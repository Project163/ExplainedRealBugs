<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:37:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1259] Log4j threads are leaking on Tomcat shutdown</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1259</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Running log4j2 v2.5 with disruptor 3.3.x. AsyncLoggers configured. log4j-web also included in the web application deployed in Tomcat 8. The context listener is correctly starting up and shutting down, catalina.properties does not include the log4j*.jar entry. Yet I see:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
20-Jan-2016 14:59:26.322 WARNING [localhost-startStop-2] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesThreads The web application [cas-server-webapp-4.3.0-SNAPSHOT] appears to have started a thread named [Log4j2-Log4j2Scheduled-5] but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:
 sun.misc.Unsafe.park(Native Method)
 java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1093)
 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:809)
 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1067)
 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)
 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
 java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
20-Jan-2016 14:59:26.336 WARNING [localhost-startStop-2] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesThreads The web application [cas-server-webapp-4.3.0-SNAPSHOT] appears to have started a thread named [Log4j2-AsyncLoggerConfig-6] but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:
 sun.misc.Unsafe.park(Native Method)
 java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
 com.lmax.disruptor.BlockingWaitStrategy.waitFor(BlockingWaitStrategy.java:45)
 com.lmax.disruptor.ProcessingSequenceBarrier.waitFor(ProcessingSequenceBarrier.java:56)
 com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:124)
 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
 java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12932884">LOG4J2-1259</key>
            <summary>Log4j threads are leaking on Tomcat shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mmoayyed">Misagh Moayyed</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Jan 2016 21:59:48 +0000</created>
                <updated>Wed, 6 Sep 2017 15:29:08 +0000</updated>
                                            <version>2.5</version>
                                                    <component>Appenders</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>18</watches>
                                                                                                                <comments>
                            <comment id="15109707" author="remkop@yahoo.com" created="Wed, 20 Jan 2016 23:17:03 +0000"  >&lt;p&gt;Can you please include your full log4j2.xml configuration file, any system properties you specified, and indicate the location of the log4j2.xml and log4j jar files (in the WAR or in container lib)?&lt;/p&gt;

&lt;p&gt;Also, what are the steps to reproduce the issue? Stop/start web app? Unload/redeploy web app? Stop web container?&lt;/p&gt;</comment>
                            <comment id="15109752" author="garydgregory" created="Wed, 20 Jan 2016 23:45:19 +0000"  >&lt;p&gt;And your classpath.&lt;/p&gt;</comment>
                            <comment id="15109763" author="ralph.goers@dslextreme.com" created="Wed, 20 Jan 2016 23:57:43 +0000"  >&lt;p&gt;There seem to be two threads in the stack trace above that are not shutting down. I believe the first is the same as what was reported on the user&apos;s list on Dec. 18. The issue is with the new ConfigurationScheduler. For some reason it is not shutting down.&lt;/p&gt;</comment>
                            <comment id="15110747" author="mmoayyed" created="Thu, 21 Jan 2016 15:21:36 +0000"  >&lt;p&gt;log4j2.xml is here:&lt;br/&gt;
&lt;a href=&quot;https://github.com/Jasig/cas/blob/master/cas-server-webapp/src/main/resources/log4j2.xml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Jasig/cas/blob/master/cas-server-webapp/src/main/resources/log4j2.xml&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;No system properties defined. Nothing special about the configuration really. Generate the war, drop it in webapps, startup.bat|sh. Tomcat comes up. shutdown.sh|bat. See the threads in the logs. Log4j jar files are part of WEB-INF\lib. &lt;/p&gt;

&lt;p&gt;I don&apos;t define anything peculiar or special for the classpath. I simply just drop the war into a vanilla brand-new tomcat environment. The webapp has about 40-50 JARs in the lib directory.  &lt;/p&gt;</comment>
                            <comment id="15110749" author="mmoayyed" created="Thu, 21 Jan 2016 15:22:40 +0000"  >&lt;p&gt;Presently, we are writing our own context listener to shut down all app threads that are log4j-related rather forcefully. &lt;/p&gt;</comment>
                            <comment id="15333612" author="remkop@yahoo.com" created="Thu, 16 Jun 2016 11:35:25 +0000"  >&lt;p&gt;In your configuration, can you add &lt;tt&gt;&amp;lt;Configuration status=&quot;trace&quot; ...&lt;/tt&gt;?&lt;br/&gt;
This will print Log4j 2 internal logging to the console and may give us more insight into what is happening.&lt;/p&gt;

&lt;p&gt;It could be that your issue has the same underlying cause as &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1419&quot; title=&quot;Memory leak on Tomcat shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1419&quot;&gt;LOG4J2-1419&lt;/a&gt;: Spring context did some logging after the Log4j 2 context was stopped, which caused Log4j 2 to reload. In the latest source in git master we now support a new system property &lt;tt&gt;log4j.LoggerContext.stacktrace.on.start&lt;/tt&gt;. If you set this to &quot;true&quot; a stack trace is printed showing what triggered the Log4j 2 context to be started. &lt;/p&gt;</comment>
                            <comment id="15421302" author="miko" created="Mon, 15 Aug 2016 17:20:01 +0000"  >&lt;p&gt;Any news with this issue?&lt;/p&gt;</comment>
                            <comment id="15421808" author="remkop@yahoo.com" created="Mon, 15 Aug 2016 22:32:35 +0000"  >&lt;p&gt;In my previous comment I asked for additional information. What do you see if you switch on trace level status logging?&lt;/p&gt;</comment>
                            <comment id="15454818" author="steffeno" created="Thu, 1 Sep 2016 08:57:27 +0000"  >&lt;p&gt;If you use the &lt;tt&gt;CronTriggeringPolicy&lt;/tt&gt;, the scheduler threads won&apos;t shut down until the job currently in the queue has been executed - which might be many hours in the future (e.g. if you configured the log system to only roll the log files at midnight every day). &lt;/p&gt;

&lt;p&gt;There does not seem to be a way to tell Log4j2 to cancel all current jobs on shutdown. Please somebody correct me if I&apos;m wrong, as this is indeed a very annoying situation in production.&lt;/p&gt;</comment>
                            <comment id="15455688" author="garydgregory" created="Thu, 1 Sep 2016 15:00:28 +0000"  >&lt;p&gt;I&apos;ve started a new initiative to better manage our Log4j threads. Please see the new Core API: org.apache.logging.log4j.core.config.Configurator.shutdown(LoggerContext, long, TimeUnit)&lt;/p&gt;

&lt;p&gt;Most but not all Log4j threads are managed from two thread pools, a normal thread pool, and a daemon thread pool.&lt;/p&gt;

&lt;p&gt;But... in the case of a &lt;tt&gt;CronTriggeringPolicy&lt;/tt&gt;, the policy manages its own pool of deamon threads and that pool is shutdown when the logger context (or Log4j) is asked to shutdown. Now that I think about it, in the case of cleaning up &lt;tt&gt;CronTriggeringPolicy&lt;/tt&gt;, you do not need to use the new API I listed above. The thread pool in the policy object should clean up normally on shutdown. Since the &lt;tt&gt;CronTriggeringPolicy&lt;/tt&gt; uses daemon threads, these threads should quietly go away when the logger context shuts down.&lt;/p&gt;

&lt;p&gt;Important: When you ask the policy&apos;s thread pool to shutdown, &lt;b&gt;it does not wait for previously submitted tasks to complete execution.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;You still need to ask the logger context to stop or shutdown.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="15464729" author="steffeno" created="Mon, 5 Sep 2016 10:52:03 +0000"  >&lt;p&gt;I just did a debugging session. I explicitly called &lt;tt&gt;LoggerContext.stop()&lt;/tt&gt; from a &lt;tt&gt;ServletContextListener&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   @Override
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void contextDestroyed( &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ServletContextEvent servletContextEvent )
   {
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LoggerContext loggerContext =
         WebLoggerContextUtils.getWebLoggerContext( servletContextEvent.getServletContext() );

      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;( loggerContext != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ) {
         loggerContext.stop();
      }
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I then stopped in the debugger after &lt;tt&gt;loggerContext.stop()&lt;/tt&gt; was called and monitored the thread in Java Mission Control. All I saw was that the threads switched to &lt;tt&gt;TIMED_WAITING&lt;/tt&gt;, but none of them was stopped:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Thread Name	Thread State	Blocked Count	Blocked Time	Waited Count	Waited Time	Total CPU Usage(%)	Deadlocked	Lock Name	Lock Owner ID	Lock Owner Name	Thread Id	Native	Suspended	Allocated Bytes(bytes)
Log4j2-Log4j2Scheduled-1	TIMED_WAITING	0		2		-45,623,600	Not Enabled	java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@636701c7			53	0	0	-256,236
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Thread Name	Thread State	Blocked Count	Blocked Time	Waited Count	Waited Time	Total CPU Usage(%)	Deadlocked	Lock Name	Lock Owner ID	Lock Owner Name	Thread Id	Native	Suspended	Allocated Bytes(bytes)
Log4j2-AsyncLoggerConfig-1	TIMED_WAITING	97		76,242		-45,623,600	Not Enabled	java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@6265aa2f			44	0	0	-256,236
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Regards,&lt;br/&gt;
  Steffen&lt;/p&gt;</comment>
                            <comment id="15465604" author="garydgregory" created="Mon, 5 Sep 2016 19:04:29 +0000"  >&lt;p&gt;Hi Steffen:&lt;/p&gt;

&lt;p&gt;Did you try with the latest from Git master?&lt;/p&gt;

&lt;p&gt;I am asking because the thread name &lt;tt&gt;&quot;Log4j2-Log4j2Scheduled-1&quot;&lt;/tt&gt; looks wrong, it should be something like &lt;tt&gt;&quot;Log4j2-TF-1-Scheduled-1&quot;&lt;/tt&gt;. This should also be a daemon thread but I cannot tell from your thread dump.&lt;/p&gt;

&lt;p&gt;Thank you,&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                            <comment id="15466557" author="steffeno" created="Tue, 6 Sep 2016 06:13:45 +0000"  >&lt;p&gt;Hi, Gary!&lt;/p&gt;

&lt;p&gt;No, I used the latest release, 2.6.2, from the public repository. There is no easy way for me to use the &lt;tt&gt;master&lt;/tt&gt; version, unfortunately.&lt;/p&gt;</comment>
                            <comment id="15466625" author="garydgregory" created="Tue, 6 Sep 2016 06:46:33 +0000"  >&lt;p&gt;If you add our SNAPSHOT repository to your Maven settings, you can try version 2.6.3-SNAPSHOT. I just pushed a fresh build there.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="15466627" author="steffeno" created="Tue, 6 Sep 2016 06:46:48 +0000"  >&lt;p&gt;I was able to do a local build, and the result was:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Before undeploying the web application:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Thread Name	Thread State	Blocked Count	Blocked Time	Waited Count	Waited Time	Total CPU Usage(%)	Deadlocked	Lock Name	Lock Owner ID	Lock Owner Name	Thread Id	Native	Suspended	Allocated Bytes(bytes)
Log4j2-TF-4-AsyncLoggerConfig-2	TIMED_WAITING	102		893		-45,623,600	Not Enabled	java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@5118f78a			37	0	0	-256,236
Log4j2-TF-3-Scheduled-1	TIMED_WAITING	0		1		-45,623,600	Not Enabled	java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@31d99db5			36	0	0	-256,236
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;After undeploying the web application:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Thread Name	Thread State	Blocked Count	Blocked Time	Waited Count	Waited Time	Total CPU Usage(%)	Deadlocked	Lock Name	Lock Owner ID	Lock Owner Name	Thread Id	Native	Suspended	Allocated Bytes(bytes)
Log4j2-TF-3-Scheduled-1	TIMED_WAITING	0		2		-45,623,600	Not Enabled	java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@31d99db5			36	0	0	-256,236
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;After redeploying the web application:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Thread Name	Thread State	Blocked Count	Blocked Time	Waited Count	Waited Time	Total CPU Usage(%)	Deadlocked	Lock Name	Lock Owner ID	Lock Owner Name	Thread Id	Native	Suspended	Allocated Bytes(bytes)
Log4j2-TF-4-AsyncLoggerConfig-2	TIMED_WAITING	96		676		-45,623,600	Not Enabled	java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@7d134f0b			69	0	0	-256,236
Log4j2-TF-3-Scheduled-1	TIMED_WAITING	0		1		-45,623,600	Not Enabled	java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@5536ad8b			68	0	0	-256,236
Log4j2-TF-3-Scheduled-1	TIMED_WAITING	0		2		-45,623,600	Not Enabled	java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@31d99db5			36	0	0	-256,236
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;After undeploying it again:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Thread Name	Thread State	Blocked Count	Blocked Time	Waited Count	Waited Time	Total CPU Usage(%)	Deadlocked	Lock Name	Lock Owner ID	Lock Owner Name	Thread Id	Native	Suspended	Allocated Bytes(bytes)
Log4j2-TF-3-Scheduled-1	TIMED_WAITING	0		2		-45,623,600	Not Enabled	java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@5536ad8b			68	0	0	-256,236
Log4j2-TF-3-Scheduled-1	TIMED_WAITING	0		2		-45,623,600	Not Enabled	java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@31d99db5			36	0	0	-256,236
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I.e. one thread remains active with every deployment/undeployment. I had managed to get that far with v2.6.2, too, in the meantime.&lt;/p&gt;</comment>
                            <comment id="15466640" author="steffeno" created="Tue, 6 Sep 2016 06:56:23 +0000"  >&lt;p&gt;Oh, and I just noticed that the following threads are left over, too:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Thread Name	Thread State	Blocked Count	Blocked Time	Waited Count	Waited Time	Total CPU Usage(%)	Deadlocked	Lock Name	Lock Owner ID	Lock Owner Name	Thread Id	Native	Suspended	Allocated Bytes(bytes)
pool-5-thread-1	TIMED_WAITING	0		2		-45,623,600	Not Enabled	java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@778bf0c2			73	0	0	-256,236
pool-2-thread-1	TIMED_WAITING	0		2		-45,623,600	Not Enabled	java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@53ec4bab			41	0	0	-256,236
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15466769" author="steffeno" created="Tue, 6 Sep 2016 08:08:58 +0000"  >&lt;p&gt;This (and the fact that the thread disappears once the next scheduled event was fired) seems to prove that the remaining thread is associated with the &lt;tt&gt;CronTriggeringPolicy&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;06-Sep-2016 09:58:00.226 WARNING [ContainerBackgroundProcessor[StandardEngine[Catalina]]] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesThreads The web application [border-proxy] appears to have started a thread named [Log4j2-TF-3-Scheduled-1] but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:
 sun.misc.Unsafe.park(Native Method)
 java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1093)
 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:809)
 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1067)
 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)
 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
 java.lang.Thread.run(Thread.java:745)
06-Sep-2016 09:59:00.002 INFO [Log4j2-TF-3-Scheduled-1] org.apache.catalina.loader.WebappClassLoaderBase.checkStateForResourceLoading Illegal access: this web application instance has been stopped already. Could not load [org.apache.logging.log4j.core.lookup.JndiLookup]. The following stack trace is thrown for debugging purposes as well as to attempt to terminate the thread which caused the illegal access.
 java.lang.IllegalStateException: Illegal access: this web application instance has been stopped already. Could not load [org.apache.logging.log4j.core.lookup.JndiLookup]. The following stack trace is thrown for debugging purposes as well as to attempt to terminate the thread which caused the illegal access.
        at org.apache.catalina.loader.WebappClassLoaderBase.checkStateForResourceLoading(WebappClassLoaderBase.java:1325)
        at org.apache.catalina.loader.WebappClassLoaderBase.checkStateForClassLoading(WebappClassLoaderBase.java:1313)
        at org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1178)
        at org.apache.catalina.loader.WebappClassLoaderBase.loadClass(WebappClassLoaderBase.java:1139)
        at org.apache.logging.log4j.util.LoaderUtil.loadClass(LoaderUtil.java:139)
        at org.apache.logging.log4j.util.LoaderUtil.newInstanceOf(LoaderUtil.java:180)
        at org.apache.logging.log4j.util.LoaderUtil.newCheckedInstanceOf(LoaderUtil.java:201)
        at org.apache.logging.log4j.core.util.Loader.newCheckedInstanceOf(Loader.java:300)
        at org.apache.logging.log4j.core.lookup.Interpolator.&amp;lt;init&amp;gt;(Interpolator.java:96)
        at org.apache.logging.log4j.core.config.AbstractConfiguration.&amp;lt;init&amp;gt;(AbstractConfiguration.java:119)
        at org.apache.logging.log4j.core.config.DefaultConfiguration.&amp;lt;init&amp;gt;(DefaultConfiguration.java:46)
        at org.apache.logging.log4j.core.LoggerContext.&amp;lt;init&amp;gt;(LoggerContext.java:81)
        at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.createContext(ClassLoaderContextSelector.java:171)
        at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.locateContext(ClassLoaderContextSelector.java:145)
        at org.apache.logging.log4j.core.selector.ClassLoaderContextSelector.getContext(ClassLoaderContextSelector.java:74)
        at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:227)
        at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:45)
        at org.apache.logging.log4j.LogManager.getContext(LogManager.java:174)
        at org.apache.logging.log4j.core.LoggerContext.getContext(LoggerContext.java:187)
        at org.apache.logging.log4j.core.appender.rolling.RollingFileManager.rollover(RollingFileManager.java:257)
        at org.apache.logging.log4j.core.appender.rolling.RollingFileManager.rollover(RollingFileManager.java:177)
        at org.apache.logging.log4j.core.appender.rolling.CronTriggeringPolicy.rollover(CronTriggeringPolicy.java:127)
        at org.apache.logging.log4j.core.appender.rolling.CronTriggeringPolicy.access$100(CronTriggeringPolicy.java:40)
        at org.apache.logging.log4j.core.appender.rolling.CronTriggeringPolicy$CronTrigger.run(CronTriggeringPolicy.java:144)
        at org.apache.logging.log4j.core.config.ConfigurationScheduler$CronRunnable.run(ConfigurationScheduler.java:178)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I configured the triggering policy to rotate the logs every minute in this example.&lt;/p&gt;</comment>
                            <comment id="15466772" author="steffeno" created="Tue, 6 Sep 2016 08:10:17 +0000"  >&lt;p&gt;Hmm, the pool thread stuff MIGHT be caused by a different part of the application. I think this does not necessarily have anything to do with Log4j2. At least I could get rid of it. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15467397" author="steffeno" created="Tue, 6 Sep 2016 13:17:25 +0000"  >&lt;p&gt;The problem is that the future holding the cron job (created via &lt;tt&gt;ConfigurationScheduler.scheduleWithCron()&lt;/tt&gt;)  is never actively cancelled. The &lt;tt&gt;CronTriggeringPolicy&lt;/tt&gt; is the only one holding a reference to that future, and stopping the executor service within &lt;tt&gt;ConfigurationScheduler&lt;/tt&gt; does not affect that future.&lt;/p&gt;

&lt;p&gt;A possible solution might be to support the registration of shutdown listeners in &lt;tt&gt;ConfigurationScheduler&lt;/tt&gt;, so the &lt;tt&gt;CronTriggeringPolicy&lt;/tt&gt; could register itself there and cancel its future once the &lt;tt&gt;ConfigurationScheduler&lt;/tt&gt; is shut down.&lt;/p&gt;</comment>
                            <comment id="15469033" author="garydgregory" created="Wed, 7 Sep 2016 00:11:44 +0000"  >&lt;p&gt;I have a tentative fix that lets &lt;tt&gt;TriggeringPolicy&lt;/tt&gt; implement &lt;tt&gt;LiceCycle&lt;/tt&gt; which has a &lt;tt&gt;stop(long, TimeUnit)&lt;/tt&gt; method. This &lt;tt&gt;TriggeringPolicy.stop(long, TimeUnit)&lt;/tt&gt; method can then be called from &lt;tt&gt;RollingFileManager.releaseSub(long timeout, TimeUnit timeUnit)&lt;/tt&gt;. A full build passes all tests. I&apos;ll commit it and then you can test it.&lt;/p&gt;</comment>
                            <comment id="15469701" author="steffeno" created="Wed, 7 Sep 2016 06:17:15 +0000"  >&lt;p&gt;Thanks, Gary, I&apos;ll check that out. But when does the &lt;tt&gt;releaseSub()&lt;/tt&gt; method get called? Don&apos;t we still have the same problem then (I haven&apos;t looked at that code yet)?&lt;/p&gt;

&lt;p&gt;BTW, I did a fix too yesterday, following the principle I described above. It works. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15469726" author="steffeno" created="Wed, 7 Sep 2016 06:29:44 +0000"  >&lt;p&gt;Oh, and yours would be a breaking change, wouldn&apos;t it (it changes the signature of the &lt;tt&gt;TriggingPolicy&lt;/tt&gt; interface)? That way all artifacts using Log4j2 would have to be recompiled before they could use the new version. &lt;/p&gt;

&lt;p&gt;... on the other hand - if you don&apos;t plan a 2.6.3 release, there will probably be more breaking changes in 2.7 anyway.&lt;/p&gt;</comment>
                            <comment id="15469748" author="steffeno" created="Wed, 7 Sep 2016 06:39:28 +0000"  >&lt;p&gt;I&apos;m afraid I can&apos;t test your changes, as they do in fact break our code. We have another implementation of &lt;tt&gt;TriggeringPolicy&lt;/tt&gt; that would have to be adjusted to implement all the methods inherited from &lt;tt&gt;LifeCycle&lt;/tt&gt;, and then ALL our artifacts would have to be recompiled, as they all depend on &lt;em&gt;Log4j2&lt;/em&gt; ...&lt;/p&gt;

&lt;p&gt;The fix that I did yesterday does not break anything. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="15469761" author="steffeno" created="Wed, 7 Sep 2016 06:47:39 +0000"  >&lt;p&gt;I did a stripped-down test. I&apos;m afraid your changes don&apos;t solve the problem, Gary, as the &lt;tt&gt;stop()&lt;/tt&gt; method does not get called. It would only get called if the method &lt;tt&gt;RollingFileManager.releaseSub()&lt;/tt&gt; was called during shutdown - which apparently is not the case.&lt;/p&gt;

&lt;p&gt;I&apos;ll adjust my own fix to match your coding styles and add it to my fork, so you can review it.&lt;/p&gt;</comment>
                            <comment id="15469853" author="steffeno" created="Wed, 7 Sep 2016 07:25:46 +0000"  >&lt;p&gt;Gary, this is the original feature branch in my fork:&lt;br/&gt;
&lt;a href=&quot;https://github.com/sofax/logging-log4j2/tree/feature/LOG4J2-1259-add-shutdown-listener-to-config-scheduler&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/sofax/logging-log4j2/tree/feature/LOG4J2-1259-add-shutdown-listener-to-config-scheduler&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And this is the result of merging it with the latest &lt;tt&gt;master&lt;/tt&gt;:&lt;br/&gt;
&lt;a href=&quot;https://github.com/sofax/logging-log4j2/tree/merge-feature/LOG4J2-1259-add-shutdown-listener-to-config-scheduler&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/sofax/logging-log4j2/tree/merge-feature/LOG4J2-1259-add-shutdown-listener-to-config-scheduler&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In the merged version I reverted your changes, so it does not break our code anymore.&lt;/p&gt;</comment>
                            <comment id="15470895" author="garydgregory" created="Wed, 7 Sep 2016 15:17:32 +0000"  >&lt;p&gt;You can inherit from &lt;tt&gt;AbstractLifeCycle&lt;/tt&gt; and not break anything &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Maybe we should introduce an &lt;tt&gt;AbstractTriggeringPolicy&lt;/tt&gt; that extends &lt;tt&gt;AbstractLifeCycle&lt;/tt&gt; to abstract this and any future changes...&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="15470911" author="garydgregory" created="Wed, 7 Sep 2016 15:23:31 +0000"  >&lt;p&gt;I added an abstract class &lt;tt&gt;AbstractTriggeringPolicy&lt;/tt&gt; that extends &lt;tt&gt;AbstractLifeCycle&lt;/tt&gt; and implements &lt;tt&gt;TriggeringPolicy&lt;/tt&gt;. All of our Core module triggering policies now extend &lt;tt&gt;AbstractTriggeringPolicy&lt;/tt&gt;. Can you have your TPs extend Core&apos;s ATP?&lt;/p&gt;</comment>
                            <comment id="15470917" author="garydgregory" created="Wed, 7 Sep 2016 15:25:27 +0000"  >&lt;p&gt;I have not seen any prep work on our end for a 2.6.3 release. OTOH, the 2.7 release will be cooked-up soon from what I see.&lt;/p&gt;</comment>
                            <comment id="15470924" author="remkop@yahoo.com" created="Wed, 7 Sep 2016 15:27:53 +0000"  >&lt;p&gt;Does the &lt;tt&gt;TriggeringPolicy&lt;/tt&gt; interface still extend &lt;tt&gt;LifeCycle&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;It is fine to introduce the abstract class and implement LifeCycle there, but in principle we should not modify a published interface.&lt;/p&gt;</comment>
                            <comment id="15471284" author="garydgregory" created="Wed, 7 Sep 2016 17:39:52 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=SteffenO&quot; class=&quot;user-hover&quot; rel=&quot;SteffenO&quot;&gt;SteffenO&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;The method &lt;tt&gt;RollingFileManager.releaseSub(long, TimeUnit)&lt;/tt&gt; and all &lt;tt&gt;*Manager.releaseSub(long, TimeUnit)&lt;/tt&gt; methods are called from &lt;tt&gt;AbstractManager.stop(long, TimeUnit)&lt;/tt&gt;. A manager is stopped by it&apos;s appender when that appender stops. It&apos;s up to each appender implementation to manage the life-cycle of it&apos;s resource manager. In the case of &lt;tt&gt;RollingFileAppender.stop(long, TimeUnit)&lt;/tt&gt;, the manager is stored in the super class &lt;tt&gt;AbstractOutputStreamAppender&lt;/tt&gt; and stopped by a call to &lt;tt&gt;super.stop(...)&lt;/tt&gt;. An appender is stopped when the logger context is stopped.&lt;/p&gt;

&lt;p&gt;So if you are not seeing the logger context stop, then that&apos;s the problem. Do you see the logger context and appender being stopped?&lt;/p&gt;

&lt;p&gt;When I step in the debugger for the test &lt;tt&gt;org.apache.logging.log4j.core.appender.rolling.RollingAppenderCronTest&lt;/tt&gt;, I can see the future being canceled in &lt;tt&gt;org.apache.logging.log4j.core.appender.rolling.CronTriggeringPolicy.stop(long, TimeUnit)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;You must have a different code path. Can you check at which point the stop() method calls do not go all the way through? Please try with the latest from Git master.&lt;/p&gt;

&lt;p&gt;Thank you,&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                            <comment id="15473003" author="steffeno" created="Thu, 8 Sep 2016 06:51:05 +0000"  >&lt;p&gt;Thanks again, Gary!&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;RollingFileManager.releaseSub()&lt;/tt&gt; is indeed called, but it holds a &lt;tt&gt;CompositeTriggeringPolicy&lt;/tt&gt;, which does not stop the nested policies because it does not override the &lt;tt&gt;stop()&lt;/tt&gt; method inherited from &lt;tt&gt;AbstractLifeCycle&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; stop(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; timeout, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TimeUnit timeUnit) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.state = LifeCycle.State.STOPPED;
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the change also still breaks existing code, because the &lt;tt&gt;TriggeringPolicy&lt;/tt&gt; interface was changed. All artifacts using Log4j2 would have to be recompiled, including the transitive dependencies.&lt;/p&gt;
</comment>
                            <comment id="15473043" author="garydgregory" created="Thu, 8 Sep 2016 07:08:43 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=SteffenO&quot; class=&quot;user-hover&quot; rel=&quot;SteffenO&quot;&gt;SteffenO&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;Nice find and my bad! I implemented &lt;tt&gt;CompositeTriggeringPolicy.stop(long, TimeUnit)&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;Can you please test the latest for your use case? &lt;/p&gt;

&lt;p&gt;We are currently discussing on the ML what the boundaries are for Binary Compatibility in the &lt;tt&gt;log4j-core&lt;/tt&gt; module. For the &lt;tt&gt;log4j-api&lt;/tt&gt; module, we strive for 100% BC of course. As Matt remarked on the ML, we should have created an SPI package a long time ago...&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="15473076" author="steffeno" created="Thu, 8 Sep 2016 07:24:15 +0000"  >&lt;p&gt;Will do in a minute, Gary. I just checked it out and looked at it - in the overridden method &lt;tt&gt;CompositeTriggeringPolicy.stop()&lt;/tt&gt; you don&apos;t call the super implementation, and hence the &lt;tt&gt;state&lt;/tt&gt; attribute won&apos;t get changed. Was that intended?&lt;/p&gt;</comment>
                            <comment id="15473122" author="garydgregory" created="Thu, 8 Sep 2016 07:48:46 +0000"  >&lt;p&gt;Arg, good catch again. Time for rest after a long day. Fixed in Git master.&lt;/p&gt;</comment>
                            <comment id="15473144" author="steffeno" created="Thu, 8 Sep 2016 08:01:12 +0000"  >&lt;p&gt;Go rest! My day has just begun. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;It works now! Thanks so far!&lt;/p&gt;

&lt;p&gt;It&apos;s still a breaking change, and one of our test cases fails now, but other than that this looks promising. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15474125" author="garydgregory" created="Thu, 8 Sep 2016 15:16:17 +0000"  >&lt;p&gt;What is your failing test?&lt;/p&gt;</comment>
                            <comment id="15475189" author="garydgregory" created="Thu, 8 Sep 2016 22:18:05 +0000"  >&lt;p&gt;I&apos;ve restored binary compatibility for TriggeringPolicy in Git master. I added a TODO comment for 3.0 to extend LifeCycle.&lt;/p&gt;</comment>
                            <comment id="15476104" author="steffeno" created="Fri, 9 Sep 2016 06:39:42 +0000"  >&lt;p&gt;The test case basically looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   @Test
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void verifyThatAsyncAppendersAreAvailable()
   {
      &lt;span class=&quot;code-comment&quot;&gt;//logTest( Configurator.initialize( &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;log4j2-xml-async.xml&quot;&lt;/span&gt; ) );
&lt;/span&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LoggerContext context = Configurator.initialize( &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;log4j2-xml-async.xml&quot;&lt;/span&gt; );

      assertThat( context, not( nullValue() ) );

      context.start();
      context.getLogger( &lt;span class=&quot;code-quote&quot;&gt;&quot;&quot; ).info( &quot;&lt;/span&gt;Test&quot; );
      context.stop();
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;This is the config file:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;warn&quot;&lt;/span&gt; packages=&lt;span class=&quot;code-quote&quot;&gt;&quot;com.aixigo.tec.logging&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Appenders&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;myConsole&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Async name=&lt;span class=&quot;code-quote&quot;&gt;&quot;myConsoleAsync&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
         &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;myConsole&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Async&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Appenders&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Loggers&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;AsyncRoot level=&lt;span class=&quot;code-quote&quot;&gt;&quot;info&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Loggers&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Configuration&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And this is the error log:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2016-09-09 08:37:03,692 main ERROR The parameter is null: layout
2016-09-09 08:37:03,695 main ERROR Unable to inject fields into builder class for plugin type class org.apache.logging.log4j.core.appender.ConsoleAppender, element Console. org.apache.logging.log4j.core.config.ConfigurationException: Arguments given for element Console are invalid
	at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.injectFields(PluginBuilder.java:198)
	at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:121)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:933)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:873)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:865)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:489)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:226)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:238)
	at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:525)
	at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:258)
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:239)
	at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:159)
	at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:131)
	at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:101)
	at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:188)
	at com.aixigo.tec.logging.DependencyTest.verifyThatAsyncAppendersAreAvailable(DependencyTest.java:97)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:86)
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:459)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:678)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:382)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:192)

2016-09-09 08:37:03,698 main ERROR Unable to invoke factory method in class class org.apache.logging.log4j.core.appender.ConsoleAppender for element Console. java.lang.IllegalStateException: No factory method found for class org.apache.logging.log4j.core.appender.ConsoleAppender
	at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.findFactoryMethod(PluginBuilder.java:224)
	at org.apache.logging.log4j.core.config.plugins.util.PluginBuilder.build(PluginBuilder.java:130)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createPluginObject(AbstractConfiguration.java:933)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:873)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.createConfiguration(AbstractConfiguration.java:865)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.doConfigure(AbstractConfiguration.java:489)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.initialize(AbstractConfiguration.java:226)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:238)
	at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:525)
	at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:258)
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:239)
	at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:159)
	at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:131)
	at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:101)
	at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:188)
	at com.aixigo.tec.logging.DependencyTest.verifyThatAsyncAppendersAreAvailable(DependencyTest.java:97)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:86)
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:459)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:678)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:382)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:192)

2016-09-09 08:37:03,707 main ERROR Null object returned for Console in Appenders.
2016-09-09 08:37:03,732 main ERROR No appender named myConsole was configured
2016-09-09 08:37:03,732 main ERROR There was a problem initializing the LoggerContext [foo] using configuration at [log4j2-xml-async.xml]. org.apache.logging.log4j.core.config.ConfigurationException: No appenders are available for AsyncAppender myConsoleAsync
	at org.apache.logging.log4j.core.appender.AsyncAppender.start(AsyncAppender.java:117)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.start(AbstractConfiguration.java:254)
	at org.apache.logging.log4j.core.LoggerContext.setConfiguration(LoggerContext.java:525)
	at org.apache.logging.log4j.core.LoggerContext.start(LoggerContext.java:258)
	at org.apache.logging.log4j.core.impl.Log4jContextFactory.getContext(Log4jContextFactory.java:239)
	at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:159)
	at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:131)
	at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:101)
	at org.apache.logging.log4j.core.config.Configurator.initialize(Configurator.java:188)
	at com.aixigo.tec.logging.DependencyTest.verifyThatAsyncAppendersAreAvailable(DependencyTest.java:97)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:86)
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:459)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:678)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:382)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:192)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="15476166" author="steffeno" created="Fri, 9 Sep 2016 07:10:21 +0000"  >&lt;p&gt;The problem occurs in &lt;tt&gt;AsyncAppender.start()&lt;/tt&gt;. When iterating through the appender refs for the &lt;tt&gt;AsyncAppender&lt;/tt&gt; named &quot;myConsoleAsync&quot; it cannot find the appender named &quot;myConsole&quot; because it is not in the map:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void start() {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Appender&amp;gt; map = config.getAppenders();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;AppenderControl&amp;gt; appenders = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AppenderRef appenderRef : appenderRefs) {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Appender appender = map.get(appenderRef.getRef());
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (appender != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                appenders.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AppenderControl(appender, appenderRef.getLevel(), appenderRef.getFilter()));
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                LOGGER.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;No appender named {} was configured&quot;&lt;/span&gt;, appenderRef);
            }
        }
        ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looks like the XML config is not parsed correctly.&lt;/p&gt;</comment>
                            <comment id="15476303" author="steffeno" created="Fri, 9 Sep 2016 08:16:23 +0000"  >&lt;p&gt;The field &quot;layout&quot; seems to be required for &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt; &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;myConsole&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;now, and that causes the error. Unfortunately the error log is useless as it does not name the cause. I could only find this using the debugger.&lt;/p&gt;

&lt;p&gt;According to the current documentation this is a bug:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Parameter Name&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Type&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;	Description&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; layout &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Layout &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The Layout to use to format the LogEvent. If no layout is supplied the default pattern layout of &quot;%m%n&quot; will be used.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;With this configuration it works:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;warn&quot;&lt;/span&gt; packages=&lt;span class=&quot;code-quote&quot;&gt;&quot;com.aixigo.tec.logging&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Appenders&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;myConsole&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
         &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DetailsLayout/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Console&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Async name=&lt;span class=&quot;code-quote&quot;&gt;&quot;myConsoleAsync&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
         &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;myConsole&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Async&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Appenders&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Loggers&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;AsyncRoot level=&lt;span class=&quot;code-quote&quot;&gt;&quot;info&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Loggers&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Configuration&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll report this as a new issue.&lt;/p&gt;</comment>
                            <comment id="15476383" author="steffeno" created="Fri, 9 Sep 2016 08:53:26 +0000"  >&lt;p&gt;Reported as&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1573&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LOG4J2-1573&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15492471" author="garydgregory" created="Thu, 15 Sep 2016 05:53:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=SteffenO&quot; class=&quot;user-hover&quot; rel=&quot;SteffenO&quot;&gt;SteffenO&lt;/a&gt;: Can you reproduce?&lt;/p&gt;</comment>
                            <comment id="15492558" author="steffeno" created="Thu, 15 Sep 2016 06:47:52 +0000"  >&lt;p&gt;@&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;:&lt;br/&gt;
In &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1259?focusedCommentId=15473144&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15473144&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;comment 15473144&lt;/a&gt; I confirmed that the threads now are shut down correctly, and that the tests no longer break. That still holds. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;What remains to do is described in issue &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1573&quot; title=&quot;Layout is no longer optional&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1573&quot;&gt;&lt;del&gt;LOG4J2-1573&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15492568" author="garydgregory" created="Thu, 15 Sep 2016 06:51:06 +0000"  >&lt;p&gt;Closing per &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=SteffenO&quot; class=&quot;user-hover&quot; rel=&quot;SteffenO&quot;&gt;SteffenO&lt;/a&gt;&apos;s comment. See also &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1573&quot; title=&quot;Layout is no longer optional&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1573&quot;&gt;&lt;del&gt;LOG4J2-1573&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15506734" author="gabe.stanek@gmail.com" created="Tue, 20 Sep 2016 14:31:27 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt; - could you confirm which official release this change will be a part of, and what date that release is scheduled for?&lt;/p&gt;</comment>
                            <comment id="15506777" author="jvz" created="Tue, 20 Sep 2016 14:45:00 +0000"  >&lt;p&gt;It&apos;ll be in 2.7, and we&apos;re getting read to release that within the next week or so. We almost began a release yesterday, but we found a regression we&apos;re investigating first.&lt;/p&gt;</comment>
                            <comment id="15507208" author="gabe.stanek@gmail.com" created="Tue, 20 Sep 2016 17:32:47 +0000"  >&lt;p&gt;Great, thank you!&lt;/p&gt;</comment>
                            <comment id="15507277" author="garydgregory" created="Tue, 20 Sep 2016 17:57:22 +0000"  >&lt;p&gt;Are you able to test our Git master?&lt;/p&gt;</comment>
                            <comment id="15510324" author="gabe.stanek@gmail.com" created="Wed, 21 Sep 2016 15:41:18 +0000"  >&lt;p&gt;My test so far have not been successful.  I&apos;ve used the following dependencies:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.logging.log4j&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;log4j-api&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;2.6.3-SNAPSHOT&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.logging.log4j&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;log4j-core&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;2.6.3-SNAPSHOT&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.logging.log4j&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;log4j-slf4j-impl&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;2.6.2&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.slf4j&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt; 
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;slf4j-api&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;1.7.21&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.lmax&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;disruptor&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;3.3.5&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but, when I delete my war to undeploy the app, I see the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;Sep 21, 2016 8:37:30 AM org.apache.catalina.startup.HostConfig undeploy
INFO: Undeploying context [/webs-pub-subscription-usage-api]
Sep 21, 2016 8:37:30 AM org.apache.catalina.loader.WebappClassLoader clearReferencesJdbc
SEVERE: The web application [/webs-pub-subscription-usage-api] registered the JDBC driver [oracle.jdbc.OracleDriver] but failed to unregister it when the web application was stopped. To prevent a memory leak, the JDBC Driver has been forcibly unregistered.
Sep 21, 2016 8:37:30 AM org.apache.catalina.loader.WebappClassLoader clearReferencesThreads
SEVERE: The web application [/webs-pub-subscription-usage-api] appears to have started a thread named [Log4j2-TF-3-Scheduled-1] but has failed to stop it. This is very likely to create a memory leak.
Sep 21, 2016 8:37:30 AM org.apache.catalina.loader.WebappClassLoader clearReferencesThreads
SEVERE: The web application [/webs-pub-subscription-usage-api] appears to have started a thread named [Log4j2-TF-4-AsyncLoggerConfig-2] but has failed to stop it. This is very likely to create a memory leak.
Sep 21, 2016 8:37:30 AM org.apache.catalina.loader.WebappClassLoader clearReferencesThreads
SEVERE: The web application [/webs-pub-subscription-usage-api] appears to have started a thread named [Thread-53] but has failed to stop it. This is very likely to create a memory leak.
Sep 21, 2016 8:37:30 AM org.apache.catalina.loader.WebappClassLoader checkThreadLocalMapForLeaks
SEVERE: The web application [/webs-pub-subscription-usage-api] created a ThreadLocal with key of type [org.springframework.core.NamedThreadLocal] (value [Locale context]) and a value of type [org.springframework.context.i18n.SimpleLocaleContext] (value [en_US]) but failed to remove it when the web application was stopped. Threads are going to be renewed over time to try and avoid a probable memory leak.
Sep 21, 2016 8:37:30 AM org.apache.catalina.loader.WebappClassLoader checkThreadLocalMapForLeaks
SEVERE: The web application [/webs-pub-subscription-usage-api] created a ThreadLocal with key of type [com.intuit.platform.webs.aop.KpiLogging$1] (value [com.intuit.platform.webs.aop.KpiLogging$1@20cec9a5]) and a value of type [java.util.HashMap] (value [{}]) but failed to remove it when the web application was stopped. Threads are going to be renewed over time to try and avoid a probable memory leak.
Sep 21, 2016 8:37:45 AM org.apache.catalina.loader.WebappClassLoader loadClass
INFO: Illegal access: this web application instance has been stopped already.  Could not load org.apache.logging.log4j.core.config.ConfiguratonFileWatcher$ReconfigurationWorker.  The eventual following stack trace is caused by an error thrown for debugging purposes as well as to attempt to terminate the thread which caused the illegal access, and has no functional impact.
java.lang.IllegalStateException
        at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1614)
        at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1573)
        at org.apache.logging.log4j.core.config.ConfiguratonFileWatcher.fileModified(ConfiguratonFileWatcher.java:46)
        at org.apache.logging.log4j.core.util.WatchManager$WatchWorker.run(WatchManager.java:103)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For reference, my log4j2.xml configuration is the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Configuration strict=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;loggingConfig&quot;&lt;/span&gt; monitorInterval=&lt;span class=&quot;code-quote&quot;&gt;&quot;30&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Properties&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;logDir&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;${sys:catalina.base}/logs&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Property&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileName&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;webs-pub-subscription-usage-api-v3.log&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Property&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Properties&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Appenders&amp;gt;&lt;/span&gt;
		&amp;lt;RollingRandomAccessFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileLogger&quot;&lt;/span&gt;
			fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;${logDir}/${fileName}&quot;&lt;/span&gt; append=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt;
			filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;${logDir}/$${date:yyyy-MM}/${fileName}-%d{MM-dd-yyyy}-%i.log.gz&quot;&lt;/span&gt;&amp;gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;PatternLayout&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;pattern&amp;gt;&lt;/span&gt;%d | level=%-5p| thread=%t | class=%c |%X{intuit_app_nameFormat}%X{intuit_appidFormat}%X{intuit_assetaliasFormat}%X{intuit_originatingipFormat}%X{intuit_tidFormat}%X{intuit_transactionidFormat}%X{intuit_realmidFormat}%X{intuit_subscriptionidFormat}%X{intuit_useridFormat} %m%n&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/pattern&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/PatternLayout&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Policies&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;TimeBasedTriggeringPolicy /&amp;gt;&lt;/span&gt;
				&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;250 MB&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Policies&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DefaultRolloverStrategy max=&lt;span class=&quot;code-quote&quot;&gt;&quot;10&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/RollingRandomAccessFile&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Appenders&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Loggers&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;AsyncRoot level=&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt; additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
			&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;fileLogger&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/AsyncRoot&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Loggers&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Configuration&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you see that I have configured something incorrectly, I&apos;d be happy to make a change and test again.&lt;/p&gt;</comment>
                            <comment id="15510729" author="garydgregory" created="Wed, 21 Sep 2016 18:15:47 +0000"  >&lt;p&gt;I notice that you are not using the &lt;tt&gt;log4j-web&lt;/tt&gt; module. See &lt;a href=&quot;https://logging.apache.org/log4j/2.x/log4j-web/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/log4j-web/index.html&lt;/a&gt; and &lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/webapp.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/manual/webapp.html&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Can you try that with the latest SNAPSHOT build?&lt;/p&gt;

&lt;p&gt;I uploaded a new snapshot with updates to the log4j-web module to allow for a more orderly shutdown.&lt;/p&gt;

&lt;p&gt;The commit adds two servlet init parameters called &lt;tt&gt;log4j.stop.timeout&lt;/tt&gt;&lt;br/&gt;
and &lt;tt&gt;log4j.stop.timeout.timeunit&lt;/tt&gt; with defaults of 30 and&lt;br/&gt;
TimeUnit.SECONDS.&lt;/p&gt;

&lt;p&gt;Before this code, I am thinking that when the container shuts down Log4j and unloads the classes, some Log4j code is left running in sleeping threads and causes problems like &quot;Could not load org.apache.logging.log4j.core.config.ConfiguratonFileWatcher$ReconfigurationWorker.&quot;&lt;/p&gt;

&lt;p&gt;The new shutdown code causes Log4j to wait up to the timeout for resources like thread pools to shutdown after requesting the cancellation of scheduled jobs, which the ReconfigurationWorker is. (Detail: I renamed ReconfigurationWorker to ReconfigurationRunnable)&lt;/p&gt;

&lt;p&gt;Without the timeout request, Log4j shutsdown immediately but does not wait for jobs to complete.&lt;/p&gt;</comment>
                            <comment id="15510855" author="gabe.stanek@gmail.com" created="Wed, 21 Sep 2016 19:04:11 +0000"  >&lt;p&gt;Good catch on the log4j-web module.  It appears I did not read far enough down on the maven page to see the additional module was needed.  Unfortunately, even with the module included, I still see similar exceptions.  I included the module as a runtime dependency:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;org.apache.logging.log4j&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;log4j-web&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;2.6.3-SNAPSHOT&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;scope&amp;gt;&lt;/span&gt;runtime&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/scope&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When looking at the lib folder of the generated war, I do see one extra log4j related jar: log4j-1.2.16&lt;br/&gt;
That jar is brought in from a dependency.  I don&apos;t anticipate that it would cause a conflict, but wanted to point it out in case you think it would.&lt;/p&gt;

&lt;p&gt;Latest log output on app shutdown (Tomcat still running):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;Sep 21, 2016 11:32:34 AM org.apache.catalina.startup.HostConfig undeploy
INFO: Undeploying context [/webs-pub-subscription-usage-api]
Sep 21, 2016 11:32:34 AM org.apache.catalina.loader.WebappClassLoader clearReferencesJdbc
SEVERE: The web application [/webs-pub-subscription-usage-api] registered the JDBC driver [oracle.jdbc.OracleDriver] but failed to unregister it when the web application was stopped. To prevent a memory leak, the JDBC Driver has been forcibly unregistered.
Sep 21, 2016 11:32:34 AM org.apache.catalina.loader.WebappClassLoader clearReferencesThreads
SEVERE: The web application [/webs-pub-subscription-usage-api] appears to have started a thread named [Log4j2-TF-3-Scheduled-1] but has failed to stop it. This is very likely to create a memory leak.
Sep 21, 2016 11:32:34 AM org.apache.catalina.loader.WebappClassLoader clearReferencesThreads
SEVERE: The web application [/webs-pub-subscription-usage-api] appears to have started a thread named [Log4j2-TF-4-AsyncLoggerConfig-2] but has failed to stop it. This is very likely to create a memory leak.
Sep 21, 2016 11:32:52 AM org.apache.catalina.loader.WebappClassLoader loadClass
INFO: Illegal access: this web application instance has been stopped already.  Could not load org.apache.logging.log4j.core.config.ConfiguratonFileWatcher$ReconfigurationWorker.  The eventual following stack trace is caused by an error thrown for debugging purposes as well as to attempt to terminate the thread which caused the illegal access, and has no functional impact.
java.lang.IllegalStateException
        at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1614)
        at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1573)
        at org.apache.logging.log4j.core.config.ConfiguratonFileWatcher.fileModified(ConfiguratonFileWatcher.java:46)
        at org.apache.logging.log4j.core.util.WatchManager$WatchWorker.run(WatchManager.java:103)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &quot;SEVERE&quot; entries related to Log4j2 occur nearly immediately after the shutdown process initiates, so it seems the delay is not taking affect. &lt;/p&gt;</comment>
                            <comment id="15510972" author="garydgregory" created="Wed, 21 Sep 2016 19:50:02 +0000"  >&lt;p&gt;In your Log4j configuration file, please set status to TRACE and lets see what comes out on the console. &lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;TRACE&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="15511185" author="gabe.stanek@gmail.com" created="Wed, 21 Sep 2016 21:10:36 +0000"  >&lt;p&gt;The logs that I have been pasting from shutdown are output to catalina.out and configured via the Tomcat logging.properties file, which at this point has default configurations.  I&apos;ll have to spend more time getting the right settings in place to see more detail on the shutdown.  My day is ending here and I&apos;m off tomorrow. I&apos;ll try to look at this again on Friday.  I&apos;ll provide more detail when I have it.&lt;/p&gt;</comment>
                            <comment id="15511195" author="garydgregory" created="Wed, 21 Sep 2016 21:14:01 +0000"  >&lt;p&gt;OK, sounds good.&lt;/p&gt;</comment>
                            <comment id="15516552" author="gabe.stanek@gmail.com" created="Fri, 23 Sep 2016 14:07:44 +0000"  >&lt;p&gt;I&apos;ve realized this morning that I had referenced the log4j snapshot dependencies via the dependency management section of the pom instead of the dependencies section.  Moving the references to the dependencies section and ensuring the log4j-web artifact was included does resolve the issue after all.  I apologize if you spent more unneeded time digging deeper on this due to my silly mistake.  Thanks for the help&lt;/p&gt;</comment>
                            <comment id="15860840" author="ralphgoers" created="Fri, 10 Feb 2017 06:49:10 +0000"  >&lt;p&gt;I believe this is most likely fixed in 2.8. Can someone please verify that?&lt;/p&gt;</comment>
                            <comment id="15894974" author="vguna" created="Fri, 3 Mar 2017 20:21:33 +0000"  >&lt;p&gt;I just ran into the same problem using 2.8.1.&lt;br/&gt;
Apache Tomcat/8.0.20, jdk 1.8.0_66-b18, Windows 7.&lt;/p&gt;

&lt;p&gt;I&apos;ve added the log4j-web.jar, switched to servlet spec 3.0 in my web.xml and I&apos;m using Spring in my web application.&lt;br/&gt;
I&apos;ve added an AsyncAppender in front of my SmtpAppender. Starting the webapp and directly stopping it leads to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
2017-03-03 21:17:56,049 localhost-startStop-2 TRACE Reregistering MBeans after reconfigure. Selector=org.apache.logging.log4j.core.selector.ClassLoaderContextSelector@33d1ef79
2017-03-03 21:17:56,049 localhost-startStop-2 TRACE Reregistering context (1/1): &lt;span class=&quot;code-quote&quot;&gt;&apos;37b00782&apos;&lt;/span&gt; org.apache.logging.log4j.core.LoggerContext@28b6cf75
2017-03-03 21:17:56,049 localhost-startStop-2 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=37b00782&apos;&lt;/span&gt;
2017-03-03 21:17:56,050 localhost-startStop-2 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=37b00782,component=StatusLogger&apos;&lt;/span&gt;
2017-03-03 21:17:56,050 localhost-startStop-2 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=37b00782,component=ContextSelector&apos;&lt;/span&gt;
2017-03-03 21:17:56,050 localhost-startStop-2 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=37b00782,component=Loggers,name=*&apos;&lt;/span&gt;
2017-03-03 21:17:56,051 localhost-startStop-2 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=37b00782,component=Appenders,name=*&apos;&lt;/span&gt;
2017-03-03 21:17:56,051 localhost-startStop-2 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=37b00782,component=AsyncAppenders,name=*&apos;&lt;/span&gt;
2017-03-03 21:17:56,051 localhost-startStop-2 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=37b00782,component=AsyncLoggerRingBuffer&apos;&lt;/span&gt;
2017-03-03 21:17:56,051 localhost-startStop-2 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=37b00782,component=Loggers,name=*,subtype=RingBuffer&apos;&lt;/span&gt;
2017-03-03 21:17:56,052 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782
2017-03-03 21:17:56,055 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782,component=StatusLogger
2017-03-03 21:17:56,056 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782,component=ContextSelector
2017-03-03 21:17:56,056 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782,component=Loggers,name=
2017-03-03 21:17:56,057 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782,component=Loggers,name=org.hibernate.SQL
2017-03-03 21:17:56,058 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782,component=Loggers,name=org.springframework.transaction
2017-03-03 21:17:56,059 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782,component=Loggers,name=org.springframework.security
2017-03-03 21:17:56,060 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782,component=Loggers,name=com.acme.backend
2017-03-03 21:17:56,061 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782,component=Loggers,name=org.springframework.orm.jpa
2017-03-03 21:17:56,062 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782,component=Loggers,name=org.hibernate.type
2017-03-03 21:17:56,063 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782,component=Appenders,name=smtpAppender
2017-03-03 21:17:56,063 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782,component=AsyncAppenders,name=asyncSmtpAppender
2017-03-03 21:17:56,064 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782,component=Appenders,name=rollingFileAppender
2017-03-03 21:17:56,065 localhost-startStop-2 DEBUG Registering MBean org.apache.logging.log4j2:type=37b00782,component=Appenders,name=consoleAppender
2017-03-03 21:17:56,066 localhost-startStop-2 TRACE Using DummyNanoClock &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; nanosecond timestamps.
2017-03-03 21:17:56,066 localhost-startStop-2 DEBUG Reconfiguration complete &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; context[name=37b00782] at URI E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\pg-web-impl\WEB-INF\classes\log4j2.xml (org.apache.logging.log4j.core.LoggerContext@28b6cf75) with optional &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2017-03-03 21:17:56,066 localhost-startStop-2 DEBUG Shutdown hook enabled. Registering a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; one.
2017-03-03 21:17:56,067 localhost-startStop-2 DEBUG LoggerContext[name=37b00782, org.apache.logging.log4j.core.LoggerContext@28b6cf75] started OK.
M&#228;r 03, 2017 9:17:56 PM org.apache.catalina.loader.WebappClassLoaderBase clearReferencesThreads
WARNUNG: The web application [acme-backend] appears to have started a thread named [AsyncAppender-asyncSmtpAppender] but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:
 sun.misc.Unsafe.park(Native Method)
 java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
 java.util.concurrent.ArrayBlockingQueue.take(ArrayBlockingQueue.java:403)
 org.apache.logging.log4j.core.appender.AsyncAppender$AsyncThread.run(AsyncAppender.java:403)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here&apos;s the output of status=trace during startup:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2017-03-03 21:09:58,741 localhost-startStop-1 DEBUG Starting LoggerContext[name=Acme Backend] from configuration at &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2017-03-03 21:09:58,745 localhost-startStop-1 DEBUG Starting LoggerContext[name=Acme Backend, org.apache.logging.log4j.core.LoggerContext@554ad7a7] with configuration XmlConfiguration[location=E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml]...
2017-03-03 21:09:58,746 localhost-startStop-1 DEBUG Shutdown hook enabled. Registering a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; one.
2017-03-03 21:09:58,748 localhost-startStop-1 DEBUG Initializing configuration XmlConfiguration[location=E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml]
2017-03-03 21:09:58,755 localhost-startStop-1 DEBUG Installed script engines
2017-03-03 21:09:59,396 localhost-startStop-1 DEBUG Oracle Nashorn Version: 1.8.0_66, Language: ECMAScript, Threading: Not &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; Safe, Compile: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, Names: {nashorn, Nashorn, js, JS, JavaScript, javascript, ECMAScript, ecmascript}
2017-03-03 21:09:59,407 localhost-startStop-1 DEBUG Took 0,009540 seconds to load 4 plugins from &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; com.acme.backend.service.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.logging.log4j2
2017-03-03 21:09:59,407 localhost-startStop-1 DEBUG PluginManager &lt;span class=&quot;code-quote&quot;&gt;&apos;Core&apos;&lt;/span&gt; found 117 plugins
2017-03-03 21:09:59,407 localhost-startStop-1 DEBUG PluginManager &lt;span class=&quot;code-quote&quot;&gt;&apos;Level&apos;&lt;/span&gt; found 0 plugins
2017-03-03 21:09:59,425 localhost-startStop-1 DEBUG Building Plugin[name=property, class=org.apache.logging.log4j.core.config.Property].
2017-03-03 21:09:59,443 localhost-startStop-1 TRACE TypeConverterRegistry initializing.
2017-03-03 21:09:59,444 localhost-startStop-1 DEBUG PluginManager &lt;span class=&quot;code-quote&quot;&gt;&apos;TypeConverter&apos;&lt;/span&gt; found 26 plugins
2017-03-03 21:09:59,458 localhost-startStop-1 DEBUG createProperty(name=&lt;span class=&quot;code-quote&quot;&gt;&quot;logsPath&quot;&lt;/span&gt;, value=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs&quot;&lt;/span&gt;)
2017-03-03 21:09:59,458 localhost-startStop-1 DEBUG Building Plugin[name=properties, class=org.apache.logging.log4j.core.config.PropertiesPlugin].
2017-03-03 21:09:59,466 localhost-startStop-1 DEBUG configureSubstitutor(={logsPath=logs}, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml))
2017-03-03 21:09:59,467 localhost-startStop-1 DEBUG PluginManager &lt;span class=&quot;code-quote&quot;&gt;&apos;Lookup&apos;&lt;/span&gt; found 14 plugins
2017-03-03 21:09:59,467 localhost-startStop-1 DEBUG Building Plugin[name=layout, class=org.apache.logging.log4j.core.layout.PatternLayout].
2017-03-03 21:09:59,477 localhost-startStop-1 DEBUG PatternLayout$Builder(pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d %-5p [%mdc{RQID}] [%c{1}] - %m%n&quot;&lt;/span&gt;, PatternSelector=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), Replace=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, charset=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, alwaysWriteExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, disableAnsi=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, noConsoleNoAnsi=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, header=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, footer=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;)
2017-03-03 21:09:59,478 localhost-startStop-1 DEBUG PluginManager &lt;span class=&quot;code-quote&quot;&gt;&apos;Converter&apos;&lt;/span&gt; found 41 plugins
2017-03-03 21:09:59,507 localhost-startStop-1 DEBUG Building Plugin[name=SizeBasedTriggeringPolicy, class=org.apache.logging.log4j.core.appender.rolling.SizeBasedTriggeringPolicy].
2017-03-03 21:09:59,510 localhost-startStop-1 DEBUG createPolicy(size=&lt;span class=&quot;code-quote&quot;&gt;&quot;10 MB&quot;&lt;/span&gt;)
2017-03-03 21:09:59,512 localhost-startStop-1 DEBUG Building Plugin[name=Policies, class=org.apache.logging.log4j.core.appender.rolling.CompositeTriggeringPolicy].
2017-03-03 21:09:59,513 localhost-startStop-1 DEBUG createPolicy(={SizeBasedTriggeringPolicy(size=10485760)})
2017-03-03 21:09:59,513 localhost-startStop-1 DEBUG Building Plugin[name=DefaultRolloverStrategy, class=org.apache.logging.log4j.core.appender.rolling.DefaultRolloverStrategy].
2017-03-03 21:09:59,515 localhost-startStop-1 DEBUG createStrategy(max=&lt;span class=&quot;code-quote&quot;&gt;&quot;5&quot;&lt;/span&gt;, min=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, fileIndex=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, compressionLevel=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, ={}, stopCustomActionsOnError=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml))
2017-03-03 21:09:59,516 localhost-startStop-1 DEBUG Building Plugin[name=appender, class=org.apache.logging.log4j.core.appender.RollingRandomAccessFileAppender].
2017-03-03 21:09:59,528 localhost-startStop-1 DEBUG RollingRandomAccessFileAppender$Builder(fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/acme-backend.log&quot;&lt;/span&gt;, filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/acme-backend-%d{yyyy-MM-dd}-%i.log&quot;&lt;/span&gt;, append=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, Policies(CompositeTriggeringPolicy(policies=[SizeBasedTriggeringPolicy(size=10485760)])), DefaultRolloverStrategy(DefaultRolloverStrategy(min=1, max=5, useMax=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)), advertise=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, advertiseURI=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, bufferedIo=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, bufferSize=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, immediateFlush=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, ignoreExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, PatternLayout(%d %-5p [%mdc{RQID}] [%c{1}] - %m%n), name=&lt;span class=&quot;code-quote&quot;&gt;&quot;rollingFileAppender&quot;&lt;/span&gt;, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2017-03-03 21:09:59,539 localhost-startStop-1 TRACE RandomAccessFile logs/acme-backend.log seek to 9220221
2017-03-03 21:09:59,539 localhost-startStop-1 DEBUG Starting RollingRandomAccessFileManager logs/acme-backend.log
2017-03-03 21:09:59,542 localhost-startStop-1 DEBUG PluginManager &lt;span class=&quot;code-quote&quot;&gt;&apos;FileConverter&apos;&lt;/span&gt; found 2 plugins
2017-03-03 21:09:59,544 localhost-startStop-1 DEBUG Setting prev file time to 2017-03-03T21:01:57.387+0100
2017-03-03 21:09:59,550 localhost-startStop-1 DEBUG Initializing triggering policy CompositeTriggeringPolicy(policies=[SizeBasedTriggeringPolicy(size=10485760)])
2017-03-03 21:09:59,550 localhost-startStop-1 DEBUG Building Plugin[name=layout, class=org.apache.logging.log4j.core.layout.PatternLayout].
2017-03-03 21:09:59,550 localhost-startStop-1 DEBUG PatternLayout$Builder(pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d{HH:mm:ss,SSS} %-5p [%mdc{RQID}] [%c{1}] - %m%n&quot;&lt;/span&gt;, PatternSelector=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), Replace=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, charset=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, alwaysWriteExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, disableAnsi=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, noConsoleNoAnsi=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, header=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, footer=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;)
2017-03-03 21:09:59,551 localhost-startStop-1 DEBUG Building Plugin[name=appender, class=org.apache.logging.log4j.core.appender.ConsoleAppender].
2017-03-03 21:09:59,554 localhost-startStop-1 DEBUG ConsoleAppender$Builder(target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;, follow=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, direct=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, bufferedIo=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, bufferSize=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, immediateFlush=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, ignoreExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, PatternLayout(%d{HH:mm:ss,SSS} %-5p [%mdc{RQID}] [%c{1}] - %m%n), name=&lt;span class=&quot;code-quote&quot;&gt;&quot;consoleAppender&quot;&lt;/span&gt;, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2017-03-03 21:09:59,556 localhost-startStop-1 DEBUG Jansi is not installed, cannot find org.fusesource.jansi.WindowsAnsiOutputStream
2017-03-03 21:09:59,557 localhost-startStop-1 DEBUG Starting OutputStreamManager SYSTEM_OUT.&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2017-03-03 21:09:59,557 localhost-startStop-1 DEBUG Building Plugin[name=filter, class=com.acme.backend.service.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.logging.log4j2.RegExFileFilter].
2017-03-03 21:09:59,559 localhost-startStop-1 DEBUG createFilter(filePath=&lt;span class=&quot;code-quote&quot;&gt;&quot;log4j2-regex-filters.txt&quot;&lt;/span&gt;, checkModificationIntervalSecs=&lt;span class=&quot;code-quote&quot;&gt;&quot;60&quot;&lt;/span&gt;, acceptOnMatch=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;)
2017-03-03 21:09:59,563 localhost-startStop-1 INFO loading regexs from &lt;span class=&quot;code-quote&quot;&gt;&apos;E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2-regex-filters.txt&apos;&lt;/span&gt;...
2017-03-03 21:09:59,564 localhost-startStop-1 DEBUG Building Plugin[name=filter, class=com.acme.backend.service.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.logging.log4j2.DeduplicateExceptionFilter].
2017-03-03 21:09:59,566 localhost-startStop-1 DEBUG createFilter(level=&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;, expirationIntervalMillis=&lt;span class=&quot;code-quote&quot;&gt;&quot;60000&quot;&lt;/span&gt;, releaseBlockAfterSilenceOfSecs=&lt;span class=&quot;code-quote&quot;&gt;&quot;3600&quot;&lt;/span&gt;, releaseBlockAfterSecs=&lt;span class=&quot;code-quote&quot;&gt;&quot;21600&quot;&lt;/span&gt;, dupsHighlightCount=&lt;span class=&quot;code-quote&quot;&gt;&quot;10&quot;&lt;/span&gt;)
2017-03-03 21:09:59,593 localhost-startStop-1 DEBUG Building Plugin[name=filters, class=org.apache.logging.log4j.core.filter.CompositeFilter].
2017-03-03 21:09:59,595 localhost-startStop-1 DEBUG createFilters(={RegExFileFilter, DeduplicateExceptionFilter})
2017-03-03 21:09:59,595 localhost-startStop-1 DEBUG Building Plugin[name=layout, class=org.apache.logging.log4j.core.layout.PatternLayout].
2017-03-03 21:09:59,596 localhost-startStop-1 DEBUG PatternLayout$Builder(pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d %-5p [%mdc{RQID}] [%c{1}] - %m%n&quot;&lt;/span&gt;, PatternSelector=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), Replace=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, charset=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, alwaysWriteExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, disableAnsi=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, noConsoleNoAnsi=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, header=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, footer=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;)
2017-03-03 21:09:59,597 localhost-startStop-1 DEBUG Building Plugin[name=appender, class=com.acme.backend.service.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.logging.log4j2.DeduplicateExceptionSmtpAppender].
2017-03-03 21:09:59,604 localhost-startStop-1 DEBUG createAppender(Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), name=&lt;span class=&quot;code-quote&quot;&gt;&quot;smtpAppender&quot;&lt;/span&gt;, PatternLayout(%d %-5p [%mdc{RQID}] [%c{1}] - %m%n), Filters({RegExFileFilter, DeduplicateExceptionFilter}), ignoreExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;)
2017-03-03 21:09:59,634 localhost-startStop-1 DEBUG Starting SmtpManager SMTP:bc180b2b3c83b892f0c5ade1df40cd47
2017-03-03 21:09:59,635 localhost-startStop-1 DEBUG Building Plugin[name=AppenderRef, class=org.apache.logging.log4j.core.config.AppenderRef].
2017-03-03 21:09:59,636 localhost-startStop-1 DEBUG createAppenderRef(ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;smtpAppender&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2017-03-03 21:09:59,636 localhost-startStop-1 DEBUG Building Plugin[name=appender, class=org.apache.logging.log4j.core.appender.AsyncAppender].
2017-03-03 21:09:59,640 localhost-startStop-1 DEBUG AsyncAppender$Builder(={smtpAppender}, errorRef=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, blocking=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, shutdownTimeout=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, bufferSize=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&quot;asyncSmtpAppender&quot;&lt;/span&gt;, includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), ignoreExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, BlockingQueueFactory=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2017-03-03 21:09:59,641 localhost-startStop-1 DEBUG Building Plugin[name=appenders, class=org.apache.logging.log4j.core.config.AppendersPlugin].
2017-03-03 21:09:59,641 localhost-startStop-1 DEBUG createAppenders(={rollingFileAppender, consoleAppender, smtpAppender, asyncSmtpAppender})
2017-03-03 21:09:59,641 localhost-startStop-1 DEBUG Building Plugin[name=logger, class=org.apache.logging.log4j.core.config.LoggerConfig].
2017-03-03 21:09:59,642 localhost-startStop-1 DEBUG createLogger(additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&quot;com.acme.backend&quot;&lt;/span&gt;, includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, ={}, ={}, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2017-03-03 21:09:59,646 localhost-startStop-1 DEBUG Building Plugin[name=logger, class=org.apache.logging.log4j.core.config.LoggerConfig].
2017-03-03 21:09:59,647 localhost-startStop-1 DEBUG createLogger(additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.springframework.security&quot;&lt;/span&gt;, includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, ={}, ={}, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2017-03-03 21:09:59,647 localhost-startStop-1 DEBUG Building Plugin[name=logger, class=org.apache.logging.log4j.core.config.LoggerConfig].
2017-03-03 21:09:59,648 localhost-startStop-1 DEBUG createLogger(additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.springframework.transaction&quot;&lt;/span&gt;, includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, ={}, ={}, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2017-03-03 21:09:59,648 localhost-startStop-1 DEBUG Building Plugin[name=logger, class=org.apache.logging.log4j.core.config.LoggerConfig].
2017-03-03 21:09:59,648 localhost-startStop-1 DEBUG createLogger(additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.springframework.orm.jpa&quot;&lt;/span&gt;, includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, ={}, ={}, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2017-03-03 21:09:59,649 localhost-startStop-1 DEBUG Building Plugin[name=logger, class=org.apache.logging.log4j.core.config.LoggerConfig].
2017-03-03 21:09:59,649 localhost-startStop-1 DEBUG createLogger(additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.hibernate.SQL&quot;&lt;/span&gt;, includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, ={}, ={}, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2017-03-03 21:09:59,649 localhost-startStop-1 DEBUG Building Plugin[name=logger, class=org.apache.logging.log4j.core.config.LoggerConfig].
2017-03-03 21:09:59,650 localhost-startStop-1 DEBUG createLogger(additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.hibernate.type&quot;&lt;/span&gt;, includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, ={}, ={}, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2017-03-03 21:09:59,650 localhost-startStop-1 DEBUG Building Plugin[name=AppenderRef, class=org.apache.logging.log4j.core.config.AppenderRef].
2017-03-03 21:09:59,651 localhost-startStop-1 DEBUG createAppenderRef(ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;consoleAppender&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2017-03-03 21:09:59,651 localhost-startStop-1 DEBUG Building Plugin[name=AppenderRef, class=org.apache.logging.log4j.core.config.AppenderRef].
2017-03-03 21:09:59,651 localhost-startStop-1 DEBUG createAppenderRef(ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;rollingFileAppender&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2017-03-03 21:09:59,651 localhost-startStop-1 DEBUG Building Plugin[name=filter, class=com.acme.backend.service.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.logging.log4j2.IsPropertySetFilter].
2017-03-03 21:09:59,652 localhost-startStop-1 DEBUG createFilter(sysProperty=&lt;span class=&quot;code-quote&quot;&gt;&quot;pgb.env&quot;&lt;/span&gt;, envProperty=&lt;span class=&quot;code-quote&quot;&gt;&quot;PGB_ENV&quot;&lt;/span&gt;, value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, onMatch=&lt;span class=&quot;code-quote&quot;&gt;&quot;ACCEPT&quot;&lt;/span&gt;, onMismatch=&lt;span class=&quot;code-quote&quot;&gt;&quot;DENY&quot;&lt;/span&gt;)
2017-03-03 21:09:59,652 localhost-startStop-1 DEBUG Building Plugin[name=AppenderRef, class=org.apache.logging.log4j.core.config.AppenderRef].
2017-03-03 21:09:59,653 localhost-startStop-1 DEBUG createAppenderRef(ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;asyncSmtpAppender&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, IsPropertySetFilter(IsPropertySetFilter))
2017-03-03 21:09:59,653 localhost-startStop-1 DEBUG Building Plugin[name=root, class=org.apache.logging.log4j.core.config.LoggerConfig$RootLogger].
2017-03-03 21:09:59,654 localhost-startStop-1 DEBUG createLogger(additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;, includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, ={consoleAppender, rollingFileAppender, asyncSmtpAppender}, ={}, Configuration(E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2017-03-03 21:09:59,654 localhost-startStop-1 DEBUG Building Plugin[name=loggers, class=org.apache.logging.log4j.core.config.LoggersPlugin].
2017-03-03 21:09:59,656 localhost-startStop-1 DEBUG createLoggers(={com.acme.backend, org.springframework.security, org.springframework.transaction, org.springframework.orm.jpa, org.hibernate.SQL, org.hibernate.type, root})
2017-03-03 21:09:59,656 localhost-startStop-1 DEBUG Configuration XmlConfiguration[location=E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml] initialized
2017-03-03 21:09:59,657 localhost-startStop-1 DEBUG Starting configuration XmlConfiguration[location=E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml]
2017-03-03 21:09:59,661 localhost-startStop-1 DEBUG Started configuration XmlConfiguration[location=E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml] OK.
2017-03-03 21:09:59,662 localhost-startStop-1 TRACE Stopping org.apache.logging.log4j.core.config.DefaultConfiguration@373492e5...
2017-03-03 21:09:59,662 localhost-startStop-1 TRACE DefaultConfiguration notified 1 ReliabilityStrategies that config will be stopped.
2017-03-03 21:09:59,662 localhost-startStop-1 TRACE DefaultConfiguration stopping root LoggerConfig.
2017-03-03 21:09:59,662 localhost-startStop-1 TRACE DefaultConfiguration notifying ReliabilityStrategies that appenders will be stopped.
2017-03-03 21:09:59,663 localhost-startStop-1 TRACE DefaultConfiguration stopping remaining Appenders.
2017-03-03 21:09:59,663 localhost-startStop-1 DEBUG Shutting down OutputStreamManager SYSTEM_OUT.&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;-1
2017-03-03 21:09:59,663 localhost-startStop-1 DEBUG Shut down OutputStreamManager SYSTEM_OUT.&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;-1, all resources released: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2017-03-03 21:09:59,663 localhost-startStop-1 DEBUG Appender DefaultConsole-1 stopped with status &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2017-03-03 21:09:59,664 localhost-startStop-1 TRACE DefaultConfiguration stopped 1 remaining Appenders.
2017-03-03 21:09:59,664 localhost-startStop-1 TRACE DefaultConfiguration cleaning Appenders from 1 LoggerConfigs.
2017-03-03 21:09:59,664 localhost-startStop-1 DEBUG Stopped org.apache.logging.log4j.core.config.DefaultConfiguration@373492e5 OK
2017-03-03 21:09:59,666 localhost-startStop-1 TRACE Reregistering MBeans after reconfigure. Selector=org.apache.logging.log4j.core.selector.ClassLoaderContextSelector@33d1ef79
2017-03-03 21:09:59,667 localhost-startStop-1 TRACE Reregistering context (1/1): &lt;span class=&quot;code-quote&quot;&gt;&apos;Acme Backend&apos;&lt;/span&gt; org.apache.logging.log4j.core.LoggerContext@554ad7a7
2017-03-03 21:09:59,667 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=Acme Backend&apos;&lt;/span&gt;
2017-03-03 21:09:59,667 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=Acme Backend,component=StatusLogger&apos;&lt;/span&gt;
2017-03-03 21:09:59,668 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=Acme Backend,component=ContextSelector&apos;&lt;/span&gt;
2017-03-03 21:09:59,668 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=Acme Backend,component=Loggers,name=*&apos;&lt;/span&gt;
2017-03-03 21:09:59,668 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=Acme Backend,component=Appenders,name=*&apos;&lt;/span&gt;
2017-03-03 21:09:59,669 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=Acme Backend,component=AsyncAppenders,name=*&apos;&lt;/span&gt;
2017-03-03 21:09:59,669 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=Acme Backend,component=AsyncLoggerRingBuffer&apos;&lt;/span&gt;
2017-03-03 21:09:59,669 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=Acme Backend,component=Loggers,name=*,subtype=RingBuffer&apos;&lt;/span&gt;
2017-03-03 21:09:59,672 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend
2017-03-03 21:09:59,675 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend,component=StatusLogger
2017-03-03 21:09:59,677 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend,component=ContextSelector
2017-03-03 21:09:59,679 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend,component=Loggers,name=
2017-03-03 21:09:59,680 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend,component=Loggers,name=org.hibernate.SQL
2017-03-03 21:09:59,680 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend,component=Loggers,name=org.springframework.transaction
2017-03-03 21:09:59,681 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend,component=Loggers,name=org.springframework.security
2017-03-03 21:09:59,681 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend,component=Loggers,name=com.acme.backend
2017-03-03 21:09:59,681 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend,component=Loggers,name=org.springframework.orm.jpa
2017-03-03 21:09:59,681 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend,component=Loggers,name=org.hibernate.type
2017-03-03 21:09:59,684 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend,component=Appenders,name=smtpAppender
2017-03-03 21:09:59,686 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend,component=AsyncAppenders,name=asyncSmtpAppender
2017-03-03 21:09:59,686 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend,component=Appenders,name=rollingFileAppender
2017-03-03 21:09:59,687 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=Acme Backend,component=Appenders,name=consoleAppender
2017-03-03 21:09:59,690 localhost-startStop-1 TRACE Using &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; SystemClock &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; timestamps.
2017-03-03 21:09:59,692 localhost-startStop-1 TRACE Using DummyNanoClock &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; nanosecond timestamps.
2017-03-03 21:09:59,692 localhost-startStop-1 DEBUG LoggerContext[name=Acme Backend, org.apache.logging.log4j.core.LoggerContext@554ad7a7] started OK with configuration XmlConfiguration[location=E:\Coding\workspace\.metadata\.plugins\org.eclipse.wst.server.core\tmp0\wtpwebapps\acme-web-impl\WEB-INF\classes\log4j2.xml].
...
2017-03-03 21:09:59,746 localhost-startStop-1 DEBUG AsyncLogger.ThreadNameStrategy=CACHED
2017-03-03 21:09:59,746 localhost-startStop-1 TRACE Using &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; SystemClock &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; timestamps.
...
2017-03-03 21:10:18,759 localhost-startStop-1 DEBUG Log4jServletContextListener ensuring that Log4j starts up properly.
2017-03-03 21:10:18,762 localhost-startStop-1 DEBUG Log4jServletFilter initialized.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems that during shutdown, after mbean unregistration, it reinitializes it?&lt;/p&gt;</comment>
                            <comment id="15894991" author="vguna" created="Fri, 3 Mar 2017 20:42:36 +0000"  >&lt;p&gt;Funny thing is: when adding the 2.5 stuff to web.xml, before the Spring ContextLoaderListener, it works:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &amp;lt;listener&amp;gt;
            &amp;lt;listener-&lt;span class=&quot;code-keyword&quot;&gt;class&amp;&lt;/span&gt;gt;org.apache.logging.log4j.web.Log4jServletContextListener&amp;lt;/listener-&lt;span class=&quot;code-keyword&quot;&gt;class&amp;&lt;/span&gt;gt;
        &amp;lt;/listener&amp;gt;
     
        &amp;lt;filter&amp;gt;
            &amp;lt;filter-name&amp;gt;log4jServletFilter&amp;lt;/filter-name&amp;gt;
            &amp;lt;filter-&lt;span class=&quot;code-keyword&quot;&gt;class&amp;&lt;/span&gt;gt;org.apache.logging.log4j.web.Log4jServletFilter&amp;lt;/filter-&lt;span class=&quot;code-keyword&quot;&gt;class&amp;&lt;/span&gt;gt;
        &amp;lt;/filter&amp;gt;
        &amp;lt;filter-mapping&amp;gt;
            &amp;lt;filter-name&amp;gt;log4jServletFilter&amp;lt;/filter-name&amp;gt;
            &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
            &amp;lt;dispatcher&amp;gt;REQUEST&amp;lt;/dispatcher&amp;gt;
            &amp;lt;dispatcher&amp;gt;FORWARD&amp;lt;/dispatcher&amp;gt;
            &amp;lt;dispatcher&amp;gt;INCLUDE&amp;lt;/dispatcher&amp;gt;
            &amp;lt;dispatcher&amp;gt;ERROR&amp;lt;/dispatcher&amp;gt;
            &amp;lt;dispatcher&amp;gt;ASYNC&amp;lt;/dispatcher&amp;gt;
        &amp;lt;/filter-mapping&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But just using the log4j context listener, doesn&apos;t work.&lt;/p&gt;

&lt;p&gt;Does it maybe have something todo with it, that the log4j listener is registered after the spring one in servlet 3.0?&lt;/p&gt;</comment>
                            <comment id="15895026" author="vguna" created="Fri, 3 Mar 2017 21:06:42 +0000"  >&lt;p&gt;Ok, I figured it out. If spring context listener is specified in web.xml, although using servlet 3.0 spec, it is started first and avoids proper log4j cleanup.&lt;br/&gt;
If I specify the log4j context listener before the spring ones, it doesn&apos;t work either, since then it&apos;s loaded twice - as it seems. Once at the beginning by web.xml and once during spec 3.0 autoregister &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. What works for me now is this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	&amp;lt;listener&amp;gt;
		&amp;lt;listener-&lt;span class=&quot;code-keyword&quot;&gt;class&amp;&lt;/span&gt;gt;org.apache.logging.log4j.web.Log4jServletContextListener&amp;lt;/listener-&lt;span class=&quot;code-keyword&quot;&gt;class&amp;&lt;/span&gt;gt;
	&amp;lt;/listener&amp;gt;
	&amp;lt;context-param&amp;gt;
		&amp;lt;param-name&amp;gt;isLog4jAutoInitializationDisabled&amp;lt;/param-name&amp;gt;
		&amp;lt;param-value&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/param-value&amp;gt;
	&amp;lt;/context-param&amp;gt;

	&amp;lt;listener&amp;gt;
		&amp;lt;listener-&lt;span class=&quot;code-keyword&quot;&gt;class&amp;&lt;/span&gt;gt;org.springframework.web.context.ContextLoaderListener&amp;lt;/listener-&lt;span class=&quot;code-keyword&quot;&gt;class&amp;&lt;/span&gt;gt;
	&amp;lt;/listener&amp;gt;
	&amp;lt;context-param&amp;gt;
		&amp;lt;param-name&amp;gt;contextConfigLocation&amp;lt;/param-name&amp;gt;
		&amp;lt;param-value&amp;gt;/WEB-INF/applicationContext.xml&amp;lt;/param-value&amp;gt;
	&amp;lt;/context-param&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I hope that helps anyone else stuggling with this.&lt;/p&gt;</comment>
                            <comment id="15895092" author="remkop@yahoo.com" created="Fri, 3 Mar 2017 21:54:58 +0000"  >&lt;p&gt;Do you want to provide a patch for the Log4j2 manual?&lt;/p&gt;</comment>
                            <comment id="15924200" author="mustangxu" created="Tue, 14 Mar 2017 13:39:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vguna&quot; class=&quot;user-hover&quot; rel=&quot;vguna&quot;&gt;vguna&lt;/a&gt;&apos;s comment helps~&lt;/p&gt;</comment>
                            <comment id="15940157" author="zutnop" created="Fri, 24 Mar 2017 11:12:26 +0000"  >&lt;p&gt;I had similar issues as Veit Guna and it took me a full day to figure out how everything (log4j2 and spring mvc startup, tomcat jar scanning) works and to come to a solution.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Problem:&lt;/b&gt; Tomcat production application server doesn&apos;t shutdown cleanly (it tries, waits for 30 seconds and kills the process).&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Environment:&lt;/b&gt; Linux, Java 1.8, Tomcat 8.0.23, Log4j 2.8.1, Spring MVC 4.2.6.&lt;br/&gt;
I have an empty web.xml file (nothing but the display-name and empty welcome-file tags) with version=&quot;3.1&quot;. So all the Servlet 3.0 magic should work out of the box.&lt;br/&gt;
I override the conf location with -Dlog4j.configurationFile=/etc/xxx/log4j2.xml.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Symptoms:&lt;/b&gt; Tomcat receives shutdown command, then Log4j completes a shutdown BUT after 2 seconds Log4j &quot;starts up again&quot;, Tomcat logs the running threads warnings:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;24-Mar-2017 09:10:13.842 WARNING [localhost-startStop-2] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesThreads The web application [ROOT] appears to have started a thread named [pool-5-thread-1] but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:
 sun.misc.Unsafe.park(Native Method)
 java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1067)
 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)
 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
 java.lang.Thread.run(Thread.java:745)
24-Mar-2017 09:10:13.842 WARNING [localhost-startStop-2] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesThreads The web application [ROOT] appears to have started a thread named [pool-5-thread-2] but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:
 sun.misc.Unsafe.park(Native Method)
 java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
 java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1067)
 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)
 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
 java.lang.Thread.run(Thread.java:745)
24-Mar-2017 09:10:13.843 WARNING [localhost-startStop-2] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesThreads The web application [ROOT] appears to have started a thread named [Log4j2-TF-10-Scheduled-11] but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:
 sun.misc.Unsafe.park(Native Method)
 java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1093)
 java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:809)
 java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1067)
 java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1127)
 java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
 java.lang.Thread.run(Thread.java:745)
24-Mar-2017 09:10:13.843 WARNING [localhost-startStop-2] org.apache.catalina.loader.WebappClassLoaderBase.clearReferencesThreads The web application [ROOT] appears to have started a thread named [AsyncAppender-AsyncMailer] but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:
 sun.misc.Unsafe.park(Native Method)
 java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
 java.util.concurrent.ArrayBlockingQueue.take(ArrayBlockingQueue.java:403)
 org.apache.logging.log4j.core.appender.AsyncAppender$AsyncThread.run(AsyncAppender.java:403)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now shutdown script waits until 30 seconds is passed and then kills the process.&lt;/p&gt;

&lt;p&gt;When I look at a web request exception stacktrace then I can see that the filter order is incorrect: first CharacterEncodingFilter, then Spring Security filters, &lt;b&gt;then Log4jServletFilter&lt;/b&gt;, and then my own &quot;non priority&quot; filters.&lt;/p&gt;

&lt;p&gt;NB1! The weird thing is, that the same tomcat version, conf and application on my development Windows 10 machine boots up in correct order and Log4j is initialized first, filter comes first and shutdown works.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Cause:&lt;/b&gt;&lt;br/&gt;
Tomcat 8.0.23 distribution comes with a conf/catalina.properties file where &lt;b&gt;jarsToSkip&lt;/b&gt; contains &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;log4j*.jar&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; but &lt;b&gt;jarsToScan&lt;/b&gt; lists only &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;log4j-core*.jar,log4j-taglib*.jar&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;, the log4j-web*.jar &lt;b&gt;is never scanned&lt;/b&gt; for TLD-s (doesn&apos;t matter) nor PLUGGABILITY (this matters). So the web-fragment.xml with order tags is never processed. So the init order is not correct and Spring happens to boot up first.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Solution:&lt;/b&gt;&lt;br/&gt;
I updated my catalina.properties to include log4j-web.jar in &lt;b&gt;jarsToScan&lt;/b&gt;. So now Tomcat reads both Log4j and Spring jars, and boots Log4j up first. This results in a clean shutdown!&lt;/p&gt;

&lt;p&gt;NB2! Tomcat 8.0.42 (latest in 8.0 branch) already has this fix in the distribution.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Log4j bug:&lt;/b&gt; The &lt;a href=&quot;http://logging.apache.org/log4j/2.x/manual/webapp.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://logging.apache.org/log4j/2.x/manual/webapp.html&lt;/a&gt; manual incorrectly states &quot;This has been fixed in Tomcat 7.0.43, Tomcat 8, and later.&quot;. Based on this statement I ignored the JAR scanning for quite a few hours in my troubleshooting. It would help a lot if the manual describes how to verify if your Servlet 3.0 magic works correctly (produce a web request stack trace and see if the Log4j filter comes before Spring initialized filters) and if not then you need to dig into your web.xml or JAR scanning.&lt;/p&gt;</comment>
                            <comment id="16155529" author="membersound" created="Wed, 6 Sep 2017 15:29:08 +0000"  >&lt;p&gt;I can confirm adding log4j-web*.jar to jarsToSkip fixes the problem.&lt;br/&gt;
or just upgrading to at least 0.42.&lt;/p&gt;

&lt;p&gt;So I think this issue could be closed as log4j cannot do much about it (or could they?).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12977173">LOG4J2-1419</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13003788">LOG4J2-1573</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rrlj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>