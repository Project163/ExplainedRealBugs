<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:31:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-391] Flume appender crashes when lock timeout occurs</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-391</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Flume appender seems to crash when it can&apos;t acquire the lock on the embeded Berkeley DB before the timeout period. The flume appender should retry when this happens. Here is the stack trace:&lt;/p&gt;

&lt;p&gt;2013-08-20 22:40:36,315 -0700 level=INFO  class=STDOUT              2013-08-20 22:40:36,314 ERROR Error reading database com.sleepycat.je.LockTimeoutException: (JE 5.0.73) Lock expired. Locker 988835149 -1_Thread-12_ThreadLocker: waited for lock on database=FlumePersistent&lt;span class=&quot;error&quot;&gt;&amp;#91;pprdgblas30i.ie.intuit.net:8800,pprdgblas30c.ie.intuit.net:8800,pprdgblas30b.ie.intuit.net:8800&amp;#93;&lt;/span&gt; /usr/local/whp-jboss-ws-5/server/default/flumeData LockAddr:2123888757 LSN=0x93/0x2d3184 type=READ grant=WAIT_NEW timeoutMillis=5000 startTime=1377063631308 endTime=1377063636310&lt;br/&gt;
Owners: &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;lt;LockInfo locker=&amp;quot;1275407544 1268918_DaemonPool-1-thread-2902_Txn&amp;quot; type=&amp;quot;WRITE&amp;quot;/&amp;gt;&amp;#93;&lt;/span&gt;&lt;br/&gt;
Waiters: []&lt;/p&gt;

&lt;p&gt;	at com.sleepycat.je.txn.LockManager.newLockTimeoutException(LockManager.java:664)&lt;br/&gt;
	at com.sleepycat.je.txn.LockManager.makeTimeoutMsgInternal(LockManager.java:623)&lt;br/&gt;
	at com.sleepycat.je.txn.SyncedLockManager.makeTimeoutMsg(SyncedLockManager.java:97)&lt;br/&gt;
	at com.sleepycat.je.txn.LockManager.lockInternal(LockManager.java:390)&lt;br/&gt;
	at com.sleepycat.je.txn.LockManager.lock(LockManager.java:276)&lt;br/&gt;
	at com.sleepycat.je.txn.BasicLocker.lockInternal(BasicLocker.java:118)&lt;br/&gt;
	at com.sleepycat.je.txn.Locker.lock(Locker.java:443)&lt;br/&gt;
	at com.sleepycat.je.dbi.CursorImpl.lockLN(CursorImpl.java:2621)&lt;br/&gt;
	at com.sleepycat.je.dbi.CursorImpl.lockLN(CursorImpl.java:2422)&lt;br/&gt;
	at com.sleepycat.je.dbi.CursorImpl.fetchCurrent(CursorImpl.java:2253)&lt;br/&gt;
	at com.sleepycat.je.dbi.CursorImpl.getCurrentAlreadyLatched(CursorImpl.java:1466)&lt;br/&gt;
	at com.sleepycat.je.dbi.CursorImpl.getNext(CursorImpl.java:1593)&lt;br/&gt;
	at com.sleepycat.je.Cursor.retrieveNextAllowPhantoms(Cursor.java:2924)&lt;br/&gt;
	at com.sleepycat.je.Cursor.retrieveNextNoDups(Cursor.java:2801)&lt;br/&gt;
	at com.sleepycat.je.Cursor.retrieveNext(Cursor.java:2775)&lt;br/&gt;
	at com.sleepycat.je.Cursor.getNext(Cursor.java:1128)&lt;br/&gt;
	at org.apache.logging.log4j.flume.appender.FlumePersistentManager$WriterThread.sendBatch(FlumePersistentManager.java:568)&lt;br/&gt;
	at org.apache.logging.log4j.flume.appender.FlumePersistentManager$WriterThread.run(FlumePersistentManager.java:473)&lt;br/&gt;
2013-08-20 22:40:56,947 -0700 level=INFO  class=STDOUT       2ba4851d-0a24-11e3-9b42-005056b5071b       2013-08-20 22:40:56,946 ERROR An exception occurred processing Appender flume org.apache.logging.log4j.LoggingException: Unable to record event&lt;br/&gt;
	at org.apache.logging.log4j.flume.appender.FlumePersistentManager.send(FlumePersistentManager.java:172)&lt;br/&gt;
	at org.apache.logging.log4j.flume.appender.FlumeAppender.append(FlumeAppender.java:102)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:102)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.rewrite.RewriteAppender.append(RewriteAppender.java:92)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:102)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:426)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:407)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:368)&lt;br/&gt;
	at org.apache.logging.log4j.core.Logger.log(Logger.java:110)&lt;br/&gt;
	at org.apache.logging.log4j.spi.AbstractLoggerWrapper.log(AbstractLoggerWrapper.java:55)&lt;br/&gt;
	at org.apache.logging.log4j.EventLogger.logEvent(EventLogger.java:56)&lt;br/&gt;
	at com.intuit.ifs.globallogging.dto.LogEventFactory$AuditProxy.invoke(LogEventFactory.java:242)&lt;br/&gt;
	at $Proxy161.logEvent(Unknown Source)&lt;br/&gt;
	at com.intuit.ifs.globallogging.fakeapp.LoggingController.startLogging(LoggingController.java:157)&lt;br/&gt;
	at sun.reflect.GeneratedMethodAccessor179.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.springframework.web.bind.annotation.support.HandlerMethodInvoker.invokeHandlerMethod(HandlerMethodInvoker.java:176)&lt;br/&gt;
	at org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.invokeHandlerMethod(AnnotationMethodHandlerAdapter.java:436)&lt;br/&gt;
	at org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.handle(AnnotationMethodHandlerAdapter.java:424)&lt;br/&gt;
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:923)&lt;br/&gt;
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:852)&lt;br/&gt;
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:882)&lt;br/&gt;
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:778)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:617)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)&lt;br/&gt;
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:235)&lt;br/&gt;
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)&lt;br/&gt;
	at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:183)&lt;br/&gt;
	at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:95)&lt;br/&gt;
	at org.jboss.web.tomcat.security.SecurityContextEstablishmentValve.process(SecurityContextEstablishmentValve.java:126)&lt;br/&gt;
	at org.jboss.web.tomcat.security.SecurityContextEstablishmentValve.invoke(SecurityContextEstablishmentValve.java:70)&lt;br/&gt;
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)&lt;br/&gt;
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)&lt;br/&gt;
	at org.jboss.web.tomcat.service.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:158)&lt;br/&gt;
	at org.apache.catalina.authenticator.SingleSignOn.invoke(SingleSignOn.java:383)&lt;br/&gt;
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)&lt;br/&gt;
	at org.jboss.web.tomcat.service.request.ActiveRequestResponseCacheValve.internalProcess(ActiveRequestResponseCacheValve.java:74)&lt;br/&gt;
	at org.jboss.web.tomcat.service.request.ActiveRequestResponseCacheValve.invoke(ActiveRequestResponseCacheValve.java:47)&lt;br/&gt;
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:330)&lt;br/&gt;
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:829)&lt;br/&gt;
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:599)&lt;br/&gt;
	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:451)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
2013-08-20 22:40:57,559 -0700 level=INFO  class=STDOUT       2be29f90-0a24-11e3-9b42-005056b5071b       2013-08-20 22:40:57,557 ERROR An exception occurred processing Appender flume org.apache.logging.log4j.LoggingException: Unable to record event&lt;br/&gt;
	at org.apache.logging.log4j.flume.appender.FlumePersistentManager.send(FlumePersistentManager.java:172)&lt;br/&gt;
	at org.apache.logging.log4j.flume.appender.FlumeAppender.append(FlumeAppender.java:102)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:102)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.rewrite.RewriteAppender.append(RewriteAppender.java:92)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:102)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:426)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:407)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:368)&lt;br/&gt;
	at org.apache.logging.log4j.core.Logger.log(Logger.java:110)&lt;br/&gt;
	at org.apache.logging.log4j.spi.AbstractLoggerWrapper.log(AbstractLoggerWrapper.java:55)&lt;br/&gt;
	at org.apache.logging.log4j.EventLogger.logEvent(EventLogger.java:56)&lt;br/&gt;
	at com.intuit.ifs.globallogging.dto.LogEventFactory$AuditProxy.invoke(LogEventFactory.java:242)&lt;br/&gt;
	at $Proxy199.logEvent(Unknown Source)&lt;br/&gt;
	at com.intuit.ifs.globallogging.fakeapp.LoggingController.startLogging(LoggingController.java:157)&lt;br/&gt;
	at sun.reflect.GeneratedMethodAccessor179.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.springframework.web.bind.annotation.support.HandlerMethodInvoker.invokeHandlerMethod(HandlerMethodInvoker.java:176)&lt;br/&gt;
	at org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.invokeHandlerMethod(AnnotationMethodHandlerAdapter.java:436)&lt;br/&gt;
	at org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.handle(AnnotationMethodHandlerAdapter.java:424)&lt;br/&gt;
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:923)&lt;br/&gt;
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:852)&lt;br/&gt;
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:882)&lt;br/&gt;
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:778)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:617)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)&lt;br/&gt;
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:235)&lt;br/&gt;
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)&lt;br/&gt;
	at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:183)&lt;br/&gt;
	at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:95)&lt;br/&gt;
	at org.jboss.web.tomcat.security.SecurityContextEstablishmentValve.process(SecurityContextEstablishmentValve.java:126)&lt;br/&gt;
	at org.jboss.web.tomcat.security.SecurityContextEstablishmentValve.invoke(SecurityContextEstablishmentValve.java:70)&lt;br/&gt;
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)&lt;br/&gt;
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)&lt;br/&gt;
	at org.jboss.web.tomcat.service.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:158)&lt;br/&gt;
	at org.apache.catalina.authenticator.SingleSignOn.invoke(SingleSignOn.java:383)&lt;br/&gt;
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)&lt;br/&gt;
	at org.jboss.web.tomcat.service.request.ActiveRequestResponseCacheValve.internalProcess(ActiveRequestResponseCacheValve.java:74)&lt;br/&gt;
	at org.jboss.web.tomcat.service.request.ActiveRequestResponseCacheValve.invoke(ActiveRequestResponseCacheValve.java:47)&lt;br/&gt;
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:330)&lt;br/&gt;
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:829)&lt;br/&gt;
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:599)&lt;br/&gt;
	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:451)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
2013-08-20 22:40:58,641 -0700 level=INFO  class=STDOUT       3060d4b8-0a24-11e3-9b42-005056b5071b       2013-08-20 22:40:58,639 ERROR An exception occurred processing Appender flume org.apache.logging.log4j.LoggingException: Unable to record event&lt;br/&gt;
	at org.apache.logging.log4j.flume.appender.FlumePersistentManager.send(FlumePersistentManager.java:172)&lt;br/&gt;
	at org.apache.logging.log4j.flume.appender.FlumeAppender.append(FlumeAppender.java:102)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:102)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.rewrite.RewriteAppender.append(RewriteAppender.java:92)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:102)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:426)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:407)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:368)&lt;br/&gt;
	at org.apache.logging.log4j.core.Logger.log(Logger.java:110)&lt;br/&gt;
	at org.apache.logging.log4j.spi.AbstractLoggerWrapper.log(AbstractLoggerWrapper.java:55)&lt;br/&gt;
	at org.apache.logging.log4j.EventLogger.logEvent(EventLogger.java:56)&lt;br/&gt;
	at com.intuit.ifs.globallogging.dto.LogEventFactory$AuditProxy.invoke(LogEventFactory.java:242)&lt;br/&gt;
	at $Proxy162.logEvent(Unknown Source)&lt;br/&gt;
	at com.intuit.ifs.globallogging.fakeapp.LoggingController.startLogging(LoggingController.java:157)&lt;br/&gt;
	at sun.reflect.GeneratedMethodAccessor179.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.springframework.web.bind.annotation.support.HandlerMethodInvoker.invokeHandlerMethod(HandlerMethodInvoker.java:176)&lt;br/&gt;
	at org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.invokeHandlerMethod(AnnotationMethodHandlerAdapter.java:436)&lt;br/&gt;
	at org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter.handle(AnnotationMethodHandlerAdapter.java:424)&lt;br/&gt;
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:923)&lt;br/&gt;
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:852)&lt;br/&gt;
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:882)&lt;br/&gt;
	at org.springframework.web.servlet.FrameworkServlet.doGet(FrameworkServlet.java:778)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:617)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:717)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:290)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)&lt;br/&gt;
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:235)&lt;br/&gt;
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)&lt;br/&gt;
	at org.jboss.web.tomcat.security.SecurityAssociationValve.invoke(SecurityAssociationValve.java:183)&lt;br/&gt;
	at org.jboss.web.tomcat.security.JaccContextValve.invoke(JaccContextValve.java:95)&lt;br/&gt;
	at org.jboss.web.tomcat.security.SecurityContextEstablishmentValve.process(SecurityContextEstablishmentValve.java:126)&lt;br/&gt;
	at org.jboss.web.tomcat.security.SecurityContextEstablishmentValve.invoke(SecurityContextEstablishmentValve.java:70)&lt;br/&gt;
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)&lt;br/&gt;
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)&lt;br/&gt;
	at org.jboss.web.tomcat.service.jca.CachedConnectionValve.invoke(CachedConnectionValve.java:158)&lt;br/&gt;
	at org.apache.catalina.authenticator.SingleSignOn.invoke(SingleSignOn.java:383)&lt;br/&gt;
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)&lt;br/&gt;
	at org.jboss.web.tomcat.service.request.ActiveRequestResponseCacheValve.internalProcess(ActiveRequestResponseCacheValve.java:74)&lt;br/&gt;
	at org.jboss.web.tomcat.service.request.ActiveRequestResponseCacheValve.invoke(ActiveRequestResponseCacheValve.java:47)&lt;br/&gt;
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:330)&lt;br/&gt;
	at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:829)&lt;br/&gt;
	at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:599)&lt;br/&gt;
	at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:451)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Rhel 5&lt;/p&gt;</environment>
        <key id="12666914">LOG4J2-391</key>
            <summary>Flume appender crashes when lock timeout occurs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kamalb">Kamal Bahadur</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Sep 2013 16:18:02 +0000</created>
                <updated>Wed, 10 Sep 2014 23:40:53 +0000</updated>
                            <resolved>Wed, 10 Sep 2014 05:18:24 +0000</resolved>
                                    <version>2.0-beta9</version>
                                    <fixVersion>2.1</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13758515" author="kamalb" created="Wed, 4 Sep 2013 23:28:45 +0000"  >&lt;p&gt;This could be related: &lt;a href=&quot;https://forums.oracle.com/thread/2426617&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://forums.oracle.com/thread/2426617&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13759370" author="kamalb" created="Thu, 5 Sep 2013 19:53:54 +0000"  >&lt;p&gt;Attached is a patch to fix this bug. Basically, I have added a logic to sleep for 500 milliseconds and retry if lock related exception occurs. It will retry 100 times before setting the errors to true. This should prevent the FlumePersistentManager to shutdown.&lt;/p&gt;</comment>
                            <comment id="13760559" author="garydgregory" created="Fri, 6 Sep 2013 19:58:36 +0000"  >&lt;p&gt;I&apos;ll let Ralph opine on the patch but I would expect these retry values to be configurable from log4j.xml.&lt;/p&gt;</comment>
                            <comment id="13760692" author="kamalb" created="Fri, 6 Sep 2013 22:18:04 +0000"  >&lt;p&gt;I&apos;ll make it configurable&lt;/p&gt;</comment>
                            <comment id="13762238" author="kamalb" created="Mon, 9 Sep 2013 20:23:24 +0000"  >&lt;p&gt;Made the number of retires configurable&lt;/p&gt;</comment>
                            <comment id="13763495" author="ralph.goers@dslextreme.com" created="Tue, 10 Sep 2013 20:48:30 +0000"  >&lt;p&gt;I applied a modified version of the patch in revision 1521640. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="13904729" author="ssulatycki" created="Tue, 18 Feb 2014 22:38:12 +0000"  >&lt;p&gt;Though this has been closed, this issue still persists in beta9. We have multiple servers/services that have had this error, which effectively stops the Flume logging.&lt;/p&gt;

&lt;p&gt;Version: beta9&lt;/p&gt;

&lt;p&gt;Config: Running async loggers, with the following parameters:&lt;br/&gt;
-DLog4jContextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelector&lt;br/&gt;
-DAsyncLogger.RingBufferSize=512&lt;br/&gt;
-DAsyncLogger.WaitStrategy=Block&lt;/p&gt;

&lt;p&gt;OSes:&lt;br/&gt;
1. SunOS 5.10 Generic_141445-09 i86pc i386 i86pc&lt;br/&gt;
2. Linux 2.6.32-220.el6.x86_64 #1 SMP Tue Dec 6 19:48:22 GMT 2011 x86_64 x86_64 x86_64 GNU/Linux&lt;/p&gt;

&lt;p&gt;Error seen in logs:&lt;/p&gt;

&lt;p&gt;2014-02-04 16:00:19,945 ERROR Error reading database com.sleepycat.je.LockTimeoutException: (JE 5.0.73) Lock expired. Locker 31404296 -1_Thread-3_ThreadLocker: waited for lock on database=FlumePersistent&lt;span class=&quot;error&quot;&gt;&amp;#91;agent01:44444,agent02:44444&amp;#93;&lt;/span&gt; /logs/flume LockAddr:793535 LSN=0x5f/0x7004b8 type=READ grant=WAIT_NEW timeoutMillis=5000 startTime=1391529614658 endTime=1391529619941&lt;br/&gt;
Owners: &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;lt;LockInfo locker=&amp;quot;28110478 856908_DaemonPool-1-thread-36_Txn&amp;quot; type=&amp;quot;WRITE&amp;quot;/&amp;gt;&amp;#93;&lt;/span&gt;&lt;br/&gt;
Waiters: []&lt;/p&gt;

&lt;p&gt;        at com.sleepycat.je.txn.LockManager.newLockTimeoutException(LockManager.java:664)&lt;br/&gt;
        at com.sleepycat.je.txn.LockManager.makeTimeoutMsgInternal(LockManager.java:623)&lt;br/&gt;
        at com.sleepycat.je.txn.SyncedLockManager.makeTimeoutMsg(SyncedLockManager.java:97)&lt;br/&gt;
        at com.sleepycat.je.txn.LockManager.lockInternal(LockManager.java:390)&lt;br/&gt;
        at com.sleepycat.je.txn.LockManager.lock(LockManager.java:276)&lt;br/&gt;
        at com.sleepycat.je.txn.BasicLocker.lockInternal(BasicLocker.java:118)&lt;br/&gt;
        at com.sleepycat.je.txn.Locker.lock(Locker.java:443)&lt;br/&gt;
        at com.sleepycat.je.dbi.CursorImpl.lockLN(CursorImpl.java:2621)&lt;br/&gt;
        at com.sleepycat.je.dbi.CursorImpl.lockLN(CursorImpl.java:2422)&lt;br/&gt;
        at com.sleepycat.je.dbi.CursorImpl.fetchCurrent(CursorImpl.java:2253)&lt;br/&gt;
        at com.sleepycat.je.dbi.CursorImpl.getCurrentAlreadyLatched(CursorImpl.java:1466)&lt;br/&gt;
        at com.sleepycat.je.dbi.CursorImpl.getNext(CursorImpl.java:1593)&lt;br/&gt;
        at com.sleepycat.je.Cursor.retrieveNextAllowPhantoms(Cursor.java:2924)&lt;br/&gt;
        at com.sleepycat.je.Cursor.retrieveNextNoDups(Cursor.java:2801)&lt;br/&gt;
        at com.sleepycat.je.Cursor.retrieveNext(Cursor.java:2775)&lt;br/&gt;
        at com.sleepycat.je.Cursor.getNext(Cursor.java:1128)&lt;br/&gt;
        at org.apache.logging.log4j.flume.appender.FlumePersistentManager$WriterThread.run(FlumePersistentManager.java:460)&lt;/p&gt;

&lt;p&gt;2014-02-04 16:00:21,591 ERROR An exception occurred processing Appender flume org.apache.logging.log4j.LoggingException: Unable to record event&lt;br/&gt;
        at org.apache.logging.log4j.flume.appender.FlumePersistentManager.send(FlumePersistentManager.java:166)&lt;br/&gt;
        at org.apache.logging.log4j.flume.appender.FlumeAppender.append(FlumeAppender.java:102)&lt;br/&gt;
        at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:102)&lt;br/&gt;
        at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:426)&lt;br/&gt;
        at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:407)&lt;br/&gt;
        at org.apache.logging.log4j.core.Logger$PrivateConfig.logEvent(Logger.java:273)&lt;br/&gt;
        at org.apache.logging.log4j.core.async.AsyncLogger.actualAsyncLog(AsyncLogger.java:240)&lt;br/&gt;
        at org.apache.logging.log4j.core.async.RingBufferLogEvent.execute(RingBufferLogEvent.java:97)&lt;br/&gt;
        at org.apache.logging.log4j.core.async.RingBufferLogEventHandler.onEvent(RingBufferLogEventHandler.java:43)&lt;br/&gt;
        at org.apache.logging.log4j.core.async.RingBufferLogEventHandler.onEvent(RingBufferLogEventHandler.java:28)&lt;br/&gt;
        at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:133)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;


&lt;p&gt;I would suggest that the retry and timeout parameters be made configurable so that they may be tuned for specific needs.&lt;/p&gt;</comment>
                            <comment id="13907438" author="kamalb" created="Thu, 20 Feb 2014 20:09:29 +0000"  >&lt;p&gt;Stack trace matches with the source in beta8 instead of beta9. Steve, can you double check the version you are on?&lt;/p&gt;

&lt;p&gt;Kamal&lt;/p&gt;</comment>
                            <comment id="13907553" author="ssulatycki" created="Thu, 20 Feb 2014 21:44:05 +0000"  >&lt;p&gt;Kamal,&lt;/p&gt;

&lt;p&gt;I was hoping that could be the case, so I downloaded beta9, and compared that to what we have in our repo by running md5 checksums:&lt;/p&gt;

&lt;p&gt;Fresh beta9 download:&lt;/p&gt;

&lt;p&gt;MD5 (log4j-1.2-api-2.0-beta9.jar) = 8d44e2635d2efebeed217b068190912b&lt;br/&gt;
MD5 (log4j-api-2.0-beta9.jar) = 243049406066e313938e168335069d32&lt;br/&gt;
MD5 (log4j-core-2.0-beta9.jar) = 152ecb3ce094ac5bc9ea39d6122e2814&lt;br/&gt;
MD5 (log4j-jcl-2.0-beta9.jar) = 364b72e29a557e58fdd709e665fdaf8d&lt;br/&gt;
MD5 (log4j-slf4j-impl-2.0-beta9.jar) = 0df94ba36ac62c9ace4c5216cae8c87d&lt;br/&gt;
MD5 (log4j-taglib-2.0-beta9.jar) = f7c919ea26d83878d5773048c8e0f7b1&lt;/p&gt;

&lt;p&gt;In local repo (and on servers throwing exceptions...):&lt;/p&gt;

&lt;p&gt;MD5 (log4j-1.2-api-2.0.jar) = 8d44e2635d2efebeed217b068190912b&lt;br/&gt;
MD5 (log4j-api-2.0.jar) = 243049406066e313938e168335069d32&lt;br/&gt;
MD5 (log4j-core-2.0.jar) = 152ecb3ce094ac5bc9ea39d6122e2814&lt;br/&gt;
MD5 (log4j-jcl-2.0.jar) = 364b72e29a557e58fdd709e665fdaf8d&lt;br/&gt;
MD5 (log4j-slf4j-impl-2.0.jar) = 0df94ba36ac62c9ace4c5216cae8c87d&lt;br/&gt;
MD5 (log4j-taglib-2.0.jar) = f7c919ea26d83878d5773048c8e0f7b1&lt;/p&gt;

&lt;p&gt;All those checksums appear to match.&lt;/p&gt;

&lt;p&gt;Here&apos;s what our Flume appender config looks like:&lt;/p&gt;

&lt;p&gt;    &amp;lt;Flume&lt;br/&gt;
      name=&quot;flume&quot;&lt;br/&gt;
      type=&quot;persistent&quot;&lt;br/&gt;
      compress=&quot;true&quot;&lt;br/&gt;
      suppressExceptions=&quot;true&quot;&lt;br/&gt;
      batchSize=&quot;10&quot;&lt;br/&gt;
      maxDelay=&quot;15050&quot;&lt;br/&gt;
      connectTimeout=&quot;5000&quot;&lt;br/&gt;
      requestTimeout=&quot;10000&quot;&lt;br/&gt;
      dataDir=&quot;/logs/flume&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;Agent host=&quot;agent01&quot; port=&quot;44444&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;Agent host=&quot;agent02&quot; port=&quot;44444&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;PatternLayout pattern=&quot;%d&lt;/p&gt;
{yyyyMMddHHmmssSSS}
&lt;p&gt;|1|%m%throwable&lt;/p&gt;
{none}
&lt;p&gt;&quot; /&amp;gt;&lt;br/&gt;
    &amp;lt;/Flume&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="13925344" author="ralph.goers@dslextreme.com" created="Sun, 9 Mar 2014 22:16:56 +0000"  >&lt;p&gt;I am having a hard time looking into this.  The stack trace above is definitely not for beta9 - nothing lines up.  I understand you believe you verified checksums but somehow you are not running beta9. &lt;/p&gt;

&lt;p&gt;I notice you don&apos;t have the log4j flume jar in the list of MD5&apos;s you checked.&lt;/p&gt;</comment>
                            <comment id="13926078" author="ssulatycki" created="Mon, 10 Mar 2014 19:23:19 +0000"  >&lt;p&gt;Ralph,&lt;/p&gt;

&lt;p&gt;I pieced through this issue over the weekend and indeed the log4j flume jar was the culprit - it was beta7.&lt;/p&gt;

&lt;p&gt;Thought I haven&apos;t actually verified the lock timeout fix, please feel free to close this issue out. We&apos;ll deploy the code soon and I&apos;ll update is indeed the issue persists.&lt;/p&gt;

&lt;p&gt;Thanks and sorry for the confusion on this.&lt;/p&gt;

&lt;p&gt;Steve&lt;/p&gt;</comment>
                            <comment id="13926097" author="ralph.goers@dslextreme.com" created="Mon, 10 Mar 2014 19:40:11 +0000"  >&lt;p&gt;I am marking this as resolved.  Please close it when you have verified the current release.&lt;/p&gt;</comment>
                            <comment id="14126190" author="kamalb" created="Mon, 8 Sep 2014 22:02:27 +0000"  >&lt;p&gt;LockTimeoutException has not been handled for batch. In sendBatch method of FlumePersistentManager.WriterThread, the methods cursor.getFirst and cursor.getNext are not catching LockConflictException. We should catch the LockConflictException and include the retry logic just like we implemented in send method.&lt;/p&gt;</comment>
                            <comment id="14126575" author="kamalb" created="Tue, 9 Sep 2014 04:16:12 +0000"  >&lt;p&gt;Attached is the patch to handle time out exception during batch send.&lt;/p&gt;</comment>
                            <comment id="14126593" author="ralph.goers@dslextreme.com" created="Tue, 9 Sep 2014 04:48:06 +0000"  >&lt;p&gt;Are you sure the patch file is good?  I am having trouble applying it - but it might be me.&lt;/p&gt;</comment>
                            <comment id="14126595" author="kamalb" created="Tue, 9 Sep 2014 04:53:30 +0000"  >&lt;p&gt;I synced the latest code from git before I made the changes. Let me double check &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I just compared the changes with head revision and it looks ok to me.&lt;/p&gt;</comment>
                            <comment id="14126608" author="ralph.goers@dslextreme.com" created="Tue, 9 Sep 2014 05:10:32 +0000"  >&lt;p&gt;I tried doing &lt;br/&gt;
git apply ../logging-log4j2-391.patch &lt;/p&gt;

&lt;p&gt;and got&lt;/p&gt;

&lt;p&gt;../logging-log4j2-391.patch:19: space before tab in indent.&lt;br/&gt;
            	final BatchEvent batch = new BatchEvent();&lt;br/&gt;
../logging-log4j2-391.patch:20: space before tab in indent.&lt;br/&gt;
            	for (int retryIndex = 0; retryIndex &amp;lt; lockTimeoutRetryCount; ++retryIndex) {&lt;br/&gt;
../logging-log4j2-391.patch:21: space before tab in indent.&lt;br/&gt;
            		try {&lt;br/&gt;
../logging-log4j2-391.patch:22: space before tab in indent.&lt;br/&gt;
		            	cursor = database.openCursor(null, CursorConfig.DEFAULT);&lt;br/&gt;
../logging-log4j2-391.patch:24: trailing whitespace.&lt;/p&gt;

&lt;p&gt;fatal: corrupt patch at line 63&lt;/p&gt;</comment>
                            <comment id="14126654" author="kamalb" created="Tue, 9 Sep 2014 06:05:29 +0000"  >&lt;p&gt;I am not sure what is wrong. I just tried to create the patch again.&lt;/p&gt;</comment>
                            <comment id="14127366" author="jvz" created="Tue, 9 Sep 2014 18:44:30 +0000"  >&lt;p&gt;Patch looks like it should work with git apply. If not, use &lt;tt&gt;patch -p1 &amp;lt;file.patch&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="14127531" author="garydgregory" created="Tue, 9 Sep 2014 20:53:22 +0000"  >&lt;p&gt;The patch applies fine from Eclipse&apos;s Team&amp;gt;Apply patch... The unit tests pass. I&apos;ve not done a code review on the patch though.&lt;/p&gt;</comment>
                            <comment id="14127609" author="ralph.goers@dslextreme.com" created="Tue, 9 Sep 2014 21:44:04 +0000"  >&lt;p&gt;Matt. I tried patch -p1 before I tried the git apply. I will try with the second file he uploaded but at a glance it looked the same as the first file.  I have no idea why it didn&apos;t work for me.  I&apos;ll review the patch, but I used to work with Kamal and I have no doubt he tested it.&lt;/p&gt;</comment>
                            <comment id="14128069" author="ralph.goers@dslextreme.com" created="Wed, 10 Sep 2014 05:17:57 +0000"  >&lt;p&gt;Gary, thanks for the hint. I was able to apply the patch through IntelliJ. Kanal, pleaes verify and close.&lt;/p&gt;</comment>
                            <comment id="14128520" author="kamalb" created="Wed, 10 Sep 2014 14:22:22 +0000"  >&lt;p&gt;Thanks guys! I will run another round of performance test today.&lt;/p&gt;</comment>
                            <comment id="14129146" author="kamalb" created="Wed, 10 Sep 2014 21:29:41 +0000"  >&lt;p&gt;I was going to test the changes with the snapshot version from apache but it looks like the snapshots there are old. How often does the snapshots get generated?&lt;/p&gt;

&lt;p&gt;I am looking at &lt;a href=&quot;http://repository.apache.org/content/groups/snapshots/org/apache/logging/log4j/log4j-flume-ng/2.1-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://repository.apache.org/content/groups/snapshots/org/apache/logging/log4j/log4j-flume-ng/2.1-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14129207" author="garydgregory" created="Wed, 10 Sep 2014 22:01:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kamalb&quot; class=&quot;user-hover&quot; rel=&quot;kamalb&quot;&gt;kamalb&lt;/a&gt;: You best bet is to clone the repository from Git and do a local build. This will make testing much easier. You can install in your local Maven repo with &quot;mvn clean install&quot;.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="14129223" author="kamalb" created="Wed, 10 Sep 2014 22:06:24 +0000"  >&lt;p&gt;Ok Gary, I will do that.&lt;/p&gt;</comment>
                            <comment id="14129352" author="garydgregory" created="Wed, 10 Sep 2014 23:29:13 +0000"  >&lt;p&gt;Great Kamal, thank you for going through the extra steps &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14129367" author="kamalb" created="Wed, 10 Sep 2014 23:39:20 +0000"  >&lt;p&gt;No problem Gary. I tested the flume appender with 3.5 millions logs and it worked fine. I did not see any time out exceptions &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I am closing this issue.&lt;/p&gt;</comment>
                            <comment id="14129369" author="kamalb" created="Wed, 10 Sep 2014 23:40:53 +0000"  >&lt;p&gt;I am closing this issue as I am happy with the fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12602205" name="log4j2-391_patch.txt" size="19314" author="kamalb" created="Mon, 9 Sep 2013 20:23:24 +0000"/>
                            <attachment id="12667356" name="logging-log4j2-391-1.patch" size="3015" author="kamalb" created="Tue, 9 Sep 2014 06:05:29 +0000"/>
                            <attachment id="12667340" name="logging-log4j2-391.patch" size="3085" author="kamalb" created="Tue, 9 Sep 2014 04:16:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346851</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1nt6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>347151</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>