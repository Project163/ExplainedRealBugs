<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:31:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-235] Dependency on tools.jar and jconsole</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-235</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;when switching from 2.0-beta4 to 2.0-beta5 I something irritating that in the dependency hierarchy of my project. For log4j2-core there were transitive dependencies on tools.jar and jsconsole which had not been there.&lt;/p&gt;

&lt;p&gt;This looks like a bug and an as a consequence requires a JDK instead of  a JRE (at least due to the tools.jar which does not exist in Java 1.6 JRE). If these dependencies are really required, it should be clearly stated.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7, 64 bit, Maven 3.0.5, Java 1.6&lt;/p&gt;</environment>
        <key id="12645821">LOG4J2-235</key>
            <summary>Dependency on tools.jar and jconsole</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="zyrano">Sebastian Oerding</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 May 2013 14:58:20 +0000</created>
                <updated>Tue, 14 May 2013 06:29:56 +0000</updated>
                            <resolved>Sat, 4 May 2013 00:54:07 +0000</resolved>
                                    <version>2.0-beta5</version>
                                    <fixVersion>2.0-beta6</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13647627" author="beamerblvd" created="Thu, 2 May 2013 15:31:11 +0000"  >&lt;p&gt;I noticed that the other day, too, and almost filed a bug for it. Specifically, this is related to the JMX implementation in Log4j2 (&lt;a href=&quot;http://markmail.org/thread/flnzsojwv47ohf4q&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/thread/flnzsojwv47ohf4q&lt;/a&gt;). However, as Ralph stated (&lt;a href=&quot;http://markmail.org/thread/fbs5huavd4zkdz7c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/thread/fbs5huavd4zkdz7c&lt;/a&gt;), extra dependencies should not be drug in. This made me think, &quot;well, additional dependencies have been drug in and shouldn&apos;t have.&quot;&lt;/p&gt;

&lt;p&gt;However, it&apos;s important to note that these transitive dependencies system dependencies that are resolved at runtime and are not, for example, packaged with your WAR file if you&apos;re creating a web application. Other runtime dependencies would normally be shipped in your WAR file. So the inconvenience here is really only noticed if your IDE is transparent about what it&apos;s downloading. I don&apos;t BELIEVE it actually affects anything at runtime.&lt;/p&gt;

&lt;p&gt;However, it would be great if Remko could shed some light on this. I&apos;m not exactly clear about how the JMX support he added to Log4j2 would work unless the application was running in a JDK instead of a JRE.&lt;/p&gt;</comment>
                            <comment id="13648043" author="remkop@yahoo.com" created="Fri, 3 May 2013 00:06:23 +0000"  >&lt;p&gt;These are &lt;b&gt;compile&lt;/b&gt; time dependencies (to build the log4j binaries), not runtime dependencies. Once you have the log4j jar files you should not need tools.jar or jconsole.jar to compile your project. At least I think not, I don&apos;t have much maven experience.&lt;/p&gt;

&lt;p&gt;Jconsole classes in core are only used when running the JMX gui as a JConsole plugin.&lt;/p&gt;

&lt;p&gt;I can remove the dependency on tools.jar from core/pom.xml, that was probably a mistake on my part anyway.&lt;/p&gt;</comment>
                            <comment id="13648056" author="beamerblvd" created="Fri, 3 May 2013 00:26:33 +0000"  >&lt;p&gt;Compile time dependencies would, by nature, also be runtime dependencies.&lt;/p&gt;

&lt;p&gt;If this compiles without tools.jar, then tools.jar definitely needs to be removed as a dependency.&lt;/p&gt;

&lt;p&gt;As far as the JMX classes, my (limited) understanding of JMX is that there would be two parts: the &quot;server-side&quot; code (that is, the code running within the application that is using Log4j, and that is running a JMX server) and the &quot;client-side&quot; code (the JConsole plugin). I think packaging these in the same artifact/JAR might not be correct.&lt;/p&gt;

&lt;p&gt;I definitely think that the &quot;server-side&quot; code should be in the log4j-core artifact. This makes sense. However, the JConsole (GUI) code would never be used within the logging application (as far as I can tell). I think this could serve as an argument for moving the JConsole plugin code into a log4j-jconsole-plugin artifact. If the JConsole plugin/GUI code is the only code that depends on jconsole.jar, I think that makes a STRONG argument for moving the JConsole plugin code into a log4j-jconsole-plugin artifact.&lt;/p&gt;</comment>
                            <comment id="13648061" author="beamerblvd" created="Fri, 3 May 2013 00:29:08 +0000"  >&lt;p&gt;So, just to be clear, my suggestion is:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;log4j-core contains most classes from org/apache/logging/log4j/core/jmx/ (those classes required to provide statistics through the JMX server)&lt;/li&gt;
	&lt;li&gt;log4j-jconsole-plugin contains the GUI-related classes from org/apache/logging/log4j/core/jmx/ (those classes required to provide the GUI plugin in the JConsole window)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13648090" author="remkop@yahoo.com" created="Fri, 3 May 2013 01:18:28 +0000"  >&lt;p&gt;Removed dependency on tools jar from core/pom.xml (revision 1478623). No compilation issues on Windows.&lt;/p&gt;

&lt;p&gt;About creating a separate module for the jconsole plugin, this would mean Yet Another Jar.&lt;br/&gt;
What problem are we trying to solve?&lt;/p&gt;</comment>
                            <comment id="13648126" author="beamerblvd" created="Fri, 3 May 2013 02:34:04 +0000"  >&lt;p&gt;Glad to hear tools.jar wasn&apos;t actually needed.&lt;/p&gt;

&lt;p&gt;Part of the issue is classpath pollution. By putting jconsole.jar on the classpath in the core JAR, other Log4j developers could accidentally use classes from jconsole.jar within other features in the core module. This could have negative consequences for the end-user (granted, that would be detected and corrected pretty quickly).&lt;/p&gt;

&lt;p&gt;The other problem, however, is JAR pollution. The JConsole GUI plugin classes in log4j-core will never be used in applications that normally use log4j-core. For that matter, log4j-core and all other artifacts in Log4j right now are intended to be Maven central artifacts or otherwise libraries that are packaged with the resulting application. But the JConsole GUI plugin classes are NOT intended for that. They will be have to be manually downloaded and placed somewhere (usually on an application administrator&apos;s computer) from where they can be put on the classpath when running JConsole. This is a very different context and a very different need. The log4j-jconsole-plugin wouldn&apos;t even need to be published in Maven central (though there would be no harm in doing so). I don&apos;t think this creates the &quot;Yet Another Jar&quot; problem that it sounds like. It&apos;s not &quot;Yet Another Jar&quot; that would ever go in an application.&lt;/p&gt;

&lt;p&gt;Just my $0.02.&lt;/p&gt;</comment>
                            <comment id="13648137" author="remkop@yahoo.com" created="Fri, 3 May 2013 03:05:11 +0000"  >&lt;p&gt;Sebastian,&lt;br/&gt;
I&apos;m trying to understand your use case. &lt;br/&gt;
Do you want to build your application with Maven using only a JRE and no JDK?&lt;/p&gt;</comment>
                            <comment id="13648195" author="ralph.goers@dslextreme.com" created="Fri, 3 May 2013 05:19:32 +0000"  >&lt;p&gt;jconsole.jar should definitely not be a required dependency. Optional, maybe. I tend to think that moving the Jconsole support to a separate jar project makes sense since it only has value within jconsole.&lt;/p&gt;</comment>
                            <comment id="13648203" author="sdeboy" created="Fri, 3 May 2013 05:44:39 +0000"  >&lt;p&gt;Is it fair to say &apos;gui related things&apos; are a bridge-too-far when it comes to core? Pretty much everything else that&apos;s optional is fair game?  I&apos;d be ok with that.&lt;/p&gt;</comment>
                            <comment id="13648205" author="ralph.goers@dslextreme.com" created="Fri, 3 May 2013 05:48:02 +0000"  >&lt;p&gt;I can think of a few other things but in general that is fair.&lt;/p&gt;</comment>
                            <comment id="13648209" author="remkop@yahoo.com" created="Fri, 3 May 2013 05:56:01 +0000"  >&lt;p&gt;Perhaps my Maven inexperience is getting in the way here. &lt;br/&gt;
Let me try to understand. &lt;br/&gt;
We need jconsole to build log4j, but once these jars have been created, anyone can build their project with just the log4j jars, no? Or does maven now impose a dependency on jconsole on anyone who has a project that uses log4j? And would making this dependency &quot;optional&quot; remove that problem for projects that use log4j?&lt;/p&gt;</comment>
                            <comment id="13648211" author="ralph.goers@dslextreme.com" created="Fri, 3 May 2013 06:04:16 +0000"  >&lt;p&gt;Maven has different dependency scopes.  See &lt;a href=&quot;http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Scope&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html#Dependency_Scope&lt;/a&gt;  Compile scope means the dependency is required to compile, and therefore also to run. If you mark it as optional then it won&apos;t be pulled in as a transitive dependency. Requiring jconsole.jar for core would be similar to requiring an eclipse jar or similar. An application running as a server would never want that jar included and it really doesn&apos;t make much sense to have the JConsole UI classes in core.&lt;/p&gt;</comment>
                            <comment id="13648212" author="zyrano" created="Fri, 3 May 2013 06:08:37 +0000"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;actually our use case IS a commercial application running on a server (but not packaged as a WAR). Hence we could define a JDK as system requirements. However currently a JRE is sufficient and to formulate a requirement for a JDK instead just due to two transitive dependencies that are actually not needed makes me feeling uncomfortable.&lt;/p&gt;

&lt;p&gt;Besides just feeling uncomfortable I totally agree with Nick Williams (class path pollution / usage of classes that are not intended to be used by someone just using log4j2).&lt;/p&gt;

&lt;p&gt;About the runtime/compile time dependencies: The scopes of dependencies form a hierarchy. Thus as Nick stated a jar that is required for compilation is also required at runtime.&lt;/p&gt;

&lt;p&gt;You can try the following: Take a jar with a transitive dependency for example on log4j (1.2). Then use the Maven mechanism to exclude transitive dependencies. However you may have a project with several jars depending on log4j. Then exclude all transitive dependencies for log4j and remove the declared direct dependency on log4j if there is any. Once the last dependency is left you&apos;ll run into problems.&lt;/p&gt;

&lt;p&gt;For example in Eclipse you would at first get errors such as &quot;Class XYZ is missing. It is indirectly referenced by some .class files&quot; (I do not have the exact wording in my mind at this moment). Furthermore your auto completion would fail on any of these log4j classes.&lt;/p&gt;

&lt;p&gt;Howver everything starts to get more complex if using reflection. By reflection you may call classes at runtime given by strings (class names) =&amp;gt; no compile time dependency but runtime dependency. At the moment I&apos;m not totally sure if it can go the other way round.&lt;br/&gt;
I don&apos;t think so cause at some point you must call a specific class if you want to use it otherwise there should be no dependency at all. But using service provider frameworks or using the JDK 6 compiler API (you can give a string at runtime and compile it to a Java class ...) or doing your own code instrumentation things are getting rather complex. Thus having removed the dependency on tools.jar and do not encountering any compilation issues is not a real proof (however it might be good enough as there will be some testing / continous integration before a release).&lt;/p&gt;

&lt;p&gt;This leads to my conclusion: If there is a transitive dependency on something, I may exclude it and everything may compile fine. Furthermore everything may run fine for some time but may crash at one point when a specific class is invoked using reflection. Having there no transitive dependency gives a me kind of safety (as I&apos;m assuming that the declared dependencies are correct) and avoids me spending time on wondering issues that might be irrelevant.&lt;/p&gt;</comment>
                            <comment id="13648372" author="remkop@yahoo.com" created="Fri, 3 May 2013 12:49:30 +0000"  >&lt;p&gt;Ralph, thank you for the link.&lt;br/&gt;
The dependency on jconsole should obviously have been optional from the beginning.&lt;br/&gt;
Apologies that my lack of Maven experience caused inconvenience.&lt;/p&gt;

&lt;p&gt;I made the dependency on jconsole optional in core/pom.xml (revision 1478758).&lt;br/&gt;
This should resolve Sebastian&apos;s immediate issue.&lt;/p&gt;

&lt;p&gt;The consensus seems to be to move the 4 jmx gui classes into a separate module. I&apos;ll do that at some later point.&lt;/p&gt;</comment>
                            <comment id="13648398" author="beamerblvd" created="Fri, 3 May 2013 13:21:20 +0000"  >&lt;p&gt;Alright, let me clear a few things up, because it sounds like there may be some confusion, and that&apos;s the last thing I want. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;First of all, tools.jar probably isn&apos;t ever required. It contains utilities for running the compiler, JavaDoc, and other normally-executable utilities from the Java API instead of the command line. It doesn&apos;t contain any JMX or JConsole classes that I can see. So I think removing it as a dependency is safe.&lt;/p&gt;

&lt;p&gt;Now as far as I can tell jconsole.jar is required for compiling and running the GUI JMX classes. Even if it WERE required for the other JMX classes, it would never be required to COMPILE an application that was using Log4j. It would only be required to RUN an application using Log4j (which means the running application would have to be running in a JDK).&lt;/p&gt;

&lt;p&gt;Of course, we certainly don&apos;t want to introduce a dependency on a JDK in order to use Log4j. As I said, my suspicion is that these JDK-only classes are ONLY required for the GUI classes. However, the best way to ensure this is, as many have agreed here, to move the GUI classes into a separate submodule (log4j-jconsole-plugin, or similar). Then, we should be able to remove the jconsole.jar dependency from the Core since it would only be required in the submodule.&lt;/p&gt;

&lt;p&gt;Hope this clears a few things up.&lt;/p&gt;</comment>
                            <comment id="13648440" author="remkop@yahoo.com" created="Fri, 3 May 2013 14:20:39 +0000"  >&lt;p&gt;Nick, I&apos;m not disagreeing with you. &lt;br/&gt;
I removed tools.jar as soon as it was pointed out. &lt;br/&gt;
I made jconsole.jar optional as soon as I understood how this transitive dependency thing works in maven. &lt;/p&gt;

&lt;p&gt;There is no (and never was any) dependency on JDK classes for anyone using log4j. &lt;br/&gt;
The class in question is only used when you run&lt;br/&gt;
  $JAVA_HOME/bin/jconsole &lt;del&gt;pluginpath log4j-core&lt;/del&gt;&amp;lt;version&amp;gt;.jar&lt;br/&gt;
(and you would need a JDK to run that command anyway)&lt;/p&gt;

&lt;p&gt;Removing tools.jar and making jconsole.jar optional was high-priority as it was affecting users. &lt;/p&gt;

&lt;p&gt;Moving the JMX GUI classes into a separate submodule (I&apos;d like to call it log4j-jmx-gui) is on the todo list, but not at the top anymore. There are a handful of bugs and there&apos;s your DB appenders patch that I all consider higher priority and I plan to look at those first before the module reshuffling. &lt;/p&gt;

&lt;p&gt;Let me know if you think I am prioritizing things wrong. &lt;/p&gt;</comment>
                            <comment id="13648451" author="beamerblvd" created="Fri, 3 May 2013 14:35:13 +0000"  >&lt;p&gt;No, I think that&apos;s a fair order of priorities. Sounds good.&lt;/p&gt;</comment>
                            <comment id="13648512" author="remkop@yahoo.com" created="Fri, 3 May 2013 15:50:18 +0000"  >&lt;p&gt;Created ticket &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-237&quot; title=&quot;Move JMX GUI classes out of the core module into a new submodule&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-237&quot;&gt;&lt;del&gt;LOG4J2-237&lt;/del&gt;&lt;/a&gt; for the follow-up work.&lt;/p&gt;</comment>
                            <comment id="13648514" author="beamerblvd" created="Fri, 3 May 2013 15:53:57 +0000"  >&lt;p&gt;Good idea.&lt;/p&gt;</comment>
                            <comment id="13648517" author="remkop@yahoo.com" created="Fri, 3 May 2013 15:54:24 +0000"  >&lt;p&gt;Ralph, I&apos;d like to mark this ticket as &quot;Resolved&quot; but I cannot see that button (perhaps because it wasn&apos;t assigned yet?). Can you give me the right to assign issues to myself?&lt;/p&gt;

&lt;p&gt;Sebastian, this is now fixed in trunk. Can you verify and close this ticket? Thanks!&lt;/p&gt;</comment>
                            <comment id="13648567" author="ralph.goers@dslextreme.com" created="Fri, 3 May 2013 17:09:39 +0000"  >&lt;p&gt;I&apos;ve changed your role in Jira to committer. Please let me know if that gives you the rights you need.&lt;/p&gt;</comment>
                            <comment id="13648958" author="remkop@yahoo.com" created="Sat, 4 May 2013 00:54:07 +0000"  >&lt;p&gt;Sebastian, this is now fixed in trunk. Can you verify and close this ticket? Thanks!&lt;/p&gt;</comment>
                            <comment id="13656851" author="zyrano" created="Tue, 14 May 2013 06:23:16 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I switched to 2.0-beta6 and the dependencies on the JDK (tools.jar and jconsole.jar) are removed.&lt;/p&gt;

&lt;p&gt;Thx for your immediate reaction.&lt;/p&gt;

&lt;p&gt;By the way is there a proper place for questions? I noticed one thing, probably it&apos;s a misconfiguration on my side but it might be a completely different bug. However I do not won&apos;t to open a new issue until I&apos;m sure about it.&lt;/p&gt;

&lt;p&gt;With regards&lt;br/&gt;
Sebastian&lt;/p&gt;</comment>
                            <comment id="13656852" author="zyrano" created="Tue, 14 May 2013 06:26:26 +0000"  >&lt;p&gt;Switching to the new version (2.0-beta6) the dependencies on tools.jar and jconsole.jar are vanished.&lt;/p&gt;

&lt;p&gt;I do not made any tests for side effects. At a first glance logging (as far as I use it) seems to work as before.&lt;/p&gt;</comment>
                            <comment id="13656854" author="remkop@yahoo.com" created="Tue, 14 May 2013 06:29:56 +0000"  >&lt;p&gt;Sebastian,&lt;br/&gt;
For questions, you can either post to one of the mailing lists or create a new JIRA. Both are fine. &lt;/p&gt;

&lt;p&gt;Mailing lists are here: &lt;a href=&quot;http://logging.apache.org/log4j/2.x/mail-lists.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://logging.apache.org/log4j/2.x/mail-lists.html&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="12645995">LOG4J2-237</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>326180</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 28 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1k9tz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>326525</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>