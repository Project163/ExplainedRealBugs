<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:38:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1311] SocketAppender will lose several events after re-connection to server</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1311</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;-------&amp;gt; Firstly, I&apos;d like to describe some conditions of our environment:&lt;br/&gt;
1) Our application uses SocketAppender(TCP) for audit logs and SocketAppender(UDP) for system logs and the problem occurs for the TCP case.&lt;br/&gt;
2) We have two logstash servers and there is one HAProxy Server(172.16.64.236) for load balance usage between one application server(10.111.131.28) and two logstash servers(172.16.64.33 and 172.16.64.3). &lt;br/&gt;
3) Haproxy Server will break the connection if the connection is idle for several minutes, e.g. 10 minutes as we set.&lt;br/&gt;
4) The content of log4j2.properties(You can only focus on the TCP SocketAppender part): &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;status=TRACE
name=TestOneLogConfig
 
property.filename=/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log.log
 
#filters=threshold
 
#filter.threshold.type=ThresholdFilter
#filter.threshold.level=debug
 
appenders=console, rolling, syslog, auditlog
 
appender.console.type=Console
appender.console.name=STDOUT
appender.console.layout.type=PatternLayout
appender.console.layout.pattern=%d{yyyy-MM-dd HH:mm:ss} [%t] %p %c:%L - %m%n
 
appender.rolling.type=RollingFile
appender.rolling.name=RollingFile
appender.rolling.fileName=${filename}
appender.rolling.filePattern=/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-%d{MM-dd-yy-HH-mm-ss}-%i.log.gz
appender.rolling.layout.type=PatternLayout
appender.rolling.layout.pattern=%d{yyyy-MM-dd HH:mm:ss} [%t] %p %c:%L - %m%n
appender.rolling.policies.type=Policies
appender.rolling.policies.time.type=TimeBasedTriggeringPolicy
appender.rolling.policies.time.interval=2
appender.rolling.policies.time.modulate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
appender.rolling.policies.size.type=SizeBasedTriggeringPolicy
appender.rolling.policies.size.size=100MB
appender.rolling.strategy.type=DefaultRolloverStrategy
appender.rolling.strategy.max=5

appender.syslog.type=Socket
appender.syslog.name=UDPSocket
appender.syslog.layout.type=JsonLayout
appender.syslog.layout.locationInfo=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
appender.syslog.layout.properties=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
appender.syslog.protocol=UDP
appender.syslog.host=172.16.64.3
appender.syslog.port=4562

appender.auditlog.type=Socket
appender.auditlog.name=TCPSocket
appender.auditlog.layout.type=JsonLayout
appender.auditlog.layout.locationInfo=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
appender.auditlog.layout.properties=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
appender.auditlog.protocol=TCP
appender.auditlog.host=172.16.64.236
appender.auditlog.port=4561
appender.auditlog.connectTimeoutMillis=3000
appender.auditlog.reconnectionDelayMillis=3000
appender.auditlog.immediateFail=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
appender.auditlog.immediateFlush=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
appender.auditlog.ignoreExceptions=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;

#appender.asyncauditlog.type=Async
#appender.asyncauditlog.name=AsyncTCPSocket
#appender.asyncauditlog.blocking=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
#appender.asyncauditlog.bufferSize=2048
#appender.asyncauditlog.ignoreExceptions=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
#appender.asyncauditlog.asyncaudit.type=AppenderRef
#appender.asyncauditlog.asyncaudit.ref=TCPSocket

loggers=auditlogger
 
logger.auditlogger.name=auditlogger
logger.auditlogger.level=debug
#logger.auditlogger.additivity=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
logger.auditlogger.appenderRefs=auditlog
logger.auditlogger.appenderRef.auditlog.ref=TCPSocket
 
rootLogger.level=debug
rootLogger.appenderRefs=console, rolling, syslog
rootLogger.appenderRef.console.ref=STDOUT
rootLogger.appenderRef.rolling.ref=RollingFile
rootLogger.appenderRef.syslog.ref=UDPSocket
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;-------&amp;gt; Secondly, the process/steps of meeting problem:&lt;br/&gt;
1) Logstash servers, HAProxy servers and our application servers are up, and the application servers send audit logs to haproxy and logstash successfully.&lt;br/&gt;
2) As we didn&apos;t do any operation, there is no audit logs come into haproxy in several minutes, and haproxy break the connection between it and application server. I use &quot;netstat -antp&quot; to check tcp connection states and found that: from the harpoxy server&apos;s pov, there is no connection to its 4561 tcp port and from the application server&apos;s pov, the connection to haproxy&apos;s 4561 port is CLOSE_WAIT&lt;br/&gt;
3) We did a operation so that application server will write one audit log. However nothing happen, SocketAppender didn&apos;t throw any exception. And I can see that previous CLOSE_WAIT connection is also gone. This audit log didn&apos;t come into haproxy and logstash at all.&lt;br/&gt;
4) We did a second operation so that application server will write the second audit log. However now SocketAppender throw a exception of and our application catches it and write the system log about it. This audit log didn&apos;t  come into haproxy and logstash either.&lt;br/&gt;
5) We did a third operation so that application server will write the third audit log. This time SocketAppender works well and this audit log came into haproxy and logstash.&lt;/p&gt;

&lt;p&gt;-------&amp;gt; So our question is that:&lt;br/&gt;
1) What&apos;s the reason of this situation, do you have any idea?&lt;br/&gt;
2) Is there any solution to write the first and second audit log to log server finally? The audit log is really importance for us.&lt;/p&gt;

&lt;p&gt;P.S.&lt;br/&gt;
Here I paste the logs of console(from eclipse), you can see there are serveral prints of &quot;DEBUG auditlogger:57 - LXB 0.0.0.0 xClone roles successfully&quot; after re-connection, however logstash only receive the last one:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&#19977;&#26376; 09, 2016 4:58:01 &#19979;&#21320; org.apache.catalina.core.AprLifecycleListener init
&#20449;&#24687;: The APR based Apache Tomcat Native library which allows optimal performance in production environments was not found on the java.library.path: /usr/java/packages/lib/amd64:/usr/lib64:/lib64:/lib:/usr/lib
&#19977;&#26376; 09, 2016 4:58:01 &#19979;&#21320; org.apache.tomcat.util.digester.SetPropertiesRule begin
&#35686;&#21578;: [SetPropertiesRule]{Server/Service/Engine/Host/Context} Setting property &lt;span class=&quot;code-quote&quot;&gt;&apos;source&apos;&lt;/span&gt; to &lt;span class=&quot;code-quote&quot;&gt;&apos;org.eclipse.jst.j2ee.server:test-one-log&apos;&lt;/span&gt; did not find a matching property.
&#19977;&#26376; 09, 2016 4:58:02 &#19979;&#21320; org.apache.coyote.AbstractProtocol init
&#20449;&#24687;: Initializing ProtocolHandler [&lt;span class=&quot;code-quote&quot;&gt;&quot;http-bio-8080&quot;&lt;/span&gt;]
&#19977;&#26376; 09, 2016 4:58:02 &#19979;&#21320; org.apache.coyote.AbstractProtocol init
&#20449;&#24687;: Initializing ProtocolHandler [&lt;span class=&quot;code-quote&quot;&gt;&quot;ajp-bio-8009&quot;&lt;/span&gt;]
&#19977;&#26376; 09, 2016 4:58:02 &#19979;&#21320; org.apache.catalina.startup.Catalina load
&#20449;&#24687;: Initialization processed in 1050 ms
&#19977;&#26376; 09, 2016 4:58:02 &#19979;&#21320; org.apache.catalina.core.StandardService startInternal
&#20449;&#24687;: Starting service Catalina
&#19977;&#26376; 09, 2016 4:58:02 &#19979;&#21320; org.apache.catalina.core.StandardEngine startInternal
&#20449;&#24687;: Starting Servlet Engine: Apache Tomcat/7.0.47
&#19977;&#26376; 09, 2016 4:58:03 &#19979;&#21320; org.apache.catalina.loader.WebappClassLoader validateJarFile
&#20449;&#24687;: validateJarFile(/home/xibing-liang/workspace/.metadata/.plugins/org.eclipse.wst.server.core/tmp2/wtpwebapps/test-one-log/WEB-INF/lib/javax.servlet-api-3.1.0.jar) - jar not loaded. See Servlet Spec 2.3, section 9.7.2. Offending class: javax/servlet/Servlet.&lt;span class=&quot;code-keyword&quot;&gt;class
&lt;/span&gt;&#19977;&#26376; 09, 2016 4:58:06 &#19979;&#21320; org.apache.catalina.core.ApplicationContext log
&#20449;&#24687;: No Spring WebApplicationInitializer types detected on classpath
SLF4J: Failed to load class &lt;span class=&quot;code-quote&quot;&gt;&quot;org.slf4j.impl.StaticLoggerBinder&quot;&lt;/span&gt;.
SLF4J: Defaulting to no-operation (NOP) logger implementation
SLF4J: See http:&lt;span class=&quot;code-comment&quot;&gt;//www.slf4j.org/codes.html#StaticLoggerBinder &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; further details.
&lt;/span&gt;&#19977;&#26376; 09, 2016 4:58:06 &#19979;&#21320; org.apache.catalina.core.ApplicationContext log
&#20449;&#24687;: Initializing Spring root WebApplicationContext
&#19977;&#26376; 09, 2016 4:58:07 &#19979;&#21320; org.apache.catalina.core.ApplicationContext log
&#20449;&#24687;: Initializing Spring FrameworkServlet &lt;span class=&quot;code-quote&quot;&gt;&apos;mvc-dispatcher&apos;&lt;/span&gt;
2016-03-09 16:58:07,694 localhost-startStop-1 DEBUG Initializing configuration org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@574c1328
2016-03-09 16:58:07,705 localhost-startStop-1 DEBUG Installed script engines
2016-03-09 16:58:07,717 localhost-startStop-1 DEBUG Mozilla Rhino Version: 1.7 release 3 PRERELEASE, Language: ECMAScript, Threading: MULTITHREADED, Compile: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, Names: {js, rhino, JavaScript, javascript, ECMAScript, ecmascript}
2016-03-09 16:58:07,718 localhost-startStop-1 DEBUG PluginManager &lt;span class=&quot;code-quote&quot;&gt;&apos;Core&apos;&lt;/span&gt; found 97 plugins
2016-03-09 16:58:07,718 localhost-startStop-1 DEBUG PluginManager &lt;span class=&quot;code-quote&quot;&gt;&apos;Level&apos;&lt;/span&gt; found 0 plugins
2016-03-09 16:58:07,723 localhost-startStop-1 DEBUG No scheduled items
2016-03-09 16:58:07,724 localhost-startStop-1 DEBUG Building Plugin[name=property, class=org.apache.logging.log4j.core.config.Property].
2016-03-09 16:58:07,740 localhost-startStop-1 TRACE TypeConverterRegistry initializing.
2016-03-09 16:58:07,740 localhost-startStop-1 DEBUG PluginManager &lt;span class=&quot;code-quote&quot;&gt;&apos;TypeConverter&apos;&lt;/span&gt; found 23 plugins
2016-03-09 16:58:07,749 localhost-startStop-1 DEBUG createProperty(name=&lt;span class=&quot;code-quote&quot;&gt;&quot;filename&quot;&lt;/span&gt;, value=&lt;span class=&quot;code-quote&quot;&gt;&quot;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log.log&quot;&lt;/span&gt;)
2016-03-09 16:58:07,750 localhost-startStop-1 DEBUG Building Plugin[name=properties, class=org.apache.logging.log4j.core.config.PropertiesPlugin].
2016-03-09 16:58:07,770 localhost-startStop-1 DEBUG configureSubstitutor(={filename=/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log.log}, Configuration(TestOneLogConfig))
2016-03-09 16:58:07,771 localhost-startStop-1 DEBUG PluginManager &lt;span class=&quot;code-quote&quot;&gt;&apos;Lookup&apos;&lt;/span&gt; found 13 plugins
2016-03-09 16:58:07,771 localhost-startStop-1 DEBUG Building Plugin[name=AppenderRef, class=org.apache.logging.log4j.core.config.AppenderRef].
2016-03-09 16:58:07,772 localhost-startStop-1 DEBUG createAppenderRef(ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;TCPSocket&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2016-03-09 16:58:07,773 localhost-startStop-1 DEBUG Building Plugin[name=logger, class=org.apache.logging.log4j.core.config.LoggerConfig].
2016-03-09 16:58:07,776 localhost-startStop-1 DEBUG createLogger(additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&quot;auditlogger&quot;&lt;/span&gt;, includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, ={TCPSocket}, ={}, Configuration(TestOneLogConfig), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2016-03-09 16:58:07,779 localhost-startStop-1 DEBUG Building Plugin[name=AppenderRef, class=org.apache.logging.log4j.core.config.AppenderRef].
2016-03-09 16:58:07,780 localhost-startStop-1 DEBUG createAppenderRef(ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;STDOUT&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2016-03-09 16:58:07,780 localhost-startStop-1 DEBUG Building Plugin[name=AppenderRef, class=org.apache.logging.log4j.core.config.AppenderRef].
2016-03-09 16:58:07,783 localhost-startStop-1 DEBUG createAppenderRef(ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;RollingFile&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2016-03-09 16:58:07,783 localhost-startStop-1 DEBUG Building Plugin[name=AppenderRef, class=org.apache.logging.log4j.core.config.AppenderRef].
2016-03-09 16:58:07,784 localhost-startStop-1 DEBUG createAppenderRef(ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;UDPSocket&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2016-03-09 16:58:07,784 localhost-startStop-1 DEBUG Building Plugin[name=root, class=org.apache.logging.log4j.core.config.LoggerConfig$RootLogger].
2016-03-09 16:58:07,786 localhost-startStop-1 DEBUG createLogger(additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, level=&lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;, includeLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, ={STDOUT, RollingFile, UDPSocket}, ={}, Configuration(TestOneLogConfig), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
2016-03-09 16:58:07,787 localhost-startStop-1 DEBUG Building Plugin[name=loggers, class=org.apache.logging.log4j.core.config.LoggersPlugin].
2016-03-09 16:58:07,788 localhost-startStop-1 DEBUG createLoggers(={auditlogger, root})
2016-03-09 16:58:07,788 localhost-startStop-1 DEBUG Building Plugin[name=layout, class=org.apache.logging.log4j.core.layout.PatternLayout].
2016-03-09 16:58:07,821 localhost-startStop-1 DEBUG PatternLayout$Builder(pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d{yyyy-MM-dd HH:mm:ss} [%t] %p %c:%L - %m%n&quot;&lt;/span&gt;, PatternSelector=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, Configuration(TestOneLogConfig), Replace=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, charset=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, alwaysWriteExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, noConsoleNoAnsi=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, header=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, footer=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;)
2016-03-09 16:58:07,822 localhost-startStop-1 DEBUG PluginManager &lt;span class=&quot;code-quote&quot;&gt;&apos;Converter&apos;&lt;/span&gt; found 38 plugins
2016-03-09 16:58:07,887 localhost-startStop-1 DEBUG Building Plugin[name=appender, class=org.apache.logging.log4j.core.appender.ConsoleAppender].
2016-03-09 16:58:07,895 localhost-startStop-1 INFO Log4j appears to be running in a Servlet environment, but there&apos;s no log4j-web module available. If you want better web container support, please add the log4j-web JAR to your web archive or server lib directory.
2016-03-09 16:58:07,896 localhost-startStop-1 DEBUG PluginManager &lt;span class=&quot;code-quote&quot;&gt;&apos;Converter&apos;&lt;/span&gt; found 38 plugins
2016-03-09 16:58:07,899 localhost-startStop-1 DEBUG Starting OutputStreamManager SYSTEM_OUT.&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;-2
2016-03-09 16:58:07,930 localhost-startStop-1 DEBUG ConsoleAppender$Builder(PatternLayout(%d{yyyy-MM-dd HH:mm:ss} [%t] %p %c:%L - %m%n), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, target=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&quot;STDOUT&quot;&lt;/span&gt;, follow=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, ignoreExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;)
2016-03-09 16:58:07,938 localhost-startStop-1 DEBUG Starting OutputStreamManager SYSTEM_OUT.&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2016-03-09 16:58:07,940 localhost-startStop-1 DEBUG Building Plugin[name=layout, class=org.apache.logging.log4j.core.layout.PatternLayout].
2016-03-09 16:58:07,942 localhost-startStop-1 DEBUG PatternLayout$Builder(pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d{yyyy-MM-dd HH:mm:ss} [%t] %p %c:%L - %m%n&quot;&lt;/span&gt;, PatternSelector=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, Configuration(TestOneLogConfig), Replace=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, charset=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, alwaysWriteExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, noConsoleNoAnsi=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, header=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, footer=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;)
2016-03-09 16:58:07,943 localhost-startStop-1 DEBUG Building Plugin[name=TimeBasedTriggeringPolicy, class=org.apache.logging.log4j.core.appender.rolling.TimeBasedTriggeringPolicy].
2016-03-09 16:58:07,946 localhost-startStop-1 DEBUG createPolicy(interval=&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;, modulate=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;)
2016-03-09 16:58:07,947 localhost-startStop-1 DEBUG Building Plugin[name=SizeBasedTriggeringPolicy, class=org.apache.logging.log4j.core.appender.rolling.SizeBasedTriggeringPolicy].
2016-03-09 16:58:07,951 localhost-startStop-1 DEBUG createPolicy(size=&lt;span class=&quot;code-quote&quot;&gt;&quot;100MB&quot;&lt;/span&gt;)
2016-03-09 16:58:07,955 localhost-startStop-1 DEBUG Building Plugin[name=Policies, class=org.apache.logging.log4j.core.appender.rolling.CompositeTriggeringPolicy].
2016-03-09 16:58:07,963 localhost-startStop-1 DEBUG createPolicy(={TimeBasedTriggeringPolicy(nextRolloverMillis=0, interval=2, modulate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;), SizeBasedTriggeringPolicy(size=104857600)})
2016-03-09 16:58:07,968 localhost-startStop-1 DEBUG Building Plugin[name=DefaultRolloverStrategy, class=org.apache.logging.log4j.core.appender.rolling.DefaultRolloverStrategy].
2016-03-09 16:58:07,973 localhost-startStop-1 DEBUG createStrategy(max=&lt;span class=&quot;code-quote&quot;&gt;&quot;5&quot;&lt;/span&gt;, min=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, fileIndex=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, compressionLevel=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, ={}, stopCustomActionsOnError=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, Configuration(TestOneLogConfig))
2016-03-09 16:58:07,975 localhost-startStop-1 DEBUG Building Plugin[name=appender, class=org.apache.logging.log4j.core.appender.RollingFileAppender].
2016-03-09 16:58:07,980 localhost-startStop-1 DEBUG createAppender(fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log.log&quot;&lt;/span&gt;, filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-%d{MM-dd-yy-HH-mm-ss}-%i.log.gz&quot;&lt;/span&gt;, append=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&quot;RollingFile&quot;&lt;/span&gt;, bufferedIO=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, bufferSize=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, immediateFlush=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, Policies(CompositeTriggeringPolicy(policies=[TimeBasedTriggeringPolicy(nextRolloverMillis=0, interval=2, modulate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;), SizeBasedTriggeringPolicy(size=104857600)])), DefaultRolloverStrategy(DefaultRolloverStrategy(min=1, max=5)), PatternLayout(%d{yyyy-MM-dd HH:mm:ss} [%t] %p %c:%L - %m%n), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, ignoreExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, advertise=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, advertiseURI=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;, Configuration(TestOneLogConfig))
2016-03-09 16:58:07,990 localhost-startStop-1 DEBUG Starting RollingFileManager /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log.log
2016-03-09 16:58:07,994 localhost-startStop-1 DEBUG PluginManager &lt;span class=&quot;code-quote&quot;&gt;&apos;FileConverter&apos;&lt;/span&gt; found 2 plugins
2016-03-09 16:58:07,997 localhost-startStop-1 TRACE PatternProcessor.getNextTime returning 2016/03/09-16:45:52.000, nextFileTime=2016/03/09-16:45:51.000, prevFileTime=1970/01/01-08:00:00.000, current=2016/03/09-16:58:07.997, freq=EVERY_SECOND
2016-03-09 16:58:08,003 localhost-startStop-1 TRACE PatternProcessor.getNextTime returning 2016/03/09-16:45:52.000, nextFileTime=2016/03/09-16:45:51.000, prevFileTime=2016/03/09-16:45:51.000, current=2016/03/09-16:58:08.002, freq=EVERY_SECOND
2016-03-09 16:58:08,003 localhost-startStop-1 DEBUG Building Plugin[name=layout, class=org.apache.logging.log4j.core.layout.JsonLayout].
2016-03-09 16:58:08,012 localhost-startStop-1 DEBUG createLayout(locationInfo=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, properties=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, complete=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;, compact=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;, eventEol=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;, charset=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;)
2016-03-09 16:58:08,301 localhost-startStop-1 DEBUG Building Plugin[name=appender, class=org.apache.logging.log4j.core.appender.SocketAppender].
2016-03-09 16:58:08,308 localhost-startStop-1 DEBUG createAppender(host=&lt;span class=&quot;code-quote&quot;&gt;&quot;172.16.64.3&quot;&lt;/span&gt;, port=&lt;span class=&quot;code-quote&quot;&gt;&quot;4562&quot;&lt;/span&gt;, protocol=&lt;span class=&quot;code-quote&quot;&gt;&quot;UDP&quot;&lt;/span&gt;, SSL=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, connectTimeoutMillis=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;, reconnectionDelayMillis=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;, immediateFail=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&quot;UDPSocket&quot;&lt;/span&gt;, immediateFlush=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, ignoreExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, JsonLayout(org.apache.logging.log4j.core.layout.JsonLayout@35e97fc3), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, advertise=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;, Configuration(TestOneLogConfig))
2016-03-09 16:58:08,311 localhost-startStop-1 DEBUG Starting DatagramSocketManager UDP:172.16.64.3:4562
2016-03-09 16:58:08,312 localhost-startStop-1 DEBUG Building Plugin[name=layout, class=org.apache.logging.log4j.core.layout.JsonLayout].
2016-03-09 16:58:08,313 localhost-startStop-1 DEBUG createLayout(locationInfo=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, properties=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, complete=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;, compact=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;, eventEol=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;, charset=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;)
2016-03-09 16:58:08,313 localhost-startStop-1 DEBUG Building Plugin[name=appender, class=org.apache.logging.log4j.core.appender.SocketAppender].
2016-03-09 16:58:08,316 localhost-startStop-1 DEBUG createAppender(host=&lt;span class=&quot;code-quote&quot;&gt;&quot;172.16.64.236&quot;&lt;/span&gt;, port=&lt;span class=&quot;code-quote&quot;&gt;&quot;4561&quot;&lt;/span&gt;, protocol=&lt;span class=&quot;code-quote&quot;&gt;&quot;TCP&quot;&lt;/span&gt;, SSL=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, connectTimeoutMillis=&lt;span class=&quot;code-quote&quot;&gt;&quot;3000&quot;&lt;/span&gt;, reconnectionDelayMillis=&lt;span class=&quot;code-quote&quot;&gt;&quot;3000&quot;&lt;/span&gt;, immediateFail=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, name=&lt;span class=&quot;code-quote&quot;&gt;&quot;TCPSocket&quot;&lt;/span&gt;, immediateFlush=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;, ignoreExceptions=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;, JsonLayout(org.apache.logging.log4j.core.layout.JsonLayout@6ab715ca), Filter=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, advertise=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;, Configuration(TestOneLogConfig))
2016-03-09 16:58:08,322 localhost-startStop-1 DEBUG Starting TcpSocketManager TCP:172.16.64.236:4561
2016-03-09 16:58:08,323 localhost-startStop-1 DEBUG Building Plugin[name=appenders, class=org.apache.logging.log4j.core.config.AppendersPlugin].
2016-03-09 16:58:08,323 localhost-startStop-1 DEBUG createAppenders(={STDOUT, RollingFile, UDPSocket, TCPSocket})
2016-03-09 16:58:08,324 localhost-startStop-1 DEBUG Configuration org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@574c1328 initialized
2016-03-09 16:58:08,325 localhost-startStop-1 DEBUG Starting configuration org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@574c1328
2016-03-09 16:58:08,326 localhost-startStop-1 DEBUG Started configuration org.apache.logging.log4j.core.config.properties.PropertiesConfiguration@574c1328 OK.
2016-03-09 16:58:08,326 localhost-startStop-1 TRACE Stopping org.apache.logging.log4j.core.config.DefaultConfiguration@5332203...
2016-03-09 16:58:08,327 localhost-startStop-1 TRACE DefaultConfiguration notified 1 ReliabilityStrategies that config will be stopped.
2016-03-09 16:58:08,327 localhost-startStop-1 TRACE DefaultConfiguration stopping root LoggerConfig.
2016-03-09 16:58:08,327 localhost-startStop-1 TRACE DefaultConfiguration notifying ReliabilityStrategies that appenders will be stopped.
2016-03-09 16:58:08,327 localhost-startStop-1 TRACE DefaultConfiguration stopping remaining Appenders.
2016-03-09 16:58:08,328 localhost-startStop-1 DEBUG Shutting down OutputStreamManager SYSTEM_OUT.&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;-1
2016-03-09 16:58:08,328 localhost-startStop-1 TRACE DefaultConfiguration stopped 1 remaining Appenders.
2016-03-09 16:58:08,328 localhost-startStop-1 TRACE DefaultConfiguration cleaning Appenders from 1 LoggerConfigs.
2016-03-09 16:58:08,329 localhost-startStop-1 DEBUG Stopped org.apache.logging.log4j.core.config.DefaultConfiguration@5332203 OK
2016-03-09 16:58:08,339 localhost-startStop-1 TRACE Reregistering MBeans after reconfigure. Selector=org.apache.logging.log4j.core.selector.ClassLoaderContextSelector@769c48b
2016-03-09 16:58:08,339 localhost-startStop-1 TRACE Reregistering context (1/1): &lt;span class=&quot;code-quote&quot;&gt;&apos;602fc7b3&apos;&lt;/span&gt; org.apache.logging.log4j.core.LoggerContext@30e6857a
2016-03-09 16:58:08,340 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=602fc7b3&apos;&lt;/span&gt;
2016-03-09 16:58:08,340 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=602fc7b3,component=StatusLogger&apos;&lt;/span&gt;
2016-03-09 16:58:08,341 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=602fc7b3,component=ContextSelector&apos;&lt;/span&gt;
2016-03-09 16:58:08,341 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=602fc7b3,component=Loggers,name=*&apos;&lt;/span&gt;
2016-03-09 16:58:08,342 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=602fc7b3,component=Appenders,name=*&apos;&lt;/span&gt;
2016-03-09 16:58:08,342 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=602fc7b3,component=AsyncAppenders,name=*&apos;&lt;/span&gt;
2016-03-09 16:58:08,342 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=602fc7b3,component=AsyncLoggerRingBuffer&apos;&lt;/span&gt;
2016-03-09 16:58:08,343 localhost-startStop-1 TRACE Unregistering but no MBeans found matching &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.logging.log4j2:type=602fc7b3,component=Loggers,name=*,subtype=RingBuffer&apos;&lt;/span&gt;
2016-03-09 16:58:08,344 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=602fc7b3
2016-03-09 16:58:08,350 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=602fc7b3,component=StatusLogger
2016-03-09 16:58:08,352 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=602fc7b3,component=ContextSelector
2016-03-09 16:58:08,354 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=602fc7b3,component=Loggers,name=
2016-03-09 16:58:08,355 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=602fc7b3,component=Loggers,name=auditlogger
2016-03-09 16:58:08,356 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=602fc7b3,component=Appenders,name=UDPSocket
2016-03-09 16:58:08,357 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=602fc7b3,component=Appenders,name=RollingFile
2016-03-09 16:58:08,357 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=602fc7b3,component=Appenders,name=STDOUT
2016-03-09 16:58:08,357 localhost-startStop-1 DEBUG Registering MBean org.apache.logging.log4j2:type=602fc7b3,component=Appenders,name=TCPSocket
2016-03-09 16:58:08,359 localhost-startStop-1 TRACE Using &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; SystemClock &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; timestamps.
2016-03-09 16:58:08,360 localhost-startStop-1 TRACE Using DummyNanoClock &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; nanosecond timestamps.
2016-03-09 16:58:08,370 localhost-startStop-1 DEBUG Reconfiguration complete &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; context[name=602fc7b3] at URI NULL_SOURCE (org.apache.logging.log4j.core.LoggerContext@30e6857a) with optional &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2016-03-09 16:58:08,370 localhost-startStop-1 DEBUG Shutdown hook enabled. Registering a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; one.
2016-03-09 16:58:08,371 localhost-startStop-1 DEBUG LoggerContext[name=602fc7b3, org.apache.logging.log4j.core.LoggerContext@30e6857a] started OK.
&#19977;&#26376; 09, 2016 4:58:08 &#19979;&#21320; org.hibernate.validator.internal.util.Version &amp;lt;clinit&amp;gt;
INFO: HV000001: Hibernate Validator 5.1.3.Final
&#19977;&#26376; 09, 2016 4:58:09 &#19979;&#21320; org.apache.coyote.AbstractProtocol start
&#20449;&#24687;: Starting ProtocolHandler [&lt;span class=&quot;code-quote&quot;&gt;&quot;http-bio-8080&quot;&lt;/span&gt;]
&#19977;&#26376; 09, 2016 4:58:09 &#19979;&#21320; org.apache.coyote.AbstractProtocol start
&#20449;&#24687;: Starting ProtocolHandler [&lt;span class=&quot;code-quote&quot;&gt;&quot;ajp-bio-8009&quot;&lt;/span&gt;]
&#19977;&#26376; 09, 2016 4:58:09 &#19979;&#21320; org.apache.catalina.startup.Catalina start
&#20449;&#24687;: Server startup in 7725 ms
2016-03-09 17:00:33 [http-bio-8080-exec-5] DEBUG www.chinacloud.com.api.ProxyController:55 - roles xClone
2016-03-09 17:00:33,022 http-bio-8080-exec-5 TRACE PatternProcessor.getNextTime returning 2016/03/09-17:00:34.000, nextFileTime=2016/03/09-17:00:33.000, prevFileTime=2016/03/09-16:45:51.000, current=2016/03/09-17:00:33.022, freq=EVERY_SECOND
2016-03-09 17:00:33,026 http-bio-8080-exec-5 TRACE DefaultRolloverStrategy.purge() took 3.0 milliseconds
2016-03-09 17:00:33,029 http-bio-8080-exec-5 DEBUG RollingFileManager executing synchronous FileRenameAction[/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log.log to /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-03-09-16-16-45-51-1.log, renameEmptyFiles=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;]
2016-03-09 17:00:33,029 http-bio-8080-exec-5 DEBUG RollingFileManager executing async GzCompressAction[/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-03-09-16-16-45-51-1.log to /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-03-09-16-16-45-51-1.log.gz, deleteSource=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;]
2016-03-09 17:00:33 [http-bio-8080-exec-5] DEBUG auditlogger:57 - LXB 0.0.0.0 xClone roles successfully
PHPSESSID=kuk0kaclb0ogi2b9huei4hel02; expires=Wed, 09-Mar-2016 09:30:39 GMT; Max-Age=1800; path=/; HttpOnly
2016-03-09 17:14:03 [http-bio-8080-exec-7] DEBUG www.chinacloud.com.api.ProxyController:55 - roles xClone
2016-03-09 17:14:03,015 http-bio-8080-exec-7 TRACE PatternProcessor.getNextTime returning 2016/03/09-17:14:04.000, nextFileTime=2016/03/09-17:14:03.000, prevFileTime=2016/03/09-17:00:33.000, current=2016/03/09-17:14:03.013, freq=EVERY_SECOND
2016-03-09 17:14:03,017 http-bio-8080-exec-7 TRACE DefaultRolloverStrategy.purge() took 1.0 milliseconds
2016-03-09 17:14:03,017 http-bio-8080-exec-7 DEBUG RollingFileManager executing synchronous FileRenameAction[/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log.log to /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-03-09-16-17-00-33-1.log, renameEmptyFiles=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;]
2016-03-09 17:14:03,018 http-bio-8080-exec-7 DEBUG RollingFileManager executing async GzCompressAction[/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-03-09-16-17-00-33-1.log to /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-03-09-16-17-00-33-1.log.gz, deleteSource=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;]
2016-03-09 17:14:03 [http-bio-8080-exec-7] DEBUG auditlogger:57 - LXB 0.0.0.0 xClone roles successfully
PHPSESSID=kuk0kaclb0ogi2b9huei4hel02; expires=Wed, 09-Mar-2016 09:44:08 GMT; Max-Age=1800; path=/; HttpOnly
2016-03-09 17:14:45 [http-bio-8080-exec-9] DEBUG www.chinacloud.com.api.ProxyController:55 - roles xClone
2016-03-09 17:14:45,034 http-bio-8080-exec-9 TRACE PatternProcessor.getNextTime returning 2016/03/09-17:14:46.000, nextFileTime=2016/03/09-17:14:45.000, prevFileTime=2016/03/09-17:14:03.000, current=2016/03/09-17:14:45.034, freq=EVERY_SECOND
2016-03-09 17:14:45,035 http-bio-8080-exec-9 TRACE DefaultRolloverStrategy.purge() took 0.0 milliseconds
2016-03-09 17:14:45,035 http-bio-8080-exec-9 DEBUG RollingFileManager executing synchronous FileRenameAction[/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log.log to /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-03-09-16-17-14-03-1.log, renameEmptyFiles=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;]
2016-03-09 17:14:45,035 http-bio-8080-exec-9 DEBUG RollingFileManager executing async GzCompressAction[/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-03-09-16-17-14-03-1.log to /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-03-09-16-17-14-03-1.log.gz, deleteSource=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;]
2016-03-09 17:14:45,048 http-bio-8080-exec-9 ERROR Unable to write to stream TCP:172.16.64.236:4561 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; appender TCPSocket
2016-03-09 17:14:45,048 http-bio-8080-exec-9 ERROR An exception occurred processing Appender TCPSocket org.apache.logging.log4j.core.appender.AppenderLoggingException: Error writing to TCP:172.16.64.236:4561
	at org.apache.logging.log4j.core.net.TcpSocketManager.write(TcpSocketManager.java:140)
	at org.apache.logging.log4j.core.appender.OutputStreamManager.write(OutputStreamManager.java:136)
	at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.append(AbstractOutputStreamAppender.java:114)
	at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:152)
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:125)
	at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:116)
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:84)
	at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:390)
	at org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:378)
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:362)
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:352)
	at org.apache.logging.log4j.core.config.AwaitCompletionReliabilityStrategy.log(AwaitCompletionReliabilityStrategy.java:63)
	at org.apache.logging.log4j.core.Logger.logMessage(Logger.java:147)
	at org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:1022)
	at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:980)
	at org.apache.logging.log4j.spi.AbstractLogger.debug(AbstractLogger.java:239)
	at www.chinacloud.com.api.ProxyController.post(ProxyController.java:57)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:221)
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:137)
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:110)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandleMethod(RequestMappingHandlerAdapter.java:776)
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:705)
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:85)
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:959)
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:893)
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:966)
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:868)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:647)
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:842)
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:728)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:305)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
	at www.chinacloud.com.filter.CORSFilter.doFilter(CORSFilter.java:28)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:243)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:210)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:222)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:123)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:502)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:171)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:100)
	at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:953)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:118)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:408)
	at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1041)
	at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:603)
	at org.apache.tomcat.util.net.JIoEndpoint$SocketProcessor.run(JIoEndpoint.java:310)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.net.SocketException: &#26029;&#24320;&#30340;&#31649;&#36947;
	at java.net.SocketOutputStream.socketWrite0(Native Method)
	at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:113)
	at java.net.SocketOutputStream.write(SocketOutputStream.java:159)
	at org.apache.logging.log4j.core.net.TcpSocketManager.write(TcpSocketManager.java:131)
	... 55 more

2016-03-09 17:14:45 [http-bio-8080-exec-9] ERROR www.chinacloud.com.api.ProxyController:61 - LXB Audit Error: Error writing to TCP:172.16.64.236:4561
PHPSESSID=kuk0kaclb0ogi2b9huei4hel02; expires=Wed, 09-Mar-2016 09:44:51 GMT; Max-Age=1800; path=/; HttpOnly
2016-03-09 17:14:48,095 &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-3 DEBUG Connection to 172.16.64.236:4561 reestablished.
2016-03-09 17:15:39 [http-bio-8080-exec-1] DEBUG www.chinacloud.com.api.ProxyController:55 - roles xClone
2016-03-09 17:15:39,434 http-bio-8080-exec-1 TRACE PatternProcessor.getNextTime returning 2016/03/09-17:15:40.000, nextFileTime=2016/03/09-17:15:39.000, prevFileTime=2016/03/09-17:14:45.000, current=2016/03/09-17:15:39.434, freq=EVERY_SECOND
2016-03-09 17:15:39,435 http-bio-8080-exec-1 TRACE DefaultRolloverStrategy.purge() took 0.0 milliseconds
2016-03-09 17:15:39,436 http-bio-8080-exec-1 DEBUG RollingFileManager executing synchronous FileRenameAction[/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log.log to /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-03-09-16-17-14-45-1.log, renameEmptyFiles=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;]
2016-03-09 17:15:39,436 http-bio-8080-exec-1 DEBUG RollingFileManager executing async GzCompressAction[/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-03-09-16-17-14-45-1.log to /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/test-one-log/test-one-log-03-09-16-17-14-45-1.log.gz, deleteSource=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;]
2016-03-09 17:15:39 [http-bio-8080-exec-1] DEBUG auditlogger:57 - LXB 0.0.0.0 xClone roles successfully
PHPSESSID=kuk0kaclb0ogi2b9huei4hel02; expires=Wed, 09-Mar-2016 09:45:45 GMT; Max-Age=1800; path=/; HttpOnly
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;OS: Ubuntu 14.04 LTS&lt;/p&gt;</environment>
        <key id="12948345">LOG4J2-1311</key>
            <summary>SocketAppender will lose several events after re-connection to server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="liangxibing@chinacloud.com.cn">Xibing Liang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Mar 2016 09:19:29 +0000</created>
                <updated>Tue, 7 May 2019 13:32:49 +0000</updated>
                            <resolved>Sat, 29 Jul 2017 07:59:00 +0000</resolved>
                                    <version>2.5</version>
                                    <fixVersion>2.9.0</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16010768" author="girishkuks" created="Mon, 15 May 2017 16:13:18 +0000"  >&lt;p&gt;Is there any resolution to this, we are also facing similar issues in our application.&lt;/p&gt;</comment>
                            <comment id="16010800" author="garydgregory" created="Mon, 15 May 2017 16:29:30 +0000"  >&lt;p&gt;Hi Girish,&lt;/p&gt;

&lt;p&gt;Can you please try the current version 2.8.2?&lt;/p&gt;

&lt;p&gt;Are you available to investigate or provide a patch?&lt;/p&gt;

&lt;p&gt;Thank you,&lt;br/&gt;
Gary&lt;/p&gt;</comment>
                            <comment id="16011663" author="girishkuks" created="Tue, 16 May 2017 02:51:14 +0000"  >&lt;p&gt;Thanks Gary for suggesting. We are already using 2.7, however we will try with 2.8.2 as well. &lt;br/&gt;
Can you please verify our log4j2 config file below to check are there any issues which could be creating this as I understand latest log4j2 version has introduced buffersize and all which should hold data in buffer when tcpsocket connection is invalid and should send it as soon as next active tcp socket is established.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt; ?&amp;gt; 
&amp;lt;Configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;trace&quot;&lt;/span&gt; monitorInterval=&lt;span class=&quot;code-quote&quot;&gt;&quot;5&quot;&lt;/span&gt;&amp;gt;
  &amp;lt;Appenders&amp;gt;
    &amp;lt;Socket name=&lt;span class=&quot;code-quote&quot;&gt;&quot;socket&quot;&lt;/span&gt; host=&lt;span class=&quot;code-quote&quot;&gt;&quot;xxxxx&quot;&lt;/span&gt; port=&lt;span class=&quot;code-quote&quot;&gt;&quot;xxxxx&quot;&lt;/span&gt; reconnectDelayMillis=&lt;span class=&quot;code-quote&quot;&gt;&quot;30000&quot;&lt;/span&gt; immediateFail=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt; bufferedIo=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; bufferSize=&lt;span class=&quot;code-quote&quot;&gt;&quot;204800&quot;&lt;/span&gt; protocol=&lt;span class=&quot;code-quote&quot;&gt;&quot;TCP&quot;&lt;/span&gt; immediateFlush=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;PatternLayout /&amp;gt; 
    &amp;lt;/Socket&amp;gt;
    &amp;lt;Async name=&lt;span class=&quot;code-quote&quot;&gt;&quot;SplunkAsync&quot;&lt;/span&gt; bufferSize=&lt;span class=&quot;code-quote&quot;&gt;&quot;204800&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;socket&quot;&lt;/span&gt; /&amp;gt; 
    &amp;lt;/Async&amp;gt;
  &amp;lt;/Appenders&amp;gt;
  &amp;lt;Loggers&amp;gt;
    &amp;lt;Root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;warn&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;SplunkAsync&quot;&lt;/span&gt; /&amp;gt; 
    &amp;lt;/Root&amp;gt;
    &amp;lt;Logger name=&lt;span class=&quot;code-quote&quot;&gt;&quot;SplunkInfoLogger&quot;&lt;/span&gt; level=&lt;span class=&quot;code-quote&quot;&gt;&quot;info&quot;&lt;/span&gt; additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;SplunkAsync&quot;&lt;/span&gt; /&amp;gt; 
    &amp;lt;/Logger&amp;gt;
    &amp;lt;Logger name=&lt;span class=&quot;code-quote&quot;&gt;&quot;SplunkDebugLogger&quot;&lt;/span&gt; level=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug&quot;&lt;/span&gt; additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;SplunkAsync&quot;&lt;/span&gt; /&amp;gt; 
    &amp;lt;/Logger&amp;gt;
    &amp;lt;Logger name=&lt;span class=&quot;code-quote&quot;&gt;&quot;SplunkWarnLogger&quot;&lt;/span&gt; level=&lt;span class=&quot;code-quote&quot;&gt;&quot;warn&quot;&lt;/span&gt; additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;SplunkAsync&quot;&lt;/span&gt; /&amp;gt; 
    &amp;lt;/Logger&amp;gt;
  &amp;lt;/Loggers&amp;gt;
&amp;lt;/Configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16018689" author="girishkuks" created="Sun, 21 May 2017 04:27:57 +0000"  >&lt;p&gt;Any suggestions to above issue is appreciated !!!&lt;/p&gt;</comment>
                            <comment id="16090307" author="cooper6581" created="Mon, 17 Jul 2017 18:39:34 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=girishkuks&quot; class=&quot;user-hover&quot; rel=&quot;girishkuks&quot;&gt;girishkuks&lt;/a&gt; did you end up coming up with a way to solve this issue?  We are running into a similar issue and not sure the best way to proceed.&lt;/p&gt;
</comment>
                            <comment id="16090312" author="jvz" created="Mon, 17 Jul 2017 18:42:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt; has been working on a proof of concept for various appenders&apos; ability to replay log messages on failure restarts.&lt;/p&gt;</comment>
                            <comment id="16090319" author="cooper6581" created="Mon, 17 Jul 2017 18:49:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jvz&quot; class=&quot;user-hover&quot; rel=&quot;jvz&quot;&gt;jvz&lt;/a&gt; That is wonderful news.  Let me know if I can help with anything (tests / documentation / etc.).  Thanks!&lt;/p&gt;</comment>
                            <comment id="16104362" author="garydgregory" created="Fri, 28 Jul 2017 02:42:08 +0000"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;This ticket is logged against version 2.5, which is quite old. Is there any chance to get you to you to update to 2.8.2 and see what the current behavior is for you? Any changes would be in the upcoming 2.9.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16105375" author="cooper6581" created="Fri, 28 Jul 2017 17:57:14 +0000"  >&lt;p&gt;I&apos;m still able to duplicate with 2.8.2.  From what I can tell, this is the expected behavior.  Maybe this is more of a feature request than a bug.  We have a centralized syslog endpoint that could go down due to network maintenance.  Ideally, I would like to be able to configure a ring buffer that could hold N log events or N bytes.  If writing to the socket fails, the event would be appended to the ring buffer.  When reconnect succeeds, the buffer would be flushed.&lt;/p&gt;

&lt;p&gt;I dumped all the things for the test to the following gist:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/cooper6581/e8e9eb32e6e13066498d68c4a8195dd7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/cooper6581/e8e9eb32e6e13066498d68c4a8195dd7&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16105465" author="garydgregory" created="Fri, 28 Jul 2017 18:39:17 +0000"  >&lt;p&gt;I&apos;ll look over the weekend if I can update this Appender in the same manner as the JMS Appender now better handles a server going up and down.&lt;/p&gt;</comment>
                            <comment id="16106063" author="jira-bot" created="Sat, 29 Jul 2017 07:54:20 +0000"  >&lt;p&gt;Commit 83b173fe46901531482f0fbe3f13bd31a3f8ddb5 in logging-log4j-tools&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j-tools.git;h=83b173f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j-tools.git;h=83b173f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1311&quot; title=&quot;SocketAppender will lose several events after re-connection to server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1311&quot;&gt;&lt;del&gt;LOG4J2-1311&lt;/del&gt;&lt;/a&gt; SocketAppender will lose several events after&lt;br/&gt;
re-connection to server.&lt;/p&gt;</comment>
                            <comment id="16106064" author="jira-bot" created="Sat, 29 Jul 2017 07:55:23 +0000"  >&lt;p&gt;Commit a5f3b03aa1f0ab9f301a830371544064aa5e4c3d in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=a5f3b03&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=a5f3b03&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1311&quot; title=&quot;SocketAppender will lose several events after re-connection to server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1311&quot;&gt;&lt;del&gt;LOG4J2-1311&lt;/del&gt;&lt;/a&gt; SocketAppender will lose several events after&lt;br/&gt;
re-connection to server.&lt;/p&gt;</comment>
                            <comment id="16106065" author="garydgregory" created="Sat, 29 Jul 2017 07:59:00 +0000"  >&lt;p&gt;In git master. Please verify and close.&lt;/p&gt;

&lt;p&gt;The solution I implemented is the same as in the recently reworked JMS Appender.&lt;/p&gt;

&lt;p&gt;When the Appender&apos;s manager detects a communication, and reconnection is enabled, the manager tries to immediately reconnect and resend. If that fails, then the reconnect thread keeps on running and an exception is thrown. &lt;/p&gt;

&lt;p&gt;This is different from the previous behavior which only started the reconnect thread but did not try to resend the current event being processed. &lt;/p&gt;

&lt;p&gt;Note that this solution does not use a cyclic buffer or LMAX ring buffer.&lt;/p&gt;</comment>
                            <comment id="16109279" author="cooper6581" created="Tue, 1 Aug 2017 16:53:36 +0000"  >&lt;p&gt;Unfortunately it seems that a log has a chance of being lost.  The outputStream can be flushed without throwing an exception even when the server on the remote end has terminated the connection (this was a surprise to me).&lt;/p&gt;

&lt;p&gt;After doing some research yesterday, it seems the only way to detect a remote server has terminated the connection is to get the inputStream from the socket and see if reading from it returns -1.&lt;/p&gt;

&lt;p&gt;Here is a gist with a really basic test program and a crude patch for firing a thread that blocks reading from the socket&apos;s inputStream:  &lt;a href=&quot;https://gist.github.com/cooper6581/55a72b8c69e8b88fe7965af75e0979f5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/cooper6581/55a72b8c69e8b88fe7965af75e0979f5&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When running against master, the test program would lose a single log line before getting an IOException on write / flush to trigger the reconnect.&lt;/p&gt;
</comment>
                            <comment id="16834746" author="post-prime" created="Tue, 7 May 2019 13:14:39 +0000"  >&lt;p&gt;I don&apos;t understand why this bug is marked as resolved because the issue is not fixed.&lt;/p&gt;

&lt;p&gt;See related ticket :&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1918&quot; title=&quot;Issues with log4j2 socket appender - Logs are lost when target application closes the tcp connection after idle time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1918&quot;&gt;&lt;del&gt;LOG4J2-1918&lt;/del&gt;&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;As stated by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cooper6581&quot; class=&quot;user-hover&quot; rel=&quot;cooper6581&quot;&gt;cooper6581&lt;/a&gt;, the proposed workaround by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt; is not enough. There are still some messages lost&#160;when&#160;the connection&#160;is closed by&#160;the remote host.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cooper6581&quot; class=&quot;user-hover&quot; rel=&quot;cooper6581&quot;&gt;cooper6581&lt;/a&gt; proposal sounds good to me (checking if the reading from the inputstream return -1) + buffering logs until the connection is established again.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16834755" author="ralph.goers@dslextreme.com" created="Tue, 7 May 2019 13:26:06 +0000"  >&lt;p&gt;I ran into this when testing support for various methods of logging from a Docker container. This issue cannot be resolved. The problem is baked into how TCP works. The socket appender sends events that the OS tells us were accepted OK but they might not actually be delivered to the target endpoint right away - they might be buffered by the OS. The client only knows that the remote server is down when it gets an error from the operating system. Since no error is thrown there is no way for the SocketAppender to know it wasn&apos;t successfully sent.&#160;&lt;/p&gt;

&lt;p&gt;The only way to fix this is to use a protocol that sends acknowledgements, such as what Flume does. If you need guaranteed delivery of events you have to use something like Flume or Kafka.&lt;/p&gt;

&lt;p&gt;This issue really needs to be closed and marked as can&apos;t fix. This made me realize though that the documentation on the SocketAppender does not cover this issue so I will make sure the documentation is updated.&lt;/p&gt;</comment>
                            <comment id="16834760" author="garydgregory" created="Tue, 7 May 2019 13:30:47 +0000"  >&lt;p&gt;Also as an alternative: Use a JMS appender with a provider configured to guarantee delivery.&lt;/p&gt;</comment>
                            <comment id="16834761" author="post-prime" created="Tue, 7 May 2019 13:32:18 +0000"  >&lt;p&gt;Well, thank you for this&#160;neat response &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ralph.goers%40dslextreme.com&quot; class=&quot;user-hover&quot; rel=&quot;ralph.goers@dslextreme.com&quot;&gt;ralph.goers@dslextreme.com&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Also, I appreciate your recommendations.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16834762" author="post-prime" created="Tue, 7 May 2019 13:32:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&#160;ok, thank you as well.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13073682">LOG4J2-1918</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 28 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ue3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>