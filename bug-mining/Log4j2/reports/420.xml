<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:33:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-886]  Not serializing the exception or ThreadContext (MDC) </title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-886</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Not serializing the exception or ThreadContext (MDC) into the serialized LogEvent object when using the SerializedLayout for the Socket appender.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12750416">LOG4J2-886</key>
            <summary> Not serializing the exception or ThreadContext (MDC) </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mcelano">Mark Celano</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Oct 2014 18:40:55 +0000</created>
                <updated>Tue, 28 Oct 2014 13:06:01 +0000</updated>
                            <resolved>Tue, 28 Oct 2014 13:06:01 +0000</resolved>
                                    <version>2.1</version>
                                                    <component>Appenders</component>
                    <component>Layouts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14183392" author="garydgregory" created="Fri, 24 Oct 2014 20:06:51 +0000"  >&lt;p&gt;Do you have a stack trace for an exception or is there a behavior you&apos;re not expecting?&lt;/p&gt;</comment>
                            <comment id="14183420" author="ralph.goers@dslextreme.com" created="Fri, 24 Oct 2014 20:27:11 +0000"  >&lt;p&gt;Or better yet, a sample app that demonstrates the problem?  &lt;/p&gt;

&lt;p&gt;In looking at the code the exception and thread context should be present when the LogEvent is serialized.&lt;/p&gt;</comment>
                            <comment id="14183421" author="garydgregory" created="Fri, 24 Oct 2014 20:30:27 +0000"  >&lt;p&gt;Please see the class org.apache.logging.log4j.core.appender.SocketAppenderTest in the Core module in the git master branch. I just added a ThreadContext key-value pair and the test passes. Can you edit the test and attache a patch to show your error?&lt;/p&gt;</comment>
                            <comment id="14185131" author="mcelano" created="Mon, 27 Oct 2014 13:46:01 +0000"  >&lt;p&gt;  Please add the following test case to the org.apache.logging.log4j.core.appender.SocketAppenderTest&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testPropertyAppender() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        org.apache.logging.log4j.Logger LOG2 = org.apache.logging.log4j.LogManager.getLogger(SocketAppenderTest.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName());

        &lt;span class=&quot;code-comment&quot;&gt;// NDC Stack - Nested Diagnostic Context
&lt;/span&gt;        org.apache.logging.log4j.ThreadContext.push(&lt;span class=&quot;code-quote&quot;&gt;&quot;NDC: &quot;&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&quot;Message&quot;&lt;/span&gt;);

        &lt;span class=&quot;code-comment&quot;&gt;// MDC Stack - Mapped Diagnostic Context
&lt;/span&gt;        org.apache.logging.log4j.ThreadContext.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;MDC&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;);

        LOG2.fatal(&lt;span class=&quot;code-quote&quot;&gt;&quot;fatal message&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(&lt;span class=&quot;code-quote&quot;&gt;&quot;fatal occurred&quot;&lt;/span&gt;));
        LogEvent event = list.poll(3, TimeUnit.SECONDS);

        assertNotNull(event.getContextStack());
        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;NDC: Message&quot;&lt;/span&gt;, event.getContextStack().pop());
        assertNotNull(event.getThrown());
        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;fatal occured&quot;&lt;/span&gt;, event.getThrown().getMessage());
        assertNotNull(event.getContextMap());
        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;, event.getContextMap().get(&lt;span class=&quot;code-quote&quot;&gt;&quot;MDC&quot;&lt;/span&gt;));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;log4j2.xml:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Appenders&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;STDOUT&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d %p %l %m%n&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Console&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Socket name=&lt;span class=&quot;code-quote&quot;&gt;&quot;LF5_SOCKET&quot;&lt;/span&gt; host=&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt; port=&lt;span class=&quot;code-quote&quot;&gt;&quot;8199&quot;&lt;/span&gt; protocol=&lt;span class=&quot;code-quote&quot;&gt;&quot;TCP&quot;&lt;/span&gt; reconnectionDelay=&lt;span class=&quot;code-quote&quot;&gt;&quot;5000&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;SerializedLayout/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Socket&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Appenders&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Loggers&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;trace&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;STDOUT&quot;&lt;/span&gt; level=&lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;LF5_SOCKET&quot;&lt;/span&gt; level=&lt;span class=&quot;code-quote&quot;&gt;&quot;DEBUG&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Root&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Loggers&amp;gt;&lt;/span&gt;

&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Configuration&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14185160" author="garydgregory" created="Mon, 27 Oct 2014 14:11:30 +0000"  >&lt;p&gt;What does the test failure look like in &lt;em&gt;your&lt;/em&gt; environment?&lt;/p&gt;

&lt;p&gt;BTW, if you want to provide a change, please attach a diff file.  Adding the test method you provided does not work because you also provide a config file. The test class uses dynamic ports and a programmatic configuration.&lt;/p&gt;

&lt;p&gt;Can you reproduce the problem with a patch or at least provide a stack trace or better explanation?&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="14185166" author="mcelano" created="Mon, 27 Oct 2014 14:16:05 +0000"  >&lt;p&gt;The object is null thus this assert fails:  assertNotNull(event.getThrown());  as well as assertEquals(&quot;value&quot;, event.getContextMap().get(&quot;MDC&quot;)); as key is not present in map.&lt;/p&gt;</comment>
                            <comment id="14185177" author="mcelano" created="Mon, 27 Oct 2014 14:27:10 +0000"  >&lt;p&gt;No exception is thrown here.  This issue is that the exception contained within the log message is not sent to the socket server, nor is the MDC map.&lt;/p&gt;

&lt;p&gt;To run the test case method provided you will need to place the log4j2.xml in the class path.&lt;/p&gt;</comment>
                            <comment id="14185203" author="garydgregory" created="Mon, 27 Oct 2014 14:48:22 +0000"  >&lt;p&gt;In your test, this will not work as you expect:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.logging.log4j.ThreadContext.getContext().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;MDC&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please see the Javadoc for ThreadContext.getContext().&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="14185209" author="garydgregory" created="Mon, 27 Oct 2014 14:53:54 +0000"  >&lt;p&gt;Also read the Javadocs for &lt;tt&gt;org.apache.logging.log4j.core.impl.ThrowableProxy&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;IOW, the behavior is expected.&lt;/p&gt;

&lt;p&gt;If you want to address the TODO in the Javadoc, feel free to provide a patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14185455" author="mcelano" created="Mon, 27 Oct 2014 17:25:39 +0000"  >&lt;p&gt;I have corrected the code snippet above for the test case for the MDC and agree this works as expected:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// MDC Stack - Mapped Diagnostic Context
&lt;/span&gt;        org.apache.logging.log4j.ThreadContext.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;MDC&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Issue (maybe a TODO in ThrowableProxy) still surrounding the lack of the throwable within the LogEvent exist within the SocketAppender.  Can you explain why this is the case since in other appenders such as the console appender the thowable arrives? &lt;/p&gt;</comment>
                            <comment id="14185522" author="ralph.goers@dslextreme.com" created="Mon, 27 Oct 2014 18:04:05 +0000"  >&lt;p&gt;The SerializedLayout is a special case since the events are being serialized to be sent to a remote system. One would never expect the ConsoleAppender to use the SerializedLayout.&lt;/p&gt;

&lt;p&gt;There are tools, such as Lillith - &lt;a href=&quot;http://lilith.huxhorn.de/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://lilith.huxhorn.de/&lt;/a&gt; - that allow events to be sent to a generic log reporting tool.  Since ThrowableProxy is a Log4j class it should always be able to be deserialized. But if that tool does not have the Class object for the actual exception that was thrown it will not be able to deserialize it, but it will still have access to all the information about the exception and the event via the getThrownProxy method.&lt;/p&gt;</comment>
                            <comment id="14186780" author="mcelano" created="Tue, 28 Oct 2014 13:01:01 +0000"  >&lt;p&gt;Ralph thank you for the comment, as this helps but I have included the core as part of the lilb for a tool similar to Lillith, that is &lt;a href=&quot;http://plugins.jetbrains.com/plugin/13?pr=idea&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Log4JPlugin for IntelliJ&lt;/a&gt;.  The ThrowableProxy contains the mesaage (getMessage), and stackTrace (getExtendedStackTrace), but is returning null for the thowable (getThorwable) and this is where I got thrown, but I do see now that the throwable object is transient, so this is by design.&lt;/p&gt;</comment>
                            <comment id="14186786" author="mcelano" created="Tue, 28 Oct 2014 13:06:01 +0000"  >&lt;p&gt;ThrowableProxy  returns null from deserialized form because the throwable object is transient.  The JavaDocs text is unclear: &quot;Returns: The throwable or null if this object is deserialized &lt;del&gt;from XML or JSON&lt;/del&gt;&quot; .&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21k0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>