<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:40:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2658] Exceptions during compacting in the context of RollingFileAppender are not logged</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2658</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;My customer reported that the log files of my application were consuming too much disc space. After some analysis i found out that the compacting to zip files was not applied. I need to find out why, but i am missing the needed error diagnosis messages.&lt;/p&gt;

&lt;p&gt;I use a RollingFileAppender with following configuration.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;RollingFile
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;RollingFile&quot;&lt;/span&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;${sys:logPath}/application.log&quot;&lt;/span&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;${sys:logPath}/application-%d\{yyyy-MM-dd}-%i.log.zip&quot;&lt;/span&gt;&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d\{YYYY-MM-dd HH:mm:ss.SSS &lt;span class=&quot;code-quote&quot;&gt;&apos;UTC&apos;&lt;/span&gt;XXX} [host=%X\{hostName};user=%X\{userName}] [%t] %-5level %logger\{36} - %msg%n&quot;&lt;/span&gt; /&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;Policies&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;TimeBasedTriggeringPolicy /&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;50 MB&quot;&lt;/span&gt; /&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;/Policies&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;DefaultRolloverStrategy max=&lt;span class=&quot;code-quote&quot;&gt;&quot;50&quot;&lt;/span&gt;&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;Delete basePath=&lt;span class=&quot;code-quote&quot;&gt;&quot;${sys:logPath}/&quot;&lt;/span&gt;&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;IfFileName regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;application-\d.*(\.log\.zip|\.log)&quot;&lt;/span&gt; /&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;IfLastModified age=&lt;span class=&quot;code-quote&quot;&gt;&quot;10d&quot;&lt;/span&gt; /&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;/Delete&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;/DefaultRolloverStrategy&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;/RollingFile&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;Async name=&lt;span class=&quot;code-quote&quot;&gt;&quot;File&quot;&lt;/span&gt;&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;RollingFile&quot;&lt;/span&gt; /&amp;gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &amp;lt;/Async&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;br/&gt;
Apart from the zip compression everything else works.&lt;/p&gt;

&lt;p&gt;I made some effort to reproduce the issue on my machine with debugging enabled.&lt;/p&gt;

&lt;p&gt;I found out that org.apache.logging.log4j.core.appender.rolling.action.ZipCompressAction is responsible for doing the actual zip compressing. At this point something could go wrong and an exception would be raised. But as far as i comprehend the code this exception is not handled appropriate. &lt;/p&gt;

&lt;p&gt;The org.apache.logging.log4j.core.appender.rolling.RollingFileManager executed this action during the rollover in some asyncExecutor. The actions are wrapped in the inner class RollingFileManager$AsyncAction.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
asyncExecutor.execute(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AsyncAction(descriptor.getAsynchronous(), &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The top level method org.apache.logging.log4j.core.appender.rolling.action.AbstractAction.run() catches IOExceptions as expected.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
     execute();
 } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; IOException ex) {
     reportException(ex);
 }
&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;RollingFileManager$AsyncAction does not override the method reportException(Exception) and in AbstractAction the implementation is empty.&lt;br/&gt;
&#160;&lt;br/&gt;
This leads me to assume that any IOException during zip compacting in the context of RollingFileAppender is silently ignored. &lt;/p&gt;

&lt;p&gt;I would expect that such Exception is reported and logged on WARN or ERROR level.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13246018">LOG4J2-2658</key>
            <summary>Exceptions during compacting in the context of RollingFileAppender are not logged</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ckozak">Carter Kozak</assignee>
                                    <reporter username="Christopher Roscoe">Christopher Roscoe</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Jul 2019 15:13:58 +0000</created>
                <updated>Wed, 7 Aug 2019 19:59:15 +0000</updated>
                            <resolved>Fri, 19 Jul 2019 18:06:18 +0000</resolved>
                                    <version>2.8.1</version>
                    <version>2.12.0</version>
                                    <fixVersion>2.12.1</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16888997" author="ckozak" created="Fri, 19 Jul 2019 16:03:13 +0000"  >&lt;p&gt;Ouch, that&apos;s not good, thanks for reporting!&lt;/p&gt;</comment>
                            <comment id="16889055" author="jira-bot" created="Fri, 19 Jul 2019 17:46:48 +0000"  >&lt;p&gt;Commit c97591b33024cf1a5970e4755277b6e5cd597b80 in logging-log4j2&apos;s branch refs/heads/master from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=c97591b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=c97591b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2658&quot; title=&quot;Exceptions during compacting in the context of RollingFileAppender are not logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2658&quot;&gt;&lt;del&gt;LOG4J2-2658&lt;/del&gt;&lt;/a&gt;: AbstractAction.reportException records a warning to the status logger (#293)&lt;/p&gt;
</comment>
                            <comment id="16889056" author="jira-bot" created="Fri, 19 Jul 2019 17:47:02 +0000"  >&lt;p&gt;Commit 4ab46ab8d1994a550792143c4f359558777c4922 in logging-log4j2&apos;s branch refs/heads/release-2.x from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=4ab46ab&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=4ab46ab&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2658&quot; title=&quot;Exceptions during compacting in the context of RollingFileAppender are not logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2658&quot;&gt;&lt;del&gt;LOG4J2-2658&lt;/del&gt;&lt;/a&gt;: AbstractAction.reportException records a warning to the status logger (#294)&lt;/p&gt;
</comment>
                            <comment id="16889076" author="ckozak" created="Fri, 19 Jul 2019 18:06:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Christopher+Roscoe&quot; class=&quot;user-hover&quot; rel=&quot;Christopher Roscoe&quot;&gt;Christopher Roscoe&lt;/a&gt; the fix is merged and backported to the release-2.x branch, a 2.x snapshot should be available shortly. Could you verify the fix against the snapshot build when it becomes available?&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="16890190" author="christopher roscoe" created="Mon, 22 Jul 2019 14:09:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckozak&quot; class=&quot;user-hover&quot; rel=&quot;ckozak&quot;&gt;ckozak&lt;/a&gt; I tested with the 2.12.1-SNAPSHOT. The described issue is fixed with your changes. &lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="16890559" author="ckozak" created="Tue, 23 Jul 2019 00:05:12 +0000"  >&lt;p&gt;Verified by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Christopher+Roscoe&quot; class=&quot;user-hover&quot; rel=&quot;Christopher Roscoe&quot;&gt;Christopher Roscoe&lt;/a&gt; on 2.12.1-SNAPSHOT.&lt;/p&gt;</comment>
                            <comment id="16902427" author="jira-bot" created="Wed, 7 Aug 2019 19:55:55 +0000"  >&lt;p&gt;Commit e5503d7f9f0f8059c1c83e028a54ec7d84ea112c in logging-log4j2&apos;s branch refs/heads/release-2.x from Gary Gregory&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=e5503d7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=e5503d7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2658&quot; title=&quot;Exceptions during compacting in the context of RollingFileAppender are not logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2658&quot;&gt;&lt;del&gt;LOG4J2-2658&lt;/del&gt;&lt;/a&gt; Make test OS independent.&lt;/p&gt;</comment>
                            <comment id="16902428" author="jira-bot" created="Wed, 7 Aug 2019 19:59:15 +0000"  >&lt;p&gt;Commit 3f6d702732a8553ded87fb884e4bb26935b490bf in logging-log4j2&apos;s branch refs/heads/master from Gary Gregory&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=3f6d702&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=3f6d702&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2658&quot; title=&quot;Exceptions during compacting in the context of RollingFileAppender are not logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2658&quot;&gt;&lt;del&gt;LOG4J2-2658&lt;/del&gt;&lt;/a&gt; Make test OS independent.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z04ue0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>