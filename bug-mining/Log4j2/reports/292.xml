<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:32:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-669] NPE when combining AsyncLoggerConfig with AsyncLogger</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-669</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;When all loggers are made asynchronous by setting Log4jContextSelector to &lt;tt&gt;org.apache.logging.log4j.core.async.AsyncLoggerContextSelector&lt;/tt&gt;, they produce &lt;tt&gt;RingBufferLogEvent&lt;/tt&gt; instances. These RingBufferLogEvents are mutable by design. They are used as follows:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Application calls logger.log(&quot;msg&quot;).&lt;/li&gt;
	&lt;li&gt;The AsyncLogger claims a RingBufferLogEvent and populates its fields (level, timestamp, message, etc).&lt;/li&gt;
	&lt;li&gt;The AsyncLogger then &quot;publishes&quot; the RingBufferLogEvent, to pass it to the event handler thread.&lt;/li&gt;
	&lt;li&gt;The event handler thread passes the RingBufferLogEvent to all appenders.&lt;/li&gt;
	&lt;li&gt;Finally, the event handler thread calls &lt;tt&gt;RingBufferLogEvent.clear()&lt;/tt&gt; to allow the log message to be garbage collected (&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-304&quot; title=&quot;Async Loggers cause excessive memory usage and GC pauses&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-304&quot;&gt;&lt;del&gt;LOG4J2-304&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;This last step causes problems if the log event is still being processed.&lt;/p&gt;

&lt;p&gt;To reproduce this issue, configure all loggers to be asynchronous (with the Log4jContextSelector system property), and in the configuration, have a normal (non-async) Root logger, and an AsyncLogger.&lt;br/&gt;
Be sure not to keep the default additivity=&quot;true&quot;, to ensure both the Root logger and the AsyncLogger process the events. (There may be other ways to reproduce this, but they all have to do with combining AsyncLogger with AsyncLoggerConfig.)&lt;/p&gt;

&lt;p&gt;This give the error below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2014-06-14 17:57:55,547 ERROR An exception occurred processing Appender File java.lang.NullPointerException
	at java.lang.StringBuilder.&amp;lt;init&amp;gt;(StringBuilder.java:92)
	at org.apache.logging.log4j.core.pattern.NameAbbreviator$PatternAbbreviator.abbreviate(NameAbbreviator.java:286)
	at org.apache.logging.log4j.core.pattern.NamePatternConverter.abbreviate(NamePatternConverter.java:53)
	at org.apache.logging.log4j.core.pattern.LoggerPatternConverter.format(LoggerPatternConverter.java:64)
	at org.apache.logging.log4j.core.pattern.PatternFormatter.format(PatternFormatter.java:36)
	at org.apache.logging.log4j.core.layout.PatternLayout.toSerializable(PatternLayout.java:214)
	at org.apache.logging.log4j.core.layout.PatternLayout.toSerializable(PatternLayout.java:54)
	at org.apache.logging.log4j.core.layout.AbstractStringLayout.toByteArray(AbstractStringLayout.java:46)
	at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.append(AbstractOutputStreamAppender.java:104)
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:97)
	at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:426)
	at org.apache.logging.log4j.core.async.AsyncLoggerConfig.asyncCallAppenders(AsyncLoggerConfig.java:118)
	at org.apache.logging.log4j.core.async.AsyncLoggerConfigHelper$Log4jEventWrapperHandler.onEvent(AsyncLoggerConfigHelper.java:222)
	at org.apache.logging.log4j.core.async.AsyncLoggerConfigHelper$Log4jEventWrapperHandler.onEvent(AsyncLoggerConfigHelper.java:207)
	at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:133)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;By the time the &lt;tt&gt;AsyncLoggerConfigHelper$Log4jEventWrapperHandler&lt;/tt&gt; handles the event, the original AsyncLogger has already called &lt;tt&gt;clear()&lt;/tt&gt; on the event, so the logger name has been set to null, causing the NPE above.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12721243">LOG4J2-669</key>
            <summary>NPE when combining AsyncLoggerConfig with AsyncLogger</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="rpopma">Remko Popma</reporter>
                        <labels>
                    </labels>
                <created>Sat, 14 Jun 2014 09:03:47 +0000</created>
                <updated>Sat, 14 Jun 2014 12:26:21 +0000</updated>
                            <resolved>Sat, 14 Jun 2014 11:35:01 +0000</resolved>
                                    <version>2.0-rc1</version>
                                    <fixVersion>2.0-rc2</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14031556" author="remkop@yahoo.com" created="Sat, 14 Jun 2014 11:35:01 +0000"  >&lt;p&gt;Fixed in revision 1602578.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12721239">LOG4J2-668</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399439</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wrhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399548</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>