<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:33:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-830] failure to shutdown JVM when join called on AsyncAppender thread</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-830</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I&apos;ve configured my maven project to run my small java program as part of the build process like so:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
  &amp;lt;build&amp;gt;
    &amp;lt;defaultGoal&amp;gt;clean install&amp;lt;/defaultGoal&amp;gt;
    &amp;lt;plugins&amp;gt;
      &amp;lt;plugin&amp;gt;
        &amp;lt;artifactId&amp;gt;maven-compiler-plugin&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;2.3.2&amp;lt;/version&amp;gt;
        &amp;lt;configuration&amp;gt;
          &amp;lt;source&amp;gt;1.8&amp;lt;/source&amp;gt;
          &amp;lt;target&amp;gt;1.8&amp;lt;/target&amp;gt;
        &amp;lt;/configuration&amp;gt;
      &amp;lt;/plugin&amp;gt;
      &amp;lt;plugin&amp;gt;
        &amp;lt;groupId&amp;gt;org.codehaus.mojo&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;exec-maven-plugin&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;1.3.2&amp;lt;/version&amp;gt;
        &amp;lt;executions&amp;gt;
          &amp;lt;execution&amp;gt;
            &amp;lt;phase&amp;gt;install&amp;lt;/phase&amp;gt;
            &amp;lt;goals&amp;gt;
              &amp;lt;goal&amp;gt;java&amp;lt;/goal&amp;gt;
            &amp;lt;/goals&amp;gt;
          &amp;lt;/execution&amp;gt;
        &amp;lt;/executions&amp;gt;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After adding log4j 2.0.2 maven started experiencing issues completing the build process. Luckily it has a timeout, so the only effect is a slow down of the build process, while everything else still works.&lt;br/&gt;
Also the program itself, when run outside maven, finishes without issues.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7&lt;br/&gt;
Java 8 update 20 64 &amp;amp; 32 bit&lt;/p&gt;</environment>
        <key id="12741754">LOG4J2-830</key>
            <summary>failure to shutdown JVM when join called on AsyncAppender thread</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="adamhonen">Adam Honen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Sep 2014 11:36:02 +0000</created>
                <updated>Mon, 22 Sep 2014 10:12:21 +0000</updated>
                            <resolved>Sat, 20 Sep 2014 05:00:20 +0000</resolved>
                                    <version>2.0.2</version>
                                    <fixVersion>2.1</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14135324" author="adamhonen" created="Tue, 16 Sep 2014 11:37:22 +0000"  >&lt;p&gt;Attached is an output from Maven which includes a thread dump I printed before Maven&apos;s timeout kicked in and killed the java process.&lt;/p&gt;</comment>
                            <comment id="14135387" author="remkop@yahoo.com" created="Tue, 16 Sep 2014 12:55:12 +0000"  >&lt;p&gt;Is your thread a daemon thread? The AsyncAppender thread will never exit (it runs in an eternal loop), but is a daemon thread, so if there are no other threads then the VM can exit. &lt;/p&gt;

&lt;p&gt;If your thread is a non-daemon thread then joining the AsyncAppender thread will cause it to also run forever. However, the VM cannot exit because there are still non-daemon threads running.&lt;/p&gt;</comment>
                            <comment id="14135402" author="adamhonen" created="Tue, 16 Sep 2014 13:15:39 +0000"  >&lt;p&gt;Well, it&apos;s not exactly &quot;my&quot; thread, it&apos;s maven&apos;s.&lt;br/&gt;
My thread is already dead as the main method was exited.&lt;br/&gt;
The general form of that main method before being exited is:&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
at com.bla.Main.main(Main.java:...)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
at java.lang.reflect.Method.invoke(Method.java:483)&lt;br/&gt;
at org.codehaus.mojo.exec.ExecJavaMojo$1.run(ExecJavaMojo.java:293)&lt;br/&gt;
at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;


&lt;p&gt;I guess you could argue that this is really a maven issue (of the exec Mojo), because perhaps it&apos;s not exactly a good idea to call join on some unknown thread and it might be possible to decide that if all remaining threads are daemon threads a much smaller timeout is needed to terminate the program.&lt;/p&gt;

&lt;p&gt;At the same time it might be possible to stop log4j threads based on the fact that there are no remaining loggers.&lt;br/&gt;
In my program&apos;s case only the main class had a logger and as you can see from the thread dump, the main method has already ended.&lt;/p&gt;</comment>
                            <comment id="14135411" author="remkop@yahoo.com" created="Tue, 16 Sep 2014 13:24:12 +0000"  >&lt;p&gt;I suppose the workaround is to configure your program to log synchronously. Can you try and see if that resolves the issue?&lt;/p&gt;</comment>
                            <comment id="14135509" author="adamhonen" created="Tue, 16 Sep 2014 14:19:39 +0000"  >&lt;p&gt;Yeah, without any asynchronous appenders there is no issue.&lt;/p&gt;</comment>
                            <comment id="14135560" author="remkop@yahoo.com" created="Tue, 16 Sep 2014 14:52:55 +0000"  >&lt;p&gt;Ah, good!&lt;/p&gt;

&lt;p&gt;As for the improvement that Log4j can make: currently in the main while loop in the AsyncAppender thread, InterruptedExceptions are caught and ignored. It looks like Maven(or Mojo?) tried to interrupt the thread but this was ignored. &lt;/p&gt;

&lt;p&gt;(from output.txt)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[WARNING] thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[AsyncAppender-fileAsync,5,...] was interrupted but is still alive after waiting at least 15000msecs
[WARNING] thread &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;[AsyncAppender-fileAsync,5,...] will linger despite being asked to die via interruption
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It may be better to break out of the while loop when interrupted and execute the shutdown logic that immediately follows.&lt;/p&gt;</comment>
                            <comment id="14141748" author="remkop@yahoo.com" created="Sat, 20 Sep 2014 05:00:20 +0000"  >&lt;p&gt;Fixed in master in commit e20ac291a0c65950d20de588bcfe6af0f22be2ea.&lt;br/&gt;
Please verify and close.&lt;/p&gt;</comment>
                            <comment id="14143069" author="adamhonen" created="Mon, 22 Sep 2014 10:12:21 +0000"  >&lt;p&gt;Verified - now shuts down immediately.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12669038" name="output.txt" size="9886" author="adamhonen" created="Tue, 16 Sep 2014 11:37:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 9 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i203db:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>