<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:32:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-535] Rolled log files end up in the wrong directory</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-535</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Follow-up for issue &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-531&quot; title=&quot;Rolled log files overwritten by RollingFile appender with composite time and size based policies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-531&quot;&gt;&lt;del&gt;LOG4J2-531&lt;/del&gt;&lt;/a&gt;: the main issue (rolled over archives were overwritten) was resolved but the solution brought to light another issue that is tracked here:&lt;/p&gt;

&lt;p&gt;The distribution of the log files into the folders is odd and it feels like there might be a flaw in the timestamp logic in there somewhere still.&lt;/p&gt;

&lt;p&gt;Test program to reproduce the issue:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.LogManager;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.Logger;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;LogTest {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Logger logger = LogManager.getLogger(&lt;span class=&quot;code-quote&quot;&gt;&quot;TestLogger&quot;&lt;/span&gt;);

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; i=0; ; i+=1) {
            logger.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Sequence: &quot;&lt;/span&gt; + i);
            &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(250);
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sample configuration for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-531&quot; title=&quot;Rolled log files overwritten by RollingFile appender with composite time and size based policies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-531&quot;&gt;&lt;del&gt;LOG4J2-531&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;Configuration&amp;gt;
    &amp;lt;Appenders&amp;gt;
        &amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Test&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/test.log&quot;&lt;/span&gt; filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/test/$${date:yyyyMMddHHmm}/TEST-%d{yyyyMMddHHmm}-%i.log.gz&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d %p (%t) [%c] - %m%n&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;Policies&amp;gt;
                &amp;lt;TimeBasedTriggeringPolicy /&amp;gt;
                &amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;1 KB&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;/Policies&amp;gt;
            &amp;lt;DefaultRolloverStrategy max=&lt;span class=&quot;code-quote&quot;&gt;&quot;999999&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;/RollingFile&amp;gt;
    &amp;lt;/Appenders&amp;gt;
    &amp;lt;Loggers&amp;gt;
        &amp;lt;Root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;Test&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;/Root&amp;gt;
    &amp;lt;/Loggers&amp;gt;
&amp;lt;/Configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I kicked off the test run at &lt;tt&gt;14:29:11&lt;/tt&gt; using my example setup from the first post above more or less as is - but with a more sensible &lt;tt&gt;max=99&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The initial folder created was &lt;tt&gt;201402101429&lt;/tt&gt; and contained 27 numbered files prefixed &lt;tt&gt;TEST-201402101429-&lt;/tt&gt;. Numbers 1-12 contained 16 log lines each with timestamps &lt;tt&gt;14:29:11,667&lt;/tt&gt; to &lt;tt&gt;14:29:59,649&lt;/tt&gt;, number 13 a single log line with timestamp &lt;tt&gt;14:29:59,899&lt;/tt&gt;, and numbers 14-27 again contain 16 lines each with timestamps &lt;tt&gt;14:30:00,164&lt;/tt&gt; to &lt;tt&gt;14:30:56,155&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The second folder created was &lt;tt&gt;201402101430&lt;/tt&gt; and contained 15 numbered files. The first file contained 15 log lines with timestamps &lt;tt&gt;14:30:56,405&lt;/tt&gt; to &lt;tt&gt;14:30:59,919&lt;/tt&gt;. The subsequent files contained 16 log lines each with timestamps &lt;tt&gt;14:31:00,170&lt;/tt&gt; to &lt;tt&gt;14:31:56,123&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The third folder created was &lt;tt&gt;201402101431&lt;/tt&gt;. The first file contained 15 log lines with timestamps &lt;tt&gt;14:31:56,373&lt;/tt&gt; to &lt;tt&gt;14:31:59,886&lt;/tt&gt;. The subsequent files contained 16 log lines each with timestamps from &lt;tt&gt;14:32:00,136&lt;/tt&gt; onwards.&lt;/p&gt;

&lt;p&gt;So in summary after the first minute the majority of log lines from minute X end up in the folder for minute X-1. The exception are the last file of lines which end up in the correct folder.&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;This happens with longer rollover periods as well:&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Sample configuration based on that for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-531&quot; title=&quot;Rolled log files overwritten by RollingFile appender with composite time and size based policies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-531&quot;&gt;&lt;del&gt;LOG4J2-531&lt;/del&gt;&lt;/a&gt;, adjusted to roll every hour and every 64kb (i.e. expect similar number of files per folder):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Configuration&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Appenders&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Test&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/test.log&quot;&lt;/span&gt; filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/test/$${date:yyyyMMddHH}/TEST-%d{yyyyMMddHH}-%i.log.gz&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d %p (%t) [%c] - %m%n&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Policies&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;TimeBasedTriggeringPolicy /&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;64 KB&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Policies&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;DefaultRolloverStrategy max=&lt;span class=&quot;code-quote&quot;&gt;&quot;99&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/RollingFile&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Appenders&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Loggers&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;debug&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;Test&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Root&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Loggers&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Configuration&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running this overnight gave a similar pattern, e.g. the folder for &lt;tt&gt;2014021100&lt;/tt&gt; contains one file with timestamps &lt;tt&gt;00:59:42,836&lt;/tt&gt; to &lt;tt&gt;00:59:59,851&lt;/tt&gt;, and then 15 others covering timestamps &lt;tt&gt;01:00:00,101&lt;/tt&gt; to &lt;tt&gt;01:59:24,196&lt;/tt&gt;. Only the last file&apos;s worth for each hour (the one rotated based on time) is in the correct folder, and the rest (rotated based on size) are in the previous hour&apos;s folder.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 12.04 and 13.04, java version &quot;1.7.0_51&quot;&lt;/p&gt;</environment>
        <key id="12694460">LOG4J2-535</key>
            <summary>Rolled log files end up in the wrong directory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="rpopma">Remko Popma</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Feb 2014 10:47:10 +0000</created>
                <updated>Sat, 7 Jun 2014 22:45:02 +0000</updated>
                            <resolved>Sat, 7 Jun 2014 22:45:02 +0000</resolved>
                                    <version>2.0-rc1</version>
                                    <fixVersion>2.0-rc2</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14019451" author="ralph.goers@dslextreme.com" created="Fri, 6 Jun 2014 00:24:47 +0000"  >&lt;p&gt;I have run your test and it definitely is not behaving as you would like.&lt;/p&gt;</comment>
                            <comment id="14019509" author="ralph.goers@dslextreme.com" created="Fri, 6 Jun 2014 02:24:05 +0000"  >&lt;p&gt;When a time based rollover occurs the time is supposed to be for the previous time unit (in this case a second) since all the data would be for that time frame.  from what I can tell this is working properly.&lt;/p&gt;

&lt;p&gt;When a size based rollover occurs it just takes the current filename and increments the counter. This causes a file to be created with a name containing the previous time unit and the counter incremented.  This is really incorrect as the data is for the current time period.&lt;/p&gt;</comment>
                            <comment id="14021004" author="ralph.goers@dslextreme.com" created="Sat, 7 Jun 2014 22:45:02 +0000"  >&lt;p&gt;The size based triggering policy now causes the file time to update which now seems to have the test program behaving correctly. Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12693898">LOG4J2-531</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>372968</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1s9wn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>373270</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>