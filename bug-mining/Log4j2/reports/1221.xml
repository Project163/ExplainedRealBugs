<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:39:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2312] Using async appender with json layout causes only the message to be written</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2312</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;When using the async appender combined with the JsonLayout, you only get the results of the message being written to the appender.&lt;br/&gt;
&#160;&lt;br/&gt;
I took a look at it seems like this is because RingBufferLogEvent implements ReusableMessage which is where jackson gets the MessageSerializer, whereas the non async LogEvent doesn&apos;t, so it gets the BeanSerializer&lt;/p&gt;

&lt;p&gt;Attached are traces, both of which originating from the MessageSerializer.serialize method&lt;/p&gt;</description>
                <environment></environment>
        <key id="13150869">LOG4J2-2312</key>
            <summary>Using async appender with json layout causes only the message to be written</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ckozak">Carter Kozak</assignee>
                                    <reporter username="falmarri">David Knapp</reporter>
                        <labels>
                    </labels>
                <created>Sun, 8 Apr 2018 23:39:15 +0000</created>
                <updated>Tue, 3 Jul 2018 19:37:49 +0000</updated>
                            <resolved>Tue, 3 Jul 2018 19:37:49 +0000</resolved>
                                                    <fixVersion>2.11.1</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16452748" author="andrew.oberstar" created="Wed, 25 Apr 2018 17:46:00 +0000"  >&lt;p&gt;I&apos;ve run into the same issue (I&apos;m using 2.11.0). If I use&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;-Dlog4j2.contextSelector=org.apache.logging.log4j.core.async.AsyncLoggerContextSelector&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;My logs only contain:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;&quot;My message&quot;&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If I don&apos;t use the aync context selector:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;{&lt;br/&gt;
&#160; &quot;thread&quot; : &quot;main&quot;,&lt;br/&gt;
&#160; &quot;level&quot; : &quot;INFO&quot;,&lt;br/&gt;
&#160; &quot;loggerName&quot; : &quot;com.example.Main&quot;,&lt;br/&gt;
&#160; &quot;message&quot; : &quot;My message&quot;,&lt;br/&gt;
&#160; &quot;endOfBatch&quot; : false,&lt;br/&gt;
&#160; &quot;loggerFqcn&quot; : &quot;org.apache.logging.log4j.spi.AbstractLogger&quot;,&lt;br/&gt;
&#160; &quot;instant&quot; : &lt;/p&gt;
{
&#160;&#160;&#160; &quot;epochSecond&quot; : 1524677715,
&#160;&#160;&#160; &quot;nanoOfSecond&quot; : 883000000
&#160; }
&lt;p&gt;,&lt;br/&gt;
&#160; &quot;contextMap&quot; : { },&lt;br/&gt;
&#160; &quot;threadId&quot; : 1,&lt;br/&gt;
&#160; &quot;threadPriority&quot; : 5&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16531537" author="githubbot" created="Tue, 3 Jul 2018 15:17:20 +0000"  >&lt;p&gt;GitHub user cakofony opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/187&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/187&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2312&quot; title=&quot;Using async appender with json layout causes only the message to be written&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2312&quot;&gt;&lt;del&gt;LOG4J2-2312&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2341&quot; title=&quot;JsonLayout not working with AsyncLoggerContextSelector in 2.11.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2341&quot;&gt;&lt;del&gt;LOG4J2-2341&lt;/del&gt;&lt;/a&gt; Fix jackson layout with async loggers&lt;/p&gt;

&lt;p&gt;    AsyncLoggerContextSelector RingBufferLogEvents were not properly&lt;br/&gt;
    handled by the jackson layout. Currently the jackson layout&lt;br/&gt;
    implementation requires Log4jLogEvent instances, so we must&lt;br/&gt;
    convert all other LogEvent implementations into these.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/cakofony/logging-log4j2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/cakofony/logging-log4j2&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2312&quot; title=&quot;Using async appender with json layout causes only the message to be written&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2312&quot;&gt;&lt;del&gt;LOG4J2-2312&lt;/del&gt;&lt;/a&gt;_&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2341&quot; title=&quot;JsonLayout not working with AsyncLoggerContextSelector in 2.11.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2341&quot;&gt;&lt;del&gt;LOG4J2-2341&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/187.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/187.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #187&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit fd1006b2f26d2c3860ddd907dc8ac9ba7e7239f6&lt;br/&gt;
Author: Carter Kozak &amp;lt;ckozak@...&amp;gt;&lt;br/&gt;
Date:   2018-07-03T15:13:34Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2312&quot; title=&quot;Using async appender with json layout causes only the message to be written&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2312&quot;&gt;&lt;del&gt;LOG4J2-2312&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2341&quot; title=&quot;JsonLayout not working with AsyncLoggerContextSelector in 2.11.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2341&quot;&gt;&lt;del&gt;LOG4J2-2341&lt;/del&gt;&lt;/a&gt; Fix jackson layout with async loggers&lt;/p&gt;

&lt;p&gt;    AsyncLoggerContextSelector RingBufferLogEvents were not properly&lt;br/&gt;
    handled by the jackson layout. Currently the jackson layout&lt;br/&gt;
    implementation requires Log4jLogEvent instances, so we must&lt;br/&gt;
    convert all other LogEvent implementations into these.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16531548" author="githubbot" created="Tue, 3 Jul 2018 15:21:53 +0000"  >&lt;p&gt;Github user cakofony commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/187#discussion_r199848400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/187#discussion_r199848400&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: log4j-layout-jackson-json/pom.xml &amp;#8212;&lt;br/&gt;
    @@ -55,6 +55,11 @@&lt;br/&gt;
           &amp;lt;type&amp;gt;test-jar&amp;lt;/type&amp;gt;&lt;br/&gt;
           &amp;lt;version&amp;gt;${project.version}&amp;lt;/version&amp;gt;&lt;br/&gt;
         &amp;lt;/dependency&amp;gt;&lt;br/&gt;
    +    &amp;lt;dependency&amp;gt;&lt;br/&gt;
    +      &amp;lt;groupId&amp;gt;com.lmax&amp;lt;/groupId&amp;gt;&lt;br/&gt;
    +      &amp;lt;artifactId&amp;gt;disruptor&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
    +      &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;&lt;br/&gt;
    +    &amp;lt;/dependency&amp;gt;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Required to construct a RingBufferLogEvent&lt;/p&gt;</comment>
                            <comment id="16531780" author="jira-bot" created="Tue, 3 Jul 2018 18:31:04 +0000"  >&lt;p&gt;Commit 34cc745705b0c33d79ef326032edf9cb212fc26f in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckozak&quot; class=&quot;user-hover&quot; rel=&quot;ckozak&quot;&gt;ckozak&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=34cc745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=34cc745&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2312&quot; title=&quot;Using async appender with json layout causes only the message to be written&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2312&quot;&gt;&lt;del&gt;LOG4J2-2312&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2341&quot; title=&quot;JsonLayout not working with AsyncLoggerContextSelector in 2.11.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2341&quot;&gt;&lt;del&gt;LOG4J2-2341&lt;/del&gt;&lt;/a&gt; Fix jackson layout with async loggers&lt;/p&gt;

&lt;p&gt;AsyncLoggerContextSelector RingBufferLogEvents were not properly&lt;br/&gt;
handled by the jackson layout. Currently the jackson layout&lt;br/&gt;
implementation requires Log4jLogEvent instances, so we must&lt;br/&gt;
convert all other LogEvent implementations into these.&lt;/p&gt;

&lt;p&gt;This closes #187&lt;/p&gt;</comment>
                            <comment id="16531782" author="githubbot" created="Tue, 3 Jul 2018 18:31:20 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/187&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/187&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16531848" author="jira-bot" created="Tue, 3 Jul 2018 19:29:07 +0000"  >&lt;p&gt;Commit b7ac37fa7a2090b978020fb15b19328bf5597039 in logging-log4j2&apos;s branch refs/heads/release-2.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckozak&quot; class=&quot;user-hover&quot; rel=&quot;ckozak&quot;&gt;ckozak&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=b7ac37f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=b7ac37f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2312&quot; title=&quot;Using async appender with json layout causes only the message to be written&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2312&quot;&gt;&lt;del&gt;LOG4J2-2312&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2341&quot; title=&quot;JsonLayout not working with AsyncLoggerContextSelector in 2.11.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2341&quot;&gt;&lt;del&gt;LOG4J2-2341&lt;/del&gt;&lt;/a&gt; Fix jackson layout with async loggers&lt;/p&gt;

&lt;p&gt;AsyncLoggerContextSelector RingBufferLogEvents were not properly&lt;br/&gt;
handled by the jackson layout. Currently the jackson layout&lt;br/&gt;
implementation requires Log4jLogEvent instances, so we must&lt;br/&gt;
convert all other LogEvent implementations into these.&lt;/p&gt;

&lt;p&gt;This closes #187&lt;/p&gt;</comment>
                            <comment id="16531855" author="ckozak" created="Tue, 3 Jul 2018 19:37:49 +0000"  >&lt;p&gt;This is fixed on master and the release-2.x branches. I have reproduced the failure with a unit test and fixed it.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13161328">LOG4J2-2341</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12918004" name="async_trace.txt" size="3304" author="falmarri" created="Sun, 8 Apr 2018 23:41:06 +0000"/>
                            <attachment id="12918003" name="synchronous_trace.txt" size="5555" author="falmarri" created="Sun, 8 Apr 2018 23:40:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3sa7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>