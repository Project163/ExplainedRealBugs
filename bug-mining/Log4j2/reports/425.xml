<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:33:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-893] NullPointerException on core.Logger$PrivateConfig.filter() when mapping JUL to Log4j2</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-893</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I have a project in scala loading log4j2-core, api, jul, slf4j and jcl and try to map the JUL to Log4J by using the following java parameter:&lt;/p&gt;

&lt;p&gt;-Djava.util.logging.manager=org.apache.logging.log4j.jul.LogManager&lt;/p&gt;

&lt;p&gt;I also use Twitter Server which uses JUL to log it&apos;s messages.&lt;/p&gt;

&lt;p&gt;When I start up the server with the JUL mapping for Log4J I get a NullPointerException.&lt;/p&gt;

&lt;p&gt;The exception and code is here:&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/mmlac/2e2b38dc3fbd0e5b0da4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/mmlac/2e2b38dc3fbd0e5b0da4&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Might be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-234&quot; title=&quot;RegexFilter crashes as context-wide filter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-234&quot;&gt;&lt;del&gt;LOG4J2-234&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR StatusLogger No log4j2 configuration file found. Using default configuration: logging only errors to the console.
Exception in thread &quot;main&quot; java.lang.ExceptionInInitializerError
at com.twitter.server.Admin$class.$init$(Admin.scala:13)
at foo.bar.Foo$.&amp;lt;init&amp;gt;(Foo.scala:8)
at foo.bar.Foo$.&amp;lt;clinit&amp;gt;(Foo.scala)
at foo.bar.Foo.main(Foo.scala)
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.lang.reflect.Method.invoke(Method.java:606)
at com.intellij.rt.execution.application.AppMain.main(AppMain.java:134)
Caused by: java.lang.NullPointerException
at org.apache.logging.log4j.core.Logger$PrivateConfig.filter(Logger.java:301)
at org.apache.logging.log4j.core.Logger.isEnabled(Logger.java:122)
at org.apache.logging.log4j.spi.ExtendedLoggerWrapper.isEnabled(ExtendedLoggerWrapper.java:87)
at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:699)
at org.apache.logging.log4j.jul.WrappedLogger.log(WrappedLogger.java:50)
at org.apache.logging.log4j.jul.ApiLogger.log(ApiLogger.java:106)
at com.twitter.finagle.util.LoadService$$anonfun$apply$9.apply(LoadService.scala:186)
at com.twitter.finagle.util.LoadService$$anonfun$apply$9.apply(LoadService.scala:181)
at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:244)
at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:244)
at scala.collection.mutable.ResizableArray$class.foreach(ResizableArray.scala:59)
at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:47)
at scala.collection.TraversableLike$class.map(TraversableLike.scala:244)
at scala.collection.AbstractTraversable.map(Traversable.scala:105)
at com.twitter.finagle.util.LoadService$.apply(LoadService.scala:181)
at com.twitter.finagle.http.HttpMuxer$.&amp;lt;init&amp;gt;(HttpMuxer.scala:118)
at com.twitter.finagle.http.HttpMuxer$.&amp;lt;clinit&amp;gt;(HttpMuxer.scala)
... 9 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Mac OSX, Scala 2.10.4, SBT 0.13, Java(TM) SE Runtime Environment (build 1.7.0_45-b18)&lt;/p&gt;</environment>
        <key id="12753891">LOG4J2-893</key>
            <summary>NullPointerException on core.Logger$PrivateConfig.filter() when mapping JUL to Log4j2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mmlac">Markus Lachinger</reporter>
                        <labels>
                    </labels>
                <created>Sat, 8 Nov 2014 05:08:59 +0000</created>
                <updated>Thu, 19 Feb 2015 21:18:52 +0000</updated>
                            <resolved>Thu, 19 Feb 2015 21:18:52 +0000</resolved>
                                    <version>2.1</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14203224" author="mmlac" created="Sat, 8 Nov 2014 05:10:45 +0000"  >&lt;p&gt;Attached is a basic project that can reproduce the error. just &apos;sbt run&apos; it.&lt;/p&gt;

&lt;p&gt;I think the issue is that in Logger, line 301, level is null, so the level.intLevel() in the return comparison fails.&lt;/p&gt;</comment>
                            <comment id="14206946" author="ggregory" created="Tue, 11 Nov 2014 19:57:24 +0000"  >&lt;p&gt;I have a fix for the NPE but it seems like something else is off. I&apos;ll test and commit tonight.&lt;/p&gt;</comment>
                            <comment id="14207007" author="garydgregory" created="Tue, 11 Nov 2014 20:38:08 +0000"  >&lt;p&gt;The NPE fix is in git. Please build from git master and test.&lt;/p&gt;</comment>
                            <comment id="14207020" author="ralph.goers@dslextreme.com" created="Tue, 11 Nov 2014 20:44:45 +0000"  >&lt;p&gt;I am not sure I agree with this fix.  It seems truly bizarre to me to log an event with no level.  If the level is null a default value should be provided. By the time the code you &quot;fixed&quot; is reached the level parameter should never be null.&lt;/p&gt;</comment>
                            <comment id="14207540" author="garydgregory" created="Wed, 12 Nov 2014 02:09:44 +0000"  >&lt;p&gt;I agree that the &quot;fix&quot; is weird. What I am trying to get to is &quot;adjust&quot; the code in a reasonable way such that user can retry and see what happens. No logging? Another NPE? A weird error? Let&apos;s find out. I have not been able to reproduce this locally mostly because I do not want to take the time to fiddle with Scala ATM.&lt;/p&gt;

&lt;p&gt;Another &quot;fix&quot; would be to have the level converter map a null level to the &lt;tt&gt;OFF&lt;/tt&gt; Level. This would allow a real level to be used in the deeper part of the code and the current fix to be removed.&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="14208326" author="garydgregory" created="Wed, 12 Nov 2014 17:50:20 +0000"  >&lt;p&gt;In the current version in git of Finagle&apos;s LoadService.scala, the statement that corresponds to:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;at com.twitter.finagle.util.LoadService$$anonfun$apply$9.apply(LoadService.scala:186)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;      DefaultLogger.log(
        Level.DEBUG,
        &quot;LoadService: loaded instance of class %s for requested service %s&quot;.format(className, ifaceName)
      )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But &lt;tt&gt;DefaultLogger&lt;/tt&gt; is not our &lt;tt&gt;ApiLogger&lt;/tt&gt;... (or is it through some Scala mapping?) so what version of Finagle do you use?&lt;/p&gt;
</comment>
                            <comment id="14211725" author="mmlac" created="Fri, 14 Nov 2014 02:25:36 +0000"  >&lt;p&gt;I use finagle 6.22.0. I think the DefaultLogger is from finagle-core/finagel/util/package.scala which maps to JUL, which in turn should map to Log4J through the JUL bridge.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/twitter/finagle/blob/84e36f37a76f488d16e18ae827d6b8fa2a8be8ef/finagle-core/src/main/scala/com/twitter/finagle/util/package.scala&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/twitter/finagle/blob/84e36f37a76f488d16e18ae827d6b8fa2a8be8ef/finagle-core/src/main/scala/com/twitter/finagle/util/package.scala&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14211730" author="garydgregory" created="Fri, 14 Nov 2014 02:32:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mmlac&quot; class=&quot;user-hover&quot; rel=&quot;mmlac&quot;&gt;mmlac&lt;/a&gt;: Can you test again with (1) the latest from git master and build the jars or (2) the current 2.1.1-SNAPHOT jars (for example &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/logging/log4j/log4j-api/2.1.1-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/logging/log4j/log4j-api/2.1.1-SNAPSHOT/&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;There is something funky going on, it looks like &lt;tt&gt;Level.DEBUG&lt;/tt&gt; evaluates to null. &lt;/p&gt;

&lt;p&gt;The current git master code should not cause an NPE, but I suspect other problems will perhaps arise.&lt;/p&gt;

&lt;p&gt;Let us know what you see.&lt;/p&gt;

&lt;p&gt;Thank you.&lt;/p&gt;</comment>
                            <comment id="14291277" author="garydgregory" created="Sun, 25 Jan 2015 21:22:32 +0000"  >&lt;p&gt;Ping?&lt;/p&gt;</comment>
                            <comment id="14317225" author="mmlac" created="Wed, 11 Feb 2015 23:43:52 +0000"  >&lt;p&gt;Looks like it is no longer failing. Tested with 2.1.1-SNAPSHOT and finagle 6.24.1-MONOCACHE  /  twitter-server 1.9&lt;/p&gt;</comment>
                            <comment id="14328145" author="garydgregory" created="Thu, 19 Feb 2015 21:18:52 +0000"  >&lt;p&gt;Resolving as fixed per user&apos;s comment.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12680361" name="breaklog4jul.zip" size="189512" author="mmlac" created="Sat, 8 Nov 2014 05:10:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2250v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>