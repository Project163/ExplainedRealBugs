<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:37:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1313] &lt;Property name=&quot;&quot; value=&quot;&quot; /&gt; not working</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1313</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;The documentation shows examples of the property tag like this (&lt;a href=&quot;http://logging.apache.org/log4j/2.x/manual/configuration.html#ConfigurationSyntax&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://logging.apache.org/log4j/2.x/manual/configuration.html#ConfigurationSyntax&lt;/a&gt;):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;Properties&amp;gt;
    &amp;lt;Property name=&quot;name1&quot;&amp;gt;value&amp;lt;/property&amp;gt;
    &amp;lt;Property name=&quot;name2&quot; value=&quot;value2&quot;/&amp;gt;
  &amp;lt;/Properties&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When using the later one with the value attribute you&apos;ll get on startup this error:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR Property contains an invalid element or attribute &quot;value&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It would be good to have the attribute support working as well, as otherwise it might happen that IDE auto formatting is line breaking an attribute. If this isn&apos;t possible please update the documentation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12948391">LOG4J2-1313</key>
            <summary>&lt;Property name=&quot;&quot; value=&quot;&quot; /&gt; not working</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="pknobel">Philipp Knobel</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Mar 2016 12:50:57 +0000</created>
                <updated>Tue, 13 Sep 2016 13:55:00 +0000</updated>
                            <resolved>Mon, 12 Sep 2016 15:14:20 +0000</resolved>
                                    <version>2.5</version>
                                    <fixVersion>2.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15187395" author="jvz" created="Wed, 9 Mar 2016 16:51:35 +0000"  >&lt;p&gt;I can&apos;t even find a test that uses that syntax, so it looks like an oversight. We&apos;ve always used the first syntax.&lt;/p&gt;</comment>
                            <comment id="15391253" author="remkop@yahoo.com" created="Mon, 25 Jul 2016 02:03:25 +0000"  >&lt;p&gt;I wonder if it is as simple as changing the current factory method parameters&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Plugin(name = &lt;span class=&quot;code-quote&quot;&gt;&quot;property&quot;&lt;/span&gt;, category = Node.CATEGORY, printObject = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Property {
    ...
    @PluginFactory
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Property createProperty(
            @PluginAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name,
            @PluginValue(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value) {
   ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to the below?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @PluginFactory
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Property createProperty(
            @PluginAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name,
            @PluginAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value) { &lt;span class=&quot;code-comment&quot;&gt;// does @PluginAttribute support both attributes and nested elements?
&lt;/span&gt;        ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15391365" author="ralph.goers@dslextreme.com" created="Mon, 25 Jul 2016 05:24:39 +0000"  >&lt;p&gt;I doubt it. &lt;/p&gt;

&lt;p&gt;First, from what I can tell the PluginValue should be using the attribute if the XML node has no value.  But it is only checking for null. I am guessing it is an empty String.  &lt;/p&gt;

&lt;p&gt;Second, I have a suspicion that &quot;value&quot; as an attribute might get treated incorrectly, but that is just based on a vague recollection.  You can certainly try it and see.  What is interesting is that although I am sure attributes can be specified as the value of an element the PluginAttributeVisitor is only looking at the attributes while PluginValueVisitor looks that the value of the node as well. This difference is why I suspect &quot;value=&quot; wouldn&apos;t work as a PluginAttribute.&lt;/p&gt;</comment>
                            <comment id="15391594" author="remkop@yahoo.com" created="Mon, 25 Jul 2016 09:27:58 +0000"  >&lt;p&gt;I think you are right about the empty string: PluginValueVisitor only checks attributes if the XML Node value is null, while XmlConfiguration will call Node.setValue() with an empty string, not null (line 299).&lt;/p&gt;

&lt;p&gt;Looks like the fix is to change PluginValueVisitor to go to the attributes if the node value is either null or empty.&lt;/p&gt;</comment>
                            <comment id="15391994" author="jvz" created="Mon, 25 Jul 2016 14:28:48 +0000"  >&lt;p&gt;You mean like a special case for attributes named &quot;value&quot;?&lt;/p&gt;</comment>
                            <comment id="15392050" author="remkop@yahoo.com" created="Mon, 25 Jul 2016 14:56:22 +0000"  >&lt;p&gt;Fixed in master.&lt;/p&gt;

&lt;p&gt;The only change required was in PluginValueVisitor to use &lt;tt&gt;Strings.isNotEmpty(node.getValue())&lt;/tt&gt; instead of just checking for null.&lt;/p&gt;

&lt;p&gt;Please verify and close.&lt;/p&gt;</comment>
                            <comment id="15477178" author="leonfin" created="Fri, 9 Sep 2016 14:27:02 +0000"  >&lt;p&gt;This caused a regression in sys properties lookup/substitution per below. I don&apos;t have permission to re-open the ticket. Maybe someone else from log4j2 dev can re-open it please. Thanks&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;From: Remko Popma &amp;lt;remko.popma@gmail.com&amp;gt;
To: Log4J Developers List &amp;lt;log4j-dev@logging.apache.org&amp;gt;
Subject: Re: &quot;sys&quot; properties lookup regression
Date: 2016-09-08 18:22 (-0400)
List: log4j-dev@logging.apache.org

Good catch!
This must be a regression caused by the change made to support value attribute in Property elements (https://issues.apache.org/jira/browse/LOG4J2-1313)

&amp;gt; On 2016/09/09, at 6:48, Leon Finker &amp;lt;leonfin@gmail.com&amp;gt; wrote:
&amp;gt; 
&amp;gt; Hi,
&amp;gt; 
&amp;gt; Testing master branch.. We have the following xml configuration:
&amp;gt; ..
&amp;gt; &amp;lt;Property name=&quot;additionalProp&quot;&amp;gt;&amp;lt;/Property&amp;gt;
&amp;gt; ..
&amp;gt; &amp;lt;RegexFilterEx regex=&quot;${sys:additionalProp}&quot; onMatch=&quot;DENY&quot;
&amp;gt;                onMismatch=&quot;ACCEPT&quot; /&amp;gt;
&amp;gt; -- or you can have &amp;lt;Property name=&quot;additionalProp&quot; /&amp;gt; doesn&apos;t matter for the issue
&amp;gt; 
&amp;gt; And assume there is no &apos;additionalProp&apos; System property set.  On master branch, ${sys:additionalProp} doesn&apos;t get resolved and remains as literal ${sys:additionalProp}. It&apos;s supposed to default to xml specified props, no? This worked up to 2.6.3.
&amp;gt; 
&amp;gt; But if I change the xml prop to be:
&amp;gt; &amp;lt;Property name=&quot;additionalProp&quot; value=&quot;&quot; /&amp;gt; 
&amp;gt; 
&amp;gt; Then ${sys:additionalProp} fallsback to xml defined prop and resolves to empty string.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15480877" author="remkop@yahoo.com" created="Sun, 11 Sep 2016 02:38:31 +0000"  >&lt;p&gt;The current logic in &lt;a href=&quot;https://github.com/apache/logging-log4j2/blob/master/log4j-core/src/main/java/org/apache/logging/log4j/core/config/plugins/visitors/PluginValueVisitor.java#L39&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PluginValueVisitor&lt;/a&gt; is&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; rawValue = Strings.isNotEmpty(node.getValue()) &lt;span class=&quot;code-comment&quot;&gt;// check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; or &quot;&quot;
&lt;/span&gt;        ? node.getValue()
        : removeAttributeValue(node.getAttributes(), &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// remove the property altogether&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, if there is no value, the property is removed. &lt;/p&gt;

&lt;p&gt;As Leon indicated, this means that when the property is defined as &lt;tt&gt;&amp;lt;Property name=&quot;additionalProp&quot;&amp;gt;&amp;lt;/Property&amp;gt;&lt;/tt&gt;, references like ${sys:additionalProp} don&apos;t get resolved and remain as literal ${sys:additionalProp}. &lt;/p&gt;

&lt;p&gt;I&apos;ve committed a failing test demonstrating the issue. (org.apache.logging.log4j.core.config.PropertyTest)&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  &amp;lt;Property name=&quot;elementKey&quot;&amp;gt;elementValue&amp;lt;/Property&amp;gt;
  &amp;lt;Property name=&quot;emptyElementKey&quot;&amp;gt;&amp;lt;/Property&amp;gt;
  &amp;lt;Property name=&quot;attributeKey&quot; value=&quot;attributeValue&quot; /&amp;gt;
  &amp;lt;Property name=&quot;attributeWithEmptyElementKey&quot; value=&quot;attributeValue2&quot;&amp;gt;&amp;lt;/Property&amp;gt;
  &amp;lt;Property name=&quot;bothElementAndAttributeKey&quot; value=&quot;attributeValue3&quot;&amp;gt;elementValue3&amp;lt;/Property&amp;gt;
...
&amp;lt;Appenders&amp;gt;
&amp;lt;List name=&quot;List&quot;&amp;gt;
  &amp;lt;PatternLayout pattern
=&quot;1=${sys:elementKey},2=${sys:emptyElementKey},3=${sys:attributeKey},4=${sys:attributeWithEmptyElementKey},5=${sys:bothElementAndAttributeKey},m=%m&quot; /&amp;gt;
&amp;lt;/List&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I tried to stop removing the attributes if the value is empty. Depending on the return value I get different incorrect results:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// option 1: replace &quot;&quot; values with &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; rawValue = Strings.isBlank(node.getValue()) ? &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; : node.getValue();

Test fails like &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;:
Expected :1=elementValue,2=,3=attributeValue,4=attributeValue2,5=attributeValue3,m=msg
Actual   :1=elementValue,2=${sys:emptyElementKey},3=${sys:attributeKey},4=${sys:attributeWithEmptyElementKey},5=elementValue3,m=msg

---------------
&lt;span class=&quot;code-comment&quot;&gt;// option 2: allow &quot;&quot; attributes 
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; rawValue = node.getValue();

Test fails like &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;:
Expected :1=elementValue,2=,3=attributeValue,4=attributeValue2,5=attributeValue3,m=msg
Actual   :1=elementValue,2=,3=,4=,5=elementValue3,m=msg

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The second failure is a more promising avenue but still has issues. This requires more plugin-fu than I can command at the moment.&lt;br/&gt;
Any plugin expert willing to take a further look?&lt;/p&gt;</comment>
                            <comment id="15482596" author="remkop@yahoo.com" created="Sun, 11 Sep 2016 23:39:51 +0000"  >&lt;p&gt;Also, what do we want an empty attribute to mean? A &lt;tt&gt;Property&lt;/tt&gt; with a &lt;tt&gt;null&lt;/tt&gt; value, a &lt;tt&gt;&quot;&quot;&lt;/tt&gt; value, or should the property be removed altogether?&lt;/p&gt;</comment>
                            <comment id="15482677" author="ralph.goers@dslextreme.com" created="Mon, 12 Sep 2016 00:52:19 +0000"  >&lt;p&gt;A property with a null value should be the same as if it wasn&apos;t specified at all. A property with an empty String should be a property with an empty String.  What I don&apos;t understand is what a property with a value attribute and a value should be.  It really isn&apos;t valid and generate an error message.&lt;/p&gt;</comment>
                            <comment id="15482751" author="remkop@yahoo.com" created="Mon, 12 Sep 2016 01:38:45 +0000"  >&lt;p&gt;When I looked at PluginValueVisitor in a debugger, I never got a null value for a property, no matter how I configured it. My question was not about the incoming value but about what the value of the resulting java &lt;tt&gt;Property&lt;/tt&gt; object should be when the configuration property is specified as:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1. &amp;lt;Property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; /&amp;gt;           --&amp;gt; result in Property with &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; value?
2. &amp;lt;Property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;&amp;gt;&amp;lt;/Property&amp;gt;  --&amp;gt; result in Property with &quot;&quot; value or &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; value?
3. &amp;lt;Property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot; /&amp;gt;  --&amp;gt; result in Property with &quot;&lt;/span&gt;&quot; value?
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15482807" author="garydgregory" created="Mon, 12 Sep 2016 02:13:57 +0000"  >&lt;p&gt;IMO:&lt;br/&gt;
1) null&lt;br/&gt;
2) &quot;&quot;&lt;br/&gt;
3) &quot;&quot;&lt;/p&gt;</comment>
                            <comment id="15483067" author="ralph.goers@dslextreme.com" created="Mon, 12 Sep 2016 04:51:27 +0000"  >&lt;p&gt;I guess I have to agree with Gary.&lt;/p&gt;

&lt;p&gt;What you didn&apos;t list was &lt;/p&gt;

&lt;p&gt;    4) &amp;lt;Property name=&quot;name&quot; value=&quot;Something&quot;&amp;gt;else&amp;lt;/Property&amp;gt;&lt;/p&gt;

&lt;p&gt;You show it up above. IMO this is an error.&lt;/p&gt;</comment>
                            <comment id="15484058" author="remkop@yahoo.com" created="Mon, 12 Sep 2016 13:07:04 +0000"  >&lt;p&gt;(Debugging out loud)&lt;br/&gt;
What is currently happening is that given this configuration:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;Configuration status=&quot;ERROR&quot;&amp;gt;
  &amp;lt;Properties&amp;gt;
    &amp;lt;Property name=&quot;emptyElementKey&quot; /&amp;gt;
    &amp;lt;Property name=&quot;emptyAttributeKey&quot; value=&quot;&quot; /&amp;gt;
    &amp;lt;Property name=&quot;emptyAttributeKey2&quot; value=&quot;&quot;&amp;gt;&amp;lt;/Property&amp;gt;
    &amp;lt;Property name=&quot;elementKey&quot;&amp;gt;elementValue&amp;lt;/Property&amp;gt;
    &amp;lt;Property name=&quot;attributeKey&quot; value=&quot;attributeValue&quot; /&amp;gt;
    &amp;lt;Property name=&quot;attributeWithEmptyElementKey&quot; value=&quot;attributeValue2&quot;&amp;gt;&amp;lt;/Property&amp;gt;
    &amp;lt;Property name=&quot;bothElementAndAttributeKey&quot; value=&quot;attributeValue3&quot;&amp;gt;elementValue3&amp;lt;/Property&amp;gt;
  &amp;lt;/Properties&amp;gt;
  &amp;lt;Appenders&amp;gt;
    &amp;lt;List name=&quot;List&quot;&amp;gt;
      &amp;lt;PatternLayout pattern=&quot;1=${sys:elementKey},2=${sys:emptyElementKey},a=${sys:emptyAttributeKey},b=${sys:emptyAttributeKey2},3=${sys:attributeKey},4=${sys:attributeWithEmptyElementKey},5=${sys:bothElementAndAttributeKey},m=%m&quot; /&amp;gt;
    &amp;lt;/List&amp;gt;
  &amp;lt;/Appenders&amp;gt;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Properties internally become represented as the following StrSubstitutor in the Configuration object:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;subst = {StrSubstitutor@1473} &quot;StrSubstitutor({date, ctx, main, env, sys, sd, java, marker, jndi, jvmrunargs, map, bundle, log4j})&quot;
 escapeChar = &apos;$&apos; 36
 prefixMatcher = {StrMatcher$StringMatcher@3436} &quot;org.apache.logging.log4j.core.lookup.StrMatcher$StringMatcher@2667f029 [$, {]&quot;
 suffixMatcher = {StrMatcher$StringMatcher@3437} &quot;org.apache.logging.log4j.core.lookup.StrMatcher$StringMatcher@67a20f67 [}]&quot;
 valueDelimiterMatcher = {StrMatcher$StringMatcher@3438} &quot;org.apache.logging.log4j.core.lookup.StrMatcher$StringMatcher@57c758ac [:, -]&quot;
 variableResolver = {Interpolator@3289} &quot;{date, ctx, main, env, sys, sd, java, marker, jndi, jvmrunargs, map, bundle, log4j}&quot;
  lookups = {HashMap@3444}  size = 13
  defaultLookup = {MapLookup@3445} 
   map = {HashMap@3491}  size = 9
    0 = {HashMap$Node@3494} &quot;elementKey&quot; -&amp;gt; &quot;elementValue&quot;
    1 = {HashMap$Node@3495} &quot;bothElementAndAttributeKey&quot; -&amp;gt; &quot;elementValue3&quot;
    2 = {HashMap$Node@3496} &quot;hostName&quot; -&amp;gt; &quot;933P66151121001&quot;
    3 = {HashMap$Node@3497} &quot;contextName&quot; -&amp;gt; &quot;org.apache.logging.log4j.core.config.PropertyTest&quot;
    4 = {HashMap$Node@3498} &quot;attributeWithEmptyElementKey&quot; -&amp;gt; &quot;attributeValue2&quot;
    5 = {HashMap$Node@3499} &quot;attributeKey&quot; -&amp;gt; &quot;attributeValue&quot;
    6 = {HashMap$Node@3500} &quot;emptyAttributeKey2&quot; -&amp;gt; 
    7 = {HashMap$Node@3501} &quot;emptyElementKey&quot; -&amp;gt; &quot;null&quot;  &amp;lt;--- note that the key is in the map with defaults but its value is null
    8 = {HashMap$Node@3502} &quot;emptyAttributeKey&quot; -&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the PatternLayout object in the Configuration object becomes &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;0 = {PatternFormatter} &lt;span class=&quot;code-quote&quot;&gt;&quot;...[converter=LiteralPatternConverter[&quot;&lt;/span&gt;literal=1=elementValue,2=${sys:emptyElementKey},a=,b=,3=attributeValue,4=attributeValue2,5=elementValue3,m=&lt;span class=&quot;code-quote&quot;&gt;&quot;,]&quot;&lt;/span&gt;
1 = {PatternFormatter} &lt;span class=&quot;code-quote&quot;&gt;&quot;...[converter=MessagePatternConverter]&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is because the StrSubstitutor&apos;s VariableResolver will return &lt;tt&gt;null&lt;/tt&gt; when resolving &quot;sys:emptyElementKey&quot;. There is no distinction between the defaultLookup map containing a null value for a key, or the key not existing at all in the defaultLookup map. In both cases the variable is not resolved and the layout pattern contains &quot;${sys:emptyElementKey}&quot;.&lt;/p&gt;

&lt;p&gt;&lt;del&gt;Long story short:&lt;/del&gt; &lt;b&gt;Conclusion:&lt;/b&gt;&lt;br/&gt;
if both the value attribute and the element value are &quot;&quot;, PluginValueVisitor returns null, and a Property object is created with a &lt;tt&gt;null&lt;/tt&gt; value. When this Property is registered in the defaultLookup map, the null value means the property is effectively &quot;undefined&quot;. One way to fix this is to modify the Property class so that &lt;tt&gt;Property::getValue&lt;/tt&gt; returns &lt;tt&gt;&quot;&quot;&lt;/tt&gt; if it was constructed with a null value. The defaultLookup map will then correctly resolve ${sys:emptyElementKey} to the empty string.&lt;/p&gt;

&lt;p&gt;In PluginValueVisitor we can log to the status logger at error level when both a &quot;value&quot; attribute and an element value are configured (see below). I don&apos;t think we should treat this as a fatal error. We should just pick one (the element value) and continue processing. In the manual we document that the element is used if both a value attribute and an element value are configured.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; visit(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Configuration configuration, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Node node, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LogEvent event,
                        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StringBuilder log) {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.annotation.value();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; elementValue = node.getValue();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; attributeValue = node.getAttributes().get(&lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; rawValue = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; neither is specified, &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Strings.isNotEmpty(elementValue)) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Strings.isNotEmpty(attributeValue)) {
                LOGGER.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Configuration contains {} with both attribute value=\&quot;&lt;/span&gt;{}\&lt;span class=&quot;code-quote&quot;&gt;&quot; AND element&quot;&lt;/span&gt; +
                                &lt;span class=&quot;code-quote&quot;&gt;&quot; value \&quot;&lt;/span&gt;{}\&lt;span class=&quot;code-quote&quot;&gt;&quot;. Please specify only one value. Using the element value.&quot;&lt;/span&gt;,
                        node.getName(), attributeValue, elementValue);
            }
            rawValue = elementValue;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Strings.isNotEmpty(attributeValue)) {
            rawValue = removeAttributeValue(node.getAttributes(), &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.substitutor.replace(event, rawValue);
        StringBuilders.appendKeyDqValue(log, name, value);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15484389" author="remkop@yahoo.com" created="Mon, 12 Sep 2016 15:14:20 +0000"  >&lt;p&gt;Fixed in master in commit 7994789.&lt;br/&gt;
Please verify and close.&lt;/p&gt;</comment>
                            <comment id="15487278" author="leonfin" created="Tue, 13 Sep 2016 13:54:39 +0000"  >&lt;p&gt;Thank you Remko! The issue I reported is fixed. Just to clarify our use case:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;Property name=&quot;nagiosIgnoreRegex&quot;&amp;gt;some known pattern to ignore here&amp;lt;/Property&amp;gt;
&amp;lt;Property name=&quot;nagiosAdditionalIgnoreRegex&quot;&amp;gt;&amp;lt;/Property&amp;gt; 

&amp;lt;NagiosAppender name=&quot;Nagios&quot; maxMessageLength=&quot;255&quot;&amp;gt;
            &amp;lt;RegexFilterEx regex=&quot;${nagiosIgnoreRegex}${sys:nagiosAdditionalIgnoreRegex}&quot; onMatch=&quot;DENY&quot; onMismatch=&quot;ACCEPT&quot; /&amp;gt;
&amp;lt;/NagiosAppender&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So we have some known errors patterns to ignore as standard across some services and then optionally services can ignore more service specific patterns by specifying System property, but if none specified it would be empty string.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uee7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>