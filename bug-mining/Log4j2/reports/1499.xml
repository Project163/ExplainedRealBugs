<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:42:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2829] TcpSocketManager.write swallows IOException when retry = false or reconnector != null</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2829</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Hi, I see very stange behavior when using tcp SocketAppender. My configuration is:&lt;/p&gt;

&lt;p&gt;&amp;lt;Socket name=&quot;auditSocket&quot; protocol=&quot;TCP&quot; host=&quot;10.8.84.194&quot; port=&quot;4587&quot; connectTimeoutMillis=&quot;10000&quot; reconnectionDelayMillis=&quot;10000&quot;&lt;br/&gt;
 immediateFail=&quot;true&quot; immediateFlush=&quot;true&quot; ignoreExceptions=&quot;false&quot; bufferedIO=&quot;false&quot;&amp;gt;&lt;/p&gt;

&lt;p&gt;After application starts and before writing any logs I simulate connection reset with:&lt;/p&gt;

&lt;p&gt;iptables -A OUTPUT -p tcp -d 10.8.84.194 --dport 4587 -j REJECT --reject-with tcp-reset&lt;/p&gt;

&lt;p&gt;Now the strange part:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;First log is written to output stream successfully (but nothing actually gets sent)&lt;/li&gt;
	&lt;li&gt;Second log throws IOException on outputstream write, this gets handled with a reconnection attempt (which fails) and result is AppenderLoggingException - this is what I expect because I&apos;m using a failover appender to route the log into file.&lt;/li&gt;
	&lt;li&gt;Third and subsequent log attempts also fail due to IOException on outputstream write BUT no AppenderLoggingException is raised - reconnector is not null at this point and IOException gets swallowed up.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m using log4j2 2.12.1&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13300830">LOG4J2-2829</key>
            <summary>TcpSocketManager.write swallows IOException when retry = false or reconnector != null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="okanarbik">Mihail</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Apr 2020 15:38:28 +0000</created>
                <updated>Tue, 2 Nov 2021 18:55:05 +0000</updated>
                            <resolved>Sun, 24 Oct 2021 19:30:32 +0000</resolved>
                                    <version>2.12.1</version>
                                    <fixVersion>2.15.0</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17405256" author="wjzych" created="Thu, 26 Aug 2021 14:25:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=okanarbik&quot; class=&quot;user-hover&quot; rel=&quot;okanarbik&quot;&gt;okanarbik&lt;/a&gt;&#160;Did you find any workaround/fix for this problem?&lt;/p&gt;</comment>
                            <comment id="17405644" author="okanarbik" created="Fri, 27 Aug 2021 07:15:21 +0000"  >&lt;p&gt;Yes, I created a custom appender from a copy of TcpSocketManager + SocketAppender and made one change inside TcpSocketManager.write&lt;br/&gt;
that throws AppenderLoggingException unconditionally on IOException&lt;br/&gt;
 throw new AppenderLoggingException(&lt;br/&gt;
 String.format(&quot;Error writing to %s connection for %s&quot;, getName(), config), causeEx);&lt;/p&gt;

&lt;p&gt;after this if block:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/logging-log4j2/blob/rel/2.12.1/log4j-core/src/main/java/org/apache/logging/log4j/core/net/TcpSocketManager.java#L242&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/blob/rel/2.12.1/log4j-core/src/main/java/org/apache/logging/log4j/core/net/TcpSocketManager.java#L242&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17405764" author="vy" created="Fri, 27 Aug 2021 11:46:53 +0000"  >&lt;p&gt;This deserves a decent plain-Java test in addition to unconditionally throwing on &lt;tt&gt;IOException&lt;/tt&gt;, IMHO. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=okanarbik&quot; class=&quot;user-hover&quot; rel=&quot;okanarbik&quot;&gt;okanarbik&lt;/a&gt;, would you be interested in such a PR?&lt;/p&gt;</comment>
                            <comment id="17405796" author="okanarbik" created="Fri, 27 Aug 2021 12:32:34 +0000"  >&lt;p&gt;No thanks, I&apos;m not into TDD.&lt;br/&gt;
On a quick look it seems this is tested but the test does not ensure that every log throws exception, only first caught exception triggers success condition:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/logging-log4j2/blob/ac121e22d763d6b5391fad9e39d5efbeb79ccfac/log4j-core/src/test/java/org/apache/logging/log4j/core/net/SocketReconnectTest.java#L145&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/blob/ac121e22d763d6b5391fad9e39d5efbeb79ccfac/log4j-core/src/test/java/org/apache/logging/log4j/core/net/SocketReconnectTest.java#L145&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17432842" author="jira-bot" created="Fri, 22 Oct 2021 07:38:11 +0000"  >&lt;p&gt;Commit 4978ec870bd781aacbb55c0c5db0c92c8bb7a7ae in logging-log4j2&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2829&quot; title=&quot;TcpSocketManager.write swallows IOException when retry = false or reconnector != null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2829&quot;&gt;&lt;del&gt;LOG4J2-2829&lt;/del&gt;&lt;/a&gt; from Volkan Yazici&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=4978ec8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=4978ec8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2829&quot; title=&quot;TcpSocketManager.write swallows IOException when retry = false or reconnector != null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2829&quot;&gt;&lt;del&gt;LOG4J2-2829&lt;/del&gt;&lt;/a&gt; SocketAppender should propagate failures when reconnection fails.&lt;/p&gt;</comment>
                            <comment id="17432843" author="jira-bot" created="Fri, 22 Oct 2021 07:38:28 +0000"  >&lt;p&gt;Commit 33be70406043ad436773500829c148e00a4fb1a6 in logging-log4j2&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2829&quot; title=&quot;TcpSocketManager.write swallows IOException when retry = false or reconnector != null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2829&quot;&gt;&lt;del&gt;LOG4J2-2829&lt;/del&gt;&lt;/a&gt; from Volkan Yazici&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=33be704&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=33be704&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2829&quot; title=&quot;TcpSocketManager.write swallows IOException when retry = false or reconnector != null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2829&quot;&gt;&lt;del&gt;LOG4J2-2829&lt;/del&gt;&lt;/a&gt; SocketAppender should propagate failures when reconnection fails.&lt;/p&gt;</comment>
                            <comment id="17432845" author="vy" created="Fri, 22 Oct 2021 07:42:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=okanarbik&quot; class=&quot;user-hover&quot; rel=&quot;okanarbik&quot;&gt;okanarbik&lt;/a&gt;, I have pushed a fix to &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/591&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the LOG4J2-2829 branch&lt;/a&gt;. Mind confirming it works for you, please?&lt;/p&gt;</comment>
                            <comment id="17433410" author="okanarbik" created="Sun, 24 Oct 2021 07:59:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vy&quot; class=&quot;user-hover&quot; rel=&quot;vy&quot;&gt;vy&lt;/a&gt;, this will work - it is pretty much the same patch I applied locally, but I see github PR swallows the original causeEx. Maybe it should be nested instead?&lt;/p&gt;</comment>
                            <comment id="17433481" author="vy" created="Sun, 24 Oct 2021 18:24:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=okanarbik&quot; class=&quot;user-hover&quot; rel=&quot;okanarbik&quot;&gt;okanarbik&lt;/a&gt;, great catch! Adding &lt;tt&gt;causeEx&lt;/tt&gt; as cause and merging it.&lt;/p&gt;</comment>
                            <comment id="17433482" author="jira-bot" created="Sun, 24 Oct 2021 18:24:20 +0000"  >&lt;p&gt;Commit 66f2cbbea9202b61462103f888824d70219db6e9 in logging-log4j2&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2829&quot; title=&quot;TcpSocketManager.write swallows IOException when retry = false or reconnector != null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2829&quot;&gt;&lt;del&gt;LOG4J2-2829&lt;/del&gt;&lt;/a&gt; from Volkan Yazici&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=66f2cbb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=66f2cbb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2829&quot; title=&quot;TcpSocketManager.write swallows IOException when retry = false or reconnector != null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2829&quot;&gt;&lt;del&gt;LOG4J2-2829&lt;/del&gt;&lt;/a&gt; Set cause in thrown AppenderLoggingException.&lt;/p&gt;</comment>
                            <comment id="17433484" author="jira-bot" created="Sun, 24 Oct 2021 18:32:51 +0000"  >&lt;p&gt;Commit a88c08be86411c8e0bc5112b315515fe6dc201b7 in logging-log4j2&apos;s branch refs/heads/release-2.x from Volkan Yaz&#305;c&#305;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=a88c08b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=a88c08b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2829&quot; title=&quot;TcpSocketManager.write swallows IOException when retry = false or reconnector != null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2829&quot;&gt;&lt;del&gt;LOG4J2-2829&lt;/del&gt;&lt;/a&gt; SocketAppender should propagate failures when reconnection fails. (#591)&lt;/p&gt;

&lt;p&gt;Certain `SocketAppender` tests are rewritten and the redundant/disabled ones are removed.&lt;/p&gt;</comment>
                            <comment id="17433498" author="jira-bot" created="Sun, 24 Oct 2021 19:28:21 +0000"  >&lt;p&gt;Commit 08b2946d3619f70887b9e528a0d09940a4c7294e in logging-log4j2&apos;s branch refs/heads/master from Volkan Yaz&#305;c&#305;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=08b2946&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=08b2946&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2829&quot; title=&quot;TcpSocketManager.write swallows IOException when retry = false or reconnector != null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2829&quot;&gt;&lt;del&gt;LOG4J2-2829&lt;/del&gt;&lt;/a&gt; SocketAppender should propagate failures when reconnection fails. (#591)&lt;/p&gt;

&lt;p&gt;Certain `SocketAppender` tests are rewritten and the redundant/disabled ones are removed.&lt;/p&gt;</comment>
                            <comment id="17437331" author="jira-bot" created="Tue, 2 Nov 2021 12:37:18 +0000"  >&lt;p&gt;Commit 7b13505a82e7afeb2d89518ad36597e233790572 in logging-log4j2&apos;s branch refs/heads/release-2.x from Volkan Yazici&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7b13505&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7b13505&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2829&quot; title=&quot;TcpSocketManager.write swallows IOException when retry = false or reconnector != null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2829&quot;&gt;&lt;del&gt;LOG4J2-2829&lt;/del&gt;&lt;/a&gt; Try to fix SocketAppenderReconnectTest failures on Windows.&lt;/p&gt;</comment>
                            <comment id="17437538" author="jira-bot" created="Tue, 2 Nov 2021 18:55:05 +0000"  >&lt;p&gt;Commit 0d9e844c77fc03f72fb1a2c96499b06640434c06 in logging-log4j2&apos;s branch refs/heads/master from Volkan Yazici&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=0d9e844&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=0d9e844&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2829&quot; title=&quot;TcpSocketManager.write swallows IOException when retry = false or reconnector != null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2829&quot;&gt;&lt;del&gt;LOG4J2-2829&lt;/del&gt;&lt;/a&gt; Try to fix SocketAppenderReconnectTest failures on Windows.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0e1ko:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>