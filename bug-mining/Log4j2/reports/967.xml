<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:37:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1676] Some LogEvents may not carry a Throwable (Use Message.getThrowable() in log(Message) methods)</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1676</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;All &lt;tt&gt;log(Message)&lt;/tt&gt; methods should use &lt;tt&gt;Message.getThrowable()&lt;/tt&gt;, e.g.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void debug(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Message msg) {
        logIfEnabled(FQCN, Level.DEBUG, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, msg, msg != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? msg.getThrowable() : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;instead of the current&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void debug(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Message msg) {
        logIfEnabled(FQCN, Level.DEBUG, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, msg, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13019125">LOG4J2-1676</key>
            <summary>Some LogEvents may not carry a Throwable (Use Message.getThrowable() in log(Message) methods)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="huxi">Joern Huxhorn</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Nov 2016 07:10:41 +0000</created>
                <updated>Fri, 18 Nov 2016 07:25:10 +0000</updated>
                            <resolved>Fri, 18 Nov 2016 05:45:59 +0000</resolved>
                                    <version>2.5</version>
                    <version>2.6</version>
                    <version>2.7</version>
                                    <fixVersion>2.8</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15646807" author="garydgregory" created="Tue, 8 Nov 2016 07:44:55 +0000"  >&lt;p&gt;Can you please provide a unit test to demonstrate the problem?&lt;/p&gt;</comment>
                            <comment id="15646885" author="remkop@yahoo.com" created="Tue, 8 Nov 2016 08:25:27 +0000"  >&lt;p&gt;The background of this issue is discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1226&quot; title=&quot;Message instances are simply serialized. They mustn&amp;#39;t.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1226&quot;&gt;&lt;del&gt;LOG4J2-1226&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="15646982" author="mikaelstaldal" created="Tue, 8 Nov 2016 09:15:16 +0000"  >&lt;p&gt;What was the original purpose of &lt;tt&gt;Message.getThrowable()&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="15646990" author="huxi" created="Tue, 8 Nov 2016 09:19:32 +0000"  >&lt;p&gt;It is used to retrieve a potential &lt;tt&gt;Throwable&lt;/tt&gt; from the parameter varargs of a message.&lt;/p&gt;

&lt;p&gt;e.g.&lt;br/&gt;
&lt;tt&gt;logger.debug(&quot;{} {}&quot;, &quot;one&quot;, &quot;two&quot;, new Throwable())&lt;/tt&gt;&lt;br/&gt;
should populate that field while&lt;br/&gt;
&lt;tt&gt;logger.debug(&quot;{} {} {}&quot;, &quot;one&quot;, &quot;two&quot;, new Throwable())&lt;/tt&gt;&lt;br/&gt;
shouldn&apos;t. It should instead replace the last {} with &lt;tt&gt;t.toString()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15647020" author="mikaelstaldal" created="Tue, 8 Nov 2016 09:34:18 +0000"  >&lt;p&gt;The first one should populate the Throwable in the LogEvent, but why via a Message?&lt;/p&gt;</comment>
                            <comment id="15647072" author="huxi" created="Tue, 8 Nov 2016 09:51:24 +0000"  >&lt;p&gt;Because &lt;tt&gt;getThrowable()&lt;/tt&gt; is part of the &lt;tt&gt;Message&lt;/tt&gt; interface.&lt;/p&gt;

&lt;p&gt;One can implement custom messages like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;FooMessage
		&lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Message
{
	@Override
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getFormattedMessage() {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;foo message&quot;&lt;/span&gt;;
	}

	@Override
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getFormat() {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;foo message format&quot;&lt;/span&gt;;
	}

	@Override
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] getParameters() {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]{&lt;span class=&quot;code-quote&quot;&gt;&quot;param1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;param2&quot;&lt;/span&gt;};
	}

	@Override
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Throwable getThrowable() {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException();
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is very surprising that this message will create an event without a &lt;tt&gt;Throwable&lt;/tt&gt;. At least Remko and I didn&apos;t have an immediate explanation.&lt;/p&gt;

&lt;p&gt;Similarly, it shouldn&apos;t make a difference whether a &lt;tt&gt;ParameterizedMessageFactory&lt;/tt&gt; is used internally via&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void logMessage(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fqcn, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Level level, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Marker marker, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; message,
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;... params) {
	&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Message msg = messageFactory.newMessage(message, params);
	logMessageSafely(fqcn, level, marker, msg, msg.getThrowable());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;or manually via&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;logger.debug(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ParameterizedMessage(messagePattern, arguments));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15647111" author="mikaelstaldal" created="Tue, 8 Nov 2016 10:01:03 +0000"  >&lt;p&gt;I think you did not get my question. I wonder about the reason for adding &lt;tt&gt;Message.getThrowable()&lt;/tt&gt; in the first place. &lt;/p&gt;

&lt;p&gt;Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt; can answer, he made committ 64f7ec1c100655bc04188e19c932a4d86a3552b2 back in 2012. JIRA issue &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-133&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LOG4J2-133&lt;/a&gt; does not answer it.&lt;/p&gt;</comment>
                            <comment id="15647134" author="huxi" created="Tue, 8 Nov 2016 10:08:44 +0000"  >&lt;p&gt;Others may correct me but I&apos;m pretty sure it&apos;s there because the &quot;is the Throwable &apos;used up&apos; while formatting the message&quot; decision is implementation specific.&lt;/p&gt;

&lt;p&gt;&quot;&lt;/p&gt;
{0}
&lt;p&gt; &lt;/p&gt;
{1}
&lt;p&gt;&quot; vs. &quot;{} {}&quot; vs. &quot;%s %s&quot;.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;getThrowable()&lt;/tt&gt; should only return a &lt;tt&gt;Throwable&lt;/tt&gt; if it is not &apos;used up&apos; by placeholders. But then it definitely should and is doing so right now.&lt;/p&gt;

&lt;p&gt;The message factory being used can be specified via system property &lt;tt&gt;&quot;log4j2.messageFactory&quot;&lt;/tt&gt;. I don&apos;t think that this is the best idea but that is an entirely different issue...&lt;/p&gt;</comment>
                            <comment id="15647309" author="ralph.goers@dslextreme.com" created="Tue, 8 Nov 2016 11:38:23 +0000"  >&lt;p&gt;My recollection is that if the Throwablle is part of ParameterizedMessage getThrowable was called to add it to the LogEvent.&lt;/p&gt;</comment>
                            <comment id="15666668" author="huxi" created="Tue, 15 Nov 2016 09:41:38 +0000"  >&lt;p&gt;Is there any downside of this proposed change that I&apos;m missing?&lt;/p&gt;</comment>
                            <comment id="15670799" author="huxi" created="Wed, 16 Nov 2016 15:55:00 +0000"  >&lt;p&gt;Patches containing the suggested changes.&lt;/p&gt;</comment>
                            <comment id="15670901" author="remkop@yahoo.com" created="Wed, 16 Nov 2016 16:27:49 +0000"  >&lt;p&gt;No downsides I can see. Just haven&apos;t had time to look at this. &lt;/p&gt;</comment>
                            <comment id="15670935" author="garydgregory" created="Wed, 16 Nov 2016 16:41:13 +0000"  >&lt;p&gt;There is no unit test that demonstrate the problem(s) which means if someone changes the code in the future, no one will know it breaks something.&lt;/p&gt;</comment>
                            <comment id="15670964" author="huxi" created="Wed, 16 Nov 2016 16:52:48 +0000"  >&lt;p&gt;I know. Can you give me some hints about where/how you prefer this to be tested?&lt;/p&gt;

&lt;p&gt;The patch was mainly meant as a little bit of help. I hoped that the changes alone would make some relevant tests fail but that wasn&apos;t the case, unfortunately.&lt;/p&gt;</comment>
                            <comment id="15670989" author="garydgregory" created="Wed, 16 Nov 2016 17:05:15 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Ideally, I would like to see one patch file with unit test changes that I can apply and see tests fail.&lt;/p&gt;

&lt;p&gt;Then another patch file with the main changes that fix the tests.&lt;/p&gt;

&lt;p&gt;Since your main changes are in the API module&apos;s AbstractLogger class, you could try to write a test in that module&apos;s package. &lt;/p&gt;

&lt;p&gt;IIRC, in the API module the only subclass of AbstractLogger is SimpleLogger which does not do much, so that might not help. We also have a org.apache.logging.log4j.TestLogger class but I did not dig to see how it is used. That&apos;s worth a look.&lt;/p&gt;

&lt;p&gt;In addition, testing from the Core module would also be a good thing. There are lots test in the Core modules to get inspiration from. Maybe start with org.apache.logging.log4j.core.LoggerTest&lt;/p&gt;

&lt;p&gt;The bottom line is that we want a test that will guard against a future regression.&lt;/p&gt;

&lt;p&gt;I hope this helps! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;
</comment>
                            <comment id="15672954" author="huxi" created="Thu, 17 Nov 2016 06:47:12 +0000"  >&lt;p&gt;I&apos;ll probably give it a shot over the weekend. No promises! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15673450" author="huxi" created="Thu, 17 Nov 2016 11:20:50 +0000"  >&lt;p&gt;0001 is a refactoring of &lt;tt&gt;AbstractLoggerTest&lt;/tt&gt; without any change to its functionality. &lt;tt&gt;AbstractLoggerTest&lt;/tt&gt; itself is no longer extending &lt;tt&gt;AbstractLogger&lt;/tt&gt;. This enables the use of different &lt;tt&gt;AbstractLogger&lt;/tt&gt; implementations in different testing contexts in a more straightforward way. It&apos;s now also more obvious what is actual test code and what is just code supporting the tests.&lt;/p&gt;

&lt;p&gt;0002 is implementing the tests for the desired functionality. Some (the ones expecting a &lt;tt&gt;Throwable&lt;/tt&gt;) will fail.&lt;/p&gt;

&lt;p&gt;0003 is implementing the desired functionality for all relevant &lt;tt&gt;log&lt;/tt&gt;/&lt;tt&gt;debug&lt;/tt&gt; etc. methods.&lt;/p&gt;

&lt;p&gt;0004 is implementing the desired functionality for &lt;tt&gt;MessageSupplier&lt;/tt&gt;/&lt;tt&gt;Supplier&lt;/tt&gt; methods.&lt;/p&gt;</comment>
                            <comment id="15675266" author="garydgregory" created="Fri, 18 Nov 2016 00:24:44 +0000"  >&lt;p&gt;Applied patch &lt;tt&gt;0001-Refactored-AbstractLoggerTest.patch&lt;/tt&gt; to Git master. I will continue to review later tonight.&lt;/p&gt;</comment>
                            <comment id="15675873" author="garydgregory" created="Fri, 18 Nov 2016 05:45:22 +0000"  >&lt;p&gt;In Git master. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="15675875" author="garydgregory" created="Fri, 18 Nov 2016 05:45:43 +0000"  >&lt;p&gt;In Git master. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="15676026" author="huxi" created="Fri, 18 Nov 2016 07:25:10 +0000"  >&lt;p&gt;Verified. Thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12923393">LOG4J2-1226</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12839346" name="0001-Refactored-AbstractLoggerTest.patch" size="77527" author="huxi" created="Thu, 17 Nov 2016 11:20:50 +0000"/>
                            <attachment id="12839347" name="0002-Testing-Message-Throwable-handling.patch" size="11452" author="huxi" created="Thu, 17 Nov 2016 11:20:50 +0000"/>
                            <attachment id="12839348" name="0003-Using-Throwable-of-Message-if-available.patch" size="5630" author="huxi" created="Thu, 17 Nov 2016 11:20:50 +0000"/>
                            <attachment id="12839349" name="0004-Using-Throwable-of-Message-if-not-explicitly-given.patch" size="1769" author="huxi" created="Thu, 17 Nov 2016 11:20:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i361yn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>