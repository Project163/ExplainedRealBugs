<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:32:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-385] Unable to roll log files monthly</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-385</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Attempting to use FastRollingFile appender and configure log file rollover to occur monthly.  When &lt;tt&gt;filePattern=&quot;logs/app-%d{yyyy-MM}.log.gz&quot;&lt;/tt&gt; is used, at application startup an archive file is created immediately (app-2013-01.log.gz) even if no log previously existed.  A log file is created, but only a single entry is made into the log.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java 1.7.0_25, Windows 7 64bit, IntelliJ IDEA 12 Ultimate&lt;/p&gt;</environment>
        <key id="12666870">LOG4J2-385</key>
            <summary>Unable to roll log files monthly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="acefunk">Ace Funk</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Sep 2013 11:49:27 +0000</created>
                <updated>Fri, 31 Jan 2014 13:38:02 +0000</updated>
                            <resolved>Fri, 31 Jan 2014 13:38:02 +0000</resolved>
                                    <version>2.0-beta8</version>
                                    <fixVersion>2.0-rc1</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13769248" author="ppartida" created="Tue, 17 Sep 2013 06:16:19 +0000"  >&lt;p&gt;Seems that it is triggering the rollover but it erases instead of back up the log as it does with daily backups.&lt;/p&gt;</comment>
                            <comment id="13770290" author="ppartida" created="Wed, 18 Sep 2013 01:31:34 +0000"  >&lt;p&gt;org.apache.logging.log4j.core.appender.rolling.PatternProcessor&lt;br/&gt;
Method: getNextTime(long, int, boolean)&lt;/p&gt;

&lt;p&gt;It has issues logging Monthly because it detects the next variables:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Calendar currentCal = Calendar.getInstance();
        currentCal.setTimeInMillis(current);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Calendar cal = Calendar.getInstance();
        cal.set(currentCal.get(Calendar.YEAR), 0, 1, 0, 0, 0);  &lt;span class=&quot;code-comment&quot;&gt;// inits with current year
&lt;/span&gt;        cal.set(Calendar.MILLISECOND, 0);
....

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (frequency == RolloverFrequency.MONTHLY) {
            increment(cal, Calendar.MONTH, increment, modulus);
            nextTime = cal.getTimeInMillis();
            cal.add(Calendar.MONTH, -1);
            nextFileTime = cal.getTimeInMillis();
            &lt;span class=&quot;code-comment&quot;&gt;// Running on September the 17th (it doesn&apos;t matter the date)
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;//   nextFileTime : 1357023600000 - Tue Jan 01 00:00:00 GMT-07:00 2013 //Only year is added
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;//   nextTime : 1359702000000 - Fri Feb 01 00:00:00 GMT-07:00 2013 //Moving from Jan to Feb
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nextTime;
        }
...

&lt;span class=&quot;code-comment&quot;&gt;//Why is daily working then? because right after Monthly we have weekly (it should be failing as well) and then daily comes as &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;:
&lt;/span&gt;
...
        &lt;span class=&quot;code-comment&quot;&gt;//Next line is going to point to current date to determine the very next lookup.
&lt;/span&gt;        cal.set(Calendar.DAY_OF_YEAR, currentCal.get(Calendar.DAY_OF_YEAR)); 
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (frequency == RolloverFrequency.DAILY) {
            increment(cal, Calendar.DAY_OF_YEAR, increment, modulus);
            nextTime = cal.getTimeInMillis();
            cal.add(Calendar.DAY_OF_YEAR, -1);
            nextFileTime = cal.getTimeInMillis();
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nextTime;
        }
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;In order to fix, we could move the line&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    cal.set(Calendar.DAY_OF_YEAR, currentCal.get(Calendar.DAY_OF_YEAR)); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to the top (before Year) and remove the elements as needed inside each if statement, ie:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;remove month, day, time inside year&lt;/li&gt;
	&lt;li&gt;remove day and time inside month&lt;/li&gt;
	&lt;li&gt;remove time inside daily&lt;br/&gt;
etc..&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;OR&lt;/p&gt;

&lt;p&gt;we can set current month at month level and add the week at week level, like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (frequency == RolloverFrequency.MONTHLY) {
+           cal.set(Calendar.MONTH, currentCal.get(Calendar.MONTH)); &lt;span class=&quot;code-comment&quot;&gt;//moves the date to today&apos;s month.
&lt;/span&gt;            increment(cal, Calendar.MONTH, increment, modulus);
            nextTime = cal.getTimeInMillis();
            cal.add(Calendar.MONTH, -1);
            nextFileTime = cal.getTimeInMillis();
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nextTime;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (frequency == RolloverFrequency.WEEKLY) {
+           cal.set(Calendar.WEEK_OF_YEAR, currentCal.get(Calendar.WEEK_OF_YEAR));&lt;span class=&quot;code-comment&quot;&gt;//moves the week.
&lt;/span&gt;            ....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="13771179" author="ppartida" created="Wed, 18 Sep 2013 20:11:04 +0000"  >&lt;p&gt;Attaching patch that fixes the issue, please review and check in, thanks.&lt;/p&gt;</comment>
                            <comment id="13887396" author="remkop@yahoo.com" created="Fri, 31 Jan 2014 02:36:42 +0000"  >&lt;p&gt;Team, what is the spec for rollover?&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Starting Oct 15, given monthly rollover, do we expect Nov 15 (add 1 month), or Nov 1st (1st day of next month)? (And what time?)&lt;/li&gt;
	&lt;li&gt;Starting Tue March 4th, given weekly rollover, do we expect Tue March 11th (add 1 week)? (And what time?)&lt;/li&gt;
	&lt;li&gt;Starting Tue March 4th 10:31, given hourly rollover, do we expect Tue March 4th 11:31 (add 1 hour) or Tue March 4th 11:00 (1st minute of next hour)?  (And do we truncate seconds/millis?)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;tt&gt;PatternProcessor.getNextTime()&lt;/tt&gt; currently gives interesting answers to these questions (yyyy/MM/dd format):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Monthly rollover from 2014/01/31 gives 2014/02/&lt;font color=&quot;red&quot;&gt;01&lt;/font&gt;&lt;/li&gt;
	&lt;li&gt;Monthly rollover from 2014/10/15 gives 2014/&lt;font color=&quot;red&quot;&gt;02/01&lt;/font&gt;&lt;/li&gt;
	&lt;li&gt;Weekly rollover from 2014/03/4 Tue gives 2014/&lt;font color=&quot;red&quot;&gt;01/08 Wed&lt;/font&gt;&lt;/li&gt;
	&lt;li&gt;Hourly rollover from 2014/03/04 10:31 gives 2014/03/04 11:&lt;font color=&quot;red&quot;&gt;00&lt;/font&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Some JUnit tests:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetNextTimeMonthlyAddsOneMonthToSpecifiedTime() {
    PatternProcessor pp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PatternProcessor(&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app-%d{yyyy-MM}.log.gz&quot;&lt;/span&gt;);
    Calendar initial = Calendar.getInstance();
    initial.set(2014, 9, 15, 10, 31, 59); &lt;span class=&quot;code-comment&quot;&gt;// Oct 15th
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; actual = pp.getNextTime(initial.getTimeInMillis(), 1, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
    
    &lt;span class=&quot;code-comment&quot;&gt;// Do we expect 1st day of next month?
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// Or &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; we add 1 month, and expect Nov 15?
&lt;/span&gt;    Calendar expected = Calendar.getInstance();
    expected.set(2014, 10, 15, 0, 0, 00);
    expected.set(Calendar.MILLISECOND, 0);
    assertEquals(format(expected.getTimeInMillis()), format(actual));
}

@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetNextTimeMonthlyAddsOneMonthOnLastDayOfMonth() {
    PatternProcessor pp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PatternProcessor(&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app-%d{yyyy-MM}.log.gz&quot;&lt;/span&gt;);
    Calendar initial = Calendar.getInstance();
    initial.set(2014, 0, 31, 10, 31, 59); &lt;span class=&quot;code-comment&quot;&gt;// 2014 Jan 31st
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; actual = pp.getNextTime(initial.getTimeInMillis(), 1, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
    
    &lt;span class=&quot;code-comment&quot;&gt;// Expect last day of next month: 2014 Feb 28th
&lt;/span&gt;    Calendar expected = Calendar.getInstance();
    expected.set(2014, 1, 28, 0, 0, 00);
    expected.set(Calendar.MILLISECOND, 0);
    assertEquals(format(expected.getTimeInMillis()), format(actual));
}

@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetNextTimeWeeklyAddsOneWeekToSpecifiedTime() {
    PatternProcessor pp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PatternProcessor(&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app-%d{yyyy-MM-W}.log.gz&quot;&lt;/span&gt;);
    Calendar initial = Calendar.getInstance();
    initial.set(2014, 2, 4, 10, 31, 59); &lt;span class=&quot;code-comment&quot;&gt;// Tue, March 4, 2014
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; actual = pp.getNextTime(initial.getTimeInMillis(), 1, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
    
    &lt;span class=&quot;code-comment&quot;&gt;// expect Tue, March 11, 2014 (one week later)
&lt;/span&gt;    Calendar expected = Calendar.getInstance();
    expected.set(2014, 2, 11, 0, 0, 00);
    expected.set(Calendar.MILLISECOND, 0);
    assertEquals(format(expected.getTimeInMillis()), format(actual));
}

@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetNextTimeHourlyAddsOneHourToSpecifiedTime() {
    PatternProcessor pp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PatternProcessor(&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app-%d{yyyy-MM-dd-HH}.log.gz&quot;&lt;/span&gt;);
    Calendar initial = Calendar.getInstance();
    initial.set(2014, 2, 4, 10, 31, 59); &lt;span class=&quot;code-comment&quot;&gt;// Tue, March 4, 2014, 10:31
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; actual = pp.getNextTime(initial.getTimeInMillis(), 1, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
    
    &lt;span class=&quot;code-comment&quot;&gt;// expect Wed, March 4, 2014, 11:31 (one hour later)
&lt;/span&gt;    Calendar expected = Calendar.getInstance();
    expected.set(2014, 2, 4, 11, 31, 00);
    expected.set(Calendar.MILLISECOND, 0);
    assertEquals(format(expected.getTimeInMillis()), format(actual));
}

&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; format(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; time) {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; actualStr = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleDateFormat(&lt;span class=&quot;code-quote&quot;&gt;&quot;yyyy/MM/dd HH:mm:ss.SSS&quot;&lt;/span&gt;).format(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Date(time));
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; actualStr;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13887415" author="garydgregory" created="Fri, 31 Jan 2014 03:05:17 +0000"  >&lt;p&gt;I am wondering about following a standard like cron...&lt;/p&gt;

&lt;p&gt;Maybe even having a cron Quartz-based rollover policy as an additional (heavy) component. &lt;/p&gt;</comment>
                            <comment id="13887431" author="jvz" created="Fri, 31 Jan 2014 03:39:08 +0000"  >&lt;p&gt;Speaking of Quartz, another way to give that sort of feature is through the Jave EE Timer service for EJB as described &lt;a href=&quot;http://docs.oracle.com/javaee/6/tutorial/doc/bnboy.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;in the tutorial&lt;/a&gt;. I also +1 the cron idea.&lt;/p&gt;</comment>
                            <comment id="13887434" author="remkop@yahoo.com" created="Fri, 31 Jan 2014 03:49:04 +0000"  >&lt;p&gt;What do Log4j-1.2 and Logback do in the above scenarios? Considering easy migration, we probably want to follow them (unless they do something very strange...)&lt;/p&gt;

&lt;p&gt;Edit:&lt;br/&gt;
To answer my own question: &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Monthly rollover occurs at the beginning of each month.&lt;/li&gt;
	&lt;li&gt;Weekly rollover occurs at the first day of each week. The first day of the week depends on the locale.&lt;/li&gt;
	&lt;li&gt;Daily rollover occurs at midnight each day.&lt;/li&gt;
	&lt;li&gt;Log4J-1.2 also has an option to rollover both at midnight and at noon during the day, so twice each day.&lt;/li&gt;
	&lt;li&gt;Hourly rollover occurs at the beginning of each hour.&lt;/li&gt;
	&lt;li&gt;Minutely&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; rollover occurs at the beginning of each minute.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/DailyRollingFileAppender.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/DailyRollingFileAppender.html&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://logback.qos.ch/manual/appenders.html#TimeBasedRollingPolicy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://logback.qos.ch/manual/appenders.html#TimeBasedRollingPolicy&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13887467" author="remkop@yahoo.com" created="Fri, 31 Jan 2014 04:51:54 +0000"  >&lt;p&gt;Cron... to be honest, I know it is a standard, but I really dislike the format... It &quot;makes me think&quot;, every time I look at a crontab. I can&apos;t just &quot;grok&quot; what it says, I always have to think twice about it...&lt;/p&gt;

&lt;p&gt;However, the &lt;a href=&quot;http://en.wikipedia.org/wiki/Cron#Predefined_scheduling_definitions&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;predefined values&lt;/a&gt; like &lt;tt&gt;@hourly&lt;/tt&gt;, &lt;tt&gt;@weekly&lt;/tt&gt; are very nice. I would like to be able to use those... &lt;/p&gt;

&lt;p&gt;At the moment the &lt;tt&gt;&quot;${yyyy-W}&quot;&lt;/tt&gt; pattern does double duty: it determine the rollover frequency, and it also lets the user determine (to some limited degree) how the resulting file will be named after the rollover. &lt;/p&gt;

&lt;p&gt;Instead of asking the user to specify a pattern for the rename, we could use a fixed renaming rule:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;filepattern=&quot;/logs/mylog_${@yearly}.log.gz&quot;&lt;/tt&gt; -&amp;gt; rollover once a year at midnight in the morning of January 1. Rename format is fixed &lt;tt&gt;&quot;yyyy&quot;&lt;/tt&gt;. E.g. on Jan 1, 2014, the old log file is renamed to &lt;tt&gt;/logs/mylog_2013.log.gz&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;filepattern=&quot;/logs/mylog_${@monthly}.log.gz&quot;&lt;/tt&gt; -&amp;gt; rollover once a month at midnight in the morning of the first day of the month. Rename format is fixed &lt;tt&gt;&quot;yyyy-MM&quot;&lt;/tt&gt;. E.g. on Feb 1, 2014, the old log file is renamed to &lt;tt&gt;/logs/mylog_2013-01.log.gz&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;filepattern=&quot;/logs/mylog_${@weekly}.log.gz&quot;&lt;/tt&gt; -&amp;gt; once a week at midnight the (locale-dependent) first day of the week. Rename format is fixed &lt;tt&gt;&quot;yyyy-MM-dd&quot;&lt;/tt&gt;. E.g. on Feb 2, 2014, the old log file is renamed to &lt;tt&gt;/logs/mylog_2013-01-26.log.gz&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;filepattern=&quot;/logs/mylog_${@daily}.log.gz&quot;&lt;/tt&gt; -&amp;gt; once a day at midnight. Rename format is fixed &lt;tt&gt;&quot;yyyy-MM-dd&quot;&lt;/tt&gt;. E.g. on Feb 1, 2014, the old log file is renamed to &lt;tt&gt;/logs/mylog_2013-01-31.log.gz&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;filepattern=&quot;/logs/mylog_${@hourly}.log.gz&quot;&lt;/tt&gt; -&amp;gt; once an hour at the beginning of the hour. Rename format is fixed &lt;tt&gt;&quot;yyyy-MM-dd_HH&quot;&lt;/tt&gt;. E.g. on Feb 1, 2014, 10:00 the old log file is renamed to &lt;tt&gt;/logs/mylog_2013-02-01_09.log.gz&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;filepattern=&quot;/logs/mylog_${@minutely}.log.gz&quot;&lt;/tt&gt; -&amp;gt; once a minute at the beginning of the minute. Rename format is fixed &lt;tt&gt;&quot;yyyy-MM-dd_HH-mm&quot;&lt;/tt&gt;. E.g. on Feb 1, 2014, 10:03 the old log file is renamed to &lt;tt&gt;/logs/mylog_2013-02-01_10-02.log.gz&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thoughts?&lt;/p&gt;

&lt;p&gt;I would &lt;b&gt;not&lt;/b&gt; like to ask users to use this type of cron format below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; #  *  *  *  *  *  command to execute
 # &#9516; &#9516; &#9516; &#9516; &#9516;
 # &#9474; &#9474; &#9474; &#9474; &#9474;
 # &#9474; &#9474; &#9474; &#9474; &#9474;
 # &#9474; &#9474; &#9474; &#9474; &#9492;&#9472;&#9472;&#9472;&#9472;&#9472; day of week (0 - 7) (0 to 6 are Sunday to Saturday, or use names; 7 is Sunday, the same as 0)
 # &#9474; &#9474; &#9474; &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472; month (1 - 12)
 # &#9474; &#9474; &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472; day of month (1 - 31)
 # &#9474; &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472; hour (0 - 23)
 # &#9492;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472;&#9472; min (0 - 59)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13887524" author="remkop@yahoo.com" created="Fri, 31 Jan 2014 06:43:36 +0000"  >&lt;p&gt;After checking the behaviour of Log4J-1.2 and Logback there seem to be a few bugs in the current &lt;tt&gt;PatternProcessor.getNextTime()&lt;/tt&gt; logic.&lt;/p&gt;

&lt;p&gt;Current &lt;tt&gt;PatternProcessor.getNextTime()&lt;/tt&gt; results (dates in &lt;tt&gt;yyyy/MM/dd&lt;/tt&gt; format):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Monthly rollover from 2014/01/31 gives 2014/02/01&lt;/li&gt;
	&lt;li&gt;Monthly rollover from 2014/10/15 gives 2014/&lt;font color=&quot;red&quot;&gt;02/01&lt;/font&gt; &lt;b&gt;&amp;lt;-- BUG&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;Weekly rollover from 2014/03/4 Tue gives 2014/&lt;font color=&quot;red&quot;&gt;01/08 Wed&lt;/font&gt; &lt;b&gt;&amp;lt;-- BUG&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;Hourly rollover from 2014/03/04 10:31 gives 2014/03/04 11:00 when run in the morning&lt;/li&gt;
	&lt;li&gt;Hourly rollover from 2014/03/04 10:31 gives 2014/03/04 &lt;font color=&quot;red&quot;&gt;23&lt;/font&gt;:00 when run in the afternoon &lt;b&gt;&amp;lt;-- BUG&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;Minutely rollover from 2014/03/04 10:31 gives 2014/03/04 &lt;font color=&quot;red&quot;&gt;22&lt;/font&gt;:00 when run in the afternoon &lt;b&gt;&amp;lt;-- BUG&lt;/b&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The following patch fixes the above issues:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Index: src/main/java/org/apache/logging/log4j/core/appender/rolling/PatternProcessor.java
===================================================================
--- src/main/java/org/apache/logging/log4j/core/appender/rolling/PatternProcessor.java	(revision 1563035)
+++ src/main/java/org/apache/logging/log4j/core/appender/rolling/PatternProcessor.java	(working copy)
@@ -102,6 +102,7 @@
             nextFileTime = cal.getTimeInMillis();
             &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nextTime;
         }
+        cal.set(Calendar.MONTH, currentCal.get(Calendar.MONTH));
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (frequency == RolloverFrequency.MONTHLY) {
             increment(cal, Calendar.MONTH, increment, modulus);
             nextTime = cal.getTimeInMillis();
@@ -110,7 +111,9 @@
             &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nextTime;
         }
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (frequency == RolloverFrequency.WEEKLY) {
+            cal.set(Calendar.WEEK_OF_YEAR, currentCal.get(Calendar.WEEK_OF_YEAR));
             increment(cal, Calendar.WEEK_OF_YEAR, increment, modulus);
+            cal.set(Calendar.DAY_OF_WEEK, currentCal.getFirstDayOfWeek());
             nextTime = cal.getTimeInMillis();
             cal.add(Calendar.WEEK_OF_YEAR, -1);
             nextFileTime = cal.getTimeInMillis();
@@ -124,11 +127,11 @@
             nextFileTime = cal.getTimeInMillis();
             &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nextTime;
         }
-        cal.set(Calendar.HOUR, currentCal.get(Calendar.HOUR));
+        cal.set(Calendar.HOUR_OF_DAY, currentCal.get(Calendar.HOUR_OF_DAY));
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (frequency == RolloverFrequency.HOURLY) {
-            increment(cal, Calendar.HOUR, increment, modulus);
+            increment(cal, Calendar.HOUR_OF_DAY, increment, modulus);
             nextTime = cal.getTimeInMillis();
-            cal.add(Calendar.HOUR, -1);
+            cal.add(Calendar.HOUR_OF_DAY, -1);
             nextFileTime = cal.getTimeInMillis();
             &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nextTime;
         }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Updated JUnit tests:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; format(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; time) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; actualStr = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleDateFormat(&lt;span class=&quot;code-quote&quot;&gt;&quot;yyyy/MM/dd HH:mm:ss.SSS&quot;&lt;/span&gt;)
                .format(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Date(time));
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; actualStr;
    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetNextTimeMonthlyReturnsFirstDayOfNextMonth() {
        PatternProcessor pp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PatternProcessor(
                &lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app-%d{yyyy-MM}.log.gz&quot;&lt;/span&gt;);
        Calendar initial = Calendar.getInstance();
        initial.set(2014, 9, 15, 10, 31, 59); &lt;span class=&quot;code-comment&quot;&gt;// Oct 15th
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; actual = pp.getNextTime(initial.getTimeInMillis(), 1, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);

        &lt;span class=&quot;code-comment&quot;&gt;// We expect 1st day of next month
&lt;/span&gt;        Calendar expected = Calendar.getInstance();
        expected.set(2014, 10, 1, 0, 0, 00);
        expected.set(Calendar.MILLISECOND, 0);
        assertEquals(format(expected.getTimeInMillis()), format(actual));
    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetNextTimeMonthlyReturnsFirstDayOfNextMonth2() {
        PatternProcessor pp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PatternProcessor(
                &lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app-%d{yyyy-MM}.log.gz&quot;&lt;/span&gt;);
        Calendar initial = Calendar.getInstance();
        initial.set(2014, 0, 31, 10, 31, 59); &lt;span class=&quot;code-comment&quot;&gt;// 2014 Jan 31st
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; actual = pp.getNextTime(initial.getTimeInMillis(), 1, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);

        &lt;span class=&quot;code-comment&quot;&gt;// Expect 1st of next month: 2014 Feb 1st
&lt;/span&gt;        Calendar expected = Calendar.getInstance();
        expected.set(2014, 1, 1, 0, 0, 00);
        expected.set(Calendar.MILLISECOND, 0);
        assertEquals(format(expected.getTimeInMillis()), format(actual));
    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetNextTimeWeeklyReturnsFirstDayOfNextWeek_US() {
        Locale old = Locale.getDefault();
        Locale.setDefault(Locale.US); &lt;span class=&quot;code-comment&quot;&gt;// force 1st day to be Sunday
&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            PatternProcessor pp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PatternProcessor(
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app-%d{yyyy-MM-W}.log.gz&quot;&lt;/span&gt;);
            Calendar initial = Calendar.getInstance();
            initial.set(2014, 2, 4, 10, 31, 59); &lt;span class=&quot;code-comment&quot;&gt;// Tue, March 4, 2014
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; actual = pp.getNextTime(initial.getTimeInMillis(), 1, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);

            &lt;span class=&quot;code-comment&quot;&gt;// expect Sun, March 9, 2014
&lt;/span&gt;            Calendar expected = Calendar.getInstance();
            expected.set(2014, 2, 9, 0, 0, 00);
            expected.set(Calendar.MILLISECOND, 0);
            assertEquals(format(expected.getTimeInMillis()), format(actual));
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            Locale.setDefault(old);
        }
    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetNextTimeWeeklyReturnsFirstDayOfNextWeek_FRANCE() {
        Locale old = Locale.getDefault();
        Locale.setDefault(Locale.FRANCE); &lt;span class=&quot;code-comment&quot;&gt;// force 1st day to be Monday
&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            PatternProcessor pp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PatternProcessor(
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app-%d{yyyy-MM-W}.log.gz&quot;&lt;/span&gt;);
            Calendar initial = Calendar.getInstance();
            initial.set(2014, 2, 4, 10, 31, 59); &lt;span class=&quot;code-comment&quot;&gt;// Tue, March 4, 2014
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; actual = pp.getNextTime(initial.getTimeInMillis(), 1, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);

            &lt;span class=&quot;code-comment&quot;&gt;// expect Monday, March 10, 2014
&lt;/span&gt;            Calendar expected = Calendar.getInstance();
            expected.set(2014, 2, 10, 0, 0, 00);
            expected.set(Calendar.MILLISECOND, 0);
            assertEquals(format(expected.getTimeInMillis()), format(actual));
        } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
            Locale.setDefault(old);
        }
    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetNextTimeHourlyReturnsFirstMinuteOfNextHour() {
        PatternProcessor pp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PatternProcessor(
                &lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app-%d{yyyy-MM-dd-HH}.log.gz&quot;&lt;/span&gt;);
        Calendar initial = Calendar.getInstance();
        initial.set(2014, 2, 4, 10, 31, 59); &lt;span class=&quot;code-comment&quot;&gt;// Tue, March 4, 2014, 10:31
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; actual = pp.getNextTime(initial.getTimeInMillis(), 1, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);

        &lt;span class=&quot;code-comment&quot;&gt;// expect Wed, March 4, 2014, 11:00
&lt;/span&gt;        Calendar expected = Calendar.getInstance();
        expected.set(2014, 2, 4, 11, 00, 00);
        expected.set(Calendar.MILLISECOND, 0);
        assertEquals(format(expected.getTimeInMillis()), format(actual));
    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetNextTimeMinutelyReturnsFirstSecondOfNextMinute() {
        PatternProcessor pp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PatternProcessor(
                &lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app-%d{yyyy-MM-dd-HH-mm}.log.gz&quot;&lt;/span&gt;);
        Calendar initial = Calendar.getInstance();
        initial.set(2014, 2, 4, 10, 31, 59); &lt;span class=&quot;code-comment&quot;&gt;// Tue, March 4, 2014, 10:31
&lt;/span&gt;        initial.set(Calendar.MILLISECOND, 0);
        assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;2014/03/04 10:31:59.000&quot;&lt;/span&gt;, format(initial.getTimeInMillis()));
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; actual = pp.getNextTime(initial.getTimeInMillis(), 1, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);

        &lt;span class=&quot;code-comment&quot;&gt;// expect Tue, March 4, 2014, 10:32
&lt;/span&gt;        Calendar expected = Calendar.getInstance();
        expected.set(2014, 2, 4, 10, 32, 00);
        expected.set(Calendar.MILLISECOND, 0);
        assertEquals(format(expected.getTimeInMillis()), format(actual));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13887741" author="remkop@yahoo.com" created="Fri, 31 Jan 2014 13:38:02 +0000"  >&lt;p&gt;Fixed the above issues with monthly, weekly, hourly and every-minute rollover in revision 1563132.&lt;/p&gt;

&lt;p&gt;Unfortunately, I was unable to reproduce the original issue reported in the description. I did not see a rollover zip file being created at application startup...&lt;/p&gt;

&lt;p&gt;Can you verify and close the issue if the problem no longer occurs with current trunk? (Please re-open if the issue still exists. In that case please also attach your log4j2.xml config to help me reproduce the issue.)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12603907" name="LOG4J2-385.patch" size="1073" author="ppartida" created="Wed, 18 Sep 2013 20:11:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1nsx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>347107</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>