<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:41:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3087] Race in JsonTemplateLayout where a timestamp could end up unquoted</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3087</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;There is a &quot;race&quot; when constructing a &lt;b&gt;&lt;tt&gt;JsonTemplateLayout&lt;/tt&gt;&lt;/b&gt; that can produce invalid JSON.&lt;/p&gt;

&lt;p&gt;In the constructor of&#160;&lt;b&gt;&lt;tt&gt;FormatResolverContext&lt;/tt&gt;&lt;/b&gt; the&#160;&lt;b&gt;&lt;tt&gt;formattedTimestampBuilder&lt;/tt&gt;&lt;/b&gt; is populated with a formated, but unquoted, timestamp based on the current time. Later in&#160;&lt;b&gt;&lt;tt&gt;FormatResolver.resolve()&lt;/tt&gt;&lt;/b&gt; we check if the log event matches the current time and use the cached value to&#160;&lt;b&gt;&lt;tt&gt;jsonWriter.writeRawString()&lt;/tt&gt;&lt;/b&gt;, which can be unquoted if the layout and log event was created in the same millisecond.&lt;/p&gt;

&lt;p&gt;Easy to reproduce with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.apache.logging.log4j.layout.template.json;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.LogEvent;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.config.Configuration;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.config.DefaultConfiguration;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.jupiter.api.RepeatedTest;

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JsonTemplateLayoutTimestampTest
{
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Configuration CONFIGURATION = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultConfiguration();

    @RepeatedTest( 20 )
    void test_timestamp_pattern_race() {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JsonTemplateLayout layout = JsonTemplateLayout
                .newBuilder()
                .setConfiguration(CONFIGURATION)
                .setEventTemplate(&lt;span class=&quot;code-quote&quot;&gt;&quot;{\&quot;&lt;/span&gt;t\&lt;span class=&quot;code-quote&quot;&gt;&quot;:{\&quot;&lt;/span&gt;$resolver\&lt;span class=&quot;code-quote&quot;&gt;&quot;:\&quot;&lt;/span&gt;timestamp\&lt;span class=&quot;code-quote&quot;&gt;&quot;,\&quot;&lt;/span&gt;pattern\&lt;span class=&quot;code-quote&quot;&gt;&quot;:{\&quot;&lt;/span&gt;format\&lt;span class=&quot;code-quote&quot;&gt;&quot;:\&quot;&lt;/span&gt;yyyy-MM-dd\&lt;span class=&quot;code-quote&quot;&gt;&quot;}}}&quot;&lt;/span&gt;)
                .build();

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LogEvent logEvent = LogEventFixture.createLiteLogEvents(1).get(0);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; json = layout.toSerializable(logEvent);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(json);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which can print&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-json&quot;&gt;
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2021-05-04&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:2021-05-04}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:2021-05-04}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:2021-05-04}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;t&quot;&lt;/span&gt;:2021-05-04}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;m working on a fix.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13376525">LOG4J2-3087</key>
            <summary>Race in JsonTemplateLayout where a timestamp could end up unquoted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vy">Volkan Yazici</assignee>
                                    <reporter username="klaren">Anton Klar&#233;n</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 May 2021 09:33:31 +0000</created>
                <updated>Thu, 13 May 2021 18:22:10 +0000</updated>
                            <resolved>Thu, 6 May 2021 09:11:24 +0000</resolved>
                                    <version>2.14.0</version>
                    <version>2.14.1</version>
                                    <fixVersion>3.0.0</fixVersion>
                    <fixVersion>2.15.0</fixVersion>
                                    <component>JsonTemplateLayout</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17340092" author="vy" created="Thu, 6 May 2021 09:00:28 +0000"  >&lt;p&gt;This fix needs to be cherry-picked onto &lt;tt&gt;master&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17340094" author="jira-bot" created="Thu, 6 May 2021 09:01:16 +0000"  >&lt;p&gt;Commit 9c230639dffc3c13b91a7194644e219825e6a84c in logging-log4j2&apos;s branch refs/heads/release-2.x from Anton Klar&#233;n&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=9c23063&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=9c23063&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3087&quot; title=&quot;Race in JsonTemplateLayout where a timestamp could end up unquoted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3087&quot;&gt;&lt;del&gt;LOG4J2-3087&lt;/del&gt;&lt;/a&gt; Fix race in JsonTemplateLayout where a timestamp could end up unquoted (#489)&lt;/p&gt;
</comment>
                            <comment id="17340106" author="jira-bot" created="Thu, 6 May 2021 09:10:16 +0000"  >&lt;p&gt;Commit ee3201d9a582a325547a26d2706c0f6160c868e9 in logging-log4j2&apos;s branch refs/heads/master from Anton Klar&#233;n&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ee3201d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ee3201d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3087&quot; title=&quot;Race in JsonTemplateLayout where a timestamp could end up unquoted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3087&quot;&gt;&lt;del&gt;LOG4J2-3087&lt;/del&gt;&lt;/a&gt; Fix race in JsonTemplateLayout where a timestamp could end up unquoted (#489)&lt;/p&gt;
</comment>
                            <comment id="17340108" author="vy" created="Thu, 6 May 2021 09:12:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=klaren&quot; class=&quot;user-hover&quot; rel=&quot;klaren&quot;&gt;klaren&lt;/a&gt;, thanks so much for both the report and the fix. I&apos;ve cherry-picked this onto &lt;tt&gt;master&lt;/tt&gt; too. Would you mind closing the ticket if the landed changes are okay with you?&lt;/p&gt;</comment>
                            <comment id="17340116" author="klaren" created="Thu, 6 May 2021 09:34:01 +0000"  >&lt;p&gt;Certainly, I tested the solution and it resolved our problems. And thank you for the swift response as well!&lt;/p&gt;</comment>
                            <comment id="17344056" author="jira-bot" created="Thu, 13 May 2021 18:22:10 +0000"  >&lt;p&gt;Commit ee3201d9a582a325547a26d2706c0f6160c868e9 in logging-log4j2&apos;s branch refs/heads/dependabot/maven/com.github.tomakehurst-wiremock-2.27.2 from Anton Klar&#233;n&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ee3201d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ee3201d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3087&quot; title=&quot;Race in JsonTemplateLayout where a timestamp could end up unquoted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3087&quot;&gt;&lt;del&gt;LOG4J2-3087&lt;/del&gt;&lt;/a&gt; Fix race in JsonTemplateLayout where a timestamp could end up unquoted (#489)&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0qpc0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>