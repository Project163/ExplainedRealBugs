<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:36:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1339] AsyncLogger should not call instanceof TimestampMessage in hot path</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1339</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;With &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-744&quot; title=&quot;Avoid unnecessary Clock calls when TimestampMessage is logged&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-744&quot;&gt;&lt;del&gt;LOG4J2-744&lt;/del&gt;&lt;/a&gt;, AsyncLogger attempts to get the time from the message by calling&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;millis = message &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; TimestampMessage ? ((TimestampMessage) message).getTimestamp() : CLOCK.currentTimeMillis()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;for every message. The vast majority of messages are not TimestampMessages so the time is eventually obtained from the clock. However, benchmarking shows that the &lt;tt&gt;instanceof&lt;/tt&gt; check is not free.&lt;/p&gt;

&lt;p&gt;It gives better performance (especially for simple fixed text log messages) to postpone the above logic to the background thread.&lt;/p&gt;

&lt;p&gt;Before:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java -Dlog4j2.enable.threadlocals=false -DAsyncLogger.RingBufferSize=262144  -jar benchmarks-2.6-varargs20160329.jar &quot;.AsyncLoggersBench.*&quot; -f 1 -wi 5 -i 10
Benchmark                                                Mode  Samples        Score        Error  Units
o.a.l.l.p.j.AsyncLoggersBenchmark.throughput3Params     thrpt       10  2536721.716 &#177; 346845.032  ops/s
o.a.l.l.p.j.AsyncLoggersBenchmark.throughput5Params     thrpt       10  2177187.778 &#177; 305779.317  ops/s
o.a.l.l.p.j.AsyncLoggersBenchmark.throughput7Params     thrpt       10  1749921.199 &#177; 274752.264  ops/s
o.a.l.l.p.j.AsyncLoggersBenchmark.throughput9Params     thrpt       10  1621232.163 &#177; 213933.235  ops/s
o.a.l.l.p.j.AsyncLoggersBenchmark.throughputSimple      thrpt       10  4734890.484 &#177; 495169.073  ops/s
o.a.l.l.p.j.AsyncLoggersBenchmark.latency3Params       sample   114628      401.673 &#177;      8.308  ns/op
o.a.l.l.p.j.AsyncLoggersBenchmark.latency5Params       sample    92326      491.471 &#177;     10.322  ns/op
o.a.l.l.p.j.AsyncLoggersBenchmark.latency7Params       sample   152204      583.759 &#177;      2.475  ns/op
o.a.l.l.p.j.AsyncLoggersBenchmark.latency9Params       sample   134818      658.336 &#177;     10.086  ns/op
o.a.l.l.p.j.AsyncLoggersBenchmark.latencySimple        sample   121357      264.867 &#177;      1.879  ns/op
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java -Dlog4j2.enable.threadlocals=false -DAsyncLogger.RingBufferSize=262144  -jar benchmarks-2.6-varargs20160330Tm.jar &quot;.AsyncLoggersBench.*&quot; -f 1 -wi 5 -i 10
Benchmark                                                Mode  Samples        Score        Error  Units
o.a.l.l.p.j.AsyncLoggersBenchmark.throughput3Params     thrpt       10  3024631.638 &#177; 603690.008  ops/s
o.a.l.l.p.j.AsyncLoggersBenchmark.throughput5Params     thrpt       10  2075676.591 &#177; 565118.526  ops/s
o.a.l.l.p.j.AsyncLoggersBenchmark.throughput7Params     thrpt       10  1941322.235 &#177; 294362.669  ops/s
o.a.l.l.p.j.AsyncLoggersBenchmark.throughput9Params     thrpt       10  1731353.147 &#177; 292176.130  ops/s
o.a.l.l.p.j.AsyncLoggersBenchmark.throughputSimple      thrpt       10  5247737.873 &#177; 498790.784  ops/s
o.a.l.l.p.j.AsyncLoggersBenchmark.latency3Params       sample   136170      333.617 &#177;      8.183  ns/op
o.a.l.l.p.j.AsyncLoggersBenchmark.latency5Params       sample   108236      496.328 &#177;      2.497  ns/op
o.a.l.l.p.j.AsyncLoggersBenchmark.latency7Params       sample   144521      632.009 &#177;      2.825  ns/op
o.a.l.l.p.j.AsyncLoggersBenchmark.latency9Params       sample   137998      776.229 &#177;    433.813  ns/op
o.a.l.l.p.j.AsyncLoggersBenchmark.latencySimple        sample   106458      234.457 &#177;      8.377  ns/op
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12954648">LOG4J2-1339</key>
            <summary>AsyncLogger should not call instanceof TimestampMessage in hot path</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="rpopma">Remko Popma</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Mar 2016 14:32:33 +0000</created>
                <updated>Wed, 30 Mar 2016 15:23:35 +0000</updated>
                            <resolved>Wed, 30 Mar 2016 15:23:29 +0000</resolved>
                                    <version>2.0.1</version>
                    <version>2.0.2</version>
                    <version>2.1</version>
                    <version>2.2</version>
                    <version>2.3</version>
                    <version>2.4</version>
                    <version>2.4.1</version>
                    <version>2.5</version>
                                    <fixVersion>2.6</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15218088" author="remkop@yahoo.com" created="Wed, 30 Mar 2016 14:56:14 +0000"  >&lt;p&gt;Fixed in master.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12729648">LOG4J2-744</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vel3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>