<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:34:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1068] Exceptions not logged when using TcpSocketServer + SerializedLayout</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1068</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;This issue was reported in BugZilla bug 57036: &lt;a href=&quot;https://bz.apache.org/bugzilla/show_bug.cgi?id=57036&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bz.apache.org/bugzilla/show_bug.cgi?id=57036&lt;/a&gt;.   The description there covers the problem well:&lt;/p&gt;

&lt;p&gt;&quot;... in the Method format(final LogEvent event, final StringBuilder toAppendTo) in ExtendedThrowablePatternConverter writing the Stacktrace in the logfile on condition that the Throwable throwable from Log4jLogEvent is not null, but on the Socketserver the Throwable throwable is always null, because it&apos;s defined as transient.&quot;&lt;/p&gt;

&lt;p&gt;I couldn&apos;t find the bug here in Jira, so I&apos;m reporting again in case it has been lost in the migration.&lt;/p&gt;

&lt;p&gt;It&apos;s a major problem with a simple fix, so seems like it should be a high priority.&lt;/p&gt;

&lt;p&gt;I&apos;ve worked around it for now by plugging in my own ExtendedThrowablePatternConverter.  My fix is to change this line:&lt;/p&gt;

&lt;p&gt;if (throwable != null &amp;amp;&amp;amp; options.anyLines() {&lt;/p&gt;

&lt;p&gt;to this:&lt;/p&gt;

&lt;p&gt;if ((throwable != null || proxy != null) &amp;amp;&amp;amp; options.anyLines()) {&lt;/p&gt;</description>
                <environment></environment>
        <key id="12840139">LOG4J2-1068</key>
            <summary>Exceptions not logged when using TcpSocketServer + SerializedLayout</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="andy@andymcm.com">Andy McMullan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Jun 2015 09:11:30 +0000</created>
                <updated>Fri, 10 Jul 2015 22:34:02 +0000</updated>
                            <resolved>Wed, 24 Jun 2015 21:45:57 +0000</resolved>
                                    <version>2.1</version>
                    <version>2.2</version>
                    <version>2.3</version>
                                    <fixVersion>2.4</fixVersion>
                                    <component>Pattern Converters</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14599505" author="garydgregory" created="Wed, 24 Jun 2015 14:39:26 +0000"  >&lt;p&gt;Could you please provide a patch with a unit test?&lt;/p&gt;</comment>
                            <comment id="14600171" author="andy@andymcm.com" created="Wed, 24 Jun 2015 21:20:44 +0000"  >&lt;p&gt;I have attached a patch.&lt;/p&gt;</comment>
                            <comment id="14600211" author="garydgregory" created="Wed, 24 Jun 2015 21:45:57 +0000"  >&lt;p&gt;Andy,&lt;/p&gt;

&lt;p&gt;Thank you for your patch!&lt;/p&gt;

&lt;p&gt;Please verify and close.&lt;/p&gt;

&lt;p&gt;Keep&apos;em coming...&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="14600252" author="andy@andymcm.com" created="Wed, 24 Jun 2015 22:08:03 +0000"  >&lt;p&gt;Looks good, thanks.&lt;/p&gt;</comment>
                            <comment id="14600274" author="garydgregory" created="Wed, 24 Jun 2015 22:22:47 +0000"  >&lt;p&gt;YW, got more?&lt;/p&gt;</comment>
                            <comment id="14622834" author="hsyn" created="Fri, 10 Jul 2015 20:04:28 +0000"  >
&lt;p&gt;I got more. The applied patch seems not enough to fix.&lt;/p&gt;

&lt;p&gt;Please ReOpen.&lt;/p&gt;


&lt;p&gt;Below a stackTrace for better understanding.&lt;/p&gt;


&lt;p&gt;As you can see i use also a Patched version of the ExtendedThrowablePatternConverter.&lt;/p&gt;

&lt;p&gt;In the following processing the ThrowableProxy try to access this.causeProxy.getThrowable() which is also null because its transient.&lt;/p&gt;

&lt;p&gt;2015-07-10 21:01:59,395 ERROR An exception occurred processing Appender OUT java.lang.NullPointerException&lt;br/&gt;
	at org.apache.logging.log4j.core.impl.ThrowableProxy.formatCause(ThrowableProxy.java:190)&lt;br/&gt;
	at org.apache.logging.log4j.core.impl.ThrowableProxy.getExtendedStackTraceAsString(ThrowableProxy.java:347)&lt;br/&gt;
-&amp;gt;	at org.apache.logging.log4j.extending.PatchedExtendedThrowablePatternConverter.format(PatchedExtendedThrowablePatternConverter.java:54)&lt;br/&gt;
	at org.apache.logging.log4j.core.pattern.PatternFormatter.format(PatternFormatter.java:36)&lt;br/&gt;
	at org.apache.logging.log4j.core.layout.PatternLayout.toSerializable(PatternLayout.java:196)&lt;br/&gt;
	at org.apache.logging.log4j.core.layout.PatternLayout.toSerializable(PatternLayout.java:55)&lt;br/&gt;
	at org.apache.logging.log4j.core.layout.AbstractStringLayout.toByteArray(AbstractStringLayout.java:71)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.append(AbstractOutputStreamAppender.java:108)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.RollingRandomAccessFileAppender.append(RollingRandomAccessFileAppender.java:98)&lt;br/&gt;
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:99)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.AsyncAppender$AsyncThread.callAppenders(AsyncAppender.java:290)&lt;br/&gt;
	at org.apache.logging.log4j.core.appender.AsyncAppender$AsyncThread.run(AsyncAppender.java:241)&lt;/p&gt;


&lt;p&gt;For Unit test log the following Exception to a SocketAppender. Maybe u can use Andy&apos;s test case.&lt;/p&gt;

&lt;p&gt;       Configuration of my the SocketAppender&lt;/p&gt;

&lt;p&gt;       &amp;lt;Appender type=&quot;Socket&quot; name=&quot;OUT-SOCKET&quot; host=&quot;${sys:log.host}&quot; port=&quot;${sys:log.port}&quot; protocol=&quot;${sys:log.protocol}&quot;&amp;gt;&lt;br/&gt;
              &amp;lt;Layout type=&quot;JsonLayout&quot; compact=&quot;true&quot; eventEol=&quot;true&quot; complete=&quot;true&quot; properties=&quot;true&quot; /&amp;gt;&lt;br/&gt;
       &amp;lt;/Appender&amp;gt;&lt;/p&gt;



&lt;p&gt;    @Test&lt;br/&gt;
    public final void testThrowableProxyOnServer() &lt;/p&gt;
{

        Logger logger = LogManager.getLogger();

        IllegalArgumentException cause = new IllegalArgumentException();
        cause.setStackTrace(Thread.currentThread().getStackTrace());

        IllegalArgumentException exception = new IllegalArgumentException(cause.getMessage(), cause);
        exception.setStackTrace(Thread.currentThread().getStackTrace());

        logger.catching(exception);
    }


&lt;p&gt;I sorry, but i have no patch for this issue, but i assume ThrowableProxy should not use Throwable instances direct at all.&lt;/p&gt;

&lt;p&gt;H&#252;seyin&lt;/p&gt;</comment>
                            <comment id="14622928" author="andy@andymcm.com" created="Fri, 10 Jul 2015 21:40:43 +0000"  >&lt;p&gt;I think this problem has already been fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1067&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LOG4J2-1067&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14623000" author="garydgregory" created="Fri, 10 Jul 2015 22:34:02 +0000"  >&lt;p&gt;Can you test by building from the Git master, or download a SNAPSHOT?&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12741700" name="patch.txt" size="2993" author="andy@andymcm.com" created="Wed, 24 Jun 2015 21:20:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 19 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gfa7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>