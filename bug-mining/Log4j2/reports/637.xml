<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:35:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1178] Support use-case for JDBC&apos;s CommonDataSource.setLogWriter(PrintWriter) and java.sql.DriverManager.setLogWriter(PrintWriter)</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1178</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I am writing a JDBC driver. The JDBC Spec has a a method &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/javax/sql/CommonDataSource.html#setLogWriter-java.io.PrintWriter-&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DataSource.setLogWriter(PrintStream)&lt;/a&gt; API drivers should implement.&lt;/p&gt;

&lt;p&gt;Users can drop our driver into any tool that talks JDBC or write their own apps. In am concerned about the &apos;drop the driver anywhere&apos; scenario, like in an Eclipse based tool; that may or may not use Eclipse DTP. Or anything else.&lt;/p&gt;

&lt;p&gt;The &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/javax/sql/CommonDataSource.html#setLogWriter-java.io.PrintWriter-&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;setLogWriter()&lt;/a&gt; API can be called at any time, after Log4j has initialized itself for example.&lt;/p&gt;

&lt;p&gt;I do all my driver logging through Log4j. If a tool calls &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/javax/sql/CommonDataSource.html#setLogWriter-java.io.PrintWriter-&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;setLogWriter()&lt;/a&gt;, I&apos;d like the given PrintStream to become an Appender such that Log4j output appears there.&lt;/p&gt;

&lt;p&gt;The only way I see to do that is through pseudo-code like &quot;getLoggerContext().getConfiguration().addAppender(PrintStreamAppender.createPrintStreamAppender(aPrintStream))&quot;&lt;/p&gt;

&lt;p&gt;I think that would need to be followed by a full reconfigure.&lt;/p&gt;

&lt;p&gt;Can we use our new builder API to add to the current config and reconfigure?&lt;/p&gt;

&lt;p&gt;This also applies to &lt;tt&gt;java.sql.DriverManager.setLogWriter(PrintWriter)&lt;/tt&gt; and &lt;tt&gt;java.sql.DriverManager.setLogStream(PrintStream)&lt;/tt&gt;&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Apache Maven 3.3.3 (7994120775791599e205a5524ec3e0dfe41d4a06; 2015-04-22T04:57:37-07:00)&lt;br/&gt;
Maven home: C:\Java\apache-maven-3.3.3\bin\..&lt;br/&gt;
Java version: 1.7.0_79, vendor: Oracle Corporation&lt;br/&gt;
Java home: C:\Program Files\Java\jdk1.7.0_79\jre&lt;br/&gt;
Default locale: en_US, platform encoding: Cp1252&lt;br/&gt;
OS name: &quot;windows 7&quot;, version: &quot;6.1&quot;, arch: &quot;amd64&quot;, family: &quot;windows&quot;&lt;/p&gt;</environment>
        <key id="12907784">LOG4J2-1178</key>
            <summary>Support use-case for JDBC&apos;s CommonDataSource.setLogWriter(PrintWriter) and java.sql.DriverManager.setLogWriter(PrintWriter)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="ggregory">Gary D. Gregory</reporter>
                        <labels>
                    </labels>
                <created>Sun, 25 Oct 2015 22:49:23 +0000</created>
                <updated>Sun, 1 Nov 2015 21:58:26 +0000</updated>
                            <resolved>Sun, 1 Nov 2015 21:58:26 +0000</resolved>
                                                    <fixVersion>2.5</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14973481" author="ralph.goers@dslextreme.com" created="Sun, 25 Oct 2015 23:13:13 +0000"  >&lt;p&gt;What your suggesting just doesn&apos;t feel right to me.  A Logger is an abstraction that generates an event and has no idea where it is going to end up.  An Appender takes events and writes them to a specific destination.  setLogWriter(PrintStream) doesn&apos;t really sound like a &quot;logging&quot; API at all in that it is directly tying output to the destination.&lt;/p&gt;

&lt;p&gt;Also, I am not sure reconfiguration makes sense to do this. What are you going to reconfigure it to do? A PrintStream to what destination?&lt;/p&gt;

&lt;p&gt;What you could is access the OutputStream from an existing Appender and wrap it with a PrintStream.&lt;/p&gt;</comment>
                            <comment id="14973500" author="garydgregory" created="Sun, 25 Oct 2015 23:43:45 +0000"  >&lt;p&gt;One thing to keep in mind is that JDBC is an old API suffering from all sorts of ills and oddness.&lt;/p&gt;

&lt;p&gt;When an application calls DataSource.setLogWriter(PW), it is asking the driver to log to that destination. JDBC knows nothing of logging frameworks.&lt;/p&gt;

&lt;p&gt;My driver uses Log4j 2, so that&apos;s OK.&lt;/p&gt;

&lt;p&gt;If a user drops the driver into a tool that knows nothing of Log4j and uses std JDBC, it will call &lt;tt&gt;setLogWriter()&lt;/tt&gt; and give it a &lt;tt&gt;PrintWriter&lt;/tt&gt; for its own console for example. The user would rightly expect logging to appear on this PW. So how do I do that? In this case, I want the driver to tell Log4j that the given PW should be an appender. This way, when the driver logs to Log4j, one of the places logging will appear is the PW.&lt;/p&gt;</comment>
                            <comment id="14973515" author="remkop@yahoo.com" created="Mon, 26 Oct 2015 00:13:58 +0000"  >&lt;p&gt;I thought this use case was why we introduced the log4j-io module. Why does that module not solve the problem?&lt;/p&gt;</comment>
                            <comment id="14973521" author="garydgregory" created="Mon, 26 Oct 2015 00:28:06 +0000"  >&lt;p&gt;What the IO module solves is how to turn a stream into a source of log events. This is good to use with JDBC drivers that do not use a logging framework and really do use a PrintStream/PrintWriter for logging.&lt;/p&gt;

&lt;p&gt;The use-case I mention now is different and kind of the other way around: I want log events to go to a given PrintWriter (in addition to whatever Log4j is configured to do). The PW can be set after Log4j has been initialized.&lt;/p&gt;</comment>
                            <comment id="14973822" author="ralph.goers@dslextreme.com" created="Mon, 26 Oct 2015 06:51:34 +0000"  >&lt;p&gt;What you are doing is really subverting the logging framework. You also didn&apos;t answer my questions. What are you going to reconfigure it to do? A PrintStream to what destination? Why isn&apos;t getting access to the OutputStream enough?&lt;/p&gt;</comment>
                            <comment id="14973863" author="garydgregory" created="Mon, 26 Oct 2015 07:42:41 +0000"  >&lt;p&gt;The given PrintStream (for JDBC 1.0) or the PrintWriter for a newer JDBC driver &lt;b&gt;is&lt;/b&gt; the destination. I&apos;m not sure how to explain it without just repeating what I wrote earlier. This would have the effect &amp;#8211; from the end user&apos;s POV &amp;#8211; of adding an appender (to the given stream) dynamically. Whether or not Log4j does a full reconfigure internally would be an implementation detail.&lt;/p&gt;</comment>
                            <comment id="14974172" author="ralph.goers@dslextreme.com" created="Mon, 26 Oct 2015 13:07:50 +0000"  >&lt;p&gt;Saying a PrintStrem is the destination is like saying you get in your car and start driving and you have arrived at your destination even though the car is still moving. Where it could end up is anybody&apos;s guess.&lt;/p&gt;

&lt;p&gt;The bytes from the stream have to end up somewhere, a socket, a file or something. The PrintStream is just the road to get there. And just like with driving you have to pick what the destination is before you start driving or else it will likely get lost.&lt;/p&gt;</comment>
                            <comment id="14974697" author="garydgregory" created="Mon, 26 Oct 2015 18:08:53 +0000"  >&lt;p&gt;The PrintStream or PrintWriter is passed to the JDBC API implemented by the JDBC driver. Log4j does not need to know any more than that; and there is no point in it knowing more, the driver needs to cause Log4j to publish log events to this stream. The driver&apos;s setLogWriter(PrintStream|PrintWriter) can decide on the layout or just let the default kick in. The pseudo code could be:&lt;/p&gt;

&lt;p&gt;getLoggerContext().getConfiguration().addAppender(PrintStreamAppender.createPrintStreamAppender(aPrintStream, myLayoutOrNone))&lt;br/&gt;
getLoggerContext().getConfiguration().reconfigure()?&lt;br/&gt;
// Or use the new builder API?&lt;/p&gt;

&lt;p&gt;The PS/PW could end up going to a file, the console, a text pane, who knows, but that does not matter here. What matters is that the driver can find a way to publish its log events to this stream.&lt;/p&gt;


</comment>
                            <comment id="14974843" author="ralph.goers@dslextreme.com" created="Mon, 26 Oct 2015 19:06:47 +0000"  >&lt;p&gt;OK.  So now I understand that the JDBC driver wants to add a new destination to write to. How does it get written to?  Is the JDBC driver using the Log4j API?  I don&apos;t see you configuring any Loggers to use the appender you added. So how will events end up being routed to the appender. If you are adding Loggers how are you going to know the names to add? &lt;/p&gt;

&lt;p&gt;Also, I don&apos;t see how you can pass a Layout.  The Appender is accepting a PrintStream - which implies that it has already been formatted (there is no logging event to format).&lt;/p&gt;

&lt;p&gt;I still feel like I must be missing something.&lt;/p&gt;</comment>
                            <comment id="14975005" author="garydgregory" created="Mon, 26 Oct 2015 20:42:34 +0000"  >&lt;p&gt;My JDBC driver uses Log4j 2 internally, yes, so I&apos;ve got that going for me, which is nice. The driver is configured more or less normally, either with a log4j2.xml file on the classpath, and so on, the usual Log4j way. Or, the end-use can pass in a &quot;LogConfiguration&quot; property in a driver connection string. For completeness&apos; sake, If the user gives me a LogConfiguration in the connect string I do:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void configure(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; configLocation) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Strings.isNotBlank(configLocation)) {            
            Configurator.initialize(DvConstants.ROOT_PACKAGE, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, Strings.toURI(configLocation));
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is an example of a setLogWriter(PrintWriter) method that could be the basis for my solution:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LoggerContext context = LoggerContext.getContext(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Configuration configuration = context.getConfiguration();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PatternLayout layout = PatternLayout.newBuilder().withConfiguration(configuration).build();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Appender appender = ConsoleAppender.createDefaultAppenderForLayout(layout);
        configuration.addAppender(appender);
        Configurator.initialize(configuration);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Instead of:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Appender appender = ConsoleAppender.createDefaultAppenderForLayout(layout);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;d need:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Appender appender = PrintWriterAppender.createDefaultAppender(printWriter, layout);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(The &quot;ForLayout&quot; in the method name is superfluous.)&lt;/p&gt;

&lt;p&gt;In fact, I am guessing that this appender would be a simpler version of the current ConsoleAppender and would not need to be a Plugin.&lt;/p&gt;</comment>
                            <comment id="14984569" author="garydgregory" created="Sun, 1 Nov 2015 21:58:26 +0000"  >&lt;p&gt;In Git master.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12909511">LOG4J2-1187</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 3 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ni0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>