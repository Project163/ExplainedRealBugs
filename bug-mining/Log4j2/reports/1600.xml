<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:42:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3490] Inconsistent counting in DirectWriteRolloverStrategy</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3490</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;When several log files already exist, DirectWriteRolloverStrategy has an inconsistent counting after restart. E.g. if maxFiles = 2 and in the log folder there are two files app-21.log &#160;app-22.log, then the first created file is app-2.log.&lt;/p&gt;

&lt;p&gt;After a rollover, the next created file name is OK.&lt;/p&gt;

&lt;p&gt;Example configuration&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;Configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;warn&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;MyApp&quot;&lt;/span&gt; packages=&quot;&quot;&amp;gt;
&#160; &#160; &amp;lt;Appenders&amp;gt;
&#160; &#160; &#160; &#160; &amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;RollingFile&quot;&lt;/span&gt;
&#160; &#160; &#160; &#160; &#160; &#160; filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;logs/app-%i.log&quot;&lt;/span&gt;&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;PatternLayout&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;Pattern&amp;gt;%d %p %c{1.} [%t] %m%n&amp;lt;/Pattern&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;/PatternLayout&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;Policies&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;1 kB&quot;&lt;/span&gt; /&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;/Policies&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;DirectWriteRolloverStrategy maxFiles=&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt; /&amp;gt;
&#160; &#160; &#160; &#160; &amp;lt;/RollingFile&amp;gt;
&#160; &#160; &amp;lt;/Appenders&amp;gt;
&#160; &#160; &amp;lt;Loggers&amp;gt;
&#160; &#160; &#160; &#160; &amp;lt;Root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;&amp;gt;
&#160; &#160; &#160; &#160; &#160; &#160; &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;RollingFile&quot;&lt;/span&gt; /&amp;gt;
&#160; &#160; &#160; &#160; &amp;lt;/Root&amp;gt;
&#160; &#160; &amp;lt;/Loggers&amp;gt;
&amp;lt;/Configuration&amp;gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Just run following Java application several times and you will encounter the effect after building up a log file history.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; log4jtest;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.LogManager;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.Logger;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;LogTest
{
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Logger logger = LogManager.getLogger(&lt;span class=&quot;code-quote&quot;&gt;&quot;HelloWorld&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 15; i++) {
&#160; &#160; &#160; &#160; &#160; &#160; logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hello, World!&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; }
&#160; &#160; }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;May be caused by line 317 of DirectWriteRolloverStrategy&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; fileIndex = eligibleFiles.size() &amp;gt; 0 ? (nextIndex &amp;gt; 0 ? nextIndex : eligibleFiles.size()) : 1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which defaults to the number of files when nextIndex is not initialized.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Running test application 5 times&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;C:\misc\pt1\ws\log4jtest\logs&amp;gt;ls &lt;br/&gt;
app-1.log&lt;/p&gt;

&lt;p&gt;C:\misc\pt1\ws\log4jtest\logs&amp;gt;ls &lt;br/&gt;
app-1.log &#160;app-2.log&lt;/p&gt;

&lt;p&gt;C:\misc\pt1\ws\log4jtest\logs&amp;gt;ls &lt;br/&gt;
app-2.log &#160;app-3.log&lt;/p&gt;

&lt;p&gt;C:\misc\pt1\ws\log4jtest\logs&amp;gt;ls &lt;br/&gt;
app-3.log &#160;app-4.log&lt;/p&gt;

&lt;p&gt;C:\misc\pt1\ws\log4jtest\logs&amp;gt;ls &lt;br/&gt;
&lt;em&gt;&lt;b&gt;app-2.log&lt;/b&gt;&lt;/em&gt; &#160;app-3.log &#160;app-4.log &lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13441752">LOG4J2-3490</key>
            <summary>Inconsistent counting in DirectWriteRolloverStrategy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="H.Noemmer@znt.de">Hans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Apr 2022 09:10:18 +0000</created>
                <updated>Thu, 16 Jun 2022 10:04:15 +0000</updated>
                            <resolved>Tue, 31 May 2022 06:24:37 +0000</resolved>
                                    <version>2.17.2</version>
                                    <fixVersion>2.18.0</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17544141" author="jira-bot" created="Tue, 31 May 2022 05:52:57 +0000"  >&lt;p&gt;Commit 1ab0788f61e6d396afc27c28e0cd9063deaa6e13 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=1ab0788f61&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=1ab0788f61&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3490&quot; title=&quot;Inconsistent counting in DirectWriteRolloverStrategy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3490&quot;&gt;&lt;del&gt;LOG4J2-3490&lt;/del&gt;&lt;/a&gt; - The DirectWriteRolloverStrategy was not detecting the correct index to use during startup&lt;/p&gt;</comment>
                            <comment id="17544146" author="jira-bot" created="Tue, 31 May 2022 06:23:46 +0000"  >&lt;p&gt;Commit c294a79f31785d237cd7ebbb910bd8f36292b48c in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=c294a79f31&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=c294a79f31&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3490&quot; title=&quot;Inconsistent counting in DirectWriteRolloverStrategy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3490&quot;&gt;&lt;del&gt;LOG4J2-3490&lt;/del&gt;&lt;/a&gt; - The DirectWriteRolloverStrategy was not detecting the correct index to use during startup&lt;/p&gt;</comment>
                            <comment id="17544147" author="ralph.goers@dslextreme.com" created="Tue, 31 May 2022 06:24:37 +0000"  >&lt;p&gt;Patch applied. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="17555004" author="jira-bot" created="Thu, 16 Jun 2022 10:04:15 +0000"  >&lt;p&gt;Commit 1ab0788f61e6d396afc27c28e0cd9063deaa6e13 in logging-log4j2&apos;s branch refs/heads/dependabot/maven/org.junit-pioneer-junit-pioneer-1.7.1 from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=1ab0788f61&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=1ab0788f61&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3490&quot; title=&quot;Inconsistent counting in DirectWriteRolloverStrategy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3490&quot;&gt;&lt;del&gt;LOG4J2-3490&lt;/del&gt;&lt;/a&gt; - The DirectWriteRolloverStrategy was not detecting the correct index to use during startup&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 21 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z11tfk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>