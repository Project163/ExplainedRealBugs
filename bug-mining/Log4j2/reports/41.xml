<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:30:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-129] RoutingAppender dynamic appender creation only creates 1</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-129</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I was looking through the new appenders and found RoutingAppender which intrigued me&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://logging.apache.org/log4j/2.x/manual/appenders.html#RoutingAppender&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://logging.apache.org/log4j/2.x/manual/appenders.html#RoutingAppender&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From the documentation it seems that the RoutingAppender would create a new appender dynamically every time the key didn&apos;t match an existing appender name.  However when testing this I find it only creates the first dynamically and then reuses that one as it is set to default.  That doesn&apos;t seem what I would expect.  My example code is as the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestRouting {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        ThreadContext.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;filename&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;foo.bar&quot;&lt;/span&gt;);
        _logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;TEST&quot;&lt;/span&gt;);
        ThreadContext.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;filename&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;foo.bar2&quot;&lt;/span&gt;);
        _logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;TEST2&quot;&lt;/span&gt;);
        ThreadContext.remove(&lt;span class=&quot;code-quote&quot;&gt;&quot;filename&quot;&lt;/span&gt;);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Logger _logger = LogManager.getLogger(TestRouting.class);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is the log4j2 xml file it picks up.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;configuration&amp;gt;
  &amp;lt;appenders&amp;gt;
    &amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/Console&amp;gt;
  
    &amp;lt;Routing name=&lt;span class=&quot;code-quote&quot;&gt;&quot;RoutingAppender&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;Routes pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;${ctx:filename}&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;Route&amp;gt;
          &amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Rolling-${ctx:filename}&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;${ctx:filename}&quot;&lt;/span&gt;
                       filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;${ctx:filename}.%i.log.gz&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;PatternLayout&amp;gt;
              &amp;lt;pattern&amp;gt;%d %p %C{1.} [%t] %m%n&amp;lt;/pattern&amp;gt;
            &amp;lt;/PatternLayout&amp;gt;
            &amp;lt;SizeBasedTriggeringPolicy size=&lt;span class=&quot;code-quote&quot;&gt;&quot;500&quot;&lt;/span&gt; /&amp;gt;
          &amp;lt;/RollingFile&amp;gt;
        &amp;lt;/Route&amp;gt;
      
        &amp;lt;!-- By having &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; set to ${ctx:filename} it will match when filename
             is not set in the context --&amp;gt;
        &amp;lt;Route ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt; key=&lt;span class=&quot;code-quote&quot;&gt;&quot;${ctx:filename}&quot;&lt;/span&gt;/&amp;gt;
      
      &amp;lt;/Routes&amp;gt;
    &amp;lt;/Routing&amp;gt;
  &amp;lt;/appenders&amp;gt;
    
  &amp;lt;loggers&amp;gt;
    &amp;lt;root level=&lt;span class=&quot;code-quote&quot;&gt;&quot;info&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;appender-ref ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;RoutingAppender&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/root&amp;gt;
  &amp;lt;/loggers&amp;gt;
&amp;lt;/configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I run the test though it only creates 1 file/appender with the name foo.bar and logs both messages to it.  I would expect that it creates 2 files where each gets the different message.&lt;/p&gt;

&lt;p&gt;Is there something I am missing about this or is this the intended behavior?&lt;/p&gt;

&lt;p&gt;I have a change that gets it working, however part of it is hack and would need to be updated to the best alternative.  Also I had to change BaseConfiguration slightly to make a defensive copy of the attributes.  It seemed that was fine, otherwise the Route cannot be reused to make another appender if it blows away the attributes, don&apos;t know if that will affect other things though.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12618201">LOG4J2-129</key>
            <summary>RoutingAppender dynamic appender creation only creates 1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="rpwburns">William Burns</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Nov 2012 19:22:19 +0000</created>
                <updated>Mon, 14 Jan 2013 19:12:54 +0000</updated>
                            <resolved>Sat, 1 Dec 2012 22:49:20 +0000</resolved>
                                    <version>2.0-beta3</version>
                                    <fixVersion>2.0-beta4</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13506699" author="rpwburns" created="Thu, 29 Nov 2012 19:24:20 +0000"  >&lt;p&gt;Patch with changes to get it working to create multiple appenders.&lt;/p&gt;</comment>
                            <comment id="13507219" author="feltes" created="Fri, 30 Nov 2012 09:33:06 +0000"  >&lt;p&gt;When I read the documentation I also thought that a new appender should dynamically be created for each unkown key.&lt;/p&gt;

&lt;p&gt;Instead of changing the BaseConfiguration, I think the node should be cloned before the appender is created. Please find an updated patch attached.&lt;/p&gt;</comment>
                            <comment id="13508088" author="ralph.goers@dslextreme.com" created="Sat, 1 Dec 2012 22:49:20 +0000"  >&lt;p&gt;The problem was that the code was treating the Appender being created under the default Route as the default. That is incorrect. The code has been modified to just keep track of the default route.&lt;/p&gt;

&lt;p&gt;Note that the configuration in your example is incorrect in that the key for &quot;Console&quot; needs to be a value and not a variable. In addition, the variable declaration in the Routes pattern should be $${ctx:filename}.&lt;/p&gt;

&lt;p&gt;You can look at log4j-routing.xml for an example, however it is similar to the documentation on the web site.&lt;/p&gt;

&lt;p&gt;Please verify and close.&lt;/p&gt;</comment>
                            <comment id="13508277" author="feltes" created="Sun, 2 Dec 2012 14:17:25 +0000"  >&lt;p&gt;The implementation seems to work correctly now, but the test cleans up the wrong files. See attached patch.&lt;/p&gt;</comment>
                            <comment id="13553008" author="rpwburns" created="Mon, 14 Jan 2013 19:12:54 +0000"  >&lt;p&gt;Just reread your comment again.&lt;/p&gt;

&lt;p&gt;I wanted to clarify on the Console Appender using a variable for the key.  The reason is because the replacement won&apos;t occur if the context value isn&apos;t present so then the console will be matched to thread contexts that don&apos;t have a value set for filename in this case.  Is there a better way you can recommend?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12555489" name="LOG4J2-129-RoutingAppender.patch" size="8444" author="feltes" created="Fri, 30 Nov 2012 09:33:06 +0000"/>
                            <attachment id="12555668" name="LOG4J2-129-RoutingAppenderTest.patch" size="1213" author="feltes" created="Sun, 2 Dec 2012 14:17:25 +0000"/>
                            <attachment id="12555388" name="patch" size="6431" author="rpwburns" created="Thu, 29 Nov 2012 19:24:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>292829</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0setz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163879</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>