<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:40:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2527] concurrent modification exception when using list appender</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2527</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Maybe this is intended and expected, but in case it is not I thought I report it.&lt;br/&gt;
When you use the &lt;tt&gt;ListAppender&lt;/tt&gt; and then when you verify the log events using some iteration like streams or in Groovy (using Spock) like &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ListAppender.getListAppender(&lt;span class=&quot;code-quote&quot;&gt;&apos;Test Appender&apos;&lt;/span&gt;).events.findAll { it.thrown }.each { &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; it.thrown }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; and while you iterate there are new log events, you get concurrent modification exceptions as the returned list (also for other methods like &lt;tt&gt;getMessages&lt;/tt&gt; or &lt;tt&gt;getData&lt;/tt&gt;) is backed by the original list when you use `Collections.unmodifiableList`.&lt;/p&gt;

&lt;p&gt;If this is not expected, maybe it should instead return a copy of the underlying collections. If it is intended, maybe a second set of methods would make sense that return a snapshot at call time.&lt;/p&gt;

&lt;p&gt;My current workaround is to copy the returned list like &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;(ListAppender.getListAppender(&lt;span class=&quot;code-quote&quot;&gt;&apos;Test Appender&apos;&lt;/span&gt;).events).findAll { it.thrown }.each { &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; it.thrown }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13206687">LOG4J2-2527</key>
            <summary>concurrent modification exception when using list appender</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ckozak">Carter Kozak</assignee>
                                    <reporter username="vampire">Bj&#246;rn Kautler</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Dec 2018 21:32:05 +0000</created>
                <updated>Sun, 30 Dec 2018 18:46:29 +0000</updated>
                            <resolved>Sun, 30 Dec 2018 18:46:03 +0000</resolved>
                                    <version>2.11.1</version>
                                    <fixVersion>3.0.0</fixVersion>
                    <fixVersion>2.11.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="16730993" author="ckozak" created="Sun, 30 Dec 2018 15:14:00 +0000"  >&lt;p&gt;Thank you for the report, I agree that this is odd.&lt;br/&gt;
This should do the trick! &lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/247&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/247&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16731046" author="jira-bot" created="Sun, 30 Dec 2018 18:42:33 +0000"  >&lt;p&gt;Commit 17fde24e612e2e1bceff0e111c48d1e5b23a69e3 in logging-log4j2&apos;s branch refs/heads/release-2.x from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=17fde24&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=17fde24&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2527&quot; title=&quot;concurrent modification exception when using list appender&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2527&quot;&gt;&lt;del&gt;LOG4J2-2527&lt;/del&gt;&lt;/a&gt;: ListAppender getters return immutable snapshots&lt;/p&gt;

&lt;p&gt;Provides a bit more thread safety to ListAppender. The class&lt;br/&gt;
is marked not-thread-safe, however this functionality is&lt;br/&gt;
important for testing, particularly when asynchronous logging is&lt;br/&gt;
configured.&lt;/p&gt;

&lt;p&gt;Previously we returned unmodifiable wrappers around the internal&lt;br/&gt;
state, which can be dangerous to iterate over while events are&lt;br/&gt;
actively logged.&lt;/p&gt;

&lt;p&gt;State is tracked in synchronized lists, which should be safer&lt;br/&gt;
than synchronizing on individual methods.&lt;/p&gt;</comment>
                            <comment id="16731047" author="jira-bot" created="Sun, 30 Dec 2018 18:43:21 +0000"  >&lt;p&gt;Commit 8cd0ef5b294319c579ae1f692eff3c9535aaf564 in logging-log4j2&apos;s branch refs/heads/master from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=8cd0ef5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=8cd0ef5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2527&quot; title=&quot;concurrent modification exception when using list appender&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2527&quot;&gt;&lt;del&gt;LOG4J2-2527&lt;/del&gt;&lt;/a&gt;: ListAppender getters return immutable snapshots&lt;/p&gt;

&lt;p&gt;Provides a bit more thread safety to ListAppender. The class&lt;br/&gt;
is marked not-thread-safe, however this functionality is&lt;br/&gt;
important for testing, particularly when asynchronous logging is&lt;br/&gt;
configured.&lt;/p&gt;

&lt;p&gt;Previously we returned unmodifiable wrappers around the internal&lt;br/&gt;
state, which can be dangerous to iterate over while events are&lt;br/&gt;
actively logged.&lt;/p&gt;

&lt;p&gt;State is tracked in synchronized lists, which should be safer&lt;br/&gt;
than synchronizing on individual methods.&lt;/p&gt;</comment>
                            <comment id="16731049" author="ckozak" created="Sun, 30 Dec 2018 18:46:03 +0000"  >&lt;p&gt;The fix has merged to the release-2.x and master branches&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 46 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00cl4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>