<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:41:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1606] log4j-web deinitalizes the Logger too early if listeners defined in web.xml use it </title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1606</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;We use log4j in a Apache Tomcat environment.&lt;br/&gt;
In the web.xml file we define a custom ServerStartup listener that initializes the DB etc and logs both in contextInitialized and contextDestroyed.&lt;/p&gt;

&lt;p&gt;If we use the log4j-web package the class Log4jServletContainerInitializer initializes the logger and adds a Log4jServletContextListener to the ServletContext. Since this listener is added after our listener the method Log4jServletContextListener#contextDestroyed is called before our listener&apos;s contextDestroyed method. Thus the Logger is de-initialized too early.&lt;/p&gt;

&lt;p&gt;We could disable auto initialization and initialize the logger ourselves but then doing it in the listener is too late since the WebService-framework (Metro glassfish) initializes the webservice endpoints before the listener. Since we use static logger variables in those webservice classes this would trigger the message &quot;StatusLogger no log4j configuration found...&quot;  because the logger was not yet initialized.&lt;/p&gt;

&lt;p&gt;One possible patch we see is that we make an option to manually add the Log4jServletContextListener:&lt;br/&gt;
In Log4jServletContainerInitializer we would put an &quot;if (! Manually added)&quot; around the  call &quot;servletContext.addListener(new Log4jServletContextListener());&quot; and then we could manually add it to the listeners in web.xml&lt;/p&gt;

&lt;p&gt;If you have any other suggestions I would be glad to hear them.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java8, Linux/Mac, Tomcat&lt;/p&gt;</environment>
        <key id="13006820">LOG4J2-1606</key>
            <summary>log4j-web deinitalizes the Logger too early if listeners defined in web.xml use it </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lukedirtwalker">Lukas Vogel</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Sep 2016 11:42:35 +0000</created>
                <updated>Fri, 5 Feb 2021 10:11:46 +0000</updated>
                            <resolved>Wed, 3 Feb 2021 19:57:47 +0000</resolved>
                                    <version>2.6.2</version>
                                    <fixVersion>3.0.0</fixVersion>
                    <fixVersion>2.14.1</fixVersion>
                                    <component>Web/Servlet</component>
                        <due></due>
                            <votes>4</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15513184" author="ralph.goers@dslextreme.com" created="Thu, 22 Sep 2016 12:37:54 +0000"  >&lt;p&gt;Log4j&apos;s listener is supposed to be first. Doesn&apos;t the documentation say that?&lt;/p&gt;</comment>
                            <comment id="15513283" author="lukedirtwalker" created="Thu, 22 Sep 2016 13:17:46 +0000"  >&lt;p&gt;I&apos;m not sure I understand what you mean. The documentation says &quot;You must not manually configure the Log4jServletContextListener or Log4jServletFilter in your deployment descriptor (web.xml) or in another initializer or listener in a Servlet 3.0 ...&quot; and &quot;... unless you disable auto-initialization with isLog4jAutoInitializationDisabled&quot; &lt;/p&gt;

&lt;p&gt;But I would like to have auto initialization and my own listeners. But as soon as I add listeners to web.xml they will always get de-initialized (contextDestroyed) after the programmatically added Log4jServletContextListener.&lt;/p&gt;</comment>
                            <comment id="16189185" author="rturner@e-djuster.com" created="Tue, 3 Oct 2017 02:30:28 +0000"  >&lt;p&gt;Also affects 2.9.1.&lt;/p&gt;

&lt;p&gt;So I&apos;ve been fighting with this issue all night, reading Tomcat code, reading log4j code, etc. Basically I&apos;ve got a circular problem, that I cannot seem to fix. Here&apos;s the two options I&apos;ve worked through:&lt;/p&gt;

&lt;p&gt;1. Used the automatic configuration; results in my contextDestroyed() being unable to log (as per the description of this Jira)&lt;br/&gt;
2. Used manual configuration, with log4j configured first; results in the file being created without being able to read lookups from the web context. (so I get a file named  ${web:contextPath}}&lt;/p&gt;

&lt;p&gt;What I&apos;ve managed to determine so far is that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Tomcat will execute all ServletContextInitializers (SCIs) after having constructed the list of ServletContextListeners (SCLs) from the web.xml file. This causes any dynamic listeners to be added at the end, and thus executed in reverse order for contextDestroyed().&lt;/li&gt;
	&lt;li&gt;If I try to control the initialization order manually, I always see log4j being initialized before my contextInitialized() is invoked (likely due to some call to LoggerFactory.getLogger() or something &amp;#8211; I haven&apos;t tried building everything from source to putting a debugger on it yet). This results in the ServletContext not being tracked for some reasons, and the web lookups not working.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Moreover, I think there is a general sequencing issue to be concerned about here. The initialization and uninitialization are not going to be executed in the same &quot;order&quot; in the sequence. log4j initialization occurs when the SCI runs, and then the remaining SCLs run. During shutdown, the SCLs run, but the log4j un-initialization occurs first (so long as no other dynamic listeners have been added), and then the remaining SCLs execute, resulting in inverse order with respect to log4j.&lt;/p&gt;

&lt;p&gt;*&lt;b&gt;EDIT: Note that this next item won&apos;t work as written because addListener() cannot be called outside of an SCI&lt;/b&gt;*&lt;br/&gt;
The only solution I have come up with (but not yet verified) is to create a separate SCL, that is dynamically registered during my normal SCL initialization, so that it gets registered after log4j listener. and thus gets executed before log4j during shutdown. This is far from ideal, as it&apos;s not really symmetric, but it probably will give the desired result.&lt;/p&gt;</comment>
                            <comment id="16261257" author="epavel" created="Tue, 21 Nov 2017 18:40:57 +0000"  >&lt;p&gt;I&apos;m facing exactly the same issue. Is there any workaround? &lt;/p&gt;</comment>
                            <comment id="16261428" author="rturner@e-djuster.com" created="Tue, 21 Nov 2017 20:13:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epavel&quot; class=&quot;user-hover&quot; rel=&quot;epavel&quot;&gt;epavel&lt;/a&gt; I didn&apos;t find one when I investigated and I was looking through the various bits of log4j and Tomcat code (but not debugging as I wasn&apos;t set up for it). Superficially, I had thought that what I suggested above with the manual initialization order would work, but it didn&apos;t in my case (I think possibly because something triggers the log initialization from a &quot;static&quot;). Conceptually, I think it still will, but might require some additional work in our case to prevent log system initialization until after the SCI has run. The separate SCL approach I suggested likely will not work though (at least not without design changes to Tomcat, which would be hard-pressed to justify I would expect).&lt;/p&gt;

&lt;p&gt;I had planned to come back to investigating it further, but hadn&apos;t had a chance yet (not sure if I will get to it before December though due to other commitments). At the moment, it&apos;s one of the things that sort of blocks our project&apos;s migration to log4j/slf4j. If I find a workaround or solution, I will post it, and/or submit pull requests to the relevant products/libraries for the required changes.&lt;/p&gt;</comment>
                            <comment id="16262051" author="lukedirtwalker" created="Wed, 22 Nov 2017 06:51:07 +0000"  >&lt;p&gt;Our workaround is:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Initialize the logger with XML configuration through a VM argument. (-Dlog4j.configurationFile=PATH/TO/CONFIG/FILE/log4j2.xml)&lt;/li&gt;
	&lt;li&gt;Initialize further programmatic state needed for logging in a ServletContainerInitializer&lt;/li&gt;
	&lt;li&gt;Use a ServletContextListener that does the de-initialization&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;This solves all of our issues we had, and we don&apos;t need to rely on log4j-web.&lt;/p&gt;</comment>
                            <comment id="16264359" author="epavel" created="Thu, 23 Nov 2017 13:53:09 +0000"  >&lt;p&gt;Thanks a lot &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lukedirtwalker&quot; class=&quot;user-hover&quot; rel=&quot;lukedirtwalker&quot;&gt;lukedirtwalker&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rturner%40e-djuster.com&quot; class=&quot;user-hover&quot; rel=&quot;rturner@e-djuster.com&quot;&gt;rturner@e-djuster.com&lt;/a&gt;&lt;br/&gt;
After trying different workarounds I found the one which works fine for us:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I keep log4j-web on the classpath&lt;/li&gt;
	&lt;li&gt;In web.xml I disable auto initialization with context param &lt;tt&gt;isLog4jAutoInitializationDisabled&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;I include &lt;tt&gt;Log4jServletContextListener&lt;/tt&gt; as the first listener in web.xml - it guarantees the right order of initialization / shutdown&lt;/li&gt;
	&lt;li&gt;Inside all other context listeners, I don&apos;t create loggers before contextInitialized is called&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16264840" author="rturner@e-djuster.com" created="Thu, 23 Nov 2017 23:21:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epavel&quot; class=&quot;user-hover&quot; rel=&quot;epavel&quot;&gt;epavel&lt;/a&gt; Yeah, that was roughly my approach, but hadn&apos;t got around to figuring out how I would achieve your 4th bullet  (don&apos;t create loggers before &lt;tt&gt;contextInitialized&lt;/tt&gt; is called) in our system. What approach did you use to do this (as the traditional method of creating the loggers is from static class members initialization, which is hard to control)?&lt;/p&gt;</comment>
                            <comment id="16265137" author="epavel" created="Fri, 24 Nov 2017 10:25:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rturner%40e-djuster.com&quot; class=&quot;user-hover&quot; rel=&quot;rturner@e-djuster.com&quot;&gt;rturner@e-djuster.com&lt;/a&gt; Well I made the loggers non-static fields and created them in contextInitialized. It doesn&apos;t look nice, but as long as ServletContextListener-s are singletons anyway, and contextInitialized is called exactly once, it&apos;s OK.&lt;/p&gt;

&lt;p&gt;Another point, I&apos;m relying on the fact that no other classes (servlets, filters, ... - they use traditional static loggers) are loaded before the context listeners are called. I&apos;m not sure if it&apos;s defined in the servlet spec, but at least Tomcat 7 works this way. Again, not future proof, but acceptable as a workaround. Once I have a bit more free time I could dig deeper, but now I have to move forward. &lt;/p&gt;</comment>
                            <comment id="16265347" author="rturner@e-djuster.com" created="Fri, 24 Nov 2017 14:45:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=epavel&quot; class=&quot;user-hover&quot; rel=&quot;epavel&quot;&gt;epavel&lt;/a&gt; Thanks &amp;#8211; I was thinking along similar lines, but instead of making them non-static, I was thinking of injecting a custom &quot;logger factory&quot; that would create a &quot;shim&quot; logger that would internally create the real logger at a later point. I need a shim so I can have annotated log functions for whitelisting against a static security analyzer, so this might be my route. Best of luck.&lt;/p&gt;</comment>
                            <comment id="17096339" author="djohle" created="Thu, 30 Apr 2020 08:59:37 +0000"  >&lt;p&gt;So it&apos;s been a few years since this all started, and I can confirm it&apos;s still a thing in at least version 2.13.1 that I recently upgraded to.&#160; Much like &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rturner%40e-djuster.com&quot; class=&quot;user-hover&quot; rel=&quot;rturner@e-djuster.com&quot;&gt;rturner@e-djuster.com&lt;/a&gt;, &quot;I&apos;ve been fighting with this issue all night, reading Tomcat code, reading log4j code, etc.&quot; as well.&#160;&#160; Finally understood this well enough, and was going to log the bug here, but now knowing the actual problem &amp;amp; magic terms to search for I found this issue.&lt;/p&gt;

&lt;p&gt;I was having two main symptoms:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The logging from MyContextListener.contextDestroyed was going nowhere.&lt;/li&gt;
	&lt;li&gt;Tomcat was complaining about threads my application started, but didn&apos;t stop, and thus creating leaks.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;So I was focusing on #2 at the time, and tracking down how/when these threads were created.&#160; It was clear they were Log4j2, so I put in some conditional breakpoints and let it rip.&#160; It was then that I found out they were being created during MyContextListener.contextDestroyed being called at undeploy time.&#160; One was named Log4j2-TF-8-Schedule-3 and the other AsyncAppender-apendername.&lt;/p&gt;

&lt;p&gt;So after much playing with things, I realized that the &quot;TF&quot; one was actually a different name than the &quot;TF&quot; thread name I would see while the application was running.&#160; Digging deeper, it turns out the other one was named the same, but not actually the same thread.&#160; So these were not even from the same logging context that the rest of my webapp used, the plot thickened!&lt;/p&gt;

&lt;p&gt;I was also paying attention to the order of operations here, and noticed that, as mentioned in other comments, the logging context was being destroyed prior to my own listener&apos;s destroy.&#160; So I played around with web.xml, and even made my own JAR with its own web-fragment.xml, but nothing would affect the order of Log4j2 init nor destroy with respect to my listener.&lt;/p&gt;

&lt;p&gt;So, in case it helps explain what&apos;s going on, I&apos;ll offer up what I&apos;ve learned in the past several hours:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Order of startup operations...&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;1. Log4jServletContainerInitializer.onStartup is called&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Since we are servlet 3.0+, this actually initializes the logging context&lt;br/&gt;
 This agrees with the documentation in &quot;&lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/webapp.html#Servlet-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;The Short Story&lt;/a&gt;&quot;&lt;/li&gt;
	&lt;li&gt;Log4jWebInitializerImpl.start is what actually does this&lt;/li&gt;
	&lt;li&gt;It also creates &amp;amp; registers the new Log4jServletContextListener that will be used during shutdown&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;2. MyContextListener.contextInitialized is called&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This performs some logging, which works properly since the logging context was initialized before&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;3. Log4jServletContextListener.contextInitialized is called&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This calls Log4jWebInitializerImpl.start, but because it&apos;s already initialized, it does nothing.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Order of shutdown operations...&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;1. Log4jServletContextListener.contextDestroyed is called&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This gets rid of the logging context for the web app&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;2. MyContextListener.contextDestroyed is called&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;This attempts to do some logging, but since the logging context is gone, a new one is auto-created!&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;3. The webapp is finished shutting down, and at this point Tomcat freaks out because of the dangling threads from the extra logging context, which are leaked&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Conclusion...&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Even when my listener is a web-fragment, and defined as &amp;lt;after&amp;gt; the log4j fragment, it still comes &lt;em&gt;first&lt;/em&gt; because the Log4jServletContextListener is added programmatically, and thus simply appended to the end of the list instead of considered in the specified ordering!&#160; However, this &lt;em&gt;completely defeats the purpose&lt;/em&gt; of &quot;configured to order before any other web fragments&quot; mentioned in &quot;&lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/webapp.html#Servlet-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;The Long Story&lt;/a&gt;&quot; section.&lt;/p&gt;

&lt;p&gt;So to answer the the question from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgoers&quot; class=&quot;user-hover&quot; rel=&quot;rgoers&quot;&gt;rgoers&lt;/a&gt; above, &quot;Log4j&apos;s listener is supposed to be first. Doesn&apos;t the documentation say that?&quot;&lt;/p&gt;

&lt;p&gt;Yes, the documentation says that, and yes it is &lt;em&gt;supposed&lt;/em&gt; to be first, however the &lt;em&gt;code&lt;/em&gt; dictates otherwise and that&apos;s what matters most &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Solution...?&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;It is not clear to me why the listener isn&apos;t declared in the web-fragment.xml, allowing the logging context to be created in the right sequence.&#160; I guess perhaps it&apos;s because of some of the other things performed in Log4jServletContainerInitializer.onStartup?&#160; I&apos;m not sure if those things need/have to be in there vs the listener and/or done after init.&#160; If not I propose the init &amp;amp; dynamic listener registration be removed and the listener be defined in the web-fragment.&lt;/p&gt;

&lt;p&gt;If there is an actual need/benefit to using the ContainerInitializer instead of the ContextListener, then perhaps there could be an init parameter added to skip the logging context init &amp;amp; dynamic listener registration in ContainerInitializer. With that, the init would end up happening from the listener call, and in the right order by defining it in the web-fragment.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17096481" author="rturner@e-djuster.com" created="Thu, 30 Apr 2020 12:33:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djohle&quot; class=&quot;user-hover&quot; rel=&quot;djohle&quot;&gt;djohle&lt;/a&gt; Seems I wasn&apos;t the only one up late working on this (or a very related) problem last night. I was looking more specifically at &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2624&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LOG4J2-2624&lt;/a&gt; which is dealing with an issue when trying to work around this shutdown ordering issue (but is caused again by some inconsistent startup issues with log4j-web). Although I didn&apos;t see this the last time I researched this issue, I did find this page, which somewhat documents the start-up/shutdown issue (including some visuals) along with workarounds: &lt;a href=&quot;http://instantdelay.com/articles/log4j-shutdown-problems.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://instantdelay.com/articles/log4j-shutdown-problems.html&lt;/a&gt; (possibly posted by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=takteek&quot; class=&quot;user-hover&quot; rel=&quot;takteek&quot;&gt;takteek&lt;/a&gt;, my appologies if that&apos;s the wrong accreditation)&lt;/p&gt;</comment>
                            <comment id="17096486" author="rturner@e-djuster.com" created="Thu, 30 Apr 2020 12:45:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djohle&quot; class=&quot;user-hover&quot; rel=&quot;djohle&quot;&gt;djohle&lt;/a&gt; Unless I misunderstood one aspect of your proposed solution (&quot;could be an init parameter added to skip the logging context init&quot;), I think that parameter already exists, as per the &quot;&lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/webapp.html#Servlet-3.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;The Long Story&lt;/a&gt;&quot;, &lt;tt&gt;isLog4jAutoInitializationDisabled&lt;/tt&gt; exists to skip that initialization, and then one can get logging to work during shutdown, but you then run into issues using WebLookup during the initialization sequence as per &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2624&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;LOG4J2-2624&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17096970" author="djohle" created="Thu, 30 Apr 2020 20:45:41 +0000"  >&lt;p&gt;Yes, isLog4jAutoInitializationDisabled kind of does it, but it&apos;s a bit too heavy handed in that it kills ALL of the auto initialization functionality. As such one has to fully configure everything the &quot;old way&quot; in web.xml and friends.&lt;/p&gt;

&lt;p&gt;What I was suggesting was something more specific to &lt;a href=&quot;https://github.com/apache/logging-log4j2/blob/e7a1d9d93ee9620fb289a37090fc28d0ed12a2f4/log4j-web/src/main/java/org/apache/logging/log4j/web/Log4jServletContainerInitializer.java#L56-L60&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the context initialization itself&lt;/a&gt;, not the entire method body.&#160; But again, that was more of an alternate idea.&#160; Just moving it all to the context listener seems (to me, at least) like a better option that may provide auto-config + proper ordering.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;P.S. I did see that page with the visuals, and it&apos;s very helpful, but it also makes the same assumption in its &quot;Solution 2&quot; that putting your listeners in web fragments will fix the ordering problem.&#160; That is incorrect as I explained a few posts up, and I think that is the true &quot;bug&quot; here.&lt;/p&gt;</comment>
                            <comment id="17278310" author="jira-bot" created="Wed, 3 Feb 2021 19:25:20 +0000"  >&lt;p&gt;Commit 516756119ff74cb5b4bcbea425bf6b26ec630f63 in logging-log4j2&apos;s branch refs/heads/release-2.x from perry2of5&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=5167561&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=5167561&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1606&quot; title=&quot;log4j-web deinitalizes the Logger too early if listeners defined in web.xml use it &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1606&quot;&gt;&lt;del&gt;LOG4J2-1606&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2624&quot; title=&quot;${web:rootDir} not working in weblogic 12c&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2624&quot;&gt;&lt;del&gt;LOG4J2-2624&lt;/del&gt;&lt;/a&gt; Add flag to disable automatic log4j shutdown in log4j-web. (#463)&lt;/p&gt;

&lt;p&gt;Added flag to control auto-shutdown of Log4j when&lt;br/&gt;
Log4jServletContainerInitializer is used for a servlet 3+ deployment.&lt;/p&gt;

&lt;p&gt;Added &quot;Log4jShutdownOnContextDestroyedListener&quot;, a&lt;br/&gt;
ServletContextListener, to shutdown log4j cleanly when&lt;br/&gt;
contextDestroyed is called. Assuming this ServletContextListener is&lt;br/&gt;
the very first listener registered in the web application&apos;s web.xml,&lt;br/&gt;
then log4j will be shut down after all other components are shut down.&lt;br/&gt;
Log4jShutdownOnContextDestroyedListener should only be used when&lt;br/&gt;
auto-shutdown is disabled in Log4jServletContainerInitializer.&lt;/p&gt;</comment>
                            <comment id="17278324" author="jira-bot" created="Wed, 3 Feb 2021 19:53:33 +0000"  >&lt;p&gt;Commit 45c86742ad43bf747970fb2d4cf536465e1fb5e7 in logging-log4j2&apos;s branch refs/heads/master from perry2of5&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=45c8674&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=45c8674&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1606&quot; title=&quot;log4j-web deinitalizes the Logger too early if listeners defined in web.xml use it &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1606&quot;&gt;&lt;del&gt;LOG4J2-1606&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2624&quot; title=&quot;${web:rootDir} not working in weblogic 12c&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2624&quot;&gt;&lt;del&gt;LOG4J2-2624&lt;/del&gt;&lt;/a&gt; Add flag to disable automatic log4j shutdown in log4j-web. (#463)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13237410">LOG4J2-2624</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33y7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>