<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:31:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-168] Include arbitrary message fields in RFC-5424 structured data</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-168</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;We&apos;d really like to see the logger and/or location be included in RFC-5424 structured data. As such, we&apos;ve developed a small patch to allow arbitrary PatternLayout names to be configured on the SyslogAppender, which are then included in the structured data.&lt;/p&gt;

&lt;p&gt;Patch to follow shortly.&lt;/p&gt;</description>
                <environment>&lt;p&gt;N/A&lt;/p&gt;</environment>
        <key id="12633115">LOG4J2-168</key>
            <summary>Include arbitrary message fields in RFC-5424 structured data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ssevertson">Scott Severtson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Feb 2013 01:37:36 +0000</created>
                <updated>Fri, 16 Aug 2013 15:51:16 +0000</updated>
                            <resolved>Sun, 9 Jun 2013 07:09:36 +0000</resolved>
                                    <version>2.0-beta5</version>
                                    <fixVersion>2.0-beta8</fixVersion>
                                    <component>Layouts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13581850" author="ssevertson" created="Wed, 20 Feb 2013 01:38:52 +0000"  >&lt;p&gt;Implement support for arbitrary message fields in RFC-5424 structured data.&lt;/p&gt;</comment>
                            <comment id="13585321" author="ralph.goers@dslextreme.com" created="Sun, 24 Feb 2013 07:41:36 +0000"  >&lt;p&gt;While I support the concept of what this patch is trying to do I have some issues with the actual patch:&lt;br/&gt;
1. There aren&apos;t any tests for it.&lt;br/&gt;
2. There isn&apos;t any doc for it.&lt;br/&gt;
3. The way the patch works is to use the converter name as the key in the map.  This doesn&apos;t work well in a lot of cases. For example, specifying %X&lt;/p&gt;
{key1}
&lt;p&gt; %X&lt;/p&gt;
{key2}
&lt;p&gt; would not be nice (and, of course, would also be stupid to specify). I&apos;m wondering if it wouldn&apos;t be nicer to specify KeyValuePairs under an MDC or ThreadContext element instead. Then the user could specify the name of the key and the value would be a pattern or expression.&lt;/p&gt;
</comment>
                            <comment id="13588475" author="ssevertson" created="Wed, 27 Feb 2013 16:28:41 +0000"  >&lt;p&gt;Two questions:&lt;br/&gt;
1. Where do the docs live? More than happy to contribute.&lt;br/&gt;
2. Would the following example key/value format be acceptable: &quot;ClassName %class Sequence %sequenceNumber&quot;? I would have loved to use delimiters for clarity, but PatternParser lumps anything that&apos;s not a converter pattern into a single literal, and I had concerns about pre-parsing/splitting the PatternParser string without duplicating a lot of code.&lt;/p&gt;

&lt;p&gt;I&apos;ve added a simple test case locally, and reworked the code to support the key/value format described above. Let me know if this is acceptable, and I&apos;ll re-generate the patch.&lt;/p&gt;</comment>
                            <comment id="13588536" author="ralph.goers@dslextreme.com" created="Wed, 27 Feb 2013 17:28:18 +0000"  >&lt;p&gt;The docs are in the source - trunk/src/site/xdocs.  The user&apos;s guide is under the manual subdirectory. They generally use the xdoc format although some files are also processed by velocity first.&lt;/p&gt;

&lt;p&gt;I was thinking they would be specified similar to &lt;/p&gt;

&lt;p&gt;&amp;lt;MDCFields&amp;gt;&lt;br/&gt;
  &amp;lt;KeyValuePair key=&quot;ClassName&quot; value=&quot;%class&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;KeyValuePair key=&quot;Sequence&quot; value=&quot;%sequenceNumber&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;KeyValuePair key=&quot;HostName value=&quot;$${env:HOSTNAME}&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/MDCFields&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13588543" author="ssevertson" created="Wed, 27 Feb 2013 17:33:00 +0000"  >&lt;p&gt;Oh, I didn&apos;t think of this style of configuration. Any pointers to a plugin which handles for nested XML configuration like this?&lt;/p&gt;</comment>
                            <comment id="13588549" author="ralph.goers@dslextreme.com" created="Wed, 27 Feb 2013 17:39:41 +0000"  >&lt;p&gt;Yes and no.  DynamicThresholdFilter, MapFilter, StructuredDataFilter, ThreadContextMapFilter and MapRewritePolicy all can be configured with KeyValuePairs but not under a subordinate XML element. To do the above you would have to create a new MDCFields plugin to contain the KeyValuePairs and then have the layout get them from that container object.  Normally they are just accepted as an array of key value pairs but I think it would look odd in the configuration to have a list of KeyValuePair elements under the layout without the container.&lt;/p&gt;

&lt;p&gt;You can look at the Appenders plugin to see an example of a Plugin that is nothing but a container of an array. It returns a Map to its parent.&lt;/p&gt;</comment>
                            <comment id="13597247" author="ssevertson" created="Fri, 8 Mar 2013 16:13:39 +0000"  >&lt;p&gt;I&apos;m finally digging back into this, and I&apos;m a bit confused - not sure that I fully understand the configuration initialization process, or how to wire things together.&lt;/p&gt;

&lt;p&gt;I&apos;ve created a MDCFields plugin, with the following factory method:&lt;br/&gt;
    @PluginFactory&lt;br/&gt;
    public static ConcurrentMap&amp;lt;String, String&amp;gt; createKeyValuePairsMap(&lt;br/&gt;
                                             @PluginElement(&quot;MDCFields&quot;) final KeyValuePair[] keyValuePairs)&lt;/p&gt;

&lt;p&gt;However, in RFC5424Layout, which of the following do I include in the .createLayout(...) factory method?&lt;br/&gt;
1. @PluginElement(&quot;mdcFields&quot;) MDCFields mdcFields,&lt;br/&gt;
2. @PluginElement(&quot;mdcFields&quot;) Map&amp;lt;String, String&amp;gt; mdcFields,&lt;/p&gt;

&lt;p&gt;Also, the AppendersPlugin returns a ConcurrentMap - is this necessary for the MDCFields plugin? I didn&apos;t think the configuration could be modified except by a complete reload, so I&apos;m not sure why a ConcurrentMap is needed versus a plain-old Map.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13597681" author="ralph.goers@dslextreme.com" created="Fri, 8 Mar 2013 23:16:58 +0000"  >&lt;p&gt;If MDCFields plugin factory method is returning a Map&amp;lt;String, String&amp;gt; then that is what you would declare on the @PluginElement.&lt;/p&gt;

&lt;p&gt;Returning a ConcurrentMap should not be necessary for this as the Map won&apos;t ever be modified. (The appenders map can be, although it isn&apos;t encouraged).&lt;/p&gt;</comment>
                            <comment id="13602407" author="ssevertson" created="Thu, 14 Mar 2013 16:41:14 +0000"  >&lt;p&gt;OK, I&apos;m still just not getting the wiring for this  case. I&apos;ve switched from &quot;MDCFields&quot; to &quot;LoggerFields&quot;, as this really doesn&apos;t have anything to do with MDC. However, I&apos;d appreciate suggestions if there&apos;s a better name.&lt;/p&gt;

&lt;p&gt;Here&apos;s snippits of what I have:&lt;/p&gt;

&lt;p&gt;LoggerFields.java:&lt;br/&gt;
&amp;#8212;&lt;br/&gt;
@Plugin(name = &quot;LoggerFields&quot;, type = &quot;Core&quot;)&lt;br/&gt;
public final class LoggerFields {&lt;br/&gt;
...&lt;br/&gt;
    public static Map&amp;lt;String, String&amp;gt; createKeyValuePairsMap(&lt;br/&gt;
                                             @PluginElement(&quot;LoggerFields&quot;) final KeyValuePair[] keyValuePairs) {&lt;br/&gt;
&amp;#8212;&lt;/p&gt;

&lt;p&gt;SyslogAppender.java&lt;br/&gt;
&amp;#8212;&lt;br/&gt;
    @PluginFactory&lt;br/&gt;
    public static SyslogAppender createAppender(&lt;br/&gt;
...&lt;br/&gt;
                                                @PluginElement(&quot;loggerFields&quot;) Map&amp;lt;String, String&amp;gt; loggerFields) {&lt;/p&gt;

&lt;p&gt;&amp;#8212;&lt;/p&gt;

&lt;p&gt;log4j2.xml:&lt;br/&gt;
&amp;#8212;&lt;br/&gt;
                &amp;lt;Syslog&lt;br/&gt;
                                name=&quot;syslog&quot;&lt;br/&gt;
                                format=&quot;RFC5424&quot;&lt;br/&gt;
...&lt;br/&gt;
                &amp;gt;&lt;br/&gt;
                        &amp;lt;LoggerFields&amp;gt;&lt;br/&gt;
                                &amp;lt;KeyValuePair key=&quot;Logger&quot; value=&quot;%logger&quot;/&amp;gt;&lt;br/&gt;
                        &amp;lt;/LoggerFields&amp;gt;&lt;br/&gt;
                &amp;lt;/Syslog&amp;gt;&lt;br/&gt;
&amp;#8212;&lt;/p&gt;


&lt;p&gt;Console output:&lt;br/&gt;
&amp;#8212;&lt;br/&gt;
ERROR appender Syslog has no parameter that matches element LoggerFields&lt;br/&gt;
&amp;#8212;&lt;/p&gt;


&lt;p&gt;What am I missing? Sorry for all the back-and-forth, but I&apos;m not sure what&apos;s going on. I&apos;ve also tried &amp;lt;loggerFields&amp;gt; (versus &amp;lt;LoggerFields&amp;gt;) in the config, but it still complained about the mismatched element name.&lt;/p&gt;</comment>
                            <comment id="13613553" author="ralph.goers@dslextreme.com" created="Tue, 26 Mar 2013 06:29:32 +0000"  >&lt;p&gt;I suspect that it can&apos;t match the Map with the LoggerFields object.  Try having createAppender accept a LoggerFields object instead of a Map.  Then have LoggerFields create an instance of itself with a map as an attribute. In createAppender call loggerFields.getMap() to obtain the data map.&lt;/p&gt;</comment>
                            <comment id="13618977" author="ralph.goers@dslextreme.com" created="Mon, 1 Apr 2013 17:57:54 +0000"  >&lt;p&gt;If you can provide what you have I would be happy to help with this.&lt;/p&gt;</comment>
                            <comment id="13677461" author="ssevertson" created="Thu, 6 Jun 2013 20:26:25 +0000"  >&lt;p&gt;Finally had time to get back to this issue. Patch with LoggerFields implementation, documentation and tests to follow.&lt;/p&gt;</comment>
                            <comment id="13677467" author="ssevertson" created="Thu, 6 Jun 2013 20:28:30 +0000"  >&lt;p&gt;Patch which implements the ability to include arbitrary logger fields in MDC/RFC-5424 structured data. Basic test coverage and documentation included.&lt;/p&gt;

&lt;p&gt;Configuration of fields implemented via nested &amp;lt;LoggerFields&amp;gt; element.&lt;/p&gt;</comment>
                            <comment id="13678959" author="ralph.goers@dslextreme.com" created="Sun, 9 Jun 2013 07:09:36 +0000"  >&lt;p&gt;Patch applied with minor modifications in revision 1491152. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="13681812" author="ssevertson" created="Thu, 13 Jun 2013 00:52:26 +0000"  >&lt;p&gt;Tested against revision 1491348, and confirmed to work as expected. Thanks very much!&lt;/p&gt;</comment>
                            <comment id="13740953" author="btibi" created="Thu, 15 Aug 2013 13:25:23 +0000"  >&lt;p&gt;Does the log4j2 support multiple SD-ELEMENTs in an RFC 5424 message? For example: &lt;/p&gt;

&lt;p&gt;&amp;lt;135&amp;gt;1 2013-08-15T11:47:44+02:00 10.30.255.247 APP-NAME PID MSGID &lt;span class=&quot;error&quot;&gt;&amp;#91;stuff@32473 foo=&amp;quot;Foo&amp;quot; bar=&amp;quot;Bar&amp;quot;&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;otherStuff@32473 baz=&amp;quot;Baz&amp;quot; qux=&amp;quot;Qux&amp;quot;&amp;#93;&lt;/span&gt; Some message&lt;/p&gt;

&lt;p&gt;I think it&apos;d be nice to write something like this:&lt;br/&gt;
&amp;lt;LoggerFields enterpriseId=&quot;32473&quot; name=&quot;stuff&quot;&amp;gt;&lt;br/&gt;
	&amp;lt;KeyValuePair key=&quot;foo&quot; value=&quot;Foo&quot;/&amp;gt;&lt;br/&gt;
	&amp;lt;KeyValuePair key=&quot;Bar&quot; value = &quot;Bar&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/LoggerFields&amp;gt;&lt;br/&gt;
&amp;lt;LoggerFields enterpriseId=&quot;32473&quot; name=&quot;otherStuff&quot;&amp;gt;&lt;br/&gt;
	&amp;lt;KeyValuePair key=&quot;baz&quot; value=&quot;Baz&quot;/&amp;gt;&lt;br/&gt;
	&amp;lt;KeyValuePair key=&quot;qux&quot; value=&quot;Qux&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/LoggerFields&amp;gt;&lt;/p&gt;

&lt;p&gt;Then we could structure more the log messages. What are your opinions?&lt;/p&gt;</comment>
                            <comment id="13740957" author="ssevertson" created="Thu, 15 Aug 2013 13:30:58 +0000"  >&lt;p&gt;It currently does not support multiple SD-ELEMENTS, and it&apos;s not really a feature my team needs. But, I wouldn&apos;t see any harm in someone adding support for this - patches are always welcome!&lt;/p&gt;</comment>
                            <comment id="13740983" author="btibi" created="Thu, 15 Aug 2013 14:08:50 +0000"  >&lt;p&gt;I think we should only modify the LoggerFields, RFC5424Layout and SyslogAppender classes (and the TLSRFC5424Layout and TLSSyslogAppender classes after their merge). I&apos;m not sure about one thing: Can we use arrays with @PluginElement? Like this:&lt;/p&gt;

&lt;p&gt;@PluginElement(&quot;LoggerFields&quot;) final LoggerFields[] loggerFields&lt;/p&gt;

&lt;p&gt;And I also suggest that if no name specified in the LoggerFields, we should add its key-value pairs to the default mdc SD-ELEMENT. If nobody has quarrel with it, I&apos;ll implement it.&lt;/p&gt;</comment>
                            <comment id="13741024" author="garydgregory" created="Thu, 15 Aug 2013 14:53:24 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Can we use arrays with @PluginElement?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, for example please see:&lt;br/&gt;
&lt;tt&gt;org.apache.logging.log4j.core.appender.AsyncAppender.createAppender(AppenderRef[], String, String, String, String, String, Filter, Configuration, String)&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="13742328" author="btibi" created="Fri, 16 Aug 2013 15:51:16 +0000"  >&lt;p&gt;I created a new issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-355&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LOG4J2-355&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And I also uploaded the patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12586576" name="include-arbitrary-fields-in-mdc-2.patch" size="19774" author="ssevertson" created="Thu, 6 Jun 2013 20:28:30 +0000"/>
                            <attachment id="12570049" name="include-arbitrary-fields-in-mdc.patch" size="10301" author="ssevertson" created="Wed, 20 Feb 2013 01:38:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313611</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 14 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1i4av:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313956</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>