<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:40:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2633] JSONLayout can&apos;t find Log4jLogEvent[&quot;source&quot;] in Java 11</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2633</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;While migrating my service from Java 8 to Java 11 I noticed that most (if not all) of my logs are missing.&lt;/p&gt;

&lt;p&gt;While looking the the process stderr stream I saw the following message:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ERROR StatusLogger com.fasterxml.jackson.databind.JsonMappingException: No value present (through reference chain: org.apache.logging.log4j.core.impl.Log4jLogEvent[&lt;span class=&quot;code-quote&quot;&gt;&quot;source&quot;&lt;/span&gt;])
com.fasterxml.jackson.databind.JsonMappingException: No value present (through reference chain: org.apache.logging.log4j.core.impl.Log4jLogEvent[&lt;span class=&quot;code-quote&quot;&gt;&quot;source&quot;&lt;/span&gt;])
at com.fasterxml.jackson.databind.JsonMappingException.wrapWithPath(JsonMappingException.java:394)
at com.fasterxml.jackson.databind.JsonMappingException.wrapWithPath(JsonMappingException.java:353)
at com.fasterxml.jackson.databind.ser.std.StdSerializer.wrapAndThrow(StdSerializer.java:316)
at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFieldsFiltered(BeanSerializerBase.java:779)
at com.fasterxml.jackson.databind.ser.BeanSerializer.serialize(BeanSerializer.java:153)
at com.fasterxml.jackson.databind.ser.DefaultSerializerProvider._serialize(DefaultSerializerProvider.java:480)
at com.fasterxml.jackson.databind.ser.DefaultSerializerProvider.serializeValue(DefaultSerializerProvider.java:319)
at com.fasterxml.jackson.databind.ObjectWriter$Prefetch.serialize(ObjectWriter.java:1396)
at com.fasterxml.jackson.databind.ObjectWriter._configAndWriteValue(ObjectWriter.java:1120)
at com.fasterxml.jackson.databind.ObjectWriter.writeValue(ObjectWriter.java:966)
at org.apache.logging.log4j.core.layout.AbstractJacksonLayout.toSerializable(AbstractJacksonLayout.java:304)
at org.apache.logging.log4j.core.layout.JsonLayout.toSerializable(JsonLayout.java:291)
at org.apache.logging.log4j.core.layout.AbstractJacksonLayout.toSerializable(AbstractJacksonLayout.java:255)
at org.apache.logging.log4j.core.layout.JsonLayout.toSerializable(JsonLayout.java:68)
at org.apache.logging.log4j.core.layout.AbstractJacksonLayout.toSerializable(AbstractJacksonLayout.java:44)
at org.apache.logging.log4j.core.layout.AbstractStringLayout.toByteArray(AbstractStringLayout.java:304)
at com.moblica.log4j.ScribeAppender.append(ScribeAppender.java:90)
at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:156)
at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:129)
at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:120)
at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:84)
at org.apache.logging.log4j.core.appender.AsyncAppender$AsyncThread.callAppenders(AsyncAppender.java:454)
at org.apache.logging.log4j.core.appender.AsyncAppender$AsyncThread.run(AsyncAppender.java:407)
Caused by: java.util.NoSuchElementException: No value present
at java.base/java.util.Optional.get(Optional.java:148)
at org.apache.logging.log4j.util.StackLocator.calcLocation(StackLocator.java:79)
at org.apache.logging.log4j.util.StackLocatorUtil.calcLocation(StackLocatorUtil.java:71)
at org.apache.logging.log4j.core.impl.Log4jLogEvent.getSource(Log4jLogEvent.java:669)
at jdk.internal.reflect.GeneratedMethodAccessor446.invoke(Unknown Source)
at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
at java.base/java.lang.reflect.Method.invoke(Method.java:566)
at com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.java:688)
at com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter.serializeAsField(SimpleBeanPropertyFilter.java:208)
at com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFieldsFiltered(BeanSerializerBase.java:771)
... 19 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When using the Console appender with PatternLayout I was able to see the missing logs.&lt;/p&gt;

&lt;p&gt;Looking at my config I noticed that I set the&#160;JSONLayout.locationInfo to true. After changing it to false I was able to see my logs with the the&#160;JSONLayout properly.&lt;/p&gt;

&lt;p&gt;I did saw some logs when setting&#160;SONLayout.locationInfo to true, for example logs from the&#160;com.google.common.cache.LocalCache class (sorry but I can&apos;t share the actual exception due to legal reasons).&lt;/p&gt;

&lt;p&gt;I&apos;m not familiar with the log4j internals, but this seems like an issue with Java 11 (or maybe &amp;gt; 8) and the&#160;JSONLayout.locationInfo setting.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java -version
openjdk version &lt;span class=&quot;code-quote&quot;&gt;&quot;11.0.2&quot;&lt;/span&gt; 2019-01-15
OpenJDK &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; Environment AdoptOpenJDK (build 11.0.2+9)
OpenJDK 64-Bit Server VM AdoptOpenJDK (build 11.0.2+9, mixed mode)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
	&lt;li&gt;Log4j version -&#160;2.11.2&lt;/li&gt;
	&lt;li&gt;slf4j version -&#160;1.7.26&lt;/li&gt;
	&lt;li&gt;disruptor version -&#160;3.4.2&lt;/li&gt;
	&lt;li&gt;Log4jContextSelector=AsyncLoggerContextSelector&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;</environment>
        <key id="13240192">LOG4J2-2633</key>
            <summary>JSONLayout can&apos;t find Log4jLogEvent[&quot;source&quot;] in Java 11</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ran.leibman">Ran Leibman</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Jun 2019 12:19:25 +0000</created>
                <updated>Sun, 23 Jun 2019 06:05:49 +0000</updated>
                                            <version>2.11.2</version>
                                                    <component>Layouts</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16870397" author="ralph.goers@dslextreme.com" created="Sat, 22 Jun 2019 23:44:03 +0000"  >&lt;p&gt;From the line number I can tell that you are executing the Java 9+ vrsion of StackLocator and that it seems to be failing to find a StackFrame for the method calling the logger. I don&apos;t see the call in the stack trace above either.&lt;/p&gt;

&lt;p&gt;The method should be modified to tolerate this but that will still result in missing location information.&lt;/p&gt;</comment>
                            <comment id="16870416" author="jira-bot" created="Sun, 23 Jun 2019 02:53:44 +0000"  >&lt;p&gt;Commit 71fd036e0bbc40598b72676854b2827565b44836 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=71fd036&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=71fd036&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2633&quot; title=&quot;JSONLayout can&amp;#39;t find Log4jLogEvent[&amp;quot;source&amp;quot;] in Java 11&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2633&quot;&gt;LOG4J2-2633&lt;/a&gt; - Handle NoSuchElementException&lt;/p&gt;</comment>
                            <comment id="16870417" author="jira-bot" created="Sun, 23 Jun 2019 02:54:47 +0000"  >&lt;p&gt;Commit 87db0a429d85390a2157f47b209466e12fa21394 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=87db0a4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=87db0a4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2633&quot; title=&quot;JSONLayout can&amp;#39;t find Log4jLogEvent[&amp;quot;source&amp;quot;] in Java 11&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2633&quot;&gt;LOG4J2-2633&lt;/a&gt; - Handle NoSuchElementException&lt;/p&gt;</comment>
                            <comment id="16870418" author="ralph.goers@dslextreme.com" created="Sun, 23 Jun 2019 02:57:37 +0000"  >&lt;p&gt;I have applied a patch that will log a warning when calcLocation encounters a NoSuchElementException. Please make sure you have status=&quot;WARN&quot; set in your log4j configuration and provide the resulting log message when it occurs. The message should only be logged once during the execution of the application although it is possible the exception might happen more than that.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13221670">LOG4J2-2565</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 21 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z03v20:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>