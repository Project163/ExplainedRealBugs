<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:35:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-873] Memory leak in web container caused by incorrect log4j initialization when omitting display-name element in web.xml</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-873</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;The initializeNonJndi method in Log4jWebInitializerImpl uses servletContext.getServletContextName() to get a context name (if the name hasn&apos;t been defined using log4jContextName). getServletContextName() returns the name as specified in the &amp;lt;display-name&amp;gt; element in web.xml, but that is optional.&lt;/p&gt;

&lt;p&gt;If neither &amp;lt;display-name&amp;gt; nor log4jContextName is defined, this results in the servletContext not being set, so the WebLookup doesn&apos;t work. The following error is displayed on the console:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;No Log4j context configuration provided. This is very unusual.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It should use some sort of default. Probably the name of the war file or context file, if there&apos;s a generic way of getting that.&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;Follow-up: as noted below, it is more than just WebLookup that fails if this happens. Log4j is initialized incorrectly: logging will work, but when the web application is stopped the logging context is not stopped, causing Tomcat to complain about Threads not being stopped and ThreadLocals not being cleaned up.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12748023">LOG4J2-873</key>
            <summary>Memory leak in web container caused by incorrect log4j initialization when omitting display-name element in web.xml</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="MartinDickins">Martin Dickins</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Oct 2014 12:50:28 +0000</created>
                <updated>Mon, 26 Oct 2015 04:14:30 +0000</updated>
                            <resolved>Sat, 24 Oct 2015 15:39:56 +0000</resolved>
                                    <version>2.0.2</version>
                                    <fixVersion>2.5</fixVersion>
                                    <component>Web/Servlet</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14909463" author="lesliel" created="Sat, 26 Sep 2015 20:20:30 +0000"  >&lt;p&gt;The &lt;b&gt;missing display-name&lt;/b&gt; is causing problems also with &lt;b&gt;Spring Boot&lt;/b&gt; applications with &lt;b&gt;no web.xml&lt;/b&gt; (current GA: 1.2.6.RELEASE).&lt;/p&gt;

&lt;p&gt;Log4jServletContainerInitializer is called before any of the SpringBootServletInitializer / WebApplicationInitializer instances, thus no programmatic initialization is possible.&lt;/p&gt;

&lt;p&gt;(Spring Boot 1.3+ might solve this by introducing the server.display-name property, but it&apos;s not production ready yet.)&lt;/p&gt;</comment>
                            <comment id="14934089" author="lukewoodward" created="Mon, 28 Sep 2015 21:35:45 +0000"  >&lt;p&gt;The missing display-name also appears to cause a memory leak. If a web app uses Log4j2 and its web.xml file lacks a &amp;lt;display-name&amp;gt; (and also a &amp;lt;context-param&amp;gt; with name &lt;tt&gt;log4jConfiguration&lt;/tt&gt;), then JMX MBeans are not being deregistered when the web app is stopped.  Essentially, the behaviour described in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-578&quot; title=&quot;JMX Memory Leak in Servlet Container&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-578&quot;&gt;&lt;del&gt;LOG4J2-578&lt;/del&gt;&lt;/a&gt; comes back if there&apos;s no display-name.&lt;/p&gt;

&lt;p&gt;I have run into this leak myself, in a web application that happened not to have a display-name.  It wasn&apos;t at all obvious that supplying a display name was how you fix the leak.&lt;/p&gt;

&lt;p&gt;I also believe this is the root cause of the memory leak in &lt;a href=&quot;http://stackoverflow.com/questions/31211868&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this StackOverflow question&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14972656" author="remkop@yahoo.com" created="Sat, 24 Oct 2015 15:39:56 +0000"  >&lt;p&gt;Fixed in master in commits d17a1d3f and bbcb663a.&lt;/p&gt;

&lt;p&gt;If no &amp;lt;display-name&amp;gt; is configured, log4j will now use the servlet context path of the web application as the logger context name.&lt;/p&gt;

&lt;p&gt;Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 4 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i215in:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>