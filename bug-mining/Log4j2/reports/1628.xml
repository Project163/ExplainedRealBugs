<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:43:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-3614] InstantFormatter fails on delegate failures</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-3614</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3075&quot; title=&quot;JsonTemplateLayout timestamp resolver doesn&amp;#39;t format nanoseconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3075&quot;&gt;&lt;del&gt;LOG4J2-3075&lt;/del&gt;&lt;/a&gt; was implemented, the JsonTemplateLayout timestamp resolver documentation should be updated to reflect the new feature.&lt;/p&gt;

&lt;p&gt;It&apos;s especially important to do so since the second fragment identifier used here (&apos;S&apos;) is different from the one described in, e.g. &lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/layouts.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/manual/layouts.html&lt;/a&gt; (which is &apos;n&apos;). I don&apos;t have enough experience with Log4j to determine if this inconsistency is a bug or not, but an entry in the JsonTemplateLayout&#160; documentation would help.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13484831">LOG4J2-3614</key>
            <summary>InstantFormatter fails on delegate failures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vy">Volkan Yazici</assignee>
                                    <reporter username="strainu">Strainu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Oct 2022 15:49:58 +0000</created>
                <updated>Mon, 10 Oct 2022 09:25:32 +0000</updated>
                            <resolved>Mon, 10 Oct 2022 09:25:32 +0000</resolved>
                                    <version>2.17.2</version>
                                    <fixVersion>2.19.0</fixVersion>
                                    <component>Documentation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17614075" author="vy" created="Fri, 7 Oct 2022 13:09:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3075&quot; title=&quot;JsonTemplateLayout timestamp resolver doesn&amp;#39;t format nanoseconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3075&quot;&gt;&lt;del&gt;LOG4J2-3075&lt;/del&gt;&lt;/a&gt; was a bug fix, not a feature change. Hence nothing new was introduced there, except fixing the formatting of the nanoseconds. To be precise, caching on the incorrect key was the problem.&lt;/p&gt;

&lt;p&gt;Timestamp resolver still behaves as documented. Mind showing an example where you suspect an inconsistency, please?&lt;/p&gt;</comment>
                            <comment id="17614083" author="JIRAUSER296600" created="Fri, 7 Oct 2022 13:32:33 +0000"  >&lt;p&gt;Sure, here are the extracts from the txt and json logging configs in one project. Both aim to display the same timestamp&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;TXT log (working):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d{HH:mm:ss.nnnnnnnnn}&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;/Console&amp;gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;JSON log:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;JsonTemplateLayout eventTemplateUri=&lt;span class=&quot;code-quote&quot;&gt;&quot;classpath:log-template.json&quot;&lt;/span&gt; locationInfoEnabled=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;log-template.json (working):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;time&quot;&lt;/span&gt;: {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;$resolver&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;pattern&quot;&lt;/span&gt;: {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;format&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;HH:mm:ss.SSSSSSSSS&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;timezone&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;UTC&quot;&lt;/span&gt;
      }
  }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;log-template.json (NOT working):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;time&quot;&lt;/span&gt;: {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;$resolver&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;pattern&quot;&lt;/span&gt;: {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;format&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;HH:mm:ss.nnnnnnnnn&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;timezone&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;UTC&quot;&lt;/span&gt;
      }
  }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Notice how in the json config I had to use &lt;em&gt;SSSSSSSSS&lt;/em&gt; to display nanoseconds, while in text I used &lt;em&gt;nnnnnnnnn&lt;/em&gt;.&lt;/p&gt;</comment>
                            <comment id="17614084" author="JIRAUSER296600" created="Fri, 7 Oct 2022 13:34:58 +0000"  >&lt;p&gt;Note that regardless of the fact that this was just a bugfix and not a new feature, I still think a nanosecond example in table 2 of &lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/json-template-layout.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/manual/json-template-layout.html&lt;/a&gt; would be welcomed.&lt;/p&gt;</comment>
                            <comment id="17614995" author="vy" created="Mon, 10 Oct 2022 09:24:30 +0000"  >&lt;p&gt;This has turned out to be a bug in &lt;tt&gt;InstantFormatter&lt;/tt&gt; used by &lt;tt&gt;JsonTemplateLayout&lt;/tt&gt;. As a matter of fact, neither &lt;tt&gt;PatternLayout&lt;/tt&gt; supports your date format. That is, the following configuration&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d{HH:mm:ss.nnnnnnnnn}&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;will still log in &lt;tt&gt;yyyy-MM-dd HH:mm:ss,SSS&lt;/tt&gt; pattern.&lt;/p&gt;

&lt;p&gt;Due to historical reasons, Log4j has two internal date-time formatter implementations: &lt;tt&gt;FixedDateFormat&lt;/tt&gt; and &lt;tt&gt;FastDateFormat&lt;/tt&gt; &#8211; I guess, either only the latter or both were borrowed from Apache Commons long time ago. &lt;tt&gt;FixedDateFormat&lt;/tt&gt; is faster than &lt;tt&gt;FastDateFormat&lt;/tt&gt;&#160;with the cost of supporting less pattern combinations. &lt;tt&gt;PatternLayout&lt;/tt&gt; &lt;em&gt;only&lt;/em&gt; uses these two date-time formatters. Since &lt;b&gt;your pattern is supported by neither&lt;/b&gt;, &lt;tt&gt;PatternLayout&lt;/tt&gt; catches the exception (thrown by &lt;tt&gt;FastDateFormat&lt;/tt&gt;) and falls back to &lt;tt&gt;FixedDateFormat.FixedFormat.DEFAULT&lt;/tt&gt;, which is &lt;tt&gt;yyyy-MM-dd HH:mm:ss,SSS&lt;/tt&gt; I have shared above.&lt;/p&gt;

&lt;p&gt;JSON Template Layout uses &lt;tt&gt;InstantFormatter&lt;/tt&gt;, which is a single entry point for the all following 3 formatters &lt;em&gt;in the given order&lt;/em&gt; (due to performance reasons): Log4j &lt;tt&gt;FixedDateFormat&lt;/tt&gt;, Log4j &lt;tt&gt;FastDateFormat&lt;/tt&gt;, and Java &lt;tt&gt;DateTimeFormatter&lt;/tt&gt;. As discovered in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3075&quot; title=&quot;JsonTemplateLayout timestamp resolver doesn&amp;#39;t format nanoseconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3075&quot;&gt;&lt;del&gt;LOG4J2-3075&lt;/del&gt;&lt;/a&gt;, &lt;tt&gt;FixedDateFormat&lt;/tt&gt; and &lt;tt&gt;FastDateFormat&lt;/tt&gt; don&apos;t support all date-time patterns, hence the Java &lt;tt&gt;DateTimeFormatter&lt;/tt&gt; fallback. Though &lt;tt&gt;InstantFormatter&lt;/tt&gt; fails to catch the exception thrown by &lt;tt&gt;FastDateFormat&lt;/tt&gt; and simply the entire layout configuration fails. In df45a4611099860254c68540480fc40ea0a89ac4, I have hardened the &lt;tt&gt;InstantFormatter&lt;/tt&gt; against &lt;tt&gt;FixedDateFormat&lt;/tt&gt; and &lt;tt&gt;FastDateFormat&lt;/tt&gt; failures. Your &lt;tt&gt;HH:mm:ss.nnnnnnnnn&lt;/tt&gt; pattern should work and produce identical output to &lt;tt&gt;HH:mm:ss.SSSSSSSSS&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I am reluctant to update the docs to include example patterns containing nanoseconds. For one, nanosecond precision is not supported by Log4j out of the box, you need some configuration to do. Second, it simply works as one would expect from Java &lt;tt&gt;DateTimeFormatter&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I will mark the story as resolved. Would you verify the fix using &lt;tt&gt;2.19.0-SNAPSHOT&lt;/tt&gt; version (which should be available in ~1h as soon as &lt;a href=&quot;https://github.com/apache/logging-log4j2/actions/runs/3218171914&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this CI job&lt;/a&gt; completes) and close the story, unless you have objections, please?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 5 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z194ao:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>