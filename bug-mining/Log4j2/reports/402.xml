<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:33:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-829] Error replace slash in pattern file when rolling file appender</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-829</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;With following log configuration&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;RollingFile&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;${sys:user.home}/logs/app.log&quot;&lt;/span&gt;
                 filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;${sys:user.home}/logs/app-%d{MM-dd-yyyy}.log&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;PatternLayout&amp;gt;
        &amp;lt;pattern&amp;gt;%d %p %c{1.} [%t] %m%n&amp;lt;/pattern&amp;gt;
      &amp;lt;/PatternLayout&amp;gt;
      &amp;lt;TimeBasedTriggeringPolicy /&amp;gt;
    &amp;lt;/RollingFile&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When start, the file name is created correctly (C:\user/logs/app.log) but when the file will rotate with file pattern, the path name is wrong. The system property user.home doesn&apos;t has slashes. C:user/logs/app-0915-2014.log&lt;/p&gt;</description>
                <environment>&lt;p&gt;Development machine Windows 7&lt;/p&gt;</environment>
        <key id="12741475">LOG4J2-829</key>
            <summary>Error replace slash in pattern file when rolling file appender</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="limkin">Pablo Vidal Otero</reporter>
                        <labels>
                            <label>appender</label>
                            <label>file-pattern</label>
                            <label>slashes</label>
                    </labels>
                <created>Mon, 15 Sep 2014 13:33:47 +0000</created>
                <updated>Mon, 20 Oct 2014 08:06:47 +0000</updated>
                            <resolved>Fri, 19 Sep 2014 16:40:28 +0000</resolved>
                                    <version>2.0.2</version>
                                    <fixVersion>2.1</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14140407" author="remkop@yahoo.com" created="Fri, 19 Sep 2014 12:21:29 +0000"  >&lt;p&gt;&lt;b&gt;Cause&lt;/b&gt;&lt;br/&gt;
Special character sequences like &lt;tt&gt;backslash t&lt;/tt&gt; are converted to the corresponding special characters (e.g. tab) to accommodate users that migrated to log4j2 from log4j-1.2 who rely on this behaviour. This behaviour was introduced in log4j2 in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-682&quot; title=&quot;Special characters (tab and so on) in PatternLayout do not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-682&quot;&gt;&lt;del&gt;LOG4J2-682&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;When the rollover pattern is parsed, it is split into &quot;literal&quot; parts and &quot;date/index converter&quot; parts. &lt;/p&gt;

&lt;p&gt;In the example above, the pattern has value &quot;C:\Users\popmarem/logs/app-%d{yyyy-MM-dd_HHmm}.log&quot;, and the first part of that pattern, &quot;C:\Users\popmarem/logs/app-&quot; is remembered as a literal.&lt;/p&gt;

&lt;p&gt;The class responsible for remembering literal strings, LiteralPatternConverter, will convert special characters in that string in order to address &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-682&quot; title=&quot;Special characters (tab and so on) in PatternLayout do not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-682&quot;&gt;&lt;del&gt;LOG4J2-682&lt;/del&gt;&lt;/a&gt;. Any backslash characters in the path are taken as an escape character and are dropped depending the character that follows the backslash.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Solution?&lt;/b&gt;&lt;br/&gt;
To be honest, I can&apos;t think of a good solution for this yet.&lt;/p&gt;

&lt;p&gt;One option would be to roll back the changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-682&quot; title=&quot;Special characters (tab and so on) in PatternLayout do not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-682&quot;&gt;&lt;del&gt;LOG4J2-682&lt;/del&gt;&lt;/a&gt;. This is not a desirable option since that would inconvenience users who migrated to log4j2 from log4j1.2 and rely on this behaviour.&lt;/p&gt;

&lt;p&gt;However, that makes things tricky... How do we distinguish intentional special characters like &lt;tt&gt;backslash t&lt;/tt&gt; in the path from unintentional sequences like &quot;C:\Users&lt;font color=&quot;red&quot;&gt;\t&lt;/font&gt;imothy/logs&quot;?&lt;/p&gt;

&lt;p&gt;By the way, note that the String substitution from ${sys:user.home} to &quot;C:\Users\timothy&quot; is done by the PluginBuilder, a long time before the PatternParser is invoked. By the time the PatternParser gets the filePattern value it is no longer possible to know what part came from a string substitution. (And even if we did know, the user might have configured a system property whose value contained the character sequence &lt;tt&gt;backslash t&lt;/tt&gt; with the intention to have that sequence converted to a tab character...)&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;OptionConverter.convertSpecialChars(String) line: 57	&amp;lt;---- PROBLEM OCCURS HERE
LiteralPatternConverter.&amp;lt;init&amp;gt;(Configuration, String) line: 45	
PatternParser.parse(String, List&amp;lt;PatternConverter&amp;gt;, List&amp;lt;FormattingInfo&amp;gt;, boolean) line: 337	
PatternProcessor.&amp;lt;init&amp;gt;(String) line: 69	
RollingFileManager.&amp;lt;init&amp;gt;(String, String, OutputStream, boolean, long, long, TriggeringPolicy, RolloverStrategy, String, Layout&amp;lt;Serializable&amp;gt;, int) line: 58	
RollingFileManager$RollingFileManagerFactory.createManager(String, RollingFileManager$FactoryData) line: 323	
RollingFileManager$RollingFileManagerFactory.createManager(String, Object) line: 290	
AbstractManager.getManager(String, ManagerFactory&amp;lt;M,T&amp;gt;, T) line: 71	
OutputStreamManager.getManager(String, T, ManagerFactory&amp;lt;OutputStreamManager,T&amp;gt;) line: 60	
RollingFileManager.getFileManager(String, String, boolean, boolean, TriggeringPolicy, RolloverStrategy, String, Layout&amp;lt;Serializable&amp;gt;, int) line: 79	
RollingFileAppender.createAppender(String, String, String, String, String, String, String, TriggeringPolicy, RolloverStrategy, Layout&amp;lt;Serializable&amp;gt;, Filter, String, String, String, Configuration) line: 184	
NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available [native method]	
NativeMethodAccessorImpl.invoke(Object, Object[]) line: 57	
DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 43	
Method.invoke(Object, Object...) line: 606	
PluginBuilder&amp;lt;T&amp;gt;.build() line: 137	&amp;lt;----- STRING SUBSTITUTION IS DONE IN HERE 
XmlConfiguration(AbstractConfiguration).createPluginObject(PluginType&amp;lt;T&amp;gt;, Node, LogEvent) line: 752	
XmlConfiguration(AbstractConfiguration).createConfiguration(Node, LogEvent) line: 691	
XmlConfiguration(AbstractConfiguration).createConfiguration(Node, LogEvent) line: 683	
XmlConfiguration(AbstractConfiguration).doConfigure() line: 358	
XmlConfiguration(AbstractConfiguration).start() line: 159	
LoggerContext.setConfiguration(Configuration) line: 385	
LoggerContext.reconfigure() line: 444	
LoggerContext.start() line: 151	
Log4jContextFactory.getContext(String, ClassLoader, Object, boolean) line: 85	
Log4jContextFactory.getContext(String, ClassLoader, Object, boolean) line: 37	
LogManager.getLogger(String) line: 475	
RolloverTest.&amp;lt;clinit&amp;gt;() line: 14	
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I cannot think of a solution for this yet.&lt;/p&gt;</comment>
                            <comment id="14140410" author="remkop@yahoo.com" created="Fri, 19 Sep 2014 12:26:58 +0000"  >&lt;p&gt;How did log4j-1.2 handle this?&lt;/p&gt;</comment>
                            <comment id="14140458" author="limkin" created="Fri, 19 Sep 2014 13:23:56 +0000"  >&lt;p&gt;We do a temporal fix ussing double slash when we add these new file appenders programaticaly but we cant&apos;t use the property replace management with ${sys:user.home}&lt;/p&gt;

&lt;p&gt;  // System properties&lt;br/&gt;
 private static final String FILE_SEPARATOR = System.getProperty(&quot;file.separator&quot;);&lt;/p&gt;

&lt;p&gt;String FILE_PATTERN = FILE_PATH + FILE_SEPARATOR + FILE_SEPARATOR + FILE_NAME + FILE_PATTERN_ROLL + FILE_EXTENSION;&lt;/p&gt;</comment>
                            <comment id="14140641" author="remkop@yahoo.com" created="Fri, 19 Sep 2014 14:27:43 +0000"  >&lt;p&gt;I think I have a solution. &lt;br/&gt;
The intention of &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-682&quot; title=&quot;Special characters (tab and so on) in PatternLayout do not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-682&quot;&gt;&lt;del&gt;LOG4J2-682&lt;/del&gt;&lt;/a&gt; was not for special characters to be used in file paths, it was mainly for the PatternLayout of log events in the log file. It&apos;s just that the code where the special character sequences are converted is also used by the RollingFileManager.&lt;/p&gt;

&lt;p&gt;So, when used by the RollingFileManager, we &lt;em&gt;don&apos;t&lt;/em&gt; want backslashes to be treated as escape characters, but &lt;em&gt;otherwise we do&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;The easiest way to fix this is to add another boolean parameter to &lt;tt&gt;PatternParser.parse(String, List&amp;lt;PatternConverter&amp;gt;, List&amp;lt;FormattingInfo&amp;gt;, boolean)&lt;/tt&gt; and to the &lt;tt&gt;LiteralPatternConverter&lt;/tt&gt; constructor. This boolean would control whether &lt;tt&gt;OptionConverter.convertSpecialChars&lt;/tt&gt; is invoked or not.&lt;/p&gt;</comment>
                            <comment id="14140839" author="remkop@yahoo.com" created="Fri, 19 Sep 2014 16:40:28 +0000"  >&lt;p&gt;Fixed in master in commit b4ad64f3dad6cbe9fdb8ca7427fc941661ab83ea.&lt;br/&gt;
Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12731003">LOG4J2-755</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12749162">LOG4J2-877</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12723618">LOG4J2-682</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i201of:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>