<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:38:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1990] ConcurrentModificationException logging a parameter of type Map </title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1990</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Hello,&lt;br/&gt;
Working with current JMeter trunk and:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;attached test plan&lt;/li&gt;
	&lt;li&gt;org.apache.jmeter.protocol.http.control.CacheManager level set to debug in log4j2.xml in bin folder&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I get:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;java.util.concurrent.ExecutionException: java.util.ConcurrentModificationException
	at java.util.concurrent.FutureTask.report(FutureTask.java:122) ~[?:1.8.0_121]
	at java.util.concurrent.FutureTask.get(FutureTask.java:192) ~[?:1.8.0_121]
	at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.downloadPageResources(HTTPSamplerBase.java:1349) [ApacheJMeter_http.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.resultProcessing(HTTPSamplerBase.java:1657) [ApacheJMeter_http.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.protocol.http.sampler.HTTPAbstractImpl.resultProcessing(HTTPAbstractImpl.java:519) [ApacheJMeter_http.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.protocol.http.sampler.HTTPHC4Impl.sample(HTTPHC4Impl.java:534) [ApacheJMeter_http.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy.sample(HTTPSamplerProxy.java:74) [ApacheJMeter_http.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:1189) [ApacheJMeter_http.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase.sample(HTTPSamplerBase.java:1178) [ApacheJMeter_http.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.threads.JMeterThread.executeSamplePackage(JMeterThread.java:500) [ApacheJMeter_core.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.threads.JMeterThread.processSampler(JMeterThread.java:425) [ApacheJMeter_core.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.threads.JMeterThread.run(JMeterThread.java:254) [ApacheJMeter_core.jar:3.3-SNAPSHOT.20170724]
	at java.lang.Thread.run(Thread.java:745) [?:1.8.0_121]
Caused by: java.util.ConcurrentModificationException
	at org.apache.commons.collections.map.AbstractLinkedMap$LinkIterator.nextEntry(AbstractLinkedMap.java:560) ~[commons-collections-3.2.2.jar:3.2.2]
	at org.apache.commons.collections.map.AbstractLinkedMap$EntrySetIterator.next(AbstractLinkedMap.java:428) ~[commons-collections-3.2.2.jar:3.2.2]
	at org.apache.logging.log4j.message.ParameterFormatter.appendMap(ParameterFormatter.java:569) ~[log4j-api-2.8.2.jar:2.8.2]
	at org.apache.logging.log4j.message.ParameterFormatter.appendPotentiallyRecursiveValue(ParameterFormatter.java:505) ~[log4j-api-2.8.2.jar:2.8.2]
	at org.apache.logging.log4j.message.ParameterFormatter.recursiveDeepToString(ParameterFormatter.java:432) ~[log4j-api-2.8.2.jar:2.8.2]
	at org.apache.logging.log4j.message.ParameterFormatter.formatMessage2(ParameterFormatter.java:189) ~[log4j-api-2.8.2.jar:2.8.2]
	at org.apache.logging.log4j.message.ReusableParameterizedMessage.formatTo(ReusableParameterizedMessage.java:313) ~[log4j-api-2.8.2.jar:2.8.2]
	at org.apache.logging.log4j.core.impl.MutableLogEvent.setMessage(MutableLogEvent.java:214) ~[log4j-core-2.8.2.jar:2.8.2]
	at org.apache.logging.log4j.core.impl.ReusableLogEventFactory.createEvent(ReusableLogEventFactory.java:81) ~[log4j-core-2.8.2.jar:2.8.2]
	at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:401) [log4j-core-2.8.2.jar:2.8.2]
	at org.apache.logging.log4j.core.config.AwaitCompletionReliabilityStrategy.log(AwaitCompletionReliabilityStrategy.java:63) [log4j-core-2.8.2.jar:2.8.2]
	at org.apache.logging.log4j.core.Logger.logMessage(Logger.java:146) [log4j-core-2.8.2.jar:2.8.2]
	at org.apache.logging.log4j.spi.AbstractLogger.logMessageSafely(AbstractLogger.java:2091) [log4j-api-2.8.2.jar:2.8.2]
	at org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:2005) [log4j-api-2.8.2.jar:2.8.2]
	at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:1876) [log4j-api-2.8.2.jar:2.8.2]
	at org.apache.logging.slf4j.Log4jLogger.debug(Log4jLogger.java:124) [log4j-slf4j-impl-2.8.2.jar:2.8.2]
	at org.apache.jmeter.protocol.http.control.CacheManager.getEntry(CacheManager.java:501) ~[ApacheJMeter_http.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.protocol.http.control.CacheManager.inCache(CacheManager.java:431) ~[ApacheJMeter_http.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.protocol.http.sampler.HTTPHC4Impl.sample(HTTPHC4Impl.java:443) ~[ApacheJMeter_http.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.protocol.http.sampler.HTTPSamplerProxy.sample(HTTPSamplerProxy.java:74) ~[ApacheJMeter_http.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase$ASyncSample.call(HTTPSamplerBase.java:2031) ~[ApacheJMeter_http.jar:3.3-SNAPSHOT.20170724]
	at org.apache.jmeter.protocol.http.sampler.HTTPSamplerBase$ASyncSample.call(HTTPSamplerBase.java:1) ~[ApacheJMeter_http.jar:3.3-SNAPSHOT.20170724]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_121]
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) ~[?:1.8.0_121]
	at java.util.concurrent.FutureTask.run(FutureTask.java:266) ~[?:1.8.0_121]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_121]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_121]
	... 1 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13090317">LOG4J2-1990</key>
            <summary>ConcurrentModificationException logging a parameter of type Map </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pmouawad">Philippe Mouawad</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Jul 2017 19:48:12 +0000</created>
                <updated>Thu, 9 Feb 2023 19:22:30 +0000</updated>
                                            <version>2.8.2</version>
                                    <fixVersion>2.16.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16102362" author="garydgregory" created="Wed, 26 Jul 2017 22:08:37 +0000"  >&lt;p&gt;Either JMeter needs to use an implementation of &lt;tt&gt;ConcurrentMap&lt;/tt&gt; or we need to lock the map before we iterate on it (and if it is not a &lt;tt&gt;ConcurrentMap&lt;/tt&gt;, which might be a slight optimization.)&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16102364" author="garydgregory" created="Wed, 26 Jul 2017 22:11:29 +0000"  >&lt;p&gt;Also, instead of checking for &lt;tt&gt;Collection&lt;/tt&gt; for deep recursion, should we check for &lt;tt&gt;Iterable&lt;/tt&gt; and &lt;tt&gt;Enumeration&lt;/tt&gt; instead?&lt;/p&gt;</comment>
                            <comment id="16102367" author="garydgregory" created="Wed, 26 Jul 2017 22:16:47 +0000"  >&lt;p&gt;Did you just close the issue? If so, please explain. Also, you can try the attached patch on top of git master if you want to build a local SNAPSHOT.&lt;/p&gt;</comment>
                            <comment id="16102639" author="remkop@yahoo.com" created="Thu, 27 Jul 2017 03:22:43 +0000"  >&lt;p&gt;Gary, to answer your question, I would prefer to check for &lt;tt&gt;Map&lt;/tt&gt; and &lt;tt&gt;Collection&lt;/tt&gt; instead of &lt;tt&gt;Iterable&lt;/tt&gt; or &lt;tt&gt;Enumeration&lt;/tt&gt;, because custom user objects may implement &lt;tt&gt;Iterable&lt;/tt&gt; etc but possibly have a different threading model where Log4j2 synchronizing on these objects could cause problems like deadlock. &lt;/p&gt;

&lt;p&gt;However, the risk that synchronizing causes other problems also exists with &lt;tt&gt;Map&lt;/tt&gt; and &lt;tt&gt;Collection&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;I&apos;m still not 100% sure it&apos;s a good idea for Log4j2 to synchronize on these parameter objects. During synchronous logging the application should not be modifying the object in another thread, and with asynchronous logging Log4j2 takes a snapshot of the parameters in the application thread, so we should never see a ConcurrentModificationException unless there&apos;s a bug somewhere. &lt;/p&gt;</comment>
                            <comment id="16102808" author="garydgregory" created="Thu, 27 Jul 2017 06:55:54 +0000"  >&lt;p&gt;OK, let&apos;s leave Map and Collection checking as is for now.&lt;/p&gt;

&lt;p&gt;WRT synchronizing on Maps and Collections, we might not have a choice WRT useability: If I (a method) am given a Map or Collections and I want to log it, what should I do? Wrap it in my own shallow copy of that Map or Collections and then pass it to a logger method to avoid a concurrency exception? That seems like tough sell &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I may have zero control over what is happening to that collection outside of my method or even my thread... I do not see that we have a choice but to synchronize...&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="16102837" author="remkop@yahoo.com" created="Thu, 27 Jul 2017 07:20:28 +0000"  >&lt;p&gt;Users should not need to do anything special. They should be able to log Maps and Collections without seeing a ConcurrentModificationException. &lt;/p&gt;

&lt;p&gt;However, if an application has a bug, and one application thread is modifying the map while a different  thread is iterating over it, then you will see this exception. You may see it while logging, or elsewhere when iterating over it. (Wrapping it will not help. Even synchronizing on it will not help if the other thread doesn&apos;t also synchronize on it before modifying the map.)&lt;/p&gt;

&lt;p&gt;TLDR: Log4j2 cannot defend your application against concurrency bugs. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1988&quot; title=&quot;java.util.ConcurrentModificationException with AsyncLogger?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1988&quot;&gt;&lt;del&gt;LOG4J2-1988&lt;/del&gt;&lt;/a&gt; (while appearing similar because of the exception) is a different issue where asynchronous logging somehow failed to take a snapshot of the map before handing it off to the background thread. That one smells like a Log4j2 bug to me. &lt;/p&gt;

&lt;p&gt;This ticket seems to point to a concurrency bug in the application, not in Log4j2. &lt;/p&gt;</comment>
                            <comment id="16102862" author="ralph.goers@dslextreme.com" created="Thu, 27 Jul 2017 07:38:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/async.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/manual/async.html&lt;/a&gt; already documents all of this.&lt;/p&gt;</comment>
                            <comment id="16102888" author="garydgregory" created="Thu, 27 Jul 2017 07:55:07 +0000"  >&lt;p&gt;You&apos;re right, synchronizing will not help. &lt;/p&gt;

&lt;p&gt;Why won&apos;t wrapping help? m = new HashMap(); m.addAll(...) I guess that you could get a CME during the copying which needs to iterate... &lt;/p&gt;

&lt;p&gt;Maybe we need to catch CME and just log that we cannot get the next element:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/log4j-api/src/main/java/org/apache/logging/log4j/message/ParameterFormatter.java b/log4j-api/src/main/java/org/apache/logging/log4j/message/ParameterFormatter.java
index 79c447a..4aa8c62 100644
--- a/log4j-api/src/main/java/org/apache/logging/log4j/message/ParameterFormatter.java
+++ b/log4j-api/src/main/java/org/apache/logging/log4j/message/ParameterFormatter.java
@@ -19,11 +19,13 @@
 import java.text.SimpleDateFormat;
 import java.util.Arrays;
 import java.util.Collection;
+import java.util.ConcurrentModificationException;
 import java.util.Date;
 import java.util.HashSet;
 import java.util.Map;
 import java.util.Set;
 
+import org.apache.logging.log4j.status.StatusLogger;
 import org.apache.logging.log4j.util.StringBuilderFormattable;
 
 /**
@@ -566,18 +568,22 @@
             final Map&amp;lt;?, ?&amp;gt; oMap = (Map&amp;lt;?, ?&amp;gt;) o;
             str.append(&apos;{&apos;);
             boolean isFirst = true;
-            for (final Object o1 : oMap.entrySet()) {
-                final Map.Entry&amp;lt;?, ?&amp;gt; current = (Map.Entry&amp;lt;?, ?&amp;gt;) o1;
-                if (isFirst) {
-                    isFirst = false;
-                } else {
-                    str.append(&quot;, &quot;);
+            try {
+                for (final Object o1 : oMap.entrySet()) {
+                    final Map.Entry&amp;lt;?, ?&amp;gt; current = (Map.Entry&amp;lt;?, ?&amp;gt;) o1;
+                    if (isFirst) {
+                        isFirst = false;
+                    } else {
+                        str.append(&quot;, &quot;);
+                    }
+                    final Object key = current.getKey();
+                    final Object value = current.getValue();
+                    recursiveDeepToString(key, str, new HashSet&amp;lt;&amp;gt;(dejaVu));
+                    str.append(&apos;=&apos;);
+                    recursiveDeepToString(value, str, new HashSet&amp;lt;&amp;gt;(dejaVu));
                 }
-                final Object key = current.getKey();
-                final Object value = current.getValue();
-                recursiveDeepToString(key, str, new HashSet&amp;lt;&amp;gt;(dejaVu));
-                str.append(&apos;=&apos;);
-                recursiveDeepToString(value, str, new HashSet&amp;lt;&amp;gt;(dejaVu));
+            } catch (ConcurrentModificationException e) {
+                StatusLogger.getLogger().warn(&quot;ConcurrentModificationException logging a Map&quot;, e);
             }
             str.append(&apos;}&apos;);
         }
@@ -596,13 +602,17 @@
             final Collection&amp;lt;?&amp;gt; oCol = (Collection&amp;lt;?&amp;gt;) o;
             str.append(&apos;[&apos;);
             boolean isFirst = true;
-            for (final Object anOCol : oCol) {
-                if (isFirst) {
-                    isFirst = false;
-                } else {
-                    str.append(&quot;, &quot;);
+            try {
+                for (final Object anOCol : oCol) {
+                    if (isFirst) {
+                        isFirst = false;
+                    } else {
+                        str.append(&quot;, &quot;);
+                    }
+                    recursiveDeepToString(anOCol, str, new HashSet&amp;lt;&amp;gt;(dejaVu));
                 }
-                recursiveDeepToString(anOCol, str, new HashSet&amp;lt;&amp;gt;(dejaVu));
+            } catch (ConcurrentModificationException e) {
+                StatusLogger.getLogger().warn(&quot;ConcurrentModificationException logging  a Collection&quot;, e);
             }
             str.append(&apos;]&apos;);
         }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and maybe even put something in the string we&apos;re building...&lt;br/&gt;
?&lt;/p&gt;</comment>
                            <comment id="16102940" author="ralph.goers@dslextreme.com" created="Thu, 27 Jul 2017 08:42:43 +0000"  >&lt;p&gt;The bottom line is that when this happens it is user error. We have documented what we expect. The string that is in the process of being built is going to contain garbage, so returning from this successfully doesn&apos;t seem right. In this case I would put the try/catch in MutableLogEvent and print something like the Message simple name and message format string when an exception occurs along with writing a StatusLogger warning.&lt;/p&gt;</comment>
                            <comment id="16103607" author="garydgregory" created="Thu, 27 Jul 2017 17:54:11 +0000"  >&lt;p&gt;Like so:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/log4j-core/src/main/java/org/apache/logging/log4j/core/impl/MutableLogEvent.java b/log4j-core/src/main/java/org/apache/logging/log4j/core/impl/MutableLogEvent.java
index 56867b4..9f8a8b8 100644
--- a/log4j-core/src/main/java/org/apache/logging/log4j/core/impl/MutableLogEvent.java
+++ b/log4j-core/src/main/java/org/apache/logging/log4j/core/impl/MutableLogEvent.java
@@ -19,6 +19,7 @@
 import java.io.InvalidObjectException;
 import java.io.ObjectInputStream;
 import java.util.Arrays;
+import java.util.ConcurrentModificationException;
 import java.util.Map;
 
 import org.apache.logging.log4j.Level;
@@ -32,6 +33,7 @@
 import org.apache.logging.log4j.message.ParameterizedMessage;
 import org.apache.logging.log4j.message.ReusableMessage;
 import org.apache.logging.log4j.message.SimpleMessage;
+import org.apache.logging.log4j.status.StatusLogger;
 import org.apache.logging.log4j.util.StackLocatorUtil;
 import org.apache.logging.log4j.util.StringBuilders;
 import org.apache.logging.log4j.util.StringMap;
@@ -207,11 +209,23 @@
 
     public void setMessage(final Message msg) {
         if (msg instanceof ReusableMessage) {
-            final ReusableMessage reusable = (ReusableMessage) msg;
-            reusable.formatTo(getMessageTextForWriting());
-            if (parameters != null) {
-                parameters = reusable.swapParameters(parameters);
-                parameterCount = reusable.getParameterCount();
+            try {
+                final ReusableMessage reusable = (ReusableMessage) msg;
+                reusable.formatTo(getMessageTextForWriting());
+                if (parameters != null) {
+                    parameters = reusable.swapParameters(parameters);
+                    parameterCount = reusable.getParameterCount();
+                }
+            } catch (ConcurrentModificationException e) {
+                StringBuilder sb = getMessageTextForWriting();
+                sb.append(getClass().getSimpleName());
+                sb.append(&quot;: &quot;);
+                sb.append(e.getClass().getName());
+                sb.append(&quot; in setting a &quot;);
+                sb.append(msg.getClass().getSimpleName());
+                sb.append(&quot;; format: &quot;);
+                sb.append(msg.getFormat());
+                StatusLogger.getLogger().warn(sb.toString(), e);
             }
         } else {
             // if the Message instance is reused, there is no point in freezing its message here
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;?&lt;/p&gt;</comment>
                            <comment id="16103701" author="ralph.goers@dslextreme.com" created="Thu, 27 Jul 2017 18:57:19 +0000"  >&lt;p&gt;yeah, that looks ok.&lt;/p&gt;</comment>
                            <comment id="16103792" author="jira-bot" created="Thu, 27 Jul 2017 19:50:03 +0000"  >&lt;p&gt;Commit 6f6d95d3fcf2e17e66eb7763b6122adbe018f8be in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=6f6d95d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=6f6d95d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1990&quot; title=&quot;ConcurrentModificationException logging a parameter of type Map &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1990&quot;&gt;LOG4J2-1990&lt;/a&gt; ConcurrentModificationException logging a parameter of&lt;br/&gt;
type Map.&lt;/p&gt;</comment>
                            <comment id="16103797" author="garydgregory" created="Thu, 27 Jul 2017 19:52:59 +0000"  >&lt;p&gt;In git master, please verify and close. See &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16104086" author="remkop@yahoo.com" created="Thu, 27 Jul 2017 23:37:04 +0000"  >&lt;p&gt;Sorry I&apos;m late with this feedback, but why is catching the ConcurrentModificationException a good idea?&lt;/p&gt;

&lt;p&gt;Before this change, if an application had a concurrency bug they would find out by this exception occurring in their application. Now Log4j2 hides the problem. If status logging is disabled it is hidden completely, if it is enabled users will only be able to find out if they monitor  the console. &lt;/p&gt;

&lt;p&gt;We agreed that this problem was caused by a bug in the application. Log4j2 should not try to hide such bugs just because they happen to manifest while Log4j2 is doing work. &lt;/p&gt;</comment>
                            <comment id="16104123" author="garydgregory" created="Thu, 27 Jul 2017 23:59:40 +0000"  >&lt;p&gt;Here is a real life scenario I ran into two week ago that parallels this issue: I have an app that plugins into a larger framework. One of part of the app in invoked from main and the command line so it is &quot;my&quot; app but I still have to plugin a whole bunch of complex code into this framework. Another part of the app is run from the framework&apos;s command line with some other plugins I provide through a configuration file. In my app guts, at some point, I must traverse the &lt;tt&gt;Properties&lt;/tt&gt; from &lt;tt&gt;java.util.System.getProperties()&lt;/tt&gt;. Sometimes I get a {{ConcurrentModificationException}, sometimes not. Why? Because somewhere, someone (not my app) is fiddling with system properties, adding and/or removing entries, don&apos;t know, don&apos;t care. I can&apos;t do anything about it but I do not want to blow up so I have to do &lt;em&gt;something&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;The general problem is that some code in a library or in an app is given a Map that it did not create and does not manage. Who owns the bug of not making this a &lt;tt&gt;ConcurrentMap&lt;/tt&gt;? Doesn&apos;t matter. The point is that we need to not blow up randomly IMO.&lt;/p&gt;</comment>
                            <comment id="16104127" author="garydgregory" created="Fri, 28 Jul 2017 00:02:52 +0000"  >&lt;p&gt;Oh, yes, and I agree if you think this ugly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16104179" author="ralph.goers@dslextreme.com" created="Fri, 28 Jul 2017 00:30:48 +0000"  >&lt;p&gt;In my opinion Log4J should never be the cause of an application failure. We use the AppenderControl to catch exceptions from appenders and hide them from the application unless configured not to do that. In this case the exception can happen much earlier in the event processing. And we don&apos;t have a way to provide the user with a choice on whether they want to see it or not.&lt;/p&gt;</comment>
                            <comment id="16104204" author="garydgregory" created="Fri, 28 Jul 2017 00:33:10 +0000"  >&lt;p&gt;Do we want an &quot;ignoreExceptions&quot; option at the &amp;lt;Configuration&amp;gt; level?&lt;/p&gt;</comment>
                            <comment id="16104328" author="remkop@yahoo.com" created="Fri, 28 Jul 2017 02:11:04 +0000"  >&lt;p&gt;Gary, you say you don&apos;t care, but you have no choice if you don&apos;t want to get hit with a &lt;tt&gt;ConcurrentModificationException&lt;/tt&gt;. If you know that your application has this issue, you can only avoid this issue by iterating over the system properties in a try-catch loop. &lt;/p&gt;

&lt;p&gt;My argument is that working around application bugs is the responsibility of the application. If the application wants to log a map that may be modified elsewhere they should copy it in a try-catch block and log the copy. I agree if you think this is inconvenient. However, the bug means the map is suspect and one can&apos;t just pass it on to external libraries and hope for the best. &lt;/p&gt;

&lt;p&gt;Ralph, I don&apos;t think this classifies as Log4j2 causing application failure. The bug could manifest anywhere, it just happened to show up while Log4j2 was iterating over the map instead of application code doing the iterating.  Would we be doing our users a service by hiding this bug?&lt;/p&gt;</comment>
                            <comment id="16104364" author="remkop@yahoo.com" created="Fri, 28 Jul 2017 02:46:29 +0000"  >&lt;p&gt;I believe this is different from the &quot;normal&quot; error handling we do in &lt;tt&gt;AppenderControl&lt;/tt&gt;. There we handle (and propagate when requested) exceptions that were &lt;b&gt;caused by&lt;/b&gt; the logging itself, like disk full, socket disconnected, etc.&lt;/p&gt;

&lt;p&gt;This to me is more similar to trying to log an object that throws a NullPointerException in its &lt;tt&gt;toString&lt;/tt&gt; method.&lt;/p&gt;</comment>
                            <comment id="16104376" author="jvz" created="Fri, 28 Jul 2017 03:13:12 +0000"  >&lt;p&gt;System properties are stored in a Properties instance which is a Hashtable which synchronizes on &lt;tt&gt;this&lt;/tt&gt;. Thus, just synchronize on it to iterate. No other thread can modify it then, naturally.&lt;/p&gt;</comment>
                            <comment id="16104379" author="garydgregory" created="Fri, 28 Jul 2017 03:18:00 +0000"  >&lt;p&gt;That&apos;s what I did in my app but that will not work generically on all Map&lt;br/&gt;
and Collection instances for us in Log4j.&lt;/p&gt;

</comment>
                            <comment id="16104382" author="jvz" created="Fri, 28 Jul 2017 03:21:31 +0000"  >&lt;p&gt;Similar to your idea of checking for ConcurrentMap and not needing synchronisation, you could check for instances of Hashtable and know it&apos;s fully synchronised already. Outside of that, it&apos;s hard to say. I&apos;m a big fan of using immutable data structures everywhere possible due to bugs like this.&lt;/p&gt;</comment>
                            <comment id="16104388" author="garydgregory" created="Fri, 28 Jul 2017 03:27:16 +0000"  >&lt;p&gt;What would that look like as a patch? Right we just catch CME.&lt;/p&gt;</comment>
                            <comment id="16104398" author="jvz" created="Fri, 28 Jul 2017 03:37:28 +0000"  >&lt;p&gt;In ParameterFormatter: &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;a=blob;f=log4j-api/src/main/java/org/apache/logging/log4j/message/ParameterFormatter.java;h=79c447a89f34885f21de36581672dd0d9ced9381;hb=HEAD#l569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;a=blob;f=log4j-api/src/main/java/org/apache/logging/log4j/message/ParameterFormatter.java;h=79c447a89f34885f21de36581672dd0d9ced9381;hb=HEAD#l569&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;appendMap and appendCollection can be enhanced for synchronisation when supportable (e.g., instanceof Hashtable, Vector, etc.)&lt;/p&gt;</comment>
                            <comment id="16104400" author="garydgregory" created="Fri, 28 Jul 2017 03:40:41 +0000"  >&lt;p&gt;You mean like &quot;if map is Hashtable then sync(map)&quot;? Why not always sync on the map no matter what kind it is? Possible deadlocks?&lt;/p&gt;</comment>
                            <comment id="16104406" author="jvz" created="Fri, 28 Jul 2017 03:43:06 +0000"  >&lt;p&gt;Unless the class adds &lt;tt&gt;synchronized&lt;/tt&gt; (or &lt;tt&gt;synchronized(this)&lt;/tt&gt;) to its mutation methods, synchronising on the instance won&apos;t prevent anything. Then there&apos;s the java.util.concurrent classes which tend to use internal locks or other tricks (see LinkedTransferQueue for example) to avoid coarse locking like that which means locking on the instance, again, is pointless.&lt;/p&gt;</comment>
                            <comment id="16104414" author="remkop@yahoo.com" created="Fri, 28 Jul 2017 04:01:19 +0000"  >&lt;p&gt;Guys, what we&apos;re talking about is like trying to protect against applications logging objects that deliberately throw a RuntimeException when their &lt;tt&gt;toString&lt;/tt&gt; method is called. We should not do it. &lt;/p&gt;

&lt;p&gt;We should undo the try-catch(ConcurrentModificationException) in MutableLogEvent. &lt;/p&gt;</comment>
                            <comment id="16104422" author="jvz" created="Fri, 28 Jul 2017 04:12:03 +0000"  >&lt;p&gt;That&apos;s a good point. Perhaps catch, log some sort of warning, and rethrow? Could help in debugging.&lt;/p&gt;</comment>
                            <comment id="16104432" author="ralph.goers@dslextreme.com" created="Fri, 28 Jul 2017 04:29:07 +0000"  >&lt;p&gt;Remko, my position is that if an application callers a logger method it should never get an exception from inside that method. Performing logging is not something that should ever cause an application to fail. So even though the application passed us something bad we shouldn&apos;t throw up because of it. We need to do something that makes the application aware there is a problem and then swallow the exception - unless we add a switch that says the exception should be propagated to the caller. &lt;/p&gt;

&lt;p&gt;In reality what we should be doing instead of modifying MutableLogEvent is modify the logMessageSafely method in AbstractLogger. It already has a try block. We simply should be catching exception and logging the exception to the StatusLogger when it happens. We could easily add an option to the Configuration element as Gary suggested that would allow the exception to be propagated if it is set.&lt;/p&gt;</comment>
                            <comment id="16104435" author="garydgregory" created="Fri, 28 Jul 2017 04:30:37 +0000"  >&lt;p&gt;I&apos;m with Ralph on this one.&lt;/p&gt;</comment>
                            <comment id="16104460" author="remkop@yahoo.com" created="Fri, 28 Jul 2017 04:58:54 +0000"  >&lt;p&gt;If we do this we should do it for all runtime exceptions that may be thrown from toString, not just ConcurrentModificationException. &lt;/p&gt;</comment>
                            <comment id="16104461" author="ralph.goers@dslextreme.com" created="Fri, 28 Jul 2017 04:59:54 +0000"  >&lt;p&gt;Yes, it should catch Exception.&lt;/p&gt;</comment>
                            <comment id="16104465" author="jvz" created="Fri, 28 Jul 2017 05:05:02 +0000"  >&lt;p&gt;All sounds good to me.&lt;/p&gt;</comment>
                            <comment id="16105829" author="jira-bot" created="Fri, 28 Jul 2017 22:59:47 +0000"  >&lt;p&gt;Commit e07cc14b10315088c47fbfd9a6049cf9861d9c27 in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=e07cc14&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=e07cc14&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1990&quot; title=&quot;ConcurrentModificationException logging a parameter of type Map &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1990&quot;&gt;LOG4J2-1990&lt;/a&gt; ConcurrentModificationException logging a parameter of&lt;br/&gt;
type Map. Catch Exception instead of ConcurrentModificationException as&lt;br/&gt;
suggested by Ralph.&lt;/p&gt;</comment>
                            <comment id="16105851" author="remkop@yahoo.com" created="Fri, 28 Jul 2017 23:22:50 +0000"  >&lt;p&gt;Reopening for moving the error handling to a different place:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;what we should be doing instead of modifying MutableLogEvent is modify the logMessageSafely method in AbstractLogger.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="16106287" author="jira-bot" created="Sun, 30 Jul 2017 02:26:52 +0000"  >&lt;p&gt;Commit 3c3a9e4a1d8d53a4fd2dfa302633380eaa08c6da in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=3c3a9e4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=3c3a9e4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1990&quot; title=&quot;ConcurrentModificationException logging a parameter of type Map &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1990&quot;&gt;LOG4J2-1990&lt;/a&gt; ConcurrentModificationException logging a parameter of&lt;br/&gt;
type Map. Another go at it based on Ralph&apos;s suggestion.&lt;/p&gt;</comment>
                            <comment id="16106288" author="garydgregory" created="Sun, 30 Jul 2017 02:27:12 +0000"  >&lt;p&gt;Done in git master. &lt;/p&gt;</comment>
                            <comment id="16106296" author="jira-bot" created="Sun, 30 Jul 2017 03:13:24 +0000"  >&lt;p&gt;Commit 68de0ff88936cc2e8f77b3a67e6c495c390ea7be in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=68de0ff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=68de0ff&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1990&quot; title=&quot;ConcurrentModificationException logging a parameter of type Map &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1990&quot;&gt;LOG4J2-1990&lt;/a&gt; ConcurrentModificationException logging a parameter of&lt;br/&gt;
type Map. Another go at it based on Ralph&apos;s suggestion.&lt;/p&gt;</comment>
                            <comment id="16106417" author="remkop@yahoo.com" created="Sun, 30 Jul 2017 10:08:28 +0000"  >&lt;p&gt;Thanks for the quick work, Gary! You&apos;re on a roll!&lt;/p&gt;</comment>
                            <comment id="16106439" author="jira-bot" created="Sun, 30 Jul 2017 10:34:20 +0000"  >&lt;p&gt;Commit 218117a910995918b75ba718076e4b08862245a9 in logging-log4j2&apos;s branch refs/heads/master from rpopma&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=218117a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=218117a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1990&quot; title=&quot;ConcurrentModificationException logging a parameter of type Map &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1990&quot;&gt;LOG4J2-1990&lt;/a&gt; refactor #logMessageSafely method to stay within 35 byte MaxInlineSize threshold; add TODO for Configuration setting to propagate exceptions back to caller&lt;/p&gt;</comment>
                            <comment id="16106649" author="jira-bot" created="Sun, 30 Jul 2017 20:40:16 +0000"  >&lt;p&gt;Commit 8da3df59a5fd4cfb204ee975a93113614b1758eb in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=8da3df5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=8da3df5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1990&quot; title=&quot;ConcurrentModificationException logging a parameter of type Map &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1990&quot;&gt;LOG4J2-1990&lt;/a&gt; ConcurrentModificationException logging a parameter of&lt;br/&gt;
type Map. Clearer error message.&lt;/p&gt;</comment>
                            <comment id="16106656" author="jira-bot" created="Sun, 30 Jul 2017 21:09:31 +0000"  >&lt;p&gt;Commit 005139d6a2a5d6a75a6dde557a7d7693414114db in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=005139d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=005139d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1990&quot; title=&quot;ConcurrentModificationException logging a parameter of type Map &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1990&quot;&gt;LOG4J2-1990&lt;/a&gt; ConcurrentModificationException logging a parameter of&lt;br/&gt;
type Map. Clearer error message. Update to allow&lt;br/&gt;
AppenderLoggingException to percolate to the caller when requested with&lt;br/&gt;
the ignoreExceptions=&quot;false&quot; setting.&lt;/p&gt;</comment>
                            <comment id="16106685" author="jira-bot" created="Sun, 30 Jul 2017 22:42:50 +0000"  >&lt;p&gt;Commit bfdb2f533ca569606dd8d62fdd15b0f706404ac6 in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=bfdb2f5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=bfdb2f5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1990&quot; title=&quot;ConcurrentModificationException logging a parameter of type Map &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1990&quot;&gt;LOG4J2-1990&lt;/a&gt; ConcurrentModificationException logging a parameter of type Map. Another go at it based on Ralph&apos;s suggestion.&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 68de0ff88936cc2e8f77b3a67e6c495c390ea7be.&lt;/p&gt;</comment>
                            <comment id="16106686" author="jira-bot" created="Sun, 30 Jul 2017 22:45:43 +0000"  >&lt;p&gt;Commit 7aa2a223d175d055d31e4e4c4cce3c6519b42d70 in logging-log4j2&apos;s branch refs/heads/master from rpopma&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=7aa2a22&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=7aa2a22&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1990&quot; title=&quot;ConcurrentModificationException logging a parameter of type Map &quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1990&quot;&gt;LOG4J2-1990&lt;/a&gt; move exception handling out of hot code path&lt;/p&gt;</comment>
                            <comment id="16106701" author="remkop@yahoo.com" created="Sun, 30 Jul 2017 23:39:48 +0000"  >&lt;p&gt;The remaining problem is &quot;where does the configuration to control this behavior live?&quot;&lt;/p&gt;

&lt;p&gt;I am still very hesitant about hiding bugs in the application (exceptions being thrown from the &lt;tt&gt;toString&lt;/tt&gt; method - always a bug). So even if we decide to make this the default (should we, really?) there needs to be a way to turn this off. &lt;/p&gt;

&lt;p&gt;But where? All this (Message formatting and calling toString on parameter objects) lives in the log4j-api module, so there is no Configuration object...&lt;/p&gt;</comment>
                            <comment id="16107476" author="jvz" created="Mon, 31 Jul 2017 15:57:09 +0000"  >&lt;p&gt;The only configuration available (even with my unmerged enhancements) in log4j-api is via properties be them system or a component properties file. In that regard, make a property like &lt;tt&gt;log4j2.ignoreExceptionsInToString&lt;/tt&gt; or something like that.&lt;/p&gt;</comment>
                            <comment id="16107501" author="garydgregory" created="Mon, 31 Jul 2017 16:05:41 +0000"  >&lt;p&gt;I think log4j2.ignoreExceptions might be more consistent since we have settings like that already.&lt;/p&gt;</comment>
                            <comment id="16107548" author="jvz" created="Mon, 31 Jul 2017 16:31:13 +0000"  >&lt;p&gt;That just seems like too vague of a setting, though if it&apos;s supposed to be a global sort of ignore exceptions, then it would make sense.&lt;/p&gt;</comment>
                            <comment id="16107669" author="ralph.goers@dslextreme.com" created="Mon, 31 Jul 2017 17:39:44 +0000"  >&lt;p&gt;I have a use case with Audit logging where I only want a specific logger to percolate exceptions, so using a system property isn&apos;t desirable. It would need to be a method on the Logger. I am glad that Gary thought of throwing a specific Exception in the AppenderControl as that would have been a big problem.&lt;/p&gt;

&lt;p&gt;I would be ok if in core you could configure a setting on a logger or globally to percolate exceptions and that caused the method on the loggers to be called when they are created.&lt;/p&gt;</comment>
                            <comment id="16307085" author="ralph.goers@dslextreme.com" created="Sun, 31 Dec 2017 05:26:13 +0000"  >&lt;p&gt;Just a reminder that this is unresolved.&lt;/p&gt;</comment>
                            <comment id="17686726" author="gus_heck" created="Thu, 9 Feb 2023 19:22:30 +0000"  >&lt;p&gt;Hmm this makes debugging custom appenders that rely on ThreadContext difficult. Stack trace only tells me which class was involved, no way to catch the exception on it&apos;s way up and add info about which of a dozen possible configured instances is putting a null in the context when that should theoretically be impossible. The ability to bubble things up via configuration (preferably&#160; something I can stick in the log4j2.xml either globally or for specific appenders) would certainly help.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12879059" name="LOG4J2-1990.patch" size="2819" author="ggregory" created="Wed, 26 Jul 2017 22:16:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3i20n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>