<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:32:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-378] Logging generates file named ${sys on some systems</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-378</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;In a webapp I&apos;m setting a system property in my apps ServletContextListener, and using that system property in my log4j2.xml file, like so:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;appender type=&lt;span class=&quot;code-quote&quot;&gt;&quot;FastFile&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;File&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;${sys:catalina.home}/logs/${sys:application-name}.log&quot;&lt;/span&gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;On my Windows machine, a log file named &quot;${sys.&quot; (always 0 bytes) is being created instead of a log file with the application-name. The same war deployed on one of our linux servers does not create a ${sys.&quot; file and instead creates a log file with the intended application-name. &lt;/p&gt;

&lt;p&gt;I should note that the files DO appear in the directory that sys:catalina.home should resolve to. They appear elsewhere when I don&apos;t use sys:catalina.home so I&apos;m quite sure that this variable is resolving correctly and it is the sys:application-name which is the problem.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Issues occurs on Win7/64 system under Tomcat 7.0.42 / Oracle JDK 1.7.0_25; fails to occur on RHEL 5.2 system under Tomcat 7.0.26 / Oracle JDK 1.7.0_03&lt;/p&gt;</environment>
        <key id="12665954">LOG4J2-378</key>
            <summary>Logging generates file named ${sys on some systems</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ericjs">Eric Schwarzenbach</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Aug 2013 16:06:19 +0000</created>
                <updated>Thu, 30 Mar 2017 10:49:37 +0000</updated>
                            <resolved>Thu, 27 Feb 2014 20:35:12 +0000</resolved>
                                    <version>2.0-beta8</version>
                    <version>2.0-beta9</version>
                                                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13752594" author="ericjs" created="Wed, 28 Aug 2013 17:16:37 +0000"  >&lt;p&gt;What I suspect is happening is that my app&apos;s ServletContextListener contextInitialized method is getting called before Log4jServletContextListener&apos;s on the server (where the problem does not occur), but that they are getting called in the opposite order on my local machine (where the problem does occur). sys:catalina.home does not depend on my app&apos;s ServletContextListener contextInitialized method being called before Log4jServletContextListener&apos;s but sys:application-name, I believe, does.&lt;/p&gt;

&lt;p&gt;The javadoc seems to suggest that the intention is for it Log4jServletContextListener&apos;s to always occur first. This raises several issues:&lt;/p&gt;

&lt;p&gt;1) Is the fact that they get called in different orders on different machines a failure of (some version / implementation of) Tomcat to call them in the right order? Or a failure of the log4j code to ensure things are set up so as to guarantee this order? Or is the order even specified and guarranteeable?&lt;/p&gt;

&lt;p&gt;2) Is Log4jServletContextListener&apos;s contextInitialized  being called first necessarily desirable? If Log4jServletContextListener always gets called before the application&apos;s context listener, how is a web application to set up variables for use in the log4j configuration, particularly, for example (which is what I am doing), to get the webapp&apos;s name from the servlet context path to name the log files? Is there some better way to do this? (Ideally without requiring configuration to be loaded twice...which is what I ended up happening with logback when I tried to set it up to do this same thing.)&lt;/p&gt;

&lt;p&gt;According to the servlet spec &quot;The Web container registers the listener instances according to the interfaces they implement and the order in which they appear in the deployment descriptor. During Web application execution, listeners are invoked in the order of their registration.&quot; Since Log4jServletContextListener doesn&apos;t appear in my web.xml, I assume it should call them &quot;according to the interfaces they implement&quot;. I have no idea what that is supposed to mean, though.&lt;/p&gt;




</comment>
                            <comment id="13754000" author="ralph.goers@dslextreme.com" created="Thu, 29 Aug 2013 20:08:14 +0000"  >&lt;p&gt;Your interpretation of the problem seems correct. Since the variable couldn&apos;t be found the string itself would be used. But since a &quot;:&quot; isn&apos;t allowed in a file nane on Windows it looks like it truncated the name to &quot;${sys&quot;, although I am not sure why it would be &quot;${sys.&quot;.&lt;/p&gt;

&lt;p&gt;As you noted, the order that the listeners are invoked is specified in the servlet spec so I don&apos;t know why there would be a difference between the behavior on Windows vs Linux.&lt;/p&gt;

&lt;p&gt;Is it possible for you to just add the -Dapplication-name to setenv.sh?&lt;/p&gt;</comment>
                            <comment id="13754100" author="ericjs" created="Thu, 29 Aug 2013 21:45:48 +0000"  >&lt;p&gt;Sorry is it really is just &quot;${sys&quot; and not &quot;${sys.&quot; I must have made a cut and paste error.&lt;/p&gt;

&lt;p&gt;&amp;gt; Is it possible for you to just add the -Dapplication-name to setenv.sh?&lt;/p&gt;

&lt;p&gt;No, because there are multiple webapps on the server. The actual purpose behind what I am doing is to have multiple apps, even multiple copies of this particular app (copies of same war deployed with different names as different apps) each logging to files prefixed with the webapp name to make them distinguishable. &lt;/p&gt;

&lt;p&gt;It seems not unlikely that one or more version of tomcat just has a bug that causes it to run these methods in the wrong order. And I can explore that and pursue getting a newer version installed. However I want to address those two broader issues first, since I might have to change how I&apos;m doing this in a way that this becomes moot: &lt;/p&gt;

&lt;p&gt;1) what really does the servlet spec dictate should happen here? (See the last para of me previous comment...what does &quot;according to the interfaces they implement&quot; mean? &lt;/p&gt;

&lt;p&gt;2) If the spec does dictate something about the order that log4j can control...should the log4j contextInitialized come first? &lt;/p&gt;

&lt;p&gt;If so then what I&apos;m trying to do won&apos;t work...the fact that it works on one server is itself the bug. In which case is there some other way I can accomplish this? I realize that is kind of outside the scope of this bug, except that the consideration of making use cases like this one impossible could be a consideration for answering or reconsidering question 2.&lt;/p&gt;</comment>
                            <comment id="13764450" author="ralph.goers@dslextreme.com" created="Wed, 11 Sep 2013 16:13:09 +0000"  >&lt;p&gt;To get the webapp name you could do&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;appender type=&lt;span class=&quot;code-quote&quot;&gt;&quot;FastFile&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;File&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;${sys:catalina.home}/logs/${web:servletContextName}.log&quot;&lt;/span&gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that the web lookup was recently added and will be in beta9. You can test it in trunk.&lt;/p&gt;</comment>
                            <comment id="13774716" author="ericjs" created="Mon, 23 Sep 2013 16:55:40 +0000"  >&lt;p&gt;Thanks, Ralph. I&apos;ve now tried this out with beta9, and now it creates a 0 byte file named &quot;${web&quot; (on Win7/64 / 7.0.42 / Oracle JDK 1.7.0_40-b43). It does also create (and log to) a file named from the display-name in my web.xml, like &quot;My Web Application.log&quot;. I was looking for the actual name it was deployed to...for example if it deployed to TOMCAT_HOME/webapps/myapp and I was accessing it at someserver.com/myapp, I&apos;d like to see &quot;myapp.log&quot;. Is there another web: variable that might do that?&lt;/p&gt;</comment>
                            <comment id="13775598" author="ericjs" created="Mon, 23 Sep 2013 19:48:09 +0000"  >&lt;p&gt;What happens on Ubuntu seems to be slightly different. The 0 byte file created there is &quot;${web:servletContextName}.log&quot; (I suppose just because the : is more acceptable there than on windows). But in addition to that I am getting a log file being created with the display-name (e.g.  &quot;My Web Application.log&quot;) AND with the context name (e.g. &quot;myapp.log&quot;). &lt;/p&gt;</comment>
                            <comment id="13775609" author="ericjs" created="Mon, 23 Sep 2013 20:02:45 +0000"  >&lt;p&gt;It looks like the &quot;myapp.log&quot; file was somehow being caused by a different webapp. Something really odd is going on here. I had two webapps deployed, one was a previous iteration of the same app (still using log4j beta8, and still logging to &quot;...${sys:application-name}.log&quot;. Getting rid of the old webapp causes &quot;myapp.log&quot; to no longer be created. Note the the old webapp did not have the name &quot;myapp&quot; anywhere in it at all, that was completely new to this new build of my app.&lt;/p&gt;

&lt;p&gt;Further though the same messages were logged in &quot;My Web Application.log&quot; and &quot;myapp.log&quot; the &lt;em&gt;format&lt;/em&gt; was slightly different. While &quot;My Web Application.log&quot; had lines like:&lt;/p&gt;

&lt;p&gt;2013-09-23 15:39:39,644 INFO a.b.c.d.SomeServiceImpl &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-2-thread-1&amp;#93;&lt;/span&gt; SomeServiceImpl created &lt;/p&gt;

&lt;p&gt;&quot;myapp.log&quot; had lines like&lt;/p&gt;

&lt;p&gt;2013-09-23 15:39:51,419 INFO ? &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-2-thread-1&amp;#93;&lt;/span&gt; SomeServiceImpl created &lt;/p&gt;

&lt;p&gt;I&apos;m not making this stuff up, I promise!&lt;/p&gt;</comment>
                            <comment id="13775619" author="ericjs" created="Mon, 23 Sep 2013 20:19:32 +0000"  >&lt;p&gt;It occurs to me that configuration element name attribute was the same in the log4j2.xml files of the two webapps. Might that cause some...confusion between the two? The &quot;SomeServiceImpl created&quot; message could have come from either app, and given the timestamp differences, it makes me think the myapp.log message was coming from the first app, however it was just picking up the sys:application-name set by myapp. &lt;/p&gt;</comment>
                            <comment id="13814250" author="ericjs" created="Tue, 5 Nov 2013 21:06:33 +0000"  >&lt;p&gt;Bump...&lt;/p&gt;

&lt;p&gt;I know I noted some mistakes in my first comments about the bug still existing in beta9, but the basic problem still occurs:&lt;/p&gt;

&lt;p&gt;using ${web:servletContextName}.log in an appender file name still winds up creating a 0 byte file named ${web:servletContextName}.log (under linux), and it also creates one using the value from the display-name element of the web.xml rather than the name of the war file / webapp folder.&lt;/p&gt;</comment>
                            <comment id="13890702" author="mkurdyukov" created="Tue, 4 Feb 2014 14:02:30 +0000"  >&lt;p&gt;Similar problem with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;RollingRandomAccessFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;rolling-file&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;${sys:log.dir}/service.${date:yyyy-MM-dd}.log&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;ve defined &lt;tt&gt;log.dir&lt;/tt&gt; system variable and it was resolved, but not &apos;date&apos;.&lt;br/&gt;
Debug shows me using of &lt;tt&gt;org.apache.logging.log4j.core.lookup.Interpolator&lt;/tt&gt; which was created by default (without &apos;date&apos; lookup plugin).&lt;br/&gt;
I&apos;m not familiar with internal design of log4j2. Can I use &apos;date&apos; lookup plugin in patterns not related to log messages?&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Impl. version: 2.0-beta9&lt;/b&gt;&lt;/p&gt;</comment>
                            <comment id="13915020" author="ralph.goers@dslextreme.com" created="Thu, 27 Feb 2014 20:35:12 +0000"  >&lt;p&gt;Added date and ctx to default interpolator in revision 1572722. Please verify and close. System properties were added to the default interpolator in revision 1517427. &lt;/p&gt;</comment>
                            <comment id="14159607" author="cthielen" created="Sun, 5 Oct 2014 17:57:26 +0000"  >&lt;p&gt;I&apos;m still seeing this behavior with one Maven+Spring project through Eclipse (but not the other) both using log4j2 version 2.0.2.&lt;/p&gt;</comment>
                            <comment id="15178171" author="perceptron8" created="Thu, 3 Mar 2016 17:22:12 +0000"  >&lt;p&gt;Hi! I have similar problem. Here&apos;s my log4j2.xml fragment:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;File name=&lt;span class=&quot;code-quote&quot;&gt;&quot;File&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;${sys:catalina.base}/logs/${web:contextPath}.log&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;...&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/File&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;First, all stuff is being logged into correct file (say, &quot;/actual/catalina/base/logs/webapp.log&quot;). And that&apos;s ok. Then, during server&apos;s shutdown, additional empty file is created (&quot;/actual/catalina/base/logs/${web:contextPath}.log&quot;, with all these funny chars). Than&apos;s not ok.&lt;/p&gt;

&lt;p&gt;Checked with log4j2 version 2.5.&lt;/p&gt;</comment>
                            <comment id="15948831" author="perceptron8" created="Thu, 30 Mar 2017 10:49:37 +0000"  >&lt;p&gt;Hello again! My problem was caused by incorrect configuration.&lt;/p&gt;

&lt;p&gt;What I missed is that during log4j auto initialization, &lt;tt&gt;Log4jServletContextListener&lt;/tt&gt; is being registered &lt;em&gt;after&lt;/em&gt; listeners declared within web.xml. You can reorder processing of web-fragments by using &lt;tt&gt;&amp;lt;absolute-ordering&amp;gt;&lt;/tt&gt;, but you can&apos;t make them to be processed before web.xml (according to &lt;a href=&quot;http://download.oracle.com/otndocs/jcp/servlet-3.0-fr-oth-JSpec/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Servlet 3.0 Spec&lt;/a&gt; / 8.2.2 Ordering of web.xml and web-fragment.xml / 1b).&lt;/p&gt;

&lt;p&gt;Because of incorrect ordering, Spring&apos;s &lt;tt&gt;ContextLoaderListener#contextDestroyed&lt;/tt&gt; was being invoked after &lt;tt&gt;Log4jServletContextListener#contextDestroyed&lt;/tt&gt; during server&apos;s shutdown. Nested call to &lt;tt&gt;LogFactory.getLog&lt;/tt&gt; within the former one was causing &quot;/actual/catalina/base/logs/${web:contextPath}.log&quot; file to be created (log4j web context was already destroyed, so ${web:contextPath} couldn&apos;t be resolved).&lt;/p&gt;

&lt;p&gt;Sorry for misleading!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>345893</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 33 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1nnb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346194</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>