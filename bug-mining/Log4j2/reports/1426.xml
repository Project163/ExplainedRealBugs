<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:41:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2919] &quot;AsyncAppender is not active&quot; when logging with AsynAppender while the system is reconfigure  concurrently</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2919</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Hi Team,&#160;&lt;/p&gt;

&lt;p&gt;I found a problem where&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1121&quot; title=&quot;LoggerConfig performance improvement: remove waitForCompletion and associated fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1121&quot;&gt;&lt;del&gt;LOG4J2-1121&lt;/del&gt;&lt;/a&gt;&#160;try to fix, but left the&#160;scenario for &lt;b&gt;AsyncAppender.&lt;/b&gt; In&#160;org.apache.logging.log4j.core.config.AbstractConfiguration#stop(), loggerConfig.getReliabilityStrategy().beforeStopAppenders() is invoked after the AsyncAppender.stop(), so the reliablity strategy can&apos;t protect losing log events for AsyncAppender.&lt;/p&gt;

&lt;p&gt;So when logging with AsyncAppender, and at the same time reconfigure() is invoked, if the prev config stop before the AsyncAppender finish log(),&#160; the following error may occurs.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-09-08 01:16:06,145 main ERROR An exception occurred processing Appender async-console java.lang.IllegalStateException: AsyncAppender async-console is not active2020-09-08 01:16:06,145 main ERROR An exception occurred processing Appender async-console java.lang.IllegalStateException: AsyncAppender async-console is not active at org.apache.logging.log4j.core.appender.AsyncAppender.append(AsyncAppender.java:168) at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:156) at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:129) at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:120) at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:84) at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:508) at org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:468) at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:451) at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:426) at org.apache.logging.log4j.core.config.AwaitCompletionReliabilityStrategy.log(AwaitCompletionReliabilityStrategy.java:82) at org.apache.logging.log4j.core.Logger.log(Logger.java:158) at org.apache.logging.log4j.spi.AbstractLogger.tryLogMessage(AbstractLogger.java:2135) at org.apache.logging.log4j.spi.AbstractLogger.logMessageTrackRecursion(AbstractLogger.java:2089) at org.apache.logging.log4j.spi.AbstractLogger.logMessageSafely(AbstractLogger.java:2072) at org.apache.logging.log4j.spi.AbstractLogger.logMessage(AbstractLogger.java:1948) at org.apache.logging.log4j.spi.AbstractLogger.logIfEnabled(AbstractLogger.java:1920) at org.apache.logging.log4j.spi.AbstractLogger.info(AbstractLogger.java:1257) at ReconfigureTest.testLoggingWhenReconfigure(ReconfigureTest.java:27) at &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;The following pic describes the situation how the problem occurs.&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13011193/13011193_reconfigure-and-asyncAppender-append.png&quot; height=&quot;603&quot; width=&quot;695&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;It&apos;s really hard to reproduce this case, and I can&apos;t write a standard unit test for It.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;But by modifying class&#160;org.apache.logging.log4j.core.appender.AsyncAppender&#160;with adding a &lt;b&gt;sleep&lt;/b&gt;&#160;in the append() method, &lt;b&gt;I can reproduce it in a unusual way.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;font color=&quot;#de350b&quot;&gt;org.apache.logging.log4j.core.appender.AsyncAppender&lt;/font&gt;&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void append(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LogEvent logEvent) {
    &lt;span class=&quot;code-comment&quot;&gt;// ---------sleep to wait reconfigre() stop &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; appender----
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;AsyncAppender append, sleep 10s&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(10000);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;AsyncAppender append, awake&quot;&lt;/span&gt;);
    }&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e){
        e.printStackTrace();
    }
    &lt;span class=&quot;code-comment&quot;&gt;// ----------------------------------------------------------
&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isStarted()) {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;code-quote&quot;&gt;&quot;AsyncAppender &quot;&lt;/span&gt; + getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; is not active&quot;&lt;/span&gt;);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Log4jLogEvent memento = Log4jLogEvent.createMemento(logEvent, includeLocation);
    InternalAsyncUtil.makeMessageImmutable(logEvent.getMessage());
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!transfer(memento)) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (blocking) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (AbstractLogger.getRecursionDepth() &amp;gt; 1) { &lt;span class=&quot;code-comment&quot;&gt;// LOG4J2-1518, LOG4J2-2031
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// If queue is full AND we are in a recursive call, call appender directly to prevent deadlock
&lt;/span&gt;                AsyncQueueFullMessageUtil.logWarningToStatusLogger();
                logMessageInCurrentThread(logEvent);
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                &lt;span class=&quot;code-comment&quot;&gt;// delegate to the event router (which may discard, enqueue and block, or log in current thread)
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; EventRoute route = asyncQueueFullPolicy.getRoute(thread.getId(), memento.getLevel());
                route.logMessage(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, memento);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Appender &quot;&lt;/span&gt; + getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; is unable to write primary appenders. queue is full&quot;&lt;/span&gt;);
            logToErrorAppenderIfNecessary(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, memento);
        }
    }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;font color=&quot;#de350b&quot;&gt;&lt;b&gt;unit test&lt;/b&gt;&lt;/font&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// unit test
&lt;/span&gt;@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testLoggingWhenReconfigure(){
    Logger logger = LogManager.getLogger(&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;);

    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;() {
        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run() {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-comment&quot;&gt;// make logger.info execute first
&lt;/span&gt;                &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(2000);
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
                e.printStackTrace();
            }
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;reconfiguring ...&quot;&lt;/span&gt;);
            LoggerContext.getContext(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).reconfigure();
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;reconfiguring done...&quot;&lt;/span&gt;);
        }
    }).start();

    logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;info&quot;&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;font color=&quot;#de350b&quot;&gt;&lt;b&gt;log4j2.properties&lt;/b&gt;&#160;&lt;/font&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;
&amp;lt;Configuration status=&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;Appenders&amp;gt;
        &amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;console&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;/Console&amp;gt;
        &amp;lt;Async name=&lt;span class=&quot;code-quote&quot;&gt;&quot;async-console&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;console&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;/Async&amp;gt;
    &amp;lt;/Appenders&amp;gt;
    &amp;lt;Loggers&amp;gt;
        &amp;lt;logger name=&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt; level=&lt;span class=&quot;code-quote&quot;&gt;&quot;info&quot;&lt;/span&gt; additivity=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;AppenderRef ref=&lt;span class=&quot;code-quote&quot;&gt;&quot;async-console&quot;&lt;/span&gt; /&amp;gt;
        &amp;lt;/logger&amp;gt;
    &amp;lt;/Loggers&amp;gt;
&amp;lt;/Configuration&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I has solve this problem by calling ReliabilityStrategy&apos;s beforeStopAppenders() method before stopping AsyncAppender with the pull request&#160;&lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/416&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please help me review my code.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;

&lt;p&gt;Yuanzhe Geng&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13326345">LOG4J2-2919</key>
            <summary>&quot;AsyncAppender is not active&quot; when logging with AsynAppender while the system is reconfigure  concurrently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mattsicker">Matt Sicker</assignee>
                                    <reporter username="gengyuanzhe">Yuanzhe Geng </reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Sep 2020 18:06:07 +0000</created>
                <updated>Sun, 13 Sep 2020 16:40:28 +0000</updated>
                            <resolved>Sat, 12 Sep 2020 17:34:04 +0000</resolved>
                                    <version>2.4</version>
                    <version>2.4.1</version>
                    <version>2.5</version>
                    <version>2.6</version>
                    <version>2.6.1</version>
                    <version>2.6.2</version>
                    <version>2.7</version>
                    <version>2.8</version>
                    <version>2.8.1</version>
                    <version>2.8.2</version>
                    <version>2.9.0</version>
                    <version>2.9.1</version>
                    <version>2.10.0</version>
                    <version>2.11.0</version>
                    <version>2.11.1</version>
                    <version>2.11.2</version>
                    <version>2.12.0</version>
                    <version>2.12.1</version>
                    <version>2.13.0</version>
                    <version>2.13.1</version>
                    <version>2.13.2</version>
                    <version>2.13.3</version>
                                    <fixVersion>2.14.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17192671" author="gengyuanzhe" created="Wed, 9 Sep 2020 06:44:43 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rpopma&quot; class=&quot;user-hover&quot; rel=&quot;rpopma&quot;&gt;rpopma&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rgoers&quot; class=&quot;user-hover&quot; rel=&quot;rgoers&quot;&gt;rgoers&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I found the&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1121&quot; title=&quot;LoggerConfig performance improvement: remove waitForCompletion and associated fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1121&quot;&gt;&lt;del&gt;LOG4J2-1121&lt;/del&gt;&lt;/a&gt;&#160;is processed by you. Please help processing this issue. Thanks very much&lt;/p&gt;</comment>
                            <comment id="17194765" author="jvz" created="Sat, 12 Sep 2020 16:00:17 +0000"  >&lt;p&gt;Digging more into this, I see that this area of the code has been a hot area for bugs seemingly due to either a lack of specification or lack of tests or static analysis. Looking at the git history, I can&apos;t even figure out where this problem was introduced as it doesn&apos;t seem to have been a problem back when those comments were first written. All the better reason for adding these tests! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;More specifically, I don&apos;t see &lt;em&gt;any&lt;/em&gt; unit tests related to the ReliabilityStrategy interface, so this seems like an opportune time to fix that.&lt;/p&gt;

&lt;p&gt;Edit2: and I believe you pointed this out in the PR comments about &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1121&quot; title=&quot;LoggerConfig performance improvement: remove waitForCompletion and associated fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1121&quot;&gt;&lt;del&gt;LOG4J2-1121&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17194805" author="jira-bot" created="Sat, 12 Sep 2020 17:29:32 +0000"  >&lt;p&gt;Commit cc996cae3af63a49a52bbbf727e3ff02a4e47964 in logging-log4j2&apos;s branch refs/heads/master from gengyuanzhe&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=cc996ca&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=cc996ca&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2919&quot; title=&quot;&amp;quot;AsyncAppender is not active&amp;quot; when logging with AsynAppender while the system is reconfigure  concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2919&quot;&gt;&lt;del&gt;LOG4J2-2919&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
Call ReliabilityStrategy&apos;s beforeStopAppenders() method before stopping AsyncAppenders&lt;br/&gt;
to avoid errors caused by logging with AsyncAppender while system is reconfiguring&lt;br/&gt;
Submitted by: gengyuanzhe &amp;lt;gengyuanzhe@gmail.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17194807" author="jira-bot" created="Sat, 12 Sep 2020 17:29:36 +0000"  >&lt;p&gt;Commit 0e2ad68dc0b9dad07194a6b61142135375a4ec64 in logging-log4j2&apos;s branch refs/heads/master from Matt Sicker&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=0e2ad68&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=0e2ad68&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Add tests for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1121&quot; title=&quot;LoggerConfig performance improvement: remove waitForCompletion and associated fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1121&quot;&gt;&lt;del&gt;LOG4J2-1121&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2919&quot; title=&quot;&amp;quot;AsyncAppender is not active&amp;quot; when logging with AsynAppender while the system is reconfigure  concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2919&quot;&gt;&lt;del&gt;LOG4J2-2919&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Signed-off-by: Matt Sicker &amp;lt;boards@gmail.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17194808" author="jira-bot" created="Sat, 12 Sep 2020 17:29:37 +0000"  >&lt;p&gt;Commit c5fad55881db3acff1f447c705ea6f6a80accc7a in logging-log4j2&apos;s branch refs/heads/master from Matt Sicker&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=c5fad55&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=c5fad55&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #416 from gengyuanzhe/master&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2919&quot; title=&quot;&amp;quot;AsyncAppender is not active&amp;quot; when logging with AsynAppender while the system is reconfigure  concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2919&quot;&gt;&lt;del&gt;LOG4J2-2919&lt;/del&gt;&lt;/a&gt; Call ReliabilityStrategy&apos;s beforeStopAppenders() method before stopping AsyncAppender&lt;/p&gt;</comment>
                            <comment id="17194809" author="jira-bot" created="Sat, 12 Sep 2020 17:33:13 +0000"  >&lt;p&gt;Commit 1aabc2e3048784f5fb28a55167c93332f3bb2e8e in logging-log4j2&apos;s branch refs/heads/release-2.x from gengyuanzhe&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=1aabc2e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=1aabc2e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2919&quot; title=&quot;&amp;quot;AsyncAppender is not active&amp;quot; when logging with AsynAppender while the system is reconfigure  concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2919&quot;&gt;&lt;del&gt;LOG4J2-2919&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
Call ReliabilityStrategy&apos;s beforeStopAppenders() method before stopping AsyncAppenders&lt;br/&gt;
to avoid errors caused by logging with AsyncAppender while system is reconfiguring&lt;br/&gt;
Submitted by: gengyuanzhe &amp;lt;gengyuanzhe@gmail.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17194811" author="jira-bot" created="Sat, 12 Sep 2020 17:33:16 +0000"  >&lt;p&gt;Commit 064ddbc3a0af9505c3e9041729e8acbc990c3a81 in logging-log4j2&apos;s branch refs/heads/release-2.x from Matt Sicker&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=064ddbc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=064ddbc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Add tests for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1121&quot; title=&quot;LoggerConfig performance improvement: remove waitForCompletion and associated fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1121&quot;&gt;&lt;del&gt;LOG4J2-1121&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2919&quot; title=&quot;&amp;quot;AsyncAppender is not active&amp;quot; when logging with AsynAppender while the system is reconfigure  concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2919&quot;&gt;&lt;del&gt;LOG4J2-2919&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Signed-off-by: Matt Sicker &amp;lt;boards@gmail.com&amp;gt;&lt;/p&gt;</comment>
                            <comment id="17194812" author="jira-bot" created="Sat, 12 Sep 2020 17:33:17 +0000"  >&lt;p&gt;Commit 8865f6aece01e3cd71a1f92f215d2e32479e1257 in logging-log4j2&apos;s branch refs/heads/release-2.x from Matt Sicker&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=8865f6a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=8865f6a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Add changelog entry for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2919&quot; title=&quot;&amp;quot;AsyncAppender is not active&amp;quot; when logging with AsynAppender while the system is reconfigure  concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2919&quot;&gt;&lt;del&gt;LOG4J2-2919&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17194813" author="jvz" created="Sat, 12 Sep 2020 17:34:04 +0000"  >&lt;p&gt;I&apos;ve added a test, merged the PR to master, and cherry-picked it back to release-2.x for inclusion into the upcoming 2.14.0 release. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="17194815" author="jira-bot" created="Sat, 12 Sep 2020 17:36:37 +0000"  >&lt;p&gt;Commit 424754efea529e1e2cb7c6c6217ac1f8b5a25b9b in logging-log4j2&apos;s branch refs/heads/master from Matt Sicker&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=424754e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=424754e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Add changelog entry for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2919&quot; title=&quot;&amp;quot;AsyncAppender is not active&amp;quot; when logging with AsynAppender while the system is reconfigure  concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2919&quot;&gt;&lt;del&gt;LOG4J2-2919&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17194962" author="gengyuanzhe" created="Sun, 13 Sep 2020 10:23:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mattsicker&quot; class=&quot;user-hover&quot; rel=&quot;mattsicker&quot;&gt;mattsicker&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve read your test code, and got what you mean. Your test code assert that&#160;&lt;b&gt;beforeStopAppenders should be invoked before the appender stop&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;You just test the interface&#160;&lt;b&gt;ReliabilityStrategy&lt;/b&gt;(LLT), rather than building the complex scene I describe (what I tried to do, more like HLT).&lt;/p&gt;

&lt;p&gt;That&apos;s cool. I&apos;ve learn a lot from that&lt;/p&gt;</comment>
                            <comment id="17194963" author="gengyuanzhe" created="Sun, 13 Sep 2020 10:24:14 +0000"  >&lt;p&gt;issue resolved&#160;&lt;/p&gt;</comment>
                            <comment id="17195071" author="jvz" created="Sun, 13 Sep 2020 16:40:28 +0000"  >&lt;p&gt;I initially tried looking into the concurrency scenario you described, though after linking it back with past issues and code changes, it turned out to be a bit easier to test thanks to how the API was designed. I think these types of things are usually thought of as trivial when they&apos;re first developed and thus lack a test, but then one day something changes and a test becomes very relevant. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="12863690">LOG4J2-1121</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12660290">LOG4J2-323</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12667035">LOG4J2-392</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12691054">LOG4J2-511</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13011193" name="reconfigure-and-asyncAppender-append.png" size="191526" author="gengyuanzhe" created="Mon, 7 Sep 2020 18:26:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 9 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ie74:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>