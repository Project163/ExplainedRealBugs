<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:39:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2104] LoaderUtil getClassLoaders() method and while loops</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2104</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;For v2.9.1 inside org.apache.logging.log4j.util.LoaderUtil and getClassLoaders() method we have lines 120-123 as such:&lt;/p&gt;

&lt;p&gt;ClassLoader parent = tcl;&lt;br/&gt;
while (parent != null &amp;amp;&amp;amp; !classLoaders.contains(parent)) &lt;/p&gt;
{
    classLoaders.add(parent);
}

&lt;p&gt;where it looks like some getParent() call is either missing or otherwise &quot;while&quot; loop is not needed.&lt;/p&gt;

&lt;p&gt;In line 111 tcl classloader already added into list of clasloaders:&lt;br/&gt;
classLoaders.add(tcl);&lt;/p&gt;

&lt;p&gt;Was it an attempt to add all classloaders hierarchy or just some immediate parents?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13116532">LOG4J2-2104</key>
            <summary>LoaderUtil getClassLoaders() method and while loops</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="andrejusc">Andrejus Chaliapinas</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Nov 2017 22:16:59 +0000</created>
                <updated>Fri, 21 Sep 2018 00:05:43 +0000</updated>
                            <resolved>Sun, 11 Mar 2018 19:36:57 +0000</resolved>
                                    <version>2.9.1</version>
                                    <fixVersion>2.11.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16241463" author="ralph.goers@dslextreme.com" created="Tue, 7 Nov 2017 04:22:50 +0000"  >&lt;p&gt;First, why is this a Jira issue? Simple questions like this should be on the dev list.&lt;/p&gt;

&lt;p&gt;Yes. This method returns all the ClassLoaders to search for a Log4j implementation. Although the ThreadContextClassLoader shouldn&apos;t be there twice it won&apos;t really hurt anything.&lt;/p&gt;</comment>
                            <comment id="16241850" author="andrejusc" created="Tue, 7 Nov 2017 11:25:08 +0000"  >&lt;p&gt;Ralph - I&apos;ve submitted this as JIRA issue because I think it&apos;s a bug inside current v2.9.1 code and you confirmed that already about that twice occurrence. And I&apos;ve marked it as Minor as I thought it&apos;s appropriate for such kind of issues. So in that sense it&apos;s not a question here.&lt;/p&gt;</comment>
                            <comment id="16242297" author="andrejusc" created="Tue, 7 Nov 2017 16:20:14 +0000"  >&lt;p&gt;Ralph - I think there is another issue, which this one now highlights. Inside ProviderUtil there is such method:&lt;br/&gt;
protected static void loadProviders(final ClassLoader cl)&lt;/p&gt;

&lt;p&gt;and then inside private constructor of ProviderUtil we have this part:&lt;br/&gt;
        for (ClassLoader classLoader : LoaderUtil.getClassLoaders()) &lt;/p&gt;
{
            loadProviders(classLoader);
        }

&lt;p&gt;so it looks that intent is to load some Service provider(s) by all returned clasloaders regardless where Provider.class itself was loaded.&lt;/p&gt;

&lt;p&gt;At least for use case I&apos;m working on myself - with v2.9.1 I&apos;m getting part of stack trace like this:&lt;br/&gt;
Caused By: java.util.ServiceConfigurationError: org.apache.logging.log4j.spi.Provider: Provider &lt;br/&gt;
org.apache.logging.log4j.core.impl.Log4jProvider not a subtype&lt;br/&gt;
        at java.util.ServiceLoader.fail(ServiceLoader.java:239)&lt;br/&gt;
        at java.util.ServiceLoader.access$300(ServiceLoader.java:185)&lt;br/&gt;
        at java.util.ServiceLoader$LazyIterator.nextService(ServiceLoader.java:376)&lt;br/&gt;
        at java.util.ServiceLoader$LazyIterator.next(ServiceLoader.java:404)&lt;br/&gt;
        at java.util.ServiceLoader$1.next(ServiceLoader.java:480)&lt;/p&gt;

&lt;p&gt;But if I do such modification within mentioned &lt;br/&gt;
protected static void loadProviders(final ClassLoader cl) &lt;br/&gt;
method of ProviderUtil:&lt;br/&gt;
      if (!cl.equals(Provider.class.getClassLoader())) &lt;/p&gt;
{
        return;
      }

&lt;p&gt;then error about &quot;not a subtype&quot; is gone for me at runtime cause it then assures that classes are loaded within same classloader. Potentially better way here would be to check if there is proper child-parent hierarchy in place (so if needed - delegation to parent could work as well) and not just equality of classloaders.&lt;/p&gt;</comment>
                            <comment id="16242342" author="ralph.goers@dslextreme.com" created="Tue, 7 Nov 2017 16:39:55 +0000"  >&lt;p&gt;The problem you are mentioning is fixed in trunk as a result of &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2055&quot; title=&quot;ServiceConfigurationError in Tomcat when Log4j is used as the logging implementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2055&quot;&gt;&lt;del&gt;LOG4J2-2055&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Using Provider.class.getClassLoader will only return the ClassLoader for the log4j-api jar, which isn&apos;t what is desired. However, I am going to assign this to myself to remind me to look at the ServiceLoader code so I can understand why it is throwing the ServiceConfigurationError.&lt;/p&gt;</comment>
                            <comment id="16255953" author="mikaelstaldal" created="Thu, 16 Nov 2017 20:52:40 +0000"  >&lt;p&gt;Can this issue be closed?&lt;/p&gt;</comment>
                            <comment id="16256058" author="andrejusc" created="Thu, 16 Nov 2017 22:20:04 +0000"  >&lt;p&gt;I&apos;d say this still requires some fixing before closing.&lt;/p&gt;</comment>
                            <comment id="16256128" author="ralph.goers@dslextreme.com" created="Thu, 16 Nov 2017 23:18:46 +0000"  >&lt;p&gt;To do what? Did you test the code in master?&lt;/p&gt;</comment>
                            <comment id="16262561" author="andrejusc" created="Wed, 22 Nov 2017 14:04:27 +0000"  >&lt;p&gt;Sorry for delay, please give me few more days here to respond fully as busy with some other things.&lt;/p&gt;

&lt;p&gt;But some quick comments:&lt;br/&gt;
#1 - fix is needed here to eliminate addition of same classloader twice, especially having possibility of twice exception based on current fix in master.&lt;br/&gt;
#2 - change delivered under  &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2055&quot; title=&quot;ServiceConfigurationError in Tomcat when Log4j is used as the logging implementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2055&quot;&gt;&lt;del&gt;LOG4J2-2055&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;loadProviders(classLoader);&lt;br/&gt;
+            try 
{
+                loadProviders(classLoader);
+            }
&lt;p&gt; catch (Throwable ex) {&lt;br/&gt;
+                LOGGER.debug(&quot;Unable to retrieve provider from ClassLoader {}&quot;, classLoader, ex);&lt;br/&gt;
+            }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;looks right now as a workaround right now rather than correct fix.&lt;/p&gt;

&lt;p&gt;But I&apos;ll try master and see if what it will print will be about already discussed java.util.ServiceConfigurationError or anything else.&lt;/p&gt;

&lt;p&gt;Will update more till the end of this week. Sorry once again for delay with my response.&lt;/p&gt;</comment>
                            <comment id="16394616" author="jira-bot" created="Sun, 11 Mar 2018 19:36:19 +0000"  >&lt;p&gt;Commit b7c815e8c53dfac447f5ee1c523c68563c76cd82 in logging-log4j2&apos;s branch refs/heads/release-2.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ralphgoers&quot; class=&quot;user-hover&quot; rel=&quot;ralphgoers&quot;&gt;ralphgoers&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=b7c815e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=b7c815e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2104&quot; title=&quot;LoaderUtil getClassLoaders() method and while loops&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2104&quot;&gt;&lt;del&gt;LOG4J2-2104&lt;/del&gt;&lt;/a&gt; - LoaderUtil was improperly looping over classloaders&lt;/p&gt;</comment>
                            <comment id="16394617" author="jira-bot" created="Sun, 11 Mar 2018 19:36:20 +0000"  >&lt;p&gt;Commit 1d70d3197887847529b3f06261ed38d20af57240 in logging-log4j2&apos;s branch refs/heads/release-2.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ralphgoers&quot; class=&quot;user-hover&quot; rel=&quot;ralphgoers&quot;&gt;ralphgoers&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=1d70d31&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=1d70d31&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2104&quot; title=&quot;LoaderUtil getClassLoaders() method and while loops&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2104&quot;&gt;&lt;del&gt;LOG4J2-2104&lt;/del&gt;&lt;/a&gt; - LoaderUtil was improperly looping over classloaders&lt;/p&gt;</comment>
                            <comment id="16394618" author="jira-bot" created="Sun, 11 Mar 2018 19:36:22 +0000"  >&lt;p&gt;Commit 9ed183774830b53927e871e303272276cb835603 in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ralphgoers&quot; class=&quot;user-hover&quot; rel=&quot;ralphgoers&quot;&gt;ralphgoers&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=9ed1837&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=9ed1837&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2104&quot; title=&quot;LoaderUtil getClassLoaders() method and while loops&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2104&quot;&gt;&lt;del&gt;LOG4J2-2104&lt;/del&gt;&lt;/a&gt; - LoaderUtil was improperly looping over classloaders&lt;/p&gt;</comment>
                            <comment id="16394619" author="ralph.goers@dslextreme.com" created="Sun, 11 Mar 2018 19:36:57 +0000"  >&lt;p&gt;The look was changed to properly loop over the parents.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 36 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mgtj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>