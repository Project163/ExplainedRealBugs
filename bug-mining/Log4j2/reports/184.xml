<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:31:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-180] style &amp; highlight patterns altering content behaviour</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-180</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Using style or highlight patterns over a Throwable pattern makes this code useless if the exception is the only content (i.e. &quot;%highlight
{%ex}
&lt;p&gt;&quot;)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.logging.log4j.core.pattern.ThrowablePatternConverter:format(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LogEvent event, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StringBuilder toAppendTo) {
...
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; len = toAppendTo.length();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (len &amp;gt; 0 &amp;amp;&amp;amp; !&lt;span class=&quot;code-object&quot;&gt;Character&lt;/span&gt;.isWhitespace(toAppendTo.charAt(len - 1))) {
                toAppendTo.append(&lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// Add a space before printing stack trace
&lt;/span&gt;            }
...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(With style or highlight patterns, the format is called with a new empty StringBuilder)&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Example:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;17:26:54.395 ERROR # Server.doOperation catchingjava.lang.NullPointerException
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(Syntax affected, no space between the message &apos;catching&apos; and the exception &apos;java.lang.NullPointerException&apos;)&lt;/p&gt;



&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Using style or highlight patterns over a Throwable pattern makes it to be duplicated (the pattern is interpreted as if there was nothing dealing with throwables)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Examples:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Simple pattern: &quot;%m %ex{short}&quot;
Output: catching java.lang.NullPointerException
        at net.wm.core.prototype.Server.doOperation(Server.java:27)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Pattern with highlight: &quot;%m %highlight{%ex{short}}&quot;
Output: catching java.lang.NullPointerException
        at net.wm.core.prototype.Server.doOperation(Server.java:27)
 java.lang.NullPointerException
        at net.wm.core.prototype.Server.doOperation(Server.java:27) [bin/:?]
        at net.wm.core.AbstractOperation.run(AbstractOperation.java:99) [bin/:?]
        at java.lang.Thread.run(Unknown Source) [?:1.7.0_07]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12638313">LOG4J2-180</key>
            <summary>style &amp; highlight patterns altering content behaviour</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="seyguai">Seyguai</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Mar 2013 16:47:02 +0000</created>
                <updated>Sat, 24 Aug 2013 11:48:48 +0000</updated>
                                            <version>2.0-beta4</version>
                                                    <component>Layouts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13748745" author="garydgregory" created="Fri, 23 Aug 2013 17:27:07 +0000"  >&lt;p&gt;The second issue has been fixed as &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-319&quot; title=&quot;Double stack trace logging when using %throwable in %style and %highlight&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-319&quot;&gt;&lt;del&gt;LOG4J2-319&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13748799" author="garydgregory" created="Fri, 23 Aug 2013 18:08:04 +0000"  >&lt;p&gt;For this first issue, as of the HEAD of trunk now, I am thinking this is a configuration issue.&lt;/p&gt;

&lt;p&gt;Here is my example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Console name=&lt;span class=&quot;code-quote&quot;&gt;&quot;Console&quot;&lt;/span&gt; target=&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM_OUT&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%d{ABSOLUTE} %-5level # %class.%method %m %style{%ex{1}}{green}%n&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Console&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I get:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;14:03:58,661 FATAL # org.apache.logging.log4j.core.appender.ConsoleAppenderAnsiStyleJira180Main.main Fatal message.
14:03:58,663 ERROR # org.apache.logging.log4j.core.appender.ConsoleAppenderAnsiStyleJira180Main.main Error message.
14:03:58,664 WARN  # org.apache.logging.log4j.core.appender.ConsoleAppenderAnsiStyleJira180Main.main Warning message.
14:03:58,664 INFO  # org.apache.logging.log4j.core.appender.ConsoleAppenderAnsiStyleJira180Main.main Information message.
14:03:58,664 DEBUG # org.apache.logging.log4j.core.appender.ConsoleAppenderAnsiStyleJira180Main.main Debug message.
14:03:58,664 TRACE # org.apache.logging.log4j.core.appender.ConsoleAppenderAnsiStyleJira180Main.main Trace message.
14:03:58,664 ERROR # org.apache.logging.log4j.core.appender.ConsoleAppenderAnsiStyleJira180Main.main Error message. java.lang.NullPointerException
14:03:58,668 ERROR # org.apache.logging.log4j.core.appender.ConsoleAppenderAnsiStyleJira180Main.main catching java.lang.NullPointerException
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please see:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://svn.apache.org/repos/asf/logging/log4j/log4j2/trunk/core/src/test/resources/log4j2-180.xml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/logging/log4j/log4j2/trunk/core/src/test/resources/log4j2-180.xml&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://svn.apache.org/repos/asf/logging/log4j/log4j2/trunk/core/src/test/java/org/apache/logging/log4j/core/appender/ConsoleAppenderAnsiStyleJira180Main.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/logging/log4j/log4j2/trunk/core/src/test/java/org/apache/logging/log4j/core/appender/ConsoleAppenderAnsiStyleJira180Main.java&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please comment here or mark the issue as resolved.&lt;/p&gt;</comment>
                            <comment id="13749366" author="seyguai" created="Sat, 24 Aug 2013 11:47:59 +0000"  >&lt;p&gt;Yes, this behaviour is related to a misconfiguration, but the code I quoted is supposed to fix this issue in case the user did it on purpose. Please consider those 4 cases:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;#1: &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%m %ex{1}%n&quot;&lt;/span&gt; /&amp;gt;
#2: &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%m%ex{1}%n&quot;&lt;/span&gt; /&amp;gt;
#3: &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%m %highlight{%ex{1}}%n&quot;&lt;/span&gt; /&amp;gt;
#4: &amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;%m%highlight{%ex{1}}%n&quot;&lt;/span&gt; /&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With the cases #1 and #2, the previous code will correctly look into &apos;toAppendTo&apos; to add a whitespace if needed, since toAppendTo already contains the message.&lt;br/&gt;
With the others cases, the toAppendTo StringBuilder is empty when it reachs the ThrowablePatternConverter class, thus the code will never have the expected behaviour.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.logging.log4j.core.pattern.HighlightConverter.java:
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void format(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; LogEvent event, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StringBuilder toAppendTo) {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StringBuilder buf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringBuilder();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PatternFormatter formatter : formatters) {
            formatter.format(event, buf); &lt;span class=&quot;code-comment&quot;&gt;// Here buf is empty, thus the ThrowablePattern formatter won&apos;t be able to fix the spacing problem as it should.
&lt;/span&gt;        }

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (buf.length() &amp;gt; 0) {
            toAppendTo.append(levelStyles.get(event.getLevel())).append(buf.toString()).
                append(AnsiEscape.getDefaultStyle());
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A fix would probably looks like that:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (buf.length() &amp;gt; 0) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;code-object&quot;&gt;Character&lt;/span&gt;.isWhitespace(toAppendTo.charAt(len - 1))) {
                toAppendTo.append(&lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;);
            }
            toAppendTo.append(levelStyles.get(event.getLevel())).append(buf.toString()).
                append(AnsiEscape.getDefaultStyle());
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(for all converters)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12658889">LOG4J2-319</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>318789</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1j087:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319130</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>