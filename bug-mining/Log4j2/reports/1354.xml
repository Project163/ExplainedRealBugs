<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:41:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2725] RingBufferLogEvent.clear() is not called in case of OutOfMemoryError (or any other exception/error)</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2725</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Please see the following class&#160;&lt;a href=&quot;https://logging.apache.org/log4j/2.x/log4j-core/apidocs/src-html/org/apache/logging/log4j/core/async/RingBufferLogEventHandler.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/log4j-core/apidocs/src-html/org/apache/logging/log4j/core/async/RingBufferLogEventHandler.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There is the following code in the onEvent() method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
event.execute(endOfBatch);
event.clear();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But in case of an exception (or error) in the execute() method - method clear() will not be invoked, event will be not cleared (and logged message as well) and will be in the memory (probably try/catch will be enough to fix the issue).&lt;/p&gt;

&lt;p&gt;I&apos;ve faced this issue when OutOfMemoryError occurred due to very large messages logging (also message is duplication in the SimpleMessage class, please see related issue&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2724&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LOG4J2-2724&lt;/a&gt;) - all these event are still in memory and it causes a lot of another OOM errors as memory is not released (because clear() method was not invoked).&lt;/p&gt;

&lt;p&gt;Please see attached&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12986090/12986090_RingBufferLogEvent_dominator_tree.txt&quot; title=&quot;RingBufferLogEvent_dominator_tree.txt attached to LOG4J2-2725&quot;&gt;RingBufferLogEvent_dominator_tree.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&#160;report from Eclipse Memory Analyzer (&lt;a href=&quot;https://www.eclipse.org/mat/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.eclipse.org/mat/&lt;/a&gt;). As you can see there are a log of RingBufferLogEvent object that were not cleared and garbage collected:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; Name                                                                                    | Shallow Heap | Retained Heap | Percentage
------------------------------------------------------------------------------------------------------------------------------------------
                                                                                              |              |               |           
com.lmax.disruptor.RingBuffer @ 0x9f29a550                                                    |          144 | 1,205,392,112 |     57.52%
&apos;- java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[262208] @ 0xb3d00000                                                      |    1,048,848 | 1,205,391,968 |     57.52%
   |- org.apache.logging.log4j.core.async.RingBufferLogEvent @ 0xa35f7f08                     |          104 |   233,251,104 |     11.13%
   |- org.apache.logging.log4j.core.async.RingBufferLogEvent @ 0x8727b4d8                     |          104 |   185,151,488 |      8.84%
   |- org.apache.logging.log4j.core.async.RingBufferLogEvent @ 0x8728ef48                     |          104 |   115,523,080 |      5.51%
   |- org.apache.logging.log4j.core.async.RingBufferLogEvent @ 0x87264ae0                     |          104 |    83,109,992 |      3.97%
   |- org.apache.logging.log4j.core.async.RingBufferLogEvent @ 0xb1bd6950                     |          104 |    69,825,312 |      3.33%
   |- org.apache.logging.log4j.core.async.RingBufferLogEvent @ 0x872730d0                     |          104 |    67,399,704 |      3.22%
   |- org.apache.logging.log4j.core.async.RingBufferLogEvent @ 0x872651c8                     |          104 |    67,209,496 |      3.21%
   |- org.apache.logging.log4j.core.async.RingBufferLogEvent @ 0x828e61d8                     |          104 |    48,321,480 |      2.31%
   |- org.apache.logging.log4j.core.async.RingBufferLogEvent @ 0x828ca708                     |          104 |    42,499,912 |      2.03% 
................&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also please see&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12986089/12986089_RingBufferLogEvent_OOM.log&quot; title=&quot;RingBufferLogEvent_OOM.log attached to LOG4J2-2725&quot;&gt;RingBufferLogEvent_OOM.log&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&#160;log file with OOM stacktrace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.OutOfMemoryError: Java heap spacejava.lang.OutOfMemoryError: Java heap space at java.util.Arrays.copyOf(Arrays.java:3332) at java.lang.AbstractStringBuilder.expandCapacity(AbstractStringBuilder.java:137) at java.lang.AbstractStringBuilder.ensureCapacityInternal(AbstractStringBuilder.java:121) at java.lang.AbstractStringBuilder.append(AbstractStringBuilder.java:421) at java.lang.StringBuilder.append(StringBuilder.java:136) at org.apache.logging.log4j.core.pattern.LineSeparatorPatternConverter.format(LineSeparatorPatternConverter.java:66) at org.apache.logging.log4j.core.pattern.PatternFormatter.format(PatternFormatter.java:38) at org.apache.logging.log4j.core.layout.PatternLayout$PatternSerializer.toSerializable(PatternLayout.java:333) at org.apache.logging.log4j.core.layout.PatternLayout.toText(PatternLayout.java:232) at org.apache.logging.log4j.core.layout.PatternLayout.encode(PatternLayout.java:217) at org.apache.logging.log4j.core.layout.PatternLayout.encode(PatternLayout.java:57) at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.directEncodeEvent(AbstractOutputStreamAppender.java:177) at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.tryAppend(AbstractOutputStreamAppender.java:170) at org.apache.logging.log4j.core.appender.AbstractOutputStreamAppender.append(AbstractOutputStreamAppender.java:161) at org.apache.logging.log4j.core.appender.RollingFileAppender.append(RollingFileAppender.java:268) at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:156) at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:129) at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:120) at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:84) at org.apache.logging.log4j.core.config.LoggerConfig.callAppenders(LoggerConfig.java:448) at org.apache.logging.log4j.core.config.LoggerConfig.processLogEvent(LoggerConfig.java:433) at org.apache.logging.log4j.core.config.LoggerConfig.log(LoggerConfig.java:417) at org.apache.logging.log4j.core.config.AwaitCompletionReliabilityStrategy.log(AwaitCompletionReliabilityStrategy.java:79) at org.apache.logging.log4j.core.async.AsyncLogger.actualAsyncLog(AsyncLogger.java:337) at org.apache.logging.log4j.core.async.RingBufferLogEvent.execute(RingBufferLogEvent.java:161) at org.apache.logging.log4j.core.async.RingBufferLogEventHandler.onEvent(RingBufferLogEventHandler.java:45) at org.apache.logging.log4j.core.async.RingBufferLogEventHandler.onEvent(RingBufferLogEventHandler.java:29) at com.lmax.disruptor.BatchEventProcessor.run(BatchEventProcessor.java:129) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Could you please fix it or explain if such behavior is expected?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Dzmitry&lt;/p&gt;</description>
                <environment></environment>
        <key id="13269011">LOG4J2-2725</key>
            <summary>RingBufferLogEvent.clear() is not called in case of OutOfMemoryError (or any other exception/error)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="anikosss">Dzmitry Anikechanka</reporter>
                        <labels>
                            <label>OOM</label>
                    </labels>
                <created>Mon, 18 Nov 2019 08:36:43 +0000</created>
                <updated>Thu, 20 Feb 2020 23:21:02 +0000</updated>
                            <resolved>Sun, 8 Dec 2019 02:56:26 +0000</resolved>
                                    <version>2.12.1</version>
                                    <fixVersion>2.13.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4200">1h 10m</timespent>
                                <comments>
                            <comment id="16976424" author="remkop@yahoo.com" created="Mon, 18 Nov 2019 10:35:21 +0000"  >&lt;p&gt;That sounds like it would be a good improvement. &lt;br/&gt;
Will you be able to provide a pull request?&lt;/p&gt;</comment>
                            <comment id="16976602" author="anikosss" created="Mon, 18 Nov 2019 14:38:02 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rpopma&quot; class=&quot;user-hover&quot; rel=&quot;rpopma&quot;&gt;rpopma&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I&apos;m not sure I will be able to do it this week but I will try to do it next week, is it suitable?&lt;br/&gt;
Also could you please provide the target branch link/name?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Dzmitry&lt;/p&gt;</comment>
                            <comment id="16976898" author="remkop@yahoo.com" created="Mon, 18 Nov 2019 21:28:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anikosss&quot; class=&quot;user-hover&quot; rel=&quot;anikosss&quot;&gt;anikosss&lt;/a&gt; Absolutely, no rush. I haven&apos;t actively coded on Log4j2 for a while, but I believe &lt;tt&gt;release-2.x&lt;/tt&gt; is the branch for the latest releases, while &lt;tt&gt;master&lt;/tt&gt; is for the upcoming log4j 3.0 (which may still be some time in the making). You can either provide PRs for both branches or just for master and we can cherrypick it to release-2.x.&lt;/p&gt;</comment>
                            <comment id="16983287" author="anikosss" created="Wed, 27 Nov 2019 08:40:55 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rpopma&quot; class=&quot;user-hover&quot; rel=&quot;rpopma&quot;&gt;rpopma&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I&apos;ve created 2 PRs for release-2.x and master branches:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;to release-2.x:&#160;&lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/316&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;to master:&#160;&lt;a href=&quot;https://github.com/apache/logging-log4j2/pull/317&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/logging-log4j2/pull/317&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please see attached&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12986893/12986893_domitator_tree_report_clear_not_called.txt&quot; title=&quot;domitator_tree_report_clear_not_called.txt attached to LOG4J2-2725&quot;&gt;domitator_tree_report_clear_not_called.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&#160;with report from heap dump (using Eclipse Memory Analyzer) when exception occurred and message was not cleared:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12986895/12986895_image-2019-11-27-11-38-50-296.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Also please see attached&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12986894/12986894_domitator_tree_report_clear_called.txt&quot; title=&quot;domitator_tree_report_clear_called.txt attached to LOG4J2-2725&quot;&gt;domitator_tree_report_clear_called.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&#160;for the same case with occurred exception but after applied fix:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12986896/12986896_image-2019-11-27-11-39-49-904.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Here RingBufferLogEvent doesn&apos;t contain SimpleMessage with message string, so this means that it was correctly cleared.&lt;/p&gt;

&lt;p&gt;Feel free to contact me in case of any further questions.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Dzmitry&lt;/p&gt;</comment>
                            <comment id="16990647" author="jira-bot" created="Sat, 7 Dec 2019 22:55:17 +0000"  >&lt;p&gt;Commit 61c661fd13ffc607a0066edfc8ab2ae7acc916d1 in logging-log4j2&apos;s branch refs/heads/release-2.x from anikosss&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=61c661f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=61c661f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2725&quot; title=&quot;RingBufferLogEvent.clear() is not called in case of OutOfMemoryError (or any other exception/error)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2725&quot;&gt;&lt;del&gt;LOG4J2-2725&lt;/del&gt;&lt;/a&gt; - Added try/finally around event.execute() for RingBufferLogEventHandler to clear memory correctly in case of exception/error (#316)&lt;/p&gt;
</comment>
                            <comment id="16990648" author="jira-bot" created="Sat, 7 Dec 2019 22:57:20 +0000"  >&lt;p&gt;Commit aa93a911a754b76a8e558e05074b6e15ab33ed17 in logging-log4j2&apos;s branch refs/heads/master from anikosss&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=aa93a91&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=aa93a91&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2725&quot; title=&quot;RingBufferLogEvent.clear() is not called in case of OutOfMemoryError (or any other exception/error)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2725&quot;&gt;&lt;del&gt;LOG4J2-2725&lt;/del&gt;&lt;/a&gt; - Added try/finally around event.execute() for RingBufferLogEventHandler to clear memory correctly in case of exception/error (#317)&lt;/p&gt;
</comment>
                            <comment id="16990653" author="jira-bot" created="Sat, 7 Dec 2019 23:14:26 +0000"  >&lt;p&gt;Commit 7421fe77385faf37425c9f832bfbcb06b05f9a17 in logging-log4j2&apos;s branch refs/heads/master from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7421fe7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7421fe7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Changelog and test coverage for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2725&quot; title=&quot;RingBufferLogEvent.clear() is not called in case of OutOfMemoryError (or any other exception/error)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2725&quot;&gt;&lt;del&gt;LOG4J2-2725&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16990654" author="jira-bot" created="Sat, 7 Dec 2019 23:15:12 +0000"  >&lt;p&gt;Commit 26a7e3b0f9287e621f1251c0c567caa425c1d3b2 in logging-log4j2&apos;s branch refs/heads/release-2.x from Carter Kozak&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=26a7e3b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=26a7e3b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Changelog and test coverage for &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2725&quot; title=&quot;RingBufferLogEvent.clear() is not called in case of OutOfMemoryError (or any other exception/error)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2725&quot;&gt;&lt;del&gt;LOG4J2-2725&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16990691" author="ckozak" created="Sun, 8 Dec 2019 02:56:26 +0000"  >&lt;p&gt;I&apos;ve merged the fix and a test which reproduced the bug into release-2.x and master. Thanks for the contribution!&lt;/p&gt;</comment>
                            <comment id="16990692" author="ckozak" created="Sun, 8 Dec 2019 02:56:58 +0000"  >&lt;p&gt;Closing this ticket because the test was able to reproduce the reported scenario.&lt;/p&gt;</comment>
                            <comment id="17041105" author="breun" created="Thu, 20 Feb 2020 16:03:20 +0000"  >&lt;p&gt;I&apos;ve seen an application that logs a lot running under a lot higher load after upgrading from Spring Boot 2.1.x to 2.2.x (currently 2.2.4.RELEASE), which updated log4j from 2.11.2 to 2.12.1.&lt;/p&gt;

&lt;p&gt;Is there any chance of a log4j 2.12.x release with this fix backported? This would allow this fix to be picked up in a Spring Boot 2.2.x update.&lt;/p&gt;

&lt;p&gt;Spring Boot 2.2.x won&apos;t pull in minor version updates like log4j 2.13.0 until Spring Boot 2.3.x, which won&apos;t be out for another couple of months.&lt;/p&gt;</comment>
                            <comment id="17041109" author="ckozak" created="Thu, 20 Feb 2020 16:08:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=breun&quot; class=&quot;user-hover&quot; rel=&quot;breun&quot;&gt;breun&lt;/a&gt; I expect it to be safe for individual projects to specify a newer version of log4j than the minimum version from spring-boot, we put a great deal of care into avoiding both API and ABI breaks.&lt;/p&gt;</comment>
                            <comment id="17041150" author="breun" created="Thu, 20 Feb 2020 17:16:13 +0000"  >&lt;p&gt;It took us a couple of hours to find out that our increased load average was caused by log4j 2.12.1, which was brought in by the upgrade from Spring Boot 2.1.x to 2.2.x. If this bug won&apos;t be fixed in log4j a 2.12.x update, then Spring Boot 2.2.x users will not get this bugfix until they upgrade to Spring Boot 2.3.0, which is currently scheduled for April 30, but that will probably move into somewhere in May.&lt;/p&gt;

&lt;p&gt;Sadly Spring Boot doesn&apos;t trust libraries to be backwards compatible across different minor versions, so everyone using the latest Spring Boot 2.2.x will be using log4j with this memory bug for a few more months. Of course individual projects can override the log4j version, but then framework users like those using Spring Boot first need to find out that they are dealing with a leaky log4j version.&lt;/p&gt;

&lt;p&gt;We also noticed that upgrading to log4j 2.13.0 fixed the load issue (no longer a lot of &lt;tt&gt;org.apache.logging.log4j.core.async.AsyncLoggerConfigDisruptor$Log4jEventWrapper&lt;/tt&gt; instances in memory), but also showed some weird behavior where multiple log messages ended up in a single log line. We will need to investigate this further, but this means upgrading is currently also not a way out for us. Currently our best bet seems to downgrade to log4j 2.11.2 as used by Spring Boot 2.1.x. So this is why I asked if it would be possible to backport this fix to log4j 2.12.x. This would allow bringing this fix to everyone using log4j via the current line of Spring Boot 2.2.x.&lt;/p&gt;</comment>
                            <comment id="17041193" author="ralph.goers@dslextreme.com" created="Thu, 20 Feb 2020 17:56:00 +0000"  >&lt;p&gt;FWIW, my hope is to create the 2.13.1 release this weekend.&#160; After that we would have to look at how much work it would be to backport the commits. Although we are prepared for it, we have never created a patch for a previous release version. In this case though it makes even more sense as 2.12.x is the last version that will support Java 7, so adding a fix like this would be important.&lt;/p&gt;</comment>
                            <comment id="17041196" author="ckozak" created="Thu, 20 Feb 2020 17:59:18 +0000"  >&lt;p&gt;&amp;gt; also showed some weird behavior where multiple log messages ended up in a single log line.&lt;/p&gt;

&lt;p&gt;Any chance you could file a ticket for this if you have not already? It sounds very high priority to fix!&lt;/p&gt;</comment>
                            <comment id="17041359" author="breun" created="Thu, 20 Feb 2020 23:21:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckozak&quot; class=&quot;user-hover&quot; rel=&quot;ckozak&quot;&gt;ckozak&lt;/a&gt; I will file a ticket for this if I can reproduce this. So far this was only mentioned by a colleague that upgraded to 2.13.0 to see if that would fix the load issue they saw after the upgrade from 2.11.2 to 2.12.1.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13269009">LOG4J2-2724</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12986089" name="RingBufferLogEvent_OOM.log" size="2957" author="anikosss" created="Mon, 18 Nov 2019 08:36:25 +0000"/>
                            <attachment id="12986090" name="RingBufferLogEvent_dominator_tree.txt" size="4169" author="anikosss" created="Mon, 18 Nov 2019 08:34:10 +0000"/>
                            <attachment id="12986894" name="domitator_tree_report_clear_called.txt" size="4026" author="anikosss" created="Wed, 27 Nov 2019 08:33:25 +0000"/>
                            <attachment id="12986893" name="domitator_tree_report_clear_not_called.txt" size="4026" author="anikosss" created="Wed, 27 Nov 2019 08:33:25 +0000"/>
                            <attachment id="12986895" name="image-2019-11-27-11-38-50-296.png" size="47101" author="anikosss" created="Wed, 27 Nov 2019 08:38:50 +0000"/>
                            <attachment id="12986896" name="image-2019-11-27-11-39-49-904.png" size="53508" author="anikosss" created="Wed, 27 Nov 2019 08:39:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08qd4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>