<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:34:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1030] Header in layout created every time application starts</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1030</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Header is appended to OutputStream every time Appender/Manager constructor is called. This causes appending header every time application restarts which I think is wrong. Examples:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; OutputStreamManager(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; OutputStream os, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; streamName, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Layout&amp;lt;?&amp;gt; layout) {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(streamName);
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.os = os;
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.layout = layout;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (layout != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] header = layout.getHeader();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (header != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.os.write(header, 0, header.length);
                } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; IOException ioe) {
                    LOGGER.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to write header&quot;&lt;/span&gt;, ioe);
                }
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; RollingRandomAccessFileManager(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RandomAccessFile raf, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fileName,
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; pattern, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; OutputStream os, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; append,
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; immediateFlush, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; bufferSize, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; size, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; time,
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TriggeringPolicy policy, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RolloverStrategy strategy,
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; advertiseURI, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Layout&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Serializable&amp;gt; layout) {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(fileName, pattern, os, append, size, time, policy, strategy, advertiseURI, layout, bufferSize);
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isImmediateFlush = immediateFlush;
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.randomAccessFile = raf;
        isEndOfBatch.set(&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.FALSE);
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.buffer = ByteBuffer.allocate(bufferSize);
        writeHeader();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think header should be appended to the file only once. It might be configurable if one wants to append header after application restart. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12832724">LOG4J2-1030</key>
            <summary>Header in layout created every time application starts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="truecurry">Maciej Kara&#347;</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 May 2015 14:08:08 +0000</created>
                <updated>Sun, 4 Oct 2015 21:39:36 +0000</updated>
                            <resolved>Tue, 7 Jul 2015 12:49:32 +0000</resolved>
                                    <version>2.3</version>
                                    <fixVersion>2.4</fixVersion>
                                    <component>Appenders</component>
                    <component>Core</component>
                    <component>Layouts</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14559274" author="ralph.goers@dslextreme.com" created="Tue, 26 May 2015 15:43:24 +0000"  >&lt;p&gt;Yes, it could easily be argued that it should go either way. In addition, if a configuration option is added the current behavior should be the default since existing applications expect it to work the way it currently does.&lt;/p&gt;</comment>
                            <comment id="14560683" author="truecurry" created="Wed, 27 May 2015 09:31:14 +0000"  >&lt;p&gt;I cannot agree. The documentation for header in LayoutPattern says it is included at the top of each log file. The current behaviour is misleading and not conforming to documentation.&lt;br/&gt;
&lt;a href=&quot;https://logging.apache.org/log4j/2.x/manual/layouts.html#PatternLayout&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://logging.apache.org/log4j/2.x/manual/layouts.html#PatternLayout&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="14614226" author="remkop@yahoo.com" created="Sun, 5 Jul 2015 11:53:47 +0000"  >&lt;p&gt;I tend to agree with Maciej. The docs say &quot;at the top of each log file&quot;. &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-889&quot; title=&quot;RollingRandomAccessFileAppender appends the header every time the application is started.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-889&quot;&gt;&lt;del&gt;LOG4J2-889&lt;/del&gt;&lt;/a&gt; also requests this to be fixed so there is a clear need. If we fix this and existing applications have a problem they can report this and we can consider making it configurable. For now I would prefer to fix it to work according to our docs.&lt;/p&gt;

&lt;p&gt;I have a fix ready to go in. If no objections I will commit it.&lt;/p&gt;</comment>
                            <comment id="14614306" author="garydgregory" created="Sun, 5 Jul 2015 16:18:49 +0000"  >&lt;p&gt;We could add a new attribute called fileHeader and leave the old one alone.&lt;/p&gt;</comment>
                            <comment id="14615749" author="remkop@yahoo.com" created="Mon, 6 Jul 2015 22:06:10 +0000"  >&lt;p&gt;Adding a new attribute will have large repercussions: all layouts would need to support it, and all OutputStreamAppenders would need to have separate behaviour for it. &lt;br/&gt;
And all that because we speculate there may be people who like the behaviour caused by this bug. I feel we should just fix it to work according to spec, and accept new feature requests if some people like the old behaviour.  &lt;/p&gt;</comment>
                            <comment id="14615802" author="garydgregory" created="Mon, 6 Jul 2015 22:48:12 +0000"  >&lt;p&gt;Ok, sounds good.&lt;/p&gt;</comment>
                            <comment id="14615823" author="remkop@yahoo.com" created="Mon, 6 Jul 2015 22:57:59 +0000"  >&lt;p&gt;Thanks Gary!&lt;br/&gt;
Ralph, what do you think?&lt;/p&gt;</comment>
                            <comment id="14615892" author="ralph.goers@dslextreme.com" created="Mon, 6 Jul 2015 23:37:07 +0000"  >&lt;p&gt;Go ahead and do it.&lt;/p&gt;</comment>
                            <comment id="14616619" author="remkop@yahoo.com" created="Tue, 7 Jul 2015 12:49:32 +0000"  >&lt;p&gt;Fixed in commit 547574f9.&lt;br/&gt;
(Release notes will mention Jira number &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-889&quot; title=&quot;RollingRandomAccessFileAppender appends the header every time the application is started.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-889&quot;&gt;&lt;del&gt;LOG4J2-889&lt;/del&gt;&lt;/a&gt; for this fix because that ticket was filed first.&lt;/p&gt;

&lt;p&gt;Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12751471">LOG4J2-889</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f793:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>