<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:41:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2575] CronExpression.getTimeBefore() returns incorrect result</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2575</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;The method getTimeBefore(targetDate) of org.apache.logging.log4j.core.util.CronExpression incorrectly returns the targetDate argument instead of one time increment before targetDate when running in OpenJDK 1.8.0_191.&lt;/p&gt;

&lt;p&gt;When CronTiggeringPolicy calls this method the targetDate object contains a time with milliseconds, but prevFireTime is always computed with zero milliseconds which causes the comparison at line 1586:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; ... &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (prevFireTime.compareTo(targetDate) &amp;gt;= 0);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to be false on the first time through the loop and so targetDate (with zero milliseconds) is returned.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Configuration example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;RollingFile name=&lt;span class=&quot;code-quote&quot;&gt;&quot;my_log&quot;&lt;/span&gt; fileName=&lt;span class=&quot;code-quote&quot;&gt;&quot;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/my.log&quot;&lt;/span&gt;
 filePattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/log/my.log.%d{yyyy-MM-dd}&quot;&lt;/span&gt;&amp;gt;
&amp;lt;PatternLayout pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;[%d{EEE MMM dd HH:mm:ss yyyy}] [%p] %x [%X{user}] %m{nolookups}%n&quot;&lt;/span&gt; /&amp;gt;
 &amp;lt;CronTriggeringPolicy schedule=&lt;span class=&quot;code-quote&quot;&gt;&quot;0 0 0 * * ?&quot;&lt;/span&gt; evaluateOnStartup=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; /&amp;gt;
 &amp;lt;/RollingFile&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Adding some extra debugging, we can see the behaviour:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;DEBUG StatusLogger getTimeBefore(targetDate=2019-03-22T00:00:00.002-0600
DEBUG StatusLogger in loop preFireTime=2019-03-22T00:00:00.000-0600
DEBUG StatusLogger return 2019-03-22T00:00:00.000-0600&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Sometimes the file rolling will run at exactly zero milliseconds and getTimeBefore() will correctly returns the previous day in the above example, masking this issue during those runs.&#160; I marked this issue as critical because in combination with FileRenameAction&apos;s procedure of replacing existing files, log files will be lost at seemingly random rolls when this method returns the current date on one run, but then reverts back to the previous date on the next run, causing a filename collision.&lt;/p&gt;

&lt;p&gt;A patch is attached.&#160; This issue may be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2246&quot; title=&quot;CronTrigger not rolling file correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2246&quot;&gt;LOG4J2-2246&lt;/a&gt; since that bug mentions issues with milliseconds in Date objects as well, but I have not investigated that part of the file rolling code.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13223837">LOG4J2-2575</key>
            <summary>CronExpression.getTimeBefore() returns incorrect result</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ckozak">Carter Kozak</assignee>
                                    <reporter username="nathan.friess">Nathan Friess</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Mar 2019 18:15:59 +0000</created>
                <updated>Thu, 30 Jun 2022 06:25:47 +0000</updated>
                            <resolved>Mon, 6 Jan 2020 13:52:49 +0000</resolved>
                                    <version>2.11.2</version>
                                    <fixVersion>2.13.1</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16849647" author="garydgregory" created="Tue, 28 May 2019 12:04:59 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nathan.friess&quot; class=&quot;user-hover&quot; rel=&quot;nathan.friess&quot;&gt;nathan.friess&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;May you please add a unit test to your patch?&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="16849803" author="ralph.goers@dslextreme.com" created="Tue, 28 May 2019 14:48:51 +0000"  >&lt;p&gt;How does this patch address the issue? I see that it will no longer replace existing files but it doesn&apos;t do anything with the problem with the time you are mentioning.&lt;/p&gt;</comment>
                            <comment id="16850206" author="nathan.friess" created="Tue, 28 May 2019 22:37:14 +0000"  >&lt;p&gt;My apologies.&#160; I attached a patch for some unrelated change that I was working on.&#160; cronexpression.patch has the fix and cronexpressiontest.patch has a JUnit test which fails on the current code and passes the test after applying the fix.&#160; I left two println&apos;s in the test case so that you can see what is happening.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16884793" author="jira-bot" created="Mon, 15 Jul 2019 00:46:45 +0000"  >&lt;p&gt;Commit dd28ef5ad473e4228ddb016a083251521c24e523 in logging-log4j2&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2644&quot; title=&quot;Logging with location information is considerably slower than logging with location information in java.util.logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2644&quot;&gt;&lt;del&gt;LOG4J2-2644&lt;/del&gt;&lt;/a&gt;-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=dd28ef5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=dd28ef5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2575&quot; title=&quot;CronExpression.getTimeBefore() returns incorrect result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2575&quot;&gt;&lt;del&gt;LOG4J2-2575&lt;/del&gt;&lt;/a&gt; - CronExpression.getBeforeTime() would sometimes return incorrect result&lt;/p&gt;</comment>
                            <comment id="16884794" author="jira-bot" created="Mon, 15 Jul 2019 00:46:51 +0000"  >&lt;p&gt;Commit bf961381d2cf5e3e4502bb211af88ee1a7725d6f in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=bf96138&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=bf96138&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2575&quot; title=&quot;CronExpression.getTimeBefore() returns incorrect result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2575&quot;&gt;&lt;del&gt;LOG4J2-2575&lt;/del&gt;&lt;/a&gt; - CronExpression.getBeforeTime() would sometimes return incorrect result&lt;/p&gt;</comment>
                            <comment id="16884795" author="ralph.goers@dslextreme.com" created="Mon, 15 Jul 2019 00:47:24 +0000"  >&lt;p&gt;Patches have been applied. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="16888453" author="nathan.friess" created="Fri, 19 Jul 2019 02:23:13 +0000"  >&lt;p&gt;I have verified that the behavior is now correct.&lt;/p&gt;</comment>
                            <comment id="16888454" author="nathan.friess" created="Fri, 19 Jul 2019 02:23:24 +0000"  >&lt;p&gt;Closing.&lt;/p&gt;</comment>
                            <comment id="17008862" author="jira-bot" created="Mon, 6 Jan 2020 13:50:30 +0000"  >&lt;p&gt;Commit 07787ec8459e03cefcb23c48b312d363ce8f6856 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=07787ec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=07787ec&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2575&quot; title=&quot;CronExpression.getTimeBefore() returns incorrect result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2575&quot;&gt;&lt;del&gt;LOG4J2-2575&lt;/del&gt;&lt;/a&gt; - CronExpression.getBeforeTime() would sometimes return incorrect result&lt;/p&gt;</comment>
                            <comment id="17560843" author="JIRAUSER284282" created="Thu, 30 Jun 2022 06:25:47 +0000"  >&lt;p&gt;when I upgrade to&#160;&lt;/p&gt;

&lt;p&gt;&amp;lt;log4j2.version&amp;gt;2.17.2&amp;lt;/log4j2.version&amp;gt;&lt;/p&gt;

&lt;p&gt;I also have this problem When I use cronTriggerPolicy in&#160;&lt;/p&gt;

&lt;p&gt;&amp;lt;Policies&amp;gt;&lt;br/&gt;
&amp;lt;CronTriggeringPolicy schedule=&quot;0 30 0 * * ?&quot; evaluateOnStartup=&quot;true&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/Policies&amp;gt;&lt;/p&gt;

&lt;p&gt;It certain probability to roll out today&apos;s GZ&lt;br/&gt;
like:&lt;br/&gt;
2022-01-01&#160;&lt;br/&gt;
2022-01-02&#160; cron trigger --&amp;gt; I got 2022-01-02&#160; xxx.log.gz&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13275053">LOG4J2-2741</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12970089" name="cronexpression.patch" size="1320" author="nathan.friess" created="Tue, 28 May 2019 22:34:05 +0000"/>
                            <attachment id="12970090" name="cronexpressiontest.patch" size="1622" author="nathan.friess" created="Tue, 28 May 2019 22:34:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z012sw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>