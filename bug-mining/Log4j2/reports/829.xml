<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:36:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1422] AsyncAppenderQueueFullPolicyTest sometimes hangs</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1422</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;From the log4j-dev mailing list:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I just tried to do a full build and got this test to hang. Gary reported the same thing last week on Windows.  The stack trace indicates that it isn&#8217;t properly shutting down. Somehow it seems the BlockingAppender must not be having its shutdown flag set. This test was only added a month ago. I&#8217;m not really sure what this test is trying to do but it appears to have some flawed logic somewhere.&lt;/p&gt;&lt;/blockquote&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Full thread dump Java HotSpot(TM) 64-Bit Server VM (24.80-b11 mixed mode):

&quot;Attach Listener&quot; daemon prio=5 tid=0x00007fc93b81b000 nid=0x3d0b waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;AsyncAppender-Async&quot; daemon prio=5 tid=0x00007fc93c16c000 nid=0x5603 sleeping[0x00007000015d5000]
   java.lang.Thread.State: TIMED_WAITING (sleeping)
	at java.lang.Thread.sleep(Native Method)
	at org.apache.logging.log4j.test.appender.BlockingAppender.append(BlockingAppender.java:44)
	at org.apache.logging.log4j.core.config.AppenderControl.tryCallAppender(AppenderControl.java:155)
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender0(AppenderControl.java:128)
	at org.apache.logging.log4j.core.config.AppenderControl.callAppenderPreventRecursion(AppenderControl.java:119)
	at org.apache.logging.log4j.core.config.AppenderControl.callAppender(AppenderControl.java:84)
	at org.apache.logging.log4j.core.appender.AsyncAppender$AsyncThread.callAppenders(AsyncAppender.java:338)
	at org.apache.logging.log4j.core.appender.AsyncAppender$AsyncThread.run(AsyncAppender.java:291)

&quot;surefire-forkedjvm-command-thread&quot; daemon prio=5 tid=0x00007fc93c845800 nid=0x5403 runnable [0x00007000014d2000]
   java.lang.Thread.State: RUNNABLE
	at java.io.FileInputStream.readBytes(Native Method)
	at java.io.FileInputStream.read(FileInputStream.java:272)
	at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)
	at java.io.BufferedInputStream.read(BufferedInputStream.java:254)
	- locked &amp;lt;0x00000007aaa9ab70&amp;gt; (a java.io.BufferedInputStream)
	at java.io.DataInputStream.readInt(DataInputStream.java:387)
	at org.apache.maven.surefire.booter.MasterProcessCommand.decode(MasterProcessCommand.java:117)
	at org.apache.maven.surefire.booter.CommandReader$CommandRunnable.run(CommandReader.java:360)
	at java.lang.Thread.run(Thread.java:745)

&quot;last-ditch-daemon-shutdown-thread-30sec&quot; daemon prio=5 tid=0x00007fc93c873800 nid=0x5203 waiting on condition [0x00007000013cf000]
   java.lang.Thread.State: TIMED_WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait for  &amp;lt;0x00000007aad7d750&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
	at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:226)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2082)
	at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1090)
	at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:807)
	at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1068)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:745)

&quot;Service Thread&quot; daemon prio=5 tid=0x00007fc93c014800 nid=0x4e03 runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;C2 CompilerThread1&quot; daemon prio=5 tid=0x00007fc93c82d800 nid=0x4c03 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;C2 CompilerThread0&quot; daemon prio=5 tid=0x00007fc93b051800 nid=0x4a03 waiting on condition [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;Signal Dispatcher&quot; daemon prio=5 tid=0x00007fc93b04c000 nid=0x3e0f runnable [0x0000000000000000]
   java.lang.Thread.State: RUNNABLE

&quot;Finalizer&quot; daemon prio=5 tid=0x00007fc93c800000 nid=0x3803 in Object.wait() [0x0000700000d3a000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on &amp;lt;0x00000007aaa84858&amp;gt; (a java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:135)
	- locked &amp;lt;0x00000007aaa84858&amp;gt; (a java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:151)
	at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)

&quot;Reference Handler&quot; daemon prio=5 tid=0x00007fc93c00e000 nid=0x3603 in Object.wait() [0x0000700000c37000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on &amp;lt;0x00000007aaa84470&amp;gt; (a java.lang.ref.Reference$Lock)
	at java.lang.Object.wait(Object.java:503)
	at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)
	- locked &amp;lt;0x00000007aaa84470&amp;gt; (a java.lang.ref.Reference$Lock)

&quot;main&quot; prio=5 tid=0x00007fc93c002800 nid=0x1703 in Object.wait() [0x0000700000218000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	- waiting on &amp;lt;0x00000007aca98af0&amp;gt; (a org.apache.logging.log4j.core.appender.AsyncAppender$AsyncThread)
	at java.lang.Thread.join(Thread.java:1281)
	- locked &amp;lt;0x00000007aca98af0&amp;gt; (a org.apache.logging.log4j.core.appender.AsyncAppender$AsyncThread)
	at org.apache.logging.log4j.core.appender.AsyncAppender.stop(AsyncAppender.java:126)
	at org.apache.logging.log4j.core.config.AbstractConfiguration.stop(AbstractConfiguration.java:321)
	at org.apache.logging.log4j.core.LoggerContext.stop(LoggerContext.java:306)
	at org.apache.logging.log4j.core.config.Configurator.shutdown(Configurator.java:337)
	at org.apache.logging.log4j.junit.LoggerContextRule$1.evaluate(LoggerContextRule.java:97)
	at org.junit.rules.RunRules.evaluate(RunRules.java:20)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.junit.runners.Suite.runChild(Suite.java:128)
	at org.junit.runners.Suite.runChild(Suite.java:27)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junitcore.JUnitCore.run(JUnitCore.java:55)
	at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.createRequestAndRun(JUnitCoreWrapper.java:137)
	at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.executeEager(JUnitCoreWrapper.java:107)
	at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.execute(JUnitCoreWrapper.java:83)
	at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.execute(JUnitCoreWrapper.java:75)
	at org.apache.maven.surefire.junitcore.JUnitCoreProvider.invoke(JUnitCoreProvider.java:161)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:290)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:242)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:121)

&quot;VM Thread&quot; prio=5 tid=0x00007fc93c00b800 nid=0x3403 runnable 

&quot;GC task thread#0 (ParallelGC)&quot; prio=5 tid=0x00007fc93b809800 nid=0x2403 runnable 

&quot;GC task thread#1 (ParallelGC)&quot; prio=5 tid=0x00007fc93b80a000 nid=0x2603 runnable 

&quot;GC task thread#2 (ParallelGC)&quot; prio=5 tid=0x00007fc93b80a800 nid=0x2803 runnable 

&quot;GC task thread#3 (ParallelGC)&quot; prio=5 tid=0x00007fc93b80b000 nid=0x2a03 runnable 

&quot;GC task thread#4 (ParallelGC)&quot; prio=5 tid=0x00007fc93b80c000 nid=0x2c03 runnable 

&quot;GC task thread#5 (ParallelGC)&quot; prio=5 tid=0x00007fc93b80c800 nid=0x2e03 runnable 

&quot;GC task thread#6 (ParallelGC)&quot; prio=5 tid=0x00007fc93b80d000 nid=0x3003 runnable 

&quot;GC task thread#7 (ParallelGC)&quot; prio=5 tid=0x00007fc93b00b800 nid=0x3203 runnable 

&quot;VM Periodic Task Thread&quot; prio=5 tid=0x00007fc93c01d000 nid=0x5003 waiting on condition 

JNI global references: 170
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12977686">LOG4J2-1422</key>
            <summary>AsyncAppenderQueueFullPolicyTest sometimes hangs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="rpopma">Remko Popma</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Jun 2016 17:08:48 +0000</created>
                <updated>Mon, 8 Jul 2019 05:54:48 +0000</updated>
                            <resolved>Fri, 10 Jun 2016 17:37:53 +0000</resolved>
                                    <version>2.6</version>
                                    <fixVersion>2.6.2</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15324919" author="remkop@yahoo.com" created="Fri, 10 Jun 2016 17:37:53 +0000"  >&lt;p&gt;The purpose of the test is to verify that AsyncAppender invokes its AsyncQueueFullPolicy to figure out what to do when an event arrives and the queue is full.&lt;/p&gt;

&lt;p&gt;I am still not sure how the system gets into this state, but these made changes to ensure it can get out:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;In the test, ensure that the CountingAsyncQueueFullPolicy is correctly installed (or the BlockingAppender shutdown flag is never set)&lt;/li&gt;
	&lt;li&gt;BlockingAppender.append now exits the method if it&apos;s Thread.sleep() call is interrupted.&lt;/li&gt;
	&lt;li&gt;AsyncAppender$AsyncThread.shutdown() verifies if the underlying appender is sleeping/waiting/joining/parked, and if so, interrupt()s the thread.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16879565" author="jira-bot" created="Fri, 5 Jul 2019 23:48:59 +0000"  >&lt;p&gt;Commit ac91541c4ee2523cfd7273e417fe99b50f607ea3 in logging-log4j2&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3644&quot; title=&quot;Deprecate package scanning in 2.x and remove in 3.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3644&quot;&gt;&lt;del&gt;LOG4J2-3644&lt;/del&gt;&lt;/a&gt;-3.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ac91541&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ac91541&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1422&quot; title=&quot;AsyncAppenderQueueFullPolicyTest sometimes hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1422&quot;&gt;&lt;del&gt;LOG4J2-1422&lt;/del&gt;&lt;/a&gt; - cause queue full policy to be invokes&lt;/p&gt;</comment>
                            <comment id="16879566" author="jira-bot" created="Fri, 5 Jul 2019 23:49:01 +0000"  >&lt;p&gt;Commit 7318abcbf2d8492ea6db5f3a3beef9660a87f220 in logging-log4j2&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-3644&quot; title=&quot;Deprecate package scanning in 2.x and remove in 3.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-3644&quot;&gt;&lt;del&gt;LOG4J2-3644&lt;/del&gt;&lt;/a&gt;-3.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7318abc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7318abc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1422&quot; title=&quot;AsyncAppenderQueueFullPolicyTest sometimes hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1422&quot;&gt;&lt;del&gt;LOG4J2-1422&lt;/del&gt;&lt;/a&gt; - revert change&lt;/p&gt;</comment>
                            <comment id="16880035" author="jira-bot" created="Mon, 8 Jul 2019 05:54:46 +0000"  >&lt;p&gt;Commit ac91541c4ee2523cfd7273e417fe99b50f607ea3 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ac91541&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=ac91541&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1422&quot; title=&quot;AsyncAppenderQueueFullPolicyTest sometimes hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1422&quot;&gt;&lt;del&gt;LOG4J2-1422&lt;/del&gt;&lt;/a&gt; - cause queue full policy to be invokes&lt;/p&gt;</comment>
                            <comment id="16880036" author="jira-bot" created="Mon, 8 Jul 2019 05:54:48 +0000"  >&lt;p&gt;Commit 7318abcbf2d8492ea6db5f3a3beef9660a87f220 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7318abc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=7318abc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1422&quot; title=&quot;AsyncAppenderQueueFullPolicyTest sometimes hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1422&quot;&gt;&lt;del&gt;LOG4J2-1422&lt;/del&gt;&lt;/a&gt; - revert change&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 19 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zauv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>