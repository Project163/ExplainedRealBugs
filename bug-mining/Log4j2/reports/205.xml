<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:32:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-425] Permgen leak in AsyncLoggerConfigHelper</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-425</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Thread local &apos;currentLogEvent&apos; is not cleaned on shutdown which prevent  web applications clean undeploying.&lt;br/&gt;
Tomcat prints following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SEVERE: The web application [/web] created a ThreadLocal with key of type [java.lang.ThreadLocal] (value [java.lang.ThreadLocal@22410487]) and a value of type [org.apache.logging.log4j.core.impl.Log4jLogEvent] (value [Logger=********* Level=INFO Message=************]) but failed to remove it when the web application was stopped. Threads are going to be renewed over time to &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; and avoid a probable memory leak.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We use async loggers declared explicitly in log4j2.xml:&lt;br/&gt;
&amp;lt;AsyncLogger name=&quot;logger&quot; additivity=&quot;false&quot; level=&quot;trace&quot;&amp;gt; ......&lt;/p&gt;

&lt;p&gt;We use RollingRandomAccessFile as appender.&lt;/p&gt;

</description>
                <environment>&lt;p&gt;JDK7, Win8 64bit&lt;/p&gt;</environment>
        <key id="12673743">LOG4J2-425</key>
            <summary>Permgen leak in AsyncLoggerConfigHelper</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rpopma">Remko Popma</assignee>
                                    <reporter username="salaev">Sergey Alaev</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Oct 2013 18:32:54 +0000</created>
                <updated>Tue, 15 Oct 2013 16:58:42 +0000</updated>
                            <resolved>Tue, 15 Oct 2013 16:58:42 +0000</resolved>
                                    <version>2.0-beta9</version>
                                    <fixVersion>2.0-rc1</fixVersion>
                                    <component>Appenders</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13794700" author="remkop@yahoo.com" created="Tue, 15 Oct 2013 00:29:43 +0000"  >&lt;p&gt;To be exact, this issue is not exactly a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-323&quot; title=&quot;ThreadLocal-leak on tomcat shutdown when using async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-323&quot;&gt;&lt;del&gt;LOG4J2-323&lt;/del&gt;&lt;/a&gt;, because it happens with AsyncLoggerConfigHelper (mixed async and sync loggers) and the issue reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-323&quot; title=&quot;ThreadLocal-leak on tomcat shutdown when using async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-323&quot;&gt;&lt;del&gt;LOG4J2-323&lt;/del&gt;&lt;/a&gt; happens with AsyncLogger (all loggers are async).&lt;/p&gt;

&lt;p&gt;However, the underlying cause is the same, and they should be fixed together. I&apos;ll add a note to &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-323&quot; title=&quot;ThreadLocal-leak on tomcat shutdown when using async logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-323&quot;&gt;&lt;del&gt;LOG4J2-323&lt;/del&gt;&lt;/a&gt; to link to this issue.&lt;/p&gt;

&lt;p&gt;I will also link both issues to &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-406&quot; title=&quot;JMX MBeans are not being unregistered when a tomcat web application that uses log4j is undeployed, leading to a permgen memory leak.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-406&quot;&gt;&lt;del&gt;LOG4J2-406&lt;/del&gt;&lt;/a&gt;, as any work to release the ThreadLocal references should be done at the same timing as unregistering MBeans.&lt;/p&gt;</comment>
                            <comment id="13795375" author="remkop@yahoo.com" created="Tue, 15 Oct 2013 16:58:42 +0000"  >&lt;p&gt;Eliminated ThreadLocal from AsyncLoggerConfigHelper by using EventTranslatorTwoArg (essentially passing the log event via the call stack instead of via a field).&lt;/p&gt;

&lt;p&gt;Fixed in revision 1532427.&lt;br/&gt;
Please verify and close.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12660290">LOG4J2-323</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353366</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 6 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ox9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353658</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>