<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:31:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-293] classloader URI scheme broken or insufficient when using Log4jContextListener</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-293</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I&apos;m trying to migrate to Log4j2, and things looked promising when I spotted Log4jContextListener.&lt;/p&gt;

&lt;p&gt;However, there are too many holes.&lt;/p&gt;

&lt;p&gt;Firstly, I tried using classpath: as a scheme, and nothing blew up, so I assumed I&apos;d got it right.&lt;/p&gt;

&lt;p&gt;Then I &lt;b&gt;looked at the code&lt;/b&gt; (which shouldn&apos;t be how we find out) and eventually discovered some code relating to a &apos;classloader&apos; scheme.&lt;/p&gt;

&lt;p&gt;Still silent failure.  It seems that the classpath is not being searched, perhaps just the WAR classloader, not the JARs in WEB-INF/lib.&lt;/p&gt;

&lt;p&gt;Next I tried omitting the / (i.e. using classloader:log4j2.xml) and got a NullPointerException.&lt;/p&gt;

&lt;p&gt;Can you please document what schemes are supported and what you expect them to do, and &lt;b&gt;not fail silently&lt;/b&gt; when a configuration file is specified, but nothing happens.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12654377">LOG4J2-293</key>
            <summary>classloader URI scheme broken or insufficient when using Log4jContextListener</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="beamerblvd">Nick Williams</assignee>
                                    <reporter username="nealeu">Neale Upstone</reporter>
                        <labels>
                            <label>documentation</label>
                    </labels>
                <created>Sun, 23 Jun 2013 14:34:00 +0000</created>
                <updated>Thu, 5 Sep 2013 17:14:31 +0000</updated>
                            <resolved>Mon, 2 Sep 2013 04:22:23 +0000</resolved>
                                    <version>2.0-beta7</version>
                                    <fixVersion>2.0-beta9</fixVersion>
                                    <component>Configurators</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13701699" author="beamerblvd" created="Sun, 7 Jul 2013 23:32:17 +0000"  >&lt;p&gt;Can you provide a bit more information about the problem you&apos;re seeing? I&apos;m unable to see a problem. Can you provide some example configurations, list directory/file layouts, show your deployment descriptor (web.xml), etc?&lt;/p&gt;

&lt;p&gt;Note that the entire web initialization system got a major overhaul for 2.0-beta8, which comes out next week. See &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-270&quot; title=&quot;Improve logging initialization in Servlet containers; reduce amount of extra configuration needed in these contexts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-270&quot;&gt;&lt;del&gt;LOG4J2-270&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13701936" author="nealeu" created="Mon, 8 Jul 2013 11:09:06 +0000"  >&lt;p&gt;Hi Nick, I&apos;ll give beta8 a go and then update.&lt;/p&gt;</comment>
                            <comment id="13727264" author="beamerblvd" created="Fri, 2 Aug 2013 03:19:28 +0000"  >&lt;p&gt;Neale,&lt;/p&gt;

&lt;p&gt;How is this working for you in beta8? Can you update us?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13727491" author="nealeu" created="Fri, 2 Aug 2013 09:00:45 +0000"  >&lt;p&gt;Hi Nick,&lt;/p&gt;

&lt;p&gt;Just updated my Log4j2 branch to beta8 and config is apparently behaving but silently is giving defaults.  I think something is happening before the initializer gets in on the act, so the context never gets initialized from the URI.&lt;/p&gt;

&lt;p&gt;I can&apos;t get much further as until beta9, as what seems to be &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-304&quot; title=&quot;Async Loggers cause excessive memory usage and GC pauses&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-304&quot;&gt;&lt;del&gt;LOG4J2-304&lt;/del&gt;&lt;/a&gt; breaks our build&lt;/p&gt;

&lt;p&gt;Thanks. Neale&lt;/p&gt;</comment>
                            <comment id="13727527" author="nealeu" created="Fri, 2 Aug 2013 10:07:20 +0000"  >&lt;p&gt;I&apos;ve got further on this.  I think that some helpful checking could be done.  What seems to be happening is:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;web.xml has other listeners.  log4j2 is the first listed, but the other fires first (This seems a Tomcat 7 issue: &lt;a href=&quot;http://tomcat.10.x6.nabble.com/Autowired-spring-bean-not-working-in-tomcat-7-0-35-with-jax-ws-td4993897.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://tomcat.10.x6.nabble.com/Autowired-spring-bean-not-working-in-tomcat-7-0-35-with-jax-ws-td4993897.html&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;The other listener calls SLF4J Log4jLoggerFactory.getLogger(), which in turn calls Log4jContextFactory.getContext()&lt;/li&gt;
	&lt;li&gt;This causes a LoggerContext to be created with configLocation set to null (ClassLoaderContextSelector:line 204).  This is placed in CONTEXT_MAP.&lt;/li&gt;
	&lt;li&gt;After the above, the Log4jServletContextListener fires.&lt;/li&gt;
	&lt;li&gt;locateContext() is called again, this time with the URI set.  At line 214 (&lt;tt&gt;if(ctx != null) return ctx;&lt;/tt&gt;), you now have ctx.configLocation==null, but the passed in configLocation is classloader:/path/to/log4j2.xml&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Should the key used for CONTEXT_MAP perhaps contain configLocation too?&lt;/p&gt;

&lt;p&gt;I think at the very least, a useful warning could be emitted when the configLocation mis-match is discovered.  I would have thought the expected behaviour would be that a reconfiguration would take place at this point, so Log4j2 would tolerate the late config.  I&apos;ve always thought that this is what&apos;s been happening with 1.2.x.&lt;/p&gt;
</comment>
                            <comment id="13728557" author="beamerblvd" created="Sat, 3 Aug 2013 15:06:08 +0000"  >&lt;ol&gt;
	&lt;li&gt;Just to double-check, you&apos;re using Beta8, right?&lt;/li&gt;
	&lt;li&gt;What exact version of Tomcat are you using?&lt;/li&gt;
	&lt;li&gt;Attach your &lt;tt&gt;web.xml&lt;/tt&gt; file, please.&lt;/li&gt;
	&lt;li&gt;Go through all of the JARs in your application&apos;s &lt;tt&gt;/WEB-INF/lib&lt;/tt&gt; directory and find any and all JARs (other than log4j) that contain a &lt;tt&gt;/META-INF/web-fragment.xml&lt;/tt&gt; file. Post the names of those JARs and the contents of their corresponding &lt;tt&gt;web-fragment.xml&lt;/tt&gt; files.&lt;/li&gt;
	&lt;li&gt;You have read &lt;a href=&quot;http://logging.apache.org/log4j/2.x/manual/webapp.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this documentation&lt;/a&gt;, correct?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13729619" author="nealeu" created="Mon, 5 Aug 2013 16:22:32 +0000"  >&lt;p&gt;Beta 8, as I said:&lt;/p&gt;

&lt;p&gt;&amp;gt; Just updated my Log4j2 branch to beta8 &lt;/p&gt;

&lt;p&gt;Apols that I omitted to clarify that the linked Tomcat issue is a Servlet 2.5 issue, i.e. that I&apos;m using 2.5 so fragments are not relevant.&lt;/p&gt;

&lt;p&gt;I&apos;m now confused.  For some reason &lt;tt&gt;classloader:&lt;/tt&gt; seemed to be the scheme when I last looked and this seems to pick up the correct handler stepping through the code, but your docs (which seem to be different from the ones I remember) say &lt;tt&gt;classpath:&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Could you please read my bullets and confirm the expected behaviour when &lt;tt&gt;getLogger()&lt;/tt&gt; has already been called by another &lt;tt&gt;Listener&lt;/tt&gt;?  This silent skipping of config is not helpful.&lt;/p&gt;

&lt;p&gt;I&apos;ll check whether 1.2 exhibited that behaviour as you&apos;ll really need to jump one way or the other on it: reconfigure or fail, not silently proceed with defaults, as is happening at the moment.&lt;/p&gt;
</comment>
                            <comment id="13754049" author="abhinav.shah@gmail.com" created="Thu, 29 Aug 2013 20:58:11 +0000"  >&lt;h3&gt;&lt;a name=&quot;Ifoundaworkaroundtothisproblem.&quot;&gt;&lt;/a&gt;I found a work around to this problem. &lt;/h3&gt;
&lt;h4&gt;&lt;a name=&quot;Youwouldneedspringcore3.2.0jarforthissolutiontowork.&quot;&gt;&lt;/a&gt;You would need spring-core-3.2.0 jar for this solution to work.&lt;/h4&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.FileNotFoundException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.net.URL;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.servlet.ServletContext;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.servlet.ServletContextEvent;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.servlet.ServletContextListener;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.logging.log4j.core.web.Log4jServletContextListener;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.springframework.util.ResourceUtils;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.springframework.util.SystemPropertyUtils;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.springframework.web.util.WebUtils;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyLog4jServletContextListener &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; ServletContextListener {
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; ServletContext servletContext;
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Log4jServletContextListener log4jServletContextListener;

	@Override
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void contextInitialized(ServletContextEvent sce) {
		&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.servletContext = sce.getServletContext();
		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; location = servletContext.getInitParameter(&lt;span class=&quot;code-quote&quot;&gt;&quot;log4jConfig&quot;&lt;/span&gt;);

		&lt;span class=&quot;code-comment&quot;&gt;// Perform actual log4j initialization; &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; rely on log4j&apos;s &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
&lt;/span&gt;		&lt;span class=&quot;code-comment&quot;&gt;// initialization.
&lt;/span&gt;		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			&lt;span class=&quot;code-comment&quot;&gt;// Resolve system property placeholders before potentially
&lt;/span&gt;			&lt;span class=&quot;code-comment&quot;&gt;// resolving a real path.
&lt;/span&gt;			location = SystemPropertyUtils.resolvePlaceholders(location);

			&lt;span class=&quot;code-comment&quot;&gt;// Leave a URL (e.g. &lt;span class=&quot;code-quote&quot;&gt;&quot;classpath:&quot;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&quot;file:&quot;&lt;/span&gt;) as-is.
&lt;/span&gt;			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!ResourceUtils.isUrl(location)) {
				&lt;span class=&quot;code-comment&quot;&gt;// Consider a plain file path as relative to the web
&lt;/span&gt;				&lt;span class=&quot;code-comment&quot;&gt;// application root directory.
&lt;/span&gt;				location = WebUtils.getRealPath(servletContext, location);
			}

			URL url = ResourceUtils.getURL(location);
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (url == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
				&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileNotFoundException(location
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot; cannot be resolved to absolute file path &quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;because it does not reside in the file system&quot;&lt;/span&gt;);
			}
			sce.getServletContext().setInitParameter(&lt;span class=&quot;code-quote&quot;&gt;&quot;log4jConfiguration&quot;&lt;/span&gt;,
					url.toString());
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (FileNotFoundException ex) {
			&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(
					&lt;span class=&quot;code-quote&quot;&gt;&quot;Invalid &lt;span class=&quot;code-quote&quot;&gt;&apos;log4jConfigLocation&apos;&lt;/span&gt; parameter: &quot;&lt;/span&gt;
							+ ex.getMessage());
		}
		log4jServletContextListener = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Log4jServletContextListener();
		log4jServletContextListener.contextInitialized(sce);
	}

	@Override
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void contextDestroyed(ServletContextEvent sce) {
		log4jServletContextListener.contextDestroyed(sce);
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h4&gt;&lt;a name=&quot;web.xml&quot;&gt;&lt;/a&gt;web.xml&lt;/h4&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;
&amp;lt;web-app &lt;span class=&quot;code-keyword&quot;&gt;xmlns:xsi&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt;
	xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://java.sun.com/xml/ns/javaee&quot;&lt;/span&gt;
	xsi:schemaLocation=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;&lt;/span&gt;
	id=&lt;span class=&quot;code-quote&quot;&gt;&quot;WebApp_ID&quot;&lt;/span&gt; version=&lt;span class=&quot;code-quote&quot;&gt;&quot;3.0&quot;&lt;/span&gt; metadata-complete=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt;&amp;gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;absolute-ordering /&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;display-name&amp;gt;&lt;/span&gt;pec-service&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/display-name&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;context-param&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;param-name&amp;gt;&lt;/span&gt;log4jConfig&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/param-name&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;param-value&amp;gt;&lt;/span&gt;classpath:log4j/${com.labcorp.app.env}.log4j.xml&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/param-value&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/context-param&amp;gt;&lt;/span&gt;
	 
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;listener&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;listener-class&amp;gt;&lt;/span&gt;com.eag.util.web.MyLog4jServletContextListener&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/listener-class&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/listener&amp;gt;&lt;/span&gt;	
	 
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter-name&amp;gt;&lt;/span&gt;log4jServletFilter&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter-name&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter-class&amp;gt;&lt;/span&gt;org.apache.logging.log4j.core.web.Log4jServletFilter&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter-class&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter-mapping&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;filter-name&amp;gt;&lt;/span&gt;log4jServletFilter&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter-name&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;url-pattern&amp;gt;&lt;/span&gt;/*&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/url-pattern&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dispatcher&amp;gt;&lt;/span&gt;REQUEST&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dispatcher&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dispatcher&amp;gt;&lt;/span&gt;FORWARD&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dispatcher&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dispatcher&amp;gt;&lt;/span&gt;INCLUDE&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dispatcher&amp;gt;&lt;/span&gt;
		&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dispatcher&amp;gt;&lt;/span&gt;ERROR&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dispatcher&amp;gt;&lt;/span&gt;
	&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/filter-mapping&amp;gt;&lt;/span&gt;
	
	
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/web-app&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13754080" author="ralph.goers@dslextreme.com" created="Thu, 29 Aug 2013 21:26:19 +0000"  >&lt;p&gt;I think your earlier suggestion to reconfigure if the LoggerContext has a null configLocation is the correct one.&lt;/p&gt;</comment>
                            <comment id="13755216" author="abhinav.shah@gmail.com" created="Fri, 30 Aug 2013 22:41:18 +0000"  >&lt;p&gt;I fixed this issue. Since I am not a contributor to log4j2, I am going to attach the source files here. &lt;/p&gt;</comment>
                            <comment id="13755217" author="abhinav.shah@gmail.com" created="Fri, 30 Aug 2013 22:42:09 +0000"  >&lt;p&gt;prefix to pick the config. file from classpath is classpath:&lt;/p&gt;</comment>
                            <comment id="13755251" author="beamerblvd" created="Fri, 30 Aug 2013 23:22:00 +0000"  >&lt;p&gt;Thanks for looking into and, possibly (I haven&apos;t reviewed it yet), fixing this issue. Such proposed patches should be attached as SVN diffs, not whole source files. That way, it makes it easier for us to tell exactly what changed and review the proposed patch.&lt;/p&gt;

&lt;p&gt;Please use a command like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ svn diff &amp;gt; LOG4J2-293.patch&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(from the trunk directory) to generate a patch that can be properly vetted, and attach that patch to this issue.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13755271" author="abhinav.shah@gmail.com" created="Fri, 30 Aug 2013 23:47:31 +0000"  >&lt;p&gt;Attaching svn patch.&lt;/p&gt;</comment>
                            <comment id="13755280" author="beamerblvd" created="Sat, 31 Aug 2013 00:08:31 +0000"  >&lt;p&gt;Your IDE has reformatted the JavaDoc and Java code in the file. This makes it very difficult to separate out the changes you made from the reformatting. Please correct this. Patches should not reformat code that doesn&apos;t change. You will likely need to disable this auto-reformatting in your IDE, or change the settings to reflect the Log4j coding standards (for example, 120-character lines, not 80-character lines as it appears your IDE is enforcing).&lt;/p&gt;</comment>
                            <comment id="13755308" author="abhinav.shah@gmail.com" created="Sat, 31 Aug 2013 00:47:09 +0000"  >&lt;p&gt;Nick. I just removed all the code formatting. Attaching new patch.&lt;/p&gt;</comment>
                            <comment id="13755601" author="beamerblvd" created="Sat, 31 Aug 2013 20:59:52 +0000"  >&lt;p&gt;Thanks for the patch. I tweaked it slightly to still maintain support for the classloader: scheme and also to improve test code coverage. Can you checkout, build, verify, and close, please?&lt;/p&gt;</comment>
                            <comment id="13755617" author="nealeu" created="Sat, 31 Aug 2013 22:19:55 +0000"  >&lt;p&gt;It looks like this patch fixes only the NPE, but not the reconfiguration issue, as Ralph had alluded to.&lt;/p&gt;

&lt;p&gt;That still remains a gotcha as Log4j2 should not silently ignore configuration as it does.&lt;/p&gt;</comment>
                            <comment id="13755626" author="beamerblvd" created="Sat, 31 Aug 2013 23:02:40 +0000"  >&lt;p&gt;As instructed in the mailing list conversation you linked to, can you enable logging the effective &lt;tt&gt;web.xml&lt;/tt&gt;? Then, attach both your &lt;em&gt;actual&lt;/em&gt; &lt;tt&gt;web.xml&lt;/tt&gt; and the &lt;em&gt;effective&lt;/em&gt; &lt;tt&gt;web.xml&lt;/tt&gt;? Thanks.&lt;/p&gt;</comment>
                            <comment id="13755899" author="ralph.goers@dslextreme.com" created="Mon, 2 Sep 2013 04:22:23 +0000"  >&lt;p&gt;As of revision 1519337 ClassLoaderContextSelector will now reconfigure if it previously had no configuration location and is subsequently provided one. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="13756202" author="nealeu" created="Mon, 2 Sep 2013 18:44:59 +0000"  >&lt;p&gt;Thanks.  Will verify when I get a chance this week.  Prob not going to be until Wed or Thurs&lt;/p&gt;</comment>
                            <comment id="13756503" author="nealeu" created="Tue, 3 Sep 2013 10:54:24 +0000"  >&lt;p&gt;Okay. More time spent with a debugger to find:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;classpath:/properties/log4j2.xml still &lt;b&gt;fails silently&lt;/b&gt; (this should at least output something saying that nothing was found, or preferably illegal config and bomb out)&lt;/li&gt;
	&lt;li&gt;classpath:properties/log4j2.xml works (once I&apos;ve excluded an old Xerces 2.6 from my build).&lt;/li&gt;
	&lt;li&gt;when running, there is lots of &quot;WARN locateContext called with URI null. Existing LoggerContext has URI classpath:properties/dev/log4j2.xml&quot;.  I think being called with null is to be expected, as that&apos;s what lots of filters etc are doing via things like commons logging or SLF4J APIs.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The silent failure is still a bug.  I should not need to use a debugger, and it certainly should be covered in the documentation (and isn&apos;t. An example for classpath: is needed).&lt;br/&gt;
I&apos;d even suggest that the JavaDoc for Log4jServletContextListener could say what params it expects and what the valid values are.&lt;/p&gt;



&lt;p&gt;If you want to help those who somehow have Xerces 2.6.1 or equiv on their classpath, then the following could be caught and dealt with (e.g. continue, but warn that they have old XML parser around):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.AbstractMethodError: javax.xml.parsers.DocumentBuilderFactory.setFeature(Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;;Z)V
	at org.apache.logging.log4j.core.config.XMLConfiguration.enableXInclude(XMLConfiguration.java:106)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="13756535" author="beamerblvd" created="Tue, 3 Sep 2013 11:45:20 +0000"  >&lt;p&gt;Point taken that there are improvements to be made on JavaDoc. However, there are three separate issues here, and they all need to be handled differently:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Log4j is not gracefully handling logging starting before Log4j&apos;s filter. We&apos;re trying to fix that. This additional info you&apos;ve provided is helpful to get that straightened out. I definitely understand that silent failures are frustrating.&lt;/li&gt;
	&lt;li&gt;Something is starting logging before Log4j&apos;s filter. While Log4j should handle this gracefully, this is still a &lt;b&gt;big problem&lt;/b&gt; because you could be missing important logging events. &lt;b&gt;I need more information to troubleshoot this.&lt;/b&gt; As mentioned above and above, I need A) your web.xml, B) your effective web.xml as generated by Tomcat (the thread you linked to has instructions for logging this info), and C) a list of any JARs in your webapp containing files /META-INF/web-fragment.xml &lt;em&gt;OR&lt;/em&gt; META-INF/services/javax.servlet.ServletContainerInitializer.&lt;/li&gt;
	&lt;li&gt;You are now getting an AbstractMethodError. I understand your frustration with it, but Log4j cannot be responsible for detecting, catching, and reporting all the many different errors that can happen because users have the wrong versions of other-party libraries on their classpath. The error, as you pointed out, means that you had an old Xerces on your classpath. Fixing that fixes the problem. There&apos;s nothing that needs to be done in Log4j here.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13756573" author="nealeu" created="Tue, 3 Sep 2013 12:47:24 +0000"  >&lt;p&gt;Thanks Nick.  Will see what I can do when I next get time.&lt;/p&gt;

&lt;p&gt;I understand about XML, although I&apos;d people expect a level of &apos;drop-in-replacement&apos;.  My suggestion fits with what Liquibase does, which is just to warn that it will not be able to process includes, and carries on.  Naturally, now I&apos;ve fixed the issue, I can see all sorts of DRYness I can get out of using them &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13756753" author="ralph.goers@dslextreme.com" created="Tue, 3 Sep 2013 16:32:20 +0000"  >&lt;p&gt;I disagree with item 3. I think we should check for the exception and log a warning that XInclude support is unavailable. But that should be a separate Jira issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12664152">LOG4J2-357</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12667138">LOG4J2-394</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12664152">LOG4J2-357</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12664156">LOG4J2-359</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12649940">LOG4J2-270</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12600875" name="ConfigurationFactory.java" size="19847" author="abhinav.shah@gmail.com" created="Fri, 30 Aug 2013 22:41:18 +0000"/>
                            <attachment id="12600904" name="LOG4J2-293.patch" size="3331" author="abhinav.shah@gmail.com" created="Sat, 31 Aug 2013 00:47:09 +0000"/>
                            <attachment id="12600876" name="TestConfigurator.java" size="15481" author="abhinav.shah@gmail.com" created="Fri, 30 Aug 2013 22:41:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334654</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lq7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334980</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>