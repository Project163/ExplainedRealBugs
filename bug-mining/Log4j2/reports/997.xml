<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:38:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-1649] CronTriggeringPolicy breaks awefully when using &quot;reconfigure&quot; of LoggerContext</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-1649</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;Hi,&lt;br/&gt;
I&apos;ve a major problem when using CronTriggeringPolicy in Spring Boot environments.&lt;br/&gt;
I&apos;ve tracked the problem down to Log4J2.&lt;br/&gt;
The following is happening:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;When the Spring context is created, getContext is called which results in creation on the Log4J context and the cron trigger is registered as normal&lt;/li&gt;
	&lt;li&gt;After that Spring starts a reinitialization of the LoggerSystem by calling &quot;reconfigure&quot; of the LoggerContext of Log4J.&lt;/li&gt;
	&lt;li&gt;This results in very weird behvaiour of Log4J:
	&lt;ul&gt;
		&lt;li&gt;Log4J finds the already created RollingFileManager in the &quot;MAP&quot; field in the AbstractManager class.&lt;/li&gt;
		&lt;li&gt;As it was already available it calls the &quot;updateData&quot; which in result registers the trigger again.&lt;/li&gt;
		&lt;li&gt;After that the &quot;initialize&quot; method is called on the RollingFileManager, which again registers the trigger. (The cron trigger is now scheduled 3 times! First time by the normal getContext initialization and two times more by the reconfiguration)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The good thing is: As the old configuration gets destroyed, the old scheduler is being shutdown too, but the last schedule of the first cron trigger is called nevertheless.&lt;/p&gt;

&lt;p&gt;So basically you get 3 cron trigger calls, where 2 of them are rescheduled.&lt;/p&gt;

&lt;p&gt;How it should be fixed (from my point of view):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Kill old CronTriggers from scheduling when the context gets reconfigured&lt;/li&gt;
	&lt;li&gt;Do not call initialize for the triggering policy when the RollingFileManager is updated as this is done afterwards nevertheless&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13014727">LOG4J2-1649</key>
            <summary>CronTriggeringPolicy breaks awefully when using &quot;reconfigure&quot; of LoggerContext</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rgoers">Ralph Goers</assignee>
                                    <reporter username="GFriedrich">Georg Friedrich</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Oct 2016 13:49:52 +0000</created>
                <updated>Mon, 9 Jan 2017 07:08:39 +0000</updated>
                            <resolved>Mon, 9 Jan 2017 07:08:39 +0000</resolved>
                                    <version>2.7</version>
                                    <fixVersion>2.8</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15614906" author="gfriedrich" created="Fri, 28 Oct 2016 09:35:23 +0000"  >&lt;p&gt;I had some additional time to work on this and created two patched to resolve those issues. Please find them attached.&lt;br/&gt;
Those patches base on Log4J2 2.7. Feel free to write some tests for it, as I had no time to do so.&lt;/p&gt;</comment>
                            <comment id="15792336" author="ralph.goers@dslextreme.com" created="Mon, 2 Jan 2017 06:41:08 +0000"  >&lt;p&gt;I took a look at the patches. The change to RollingFileManager is similar to what I had to do to get &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1653&quot; title=&quot;CronTriggeringPolicy uses wrong naming and produces NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1653&quot;&gt;&lt;del&gt;LOG4J2-1653&lt;/del&gt;&lt;/a&gt; working. I took a different approach with shutting down the ConfigurationScheduler that I believe will accomplish what is needed. Without a test though I can&apos;t confirm it. Please verify and close if it solves your problem, otherwise reopen and provide a test.&lt;/p&gt;</comment>
                            <comment id="15792874" author="gfriedrich" created="Mon, 2 Jan 2017 13:34:37 +0000"  >&lt;p&gt;Hi Ralph,&lt;/p&gt;

&lt;p&gt;well, there was a reason for doing it the way it was done in the patches.&lt;br/&gt;
First I didn&apos;t want to interrupt the running threads as I was not sure whether it would be problematic for the eventually currently running rollover. If you are sure it is fine, I&apos;m fine too.&lt;br/&gt;
Second, be aware that shutdownNow() doesn&apos;t return the currently running task which means that the list might be empty but the scheduler is still executing stuff. Your if-statement wouldn&apos;t work in this case.&lt;/p&gt;

&lt;p&gt;This is why I decided to remove all &quot;not yet executing&quot;-tasks from the scheduler, but let the scheduler exit normally without interrupting currently executing tasks.&lt;/p&gt;</comment>
                            <comment id="15793533" author="garydgregory" created="Mon, 2 Jan 2017 21:32:26 +0000"  >&lt;p&gt;It is a good question: should a log4j shutdown wait for scheduled tasks? I think it should but I also think we could also provide a shutdownNow or shutdown(boolean noWaiting) API. I think that passing 0 for the shutdown with timeout API is the same as the semantics of a &apos;shutdown no waiting&apos; API. AFK, can&apos;t look ATM.&lt;/p&gt;</comment>
                            <comment id="15793606" author="gfriedrich" created="Mon, 2 Jan 2017 22:23:40 +0000"  >&lt;p&gt;You should be aware that this would also get called when the whole Log4J2 context is reconfigured (as stated in the ticket description).&lt;br/&gt;
Therefore it would possibly interrupt tasks that are currently running while just doing a normal operation on the Log4J context (not a shutdown from the applications point of view).&lt;/p&gt;</comment>
                            <comment id="15810885" author="gfriedrich" created="Mon, 9 Jan 2017 07:08:39 +0000"  >&lt;p&gt;Fixed in combination with &lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-1653&quot; title=&quot;CronTriggeringPolicy uses wrong naming and produces NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-1653&quot;&gt;&lt;del&gt;LOG4J2-1653&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13016106">LOG4J2-1653</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12835778" name="ConfigurationScheduler.patch" size="944" author="GFriedrich" created="Fri, 28 Oct 2016 09:35:59 +0000"/>
                            <attachment id="12835779" name="RollingFileManager.patch" size="480" author="GFriedrich" created="Fri, 28 Oct 2016 09:35:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 45 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35au7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>