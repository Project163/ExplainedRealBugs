<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:40:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[LOG4J2-2457] RollingRandomAccessFileManager ignores new file patterns from programmatic reconfiguration</title>
                <link>https://issues.apache.org/jira/browse/LOG4J2-2457</link>
                <project id="12310790" key="LOG4J2">Log4j 2</project>
                    <description>&lt;p&gt;I use the Composite Configuration feature with two configuration files and set the System-Property &quot;log4j.configurationFile&quot; programmatically.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;log4j.configurationFile&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;log4j2.xml,log4j2-test-rotategz.xml&quot;&lt;/span&gt;);
LoggerContext ctx = (LoggerContext) LogManager.getContext(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
ctx.reconfigure();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The first config file defines an appender&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;RollingRandomAccessFile name=&quot;MyRollingFile&quot; fileName=&quot;c:/temp/my.log&quot; filePattern=&quot;c:/temp/my.log-%d{yyyy-MM-dd_HH-mm-ss}&quot;&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;and the second overwrites it with a different file pattern (.gz)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;RollingRandomAccessFile name=&quot;MyRollingFile&quot; fileName=&quot;c:/temp/my.log&quot; filePattern=&quot;c:/temp/my.log-%d{yyyy-MM-dd_HH-mm-ss}.gz&quot;&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As expected when i run my application the file rotation happens uncompressed until the programmatic reconfiguration.&lt;br/&gt;
But after the programmatic reconfiguration the rotated files are still uncompressed.&lt;/p&gt;

&lt;p&gt;The following code is responsible for this behaviour:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.logging.log4j.core.appender.rolling.RollingRandomAccessFileManager.updateData(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void updateData(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; data) {
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FactoryData factoryData = (FactoryData) data;
  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.setRolloverStrategy(factoryData.getRolloverStrategy());
  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.setTriggeringPolicy(factoryData.getTriggeringPolicy());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;


&lt;p&gt;Looking at the parent class,&#160;i can see that patterns are updated too:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.logging.log4j.core.appender.rolling.RollingFileManager.updateData(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void updateData(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; data) {
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FactoryData factoryData = (FactoryData) data;
  setRolloverStrategy(factoryData.getRolloverStrategy());
  setTriggeringPolicy(factoryData.getTriggeringPolicy());
  setPatternProcessor(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PatternProcessor(factoryData.getPattern(), getPatternProcessor()));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If i do the same in RollingRandomAccessFileManager everything works as expected.&lt;/p&gt;

&lt;p&gt;Please take note of the attached testcase, which contains all resources needed to reproduce easily.&lt;/p&gt;

&lt;p&gt;I would really appreciate, if you could investigate and fix this issue.&lt;/p&gt;

&lt;p&gt;Thank you so much in advance.&lt;/p&gt;

&lt;p&gt;Best regards&lt;br/&gt;
Heiko&lt;/p&gt;</description>
                <environment></environment>
        <key id="13187877">LOG4J2-2457</key>
            <summary>RollingRandomAccessFileManager ignores new file patterns from programmatic reconfiguration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="HeikoS">Heiko Schwanke</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Sep 2018 11:38:08 +0000</created>
                <updated>Thu, 14 Jan 2021 10:35:55 +0000</updated>
                            <resolved>Sat, 18 Apr 2020 21:26:37 +0000</resolved>
                                    <version>2.11.1</version>
                                    <fixVersion>3.0.0</fixVersion>
                    <fixVersion>2.11.2</fixVersion>
                    <fixVersion>2.13.2</fixVersion>
                                    <component>Appenders</component>
                    <component>Configurators</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16657744" author="jira-bot" created="Sat, 20 Oct 2018 05:46:08 +0000"  >&lt;p&gt;Commit 8999e33ef2eef6b9a204c944d6682a47bfe0e57e in logging-log4j2&apos;s branch refs/heads/release-2.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=8999e33&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=8999e33&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2457&quot; title=&quot;RollingRandomAccessFileManager ignores new file patterns from programmatic reconfiguration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2457&quot;&gt;&lt;del&gt;LOG4J2-2457&lt;/del&gt;&lt;/a&gt; RollingRandomAccessFileManager ignores new file patterns&lt;br/&gt;
from programmatic reconfiguration.&lt;/p&gt;</comment>
                            <comment id="16657745" author="jira-bot" created="Sat, 20 Oct 2018 05:46:31 +0000"  >&lt;p&gt;Commit eef7c3a11cf8b35a619b900f6beedf8f7ad06804 in logging-log4j2&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=garydgregory&quot; class=&quot;user-hover&quot; rel=&quot;garydgregory&quot;&gt;garydgregory&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=eef7c3a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=logging-log4j2.git;h=eef7c3a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2457&quot; title=&quot;RollingRandomAccessFileManager ignores new file patterns from programmatic reconfiguration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2457&quot;&gt;&lt;del&gt;LOG4J2-2457&lt;/del&gt;&lt;/a&gt; RollingRandomAccessFileManager ignores new file patterns&lt;br/&gt;
from programmatic reconfiguration.&lt;/p&gt;</comment>
                            <comment id="16657747" author="garydgregory" created="Sat, 20 Oct 2018 05:47:07 +0000"  >&lt;p&gt;In git master and release-2.x; please verify and fix.&lt;/p&gt;</comment>
                            <comment id="16660239" author="heikos" created="Tue, 23 Oct 2018 08:12:55 +0000"  >&lt;p&gt;My testcase works now as expected. Thank you very much for the quick response!&lt;/p&gt;

&lt;p&gt;I used the following snapshots for my test:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/logging/log4j/log4j-api/2.11.2-SNAPSHOT/log4j-api-2.11.2-20181023.031112-82.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;log4j-api-2.11.2-20181023.031112-82.jar&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/logging/log4j/log4j-core/2.11.2-SNAPSHOT/log4j-core-2.11.2-20181023.031215-83.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;log4j-core-2.11.2-20181023.031215-83.jar&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16674087" author="garydgregory" created="Sat, 3 Nov 2018 15:48:39 +0000"  >&lt;p&gt;Closing per &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=HeikoS&quot; class=&quot;user-hover&quot; rel=&quot;HeikoS&quot;&gt;HeikoS&lt;/a&gt; previous message.&lt;/p&gt;</comment>
                            <comment id="17026569" author="heikos" created="Thu, 30 Jan 2020 10:37:49 +0000"  >&lt;p&gt;The patch creates files with .gz extension after reconfiguration, but they are not compressed.&lt;/p&gt;

&lt;p&gt;Too bad i missed that at first hand - sorry!&lt;/p&gt;

&lt;p&gt;In case of an update the fileExtension of the RollingFileManager attribute is not updated.&#160;&lt;/p&gt;

&lt;p&gt;The methods&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.logging.log4j.core.appender.rolling.RollingFileManager.updateData(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)

and

org.apache.logging.log4j.core.appender.rolling.RollingRandomAccessFileManager.updateData(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;should also update&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.logging.log4j.core.appender.rolling.RollingFileManager.fileExtension
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;too.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This attribute is taken into account when a rollover occurs.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.logging.log4j.core.appender.rolling.DefaultRolloverStrategy.rollover(RollingFileManager)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Currently it is still&#160;&#160;&lt;tt&gt;null&lt;/tt&gt;&#160; after reconfiguration from&#160;&#160;&lt;tt&gt;xxx.log&lt;/tt&gt;&#160; to&#160; &lt;tt&gt;xxx.log.gz&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17086352" author="ralph.goers@dslextreme.com" created="Sat, 18 Apr 2020 07:24:52 +0000"  >&lt;p&gt;Yes. FileExtension is an enum that is assigned in the RollingFileManager&apos;s constructor. I am reluctant to change this. Dynamically changing the file pattern was never intended when it was written and changing all the variables in RollingFileManager that updateData changes independently means that these values could be in various combinations if a rollover occurs while the update is taking place as they aren&apos;t all performed in one atomic operation. Furthermore, it seems very odd to me that you would want to change your file pattern to stop or start compressing files while the application is running as that could have operational consequences.&lt;/p&gt;

&lt;p&gt;Finally, I believe this issue should be closed simply because the issue that was raised in the problem description was resolved.&lt;/p&gt;</comment>
                            <comment id="17086657" author="jira-bot" created="Sat, 18 Apr 2020 21:24:12 +0000"  >&lt;p&gt;Commit 99809b488fee56935b2dbe0e241e8bff04426840 in logging-log4j2&apos;s branch refs/heads/release-2.x from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=99809b4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=99809b4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2766&quot; title=&quot;TimeBasedTriggeringPolicy of RollingRandomAccessFile is not updated instantly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2766&quot;&gt;&lt;del&gt;LOG4J2-2766&lt;/del&gt;&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2457&quot; title=&quot;RollingRandomAccessFileManager ignores new file patterns from programmatic reconfiguration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2457&quot;&gt;&lt;del&gt;LOG4J2-2457&lt;/del&gt;&lt;/a&gt; - Initialize PatternProcessor before trigging policy and allow file extension to be modified during reconfiguration&lt;/p&gt;</comment>
                            <comment id="17086659" author="jira-bot" created="Sat, 18 Apr 2020 21:24:26 +0000"  >&lt;p&gt;Commit d7ea9e60502b8ae3c46f290ae7d254f4a6e5aec6 in logging-log4j2&apos;s branch refs/heads/master from Ralph Goers&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=d7ea9e6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=logging-log4j2.git;h=d7ea9e6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2766&quot; title=&quot;TimeBasedTriggeringPolicy of RollingRandomAccessFile is not updated instantly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2766&quot;&gt;&lt;del&gt;LOG4J2-2766&lt;/del&gt;&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/browse/LOG4J2-2457&quot; title=&quot;RollingRandomAccessFileManager ignores new file patterns from programmatic reconfiguration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LOG4J2-2457&quot;&gt;&lt;del&gt;LOG4J2-2457&lt;/del&gt;&lt;/a&gt; - Initialize PatternProcessor before trigging policy and allow file extension to be modified during reconfiguration&lt;/p&gt;</comment>
                            <comment id="17086661" author="ralph.goers@dslextreme.com" created="Sat, 18 Apr 2020 21:26:22 +0000"  >&lt;p&gt;I moved the initialization of FileExtension to PatternProcessor. It is still immutable but will change when the PatternProcessor changes.&#160; Please verify and close.&lt;/p&gt;</comment>
                            <comment id="17264762" author="heikos" created="Thu, 14 Jan 2021 10:35:55 +0000"  >&lt;p&gt;Works now as expected - great work Ralph, thank you a lot.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13281358">LOG4J2-2766</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12941529" name="testcase.zip" size="1591" author="HeikoS" created="Thu, 27 Sep 2018 11:31:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 43 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ykef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>