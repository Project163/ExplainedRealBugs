diff --git a/log4j-1.2-api/src/main/java/org/apache/log4j/PropertyConfigurator.java b/log4j-1.2-api/src/main/java/org/apache/log4j/PropertyConfigurator.java
index 348646ad3c..7f82b47896 100644
--- a/log4j-1.2-api/src/main/java/org/apache/log4j/PropertyConfigurator.java
+++ b/log4j-1.2-api/src/main/java/org/apache/log4j/PropertyConfigurator.java
@@ -47,6 +47,7 @@ import org.apache.log4j.spi.RendererSupport;
 import org.apache.log4j.spi.ThrowableRenderer;
 import org.apache.log4j.spi.ThrowableRendererSupport;
 import org.apache.logging.log4j.core.config.Configuration;
+import org.apache.logging.log4j.core.net.UrlConnectionFactory;
 import org.apache.logging.log4j.util.StackLocatorUtil;
 
 /**
@@ -381,9 +382,7 @@ public class PropertyConfigurator implements Configurator {
     Configuration doConfigure(final URL url, final LoggerRepository loggerRepository, final ClassLoader classLoader) {
         LogLog.debug("Reading configuration from URL " + url);
         try {
-            final URLConnection urlConnection = url.openConnection();
-            // A "jar:" URL file remains open after the stream is closed, so do not cache it.
-            urlConnection.setUseCaches(false);
+            final URLConnection urlConnection = UrlConnectionFactory.createConnection(url);
             try (InputStream inputStream = urlConnection.getInputStream()) {
                 return doConfigure(inputStream, loggerRepository, classLoader);
             }
diff --git a/log4j-1.2-api/src/main/java/org/apache/log4j/xml/DOMConfigurator.java b/log4j-1.2-api/src/main/java/org/apache/log4j/xml/DOMConfigurator.java
index e5adf602a4..b0cbb582b1 100644
--- a/log4j-1.2-api/src/main/java/org/apache/log4j/xml/DOMConfigurator.java
+++ b/log4j-1.2-api/src/main/java/org/apache/log4j/xml/DOMConfigurator.java
@@ -39,6 +39,7 @@ import org.apache.logging.log4j.core.LoggerContext;
 import org.apache.logging.log4j.core.config.Configuration;
 import org.apache.logging.log4j.core.config.ConfigurationSource;
 import org.apache.logging.log4j.core.config.Configurator;
+import org.apache.logging.log4j.core.net.UrlConnectionFactory;
 import org.apache.logging.log4j.core.util.IOUtils;
 import org.w3c.dom.Element;
 
@@ -144,9 +145,7 @@ public class DOMConfigurator {
 
     public void doConfigure(final URL url, final LoggerRepository repository) {
         try {
-            final URLConnection connection = url.openConnection();
-            // A "jar:" URL file remains open after the stream is closed, so do not cache it.
-            connection.setUseCaches(false);
+            final URLConnection connection = UrlConnectionFactory.createConnection(url);
             try (InputStream inputStream = connection.getInputStream()) {
                 doConfigure(new ConfigurationSource(inputStream, url));
             }
diff --git a/log4j-core/src/main/java/org/apache/logging/log4j/core/config/ConfigurationFactory.java b/log4j-core/src/main/java/org/apache/logging/log4j/core/config/ConfigurationFactory.java
index 1322f85cc6..89ccd77d45 100644
--- a/log4j-core/src/main/java/org/apache/logging/log4j/core/config/ConfigurationFactory.java
+++ b/log4j-core/src/main/java/org/apache/logging/log4j/core/config/ConfigurationFactory.java
@@ -16,6 +16,18 @@
  */
 package org.apache.logging.log4j.core.config;
 
+import java.io.UnsupportedEncodingException;
+import java.net.URI;
+import java.net.URISyntaxException;
+import java.net.URLDecoder;
+import java.util.ArrayList;
+import java.util.Collection;
+import java.util.Collections;
+import java.util.List;
+import java.util.Map;
+import java.util.concurrent.locks.Lock;
+import java.util.concurrent.locks.ReentrantLock;
+
 import org.apache.logging.log4j.Level;
 import org.apache.logging.log4j.Logger;
 import org.apache.logging.log4j.core.LoggerContext;
@@ -26,10 +38,8 @@ import org.apache.logging.log4j.core.config.plugins.util.PluginType;
 import org.apache.logging.log4j.core.lookup.ConfigurationStrSubstitutor;
 import org.apache.logging.log4j.core.lookup.Interpolator;
 import org.apache.logging.log4j.core.lookup.StrSubstitutor;
-import org.apache.logging.log4j.core.net.UrlConnectionFactory;
 import org.apache.logging.log4j.core.util.AuthorizationProvider;
 import org.apache.logging.log4j.core.util.BasicAuthorizationProvider;
-import org.apache.logging.log4j.core.util.FileUtils;
 import org.apache.logging.log4j.core.util.Loader;
 import org.apache.logging.log4j.core.util.NetUtils;
 import org.apache.logging.log4j.core.util.ReflectionUtil;
@@ -38,23 +48,6 @@ import org.apache.logging.log4j.util.LoaderUtil;
 import org.apache.logging.log4j.util.PropertiesUtil;
 import org.apache.logging.log4j.util.Strings;
 
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.FileNotFoundException;
-import java.io.UnsupportedEncodingException;
-import java.net.URI;
-import java.net.URISyntaxException;
-import java.net.URL;
-import java.net.URLConnection;
-import java.net.URLDecoder;
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.Collections;
-import java.util.List;
-import java.util.Map;
-import java.util.concurrent.locks.Lock;
-import java.util.concurrent.locks.ReentrantLock;
-
 /**
  * Factory class for parsed {@link Configuration} objects from a configuration file.
  * ConfigurationFactory allows the configuration implementation to be
@@ -355,28 +348,9 @@ public abstract class ConfigurationFactory extends ConfigurationBuilderFactory {
      * @param loader The default ClassLoader to use.
      * @return The InputSource to use to read the configuration.
      */
+    @Deprecated
     protected ConfigurationSource getInputFromString(final String config, final ClassLoader loader) {
-        try {
-            final URL url = new URL(config);
-            URLConnection urlConnection = UrlConnectionFactory.createConnection(url);
-            File file = FileUtils.fileFromUri(url.toURI());
-            if (file != null) {
-                return new ConfigurationSource(urlConnection.getInputStream(), FileUtils.fileFromUri(url.toURI()));
-            }
-            return new ConfigurationSource(urlConnection.getInputStream(), url, urlConnection.getLastModified());
-        } catch (final Exception ex) {
-            final ConfigurationSource source = ConfigurationSource.fromResource(config, loader);
-            if (source == null) {
-                try {
-                    final File file = new File(config);
-                    return new ConfigurationSource(new FileInputStream(file), file);
-                } catch (final FileNotFoundException fnfe) {
-                    // Ignore the exception
-                    LOGGER.catching(Level.DEBUG, fnfe);
-                }
-            }
-            return source;
-        }
+        return ConfigurationSource.fromUri(NetUtils.toURI(config));
     }
 
     /**
diff --git a/log4j-core/src/main/java/org/apache/logging/log4j/core/config/ConfigurationSource.java b/log4j-core/src/main/java/org/apache/logging/log4j/core/config/ConfigurationSource.java
index a26c14400b..48d7d5aa9a 100644
--- a/log4j-core/src/main/java/org/apache/logging/log4j/core/config/ConfigurationSource.java
+++ b/log4j-core/src/main/java/org/apache/logging/log4j/core/config/ConfigurationSource.java
@@ -339,17 +339,9 @@ public class ConfigurationSource {
             return null;
         }
         try {
-            URL url = configLocation.toURL();
-            URLConnection urlConnection = UrlConnectionFactory.createConnection(url);
-            InputStream is = urlConnection.getInputStream();
-            long lastModified = urlConnection.getLastModified();
-            return new ConfigurationSource(is, configLocation.toURL(), lastModified);
-        } catch (final FileNotFoundException ex) {
-            ConfigurationFactory.LOGGER.warn("Could not locate file {}", configLocation.toString());
+            return getConfigurationSource(configLocation.toURL());
         } catch (final MalformedURLException ex) {
             ConfigurationFactory.LOGGER.error("Invalid URL {}", configLocation.toString(), ex);
-        } catch (final Exception ex) {
-            ConfigurationFactory.LOGGER.error("Unable to access {}", configLocation.toString(), ex);
         }
         return null;
     }
@@ -370,21 +362,8 @@ public class ConfigurationSource {
 
     private static ConfigurationSource getConfigurationSource(URL url) {
         try {
-            URLConnection urlConnection = url.openConnection();
-            // A "jar:" URL file remains open after the stream is closed, so do not cache it.
-            urlConnection.setUseCaches(false);
-            AuthorizationProvider provider = ConfigurationFactory.authorizationProvider(PropertiesUtil.getProperties());
-            provider.addAuthorization(urlConnection);
-            if (url.getProtocol().equals(HTTPS)) {
-                SslConfiguration sslConfiguration = SslConfigurationFactory.getSslConfiguration();
-                if (sslConfiguration != null) {
-                    ((HttpsURLConnection) urlConnection).setSSLSocketFactory(sslConfiguration.getSslSocketFactory());
-                    if (!sslConfiguration.isVerifyHostName()) {
-                        ((HttpsURLConnection) urlConnection).setHostnameVerifier(LaxHostnameVerifier.INSTANCE);
-                    }
-                }
-            }
             File file = FileUtils.fileFromUri(url.toURI());
+            URLConnection urlConnection = UrlConnectionFactory.createConnection(url);
             try {
                 if (file != null) {
                     return new ConfigurationSource(urlConnection.getInputStream(), FileUtils.fileFromUri(url.toURI()));
diff --git a/log4j-core/src/main/java/org/apache/logging/log4j/core/config/HttpWatcher.java b/log4j-core/src/main/java/org/apache/logging/log4j/core/config/HttpWatcher.java
index 1673c07b65..72f3128f4d 100644
--- a/log4j-core/src/main/java/org/apache/logging/log4j/core/config/HttpWatcher.java
+++ b/log4j-core/src/main/java/org/apache/logging/log4j/core/config/HttpWatcher.java
@@ -135,6 +135,8 @@ public class HttpWatcher extends AbstractWatcher {
                 }
             } catch (final IOException ioe) {
                 LOGGER.error("Error accessing configuration at {}: {}", url, ioe.getMessage());
+            } finally {
+                urlConnection.disconnect();
             }
         } catch (final IOException ioe) {
             LOGGER.error("Error connecting to configuration at {}: {}", url, ioe.getMessage());
diff --git a/log4j-core/src/main/java/org/apache/logging/log4j/core/net/UrlConnectionFactory.java b/log4j-core/src/main/java/org/apache/logging/log4j/core/net/UrlConnectionFactory.java
index 83151f7378..93841022d8 100644
--- a/log4j-core/src/main/java/org/apache/logging/log4j/core/net/UrlConnectionFactory.java
+++ b/log4j-core/src/main/java/org/apache/logging/log4j/core/net/UrlConnectionFactory.java
@@ -18,6 +18,7 @@ package org.apache.logging.log4j.core.net;
 
 import java.io.IOException;
 import java.net.HttpURLConnection;
+import java.net.JarURLConnection;
 import java.net.ProtocolException;
 import java.net.URL;
 import java.net.URLConnection;
@@ -77,8 +78,6 @@ public class UrlConnectionFactory {
         urlConnection.setDoOutput(true);
         urlConnection.setDoInput(true);
         urlConnection.setRequestMethod("GET");
-        // A "jar:" URL file remains open after the stream is closed, so do not cache it.
-        urlConnection.setUseCaches(false);
         if (connectTimeoutMillis > 0) {
             urlConnection.setConnectTimeout(connectTimeoutMillis);
         }
@@ -107,13 +106,14 @@ public class UrlConnectionFactory {
             urlConnection = createConnection(url, 0, SslConfigurationFactory.getSslConfiguration());
         } else {
             urlConnection = url.openConnection();
-            // A "jar:" URL file remains open after the stream is closed, so do not cache it.
-            urlConnection.setUseCaches(false);
+            if (urlConnection instanceof JarURLConnection) {
+                // A "jar:" URL file remains open after the stream is closed, so do not cache it.
+                urlConnection.setUseCaches(false);
+            }
         }
         return urlConnection;
     }
 
-
     private static boolean isXml(final String type) {
         return type.equalsIgnoreCase("xml");
     }
diff --git a/log4j-core/src/test/java/org/apache/logging/log4j/core/config/ConfigurationSourceTest.java b/log4j-core/src/test/java/org/apache/logging/log4j/core/config/ConfigurationSourceTest.java
index c067b7150f..a3cae62402 100644
--- a/log4j-core/src/test/java/org/apache/logging/log4j/core/config/ConfigurationSourceTest.java
+++ b/log4j-core/src/test/java/org/apache/logging/log4j/core/config/ConfigurationSourceTest.java
@@ -17,11 +17,24 @@
 
 package org.apache.logging.log4j.core.config;
 
-import org.junit.jupiter.api.Test;
+import static org.junit.jupiter.api.Assertions.assertEquals;
+import static org.junit.jupiter.api.Assertions.assertNotNull;
+import static org.junit.jupiter.api.Assertions.fail;
 
 import java.io.ByteArrayInputStream;
+import java.io.File;
+import java.io.IOException;
+import java.lang.management.ManagementFactory;
+import java.lang.management.OperatingSystemMXBean;
+import java.net.URL;
+import java.nio.file.Files;
+import java.nio.file.Path;
+import java.nio.file.Paths;
 
-import static org.junit.jupiter.api.Assertions.assertNotNull;
+import org.apache.logging.log4j.core.net.UrlConnectionFactory;
+import org.junit.jupiter.api.Test;
+
+import com.sun.management.UnixOperatingSystemMXBean;
 
 public class ConfigurationSourceTest {
 
@@ -30,4 +43,36 @@ public class ConfigurationSourceTest {
         ConfigurationSource configurationSource = new ConfigurationSource(new ByteArrayInputStream(new byte[] { 'a', 'b' }));
         assertNotNull(configurationSource.resetInputStream());
     }
+
+    /**
+     * Checks if the usage of 'jar:' URLs does not increase the file descriptor
+     * count and the jar file can be deleted.
+     * 
+     * @throws Exception
+     */
+    @Test
+    public void testNoJarFileLeak() throws Exception {
+        final Path original = Paths.get("target", "test-classes", "jarfile.jar");
+        final Path copy = Paths.get("target", "test-classes", "jarfile-copy.jar");
+        Files.copy(original, copy);
+        final URL jarUrl = new URL("jar:" + copy.toUri().toURL() + "!/config/console.xml");
+        final long expected = getOpenFileDescriptorCount();
+        UrlConnectionFactory.createConnection(jarUrl).getInputStream().close();
+        // This can only fail on UNIX
+        assertEquals(expected, getOpenFileDescriptorCount());
+        // This can only fail on Windows
+        try {
+            Files.delete(copy);
+        } catch (IOException e) {
+            fail(e);
+        }
+    }
+
+    private long getOpenFileDescriptorCount() {
+        final OperatingSystemMXBean os = ManagementFactory.getOperatingSystemMXBean();
+        if (os instanceof UnixOperatingSystemMXBean) {
+            return ((UnixOperatingSystemMXBean) os).getOpenFileDescriptorCount();
+        }
+        return 0L;
+    }
 }
diff --git a/log4j-core/src/test/java/org/apache/logging/log4j/core/net/UrlConnectionFactoryTest.java b/log4j-core/src/test/java/org/apache/logging/log4j/core/net/UrlConnectionFactoryTest.java
index 07cd754dc0..202a221c3f 100644
--- a/log4j-core/src/test/java/org/apache/logging/log4j/core/net/UrlConnectionFactoryTest.java
+++ b/log4j-core/src/test/java/org/apache/logging/log4j/core/net/UrlConnectionFactoryTest.java
@@ -16,38 +16,51 @@
  */
 package org.apache.logging.log4j.core.net;
 
-import javax.servlet.ServletException;
-import javax.servlet.http.HttpServletRequest;
-import javax.servlet.http.HttpServletResponse;
+import static javax.servlet.http.HttpServletResponse.SC_BAD_REQUEST;
+import static javax.servlet.http.HttpServletResponse.SC_INTERNAL_SERVER_ERROR;
+import static javax.servlet.http.HttpServletResponse.SC_NOT_FOUND;
+import static javax.servlet.http.HttpServletResponse.SC_NOT_MODIFIED;
+import static javax.servlet.http.HttpServletResponse.SC_OK;
+import static javax.servlet.http.HttpServletResponse.SC_UNAUTHORIZED;
+import static org.junit.jupiter.api.Assertions.assertEquals;
+import static org.junit.jupiter.api.Assertions.assertNotNull;
+import static org.junit.jupiter.api.Assertions.assertNull;
+import static org.junit.jupiter.api.Assertions.assertTrue;
+import static org.junit.jupiter.api.Assertions.fail;
+
 import java.io.File;
 import java.io.IOException;
 import java.io.InputStream;
+import java.lang.management.ManagementFactory;
+import java.lang.management.OperatingSystemMXBean;
 import java.net.HttpURLConnection;
 import java.net.URI;
+import java.net.URL;
 import java.nio.file.Files;
 import java.util.Base64;
 import java.util.Enumeration;
-import java.util.Properties;
+
+import javax.servlet.ServletException;
+import javax.servlet.http.HttpServletRequest;
+import javax.servlet.http.HttpServletResponse;
 
 import org.apache.logging.log4j.LogManager;
 import org.apache.logging.log4j.Logger;
 import org.apache.logging.log4j.core.config.ConfigurationSource;
+import org.apache.logging.log4j.core.util.FileUtils;
 import org.eclipse.jetty.http.HttpHeader;
 import org.eclipse.jetty.server.Server;
 import org.eclipse.jetty.server.ServerConnector;
 import org.eclipse.jetty.servlet.DefaultServlet;
 import org.eclipse.jetty.servlet.ServletContextHandler;
 import org.eclipse.jetty.servlet.ServletHolder;
-
 import org.junit.jupiter.api.AfterAll;
 import org.junit.jupiter.api.BeforeAll;
 import org.junit.jupiter.api.Test;
+import org.junit.jupiter.api.condition.EnabledOnOs;
+import org.junit.jupiter.api.condition.OS;
 
-import static org.junit.jupiter.api.Assertions.assertEquals;
-import static org.junit.jupiter.api.Assertions.assertNotNull;
-import static org.junit.jupiter.api.Assertions.assertNull;
-import static org.junit.jupiter.api.Assertions.assertTrue;
-import static org.junit.jupiter.api.Assertions.fail;
+import com.sun.management.UnixOperatingSystemMXBean;
 
 /**
  * Tests the UrlConnectionFactory
@@ -60,9 +73,6 @@ public class UrlConnectionFactoryTest {
     private static Server server;
     private static Base64.Decoder decoder = Base64.getDecoder();
     private static int port;
-    private static final int NOT_MODIFIED = 304;
-    private static final int NOT_AUTHORIZED = 401;
-    private static final int OK = 200;
     private static final int BUF_SIZE = 1024;
 
     @BeforeAll
@@ -110,15 +120,16 @@ public class UrlConnectionFactoryTest {
         assertNotNull(source, "No ConfigurationSource returned");
         InputStream is = source.getInputStream();
         assertNotNull(is, "No data returned");
+        is.close();
         long lastModified = source.getLastModified();
         int result = verifyNotModified(uri, lastModified);
-        assertEquals(NOT_MODIFIED, result,"File was modified");
+        assertEquals(SC_NOT_MODIFIED, result,"File was modified");
         File file = new File("target/test-classes/log4j2-config.xml");
         if (!file.setLastModified(System.currentTimeMillis())) {
             fail("Unable to set last modified time");
         }
         result = verifyNotModified(uri, lastModified);
-        assertEquals(OK, result,"File was not modified");
+        assertEquals(SC_OK, result,"File was not modified");
     }
 
     private int verifyNotModified(URI uri, long lastModifiedMillis) throws Exception {
@@ -130,10 +141,34 @@ public class UrlConnectionFactoryTest {
             return urlConnection.getResponseCode();
         } catch (final IOException ioe) {
             LOGGER.error("Error accessing configuration at {}: {}", uri, ioe.getMessage());
-            return 500;
+            return SC_INTERNAL_SERVER_ERROR;
         }
     }
 
+    @Test
+    public void testNoJarFileLeak() throws Exception {
+        final URL url = new File("target/test-classes/jarfile.jar").toURI().toURL();
+        // Retrieve using 'file:'
+        URL jarUrl = new URL("jar:" + url.toString() + "!/config/console.xml");
+        long expected = getOpenFileDescriptorCount();
+        UrlConnectionFactory.createConnection(jarUrl).getInputStream().close();
+        assertEquals(expected, getOpenFileDescriptorCount());
+        // Retrieve using 'http:'
+        jarUrl = new URL("jar:http://localhost:" + port + "/jarfile.jar!/config/console.xml");
+        final File tmpDir = new File(System.getProperty("java.io.tmpdir"));
+        expected = tmpDir.list().length;
+        UrlConnectionFactory.createConnection(jarUrl).getInputStream().close();
+        assertEquals(expected, tmpDir.list().length, "File descriptor leak");
+    }
+
+    private long getOpenFileDescriptorCount() {
+        final OperatingSystemMXBean os = ManagementFactory.getOperatingSystemMXBean();
+        if (os instanceof UnixOperatingSystemMXBean) {
+            return ((UnixOperatingSystemMXBean) os).getOpenFileDescriptorCount();
+        }
+        return 0L;
+    }
+
     public static class TestServlet extends DefaultServlet {
 
         private static final long serialVersionUID = -2885158530511450659L;
@@ -143,7 +178,7 @@ public class UrlConnectionFactoryTest {
                 HttpServletResponse response) throws ServletException, IOException {
             Enumeration<String> headers = request.getHeaders(HttpHeader.AUTHORIZATION.toString());
             if (headers == null) {
-                response.sendError(401, "No Auth header");
+                response.sendError(SC_UNAUTHORIZED, "No Auth header");
                 return;
             }
             while (headers.hasMoreElements()) {
@@ -151,26 +186,31 @@ public class UrlConnectionFactoryTest {
                 assertTrue(authData.startsWith(BASIC), "Not a Basic auth header");
                 String credentials = new String(decoder.decode(authData.substring(BASIC.length())));
                 if (!expectedCreds.equals(credentials)) {
-                    response.sendError(401, "Invalid credentials");
+                    response.sendError(SC_UNAUTHORIZED, "Invalid credentials");
                     return;
                 }
             }
-            if (request.getServletPath().equals("/log4j2-config.xml")) {
-                File file = new File("target/test-classes/log4j2-config.xml");
+            final String servletPath = request.getServletPath();
+            if (servletPath != null) {
+                final File file = new File("target/test-classes" + servletPath);
+                if (!file.exists()) {
+                    response.sendError(SC_NOT_FOUND);
+                    return;
+                }
                 long modifiedSince = request.getDateHeader(HttpHeader.IF_MODIFIED_SINCE.toString());
                 long lastModified = (file.lastModified() / 1000) * 1000;
                 LOGGER.debug("LastModified: {}, modifiedSince: {}", lastModified, modifiedSince);
                 if (modifiedSince > 0 && lastModified <= modifiedSince) {
-                    response.setStatus(304);
+                    response.setStatus(SC_NOT_MODIFIED);
                     return;
                 }
                 response.setDateHeader(HttpHeader.LAST_MODIFIED.toString(), lastModified);
                 response.setContentLengthLong(file.length());
                 Files.copy(file.toPath(), response.getOutputStream());
                 response.getOutputStream().flush();
-                response.setStatus(200);
+                response.setStatus(SC_OK);
             } else {
-                response.sendError(400, "Unsupported request");
+                response.sendError(SC_BAD_REQUEST, "Unsupported request");
             }
         }
     }
diff --git a/log4j-core/src/test/java/org/apache/logging/log4j/core/util/NetUtilsTest.java b/log4j-core/src/test/java/org/apache/logging/log4j/core/util/NetUtilsTest.java
index a1cf6ab805..10d9705b77 100644
--- a/log4j-core/src/test/java/org/apache/logging/log4j/core/util/NetUtilsTest.java
+++ b/log4j-core/src/test/java/org/apache/logging/log4j/core/util/NetUtilsTest.java
@@ -17,24 +17,40 @@
 
 package org.apache.logging.log4j.core.util;
 
-import org.junit.jupiter.api.Test;
-import org.junit.jupiter.api.condition.EnabledOnOs;
-import org.junit.jupiter.api.condition.OS;
+import static org.junit.jupiter.api.Assertions.assertEquals;
+import static org.junit.jupiter.api.Assertions.assertNotNull;
 
+import java.io.File;
 import java.net.URI;
 
-import static org.junit.jupiter.api.Assertions.assertEquals;
-import static org.junit.jupiter.api.Assertions.assertNotNull;
+import org.junit.jupiter.api.Test;
+import org.junit.jupiter.api.condition.EnabledOnOs;
+import org.junit.jupiter.api.condition.OS;
 
 public class NetUtilsTest {
 
     @Test
     public void testToUriWithoutBackslashes() {
         final String config = "file:///path/to/something/on/unix";
-        final URI uri = NetUtils.toURI(config);
+        URI uri = NetUtils.toURI(config);
 
         assertNotNull(uri, "The URI should not be null.");
         assertEquals("file:///path/to/something/on/unix", uri.toString(), "The URI is not correct.");
+
+        final String properUriPath = "/path/without/spaces";
+        uri = NetUtils.toURI(properUriPath);
+
+        assertNotNull(uri, "The URI should not be null.");
+        assertEquals(properUriPath, uri.toString(), "The URI is not correct.");
+    }
+
+    @Test
+    public void testToUriUnixWithSpaces() {
+        final String pathWithSpaces = "/ path / with / spaces";
+        final URI uri = NetUtils.toURI(pathWithSpaces);
+
+        assertNotNull(uri, "The URI should not be null.");
+        assertEquals(new File(pathWithSpaces).toURI().toString(), uri.toString(), "The URI is not correct.");
     }
 
     @Test
diff --git a/log4j-core/src/test/resources/jarfile.jar b/log4j-core/src/test/resources/jarfile.jar
new file mode 100644
index 0000000000..bf34b8c468
Binary files /dev/null and b/log4j-core/src/test/resources/jarfile.jar differ
diff --git a/log4j-core/src/test/resources/jarfile/config/console.xml b/log4j-core/src/test/resources/jarfile/config/console.xml
new file mode 100644
index 0000000000..015ac0b95e
--- /dev/null
+++ b/log4j-core/src/test/resources/jarfile/config/console.xml
@@ -0,0 +1,28 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+  Licensed to the Apache Software Foundation (ASF) under one or more
+  contributor license agreements. See the NOTICE file distributed with
+  this work for additional information regarding copyright ownership.
+  The ASF licenses this file to You under the Apache License, Version 2.0
+  (the "License"); you may not use this file except in compliance with
+  the License. You may obtain a copy of the License at
+
+  http://www.apache.org/licenses/LICENSE-2.0
+
+  Unless required by applicable law or agreed to in writing, software
+  distributed under the License is distributed on an "AS IS" BASIS,
+  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+  See the License for the specific language governing permissions and
+  limitations under the License.
+
+-->
+<Configuration status="WARN">
+  <Appenders>
+    <Console name="Console" />
+  </Appenders>
+  <Loggers>
+    <Root level="TRACE">
+      <AppenderRef ref="Console" />
+    </Root>
+  </Loggers>
+</Configuration>
