diff --git a/core/src/main/java/org/apache/logging/log4j/core/config/plugins/PluginManager.java b/core/src/main/java/org/apache/logging/log4j/core/config/plugins/PluginManager.java
index f340971d70..c40c0bca1a 100644
--- a/core/src/main/java/org/apache/logging/log4j/core/config/plugins/PluginManager.java
+++ b/core/src/main/java/org/apache/logging/log4j/core/config/plugins/PluginManager.java
@@ -155,9 +155,11 @@ public class PluginManager {
                 LOGGER.warn("Plugin preloads not available");
             }
         }
-        if (plugins.size() == 0) {
+        if (plugins == null || plugins.size() == 0) {
             if (pkgs == null) {
-                PACKAGES.add(LOG4J_PACKAGES);
+                if (!PACKAGES.contains(LOG4J_PACKAGES)) {
+                    PACKAGES.add(LOG4J_PACKAGES);
+                }
             } else {
                 final String[] names = pkgs.split(",");
                 for (final String name : names) {
diff --git a/core/src/main/java/org/apache/logging/log4j/core/helpers/SecretKeyProvider.java b/core/src/main/java/org/apache/logging/log4j/core/helpers/SecretKeyProvider.java
new file mode 100644
index 0000000000..fbabb8a9c0
--- /dev/null
+++ b/core/src/main/java/org/apache/logging/log4j/core/helpers/SecretKeyProvider.java
@@ -0,0 +1,11 @@
+package org.apache.logging.log4j.core.helpers;
+
+import javax.crypto.SecretKey;
+
+/**
+ *
+ */
+public interface SecretKeyProvider {
+
+    SecretKey getSecretKey();
+}
diff --git a/flume-ng/src/main/java/org/apache/logging/log4j/flume/appender/FlumePersistentManager.java b/flume-ng/src/main/java/org/apache/logging/log4j/flume/appender/FlumePersistentManager.java
index d2a6149179..e5779d6c9a 100644
--- a/flume-ng/src/main/java/org/apache/logging/log4j/flume/appender/FlumePersistentManager.java
+++ b/flume-ng/src/main/java/org/apache/logging/log4j/flume/appender/FlumePersistentManager.java
@@ -29,7 +29,10 @@ import org.apache.flume.event.SimpleEvent;
 import org.apache.logging.log4j.LoggingException;
 import org.apache.logging.log4j.core.appender.ManagerFactory;
 import org.apache.logging.log4j.core.config.Property;
+import org.apache.logging.log4j.core.config.plugins.PluginManager;
+import org.apache.logging.log4j.core.config.plugins.PluginType;
 import org.apache.logging.log4j.core.helpers.FileUtils;
+import org.apache.logging.log4j.core.helpers.SecretKeyProvider;
 
 import javax.crypto.Cipher;
 import javax.crypto.SecretKey;
@@ -58,7 +61,7 @@ import java.util.zip.GZIPOutputStream;
  */
 public class FlumePersistentManager extends FlumeAvroManager {
 
-    public static final String PASSWORD = "password";
+    public static final String KEY_PROVIDER = "keyProvider";
 
     private static final Charset UTF8 = Charset.forName("UTF-8");
 
@@ -232,7 +235,6 @@ public class FlumePersistentManager extends FlumeAvroManager {
          */
         public FlumePersistentManager createManager(final String name, final FactoryData data) {
             SecretKey secretKey = null;
-            byte[] salt;
 
             Database database;
 
@@ -261,37 +263,44 @@ public class FlumePersistentManager extends FlumeAvroManager {
             }
 
             try {
-                if (properties.containsKey(PASSWORD)) {
-                    String password = properties.get(PASSWORD);
-                    salt = new byte[20];
-                    File saltFile = new File(data.dataDir + "/salt.dat");
-                    boolean needSalt = true;
-                    if (saltFile.exists()) {
-                        FileInputStream fis = new FileInputStream(saltFile);
-                        if (fis.read(salt) == 20) {
-                            needSalt = false;
-                        }
-                        fis.close();
+                String key = null;
+                for (Map.Entry<String, String> entry : properties.entrySet()) {
+                    if (entry.getKey().equalsIgnoreCase(KEY_PROVIDER)) {
+                        key = entry.getValue();
                     }
-                    if (needSalt) {
-                        Random r = new SecureRandom();
-                        r.nextBytes(salt);
-                        FileOutputStream fos = new FileOutputStream(saltFile);
-                        fos.write(salt);
-                        fos.close();
+                }
+                if (key != null) {
+                    final PluginManager manager = new PluginManager("KeyProvider", SecretKeyProvider.class);
+                    manager.collectPlugins();
+                    final Map<String, PluginType> plugins = manager.getPlugins();
+                    if (plugins != null) {
+                        boolean found = false;
+                        for (Map.Entry<String, PluginType> entry : plugins.entrySet()) {
+                            if (entry.getKey().equalsIgnoreCase(key)) {
+                                found = true;
+                                Class cl = entry.getValue().getPluginClass();
+                                try {
+                                    SecretKeyProvider provider = (SecretKeyProvider) cl.newInstance();
+                                    secretKey = provider.getSecretKey();
+                                } catch (Exception ex) {
+                                    LOGGER.error("Unable to create SecretKeyProvider {}, encryption will be disabled",
+                                        cl.getName());
+                                }
+                                break;
+                            }
+                        }
+                        if (!found) {
+                            LOGGER.error("Unable to locate SecretKey provider {}, encryption will be disabled", key);
+                        }
+                    } else {
+                        LOGGER.error("Unable to locate SecretKey provider {}, encryption will be disabled", key);
                     }
-                    SecretKeyFactory factory = SecretKeyFactory.getInstance("PBKDF2WithHmacSHA1");
-                    KeySpec spec = new PBEKeySpec(password.toCharArray(), salt, 65536, 256);
-                    SecretKey tmp = factory.generateSecret(spec);
-                    secretKey = new SecretKeySpec(tmp.getEncoded(), "AES");
                 }
-                return new FlumePersistentManager(name, data.name, data.agents, data.batchSize, data.reconnectionDelay,
-                    database, secretKey);
             } catch (Exception ex) {
                 LOGGER.warn("Error setting up encryption - encryption will be disabled", ex);
-
             }
-            return null;
+            return new FlumePersistentManager(name, data.name, data.agents, data.batchSize, data.reconnectionDelay,
+                database, secretKey);
         }
     }
 
diff --git a/flume-ng/src/test/java/org/apache/logging/log4j/flume/test/FlumeKeyProvider.java b/flume-ng/src/test/java/org/apache/logging/log4j/flume/test/FlumeKeyProvider.java
new file mode 100644
index 0000000000..a0fc06c593
--- /dev/null
+++ b/flume-ng/src/test/java/org/apache/logging/log4j/flume/test/FlumeKeyProvider.java
@@ -0,0 +1,43 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements. See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache license, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License. You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the license for the specific language governing permissions and
+ * limitations under the license.
+ */
+package org.apache.logging.log4j.flume.test;
+
+import org.apache.logging.log4j.core.config.plugins.Plugin;
+import org.apache.logging.log4j.core.helpers.SecretKeyProvider;
+
+import javax.crypto.SecretKey;
+import javax.crypto.SecretKeyFactory;
+import javax.crypto.spec.PBEKeySpec;
+import javax.crypto.spec.SecretKeySpec;
+import java.io.FileOutputStream;
+import java.security.SecureRandom;
+import java.security.spec.KeySpec;
+import java.util.Random;
+
+/**
+ *
+ */
+@Plugin(name = "FlumeKeyProvider", type = "KeyProvider", elementType = "SecretKeyProvider", printObject = true)
+public class FlumeKeyProvider implements SecretKeyProvider {
+
+    private static final byte[] key = new byte[] {-7, -21, -118, -25, -79, 73, 72, -64, 0, 127, -93, -13, -38,
+        3, -73, -31, -2, -74, 3, 28, 113, -55, -105, 9, -103, 97, -5, -54, 88, -110, 97, -4};
+
+    public SecretKey getSecretKey() {
+        return new SecretKeySpec(key, "AES");
+    }
+}
diff --git a/flume-ng/src/test/resources/persistent.xml b/flume-ng/src/test/resources/persistent.xml
index d249395ac2..e2e2ddd299 100644
--- a/flume-ng/src/test/resources/persistent.xml
+++ b/flume-ng/src/test/resources/persistent.xml
@@ -1,11 +1,12 @@
 <?xml version="1.0" encoding="UTF-8"?>
-<configuration status="info" name="MyApp" packages="">
+<configuration status="info" name="MyApp" packages="org.apache.logging.log4j.flume.test">
   <appenders>
     <Flume name="eventLogger" suppressExceptions="false" compress="true" type="persistent" dataDir="target/persistent">
       <Agent host="localhost" port="${sys:primaryPort}"/>
       <Agent host="localhost" port="${sys:alternatePort}"/>
       <RFC5424Layout enterpriseNumber="18060" includeMDC="true" appName="MyApp"/>
-      <Property name="password">Test123!!</Property>
+      <!-- Uncomment to enable encryption
+      <Property name="keyProvider">FlumeKeyProvider</Property> -->
     </Flume>
     <Console name="STDOUT">
       <PatternLayout pattern="%d %t - [%p] %c %m%n"/>
diff --git a/src/site/xdoc/manual/appenders.xml b/src/site/xdoc/manual/appenders.xml
index 79fc366ccb..614637f5b9 100644
--- a/src/site/xdoc/manual/appenders.xml
+++ b/src/site/xdoc/manual/appenders.xml
@@ -484,8 +484,7 @@
                 elements will result in an error.</p>
                 <p>When used to configure in Persistent mode the valid properties are:
                   <ol>
-                  <li>"password" to specfify that
-                the data should be encrypted when written to disk.</li>
+                  <li>"keyProvider" to specify the name of the plugin to provide the secret key for encryption.</li>
                 </ol></p>
               </td>
             </tr>
@@ -542,7 +541,7 @@
       <Agent host="192.168.10.101" port="8800"/>
       <Agent host="192.168.10.102" port="8800"/>
       <RFC5424Layout enterpriseNumber="18060" includeMDC="true" appName="MyApp"/>
-      <Property name="password">Test123!!</Property>
+      <Property name="keyProvider">MySecretProvider</Property>
     </Flume>
   </appenders>
   <loggers>
diff --git a/src/site/xdoc/manual/plugins.xml b/src/site/xdoc/manual/plugins.xml
index 3b12449243..1e099c0d19 100644
--- a/src/site/xdoc/manual/plugins.xml
+++ b/src/site/xdoc/manual/plugins.xml
@@ -89,6 +89,13 @@
             RollingFileAppender to construct the name of the file to log to.
           </p>
         </subsection>
+        <a name="KeyProviders"/>
+        <subsection name="KeyProviders">
+          Some components within Log4j may provide the ability to perform data encryption. These components require
+          a secret key to perform the encryption. Applications may provide the key by creating a class that
+          implements the <a href="../log4j-core/apidocs/org/apache/logging/log4j/core/helpers/SecretKeyProvider.html">SecretKeyProvider</a>
+          interface.
+        </subsection>
         <a name="Lookups"/>
         <subsection name="Lookups">
           <p>
