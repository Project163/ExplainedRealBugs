diff --git a/log4j-core/src/main/java/org/apache/logging/log4j/core/appender/rolling/DirectWriteRolloverStrategy.java b/log4j-core/src/main/java/org/apache/logging/log4j/core/appender/rolling/DirectWriteRolloverStrategy.java
index ab13a333b9..3f8395375a 100644
--- a/log4j-core/src/main/java/org/apache/logging/log4j/core/appender/rolling/DirectWriteRolloverStrategy.java
+++ b/log4j-core/src/main/java/org/apache/logging/log4j/core/appender/rolling/DirectWriteRolloverStrategy.java
@@ -314,7 +314,8 @@ public class DirectWriteRolloverStrategy extends AbstractRolloverStrategy implem
     public String getCurrentFileName(final RollingFileManager manager) {
         if (currentFileName == null) {
             final SortedMap<Integer, Path> eligibleFiles = getEligibleFiles(manager);
-            final int fileIndex = eligibleFiles.size() > 0 ? (nextIndex > 0 ? nextIndex : eligibleFiles.size()) : 1;
+            final int fileIndex = eligibleFiles.size() > 0 ? (nextIndex > 0 ? nextIndex :
+                    eligibleFiles.lastKey()) : 1;
             final StringBuilder buf = new StringBuilder(255);
             manager.getPatternProcessor().formatFileName(strSubstitutor, buf, true, fileIndex);
             final int suffixLength = suffixLength(buf.toString());
diff --git a/log4j-core/src/test/java/org/apache/logging/log4j/core/appender/rolling/RollingDirectSize3490Test.java b/log4j-core/src/test/java/org/apache/logging/log4j/core/appender/rolling/RollingDirectSize3490Test.java
new file mode 100644
index 0000000000..86b4cd1ca4
--- /dev/null
+++ b/log4j-core/src/test/java/org/apache/logging/log4j/core/appender/rolling/RollingDirectSize3490Test.java
@@ -0,0 +1,100 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements. See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache license, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License. You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the license for the specific language governing permissions and
+ * limitations under the license.
+ */
+package org.apache.logging.log4j.core.appender.rolling;
+
+import java.io.File;
+import java.nio.file.Files;
+import java.nio.file.Path;
+import java.nio.file.StandardOpenOption;
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.List;
+import java.util.Objects;
+
+import org.apache.logging.log4j.Logger;
+import org.apache.logging.log4j.core.LoggerContext;
+import org.apache.logging.log4j.core.appender.RollingFileAppender;
+import org.apache.logging.log4j.core.config.Configurator;
+import org.junit.jupiter.api.BeforeAll;
+import org.junit.jupiter.api.Test;
+
+import static org.junit.jupiter.api.Assertions.assertTrue;
+
+
+/**
+ * This test attempts to validate that logging rolls after the max files are already written
+ * will succeed on a restart.
+ */
+public class RollingDirectSize3490Test implements RolloverListener {
+
+    private static final String CONFIG = "log4j-rolling-3490.xml";
+    private static final String[] set1 = {"This is file 1"};
+    private static final String LINE_2 = "This is file 2\n";
+
+    // Note that the path is hardcoded in the configuration!
+    private static final String DIR = "target/rolling-3490";
+
+    private boolean rolloverTriggered = false;
+
+    @BeforeAll
+    public static void clean() throws Exception {
+        File dir = new File(DIR);
+        if (dir.exists()) {
+            File[] files = dir.listFiles();
+            if (files != null) {
+                for (File file : files) {
+                    file.delete();
+                }
+            }
+            dir.delete();
+        }
+    }
+
+    @Test
+    public void rolloverTest() throws Exception {
+        File parent = new File(DIR);
+        parent.mkdirs();
+        Path app1 = new File(parent, "app-21.log").toPath();
+        Files.write(app1, Arrays.asList(set1), StandardOpenOption.CREATE_NEW);
+        List<String> lines = new ArrayList<>();
+        for (int count = 0; count < 1024; count += LINE_2.length()) {
+            lines.add(LINE_2);
+        }
+        File file2 = new File(parent, "app-22.log");
+        Path app2 = file2.toPath();
+        Files.write(app2, lines, StandardOpenOption.CREATE_NEW);
+        LoggerContext context = Configurator.initialize("TestConfig", this.getClass().getClassLoader(),
+                CONFIG);
+        RollingFileAppender app = context.getConfiguration().getAppender("RollingFile");
+        app.getManager().addRolloverListener(this);
+        Logger logger = context.getLogger("Test");
+        logger.info("Trigger rollover");
+        assertTrue(rolloverTriggered, "Rollover was not triggered");
+    }
+
+    @Override
+    public void rolloverTriggered(String fileName) {
+
+    }
+
+    @Override
+    public void rolloverComplete(String fileName) {
+        assertTrue(fileName.endsWith("app-22.log"), "File does not end with correct suffix");
+        rolloverTriggered = true;
+    }
+}
+
diff --git a/log4j-core/src/test/resources/log4j-rolling-3490.xml b/log4j-core/src/test/resources/log4j-rolling-3490.xml
new file mode 100644
index 0000000000..117274a138
--- /dev/null
+++ b/log4j-core/src/test/resources/log4j-rolling-3490.xml
@@ -0,0 +1,19 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<Configuration status="warn" name="MyApp" packages="">
+  <Appenders>
+    <RollingFile name="RollingFile" filePattern="target/rolling-3490/app-%i.log">
+      <PatternLayout>
+        <Pattern>%d %p %c{1.} [%t] %m%n</Pattern>
+      </PatternLayout>
+      <Policies>
+        <SizeBasedTriggeringPolicy size="1 kB" />
+      </Policies>
+      <DirectWriteRolloverStrategy maxFiles="2" />
+    </RollingFile>
+  </Appenders>
+  <Loggers>
+    <Root level="INFO">
+      <AppenderRef ref="RollingFile" />
+    </Root>
+  </Loggers>
+</Configuration>
\ No newline at end of file
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 05f2a42645..cedee6e839 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -29,7 +29,10 @@
          - "update" - Change
          - "remove" - Removed
     -->
-    <release version="2.18.0" date="2022-TBD" description="GA Release 2.18.0">
+    <release version="2.18.0" date="2022-MM-DD" description="GA Release 2.18.0">
+      <action issue="LOG4J2-3490" dev="rgoers" type="fix">
+        The DirectWriteRolloverStrategy was not detecting the correct index to use during startup.
+      </action>
       <action issue="LOG4J2-3516" dev="rgoers" type="update">
         Move perf tests to log4j-core-its
       </action>
