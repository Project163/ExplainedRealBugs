diff --git a/core/src/main/java/org/apache/logging/log4j/core/appender/SMTPAppender.java b/core/src/main/java/org/apache/logging/log4j/core/appender/SMTPAppender.java
index ffd38328c2..776334cfd1 100644
--- a/core/src/main/java/org/apache/logging/log4j/core/appender/SMTPAppender.java
+++ b/core/src/main/java/org/apache/logging/log4j/core/appender/SMTPAppender.java
@@ -146,8 +146,11 @@ public class SMTPAppender extends AbstractAppender {
      */
     @Override
     public boolean isFiltered(final LogEvent event) {
-        manager.add(event);
-        return super.isFiltered(event);
+        final boolean filtered = super.isFiltered(event);
+        if(filtered) {
+            manager.add(event);
+        }
+		return filtered;
     }
 
     /**
@@ -156,6 +159,6 @@ public class SMTPAppender extends AbstractAppender {
      * sent.
      */
     public void append(final LogEvent event) {
-        manager.sendEvents(getLayout());
+        manager.sendEvents(getLayout(), event);
     }
 }
\ No newline at end of file
diff --git a/core/src/main/java/org/apache/logging/log4j/core/net/SMTPManager.java b/core/src/main/java/org/apache/logging/log4j/core/net/SMTPManager.java
index 83097178fe..8f9ea12f1f 100644
--- a/core/src/main/java/org/apache/logging/log4j/core/net/SMTPManager.java
+++ b/core/src/main/java/org/apache/logging/log4j/core/net/SMTPManager.java
@@ -123,13 +123,15 @@ public class SMTPManager extends AbstractManager {
 
     /**
      * Send the contents of the cyclic buffer as an e-mail message.
+     * @param appendEvent 
      */
-    public void sendEvents(final Layout<?> layout) {
+    public void sendEvents(final Layout<?> layout, final LogEvent appendEvent) {
         if (message == null) {
             connect();
         }
         try {
-            final byte[] rawBytes = formatContentToBytes(buffer, layout);
+        	final LogEvent[] priorEvents = buffer.removeAll();
+            final byte[] rawBytes = formatContentToBytes(priorEvents, appendEvent, layout);
 
             final String contentType = layout.getContentType();
             final String encoding = getEncoding(rawBytes, contentType);
@@ -151,16 +153,16 @@ public class SMTPManager extends AbstractManager {
         }
     }
 
-    protected byte[] formatContentToBytes(final CyclicBuffer<LogEvent> cb, final Layout<?> layout) throws IOException {
+    protected byte[] formatContentToBytes(final LogEvent[] priorEvents, final LogEvent appendEvent, final Layout<?> layout) throws IOException {
         final ByteArrayOutputStream raw = new ByteArrayOutputStream();
-        writeContent(cb, layout, raw);
+        writeContent(priorEvents, appendEvent, layout, raw);
         return raw.toByteArray();
     }
 
-    private void writeContent(final CyclicBuffer<LogEvent> cb, final Layout<?> layout, final ByteArrayOutputStream out)
+    private void writeContent(final LogEvent[] priorEvents, final LogEvent appendEvent, final Layout<?> layout, final ByteArrayOutputStream out)
         throws IOException {
         writeHeader(layout, out);
-        writeBuffer(cb, layout, out);
+        writeBuffer(priorEvents, appendEvent, layout, out);
         writeFooter(layout, out);
     }
 
@@ -171,12 +173,14 @@ public class SMTPManager extends AbstractManager {
         }
     }
 
-    protected void writeBuffer(final CyclicBuffer<LogEvent> cb, final Layout<?> layout, final OutputStream out) throws IOException {
-        final LogEvent[] events = cb.removeAll();
-        for (final LogEvent event : events) {
-            final byte[] bytes = layout.toByteArray(event);
+    protected void writeBuffer(final LogEvent[] priorEvents, final LogEvent appendEvent, final Layout<?> layout, final OutputStream out) throws IOException {
+        for (final LogEvent priorEvent : priorEvents) {
+            final byte[] bytes = layout.toByteArray(priorEvent);
             out.write(bytes);
         }
+        
+        final byte[] bytes = layout.toByteArray(appendEvent);
+        out.write(bytes);
     }
 
     protected void writeFooter(final Layout<?> layout, final OutputStream out) throws IOException {
diff --git a/core/src/test/java/org/apache/logging/log4j/core/appender/SMTPAppenderTest.java b/core/src/test/java/org/apache/logging/log4j/core/appender/SMTPAppenderTest.java
index 70e588dbdc..3b5e8da161 100644
--- a/core/src/test/java/org/apache/logging/log4j/core/appender/SMTPAppenderTest.java
+++ b/core/src/test/java/org/apache/logging/log4j/core/appender/SMTPAppenderTest.java
@@ -144,6 +144,7 @@ public class SMTPAppenderTest {
         root.debug("Debug message #1");
         root.debug("Debug message #2");
         root.debug("Debug message #3");
+        root.debug("Debug message #4");
         root.error("Error with exception", new RuntimeException("Exception message"));
 
         server.stop();
@@ -162,6 +163,7 @@ public class SMTPAppenderTest {
         assertFalse(body.contains("Debug message #1"));
         assertTrue(body.contains("Debug message #2"));
         assertTrue(body.contains("Debug message #3"));
+        assertTrue(body.contains("Debug message #4"));
         assertTrue(body.contains("Error with exception"));
         assertTrue(body.contains("RuntimeException"));
         assertTrue(body.contains("Exception message"));
diff --git a/flume-ng/pom.xml b/flume-ng/pom.xml
index f52de69546..170dc77b47 100644
--- a/flume-ng/pom.xml
+++ b/flume-ng/pom.xml
@@ -32,7 +32,7 @@
     <log4jParentDir>${basedir}/..</log4jParentDir>
     <docLabel>Flume Documentation</docLabel>
     <projectDir>/flume-ng</projectDir>
-    <flumeVersion>1.2.0</flumeVersion>
+    <flumeVersion>1.3.1</flumeVersion>
   </properties>
   <dependencies>
     <dependency>
diff --git a/samples/flume-common/src/main/java/org/apache/logging/log4j/samples/app/LoggingApp.java b/samples/flume-common/src/main/java/org/apache/logging/log4j/samples/app/LoggingApp.java
new file mode 100755
index 0000000000..5c3ccd3c15
--- /dev/null
+++ b/samples/flume-common/src/main/java/org/apache/logging/log4j/samples/app/LoggingApp.java
@@ -0,0 +1,142 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements. See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache license, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License. You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the license for the specific language governing permissions and
+ * limitations under the license.
+ */
+package org.apache.logging.log4j.samples.app;
+
+import org.apache.logging.log4j.LogManager;
+import org.apache.logging.log4j.Logger;
+import org.apache.logging.log4j.ThreadContext;
+import org.apache.logging.log4j.samples.dto.AuditEvent;
+import org.apache.logging.log4j.samples.dto.RequestContext;
+
+import java.util.List;
+import java.util.Random;
+
+
+/**
+ * The Class LoggingApp.
+ */
+public class LoggingApp {
+
+    /**
+     * The logger.
+     */
+    private static Logger logger = LogManager.getLogger(LoggingApp.class);
+
+    private Random ran = new Random();
+
+    private List<AuditEvent> events;
+
+    public static void main(String[] args) {
+        String member = "fakemember";
+        if (args.length == 1) {
+            member = args[0];
+        }
+        LoggingApp app = new LoggingApp(member);
+        app.runApp(member);
+        System.out.println("Job ended");
+    }
+
+    public LoggingApp(String member) {
+
+        ThreadContext.clear();
+
+        RequestContext.setSessionId("session1234");
+        RequestContext.setIpAddress("127.0.0.1");
+        RequestContext.setClientId("02121");
+        RequestContext.setProductName("IB");
+        RequestContext.setProductVersion("4.18.1");
+        RequestContext.setLocale("en_US");
+        RequestContext.setRegion("prod");
+
+        if (events == null) {
+            events = MockEventsSupplier.getAllEvents(member);
+        }
+    }
+
+    public void runApp(String member) {
+        Worker worker = new Worker(member);
+        worker.start();
+        sleep(30000);
+        worker.shutdown();
+        sleep(5000);
+    }
+
+    private void sleep(long millis) {
+        try {
+            Thread.sleep(millis);
+        } catch (InterruptedException ie) {
+            //
+        }
+    }
+
+
+    public class Worker extends Thread {
+
+        private final String member;
+
+        private boolean shutdown = false;
+
+        public Worker(String member) {
+            this.member = member;
+        }
+
+        public void run() {
+            System.out.println("STARTING..................");
+
+            while (!shutdown) {
+                // Generate rand number between 1 to 10
+                int rand = ran.nextInt(9) + 1;
+
+                // Sleep for rand seconds
+                try {
+                    Thread.sleep(rand * 1000);
+                } catch (InterruptedException e) {
+                    logger.warn("WARN", e);
+                }
+
+                // Write rand number of logs
+                for (int i = 0; i < rand; i++) {
+                    int eventIndex = (Math.abs(ran.nextInt())) % events.size();
+                    AuditEvent event = events.get(eventIndex);
+                    RequestContext.setUserId(member);
+                    event.logEvent();
+
+                    if ((rand % 4) == 1) {
+                        logger.debug("DEBUG level logging.....");
+                    } else if ((rand % 4) == 2) {
+                        logger.info("INFO level logging.....");
+                    } else if ((rand % 4) == 3) {
+                        logger.warn("WARN level logging.....");
+                    } else {
+                        logger.error("ERROR level logging.....");
+                    }
+                }
+
+            }
+        }
+
+        public void shutdown() {
+            this.shutdown = true;
+            try {
+                this.join();
+            } catch (InterruptedException ie) {
+                //
+            }
+            System.out.println("SHUTDOWN.......................");
+        }
+    }
+}
diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 343d25c44b..87e65203dc 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -23,6 +23,9 @@
 
   <body>
     <release version="2.0-beta4" date="TBD" description="Bug fixes and enhancements">
+      <action issue="LOG4J2-149" dev="rgoers" type="fix">
+        SMTPAppender will only cache filtered events.
+      </action>
       <action issue="LOG4J2-145" dev="ggregory" type="fix">
         Add missing serial version IDs.
       </action>
