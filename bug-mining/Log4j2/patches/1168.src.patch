diff --git a/log4j-api-java9/src/main/java/org/apache/logging/log4j/util/internal/DefaultObjectInputFilter.java b/log4j-api-java9/src/main/java/org/apache/logging/log4j/util/internal/DefaultObjectInputFilter.java
new file mode 100644
index 0000000000..6e7cee5278
--- /dev/null
+++ b/log4j-api-java9/src/main/java/org/apache/logging/log4j/util/internal/DefaultObjectInputFilter.java
@@ -0,0 +1,100 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements. See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache license, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License. You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the license for the specific language governing permissions and
+ * limitations under the license.
+ */
+package org.apache.logging.log4j.util.internal;
+
+import java.io.ObjectInputFilter;
+import java.util.Arrays;
+import java.util.List;
+
+public class DefaultObjectInputFilter implements ObjectInputFilter {
+
+
+    private static final List<String> REQUIRED_JAVA_CLASSES = Arrays.asList(
+            "java.math.BigDecimal",
+            "java.math.BigInteger",
+            // for Message delegate
+            "java.rmi.MarshalledObject",
+            "[B"
+    );
+
+    private static final List<String> REQUIRED_JAVA_PACKAGES = Arrays.asList(
+            "java.lang.",
+            "java.time",
+            "java.util.",
+            "org.apache.logging.log4j.",
+            "[Lorg.apache.logging.log4j."
+    );
+
+    private final ObjectInputFilter delegate;
+
+    public DefaultObjectInputFilter() {
+        delegate = null;
+    }
+
+    public DefaultObjectInputFilter(ObjectInputFilter filter) {
+        delegate = filter;
+    }
+
+    /**
+     * This is easier to use via reflection.
+     * @param filter The ObjectInputFilter.
+     * @return The DefaultObjectInputFilter.
+     */
+    public static DefaultObjectInputFilter newInstance(ObjectInputFilter filter) {
+        return new DefaultObjectInputFilter(filter);
+    }
+
+
+    @Override
+    public Status checkInput(FilterInfo filterInfo) {
+        Status status = null;
+        if (delegate != null) {
+            status = delegate.checkInput(filterInfo);
+            if (status != Status.UNDECIDED) {
+                return status;
+            }
+        }
+        ObjectInputFilter serialFilter = ObjectInputFilter.Config.getSerialFilter();
+        if (serialFilter != null) {
+            status = serialFilter.checkInput(filterInfo);
+            if (status != Status.UNDECIDED) {
+                // The process-wide filter overrides this filter
+                return status;
+            }
+        }
+        if (filterInfo.serialClass() != null) {
+            String name = filterInfo.serialClass().getName();
+            if (isAllowedByDefault(name) || isRequiredPackage(name)) {
+                return Status.ALLOWED;
+            }
+        }
+        return Status.REJECTED;
+    }
+
+    private static boolean isAllowedByDefault(final String name) {
+        return isRequiredPackage(name) || REQUIRED_JAVA_CLASSES.contains(name);
+    }
+
+    private static boolean isRequiredPackage(final String name) {
+        for (final String packageName : REQUIRED_JAVA_PACKAGES) {
+            if (name.startsWith(packageName)) {
+                return true;
+            }
+        }
+        return false;
+    }
+}
diff --git a/log4j-api/src/main/java/org/apache/logging/log4j/util/SortedArrayStringMap.java b/log4j-api/src/main/java/org/apache/logging/log4j/util/SortedArrayStringMap.java
index c95aaabadf..d6dae4560d 100644
--- a/log4j-api/src/main/java/org/apache/logging/log4j/util/SortedArrayStringMap.java
+++ b/log4j-api/src/main/java/org/apache/logging/log4j/util/SortedArrayStringMap.java
@@ -27,6 +27,7 @@ import java.io.StreamCorruptedException;
 import java.io.WriteAbortedException;
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
+import java.lang.reflect.Modifier;
 import java.util.Arrays;
 import java.util.Collection;
 import java.util.ConcurrentModificationException;
@@ -91,6 +92,7 @@ public class SortedArrayStringMap implements IndexedStringMap {
 
     private static final Method setObjectInputFilter;
     private static final Method getObjectInputFilter;
+    private static final Method newObjectInputFilter;
 
     static {
         Method[] methods = ObjectInputStream.class.getMethods();
@@ -103,6 +105,22 @@ public class SortedArrayStringMap implements IndexedStringMap {
                 getMethod = method;
             }
         }
+        Method newMethod = null;
+        try {
+            if (setMethod != null) {
+                Class clazz = Class.forName("org.apache.logging.log4j.util.internal.DefaultObjectInputFilter");
+                methods = clazz.getMethods();
+                for (Method method : methods) {
+                    if (method.getName().equals("newInstance") && Modifier.isStatic(method.getModifiers())) {
+                        newMethod = method;
+                        break;
+                    }
+                }
+            }
+        } catch (ClassNotFoundException ex) {
+            // Ignore the exception
+        }
+        newObjectInputFilter = newMethod;
         setObjectInputFilter = setMethod;
         getObjectInputFilter = getMethod;
     }
@@ -544,11 +562,9 @@ public class SortedArrayStringMap implements IndexedStringMap {
         } else {
             try {
                 Object obj = getObjectInputFilter.invoke(inputStream);
-                if (obj == null) {
-                    throw new StreamCorruptedException("An ObjectInputFilter must be provided");
-                }
+                Object filter = newObjectInputFilter.invoke(null, obj);
                 ois = new ObjectInputStream(bin);
-                setObjectInputFilter.invoke(ois, obj);
+                setObjectInputFilter.invoke(ois, filter);
             } catch (IllegalAccessException | InvocationTargetException ex) {
                 throw new StreamCorruptedException("Unable to set ObjectInputFilter on stream");
             }
@@ -578,7 +594,7 @@ public class SortedArrayStringMap implements IndexedStringMap {
      * deserialize it).
      */
     private void readObject(final java.io.ObjectInputStream s)  throws IOException, ClassNotFoundException {
-        if (!(s instanceof FilteredObjectInputStream) || setObjectInputFilter != null) {
+        if (!(s instanceof FilteredObjectInputStream) && setObjectInputFilter == null) {
             throw new IllegalArgumentException("readObject requires a FilteredObjectInputStream or an ObjectInputStream that accepts an ObjectInputFilter");
         }
         // Read in the threshold (ignored), and any hidden stuff
diff --git a/log4j-core/src/test/java/org/apache/logging/log4j/core/impl/MutableLogEventTest.java b/log4j-core/src/test/java/org/apache/logging/log4j/core/impl/MutableLogEventTest.java
index 5af5838acf..1e4c8ccdf4 100644
--- a/log4j-core/src/test/java/org/apache/logging/log4j/core/impl/MutableLogEventTest.java
+++ b/log4j-core/src/test/java/org/apache/logging/log4j/core/impl/MutableLogEventTest.java
@@ -35,6 +35,7 @@ import org.apache.logging.log4j.util.SortedArrayStringMap;
 import org.apache.logging.log4j.util.StringMap;
 import org.apache.logging.log4j.spi.MutableThreadContextStack;
 import org.junit.Assert;
+import org.junit.BeforeClass;
 import org.junit.Test;
 
 import static org.junit.Assert.*;
@@ -46,6 +47,8 @@ public class MutableLogEventTest {
     private static final StringMap CONTEXT_DATA = createContextData();
     private static final ThreadContext.ContextStack STACK = new MutableThreadContextStack(Arrays.asList("abc", "xyz"));
 
+    static boolean useObjectInputStream = false;
+
     private static StringMap createContextData() {
         final StringMap result = new SortedArrayStringMap();
         result.putValue("a", "1");
@@ -53,6 +56,16 @@ public class MutableLogEventTest {
         return result;
     }
 
+    @BeforeClass
+    public static void setupClass() {
+        try {
+            Class.forName("java.io.ObjectInputFilter");
+            useObjectInputStream = true;
+        } catch (ClassNotFoundException ex) {
+            // Ignore the exception
+        }
+    }
+
     @Test
     public void testToImmutable() {
         final LogEvent logEvent = new MutableLogEvent();
@@ -279,7 +292,8 @@ public class MutableLogEventTest {
 
     private Log4jLogEvent deserialize(final byte[] binary) throws IOException, ClassNotFoundException {
         final ByteArrayInputStream inArr = new ByteArrayInputStream(binary);
-        final ObjectInputStream in = new FilteredObjectInputStream(inArr);
+        final ObjectInputStream in = useObjectInputStream ? new ObjectInputStream(inArr) :
+                new FilteredObjectInputStream(inArr);
         final Log4jLogEvent result = (Log4jLogEvent) in.readObject();
         return result;
     }
diff --git a/log4j-core/src/test/java/org/apache/logging/log4j/core/layout/SerializedLayoutTest.java b/log4j-core/src/test/java/org/apache/logging/log4j/core/layout/SerializedLayoutTest.java
index b7d590cb36..c01c82e295 100644
--- a/log4j-core/src/test/java/org/apache/logging/log4j/core/layout/SerializedLayoutTest.java
+++ b/log4j-core/src/test/java/org/apache/logging/log4j/core/layout/SerializedLayoutTest.java
@@ -56,11 +56,19 @@ public class SerializedLayoutTest {
 
     static ConfigurationFactory cf = new BasicConfigurationFactory();
 
+    static boolean useObjectInputStream = false;
+
     @Rule
     public final ThreadContextRule threadContextRule = new ThreadContextRule(); 
 
     @BeforeClass
     public static void setupClass() {
+        try {
+            Class.forName("java.io.ObjectInputFilter");
+            useObjectInputStream = true;
+        } catch (ClassNotFoundException ex) {
+            // Ignore the exception
+        }
         ConfigurationFactory.setConfigurationFactory(cf);
         final LoggerContext ctx = LoggerContext.getContext();
         ctx.reconfigure();
@@ -128,7 +136,8 @@ public class SerializedLayoutTest {
         int i = 0;
         for (final byte[] item : data) {
             final ByteArrayInputStream bais = new ByteArrayInputStream(item);
-            final ObjectInputStream ois = new FilteredObjectInputStream(bais);
+            final ObjectInputStream ois = useObjectInputStream ? new ObjectInputStream(bais) :
+                    new FilteredObjectInputStream(bais);
             LogEvent event;
             try {
                 event = (LogEvent) ois.readObject();
@@ -168,9 +177,13 @@ public class SerializedLayoutTest {
         testSerialization();
         final File file = new File(DAT_PATH);
         final FileInputStream fis = new FileInputStream(file);
-        try (final ObjectInputStream ois = new FilteredObjectInputStream(fis) ) {
+        final ObjectInputStream ois = useObjectInputStream ? new ObjectInputStream(fis) :
+                new FilteredObjectInputStream(fis);
+        try {
             final LogEvent event = (LogEvent) ois.readObject();
             assertNotNull(event);
+        } finally {
+            ois.close();
         }
     }
 }
