diff --git a/log4j-core/src/test/java/org/apache/logging/log4j/core/appender/SmtpAppenderAsyncTest.java b/log4j-core/src/test/java/org/apache/logging/log4j/core/appender/SmtpAppenderAsyncTest.java
new file mode 100644
index 0000000000..91503d3b0a
--- /dev/null
+++ b/log4j-core/src/test/java/org/apache/logging/log4j/core/appender/SmtpAppenderAsyncTest.java
@@ -0,0 +1,98 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements. See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache license, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License. You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the license for the specific language governing permissions and
+ * limitations under the license.
+ */
+package org.apache.logging.log4j.core.appender;
+
+import org.apache.logging.dumbster.smtp.SimpleSmtpServer;
+import org.apache.logging.dumbster.smtp.SmtpMessage;
+import org.apache.logging.log4j.ThreadContext;
+import org.apache.logging.log4j.core.Logger;
+import org.apache.logging.log4j.junit.LoggerContextRule;
+import org.apache.logging.log4j.test.AvailablePortFinder;
+import org.junit.After;
+import org.junit.AfterClass;
+import org.junit.Before;
+import org.junit.BeforeClass;
+import org.junit.Rule;
+import org.junit.Test;
+
+import java.util.Iterator;
+
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.fail;
+
+public class SmtpAppenderAsyncTest {
+
+    private static int PORT;
+
+    private SimpleSmtpServer smtpServer;
+
+    @BeforeClass
+    public static void setupClass() {
+        PORT = AvailablePortFinder.getNextAvailable();
+        System.setProperty("smtp.port", String.valueOf(PORT));
+    }
+
+    @Before
+    public void setup() {
+        smtpServer = SimpleSmtpServer.start(PORT);
+    }
+
+    @Rule
+    public LoggerContextRule ctx = new LoggerContextRule("SmtpAppenderAsyncTest.xml");
+
+    @Test
+    public void testSync() {
+        testSmtpAppender(ctx.getLogger("sync"));
+    }
+
+    @Test
+    public void testAsync() {
+        testSmtpAppender(ctx.getLogger("async"));
+    }
+
+    private void testSmtpAppender(Logger logger) {
+        ThreadContext.put("MDC1", "mdc1");
+        logger.error("the message");
+        ctx.getLoggerContext().stop();
+        smtpServer.stop();
+
+        assertEquals(1, smtpServer.getReceivedEmailSize());
+        final Iterator<SmtpMessage> messages = smtpServer.getReceivedEmail();
+        final SmtpMessage email = messages.next();
+
+        assertEquals("to@example.com", email.getHeaderValue("To"));
+        assertEquals("from@example.com", email.getHeaderValue("From"));
+        assertEquals("[mdc1]", email.getHeaderValue("Subject"));
+
+        String body = email.getBody();
+        if (!body.contains("Body:[mdc1]")) {
+            fail(body);
+        }
+    }
+
+    @After
+    public void teardown() {
+        if (smtpServer != null) {
+            smtpServer.stop();
+        }
+    }
+
+    @AfterClass
+    public static void teardownClass() {
+        System.clearProperty("smtp.port");
+    }
+}
\ No newline at end of file
diff --git a/log4j-core/src/test/resources/SmtpAppenderAsyncTest.xml b/log4j-core/src/test/resources/SmtpAppenderAsyncTest.xml
new file mode 100644
index 0000000000..1939ddd2e9
--- /dev/null
+++ b/log4j-core/src/test/resources/SmtpAppenderAsyncTest.xml
@@ -0,0 +1,42 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!--
+  ~ Licensed to the Apache Software Foundation (ASF) under one or more
+  ~ contributor license agreements. See the NOTICE file distributed with
+  ~ this work for additional information regarding copyright ownership.
+  ~ The ASF licenses this file to You under the Apache license, Version 2.0
+  ~ (the "License"); you may not use this file except in compliance with
+  ~ the License. You may obtain a copy of the License at
+  ~
+  ~      http://www.apache.org/licenses/LICENSE-2.0
+  ~
+  ~ Unless required by applicable law or agreed to in writing, software
+  ~ distributed under the License is distributed on an "AS IS" BASIS,
+  ~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+  ~ See the license for the specific language governing permissions and
+  ~ limitations under the license.
+  -->
+<Configuration name="SmtpAppenderAsyncTest" status="WARN">
+    <Appenders>
+        <SMTP name="mail-sync" to="to@example.com" from="from@example.com" smtpHost="localhost"
+              smtpPort="${sys:smtp.port}" ignoreExceptions="false" subject="[%X{MDC1}]">
+            <PatternLayout pattern="Body:[%X{MDC1}]" />
+        </SMTP>
+        <Async name="mail-async">
+            <AppenderRef ref="mail-sync"/>
+        </Async>
+        <Console name="Console" target="SYSTEM_OUT">
+            <PatternLayout pattern="%d [%t] %-5level: %msg%n%throwable" />
+        </Console>
+    </Appenders>
+    <Loggers>
+        <Root level="FATAL">
+          <AppenderRef ref="Console"/>
+        </Root>
+        <Logger name="sync" level="INFO">
+            <AppenderRef ref="mail-sync"/>
+        </Logger>
+        <Logger name="async" level="INFO">
+            <AppenderRef ref="mail-async"/>
+        </Logger>
+    </Loggers>
+</Configuration>
