diff --git a/storm-client/pom.xml b/storm-client/pom.xml
index 7c28cce88..c925ffd86 100644
--- a/storm-client/pom.xml
+++ b/storm-client/pom.xml
@@ -97,6 +97,12 @@
 
         <!-- end of transitive dependency management -->
 
+        <dependency>
+            <groupId>com.google.guava</groupId>
+            <artifactId>guava</artifactId>
+            <version>${guava.version}</version>
+        </dependency>
+
         <!-- test -->
         <dependency>
             <groupId>org.mockito</groupId>
diff --git a/storm-client/src/jvm/org/apache/storm/daemon/worker/Worker.java b/storm-client/src/jvm/org/apache/storm/daemon/worker/Worker.java
index c0dfc0aa0..9f8428b17 100644
--- a/storm-client/src/jvm/org/apache/storm/daemon/worker/Worker.java
+++ b/storm-client/src/jvm/org/apache/storm/daemon/worker/Worker.java
@@ -278,8 +278,8 @@ public class Worker implements Shutdownable, DaemonCommon {
         setupFlushTupleTimer(topologyConf, newExecutors);
         setupBackPressureCheckTimer(topologyConf);
 
-        LOG.info("Worker has topology config {}", ConfigUtils.maskPasswords(Utils.redactValue(topologyConf,
-                Config.STORM_ZOOKEEPER_TOPOLOGY_AUTH_PAYLOAD)));
+        LOG.info("Worker has topology config {}", Utils.redactValue(ConfigUtils.maskPasswords(topologyConf),
+                Config.STORM_ZOOKEEPER_TOPOLOGY_AUTH_PAYLOAD));
         LOG.info("Worker {} for storm {} on {}:{}  has finished loading", workerId, topologyId, assignmentId, port);
         return this;
     }
diff --git a/storm-client/src/jvm/org/apache/storm/utils/ConfigUtils.java b/storm-client/src/jvm/org/apache/storm/utils/ConfigUtils.java
index 064365d3d..5fefceac7 100644
--- a/storm-client/src/jvm/org/apache/storm/utils/ConfigUtils.java
+++ b/storm-client/src/jvm/org/apache/storm/utils/ConfigUtils.java
@@ -26,9 +26,9 @@ import java.util.Map;
 import java.util.Random;
 import java.util.Set;
 import java.util.function.BooleanSupplier;
-import java.util.function.Supplier;
 import java.util.stream.Collectors;
 
+import com.google.common.collect.Maps;
 import org.apache.storm.Config;
 import org.apache.storm.daemon.supervisor.AdvancedFSOps;
 import org.apache.storm.generated.StormTopology;
@@ -79,34 +79,14 @@ public class ConfigUtils {
         return oldInstance;
     }
 
-    private static class MaskedConf implements Supplier<Map<String, Object>> {
-        private final Map<String, Object> conf;
-
-        MaskedConf(Map<String, Object> conf) {
-            this.conf = conf;
-        }
-
-        @Override
-        public Map<String, Object> get() {
-            Map<String, Object> res = new HashMap<>();
-            for (Map.Entry<String, Object> e : conf.entrySet()) {
-                if (passwordConfigKeys.contains(e.getKey())) {
-                    res.put(e.getKey(), "*****");
-                } else {
-                    res.put(e.getKey(), e.getValue());
-                }
-            }
-            return res;
-        }
-
-        @Override
-        public String toString() {
-            return get().toString();
-        }
-    }
-
-    public static Supplier<Map<String, Object>> maskPasswords(Map<String, Object> conf) {
-        return new MaskedConf(conf);
+    public static Map<String, Object> maskPasswords(final Map<String, Object> conf) {
+        Maps.EntryTransformer<String, Object, Object> maskPasswords =
+                new Maps.EntryTransformer<String, Object, Object>() {
+                    public Object transformEntry(String key, Object value) {
+                        return passwordConfigKeys.contains(key) ? "*****" : value;
+                    }
+                };
+        return Maps.transformEntries(conf, maskPasswords);
     }
 
     public static boolean isLocalMode(Map<String, Object> conf) {
