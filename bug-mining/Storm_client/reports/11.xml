<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:46:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[STORM-2489] Overlap and data loss on WindowedBolt based on Duration</title>
                <link>https://issues.apache.org/jira/browse/STORM-2489</link>
                <project id="12314820" key="STORM">Apache Storm</project>
                    <description>&lt;p&gt;The attachment is my test script, one of my test results is:&lt;br/&gt;
```&lt;br/&gt;
expired=1...55&lt;br/&gt;
get=56...4024&lt;br/&gt;
new=56...4024&lt;br/&gt;
Recived=3969,RecivedTotal=3969&lt;br/&gt;
expired=56...4020&lt;br/&gt;
get=4021...8191&lt;br/&gt;
new=4025...8191&lt;br/&gt;
Recived=4171,RecivedTotal=8140&lt;br/&gt;
SendTotal=12175&lt;br/&gt;
expired=4021...8188&lt;br/&gt;
get=8189...12175&lt;br/&gt;
new=8192...12175&lt;br/&gt;
Recived=3987,RecivedTotal=12127&lt;br/&gt;
```&lt;br/&gt;
This test result shows that some tuples appear in the expired list directly, we lost these data if we just use get() to get tuples, this is the first bug.&lt;br/&gt;
The second: the tuples of get() has overlap, the getNew() seems alright.&lt;/p&gt;

&lt;p&gt;The problem not happen definitely, may need to try several times.&lt;/p&gt;

&lt;p&gt;Actually, I&apos;m newbie about storm, so I&apos;m not sure this is a bug indeed, or, I use it in wrong way?&lt;/p&gt;</description>
                <environment>windows 10, eclipse, jdk1.7</environment>
        <key id="13066226">STORM-2489</key>
            <summary>Overlap and data loss on WindowedBolt based on Duration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="arunmahadevan">Arun Mahadevan</assignee>
                                    <reporter username="wangkui">wangkui</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Apr 2017 03:19:48 +0000</created>
                <updated>Sun, 26 Jan 2025 09:23:29 +0000</updated>
                            <resolved>Tue, 30 May 2017 10:20:43 +0000</resolved>
                                    <version>1.0.2</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.1.1</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>storm-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="10800">3h</timespent>
                                <comments>
                            <comment id="15980736" author="arunmahadevan" created="Mon, 24 Apr 2017 05:20:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wangkui&quot; class=&quot;user-hover&quot; rel=&quot;wangkui&quot;&gt;wangkui&lt;/a&gt; thanks for reporting the issue. Processing-time based windows internally uses a ScheduledExecutor. It maybe that the tasks are not triggered exactly after the tumbling window interval causing some overlap. To debug further, can you also print the window end timestamp (&lt;a href=&quot;https://github.com/apache/storm/blob/master/storm-client/src/jvm/org/apache/storm/windowing/Window.java#L55&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/storm/blob/master/storm-client/src/jvm/org/apache/storm/windowing/Window.java#L55&lt;/a&gt;) each time the execute is invoked? &quot;getEndTimestamp&quot; returns the reference processing time which is used to calculate the window boundaries.&lt;/p&gt;

&lt;p&gt;You will need build storm from the latest master and run your examples against that since &quot;getEndTimestamp&quot; is not available in any of the released versions of storm.&lt;/p&gt;</comment>
                            <comment id="15982316" author="wangkui" created="Tue, 25 Apr 2017 03:26:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arunmahadevan&quot; class=&quot;user-hover&quot; rel=&quot;arunmahadevan&quot;&gt;arunmahadevan&lt;/a&gt; Sorry for late response, call on getStartTimestamp() and getEndTimestamp(), I got following log:&lt;br/&gt;
Timestamp_start-end=1493089795102-1493089800102&lt;br/&gt;
expired=1...56&lt;br/&gt;
get=57...4085&lt;br/&gt;
new=57...4085&lt;br/&gt;
Recived=4029,RecivedTotal=4029&lt;br/&gt;
Timestamp_start-end=1493089800101-1493089805101&lt;br/&gt;
expired=57...4084&lt;br/&gt;
get=4085...8049&lt;br/&gt;
new=4086...8049&lt;br/&gt;
Recived=3965,RecivedTotal=7994&lt;br/&gt;
SendTotal=11705&lt;br/&gt;
Timestamp_start-end=1493089805102-1493089810102&lt;br/&gt;
expired=4085...8047&lt;br/&gt;
get=8048...11705&lt;br/&gt;
new=8050...11705&lt;br/&gt;
Recived=3658,RecivedTotal=11652&lt;/p&gt;</comment>
                            <comment id="15982487" author="arunmahadevan" created="Tue, 25 Apr 2017 07:20:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wangkui&quot; class=&quot;user-hover&quot; rel=&quot;wangkui&quot;&gt;wangkui&lt;/a&gt;, posted a potential fix - &lt;a href=&quot;https://github.com/apache/storm/pull/2090&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/storm/pull/2090&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You might want to try your tests with the patch (you can apply the patch or clone &lt;a href=&quot;https://github.com/arunmahadevan/storm/tree/STORM-2489&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/arunmahadevan/storm/tree/STORM-2489&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="15984353" author="wangkui" created="Wed, 26 Apr 2017 08:16:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arunmahadevan&quot; class=&quot;user-hover&quot; rel=&quot;arunmahadevan&quot;&gt;arunmahadevan&lt;/a&gt; I tested several times with your patch, now it seems all right, no tuples overlap. Thank you!&lt;/p&gt;</comment>
                            <comment id="15984368" author="wangkui" created="Wed, 26 Apr 2017 08:38:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arunmahadevan&quot; class=&quot;user-hover&quot; rel=&quot;arunmahadevan&quot;&gt;arunmahadevan&lt;/a&gt; Eh, it still lose data, following is one test result, and you can see that the 15073 is lost:&lt;br/&gt;
Timestamp_start-end=1493195565070-1493195570070&lt;br/&gt;
expired=&lt;br/&gt;
get=1...3757&lt;br/&gt;
new=1...3757&lt;br/&gt;
Recived=3757,RecivedTotal=3757&lt;br/&gt;
Timestamp_start-end=1493195570070-1493195575070&lt;br/&gt;
expired=1...3757&lt;br/&gt;
get=3758...7579&lt;br/&gt;
new=3758...7579&lt;br/&gt;
Recived=3822,RecivedTotal=7579&lt;br/&gt;
Timestamp_start-end=1493195575070-1493195580070&lt;br/&gt;
expired=3758...7579&lt;br/&gt;
get=7580...11276&lt;br/&gt;
new=7580...11276&lt;br/&gt;
Recived=3697,RecivedTotal=11276&lt;br/&gt;
Timestamp_start-end=1493195580070-1493195585070&lt;br/&gt;
expired=7580...11276&lt;br/&gt;
get=11277...15072&lt;br/&gt;
new=11277...15072&lt;br/&gt;
Recived=3796,RecivedTotal=15072&lt;br/&gt;
SendTotal=15162&lt;br/&gt;
Timestamp_start-end=1493195585070-1493195590070&lt;br/&gt;
expired=11277...15073&lt;br/&gt;
get=15074...15162&lt;br/&gt;
new=15074...15162&lt;br/&gt;
Recived=89,RecivedTotal=15161&lt;/p&gt;</comment>
                            <comment id="15984369" author="arunmahadevan" created="Wed, 26 Apr 2017 08:38:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wangkui&quot; class=&quot;user-hover&quot; rel=&quot;wangkui&quot;&gt;wangkui&lt;/a&gt; thanks for the update. I made some minor changes to the patch today. If you could pull the latest changes and run your tests a few times will be great. &lt;/p&gt;</comment>
                            <comment id="15984426" author="arunmahadevan" created="Wed, 26 Apr 2017 09:18:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wangkui&quot; class=&quot;user-hover&quot; rel=&quot;wangkui&quot;&gt;wangkui&lt;/a&gt;, I made some minor tweak to process the tuples with some time offset, please pull the current changes and test.&lt;/p&gt;</comment>
                            <comment id="15984429" author="wangkui" created="Wed, 26 Apr 2017 09:18:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arunmahadevan&quot; class=&quot;user-hover&quot; rel=&quot;arunmahadevan&quot;&gt;arunmahadevan&lt;/a&gt; I pull and test again, yes, no tuple lost now. Thanks.&lt;/p&gt;</comment>
                            <comment id="15984624" author="arunmahadevan" created="Wed, 26 Apr 2017 11:36:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wangkui&quot; class=&quot;user-hover&quot; rel=&quot;wangkui&quot;&gt;wangkui&lt;/a&gt;, when you get some time can you pull the updated changes and test again ? The earlier approach might have issues if the clock continuously drifts and lead to lost and overlapping tuples. I made some changes to address it.&lt;/p&gt;</comment>
                            <comment id="15986049" author="wangkui" created="Thu, 27 Apr 2017 05:41:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arunmahadevan&quot; class=&quot;user-hover&quot; rel=&quot;arunmahadevan&quot;&gt;arunmahadevan&lt;/a&gt; I test again, as the same arguments as before, it seems all right. But when I make the spout emit more frequently, the ahead tuples are expired, following test I spout data with out sleep() and use Duration(4sec) window bolt, &lt;br/&gt;
Timestamp_start-end=1493271145887-1493271149887&lt;br/&gt;
expired=1...291972&lt;br/&gt;
get=291973...1189440&lt;br/&gt;
new=291973...1189440&lt;br/&gt;
Recived=897468,RecivedTotal=897468&lt;br/&gt;
13:32:34.470 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-45-thread-1&amp;#93;&lt;/span&gt; WARN  o.a.s.w.TimeEvictionPolicy - Possible clock drift or long running computation in window; Previous eviction time: 1493271149887, current eviction time: 1493271154469&lt;br/&gt;
Timestamp_start-end=1493271150469-1493271154469&lt;br/&gt;
expired=291973...1189440&lt;br/&gt;
get=1189441...2888803&lt;br/&gt;
new=1189441...2888803&lt;br/&gt;
Recived=1699363,RecivedTotal=2596831&lt;br/&gt;
13:32:39.213 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-45-thread-1&amp;#93;&lt;/span&gt; WARN  o.a.s.w.TimeEvictionPolicy - Possible clock drift or long running computation in window; Previous eviction time: 1493271154469, current eviction time: 1493271159212&lt;br/&gt;
SendTotal=5435440&lt;br/&gt;
Timestamp_start-end=1493271155212-1493271159212&lt;br/&gt;
expired=1189441...2888803&lt;br/&gt;
get=2888804...5069647&lt;br/&gt;
new=2888804...5069647&lt;br/&gt;
Recived=2180844,RecivedTotal=4777675&lt;br/&gt;
13:32:42.311 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-45-thread-1&amp;#93;&lt;/span&gt; WARN  o.a.s.w.TimeEvictionPolicy - Possible clock drift or long running computation in window; Previous eviction time: 1493271159212, current eviction time: 1493271162310&lt;br/&gt;
Timestamp_start-end=1493271158310-1493271162310&lt;br/&gt;
expired=2888804...5069647&lt;br/&gt;
get=5069648...5435440&lt;br/&gt;
new=5069648...5435440&lt;br/&gt;
Recived=365793,RecivedTotal=5143468&lt;br/&gt;
13:32:45.195 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-45-thread-1&amp;#93;&lt;/span&gt; WARN  o.a.s.w.TimeEvictionPolicy - Possible clock drift or long running computation in window; Previous eviction time: 1493271162310, current eviction time: 1493271165194&lt;/p&gt;</comment>
                            <comment id="15992758" author="arunmahadevan" created="Tue, 2 May 2017 11:41:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wangkui&quot; class=&quot;user-hover&quot; rel=&quot;wangkui&quot;&gt;wangkui&lt;/a&gt;, the initial tuples expired because the trigger was not fired exactly after the window interval but after a delay. When I tested in local mode with spout emitting without a delay, the trigger happened after 6s (for a 4s tumbling window). This may be because the system is overwhelmed with data and not able to schedule the trigger thread on time. In this case the initial tuples (0 - 2s) will not be considered in the first window. &lt;/p&gt;

&lt;p&gt;Typically the window duration should be such that all the tuples within a window can be processed before the next window trigger, otherwise the next window trigger will be delayed and it will lead to incorrect results. You should use a real cluster with multiple hosts/workers and split the data among these workers to handle such high data rates.&lt;/p&gt;

&lt;p&gt;Another option would be to use event time windows where each event contains a &quot;timestamp&quot; field and the window calculations are done based on the actual event time instead of system time.&lt;/p&gt;</comment>
                            <comment id="15994230" author="wangkui" created="Wed, 3 May 2017 03:36:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arunmahadevan&quot; class=&quot;user-hover&quot; rel=&quot;arunmahadevan&quot;&gt;arunmahadevan&lt;/a&gt; So that&apos;s it, I got, thanks!&lt;/p&gt;</comment>
                            <comment id="17919462" author="githubbot" created="Sun, 26 Jan 2025 09:23:29 +0000"  >&lt;p&gt;For your information, &lt;a href=&quot;https://issues.apache.org/jira/projects/STORM/issues/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;all STORM issues&lt;/a&gt;  have been transferred to Github: &lt;a href=&quot;https://github.com/apache/storm/issues/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/storm/issues/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here is the direct link to this issue in Github: &lt;a href=&quot;https://github.com/apache/storm/issues//6271&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/storm/issues//6271&lt;/a&gt;&lt;br/&gt;
And here is the link to a search for related issues: &lt;a href=&quot;https://github.com/apache/storm/issues/?q=%22STORM-2489%22&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/storm/issues/?q=%22STORM-2489%22&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(Note: this is an automated bulk comment)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12864700" name="TumblingWindowIssue.java" size="3804" author="wangkui" created="Mon, 24 Apr 2017 03:19:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3dzmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>