<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:46:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[STORM-3606] AutoTGT shouldn&apos;t invoke TGT renewal thread (from UserGroupInformation.loginUserFromSubject)</title>
                <link>https://issues.apache.org/jira/browse/STORM-3606</link>
                <project id="12314820" key="STORM">Apache Storm</project>
                    <description>&lt;p&gt;When hadoop security is enabled, &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/storm/blob/master/storm-client/src/jvm/org/apache/storm/security/auth/kerberos/AutoTGT.java#L199-L209&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/storm/blob/master/storm-client/src/jvm/org/apache/storm/security/auth/kerberos/AutoTGT.java#L199-L209&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AutoTGT will invoke &quot;loginUserFromSubject&quot;, and it will spawn a TGT renewal thread (&quot;TGT Renewer for &amp;lt;username&amp;gt;&quot;). &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hadoop/blob/branch-2.8.5/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/UserGroupInformation.java#L928-L957&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/branch-2.8.5/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/UserGroupInformation.java#L928-L957&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;which will eventually invoke system command &quot;kinit -R&quot;, and then fail with the exception&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.hadoop.util.Shell$ExitCodeException: kinit: Credentials cache file &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/krb5cc_xxx&apos;&lt;/span&gt; not found &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; renewing credentials

	at org.apache.hadoop.util.Shell.runCommand(Shell.java:1004) ~[stormjar.jar:?]
	at org.apache.hadoop.util.Shell.run(Shell.java:898) ~[stormjar.jar:?]
	at org.apache.hadoop.util.Shell$ShellCommandExecutor.execute(Shell.java:1213) ~[stormjar.jar:?]
	at org.apache.hadoop.util.Shell.execCommand(Shell.java:1307) ~[stormjar.jar:?]
	at org.apache.hadoop.util.Shell.execCommand(Shell.java:1289) ~[stormjar.jar:?]
	at org.apache.hadoop.security.UserGroupInformation$1.run(UserGroupInformation.java:1011) [stormjar.jar:?]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) [?:1.8.0_181]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;&quot;kinit&quot; will never work from worker process since Storm don&apos;t keep TGT in local cache. Instead, TGT is saved in zookeeper and in memory of Worker process. &lt;/p&gt;

&lt;p&gt;This exception is confusing but not harmful to topologies. And the TGT renewal thread will eventually abort. &lt;/p&gt;

&lt;p&gt;It&apos;s better to find a real solution for it. But for now we can document what might happen in AutoTGT code.&lt;/p&gt;

&lt;p&gt;To be clear, we still need loginUserFromSubject or some sort but we don&apos;t want to spawn TGT renewal thread.  This is found with hadoop-2.8.5. Other versions are similar. But it can also change in the future release.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13293893">STORM-3606</key>
            <summary>AutoTGT shouldn&apos;t invoke TGT renewal thread (from UserGroupInformation.loginUserFromSubject)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="agresch">Aaron Gresch</assignee>
                                    <reporter username="ethanli">Ethan Li</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 25 Mar 2020 17:57:23 +0000</created>
                <updated>Sun, 26 Jan 2025 09:29:08 +0000</updated>
                            <resolved>Wed, 8 Apr 2020 21:19:53 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.2.3</version>
                    <version>2.1.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                                        <aggregatetimeremainingestimate seconds="0">0h</aggregatetimeremainingestimate>
                                        <aggregatetimespent seconds="2400">40m</aggregatetimespent>
                                    <comments>
                            <comment id="17076694" author="agresch" created="Mon, 6 Apr 2020 21:31:30 +0000"  >&lt;p&gt;user will see workers restart due to a NPE if they upload credentials before the TGT renewal thread runs the kinit -R command.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
020-04-01 14:36:53.005 o.a.s.u.Utils TGT Renewer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; XXX [ERROR] Received error in thread TGT Renewer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; XXX.. terminating server... java.lang.Error: java.lang.NullPointerException &#160; &#160; &#160; &#160; at org.apache.storm.utils.Utils.handleUncaughtException(Utils.java:694) ~[storm-client-2.2.0.y.jar:2.2.0.y] &#160; &#160; &#160; &#160; at org.apache.storm.utils.Utils.handleUncaughtException(Utils.java:673) ~[storm-client-2.2.0.y.jar:2.2.0.y] &#160; &#160; &#160; &#160; at org.apache.storm.utils.Utils.lambda$createDefaultUncaughtExceptionHandler$2(Utils.java:1055) ~[storm-client-2.2.0.y.jar:2.2.0.y] &#160; &#160; &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;ThreadGroup&lt;/span&gt;.uncaughtException(&lt;span class=&quot;code-object&quot;&gt;ThreadGroup&lt;/span&gt;.java) &#160; &#160; &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;ThreadGroup&lt;/span&gt;.uncaughtException(&lt;span class=&quot;code-object&quot;&gt;ThreadGroup&lt;/span&gt;.java) &#160; &#160; &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.dispatchUncaughtException(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java) Caused by: java.lang.NullPointerException &#160; &#160; &#160; &#160; at org.apache.hadoop.security.UserGroupInformation$1.run(UserGroupInformation.java:1031) ~[stormjar.jar: ?] &#160; &#160; &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java) 2020-04-01 14:36:53.018 o.a.s.u.Utils &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-23 [INFO] Halting after 3 seconds 2020-04-01 14:36:53.019 o.a.s.d.w.Worker &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-24 [INFO] Shutting down worker XXX
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Sequence:&lt;/p&gt;

&lt;p&gt;1) Hadoop thread grabs the initial TGT:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hadoop/blob/branch-2.9/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/UserGroupInformation.java#L978&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/branch-2.9/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/UserGroupInformation.java#L978&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2) Hadoop then sleeps:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hadoop/blob/branch-2.9/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/UserGroupInformation.java#L992&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/branch-2.9/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/UserGroupInformation.java#L992&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;3) kinit -R runs:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hadoop/blob/branch-2.9/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/UserGroupInformation.java#L994&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/branch-2.9/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/UserGroupInformation.java#L994&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The kinit will fail and generate an IOException. Then we get to this line that accesses the original TGT:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hadoop/blob/branch-2.9/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/UserGroupInformation.java#L1014&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/branch-2.9/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/UserGroupInformation.java#L1014&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;But since we cleared credentials on an upload credentials this will cause the NPE, which then restarts the worker.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17078722" author="ethanli" created="Wed, 8 Apr 2020 21:19:53 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=agresch&quot; class=&quot;user-hover&quot; rel=&quot;agresch&quot;&gt;agresch&lt;/a&gt; Merged to master and 2.1.x-branch&lt;/p&gt;</comment>
                            <comment id="17920580" author="githubbot" created="Sun, 26 Jan 2025 09:29:08 +0000"  >&lt;p&gt;For your information, &lt;a href=&quot;https://issues.apache.org/jira/projects/STORM/issues/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;all STORM issues&lt;/a&gt;  have been transferred to Github: &lt;a href=&quot;https://github.com/apache/storm/issues/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/storm/issues/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here is the direct link to this issue in Github: &lt;a href=&quot;https://github.com/apache/storm/issues//7388&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/storm/issues//7388&lt;/a&gt;&lt;br/&gt;
And here is the link to a search for related issues: &lt;a href=&quot;https://github.com/apache/storm/issues/?q=%22STORM-3606%22&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/storm/issues/?q=%22STORM-3606%22&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(Note: this is an automated bulk comment)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13313266">STORM-3656</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="13293894">STORM-3607</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0cwk0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>