[{"id":4610579994,"node_id":"MDEyOkxhYmVsZWRFdmVudDQ2MTA1Nzk5OTQ=","url":"https://api.github.com/repos/semuxproject/semux-core/issues/events/4610579994","actor":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-04-19T06:40:50Z","label":{"name":"enhancement","color":"11c681"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/823497749","html_url":"https://github.com/semuxproject/semux-core/issues/310#issuecomment-823497749","issue_url":"https://api.github.com/repos/semuxproject/semux-core/issues/310","id":823497749,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMzQ5Nzc0OQ==","user":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-20T18:15:11Z","updated_at":"2021-04-20T18:15:11Z","body":"Yes @fenghaoming, you're right!\r\n\r\nThe purpose of executing pending transactions in the pool is to exclude invalid transactions after the state change caused by importing a new block. \r\n\r\nThere is definitely a performance cost associated with this process and there are two possible workarounds:\r\n- To make the notifcation process asynchronous so the block importing will not be blocked; \r\n- To make the pending transaction validation **lighter**, for instance, only to check the sender's balance only.\r\n\r\nWill definitely consider these options.\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/823497749/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4620835486,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDYyMDgzNTQ4Ng==","url":"https://api.github.com/repos/semuxproject/semux-core/issues/events/4620835486","actor":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-20T18:15:12Z","performed_via_github_app":null},{"id":4620835493,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ2MjA4MzU0OTM=","url":"https://api.github.com/repos/semuxproject/semux-core/issues/events/4620835493","actor":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-20T18:15:12Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/823815884","html_url":"https://github.com/semuxproject/semux-core/issues/310#issuecomment-823815884","issue_url":"https://api.github.com/repos/semuxproject/semux-core/issues/310","id":823815884,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMzgxNTg4NA==","user":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-21T06:37:03Z","updated_at":"2021-04-21T06:43:34Z","body":"> Yes @fenghaoming, you're right!\r\n> \r\n> The purpose of executing pending transactions in the pool is to exclude invalid transactions after the state change caused by importing a new block.\r\n> \r\n> There is definitely a performance cost associated with this process and there are two possible workarounds:\r\n> \r\n> * To make the notifcation process asynchronous so the block importing will not be blocked;\r\n> * To make the pending transaction validation **lighter**, for instance, only to check the sender's balance only.\r\n> \r\n> Will definitely consider these options.\r\n\r\n### First solution\r\nI think the first asynchronous solution is still unreliable because all functions in the PendingManager need to be synchronized.\r\nWithout blocking block adding, but blocking transactions receiving like AddTransaction. it still reduce the TPS. \r\nThis solution just pass the problem on without really solving it.\r\n\r\n### Second solution\r\nI think the second lighter scheme is reasonable, and this is how Ethereum deals with it. An example is as follows:\r\n\r\n### Example\r\nAssume that an account currently has a nonce of 1 and a balance of 1000 ETH, and send four transactions as follows quickly and continuously (Nonce is null when user sends) :\r\n- The first transaction: GasPrice is 1 ETH, GasLimit is 700, and the actual GasUsed consumed by the contract is 400.\r\n- The second transaction: GasPrice is 1 ETH, GasLimit is 500, and the GasUsed actually consumed by the contract is 300.\r\n- The third transaction: GasPrice is 1 ETH, GasLimit is 400, and the actual GasUsed consumed by the contract is 300.\r\n- The fourth transaction: GasPrice is 1 ETH, GasLimit is 200, and the actual GasUsed consumed by the contract is 100.\r\n\r\n### According to Semux's current treatment:\r\nThe first three transactions were successfully added to the tx pool (1000 ETH is just enough for the GasUsed accumulated according to the pending transactions execution), \r\nwhile the fourth transaction immediately returned an \"insufficient balance\" error.\r\n\r\n### As Ethereum does:\r\nAll transactions are successfully added to the trading pool, and on subsequent block generation then:\r\n- The first and second transactions are successfully packaged in block N, with nonce of 1 and 2 respectively;\r\n- The third transaction was dropped due to insufficient balance (300 ETH in the new world state after executing the first two, and 400 ETH expected for this transaction);\r\n- The fourth transaction is demote into the queue with a nonce of 4 (because the third transaction occupies a nonce of 3).\r\n\r\nAfter that, if the user initiates the following transaction:\r\n- Fifth transaction: GasPrice is 1 ETH, GasLimit is 100, and the actual GasUsed consumed by the contract is 50.\r\n\r\n- The fifth and fourth transactions are successfully packaged in blocks N + M with a nonce of 3 and 4 respectively (the fifth transaction reoccupies a nonce of 3).\r\n\r\n### Therefore\r\nWe can see that the removal of the pending transactions execution in the PendingManager only results in the following two disadvantages:\r\n\r\n- First, if the balance is sufficient to verify, it shall be in accordance with 'gasLimit', rather than the 'gasUsed' actually consumed by the contract as a reference. \r\nThis requires users to have a sufficient understanding of the 'gasUsed' of the contract, so as to avoid transaction verification failure caused by setting too high 'gasLimit'.\r\n\r\n- Second, the balance check for each transaction is independent, so when a user sends multiple transactions in rapid succession, subsequent transactions cannot be checked for an \"insufficient balance\" error in real time.\r\n\r\nThese two disadvantages only affect the case of sending multiple transactions in rapid succession when the user has only a small balance. \r\nI think the disadvantages is worth while because it reduces the huge performance overhead of pending transactions execution.\r\n\r\nAre there any other shortcomings I haven't considered? Thank you very much!","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/823815884/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4623004154,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDYyMzAwNDE1NA==","url":"https://api.github.com/repos/semuxproject/semux-core/issues/events/4623004154","actor":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-21T06:37:03Z","performed_via_github_app":null},{"id":4623004156,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ2MjMwMDQxNTY=","url":"https://api.github.com/repos/semuxproject/semux-core/issues/events/4623004156","actor":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-21T06:37:03Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/826305861","html_url":"https://github.com/semuxproject/semux-core/issues/310#issuecomment-826305861","issue_url":"https://api.github.com/repos/semuxproject/semux-core/issues/310","id":826305861,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNjMwNTg2MQ==","user":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-25T11:08:45Z","updated_at":"2021-04-25T11:08:45Z","body":"This is a thorough analysis!\r\n\r\nI agree with the first conclusion but have some doubt about the second scenario. \r\n\r\nThe balance check should deduct the sender’s balance by the theoretical max cost and increase its nonce to the pending state after each added transaction. With a large number of transactions, they should be reorganized by the designated nonce and validated the same way. The transaction validation in pending pool may include false positives but should be sound.\r\n\r\nOut of curiosity though, are you able to make a PR to improve the pending manager? :)","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/826305861/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/826306192","html_url":"https://github.com/semuxproject/semux-core/issues/310#issuecomment-826306192","issue_url":"https://api.github.com/repos/semuxproject/semux-core/issues/310","id":826306192,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNjMwNjE5Mg==","user":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-25T11:11:09Z","updated_at":"2021-04-25T11:11:09Z","body":"Also note that most of the account states should already be in cache and can be retrieved fairly fast.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/826306192/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/826320998","html_url":"https://github.com/semuxproject/semux-core/issues/310#issuecomment-826320998","issue_url":"https://api.github.com/repos/semuxproject/semux-core/issues/310","id":826320998,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNjMyMDk5OA==","user":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-25T13:03:07Z","updated_at":"2021-04-25T13:03:07Z","body":"> This is a thorough analysis!\r\n> \r\n> I agree with the first conclusion but have some doubt about the second scenario.\r\n> \r\n> The balance check should deduct the sender’s balance by the theoretical max cost and increase its nonce to the pending state after each added transaction. With a large number of transactions, they should be reorganized by the designated nonce and validated the same way. The transaction validation in pending pool may include false positives but should be sound.\r\n> \r\n> Out of curiosity though, are you able to make a PR to improve the pending manager? :)\r\n\r\nMay I ask what is your suspicion about the second scenario? Could you give me an example?\r\n\r\nDo you want me to optimize the Pending Manager as I said above (remove mock execution, do not maintain a set of world states, just do simple \"per transaction independent\" balance checks)?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/826320998/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/826392456","html_url":"https://github.com/semuxproject/semux-core/issues/310#issuecomment-826392456","issue_url":"https://api.github.com/repos/semuxproject/semux-core/issues/310","id":826392456,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNjM5MjQ1Ng==","user":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-25T21:25:16Z","updated_at":"2021-04-25T21:31:11Z","body":"Let me clarify it a bit - my point was that we should not remove transaction execution, but simplify it instead.\r\n\r\nWhen a new block is imported,\r\n- Create a new `pendingState` based on the current global state\r\n- Re-validate all transactions (assuming format and signature have been validated when received for the first time):\r\n  - Check transaction nonce:\r\n    * If it's greater than account nonce, move it to a secondary queue\r\n    * If it's less than account nonce,  discard it immediately\r\n  - Check if `value + fee + gasPrice * gasLimit` is not less than account balance\r\n    * If not, discard it immediately\r\n  - If all checks pass, \r\n    * Increment the sender's account nonce in `pendingState`\r\n    * Deduct the sender's balance by `value + fee + gasPrice * gasLimit`\r\n- Done\r\n\r\nThe above process does not trigger any VM execution and only requires account state (cached with high probability), so it should be fast.\r\n\r\n> subsequent transactions cannot be checked for an \"insufficient balance\" error in real time\r\n\r\nEssentially, transactions from the same sender are validated sequentially, so \"insufficient balance\" error should be immediately available.\r\n\r\nI might have missed details, but feel free to add as you see fit. :)","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/826392456/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/826455267","html_url":"https://github.com/semuxproject/semux-core/issues/310#issuecomment-826455267","issue_url":"https://api.github.com/repos/semuxproject/semux-core/issues/310","id":826455267,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNjQ1NTI2Nw==","user":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-26T02:13:12Z","updated_at":"2021-04-26T02:22:17Z","body":"> Let me clarify it a bit - my point was that we should not remove transaction execution, but simplify it instead.\r\n> \r\n> When a new block is imported,\r\n> \r\n> * Create a new `pendingState` based on the current global state\r\n> * Re-validate all transactions (assuming format and signature have been validated when received for the first time):\r\n>   \r\n>   * Check transaction nonce:\r\n>     \r\n>     * If it's greater than account nonce, move it to a secondary queue\r\n>     * If it's less than account nonce,  discard it immediately\r\n>   * Check if `value + fee + gasPrice * gasLimit` is not less than account balance\r\n>     \r\n>     * If not, discard it immediately\r\n>   * If all checks pass,\r\n>     \r\n>     * Increment the sender's account nonce in `pendingState`\r\n>     * Deduct the sender's balance by `value + fee + gasPrice * gasLimit`\r\n> * Done\r\n> \r\n> The above process does not trigger any VM execution and only requires account state (cached with high probability), so it should be fast.\r\n> \r\n> > subsequent transactions cannot be checked for an \"insufficient balance\" error in real time\r\n> \r\n> Essentially, transactions from the same sender are validated sequentially, so \"insufficient balance\" error should be immediately available.\r\n> \r\n> I might have missed details, but feel free to add as you see fit. :)\r\n\r\n\r\nI agree with you on the whole, but I have a different opinion on one point\r\nI don't think it is necessary to maintain the balance of the account in pendingState, so I don't need to perform the operation \"Deduct the sender's balance by value + fee + gasPrice * gasLimit\".\r\n\r\n### Example:\r\nFor example, there are 4 transactions from the same sender with a balance of 1000 ETH, each of which has a GasPrice of 1 ETH, a GasLimit of 500, but the actual execution consumes a GasUsed of 300\r\n\r\n### According to your approach:\r\nThe first two transactions successfully joined the PendingPool, and the last two transactions reported an error of \"insufficient balance\" in real time.\r\n\r\n### My view:\r\nAll four transactions were successfully added to the PendingPool because \"500 is less than 1000\" (where each transaction is \"independently\" compared with the account balance by GasLimit), and finally the first three transactions successfully packaged into the block (use the \"cumulative\" GasUsed to compare when the block generating) and the last transaction is discarded.\r\n\r\n### So:\r\nI think your approach requires the user not to set the GasLimit too high (much higher than GasUsed) when sending a transaction, otherwise subsequent transactions from that user could easily check for error \"insufficient balance\" unreasonably.\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/826455267/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/827057139","html_url":"https://github.com/semuxproject/semux-core/issues/310#issuecomment-827057139","issue_url":"https://api.github.com/repos/semuxproject/semux-core/issues/310","id":827057139,"node_id":"MDEyOklzc3VlQ29tbWVudDgyNzA1NzEzOQ==","user":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-26T18:32:50Z","updated_at":"2021-04-26T18:32:50Z","body":"Yes, your example is absolutely correct. The proposal is an optimistic approach and may falsely reject a transaction even if the sender has enough balance to cover the **actual transaction cost**. I think it only affects users who deliberately wants to spend all the available funds. In this case, they can potentially lower the `gasLimit` to work around it. Right?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/827057139/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/828114613","html_url":"https://github.com/semuxproject/semux-core/issues/310#issuecomment-828114613","issue_url":"https://api.github.com/repos/semuxproject/semux-core/issues/310","id":828114613,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODExNDYxMw==","user":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T03:28:42Z","updated_at":"2021-04-28T03:55:56Z","body":"> Yes, your example is absolutely correct. The proposal is an optimistic approach and may falsely reject a transaction even if the sender has enough balance to cover the **actual transaction cost**. I think it only affects users who deliberately wants to spend all the available funds. In this case, they can potentially lower the `gasLimit` to work around it. Right?\r\n\r\nI stand in the user's position to think about this problem.When I send a transaction, I don't know how much gas it actually consumes, so I usually try to set the gas as high as possible to avoid the error of outOfGas and wasting my ETH.This is just my personal opinion, do not know right?\r\n\r\nAnother reason I don't want to continue to maintain user balances in \"onBlockAdded()\" is that it still needs to read every transaction in the trade pool to operate, even if it no longer penetrates into the VM layer, but the time complexity is still O(n).\r\n\r\nI think the trade pool should be maintained in both account and nonce dimensions.\r\n```\r\npublic class PendingManager {\r\n    private AccountState accountState;\r\n    \r\n    // map< address, accTxs >\r\n    Map<ByteArray, AccountTransactions> txs = new HashMap<>();\r\n    \r\n    public synchronized void onBlockAdded(Block block) {\r\n        // reset accountState\r\n        accountState = facade.getBlockchain().getAccountState().track();\r\n        \r\n        // retrieve max nonce of each account in given block\r\n        Map<ByteArray, Long> accountMaxNonce = new HashMap<>();\r\n        for (Transaction tx : block.getTransactions()) {\r\n            ByteArray address = ByteArray.of(tx.getFrom());\r\n            long nonce = tx.getNonce();\r\n            accountMaxNonce.compute(address, (k, v) -> v == null || v < nonce ? nonce : v);\r\n        }\r\n    \r\n        for (Map.Entry<ByteArray, Long> e : accountMaxNonce.entrySet()) {\r\n            ByteArray address = e.getKey();\r\n            AccountTransactions accTxs = txs.get(address);\r\n                        \r\n            //remove txs whose nonce is outdated\r\n            accTxs.forward(e.getValue());\r\n            \r\n            //remove first pending whose balance is insufficient and demote subsequent txs\r\n            Amount available = accountState.getAccount(address.getData()).getAvailable();\r\n            accTxs.filter(available);\r\n\r\n            //release memory\r\n            if (accTxs.size() == 0) {\r\n                txs.remove(address);\r\n            }\r\n        }\r\n    }\r\n```\r\n\r\n```\r\npublic class AccountTransactions {\r\n    // map< nonce, tx >, continuous nonce which is ready, and pendingNonceMin equals to accountNonce in DB\r\n    private final Map<Long, Transaction> pending = new HashMap<>();\r\n    private Long pendingNonceMin;\r\n    private Long pendingNonceMax;\r\n\r\n    // map< nonce, tx >, large nonce which greater than (pendingNonceMax + 1)\r\n    Map<Long, Transaction> queue = new HashMap<>();\r\n    \r\n    public int size() {\r\n        return pending.size() + queue.size();\r\n    }\r\n\r\n    // Remove transactions whose nonce less or equal given nonce\r\n    public void forward(long nonce) {\r\n        while (pendingNonceMin != null && pendingNonceMin <= nonce) {\r\n            pending.remove(pendingNonceMin);\r\n            if (pending.get(pendingNonceMin + 1) != null) {\r\n                pendingNonceMin++;\r\n            } else {\r\n                pendingNonceMin = null;\r\n                pendingNonceMax = null;\r\n            }\r\n        }\r\n    }\r\n    \r\n    // Remove the first transaction with an insufficient balance, and demote subsequent transactions from pending to queue\r\n    public void filter(Amount available) {\r\n        if (pendingNonceMin == null) {\r\n            return;\r\n        }\r\n        Transaction pendingMin = pending.get(pendingNonceMin);\r\n        if (available.greaterThenOrEqual(pendingMin.value.add(pendingMin.fee).add(pendingMin.gasPrice.multiply(pendingMin.gas)))) {\r\n            return; // available is enough\r\n        }\r\n\r\n        // remove first\r\n        pending.remove(pendingNonceMin);\r\n\r\n        // demote subsequent\r\n        for (Map.Entry<Long, Transaction> e : pending.entrySet()) {\r\n            queue.put(e.getKey(), e.getValue());\r\n        }\r\n\r\n        // clear pending\r\n        pending.clear();\r\n        pendingNonceMin = null;\r\n        pendingNonceMax = null;\r\n    }\r\n```\r\n\r\nSo we're going to do it this way, the number of onBlockAdded transactions that need to be processed is related only to the number of transactions in the block, not to the number of transactions pending.\r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/828114613/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4654213347,"node_id":"MDExOkNsb3NlZEV2ZW50NDY1NDIxMzM0Nw==","url":"https://api.github.com/repos/semuxproject/semux-core/issues/events/4654213347","actor":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-04-28T03:28:42Z","state_reason":null,"performed_via_github_app":null},{"id":4654230524,"node_id":"MDEzOlJlb3BlbmVkRXZlbnQ0NjU0MjMwNTI0","url":"https://api.github.com/repos/semuxproject/semux-core/issues/events/4654230524","actor":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2021-04-28T03:36:14Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/830044215","html_url":"https://github.com/semuxproject/semux-core/issues/310#issuecomment-830044215","issue_url":"https://api.github.com/repos/semuxproject/semux-core/issues/310","id":830044215,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDA0NDIxNQ==","user":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-30T11:58:56Z","updated_at":"2021-04-30T11:58:56Z","body":"> Another reason I don't want to continue to maintain user balances in \"onBlockAdded()\" is that it still needs to read every transaction in the trade pool to operate, even if it no longer penetrates into the VM layer, but the time complexity is still O(n).\r\n\r\nWe can simply sort the transactions based on the gasPrice and limit the number of transactions that are actively evluated for pending block. So the complexity can be limited to O(1). The execute time is not wasted as it will spend up the block creation process, given most of the account states are hot.\r\n\r\nThat said, I do like the idea about grouping transactions by the sender's address. I will explore this a bit more.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/830044215/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/830049476","html_url":"https://github.com/semuxproject/semux-core/issues/310#issuecomment-830049476","issue_url":"https://api.github.com/repos/semuxproject/semux-core/issues/310","id":830049476,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDA0OTQ3Ng==","user":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-30T12:09:08Z","updated_at":"2021-04-30T12:09:08Z","body":"Aso, regarding:\r\n> I stand in the user's position to think about this problem.When I send a transaction, I don't know how much gas it actually consumes, so I usually try to set the gas as high as possible to avoid the error of outOfGas and wasting my ETH.This is just my personal opinion, do not know right?\r\n\r\nI don't have data about different user behaviors so I'm going to guess that some people might prefer to set the gasLimit as high as possible. Let's say he/she uses `5,000,000` as gas limit and the default `10 NanoSEM = 10 Gwei` gas price. The max cost is `0.05 SEM`. Any account holder with reasonably enough balance should be able to do transactions using their prefered gas limit. ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/830049476/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"semuxgo","id":40153479,"node_id":"MDQ6VXNlcjQwMTUzNDc5","avatar_url":"https://avatars.githubusercontent.com/u/40153479?v=4","gravatar_id":"","url":"https://api.github.com/users/semuxgo","html_url":"https://github.com/semuxgo","followers_url":"https://api.github.com/users/semuxgo/followers","following_url":"https://api.github.com/users/semuxgo/following{/other_user}","gists_url":"https://api.github.com/users/semuxgo/gists{/gist_id}","starred_url":"https://api.github.com/users/semuxgo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/semuxgo/subscriptions","organizations_url":"https://api.github.com/users/semuxgo/orgs","repos_url":"https://api.github.com/users/semuxgo/repos","events_url":"https://api.github.com/users/semuxgo/events{/privacy}","received_events_url":"https://api.github.com/users/semuxgo/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/834105795","html_url":"https://github.com/semuxproject/semux-core/issues/310#issuecomment-834105795","issue_url":"https://api.github.com/repos/semuxproject/semux-core/issues/310","id":834105795,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNDEwNTc5NQ==","user":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-07T06:33:33Z","updated_at":"2021-05-07T06:34:26Z","body":"> We can simply sort the transactions based on the gasPrice and limit the number of transactions that are actively evluated for pending block. So the complexity can be limited to O(1). \r\n\r\nIf there 10,000 txs in txPool, but only 1000 txs that are actively evluated for pending block. You maintain user balances in txPool only with the 1000 txs. Here comes another new one tx. In my opinion, we should judge whether the balance of this transaction is sufficient by deducting the cost of those 10,000 transactions. Maintaining only those 1000 transactions makes no sense on its own.\r\n\r\n\r\n\r\n> The execute time is not wasted as it will spend up the block creation process, given most of the account states are hot.\r\n\r\nI'm sorry, I don't understand how it will spend up the block creation process. Could you give an example? Thank you!\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/semuxproject/semux-core/issues/comments/834105795/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"VictorECDSA","id":26361852,"node_id":"MDQ6VXNlcjI2MzYxODUy","avatar_url":"https://avatars.githubusercontent.com/u/26361852?v=4","gravatar_id":"","url":"https://api.github.com/users/VictorECDSA","html_url":"https://github.com/VictorECDSA","followers_url":"https://api.github.com/users/VictorECDSA/followers","following_url":"https://api.github.com/users/VictorECDSA/following{/other_user}","gists_url":"https://api.github.com/users/VictorECDSA/gists{/gist_id}","starred_url":"https://api.github.com/users/VictorECDSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/VictorECDSA/subscriptions","organizations_url":"https://api.github.com/users/VictorECDSA/orgs","repos_url":"https://api.github.com/users/VictorECDSA/repos","events_url":"https://api.github.com/users/VictorECDSA/events{/privacy}","received_events_url":"https://api.github.com/users/VictorECDSA/received_events","type":"User","user_view_type":"public","site_admin":false}}]