{"url":"https://api.github.com/repos/mrdoob/three.js/issues/23490","repository_url":"https://api.github.com/repos/mrdoob/three.js","labels_url":"https://api.github.com/repos/mrdoob/three.js/issues/23490/labels{/name}","comments_url":"https://api.github.com/repos/mrdoob/three.js/issues/23490/comments","events_url":"https://api.github.com/repos/mrdoob/three.js/issues/23490/events","html_url":"https://github.com/mrdoob/three.js/issues/23490","id":1137268425,"node_id":"I_kwDOAAjKyc5DyVbJ","number":23490,"title":"Manually generated data texture mipmaps uploaded wrongly","user":{"login":"MatejJan","id":565736,"node_id":"MDQ6VXNlcjU2NTczNg==","avatar_url":"https://avatars.githubusercontent.com/u/565736?v=4","gravatar_id":"","url":"https://api.github.com/users/MatejJan","html_url":"https://github.com/MatejJan","followers_url":"https://api.github.com/users/MatejJan/followers","following_url":"https://api.github.com/users/MatejJan/following{/other_user}","gists_url":"https://api.github.com/users/MatejJan/gists{/gist_id}","starred_url":"https://api.github.com/users/MatejJan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MatejJan/subscriptions","organizations_url":"https://api.github.com/users/MatejJan/orgs","repos_url":"https://api.github.com/users/MatejJan/repos","events_url":"https://api.github.com/users/MatejJan/events{/privacy}","received_events_url":"https://api.github.com/users/MatejJan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":620412970,"node_id":"MDU6TGFiZWw2MjA0MTI5NzA=","url":"https://api.github.com/repos/mrdoob/three.js/labels/Regression","name":"Regression","color":"000000","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-02-14T13:00:45Z","updated_at":"2022-02-14T15:48:58Z","closed_at":"2022-02-14T15:48:30Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"After switching to WebGL 2 by upgrading to latest three.js, my data texture with custom mipmap levels stopped working correctly. \r\n\r\nHere's a debug image showing a normal map of a floor that has a texture with custom mipmaps. On the main level you can see the floor texture and for debugging I put just different colors on the other levels. Instead of the colors appearing as the floor recedes into the distance, they appear overlaid on the main level.\r\n\r\n<img width=\"695\" alt=\"Screen Shot 2022-02-14 at 13 48 07\" src=\"https://user-images.githubusercontent.com/565736/153867067-e64e52b8-9a1c-430d-9deb-dbf998a04bf4.png\">\r\n\r\nI traced the issue down to the uploading process in case of WebGL 2 which seems to use tex storage:\r\nhttps://github.com/mrdoob/three.js/blob/56a39221193a80a6c0a4e37da6f7757596007fe4/src/renderers/webgl/WebGLTextures.js#L806\r\n\r\nI'm guessing the line should have the index `i` as the second parameter:\r\n\r\n```\r\nstate.texSubImage2D( _gl.TEXTURE_2D, i, 0, 0, mipmap.width, mipmap.height, glFormat, glType, mipmap.data );\r\n```\r\n\r\nI'll try and see if this is indeed the fix. I'm a bit confused because the [texture manual mipmapping example](https://threejs.org/examples/?q=mipmap#webgl_materials_texture_manualmipmap) seems to be working just fine, so maybe that line is supposed to be like this (I have no experience with tex storage yet).","closed_by":{"login":"mrdoob","id":97088,"node_id":"MDQ6VXNlcjk3MDg4","avatar_url":"https://avatars.githubusercontent.com/u/97088?v=4","gravatar_id":"","url":"https://api.github.com/users/mrdoob","html_url":"https://github.com/mrdoob","followers_url":"https://api.github.com/users/mrdoob/followers","following_url":"https://api.github.com/users/mrdoob/following{/other_user}","gists_url":"https://api.github.com/users/mrdoob/gists{/gist_id}","starred_url":"https://api.github.com/users/mrdoob/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrdoob/subscriptions","organizations_url":"https://api.github.com/users/mrdoob/orgs","repos_url":"https://api.github.com/users/mrdoob/repos","events_url":"https://api.github.com/users/mrdoob/events{/privacy}","received_events_url":"https://api.github.com/users/mrdoob/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/mrdoob/three.js/issues/23490/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/mrdoob/three.js/issues/23490/timeline","performed_via_github_app":null,"state_reason":"completed"}