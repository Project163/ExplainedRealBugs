{"url":"https://api.github.com/repos/storybookjs/storybook/issues/29621","repository_url":"https://api.github.com/repos/storybookjs/storybook","labels_url":"https://api.github.com/repos/storybookjs/storybook/issues/29621/labels{/name}","comments_url":"https://api.github.com/repos/storybookjs/storybook/issues/29621/comments","events_url":"https://api.github.com/repos/storybookjs/storybook/issues/29621/events","html_url":"https://github.com/storybookjs/storybook/issues/29621","id":2661054999,"node_id":"I_kwDOAzqfmc6enHoX","number":29621,"title":"[Bug]: Webpack fsCache does not work with @storybook/nextjs framework","user":{"login":"sentience","id":89772,"node_id":"MDQ6VXNlcjg5Nzcy","avatar_url":"https://avatars.githubusercontent.com/u/89772?v=4","gravatar_id":"","url":"https://api.github.com/users/sentience","html_url":"https://github.com/sentience","followers_url":"https://api.github.com/users/sentience/followers","following_url":"https://api.github.com/users/sentience/following{/other_user}","gists_url":"https://api.github.com/users/sentience/gists{/gist_id}","starred_url":"https://api.github.com/users/sentience/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sentience/subscriptions","organizations_url":"https://api.github.com/users/sentience/orgs","repos_url":"https://api.github.com/users/sentience/repos","events_url":"https://api.github.com/users/sentience/events{/privacy}","received_events_url":"https://api.github.com/users/sentience/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":343576454,"node_id":"MDU6TGFiZWwzNDM1NzY0NTQ=","url":"https://api.github.com/repos/storybookjs/storybook/labels/bug","name":"bug","color":"EB484F","default":true,"description":null},{"id":571226465,"node_id":"MDU6TGFiZWw1NzEyMjY0NjU=","url":"https://api.github.com/repos/storybookjs/storybook/labels/help%20wanted","name":"help wanted","color":"0E8A16","default":true,"description":""},{"id":2272354128,"node_id":"MDU6TGFiZWwyMjcyMzU0MTI4","url":"https://api.github.com/repos/storybookjs/storybook/labels/nextjs","name":"nextjs","color":"09b1ba","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-11-15T07:22:11Z","updated_at":"2025-01-18T04:36:54Z","closed_at":"2024-12-13T12:36:13Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nThe [Storybook Next.js framework](https://storybook.js.org/docs/get-started/frameworks/nextjs) uses webpack internally to build Storybooks for Next.js projects.\n\nThe [Storybook webpack builder](https://storybook.js.org/docs/builders/webpack) supports an `fsCache` option to enable disk-based caching, which greatly improves incremental build performance in webpack-based Storybook projects.\n\nWhen the `fsCache` option is enabled in a Storybook project that uses the Next.js framework, however, the disk-based cache does not work, and the Storybook build outputs a large number of `webpack.cache.packFileCacheStrategy` warnings. As a result, Next.js projects cannot benefit from the significant speed boost afforded by the webpack disk cache.\n\n#### Storybook config\n\n```\nimport { StorybookConfig } from \"@storybook/nextjs\"\n\nexport default {\n  stories: [\"../example/**/*.stories.(ts|tsx)\"],\n  framework: {\n    name: \"@storybook/nextjs\",\n    options: {\n      builder: {\n        fsCache: true,\n      },\n    },\n  },\n  addons: [],\n} satisfies StorybookConfig\n```\n\n### Reproduction link\n\nhttps://github.com/sentience/storybook-nextjs-webpack-cache-issue-demo\n\n### Reproduction steps\n\n1. `git clone https://github.com/sentience/storybook-nextjs-webpack-cache-issue-demo.git`\n2. `cd storybook-nextjs-webpack-cache-issue-demo`\n3. `pnpm i`\n4. `pnpm storybook dev`\n\n### System\n\n```bash\nStorybook Environment Info:\n\n  System:\n    OS: macOS 15.1\n    CPU: (8) arm64 Apple M1\n    Shell: 5.9 - /bin/zsh\n  Binaries:\n    Node: 18.19.1 - ~/Developer/storybook-nextjs-webpack-cache-issue-demo/.devbox/nix/profile/default/bin/node\n    Yarn: 1.22.22 - ~/Developer/storybook-nextjs-webpack-cache-issue-demo/.devbox/virtenv/nodejs/corepack-bin/yarn\n    npm: 10.2.4 - ~/Developer/storybook-nextjs-webpack-cache-issue-demo/.devbox/nix/profile/default/bin/npm\n    pnpm: 9.12.3 - ~/Developer/storybook-nextjs-webpack-cache-issue-demo/.devbox/virtenv/nodejs/corepack-bin/pnpm <----- active\n  Browsers:\n    Chrome: 130.0.6723.119\n    Safari: 18.1\n  npmPackages:\n    @storybook/global: ^5.0.0 => 5.0.0 \n    @storybook/nextjs: ^8.4.3 => 8.4.3 \n    @storybook/types: ^8.4.3 => 8.4.3 \n    storybook: ^8.4.3 => 8.4.3\n```\n\n### Additional context\n\nThis problem seems to have existed since the introduction of @storybook/nextjs in Storybook 8.0.","closed_by":{"login":"valentinpalkovic","id":5889929,"node_id":"MDQ6VXNlcjU4ODk5Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5889929?v=4","gravatar_id":"","url":"https://api.github.com/users/valentinpalkovic","html_url":"https://github.com/valentinpalkovic","followers_url":"https://api.github.com/users/valentinpalkovic/followers","following_url":"https://api.github.com/users/valentinpalkovic/following{/other_user}","gists_url":"https://api.github.com/users/valentinpalkovic/gists{/gist_id}","starred_url":"https://api.github.com/users/valentinpalkovic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/valentinpalkovic/subscriptions","organizations_url":"https://api.github.com/users/valentinpalkovic/orgs","repos_url":"https://api.github.com/users/valentinpalkovic/repos","events_url":"https://api.github.com/users/valentinpalkovic/events{/privacy}","received_events_url":"https://api.github.com/users/valentinpalkovic/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/storybookjs/storybook/issues/29621/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/storybookjs/storybook/issues/29621/timeline","performed_via_github_app":null,"state_reason":"completed"}