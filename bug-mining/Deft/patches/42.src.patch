diff --git a/src/main/java/org/deftserver/web/protocol/HttpProtocol.java b/src/main/java/org/deftserver/web/protocol/HttpProtocol.java
index 4e7a083..1132639 100644
--- a/src/main/java/org/deftserver/web/protocol/HttpProtocol.java
+++ b/src/main/java/org/deftserver/web/protocol/HttpProtocol.java
@@ -1,6 +1,8 @@
 package org.deftserver.web.protocol;
 
+import java.io.File;
 import java.io.IOException;
+import java.io.RandomAccessFile;
 import java.lang.management.ManagementFactory;
 import java.nio.ByteBuffer;
 import java.nio.channels.ClosedChannelException;
@@ -39,6 +41,7 @@ public class HttpProtocol implements Protocol, HttpProtocolMXBean {
 	private final Map<SocketChannel, Long> persistentConnections = new HashMap<SocketChannel, Long>();
 	
 	private final Map<SelectionKey, List<ByteBuffer>> stagedData = Maps.newHashMap();
+	private final Map<SelectionKey, File> stagedFiles = Maps.newHashMap();
 	private final int readBufferSize;
 
 	private final Application application;
@@ -92,32 +95,33 @@ public class HttpProtocol implements Protocol, HttpProtocolMXBean {
 	public void handleWrite(SelectionKey key) {
 		logger.debug("handle write...");
 		List<ByteBuffer> pending = stagedData.get(key);
-		// shouldn't we always have staged data to write if we got this callback?
-		if (pending != null && !pending.isEmpty()) {
-			// pending data waiting to be written
-			logger.debug("pending data about to be written");
-			ByteBuffer toSend = pending.get(0);
-			try {
-				long bytesWritten = ((SocketChannel)key.channel()).write(toSend);
-				logger.debug("sent {} bytes to wire", bytesWritten);
-				if (!toSend.hasRemaining()) {
-					// sent all in the toSend ByteBuffer
-					logger.debug("sent all data in toSend buffer");
-					pending.remove(0);
-					if (pending.isEmpty()) {
-						// last 'chunk' sent
-						closeOrRegisterForRead(key);
-					}
+		logger.debug("pending data about to be written");
+		ByteBuffer toSend = pending.get(0);
+		try {
+			long bytesWritten = ((SocketChannel)key.channel()).write(toSend);
+			logger.debug("sent {} bytes to wire", bytesWritten);
+			if (!toSend.hasRemaining()) {
+				logger.debug("sent all data in toSend buffer");
+				pending.remove(0);
+				if (pending.isEmpty()) {
+					// last 'chunk' sent
+					closeOrRegisterForRead(key);
 				}
+			}
+		} catch (IOException e) {
+			logger.error("Failed to send data to client: {}", e.getMessage());
+			Closeables.closeQuietly(key.channel());
+		}
+		if (stagedFiles.containsKey(key)) {
+			File file = stagedFiles.get(key);
+			try {
+				SocketChannel clientChannel = (SocketChannel) key.channel();
+				new RandomAccessFile(file, "r").getChannel().transferTo(0, file.length(), clientChannel);
 			} catch (IOException e) {
-				logger.error("Failed to send data to client: {}", e.getMessage());
-				Closeables.closeQuietly(key.channel());
+				logger.error("Error writing (static file) response: {}", e.getMessage());
 			}
-		} else {
-			logger.debug("no data pending to be written");
 			closeOrRegisterForRead(key);
-		}
-		
+		} 
 	}
 	
 	private void closeOrRegisterForRead(SelectionKey key) {
@@ -183,4 +187,9 @@ public class HttpProtocol implements Protocol, HttpProtocolMXBean {
 		pending.add(responseData);
 	}
 
+
+	public void stage(SelectionKey key, File file) {
+		stagedFiles.put(key, file);
+	}
+
 }
diff --git a/src/main/java/org/deftserver/web/protocol/HttpResponse.java b/src/main/java/org/deftserver/web/protocol/HttpResponse.java
index 7858f25..22973fe 100644
--- a/src/main/java/org/deftserver/web/protocol/HttpResponse.java
+++ b/src/main/java/org/deftserver/web/protocol/HttpResponse.java
@@ -1,8 +1,6 @@
 package org.deftserver.web.protocol;
 
 import java.io.File;
-import java.io.IOException;
-import java.io.RandomAccessFile;
 import java.nio.ByteBuffer;
 import java.nio.channels.ClosedChannelException;
 import java.nio.channels.SelectionKey;
@@ -154,18 +152,21 @@ public class HttpResponse {
 	/**
 	 * @param file Static resource/file to send
 	 */
-	public long write(File file) {
+	public void write(File file) {
 		//setHeader("Etag", HttpUtil.getEtag(file));
 		setHeader("Content-Length", String.valueOf(file.length()));
-		long bytesWritten = 0;
+//		long bytesWritten = 0;
 		flush();	// write initial line + headers
-		try {
-			SocketChannel clientChannel = (SocketChannel) key.channel();
-			bytesWritten = new RandomAccessFile(file, "r").getChannel().transferTo(0, file.length(), clientChannel);
-		} catch (IOException e) {
-			logger.error("Error writing (static file) response: {}", e.getMessage());
-		}
-		return bytesWritten;
+		protocol.stage(key, file);
+//		try {
+//			SocketChannel clientChannel = (SocketChannel) key.channel();
+//			logger.debug("sending file..");
+//			bytesWritten = new RandomAccessFile(file, "r").getChannel().transferTo(0, file.length(), clientChannel);
+//			logger.debug("sent bytes: " + bytesWritten);
+//		} catch (IOException e) {
+//			logger.error("Error writing (static file) response: {}", e.getMessage());
+//		}
+//		return bytesWritten;
 	}
 
 	
diff --git a/src/test/java/org/deftserver/web/DeftSystemTest.java b/src/test/java/org/deftserver/web/DeftSystemTest.java
index d8bf07c..8f86b49 100644
--- a/src/test/java/org/deftserver/web/DeftSystemTest.java
+++ b/src/test/java/org/deftserver/web/DeftSystemTest.java
@@ -545,36 +545,36 @@ public class DeftSystemTest {
 		assertEquals("exception message", payLoad);
 	}
 
-//	@Test
-//	public void staticFileRequestTest() throws ClientProtocolException, IOException {
-//		DefaultHttpClient httpclient = new DefaultHttpClient();
-//		HttpGet httpget = new HttpGet("http://localhost:" + PORT + "/src/test/resources/test.txt");
-//		HttpResponse response = httpclient.execute(httpget);
-//
-//		assertNotNull(response);
-//		assertEquals(200, response.getStatusLine().getStatusCode());
-//		assertEquals(new ProtocolVersion("HTTP", 1, 1), response.getStatusLine().getProtocolVersion());
-//		assertEquals("OK", response.getStatusLine().getReasonPhrase());
-//		assertEquals(7, response.getAllHeaders().length);
-//		String payLoad = convertStreamToString(response.getEntity().getContent()).trim();
-//		assertEquals("test.txt", payLoad);
-//	}
-
-//	@Test
-//	public void pictureStaticFileRequestTest() throws ClientProtocolException, IOException {
-//		DefaultHttpClient httpclient = new DefaultHttpClient();
-//		HttpGet httpget = new HttpGet("http://localhost:" + PORT + "/src/test/resources/n792205362_2067.jpg");
-//		HttpResponse response = httpclient.execute(httpget);
-//
-//		assertNotNull(response);
-//		assertEquals(200, response.getStatusLine().getStatusCode());
-//		assertEquals(new ProtocolVersion("HTTP", 1, 1), response.getStatusLine().getProtocolVersion());
-//		assertEquals("OK", response.getStatusLine().getReasonPhrase());
-//		assertEquals(7, response.getAllHeaders().length);
-//		assertEquals("54963", response.getFirstHeader("Content-Length").getValue());
-//		assertEquals("image/jpeg", response.getFirstHeader("Content-Type").getValue());
-//		assertNotNull(response.getFirstHeader("Last-Modified"));
-//	}
+	@Test
+	public void staticFileRequestTest() throws ClientProtocolException, IOException {
+		DefaultHttpClient httpclient = new DefaultHttpClient();
+		HttpGet httpget = new HttpGet("http://localhost:" + PORT + "/src/test/resources/test.txt");
+		HttpResponse response = httpclient.execute(httpget);
+
+		assertNotNull(response);
+		assertEquals(200, response.getStatusLine().getStatusCode());
+		assertEquals(new ProtocolVersion("HTTP", 1, 1), response.getStatusLine().getProtocolVersion());
+		assertEquals("OK", response.getStatusLine().getReasonPhrase());
+		assertEquals(7, response.getAllHeaders().length);
+		String payLoad = convertStreamToString(response.getEntity().getContent()).trim();
+		assertEquals("test.txt", payLoad);
+	}
+
+	@Test
+	public void pictureStaticFileRequestTest() throws ClientProtocolException, IOException {
+		DefaultHttpClient httpclient = new DefaultHttpClient();
+		HttpGet httpget = new HttpGet("http://localhost:" + PORT + "/src/test/resources/n792205362_2067.jpg");
+		HttpResponse response = httpclient.execute(httpget);
+
+		assertNotNull(response);
+		assertEquals(200, response.getStatusLine().getStatusCode());
+		assertEquals(new ProtocolVersion("HTTP", 1, 1), response.getStatusLine().getProtocolVersion());
+		assertEquals("OK", response.getStatusLine().getReasonPhrase());
+		assertEquals(7, response.getAllHeaders().length);
+		assertEquals("54963", response.getFirstHeader("Content-Length").getValue());
+		assertEquals("image/jpeg", response.getFirstHeader("Content-Type").getValue());
+		assertNotNull(response.getFirstHeader("Last-Modified"));
+	}
 
 	@Test
 	public void noBodyRequest() throws ClientProtocolException, IOException {
@@ -630,20 +630,20 @@ public class DeftSystemTest {
 		channel.close();
 	}
 	
-//	@Test
-//	public void userDefinedStaticContentHandlerTest() throws ClientProtocolException, IOException {
-//		// /static_file_handler
-//		DefaultHttpClient httpclient = new DefaultHttpClient();
-//		HttpGet httpget = new HttpGet("http://localhost:" + PORT + "/static_file_handler");
-//		HttpResponse response = httpclient.execute(httpget);
-//
-//		assertNotNull(response);
-//		assertEquals(200, response.getStatusLine().getStatusCode());
-//		assertEquals(new ProtocolVersion("HTTP", 1, 1), response.getStatusLine().getProtocolVersion());
-//		assertEquals("OK", response.getStatusLine().getReasonPhrase());
-//		assertEquals(4, response.getAllHeaders().length);
-//		assertEquals("8", response.getFirstHeader("Content-Length").getValue());
-//	}
+	@Test
+	public void userDefinedStaticContentHandlerTest() throws ClientProtocolException, IOException {
+		// /static_file_handler
+		DefaultHttpClient httpclient = new DefaultHttpClient();
+		HttpGet httpget = new HttpGet("http://localhost:" + PORT + "/static_file_handler");
+		HttpResponse response = httpclient.execute(httpget);
+
+		assertNotNull(response);
+		assertEquals(200, response.getStatusLine().getStatusCode());
+		assertEquals(new ProtocolVersion("HTTP", 1, 1), response.getStatusLine().getProtocolVersion());
+		assertEquals("OK", response.getStatusLine().getReasonPhrase());
+		assertEquals(4, response.getAllHeaders().length);
+		assertEquals("8", response.getFirstHeader("Content-Length").getValue());
+	}
 
 	public String convertStreamToString(InputStream is) throws IOException {
 		if (is != null) {
