diff --git a/src/main/java/org/deftserver/web/HttpServer.java b/src/main/java/org/deftserver/web/HttpServer.java
index 2d2dc73..d5d947d 100644
--- a/src/main/java/org/deftserver/web/HttpServer.java
+++ b/src/main/java/org/deftserver/web/HttpServer.java
@@ -1,17 +1,17 @@
 package org.deftserver.web;
 
+import org.deftserver.web.protocol.HttpProtocol;
+
 
 public class HttpServer {
 	
 	private static final int MIN_PORT_NUMBER = 1;
 	private static final int MAX_PORT_NUMBER = 65535;
 
-	private final Application application;
 	private final IOLoop ioLoop;
 	
-	public HttpServer(Application app) {
-		application = app;
-		ioLoop = new IOLoop(application);
+	public HttpServer(Application application) {
+		ioLoop = new IOLoop(new HttpProtocol(application));
 	}
 
 	public IOLoop getIOLoop() {
diff --git a/src/main/java/org/deftserver/web/IOLoop.java b/src/main/java/org/deftserver/web/IOLoop.java
index f82d4e7..7c62c50 100644
--- a/src/main/java/org/deftserver/web/IOLoop.java
+++ b/src/main/java/org/deftserver/web/IOLoop.java
@@ -9,7 +9,6 @@ import java.nio.channels.ServerSocketChannel;
 import java.util.Iterator;
 
 import org.deftserver.web.protocol.Protocol;
-import org.deftserver.web.protocol.HttpProtocol;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -20,14 +19,14 @@ public class IOLoop {
 	private static final long TIMEOUT = 250;	// 0.25s in ms
 	private static final long CALLBACK_PERIOD = 2 * 1000;	//2s in ms
 
-	private final Application application;
+	private final Protocol protocol;
 	private ServerSocketChannel channel;
 	private Selector selector;
 	private long lastCallback;
 	
 
-	protected IOLoop(Application application) {
-		this.application = application;
+	protected IOLoop(Protocol protocol) {
+		this.protocol = protocol;
 		try {
 			channel = ServerSocketChannel.open();
 			channel.configureBlocking(false);
@@ -42,11 +41,10 @@ public class IOLoop {
 		//Thread.currentThread().setPriority(Thread.MAX_PRIORITY);
 
 		registerSelector();
-		Protocol protocol = new HttpProtocol(application);
 		while (true) {
 			try {
 				if (selector.select(TIMEOUT) == 0) {
-					invokeCallback(protocol);
+					invokeCallback();
 					continue;
 				}
 
@@ -61,14 +59,14 @@ public class IOLoop {
 					}
 					keys.remove();
 				}
-				invokeCallback(protocol);
+				invokeCallback();
 
 			} catch (IOException e) {
 				logger.error("Exception received in IOLoop: {}", e);			}
 		}
 	}
 
-	private void invokeCallback(Protocol protocol) {
+	private void invokeCallback() {
 		long now = System.currentTimeMillis();
 		if (now >= lastCallback + CALLBACK_PERIOD) {
 			protocol.handleCallback();
diff --git a/src/test/java/org/deftserver/web/HttpServerTest.java b/src/test/java/org/deftserver/web/HttpServerTest.java
index 0484d3c..6da0c3e 100644
--- a/src/test/java/org/deftserver/web/HttpServerTest.java
+++ b/src/test/java/org/deftserver/web/HttpServerTest.java
@@ -1,14 +1,19 @@
 package org.deftserver.web;
 
+import org.deftserver.web.handler.RequestHandler;
 import org.junit.Test;
 
+import com.google.common.collect.Maps;
 
-public class HttpServerTest {
 
+public class HttpServerTest {
+	
+	private final Application application = new Application(Maps.<String, RequestHandler>newHashMap());
+	
 	@Test(expected=IllegalArgumentException.class)
 	public void testPortInRange_low() {
 		int port = 0;
-		HttpServer server = new HttpServer(null);
+		HttpServer server = new HttpServer(application);
 		server.listen(port);
 	}
 	
@@ -16,13 +21,13 @@ public class HttpServerTest {
 	@Test(expected=IllegalArgumentException.class)
 	public void testPortInRange_high() {
 		int port = 65536;
-		HttpServer server = new HttpServer(null);
+		HttpServer server = new HttpServer(application);
 		server.listen(port);
 	}
 	
 	public void testPortInRange_ok() {
 		int port = 34;
-		HttpServer server = new HttpServer(null);
+		HttpServer server = new HttpServer(application);
 		server.listen(port);
 	}
 	
