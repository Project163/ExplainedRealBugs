{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/1677","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/1677/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/1677/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/1677/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/1677","id":68057522,"node_id":"MDU6SXNzdWU2ODA1NzUyMg==","number":1677,"title":"Risky test not counted on default console printer","user":{"login":"llaville","id":364342,"node_id":"MDQ6VXNlcjM2NDM0Mg==","avatar_url":"https://avatars.githubusercontent.com/u/364342?v=4","gravatar_id":"","url":"https://api.github.com/users/llaville","html_url":"https://github.com/llaville","followers_url":"https://api.github.com/users/llaville/followers","following_url":"https://api.github.com/users/llaville/following{/other_user}","gists_url":"https://api.github.com/users/llaville/gists{/gist_id}","starred_url":"https://api.github.com/users/llaville/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/llaville/subscriptions","organizations_url":"https://api.github.com/users/llaville/orgs","repos_url":"https://api.github.com/users/llaville/repos","events_url":"https://api.github.com/users/llaville/events{/privacy}","received_events_url":"https://api.github.com/users/llaville/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-04-13T09:49:35Z","updated_at":"2015-04-29T04:43:14Z","closed_at":"2015-04-29T04:43:14Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I've run tests with PHPUnit 4.5.1 and 4.6.4 and get same issue on both versions. \nRisky test not counted on final results.\n\nExpected\n\n```\nFAILURES!\nTests: 4, Assertions: 2, Failures: 1, Incomplete: 1, Skipped: 1, Risky: 1.\n```\n\nActual \n\n```\nFAILURES!\nTests: 4, Assertions: 2, Failures: 1, Incomplete: 1, Skipped: 1.\n```\n\nMy simple demo test suite is `testSuite.php`\n\n``` php\n<?php\n\nnamespace Your\\Name_Space;\n\nclass YourTestSuite extends \\PHPUnit_Framework_TestCase\n{\n    public function testIncomplete()\n    {\n        // Optional: Test anything here, if you want.\n        $this->assertTrue(TRUE, 'This should already work.');\n\n        // Stop here and mark this test as incomplete.\n        $this->markTestIncomplete(\n          'This test has not been implemented yet.'\n        );\n    }\n\n    public function testRisky()\n    {\n    }\n\n    public function testSkipped()\n    {\n        $this->markTestSkipped('This test was skipped for any reason.');\n    }\n\n    public function testFailure()\n    {\n        $this->assertEmpty(array('foo'));\n    }\n}\n```\n\nMy `phpunit.xml` config file is \n\n``` xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<phpunit \n    backupGlobals=\"true\"\n    backupStaticAttributes=\"false\"\n    bootstrap=\"\"\n    colors=\"false\"\n    stopOnError=\"false\"\n    stopOnFailure=\"false\"\n    stopOnIncomplete=\"false\"\n    stopOnRisky=\"false\"\n    stopOnSkipped=\"false\"\n    strict=\"true\"\n    verbose=\"false\"\n>\n    <listeners>\n        <listener class=\"Foo\\SimpleTestListener\">\n        </listener>\n    </listeners>\n    <testsuites>\n        <testsuite name=\"Demo Test Suite\">\n            <file>testSuite.php</file>\n        </testsuite>\n    </testsuites>    \n</phpunit>\n```\n\nInvoking command \n\n```\nphpunit-4.5.1.phar  -c phpunit.xml\n```\n\nGive\n\n```\nPHPUnit 4.5.1 by Sebastian Bergmann and contributors.\n\nConfiguration read from C:\\var\\phpunit\\issues\\riskyTest\\phpunit.xml\n\nDeprecated configuration setting \"strict\" used\n\nIRSF\n\nTime: 82 ms, Memory: 4.00Mb\n\nThere was 1 failure:\n\n1) Your\\Name_Space\\YourTestSuite::testFailure\nFailed asserting that an array is empty.\n\nC:\\var\\phpunit\\issues\\riskyTest\\testSuite.php:29\n\nFAILURES!\nTests: 4, Assertions: 2, Failures: 1, Incomplete: 1, Skipped: 1.\n```\n\nInvoking command \n\n```\nphpunit-4.6.4.phar  -c phpunit.xml --report-useless-tests\n```\n\nGive\n\n```\nPHPUnit 4.6.4 by Sebastian Bergmann and contributors.\n\nConfiguration read from C:\\var\\phpunit\\issues\\riskyTest\\phpunit.xml\n\nDeprecated configuration setting \"strict\" used\n\nIRSF\n\nTime: 344 ms, Memory: 8.25Mb\n\nThere was 1 failure:\n\n1) Your\\Name_Space\\YourTestSuite::testFailure\nFailed asserting that an array is empty.\n\nC:\\var\\phpunit\\issues\\riskyTest\\testSuite.php:29\n\nFAILURES!\nTests: 4, Assertions: 2, Failures: 1, Incomplete: 1, Skipped: 1.\n```\n\nBut, the test listener count all tests (including risky).\n\nAdd the simple `Foo\\SimpleTestListener` class in a file named `SimpleTestListener.php` (already defined in `phpunit.xml`)\n\n``` php\n<?php\n\nnamespace Foo;\n\nuse PHPUnit_Util_Printer;\nuse PHPUnit_Framework_TestListener;\nuse PHPUnit_Framework_Test;\nuse PHPUnit_Framework_TestSuite;\nuse PHPUnit_Framework_AssertionFailedError;\nuse Exception;\n\nclass SimpleTestListener implements PHPUnit_Framework_TestListener\n{\n    public function addError(PHPUnit_Framework_Test $test, Exception $e, $time)\n    {\n        printf(\"Error while running test '%s'.\\n\", $test->getName());\n    }\n    public function addFailure(PHPUnit_Framework_Test $test, PHPUnit_Framework_AssertionFailedError $e, $time)\n    {\n        printf(\"Test '%s' failed.\\n\", $test->getName());\n    }\n    public function addIncompleteTest(PHPUnit_Framework_Test $test, Exception $e, $time)\n    {\n        printf(\"Test '%s' is incomplete.\\n\", $test->getName());\n    }\n    public function addRiskyTest(PHPUnit_Framework_Test $test, Exception $e, $time)\n    {\n        printf(\"Test '%s' is deemed risky.\\n\", $test->getName());\n    }\n    public function addSkippedTest(PHPUnit_Framework_Test $test, Exception $e, $time)\n    {\n        printf(\"Test '%s' has been skipped.\\n\", $test->getName());\n    }\n    public function startTest(PHPUnit_Framework_Test $test)\n    {\n        printf(\"Test '%s' started.\\n\", $test->getName());\n    }\n    public function endTest(PHPUnit_Framework_Test $test, $time)\n    {\n        printf(\"Test '%s' ended.\\n\", $test->getName());        \n    }\n    public function startTestSuite(PHPUnit_Framework_TestSuite $suite)\n    {\n        printf(\"TestSuite '%s' started with %d tests.\\n\", $suite->getName(), $suite->count());\n    }\n    public function endTestSuite(PHPUnit_Framework_TestSuite $suite)\n    {\n        printf(\"TestSuite '%s' ended.\\n\", $suite->getName());\n    }\n}\n```\n\nThe bootstrap file \n\n``` php\n<?php\nrequire_once __DIR__ . DIRECTORY_SEPARATOR . 'SimpleTestListener.php';\n```\n\nAnd invoke command with both versions (4.5.1 or 4.6.4)\n\n```\nphpunit.phar -c phpunit.xml --report-useless-tests --bootstrap bootstrap.php\n```\n\nGive such output\n\n```\nTestSuite 'Demo Test Suite' started with 4 tests.\nTestSuite 'Your\\Name_Space\\YourTestSuite' started with 4 tests.\nTest 'testIncomplete' started.\nTest 'testIncomplete' is incomplete.\nITest 'testIncomplete' ended.\nTest 'testRisky' started.\nTest 'testRisky' is deemed risky.\nRTest 'testRisky' ended.\nTest 'testSkipped' started.\nTest 'testSkipped' has been skipped.\nSTest 'testSkipped' ended.\nTest 'testFailure' started.\nTest 'testFailure' failed.\nFTest 'testFailure' ended.\nTestSuite 'Your\\Name_Space\\YourTestSuite' ended.\nTestSuite 'Demo Test Suite' ended.\n```\n\nMy Platform : Windows / PHP 5.6.7\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/1677/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/1677/timeline","performed_via_github_app":null,"state_reason":"completed"}