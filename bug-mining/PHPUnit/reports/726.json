{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5210","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5210/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5210/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5210/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/5210","id":1590316427,"node_id":"I_kwDOAAbWLc5eyk2L","number":5210,"title":"Exceptions raised in TestCase::tearDown() are not handled correctly","user":{"login":"adalessa","id":7914601,"node_id":"MDQ6VXNlcjc5MTQ2MDE=","avatar_url":"https://avatars.githubusercontent.com/u/7914601?v=4","gravatar_id":"","url":"https://api.github.com/users/adalessa","html_url":"https://github.com/adalessa","followers_url":"https://api.github.com/users/adalessa/followers","following_url":"https://api.github.com/users/adalessa/following{/other_user}","gists_url":"https://api.github.com/users/adalessa/gists{/gist_id}","starred_url":"https://api.github.com/users/adalessa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adalessa/subscriptions","organizations_url":"https://api.github.com/users/adalessa/orgs","repos_url":"https://api.github.com/users/adalessa/repos","events_url":"https://api.github.com/users/adalessa/events{/privacy}","received_events_url":"https://api.github.com/users/adalessa/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":44001,"node_id":"MDU6TGFiZWw0NDAwMQ==","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/type/bug","name":"type/bug","color":"cc0000","default":false,"description":"Something is broken"},{"id":5111411238,"node_id":"LA_kwDOAAbWLc8AAAABMKnyJg","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/version/10","name":"version/10","color":"888a85","default":false,"description":"Something affects PHPUnit 10"}],"state":"closed","locked":false,"assignee":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":2,"created_at":"2023-02-18T11:28:30Z","updated_at":"2023-02-18T12:51:39Z","closed_at":"2023-02-18T12:51:38Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"| Q                   | A\r\n| --------------------| ---------------\r\n| PHPUnit version     | 10.0.7\r\n| PHP version         | 8.2.2\r\n| Installation Method | Composer\r\n\r\n#### Summary\r\n\r\nAny exception thrown during the tear down is not reflected as an error on the test result nor the test is mark as failed.\r\nI detected this due the use of the tear down to perform the check for Mockery with the `Mockery::close()` even when I expected the test to fail, the test is still passing which is wrong. After investigating detected that is not a mockery issue since is throwing the exception as expected but phpunit is not reporting the error.\r\n\r\n#### Current behavior\r\n\r\nTest are passing even when during the `tearDown` of the test an exception is throw.\r\n\r\n#### How to reproduce\r\n\r\nCreate a simple test which during the tear down throw an exception\r\n```php\r\n    public function test_it_should_fail(): void\r\n    {\r\n        $this->assertTrue(true);\r\n    }\r\n\r\n    protected function tearDown(): void\r\n    {\r\n        throw new \\Exception('test');\r\n    }\r\n\r\n```\r\n\r\n#### Expected behavior\r\n\r\nThe tests should fail with the message provided by the exception.\r\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5210/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5210/timeline","performed_via_github_app":null,"state_reason":"completed"}