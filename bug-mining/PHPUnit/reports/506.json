{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/3697","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/3697/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/3697/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/3697/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/3697","id":446413707,"node_id":"MDU6SXNzdWU0NDY0MTM3MDc=","number":3697,"title":"@codeCoverageIgnore on a docblock should prevent driver start/stop","user":{"login":"andrewnicols","id":370047,"node_id":"MDQ6VXNlcjM3MDA0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/370047?v=4","gravatar_id":"","url":"https://api.github.com/users/andrewnicols","html_url":"https://github.com/andrewnicols","followers_url":"https://api.github.com/users/andrewnicols/followers","following_url":"https://api.github.com/users/andrewnicols/following{/other_user}","gists_url":"https://api.github.com/users/andrewnicols/gists{/gist_id}","starred_url":"https://api.github.com/users/andrewnicols/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrewnicols/subscriptions","organizations_url":"https://api.github.com/users/andrewnicols/orgs","repos_url":"https://api.github.com/users/andrewnicols/repos","events_url":"https://api.github.com/users/andrewnicols/events{/privacy}","received_events_url":"https://api.github.com/users/andrewnicols/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":44002,"node_id":"MDU6TGFiZWw0NDAwMg==","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/type/enhancement","name":"type/enhancement","color":"73d216","default":false,"description":"A new idea that should be implemented"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-05-21T00:26:10Z","updated_at":"2019-05-21T11:39:12Z","closed_at":"2019-05-21T05:17:41Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"| Q                         | A\r\n| --------------------------| ---------------\r\n| php-code-coverage version | 6.1.4\r\n| PHP version               | 7.2.18\r\n| Driver                    | PHPDBG\r\n| Xdebug version (if used)  | x.y.z\r\n| Installation Method       | Composer\r\n| Usage Method              | PHPUnit\r\n| PHPUnit version (if used) | 7.5.9\r\n\r\nAt the moment if you specify `@codeCoverageIgnore` on an individual test function or testcase class then that entire test or group of tests is not included in coverage generation. However, this only filters the data which is collected, rather than preventing the collection in the first place.\r\n\r\nWhilst the collection is still required in some situations, specifically where a single line is ignored (`// @codeCoverageIgnore`), or a range of lines via the `@codeCoverageIgnoreStart` and `@codeCoverageIgnoreEnd` tags, where the entire class or an entire function is ignored then I feel it would be prudent to not start the driver at all.\r\n\r\nThis becomes a problem when testing large and complex datasets as the fact that the driver is logging at all causes high memory consumption leading to out of memory. To give a more concrete example, we have one dataset related to machine learning where generation of the data consumes 76GB of memory via opcache alone. At the moment our only solutions are to either add a `@group` tag to the relevant test and ignore it from phpunit when we wish to generate coverage at all, or to add a hack before and after the test to stop/restart the opcache logging if it is enabled.\r\n\r\nI'd like to propose that  php-code-coverage either:\r\n* does not start/stop the driver if the `@codeCoverageIgnore` tag is applied to an entire testcase class, or test function within that testcase class; or\r\n* a new tag is added to support the same functionality.\r\n\r\nI'm aware that xdebug now supports some filters, but unfortunately phpdbg does not do so yet.\r\n\r\nIf you feel that this would be a beneficial change I'm more than happy to help in its development.","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/3697/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/3697/timeline","performed_via_github_app":null,"state_reason":"completed"}