{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6354","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6354/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6354/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6354/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/6354","id":3391767183,"node_id":"I_kwDOAAbWLc7KKkKP","number":6354,"title":"Invokable constraints","user":{"login":"linepogl","id":464549,"node_id":"MDQ6VXNlcjQ2NDU0OQ==","avatar_url":"https://avatars.githubusercontent.com/u/464549?v=4","gravatar_id":"","url":"https://api.github.com/users/linepogl","html_url":"https://github.com/linepogl","followers_url":"https://api.github.com/users/linepogl/followers","following_url":"https://api.github.com/users/linepogl/following{/other_user}","gists_url":"https://api.github.com/users/linepogl/gists{/gist_id}","starred_url":"https://api.github.com/users/linepogl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/linepogl/subscriptions","organizations_url":"https://api.github.com/users/linepogl/orgs","repos_url":"https://api.github.com/users/linepogl/repos","events_url":"https://api.github.com/users/linepogl/events{/privacy}","received_events_url":"https://api.github.com/users/linepogl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":44002,"node_id":"MDU6TGFiZWw0NDAwMg==","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/type/enhancement","name":"type/enhancement","color":"73d216","default":false,"description":"A new idea that should be implemented"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2025-09-07T16:14:43Z","updated_at":"2025-09-23T15:36:11Z","closed_at":"2025-09-23T14:45:08Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- Provide a summary of the feature you would like to see implemented. -->\nPHP 8.5 is coming soon. I believe that PHPUnit's constraints is a very good use case for the new pipe operator.\n\nThe new pipe operator forwards a value to any kind of callable, **including invokable objects**. If PHPUnit's constraints were invokable, then they could be used with the new pipe operator to directly test some value against a constraint.\n\nI have created a proof-of-concept here: https://github.com/linepogl/should\n\n\nExample of an invocable constraint:\n```php\nfinal class IsEqual extends Constraint\n{\n    ...\n\n    /**\n     * @template A\n     * @param A $actual\n     * @return A\n     */\n    #[Override]\n    public function __invoke(mixed $actual): mixed\n    {\n        Assert::assertThat($actual, $this);\n        return $actual;\n    }\n\n    ...\n}\n```\nUsage:\n```php\n$actual |> new IsEqual('test')\n```\n\n## Benefits\n\n### Readability\n\nInvokable constraints give a syntax similar to `expect( $actual )->to...` for free.\n\n```\n// (current)\nAssert::assertThat(new IsEqual('test'), $actual);\n\n// (proposed)\n$actual |> new IsEqual('test');\n```\n\n### Static type checking\n\nSince every `__invoke` method has its own signature, the acceptable types of the `$actual` value can be statically defined and checked:\n\n```\n$actual = 5;\n\n// (current) \n// The generic signature of `assertThat` does not help static type checkers\n// resulting in a run-time TypeError: expected string, got int\nAssert::assertThat(new RegularExpression('/test/'), $actual); \n\n// (proposed)\n// A tailored signature for `__invoke` of the constraint `RegularExpression`\n// makes it possible to detect the error statically\n$actual |> new RegularExpression('/test/');\n```\n\n### Static type narrowing\n\nAgain the signature of `__invoke` can be used to pass type narrowing instructions to the static type checker.\n\n```\n// (current) \n// impossible to statically determine what's the type of $actual\nAssert::assertThat(new IsString(), $actual); \n\n// (proposed)\n// thanks to the signature of `__invoke`, it's possible to narrow the type of $actual to string, \n$actual |> new IsString();\n```\n\n\n### Simple chaining\n\nTesting a value against multiple constraints can be easy with the proposed syntax\n\n```\n// (proposed)\n$actual\n|> new IsString()\n|> new RegularExpression('/test/');\n```\n\n### Minor expectation parameters placement\n\nThe minor parameters of an assertion, like delta in the example below, are conceptually part of the expectation. However, the order of the arguments separates them from the expected value:\n\n```\n// (current)\nAssert::assertEqualsWithDelta(5, $actual, 0.05);\n```\n\nWith the proposed syntax, the minor expectation parameters are nicely grouped with the expected value:\n\n```\n// (proposed)\n$actual |> new IsEqualWithDelta(5, 0.05);\n```\n\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6354/reactions","total_count":4,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":2,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6354/timeline","performed_via_github_app":null,"state_reason":"completed"}