{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6391","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6391/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6391/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6391/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/6391","id":3507994817,"node_id":"I_kwDOAAbWLc7RF8DB","number":6391,"title":"Errors during backup of global variables and static properties are not reported","user":{"login":"Daimona","id":38216014,"node_id":"MDQ6VXNlcjM4MjE2MDE0","avatar_url":"https://avatars.githubusercontent.com/u/38216014?v=4","gravatar_id":"","url":"https://api.github.com/users/Daimona","html_url":"https://github.com/Daimona","followers_url":"https://api.github.com/users/Daimona/followers","following_url":"https://api.github.com/users/Daimona/following{/other_user}","gists_url":"https://api.github.com/users/Daimona/gists{/gist_id}","starred_url":"https://api.github.com/users/Daimona/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Daimona/subscriptions","organizations_url":"https://api.github.com/users/Daimona/orgs","repos_url":"https://api.github.com/users/Daimona/repos","events_url":"https://api.github.com/users/Daimona/events{/privacy}","received_events_url":"https://api.github.com/users/Daimona/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":44001,"node_id":"MDU6TGFiZWw0NDAwMQ==","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/type/bug","name":"type/bug","color":"cc0000","default":false,"description":"Something is broken"},{"id":5111411238,"node_id":"LA_kwDOAAbWLc8AAAABMKnyJg","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/version/10","name":"version/10","color":"888a85","default":false,"description":"Something affects PHPUnit 10"},{"id":6451629111,"node_id":"LA_kwDOAAbWLc8AAAABgIwMNw","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/version/11","name":"version/11","color":"888a85","default":false,"description":"Something affects PHPUnit 11"},{"id":7573337865,"node_id":"LA_kwDOAAbWLc8AAAABw2f3CQ","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/version/12","name":"version/12","color":"888a85","default":false,"description":"Something affects PHPUnit 12"}],"state":"closed","locked":false,"assignee":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":5,"created_at":"2025-10-12T22:52:13Z","updated_at":"2025-10-14T05:34:08Z","closed_at":"2025-10-14T05:14:24Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"| Q                   | A\n| --------------------| ---------------\n| PHPUnit version     | 12.4.1\n| PHP version         | 8.4.12\n| Installation Method | Composer\n\n```\n$ composer info | sort\nmyclabs/deep-copy            1.13.4 Create deep copies (clones) of your objects\nnikic/php-parser             5.6.1  A PHP parser written in PHP\nphar-io/manifest             2.0.4  Component for reading phar.io manifest information from a PHP Archive (PHAR)\nphar-io/version              3.2.1  Library for handling version information and constraints\nphpunit/php-code-coverage    12.4.0 Library that provides collection, processing, and rendering functionality for PHP code coverage information.\nphpunit/php-file-iterator    6.0.0  FilterIterator implementation that filters files based on a list of suffixes.\nphpunit/php-invoker          6.0.0  Invoke callables with a timeout\nphpunit/php-text-template    5.0.0  Simple template engine.\nphpunit/php-timer            8.0.0  Utility class for timing\nphpunit/phpunit              12.4.1 The PHP Unit Testing framework.\nsebastian/cli-parser         4.2.0  Library for parsing CLI options\nsebastian/comparator         7.1.3  Provides the functionality to compare PHP values for equality\nsebastian/complexity         5.0.0  Library for calculating the complexity of PHP code units\nsebastian/diff               7.0.0  Diff implementation\nsebastian/environment        8.0.3  Provides functionality to handle HHVM/PHP environments\nsebastian/exporter           7.0.2  Provides the functionality to export PHP variables for visualization\nsebastian/global-state       8.0.2  Snapshotting of global state\nsebastian/lines-of-code      4.0.0  Library for counting the lines of code in PHP source code\nsebastian/object-enumerator  7.0.0  Traverses array structures and object graphs to enumerate all referenced objects\nsebastian/object-reflector   5.0.0  Allows reflection of object attributes, including inherited and non-public ones\nsebastian/recursion-context  7.0.1  Provides functionality to recursively process PHP variables\nsebastian/type               6.0.3  Collection of value objects that represent the types of the PHP type system\nsebastian/version            6.0.0  Library that helps with managing the version number of Git-hosted PHP projects\nstaabm/side-effects-detector 1.0.5  A static analysis tool to detect side effects in PHP code\ntheseer/tokenizer            1.2.3  A small library for converting tokenized PHP source code into XML and potentially other formats\n```\n\n```\n$ vendor/bin/phpunit --check-php-configuration\nPHPUnit 12.4.1 by Sebastian Bergmann and contributors.\n\nChecking whether PHP is configured according to https://docs.phpunit.de/en/12.4/installation.html#configuring-php-for-development\n\ndisplay_errors = On         ... not ok ()\ndisplay_startup_errors = On ... not ok ()\nerror_reporting = -1        ... not ok (22527)\nzend.assertions = 1         ... ok\nassert.exception = 1        ... ok\nmemory_limit = -1           ... ok\n```\n\n(I have normal dev settings, not sure why it says \"not ok\")\n\n#### Summary\n\nPreconditions:\n- Static property backup is enabled\n- A value class V forbids serialization by throwing an error in `__unserialize`\n- There exists somewhere a static property holding an instance of V\n- This static property is initialized before tests run\n- PHPUnit tries to backup that static property\n\nThe thrown error will be swallowed silently and not reported to the user.\n\n#### Current behavior\n\nThere is no trace that an error occurred. Other tests in the same test class will not run. The only way to find out that something is wrong is by noticing that the number of executed tests is \"lower than usual\", or by individually running a test and noticing that it doesn't execute. For a codebase with many tests, errors could remain unnoticed for a long time.\n\n#### How to reproduce\n\nMinimal test case:\n\n**ValueClass.php**\n```php\n<?php\n\nclass ValueClass {\n\tpublic static $instance;\n\n\tpublic function __unserialize( array $data ): void {\n\t\tthrow new Error(\"Cannot unserialize '$this'\");\n\t}\n}\n```\n\n**MyTest.php**\n```php\n<?php\n\nrequire 'ValueClass.php';\n\nuse PHPUnit\\Framework\\TestCase;\n\nclass MyTest extends TestCase {\n\tpublic static function setUpBeforeClass(): void {\n\t\tValueClass::$instance = new ValueClass;\n\t}\n\n\tpublic function testFoo() {\n\t\t$this->assertTrue( true );\n\t}\n}\n```\n\nAnd then run:\n\n```\ncomposer require --dev \"phpunit/phpunit\"\nvendor/bin/phpunit --static-backup MyTest.php\n```\n\n#### Expected behavior\n\nI'm not sure because I didn't check why exactly the error is swallowed. However, I think PHPUnit should either ignore the error and continue executing the test, or report the error to the user, together with the fact that the test was not executed (similar to when there is an error in a data provider).\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6391/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6391/timeline","performed_via_github_app":null,"state_reason":"completed"}