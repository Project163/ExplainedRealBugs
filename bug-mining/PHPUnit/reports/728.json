{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5219","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5219/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5219/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5219/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/5219","id":1590702277,"node_id":"I_kwDOAAbWLc5e0DDF","number":5219,"title":"Exceptions thrown in event subscribers affect how tests are run and/or how their outcome is evaluated","user":{"login":"cspray","id":771345,"node_id":"MDQ6VXNlcjc3MTM0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/771345?v=4","gravatar_id":"","url":"https://api.github.com/users/cspray","html_url":"https://github.com/cspray","followers_url":"https://api.github.com/users/cspray/followers","following_url":"https://api.github.com/users/cspray/following{/other_user}","gists_url":"https://api.github.com/users/cspray/gists{/gist_id}","starred_url":"https://api.github.com/users/cspray/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cspray/subscriptions","organizations_url":"https://api.github.com/users/cspray/orgs","repos_url":"https://api.github.com/users/cspray/repos","events_url":"https://api.github.com/users/cspray/events{/privacy}","received_events_url":"https://api.github.com/users/cspray/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":44001,"node_id":"MDU6TGFiZWw0NDAwMQ==","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/type/bug","name":"type/bug","color":"cc0000","default":false,"description":"Something is broken"},{"id":1329317012,"node_id":"MDU6TGFiZWwxMzI5MzE3MDEy","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/feature/test-runner","name":"feature/test-runner","color":"e9b96e","default":false,"description":"CLI test runner"},{"id":3054889839,"node_id":"MDU6TGFiZWwzMDU0ODg5ODM5","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/feature/events","name":"feature/events","color":"e9b96e","default":false,"description":"Issues related to PHPUnit's event system"},{"id":5111411238,"node_id":"LA_kwDOAAbWLc8AAAABMKnyJg","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/version/10","name":"version/10","color":"888a85","default":false,"description":"Something affects PHPUnit 10"}],"state":"closed","locked":false,"assignee":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":7,"created_at":"2023-02-19T14:11:50Z","updated_at":"2023-02-19T16:28:37Z","closed_at":"2023-02-19T16:09:29Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"| Q                   | A\r\n| --------------------| ---------------\r\n| PHPUnit version     | 10.0.9\r\n| PHP version         | 8.2.3\r\n| Installation Method | Composer\r\n\r\n#### Summary\r\n\r\nA `PHPUnit\\Event\\Test\\PreparationStartedSubscriber` throws an Exception.\r\n\r\n#### Current behavior\r\n\r\nThe test that has had preparation started is silently discarded. There are no indications that the test failed.\r\n\r\n#### How to reproduce\r\n\r\n1. Create an Extension.\r\n2. Register a PreparationStartedSubscriber and throw an Exception.\r\n3. Ensure the Extension is set to be loaded in your PHPUnit Configuration.\r\n4. Execute PHPUnit and see that no tests are run.\r\n\r\nI have also reproduced this in an isolated repo: https://github.com/cspray/phpunit10-bugs under the `PreparationStartedException` directory.\r\n\r\n#### Expected behavior\r\n\r\nI would expect a test that has an exception thrown in a `PreparationStartedSubscriber` to be properly marked as a failure/error with information on the Exception that was thrown.\r\n\r\n#### Composer Info Output\r\n\r\n```\r\nmyclabs/deep-copy                  1.11.0             Create deep copies (clones) of your objects\r\nnikic/php-parser                   v4.15.3            A PHP parser written in PHP\r\nphar-io/manifest                   2.0.3              Component for reading phar.io manifest information from a PHP Archive (PHAR)\r\nphar-io/version                    3.2.1              Library for handling version information and constraints\r\nphpunit/php-code-coverage          10.0.0             Library that provides collection, processing, and rendering functionality for PHP code coverage information.\r\nphpunit/php-file-iterator          4.0.1              FilterIterator implementation that filters files based on a list of suffixes.\r\nphpunit/php-invoker                4.0.0              Invoke callables with a timeout\r\nphpunit/php-text-template          3.0.0              Simple template engine.\r\nphpunit/php-timer                  6.0.0              Utility class for timing\r\nphpunit/phpunit                    10.0.9             The PHP Unit Testing framework.\r\nroave/security-advisories          dev-latest 9206ad5 Prevents installation of composer packages with known security vulnerabilities: no API, simply require it\r\nsebastian/cli-parser               2.0.0              Library for parsing CLI options\r\nsebastian/code-unit                2.0.0              Collection of value objects that represent the PHP code units\r\nsebastian/code-unit-reverse-lookup 3.0.0              Looks up which function or method a line of code belongs to\r\nsebastian/comparator               5.0.0              Provides the functionality to compare PHP values for equality\r\nsebastian/complexity               3.0.0              Library for calculating the complexity of PHP code units\r\nsebastian/diff                     5.0.0              Diff implementation\r\nsebastian/environment              6.0.0              Provides functionality to handle HHVM/PHP environments\r\nsebastian/exporter                 5.0.0              Provides the functionality to export PHP variables for visualization\r\nsebastian/global-state             6.0.0              Snapshotting of global state\r\nsebastian/lines-of-code            2.0.0              Library for counting the lines of code in PHP source code\r\nsebastian/object-enumerator        5.0.0              Traverses array structures and object graphs to enumerate all referenced objects\r\nsebastian/object-reflector         3.0.0              Allows reflection of object attributes, including inherited and non-public ones\r\nsebastian/recursion-context        5.0.0              Provides functionality to recursively process PHP variables\r\nsebastian/type                     4.0.0              Collection of value objects that represent the types of the PHP type system\r\nsebastian/version                  4.0.1              Library that helps with managing the version number of Git-hosted PHP projects\r\ntheseer/tokenizer                  1.2.1              A small library for converting tokenized PHP source code into XML and potentially other formats\r\n```\r\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5219/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5219/timeline","performed_via_github_app":null,"state_reason":"completed"}