{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/1953","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/1953/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/1953/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/1953/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/1953","id":117131996,"node_id":"MDU6SXNzdWUxMTcxMzE5OTY=","number":1953,"title":"PHP7 syntax error causes \"must be an instance of Exception, instance of Error given\" error","user":{"login":"gmagana","id":505453,"node_id":"MDQ6VXNlcjUwNTQ1Mw==","avatar_url":"https://avatars.githubusercontent.com/u/505453?v=4","gravatar_id":"","url":"https://api.github.com/users/gmagana","html_url":"https://github.com/gmagana","followers_url":"https://api.github.com/users/gmagana/followers","following_url":"https://api.github.com/users/gmagana/following{/other_user}","gists_url":"https://api.github.com/users/gmagana/gists{/gist_id}","starred_url":"https://api.github.com/users/gmagana/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmagana/subscriptions","organizations_url":"https://api.github.com/users/gmagana/orgs","repos_url":"https://api.github.com/users/gmagana/repos","events_url":"https://api.github.com/users/gmagana/events{/privacy}","received_events_url":"https://api.github.com/users/gmagana/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2015-11-16T14:11:04Z","updated_at":"2021-02-01T03:14:57Z","closed_at":"2015-11-20T13:51:02Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Due to PHP7's new parent of Exception (called \"Throwable\") and because syntax errors are now catchable and thrown as type \"Error\" (which inherits from Throwable and not from Exception), running phpunit (as of 5.0.9) on a script with a syntax error causes a rather unhelpful error message of\n\n```\nPHP Fatal error:  Uncaught TypeError: Argument 2 passed to PHPUnit_Framework_TestResult::addError() must be an instance of Exception, instance of Error given, called in phar:///usr/local/bin/phpunit/phpunit/Framework/TestSuite.php on line 724 and defined in phar:///usr/local/bin/phpunit/phpunit/Framework/TestResult.php:202\nStack trace:\n#0 phar:///usr/local/bin/phpunit/phpunit/Framework/TestSuite.php(724): PHPUnit_Framework_TestResult->addError(Object(PHPUnit_Framework_TestSuite), Object(Error), 0)\n#1 phar:///usr/local/bin/phpunit/phpunit/Framework/TestSuite.php(747): PHPUnit_Framework_TestSuite->run(Object(PHPUnit_Framework_TestResult))\n#2 phar:///usr/local/bin/phpunit/phpunit/TextUI/TestRunner.php(425): PHPUnit_Framework_TestSuite->run(Object(PHPUnit_Framework_TestResult))\n#3 phar:///usr/local/bin/phpunit/phpunit/TextUI/Command.php(154): PHPUnit_TextUI_TestRunner->doRun(Object(PHPUnit_Framework_TestSuite), Array)\n#4 phar:///usr/local/bin/phpunit/phpunit/TextUI/Command.php(105): PHPUnit_TextUI_Command->run(Array, true)\n#5 /usr in phar:///usr/local/bin/phpunit/phpunit/Framework/TestResult.php on line 202\n```\n\nCurrently in order to see what the error actually is, we need to then run the code outside of phpunit to see the actual syntax error messaging.\n\nThe request for this ticket is to handle the error gracefully and output PHP's error stack so that we may fix the syntax error.  Thanks!\n\nPS - In order to future-proof phpunit, maybe it would be good to var_dump() the error that _was_ received in case it helps the user pinpoint the problem.\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/1953/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/1953/timeline","performed_via_github_app":null,"state_reason":"completed"}