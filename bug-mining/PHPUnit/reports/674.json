{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4835","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4835/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4835/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4835/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/4835","id":1065799716,"node_id":"I_kwDOAAbWLc4_htAk","number":4835,"title":"Support for Composer 2.2 _composer_autoload_path global","user":{"login":"Seldaek","id":183678,"node_id":"MDQ6VXNlcjE4MzY3OA==","avatar_url":"https://avatars.githubusercontent.com/u/183678?v=4","gravatar_id":"","url":"https://api.github.com/users/Seldaek","html_url":"https://github.com/Seldaek","followers_url":"https://api.github.com/users/Seldaek/followers","following_url":"https://api.github.com/users/Seldaek/following{/other_user}","gists_url":"https://api.github.com/users/Seldaek/gists{/gist_id}","starred_url":"https://api.github.com/users/Seldaek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Seldaek/subscriptions","organizations_url":"https://api.github.com/users/Seldaek/orgs","repos_url":"https://api.github.com/users/Seldaek/repos","events_url":"https://api.github.com/users/Seldaek/events{/privacy}","received_events_url":"https://api.github.com/users/Seldaek/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":44002,"node_id":"MDU6TGFiZWw0NDAwMg==","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/type/enhancement","name":"type/enhancement","color":"73d216","default":false,"description":"A new idea that should be implemented"},{"id":2046354876,"node_id":"MDU6TGFiZWwyMDQ2MzU0ODc2","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/installation/composer","name":"installation/composer","color":"729fcf","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-11-29T09:26:00Z","updated_at":"2021-11-29T13:16:37Z","closed_at":"2021-11-29T13:16:37Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Composer 2.2.0 (releasing early December hopefully) will [introduce](https://github.com/composer/composer/pull/10137) a new $_composer_autoload_path global variable which is defined when running a Composer binary. See [docs for the new feature](https://getcomposer.org/doc/articles/vendor-binaries.md#finding-the-composer-autoloader-from-a-binary).\r\n\r\nEssentially when running `vendor/bin/phpunit`, instead of running a symlink to `vendor/phpunit/phpunit/phpunit`, Composer will add an intermediate PHP proxy file which looks like this:\r\n\r\n```\r\n#!/usr/bin/env php\r\n<?php\r\n\r\n/**\r\n * Proxy PHP file generated by Composer\r\n *\r\n * This file includes the referenced bin path (../phpunit/phpunit/phpunit)\r\n *\r\n * @generated\r\n */\r\n\r\n$GLOBALS['_composer_autoload_path'] = __DIR__ . '/..'.'/autoload.php';\r\n\r\ninclude __DIR__ . '/..'.'/phpunit/phpunit/phpunit';\r\n```\r\n\r\nThis means these lines could be changed to support the new variable if present: https://github.com/sebastianbergmann/phpunit/blob/9b18457e015823cf319b3a9cb2edfd8744364a36/phpunit#L61-L67\r\n\r\nBut the main reason I wanted to point this out is that this will define a new global variable, so any test relying on a given global state might see differences. I'm hoping there aren't too many of these out there, but who knows.\r\n\r\nOne thing PHPUnit could do is unset the global variable in the bootstrap to ensure it's back to a clean state.","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4835/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4835/timeline","performed_via_github_app":null,"state_reason":"completed"}