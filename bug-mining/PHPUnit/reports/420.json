{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/385","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/385/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/385/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/385/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/385","id":2062955,"node_id":"MDU6SXNzdWUyMDYyOTU1","number":385,"title":"TestSuite inheritance","user":{"login":"dmitri--","id":1101301,"node_id":"MDQ6VXNlcjExMDEzMDE=","avatar_url":"https://avatars.githubusercontent.com/u/1101301?v=4","gravatar_id":"","url":"https://api.github.com/users/dmitri--","html_url":"https://github.com/dmitri--","followers_url":"https://api.github.com/users/dmitri--/followers","following_url":"https://api.github.com/users/dmitri--/following{/other_user}","gists_url":"https://api.github.com/users/dmitri--/gists{/gist_id}","starred_url":"https://api.github.com/users/dmitri--/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmitri--/subscriptions","organizations_url":"https://api.github.com/users/dmitri--/orgs","repos_url":"https://api.github.com/users/dmitri--/repos","events_url":"https://api.github.com/users/dmitri--/events{/privacy}","received_events_url":"https://api.github.com/users/dmitri--/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2011-10-26T23:36:09Z","updated_at":"2011-10-31T07:24:28Z","closed_at":"2011-10-31T07:24:28Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"my case is very simple:\n- I have one class which has all necessary tests for v1 of DB (1st instance)\n- I need a class with tests for v2 of DB (another instance) which of course would contain tests for v2 working as v1 (it's backward compatible)\n  It looks quite natural that 2nd class should be derived from the 1st one -- it will inherit all the tests and code in setup/teardown methods. Everything so goog so far, but it does not work in phpUnit.\n  It appears that it includes 2nd class first and since the module contains include() statement for the module with the 1st class, both are loaded at once and only 2nd class is recognized by phpUnit.\n  To demonstrate the issue I created two simple files. The content of the tests is trivial for the sake of this demonstration being simiple:\n\nStackTest.php:\n\n```\n<?php\nclass StackTest extends PHPUnit_Framework_TestCase {\n    public function testPushAndPop()    {\n        $this->assertEquals(0, 0); \n    }\n}\n?>\n```\n\nStack2Test.php:\n\n```\n<?php\n  include __DIR__ . '/StackTest.php';\n\n  class Stack2Test extends StackTest {\n    public function testPushAndPop2() {\n        $this->assertEquals(0, 0); \n    }\n  }\n?>\n```\n\nExpected results:\n-3 methods are tested: StackTest::testPushAndPop, Stack2Test::testPushAndPop, Stack2Test::testPushAndPop2\n\nActual result:\n-2 methods are tested: Stack2Test::testPushAndPop, Stack2Test::testPushAndPop2\n\nIt looks like the following code \n\n```\n    $filename   = PHPUnit_Util_Fileloader::checkAndLoad($filename, $syntaxCheck);\n    $newClasses = PHPUnit_Util_Class::collectEnd();\n    $baseName   = str_replace('.php', '', basename($filename));\n\n    foreach ($newClasses as $className) {\n        if (substr($className, 0 - strlen($baseName)) == $baseName) {\n            $class = new ReflectionClass($className);\n\n            if ($class->getFileName() == $filename) {\n                $newClasses = array($className);\n                break;\n            }\n        }\n    }\n```\n\ndoes not  take into account that one include() can include more than one file and more than one class would be loaded from them.\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/385/timeline","performed_via_github_app":null,"state_reason":"completed"}