{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/341","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/341/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/341/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/341/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/341","id":1644608,"node_id":"MDU6SXNzdWUxNjQ0NjA4","number":341,"title":"ResultPrinter cannot show details and cause errors","user":{"login":"grimly","id":1050527,"node_id":"MDQ6VXNlcjEwNTA1Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1050527?v=4","gravatar_id":"","url":"https://api.github.com/users/grimly","html_url":"https://github.com/grimly","followers_url":"https://api.github.com/users/grimly/followers","following_url":"https://api.github.com/users/grimly/following{/other_user}","gists_url":"https://api.github.com/users/grimly/gists{/gist_id}","starred_url":"https://api.github.com/users/grimly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/grimly/subscriptions","organizations_url":"https://api.github.com/users/grimly/orgs","repos_url":"https://api.github.com/users/grimly/repos","events_url":"https://api.github.com/users/grimly/events{/privacy}","received_events_url":"https://api.github.com/users/grimly/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2011-09-14T15:31:02Z","updated_at":"2011-11-11T17:42:46Z","closed_at":"2011-11-11T17:40:06Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"PHPUnit Version : 3.5.13\nPHP version : 5.3.5\nProblematic file : TextUI/TestRunner.php\n\nThe source code might have changed in the trunk of this projet but it looks like the issue remains :\n\nThe runner, once the tests are over, flush all the result listeners (TextUI/TestRunner.php:285). By doing this, the printer (set as listener at TextUI/TestRunner.php:227) is flushed (TextUI/TestRunner.php:308). The flush method closes the output stream with the only exceptions the printer is the default one or uses \"php://stderr\" as his output (Util/Printer.php:121)\nBut then, the printer is used again to print the details of the test run and the output is never checked again.\nI suggest then to remove the printer from the listener array before they are flushed.\n\nHere is the script I encountered this issue with.\n\nTestRunner.php :\n\n```\n<?php\n\nrequire_once 'PHPUnit/Autoload.php';\n\n/**\n * Description of TestRunner\n */\nclass TestRunner {\n\n    public static function run($filename) {\n        echo 'Running : ' . $filename . PHP_EOL;\n        $resultPrinter = new PHPUnit_TextUI_ResultPrinter('php://output');\n        $suite = new PHPUnit_Framework_TestSuite();\n        $suite->addTestFile($filename);\n        $runner = new PHPUnit_TextUI_TestRunner();\n        $runner->setPrinter($resultPrinter);\n        $runner->doRun($suite);\n    }\n\n    public static function main() {\n        self::run('DummyTest.php');\n        self::run('DummyFailingTest.php');\n    }\n}\n\nTestRunner::main();\n```\n\nDummyTest.php :\n\n```\n<?php\n\n/**\n * Description of DummyTest\n */\nclass DummyTest extends PHPUnit_Framework_TestCase {\n\n    public function testTrue() {\n        $this->assertTrue(true);\n    }\n\n    public function testFalse() {\n        $this->assertFalse(false);\n    }\n}\n```\n\nDummyFailingTest.php :\n\n```\n<?php\n\n/**\n * Description of DummyFailingTest\n */\nclass DummyFailingTest extends PHPUnit_Framework_TestCase {\n\n    public function testTrue() {\n        $this->assertTrue(false);\n    }\n\n    public function testFalse() {\n        $this->assertFalse(true);\n    }\n}\n```\n\nPHPUnit version : \n\n```\nD:\\Documents and Settings\\mturpin>phpunit --version\nPHPUnit 3.5.13 by Sebastian Bergmann.\n```\n\nPHP version :\n\n```\nD:\\Documents and Settings\\mturpin>php --version\nPHP 5.3.5 (cli) (built: Jan  6 2011 17:54:09)\nCopyright (c) 1997-2010 The PHP Group\nZend Engine v2.3.0, Copyright (c) 1998-2010 Zend Technologies\n    with Xdebug v2.1.0, Copyright (c) 2002-2010, by Derick Rethans\n```\n\nRandom warning in the lot this issue gives :\n\n```\nWarning: fwrite(): 90 is not a valid stream resource in C:\\wamp\\bin\\php\\php5.3.5\\PEAR\\PHPUnit\\Util\\Printer.php on line 163\n\nCall Stack:\n    0.0003     333792   1. {main}() D:\\Mes Documents\\NetBeansProjects\\TestUnitPOC\\TestRunner.php:0\n    0.2073     511960   2. TestRunner::main() D:\\Mes Documents\\NetBeansProjects\\TestUnitPOC\\TestRunner.php:26\n    0.4183    3319016   3. TestRunner::run() D:\\Mes Documents\\NetBeansProjects\\TestUnitPOC\\TestRunner.php:22\n    0.4302    3385816   4. PHPUnit_TextUI_TestRunner->doRun() D:\\Mes Documents\\NetBeansProjects\\TestUnitPOC\\TestRunner.php:17\n    0.4469    3521544   5. PHPUnit_TextUI_ResultPrinter->printResult() C:\\wamp\\bin\\php\\php5.3.5\\PEAR\\PHPUnit\\TextUI\\TestRunner.php:311\n    0.8835    3542944   6. PHPUnit_TextUI_ResultPrinter->printFooter() C:\\wamp\\bin\\php\\php5.3.5\\PEAR\\PHPUnit\\TextUI\\ResultPrinter.php:197\n    0.9888    3543224   7. PHPUnit_Util_Printer->write() C:\\wamp\\bin\\php\\php5.3.5\\PEAR\\PHPUnit\\TextUI\\ResultPrinter.php:416\n    0.9888    3543256   8. fwrite() C:\\wamp\\bin\\php\\php5.3.5\\PEAR\\PHPUnit\\Util\\Printer.php:163\n```\n","closed_by":{"login":"edorian","id":247397,"node_id":"MDQ6VXNlcjI0NzM5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/247397?v=4","gravatar_id":"","url":"https://api.github.com/users/edorian","html_url":"https://github.com/edorian","followers_url":"https://api.github.com/users/edorian/followers","following_url":"https://api.github.com/users/edorian/following{/other_user}","gists_url":"https://api.github.com/users/edorian/gists{/gist_id}","starred_url":"https://api.github.com/users/edorian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edorian/subscriptions","organizations_url":"https://api.github.com/users/edorian/orgs","repos_url":"https://api.github.com/users/edorian/repos","events_url":"https://api.github.com/users/edorian/events{/privacy}","received_events_url":"https://api.github.com/users/edorian/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/341/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/341/timeline","performed_via_github_app":null,"state_reason":"completed"}