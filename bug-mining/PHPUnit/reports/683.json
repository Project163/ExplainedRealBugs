{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4938","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4938/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4938/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4938/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/4938","id":1178734274,"node_id":"I_kwDOAAbWLc5GQg7C","number":4938,"title":"Test Double code generator does not handle \"void\" return type declaration on __clone() methods","user":{"login":"recipe","id":1947600,"node_id":"MDQ6VXNlcjE5NDc2MDA=","avatar_url":"https://avatars.githubusercontent.com/u/1947600?v=4","gravatar_id":"","url":"https://api.github.com/users/recipe","html_url":"https://github.com/recipe","followers_url":"https://api.github.com/users/recipe/followers","following_url":"https://api.github.com/users/recipe/following{/other_user}","gists_url":"https://api.github.com/users/recipe/gists{/gist_id}","starred_url":"https://api.github.com/users/recipe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/recipe/subscriptions","organizations_url":"https://api.github.com/users/recipe/orgs","repos_url":"https://api.github.com/users/recipe/repos","events_url":"https://api.github.com/users/recipe/events{/privacy}","received_events_url":"https://api.github.com/users/recipe/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":930693698,"node_id":"MDU6TGFiZWw5MzA2OTM2OTg=","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/feature/test-doubles","name":"feature/test-doubles","color":"e9b96e","default":false,"description":"Test Stubs and Mock Objects"},{"id":2638987726,"node_id":"MDU6TGFiZWwyNjM4OTg3NzI2","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/type/change-in-php-requires-adaptation","name":"type/change-in-php-requires-adaptation","color":"cc0000","default":false,"description":"A change in PHP requires a change so that existing PHPUnit functionality continues to work"}],"state":"closed","locked":false,"assignee":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2022-03-23T22:26:09Z","updated_at":"2022-03-24T08:00:17Z","closed_at":"2022-03-24T08:00:17Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n- Please do not report an issue for a version of PHPUnit that is no longer supported. A list of currently supported versions of PHPUnit is available at https://phpunit.de/supported-versions.html.\r\n- Please do not report an issue if you are using a version of PHP that is not supported by the version of PHPUnit you are using. A list that shows which version of PHP is supported by which version of PHPUnit is available at https://phpunit.de/supported-versions.html.\r\n- Please do not report an issue if you are not using PHPUnit directly, but rather a wrapper around it such as Symfony's PHPUnit Bridge\r\n- Please fill in this template according to your issue.\r\n- Please keep the table shown below at the top of your issue.\r\n- Please include the output of \"composer info | sort\" if you installed PHPUnit using Composer.\r\n- Please post code as text (using proper markup). Do not post screenshots of code.\r\n- Visit https://phpunit.de/support.html if you are looking for support.\r\n- Please remove this comment before submitting your issue.\r\n-->\r\n\r\n| Q                   | A\r\n| --------------------| ---------------\r\n| PHPUnit version     | 9.5.19\r\n| PHP version         | 8.1.2\r\n| Installation Method | Composer \r\n\r\n#### Summary\r\n\r\nphpunit fails with the following error:\r\n```\r\nFatal error: Declaration of PHPUnit\\Framework\\MockObject\\UnmockedCloneMethod::__clone() must be compatible with Foo\\Model\\Entity\\Account::__clone(): void in /usr/local/src/foo/vendor/phpunit/phpunit/src/Framework/MockObject/Api/UnmockedCloneMethod.php on line 17\r\n```\r\n\r\n#### Current behavior\r\n\r\nphpunit tests is unable to start.\r\n\r\n#### How to reproduce\r\n\r\n```php\r\n<?php\r\n\r\nnamespace Foo\\Tests;\r\n\r\nuse PHPUnit\\Framework\\TestCase as PHPUnitTestCase;\r\n\r\nclass Account\r\n{\r\n    public function __clone(): void\r\n    {\r\n    }\r\n}\r\nclass FooTest extends PHPUnitTestCase\r\n{\r\n    public function testFoo()\r\n    {\r\n        $mock = $this->getMockBuilder(Account::class)->getMock();\r\n    }\r\n}\r\n```\r\n* Account class has the following declaration of the __clone method: ``    public function __clone(): void``\r\n\r\n#### Expected behavior\r\n\r\nIf I specify the return type of UnmockedCloneMethod::__clone() method as this, the problem is fixed:\r\n\r\n```php\r\n<?php declare(strict_types=1);\r\n/*\r\n * This file is part of PHPUnit.\r\n *\r\n * (c) Sebastian Bergmann <sebastian@phpunit.de>\r\n *\r\n * For the full copyright and license information, please view the LICENSE\r\n * file that was distributed with this source code.\r\n */\r\nnamespace PHPUnit\\Framework\\MockObject;\r\n\r\n/**\r\n * @internal This trait is not covered by the backward compatibility promise for PHPUnit\r\n */\r\ntrait UnmockedCloneMethod\r\n{\r\n    public function __clone(): void\r\n    {\r\n        $this->__phpunit_invocationMocker = clone $this->__phpunit_getInvocationHandler();\r\n\r\n        parent::__clone();\r\n    }\r\n}\r\n```\r\n\r\n### composer info | sort \r\n```\r\nadodb/adodb-php                    dev-master d54f74d ADOdb is a PHP database abstraction layer library\r\nbitbucket/client                   dev-master 70e8008 Bitbucket API 2.0 client for PHP\r\nbrianium/paratest                  v6.4.3             Parallel testing for PHP\r\ncebe/markdown                      1.2.1              A super fast, highly extensible markdown parser for PHP\r\ncebe/php-openapi                   1.6.0              Read and write OpenAPI yaml/json files and make the content accessable in PHP objects.\r\nclue/stream-filter                 v1.5.0             A simple and modern approach to stream filtering in PHP\r\ncomposer/pcre                      1.0.1              PCRE wrapping library that offers type-safe preg_* replacements.\r\ncomposer/semver                    3.2.9              Semver library that offers utilities, version constraint parsing and validation.\r\ncomposer/xdebug-handler            3.0.1              Restarts a process without Xdebug.\r\ndoctrine/annotations               1.13.2             Docblock Annotations Parser\r\ndoctrine/instantiator              1.4.1              A small, lightweight utility to instantiate objects in PHP without invoking their constructors\r\ndoctrine/lexer                     1.2.2              PHP Doctrine Lexer parser library that can be used in Top-Down, Recursive Descent Parsers.\r\nfakerphp/faker                     v1.19.0            Faker is a PHP library that generates fake data for you.\r\nfirebase/php-jwt                   v5.0.0             A simple library to encode and decode JSON Web Tokens (JWT) in PHP. Should conform to the current spec.\r\nfriendsofphp/php-cs-fixer          v3.6.0             A tool to automatically fix PHP code style\r\ngoogle/apiclient-services          v0.234.0           Client library for Google APIs\r\ngoogle/apiclient                   v2.12.1            Client library for Google APIs\r\ngoogle/auth                        v1.18.0            Google Auth Library for PHP\r\nguzzlehttp/guzzle                  7.4.1              Guzzle is a PHP HTTP client library\r\nguzzlehttp/promises                1.5.1              Guzzle promises library\r\nguzzlehttp/psr7                    2.1.0              PSR-7 message implementation that also provides common utility methods\r\njustinrainbow/json-schema          5.2.11             A library to validate a json schema.\r\nknplabs/github-api                 v3.5.0             GitHub API v3 client\r\nleague/oauth1-client               v1.10.0            OAuth 1.0 Client Library\r\nleague/oauth2-client               2.6.1              OAuth 2.0 Client Library\r\nleague/oauth2-github               2.0.0              Github OAuth 2.0 Client Provider for The PHP League OAuth2-Client\r\nleague/oauth2-google               4.0.0              Google OAuth 2.0 Client Provider for The PHP League OAuth2-Client\r\nleague/openapi-psr7-validator      0.16.4             Validate PSR-7 messages against OpenAPI (3.0.2) specifications expressed in YAML or JSON\r\nleague/uri                         6.5.0              URI manipulation library\r\nleague/uri-interfaces              2.3.0              Common interface for URI representation\r\nm4tthumphrey/php-gitlab-api        11.7.0             GitLab API v4 client for PHP\r\nmonolog/monolog                    1.26.1             Sends your logs to files, sockets, inboxes, databases and various web services\r\nmyclabs/deep-copy                  1.11.0             Create deep copies (clones) of your objects\r\nnelmio/alice                       v3.10.0            Expressive fixtures generator\r\nnikic/php-parser                   v4.13.2            A PHP parser written in PHP\r\nnyholm/psr7                        1.5.0              A fast PHP7 implementation of PSR-7\r\nomines/oauth2-gitlab               3.4.0              GitLab OAuth 2.0 Client Provider for The PHP League OAuth2-Client\r\nonelogin/php-saml                  4.0.0              OneLogin PHP SAML Toolkit\r\nparagonie/constant_time_encoding   v2.5.0             Constant-time Implementations of RFC 4648 Encoding (Base-64, Base-32, Base-16)\r\nparagonie/random_compat            v9.99.100          PHP 5.x polyfill for random_bytes() and random_int() from PHP 7\r\nphar-io/manifest                   2.0.3              Component for reading phar.io manifest information from a PHP Archive (PHAR)\r\nphar-io/version                    3.2.1              Library for handling version information and constraints\r\nphp-amqplib/php-amqplib            v3.1.2             Formerly videlalvaro/php-amqplib.  This library is a pure PHP implementation of the AMQP protocol. It's been tested agai...\r\nphp-cs-fixer/diff                  v2.0.2             sebastian/diff v3 backport support for PHP 5.6+\r\nphpdocumentor/reflection-common    2.2.0              Common reflection classes used by phpdocumentor to reflect the code structure\r\nphpdocumentor/reflection-docblock  5.3.0              With this component, a library can provide support for annotations via DocBlocks or otherwise retrieve information that ...\r\nphpdocumentor/type-resolver        1.6.0              A PSR-5 based resolver of Class names, Types and Structural Element Names\r\nphp-http/cache-plugin              1.7.5              PSR-6 Cache plugin for HTTPlug\r\nphp-http/client-common             2.5.0              Common HTTP Client implementations and tools for HTTPlug\r\nphp-http/discovery                 1.14.1             Finds installed HTTPlug implementations and PSR-7 message factories\r\nphp-http/guzzle7-adapter           1.0.0              Guzzle 7 HTTP Adapter\r\nphp-http/httplug                   2.2.0              HTTPlug, the HTTP client abstraction for PHP\r\nphp-http/message                   1.12.0             HTTP Message related tools\r\nphp-http/message-factory           v1.0.2             Factory interfaces for PSR-7 HTTP Message\r\nphp-http/multipart-stream-builder  1.2.0              A builder class that help you create a multipart stream\r\nphp-http/promise                   1.1.0              Promise used for asynchronous HTTP requests\r\nphpseclib/phpseclib                3.0.13             PHP Secure Communications Library - Pure-PHP implementations of RSA, AES, SSH2, SFTP, X.509 etc.\r\nphpspec/prophecy                   v1.15.0            Highly opinionated mocking framework for PHP 5.3+\r\nphpunit/php-code-coverage          9.2.15             Library that provides collection, processing, and rendering functionality for PHP code coverage information.\r\nphpunit/php-file-iterator          3.0.6              FilterIterator implementation that filters files based on a list of suffixes.\r\nphpunit/php-invoker                3.1.1              Invoke callables with a timeout\r\nphpunit/php-text-template          2.0.4              Simple template engine.\r\nphpunit/php-timer                  5.0.3              Utility class for timing\r\nphpunit/phpunit                    9.5.19             The PHP Unit Testing framework.\r\npsr/cache                          1.0.1              Common interface for caching libraries\r\npsr/container                      1.1.2              Common Container Interface (PHP FIG PSR-11)\r\npsr/event-dispatcher               1.0.0              Standard interfaces for event handling.\r\npsr/http-client                    1.0.1              Common interface for HTTP clients\r\npsr/http-factory                   1.0.1              Common interfaces for PSR-7 HTTP message factories\r\npsr/http-message                   1.0.1              Common interface for HTTP messages\r\npsr/http-server-handler            1.0.1              Common interface for HTTP server-side request handler\r\npsr/http-server-middleware         1.0.1              Common interface for HTTP server-side middleware\r\npsr/log                            1.1.4              Common interface for logging libraries\r\npsr/simple-cache                   1.0.0              Common interfaces for simple caching\r\nralouphie/getallheaders            3.0.3              A polyfill for getallheaders.\r\nrespect/stringifier                0.2.0              Converts any value to a string\r\nrespect/validation                 2.2.3              The most awesome validation engine ever created for PHP\r\nriverline/multipart-parser         2.0.9              One class library to parse multipart content with encoding and charset support.\r\nrobrichards/xmlseclibs             3.1.1              A PHP library for XML Security\r\nsebastian/cli-parser               1.0.1              Library for parsing CLI options\r\nsebastian/code-unit                1.0.8              Collection of value objects that represent the PHP code units\r\nsebastian/code-unit-reverse-lookup 2.0.3              Looks up which function or method a line of code belongs to\r\nsebastian/comparator               4.0.6              Provides the functionality to compare PHP values for equality\r\nsebastian/complexity               2.0.2              Library for calculating the complexity of PHP code units\r\nsebastian/diff                     4.0.4              Diff implementation\r\nsebastian/environment              5.1.3              Provides functionality to handle HHVM/PHP environments\r\nsebastian/exporter                 4.0.4              Provides the functionality to export PHP variables for visualization\r\nsebastian/global-state             5.0.5              Snapshotting of global state\r\nsebastian/lines-of-code            1.0.3              Library for counting the lines of code in PHP source code\r\nsebastian/object-enumerator        4.0.4              Traverses array structures and object graphs to enumerate all referenced objects\r\nsebastian/object-reflector         2.0.4              Allows reflection of object attributes, including inherited and non-public ones\r\nsebastian/recursion-context        4.0.4              Provides functionality to recursively process PHP variables\r\nsebastian/resource-operations      3.0.3              Provides a list of PHP built-in functions that operate on resources\r\nsebastian/type                     3.0.0              Collection of value objects that represent the types of the PHP type system\r\nsebastian/version                  3.0.2              Library that helps with managing the version number of Git-hosted PHP projects\r\nsegmentio/analytics-php            2.0.0              Segment Analytics PHP Library\r\nstevenmaguire/oauth2-bitbucket     3.0.0              Bitbucket OAuth 2.0 Client Provider for The PHP League OAuth2-Client\r\nsymfony/cache-contracts            v2.5.0             Generic abstractions related to caching\r\nsymfony/cache                      v4.4.37            Provides an extended PSR-6, PSR-16 (and tags) implementation\r\nsymfony/console                    v6.0.5             Eases the creation of beautiful and testable command line interfaces\r\nsymfony/deprecation-contracts      v3.0.0             A generic function and convention to trigger deprecation notices\r\nsymfony/event-dispatcher-contracts v3.0.0             Generic abstractions related to dispatching event\r\nsymfony/event-dispatcher           v6.0.3             Provides tools that allow your application components to communicate with each other by dispatching events and listening...\r\nsymfony/filesystem                 v6.0.3             Provides basic utilities for the filesystem\r\nsymfony/finder                     v6.0.3             Finds files and directories via an intuitive fluent interface\r\nsymfony/options-resolver           v6.0.3             Provides an improved replacement for the array_replace PHP function\r\nsymfony/polyfill-ctype             v1.25.0            Symfony polyfill for ctype functions\r\nsymfony/polyfill-intl-grapheme     v1.25.0            Symfony polyfill for intl's grapheme_* functions\r\nsymfony/polyfill-intl-normalizer   v1.25.0            Symfony polyfill for intl's Normalizer class and related functions\r\nsymfony/polyfill-mbstring          v1.25.0            Symfony polyfill for the Mbstring extension\r\nsymfony/polyfill-php73             v1.25.0            Symfony polyfill backporting some PHP 7.3+ features to lower PHP versions\r\nsymfony/polyfill-php80             v1.25.0            Symfony polyfill backporting some PHP 8.0+ features to lower PHP versions\r\nsymfony/polyfill-php81             v1.24.0            Symfony polyfill backporting some PHP 8.1+ features to lower PHP versions\r\nsymfony/process                    v6.0.5             Executes commands in sub-processes\r\nsymfony/property-access            v6.0.3             Provides functions to read and write from/to an object or array using a simple string notation\r\nsymfony/property-info              v6.0.3             Extracts information about PHP class' properties using metadata of popular sources\r\nsymfony/service-contracts          v2.4.1             Generic abstractions related to writing services\r\nsymfony/stopwatch                  v6.0.3             Provides a way to profile code\r\nsymfony/string                     v6.0.3             Provides an object-oriented API to strings and deals with bytes, UTF-8 code points and grapheme clusters in a unified way\r\nsymfony/var-exporter               v5.4.3             Allows exporting any serializable PHP data structure to plain PHP code\r\nsymfony/yaml                       v6.0.3             Loads and dumps YAML files\r\ntheseer/tokenizer                  1.2.1              A small library for converting tokenized PHP source code into XML and potentially other formats\r\nwebmozart/assert                   1.10.0             Assertions to validate method input/output with nice error messages.\r\nzircote/swagger-php                4.2.6              swagger-php - Generate interactive documentation for your RESTful API using phpdoc annotations\r\n```\r\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4938/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4938/timeline","performed_via_github_app":null,"state_reason":"completed"}