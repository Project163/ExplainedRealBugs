{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/2907","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/2907/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/2907/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/2907/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/2907","id":280252463,"node_id":"MDU6SXNzdWUyODAyNTI0NjM=","number":2907,"title":"StringMatchesFormatDescription Does Not Handle Escaped % Properly","user":{"login":"mkasberg","id":12214617,"node_id":"MDQ6VXNlcjEyMjE0NjE3","avatar_url":"https://avatars.githubusercontent.com/u/12214617?v=4","gravatar_id":"","url":"https://api.github.com/users/mkasberg","html_url":"https://github.com/mkasberg","followers_url":"https://api.github.com/users/mkasberg/followers","following_url":"https://api.github.com/users/mkasberg/following{/other_user}","gists_url":"https://api.github.com/users/mkasberg/gists{/gist_id}","starred_url":"https://api.github.com/users/mkasberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mkasberg/subscriptions","organizations_url":"https://api.github.com/users/mkasberg/orgs","repos_url":"https://api.github.com/users/mkasberg/repos","events_url":"https://api.github.com/users/mkasberg/events{/privacy}","received_events_url":"https://api.github.com/users/mkasberg/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-12-07T19:37:45Z","updated_at":"2017-12-11T13:18:08Z","closed_at":"2017-12-11T13:18:08Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"| Q                   | A\r\n| --------------------| ---------------\r\n| PHPUnit version     | 6.5.3\r\n| PHP version         | 7.0.22-0ubuntu0.17.04.1\r\n| Installation Method | Git\r\n\r\nI would expect the following test case to pass because the format string `'%%'` should produce a literal `'%'` ([sprintf](https://secure.php.net/manual/en/function.sprintf.php)). But it fails in PHPUnit 6.5.3.\r\n\r\n**StringMatchesFormatDescriptionTest.php**\r\n```php\r\n<?php\r\n\r\nuse PHPUnit\\Framework\\TestCase;\r\n\r\nclass StringMatchesFormatDescriptionTest extends TestCase {\r\n\r\n    public function testEscapedPercent() {\r\n        $this->assertStringMatchesFormat('This %%d is escaped.', 'This %d is escaped.');\r\n    }\r\n\r\n}\r\n```\r\n\r\n**Sample Output:**\r\n```\r\n$ ./phpunit StringMatchesFormatDescriptionTest.php \r\nPHPUnit 6.5.3 by Sebastian Bergmann and contributors.\r\n\r\nRuntime:       PHP 7.0.22-0ubuntu0.17.04.1 with Xdebug 2.5.0\r\nConfiguration: /home/mkasberg/repositories/phpunit/phpunit.xml\r\n\r\nF                                                                   1 / 1 (100%)\r\n\r\nTime: 436 ms, Memory: 4.00MB\r\n\r\nThere was 1 failure:\r\n\r\n1) StringMatchesFormatDescriptionTest::testEscapedPercent\r\nFailed asserting that string matches format description.\r\n--- Expected\r\n+++ Actual\r\n@@ @@\r\n-This %%d is escaped.\r\n+This %d is escaped.\r\n\r\n/home/mkasberg/repositories/phpunit/src/Framework/Constraint/Constraint.php:117\r\n/home/mkasberg/repositories/phpunit/src/Framework/Constraint/Constraint.php:62\r\n/home/mkasberg/repositories/phpunit/src/Framework/Assert.php:2116\r\n/home/mkasberg/repositories/phpunit/src/Framework/Assert.php:1768\r\n/home/mkasberg/repositories/phpunit/StringMatchesFormatDescriptionTest.php:8\r\n/home/mkasberg/repositories/phpunit/src/Framework/TestCase.php:1071\r\n/home/mkasberg/repositories/phpunit/src/Framework/TestCase.php:939\r\n/home/mkasberg/repositories/phpunit/src/Framework/TestResult.php:698\r\n/home/mkasberg/repositories/phpunit/src/Framework/TestCase.php:894\r\n/home/mkasberg/repositories/phpunit/src/Framework/TestSuite.php:755\r\n/home/mkasberg/repositories/phpunit/src/TextUI/TestRunner.php:546\r\n/home/mkasberg/repositories/phpunit/src/TextUI/Command.php:195\r\n/home/mkasberg/repositories/phpunit/src/TextUI/Command.php:148\r\n\r\nFAILURES!\r\nTests: 1, Assertions: 1, Failures: 1.\r\n```\r\n\r\n----\r\nI skimmed the source code for StringMatchesFormatDescription.php, and it is perhaps worth noting that we also seem to be missing a few other descriptors which are supported by PHP. For example, `%b`, `%E`, and `%g`. (Should we expect PHPUnit to support all of these?)\r\n\r\nNone of these are major bugs since it's certainly possible to work around them, but it might be nice to have better support for format string matching.\r\n\r\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/2907/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/2907/timeline","performed_via_github_app":null,"state_reason":"completed"}