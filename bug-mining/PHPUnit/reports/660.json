{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4694","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4694/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4694/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4694/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/4694","id":911136749,"node_id":"MDU6SXNzdWU5MTExMzY3NDk=","number":4694,"title":"TestCase::getMockFromWsdl() does not work with PHP 8.1-dev","user":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":930693698,"node_id":"MDU6TGFiZWw5MzA2OTM2OTg=","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/feature/test-doubles","name":"feature/test-doubles","color":"e9b96e","default":false,"description":"Test Stubs and Mock Objects"},{"id":2638987726,"node_id":"MDU6TGFiZWwyNjM4OTg3NzI2","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/type/change-in-php-requires-adaptation","name":"type/change-in-php-requires-adaptation","color":"cc0000","default":false,"description":"A change in PHP requires a change so that existing PHPUnit functionality continues to work"}],"state":"closed","locked":false,"assignee":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":5,"created_at":"2021-06-04T05:37:16Z","updated_at":"2021-06-04T13:17:35Z","closed_at":"2021-06-04T13:17:35Z","author_association":"OWNER","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"With a clean build of PHP 8.1-dev (d2e5203865) I get\r\n```\r\nphp-81 ./phpunit --filter testCreateMockFromWsdl\r\nPHPUnit 8.5.15-41-ge760aee1f by Sebastian Bergmann and contributors.\r\n\r\nRuntime:       PHP 8.1.0-dev\r\nConfiguration: /usr/local/src/phpunit/phpunit.xml\r\n\r\n\r\nFatal error: During inheritance of SoapClient: Uncaught Declaration of Mock_WsdlMock_a4f861c0::__call(string $name, array $args) should be compatible with SoapClient::__call(string $name, array $args): mixed\r\n\r\n/usr/local/src/phpunit/src/Framework/MockObject/MockClass.php:45\r\n/usr/local/src/phpunit/src/Framework/MockObject/Generator.php:625\r\n/usr/local/src/phpunit/src/Framework/MockObject/Generator.php:217\r\n/usr/local/src/phpunit/src/Framework/TestCase.php:1861\r\n/usr/local/src/phpunit/tests/unit/Framework/MockObject/MockObjectTest.php:910\r\n/usr/local/src/phpunit/src/Framework/TestCase.php:1472\r\n/usr/local/src/phpunit/src/Framework/TestCase.php:1092\r\n/usr/local/src/phpunit/src/Framework/TestResult.php:703\r\n/usr/local/src/phpunit/src/Framework/TestCase.php:820\r\n/usr/local/src/phpunit/src/Framework/TestSuite.php:627\r\n/usr/local/src/phpunit/src/Framework/TestSuite.php:627\r\n/usr/local/src/phpunit/src/Framework/TestSuite.php:627\r\n/usr/local/src/phpunit/src/TextUI/TestRunner.php:656\r\n/usr/local/src/phpunit/src/TextUI/Command.php:236\r\n/usr/local/src/phpunit/src/TextUI/Command.php:195\r\n in /usr/local/src/phpunit/src/Framework/MockObject/MockClass.php(45) : eval()'d code on line 3\r\n```\r\nThe generated code that causes the error looks like so:\r\n```php\r\n<?php declare(strict_types=1);\r\n\r\nclass Mock_WsdlMock_1ef6ee15 extends WsdlMock implements PHPUnit\\Framework\\MockObject\\MockObject\r\n{\r\n    use \\PHPUnit\\Framework\\MockObject\\Api;\r\n    use \\PHPUnit\\Framework\\MockObject\\Method;\r\n    use \\PHPUnit\\Framework\\MockObject\\MockedCloneMethod;\r\n\r\n    public function doGoogleSearch($key, $q, $start, $maxResults, $filter, $restrict, $safeSearch, $lr, $ie, $oe)\r\n    {\r\n        $__phpunit_arguments = [$key, $q, $start, $maxResults, $filter, $restrict, $safeSearch, $lr, $ie, $oe];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 10) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 10; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'WsdlMock', 'doGoogleSearch', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function doGetCachedPage($key, $url)\r\n    {\r\n        $__phpunit_arguments = [$key, $url];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 2) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 2; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'WsdlMock', 'doGetCachedPage', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function doSpellingSuggestion($key, $phrase)\r\n    {\r\n        $__phpunit_arguments = [$key, $phrase];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 2) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 2; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'WsdlMock', 'doSpellingSuggestion', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function __call(string $name, array $args)\r\n    {\r\n        $__phpunit_arguments = [$name, $args];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 2) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 2; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'SoapClient', '__call', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function __soapCall(string $name, array $args, ?array $options = NULL, $inputHeaders = NULL, &$outputHeaders = NULL)\r\n    {\r\n        $__phpunit_arguments = [$name, $args, $options, $inputHeaders, &$outputHeaders];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 5) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 5; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'SoapClient', '__soapCall', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function __getFunctions()\r\n    {\r\n        $__phpunit_arguments = [];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 0) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 0; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'SoapClient', '__getFunctions', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function __getTypes()\r\n    {\r\n        $__phpunit_arguments = [];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 0) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 0; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'SoapClient', '__getTypes', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function __getLastRequest()\r\n    {\r\n        $__phpunit_arguments = [];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 0) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 0; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'SoapClient', '__getLastRequest', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function __getLastResponse()\r\n    {\r\n        $__phpunit_arguments = [];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 0) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 0; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'SoapClient', '__getLastResponse', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function __getLastRequestHeaders()\r\n    {\r\n        $__phpunit_arguments = [];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 0) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 0; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'SoapClient', '__getLastRequestHeaders', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function __getLastResponseHeaders()\r\n    {\r\n        $__phpunit_arguments = [];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 0) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 0; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'SoapClient', '__getLastResponseHeaders', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function __doRequest(string $request, string $location, string $action, int $version, bool $oneWay = false)\r\n    {\r\n        $__phpunit_arguments = [$request, $location, $action, $version, $oneWay];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 5) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 5; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'SoapClient', '__doRequest', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function __setCookie(string $name, ?string $value = NULL)\r\n    {\r\n        $__phpunit_arguments = [$name, $value];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 2) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 2; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'SoapClient', '__setCookie', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function __getCookies()\r\n    {\r\n        $__phpunit_arguments = [];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 0) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 0; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'SoapClient', '__getCookies', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function __setSoapHeaders($headers = NULL)\r\n    {\r\n        $__phpunit_arguments = [$headers];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 1) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 1; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'SoapClient', '__setSoapHeaders', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n\r\n    public function __setLocation(?string $location = NULL)\r\n    {\r\n        $__phpunit_arguments = [$location];\r\n        $__phpunit_count     = func_num_args();\r\n\r\n        if ($__phpunit_count > 1) {\r\n            $__phpunit_arguments_tmp = func_get_args();\r\n\r\n            for ($__phpunit_i = 1; $__phpunit_i < $__phpunit_count; $__phpunit_i++) {\r\n                $__phpunit_arguments[] = $__phpunit_arguments_tmp[$__phpunit_i];\r\n            }\r\n        }\r\n\r\n        $__phpunit_result = $this->__phpunit_getInvocationHandler()->invoke(\r\n            new \\PHPUnit\\Framework\\MockObject\\Invocation(\r\n                'SoapClient', '__setLocation', $__phpunit_arguments, '', $this, true\r\n            )\r\n        );\r\n\r\n        return $__phpunit_result;\r\n    }\r\n}\r\n```\r\nThis error does not happen when I revert the changes introduced in https://github.com/php/php-src/commit/8ae4b560279e384c7262da04b31b4ffed1c59364.\r\n\r\nAs far as I understand it, the aforementioned commit is related to the [Add return type declarations for internal methods RFC](https://wiki.php.net/rfc/internal_method_return_types). This RFC says\r\n\r\n> As the tentative return type declarations in question wouldn't be enforced in PHP 8 versions, ReflectionMethod::hasReturnType() and ReflectionMethod::getReturnType() won't take these into account until PHP 9.0. \r\n\r\n@kocsismate Can you please clarify whether or not this error is the result of a bug that was introduced in https://github.com/php/php-src/commit/8ae4b560279e384c7262da04b31b4ffed1c59364 or whether PHPUnit needs to be adapted to these changes? Thanks!","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4694/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4694/timeline","performed_via_github_app":null,"state_reason":"completed"}