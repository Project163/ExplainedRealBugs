{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5561","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5561/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5561/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5561/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/5561","id":1992182523,"node_id":"I_kwDOAAbWLc52vkr7","number":5561,"title":"JUnit XML logger does not handle assertion failures in before-test methods","user":{"login":"hbrecht","id":13656589,"node_id":"MDQ6VXNlcjEzNjU2NTg5","avatar_url":"https://avatars.githubusercontent.com/u/13656589?v=4","gravatar_id":"","url":"https://api.github.com/users/hbrecht","html_url":"https://github.com/hbrecht","followers_url":"https://api.github.com/users/hbrecht/followers","following_url":"https://api.github.com/users/hbrecht/following{/other_user}","gists_url":"https://api.github.com/users/hbrecht/gists{/gist_id}","starred_url":"https://api.github.com/users/hbrecht/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hbrecht/subscriptions","organizations_url":"https://api.github.com/users/hbrecht/orgs","repos_url":"https://api.github.com/users/hbrecht/repos","events_url":"https://api.github.com/users/hbrecht/events{/privacy}","received_events_url":"https://api.github.com/users/hbrecht/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":44001,"node_id":"MDU6TGFiZWw0NDAwMQ==","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/type/bug","name":"type/bug","color":"cc0000","default":false,"description":"Something is broken"},{"id":1329317012,"node_id":"MDU6TGFiZWwxMzI5MzE3MDEy","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/feature/test-runner","name":"feature/test-runner","color":"e9b96e","default":false,"description":"CLI test runner"},{"id":1842308147,"node_id":"MDU6TGFiZWwxODQyMzA4MTQ3","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/feature/logging","name":"feature/logging","color":"e9b96e","default":false,"description":"Issues related to logging test results"},{"id":5111411238,"node_id":"LA_kwDOAAbWLc8AAAABMKnyJg","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/version/10","name":"version/10","color":"888a85","default":false,"description":"Something affects PHPUnit 10"},{"id":8052990377,"node_id":"LA_kwDOAAbWLc8AAAAB3_7hqQ","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/feature/logging/junit","name":"feature/logging/junit","color":"e9b96e","default":false,"description":"Issues related to logging test results in JUnit XML format"}],"state":"closed","locked":false,"assignee":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2023-11-14T07:55:52Z","updated_at":"2025-01-25T09:06:25Z","closed_at":"2023-12-05T07:31:54Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"| Q                   | A\r\n| --------------------| ---------------\r\n| PHPUnit version     | 10.4.1 / 10.4.2\r\n| PHP version         | PHP 8.2.7 with PCOV 1.0.11\r\n| Installation Method |  PHAR\r\n\r\n#### Summary\r\nOn a failed assertion in setUp, phpunit fails with an internal error.\r\nI am unsure, if assertions are allowed in setUp, the documentation only disallows them in setUpBeforeClass.\r\nIssue was previously reported as #5549, but at the time due to an incorrect analysis on my side I was not able to narrow the root cause down. I updated #5549 with the minimal test case as well.\r\n\r\n#### Current behavior\r\nWhen running the test with the failed assertion, following happens:\r\n\r\nAn error occurred inside PHPUnit.\r\n\r\nMessage:  PHPUnit\\Event\\Telemetry\\HRTime::duration(): Argument #1 ($start) must be of type PHPUnit\\Event\\Telemetry\\HRTime, null given, called in phar:///usr/local/bin/phpunit/phpunit/Logging/JUnit/JunitXmlLogger.php on line 191\r\n\r\nLocation: phar:///usr/local/bin/phpunit/phpunit/TextUI/TestRunner.php:48\r\n\r\n#0 phar:///usr/local/bin/phpunit/phpunit/TextUI/Application.php(144): PHPUnit\\TextUI\\TestRunner->run()\r\n#1 /usr/local/bin/phpunit(2976): PHPUnit\\TextUI\\Application->run()\r\n#2 {main}\r\n\r\nCaused by: phar:///usr/local/bin/phpunit/phpunit/Event/Value/Telemetry/HRTime.php:54\r\n\r\n#0 phar:///usr/local/bin/phpunit/phpunit/Logging/JUnit/JunitXmlLogger.php(191): PHPUnit\\Event\\Telemetry\\HRTime->duration()\r\n#1 phar:///usr/local/bin/phpunit/phpunit/Logging/JUnit/JunitXmlLogger.php(148): PHPUnit\\Logging\\JUnit\\JunitXmlLogger->handleFinish()\r\n#2 phar:///usr/local/bin/phpunit/phpunit/Logging/JUnit/Subscriber/TestFinishedSubscriber.php(29): PHPUnit\\Logging\\JUnit\\JunitXmlLogger->testFinished()\r\n#3 phar:///usr/local/bin/phpunit/phpunit/Event/Dispatcher/DirectDispatcher.php(78): PHPUnit\\Logging\\JUnit\\TestFinishedSubscriber->notify()\r\n#4 phar:///usr/local/bin/phpunit/phpunit/Event/Dispatcher/DeferringDispatcher.php(41): PHPUnit\\Event\\DirectDispatcher->dispatch()\r\n#5 phar:///usr/local/bin/phpunit/phpunit/Event/Emitter/DispatchingEmitter.php(548): PHPUnit\\Event\\DeferringDispatcher->dispatch()\r\n#6 phar:///usr/local/bin/phpunit/phpunit/Framework/TestRunner.php(152): PHPUnit\\Event\\DispatchingEmitter->testFinished()\r\n#7 phar:///usr/local/bin/phpunit/phpunit/Framework/TestCase.php(436): PHPUnit\\Framework\\TestRunner->run()\r\n#8 phar:///usr/local/bin/phpunit/phpunit/Framework/TestSuite.php(266): PHPUnit\\Framework\\TestCase->run()\r\n#9 phar:///usr/local/bin/phpunit/phpunit/Framework/TestSuite.php(266): PHPUnit\\Framework\\TestSuite->run()\r\n#10 phar:///usr/local/bin/phpunit/phpunit/Framework/TestSuite.php(266): PHPUnit\\Framework\\TestSuite->run()\r\n#11 phar:///usr/local/bin/phpunit/phpunit/TextUI/TestRunner.php(44): PHPUnit\\Framework\\TestSuite->run()\r\n#12 phar:///usr/local/bin/phpunit/phpunit/TextUI/Application.php(144): PHPUnit\\TextUI\\TestRunner->run()\r\n#13 /usr/local/bin/phpunit(2976): PHPUnit\\TextUI\\Application->run()\r\n#14 {main}\r\n\r\nWhen I run with assertions being active, I get\r\n\r\nMessage:  assert($this->currentTestCase !== null)\r\n\r\n#### How to reproduce\r\n\r\n```\r\n<?php\r\nclass DummyTest extends PHPUnit\\Framework\\TestCase {\r\n\r\n        protected function setUp(): void {\r\n            $this->assertTrue(false);\r\n        }\r\n\r\n        public function testDummy(): void {\r\n            $this->assertTrue(true);\r\n        }\r\n}\r\n```\r\n\r\n#### Expected behavior\r\n\r\nPHPUnit runs without internal error or documentation disallows assertions in setUp.\r\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5561/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5561/timeline","performed_via_github_app":null,"state_reason":"completed"}