{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5234","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5234/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5234/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5234/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/5234","id":1595981264,"node_id":"I_kwDOAAbWLc5fIL3Q","number":5234,"title":"Constants defined in configuration file are not defined in bootstrap file when test is run in separate process","user":{"login":"MauricioFauth","id":120970,"node_id":"MDQ6VXNlcjEyMDk3MA==","avatar_url":"https://avatars.githubusercontent.com/u/120970?v=4","gravatar_id":"","url":"https://api.github.com/users/MauricioFauth","html_url":"https://github.com/MauricioFauth","followers_url":"https://api.github.com/users/MauricioFauth/followers","following_url":"https://api.github.com/users/MauricioFauth/following{/other_user}","gists_url":"https://api.github.com/users/MauricioFauth/gists{/gist_id}","starred_url":"https://api.github.com/users/MauricioFauth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MauricioFauth/subscriptions","organizations_url":"https://api.github.com/users/MauricioFauth/orgs","repos_url":"https://api.github.com/users/MauricioFauth/repos","events_url":"https://api.github.com/users/MauricioFauth/events{/privacy}","received_events_url":"https://api.github.com/users/MauricioFauth/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":44001,"node_id":"MDU6TGFiZWw0NDAwMQ==","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/type/bug","name":"type/bug","color":"cc0000","default":false,"description":"Something is broken"},{"id":1329317012,"node_id":"MDU6TGFiZWwxMzI5MzE3MDEy","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/feature/test-runner","name":"feature/test-runner","color":"e9b96e","default":false,"description":"CLI test runner"},{"id":1841128667,"node_id":"MDU6TGFiZWwxODQxMTI4NjY3","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/feature/process-isolation","name":"feature/process-isolation","color":"e9b96e","default":false,"description":"Issues related to running tests in separate PHP processes"},{"id":5111411238,"node_id":"LA_kwDOAAbWLc8AAAABMKnyJg","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/version/10","name":"version/10","color":"888a85","default":false,"description":"Something affects PHPUnit 10"}],"state":"closed","locked":false,"assignee":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2023-02-22T23:18:28Z","updated_at":"2023-02-23T05:26:42Z","closed_at":"2023-02-23T05:26:42Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n- Please do not report an issue for a version of PHPUnit that is no longer supported. A list of currently supported versions of PHPUnit is available at https://phpunit.de/supported-versions.html.\r\n- Please do not report an issue if you are using a version of PHP that is not supported by the version of PHPUnit you are using. A list that shows which version of PHP is supported by which version of PHPUnit is available at https://phpunit.de/supported-versions.html.\r\n- Please do not report an issue if you are not using PHPUnit directly, but rather a wrapper around it such as Symfony's PHPUnit Bridge\r\n- Please fill in this template according to your issue.\r\n- Please keep the table shown below at the top of your issue.\r\n- Please include the output of \"composer info | sort\" if you installed PHPUnit using Composer.\r\n- Please post code as text (using proper markup). Do not post screenshots of code.\r\n- Visit https://phpunit.de/support.html if you are looking for support.\r\n- Please remove this comment before submitting your issue.\r\n-->\r\n\r\n| Q                   | A\r\n| --------------------| ---------------\r\n| PHPUnit version     | 10.0.11\r\n| PHP version         | 8.1.16\r\n| Installation Method | Composer\r\n\r\n#### Summary\r\n\r\nConstants defined in configuration file are not defined in the bootstrap file when running in a separated process.\r\n\r\n#### Current behavior\r\n\r\nShow the error: Test was run in child process and ended unexpectedly\r\n\r\n```\r\n PHPUnit 10.0.11 by Sebastian Bergmann and contributors.\r\n\r\nRuntime:       PHP 8.1.16\r\nConfiguration: phpunit-10.xml\r\n\r\n.E                                                                  2 / 2 (100%)\r\n\r\nTime: 00:00.064, Memory: 8.00 MB\r\n\r\nThere was 1 error:\r\n\r\n1) FooTest::testFoo2\r\nTest was run in child process and ended unexpectedly\r\n\r\nERRORS!\r\nTests: 2, Assertions: 1, Errors: 1.\r\n```\r\n\r\n#### How to reproduce\r\n\r\nPOC: https://github.com/MauricioFauth/phpunit-10-test\r\n\r\n`phpunit.xml`:\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<phpunit xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\"\r\n         xsi:noNamespaceSchemaLocation=\"https://schema.phpunit.de/10.0/phpunit.xsd\"\r\n         bootstrap=\"tests/bootstrap.php\"\r\n         cacheDirectory=\".phpunit10.cache\"\r\n         executionOrder=\"depends,defects\"\r\n         beStrictAboutOutputDuringTests=\"true\"\r\n         failOnRisky=\"true\"\r\n         failOnWarning=\"true\"\r\n         colors=\"true\">\r\n    <testsuites>\r\n        <testsuite name=\"default\">\r\n            <directory>tests</directory>\r\n        </testsuite>\r\n    </testsuites>\r\n    <coverage>\r\n        <include>\r\n            <directory suffix=\".php\">src</directory>\r\n        </include>\r\n    </coverage>\r\n    <php>\r\n        <const name=\"CONST_TEST\" value=\"1\"/>\r\n    </php>\r\n</phpunit>\r\n\r\n```\r\n\r\n`tests/bootstrap.php`:\r\n```php\r\n<?php\r\nif (! defined('CONST_TEST')) {\r\n    exit;\r\n}\r\nrequire dirname(__DIR__) . '/vendor/autoload.php';\r\n```\r\n\r\n`src/function.php`:\r\n```php\r\n<?php\r\ndeclare(strict_types=1);\r\nfunction foo(): string {\r\n    return 'foo';\r\n}\r\n```\r\n\r\n`tests/FooTest.php`:\r\n```php\r\n<?php\r\n\r\ndeclare(strict_types=1);\r\n\r\nuse PHPUnit\\Framework\\TestCase;\r\n\r\nclass FooTest extends TestCase\r\n{\r\n    public function testFoo(): void\r\n    {\r\n        $this->assertSame('foo', foo());\r\n    }\r\n\r\n    /**\r\n     * @runInSeparateProcess\r\n     * @preserveGlobalState disabled\r\n     */\r\n    public function testFoo2(): void\r\n    {\r\n        $this->assertSame('foo', foo());\r\n    }\r\n}\r\n\r\n```\r\n\r\n#### Expected behavior\r\n\r\nConstants should be available.\r\n\r\n```\r\nPHPUnit 9.6.3 by Sebastian Bergmann and contributors.\r\n\r\nRuntime:       PHP 8.0.28\r\nConfiguration: phpunit-9.xml\r\n\r\n..                                                                  2 / 2 (100%)\r\n\r\nTime: 00:00.088, Memory: 6.00 MB\r\n\r\nOK (2 tests, 2 assertions)\r\n```\r\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5234/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5234/timeline","performed_via_github_app":null,"state_reason":"completed"}