{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/614","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/614/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/614/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/614/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/614","id":5961916,"node_id":"MDU6SXNzdWU1OTYxOTE2","number":614,"title":"Serialization problem when using test isolation","user":{"login":"fabpot","id":47313,"node_id":"MDQ6VXNlcjQ3MzEz","avatar_url":"https://avatars.githubusercontent.com/u/47313?v=4","gravatar_id":"","url":"https://api.github.com/users/fabpot","html_url":"https://github.com/fabpot","followers_url":"https://api.github.com/users/fabpot/followers","following_url":"https://api.github.com/users/fabpot/following{/other_user}","gists_url":"https://api.github.com/users/fabpot/gists{/gist_id}","starred_url":"https://api.github.com/users/fabpot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fabpot/subscriptions","organizations_url":"https://api.github.com/users/fabpot/orgs","repos_url":"https://api.github.com/users/fabpot/repos","events_url":"https://api.github.com/users/fabpot/events{/privacy}","received_events_url":"https://api.github.com/users/fabpot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2012-08-01T07:55:08Z","updated_at":"2012-08-03T12:40:01Z","closed_at":"2012-08-03T09:27:11Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When setting process isolation to true, PHPUnit creates a script that is executed in another process. In the generated script, it serializes the data to be passed to the test method, and this is where there is an issue.\n\nA simple PHP script that exhibits the same issue:\n\n``` php\n$a = '\\\\\\\\foo';\nfile_put_contents(__DIR__.'/test.php', sprintf('<?php echo unserialize(\\'%s\\');', serialize($a)));\nexec('php '.__DIR__.'/test.php');\n```\n\nThe output of the script is:\n\n```\nPHP Notice:  unserialize(): Error at offset 10 of 11 bytes in /Users/fabien/work/twig/test.php on line 1\n```\n\nThe problem is that when a string contains two consecutive backslashes, it should be expanded to 4 to be correctly interpreted. A simple fix might be:\n\n``` diff\ndiff --git a/PHPUnit/Framework/TestCase.php b/PHPUnit/Framework/TestCase.php\nindex e3cd2c1..3848c52 100644\n--- a/PHPUnit/Framework/TestCase.php\n+++ b/PHPUnit/Framework/TestCase.php\n@@ -720,7 +720,7 @@ public function run(PHPUnit_Framework_TestResult $result = NULL)\n                 $strict = 'FALSE';\n             }\n\n-            $data            = addcslashes(serialize($this->data), \"'\");\n+            $data            = addcslashes(serialize($this->data), \"'\\\\\");\n             $dependencyInput = addcslashes(\n               serialize($this->dependencyInput), \"'\"\n             );\n```\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/614/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/614/timeline","performed_via_github_app":null,"state_reason":"completed"}