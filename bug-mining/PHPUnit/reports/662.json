{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4720","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4720/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4720/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4720/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/4720","id":930522018,"node_id":"MDU6SXNzdWU5MzA1MjIwMTg=","number":4720,"title":"PHPUnit does not verify its own PHP extension requirements","user":{"login":"jrfnl","id":663378,"node_id":"MDQ6VXNlcjY2MzM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/663378?v=4","gravatar_id":"","url":"https://api.github.com/users/jrfnl","html_url":"https://github.com/jrfnl","followers_url":"https://api.github.com/users/jrfnl/followers","following_url":"https://api.github.com/users/jrfnl/following{/other_user}","gists_url":"https://api.github.com/users/jrfnl/gists{/gist_id}","starred_url":"https://api.github.com/users/jrfnl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jrfnl/subscriptions","organizations_url":"https://api.github.com/users/jrfnl/orgs","repos_url":"https://api.github.com/users/jrfnl/repos","events_url":"https://api.github.com/users/jrfnl/events{/privacy}","received_events_url":"https://api.github.com/users/jrfnl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":44001,"node_id":"MDU6TGFiZWw0NDAwMQ==","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/type/bug","name":"type/bug","color":"cc0000","default":false,"description":"Something is broken"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-06-25T21:45:48Z","updated_at":"2021-06-26T07:45:07Z","closed_at":"2021-06-26T04:55:25Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"| Q                   | A\r\n| --------------------| ---------------\r\n| PHPUnit version     | 9.5.5\r\n| PHP version         | All supported\r\n| Installation Method | PHAR\r\n\r\n#### Summary\r\n\r\nIt appears that PHPUnit does not (in all cases?) verify whether its own PHP extension requirements have been satisfied.\r\n\r\nWhile for Composer installs, this shouldn't be (much of) an issue as Composer will verify on install, for running PHPUnit via the Phar, however, this can lead to unexpected error notices (without backtrace).\r\n\r\nThe Composer `require` section lists the following requirements, though not all of these appear to be \"hard\" requirements:\r\nhttps://github.com/sebastianbergmann/phpunit/blob/fb9b8333f14e3dce976a60ef6a7e05c7c7ed8bfb/composer.json#L24-L30\r\n\r\n#### Current behavior\r\n\r\nWhen the Mbstring extension is disabled and a non-testdox test run is requested, all will be fine and the test progress and results display correctly.\r\n\r\nHowever, when the Mbstring extension is disabled and `--testdox` is used, this will result in a `Call to undefined function mb_strtolower()` notice being thrown without indication where it's coming from.\r\n\r\nBased on a quick code base search, AFAICS this is caused by this function call:\r\nhttps://github.com/sebastianbergmann/phpunit/blob/fb9b8333f14e3dce976a60ef6a7e05c7c7ed8bfb/src/Util/TestDox/NamePrettifier.php#L116\r\n\r\n#### How to reproduce\r\n\r\n* Make sure the `mbstring` extension is disabled (from the `php.ini` file or otherwise).\r\n* Run the following command using a PHPUnit Phar file on PHPUnit's own test suite and see the tests pass without issues:\r\n```\r\nphpunit --filter TestBuilderTest\r\n```\r\n* Next, run the same command with `--testdox` enabled:\r\n```\r\nphpunit --testdox --filter TestBuilderTest\r\n```\r\n* See the `Call to undefined function mb_strtolower()` notice appear without indication of the file it came from (even when Xdebug is turned on) and no test results displayed.\r\n\r\n#### Expected behavior\r\n\r\nEither an error before the test run starts saying that the Mbstring extension should be enabled when using the `--testdox` option or a graceful fall-back to `strtolower()` when Mbstring is not available.\r\n\r\n\r\n#### Extra information\r\n\r\nDiscovered when testing `@requires` conditions on an external test, where one of the `@requires` was for the Mbstring extension ðŸ˜‚ \r\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4720/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/4720/timeline","performed_via_github_app":null,"state_reason":"completed"}