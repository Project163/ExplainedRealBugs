{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6111","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6111/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6111/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6111/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/6111","id":2815719122,"node_id":"I_kwDOAAbWLc6n1HbS","number":6111,"title":"Deprecations cause `SourceMapper` to scan all `<source/>` files","user":{"login":"dantleech","id":530801,"node_id":"MDQ6VXNlcjUzMDgwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/530801?v=4","gravatar_id":"","url":"https://api.github.com/users/dantleech","html_url":"https://github.com/dantleech","followers_url":"https://api.github.com/users/dantleech/followers","following_url":"https://api.github.com/users/dantleech/following{/other_user}","gists_url":"https://api.github.com/users/dantleech/gists{/gist_id}","starred_url":"https://api.github.com/users/dantleech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dantleech/subscriptions","organizations_url":"https://api.github.com/users/dantleech/orgs","repos_url":"https://api.github.com/users/dantleech/repos","events_url":"https://api.github.com/users/dantleech/events{/privacy}","received_events_url":"https://api.github.com/users/dantleech/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1329317012,"node_id":"MDU6TGFiZWwxMzI5MzE3MDEy","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/feature/test-runner","name":"feature/test-runner","color":"e9b96e","default":false,"description":"CLI test runner"},{"id":1432589276,"node_id":"MDU6TGFiZWwxNDMyNTg5Mjc2","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/type/performance","name":"type/performance","color":"cc0000","default":false,"description":"Issues related to resource consumption (time and memory)"},{"id":6451629111,"node_id":"LA_kwDOAAbWLc8AAAABgIwMNw","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/version/11","name":"version/11","color":"888a85","default":false,"description":"Something affects PHPUnit 11"},{"id":7573337865,"node_id":"LA_kwDOAAbWLc8AAAABw2f3CQ","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/version/12","name":"version/12","color":"888a85","default":false,"description":"Something affects PHPUnit 12"}],"state":"closed","locked":false,"assignee":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":9,"created_at":"2025-01-28T13:43:23Z","updated_at":"2025-01-29T08:43:39Z","closed_at":"2025-01-29T06:30:28Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"| Q                   | A\n| --------------------| ---------------\n| PHPUnit version     | 11.5.3\n| PHP version         | 8.3\n| Installation Method | PHAR + Composer\n\n#### Summary\n\nHi ðŸ‘‹ \n\nWhen deprecations are encountered the `SouceMapper` recursively scans all files for _each_ `<source>` include and exclude paths.\n\nThis causes a siginficant _pause_ in PHPUnit as it scans all these files, initially for 16 seconds until we isolated the issue and refined the `<source>` list - now it's \"only\" 3 seconds.\n\n#### Current behavior\n\nScans all files when a deprecation is encountered.\n\n#### How to reproduce\n\nAdd a `<source>` configuration:\n```\n    <source>\n        <include>\n            <directory suffix=\".php\">src/</directory>\n            <directory suffix=\".php\">perhaps-another-directory-here/</directory>\n        </include>\n        <exclude>\n            <directory suffix=\".php\">src/SubFolder</directory>\n            <!-- maybe serveral more here -->\n        </exclude>\n    </source>\n```\n\n- Run a test that would trigger a deprecation\n- Observe that source mapper will recursively iterate over all the files in the above paths.\n\nhttps://github.com/sebastianbergmann/phpunit/blob/main/src/Runner/ErrorHandler.php#L178\n\n#### Expected behavior\n\nThat a triggered deprecation would not scan all the files and block the test run for N seconds.\n","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6111/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6111/timeline","performed_via_github_app":null,"state_reason":"completed"}