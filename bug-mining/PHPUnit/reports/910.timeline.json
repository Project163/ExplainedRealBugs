[{"id":15861227211,"node_id":"LE_lADOAAbWLc6lfukAzwAAAAOxZx7L","url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/events/15861227211","actor":{"login":"cabbey","id":522147,"node_id":"MDQ6VXNlcjUyMjE0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/522147?v=4","gravatar_id":"","url":"https://api.github.com/users/cabbey","html_url":"https://github.com/cabbey","followers_url":"https://api.github.com/users/cabbey/followers","following_url":"https://api.github.com/users/cabbey/following{/other_user}","gists_url":"https://api.github.com/users/cabbey/gists{/gist_id}","starred_url":"https://api.github.com/users/cabbey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cabbey/subscriptions","organizations_url":"https://api.github.com/users/cabbey/orgs","repos_url":"https://api.github.com/users/cabbey/repos","events_url":"https://api.github.com/users/cabbey/events{/privacy}","received_events_url":"https://api.github.com/users/cabbey/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-01-08T23:54:18Z","label":{"name":"type/bug","color":"cc0000"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2579266490","html_url":"https://github.com/sebastianbergmann/phpunit/issues/6095#issuecomment-2579266490","issue_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6095","id":2579266490,"node_id":"IC_kwDOAAbWLc6ZvHu6","user":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-09T06:24:39Z","updated_at":"2025-01-09T06:36:50Z","body":"> Under phpunit 10.5.40 these tests run perfectly with no deprecation warnings\r\n\r\nI assume by \"deprecation warnings\" you mean \"risky tests\", as I do not see any deprecation warnings in your output for PHPUnit 10.5.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2579266490/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2579272890","html_url":"https://github.com/sebastianbergmann/phpunit/issues/6095#issuecomment-2579272890","issue_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6095","id":2579272890,"node_id":"IC_kwDOAAbWLc6ZvJS6","user":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-09T06:31:07Z","updated_at":"2025-01-09T07:13:05Z","body":"Do you use `TestCase::registerMockObject()` in your regular test suite or do you only use it in your reproducing test case? I ask because this method is marked `@internal` and you are not supposed to use it.\r\n\r\nAlso note that creating mock objects in a data provider does not work. Your workaround (`$mockFactory = new self('factory'); $mock = $mockFactory->createMock(bugExample::class);`) does not work.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2579272890/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2579279896","html_url":"https://github.com/sebastianbergmann/phpunit/issues/6095#issuecomment-2579279896","issue_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6095","id":2579279896,"node_id":"IC_kwDOAAbWLc6ZvLAY","user":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-09T06:37:52Z","updated_at":"2025-01-09T07:11:11Z","body":"I ran your tests `testLocalZero()`, `testLocalOne()`, and `testLocalTwo()` with PHPUnit 10.5 and PHPUnit 11.5:\r\n\r\n#### `testLocalZero()`\r\n```php\r\n$mock = $this->createMock(bugExample::class);\r\n$mock->expects($this->once())\r\n    ->method('demo');\r\n```\r\n\r\n✅ PHPUnit 10.5: The test fails and is not considered to be risky\r\n✅ PHPUnit 11.5: The test fails and is not considered to be risky\r\n\r\n---\r\n\r\n#### `testLocalOne()`\r\n```php\r\n$mock = $this->createMock(bugExample::class);\r\n$mock->expects($this->once())\r\n    ->method('demo');\r\n$mock->demo();\r\n```\r\n\r\n✅ PHPUnit 10.5: The test passes and is not considered to be risky\r\n✅ PHPUnit 11.5: The test passes and is not considered to be risky\r\n\r\n---\r\n\r\n#### `testLocalTwo()`\r\n```php\r\n$mock = $this->createMock(bugExample::class);\r\n$mock->expects($this->once())\r\n    ->method('demo');\r\n$mock->demo();\r\n$mock->demo();\r\n```\r\n\r\n⚡ PHPUnit 10.5: The test fails (correct) and is considered to be risky (incorrect)\r\n⚡ PHPUnit 11.5: The test fails (correct) and is considered to be risky (incorrect)\r\n\r\n---\r\n\r\nAs you can see, I am not able to reproduce that PHPUnit 10.5 and PHPUnit 11.5 behave differently when running these tests.\r\n\r\nThe fact that both PHPUnit 10.5 and PHPUnit 11.5 consider `testLocalTwo()` to be risky is a bug that should be fixed.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2579279896/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":15863603584,"node_id":"LE_lADOAAbWLc6lfukAzwAAAAOxi2GA","url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/events/15863603584","actor":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-01-09T07:02:34Z","label":{"name":"feature/test-doubles","color":"e9b96e"},"performed_via_github_app":null},{"id":15863603587,"node_id":"LE_lADOAAbWLc6lfukAzwAAAAOxi2GD","url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/events/15863603587","actor":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-01-09T07:02:34Z","label":{"name":"version/11","color":"888a85"},"performed_via_github_app":null},{"id":15863603699,"node_id":"AE_lADOAAbWLc6lfukAzwAAAAOxi2Hz","url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/events/15863603699","actor":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2025-01-09T07:02:35Z","assignee":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":15863829046,"node_id":"LE_lADOAAbWLc6lfukAzwAAAAOxjtI2","url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/events/15863829046","actor":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-01-09T07:30:25Z","label":{"name":"version/10","color":"888a85"},"performed_via_github_app":null},{"id":15863935793,"node_id":"REFE_lADOAAbWLc6lfukAzwAAAAOxkHMx","url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/events/15863935793","actor":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"973a49ff01f2b4041d44a7aa40582f97fb55d335","commit_url":"https://api.github.com/repos/sebastianbergmann/phpunit/commits/973a49ff01f2b4041d44a7aa40582f97fb55d335","created_at":"2025-01-09T07:42:59Z","performed_via_github_app":null},{"id":15864170986,"node_id":"RTE_lADOAAbWLc6lfukAzwAAAAOxlAnq","url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/events/15864170986","actor":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2025-01-09T08:07:18Z","rename":{"from":"Erronious risky test reports - configured expectations not counted as assertions","to":"Expectation is not counted correctly when a doubled method is called more often than is expected"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2579405608","html_url":"https://github.com/sebastianbergmann/phpunit/issues/6095#issuecomment-2579405608","issue_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6095","id":2579405608,"node_id":"IC_kwDOAAbWLc6Zvpso","user":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-09T08:13:42Z","updated_at":"2025-01-09T08:13:42Z","body":"For some reason, I do not remember why, the case that a doubled method is called more often than it is expected to be called is handled differently than all other mock object-related expectation failures.\r\n\r\nIf a doubled method is expected to be called once and is called a second time then the execution of the test is immediately aborted and the test is considered a failure. However, the fact that an expectation was verified is not recorded by incrementing the assertion counter.\r\n\r\nA look into the Git history of this part of the code reminded me that I was working on this a while ago:\r\n\r\n* ec59ed611aafc7b7cedbc534adea0886b2893857\r\n* 14303e37714ff16c92c95f7a04185c495d151335\r\n* dd6d3290d84741e8248316d37ec973448e3c254d\r\n* 2f4d105ac02acb50580ec83658c0807392f68909","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2579405608/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":15864602803,"node_id":"REFE_lADOAAbWLc6lfukAzwAAAAOxmqCz","url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/events/15864602803","actor":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"de0c82c4724ec7d2d67ebc6c621d54dda33c43b4","commit_url":"https://api.github.com/repos/sebastianbergmann/phpunit/commits/de0c82c4724ec7d2d67ebc6c621d54dda33c43b4","created_at":"2025-01-09T08:48:07Z","performed_via_github_app":null},{"id":15864602900,"node_id":"CE_lADOAAbWLc6lfukAzwAAAAOxmqEU","url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/events/15864602900","actor":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"de0c82c4724ec7d2d67ebc6c621d54dda33c43b4","commit_url":"https://api.github.com/repos/sebastianbergmann/phpunit/commits/de0c82c4724ec7d2d67ebc6c621d54dda33c43b4","created_at":"2025-01-09T08:48:08Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2580932630","html_url":"https://github.com/sebastianbergmann/phpunit/issues/6095#issuecomment-2580932630","issue_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6095","id":2580932630,"node_id":"IC_kwDOAAbWLc6Z1egW","user":{"login":"cabbey","id":522147,"node_id":"MDQ6VXNlcjUyMjE0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/522147?v=4","gravatar_id":"","url":"https://api.github.com/users/cabbey","html_url":"https://github.com/cabbey","followers_url":"https://api.github.com/users/cabbey/followers","following_url":"https://api.github.com/users/cabbey/following{/other_user}","gists_url":"https://api.github.com/users/cabbey/gists{/gist_id}","starred_url":"https://api.github.com/users/cabbey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cabbey/subscriptions","organizations_url":"https://api.github.com/users/cabbey/orgs","repos_url":"https://api.github.com/users/cabbey/repos","events_url":"https://api.github.com/users/cabbey/events{/privacy}","received_events_url":"https://api.github.com/users/cabbey/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-09T17:56:44Z","updated_at":"2025-01-09T17:56:44Z","body":"> > Under phpunit 10.5.40 these tests run perfectly with no deprecation warnings\r\n> \r\n> I assume by \"deprecation warnings\" you mean \"risky tests\", as I do not see any deprecation warnings in your output for PHPUnit 10.5.\r\n\r\nThe \"deprecation warning\" from PHPUnit 11 was due to using a docblock for the `@dataProvider` declaration. I updated it to an attribute and that went away. I think we can ignore the deprecation warnings.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2580932630/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cabbey","id":522147,"node_id":"MDQ6VXNlcjUyMjE0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/522147?v=4","gravatar_id":"","url":"https://api.github.com/users/cabbey","html_url":"https://github.com/cabbey","followers_url":"https://api.github.com/users/cabbey/followers","following_url":"https://api.github.com/users/cabbey/following{/other_user}","gists_url":"https://api.github.com/users/cabbey/gists{/gist_id}","starred_url":"https://api.github.com/users/cabbey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cabbey/subscriptions","organizations_url":"https://api.github.com/users/cabbey/orgs","repos_url":"https://api.github.com/users/cabbey/repos","events_url":"https://api.github.com/users/cabbey/events{/privacy}","received_events_url":"https://api.github.com/users/cabbey/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2580971262","html_url":"https://github.com/sebastianbergmann/phpunit/issues/6095#issuecomment-2580971262","issue_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6095","id":2580971262,"node_id":"IC_kwDOAAbWLc6Z1n7-","user":{"login":"cabbey","id":522147,"node_id":"MDQ6VXNlcjUyMjE0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/522147?v=4","gravatar_id":"","url":"https://api.github.com/users/cabbey","html_url":"https://github.com/cabbey","followers_url":"https://api.github.com/users/cabbey/followers","following_url":"https://api.github.com/users/cabbey/following{/other_user}","gists_url":"https://api.github.com/users/cabbey/gists{/gist_id}","starred_url":"https://api.github.com/users/cabbey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cabbey/subscriptions","organizations_url":"https://api.github.com/users/cabbey/orgs","repos_url":"https://api.github.com/users/cabbey/repos","events_url":"https://api.github.com/users/cabbey/events{/privacy}","received_events_url":"https://api.github.com/users/cabbey/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-09T18:17:28Z","updated_at":"2025-01-09T18:17:28Z","body":"> Do you use `TestCase::registerMockObject()` in your regular test suite or do you only use it in your reproducing test case? I ask because this method is marked `@internal` and you are not supposed to use it.\r\n\r\nNo we do not currently use it anywhere in our test suite. It was added to the reproduction case as one of our engineers noted the difference between the behavior of the locally created mocks and the injected mocks was that the injected ones were not registered. After seeing that it almost completely resolved the issues with the pattern, I do have a PR started to add it to the actual tests in our suite that are encountering this... but as you say, it's not something we are supposed to be doing, and as I said in the initial report, it feels dirty to have to do it. I would rather not. \r\n\r\n> Also note that creating mock objects in a data provider does not work. Your workaround (`$mockFactory = new self('factory'); $mock = $mockFactory->createMock(bugExample::class);`) does not work.\r\n\r\nUntil now, it has worked just fine... we do this in a number of our tests. With the addition of the `registerMockObject()` call, it's almost back to fully functional. If it were not for the fact that this particular test didn't have any *other* assertions in it, we probably wouldn't have noticed this. In looking at other tests of ours I suspect a number of them are now silently broken and will fail to alert if expectations change in a way that isn't triggered in some other fashion.\r\n\r\nWe also create a number of stubs in this same method, often those are then injected into the mocks. For example a domain object mock will have a repository stub injected which has some domain object stubs injected into it, all of which are configured for the given test variation to represent a given state of the objects in the situation under test.\r\n\r\nCan you point to any additional documentation or background on what doesn't work about this? (I've just re-read both the test doubles and data providers section of the PHPUnit manual, and unless I missed something, neither section mentions the other's concepts at all, let alone gives any advice not to mix the two.)\r\n\r\n> I ran your tests `testLocalZero()`, `testLocalOne()`, and `testLocalTwo()` with PHPUnit 10.5 and PHPUnit 11.5:\r\n> #### `testLocalZero()`\r\n\r\nSorry, I perhaps was not clear... `testLocal*()` were provided as a baseline to show \"this works without injection\". The problem this issue was raised to address is the behavior of the `testInject*()` methods. The `testRegisterInected*()` methods were provided to demonstrate the distasteful workaround of doing the registration in the test method.\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2580971262/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cabbey","id":522147,"node_id":"MDQ6VXNlcjUyMjE0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/522147?v=4","gravatar_id":"","url":"https://api.github.com/users/cabbey","html_url":"https://github.com/cabbey","followers_url":"https://api.github.com/users/cabbey/followers","following_url":"https://api.github.com/users/cabbey/following{/other_user}","gists_url":"https://api.github.com/users/cabbey/gists{/gist_id}","starred_url":"https://api.github.com/users/cabbey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cabbey/subscriptions","organizations_url":"https://api.github.com/users/cabbey/orgs","repos_url":"https://api.github.com/users/cabbey/repos","events_url":"https://api.github.com/users/cabbey/events{/privacy}","received_events_url":"https://api.github.com/users/cabbey/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2581141031","html_url":"https://github.com/sebastianbergmann/phpunit/issues/6095#issuecomment-2581141031","issue_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6095","id":2581141031,"node_id":"IC_kwDOAAbWLc6Z2RYn","user":{"login":"cabbey","id":522147,"node_id":"MDQ6VXNlcjUyMjE0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/522147?v=4","gravatar_id":"","url":"https://api.github.com/users/cabbey","html_url":"https://github.com/cabbey","followers_url":"https://api.github.com/users/cabbey/followers","following_url":"https://api.github.com/users/cabbey/following{/other_user}","gists_url":"https://api.github.com/users/cabbey/gists{/gist_id}","starred_url":"https://api.github.com/users/cabbey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cabbey/subscriptions","organizations_url":"https://api.github.com/users/cabbey/orgs","repos_url":"https://api.github.com/users/cabbey/repos","events_url":"https://api.github.com/users/cabbey/events{/privacy}","received_events_url":"https://api.github.com/users/cabbey/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-09T19:57:42Z","updated_at":"2025-01-09T19:57:42Z","body":"I've re-worked the test case that originally exposed this now to have the data provider inject a closure which takes a `TestCase` as an argument. The test function calls this closure, passing `$this`, to obtain the mock. The closure then calls `makeMock()` on the passed in `TestCase`. This is repeated for each Mock needed in the test. I believe this pattern will give us the effective result of having made the mock objects in the test case, without having to repeat the code over and over to do so. (I end up re-using the same closure for several variations out of the dataProvider.)\r\n\r\nDo you foresee any issues with this pattern? Do you think this is also needed for Stubs, or will the workaround of creating a new testcase instance in the dataprovider work for those?\r\n\r\nTo simulate this in the bugReport file, here is the additional functions:\r\n```\r\n    public static function dataProviderClosure(): \\Generator\r\n    {\r\n        $mockFactory = function(TestCase $test) {\r\n            $mock = $test->createMock(bugExample::class);\r\n            $mock->expects($test->once())\r\n                ->method('demo');\r\n            return $mock;\r\n        };\r\n        yield 'closure' => [$mockFactory];\r\n    }\r\n\r\n    #[\\PHPUnit\\Framework\\Attributes\\DataProvider('dataProviderClosure')]\r\n    public function testClosureZero(callable $mockFactory)\r\n    {\r\n        $mock = $mockFactory($this);\r\n    }\r\n\r\n    #[\\PHPUnit\\Framework\\Attributes\\DataProvider('dataProviderClosure')]\r\n    public function testClosureOne(callable $mockFactory)\r\n    {\r\n        $mock = $mockFactory($this);\r\n        $mock->demo();\r\n    }\r\n\r\n    #[\\PHPUnit\\Framework\\Attributes\\DataProvider('dataProviderClosure')]\r\n    public function testClosureTwo(callable $mockFactory)\r\n    {\r\n        $mock = $mockFactory($this);\r\n        // prove the expectation works by violating it with two calls\r\n        $mock->demo();\r\n        $mock->demo();\r\n    }\r\n```\r\n\r\nand it's run:\r\n\r\n```\r\nphpunit tests/phpunit/manual/bugDemo.php --filter testClosure\r\nusing vendor/bin/phpunit\r\nPHPUnit 11.4.3 by Sebastian Bergmann and contributors.\r\n\r\nRuntime:       PHP 8.3.12\r\nConfiguration: /home/cabbey/sandboxes/2/phpunit.xml\r\n\r\nF.F                                                                 3 / 3 (100%)\r\n\r\nTime: 00:00.022, Memory: 44.50 MB\r\n\r\nThere were 2 failures:\r\n\r\n1) TestSuite\\Manual\\bugDemo::testClosureZero with data set \"closure\" (Closure Object ())\r\nExpectation failed for method name is \"demo\" when invoked 1 time.\r\nMethod was expected to be called 1 time, actually called 0 times.\r\n\r\n2) TestSuite\\Manual\\bugDemo::testClosureTwo with data set \"closure\" (Closure Object ())\r\nTestSuite\\Manual\\bugExample::demo(): int was not expected to be called more than once.\r\n\r\n/home/cabbey/sandboxes/2/tests/phpunit/manual/bugDemo.php:124\r\n\r\n--\r\n\r\nThere was 1 risky test:\r\n\r\n1) TestSuite\\Manual\\bugDemo::testClosureTwo with data set \"closure\" (Closure Object ())\r\nThis test did not perform any assertions\r\n\r\n/home/cabbey/sandboxes/2/tests/phpunit/manual/bugDemo.php:119\r\n\r\nFAILURES!\r\nTests: 3, Assertions: 2, Failures: 2, Risky: 1.\r\n```\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2581141031/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cabbey","id":522147,"node_id":"MDQ6VXNlcjUyMjE0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/522147?v=4","gravatar_id":"","url":"https://api.github.com/users/cabbey","html_url":"https://github.com/cabbey","followers_url":"https://api.github.com/users/cabbey/followers","following_url":"https://api.github.com/users/cabbey/following{/other_user}","gists_url":"https://api.github.com/users/cabbey/gists{/gist_id}","starred_url":"https://api.github.com/users/cabbey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cabbey/subscriptions","organizations_url":"https://api.github.com/users/cabbey/orgs","repos_url":"https://api.github.com/users/cabbey/repos","events_url":"https://api.github.com/users/cabbey/events{/privacy}","received_events_url":"https://api.github.com/users/cabbey/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2581840575","html_url":"https://github.com/sebastianbergmann/phpunit/issues/6095#issuecomment-2581840575","issue_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/6095","id":2581840575,"node_id":"IC_kwDOAAbWLc6Z48K_","user":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-01-10T05:59:04Z","updated_at":"2025-01-10T05:59:04Z","body":"The actual bug you discovered in `testLocalTwo()` has been fixed. I will not look into the \"issues\" you show in https://github.com/sebastianbergmann/phpunit/issues/6095#issuecomment-2581141031 as I understand them to be unsupported use cases.","author_association":"OWNER","reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/comments/2581840575/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}}]