{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/554","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/554/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/554/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/554/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/554","id":4218602,"node_id":"MDU6SXNzdWU0MjE4NjAy","number":554,"title":"Constants Persist When using --process-isolation and --no-globals-backup","user":{"login":"bobjackman","id":1231996,"node_id":"MDQ6VXNlcjEyMzE5OTY=","avatar_url":"https://avatars.githubusercontent.com/u/1231996?v=4","gravatar_id":"","url":"https://api.github.com/users/bobjackman","html_url":"https://github.com/bobjackman","followers_url":"https://api.github.com/users/bobjackman/followers","following_url":"https://api.github.com/users/bobjackman/following{/other_user}","gists_url":"https://api.github.com/users/bobjackman/gists{/gist_id}","starred_url":"https://api.github.com/users/bobjackman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bobjackman/subscriptions","organizations_url":"https://api.github.com/users/bobjackman/orgs","repos_url":"https://api.github.com/users/bobjackman/repos","events_url":"https://api.github.com/users/bobjackman/events{/privacy}","received_events_url":"https://api.github.com/users/bobjackman/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2012-04-20T21:34:07Z","updated_at":"2012-04-21T09:21:24Z","closed_at":"2012-04-21T09:21:24Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Given the following files:\n\n/tmp/phpUnitIssues/isolation/FirstTest.php:\n\n```\n<?php\n\ndefine( 'MY_CONSTANT', 'foobar' );\n\nclass FirstTest extends PHPUnit_Framework_TestCase\n{\n    public function testFirst( )\n    {\n        $this->assertEquals( 'foobar', MY_CONSTANT );\n\n        define( 'FIRST_TEST_CONSTANT', 'flap' );\n    }\n}\n```\n\n/tmp/phpUnitIssues/isolation/SecondTest.php:\n\n```\n<?php\n\nclass SecondTest extends PHPUnit_Framework_TestCase\n{\n    public function testConstant1( )\n    {\n        $this->assertFalse( defined( 'MY_CONSTANT' ), 'Constant MY_CONSTANT already defined with value of \"'.MY_CONSTANT.'\"' );\n    }\n\n    public function testConstant2( )\n    {\n        $this->assertFalse( defined( 'FIRST_TEST_CONSTANT' ), 'Constant FIRST_TEST_CONSTANT already defined with value of \"'.FIRST_TEST_CONSTANT.'\"' );\n    }\n}\n```\n\n/tmp/phpUnitIssues/isolation/configuration.xml:\n\n```\n<phpunit>\n  <testsuites>\n    <testsuite name=\"relativity\">\n        <file>FirstTest.php</file>\n        <file>SecondTest.php</file>\n    </testsuite>\n  </testsuites>\n</phpunit>\n```\n\nExpected behavior would be that all constants are cleared between tests.\n\nHowever, running the tests with the following command(s):\n\n```\ncd /tmp/phpUnitIssues/isolation;\n/usr/bin/phpunit --process-isolation --no-globals-backup --configuration ./configuration.xml\n```\n\nWhich results in test output of:\n\n```\n.F.\n\nTime: 0 seconds, Memory: 5.00Mb\n\nThere was 1 failure:\n\n1) SecondTest::testConstant1\nConstant MY_CONSTANT already defined with value of \"foobar\"\n```\n\nWe can see that global constants (not class constants) defined outside the class definition persist across all tests, whereas global constants (not class constants) defined inside the class do not persist.\n","closed_by":{"login":"edorian","id":247397,"node_id":"MDQ6VXNlcjI0NzM5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/247397?v=4","gravatar_id":"","url":"https://api.github.com/users/edorian","html_url":"https://github.com/edorian","followers_url":"https://api.github.com/users/edorian/followers","following_url":"https://api.github.com/users/edorian/following{/other_user}","gists_url":"https://api.github.com/users/edorian/gists{/gist_id}","starred_url":"https://api.github.com/users/edorian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edorian/subscriptions","organizations_url":"https://api.github.com/users/edorian/orgs","repos_url":"https://api.github.com/users/edorian/repos","events_url":"https://api.github.com/users/edorian/events{/privacy}","received_events_url":"https://api.github.com/users/edorian/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/554/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/554/timeline","performed_via_github_app":null,"state_reason":"completed"}