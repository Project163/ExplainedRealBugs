{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5487","repository_url":"https://api.github.com/repos/sebastianbergmann/phpunit","labels_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5487/labels{/name}","comments_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5487/comments","events_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5487/events","html_url":"https://github.com/sebastianbergmann/phpunit/issues/5487","id":1864961173,"node_id":"I_kwDOAAbWLc5vKQyV","number":5487,"title":"Tests are run more than once if `<testsuites>` has overlapping `<directory>`s","user":{"login":"ThomasNunninger","id":280145,"node_id":"MDQ6VXNlcjI4MDE0NQ==","avatar_url":"https://avatars.githubusercontent.com/u/280145?v=4","gravatar_id":"","url":"https://api.github.com/users/ThomasNunninger","html_url":"https://github.com/ThomasNunninger","followers_url":"https://api.github.com/users/ThomasNunninger/followers","following_url":"https://api.github.com/users/ThomasNunninger/following{/other_user}","gists_url":"https://api.github.com/users/ThomasNunninger/gists{/gist_id}","starred_url":"https://api.github.com/users/ThomasNunninger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ThomasNunninger/subscriptions","organizations_url":"https://api.github.com/users/ThomasNunninger/orgs","repos_url":"https://api.github.com/users/ThomasNunninger/repos","events_url":"https://api.github.com/users/ThomasNunninger/events{/privacy}","received_events_url":"https://api.github.com/users/ThomasNunninger/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":44001,"node_id":"MDU6TGFiZWw0NDAwMQ==","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/type/bug","name":"type/bug","color":"cc0000","default":false,"description":"Something is broken"},{"id":1329317012,"node_id":"MDU6TGFiZWwxMzI5MzE3MDEy","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/feature/test-runner","name":"feature/test-runner","color":"e9b96e","default":false,"description":"CLI test runner"},{"id":5111411238,"node_id":"LA_kwDOAAbWLc8AAAABMKnyJg","url":"https://api.github.com/repos/sebastianbergmann/phpunit/labels/version/10","name":"version/10","color":"888a85","default":false,"description":"Something affects PHPUnit 10"}],"state":"closed","locked":false,"assignee":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2023-08-24T11:33:00Z","updated_at":"2023-08-25T09:54:49Z","closed_at":"2023-08-25T09:41:32Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"| Q                   | A\r\n| --------------------| ---------------\r\n| PHPUnit version     | 10.3.2\r\n| PHP version         | 8.1.22\r\n| Installation Method | Composer\r\n\r\n#### Summary\r\n\r\nTests are run more than once if `phpunit.xml` hast `<testsuites>` with overlapping `<directory>`s.\r\n\r\nThe `<testsuites>` includes two `<directory>` elements:\r\n\r\n```\r\n   <testsuites>\r\n       <testsuite name=\"Project Test Suite\">\r\n           <directory>tests/**/*</directory>\r\n           <directory>tests/*</directory>\r\n       </testsuite>\r\n   </testsuites>\r\n```\r\n\r\nIn PHPUnit 8.5 41 tests have been executed, in PHPUnit 10.3 71 tests have been reported. Test execution time doubled from 5 to 10 seconds.\r\n\r\n(Interestingly the number of tests does not double even there are no test files directly below `tests/`. There is one test using a data provider having 7 data sets â€“ if that might be relevant.)\r\n\r\nWhen running PHPUnit with `--testdox-text` both versions of PHPUnit reported 41 tests in the output.\r\n\r\nRemoving `<directory>tests/**/*</directory>` solves the issue.\r\n\r\n\r\n#### Current behavior\r\n\r\nTests are run more than once.\r\n\r\n\r\n#### How to reproduce\r\n\r\nAdjust `phpunit.xml` as shown above.\r\n\r\n\r\n#### Expected behavior\r\n\r\nTests are run only once. (Or there is some hint that tests are run more than once because of overlapping `<directory>` elements.)\r\n\r\n\r\n#### composer info\r\n\r\n```\r\nbash-5.1$ composer info | sort \r\nbrick/math                                       0.11.0    Arbitrary-precision arithmetic library\r\ndoctrine/instantiator                            1.5.0     A small, lightweight utility to instant...\r\nmatthiasnoback/symfony-config-test               4.3.0     Library for testing user classes relate...\r\nmatthiasnoback/symfony-dependency-injection-test v4.3.1    Library for testing user classes relate...\r\nmyclabs/deep-copy                                1.11.1    Create deep copies (clones) of your obj...\r\nnikic/php-parser                                 v4.17.1   A PHP parser written in PHP\r\nnyholm/symfony-bundle-test                       2.0.0    \r\nparagonie/constant_time_encoding                 v2.6.3    Constant-time Implementations of RFC 46...\r\nparagonie/random_compat                          v9.99.100 PHP 5.x polyfill for random_bytes() and...\r\nphake/phake                                      v4.4.0    The Phake mock testing library\r\nphar-io/manifest                                 2.0.3     Component for reading phar.io manifest ...\r\nphar-io/version                                  3.2.1     Library for handling version informatio...\r\nphp-amqplib/php-amqplib                          v3.5.4    Formerly videlalvaro/php-amqplib.  This...\r\nphpseclib/phpseclib                              3.0.21    PHP Secure Communications Library - Pur...\r\nphpunit/php-code-coverage                        10.1.3    Library that provides collection, proce...\r\nphpunit/php-file-iterator                        4.0.2     FilterIterator implementation that filt...\r\nphpunit/php-invoker                              4.0.0     Invoke callables with a timeout\r\nphpunit/php-text-template                        3.0.0     Simple template engine.\r\nphpunit/php-timer                                6.0.0     Utility class for timing\r\nphpunit/phpunit                                  10.3.2    The PHP Unit Testing framework.\r\npsr/cache                                        3.0.0     Common interface for caching libraries\r\npsr/container                                    2.0.2     Common Container Interface (PHP FIG PSR...\r\npsr/event-dispatcher                             1.0.0     Standard interfaces for event handling.\r\npsr/log                                          3.0.0     Common interface for logging libraries\r\nramsey/collection                                2.0.0     A PHP library for representing and mani...\r\nramsey/uuid                                      4.7.4     A PHP library for generating and workin...\r\nsebastian/cli-parser                             2.0.0     Library for parsing CLI options\r\nsebastian/code-unit                              2.0.0     Collection of value objects that repres...\r\nsebastian/code-unit-reverse-lookup               3.0.0     Looks up which function or method a lin...\r\nsebastian/comparator                             5.0.1     Provides the functionality to compare P...\r\nsebastian/complexity                             3.0.0     Library for calculating the complexity ...\r\nsebastian/diff                                   5.0.3     Diff implementation\r\nsebastian/environment                            6.0.1     Provides functionality to handle HHVM/P...\r\nsebastian/exporter                               5.0.0     Provides the functionality to export PH...\r\nsebastian/global-state                           6.0.1     Snapshotting of global state\r\nsebastian/lines-of-code                          2.0.0     Library for counting the lines of code ...\r\nsebastian/object-enumerator                      5.0.0     Traverses array structures and object g...\r\nsebastian/object-reflector                       3.0.0     Allows reflection of object attributes,...\r\nsebastian/recursion-context                      5.0.0     Provides functionality to recursively p...\r\nsebastian/type                                   4.0.0     Collection of value objects that repres...\r\nsebastian/version                                4.0.1     Library that helps with managing the ve...\r\nsuora/apm-wrapper                                v1.0.0    This is a wrapper for APMs in PHP\r\nsymfony/cache                                    v6.3.2    Provides extended PSR-6, PSR-16 (and ta...\r\nsymfony/cache-contracts                          v3.3.0    Generic abstractions related to caching\r\nsymfony/config                                   v6.3.2    Helps you find, load, combine, autofill...\r\nsymfony/console                                  v6.3.2    Eases the creation of beautiful and tes...\r\nsymfony/dependency-injection                     v6.3.2    Allows you to standardize and centraliz...\r\nsymfony/deprecation-contracts                    v3.3.0    A generic function and convention to tr...\r\nsymfony/error-handler                            v6.3.2    Provides tools to manage errors and eas...\r\nsymfony/event-dispatcher                         v6.3.2    Provides tools that allow your applicat...\r\nsymfony/event-dispatcher-contracts               v3.3.0    Generic abstractions related to dispatc...\r\nsymfony/filesystem                               v6.3.1    Provides basic utilities for the filesy...\r\nsymfony/finder                                   v6.3.3    Finds files and directories via an intu...\r\nsymfony/framework-bundle                         v6.3.2    Provides a tight integration between Sy...\r\nsymfony/http-foundation                          v6.3.2    Defines an object-oriented layer for th...\r\nsymfony/http-kernel                              v6.3.3    Provides a structured process for conve...\r\nsymfony/polyfill-ctype                           v1.27.0   Symfony polyfill for ctype functions\r\nsymfony/polyfill-intl-grapheme                   v1.27.0   Symfony polyfill for intl's grapheme_* ...\r\nsymfony/polyfill-intl-normalizer                 v1.27.0   Symfony polyfill for intl's Normalizer ...\r\nsymfony/polyfill-mbstring                        v1.27.0   Symfony polyfill for the Mbstring exten...\r\nsymfony/polyfill-php80                           v1.27.0   Symfony polyfill backporting some PHP 8...\r\nsymfony/polyfill-php83                           v1.27.0   Symfony polyfill backporting some PHP 8...\r\nsymfony/routing                                  v6.3.3    Maps an HTTP request to a set of config...\r\nsymfony/service-contracts                        v3.3.0    Generic abstractions related to writing...\r\nsymfony/string                                   v6.3.2    Provides an object-oriented API to stri...\r\nsymfony/var-dumper                               v6.3.3    Provides mechanisms for walking through...\r\nsymfony/var-exporter                             v6.3.2    Allows exporting any serializable PHP d...\r\nsymfony/yaml                                     v6.3.3    Loads and dumps YAML files\r\ntheseer/autoload                                 1.28.0    A tool and library to generate autoload...\r\ntheseer/directoryscanner                         1.3.3     A recursive directory scanner and filter\r\ntheseer/tokenizer                                1.2.1     A small library for converting tokenize...\r\nzetacomponents/base                              1.9.4     The Base package provides the basic inf...\r\nzetacomponents/console-tools                     1.7.3     A set of classes to do different action..\r\n```","closed_by":{"login":"sebastianbergmann","id":25218,"node_id":"MDQ6VXNlcjI1MjE4","avatar_url":"https://avatars.githubusercontent.com/u/25218?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianbergmann","html_url":"https://github.com/sebastianbergmann","followers_url":"https://api.github.com/users/sebastianbergmann/followers","following_url":"https://api.github.com/users/sebastianbergmann/following{/other_user}","gists_url":"https://api.github.com/users/sebastianbergmann/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianbergmann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianbergmann/subscriptions","organizations_url":"https://api.github.com/users/sebastianbergmann/orgs","repos_url":"https://api.github.com/users/sebastianbergmann/repos","events_url":"https://api.github.com/users/sebastianbergmann/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianbergmann/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5487/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sebastianbergmann/phpunit/issues/5487/timeline","performed_via_github_app":null,"state_reason":"completed"}