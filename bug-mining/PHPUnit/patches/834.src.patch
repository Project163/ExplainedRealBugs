diff --git a/.psalm/baseline.xml b/.psalm/baseline.xml
index 6c6f2a111..3236ea81c 100644
--- a/.psalm/baseline.xml
+++ b/.psalm/baseline.xml
@@ -714,6 +714,8 @@
       <code><![CDATA[logEventsVerboseText]]></code>
       <code><![CDATA[logfileJunit]]></code>
       <code><![CDATA[logfileTeamcity]]></code>
+      <code><![CDATA[process]]></code>
+      <code><![CDATA[process]]></code>
     </MissingThrowsDocblock>
     <UnresolvableInclude>
       <code><![CDATA[include_once $filename]]></code>
diff --git a/ChangeLog-11.1.md b/ChangeLog-11.1.md
index 4fee43815..d62b32742 100644
--- a/ChangeLog-11.1.md
+++ b/ChangeLog-11.1.md
@@ -8,6 +8,7 @@ All notable changes of the PHPUnit 11.1 release series are documented in this fi
 
 * [#5175](https://github.com/sebastianbergmann/phpunit/issues/5175): `#[CoversMethod]` and `#[UsesMethod]` attributes for more fine-grained code coverage targeting
 * [#5696](https://github.com/sebastianbergmann/phpunit/pull/5696): `#[DisableReturnValueGenerationForTestDoubles]` attribute for disabling return value generation for test doubles created using `createMock()`, `createMockForIntersectionOfInterfaces()`, `createPartialMock()`, `createStub()`, and `createStubForIntersectionOfInterfaces()`
+* [#5720](https://github.com/sebastianbergmann/phpunit/issues/5720): Support filtering using `--filter`, `--exclude-filter`, `--group`, and `--exclude-group` when listing tests using `--list-tests` and `--list-tests-xml`
 * `--only-summary-for-coverage-text` CLI option to reduce the code coverage report in text format to a summary
 * `--show-uncovered-for-coverage-text` CLI option to expand the code coverage report in text format to include a list of uncovered files
 
diff --git a/src/Framework/TestSuite.php b/src/Framework/TestSuite.php
index bc7e2074c..89881ad53 100644
--- a/src/Framework/TestSuite.php
+++ b/src/Framework/TestSuite.php
@@ -305,6 +305,28 @@ public function groupDetails(): array
         return $this->groups;
     }
 
+    /**
+     * @psalm-return list<TestCase|PhptTestCase>
+     */
+    public function collect(): array
+    {
+        $tests = [];
+
+        foreach ($this as $test) {
+            if ($test instanceof self) {
+                $tests = array_merge($tests, $test->collect());
+
+                continue;
+            }
+
+            assert($test instanceof TestCase || $test instanceof PhptTestCase);
+
+            $tests[] = $test;
+        }
+
+        return $tests;
+    }
+
     /**
      * @throws CodeCoverageException
      * @throws Event\RuntimeException
diff --git a/src/TextUI/Application.php b/src/TextUI/Application.php
index 2bf6d3c78..14f714ab7 100644
--- a/src/TextUI/Application.php
+++ b/src/TextUI/Application.php
@@ -20,6 +20,7 @@
 use PHPUnit\Event\EventFacadeIsSealedException;
 use PHPUnit\Event\Facade as EventFacade;
 use PHPUnit\Event\UnknownSubscriberTypeException;
+use PHPUnit\Framework\TestCase;
 use PHPUnit\Framework\TestSuite;
 use PHPUnit\Logging\EventLogger;
 use PHPUnit\Logging\JUnit\JunitXmlLogger;
@@ -38,6 +39,7 @@
 use PHPUnit\Runner\Extension\Facade as ExtensionFacade;
 use PHPUnit\Runner\Extension\PharLoader;
 use PHPUnit\Runner\GarbageCollection\GarbageCollectionHandler;
+use PHPUnit\Runner\PhptTestCase;
 use PHPUnit\Runner\ResultCache\DefaultResultCache;
 use PHPUnit\Runner\ResultCache\NullResultCache;
 use PHPUnit\Runner\ResultCache\ResultCache;
@@ -421,14 +423,24 @@ private function executeCommandsThatRequireTheTestSuite(Configuration $configura
         }
 
         if ($cliConfiguration->listTests()) {
-            $this->execute(new ListTestsAsTextCommand($testSuite));
+            $this->execute(
+                new ListTestsAsTextCommand(
+                    $this->filteredTests(
+                        $configuration,
+                        $testSuite,
+                    ),
+                ),
+            );
         }
 
         if ($cliConfiguration->hasListTestsXml()) {
             $this->execute(
                 new ListTestsAsXmlCommand(
+                    $this->filteredTests(
+                        $configuration,
+                        $testSuite,
+                    ),
                     $cliConfiguration->listTestsXml(),
-                    $testSuite,
                 ),
             );
         }
@@ -663,4 +675,14 @@ private function exitWithErrorMessage(string $message): never
 
         exit(Result::EXCEPTION);
     }
+
+    /**
+     * @psalm-return list<TestCase|PhptTestCase>
+     */
+    private function filteredTests(Configuration $configuration, TestSuite $suite): array
+    {
+        (new TestSuiteFilterProcessor)->process($configuration, $suite);
+
+        return $suite->collect();
+    }
 }
diff --git a/src/TextUI/Command/Commands/ListTestsAsTextCommand.php b/src/TextUI/Command/Commands/ListTestsAsTextCommand.php
index dd771b181..b78cd064f 100644
--- a/src/TextUI/Command/Commands/ListTestsAsTextCommand.php
+++ b/src/TextUI/Command/Commands/ListTestsAsTextCommand.php
@@ -12,30 +12,25 @@
 use function sprintf;
 use function str_replace;
 use PHPUnit\Framework\TestCase;
-use PHPUnit\Framework\TestSuite;
 use PHPUnit\Runner\PhptTestCase;
-use PHPUnit\TextUI\Configuration\Registry;
-use RecursiveIteratorIterator;
 
 /**
  * @internal This class is not covered by the backward compatibility promise for PHPUnit
  */
 final readonly class ListTestsAsTextCommand implements Command
 {
-    private TestSuite $suite;
+    private array $tests;
 
-    public function __construct(TestSuite $suite)
+    public function __construct(array $tests)
     {
-        $this->suite = $suite;
+        $this->tests = $tests;
     }
 
     public function execute(): Result
     {
-        $buffer = $this->warnAboutConflictingOptions();
+        $buffer = 'Available test(s):' . PHP_EOL;
 
-        $buffer .= 'Available test(s):' . PHP_EOL;
-
-        foreach (new RecursiveIteratorIterator($this->suite) as $test) {
+        foreach ($this->tests as $test) {
             if ($test instanceof TestCase) {
                 $name = sprintf(
                     '%s::%s',
@@ -56,29 +51,4 @@ public function execute(): Result
 
         return Result::from($buffer);
     }
-
-    private function warnAboutConflictingOptions(): string
-    {
-        $buffer = '';
-
-        $configuration = Registry::get();
-
-        if ($configuration->hasFilter()) {
-            $buffer .= 'The --filter and --list-tests options cannot be combined, --filter is ignored' . PHP_EOL;
-        }
-
-        if ($configuration->hasGroups()) {
-            $buffer .= 'The --group and --list-tests options cannot be combined, --group is ignored' . PHP_EOL;
-        }
-
-        if ($configuration->hasExcludeGroups()) {
-            $buffer .= 'The --exclude-group and --list-tests options cannot be combined, --exclude-group is ignored' . PHP_EOL;
-        }
-
-        if (!empty($buffer)) {
-            $buffer .= PHP_EOL;
-        }
-
-        return $buffer;
-    }
 }
diff --git a/src/TextUI/Command/Commands/ListTestsAsXmlCommand.php b/src/TextUI/Command/Commands/ListTestsAsXmlCommand.php
index ebf9fc87f..333c018b0 100644
--- a/src/TextUI/Command/Commands/ListTestsAsXmlCommand.php
+++ b/src/TextUI/Command/Commands/ListTestsAsXmlCommand.php
@@ -13,10 +13,7 @@
 use function ksort;
 use function sprintf;
 use PHPUnit\Framework\TestCase;
-use PHPUnit\Framework\TestSuite;
 use PHPUnit\Runner\PhptTestCase;
-use PHPUnit\TextUI\Configuration\Registry;
-use RecursiveIteratorIterator;
 use XMLWriter;
 
 /**
@@ -24,18 +21,17 @@
  */
 final readonly class ListTestsAsXmlCommand implements Command
 {
+    private array $tests;
     private string $filename;
-    private TestSuite $suite;
 
-    public function __construct(string $filename, TestSuite $suite)
+    public function __construct(array $tests, string $filename)
     {
+        $this->tests    = $tests;
         $this->filename = $filename;
-        $this->suite    = $suite;
     }
 
     public function execute(): Result
     {
-        $buffer = $this->warnAboutConflictingOptions();
         $writer = new XMLWriter;
 
         $writer->openMemory();
@@ -50,7 +46,7 @@ public function execute(): Result
         $currentTestClass = null;
         $groups           = [];
 
-        foreach (new RecursiveIteratorIterator($this->suite) as $test) {
+        foreach ($this->tests as $test) {
             if ($test instanceof TestCase) {
                 foreach ($test->groups() as $group) {
                     if (!isset($groups[$group])) {
@@ -121,36 +117,11 @@ public function execute(): Result
 
         file_put_contents($this->filename, $writer->outputMemory());
 
-        $buffer .= sprintf(
-            'Wrote list of tests that would have been run to %s' . PHP_EOL,
-            $this->filename,
+        return Result::from(
+            sprintf(
+                'Wrote list of tests that would have been run to %s' . PHP_EOL,
+                $this->filename,
+            ),
         );
-
-        return Result::from($buffer);
-    }
-
-    private function warnAboutConflictingOptions(): string
-    {
-        $buffer = '';
-
-        $configuration = Registry::get();
-
-        if ($configuration->hasFilter()) {
-            $buffer .= 'The --filter and --list-tests-xml options cannot be combined, --filter is ignored' . PHP_EOL;
-        }
-
-        if ($configuration->hasGroups()) {
-            $buffer .= 'The --group and --list-tests-xml options cannot be combined, --group is ignored' . PHP_EOL;
-        }
-
-        if ($configuration->hasExcludeGroups()) {
-            $buffer .= 'The --exclude-group and --list-tests-xml options cannot be combined, --exclude-group is ignored' . PHP_EOL;
-        }
-
-        if (!empty($buffer)) {
-            $buffer .= PHP_EOL;
-        }
-
-        return $buffer;
     }
 }
diff --git a/tests/end-to-end/_files/list-tests/ExampleTest.php b/tests/end-to-end/_files/list-tests/ExampleTest.php
deleted file mode 100644
index 8f867d455..000000000
--- a/tests/end-to-end/_files/list-tests/ExampleTest.php
+++ /dev/null
@@ -1,42 +0,0 @@
-<?php declare(strict_types=1);
-/*
- * This file is part of PHPUnit.
- *
- * (c) Sebastian Bergmann <sebastian@phpunit.de>
- *
- * For the full copyright and license information, please view the LICENSE
- * file that was distributed with this source code.
- */
-namespace PHPUnit\TestFixture\ListTestsXml;
-
-use PHPUnit\Framework\Attributes\DataProvider;
-use PHPUnit\Framework\Attributes\Group;
-use PHPUnit\Framework\TestCase;
-
-final class ExampleTest extends TestCase
-{
-    public static function provider(): array
-    {
-        return [
-            [1, 2, 3],
-        ];
-    }
-
-    #[DataProvider('provider')]
-    #[Group('example')]
-    public function testOne(int $a, int $b, int $c): void
-    {
-        $this->assertTrue(true);
-    }
-
-    #[Group('another-example')]
-    public function testTwo(): void
-    {
-        $this->assertTrue(true);
-    }
-
-    public function testThree(): void
-    {
-        $this->assertTrue(true);
-    }
-}
diff --git a/tests/end-to-end/_files/list-tests/example.phpt b/tests/end-to-end/_files/list-tests/example.phpt
deleted file mode 100644
index e69de29bb..000000000
diff --git a/tests/end-to-end/_files/list-tests/AnotherExampleTest.php b/tests/end-to-end/_files/listing-tests-and-groups/ExampleTest.php
similarity index 59%
rename from tests/end-to-end/_files/list-tests/AnotherExampleTest.php
rename to tests/end-to-end/_files/listing-tests-and-groups/ExampleTest.php
index 82faa0f4f..2c3c3c99b 100644
--- a/tests/end-to-end/_files/list-tests/AnotherExampleTest.php
+++ b/tests/end-to-end/_files/listing-tests-and-groups/ExampleTest.php
@@ -7,14 +7,22 @@
  * For the full copyright and license information, please view the LICENSE
  * file that was distributed with this source code.
  */
-namespace PHPUnit\TestFixture\ListTestsXml;
+namespace PHPUnit\TestFixture\ListingTestsAndGroups;
 
+use PHPUnit\Framework\Attributes\Group;
 use PHPUnit\Framework\TestCase;
 
-final class AnotherExampleTest extends TestCase
+final class ExampleTest extends TestCase
 {
+    #[Group('one')]
     public function testOne(): void
     {
         $this->assertTrue(true);
     }
+
+    #[Group('two')]
+    public function testTwo(): void
+    {
+        $this->assertTrue(true);
+    }
 }
diff --git a/tests/end-to-end/cli/group/failure/list-groups-and-exclude-filter.phpt b/tests/end-to-end/cli/group/failure/list-groups-and-exclude-filter.phpt
deleted file mode 100644
index f274beaf8..000000000
--- a/tests/end-to-end/cli/group/failure/list-groups-and-exclude-filter.phpt
+++ /dev/null
@@ -1,20 +0,0 @@
---TEST--
-phpunit --list-groups --exclude-filter name
---FILE--
-<?php declare(strict_types=1);
-$_SERVER['argv'][] = '--do-not-cache-result';
-$_SERVER['argv'][] = '--no-configuration';
-$_SERVER['argv'][] = '--list-groups';
-$_SERVER['argv'][] = '--exclude-filter';
-$_SERVER['argv'][] = 'name';
-
-require_once __DIR__ . '/../../../../bootstrap.php';
-
-(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
---EXPECTF--
-PHPUnit %s by Sebastian Bergmann and contributors.
-
-The --exclude-filter and --list-groups options cannot be combined, --exclude-filter is ignored
-
-Available test group(s):
-
diff --git a/tests/end-to-end/cli/group/failure/list-groups-and-exclude-group.phpt b/tests/end-to-end/cli/group/failure/list-groups-and-exclude-group.phpt
deleted file mode 100644
index bdb78b030..000000000
--- a/tests/end-to-end/cli/group/failure/list-groups-and-exclude-group.phpt
+++ /dev/null
@@ -1,20 +0,0 @@
---TEST--
-phpunit --list-groups --exclude-group name
---FILE--
-<?php declare(strict_types=1);
-$_SERVER['argv'][] = '--do-not-cache-result';
-$_SERVER['argv'][] = '--no-configuration';
-$_SERVER['argv'][] = '--list-groups';
-$_SERVER['argv'][] = '--exclude-group';
-$_SERVER['argv'][] = 'name';
-
-require_once __DIR__ . '/../../../../bootstrap.php';
-
-(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
---EXPECTF--
-PHPUnit %s by Sebastian Bergmann and contributors.
-
-The --exclude-group and --list-groups options cannot be combined, --exclude-group is ignored
-
-Available test group(s):
-
diff --git a/tests/end-to-end/cli/group/failure/list-groups-and-filter.phpt b/tests/end-to-end/cli/group/failure/list-groups-and-filter.phpt
deleted file mode 100644
index 372569292..000000000
--- a/tests/end-to-end/cli/group/failure/list-groups-and-filter.phpt
+++ /dev/null
@@ -1,20 +0,0 @@
---TEST--
-phpunit --list-groups --filter name
---FILE--
-<?php declare(strict_types=1);
-$_SERVER['argv'][] = '--do-not-cache-result';
-$_SERVER['argv'][] = '--no-configuration';
-$_SERVER['argv'][] = '--list-groups';
-$_SERVER['argv'][] = '--filter';
-$_SERVER['argv'][] = 'name';
-
-require_once __DIR__ . '/../../../../bootstrap.php';
-
-(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
---EXPECTF--
-PHPUnit %s by Sebastian Bergmann and contributors.
-
-The --filter and --list-groups options cannot be combined, --filter is ignored
-
-Available test group(s):
-
diff --git a/tests/end-to-end/cli/group/failure/list-groups-and-group.phpt b/tests/end-to-end/cli/group/failure/list-groups-and-group.phpt
deleted file mode 100644
index 0c670436a..000000000
--- a/tests/end-to-end/cli/group/failure/list-groups-and-group.phpt
+++ /dev/null
@@ -1,20 +0,0 @@
---TEST--
-phpunit --list-groups --group name
---FILE--
-<?php declare(strict_types=1);
-$_SERVER['argv'][] = '--do-not-cache-result';
-$_SERVER['argv'][] = '--no-configuration';
-$_SERVER['argv'][] = '--list-groups';
-$_SERVER['argv'][] = '--group';
-$_SERVER['argv'][] = 'name';
-
-require_once __DIR__ . '/../../../../bootstrap.php';
-
-(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
---EXPECTF--
-PHPUnit %s by Sebastian Bergmann and contributors.
-
-The --group and --list-groups options cannot be combined, --group is ignored
-
-Available test group(s):
-
diff --git a/tests/end-to-end/cli/group/failure/list-groups-and-testsuite.phpt b/tests/end-to-end/cli/group/failure/list-groups-and-testsuite.phpt
deleted file mode 100644
index 0cfdb2be7..000000000
--- a/tests/end-to-end/cli/group/failure/list-groups-and-testsuite.phpt
+++ /dev/null
@@ -1,20 +0,0 @@
---TEST--
-phpunit --list-groups --testsuite name
---FILE--
-<?php declare(strict_types=1);
-$_SERVER['argv'][] = '--do-not-cache-result';
-$_SERVER['argv'][] = '--no-configuration';
-$_SERVER['argv'][] = '--list-groups';
-$_SERVER['argv'][] = '--testsuite';
-$_SERVER['argv'][] = 'name';
-
-require_once __DIR__ . '/../../../../bootstrap.php';
-
-(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
---EXPECTF--
-PHPUnit %s by Sebastian Bergmann and contributors.
-
-The --testsuite and --list-groups options cannot be combined, --testsuite is ignored
-
-Available test group(s):
-
diff --git a/tests/end-to-end/cli/group/list-groups-configuration.phpt b/tests/end-to-end/cli/group/list-groups-configuration.phpt
deleted file mode 100644
index 8bd18080f..000000000
--- a/tests/end-to-end/cli/group/list-groups-configuration.phpt
+++ /dev/null
@@ -1,19 +0,0 @@
---TEST--
-phpunit --list-groups
---FILE--
-<?php declare(strict_types=1);
-$_SERVER['argv'][] = '--do-not-cache-result';
-$_SERVER['argv'][] = '--configuration';
-$_SERVER['argv'][] = __DIR__ . '/../../_files/groups';
-$_SERVER['argv'][] = '--list-groups';
-
-require_once __DIR__ . '/../../../bootstrap.php';
-
-(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
---EXPECTF--
-PHPUnit %s by Sebastian Bergmann and contributors.
-
-Available test group(s):
- - default
- - one
- - two
diff --git a/tests/end-to-end/cli/list-tests/list-tests-filter.phpt b/tests/end-to-end/cli/list-tests/list-tests-filter.phpt
deleted file mode 100644
index b7ba8588a..000000000
--- a/tests/end-to-end/cli/list-tests/list-tests-filter.phpt
+++ /dev/null
@@ -1,24 +0,0 @@
---TEST--
-phpunit --filter testOne#0 --list-tests ../../_files/list-tests
---FILE--
-<?php declare(strict_types=1);
-$_SERVER['argv'][] = '--do-not-cache-result';
-$_SERVER['argv'][] = '--no-configuration';
-$_SERVER['argv'][] = '--filter';
-$_SERVER['argv'][] = 'testOne#0';
-$_SERVER['argv'][] = '--list-tests';
-$_SERVER['argv'][] = __DIR__ . '/../../_files/list-tests';
-
-require_once __DIR__ . '/../../../bootstrap.php';
-(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
---EXPECTF--
-PHPUnit %s by Sebastian Bergmann and contributors.
-
-The --filter and --list-tests options cannot be combined, --filter is ignored
-
-Available test(s):
- - PHPUnit\TestFixture\ListTestsXml\AnotherExampleTest::testOne
- - PHPUnit\TestFixture\ListTestsXml\ExampleTest::testOne#0
- - PHPUnit\TestFixture\ListTestsXml\ExampleTest::testTwo
- - PHPUnit\TestFixture\ListTestsXml\ExampleTest::testThree
- - %sexample.phpt
diff --git a/tests/end-to-end/cli/list-tests/list-tests-xml-filter.phpt b/tests/end-to-end/cli/list-tests/list-tests-xml-filter.phpt
deleted file mode 100644
index 16dabc582..000000000
--- a/tests/end-to-end/cli/list-tests/list-tests-xml-filter.phpt
+++ /dev/null
@@ -1,52 +0,0 @@
---TEST--
-phpunit --filter testOne#0 --list-tests-xml php://stdout ../../_files/list-tests
---SKIPIF--
-<?php declare(strict_types=1);
-if (version_compare('8.3.0', PHP_VERSION, '>')) {
-    print 'skip: PHP < 8.3 required';
-}
---FILE--
-<?php declare(strict_types=1);
-$_SERVER['argv'][] = '--do-not-cache-result';
-$_SERVER['argv'][] = '--no-configuration';
-$_SERVER['argv'][] = '--filter';
-$_SERVER['argv'][] = 'testOne#0';
-$_SERVER['argv'][] = '--list-tests-xml';
-$_SERVER['argv'][] = 'php://stdout';
-$_SERVER['argv'][] = __DIR__ . '/../../_files/list-tests';
-
-require_once __DIR__ . '/../../../bootstrap.php';
-
-(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
---EXPECTF--
-PHPUnit %s by Sebastian Bergmann and contributors.
-
-<?xml version="1.0"?>
-<testSuite xmlns="https://xml.phpunit.de/testSuite">
- <tests>
-  <testClass name="PHPUnit\TestFixture\ListTestsXml\AnotherExampleTest" file="%sAnotherExampleTest.php">
-   <testMethod id="PHPUnit\TestFixture\ListTestsXml\AnotherExampleTest::testOne" name="testOne"/>
-  </testClass>
-  <testClass name="PHPUnit\TestFixture\ListTestsXml\ExampleTest" file="%sExampleTest.php">
-   <testMethod id="PHPUnit\TestFixture\ListTestsXml\ExampleTest::testOne#0" name="testOne"/>
-   <testMethod id="PHPUnit\TestFixture\ListTestsXml\ExampleTest::testTwo" name="testTwo"/>
-   <testMethod id="PHPUnit\TestFixture\ListTestsXml\ExampleTest::testThree" name="testThree"/>
-  </testClass>
-  <phpt file="%sexample.phpt"/>
- </tests>
- <groups>
-  <group name="another-example">
-   <test id="PHPUnit\TestFixture\ListTestsXml\ExampleTest::testTwo"/>
-  </group>
-  <group name="default">
-   <test id="PHPUnit\TestFixture\ListTestsXml\AnotherExampleTest::testOne"/>
-   <test id="PHPUnit\TestFixture\ListTestsXml\ExampleTest::testThree"/>
-  </group>
-  <group name="example">
-   <test id="PHPUnit\TestFixture\ListTestsXml\ExampleTest::testOne#0"/>
-  </group>
- </groups>
-</testSuite>
-The --filter and --list-tests-xml options cannot be combined, --filter is ignored
-
-Wrote list of tests that would have been run to php://stdout
diff --git a/tests/end-to-end/cli/list-tests/list-tests-xml.phpt b/tests/end-to-end/cli/list-tests/list-tests-xml.phpt
deleted file mode 100644
index 22d30bc2f..000000000
--- a/tests/end-to-end/cli/list-tests/list-tests-xml.phpt
+++ /dev/null
@@ -1,48 +0,0 @@
---TEST--
-phpunit --list-tests-xml php://stdout ../../_files/list-tests
---SKIPIF--
-<?php declare(strict_types=1);
-if (version_compare('8.3.0', PHP_VERSION, '>')) {
-    print 'skip: PHP < 8.3 required';
-}
---FILE--
-<?php declare(strict_types=1);
-$_SERVER['argv'][] = '--do-not-cache-result';
-$_SERVER['argv'][] = '--no-configuration';
-$_SERVER['argv'][] = '--list-tests-xml';
-$_SERVER['argv'][] = 'php://stdout';
-$_SERVER['argv'][] = __DIR__ . '/../../_files/list-tests';
-
-require_once __DIR__ . '/../../../bootstrap.php';
-
-(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
---EXPECTF--
-PHPUnit %s by Sebastian Bergmann and contributors.
-
-<?xml version="1.0"?>
-<testSuite xmlns="https://xml.phpunit.de/testSuite">
- <tests>
-  <testClass name="PHPUnit\TestFixture\ListTestsXml\AnotherExampleTest" file="%sAnotherExampleTest.php">
-   <testMethod id="PHPUnit\TestFixture\ListTestsXml\AnotherExampleTest::testOne" name="testOne"/>
-  </testClass>
-  <testClass name="PHPUnit\TestFixture\ListTestsXml\ExampleTest" file="%sExampleTest.php">
-   <testMethod id="PHPUnit\TestFixture\ListTestsXml\ExampleTest::testOne#0" name="testOne"/>
-   <testMethod id="PHPUnit\TestFixture\ListTestsXml\ExampleTest::testTwo" name="testTwo"/>
-   <testMethod id="PHPUnit\TestFixture\ListTestsXml\ExampleTest::testThree" name="testThree"/>
-  </testClass>
-  <phpt file="%sexample.phpt"/>
- </tests>
- <groups>
-  <group name="another-example">
-   <test id="PHPUnit\TestFixture\ListTestsXml\ExampleTest::testTwo"/>
-  </group>
-  <group name="default">
-   <test id="PHPUnit\TestFixture\ListTestsXml\AnotherExampleTest::testOne"/>
-   <test id="PHPUnit\TestFixture\ListTestsXml\ExampleTest::testThree"/>
-  </group>
-  <group name="example">
-   <test id="PHPUnit\TestFixture\ListTestsXml\ExampleTest::testOne#0"/>
-  </group>
- </groups>
-</testSuite>
-Wrote list of tests that would have been run to php://stdout
diff --git a/tests/end-to-end/cli/list-tests/list-tests.phpt b/tests/end-to-end/cli/list-tests/list-tests.phpt
deleted file mode 100644
index ff0f8214d..000000000
--- a/tests/end-to-end/cli/list-tests/list-tests.phpt
+++ /dev/null
@@ -1,20 +0,0 @@
---TEST--
-phpunit --list-tests-xml php://stdout ../../_files/list-tests
---FILE--
-<?php declare(strict_types=1);
-$_SERVER['argv'][] = '--do-not-cache-result';
-$_SERVER['argv'][] = '--no-configuration';
-$_SERVER['argv'][] = '--list-tests';
-$_SERVER['argv'][] = __DIR__ . '/../../_files/list-tests';
-
-require_once __DIR__ . '/../../../bootstrap.php';
-(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
---EXPECTF--
-PHPUnit %s by Sebastian Bergmann and contributors.
-
-Available test(s):
- - PHPUnit\TestFixture\ListTestsXml\AnotherExampleTest::testOne
- - PHPUnit\TestFixture\ListTestsXml\ExampleTest::testOne#0
- - PHPUnit\TestFixture\ListTestsXml\ExampleTest::testTwo
- - PHPUnit\TestFixture\ListTestsXml\ExampleTest::testThree
- - %sexample.phpt
diff --git a/tests/end-to-end/cli/group/list-groups-argument.phpt b/tests/end-to-end/cli/listing-tests-and-groups/list-groups.phpt
similarity index 74%
rename from tests/end-to-end/cli/group/list-groups-argument.phpt
rename to tests/end-to-end/cli/listing-tests-and-groups/list-groups.phpt
index 45b8e349c..e6809be0d 100644
--- a/tests/end-to-end/cli/group/list-groups-argument.phpt
+++ b/tests/end-to-end/cli/listing-tests-and-groups/list-groups.phpt
@@ -1,11 +1,11 @@
 --TEST--
-phpunit --list-groups tests/FooTest.php
+phpunit --list-groups ../../_files/listing-tests-and-groups
 --FILE--
 <?php declare(strict_types=1);
 $_SERVER['argv'][] = '--do-not-cache-result';
 $_SERVER['argv'][] = '--no-configuration';
 $_SERVER['argv'][] = '--list-groups';
-$_SERVER['argv'][] = __DIR__ . '/../../_files/groups/tests/FooTest.php';
+$_SERVER['argv'][] = __DIR__ . '/../../_files/listing-tests-and-groups';
 
 require_once __DIR__ . '/../../../bootstrap.php';
 
@@ -14,6 +14,5 @@ require_once __DIR__ . '/../../../bootstrap.php';
 PHPUnit %s by Sebastian Bergmann and contributors.
 
 Available test group(s):
- - default
  - one
  - two
diff --git a/tests/end-to-end/cli/listing-tests-and-groups/list-tests-exclude-filter.phpt b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-exclude-filter.phpt
new file mode 100644
index 000000000..92ba4a127
--- /dev/null
+++ b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-exclude-filter.phpt
@@ -0,0 +1,19 @@
+--TEST--
+phpunit --exclude-filter testOne --list-tests ../../_files/listing-tests-and-groups
+--FILE--
+<?php declare(strict_types=1);
+$_SERVER['argv'][] = '--do-not-cache-result';
+$_SERVER['argv'][] = '--no-configuration';
+$_SERVER['argv'][] = '--exclude-filter';
+$_SERVER['argv'][] = 'testOne';
+$_SERVER['argv'][] = '--list-tests';
+$_SERVER['argv'][] = __DIR__ . '/../../_files/listing-tests-and-groups';
+
+require_once __DIR__ . '/../../../bootstrap.php';
+
+(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
+--EXPECTF--
+PHPUnit %s by Sebastian Bergmann and contributors.
+
+Available test(s):
+ - PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testTwo
diff --git a/tests/end-to-end/cli/listing-tests-and-groups/list-tests-exclude-group.phpt b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-exclude-group.phpt
new file mode 100644
index 000000000..a5efb2876
--- /dev/null
+++ b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-exclude-group.phpt
@@ -0,0 +1,19 @@
+--TEST--
+phpunit --exclude-group one --list-tests ../../_files/listing-tests-and-groups
+--FILE--
+<?php declare(strict_types=1);
+$_SERVER['argv'][] = '--do-not-cache-result';
+$_SERVER['argv'][] = '--no-configuration';
+$_SERVER['argv'][] = '--exclude-group';
+$_SERVER['argv'][] = 'one';
+$_SERVER['argv'][] = '--list-tests';
+$_SERVER['argv'][] = __DIR__ . '/../../_files/listing-tests-and-groups';
+
+require_once __DIR__ . '/../../../bootstrap.php';
+
+(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
+--EXPECTF--
+PHPUnit %s by Sebastian Bergmann and contributors.
+
+Available test(s):
+ - PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testTwo
diff --git a/tests/end-to-end/cli/listing-tests-and-groups/list-tests-include-filter.phpt b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-include-filter.phpt
new file mode 100644
index 000000000..03fd7df72
--- /dev/null
+++ b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-include-filter.phpt
@@ -0,0 +1,19 @@
+--TEST--
+phpunit --filter testOne --list-tests ../../_files/listing-tests-and-groups
+--FILE--
+<?php declare(strict_types=1);
+$_SERVER['argv'][] = '--do-not-cache-result';
+$_SERVER['argv'][] = '--no-configuration';
+$_SERVER['argv'][] = '--filter';
+$_SERVER['argv'][] = 'testOne';
+$_SERVER['argv'][] = '--list-tests';
+$_SERVER['argv'][] = __DIR__ . '/../../_files/listing-tests-and-groups';
+
+require_once __DIR__ . '/../../../bootstrap.php';
+
+(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
+--EXPECTF--
+PHPUnit %s by Sebastian Bergmann and contributors.
+
+Available test(s):
+ - PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testOne
diff --git a/tests/end-to-end/cli/listing-tests-and-groups/list-tests-include-group.phpt b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-include-group.phpt
new file mode 100644
index 000000000..a69efbf19
--- /dev/null
+++ b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-include-group.phpt
@@ -0,0 +1,19 @@
+--TEST--
+phpunit --group one --list-tests ../../_files/listing-tests-and-groups
+--FILE--
+<?php declare(strict_types=1);
+$_SERVER['argv'][] = '--do-not-cache-result';
+$_SERVER['argv'][] = '--no-configuration';
+$_SERVER['argv'][] = '--group';
+$_SERVER['argv'][] = 'one';
+$_SERVER['argv'][] = '--list-tests';
+$_SERVER['argv'][] = __DIR__ . '/../../_files/listing-tests-and-groups';
+
+require_once __DIR__ . '/../../../bootstrap.php';
+
+(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
+--EXPECTF--
+PHPUnit %s by Sebastian Bergmann and contributors.
+
+Available test(s):
+ - PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testOne
diff --git a/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml-exclude-filter.phpt b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml-exclude-filter.phpt
new file mode 100644
index 000000000..93e62a821
--- /dev/null
+++ b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml-exclude-filter.phpt
@@ -0,0 +1,32 @@
+--TEST--
+phpunit --exclude-filter testOne --list-tests-xml php://stdout ../../_files/listing-tests-and-groups
+--FILE--
+<?php declare(strict_types=1);
+$_SERVER['argv'][] = '--do-not-cache-result';
+$_SERVER['argv'][] = '--no-configuration';
+$_SERVER['argv'][] = '--exclude-filter';
+$_SERVER['argv'][] = 'testOne';
+$_SERVER['argv'][] = '--list-tests-xml';
+$_SERVER['argv'][] = 'php://stdout';
+$_SERVER['argv'][] = __DIR__ . '/../../_files/listing-tests-and-groups';
+
+require_once __DIR__ . '/../../../bootstrap.php';
+
+(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
+--EXPECTF--
+PHPUnit %s by Sebastian Bergmann and contributors.
+
+<?xml version="1.0"?>
+<testSuite xmlns="https://xml.phpunit.de/testSuite">
+ <tests>
+  <testClass name="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest" file="%sExampleTest.php">
+   <testMethod id="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testTwo" name="testTwo"/>
+  </testClass>
+ </tests>
+ <groups>
+  <group name="two">
+   <test id="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testTwo"/>
+  </group>
+ </groups>
+</testSuite>
+Wrote list of tests that would have been run to php://stdout
diff --git a/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml-exclude-group.phpt b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml-exclude-group.phpt
new file mode 100644
index 000000000..bfe3c4822
--- /dev/null
+++ b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml-exclude-group.phpt
@@ -0,0 +1,32 @@
+--TEST--
+phpunit --exclude-group one --list-tests-xml php://stdout ../../_files/listing-tests-and-groups
+--FILE--
+<?php declare(strict_types=1);
+$_SERVER['argv'][] = '--do-not-cache-result';
+$_SERVER['argv'][] = '--no-configuration';
+$_SERVER['argv'][] = '--exclude-group';
+$_SERVER['argv'][] = 'one';
+$_SERVER['argv'][] = '--list-tests-xml';
+$_SERVER['argv'][] = 'php://stdout';
+$_SERVER['argv'][] = __DIR__ . '/../../_files/listing-tests-and-groups';
+
+require_once __DIR__ . '/../../../bootstrap.php';
+
+(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
+--EXPECTF--
+PHPUnit %s by Sebastian Bergmann and contributors.
+
+<?xml version="1.0"?>
+<testSuite xmlns="https://xml.phpunit.de/testSuite">
+ <tests>
+  <testClass name="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest" file="%sExampleTest.php">
+   <testMethod id="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testTwo" name="testTwo"/>
+  </testClass>
+ </tests>
+ <groups>
+  <group name="two">
+   <test id="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testTwo"/>
+  </group>
+ </groups>
+</testSuite>
+Wrote list of tests that would have been run to php://stdout
diff --git a/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml-include-filter.phpt b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml-include-filter.phpt
new file mode 100644
index 000000000..17f2e5b84
--- /dev/null
+++ b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml-include-filter.phpt
@@ -0,0 +1,32 @@
+--TEST--
+phpunit --filter testOne --list-tests-xml php://stdout ../../_files/listing-tests-and-groups
+--FILE--
+<?php declare(strict_types=1);
+$_SERVER['argv'][] = '--do-not-cache-result';
+$_SERVER['argv'][] = '--no-configuration';
+$_SERVER['argv'][] = '--filter';
+$_SERVER['argv'][] = 'testOne';
+$_SERVER['argv'][] = '--list-tests-xml';
+$_SERVER['argv'][] = 'php://stdout';
+$_SERVER['argv'][] = __DIR__ . '/../../_files/listing-tests-and-groups';
+
+require_once __DIR__ . '/../../../bootstrap.php';
+
+(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
+--EXPECTF--
+PHPUnit %s by Sebastian Bergmann and contributors.
+
+<?xml version="1.0"?>
+<testSuite xmlns="https://xml.phpunit.de/testSuite">
+ <tests>
+  <testClass name="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest" file="%sExampleTest.php">
+   <testMethod id="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testOne" name="testOne"/>
+  </testClass>
+ </tests>
+ <groups>
+  <group name="one">
+   <test id="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testOne"/>
+  </group>
+ </groups>
+</testSuite>
+Wrote list of tests that would have been run to php://stdout
diff --git a/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml-include-group.phpt b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml-include-group.phpt
new file mode 100644
index 000000000..45ce5171d
--- /dev/null
+++ b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml-include-group.phpt
@@ -0,0 +1,32 @@
+--TEST--
+phpunit --group one --list-tests-xml php://stdout ../../_files/listing-tests-and-groups
+--FILE--
+<?php declare(strict_types=1);
+$_SERVER['argv'][] = '--do-not-cache-result';
+$_SERVER['argv'][] = '--no-configuration';
+$_SERVER['argv'][] = '--group';
+$_SERVER['argv'][] = 'one';
+$_SERVER['argv'][] = '--list-tests-xml';
+$_SERVER['argv'][] = 'php://stdout';
+$_SERVER['argv'][] = __DIR__ . '/../../_files/listing-tests-and-groups';
+
+require_once __DIR__ . '/../../../bootstrap.php';
+
+(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
+--EXPECTF--
+PHPUnit %s by Sebastian Bergmann and contributors.
+
+<?xml version="1.0"?>
+<testSuite xmlns="https://xml.phpunit.de/testSuite">
+ <tests>
+  <testClass name="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest" file="%sExampleTest.php">
+   <testMethod id="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testOne" name="testOne"/>
+  </testClass>
+ </tests>
+ <groups>
+  <group name="one">
+   <test id="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testOne"/>
+  </group>
+ </groups>
+</testSuite>
+Wrote list of tests that would have been run to php://stdout
diff --git a/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml.phpt b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml.phpt
new file mode 100644
index 000000000..387dfad99
--- /dev/null
+++ b/tests/end-to-end/cli/listing-tests-and-groups/list-tests-xml.phpt
@@ -0,0 +1,35 @@
+--TEST--
+phpunit --no-output --list-tests-xml php://stdout ../../_files/listing-tests-and-groups
+--FILE--
+<?php declare(strict_types=1);
+$_SERVER['argv'][] = '--do-not-cache-result';
+$_SERVER['argv'][] = '--no-configuration';
+$_SERVER['argv'][] = '--no-output';
+$_SERVER['argv'][] = '--list-tests-xml';
+$_SERVER['argv'][] = 'php://stdout';
+$_SERVER['argv'][] = __DIR__ . '/../../_files/listing-tests-and-groups';
+
+require_once __DIR__ . '/../../../bootstrap.php';
+
+(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
+--EXPECTF--
+PHPUnit %s by Sebastian Bergmann and contributors.
+
+<?xml version="1.0"?>
+<testSuite xmlns="https://xml.phpunit.de/testSuite">
+ <tests>
+  <testClass name="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest" file="%sExampleTest.php">
+   <testMethod id="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testOne" name="testOne"/>
+   <testMethod id="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testTwo" name="testTwo"/>
+  </testClass>
+ </tests>
+ <groups>
+  <group name="one">
+   <test id="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testOne"/>
+  </group>
+  <group name="two">
+   <test id="PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testTwo"/>
+  </group>
+ </groups>
+</testSuite>
+Wrote list of tests that would have been run to php://stdout
diff --git a/tests/end-to-end/cli/listing-tests-and-groups/list-tests.phpt b/tests/end-to-end/cli/listing-tests-and-groups/list-tests.phpt
new file mode 100644
index 000000000..f9146a7a0
--- /dev/null
+++ b/tests/end-to-end/cli/listing-tests-and-groups/list-tests.phpt
@@ -0,0 +1,18 @@
+--TEST--
+phpunit --list-tests ../../_files/listing-tests-and-groups
+--FILE--
+<?php declare(strict_types=1);
+$_SERVER['argv'][] = '--do-not-cache-result';
+$_SERVER['argv'][] = '--no-configuration';
+$_SERVER['argv'][] = '--list-tests';
+$_SERVER['argv'][] = __DIR__ . '/../../_files/listing-tests-and-groups';
+
+require_once __DIR__ . '/../../../bootstrap.php';
+
+(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
+--EXPECTF--
+PHPUnit %s by Sebastian Bergmann and contributors.
+
+Available test(s):
+ - PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testOne
+ - PHPUnit\TestFixture\ListingTestsAndGroups\ExampleTest::testTwo
diff --git a/tests/end-to-end/groups-from-configuration/list-groups.phpt b/tests/end-to-end/groups-from-configuration/list-groups.phpt
deleted file mode 100644
index a97dd5c28..000000000
--- a/tests/end-to-end/groups-from-configuration/list-groups.phpt
+++ /dev/null
@@ -1,20 +0,0 @@
---TEST--
-phpunit --configuration _files/phpunit.xml --list-groups
---FILE--
-<?php declare(strict_types=1);
-$_SERVER['argv'][] = '--do-not-cache-result';
-$_SERVER['argv'][] = '--configuration';
-$_SERVER['argv'][] = \realpath(__DIR__ . '/_files/phpunit.xml');
-$_SERVER['argv'][] = '--list-groups';
-
-require_once __DIR__ . '/../../bootstrap.php';
-
-(new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
---EXPECTF--
-PHPUnit %s by Sebastian Bergmann and contributors.
-
-Available test group(s):
- - another-group
- - bar
- - baz
- - foo
