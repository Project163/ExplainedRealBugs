diff --git a/src/Framework/TestCase.php b/src/Framework/TestCase.php
index 809d398d2..b95ceb3df 100755
--- a/src/Framework/TestCase.php
+++ b/src/Framework/TestCase.php
@@ -46,6 +46,8 @@
 use SebastianBergmann\GlobalState\Snapshot;
 use SebastianBergmann\GlobalState\Restorer;
 use SebastianBergmann\GlobalState\Blacklist;
+use SebastianBergmann\Exporter\Context;
+use SebastianBergmann\Exporter\Exporter;
 
 /**
  * A TestCase defines the fixture to run multiple tests.
@@ -1652,45 +1654,40 @@ public static function onConsecutiveCalls()
     }
 
     /**
-     * @param  mixed  $data
+     * @param  mixed                              $data       The data to export as a string
+     * @param  SebastianBergmann\Exporter\Context $processed  Contains all objects and arrays that have previously been processed
      * @return string
      * @since  Method available since Release 3.2.1
      */
-    protected function dataToString($data)
+    protected function dataToString(&$data, $processed = NULL)
     {
         $result = array();
+        $exporter = new Exporter();
 
-        set_error_handler(function ($errno, $errstr, $errfile, $errline) {
-            throw new ErrorException($errstr, $errno, $errno, $errfile, $errline);
-        }, E_WARNING);
+        if (!$processed) {
+            $processed = new Context();
+        }
 
-        foreach ($data as $key => $_data) {
-            try {
-                // Detect array-recursions by using count
-                // http://php.net/manual/en/function.count.php
-                $iRecursiveCheck = count($_data, COUNT_RECURSIVE);
-
-                if (is_array($_data)) {
-                    $result[] = 'array(' . $this->dataToString($_data) . ')';
-                } elseif (is_object($_data)) {
-                    $object = new ReflectionObject($_data);
-
-                    if ($object->hasMethod('__toString')) {
-                        $result[] = (string) $_data;
-                    } else {
-                        $result[] = get_class($_data);
-                    }
-                } elseif (is_resource($_data)) {
-                    $result[] = '<resource>';
-                } else {
-                    $result[] = var_export($_data, true);
+        $processed->add($data);
+
+        foreach ($data as $key => $value) {
+            if (is_array($value)) {
+                if ($processed->contains($data[$key]) !== false) {
+                    $result[] = '*RECURSION*';
+                }
+
+                else {
+                    $result[] = sprintf(
+                        'array(%s)',
+                        $this->dataToString($data[$key], $processed)
+                    );
                 }
-            } catch (ErrorException $e) {
-                $result[] = '*RECURSION*';
             }
-        }
 
-        restore_error_handler();
+            else {
+                $result[] = $exporter->shortenedExport($value);
+            }
+        }
 
         return join(', ', $result);
     }
diff --git a/tests/TextUI/dataprovider-debug.phpt b/tests/TextUI/dataprovider-debug.phpt
new file mode 100644
index 000000000..3d8b57231
--- /dev/null
+++ b/tests/TextUI/dataprovider-debug.phpt
@@ -0,0 +1,34 @@
+--TEST--
+phpunit --debug DataProviderDebugTest ../_files/DataProviderDebugTest.php
+--FILE--
+<?php
+$_SERVER['argv'][1] = '--no-configuration';
+$_SERVER['argv'][2] = '--debug';
+$_SERVER['argv'][3] = 'DataProviderDebugTest';
+$_SERVER['argv'][4] = dirname(__FILE__).'/../_files/DataProviderDebugTest.php';
+
+require __DIR__ . '/../bootstrap.php';
+PHPUnit_TextUI_Command::main();
+?>
+--EXPECTF--
+PHPUnit %s by Sebastian Bergmann.
+
+
+Starting test 'DataProviderDebugTest::testProvider with data set #0 (null, true, 1, 1.0)'.
+.
+Starting test 'DataProviderDebugTest::testProvider with data set #1 (1.2, resource(29) of type (stream), '1')'.
+.
+Starting test 'DataProviderDebugTest::testProvider with data set #2 (array(array(1, 2, 3), array(3, 4, 5)))'.
+.
+Starting test 'DataProviderDebugTest::testProvider with data set #3 ('this\nis\na\nvery\nvery\nvery\nvery...g\ntext')'.
+.
+Starting test 'DataProviderDebugTest::testProvider with data set #4 (stdClass Object (), stdClass Object (...), array(), SplObjectStorage Object (...), stdClass Object (...))'.
+.
+Starting test 'DataProviderDebugTest::testProvider with data set #5 (Binary String: 0x000102030405, Binary String: 0x0e0f101112131...c1d1e1f)'.
+.
+Starting test 'DataProviderDebugTest::testProvider with data set #6 (Binary String: 0x0009)'.
+.
+
+Time: %s, Memory: %sMb
+
+OK (7 tests, 7 assertions)
diff --git a/tests/_files/DataProviderDebugTest.php b/tests/_files/DataProviderDebugTest.php
new file mode 100644
index 000000000..96cb73021
--- /dev/null
+++ b/tests/_files/DataProviderDebugTest.php
@@ -0,0 +1,48 @@
+<?php
+class DataProviderDebugTest extends PHPUnit_Framework_TestCase
+{
+    /**
+     * @dataProvider provider
+     */
+    public function testProvider()
+    {
+        $this->assertTrue(true);
+    }
+
+    public static function provider()
+    {
+        $obj2 = new \stdClass();
+        $obj2->foo = 'bar';
+
+        $obj3 = (object) array(1,2,"Test\r\n",4,5,6,7,8);
+
+        $obj = new \stdClass();
+        //@codingStandardsIgnoreStart
+        $obj->null = null;
+        //@codingStandardsIgnoreEnd
+        $obj->boolean = true;
+        $obj->integer = 1;
+        $obj->double = 1.2;
+        $obj->string = '1';
+        $obj->text = "this\nis\na\nvery\nvery\nvery\nvery\nvery\nvery\rlong\n\rtext";
+        $obj->object = $obj2;
+        $obj->objectagain = $obj2;
+        $obj->array = array('foo' => 'bar');
+        $obj->self = $obj;
+
+        $storage = new \SplObjectStorage();
+        $storage->attach($obj2);
+        $storage->foo = $obj2;
+
+        return array(
+            array(null, true, 1, 1.0),
+            array(1.2, fopen('php://memory', 'r'), '1'),
+            array(array(array(1,2,3), array(3,4,5))),
+            // \n\r and \r is converted to \n
+            array("this\nis\na\nvery\nvery\nvery\nvery\nvery\nvery\rlong\n\rtext"),
+            array(new \stdClass(), $obj, array(), $storage, $obj3),
+            array(chr(0) . chr(1) . chr(2) . chr(3) . chr(4) . chr(5), implode('', array_map('chr', range(0x0e, 0x1f)))),
+            array(chr(0x00) . chr(0x09))
+        );
+    }
+}
