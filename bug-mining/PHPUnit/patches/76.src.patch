diff --git a/PHPUnit/Extensions/GroupTestSuite.php b/PHPUnit/Extensions/GroupTestSuite.php
index b32a9f737..c927399a4 100644
--- a/PHPUnit/Extensions/GroupTestSuite.php
+++ b/PHPUnit/Extensions/GroupTestSuite.php
@@ -93,7 +93,7 @@ public function __construct(PHPUnit_Framework_TestSuite $suite, array $groups)
                 $method = $class->getMethod($test->getName(FALSE));
 
                 $testGroups = PHPUnit_Util_Test::getGroups(
-                  $method, PHPUnit_Util_Test::getGroups($class)
+                  $method->getDocComment(), PHPUnit_Util_Test::getGroups($class)
                 );
 
                 foreach ($groups as $group) {
diff --git a/PHPUnit/Extensions/SeleniumTestCase.php b/PHPUnit/Extensions/SeleniumTestCase.php
index 712cd4646..41ed4735f 100644
--- a/PHPUnit/Extensions/SeleniumTestCase.php
+++ b/PHPUnit/Extensions/SeleniumTestCase.php
@@ -137,7 +137,7 @@ public static function suite($className)
         $suite->setName($className);
 
         $class            = new ReflectionClass($className);
-        $classGroups      = PHPUnit_Util_Test::getGroups($class);
+        $classGroups      = PHPUnit_Util_Test::getGroups($class->getDocComment());
         $staticProperties = $class->getStaticProperties();
 
         // Create tests from Selenese/HTML files.
@@ -181,9 +181,10 @@ public static function suite($className)
 
                 foreach ($class->getMethods() as $method) {
                     if (PHPUnit_Framework_TestSuite::isPublicTestMethod($method)) {
-                        $name   = $method->getName();
-                        $data   = PHPUnit_Util_Test::getProvidedData($className, $name);
-                        $groups = PHPUnit_Util_Test::getGroups($method, $classGroups);
+                        $name             = $method->getName();
+                        $methodDocComment = $method->getDocComment();
+                        $data             = PHPUnit_Util_Test::getProvidedData($className, $name, $methodDocComment);
+                        $groups           = PHPUnit_Util_Test::getGroups($methodDocComment, $classGroups);
 
                         // Test method with @dataProvider.
                         if (is_array($data) || $data instanceof Iterator) {
@@ -218,9 +219,10 @@ public static function suite($className)
         else {
             foreach ($class->getMethods() as $method) {
                 if (PHPUnit_Framework_TestSuite::isPublicTestMethod($method)) {
-                    $name   = $method->getName();
-                    $data   = PHPUnit_Util_Test::getProvidedData($className, $name);
-                    $groups = PHPUnit_Util_Test::getGroups($method, $classGroups);
+                    $name             = $method->getName();
+                    $methodDocComment = $method->getDocComment();
+                    $data             = PHPUnit_Util_Test::getProvidedData($className, $name, $methodDocComment);
+                    $groups           = PHPUnit_Util_Test::getGroups($methodDocComment, $classGroups);
 
                     // Test method with @dataProvider.
                     if (is_array($data) || $data instanceof Iterator) {
diff --git a/PHPUnit/Framework/TestSuite.php b/PHPUnit/Framework/TestSuite.php
index 367a0aaf2..ef28672e8 100644
--- a/PHPUnit/Framework/TestSuite.php
+++ b/PHPUnit/Framework/TestSuite.php
@@ -215,16 +215,19 @@ public function __construct($theClass = '', $name = '')
         }
 
         $className         = $theClass->getName();
+        $classDocComment   = $theClass->getDocComment();
         $names             = array();
-        $classGroups       = PHPUnit_Util_Test::getGroups($theClass);
-        $classDependencies = PHPUnit_Util_Test::getDependencies($theClass);
+        $classGroups       = PHPUnit_Util_Test::getGroups($classDocComment);
+        $classDependencies = PHPUnit_Util_Test::getDependencies($classDocComment);
 
         foreach ($theClass->getMethods() as $method) {
             if (strpos($method->getDeclaringClass()->getName(), 'PHPUnit_') !== 0) {
+                $methodDocComment = $method->getDocComment();
+
                 $this->addTestMethod(
                   $method,
-                  PHPUnit_Util_Test::getDependencies($method, $classDependencies),
-                  PHPUnit_Util_Test::getGroups($method, $classGroups),
+                  PHPUnit_Util_Test::getDependencies($methodDocComment, $classDependencies),
+                  PHPUnit_Util_Test::getGroups($methodDocComment, $classGroups),
                   $names
                 );
             }
@@ -465,9 +468,9 @@ public function count()
      */
     public static function createTest(ReflectionClass $theClass, $name, array $classGroups = array())
     {
-        $className  = $theClass->getName();
-        $method     = new ReflectionMethod($className, $name);
-        $docComment = $method->getDocComment();
+        $className        = $theClass->getName();
+        $method           = new ReflectionMethod($className, $name);
+        $methodDocComment = $method->getDocComment();
 
         if (!$theClass->isInstantiable()) {
             return self::warning(
@@ -475,26 +478,8 @@ public static function createTest(ReflectionClass $theClass, $name, array $class
             );
         }
 
-        // @expectedException ExceptionClass              on TestCase::testMethod()
-        // @expectedException ExceptionClass message      on TestCase::testMethod()
-        // @expectedException ExceptionClass message code on TestCase::testMethod()
-        if (preg_match('(@expectedException\s+([:.\w]+)(?:[\t ]+(\S*))?(?:[\t ]+(\S*))?\s*$)m', $docComment, $matches)) {
-            $expectedException = $matches[1];
-
-            if (isset($matches[2])) {
-                $expectedExceptionMessage = trim($matches[2]);
-            } else {
-                $expectedExceptionMessage = '';
-            }
-
-            if (isset($matches[3])) {
-                $expectedExceptionCode = (int)$matches[3];
-            } else {
-                $expectedExceptionCode = 0;
-            }
-        }
-
-        $constructor = $theClass->getConstructor();
+        $constructor       = $theClass->getConstructor();
+        $expectedException = PHPUnit_Util_Test::getExpectedException($methodDocComment);
 
         if ($constructor !== NULL) {
             $parameters = $constructor->getParameters();
@@ -506,8 +491,8 @@ public static function createTest(ReflectionClass $theClass, $name, array $class
 
             // TestCase($name, $data)
             else {
-                $data   = PHPUnit_Util_Test::getProvidedData($className, $name);
-                $groups = PHPUnit_Util_Test::getGroups($method, $classGroups);
+                $data   = PHPUnit_Util_Test::getProvidedData($className, $name, $methodDocComment);
+                $groups = PHPUnit_Util_Test::getGroups($methodDocComment, $classGroups);
 
                 if (is_array($data) || $data instanceof Iterator) {
                     $test = new PHPUnit_Framework_TestSuite(
@@ -520,9 +505,9 @@ public static function createTest(ReflectionClass $theClass, $name, array $class
                         if ($_test instanceof PHPUnit_Framework_TestCase &&
                             isset($expectedException)) {
                             $_test->setExpectedException(
-                              $expectedException,
-                              $expectedExceptionMessage,
-                              $expectedExceptionCode
+                              $expectedException['class'],
+                              $expectedException['message'],
+                              $expectedException['code']
                             );
                         }
 
@@ -539,9 +524,9 @@ public static function createTest(ReflectionClass $theClass, $name, array $class
 
             if (isset($expectedException)) {
                 $test->setExpectedException(
-                  $expectedException,
-                  $expectedExceptionMessage,
-                  $expectedExceptionCode
+                  $expectedException['class'],
+                  $expectedException['message'],
+                  $expectedException['code']
                 );
             }
         }
@@ -762,7 +747,7 @@ protected function addTestMethod(ReflectionMethod $method, array $dependencies,
 
             if (!$test instanceof PHPUnit_Framework_TestSuite) {
                 $test->setDependencies(
-                  PHPUnit_Util_Test::getDependencies($method, $dependencies)
+                  PHPUnit_Util_Test::getDependencies($method->getDocComment(), $dependencies)
                 );
             }
 
diff --git a/PHPUnit/Tests/Util/AllTests.php b/PHPUnit/Tests/Util/AllTests.php
index b78df4d73..27fceedba 100644
--- a/PHPUnit/Tests/Util/AllTests.php
+++ b/PHPUnit/Tests/Util/AllTests.php
@@ -50,6 +50,7 @@
 
 require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'TestDox' . DIRECTORY_SEPARATOR . 'AllTests.php';
 require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'ConfigurationTest.php';
+require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'TestTest.php';
 require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'TimerTest.php';
 require_once dirname(__FILE__) . DIRECTORY_SEPARATOR . 'XMLTest.php';
 
@@ -75,6 +76,7 @@ public static function suite()
 
         $suite->addTest(Util_TestDox_AllTests::suite());
         $suite->addTestSuite('Util_ConfigurationTest');
+        $suite->addTestSuite('Util_TestTest');
         $suite->addTestSuite('Util_TimerTest');
         $suite->addTestSuite('Util_XMLTest');
 
diff --git a/PHPUnit/Tests/Util/TestTest.php b/PHPUnit/Tests/Util/TestTest.php
new file mode 100644
index 000000000..c0460cd5c
--- /dev/null
+++ b/PHPUnit/Tests/Util/TestTest.php
@@ -0,0 +1,125 @@
+<?php
+/**
+ * PHPUnit
+ *
+ * Copyright (c) 2002-2008, Sebastian Bergmann <sb@sebastian-bergmann.de>.
+ * All rights reserved.
+ *
+ * Redistribution and use in source and binary forms, with or without
+ * modification, are permitted provided that the following conditions
+ * are met:
+ *
+ *   * Redistributions of source code must retain the above copyright
+ *     notice, this list of conditions and the following disclaimer.
+ *
+ *   * Redistributions in binary form must reproduce the above copyright
+ *     notice, this list of conditions and the following disclaimer in
+ *     the documentation and/or other materials provided with the
+ *     distribution.
+ *
+ *   * Neither the name of Sebastian Bergmann nor the names of his
+ *     contributors may be used to endorse or promote products derived
+ *     from this software without specific prior written permission.
+ *
+ * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
+ * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
+ * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS
+ * FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE
+ * COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
+ * INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
+ * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
+ * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
+ * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
+ * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
+ * ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
+ * POSSIBILITY OF SUCH DAMAGE.
+ *
+ * @category   Testing
+ * @package    PHPUnit
+ * @author     Sebastian Bergmann <sb@sebastian-bergmann.de>
+ * @copyright  2002-2008 Sebastian Bergmann <sb@sebastian-bergmann.de>
+ * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
+ * @version    SVN: $Id$
+ * @link       http://www.phpunit.de/
+ * @since      File available since Release 3.3.6
+ */
+
+require_once 'PHPUnit/Framework/TestCase.php';
+
+require_once 'PHPUnit/Util/Timer.php';
+
+/**
+ *
+ *
+ * @category   Testing
+ * @package    PHPUnit
+ * @author     Sebastian Bergmann <sb@sebastian-bergmann.de>
+ * @copyright  2002-2008 Sebastian Bergmann <sb@sebastian-bergmann.de>
+ * @license    http://www.opensource.org/licenses/bsd-license.php  BSD License
+ * @version    Release: @package_version@
+ * @link       http://www.phpunit.de/
+ * @since      Class available since Release 3.3.6
+ */
+class Util_TestTest extends PHPUnit_Framework_TestCase
+{
+    public function testGetDependencies()
+    {
+        $this->assertEquals(
+          array('method'),
+          PHPUnit_Util_Test::getDependencies('@depends method')
+        );
+
+        $this->assertEquals(
+          array('class::method'),
+          PHPUnit_Util_Test::getDependencies('@depends class::method')
+        );
+
+        $this->assertEquals(
+          array('namespace\class::method'),
+          PHPUnit_Util_Test::getDependencies('@depends namespace\class::method')
+        );
+
+        $this->assertEquals(
+          array('namespace\namespace\class::method'),
+          PHPUnit_Util_Test::getDependencies('@depends namespace\namespace\class::method')
+        );
+    }
+
+    public function testGetExpectedException()
+    {
+        $this->assertEquals(
+          array('class' => 'FooBarBaz', 'code' => 0, 'message' => ''),
+          PHPUnit_Util_Test::getExpectedException('@expectedException FooBarBaz')
+        );
+
+        $this->assertEquals(
+          array('class' => 'Foo_Bar_Baz', 'code' => 0, 'message' => ''),
+          PHPUnit_Util_Test::getExpectedException('@expectedException Foo_Bar_Baz')
+        );
+
+        $this->assertEquals(
+          array('class' => 'Foo\Bar\Baz', 'code' => 0, 'message' => ''),
+          PHPUnit_Util_Test::getExpectedException('@expectedException Foo\Bar\Baz')
+        );
+    }
+
+    public function testGetProvidedDataRegEx()
+    {
+        $result = preg_match(PHPUnit_Util_Test::REGEX_DATA_PROVIDER, '@dataProvider method', $matches);
+        $this->assertEquals(1, $result);
+        $this->assertEquals('method', $matches[1]);
+
+        $result = preg_match(PHPUnit_Util_Test::REGEX_DATA_PROVIDER, '@dataProvider class::method', $matches);
+        $this->assertEquals(1, $result);
+        $this->assertEquals('class::method', $matches[1]);
+
+        $result = preg_match(PHPUnit_Util_Test::REGEX_DATA_PROVIDER, '@dataProvider namespace\class::method', $matches);
+        $this->assertEquals(1, $result);
+        $this->assertEquals('namespace\class::method', $matches[1]);
+
+        $result = preg_match(PHPUnit_Util_Test::REGEX_DATA_PROVIDER, '@dataProvider namespace\namespace\class::method', $matches);
+        $this->assertEquals(1, $result);
+        $this->assertEquals('namespace\namespace\class::method', $matches[1]);
+    }
+}
+?>
diff --git a/PHPUnit/Util/Test.php b/PHPUnit/Util/Test.php
index 234991445..e68f5fcc0 100644
--- a/PHPUnit/Util/Test.php
+++ b/PHPUnit/Util/Test.php
@@ -62,6 +62,12 @@
  */
 class PHPUnit_Util_Test
 {
+    const REGEX_COVERS             = '/@covers[\s]+([\!<>\:\.\w]+)([\s]+<extended>)?/';
+    const REGEX_DATA_PROVIDER      = '/@dataProvider\s+([a-zA-Z0-9._:-\\\]+)/';
+    const REGEX_DEPENDS            = '/@depends\s+([a-zA-Z0-9._:-\\\]+)/';
+    const REGEX_EXPECTED_EXCEPTION = '(@expectedException\s+([:.\w\\\]+)(?:[\t ]+(\S*))?(?:[\t ]+(\S*))?\s*$)m';
+    const REGEX_GROUP              = '/@group\s+([a-zA-Z0-9._-]+)/';
+
     /**
      * @param  PHPUnit_Framework_Test $test
      * @param  boolean                $asString
@@ -150,7 +156,7 @@ public static function getLinesToBeCovered($className, $methodName)
             $method     = new ReflectionMethod($className, $methodName);
             $docComment = $class->getDocComment() . $method->getDocComment();
 
-            if (preg_match_all('/@covers[\s]+([\!<>\:\.\w]+)([\s]+<extended>)?/', $docComment, $matches)) {
+            if (preg_match_all(self::REGEX_COVERS, $docComment, $matches)) {
                 foreach ($matches[1] as $i => $method) {
                     $codeToCoverList = array_merge(
                         $codeToCoverList,
@@ -183,35 +189,61 @@ public static function getLinesToBeCovered($className, $methodName)
     /**
      * Returns the dependencies for a test class or method.
      *
-     * @param  Reflector $reflector
-     * @param  array     $dependencies
+     * @param  string $docComment
+     * @param  array  $dependencies
      * @return array
      * @since  Method available since Release 3.4.0
      */
-    public static function getDependencies(Reflector $reflector, array $dependencies = array())
+    public static function getDependencies($docComment, array $dependencies = array())
     {
-        $docComment = $reflector->getDocComment();
-
-        if (preg_match_all('/@depends\s+([a-zA-Z0-9._:-]+)/', $docComment, $matches)) {
+        if (preg_match_all(self::REGEX_DEPENDS, $docComment, $matches)) {
             $dependencies = array_unique(array_merge($dependencies, $matches[1]));
         }
 
         return $dependencies;
     }
 
+    /**
+     * Returns the expected exception for a test.
+     *
+     * @param  string $docComment
+     * @return array
+     * @since  Method available since Release 3.3.6
+     */
+    public static function getExpectedException($docComment)
+    {
+        if (preg_match(self::REGEX_EXPECTED_EXCEPTION, $docComment, $matches)) {
+            $class   = $matches[1];
+            $code    = 0;
+            $message = '';
+
+            if (isset($matches[2])) {
+                $message = trim($matches[2]);
+            }
+
+            if (isset($matches[3])) {
+                $code = (int)$matches[3];
+            }
+
+            return array(
+              'class' => $class, 'code' => $code, 'message' => $message
+            );
+        }
+
+        return FALSE;
+    }
+
     /**
      * Returns the groups for a test class or method.
      *
-     * @param  Reflector $reflector
-     * @param  array     $groups
+     * @param  string $docComment
+     * @param  array  $groups
      * @return array
      * @since  Method available since Release 3.2.0
      */
-    public static function getGroups(Reflector $reflector, array $groups = array())
+    public static function getGroups($docComment, array $groups = array())
     {
-        $docComment = $reflector->getDocComment();
-
-        if (preg_match_all('/@group\s+([a-zA-Z0-9._-]+)/', $docComment, $matches)) {
+        if (preg_match_all(self::REGEX_GROUP, $docComment, $matches)) {
             $groups = array_unique(array_merge($groups, $matches[1]));
         }
 
@@ -223,21 +255,26 @@ public static function getGroups(Reflector $reflector, array $groups = array())
      *
      * @param  string $className
      * @param  string $methodName
+     * @param  string $docComment
      * @return array
      * @since  Method available since Release 3.2.0
      */
-    public static function getProvidedData($className, $methodName)
+    public static function getProvidedData($className, $methodName, $docComment)
     {
-        $method     = new ReflectionMethod($className, $methodName);
-        $docComment = $method->getDocComment();
-
-        if (preg_match('/@dataProvider\s+([a-zA-Z0-9._:-]+)/', $docComment, $matches)) {
+        if (preg_match(self::REGEX_DATA_PROVIDER, $docComment, $matches)) {
             try {
-                $dataProvider           = explode('::', $matches[1]);
-                $dataProviderMethodName = array_pop($dataProvider);
+                $dataProviderMethodNameNamespace = explode('\\', $matches[1]);
+                $leaf                            = explode('::', array_pop($dataProviderMethodNameNamespace));
+                $dataProviderMethodName          = array_pop($leaf);
+
+                if (!empty($dataProviderMethodNameNamespace)) {
+                    $dataProviderMethodNameNamespace = join('\\', $dataProviderMethodNameNamespace) . '\\';
+                } else {
+                    $dataProviderMethodNameNamespace = '';
+                }
 
-                if (!empty($dataProvider)) {
-                    $dataProviderClassName = join('::', $dataProvider);
+                if (!empty($leaf)) {
+                    $dataProviderClassName = $dataProviderMethodNameNamespace . array_pop($leaf);
                 } else {
                     $dataProviderClassName = $className;
                 }
diff --git a/package.xml b/package.xml
index ca85f1a5c..334c2c612 100644
--- a/package.xml
+++ b/package.xml
@@ -867,6 +867,9 @@
       <file baseinstalldir="/" name="ConfigurationTest.php" role="test">
        <tasks:replace from="@package_version@" to="version" type="package-info" />
       </file>
+      <file baseinstalldir="/" name="TestTest.php" role="test">
+       <tasks:replace from="@package_version@" to="version" type="package-info" />
+      </file>
       <file baseinstalldir="/" name="TimerTest.php" role="test">
        <tasks:replace from="@package_version@" to="version" type="package-info" />
       </file>
