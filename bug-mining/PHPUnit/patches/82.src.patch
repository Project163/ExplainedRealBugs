diff --git a/PHPUnit/Util/CodeCoverage.php b/PHPUnit/Util/CodeCoverage.php
index bc84aa3c6..d151f31c3 100644
--- a/PHPUnit/Util/CodeCoverage.php
+++ b/PHPUnit/Util/CodeCoverage.php
@@ -297,8 +297,7 @@ public static function codeCoverageToBitString(array $data, array $requiredStatu
         $result = array();
 
         foreach ($data as $file => $coverage) {
-            end($coverage);
-            $maxLine = key($coverage);
+            $maxLine = max(array_keys($coverage));
 
             if ($maxLine == 0) {
                 $bitArray = array();
