diff --git a/PHPUnit/Framework/Process/TestCaseMethod.tpl.dist b/PHPUnit/Framework/Process/TestCaseMethod.tpl.dist
index 65bb01a30..8e6b4dcff 100644
--- a/PHPUnit/Framework/Process/TestCaseMethod.tpl.dist
+++ b/PHPUnit/Framework/Process/TestCaseMethod.tpl.dist
@@ -2,9 +2,14 @@
 ini_set('display_errors', 'stderr');
 set_include_path('{include_path}');
 
-if ({composerAutoload}) {
-    require_once {composerAutoload};
-    define('PHPUNIT_COMPOSER_INSTALL', {composerAutoload});
+$composerAutoload = {composerAutoload};
+$phar             = {phar};
+
+if ($composerAutoload) {
+    require_once $composerAutoload;
+    define('PHPUNIT_COMPOSER_INSTALL', $composerAutoload);
+} else if ($phar) {
+    require $phar;
 } else {
     require 'PHPUnit/Autoload.php';
 }
diff --git a/PHPUnit/Framework/TestCase.php b/PHPUnit/Framework/TestCase.php
index 050134734..ebd5f579c 100644
--- a/PHPUnit/Framework/TestCase.php
+++ b/PHPUnit/Framework/TestCase.php
@@ -741,6 +741,12 @@ public function run(PHPUnit_Framework_TestResult $result = NULL)
                 $composerAutoload = '\'\'';
             }
 
+            if (defined('__PHPUNIT_PHAR__')) {
+                $phar = var_export(__PHPUNIT_PHAR__, TRUE);
+            } else {
+                $phar = '\'\'';
+            }
+
             $data            = var_export(serialize($this->data), TRUE);
             $dependencyInput = var_export(serialize($this->dependencyInput), TRUE);
             $includePath     = var_export(get_include_path(), TRUE);
@@ -753,6 +759,7 @@ public function run(PHPUnit_Framework_TestResult $result = NULL)
             $template->setVar(
               array(
                 'composerAutoload'               => $composerAutoload,
+                'phar'                           => $phar,
                 'filename'                       => $class->getFileName(),
                 'className'                      => $class->getName(),
                 'methodName'                     => $this->name,
diff --git a/PHPUnit/Util/PHP.php b/PHPUnit/Util/PHP.php
index 3f40b8c7e..f6cb338bb 100644
--- a/PHPUnit/Util/PHP.php
+++ b/PHPUnit/Util/PHP.php
@@ -234,7 +234,11 @@ protected function processChildResult(PHPUnit_Framework_Test $test, PHPUnit_Fram
                 throw new ErrorException($errstr, $errno, $errno, $errfile, $errline);
             });
             try {
-                $childResult = unserialize($stdout);
+                if (strpos($stdout, "#!/usr/bin/env php\n") === 0) {
+                    $stdout = substr($stdout, 19);
+                }
+
+                $childResult = unserialize(str_replace("#!/usr/bin/env php\n", '', $stdout));
                 restore_error_handler();
             } catch (ErrorException $e) {
                 restore_error_handler();
diff --git a/build/phar-autoload.php.in b/build/phar-autoload.php.in
index e9b53d0cf..9ae1cb91b 100644
--- a/build/phar-autoload.php.in
+++ b/build/phar-autoload.php.in
@@ -1,6 +1,11 @@
 #!/usr/bin/env php
 <?php
-define('__PHPUNIT_PHAR__', realpath($GLOBALS['_SERVER']['SCRIPT_NAME']));
+if ($GLOBALS['_SERVER']['SCRIPT_NAME'] != '-') {
+    define('__PHPUNIT_PHAR__', realpath($GLOBALS['_SERVER']['SCRIPT_NAME']));
+} else {
+    $files = get_included_files();
+    define('__PHPUNIT_PHAR__', $files[0]);
+}
 
 spl_autoload_register(
   function ($class)
@@ -22,6 +27,9 @@ spl_autoload_register(
 );
 
 Phar::mapPhar('___PHAR___');
-PHPUnit_TextUI_Command::main();
+
+if ($GLOBALS['_SERVER']['SCRIPT_NAME'] != '-') {
+    PHPUnit_TextUI_Command::main();
+}
 
 __HALT_COMPILER();
