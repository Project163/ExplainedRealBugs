diff --git a/PHPUnit/TextUI/TestRunner.php b/PHPUnit/TextUI/TestRunner.php
index af7fe23e6..4bb3c5582 100644
--- a/PHPUnit/TextUI/TestRunner.php
+++ b/PHPUnit/TextUI/TestRunner.php
@@ -213,15 +213,19 @@ public function doRun(PHPUnit_Framework_Test $suite, Array $parameters = array()
         }
 
         if (isset($parameters['graphvizDirectory'])) {
-            $result->addListener(
-              new PHPUnit_Util_Log_GraphViz($parameters['graphvizDirectory'])
-            );
+            if (class_exists('Image_GraphViz')) {
+                $result->addListener(
+                  new PHPUnit_Util_Log_GraphViz($parameters['graphvizDirectory'])
+                );
+            }
         }
 
         if (isset($parameters['reportDirectory'])) {
-            $result->addListener(
-              new PHPUnit_Util_Log_GraphViz($parameters['reportDirectory'])
-            );
+            if (class_exists('Image_GraphViz')) {
+                $result->addListener(
+                  new PHPUnit_Util_Log_GraphViz($parameters['reportDirectory'])
+                );
+            }
 
             $result->collectCodeCoverageInformation(TRUE);
         }
diff --git a/PHPUnit/Util/Report/Test/Node/TestSuite.php b/PHPUnit/Util/Report/Test/Node/TestSuite.php
index f2aa3f0c2..f65c2938b 100644
--- a/PHPUnit/Util/Report/Test/Node/TestSuite.php
+++ b/PHPUnit/Util/Report/Test/Node/TestSuite.php
@@ -293,7 +293,7 @@ protected function setGraphVizTemplateVars(PHPUnit_Util_Template $template, $tar
         $safeName = PHPUnit_Util_Filesystem::getSafeFilename($this->getName());
         $dotFile = $target . $safeName . '.dot';
 
-        if (file_exists($dotFile)) {
+        if (file_exists($dotFile) && class_exists('Image_GraphViz')) {
             $pngFile = $target . $safeName . '.png';
             $mapFile = $target . $safeName . '.map';
 
