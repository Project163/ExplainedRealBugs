diff --git a/PHPUnit/Framework/MockObject/Generator.php b/PHPUnit/Framework/MockObject/Generator.php
index d710d1dd7..74ec27092 100644
--- a/PHPUnit/Framework/MockObject/Generator.php
+++ b/PHPUnit/Framework/MockObject/Generator.php
@@ -162,6 +162,16 @@ public static function getMock($originalClassName, $methods = array(), array $ar
         if (!is_array($methods) && !is_null($methods)) {
             throw new InvalidArgumentException;
         }
+        foreach($methods as $method) {
+            if(!preg_match('~[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*~', $method)) {
+                throw new PHPUnit_Framework_Exception(
+                  sprintf(
+                    'Mock function "%s" can not be created. Not a not valid function name',
+                    $method
+                  )
+                );
+            }
+        }
 
         if ($mockClassName != '' && class_exists($mockClassName, FALSE)) {
             throw new PHPUnit_Framework_Exception(
diff --git a/Tests/GeneratorTest.php b/Tests/GeneratorTest.php
new file mode 100644
index 000000000..020caaa53
--- /dev/null
+++ b/Tests/GeneratorTest.php
@@ -0,0 +1,21 @@
+<?php
+
+class Framework_GeneratorTest extends PHPUnit_Framework_TestCase 
+{
+
+    /**
+     * @covers PHPUnit_Framework_MockObject_Generator::getMock
+     * @expectedException PHPUnit_Framework_Exception
+     * @expectedExceptionMessage function "0"
+     */
+    public function testGetMockFailsWhenInvalidFunctionNameIsPassedInAsAFunctionToMock()
+    {
+        PHPUnit_Framework_MockObject_Generator::getMock('stdClass', array(0));
+    }
+
+    public function testGetMockCanCreateNonExistingFunctions() {
+        $mock = PHPUnit_Framework_MockObject_Generator::getMock('stdClass', array('testFunction'));
+        $this->assertTrue(method_exists($mock, 'testFunction'));
+    }
+
+}
diff --git a/phpunit.xml.dist b/phpunit.xml.dist
index 9245ac52f..b363de90d 100644
--- a/phpunit.xml.dist
+++ b/phpunit.xml.dist
@@ -1,6 +1,6 @@
 <?xml version="1.0" encoding="UTF-8"?>
 
-<phpunit backupGlobals="false">
+<phpunit backupGlobals="false" bootstrap="mockCoverageShutdown.php">
   <php>
     <const name="PHPUNIT_TESTSUITE" value="true"/>
   </php>
@@ -9,6 +9,7 @@
     <testsuite name="PHPUnit Mock Objects">
       <directory suffix=".phpt">Tests/MockObject</directory>
       <file>Tests/MockObjectTest.php</file>
+      <file>Tests/GeneratorTest.php</file>
     </testsuite>
   </testsuites>
 
