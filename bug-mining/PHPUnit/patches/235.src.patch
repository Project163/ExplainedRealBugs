diff --git a/PHPUnit/Util/GlobalState.php b/PHPUnit/Util/GlobalState.php
index afb64fefa..4697c9dec 100644
--- a/PHPUnit/Util/GlobalState.php
+++ b/PHPUnit/Util/GlobalState.php
@@ -201,8 +201,8 @@ public static function getIncludedFilesAsString()
         for ($i = count($files) - 1; $i > 0; $i--) {
             $file = $files[$i];
 
-            if ($prefix !== FALSE) {
-                $file = str_replace($prefix, '', $file);
+            if ($prefix !== FALSE && strpos($file, $prefix) === 0) {
+                continue;
             }
 
             if (!isset($blacklist[$file]) && is_file($file)) {
@@ -383,6 +383,7 @@ protected static function arrayOnlyContainsScalars(array $array)
     public static function phpunitFiles()
     {
         if (self::$phpunitFiles === NULL) {
+            self::$phpunitFiles = array();
             self::addDirectoryContainingClassToPHPUnitFilesList('File_Iterator');
             self::addDirectoryContainingClassToPHPUnitFilesList('PHP_CodeCoverage');
             self::addDirectoryContainingClassToPHPUnitFilesList('PHP_Invoker');
diff --git a/build.xml b/build.xml
index 22b80d753..d7a3a1e7a 100644
--- a/build.xml
+++ b/build.xml
@@ -293,6 +293,7 @@
   <copy todir="${basedir}/build/phar/phpunit">
    <fileset dir="${basedir}/PHPUnit">
     <include name="**/*.php" />
+    <include name="**/*.tpl*" />
     <exclude name="**/Autoload.*" />
    </fileset>
   </copy>
