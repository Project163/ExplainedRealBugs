diff --git a/PHPUnit/Extensions/SeleniumTestCase.php b/PHPUnit/Extensions/SeleniumTestCase.php
index b1830bffd..2dde4bb01 100644
--- a/PHPUnit/Extensions/SeleniumTestCase.php
+++ b/PHPUnit/Extensions/SeleniumTestCase.php
@@ -1154,7 +1154,7 @@ protected function matchLocalAndRemotePaths(array $coverage)
     {
         $coverageWithLocalPaths = array();
 
-        foreach ($coverage as $originalRemotePath => $value) {
+        foreach ($coverage as $originalRemotePath => $data) {
             $remotePath = $originalRemotePath;
             $separator  = $this->findDirectorySeparator($remotePath);
 
@@ -1163,9 +1163,8 @@ protected function matchLocalAndRemotePaths(array $coverage)
                 $remotePath = substr($remotePath, strpos($remotePath, $separator) + 1);
             }
 
-            if ($localpath && md5_file($localpath) == $value['md5']) {
-                $coverageWithLocalPaths[$localpath] = $value;
-                unset($coverageWithLocalPaths[$localpath]['md5']);
+            if ($localpath && md5_file($localpath) == $data['md5']) {
+                $coverageWithLocalPaths[$localpath] = $data['coverage'];
             }
         }
 
diff --git a/PHPUnit/Extensions/SeleniumTestCase/append.php b/PHPUnit/Extensions/SeleniumTestCase/append.php
index a3637e79a..58cbd0020 100644
--- a/PHPUnit/Extensions/SeleniumTestCase/append.php
+++ b/PHPUnit/Extensions/SeleniumTestCase/append.php
@@ -56,10 +56,6 @@
         unset($data[$file]);
     }
 
-    foreach ($data as $filename => $linecoverage) {
-        $data[$filename]['md5'] = md5_file($filename);
-    }
-
     file_put_contents(
       $_SERVER['SCRIPT_FILENAME'] . '.phpunit_' .
       $_COOKIE['PHPUNIT_SELENIUM_TEST_ID'],
diff --git a/PHPUnit/Extensions/SeleniumTestCase/phpunit_coverage.php b/PHPUnit/Extensions/SeleniumTestCase/phpunit_coverage.php
index 1eee4a70a..985230a2e 100644
--- a/PHPUnit/Extensions/SeleniumTestCase/phpunit_coverage.php
+++ b/PHPUnit/Extensions/SeleniumTestCase/phpunit_coverage.php
@@ -64,12 +64,14 @@
 
         foreach ($data as $filename => $lines) {
             if (!isset($coverage[$filename])) {
-                $coverage[$filename] = $lines;
+                $coverage[$filename] = array(
+                  'md5' => md5_file($filename), 'coverage' => $lines
+                );
             } else {
                 foreach ($lines as $line => $flag) {
-                    if (!isset($coverage[$filename][$line]) ||
-                        $flag > $coverage[$filename][$line]) {
-                        $coverage[$filename][$line] = $flag;
+                    if (!isset($coverage[$filename]['coverage'][$line]) ||
+                        $flag > $coverage[$filename]['coverage'][$line]) {
+                        $coverage[$filename]['coverage'][$line] = $flag;
                     }
                 }
             }
