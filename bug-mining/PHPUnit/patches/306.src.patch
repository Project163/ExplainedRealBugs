diff --git a/ChangeLog-5.0.md b/ChangeLog-5.0.md
index 125b59d08..84e101c7c 100644
--- a/ChangeLog-5.0.md
+++ b/ChangeLog-5.0.md
@@ -7,6 +7,7 @@ All notable changes of the PHPUnit 5.0 release series are documented in this fil
 ### Added
 
 * Merged [#1753](https://github.com/sebastianbergmann/phpunit/issues/1753): Added the `assertFinite()`, `assertInfinite()` and `assertNan()` assertions
+* Implemented [#1604](https://github.com/sebastianbergmann/phpunit/issues/1604): A `@small` test should be marked as risky when it executes code that performs I/O operations
 * Implemented [#1656](https://github.com/sebastianbergmann/phpunit/issues/1656): Allow sorting test failures in reverse
 * Implemented [#1780](https://github.com/sebastianbergmann/phpunit/issues/1780): Support for deep-cloning of results passed between tests using `@depends`
 
diff --git a/composer.json b/composer.json
index 76a7d8b04..be06961a3 100644
--- a/composer.json
+++ b/composer.json
@@ -35,6 +35,7 @@
         "sebastian/environment": "~1.2",
         "sebastian/exporter": "~1.2",
         "sebastian/global-state": "~1.0",
+        "sebastian/resource-operations": "~1.0",
         "sebastian/version": "~1.0",
         "myclabs/deep-copy": "~1.3",
         "ext-dom": "*",
diff --git a/src/Framework/TestResult.php b/src/Framework/TestResult.php
index 552613e00..df4f44021 100644
--- a/src/Framework/TestResult.php
+++ b/src/Framework/TestResult.php
@@ -8,6 +8,8 @@
  * file that was distributed with this source code.
  */
 
+use SebastianBergmann\ResourceOperations\ResourceOperations;
+
 /**
  * A TestResult collects the results of executing a test case.
  *
@@ -579,6 +581,15 @@ public function run(PHPUnit_Framework_Test $test)
             $this->codeCoverage->start($test);
         }
 
+        $monitorFunctions = $this->beStrictAboutResourceUsageDuringSmallTests &&
+                            !$test instanceof PHPUnit_Framework_Warning &&
+                            $test->getSize() == PHPUnit_Util_Test::SMALL &&
+                            function_exists('xdebug_start_function_monitor');
+
+        if ($monitorFunctions) {
+            xdebug_start_function_monitor(ResourceOperations::getFunctions());
+        }
+
         PHP_Timer::start();
 
         try {
@@ -628,6 +639,29 @@ public function run(PHPUnit_Framework_Test $test)
         $time = PHP_Timer::stop();
         $test->addToAssertionCount(PHPUnit_Framework_Assert::getCount());
 
+        if ($monitorFunctions) {
+            $blacklist = new PHPUnit_Util_Blacklist;
+            $functions = xdebug_get_monitored_functions();
+            xdebug_stop_function_monitor();
+
+            foreach ($functions as $function) {
+                if (!$blacklist->isBlacklisted($function['filename'])) {
+                    $this->addFailure(
+                        $test,
+                        new PHPUnit_Framework_RiskyTestError(
+                            sprintf(
+                                '%s() used in %s:%s',
+                                $function['function'],
+                                $function['filename'],
+                                $function['lineno']
+                            )
+                        ),
+                        $time
+                    );
+                }
+            }
+        }
+
         if ($this->beStrictAboutTestsThatDoNotTestAnything &&
             $test->getNumAssertions() == 0) {
             $risky = true;
