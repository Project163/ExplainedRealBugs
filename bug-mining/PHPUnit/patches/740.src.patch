diff --git a/.psalm/baseline.xml b/.psalm/baseline.xml
index d9bc4628d..7811d2fad 100644
--- a/.psalm/baseline.xml
+++ b/.psalm/baseline.xml
@@ -495,7 +495,7 @@
   </file>
   <file src="src/Runner/TestSuiteLoader.php">
     <UnresolvableInclude>
-      <code>include_once $suiteClassFile</code>
+      <code>require_once $suiteClassFile</code>
     </UnresolvableInclude>
   </file>
   <file src="src/Runner/TestSuiteSorter.php">
diff --git a/ChangeLog-10.0.md b/ChangeLog-10.0.md
index 742f6d8ed..75500066b 100644
--- a/ChangeLog-10.0.md
+++ b/ChangeLog-10.0.md
@@ -2,6 +2,12 @@
 
 All notable changes of the PHPUnit 10.0 release series are documented in this file using the [Keep a CHANGELOG](https://keepachangelog.com/) principles.
 
+## [10.0.18] - 2023-MM-DD
+
+### Fixed
+
+* [#5287](https://github.com/sebastianbergmann/phpunit/issues/5287): Tests from test class with same non-fully qualified class name as another test class are sometimes not discovered
+
 ## [10.0.17] - 2023-03-20
 
 ### Changed
@@ -268,6 +274,7 @@ All notable changes of the PHPUnit 10.0 release series are documented in this fi
 * PHP 7.3, PHP 7.4, and PHP 8.0 are no longer supported
 * `phpunit/php-code-coverage` [no longer supports PHPDBG and Xdebug 2](https://github.com/sebastianbergmann/php-code-coverage/blob/10.0.0/ChangeLog.md#1000---2023-02-03)
 
+[10.0.18]: https://github.com/sebastianbergmann/phpunit/compare/10.0.17...10.0
 [10.0.17]: https://github.com/sebastianbergmann/phpunit/compare/10.0.16...10.0.17
 [10.0.16]: https://github.com/sebastianbergmann/phpunit/compare/10.0.15...10.0.16
 [10.0.15]: https://github.com/sebastianbergmann/phpunit/compare/10.0.14...10.0.15
diff --git a/src/Runner/TestSuiteLoader.php b/src/Runner/TestSuiteLoader.php
index 4121c1aa3..096a907c9 100644
--- a/src/Runner/TestSuiteLoader.php
+++ b/src/Runner/TestSuiteLoader.php
@@ -10,14 +10,13 @@
 namespace PHPUnit\Runner;
 
 use function array_diff;
-use function array_merge;
 use function array_values;
 use function basename;
-use function class_exists;
 use function get_declared_classes;
-use function stripos;
-use function strlen;
+use function realpath;
+use function str_ends_with;
 use function strpos;
+use function strtolower;
 use function substr;
 use PHPUnit\Framework\TestCase;
 use ReflectionClass;
@@ -30,72 +29,51 @@ final class TestSuiteLoader
     /**
      * @psalm-var list<class-string>
      */
-    private static array $loadedClasses = [];
+    private static array $declaredClasses = [];
 
     /**
-     * @psalm-var list<class-string>
+     * @psalm-var array<non-empty-string, list<class-string>>
      */
-    private static array $declaredClasses = [];
-
-    public function __construct()
-    {
-        if (empty(self::$declaredClasses)) {
-            self::$declaredClasses = get_declared_classes();
-        }
-    }
+    private static array $fileToClassesMap = [];
 
     /**
      * @throws Exception
      */
     public function load(string $suiteClassFile): ReflectionClass
     {
+        $suiteClassFile = realpath($suiteClassFile);
         $suiteClassName = $this->classNameFromFileName($suiteClassFile);
+        $loadedClasses  = $this->loadSuiteClassFile($suiteClassFile);
 
-        if (!class_exists($suiteClassName, false)) {
-            include_once $suiteClassFile;
-
-            $loadedClasses = array_values(
-                array_diff(
-                    get_declared_classes(),
-                    array_merge(
-                        self::$declaredClasses,
-                        self::$loadedClasses
-                    )
-                )
-            );
+        foreach ($loadedClasses as $className) {
+            /** @noinspection PhpUnhandledExceptionInspection */
+            $class = new ReflectionClass($className);
 
-            self::$loadedClasses = array_merge($loadedClasses, self::$loadedClasses);
+            if ($class->isAnonymous()) {
+                continue;
+            }
 
-            if (empty(self::$loadedClasses)) {
-                throw new ClassCannotBeFoundException($suiteClassName, $suiteClassFile);
+            if ($class->getFileName() !== $suiteClassFile) {
+                continue;
             }
-        }
 
-        if (!class_exists($suiteClassName, false)) {
-            $offset = 0 - strlen($suiteClassName);
+            if (!$class->isSubclassOf(TestCase::class)) {
+                continue;
+            }
 
-            foreach (self::$loadedClasses as $loadedClass) {
-                if (stripos(substr($loadedClass, $offset - 1), '\\' . $suiteClassName) === 0 ||
-                    stripos(substr($loadedClass, $offset - 1), '_' . $suiteClassName) === 0) {
-                    $suiteClassName = $loadedClass;
+            if (!str_ends_with(strtolower($class->getShortName()), strtolower($suiteClassName))) {
+                continue;
+            }
 
-                    break;
-                }
+            if (!$class->isAbstract()) {
+                return $class;
             }
-        }
 
-        if (!class_exists($suiteClassName, false)) {
-            throw new ClassCannotBeFoundException($suiteClassName, $suiteClassFile);
+            $e = new ClassIsAbstractException($class->getName(), $suiteClassFile);
         }
 
-        $class = new ReflectionClass($suiteClassName);
-
-        if ($class->isSubclassOf(TestCase::class)) {
-            if ($class->isAbstract()) {
-                throw new ClassIsAbstractException($suiteClassName, $suiteClassFile);
-            }
-
-            return $class;
+        if (isset($e)) {
+            throw $e;
         }
 
         throw new ClassCannotBeFoundException($suiteClassName, $suiteClassFile);
@@ -112,4 +90,46 @@ private function classNameFromFileName(string $suiteClassFile): string
 
         return $className;
     }
+
+    /**
+     * @psalm-return list<class-string>
+     */
+    private function loadSuiteClassFile(string $suiteClassFile): array
+    {
+        if (isset(self::$fileToClassesMap[$suiteClassFile])) {
+            return self::$fileToClassesMap[$suiteClassFile];
+        }
+
+        if (empty(self::$declaredClasses)) {
+            self::$declaredClasses = get_declared_classes();
+        }
+
+        require_once $suiteClassFile;
+
+        $loadedClasses = array_values(
+            array_diff(
+                get_declared_classes(),
+                self::$declaredClasses
+            )
+        );
+
+        foreach ($loadedClasses as $loadedClass) {
+            /** @noinspection PhpUnhandledExceptionInspection */
+            $class = new ReflectionClass($loadedClass);
+
+            if (!isset(self::$fileToClassesMap[$class->getFileName()])) {
+                self::$fileToClassesMap[$class->getFileName()] = [];
+            }
+
+            self::$fileToClassesMap[$class->getFileName()][] = $class->getName();
+        }
+
+        self::$declaredClasses = get_declared_classes();
+
+        if (empty($loadedClasses)) {
+            return self::$declaredClasses;
+        }
+
+        return $loadedClasses;
+    }
 }
diff --git a/tests/end-to-end/regression/5287.phpt b/tests/end-to-end/regression/5287.phpt
index ac2a4fdb3..fe9131795 100644
--- a/tests/end-to-end/regression/5287.phpt
+++ b/tests/end-to-end/regression/5287.phpt
@@ -1,7 +1,5 @@
 --TEST--
 https://github.com/sebastianbergmann/phpunit/issues/5287
---XFAIL--
-https://github.com/sebastianbergmann/phpunit/issues/5287
 --SKIPIF--
 <?php declare(strict_types=1);
 if (DIRECTORY_SEPARATOR === '\\') {
