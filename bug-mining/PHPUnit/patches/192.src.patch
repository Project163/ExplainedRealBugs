diff --git a/ChangeLog.md b/ChangeLog.md
index 19ee31d50..7b3e6a990 100644
--- a/ChangeLog.md
+++ b/ChangeLog.md
@@ -7,6 +7,7 @@ PHPUnit 3.7.2
 -------------
 
 * Implemented #656: Always clean up mock objects (and free up memory).
+* Implemented #664: Do not rely on autoloader class map to populate blacklist.
 * Added the `addUncoveredFilesFromWhitelist` configuration setting back in.
 * Fixed #655: Reverted 'More than two positional arguments provided' check as it turned out to be a BC issue.
 * Disable token caching (in PHP_TokenStream, used by PHP_CodeCoverage) by default (to reduce memory footprint).
diff --git a/PHPUnit/Util/GlobalState.php b/PHPUnit/Util/GlobalState.php
index 77ed33497..712c5bbc5 100644
--- a/PHPUnit/Util/GlobalState.php
+++ b/PHPUnit/Util/GlobalState.php
@@ -372,77 +372,40 @@ protected static function arrayOnlyContainsScalars(array $array)
     public static function phpunitFiles()
     {
         if (self::$phpunitFiles === NULL) {
-            self::$phpunitFiles = phpunit_autoload();
-
-            if (function_exists('phpunit_mockobject_autoload')) {
-                self::$phpunitFiles = array_merge(
-                  self::$phpunitFiles, phpunit_mockobject_autoload()
-                );
-            }
-
-            if (function_exists('file_iterator_autoload')) {
-                self::$phpunitFiles = array_merge(
-                  self::$phpunitFiles, file_iterator_autoload()
-                );
-            }
-
-            if (function_exists('php_codecoverage_autoload')) {
-                self::$phpunitFiles = array_merge(
-                  self::$phpunitFiles, php_codecoverage_autoload()
-                );
-            }
-
-            if (function_exists('php_timer_autoload')) {
-                self::$phpunitFiles = array_merge(
-                  self::$phpunitFiles, php_timer_autoload()
-                );
-            }
-
-            if (function_exists('php_tokenstream_autoload')) {
-                self::$phpunitFiles = array_merge(
-                  self::$phpunitFiles, php_tokenstream_autoload()
-                );
-            }
-
-            if (function_exists('text_template_autoload')) {
-                self::$phpunitFiles = array_merge(
-                  self::$phpunitFiles, text_template_autoload()
-                );
-            }
+            self::addDirectoryContainingClassToPHPUnitFilesList('File_Iterator');
+            self::addDirectoryContainingClassToPHPUnitFilesList('PHP_CodeCoverage');
+            self::addDirectoryContainingClassToPHPUnitFilesList('PHP_Invoker');
+            self::addDirectoryContainingClassToPHPUnitFilesList('PHP_Timer');
+            self::addDirectoryContainingClassToPHPUnitFilesList('PHP_Token');
+            self::addDirectoryContainingClassToPHPUnitFilesList('PHPUnit_Framework_TestCase', 2);
+            self::addDirectoryContainingClassToPHPUnitFilesList('Text_Template');
+        }
 
-            if (function_exists('phpunit_dbunit_autoload')) {
-                self::$phpunitFiles = array_merge(
-                  self::$phpunitFiles, phpunit_dbunit_autoload()
-                );
-            }
+        return self::$phpunitFiles;
+    }
 
-            if (function_exists('phpunit_selenium_autoload')) {
-                self::$phpunitFiles = array_merge(
-                  self::$phpunitFiles, phpunit_selenium_autoload()
-                );
-            }
+    /**
+     * @param string  $className
+     * @param integer $parent
+     * @since Method available since Release 3.7.2
+     */
+    protected static function addDirectoryContainingClassToPHPUnitFilesList($className, $parent = 1)
+    {
+        if (!class_exists($className)) {
+            return;
+        }
 
-            if (function_exists('phpunit_story_autoload')) {
-                self::$phpunitFiles = array_merge(
-                  self::$phpunitFiles, phpunit_story_autoload()
-                );
-            }
+        $reflector = new ReflectionClass($className);
+        $directory = $reflector->getFileName();
 
-            if (function_exists('php_invoker_autoload')) {
-                self::$phpunitFiles = array_merge(
-                  self::$phpunitFiles, php_invoker_autoload()
-                );
-            }
+        for ($i = 0; $i < $parent; $i++) {
+            $directory = dirname($directory);
+        }
 
-            foreach (self::$phpunitFiles as $key => $value) {
-                self::$phpunitFiles[$key] = str_replace(
-                  '/', DIRECTORY_SEPARATOR, $value
-                );
-            }
+        $facade = new File_Iterator_Facade;
 
-            self::$phpunitFiles = array_flip(self::$phpunitFiles);
+        foreach ($facade->getFilesAsArray($directory, '.php') as $file) {
+            self::$phpunitFiles[$file] = TRUE;
         }
-
-        return self::$phpunitFiles;
     }
 }
