diff --git a/.psalm/baseline.xml b/.psalm/baseline.xml
index 2c981e6e6..bcff646d4 100644
--- a/.psalm/baseline.xml
+++ b/.psalm/baseline.xml
@@ -509,7 +509,7 @@
   </file>
   <file src="src/Runner/TestResult/Collector.php">
     <RedundantCondition>
-      <code>assert($testSuite instanceof TestSuiteForTestClass)</code>
+      <code>assert($testSuite instanceof TestSuiteForTestMethodWithDataProvider)</code>
     </RedundantCondition>
   </file>
   <file src="src/Runner/TestSuiteLoader.php">
diff --git a/ChangeLog-10.0.md b/ChangeLog-10.0.md
index 676ffeea4..5a690d29e 100644
--- a/ChangeLog-10.0.md
+++ b/ChangeLog-10.0.md
@@ -2,6 +2,12 @@
 
 All notable changes of the PHPUnit 10.0 release series are documented in this file using the [Keep a CHANGELOG](https://keepachangelog.com/) principles.
 
+## [10.0.6] - 2023-MM-DD
+
+### Fixed
+
+* [#5178](https://github.com/sebastianbergmann/phpunit/issues/5178): Test depending on a test with data provider is always skipped
+
 ## [10.0.5] - 2023-02-07
 
 ### Fixed
@@ -166,6 +172,7 @@ All notable changes of the PHPUnit 10.0 release series are documented in this fi
 * PHP 7.3, PHP 7.4, and PHP 8.0 are no longer supported
 * `phpunit/php-code-coverage` [no longer supports PHPDBG and Xdebug 2](https://github.com/sebastianbergmann/php-code-coverage/blob/10.0.0/ChangeLog.md#1000---2023-02-03)
 
+[10.0.6]: https://github.com/sebastianbergmann/phpunit/compare/10.0.5...10.0
 [10.0.5]: https://github.com/sebastianbergmann/phpunit/compare/10.0.4...10.0.5
 [10.0.4]: https://github.com/sebastianbergmann/phpunit/compare/10.0.3...10.0.4
 [10.0.3]: https://github.com/sebastianbergmann/phpunit/compare/10.0.2...10.0.3
diff --git a/src/Framework/TestCase.php b/src/Framework/TestCase.php
index 7b4fafb9c..25b746eba 100644
--- a/src/Framework/TestCase.php
+++ b/src/Framework/TestCase.php
@@ -665,10 +665,12 @@ final public function runBare(): void
                 $this->valueObjectForEvents(),
             );
 
-            PassedTests::instance()->testMethodPassed(
-                $this->valueObjectForEvents(),
-                $this->testResult
-            );
+            if (!$this->usesDataProvider()) {
+                PassedTests::instance()->testMethodPassed(
+                    $this->valueObjectForEvents(),
+                    $this->testResult
+                );
+            }
         }
 
         $this->mockObjects = [];
diff --git a/src/Runner/TestResult/Collector.php b/src/Runner/TestResult/Collector.php
index df87fe2c3..f39528ada 100644
--- a/src/Runner/TestResult/Collector.php
+++ b/src/Runner/TestResult/Collector.php
@@ -11,6 +11,7 @@
 
 use function assert;
 use function str_contains;
+use PHPUnit\Event\Code\TestMethod;
 use PHPUnit\Event\EventFacadeIsSealedException;
 use PHPUnit\Event\Facade;
 use PHPUnit\Event\Test\BeforeFirstTestMethodErrored;
@@ -30,6 +31,7 @@
 use PHPUnit\Event\Test\PhpWarningTriggered;
 use PHPUnit\Event\Test\Skipped as TestSkipped;
 use PHPUnit\Event\Test\WarningTriggered;
+use PHPUnit\Event\TestData\NoDataSetFromDataProviderException;
 use PHPUnit\Event\TestRunner\DeprecationTriggered as TestRunnerDeprecationTriggered;
 use PHPUnit\Event\TestRunner\ExecutionStarted;
 use PHPUnit\Event\TestRunner\WarningTriggered as TestRunnerWarningTriggered;
@@ -37,6 +39,7 @@
 use PHPUnit\Event\TestSuite\Skipped as TestSuiteSkipped;
 use PHPUnit\Event\TestSuite\Started as TestSuiteStarted;
 use PHPUnit\Event\TestSuite\TestSuiteForTestClass;
+use PHPUnit\Event\TestSuite\TestSuiteForTestMethodWithDataProvider;
 use PHPUnit\Event\UnknownSubscriberTypeException;
 
 /**
@@ -266,19 +269,36 @@ public function testSuiteStarted(TestSuiteStarted $event): void
         $this->currentTestSuiteForTestClassFailed = false;
     }
 
+    /**
+     * @throws NoDataSetFromDataProviderException
+     */
     public function testSuiteFinished(TestSuiteFinished $event): void
     {
+        if ($this->currentTestSuiteForTestClassFailed) {
+            return;
+        }
+
         $testSuite = $event->testSuite();
 
-        if (!$testSuite->isForTestClass()) {
+        if ($testSuite->isWithName()) {
             return;
         }
 
-        assert($testSuite instanceof TestSuiteForTestClass);
+        if ($testSuite->isForTestMethodWithDataProvider()) {
+            assert($testSuite instanceof TestSuiteForTestMethodWithDataProvider);
 
-        if (!$this->currentTestSuiteForTestClassFailed) {
-            PassedTests::instance()->testClassPassed($testSuite->className());
+            $test = $testSuite->tests()->asArray()[0];
+
+            assert($test instanceof TestMethod);
+
+            PassedTests::instance()->testMethodPassed($test, null);
+
+            return;
         }
+
+        assert($testSuite instanceof TestSuiteForTestClass);
+
+        PassedTests::instance()->testClassPassed($testSuite->className());
     }
 
     public function testPrepared(): void
diff --git a/src/Runner/TestResult/PassedTests.php b/src/Runner/TestResult/PassedTests.php
index c036eb31f..54957177c 100644
--- a/src/Runner/TestResult/PassedTests.php
+++ b/src/Runner/TestResult/PassedTests.php
@@ -64,7 +64,7 @@ public function testMethodPassed(TestMethod $test, mixed $returnValue): void
             $test->methodName()
         );
 
-        $this->passedTestMethods[$test->id()] = [
+        $this->passedTestMethods[$test->className() . '::' . $test->methodName()] = [
             'returnValue' => $returnValue,
             'size'        => $size,
         ];
diff --git a/src/Runner/TestResult/Subscriber/TestSuiteFinishedSubscriber.php b/src/Runner/TestResult/Subscriber/TestSuiteFinishedSubscriber.php
index b4a51dac7..5ad8c1a72 100644
--- a/src/Runner/TestResult/Subscriber/TestSuiteFinishedSubscriber.php
+++ b/src/Runner/TestResult/Subscriber/TestSuiteFinishedSubscriber.php
@@ -9,6 +9,7 @@
  */
 namespace PHPUnit\TestRunner\TestResult;
 
+use PHPUnit\Event\TestData\NoDataSetFromDataProviderException;
 use PHPUnit\Event\TestSuite\Finished;
 use PHPUnit\Event\TestSuite\FinishedSubscriber;
 
@@ -17,6 +18,9 @@
  */
 final class TestSuiteFinishedSubscriber extends Subscriber implements FinishedSubscriber
 {
+    /**
+     * @throws NoDataSetFromDataProviderException
+     */
     public function notify(Finished $event): void
     {
         $this->collector()->testSuiteFinished($event);
diff --git a/tests/end-to-end/regression/5178.phpt b/tests/end-to-end/regression/5178.phpt
index 3959ea6d0..af550887b 100644
--- a/tests/end-to-end/regression/5178.phpt
+++ b/tests/end-to-end/regression/5178.phpt
@@ -8,8 +8,6 @@ $_SERVER['argv'][] = __DIR__ . '/5178/Issue5178Test.php';
 
 require_once __DIR__ . '/../../bootstrap.php';
 (new PHPUnit\TextUI\Application)->run($_SERVER['argv']);
---XFAIL--
-https://github.com/sebastianbergmann/phpunit/issues/5178
 --EXPECTF--
 PHPUnit %s by Sebastian Bergmann and contributors.
 
