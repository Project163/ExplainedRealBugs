diff --git a/ChangeLog.markdown b/ChangeLog.markdown
index a1d4cf662..de95616c8 100644
--- a/ChangeLog.markdown
+++ b/ChangeLog.markdown
@@ -28,6 +28,7 @@ PHPUnit 3.7.0
 * Fixed #322 #320 thanks to #607: Commandline option now override group/exclude settings in phpunit.xml
 * Fixed #440: Possible crash when using `--process-isolation` with PHP 5.3 and `detect_unicode=on`.
 * Fixed #523: `assertAttributeEquals()` now works with classes extending internal classes like `ArrayIterator`.
+* Fixed #581: Generating a diffs could add extra newlines in Windows.
 * It is possible again to expect the generic `Exception` class.
 * Removed `addUncoveredFilesFromWhitelist` configuration setting.
 * Removed deprecated `--skeleton-class` and `--skeleton-test` switches. The functionality is now provided by the `phpunit-skel` command of the `PHPUnit_SkeletonGenerator` package.
diff --git a/PHPUnit/Util/Type.php b/PHPUnit/Util/Type.php
index 3919504c3..4f08ce2fb 100644
--- a/PHPUnit/Util/Type.php
+++ b/PHPUnit/Util/Type.php
@@ -133,7 +133,7 @@ protected static function recursiveExport($value, $indentation, &$processedObjec
             }
 
             return "'" .
-                   str_replace(array("\n\r", "\r"), array("\n", "\n"), $value) .
+                   str_replace(array("\r\n", "\n\r", "\r"), array("\n", "\n", "\n"), $value) .
                    "'";
         }
 
diff --git a/Tests/Regression/GitHub/581.phpt b/Tests/Regression/GitHub/581.phpt
new file mode 100644
index 000000000..9e6f30424
--- /dev/null
+++ b/Tests/Regression/GitHub/581.phpt
@@ -0,0 +1,43 @@
+--TEST--
+GH-581: PHPUnit_Util_Type::export adds extra newlines in Windows
+--FILE--
+<?php
+
+$_SERVER['argv'][1] = '--no-configuration';
+$_SERVER['argv'][2] = 'Issue581Test';
+$_SERVER['argv'][3] = dirname(__FILE__).'/581/Issue581Test.php';
+
+require_once dirname(dirname(dirname(dirname(__FILE__)))) . '/PHPUnit/Autoload.php';
+PHPUnit_TextUI_Command::main();
+?>
+--EXPECTF--
+PHPUnit %s by Sebastian Bergmann.
+
+F
+
+Time: %i %s, Memory: %sMb
+
+There was 1 failure:
+
+1) Issue581Test::testExportingObjectsDoesNotBreakWindowsLineFeeds
+Failed asserting that two objects are equal.
+--- Expected
++++ Actual
+@@ @@
+ stdClass Object (
+     0 => 1
+     1 => 2
+     2 => 'Test\n'
+     3 => 4
+-    4 => 5
++    4 => 1
+     5 => 6
+     6 => 7
+     7 => 8
+ )
+
+%s:%i
+
+FAILURES!
+Tests: 1, Assertions: 1, Failures: 1.
+
diff --git a/Tests/Regression/GitHub/581/Issue581Test.php b/Tests/Regression/GitHub/581/Issue581Test.php
new file mode 100644
index 000000000..201780cd6
--- /dev/null
+++ b/Tests/Regression/GitHub/581/Issue581Test.php
@@ -0,0 +1,10 @@
+<?php
+class Issue581Test extends PHPUnit_Framework_TestCase
+{
+    public function testExportingObjectsDoesNotBreakWindowsLineFeeds() {
+        $this->assertEquals(
+            (object)array(1,2,"Test\r\n",4,5,6,7,8),
+            (object)array(1,2,"Test\r\n",4,1,6,7,8)
+        );
+    }
+}
