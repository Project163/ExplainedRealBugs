<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:12:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TINKERPOP-3045] EarlyLimitStrategy is too aggresive to promote Limit and thus causing incorrect results</title>
                <link>https://issues.apache.org/jira/browse/TINKERPOP-3045</link>
                <project id="12316520" key="TINKERPOP">TinkerPop</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
gremlin&amp;gt; &#160; g.V().map(__.in().hasId(&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;)).limit(2).values(&lt;span class=&quot;code-quote&quot;&gt;&apos;name&apos;&lt;/span&gt;)
==&amp;gt;marko&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
gremlin&amp;gt; &#160; g.withoutStrategies(EarlyLimitStrategy).V().map(__.in().hasId(&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;)).limit(2).values(&lt;span class=&quot;code-quote&quot;&gt;&apos;name&apos;&lt;/span&gt;)
==&amp;gt;marko
==&amp;gt;marko &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Early Limit strategy pulls Limit in front of map steps. However not all map steps allow the cardinality of the results flowing to be same.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As is shown in example above.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13567114">TINKERPOP-3045</key>
            <summary>EarlyLimitStrategy is too aggresive to promote Limit and thus causing incorrect results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="spmallette">Stephen Mallette</assignee>
                                    <reporter username="prashup">Prashant</reporter>
                        <labels>
                            <label>easyfix</label>
                    </labels>
                <created>Fri, 2 Feb 2024 02:14:42 +0000</created>
                <updated>Tue, 6 Feb 2024 13:27:24 +0000</updated>
                            <resolved>Tue, 6 Feb 2024 13:27:24 +0000</resolved>
                                    <version>3.6.6</version>
                                    <fixVersion>3.6.7</fixVersion>
                                    <component>process</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17813463" author="githubbot" created="Fri, 2 Feb 2024 02:32:42 +0000"  >&lt;p&gt;upadhyay-prashant opened a new pull request, #2475:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/2475&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/2475&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   &#8230;and thus causing incorrect results&lt;/p&gt;

&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-3045&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TINKERPOP-3045&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   EarlyLimitStrategy was too aggressive to promote limit before map steps. Not all the Map step can be displaced. Specifically if a Map step has capability to filter the results, then it should be displaced.&lt;/p&gt;

&lt;p&gt;   This code change brings in a utility to statically determine the output arity of a step and accordingly allow EarlyLimitStrategy to make a decision whether a map step can be moved.&lt;/p&gt;

&lt;p&gt;   Test is added in Range.feature which ensures that this bug is fixed. This test gives wrong result without this code change.&lt;/p&gt;

</comment>
                            <comment id="17813632" author="githubbot" created="Fri, 2 Feb 2024 11:45:00 +0000"  >&lt;p&gt;spmallette commented on code in PR #2475:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/2475#discussion_r1475959035&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/2475#discussion_r1475959035&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
gremlin-core/pom.xml:&lt;br/&gt;
##########&lt;br/&gt;
@@ -101,6 +101,16 @@ limitations under the License.&lt;br/&gt;
             &amp;lt;artifactId&amp;gt;hamcrest&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
             &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;&lt;br/&gt;
         &amp;lt;/dependency&amp;gt;&lt;br/&gt;
+        &amp;lt;dependency&amp;gt;&lt;/p&gt;

&lt;p&gt;Review Comment:&lt;br/&gt;
   it looks like there is relatively minor usage of guava and lombok. could you please adjust the `StepOutputArityPredictor` to   not use these libraries so that we don&apos;t need to take the dependency?&lt;/p&gt;


</comment>
                            <comment id="17813633" author="githubbot" created="Fri, 2 Feb 2024 11:45:50 +0000"  >&lt;p&gt;spmallette commented on code in PR #2475:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/2475#discussion_r1475959778&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/2475#discussion_r1475959778&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
gremlin-test/src/main/resources/org/apache/tinkerpop/gremlin/test/features/filter/Range.feature:&lt;br/&gt;
##########&lt;br/&gt;
@@ -280,4 +280,16 @@ Feature: Step - range()&lt;br/&gt;
     When iterated to list&lt;br/&gt;
     Then the result should be unordered&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; result &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; d&lt;span class=&quot;error&quot;&gt;&amp;#91;29&amp;#93;&lt;/span&gt;.i &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;\ No newline at end of file&lt;br/&gt;
+      | d&lt;span class=&quot;error&quot;&gt;&amp;#91;29&amp;#93;&lt;/span&gt;.i |&lt;br/&gt;
+&lt;br/&gt;
+  Scenario: g_V_mapXinX_limitX2X_valuesXnameX&lt;br/&gt;
+    Given the modern graph&lt;br/&gt;
+    And the traversal of&lt;br/&gt;
+      &quot;&quot;&quot;&lt;br/&gt;
+      g.V().map(__.in()).limit(2).values(&apos;name&apos;)&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   nit: we prefer double quotes for strings in our feature tests as a convention. &lt;/p&gt;


</comment>
                            <comment id="17813644" author="githubbot" created="Fri, 2 Feb 2024 11:55:11 +0000"  >&lt;p&gt;spmallette commented on PR #2475:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/2475#issuecomment-1923659468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/2475#issuecomment-1923659468&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   for other committers, i will help backfill some extra tests on this one, deal with CHANGELOG, etc. on merge&lt;/p&gt;

</comment>
                            <comment id="17814534" author="githubbot" created="Mon, 5 Feb 2024 23:32:56 +0000"  >&lt;p&gt;upadhyay-prashant commented on code in PR #2475:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/2475#discussion_r1479052070&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/2475#discussion_r1479052070&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
gremlin-core/pom.xml:&lt;br/&gt;
##########&lt;br/&gt;
@@ -101,6 +101,16 @@ limitations under the License.&lt;br/&gt;
             &amp;lt;artifactId&amp;gt;hamcrest&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
             &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;&lt;br/&gt;
         &amp;lt;/dependency&amp;gt;&lt;br/&gt;
+        &amp;lt;dependency&amp;gt;&lt;/p&gt;

&lt;p&gt;Review Comment:&lt;br/&gt;
   done &lt;/p&gt;



&lt;p&gt;##########&lt;br/&gt;
gremlin-test/src/main/resources/org/apache/tinkerpop/gremlin/test/features/filter/Range.feature:&lt;br/&gt;
##########&lt;br/&gt;
@@ -280,4 +280,16 @@ Feature: Step - range()&lt;br/&gt;
     When iterated to list&lt;br/&gt;
     Then the result should be unordered&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; result &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; d&lt;span class=&quot;error&quot;&gt;&amp;#91;29&amp;#93;&lt;/span&gt;.i &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;\ No newline at end of file&lt;br/&gt;
+      | d&lt;span class=&quot;error&quot;&gt;&amp;#91;29&amp;#93;&lt;/span&gt;.i |&lt;br/&gt;
+&lt;br/&gt;
+  Scenario: g_V_mapXinX_limitX2X_valuesXnameX&lt;br/&gt;
+    Given the modern graph&lt;br/&gt;
+    And the traversal of&lt;br/&gt;
+      &quot;&quot;&quot;&lt;br/&gt;
+      g.V().map(__.in()).limit(2).values(&apos;name&apos;)&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   done&lt;/p&gt;


</comment>
                            <comment id="17814539" author="githubbot" created="Mon, 5 Feb 2024 23:54:50 +0000"  >&lt;p&gt;upadhyay-prashant opened a new pull request, #2481:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/2481&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/2481&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   &#8230;and thus causing incorrect results&lt;/p&gt;

&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-3045&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TINKERPOP-3045&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   EarlyLimitStrategy was too aggressive to promote limit before map steps. Not all the Map step can be displaced. Specifically if a Map step has capability to filter the results, then it should be displaced.&lt;/p&gt;

&lt;p&gt;   This code change brings in a utility to statically determine the output arity of a step and accordingly allow EarlyLimitStrategy to make a decision whether a map step can be moved.&lt;/p&gt;

&lt;p&gt;   Test is added in Range.feature which ensures that this bug is fixed. This test gives wrong result without this code change.&lt;/p&gt;

</comment>
                            <comment id="17814556" author="githubbot" created="Tue, 6 Feb 2024 00:47:13 +0000"  >&lt;p&gt;spmallette closed pull request #2481: &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-3045&quot; title=&quot;EarlyLimitStrategy is too aggresive to promote Limit and thus causing incorrect results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TINKERPOP-3045&quot;&gt;&lt;del&gt;TINKERPOP-3045&lt;/del&gt;&lt;/a&gt;: EarlyLimitStrategy is too aggresive to promote Limit &#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/2481&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/2481&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17814557" author="githubbot" created="Tue, 6 Feb 2024 00:47:14 +0000"  >&lt;p&gt;spmallette commented on PR #2481:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/2481#issuecomment-1928575168&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/2481#issuecomment-1928575168&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   closing for #2475 which was updated to match what is here.&lt;/p&gt;

</comment>
                            <comment id="17814805" author="githubbot" created="Tue, 6 Feb 2024 13:27:14 +0000"  >&lt;p&gt;spmallette merged PR #2475:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/2475&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/2475&lt;/a&gt;&lt;/p&gt;

</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1n5z4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>