<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:11:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TINKERPOP-2126] toString() methods not thread-safe</title>
                <link>https://issues.apache.org/jira/browse/TINKERPOP-2126</link>
                <project id="12316520" key="TINKERPOP">TinkerPop</project>
                    <description>&lt;p&gt;&lt;tt&gt;TraverserSet::toString()&lt;/tt&gt; is not thread-safe as it uses an iterator on the internal map, which could concurrently be modified (most likely in OLAP environments).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13207743">TINKERPOP-2126</key>
            <summary>toString() methods not thread-safe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkuppitz">Daniel Kuppitz</assignee>
                                    <reporter username="dkuppitz">Daniel Kuppitz</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Jan 2019 20:18:47 +0000</created>
                <updated>Thu, 31 Jan 2019 16:41:08 +0000</updated>
                            <resolved>Thu, 31 Jan 2019 16:41:08 +0000</resolved>
                                    <version>3.3.5</version>
                                    <fixVersion>3.3.6</fixVersion>
                    <fixVersion>3.4.1</fixVersion>
                                    <component>process</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16738320" author="githubbot" created="Wed, 9 Jan 2019 15:08:59 +0000"  >&lt;p&gt;dkuppitz commented on pull request #1035: &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-2126&quot; title=&quot;toString() methods not thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TINKERPOP-2126&quot;&gt;&lt;del&gt;TINKERPOP-2126&lt;/del&gt;&lt;/a&gt; Made TraverserSet internals thread-safe&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/1035&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/1035&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-2126&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TINKERPOP-2126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   This PR replaces the `LinkedHashMap` used by `TraverserSet` with a `SynchronizedMap`. I haven&apos;t added a test case, cause I really don&apos;t know how to consistently provoke a `ConcurrentModificationException`; however, a `ConcurrentModificationException` did happen several times in a provider implementation and it was caused by the `TraverserSet::toString()` method while Spark was a) processing a query and b) concurrently logging the current state. The way `TraverserSet::toString()` is implemented, it totally makes sense that this scenario would sooner or later hit a `ConcurrentModificationException` if we don&apos;t use a synchronized map.&lt;/p&gt;

&lt;p&gt;   `docker/build.sh -t -i` passed.&lt;/p&gt;

&lt;p&gt;   VOTE +1&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16739464" author="githubbot" created="Thu, 10 Jan 2019 14:42:05 +0000"  >&lt;p&gt;asfgit commented on pull request #1035: &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-2126&quot; title=&quot;toString() methods not thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TINKERPOP-2126&quot;&gt;&lt;del&gt;TINKERPOP-2126&lt;/del&gt;&lt;/a&gt; Made TraverserSet internals thread-safe&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/1035&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/1035&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16749169" author="dkuppitz" created="Tue, 22 Jan 2019 21:30:55 +0000"  >&lt;p&gt;Reopening as the same issue occurred in &lt;tt&gt;ObjectWritable&lt;/tt&gt;&apos;s &lt;tt&gt;toString()&lt;/tt&gt; method.&lt;/p&gt;</comment>
                            <comment id="16750434" author="githubbot" created="Wed, 23 Jan 2019 21:17:04 +0000"  >&lt;p&gt;dkuppitz commented on pull request #1044: &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-2126&quot; title=&quot;toString() methods not thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TINKERPOP-2126&quot;&gt;&lt;del&gt;TINKERPOP-2126&lt;/del&gt;&lt;/a&gt; Fixed concurrency issue in `ObjectWritable::toString()`.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/1044&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/1044&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-2126&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TINKERPOP-2126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   So, apparently, Spark 2.4.0 has some background logging going on, where it takes objects out of memory and dumps their `toString()` into the log. I don&apos;t think we can control when Spark is going to do that, so we have to work around it by making our `toString()` methods thread-safe or handle each `ConcurrentModificationException`. Guaranteeing thread-safety was easy for `TraverserSet` but turned out to be tricky (impossible?) for `ObjectWritable` as it&apos;s totally unclear where the objects are coming from and/or where they get modified while Spark is trying to log them.&lt;/p&gt;

&lt;p&gt;   I don&apos;t think we can make any arbitrary object thread-safe, but we can easily catch the `ConcurrentModificationException` and retry until we succeed. `while (true)` looks a bit scary, but I don&apos;t think that this can ever become an infinite loop.&lt;/p&gt;

&lt;p&gt;   `docker/build.sh -t -i -n` passed (as well as the external provider tests that consistently triggered the concurrency exceptions).&lt;/p&gt;

&lt;p&gt;   VOTE +1&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16757469" author="githubbot" created="Thu, 31 Jan 2019 16:39:51 +0000"  >&lt;p&gt;dkuppitz commented on pull request #1044: &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-2126&quot; title=&quot;toString() methods not thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TINKERPOP-2126&quot;&gt;&lt;del&gt;TINKERPOP-2126&lt;/del&gt;&lt;/a&gt; Fixed concurrency issue in `ObjectWritable::toString()`.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/1044&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/1044&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00j3c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>