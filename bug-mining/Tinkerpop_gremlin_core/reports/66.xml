<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:11:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TINKERPOP-1619] TinkerGraphComputer worker count affects OptionalStep query results</title>
                <link>https://issues.apache.org/jira/browse/TINKERPOP-1619</link>
                <project id="12316520" key="TINKERPOP">TinkerPop</project>
                    <description>&lt;p&gt;I found that when I bump the worker count up to 4 on my local box, the dedup nested in the optional appears to not be handled correctly.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;gremlin&amp;gt; g = TinkerFactory.createModern().traversal()
==&amp;gt;graphtraversalsource[tinkergraph[vertices:6 edges:6], standard]
gremlin&amp;gt; g.withComputer(Computer.compute().workers(3)).V(1, 2).optional(bothE().dedup())
==&amp;gt;e[9][1-created-&amp;gt;3]
==&amp;gt;e[7][1-knows-&amp;gt;2]
==&amp;gt;e[8][1-knows-&amp;gt;4]
==&amp;gt;v[2]
gremlin&amp;gt; g.withComputer(Computer.compute().workers(4)).V(1, 2).optional(bothE().dedup())
==&amp;gt;e[9][1-created-&amp;gt;3]
==&amp;gt;e[7][1-knows-&amp;gt;2]
==&amp;gt;e[7][1-knows-&amp;gt;2]
==&amp;gt;e[8][1-knows-&amp;gt;4]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13039230">TINKERPOP-1619</key>
            <summary>TinkerGraphComputer worker count affects OptionalStep query results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="spmallette">Stephen Mallette</assignee>
                                    <reporter username="twilmes">Ted Wilmes</reporter>
                        <labels>
                    </labels>
                <created>Tue, 31 Jan 2017 16:38:32 +0000</created>
                <updated>Mon, 8 Jul 2019 16:32:51 +0000</updated>
                            <resolved>Mon, 8 Jul 2019 16:32:51 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.3.8</fixVersion>
                    <fixVersion>3.4.3</fixVersion>
                    <fixVersion>3.5.0</fixVersion>
                                    <component>process</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15847101" author="okram" created="Tue, 31 Jan 2017 16:43:51 +0000"  >&lt;p&gt;And &lt;tt&gt;tp32/&lt;/tt&gt; branch, it works? I ask this cause we introduced a new &lt;tt&gt;OptionalStep&lt;/tt&gt; in &lt;tt&gt;master/&lt;/tt&gt; (3.3.0).&lt;/p&gt;</comment>
                            <comment id="15847108" author="twilmes" created="Tue, 31 Jan 2017 16:50:34 +0000"  >&lt;p&gt;That&apos;s a good question, &lt;tt&gt;tp32&lt;/tt&gt; throws this exception with that query:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;gremlin&amp;gt; g = TinkerFactory.createModern().traversal()
gremlin&amp;gt; g.withComputer(Computer.compute().workers(3)).V(1, 2).optional(bothE().dedup())                                                                                                                   [33/1896]
java.lang.RuntimeException: java.lang.IllegalStateException: java.lang.IllegalArgumentException: The provided key is not a memory compute key: 1.2.1(1.1.0(2.0.0()))
Type &lt;span class=&quot;code-quote&quot;&gt;&apos;:help&apos;&lt;/span&gt; or &lt;span class=&quot;code-quote&quot;&gt;&apos;:h&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; help.
Display stack trace? [yN]y
java.lang.IllegalStateException: java.lang.RuntimeException: java.lang.IllegalStateException: java.lang.IllegalArgumentException: The provided key is not a memory compute key: 1.2.1(1.1.0(2.0.0()))
        at org.apache.tinkerpop.gremlin.process.computer.traversal.step.map.VertexProgramStep.processNextStart(VertexProgramStep.java:88)
        at org.apache.tinkerpop.gremlin.process.traversal.step.util.AbstractStep.hasNext(AbstractStep.java:143)
        at org.apache.tinkerpop.gremlin.process.traversal.step.util.ExpandableStepIterator.next(ExpandableStepIterator.java:50)
        at org.apache.tinkerpop.gremlin.process.computer.traversal.step.map.ComputerResultStep.processNextStart(ComputerResultStep.java:68)
        at org.apache.tinkerpop.gremlin.process.traversal.step.util.AbstractStep.hasNext(AbstractStep.java:143)
        at org.apache.tinkerpop.gremlin.process.traversal.util.DefaultTraversal.hasNext(DefaultTraversal.java:184)
        at org.apache.tinkerpop.gremlin.console.Console$_closure3.doCall(Console.groovy:237)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:93)
        at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:325)
        at org.codehaus.groovy.runtime.metaclass.ClosureMetaClass.invokeMethod(ClosureMetaClass.java:294)
        at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1027)
        at org.codehaus.groovy.tools.shell.Groovysh.setLastResult(Groovysh.groovy:447)
        at org.codehaus.groovy.tools.shell.Groovysh.execute(Groovysh.groovy:191)
        at org.apache.tinkerpop.gremlin.console.GremlinGroovysh.&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$3$execute(GremlinGroovysh.groovy)
        at sun.reflect.GeneratedMethodAccessor14.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:93)
        at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:325)
        at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1218)
        at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.invokeMethodOnSuperN(ScriptBytecodeAdapter.java:132)
        at org.apache.tinkerpop.gremlin.console.GremlinGroovysh.execute(GremlinGroovysh.groovy:72)
        at org.codehaus.groovy.tools.shell.Shell.leftShift(Shell.groovy:122)
        at org.codehaus.groovy.tools.shell.ShellRunner.work(ShellRunner.groovy:95)
        at org.codehaus.groovy.tools.shell.InteractiveShellRunner.&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$2$work(InteractiveShellRunner.groovy)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:93)
        at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:325)
        at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1218)
        at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.invokeMethodOnSuperN(ScriptBytecodeAdapter.java:132)
        at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.invokeMethodOnSuper0(ScriptBytecodeAdapter.java:152)
        at org.codehaus.groovy.tools.shell.InteractiveShellRunner.work(InteractiveShellRunner.groovy:124)
        at org.codehaus.groovy.tools.shell.ShellRunner.run(ShellRunner.groovy:59)
        at org.codehaus.groovy.tools.shell.InteractiveShellRunner.&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$2$run(InteractiveShellRunner.groovy)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.codehaus.groovy.reflection.CachedMethod.invoke(CachedMethod.java:93)
        at groovy.lang.MetaMethod.doMethodInvoke(MetaMethod.java:325)
        at groovy.lang.MetaClassImpl.invokeMethod(MetaClassImpl.java:1218)
        at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.invokeMethodOnSuperN(ScriptBytecodeAdapter.java:132)
        at org.codehaus.groovy.runtime.ScriptBytecodeAdapter.invokeMethodOnSuper0(ScriptBytecodeAdapter.java:152)
        at org.codehaus.groovy.tools.shell.InteractiveShellRunner.run(InteractiveShellRunner.groovy:83)
        at org.codehaus.groovy.vmplugin.v7.IndyInterface.selectMethod(IndyInterface.java:232)
        at org.apache.tinkerpop.gremlin.console.Console.&amp;lt;init&amp;gt;(Console.groovy:169)
        at org.codehaus.groovy.vmplugin.v7.IndyInterface.selectMethod(IndyInterface.java:232)
        at org.apache.tinkerpop.gremlin.console.Console.main(Console.groovy:478)
Caused by: java.util.concurrent.ExecutionException: java.lang.RuntimeException: java.lang.IllegalStateException: java.lang.IllegalArgumentException: The provided key is not a memory compute key: 1.2.1(1.1.0(2.0.0
()))
        at java.util.concurrent.FutureTask.report(FutureTask.java:122)
        at java.util.concurrent.FutureTask.get(FutureTask.java:192)
        at org.apache.tinkerpop.gremlin.process.computer.traversal.step.map.VertexProgramStep.processNextStart(VertexProgramStep.java:68)
        ... 54 more
Caused by: java.lang.RuntimeException: java.lang.IllegalStateException: java.lang.IllegalArgumentException: The provided key is not a memory compute key: 1.2.1(1.1.0(2.0.0()))
        at org.apache.tinkerpop.gremlin.tinkergraph.process.computer.TinkerGraphComputer.lambda$submit$3(TinkerGraphComputer.java:244)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.lang.IllegalStateException: java.lang.IllegalArgumentException: The provided key is not a memory compute key: 1.2.1(1.1.0(2.0.0()))
        at org.apache.tinkerpop.gremlin.tinkergraph.process.computer.TinkerWorkerPool.executeVertexProgram(TinkerWorkerPool.java:114)
        at org.apache.tinkerpop.gremlin.tinkergraph.process.computer.TinkerGraphComputer.lambda$submit$3(TinkerGraphComputer.java:169)
        ... 4 more
Caused by: java.util.concurrent.ExecutionException: java.lang.IllegalArgumentException: The provided key is not a memory compute key: 1.2.1(1.1.0(2.0.0()))
        at java.util.concurrent.FutureTask.report(FutureTask.java:122)
        at java.util.concurrent.FutureTask.get(FutureTask.java:192)
        at org.apache.tinkerpop.gremlin.tinkergraph.process.computer.TinkerWorkerPool.executeVertexProgram(TinkerWorkerPool.java:110)
        ... 5 more
Caused by: java.lang.IllegalArgumentException: The provided key is not a memory compute key: 1.2.1(1.1.0(2.0.0()))
        at org.apache.tinkerpop.gremlin.process.computer.GraphComputer$Exceptions.providedKeyIsNotAMemoryComputeKey(GraphComputer.java:249)
        at org.apache.tinkerpop.gremlin.tinkergraph.process.computer.TinkerMemory.checkKeyValue(TinkerMemory.java:143)
        at org.apache.tinkerpop.gremlin.tinkergraph.process.computer.TinkerWorkerMemory.add(TinkerWorkerMemory.java:93)
        at org.apache.tinkerpop.gremlin.process.computer.traversal.WorkerExecutor.drainStep(WorkerExecutor.java:212)
        at org.apache.tinkerpop.gremlin.process.computer.traversal.WorkerExecutor.execute(WorkerExecutor.java:147)
        at org.apache.tinkerpop.gremlin.process.computer.traversal.TraversalVertexProgram.execute(TraversalVertexProgram.java:291)
        at org.apache.tinkerpop.gremlin.tinkergraph.process.computer.TinkerGraphComputer.lambda$&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;$0(TinkerGraphComputer.java:174)
        at org.apache.tinkerpop.gremlin.tinkergraph.process.computer.TinkerWorkerPool.lambda$executeVertexProgram$0(TinkerWorkerPool.java:102)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        ... 4 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15847118" author="okram" created="Tue, 31 Jan 2017 16:55:14 +0000"  >&lt;p&gt;This makes sense. This is the problem with &lt;tt&gt;optional()&lt;/tt&gt; in tp32/. It is used &quot;twice&quot; (once to check existence, and once to iterate results). Regarding &lt;tt&gt;master/&lt;/tt&gt;, that doesn&apos;t make sense since the optional traversal of &lt;tt&gt;OptionalStep&lt;/tt&gt; is a &quot;local child.&quot; We&apos;ll figure out...&lt;/p&gt;</comment>
                            <comment id="15847125" author="okram" created="Tue, 31 Jan 2017 16:57:46 +0000"  >&lt;p&gt;Ah. I know why.... cause its a &quot;pseudo&quot; local child (like &lt;tt&gt;LocalStep&lt;/tt&gt;). Its local to the worker, not to the traverser........ hmmmm. Anywho, yea, I know why its doing that, but I have no good solution off the top of my head.&lt;/p&gt;</comment>
                            <comment id="15847131" author="twilmes" created="Tue, 31 Jan 2017 17:01:43 +0000"  >&lt;p&gt;Ok, that makes sense.  I was wondering if when I bumped the worker count to 4 the duplicate edges were no longer being processed by the same worker and the dedup wasn&apos;t global.  Kuppitz had a variation of this query as a test case for &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-1597&quot; title=&quot;PathRetractionStrategy messing up certain traversals&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TINKERPOP-1597&quot;&gt;&lt;del&gt;TINKERPOP-1597&lt;/del&gt;&lt;/a&gt; so I&apos;ll go ahead and close that one out now.&lt;/p&gt;</comment>
                            <comment id="15848603" author="okram" created="Wed, 1 Feb 2017 16:43:36 +0000"  >&lt;p&gt;The simple solution to this problem is to treat the &lt;tt&gt;optional()&lt;/tt&gt; traversal as a local child and, thus, reset prior to each new &lt;tt&gt;addStart()&lt;/tt&gt;. This means that &lt;tt&gt;dedup())&lt;/tt&gt; in an optional-traversal would be reset for each incoming traverser. This will solve that fact that we are currently treating &lt;tt&gt;optional()&lt;/tt&gt; as a &quot;pseudo&quot; local traversal that has both local and global properties.&lt;/p&gt;</comment>
                            <comment id="16876549" author="githubbot" created="Mon, 1 Jul 2019 23:10:05 +0000"  >&lt;p&gt;spmallette commented on pull request #1153: &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-1619&quot; title=&quot;TinkerGraphComputer worker count affects OptionalStep query results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TINKERPOP-1619&quot;&gt;&lt;del&gt;TINKERPOP-1619&lt;/del&gt;&lt;/a&gt; Fix optional() with TinkerGraphComputer&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/1153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/1153&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-1619&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TINKERPOP-1619&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   All tests pass with `docker/build.sh -t -i`&lt;/p&gt;

&lt;p&gt;   VOTE +1&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16880525" author="githubbot" created="Mon, 8 Jul 2019 16:32:22 +0000"  >&lt;p&gt;spmallette commented on pull request #1153: &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-1619&quot; title=&quot;TinkerGraphComputer worker count affects OptionalStep query results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TINKERPOP-1619&quot;&gt;&lt;del&gt;TINKERPOP-1619&lt;/del&gt;&lt;/a&gt; Fix optional() with TinkerGraphComputer&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/1153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/1153&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39fbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>