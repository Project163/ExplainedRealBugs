<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:12:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TINKERPOP-3100] Traversal.Admin.lock() has excessive recursion</title>
                <link>https://issues.apache.org/jira/browse/TINKERPOP-3100</link>
                <project id="12316520" key="TINKERPOP">TinkerPop</project>
                    <description>&lt;p&gt;Hi, we are currently upgrading to TinkerPop 3.7, and noticed that some of our larger queries were taking much longer than expected to applyStrategies / lock.&lt;a href=&quot;https://github.com/camfiander-sonrai/TinkerPopLockPerformanceRepro&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&#160;I&apos;ve created an example project with a contrived complex traversal that reproduces the issue&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I noticed that many of the children steps were getting locked more than once, which shouldn&apos;t be necessary. I think the problem is&#160;&lt;a href=&quot;https://github.com/apache/tinkerpop/blob/3.7.2/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/util/DefaultTraversal.java#L333&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&#160;&lt;tt&gt;applyTraversalRecursively&lt;/tt&gt;, called from the traversal root, should apply the&#160;&lt;tt&gt;lock()&lt;/tt&gt;&#160;to all children, grandchildren, and so on. But each child also calls&#160;&lt;tt&gt;applyTraversalRecursively&lt;/tt&gt;, meaning the number of times a step is locked scales with the depth of the traversal.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# TinkerPop 3.5.3
Applied strategies in PT3.695S   
# TinkerPop 3.7.2
Applied strategies in PT15.079S&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>M1 Macbook, 16GB RAM</environment>
        <key id="13587321">TINKERPOP-3100</key>
            <summary>Traversal.Admin.lock() has excessive recursion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="spmallette">Stephen Mallette</assignee>
                                    <reporter username="camfiander">Cameron Fiander</reporter>
                        <labels>
                            <label>performance</label>
                    </labels>
                <created>Tue, 30 Jul 2024 12:11:09 +0000</created>
                <updated>Tue, 22 Jul 2025 15:17:59 +0000</updated>
                            <resolved>Tue, 22 Jul 2025 15:17:59 +0000</resolved>
                                    <version>3.7.2</version>
                                    <fixVersion>4.0.0</fixVersion>
                    <fixVersion>3.7.4</fixVersion>
                    <fixVersion>3.8.0</fixVersion>
                                    <component>console</component>
                    <component>process</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17870662" author="JIRAUSER291439" created="Sat, 3 Aug 2024 05:22:30 +0000"  >&lt;p&gt;I ran a similar example on x86 and noticed a comparable performance loss. Because this is a performance issue, I increased the priority to critical so that it hopefully gets addressed in the next release.&lt;/p&gt;</comment>
                            <comment id="17993050" author="githubbot" created="Thu, 3 Jul 2025 11:30:00 +0000"  >&lt;p&gt;spmallette opened a new pull request, #3152:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/3152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/3152&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-3100&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TINKERPOP-3100&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   Drastically improves the performance of lock() as you lose the excessive recursion and avoid having to reidentify steps repeatedly.&lt;/p&gt;

&lt;p&gt;   ```&lt;br/&gt;
   Benchmark                                  Mode  Cnt   Score    Error   Units&lt;br/&gt;
   TraversalLockBenchmark.testLockTraversal  thrpt   10  &#8776; 10&#8315;&#8308;           ops/ms&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;   after&lt;/p&gt;

&lt;p&gt;   ```&lt;br/&gt;
   Benchmark                                  Mode  Cnt   Score   Error   Units&lt;br/&gt;
   TraversalLockBenchmark.testLockTraversal  thrpt   10  18.784 &#177; 0.334  ops/ms&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;   VOTE +1&lt;/p&gt;

</comment>
                            <comment id="18003889" author="githubbot" created="Tue, 8 Jul 2025 20:36:37 +0000"  >&lt;p&gt;Cole-Greer commented on PR #3152:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/3152#issuecomment-3050234923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/3152#issuecomment-3050234923&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   VOTE +1 (pending actions passing)&lt;/p&gt;

</comment>
                            <comment id="18004124" author="githubbot" created="Wed, 9 Jul 2025 12:04:02 +0000"  >&lt;p&gt;spmallette commented on PR #3152:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/3152#issuecomment-3052395986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/3152#issuecomment-3052395986&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   Updated description around the build failures.......&lt;/p&gt;

</comment>
                            <comment id="18008155" author="githubbot" created="Fri, 18 Jul 2025 20:35:29 +0000"  >&lt;p&gt;Cole-Greer commented on PR #3152:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/3152#issuecomment-3090650381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/3152#issuecomment-3090650381&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   @spmallette This should be good to rebase and merge now that &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-3172&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TINKERPOP-3172&lt;/a&gt; is in.&lt;/p&gt;

</comment>
                            <comment id="18009025" author="githubbot" created="Tue, 22 Jul 2025 15:16:46 +0000"  >&lt;p&gt;spmallette merged PR #3152:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/3152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/3152&lt;/a&gt;&lt;/p&gt;

</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1qlls:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>