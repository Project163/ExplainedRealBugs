<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:12:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TINKERPOP-2490] RangeGlobalStep touches next traverser when high limit is already hit</title>
                <link>https://issues.apache.org/jira/browse/TINKERPOP-2490</link>
                <project id="12316520" key="TINKERPOP">TinkerPop</project>
                    <description>&lt;p&gt;In FilterStep, the processNextStart() method will first retrieve next traverser and then apply filtering logic. But for RangleGlobalStep, if high limit is already hit, there will be no need to get next traverser.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Traverser.Admin&amp;lt;S&amp;gt; processNextStart() {
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Traverser.Admin&amp;lt;S&amp;gt; traverser = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.starts.next();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.filter(traverser))
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; traverser;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;An example would be limit step: g.V().limit(1). This query will touch 2 vertices although only 1 vertex will be returned.&lt;/p&gt;

&lt;p&gt;This extra data loading will cause performance defects if DB data loading is involved. It is not a functionality bug, but for better performance, we&apos;d better check high range limit first before touching next traversal.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13345440">TINKERPOP-2490</key>
            <summary>RangeGlobalStep touches next traverser when high limit is already hit</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Guo Junshi">Guo Junshi</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Dec 2020 07:07:16 +0000</created>
                <updated>Sun, 23 Apr 2023 23:07:55 +0000</updated>
                                            <version>3.4.8</version>
                                                    <component>process</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17247711" author="githubbot" created="Fri, 11 Dec 2020 07:22:24 +0000"  >&lt;p&gt;junshiguo opened a new pull request #1370:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/1370&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/1370&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-2490&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TINKERPOP-2490&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   In FilterStep, the processNextStart() method will first retrieve next traverser and then apply filtering logic. But for RangleGlobalStep, if high limit is already hit, there will be no need to get next traverser.&lt;/p&gt;

&lt;p&gt;   e.g. g.V().limit(1). This query will touch 2 vertices although only 1 vertex will be returned.&lt;/p&gt;

&lt;p&gt;   This PR added high limit check before retrieving next traverser for filtering. Functionality is not affected, but we can expect better performance if getting next traverser is heavy.&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17247743" author="githubbot" created="Fri, 11 Dec 2020 08:25:31 +0000"  >&lt;p&gt;junshiguo closed pull request #1370:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/1370&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/1370&lt;/a&gt;&lt;/p&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17247744" author="githubbot" created="Fri, 11 Dec 2020 08:25:33 +0000"  >&lt;p&gt;junshiguo opened a new pull request #1370:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/1370&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/1370&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/TINKERPOP-2490&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/TINKERPOP-2490&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   In FilterStep, the processNextStart() method will first retrieve next traverser and then apply filtering logic. But for RangleGlobalStep, if high limit is already hit, there will be no need to get next traverser.&lt;/p&gt;

&lt;p&gt;   e.g. g.V().limit(1). This query will touch 2 vertices although only 1 vertex will be returned.&lt;/p&gt;

&lt;p&gt;   This PR added high limit check before retrieving next traverser for filtering. Functionality is not affected, but we can expect better performance if getting next traverser is heavy.&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17250529" author="githubbot" created="Wed, 16 Dec 2020 18:38:49 +0000"  >&lt;p&gt;spmallette commented on pull request #1370:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/1370#issuecomment-746798499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/1370#issuecomment-746798499&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thank you for this contribution. VOTE +1&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17252794" author="githubbot" created="Mon, 21 Dec 2020 11:59:37 +0000"  >&lt;p&gt;spmallette merged pull request #1370:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/1370&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/1370&lt;/a&gt;&lt;/p&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17266001" author="spmallette" created="Fri, 15 Jan 2021 12:29:26 +0000"  >&lt;p&gt;While running integration tests for our likely release next week, I&apos;ve noticed that &lt;tt&gt;EarlyLimitStrategy} related tests are failing in a {{GraphComputer&lt;/tt&gt; context.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ERROR] Tests run: 797, Failures: 0, Errors: 1, Skipped: 7, Time elapsed: 14.266 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.tinkerpop.gremlin.tinkergraph.process.TinkerGraphNoStrategyProcessStandardIntegrateTest
[ERROR] org.apache.tinkerpop.gremlin.process.traversal.strategy.optimization.EarlyLimitStrategyProcessTest  Time elapsed: 0.049 s  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.NullPointerException
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It&apos;s probably not a big deal to fix, but rather than risk the change in this short time frame to release, I think it better to take our time fixing this and introducing it in 3.4.11 (I also don&apos;t have any time to focus on digging into this between now and release). &lt;/p&gt;</comment>
                            <comment id="17266006" author="githubbot" created="Fri, 15 Jan 2021 12:33:05 +0000"  >&lt;p&gt;spmallette commented on pull request #1370:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/tinkerpop/pull/1370#issuecomment-760915848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tinkerpop/pull/1370#issuecomment-760915848&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Unfortunately, I&apos;ve had to revert this change and re-open the issue in JIRA: 46fc7f627c75e016688727551f211c432af5a0d3 &lt;/p&gt;

&lt;p&gt;   I&apos;ve commented in JIRA on the reasoning for why. I sense this is not a big deal to fix, but didn&apos;t want to risk including the change given our short window for release.&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17715490" author="porunov" created="Sun, 23 Apr 2023 16:23:40 +0000"  >&lt;p&gt;This bug still exists in TinkerPop (checked version 3.6.2). An example test which shows when this behavior is not expected is below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testLimitedFilterNotChecksElementsOverTheLimit(){
    TinkerGraph tinkerGraph = TinkerGraph.open();
    List&amp;lt;Vertex&amp;gt; vertices = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0; i&amp;lt;3; i++){
        Vertex v1 = tinkerGraph.addVertex();
        Vertex v2 = tinkerGraph.addVertex();
        v1.addEdge(&lt;span class=&quot;code-quote&quot;&gt;&quot;connects&quot;&lt;/span&gt;, v2);
        vertices.add(v1);
    }
    tinkerGraph.traversal().V(vertices.get(0), vertices.get(1), vertices.get(2))
        .where(__.out(&lt;span class=&quot;code-quote&quot;&gt;&quot;connects&quot;&lt;/span&gt;).count().is(P.gte(1))).limit(1).toList();

    TraversalMetrics traversalMetrics = tinkerGraph.traversal()
        .V(vertices.get(0), vertices.get(1), vertices.get(2))
        .where(__.out(&lt;span class=&quot;code-quote&quot;&gt;&quot;connects&quot;&lt;/span&gt;).count().is(P.gte(1)))
        .limit(1)
        .profile().next();

    &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; filterTraversalCount = traversalMetrics.getMetrics().stream().filter(metrics -&amp;gt; metrics.getName().startsWith(TraversalFilterStep.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getSimpleName()))
        .findFirst().get().getCount(TraversalMetrics.TRAVERSER_COUNT_ID);

    Assertions.assertEquals(1, filterTraversalCount);
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In the above test the filter first checks the first provided vertex (which runs some potentially expensive check) then when limit is satisfied the check is executed again for the second provided vertex (even so it&apos;s unnecessary). The 3rd vertex is not evaluated.&lt;/p&gt;

&lt;p&gt;Thus, basically, we execute this computation always for 1 more unnecessary vertex.&lt;/p&gt;

&lt;p&gt;The above assertEquals will throw:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.opentest4j.AssertionFailedError:&#160;
Expected :1
Actual &#160; :2 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17715508" author="JIRAUSER295200" created="Sun, 23 Apr 2023 19:37:29 +0000"  >&lt;p&gt;this behavior is part of `CountStrategy` optimization and it looks correct.&#160;&lt;br/&gt;
how can you read only 1 vertex to know that there are less than 2 of them?&lt;/p&gt;</comment>
                            <comment id="17715539" author="porunov" created="Sun, 23 Apr 2023 23:07:55 +0000"  >&lt;p&gt;Maybe I&apos;m missing something, but I doubt that it&apos;s `CountStrategy. Even without `count` step at all (let&apos;s replace it with `has` step for example) the behavior will be the same. `has` step will be executed for 2 vertices even so, `limit` step says that `1` is enough. Could be I&apos;m missing some logic behind those step usages, but in my understanding the filter query should be executed for a single vertex if that vertex matches the filter and the limit is reached.&lt;/p&gt;

&lt;p&gt;I.e. `V(v1, v2, v3) .where(${some_filter_which_is_always_true}).limit(1)` in my testing `some_filter_which_is_always_true` is executed 2 times, but I would expect it to be executed only once because limit says that we don&apos;t need more elements then 1.&lt;/p&gt;

&lt;p&gt;As for count query above, notice that I use `.gte` and not `gt`. Thus it should be grater or equal and thus `1` should satisfy the requirements. I don&apos;t see a point of checking a second element to find out that the amount of elements is more if equal to 1 satisfies the requirements as well. Nevertheless, my issue isn&apos;t in the Count query, but in the filter step which is executed more than needed (from my point of view).&lt;/p&gt;

&lt;p&gt;Here is a simplified version of the test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testLimitedFilterNotChecksElementsOverTheLimit(){
    TinkerGraph tinkerGraph = TinkerGraph.open();
    List&amp;lt;Vertex&amp;gt; vertices = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0; i&amp;lt;3; i++){
        Vertex v1 = tinkerGraph.addVertex();
        Vertex v2 = tinkerGraph.addVertex();
        v1.addEdge(&lt;span class=&quot;code-quote&quot;&gt;&quot;connects&quot;&lt;/span&gt;, v2);
        vertices.add(v1);
    }

    TraversalMetrics traversalMetrics = tinkerGraph.traversal()
        .V(vertices.get(0), vertices.get(1), vertices.get(2))
        .where(__.inject(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;))
        .limit(1)
        .profile().next();

    &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; filterTraversalCount = traversalMetrics.getMetrics().stream().filter(metrics -&amp;gt; metrics.getName().startsWith(TraversalFilterStep.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getSimpleName()))
        .findFirst().get().getCount(TraversalMetrics.TRAVERSER_COUNT_ID);

    Assertions.assertEquals(1, filterTraversalCount);
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0lexc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>