{"url":"https://api.github.com/repos/square/okhttp/issues/3422","repository_url":"https://api.github.com/repos/square/okhttp","labels_url":"https://api.github.com/repos/square/okhttp/issues/3422/labels{/name}","comments_url":"https://api.github.com/repos/square/okhttp/issues/3422/comments","events_url":"https://api.github.com/repos/square/okhttp/issues/3422/events","html_url":"https://github.com/square/okhttp/issues/3422","id":237968746,"node_id":"MDU6SXNzdWUyMzc5Njg3NDY=","number":3422,"title":"multithreaded http2 GET occasionally hang","user":{"login":"ifedorenko","id":79316,"node_id":"MDQ6VXNlcjc5MzE2","avatar_url":"https://avatars.githubusercontent.com/u/79316?v=4","gravatar_id":"","url":"https://api.github.com/users/ifedorenko","html_url":"https://github.com/ifedorenko","followers_url":"https://api.github.com/users/ifedorenko/followers","following_url":"https://api.github.com/users/ifedorenko/following{/other_user}","gists_url":"https://api.github.com/users/ifedorenko/gists{/gist_id}","starred_url":"https://api.github.com/users/ifedorenko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ifedorenko/subscriptions","organizations_url":"https://api.github.com/users/ifedorenko/orgs","repos_url":"https://api.github.com/users/ifedorenko/repos","events_url":"https://api.github.com/users/ifedorenko/events{/privacy}","received_events_url":"https://api.github.com/users/ifedorenko/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":9998865,"node_id":"MDU6TGFiZWw5OTk4ODY1","url":"https://api.github.com/repos/square/okhttp/labels/bug","name":"bug","color":"d93f0b","default":true,"description":"Bug in existing code"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-06-22T20:45:11Z","updated_at":"2017-08-14T17:45:03Z","closed_at":"2017-08-14T17:45:03Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When running multithreaded HTTP2 GET requests against nginx server, okhttp 3.8.1 occasionally hangs with all client threads stuck with the stacktrace like the one below and no `Http2Connection$ReaderRunnable` thread running. This is on OSX using Oracle java 1.8.0_131 jdk, if this makes any difference.\r\n\r\nThe problem may be related to server [limiting the number of requests using the same connection to 1000](http://nginx.org/en/docs/http/ngx_http_v2_module.html#http2_max_requests), then sending `GOAWAY` frame. But I am not sure how to setup a standalone test for this hypothesis and generally out of ideas how to troubleshoot this further.\r\n\r\n\r\n```\r\n\"pool-1-thread-1\" #27 prio=5 os_prio=31 tid=0x00007fdc1f9bd800 nid=0x8603 in Object.wait() [0x0000700002c18000]\r\n   java.lang.Thread.State: WAITING (on object monitor)\r\n\tat java.lang.Object.wait(Native Method)\r\n\tat java.lang.Object.wait(Object.java:502)\r\n\tat okhttp3.internal.http2.Http2Stream.waitForIo(Http2Stream.java:577)\r\n\tat okhttp3.internal.http2.Http2Stream.takeResponseHeaders(Http2Stream.java:143)\r\n\t- locked <0x00000003c109ef90> (a okhttp3.internal.http2.Http2Stream)\r\n\tat okhttp3.internal.http2.Http2Codec.readResponseHeaders(Http2Codec.java:120)\r\n\tat okhttp3.internal.http.CallServerInterceptor.intercept(CallServerInterceptor.java:75)\r\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:92)\r\n\tat okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.java:45)\r\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:92)\r\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:67)\r\n\tat okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.java:93)\r\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:92)\r\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:67)\r\n\tat okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.java:93)\r\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:92)\r\n\tat okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.java:120)\r\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:92)\r\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:67)\r\n\tat okhttp3.logging.HttpLoggingInterceptor.intercept(HttpLoggingInterceptor.java:211)\r\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:92)\r\n\tat okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.java:67)\r\n\tat okhttp3.RealCall.getResponseWithInterceptorChain(RealCall.java:185)\r\n\tat okhttp3.RealCall.execute(RealCall.java:69)\r\n\tat io.takari.generation.aether.connector.OkhttpContentLoader.get(OkhttpContentLoader.java:105)\r\n...\r\n```","closed_by":{"login":"swankjesse","id":133019,"node_id":"MDQ6VXNlcjEzMzAxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/133019?v=4","gravatar_id":"","url":"https://api.github.com/users/swankjesse","html_url":"https://github.com/swankjesse","followers_url":"https://api.github.com/users/swankjesse/followers","following_url":"https://api.github.com/users/swankjesse/following{/other_user}","gists_url":"https://api.github.com/users/swankjesse/gists{/gist_id}","starred_url":"https://api.github.com/users/swankjesse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/swankjesse/subscriptions","organizations_url":"https://api.github.com/users/swankjesse/orgs","repos_url":"https://api.github.com/users/swankjesse/repos","events_url":"https://api.github.com/users/swankjesse/events{/privacy}","received_events_url":"https://api.github.com/users/swankjesse/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/square/okhttp/issues/3422/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/square/okhttp/issues/3422/timeline","performed_via_github_app":null,"state_reason":"completed"}