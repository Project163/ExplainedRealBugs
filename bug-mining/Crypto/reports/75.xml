<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:42:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CRYPTO-149] Intermittent Failure in GCMCipherTest#testGcmTamperedData()</title>
                <link>https://issues.apache.org/jira/browse/CRYPTO-149</link>
                <project id="12320024" key="CRYPTO">Commons Crypto</project>
                    <description>&lt;p&gt;Gary Gregory &lt;br/&gt;
Aug 5, 2020, 10:53 PM (20 hours ago)&lt;br/&gt;
to Commons&lt;/p&gt;

&lt;p&gt;Hi All:&lt;/p&gt;

&lt;p&gt;I am seeing what may be a random AEADBadTagException in GcmCipherTest?&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; testGcmTamperedData(org.apache.commons.crypto.cipher.GcmCipherTest)&lt;br/&gt;
 Time elapsed: 0.015 s  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
881java.lang.Exception: Unexpected exception,&lt;br/&gt;
expected&amp;lt;javax.crypto.AEADBadTagException&amp;gt; but&lt;br/&gt;
was&amp;lt;java.lang.InternalError&amp;gt;&lt;br/&gt;
882     at org.apache.commons.crypto.cipher.GcmCipherTest.testGcmTamperedData(GcmCipherTest.java:224)&lt;br/&gt;
883&lt;br/&gt;
884&lt;/p&gt;

&lt;p&gt;Any thoughts?&lt;/p&gt;

&lt;p&gt;The above is from&lt;br/&gt;
&lt;a href=&quot;https://travis-ci.org/github/apache/commons-crypto/jobs/715348986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/github/apache/commons-crypto/jobs/715348986&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;

&lt;p&gt;Alex Remily &lt;br/&gt;
8:10 AM (11 hours ago)&lt;br/&gt;
to Commons&lt;/p&gt;

&lt;p&gt;That is an intermittent issue that I haven&apos;t been able to reliably reproduce.  As I recall, the test that&apos;s failing is supposed to fail, but in a different way.  I think it&apos;s supposed to fail because of a short buffer but occasionally fails because of an internal error, and when that happens this test fails.  I don&apos;t know when it was introduced.  We should probably document it in jira and or realese notes.&lt;/p&gt;

&lt;p&gt;Matt Sicker &lt;br/&gt;
10:33 AM (8 hours ago)&lt;br/&gt;
to Commons&lt;/p&gt;

&lt;p&gt;Now I hope we don&apos;t have unit tests depending on non-static state for&lt;br/&gt;
its random number generator! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I&apos;d expect a crypto library&apos;s test&lt;br/&gt;
suites to include several hard-coded known-good and known-bad&lt;br/&gt;
ciphertexts with static keys/IVs similar to the test cases presented&lt;br/&gt;
in their RFCs (especially since said tests are typically small enough&lt;br/&gt;
to copy/paste the binary data fairly easily).&lt;br/&gt;
&amp;#8211;&lt;br/&gt;
Matt Sicker &lt;/p&gt;

&lt;p&gt;Rob Tompkins &lt;br/&gt;
10:37 AM (8 hours ago)&lt;br/&gt;
to Commons&lt;/p&gt;

&lt;p&gt;We actually do have a considerable number of those in our projects where we use probabilistic epsilons on the output. See commons-rng. Note, Gilles is quite good at writing such tests.&lt;/p&gt;

&lt;p&gt;-Rob&lt;/p&gt;

&lt;p&gt;Matt Sicker &lt;br/&gt;
10:42 AM (8 hours ago)&lt;br/&gt;
to Commons&lt;/p&gt;

&lt;p&gt;Well, for testing RNGs, I can understand using property testing, yes.&lt;br/&gt;
It would also be useful for testing fuzzing scenarios like making sure&lt;br/&gt;
the GCM tag is invalid for any random input data (giving a near zero&lt;br/&gt;
probability of valid data) or that an elliptic curve implementation&lt;br/&gt;
doesn&apos;t leak out information about points outside the curve or respond&lt;br/&gt;
to invalid inputs improperly or things like that.&lt;/p&gt;


&lt;p&gt;Rob Tompkins &lt;br/&gt;
10:50 AM (8 hours ago)&lt;br/&gt;
to Commons&lt;/p&gt;

&lt;p&gt;+1 - the elliptic curve stuff I&#8217;ll have to defer to you on as I&#8217;m less a number theorist and more of a logician.&lt;/p&gt;

&lt;p&gt;-Rob&lt;/p&gt;

&lt;p&gt;Gary Gregory  &lt;br/&gt;
10:56 AM (8 hours ago)&lt;br/&gt;
to Commons&lt;/p&gt;

&lt;p&gt;This is all fine and good but how would you fix the test such that it does&lt;br/&gt;
not fail randomly. PR anyone?&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;

&lt;p&gt;Rob Tompkins &lt;br/&gt;
10:57 AM (8 hours ago)&lt;br/&gt;
to Commons&lt;/p&gt;

&lt;p&gt;Either static inputs for determinism, or putting a probabilistic boundary in which the solution can fall.&lt;/p&gt;

&lt;p&gt;-Rob&lt;/p&gt;

&lt;p&gt;Matt Sicker &lt;br/&gt;
11:00 AM (8 hours ago)&lt;br/&gt;
to Commons&lt;/p&gt;

&lt;p&gt;Choose a seed value for the `new Random()` constructor and the tests&lt;br/&gt;
will be deterministic.&lt;/p&gt;

&lt;p&gt;Matt Sicker &lt;br/&gt;
11:02 AM (8 hours ago)&lt;br/&gt;
to Commons&lt;/p&gt;

&lt;p&gt;Or alternatively, if using random values each time, have it retry the&lt;br/&gt;
test with a different value. It&apos;s typically better to use an actual&lt;br/&gt;
property testing library for these types of tests anyways. One example&lt;br/&gt;
library I found is &lt;a href=&quot;https://jqwik.net/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jqwik.net/&lt;/a&gt; (these types of testing&lt;br/&gt;
libraries are more common in functional programming like in Scala).&lt;/p&gt;


&lt;p&gt;Rob Tompkins &lt;br/&gt;
11:03 AM (8 hours ago)&lt;br/&gt;
to Commons&lt;/p&gt;

&lt;p&gt;Precisely. That&#8217;s another technique we&#8217;ve used in rng.&lt;/p&gt;

&lt;p&gt;-Ropb&lt;/p&gt;</description>
                <environment></environment>
        <key id="13321402">CRYPTO-149</key>
            <summary>Intermittent Failure in GCMCipherTest#testGcmTamperedData()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="aremily">Alex Remily</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Aug 2020 23:28:41 +0000</created>
                <updated>Sun, 23 Aug 2020 12:48:32 +0000</updated>
                            <resolved>Sun, 9 Aug 2020 02:24:06 +0000</resolved>
                                    <version>1.0.0</version>
                    <version>1.1.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>Cipher</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="17173726" author="aremily" created="Sun, 9 Aug 2020 02:24:06 +0000"  >&lt;p&gt;I&apos;m fairly confident that this bug is fixed.  The length of the cipher&apos;s initialization vector is set by a call to the Random class&apos;s nextInt method.  The return value for that method was bounded between zero and sixty, inclusive.  When that method returned zero, it resulted in an error setting GCM initial vector length.  I changed the bounds of the return value to between 1 and 60, inclusive, and tested by running the unit test in a continual loop for several minutes without error.&lt;/p&gt;</comment>
                            <comment id="17173727" author="aremily" created="Sun, 9 Aug 2020 02:24:49 +0000"  >&lt;p&gt;This is the PR with the fix:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-crypto/pull/105&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-crypto/pull/105&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 13 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hjr4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>