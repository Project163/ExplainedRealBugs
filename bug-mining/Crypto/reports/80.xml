<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:42:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CRYPTO-169] Unable to load native library on Apple Silicon (M1 Mac)</title>
                <link>https://issues.apache.org/jira/browse/CRYPTO-169</link>
                <project id="12320024" key="CRYPTO">Commons Crypto</project>
                    <description>&lt;p&gt;Recently as trying to upgrade commons-crypto from 1.1.0 to 1.2.0 in Spark (&lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-45617&quot; title=&quot;Upgrade Apache Commons Crypto 1.2.0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-45617&quot;&gt;&lt;del&gt;SPARK-45617&lt;/del&gt;&lt;/a&gt;), got the following error in one test:&lt;/p&gt;

&lt;p&gt;```&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   Cause: java.security.GeneralSecurityException: Native library is not loaded&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   at org.apache.commons.crypto.random.OpenSslCryptoRandom.checkNative(OpenSslCryptoRandom.java:79)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   at org.apache.commons.crypto.random.OpenSslCryptoRandom.&amp;lt;clinit&amp;gt;(OpenSslCryptoRandom.java:65)       &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   at java.base/java.lang.Class.forName0(Native Method)                         &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   at java.base/java.lang.Class.forName(Class.java:467)               &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   at org.apache.commons.crypto.utils.ReflectionUtils.getClassByNameOrNull(ReflectionUtils.java:93)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   at org.apache.commons.crypto.utils.ReflectionUtils.getClassByName(ReflectionUtils.java:64)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   at org.apache.commons.crypto.random.CryptoRandomFactory.getCryptoRandom(CryptoRandomFactory.java:189)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   at org.apache.spark.security.CryptoStreamUtils$.createInitializationVector(CryptoStreamUtils.scala:138)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   at org.apache.spark.security.CryptoStreamUtils$.createCryptoOutputStream(CryptoStreamUtils.scala:56)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   at org.apache.spark.serializer.SerializerManager.$anonfun$wrapForEncryption$3(SerializerManager.scala:151) &lt;br/&gt;
```&lt;/p&gt;

&lt;p&gt;I did a quick check. commons-crypto-1.2.0.jar only contain x86_64 Mac native library, it doesn&apos;t provide pre-built native library for Apple Silicon.&lt;/p&gt;

&lt;p&gt;But I also checked commons-crypto-1.1.0.jar which Spark uses currently. It also doesn&apos;t provide native library for Apple Silicon.&lt;/p&gt;

&lt;p&gt;Since they both don&apos;t contain native library for Apple Silicon, why commons-crypto-1.2.0 doesn&apos;t work and what makes the difference between commons-crypto-1.1.0 and commons-crypto-1.2.0?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13555051">CRYPTO-169</key>
            <summary>Unable to load native library on Apple Silicon (M1 Mac)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="viirya">L. C. Hsieh</reporter>
                        <labels>
                    </labels>
                <created>Sat, 21 Oct 2023 08:10:09 +0000</created>
                <updated>Sun, 16 Feb 2025 18:07:53 +0000</updated>
                            <resolved>Tue, 21 Nov 2023 20:37:39 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17778033" author="garydgregory" created="Sat, 21 Oct 2023 08:39:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://commons.apache.org/proper/commons-crypto/changes-report.html#a1.2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://commons.apache.org/proper/commons-crypto/changes-report.html#a1.2.0&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17778037" author="luciferyang" created="Sat, 21 Oct 2023 08:57:01 +0000"  >&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[error] Uncaught exception when running org.apache.spark.sql.execution.python.RowQueueSuite: java.lang.ExceptionInInitializerError
[error] sbt.ForkMain$ForkError: java.lang.ExceptionInInitializerError: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
[error] &#160; &#160; &#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method)
[error] &#160; &#160; &#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:467)
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.utils.ReflectionUtils.getClassByNameOrNull(ReflectionUtils.java:93)
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.utils.ReflectionUtils.getClassByName(ReflectionUtils.java:64)
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.random.CryptoRandomFactory.getCryptoRandom(CryptoRandomFactory.java:189)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.security.CryptoStreamUtils$.createInitializationVector(CryptoStreamUtils.scala:138)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.security.CryptoStreamUtils$.createCryptoOutputStream(CryptoStreamUtils.scala:56)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.serializer.SerializerManager.$anonfun$wrapForEncryption$3(SerializerManager.scala:151)
[error] &#160; &#160; &#160; &#160; at scala.Option.map(Option.scala:242)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.serializer.SerializerManager.wrapForEncryption(SerializerManager.scala:151)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.sql.execution.python.DiskRowQueue.&amp;lt;init&amp;gt;(RowQueue.scala:119)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.sql.execution.python.RowQueueSuite.$anonfun$&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;$2(RowQueueSuite.scala:72)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.sql.execution.python.RowQueueSuite.$anonfun$&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;$2$adapted(RowQueueSuite.scala:68)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.security.EncryptionFunSuite.$anonfun$encryptionTest$2(EncryptionFunSuite.scala:32)
[error] &#160; &#160; &#160; &#160; at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)
[error] &#160; &#160; &#160; &#160; at org.scalatest.enablers.Timed$$anon$1.timeoutAfter(Timed.scala:127)
[error] &#160; &#160; &#160; &#160; at org.scalatest.concurrent.TimeLimits$.failAfterImpl(TimeLimits.scala:282)
[error] &#160; &#160; &#160; &#160; at org.scalatest.concurrent.TimeLimits.failAfter(TimeLimits.scala:231)
[error] &#160; &#160; &#160; &#160; at org.scalatest.concurrent.TimeLimits.failAfter$(TimeLimits.scala:230)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.failAfter(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.$anonfun$test$2(SparkFunSuite.scala:155)
[error] &#160; &#160; &#160; &#160; at org.scalatest.OutcomeOf.outcomeOf(OutcomeOf.scala:85)
[error] &#160; &#160; &#160; &#160; at org.scalatest.OutcomeOf.outcomeOf$(OutcomeOf.scala:83)
[error] &#160; &#160; &#160; &#160; at org.scalatest.OutcomeOf$.outcomeOf(OutcomeOf.scala:104)
[error] &#160; &#160; &#160; &#160; at org.scalatest.Transformer.apply(Transformer.scala:22)
[error] &#160; &#160; &#160; &#160; at org.scalatest.Transformer.apply(Transformer.scala:20)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike$$anon$1.apply(AnyFunSuiteLike.scala:226)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.withFixture(SparkFunSuite.scala:227)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.invokeWithFixture$1(AnyFunSuiteLike.scala:224)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.$anonfun$runTest$1(AnyFunSuiteLike.scala:236)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.runTestImpl(Engine.scala:306)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.runTest(AnyFunSuiteLike.scala:236)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.runTest$(AnyFunSuiteLike.scala:218)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.org$scalatest$BeforeAndAfterEach$$&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$runTest(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterEach.runTest(BeforeAndAfterEach.scala:234)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterEach.runTest$(BeforeAndAfterEach.scala:227)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.runTest(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.$anonfun$runTests$1(AnyFunSuiteLike.scala:269)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.$anonfun$runTestsInBranch$1(Engine.scala:413)
[error] &#160; &#160; &#160; &#160; at scala.collection.immutable.List.foreach(List.scala:333)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.traverseSubNodes$1(Engine.scala:401)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.runTestsInBranch(Engine.scala:396)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.runTestsImpl(Engine.scala:475)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.runTests(AnyFunSuiteLike.scala:269)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.runTests$(AnyFunSuiteLike.scala:268)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuite.runTests(AnyFunSuite.scala:1564)
[error] &#160; &#160; &#160; &#160; at org.scalatest.Suite.run(Suite.scala:1114)
[error] &#160; &#160; &#160; &#160; at org.scalatest.Suite.run$(Suite.scala:1096)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuite.org$scalatest$funsuite$AnyFunSuiteLike$$&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$run(AnyFunSuite.scala:1564)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.$anonfun$run$1(AnyFunSuiteLike.scala:273)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.runImpl(Engine.scala:535)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.run(AnyFunSuiteLike.scala:273)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.run$(AnyFunSuiteLike.scala:272)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.org$scalatest$BeforeAndAfterAll$$&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$run(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterAll.liftedTree1$1(BeforeAndAfterAll.scala:213)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterAll.run(BeforeAndAfterAll.scala:210)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterAll.run$(BeforeAndAfterAll.scala:208)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.run(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.scalatest.tools.Framework.org$scalatest$tools$Framework$$runSuite(Framework.scala:321)
[error] &#160; &#160; &#160; &#160; at org.scalatest.tools.Framework$ScalaTestTask.execute(Framework.scala:517)
[error] &#160; &#160; &#160; &#160; at sbt.ForkMain$Run.lambda$runTest$1(ForkMain.java:414)
[error] &#160; &#160; &#160; &#160; at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
[error] &#160; &#160; &#160; &#160; at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
[error] &#160; &#160; &#160; &#160; at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
[error] &#160; &#160; &#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:833)
[error] Caused by: sbt.ForkMain$ForkError: java.lang.IllegalStateException: java.security.GeneralSecurityException: Native library is not loaded
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.random.OpenSslCryptoRandom.&amp;lt;clinit&amp;gt;(OpenSslCryptoRandom.java:67)
[error] &#160; &#160; &#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method)
[error] &#160; &#160; &#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:467)
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.utils.ReflectionUtils.getClassByNameOrNull(ReflectionUtils.java:93)
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.utils.ReflectionUtils.getClassByName(ReflectionUtils.java:64)
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.random.CryptoRandomFactory.getCryptoRandom(CryptoRandomFactory.java:189)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.security.CryptoStreamUtils$.createInitializationVector(CryptoStreamUtils.scala:138)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.security.CryptoStreamUtils$.createCryptoOutputStream(CryptoStreamUtils.scala:56)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.serializer.SerializerManager.$anonfun$wrapForEncryption$3(SerializerManager.scala:151)
[error] &#160; &#160; &#160; &#160; at scala.Option.map(Option.scala:242)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.serializer.SerializerManager.wrapForEncryption(SerializerManager.scala:151)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.sql.execution.python.DiskRowQueue.&amp;lt;init&amp;gt;(RowQueue.scala:119)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.sql.execution.python.RowQueueSuite.$anonfun$&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;$2(RowQueueSuite.scala:72)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.sql.execution.python.RowQueueSuite.$anonfun$&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;$2$adapted(RowQueueSuite.scala:68)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.security.EncryptionFunSuite.$anonfun$encryptionTest$2(EncryptionFunSuite.scala:32)
[error] &#160; &#160; &#160; &#160; at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)
[error] &#160; &#160; &#160; &#160; at org.scalatest.enablers.Timed$$anon$1.timeoutAfter(Timed.scala:127)
[error] &#160; &#160; &#160; &#160; at org.scalatest.concurrent.TimeLimits$.failAfterImpl(TimeLimits.scala:282)
[error] &#160; &#160; &#160; &#160; at org.scalatest.concurrent.TimeLimits.failAfter(TimeLimits.scala:231)
[error] &#160; &#160; &#160; &#160; at org.scalatest.concurrent.TimeLimits.failAfter$(TimeLimits.scala:230)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.failAfter(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.$anonfun$test$2(SparkFunSuite.scala:155)
[error] &#160; &#160; &#160; &#160; at org.scalatest.OutcomeOf.outcomeOf(OutcomeOf.scala:85)
[error] &#160; &#160; &#160; &#160; at org.scalatest.OutcomeOf.outcomeOf$(OutcomeOf.scala:83)
[error] &#160; &#160; &#160; &#160; at org.scalatest.OutcomeOf$.outcomeOf(OutcomeOf.scala:104)
[error] &#160; &#160; &#160; &#160; at org.scalatest.Transformer.apply(Transformer.scala:22)
[error] &#160; &#160; &#160; &#160; at org.scalatest.Transformer.apply(Transformer.scala:20)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike$$anon$1.apply(AnyFunSuiteLike.scala:226)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.withFixture(SparkFunSuite.scala:227)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.invokeWithFixture$1(AnyFunSuiteLike.scala:224)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.$anonfun$runTest$1(AnyFunSuiteLike.scala:236)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.runTestImpl(Engine.scala:306)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.runTest(AnyFunSuiteLike.scala:236)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.runTest$(AnyFunSuiteLike.scala:218)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.org$scalatest$BeforeAndAfterEach$$&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$runTest(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterEach.runTest(BeforeAndAfterEach.scala:234)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterEach.runTest$(BeforeAndAfterEach.scala:227)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.runTest(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.$anonfun$runTests$1(AnyFunSuiteLike.scala:269)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.$anonfun$runTestsInBranch$1(Engine.scala:413)
[error] &#160; &#160; &#160; &#160; at scala.collection.immutable.List.foreach(List.scala:333)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.traverseSubNodes$1(Engine.scala:401)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.runTestsInBranch(Engine.scala:396)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.runTestsImpl(Engine.scala:475)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.runTests(AnyFunSuiteLike.scala:269)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.runTests$(AnyFunSuiteLike.scala:268)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuite.runTests(AnyFunSuite.scala:1564)
[error] &#160; &#160; &#160; &#160; at org.scalatest.Suite.run(Suite.scala:1114)
[error] &#160; &#160; &#160; &#160; at org.scalatest.Suite.run$(Suite.scala:1096)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuite.org$scalatest$funsuite$AnyFunSuiteLike$$&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$run(AnyFunSuite.scala:1564)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.$anonfun$run$1(AnyFunSuiteLike.scala:273)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.runImpl(Engine.scala:535)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.run(AnyFunSuiteLike.scala:273)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.run$(AnyFunSuiteLike.scala:272)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.org$scalatest$BeforeAndAfterAll$$&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$run(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterAll.liftedTree1$1(BeforeAndAfterAll.scala:213)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterAll.run(BeforeAndAfterAll.scala:210)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterAll.run$(BeforeAndAfterAll.scala:208)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.run(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.scalatest.tools.Framework.org$scalatest$tools$Framework$$runSuite(Framework.scala:321)
[error] &#160; &#160; &#160; &#160; at org.scalatest.tools.Framework$ScalaTestTask.execute(Framework.scala:517)
[error] &#160; &#160; &#160; &#160; at sbt.ForkMain$Run.lambda$runTest$1(ForkMain.java:414)
[error] &#160; &#160; &#160; &#160; at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
[error] &#160; &#160; &#160; &#160; at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
[error] &#160; &#160; &#160; &#160; at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
[error] &#160; &#160; &#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:833)
[error] Caused by: sbt.ForkMain$ForkError: java.security.GeneralSecurityException: Native library is not loaded
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.random.OpenSslCryptoRandom.checkNative(OpenSslCryptoRandom.java:79)
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.random.OpenSslCryptoRandom.&amp;lt;clinit&amp;gt;(OpenSslCryptoRandom.java:65)
[error] &#160; &#160; &#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method)
[error] &#160; &#160; &#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:467)
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.utils.ReflectionUtils.getClassByNameOrNull(ReflectionUtils.java:93)
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.utils.ReflectionUtils.getClassByName(ReflectionUtils.java:64)
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.random.CryptoRandomFactory.getCryptoRandom(CryptoRandomFactory.java:189)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.security.CryptoStreamUtils$.createInitializationVector(CryptoStreamUtils.scala:138)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.security.CryptoStreamUtils$.createCryptoOutputStream(CryptoStreamUtils.scala:56)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.serializer.SerializerManager.$anonfun$wrapForEncryption$3(SerializerManager.scala:151)
[error] &#160; &#160; &#160; &#160; at scala.Option.map(Option.scala:242)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.serializer.SerializerManager.wrapForEncryption(SerializerManager.scala:151)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.sql.execution.python.DiskRowQueue.&amp;lt;init&amp;gt;(RowQueue.scala:119)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.sql.execution.python.RowQueueSuite.$anonfun$&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;$2(RowQueueSuite.scala:72)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.sql.execution.python.RowQueueSuite.$anonfun$&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;$2$adapted(RowQueueSuite.scala:68)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.security.EncryptionFunSuite.$anonfun$encryptionTest$2(EncryptionFunSuite.scala:32)
[error] &#160; &#160; &#160; &#160; at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)
[error] &#160; &#160; &#160; &#160; at org.scalatest.enablers.Timed$$anon$1.timeoutAfter(Timed.scala:127)
[error] &#160; &#160; &#160; &#160; at org.scalatest.concurrent.TimeLimits$.failAfterImpl(TimeLimits.scala:282)
[error] &#160; &#160; &#160; &#160; at org.scalatest.concurrent.TimeLimits.failAfter(TimeLimits.scala:231)
[error] &#160; &#160; &#160; &#160; at org.scalatest.concurrent.TimeLimits.failAfter$(TimeLimits.scala:230)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.failAfter(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.$anonfun$test$2(SparkFunSuite.scala:155)
[error] &#160; &#160; &#160; &#160; at org.scalatest.OutcomeOf.outcomeOf(OutcomeOf.scala:85)
[error] &#160; &#160; &#160; &#160; at org.scalatest.OutcomeOf.outcomeOf$(OutcomeOf.scala:83)
[error] &#160; &#160; &#160; &#160; at org.scalatest.OutcomeOf$.outcomeOf(OutcomeOf.scala:104)
[error] &#160; &#160; &#160; &#160; at org.scalatest.Transformer.apply(Transformer.scala:22)
[error] &#160; &#160; &#160; &#160; at org.scalatest.Transformer.apply(Transformer.scala:20)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike$$anon$1.apply(AnyFunSuiteLike.scala:226)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.withFixture(SparkFunSuite.scala:227)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.invokeWithFixture$1(AnyFunSuiteLike.scala:224)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.$anonfun$runTest$1(AnyFunSuiteLike.scala:236)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.runTestImpl(Engine.scala:306)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.runTest(AnyFunSuiteLike.scala:236)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.runTest$(AnyFunSuiteLike.scala:218)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.org$scalatest$BeforeAndAfterEach$$&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$runTest(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterEach.runTest(BeforeAndAfterEach.scala:234)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterEach.runTest$(BeforeAndAfterEach.scala:227)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.runTest(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.$anonfun$runTests$1(AnyFunSuiteLike.scala:269)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.$anonfun$runTestsInBranch$1(Engine.scala:413)
[error] &#160; &#160; &#160; &#160; at scala.collection.immutable.List.foreach(List.scala:333)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.traverseSubNodes$1(Engine.scala:401)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.runTestsInBranch(Engine.scala:396)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.runTestsImpl(Engine.scala:475)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.runTests(AnyFunSuiteLike.scala:269)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.runTests$(AnyFunSuiteLike.scala:268)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuite.runTests(AnyFunSuite.scala:1564)
[error] &#160; &#160; &#160; &#160; at org.scalatest.Suite.run(Suite.scala:1114)
[error] &#160; &#160; &#160; &#160; at org.scalatest.Suite.run$(Suite.scala:1096)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuite.org$scalatest$funsuite$AnyFunSuiteLike$$&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$run(AnyFunSuite.scala:1564)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.$anonfun$run$1(AnyFunSuiteLike.scala:273)
[error] &#160; &#160; &#160; &#160; at org.scalatest.SuperEngine.runImpl(Engine.scala:535)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.run(AnyFunSuiteLike.scala:273)
[error] &#160; &#160; &#160; &#160; at org.scalatest.funsuite.AnyFunSuiteLike.run$(AnyFunSuiteLike.scala:272)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.org$scalatest$BeforeAndAfterAll$$&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;$run(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterAll.liftedTree1$1(BeforeAndAfterAll.scala:213)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterAll.run(BeforeAndAfterAll.scala:210)
[error] &#160; &#160; &#160; &#160; at org.scalatest.BeforeAndAfterAll.run$(BeforeAndAfterAll.scala:208)
[error] &#160; &#160; &#160; &#160; at org.apache.spark.SparkFunSuite.run(SparkFunSuite.scala:69)
[error] &#160; &#160; &#160; &#160; at org.scalatest.tools.Framework.org$scalatest$tools$Framework$$runSuite(Framework.scala:321)
[error] &#160; &#160; &#160; &#160; at org.scalatest.tools.Framework$ScalaTestTask.execute(Framework.scala:517)
[error] &#160; &#160; &#160; &#160; at sbt.ForkMain$Run.lambda$runTest$1(ForkMain.java:414)
[error] &#160; &#160; &#160; &#160; at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
[error] &#160; &#160; &#160; &#160; at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)
[error] &#160; &#160; &#160; &#160; at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)
[error] &#160; &#160; &#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:833) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The complete error stack is as above, the key error should be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[error] Caused by: sbt.ForkMain$ForkError: java.security.GeneralSecurityException: Native library is not loaded
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.random.OpenSslCryptoRandom.checkNative(OpenSslCryptoRandom.java:79)
[error] &#160; &#160; &#160; &#160; at org.apache.commons.crypto.random.OpenSslCryptoRandom.&amp;lt;clinit&amp;gt;(OpenSslCryptoRandom.java:65)
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17778047" author="luciferyang" created="Sat, 21 Oct 2023 09:59:28 +0000"  >&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13063764/13063764_image-2023-10-21-17-51-41-260.png&quot; height=&quot;184&quot; width=&quot;720&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13063765/13063765_image-2023-10-21-17-52-02-237.png&quot; height=&quot;152&quot; width=&quot;707&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-crypto/blob/c14df32ea386eadf1d459e05ca526ab1b6bc9874/src/main/java/org/apache/commons/crypto/random/OpenSslCryptoRandom.java#L64-L68&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-crypto/blob/c14df32ea386eadf1d459e05ca526ab1b6bc9874/src/main/java/org/apache/commons/crypto/random/OpenSslCryptoRandom.java#L64-L68&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13063766/13063766_image-2023-10-21-17-53-16-898.png&quot; height=&quot;103&quot; width=&quot;340&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It appears to be related to the newly added `checkNative()` process in OpenSslCryptoRandom, the GeneralSecurityException wrapped by IllegalStateException is ultimately wrapped as `java.lang.ExceptionInInitializerError`.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13063767/13063767_image-2023-10-21-17-59-13-866.png&quot; height=&quot;467&quot; width=&quot;716&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-crypto/blob/c14df32ea386eadf1d459e05ca526ab1b6bc9874/src/main/java/org/apache/commons/crypto/random/CryptoRandomFactory.java#L198-L201&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-crypto/blob/c14df32ea386eadf1d459e05ca526ab1b6bc9874/src/main/java/org/apache/commons/crypto/random/CryptoRandomFactory.java#L198-L201&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So, should we add handling for `ExceptionInInitializerError` in the `CryptoRandomFactory#getCryptoRandom(java.util.Properties)` method, or change it to catch `Throwable`?&lt;/p&gt;</comment>
                            <comment id="17778190" author="garydgregory" created="Sat, 21 Oct 2023 18:37:30 +0000"  >&lt;p&gt;We do not support Apple silicon yet. The issue is that GCC does not support it yet either:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gcc.gnu.org/bugzilla/show_bug.cgi?id=96168&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gcc.gnu.org/bugzilla/show_bug.cgi?id=96168&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17778192" author="viirya" created="Sat, 21 Oct 2023 18:44:44 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; for your reply.&lt;/p&gt;

&lt;p&gt;As I mentioned in the description, Spark currently uses commons-crypto-1.1.0 and the test can pass without the native loading issue.&lt;/p&gt;

&lt;p&gt;Does it mean commons-crypto-1.1.0 support Apple silicone? If so, is there any change between 1.1.0 and 1.2.0 making such difference (e.g., GCC related change)?&lt;/p&gt;</comment>
                            <comment id="17778195" author="garydgregory" created="Sat, 21 Oct 2023 18:53:01 +0000"  >&lt;p&gt;Commons Crypto has never supported Apple silicon.&lt;/p&gt;

&lt;p&gt;It&apos;s possible that we are looking for a specific version of OpenSSL that&apos;s not on the native path.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17778198" author="viirya" created="Sat, 21 Oct 2023 19:07:37 +0000"  >&lt;p&gt;&amp;gt; It&apos;s possible that we are looking for a specific version of OpenSSL that&apos;s not on the native path.&lt;/p&gt;

&lt;p&gt;Hmm, but I saw commons-crypto-1.1.0 and commons-crypto-1.2.0 both use OpenSSL 1.1.1.&lt;/p&gt;</comment>
                            <comment id="17778202" author="garydgregory" created="Sat, 21 Oct 2023 19:12:10 +0000"  >&lt;p&gt;Hm, what file is it that it cannot load? Is it there, missing, corrupted, or an incompatible format?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17778219" author="viirya" created="Sat, 21 Oct 2023 20:44:25 +0000"  >&lt;p&gt;This is the exception we got:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   Cause: java.security.GeneralSecurityException: Native library is not loaded&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   at org.apache.commons.crypto.random.OpenSslCryptoRandom.checkNative(OpenSslCryptoRandom.java:79)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;   at org.apache.commons.crypto.random.OpenSslCryptoRandom.&amp;lt;clinit&amp;gt;(OpenSslCryptoRandom.java:65)       &lt;/p&gt;

&lt;p&gt;There is no additional info indicating what file cannot be loaded and why it cannot be loaded.&lt;/p&gt;</comment>
                            <comment id="17778262" author="luciferyang" created="Sun, 22 Oct 2023 01:38:50 +0000"  >&lt;p&gt;Yes, crypto has not supported Apple Silicon.&lt;/p&gt;

&lt;p&gt;But the current critical issue is that the behavior of the line of code `org.apache.commons.crypto.random.CryptoRandomFactory.getCryptoRandom(new Properties())` has changed between version 1.1.0 and 1.2.0.&lt;/p&gt;

&lt;p&gt;In 1.1.0, the above statement returns an instance of type `org.apache.commons.crypto.random.JavaCryptoRandom`.&lt;/p&gt;

&lt;p&gt;In 1.2.0, the above statement directly throws an `ExceptionInInitializerError` type of error due to the execution failure of `org.apache.commons.crypto.utils.ReflectionUtils.getClassByName(&quot;org.apache.commons.crypto.random.OpenSslCryptoRandom&quot;)`. Note, here it throws an Error, not an Exception.&lt;/p&gt;

&lt;p&gt;Looking at the logic of `CryptoRandomFactory.getCryptoRandom`, it does not force `OpenSslCryptoRandom` to return successfully. As long as either `OpenSslCryptoRandom` or `JavaCryptoRandom` initializes successfully, it is acceptable. However, in 1.2.0, there is a scenario that `CryptoRandomFactory.getCryptoRandom` cannot handle, because it handles all `Exception` scenarios but does not handle any `Error` scenarios&#65292;so, when an `Error` occurs, it does not attempt to initialize `JavaCryptoRandom`, but directly throws an `ExceptionInInitializerError` instead.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; CryptoRandom getCryptoRandom(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Properties props)
        &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; GeneralSecurityException {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; names = Utils.splitClassNames(getRandomClassString(props), &lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (names.isEmpty()) {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;No &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;name(s) provided&quot;&lt;/span&gt;);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StringBuilder errorMessage = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringBuilder();
    CryptoRandom random = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    Exception lastException = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; klassName : names) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; klass = ReflectionUtils.getClassByName(klassName);
            random = (CryptoRandom) ReflectionUtils.newInstance(klass, props);
            &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ClassCastException e) {
            lastException = e;
            errorMessage.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;: [&quot;&lt;/span&gt; + klassName + &lt;span class=&quot;code-quote&quot;&gt;&quot;] is not a CryptoRandom.&quot;&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ClassNotFoundException e) {
            lastException = e;
            errorMessage.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;CryptoRandom: [&quot;&lt;/span&gt; + klassName + &lt;span class=&quot;code-quote&quot;&gt;&quot;] not found.&quot;&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Exception e) {
            lastException = e;
            errorMessage.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;CryptoRandom: [&quot;&lt;/span&gt; + klassName + &lt;span class=&quot;code-quote&quot;&gt;&quot;] failed with &quot;&lt;/span&gt; + e.getMessage());
        }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (random != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; random;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GeneralSecurityException(errorMessage.toString(), lastException);
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17778268" author="viirya" created="Sun, 22 Oct 2023 02:30:09 +0000"  >&lt;p&gt;It looks like reasonable to catch Throwable instead of Exception so we can get `JavaCryptoRandom` as 1.1.0. But maybe we should exclude fatal errors.&lt;/p&gt;</comment>
                            <comment id="17778297" author="sebb@apache.org" created="Sun, 22 Oct 2023 06:00:42 +0000"  >&lt;p&gt;No, it is never acceptable to catch Throwable. Some exceptions should never be caught.&lt;/p&gt;</comment>
                            <comment id="17778304" author="viirya" created="Sun, 22 Oct 2023 07:13:43 +0000"  >&lt;p&gt;How about only catch `ExceptionInInitializerError`?&lt;/p&gt;</comment>
                            <comment id="17778316" author="sebb@apache.org" created="Sun, 22 Oct 2023 09:02:35 +0000"  >&lt;p&gt;That should be OK.&lt;/p&gt;</comment>
                            <comment id="17778323" author="garydgregory" created="Sun, 22 Oct 2023 09:34:42 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=LuciferYang&quot; class=&quot;user-hover&quot; rel=&quot;LuciferYang&quot;&gt;LuciferYang&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Feel free to create a PR on GitHub so we can see if there are side effects on various platforms.&lt;/p&gt;</comment>
                            <comment id="17778338" author="luciferyang" created="Sun, 22 Oct 2023 10:42:32 +0000"  >&lt;p&gt;Submit &lt;a href=&quot;https://github.com/apache/commons-crypto/pull/258&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-crypto/pull/258&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17778369" author="garydgregory" created="Sun, 22 Oct 2023 13:16:20 +0000"  >&lt;p&gt;Merged to git master. Please test git master or a snapshot build from &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/commons/commons-crypto&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/commons/commons-crypto&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17778419" author="luciferyang" created="Sun, 22 Oct 2023 16:01:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ggregory&quot; class=&quot;user-hover&quot; rel=&quot;ggregory&quot;&gt;ggregory&lt;/a&gt; &#160;It seems that there are some issues with the reentrancy of `CryptoRandomFactory.getCryptoRandom(properties)`.&lt;/p&gt;

&lt;p&gt;For the following test case&#65306;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testReentrancyOfExceptionInInitializerErrorRandom() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; GeneralSecurityException, IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Properties properties = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties();
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; classes = ExceptionInInitializerErrorRandom.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName().concat(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;)
            .concat(CryptoRandomFactory.RandomProvider.JAVA.getClassName());
    properties.setProperty(CryptoRandomFactory.CLASSES_KEY, classes);
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CryptoRandom random = CryptoRandomFactory.getCryptoRandom(properties)) {
        assertEquals(JavaCryptoRandom.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName(), random.getClass().getName());
    }
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CryptoRandom random = CryptoRandomFactory.getCryptoRandom(properties)) {
        assertEquals(JavaCryptoRandom.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName(), random.getClass().getName());
    }
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CryptoRandom random = CryptoRandomFactory.getCryptoRandom(properties)) {
        assertEquals(JavaCryptoRandom.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName(), random.getClass().getName());
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The second call to `CryptoRandomFactory.getCryptoRandom(properties)` will result in the following error:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13063783/13063783_image-2023-10-22-23-58-57-254.png&quot; height=&quot;314&quot; width=&quot;1197&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
It seems that we need to add another layer of protection to the ExceptionInInitializerError that wraps the NoClassDefFoundError ...&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17778420" author="luciferyang" created="Sun, 22 Oct 2023 16:03:18 +0000"  >&lt;p&gt;Is it better to add a follow-up or create a new ticket?&lt;/p&gt;</comment>
                            <comment id="17778427" author="garydgregory" created="Sun, 22 Oct 2023 16:27:50 +0000"  >&lt;p&gt;If this is really a different issue, then yes, a new ticket issue makes sense. In this case, it seems like this ticket is fine.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17778428" author="luciferyang" created="Sun, 22 Oct 2023 16:29:49 +0000"  >&lt;p&gt;OK&lt;/p&gt;</comment>
                            <comment id="17787684" author="sebb@apache.org" created="Sun, 19 Nov 2023 23:39:53 +0000"  >&lt;p&gt;I think there is a problem with the recent changes to OpenSslCryptoRandom.&lt;br/&gt;
It seems wrong for the static block to raise an Exception.&lt;/p&gt;

&lt;p&gt;This means that the method OpenSslCryptoRandom.isNativeCodeEnabled() cannot be used if the class does not load.&lt;/p&gt;

&lt;p&gt;Rather than checking for errors in the static block, they should be checked by the methods of the class as necessary.&lt;/p&gt;</comment>
                            <comment id="17788185" author="sebb@apache.org" created="Mon, 20 Nov 2023 23:37:14 +0000"  >&lt;p&gt;OpenSslCryptoRandom static block issue reported as &lt;a href=&quot;https://issues.apache.org/jira/browse/CRYPTO-178&quot; title=&quot;OpenSslCryptoRandom.isNativeCodeEnabled() throws if library cannot be loaded&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CRYPTO-178&quot;&gt;&lt;del&gt;CRYPTO-178&lt;/del&gt;&lt;/a&gt;; now fixed&lt;/p&gt;</comment>
                            <comment id="17788539" author="sebb@apache.org" created="Tue, 21 Nov 2023 20:37:39 +0000"  >&lt;p&gt;AFAICT, this is fixed.&lt;/p&gt;

&lt;p&gt;Please re-open with a test that shows the issue if not&lt;/p&gt;</comment>
                            <comment id="17922196" author="dongjoon" created="Wed, 29 Jan 2025 19:53:12 +0000"  >&lt;p&gt;Hi, All. Can we have a new release including this, &lt;a href=&quot;https://issues.apache.org/jira/browse/CRYPTO-169&quot; title=&quot;Unable to load native library on Apple Silicon (M1 Mac)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CRYPTO-169&quot;&gt;&lt;del&gt;CRYPTO-169&lt;/del&gt;&lt;/a&gt;?&lt;br/&gt;
Given that 1.2.0 was released on Jan 22, 2023, it seems that we have no new release for 2 year. &lt;/p&gt;</comment>
                            <comment id="17922374" author="garydgregory" created="Thu, 30 Jan 2025 13:24:20 +0000"  >&lt;p&gt;That&apos;s a reasonable request &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dongjoon&quot; class=&quot;user-hover&quot; rel=&quot;dongjoon&quot;&gt;dongjoon&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll put it on my to-do list but I have a few other tasks I&apos;d like to get to first.&lt;/p&gt;</comment>
                            <comment id="17922400" author="dongjoon" created="Thu, 30 Jan 2025 15:05:30 +0000"  >&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13608680">SPARK-51230</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13063764" name="image-2023-10-21-17-51-41-260.png" size="166671" author="LuciferYang" created="Sat, 21 Oct 2023 09:51:42 +0000"/>
                            <attachment id="13063765" name="image-2023-10-21-17-52-02-237.png" size="327759" author="LuciferYang" created="Sat, 21 Oct 2023 09:52:03 +0000"/>
                            <attachment id="13063766" name="image-2023-10-21-17-53-16-898.png" size="101939" author="LuciferYang" created="Sat, 21 Oct 2023 09:53:17 +0000"/>
                            <attachment id="13063767" name="image-2023-10-21-17-59-13-866.png" size="613332" author="LuciferYang" created="Sat, 21 Oct 2023 09:59:15 +0000"/>
                            <attachment id="13063783" name="image-2023-10-22-23-58-57-254.png" size="689413" author="LuciferYang" created="Sun, 22 Oct 2023 15:58:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            40 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1l3w8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>