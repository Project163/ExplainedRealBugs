{"url":"https://api.github.com/repos/eslint/eslint/issues/15037","repository_url":"https://api.github.com/repos/eslint/eslint","labels_url":"https://api.github.com/repos/eslint/eslint/issues/15037/labels{/name}","comments_url":"https://api.github.com/repos/eslint/eslint/issues/15037/comments","events_url":"https://api.github.com/repos/eslint/eslint/issues/15037/events","html_url":"https://github.com/eslint/eslint/issues/15037","id":991303746,"node_id":"MDU6SXNzdWU5OTEzMDM3NDY=","number":15037,"title":"Change Request: Include `ruleId` in error message of crash","user":{"login":"AriPerkkio","id":14806298,"node_id":"MDQ6VXNlcjE0ODA2Mjk4","avatar_url":"https://avatars.githubusercontent.com/u/14806298?v=4","gravatar_id":"","url":"https://api.github.com/users/AriPerkkio","html_url":"https://github.com/AriPerkkio","followers_url":"https://api.github.com/users/AriPerkkio/followers","following_url":"https://api.github.com/users/AriPerkkio/following{/other_user}","gists_url":"https://api.github.com/users/AriPerkkio/gists{/gist_id}","starred_url":"https://api.github.com/users/AriPerkkio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AriPerkkio/subscriptions","organizations_url":"https://api.github.com/users/AriPerkkio/orgs","repos_url":"https://api.github.com/users/AriPerkkio/repos","events_url":"https://api.github.com/users/AriPerkkio/events{/privacy}","received_events_url":"https://api.github.com/users/AriPerkkio/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":45711352,"node_id":"MDU6TGFiZWw0NTcxMTM1Mg==","url":"https://api.github.com/repos/eslint/eslint/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":"This change enhances an existing feature of ESLint"},{"id":82922548,"node_id":"MDU6TGFiZWw4MjkyMjU0OA==","url":"https://api.github.com/repos/eslint/eslint/labels/core","name":"core","color":"c7def8","default":false,"description":"Relates to ESLint's core APIs and features"},{"id":131106229,"node_id":"MDU6TGFiZWwxMzExMDYyMjk=","url":"https://api.github.com/repos/eslint/eslint/labels/accepted","name":"accepted","color":"0052cc","default":false,"description":"There is consensus among the team that this change meets the criteria for inclusion"},{"id":829215248,"node_id":"MDU6TGFiZWw4MjkyMTUyNDg=","url":"https://api.github.com/repos/eslint/eslint/labels/archived%20due%20to%20age","name":"archived due to age","color":"eeeeee","default":false,"description":"This issue has been archived; please open a new issue for any further discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-09-08T16:07:35Z","updated_at":"2022-03-21T16:48:52Z","closed_at":"2021-09-21T00:35:34Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### ESLint version\r\n\r\n7.32.0, 8.0.0-beta.1\r\n\r\n### What problem do you want to solve?\r\n\r\nWhen ESLint rule encounters unexpected error and crashes, the error log should indicate which rule caused the crash. There is already some custom error handling done:\r\n\r\nhttps://github.com/eslint/eslint/blob/143a5987f18f063a47a0646fa1e10e0f88602f6f/lib/linter/linter.js#L1213-L1226\r\n\r\nIt is important for users to identify which rule is causing linter to crash. This information is used when temporarily disabling the erroneous rule. It is also essential when reproducing and debugging the issue. Users and plugin developers are most interested in the root cause.\r\n\r\nMost of the time the stack trace already displays the erroneous rule but there are many cases where it does not. Below are some real examples from stable releases of various eslint plugins.\r\n\r\n<details>\r\n    <summary>Rule code is minified</summary>\r\n\r\n```\r\nTypeError: Cannot read property 'type' of undefined\r\nOccurred while linting <text>:45\r\n    at analyzePropertyChain (/<removed>/eslint-plugin-react-hooks/cjs/eslint-plugin-react-hooks.development.js:2235:12)\r\n    at analyzePropertyChain (/<removed>/eslint-plugin-react-hooks/cjs/eslint-plugin-react-hooks.development.js:2264:20)\r\n    at /<removed>/eslint-plugin-react-hooks/cjs/eslint-plugin-react-hooks.development.js:1297:34\r\n    at Array.forEach (<anonymous>)\r\n    at visitFunctionWithDependencies (/<removed>/eslint-plugin-react-hooks/cjs/eslint-plugin-react-hooks.development.js:1277:43)\r\n    at visitCallExpression (/<removed>/eslint-plugin-react-hooks/cjs/eslint-plugin-react-hooks.development.js:1737:11)\r\n    at /<removed>/eslint/lib/linter/safe-emitter.js:45:58\r\n    at Array.forEach (<anonymous>)\r\n    at Object.emit (/<removed>/eslint/lib/linter/safe-emitter.js:45:38)\r\n    at NodeEventGenerator.applySelector (/<removed>/eslint/lib/linter/node-event-generator.js:254:26)\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n    <summary>Recursion fills stack trace</summary>\r\n\r\n```\r\nRangeError: Maximum call stack size exceeded\r\nOccurred while linting <removed>/oaf-project/oaf-react-final-form/src/validation/index.ts:125\r\n    at <removed>/node_modules/@typescript-eslint/eslint-plugin/dist/util/isTypeReadonly.js:109:66\r\n    at Array.every (<anonymous>)\r\n    at isTypeReadonlyRecurser (<removed>/node_modules/@typescript-eslint/eslint-plugin/dist/util/isTypeReadonly.js:109:55)\r\n    at <removed>/node_modules/@typescript-eslint/eslint-plugin/dist/util/isTypeReadonly.js:36:43\r\n    at Array.some (<anonymous>)\r\n    at checkTypeArguments (<removed>/node_modules/@typescript-eslint/eslint-plugin/dist/util/isTypeReadonly.js:36:27)\r\n    at isTypeReadonlyArrayOrTuple (<removed>/node_modules/@typescript-eslint/eslint-plugin/dist/util/isTypeReadonly.js:48:16)\r\n    at isTypeReadonlyRecurser (<removed>/node_modules/@typescript-eslint/eslint-plugin/dist/util/isTypeReadonly.js:123:29)\r\n    at <removed>/node_modules/@typescript-eslint/eslint-plugin/dist/util/isTypeReadonly.js:109:66\r\n    at Array.every (<anonymous>)\r\n\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n    <summary>Rule is using utilities and third party helpers</summary>\r\n\r\n```\r\nTypeError: Cannot read property 'flags' of undefined\r\nOccurred while linting /<removed>/querycap/webappkit/@querycap/reactutils/must.tsx:7\r\n    at Object.isUnionType (/<removed>/tsutils/typeguard/2.8/type.js:69:18)\r\n    at unionTypeParts (/<removed>/tsutils/util/type.js:92:19)\r\n    at isPropertyReadonlyInType (/<removed>/tsutils/util/type.js:151:21)\r\n    at isReadonlyPropertyFromMappedType (/<removed>/tsutils/util/type.js:197:12)\r\n    at /<removed>/tsutils/util/type.js:179:21\r\n    at someTypePart (/<removed>/tsutils/util/type.js:100:52)\r\n    at isReadonlyPropertyIntersection (/<removed>/tsutils/util/type.js:172:12)\r\n    at Object.isPropertyReadonlyInType (/<removed>/tsutils/util/type.js:161:43)\r\n    at isTypeReadonlyObject (/<removed>/@typescript-eslint/eslint-plugin/dist/util/isTypeReadonly.js:72:28)\r\n    at isTypeReadonlyRecurser (/<removed>/@typescript-eslint/eslint-plugin/dist/util/isTypeReadonly.js:127:30)\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n    <summary>Not sure what's going on here</summary>\r\n\r\n```\r\nTypeError: Cannot destructure property `object` of 'undefined' or 'null'.\r\nOccurred while linting <text>:21\r\n    at CallExpression[callee.property.name=/toBe(Truthy|Falsy)?|toEqual/][callee.object.callee.name='expect'] (/<removed>/ci/node_modules/eslint-plugin-jest-dom/dist/createBannedAttributeRule.js:34:21)\r\n    at /<removed>/node_modules/eslint/lib/linter/safe-emitter.js:45:58\r\n    at Array.forEach (<anonymous>)\r\n    at Object.emit (/<removed>/node_modules/eslint/lib/linter/safe-emitter.js:45:38)\r\n    at NodeEventGenerator.applySelector (/<removed>/node_modules/eslint/lib/linter/node-event-generator.js:254:26)\r\n    at NodeEventGenerator.applySelectors (/<removed>/node_modules/eslint/lib/linter/node-event-generator.js:283:22)\r\n    at NodeEventGenerator.enterNode (/<removed>/node_modules/eslint/lib/linter/node-event-generator.js:297:14)\r\n    at CodePathAnalyzer.enterNode (/<removed>/node_modules/eslint/lib/linter/code-path-analysis/code-path-analyzer.js:711:23)\r\n    at /<removed>/node_modules/eslint/lib/linter/linter.js:952:32\r\n    at Array.forEach (<anonymous>)\r\n```\r\n\r\n</details>\r\n\r\n\r\n### What do you think is the correct solution?\r\n\r\nESLint should include the erroneous rule id in the error logs.\r\n\r\nExample of ideal error log. Line 7 is added by this feature. Line numbers are only for demo purpose here.\r\n\r\n```\r\n 1 | Oops! Something went wrong! :(\r\n 2 |\r\n 3 | ESLint: 8.0.0-beta.1\r\n 4 |\r\n 5 | TypeError: Cannot read property 'flags' of undefined\r\n 6 | Occurred while linting /<removed>/querycap/webappkit/@querycap/reactutils/must.tsx:7\r\n 7 | Rule: \"some-plugin/some-rule\"\r\n 8 |     at Object.isUnionType (/<removed>/tsutils/typeguard/2.8/type.js:69:18)\r\n 9 |     at unionTypeParts (/<removed>/tsutils/util/type.js:92:19)\r\n10 |     at isPropertyReadonlyInType (/<removed>/tsutils/util/type.js:151:21)\r\n11 |     at isReadonlyPropertyFromMappedType (/<removed>/tsutils/util/type.js:197:12)\r\n12 |     at /<removed>/tsutils/util/type.js:179:21\r\n13 |     at someTypePart (/<removed>/tsutils/util/type.js:100:52)\r\n14 |     at isReadonlyPropertyIntersection (/<removed>/tsutils/util/type.js:172:12)\r\n15 |     at Object.isPropertyReadonlyInType (/<removed>/tsutils/util/type.js:161:43)\r\n16 |     at isTypeReadonlyObject (/<removed>/@typescript-eslint/eslint-plugin/dist/util/isTypeReadonly.js:72:28)\r\n17 |     at isTypeReadonlyRecurser (/<removed>/@typescript-eslint/eslint-plugin/dist/util/isTypeReadonly.js:127:30)\r\n```\r\n\r\nI have required changes ready for this feature. I'll setup PR if this gets accepted.\r\n\r\n### Participation\r\n\r\n- [X] I am willing to submit a pull request for this change.","closed_by":{"login":"nzakas","id":38546,"node_id":"MDQ6VXNlcjM4NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/38546?v=4","gravatar_id":"","url":"https://api.github.com/users/nzakas","html_url":"https://github.com/nzakas","followers_url":"https://api.github.com/users/nzakas/followers","following_url":"https://api.github.com/users/nzakas/following{/other_user}","gists_url":"https://api.github.com/users/nzakas/gists{/gist_id}","starred_url":"https://api.github.com/users/nzakas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nzakas/subscriptions","organizations_url":"https://api.github.com/users/nzakas/orgs","repos_url":"https://api.github.com/users/nzakas/repos","events_url":"https://api.github.com/users/nzakas/events{/privacy}","received_events_url":"https://api.github.com/users/nzakas/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eslint/eslint/issues/15037/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eslint/eslint/issues/15037/timeline","performed_via_github_app":null,"state_reason":"completed"}