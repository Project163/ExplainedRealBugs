{"url":"https://api.github.com/repos/eslint/eslint/issues/9249","repository_url":"https://api.github.com/repos/eslint/eslint","labels_url":"https://api.github.com/repos/eslint/eslint/issues/9249/labels{/name}","comments_url":"https://api.github.com/repos/eslint/eslint/issues/9249/comments","events_url":"https://api.github.com/repos/eslint/eslint/issues/9249/events","html_url":"https://github.com/eslint/eslint/issues/9249","id":255797799,"node_id":"MDU6SXNzdWUyNTU3OTc3OTk=","number":9249,"title":"Add CLI option to report unused eslint-disable directives","user":{"login":"not-an-aardvark","id":11638619,"node_id":"MDQ6VXNlcjExNjM4NjE5","avatar_url":"https://avatars.githubusercontent.com/u/11638619?v=4","gravatar_id":"","url":"https://api.github.com/users/not-an-aardvark","html_url":"https://github.com/not-an-aardvark","followers_url":"https://api.github.com/users/not-an-aardvark/followers","following_url":"https://api.github.com/users/not-an-aardvark/following{/other_user}","gists_url":"https://api.github.com/users/not-an-aardvark/gists{/gist_id}","starred_url":"https://api.github.com/users/not-an-aardvark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/not-an-aardvark/subscriptions","organizations_url":"https://api.github.com/users/not-an-aardvark/orgs","repos_url":"https://api.github.com/users/not-an-aardvark/repos","events_url":"https://api.github.com/users/not-an-aardvark/events{/privacy}","received_events_url":"https://api.github.com/users/not-an-aardvark/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":45711352,"node_id":"MDU6TGFiZWw0NTcxMTM1Mg==","url":"https://api.github.com/repos/eslint/eslint/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":"This change enhances an existing feature of ESLint"},{"id":82922548,"node_id":"MDU6TGFiZWw4MjkyMjU0OA==","url":"https://api.github.com/repos/eslint/eslint/labels/core","name":"core","color":"c7def8","default":false,"description":"Relates to ESLint's core APIs and features"},{"id":131106229,"node_id":"MDU6TGFiZWwxMzExMDYyMjk=","url":"https://api.github.com/repos/eslint/eslint/labels/accepted","name":"accepted","color":"0052cc","default":false,"description":"There is consensus among the team that this change meets the criteria for inclusion"},{"id":829215248,"node_id":"MDU6TGFiZWw4MjkyMTUyNDg=","url":"https://api.github.com/repos/eslint/eslint/labels/archived%20due%20to%20age","name":"archived due to age","color":"eeeeee","default":false,"description":"This issue has been archived; please open a new issue for any further discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2017-09-07T02:40:58Z","updated_at":"2018-03-29T19:20:06Z","closed_at":"2017-09-29T19:53:01Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"(Repost of https://github.com/eslint/eslint/issues/6190)\r\n\r\n`/* eslint-disable */` comments are useful to document when code is an exception to a given rule. If a piece of code was previously an exception, but now the rule is no longer being violated, it's useful to remove the comment so that it doesn't hide unintended problems in the future. Unfortunately, ESLint doesn't provide any way to detect unused comments, and it's not possible to do this with a custom rule using the public rule API because rules can't view the configurations of other rules to determine whether a directive is used.\r\n\r\nWhen this was discussed in https://github.com/eslint/eslint/issues/6190, there was consensus that if a behavior like this was added to core, it would have to be implemented as a CLI flag. The TSC [decided](https://github.com/eslint/tsc-meetings/blob/00824ca375f62abd5d98931a2fecc80cae811964/notes/2016/2016-07-07.md#httpsgithubcomeslinteslintissues6190) to wait for a prototype before determining whether to accept the feature. A few months later, the issue was closed because [`eslint-plugin-eslint-comments`](https://github.com/mysticatea/eslint-plugin-eslint-comments) was released, which achieves the same behavior in a plugin by monkeypatching ESLint's APIs.\r\n\r\nI'd like to reopen discussion on this because I think this would still be a useful feature, and I don't think using a plugin that monkeypatches core APIs is an acceptable solution in the long term, given that it breaks down the boundaries that we enforce between rules.\r\n\r\n(Case in point: We recently refactored the `context.report` internals, causing `eslint-plugin-eslint-comments` to break because it was trying to monkeypatch an API that no longer existed (https://github.com/eslint/eslint/issues/9193). We ended up adding [this](https://github.com/eslint/eslint/blob/82d8b734acd44b0c320d0ab24ce3dff92120d735/lib/linter.js#L799-L810) and [this](https://github.com/eslint/eslint/blob/82d8b734acd44b0c320d0ab24ce3dff92120d735/lib/linter.js#L853-L869) to prevent the monkeypatches in `eslint-plugin-eslint-comments` from breaking, but those are hacks and I'd like to get rid of them.)\r\n\r\nThe proposal is to add a `--report-unused-disable-directives` CLI flag (along with corresponding `reportUnusedDisableDirectives` options in `CLIEngine` and `Linter`). When the flag is enabled, ESLint adds a new reported problem with error severity when it encounters an unused `eslint-disable` comment (or variants like `eslint-disable-line`).\r\n\r\n---\r\n\r\nI've created a prototype implementation (#9250). The implementation is actually fairly simple -- most of the diff in the PR comes from additional tests, docs, and passthrough options.\r\n\r\nThere are a few edge cases to consider -- I've written a bit about them below.\r\n\r\n<details>\r\n<summary>Edge cases</summary>\r\n\r\nDefinitions:\r\n\r\n* \"unused directive\": A directive that would prevent errors from being reported, but no errors were actually reported, so it didn't suppress anything.\r\n* \"redundant directive\": A directive that has no effect because the list of disabled rules is the same before and after applying it.\r\n\r\nUnused directives would need to be detected in core, since they depend on whether other rules report errors. Redundant directives could be detected by external rules (although they would sometimes have to use strange report locations to prevent their own reports from being suppressed).  Because of this, I decided that the flag should only cause unused directives to be reported. Redundant directives are not reported unless they are also unused.\r\n\r\nExamples:\r\n\r\n1. First comment is unused, second comment is unused and redundant\r\n\r\n    ```js\r\n    /* eslint-disable */\r\n    /* eslint-disable */\r\n    ```\r\n\r\n1. First comment is unused, second comment is redundant\r\n\r\n    ```js\r\n    /* eslint-disable */\r\n    /* eslint-disable */\r\n    (reported problem)\r\n    ```\r\n\r\n1. First comment is unused\r\n\r\n    ```js\r\n    /* eslint-disable foo */\r\n    /* eslint-disable */\r\n    (reported problem from foo)\r\n    ```\r\n\r\n1. First comment is unused\r\n\r\n    ```js\r\n    /* eslint-disable foo */\r\n    /* eslint-disable */\r\n    (reported problem from an unrelated rule)\r\n    ```\r\n\r\n1. First comment is unused, second comment is redundant\r\n\r\n    ```js\r\n    /* eslint-disable */\r\n    /* eslint-disable foo */\r\n    (reported problem from foo)\r\n    ```\r\n\r\n1. Second comment is redundant and unused\r\n\r\n    ```js\r\n    /* eslint-disable */\r\n    /* eslint-disable foo */\r\n    (reported problem from an unrelated rule)\r\n    ```\r\n\r\n1. First comment is unused, second comment is redundant and unused\r\n\r\n    ```js\r\n    /* eslint-disable */\r\n    /* eslint-disable foo */\r\n    /* eslint-enable foo */\r\n    (reported problem from foo)\r\n    ```\r\n\r\n1. Comment is redundant\r\n\r\n    ```js\r\n    /* eslint-enable */\r\n    ```\r\n</details>","closed_by":{"login":"kaicataldo","id":7041728,"node_id":"MDQ6VXNlcjcwNDE3Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/7041728?v=4","gravatar_id":"","url":"https://api.github.com/users/kaicataldo","html_url":"https://github.com/kaicataldo","followers_url":"https://api.github.com/users/kaicataldo/followers","following_url":"https://api.github.com/users/kaicataldo/following{/other_user}","gists_url":"https://api.github.com/users/kaicataldo/gists{/gist_id}","starred_url":"https://api.github.com/users/kaicataldo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaicataldo/subscriptions","organizations_url":"https://api.github.com/users/kaicataldo/orgs","repos_url":"https://api.github.com/users/kaicataldo/repos","events_url":"https://api.github.com/users/kaicataldo/events{/privacy}","received_events_url":"https://api.github.com/users/kaicataldo/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eslint/eslint/issues/9249/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eslint/eslint/issues/9249/timeline","performed_via_github_app":null,"state_reason":"completed"}