{"url":"https://api.github.com/repos/eslint/eslint/issues/12986","repository_url":"https://api.github.com/repos/eslint/eslint","labels_url":"https://api.github.com/repos/eslint/eslint/issues/12986/labels{/name}","comments_url":"https://api.github.com/repos/eslint/eslint/issues/12986/comments","events_url":"https://api.github.com/repos/eslint/eslint/issues/12986/events","html_url":"https://github.com/eslint/eslint/issues/12986","id":573426997,"node_id":"MDU6SXNzdWU1NzM0MjY5OTc=","number":12986,"title":"no-use-before-define needs exception option for arrow function definitions present in common code patterns","user":{"login":"ildarmgt","id":35236406,"node_id":"MDQ6VXNlcjM1MjM2NDA2","avatar_url":"https://avatars.githubusercontent.com/u/35236406?v=4","gravatar_id":"","url":"https://api.github.com/users/ildarmgt","html_url":"https://github.com/ildarmgt","followers_url":"https://api.github.com/users/ildarmgt/followers","following_url":"https://api.github.com/users/ildarmgt/following{/other_user}","gists_url":"https://api.github.com/users/ildarmgt/gists{/gist_id}","starred_url":"https://api.github.com/users/ildarmgt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ildarmgt/subscriptions","organizations_url":"https://api.github.com/users/ildarmgt/orgs","repos_url":"https://api.github.com/users/ildarmgt/repos","events_url":"https://api.github.com/users/ildarmgt/events{/privacy}","received_events_url":"https://api.github.com/users/ildarmgt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":45798639,"node_id":"MDU6TGFiZWw0NTc5ODYzOQ==","url":"https://api.github.com/repos/eslint/eslint/labels/rule","name":"rule","color":"fbca04","default":false,"description":"Relates to ESLint's core rules"},{"id":64004798,"node_id":"MDU6TGFiZWw2NDAwNDc5OA==","url":"https://api.github.com/repos/eslint/eslint/labels/documentation","name":"documentation","color":"5319e7","default":true,"description":"Relates to ESLint's documentation"},{"id":131106229,"node_id":"MDU6TGFiZWwxMzExMDYyMjk=","url":"https://api.github.com/repos/eslint/eslint/labels/accepted","name":"accepted","color":"0052cc","default":false,"description":"There is consensus among the team that this change meets the criteria for inclusion"},{"id":829215248,"node_id":"MDU6TGFiZWw4MjkyMTUyNDg=","url":"https://api.github.com/repos/eslint/eslint/labels/archived%20due%20to%20age","name":"archived due to age","color":"eeeeee","default":false,"description":"This issue has been archived; please open a new issue for any further discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2020-02-29T23:02:18Z","updated_at":"2020-09-21T00:29:31Z","closed_at":"2020-03-23T23:27:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**What rule do you want to change?**\r\n\r\nno-use-before-define\r\n\r\n**Does this change cause the rule to produce more or fewer warnings?**\r\n\r\nFor those using new exception, same or fewer\r\n\r\n**How will the change be implemented? (New option, new default behavior, etc.)?**\r\n\r\nNew option to ignore rule for arrow functions\r\n\r\n**Please provide some example code that this change will affect:**\r\n\r\n<!-- Put your code examples here -->\r\n```js\r\n// typical React type module or large helper library\r\n// with many functions using each other in definitions but not evaluated\r\n// until parsed when exported functions get imported and afterwards executed\r\n\r\n// most important functions first like react components or main interfaces\r\nexport const Main = () => {\r\n  const renderMath = getC(getB(getA()))\r\n  return renderMath\r\n}\r\n\r\n// 100s of interconnected helpers, not easy to order\r\nexport const getA = (v = 0) => getB() + getC(v)\r\nconst getB = (v) => v || 3\r\nconst getC = (v) => v || getA(1)\r\n\r\n// here or after export/import\r\ndocument.body.innerHTML = Main()\r\n\r\n```\r\nhttps://codesandbox.io/s/nervous-pond-7x5xo\r\n\r\n**What does the rule currently do for this code?**\r\n\r\nTreats unevaluated arrow functions same as evaluated variables. [eslint.org/demo...](https://eslint.org/demo#eyJ0ZXh0IjoiZXhwb3J0IGNvbnN0IE1haW4gPSAoKSA9PiB7XG4gIGNvbnN0IHJlbmRlck1hdGggPSBnZXRDKGdldEIoZ2V0QSgpKSlcbiAgcmV0dXJuIHJlbmRlck1hdGhcbn1cblxuLy8gMTAwcyBvZiBpbnRlcmNvbm5lY3RlZCBoZWxwZXJzXG5leHBvcnQgY29uc3QgZ2V0QSA9ICh2ID0gMCkgPT4gZ2V0QigpICsgZ2V0Qyh2KVxuY29uc3QgZ2V0QiA9ICh2KSA9PiB2IHx8IDNcbmNvbnN0IGdldEMgPSAodikgPT4gdiB8fCBnZXRBKDEpXG5cbmRvY3VtZW50LmJvZHkuaW5uZXJIVE1MID0gTWFpbigpXG4iLCJvcHRpb25zIjp7InBhcnNlck9wdGlvbnMiOnsiZWNtYVZlcnNpb24iOjcsInNvdXJjZVR5cGUiOiJtb2R1bGUiLCJlY21hRmVhdHVyZXMiOnt9fSwicnVsZXMiOnsibm8tdXNlLWJlZm9yZS1kZWZpbmUiOjIsIm5vLXVuZGVmIjoyfSwiZW52Ijp7ImJyb3dzZXIiOnRydWV9fX0=)\r\n\r\nWhile reasons given are to protect from getting value from undefined variables, they prevent forming connections in the prototyping declaration design phase before any instances are created while intending to aid with evaluation of instances.\r\n\r\nDescription of [no-use-before-define](https://eslint.org/docs/rules/no-use-before-define) suggests `ReferenceError will be thrown with any attempt to access the variable` which is not the case for variables that are not evaluated when they or the block scope they are in is not called to be evaluated. The rule also discusses use prior to es6 as risk, but hoisted functions are almost never used, es6 arrows are the standard, and importing a multiple pre-declared functions from same location (equivalent to declaring definitions before evaluation) is extremely common. Rule provides optional exceptions for classes and functions which helped transition, but not for arrow functions. Classes, in fact, have exception option despite not being hoisted, but arrow functions do not in a way that doesn't overlap with actual variables. React, for example, is almost entirely es6 functional now and depends heavily on declarations.\r\n\r\nIt prevents using modern es6 syntax where functions are declared using each other, forcing often impossible sorting. It also forces the least important functions to the top. Many projects have completely switched to es6 syntax for consistency, refuse to use old function syntax & its *this* scope. So they do not have any option in es-lint to keep definition checks for variables easily without refactoring working code and risking circular dependencies or breaking syntax consistency. \r\n\r\nThis syntax is extremely common today in mass exporting modules where many individual functions are named exports and another file imports via `import { a, b, c, d } from './somelibrary' that might reference each other's definitions when they shared scope in declaration file, only evaluating/executing long after all definitions are parsed on import. Similarly when reading React modules, reader should have an option not to have to scroll through hundreds of small irrelevant helper function declarations not worth separating into 100s of individual modules to find to main component declaration. Helpers might be as simple as getters, setters, wrappers, styling using each other in prototypes. The old function(){} or class formats and designs are being abandoned in favor of functional code and pure arrow functions so old exclusions for classes and classic functions are not helpful.\r\n\r\nThis is not an edge case of only recursive functions but connections between modules in general. This is for scope of all function declarations, and not just let/const, including within anon params or objects `{ t : () => getT(), getT }`. Anon arrow function declarations are often used specifically to NOT evaluate inaccessible items at declaration time until ready .\r\n\r\nWe have to choose to either :\r\n\r\n1. Turn off the most important linter rule of checking declarations for all variables that actually do create errors because they are evaluated at same time as declared. \r\n\r\n2. Have to abandon modern syntax for arbitrary functions, change *this* in their scope, make them harder to find by regex shape. For short anon function callbacks have to switch to much wordier notation.\r\n\r\nAnother argument is that eslint isn't supposed to fix users js, only let people follow some standards, but without this exception, it can break pretty standard use of arrow functions, and there's no easy rule for common patterns that both watches actual variable declarations (most typical helpful lint warning) and allows common and popular functional syntax.\r\n\r\n**What will the rule do after it's changed?**\r\n\r\nNo changes, just new option to add to [very similar existing ones](https://eslint.org/docs/rules/no-use-before-define#options):\r\n\r\nSimple solution: new option to avoid triggering warning/error for arrow functions. For example:  `arrowFunctions: boolean` as new option. That's what it did for similar non-hoisted classes & variables. Should have same for functions, which are now arrow functions. Will be enough for me.\r\n\r\n**Are you willing to submit a pull request to implement this change?**\r\n\r\nNot at the moment as unfamiliar with code base\r\n\r\nThank you!","closed_by":{"login":"kaicataldo","id":7041728,"node_id":"MDQ6VXNlcjcwNDE3Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/7041728?v=4","gravatar_id":"","url":"https://api.github.com/users/kaicataldo","html_url":"https://github.com/kaicataldo","followers_url":"https://api.github.com/users/kaicataldo/followers","following_url":"https://api.github.com/users/kaicataldo/following{/other_user}","gists_url":"https://api.github.com/users/kaicataldo/gists{/gist_id}","starred_url":"https://api.github.com/users/kaicataldo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaicataldo/subscriptions","organizations_url":"https://api.github.com/users/kaicataldo/orgs","repos_url":"https://api.github.com/users/kaicataldo/repos","events_url":"https://api.github.com/users/kaicataldo/events{/privacy}","received_events_url":"https://api.github.com/users/kaicataldo/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eslint/eslint/issues/12986/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eslint/eslint/issues/12986/timeline","performed_via_github_app":null,"state_reason":"completed"}