{"url":"https://api.github.com/repos/eslint/eslint/issues/17345","repository_url":"https://api.github.com/repos/eslint/eslint","labels_url":"https://api.github.com/repos/eslint/eslint/issues/17345/labels{/name}","comments_url":"https://api.github.com/repos/eslint/eslint/issues/17345/comments","events_url":"https://api.github.com/repos/eslint/eslint/issues/17345/events","html_url":"https://github.com/eslint/eslint/issues/17345","id":1790370934,"node_id":"I_kwDOAKjKDc5qtuR2","number":17345,"title":"Rule Change: return await is both faster and allows better error handling","user":{"login":"clshortfuse","id":9271155,"node_id":"MDQ6VXNlcjkyNzExNTU=","avatar_url":"https://avatars.githubusercontent.com/u/9271155?v=4","gravatar_id":"","url":"https://api.github.com/users/clshortfuse","html_url":"https://github.com/clshortfuse","followers_url":"https://api.github.com/users/clshortfuse/followers","following_url":"https://api.github.com/users/clshortfuse/following{/other_user}","gists_url":"https://api.github.com/users/clshortfuse/gists{/gist_id}","starred_url":"https://api.github.com/users/clshortfuse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clshortfuse/subscriptions","organizations_url":"https://api.github.com/users/clshortfuse/orgs","repos_url":"https://api.github.com/users/clshortfuse/repos","events_url":"https://api.github.com/users/clshortfuse/events{/privacy}","received_events_url":"https://api.github.com/users/clshortfuse/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":45711352,"node_id":"MDU6TGFiZWw0NTcxMTM1Mg==","url":"https://api.github.com/repos/eslint/eslint/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":"This change enhances an existing feature of ESLint"},{"id":45798639,"node_id":"MDU6TGFiZWw0NTc5ODYzOQ==","url":"https://api.github.com/repos/eslint/eslint/labels/rule","name":"rule","color":"fbca04","default":false,"description":"Relates to ESLint's core rules"},{"id":64004798,"node_id":"MDU6TGFiZWw2NDAwNDc5OA==","url":"https://api.github.com/repos/eslint/eslint/labels/documentation","name":"documentation","color":"5319e7","default":true,"description":"Relates to ESLint's documentation"},{"id":131106229,"node_id":"MDU6TGFiZWwxMzExMDYyMjk=","url":"https://api.github.com/repos/eslint/eslint/labels/accepted","name":"accepted","color":"0052cc","default":false,"description":"There is consensus among the team that this change meets the criteria for inclusion"},{"id":829215248,"node_id":"MDU6TGFiZWw4MjkyMTUyNDg=","url":"https://api.github.com/repos/eslint/eslint/labels/archived%20due%20to%20age","name":"archived due to age","color":"eeeeee","default":false,"description":"This issue has been archived; please open a new issue for any further discussion"}],"state":"closed","locked":true,"assignee":{"login":"clshortfuse","id":9271155,"node_id":"MDQ6VXNlcjkyNzExNTU=","avatar_url":"https://avatars.githubusercontent.com/u/9271155?v=4","gravatar_id":"","url":"https://api.github.com/users/clshortfuse","html_url":"https://github.com/clshortfuse","followers_url":"https://api.github.com/users/clshortfuse/followers","following_url":"https://api.github.com/users/clshortfuse/following{/other_user}","gists_url":"https://api.github.com/users/clshortfuse/gists{/gist_id}","starred_url":"https://api.github.com/users/clshortfuse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clshortfuse/subscriptions","organizations_url":"https://api.github.com/users/clshortfuse/orgs","repos_url":"https://api.github.com/users/clshortfuse/repos","events_url":"https://api.github.com/users/clshortfuse/events{/privacy}","received_events_url":"https://api.github.com/users/clshortfuse/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"clshortfuse","id":9271155,"node_id":"MDQ6VXNlcjkyNzExNTU=","avatar_url":"https://avatars.githubusercontent.com/u/9271155?v=4","gravatar_id":"","url":"https://api.github.com/users/clshortfuse","html_url":"https://github.com/clshortfuse","followers_url":"https://api.github.com/users/clshortfuse/followers","following_url":"https://api.github.com/users/clshortfuse/following{/other_user}","gists_url":"https://api.github.com/users/clshortfuse/gists{/gist_id}","starred_url":"https://api.github.com/users/clshortfuse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clshortfuse/subscriptions","organizations_url":"https://api.github.com/users/clshortfuse/orgs","repos_url":"https://api.github.com/users/clshortfuse/repos","events_url":"https://api.github.com/users/clshortfuse/events{/privacy}","received_events_url":"https://api.github.com/users/clshortfuse/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":15,"created_at":"2023-07-05T21:30:05Z","updated_at":"2024-01-23T15:03:09Z","closed_at":"2023-07-26T15:48:23Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What rule do you want to change?\n\nno-return-await\n\n### What change to do you want to make?\n\nGenerate fewer warnings\n\n### How do you think the change should be implemented?\n\nA new default behavior\n\n### Example code\n\n```js\nasync function do(url) {\r\n  return await fetch(url);\r\n}\n```\n\n\n### What does the rule currently do for this code?\n\nEslint will say to remove `await` with the docs saying:\r\n\r\n\r\n\n\n### What will the rule do after it's changed?\n\nSuggest `return await`. (Or at least not misinform authors).\n\n### Participation\n\n- [X] I am willing to submit a pull request to implement this change.\n\n### Additional comments\n\nThe docs state:\r\n\r\n>You can avoid the extra microtask by not awaiting the return value, with the trade off of the function no longer being a part of the stack trace if an error is thrown asynchronously from the Promise being returned. This can make debugging more difficult.\r\n\r\nThis is actually false and if that is the reasoning then it should be changed. I have a long explanation of the mechanics as to why `return await` is faster at [this Stackoverflow comment](https://stackoverflow.com/questions/43353087/are-there-performance-concerns-with-return-await/70979225#70979225) but to keep this brief, you can run this:\r\n\r\n````js\r\nasync function test(name, fn) {\r\n  let tick = 0;\r\n  const tock = () => tick++;\r\n  Promise.resolve().then(tock).then(tock).then(tock);\r\n\r\n  const p = await fn();\r\n  console.assert(p === 42);\r\n  console.log(name, tick);\r\n}\r\n\r\nawait Promise.all([\r\n  test('nonpromise-sync', () => 42),\r\n  test('nonpromise-async', async () => 42),\r\n  test('nonpromise-async-await', async () => await 42),\r\n  test('promise-sync', () => Promise.resolve(42)),\r\n  test('promise-async', async () => Promise.resolve(42)),\r\n  test('promise-async-await', async () => await Promise.resolve(42)),\r\n]);\r\n\r\nsetTimeout(() => {}, 100);\r\n````\r\n\r\nAnd you'll see that returning a Promise (not using return await) is the slowest method.\r\n\r\nThere is also an added benefit (maybe) that execution (resolving) happens within the function itself, so you can catch errors. If you try to add a catch to a returning Promise, it'll never fire. \r\n\r\n````js\r\nfunction errorThrower () {\r\n  return Promise.reject('fail');\r\n}\r\nfunction returnNoAwait() {\r\n try {\r\n     return errorThrower();\r\n } catch {\r\n   console.log('I want to catch, but I am never executed');\r\n }\r\n} \r\nasync function returnAwait() {\r\n  try {\r\n      return await errorThrower();\r\n  } catch(e) {\r\n    console.log('I caught an error. I still have e, so I can rethrow.');\r\n  }\r\n}\r\nawait returnAwait();\r\nawait returnNoAwait();\r\n````\r\n\r\nYields:\r\n\r\n>`I caught an error. I still have e, so I can rethrow.`\r\n>`Uncaught fail`\r\n\r\nAnd note that uncaught fail *will* crash some environments.\r\n\r\n\r\n\r\n","closed_by":{"login":"nzakas","id":38546,"node_id":"MDQ6VXNlcjM4NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/38546?v=4","gravatar_id":"","url":"https://api.github.com/users/nzakas","html_url":"https://github.com/nzakas","followers_url":"https://api.github.com/users/nzakas/followers","following_url":"https://api.github.com/users/nzakas/following{/other_user}","gists_url":"https://api.github.com/users/nzakas/gists{/gist_id}","starred_url":"https://api.github.com/users/nzakas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nzakas/subscriptions","organizations_url":"https://api.github.com/users/nzakas/orgs","repos_url":"https://api.github.com/users/nzakas/repos","events_url":"https://api.github.com/users/nzakas/events{/privacy}","received_events_url":"https://api.github.com/users/nzakas/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eslint/eslint/issues/17345/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eslint/eslint/issues/17345/timeline","performed_via_github_app":null,"state_reason":"completed"}