{"url":"https://api.github.com/repos/eslint/eslint/issues/12926","repository_url":"https://api.github.com/repos/eslint/eslint","labels_url":"https://api.github.com/repos/eslint/eslint/issues/12926/labels{/name}","comments_url":"https://api.github.com/repos/eslint/eslint/issues/12926/comments","events_url":"https://api.github.com/repos/eslint/eslint/issues/12926/events","html_url":"https://github.com/eslint/eslint/issues/12926","id":565959509,"node_id":"MDU6SXNzdWU1NjU5NTk1MDk=","number":12926,"title":"no-restricted-modules and TemplateLiteral","user":{"login":"pieh","id":419821,"node_id":"MDQ6VXNlcjQxOTgyMQ==","avatar_url":"https://avatars.githubusercontent.com/u/419821?v=4","gravatar_id":"","url":"https://api.github.com/users/pieh","html_url":"https://github.com/pieh","followers_url":"https://api.github.com/users/pieh/followers","following_url":"https://api.github.com/users/pieh/following{/other_user}","gists_url":"https://api.github.com/users/pieh/gists{/gist_id}","starred_url":"https://api.github.com/users/pieh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pieh/subscriptions","organizations_url":"https://api.github.com/users/pieh/orgs","repos_url":"https://api.github.com/users/pieh/repos","events_url":"https://api.github.com/users/pieh/events{/privacy}","received_events_url":"https://api.github.com/users/pieh/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":45711350,"node_id":"MDU6TGFiZWw0NTcxMTM1MA==","url":"https://api.github.com/repos/eslint/eslint/labels/bug","name":"bug","color":"fc2929","default":true,"description":"ESLint is working incorrectly"},{"id":45798639,"node_id":"MDU6TGFiZWw0NTc5ODYzOQ==","url":"https://api.github.com/repos/eslint/eslint/labels/rule","name":"rule","color":"fbca04","default":false,"description":"Relates to ESLint's core rules"},{"id":131106229,"node_id":"MDU6TGFiZWwxMzExMDYyMjk=","url":"https://api.github.com/repos/eslint/eslint/labels/accepted","name":"accepted","color":"0052cc","default":false,"description":"There is consensus among the team that this change meets the criteria for inclusion"},{"id":829215248,"node_id":"MDU6TGFiZWw4MjkyMTUyNDg=","url":"https://api.github.com/repos/eslint/eslint/labels/archived%20due%20to%20age","name":"archived due to age","color":"eeeeee","default":false,"description":"This issue has been archived; please open a new issue for any further discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-02-16T19:54:29Z","updated_at":"2020-08-28T00:29:31Z","closed_at":"2020-02-28T20:51:31Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n    ESLint adheres to the [JS Foundation Code of Conduct](https://js.foundation/community/code-of-conduct).\r\n\r\n    This template is for bug reports. If you are here for another reason, please see below:\r\n\r\n    1. To propose a new rule: https://eslint.org/docs/developer-guide/contributing/new-rules\r\n    2. To request a rule change: https://eslint.org/docs/developer-guide/contributing/rule-changes\r\n    3. To request a change that is not a bug fix, rule change, or new rule: https://eslint.org/docs/developer-guide/contributing/changes\r\n    4. If you have any questions, please stop by our chatroom: https://gitter.im/eslint/eslint\r\n\r\n    Note that leaving sections blank will make it difficult for us to troubleshoot and we may have to close the issue.\r\n-->\r\n\r\n**Tell us about your environment**\r\n\r\n<!--\r\n    If you are using ESLint v6.5.0 or later, you can run ESLint with the `--env-info` flag and paste the output here.\r\n-->\r\n\r\n* **ESLint Version:** `5.16.0` (in production), but issue exist also in `6.8.0`\r\n* **Node Version:** `10.16.3`\r\n* **npm Version:** `6.13.4`\r\n\r\n**What parser (default, Babel-ESLint, etc.) are you using?**\r\n\r\n`babel-eslint`\r\n\r\n**Please show your full configuration:**\r\n\r\n<details>\r\n<summary>Configuration</summary>\r\n\r\nPasted full config below - but relevant part is in overrides configuration for `packages/gatsby-cli/src/**/*.js`\r\n\r\n<!-- Paste your configuration below: -->\r\n```js\r\nconst TSEslint = require(\"@typescript-eslint/eslint-plugin\")\r\n\r\nconst gatsbyCLILocalReactImportPath = `packages/gatsby-cli/src/reporter/loggers/ink/react-instance-used-by-ink`\r\n\r\nmodule.exports = {\r\n  parser: \"babel-eslint\",\r\n  extends: [\r\n    \"google\",\r\n    \"eslint:recommended\",\r\n    \"plugin:flowtype/recommended\",\r\n    \"plugin:react/recommended\",\r\n    \"prettier\",\r\n    \"prettier/flowtype\",\r\n    \"prettier/react\",\r\n  ],\r\n  plugins: [\"flowtype\", \"prettier\", \"react\", \"filenames\"],\r\n  parserOptions: {\r\n    ecmaVersion: 2016,\r\n    sourceType: \"module\",\r\n    ecmaFeatures: {\r\n      jsx: true,\r\n    },\r\n  },\r\n  env: {\r\n    browser: true,\r\n    es6: true,\r\n    node: true,\r\n    jest: true,\r\n  },\r\n  globals: {\r\n    before: true,\r\n    after: true,\r\n    spyOn: true,\r\n    __PATH_PREFIX__: true,\r\n    __BASE_PATH__: true,\r\n    __ASSET_PREFIX__: true,\r\n  },\r\n  rules: {\r\n    \"arrow-body-style\": [\r\n      \"error\",\r\n      \"as-needed\",\r\n      { requireReturnForObjectLiteral: true },\r\n    ],\r\n    \"no-unused-expressions\": [\r\n      \"error\",\r\n      {\r\n        allowTaggedTemplates: true,\r\n      },\r\n    ],\r\n    \"consistent-return\": [\"error\"],\r\n    \"filenames/match-regex\": [\"error\", \"^[a-z-\\\\d\\\\.]+$\", true],\r\n    \"no-console\": \"off\",\r\n    \"no-inner-declarations\": \"off\",\r\n    \"prettier/prettier\": \"error\",\r\n    quotes: [\"error\", \"backtick\"],\r\n    \"react/display-name\": \"off\",\r\n    \"react/jsx-key\": \"warn\",\r\n    \"react/no-unescaped-entities\": \"off\",\r\n    \"react/prop-types\": \"off\",\r\n    \"require-jsdoc\": \"off\",\r\n    \"valid-jsdoc\": \"off\",\r\n  },\r\n  overrides: [\r\n    {\r\n      files: [\r\n        \"packages/**/gatsby-browser.js\",\r\n        \"packages/gatsby/cache-dir/**/*\",\r\n      ],\r\n      env: {\r\n        browser: true,\r\n      },\r\n      globals: {\r\n        ___loader: false,\r\n        ___emitter: false,\r\n      },\r\n    },\r\n    {\r\n      files: [\"**/cypress/integration/**/*\", \"**/cypress/support/**/*\"],\r\n      globals: {\r\n        cy: false,\r\n        Cypress: false,\r\n      },\r\n    },\r\n    {\r\n      files: [\"*.ts\", \"*.tsx\"],\r\n      parser: \"@typescript-eslint/parser\",\r\n      plugins: [\"@typescript-eslint/eslint-plugin\"],\r\n      rules: {\r\n        ...TSEslint.configs.recommended.rules,\r\n        // This rule ensures that typescript types do not have semicolons\r\n        // at the end of their lines, since our prettier setup is to have no semicolons\r\n        // e.g.,\r\n        // interface Foo {\r\n        // -  baz: string;\r\n        // +  baz: string\r\n        // }\r\n        \"@typescript-eslint/member-delimiter-style\": [\r\n          \"error\",\r\n          {\r\n            multiline: {\r\n              delimiter: \"none\",\r\n            },\r\n          },\r\n        ],\r\n        // This ensures all interfaces are named with an I as a prefix\r\n        // e.g.,\r\n        // interface IFoo {}\r\n        \"@typescript-eslint/interface-name-prefix\": [\r\n          \"error\",\r\n          { prefixWithI: \"always\" },\r\n        ],\r\n        \"@typescript-eslint/no-empty-function\": \"off\",\r\n        // This ensures that we always type the return type of functions\r\n        // a high level focus of our TS setup is typing fn inputs and outputs.\r\n        \"@typescript-eslint/explicit-function-return-type\": \"error\",\r\n        // This forces us to use interfaces over types aliases for object defintions.\r\n        // Type is still useful for opaque types\r\n        // e.g.,\r\n        // type UUID = string\r\n        \"@typescript-eslint/consistent-type-definitions\": [\r\n          \"error\",\r\n          \"interface\",\r\n        ],\r\n\r\n        // Allows us to write unions like `type Foo = \"baz\" | \"bar\"`\r\n        // otherwise eslint will want to switch the strings to backticks,\r\n        // which then crashes the ts compiler\r\n        quotes: \"off\",\r\n        \"@typescript-eslint/quotes\": [\r\n          2,\r\n          \"backtick\",\r\n          {\r\n            avoidEscape: true,\r\n          },\r\n        ],\r\n      },\r\n    },\r\n    {\r\n      files: [`packages/gatsby-cli/src/**/*.js`],\r\n      rules: {\r\n        \"no-restricted-imports\": [\r\n          \"error\",\r\n          {\r\n            paths: [\r\n              {\r\n                name: \"react\",\r\n                message: `Please import React from ${gatsbyCLILocalReactImportPath} (using relative local path) instead.`,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n        \"no-restricted-modules\": [\r\n          \"error\",\r\n          {\r\n            paths: [\r\n              {\r\n                name: \"react\",\r\n                message: `Please import React from ${gatsbyCLILocalReactImportPath} (using relative local path) instead.`,\r\n              },\r\n            ],\r\n          },\r\n        ],\r\n      },\r\n    },\r\n  ],\r\n  settings: {\r\n    react: {\r\n      version: \"16.4.2\",\r\n    },\r\n  },\r\n}\r\n\r\n```\r\n\r\n</details>\r\n\r\n**What did you do? Please include the actual source code causing the issue, as well as the command that you used to run ESLint.**\r\n\r\n<!-- Paste the source code below: -->\r\n```js\r\n// notice using TemplateLiteral as argument for `require`\r\n// eslint-disable-next-line no-unused-vars, quotes\r\nconst React = require(`React`)\r\n```\r\n\r\n<!-- Paste the command you used to run ESLint: -->\r\n```bash\r\nyarn eslint packages/gatsby-cli/src/reporter/loggers/ink/test.js\r\n```\r\n\r\n**What did you expect to happen?**\r\n\r\nFor `no-restricted-modules` to raise linting error\r\n\r\n**What actually happened? Please include the actual, raw output from ESLint.**\r\n\r\nNo linting error\r\n\r\n**Are you willing to submit a pull request to fix this bug?**\r\n\r\nYes!\r\n\r\n### Extra information / motivation:\r\n\r\nThe `no-restricted-modules` works well when using regular single or double quoted strings as argument for `require` calls - it results in expected linting error then.\r\n\r\nHowever `gatsbyjs/gatsby` repository uses `quotes` rule with `backticks` ( https://github.com/gatsbyjs/gatsby/blob/e720d8efe58eba0f6fae9f26ec8879128967d0b5/.eslintrc.js#L53 ) which automatically will turn all `require` call arguments to use backticks, which makes it so the `no-restricted-modules` rule is ineffective.\r\n\r\nCode in rule: https://github.com/eslint/eslint/blob/41de9df41a30a4300243bfe4ca26f716a787b2fc/lib/rules/no-restricted-modules.js#L159-L175\r\n\r\nonly handle cases of using `Literal` as argument, but it doesn't have handling for `TemplateLiteral` - see AST for:\r\n  - `require(\"react\")` (`Literal` case):\r\n\r\n     ```json\r\n    {\r\n      \"type\": \"ExpressionStatement\",\r\n      \"start\": 0,\r\n      \"end\": 16,\r\n      \"expression\": {\r\n        \"type\": \"CallExpression\",\r\n        \"start\": 0,\r\n        \"end\": 16,\r\n        \"callee\": {\r\n          \"type\": \"Identifier\",\r\n          \"start\": 0,\r\n          \"end\": 7,\r\n          \"name\": \"require\"\r\n        },\r\n        \"arguments\": [\r\n          {\r\n            \"type\": \"Literal\",\r\n            \"start\": 8,\r\n            \"end\": 15,\r\n            \"value\": \"react\",\r\n            \"raw\": \"\\\"react\\\"\"\r\n          }\r\n        ]\r\n      }\r\n    }\r\n     ```\r\n  - ``require(`react`)`` (`TemplateLiteral` case):\r\n\r\n     ```json\r\n    {\r\n      \"type\": \"ExpressionStatement\",\r\n      \"start\": 17,\r\n      \"end\": 33,\r\n      \"expression\": {\r\n        \"type\": \"CallExpression\",\r\n        \"start\": 17,\r\n        \"end\": 33,\r\n        \"callee\": {\r\n          \"type\": \"Identifier\",\r\n          \"start\": 17,\r\n          \"end\": 24,\r\n          \"name\": \"require\"\r\n        },\r\n        \"arguments\": [\r\n          {\r\n            \"type\": \"TemplateLiteral\",\r\n            \"start\": 25,\r\n            \"end\": 32,\r\n            \"expressions\": [],\r\n            \"quasis\": [\r\n              {\r\n                \"type\": \"TemplateElement\",\r\n                \"start\": 26,\r\n                \"end\": 31,\r\n                \"value\": {\r\n                  \"raw\": \"react\",\r\n                  \"cooked\": \"react\"\r\n                },\r\n                \"tail\": true\r\n              }\r\n            ]\r\n          }\r\n        ]\r\n      }\r\n    }\r\n     ```\r\n\r\nAs mentioned in one of questions - I'm happy to provide pull request to adjust rule and tests to handle `TemplateLiteral` case (if it is desirable for the rule to handle it as well). ","closed_by":{"login":"kaicataldo","id":7041728,"node_id":"MDQ6VXNlcjcwNDE3Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/7041728?v=4","gravatar_id":"","url":"https://api.github.com/users/kaicataldo","html_url":"https://github.com/kaicataldo","followers_url":"https://api.github.com/users/kaicataldo/followers","following_url":"https://api.github.com/users/kaicataldo/following{/other_user}","gists_url":"https://api.github.com/users/kaicataldo/gists{/gist_id}","starred_url":"https://api.github.com/users/kaicataldo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaicataldo/subscriptions","organizations_url":"https://api.github.com/users/kaicataldo/orgs","repos_url":"https://api.github.com/users/kaicataldo/repos","events_url":"https://api.github.com/users/kaicataldo/events{/privacy}","received_events_url":"https://api.github.com/users/kaicataldo/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eslint/eslint/issues/12926/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eslint/eslint/issues/12926/timeline","performed_via_github_app":null,"state_reason":"completed"}