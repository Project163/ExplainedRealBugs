{"url":"https://api.github.com/repos/eslint/eslint/issues/17457","repository_url":"https://api.github.com/repos/eslint/eslint","labels_url":"https://api.github.com/repos/eslint/eslint/issues/17457/labels{/name}","comments_url":"https://api.github.com/repos/eslint/eslint/issues/17457/comments","events_url":"https://api.github.com/repos/eslint/eslint/issues/17457/events","html_url":"https://github.com/eslint/eslint/issues/17457","id":1847058089,"node_id":"I_kwDOAKjKDc5uF96p","number":17457,"title":"Change Request: Deprecate and remove `CodePath#currentSegments`","user":{"login":"nzakas","id":38546,"node_id":"MDQ6VXNlcjM4NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/38546?v=4","gravatar_id":"","url":"https://api.github.com/users/nzakas","html_url":"https://github.com/nzakas","followers_url":"https://api.github.com/users/nzakas/followers","following_url":"https://api.github.com/users/nzakas/following{/other_user}","gists_url":"https://api.github.com/users/nzakas/gists{/gist_id}","starred_url":"https://api.github.com/users/nzakas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nzakas/subscriptions","organizations_url":"https://api.github.com/users/nzakas/orgs","repos_url":"https://api.github.com/users/nzakas/repos","events_url":"https://api.github.com/users/nzakas/events{/privacy}","received_events_url":"https://api.github.com/users/nzakas/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":45711352,"node_id":"MDU6TGFiZWw0NTcxMTM1Mg==","url":"https://api.github.com/repos/eslint/eslint/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":"This change enhances an existing feature of ESLint"},{"id":82922548,"node_id":"MDU6TGFiZWw4MjkyMjU0OA==","url":"https://api.github.com/repos/eslint/eslint/labels/core","name":"core","color":"c7def8","default":false,"description":"Relates to ESLint's core APIs and features"},{"id":185518888,"node_id":"MDU6TGFiZWwxODU1MTg4ODg=","url":"https://api.github.com/repos/eslint/eslint/labels/breaking","name":"breaking","color":"e11d21","default":false,"description":"This change is backwards-incompatible"},{"id":829215248,"node_id":"MDU6TGFiZWw4MjkyMTUyNDg=","url":"https://api.github.com/repos/eslint/eslint/labels/archived%20due%20to%20age","name":"archived due to age","color":"eeeeee","default":false,"description":"This issue has been archived; please open a new issue for any further discussion"}],"state":"closed","locked":true,"assignee":{"login":"nzakas","id":38546,"node_id":"MDQ6VXNlcjM4NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/38546?v=4","gravatar_id":"","url":"https://api.github.com/users/nzakas","html_url":"https://github.com/nzakas","followers_url":"https://api.github.com/users/nzakas/followers","following_url":"https://api.github.com/users/nzakas/following{/other_user}","gists_url":"https://api.github.com/users/nzakas/gists{/gist_id}","starred_url":"https://api.github.com/users/nzakas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nzakas/subscriptions","organizations_url":"https://api.github.com/users/nzakas/orgs","repos_url":"https://api.github.com/users/nzakas/repos","events_url":"https://api.github.com/users/nzakas/events{/privacy}","received_events_url":"https://api.github.com/users/nzakas/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"nzakas","id":38546,"node_id":"MDQ6VXNlcjM4NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/38546?v=4","gravatar_id":"","url":"https://api.github.com/users/nzakas","html_url":"https://github.com/nzakas","followers_url":"https://api.github.com/users/nzakas/followers","following_url":"https://api.github.com/users/nzakas/following{/other_user}","gists_url":"https://api.github.com/users/nzakas/gists{/gist_id}","starred_url":"https://api.github.com/users/nzakas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nzakas/subscriptions","organizations_url":"https://api.github.com/users/nzakas/orgs","repos_url":"https://api.github.com/users/nzakas/repos","events_url":"https://api.github.com/users/nzakas/events{/privacy}","received_events_url":"https://api.github.com/users/nzakas/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":6,"created_at":"2023-08-11T15:48:34Z","updated_at":"2024-06-30T14:14:12Z","closed_at":"2024-01-01T19:03:53Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### ESLint version\r\n\r\nHEAD\r\n\r\n### What problem do you want to solve?\r\n\r\nCurrently, the `CodePath` objects produced via `onCodePathStart` and `onCodePathEnd` contain a mix of data and state. The most glaring example is `CodePath#currentSegments`, which is actually a live array that is updated as `CodePathAnalyzer` traverses the AST. (`CodePath#currentSegments` actually is a passthrough to an underlying `CodePathState#currentSegments` property.)\r\n\r\nThis is problematic with respect to the [language plugins `SourceCode#traverse()`](https://github.com/eslint/rfcs/blob/main/designs/2022-languages/README.md#the-sourecodetraverse-method), which allows for a traversal to happen at any point and returns an array of steps to complete the traversal. The data available at each step should be the same as when there's an active traversal, but that doesn't happen with code path analysis due to the `CodePath` objects exposing state information.\r\n\r\nSo, exposing state information on `CodePath` objects is a blocker for the language plugins proposal.\r\n\r\n \r\n\r\n### What do you think is the correct solution?\r\n\r\nAs best I can tell, the only problematic property is `CodePath#currentSegments`, which I think we should deprecate in  the v8 timeframe and see if we can remove it in either v9 or v10. From a search through the codebase it seems that this is the primary property we are using off of `CodePath` objects, and it doesn't appear that other state information that changes during traversal is being exposed.\r\n\r\nFurther, I doubt that there are many people using `CodePath#currentSegments` in the wild, so I think we can be pretty aggressive with removing it. I searched through some of the popular plugins and found zero instances of code path usage.\r\n\r\nThe `currentSegments` property is easily duplicated inside of rules using this code:\r\n\r\n```js\r\nconst codePathSegments = [];\r\nlet currentCodePathSegments = [];\r\n\r\nreturn {\r\n            onCodePathStart() {\r\n                codePathSegments.push(currentCodePathSegments);\r\n                currentCodePathSegments = [];\r\n            },\r\n            onCodePathSegmentStart(segment) {\r\n                currentCodePathSegments.push(segment);\r\n            },\r\n            onCodePathSegmentEnd() {\r\n                currentCodePathSegments.pop();\r\n            },\r\n            onCodePathEnd() {\r\n                currentCodePathSegments = codePathSegments.pop();\r\n            },\r\n};\r\n```\r\n\r\nI'd argue that this is the most appropriate way to track current traversal state (from within a rule rather than inside of the core).\r\n\r\n\r\n\r\n### Participation\r\n\r\n- [X] I am willing to submit a pull request for this change.\r\n\r\n### Additional comments\r\n\r\n_No response_","closed_by":{"login":"nzakas","id":38546,"node_id":"MDQ6VXNlcjM4NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/38546?v=4","gravatar_id":"","url":"https://api.github.com/users/nzakas","html_url":"https://github.com/nzakas","followers_url":"https://api.github.com/users/nzakas/followers","following_url":"https://api.github.com/users/nzakas/following{/other_user}","gists_url":"https://api.github.com/users/nzakas/gists{/gist_id}","starred_url":"https://api.github.com/users/nzakas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nzakas/subscriptions","organizations_url":"https://api.github.com/users/nzakas/orgs","repos_url":"https://api.github.com/users/nzakas/repos","events_url":"https://api.github.com/users/nzakas/events{/privacy}","received_events_url":"https://api.github.com/users/nzakas/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eslint/eslint/issues/17457/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eslint/eslint/issues/17457/timeline","performed_via_github_app":null,"state_reason":"completed"}