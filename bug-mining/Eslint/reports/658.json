{"url":"https://api.github.com/repos/eslint/eslint/issues/18385","repository_url":"https://api.github.com/repos/eslint/eslint","labels_url":"https://api.github.com/repos/eslint/eslint/issues/18385/labels{/name}","comments_url":"https://api.github.com/repos/eslint/eslint/issues/18385/comments","events_url":"https://api.github.com/repos/eslint/eslint/issues/18385/events","html_url":"https://github.com/eslint/eslint/issues/18385","id":2259564225,"node_id":"I_kwDOAKjKDc6GrjbB","number":18385,"title":"Change Request: Make it easier to inherit flat configs from the repo root","user":{"login":"jakebailey","id":5341706,"node_id":"MDQ6VXNlcjUzNDE3MDY=","avatar_url":"https://avatars.githubusercontent.com/u/5341706?v=4","gravatar_id":"","url":"https://api.github.com/users/jakebailey","html_url":"https://github.com/jakebailey","followers_url":"https://api.github.com/users/jakebailey/followers","following_url":"https://api.github.com/users/jakebailey/following{/other_user}","gists_url":"https://api.github.com/users/jakebailey/gists{/gist_id}","starred_url":"https://api.github.com/users/jakebailey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jakebailey/subscriptions","organizations_url":"https://api.github.com/users/jakebailey/orgs","repos_url":"https://api.github.com/users/jakebailey/repos","events_url":"https://api.github.com/users/jakebailey/events{/privacy}","received_events_url":"https://api.github.com/users/jakebailey/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":45711352,"node_id":"MDU6TGFiZWw0NTcxMTM1Mg==","url":"https://api.github.com/repos/eslint/eslint/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":"This change enhances an existing feature of ESLint"},{"id":82922548,"node_id":"MDU6TGFiZWw4MjkyMjU0OA==","url":"https://api.github.com/repos/eslint/eslint/labels/core","name":"core","color":"c7def8","default":false,"description":"Relates to ESLint's core APIs and features"},{"id":677842299,"node_id":"MDU6TGFiZWw2Nzc4NDIyOTk=","url":"https://api.github.com/repos/eslint/eslint/labels/needs%20design","name":"needs design","color":"f7c6c7","default":false,"description":"Important details about this change need to be discussed"}],"state":"closed","locked":false,"assignee":{"login":"nzakas","id":38546,"node_id":"MDQ6VXNlcjM4NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/38546?v=4","gravatar_id":"","url":"https://api.github.com/users/nzakas","html_url":"https://github.com/nzakas","followers_url":"https://api.github.com/users/nzakas/followers","following_url":"https://api.github.com/users/nzakas/following{/other_user}","gists_url":"https://api.github.com/users/nzakas/gists{/gist_id}","starred_url":"https://api.github.com/users/nzakas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nzakas/subscriptions","organizations_url":"https://api.github.com/users/nzakas/orgs","repos_url":"https://api.github.com/users/nzakas/repos","events_url":"https://api.github.com/users/nzakas/events{/privacy}","received_events_url":"https://api.github.com/users/nzakas/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"nzakas","id":38546,"node_id":"MDQ6VXNlcjM4NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/38546?v=4","gravatar_id":"","url":"https://api.github.com/users/nzakas","html_url":"https://github.com/nzakas","followers_url":"https://api.github.com/users/nzakas/followers","following_url":"https://api.github.com/users/nzakas/following{/other_user}","gists_url":"https://api.github.com/users/nzakas/gists{/gist_id}","starred_url":"https://api.github.com/users/nzakas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nzakas/subscriptions","organizations_url":"https://api.github.com/users/nzakas/orgs","repos_url":"https://api.github.com/users/nzakas/repos","events_url":"https://api.github.com/users/nzakas/events{/privacy}","received_events_url":"https://api.github.com/users/nzakas/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":32,"created_at":"2024-04-23T18:53:55Z","updated_at":"2024-10-23T18:34:01Z","closed_at":"2024-09-25T14:28:45Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### ESLint version\n\nv8.57.0\n\n### What problem do you want to solve?\n\nWhen using a flat config, the CLI only ever loads one config; this is resolved depending on where you invoke it. In a monorepo, you may want to have multiple `eslint.config.js` files; this is common for non-flat configs, where child `.eslintrc.json` files merge with their parents.\r\n\r\nIt's a design choice that flat configs no longer merge with parent directories; this is fine, and it seems reasonable that one could write a config like:\r\n\r\n```js\r\nimport rootConfig from \"../../../eslint.config.js\";\r\n\r\nexport default [\r\n    ...rootConfig,\r\n    // Some more stuff\r\n]\r\n```\r\n\r\nHowever, this doesn't acutally work!\r\n\r\n- If you run `eslint .` at the root of the monorepo, eslint only loads the root config. All other configs are ignored, so any of the overrides done by other configs are not reflected.\r\n- If you run `eslint .` inside of the nested dir, now the other config is loaded, so it _sometimes_ works, depending on the current working directory.\r\n- All of the paths inherited from the root array will be relative to the wrong dir entirely, e.g. ignoring `scripts/**` in the root will also ignore `script/**` in the local dir, even if the intent was that only the top level dir was ignored. Or, maybe a rule applied to a completely different location and shouldn't be included at all.\r\n\r\nThe only way to do this is to forego multiple configs entirely. The root `eslint.config.js` could include the overrides for _everything_, or invent a custom config loading mechanism, like (in psuedocode):\r\n\r\n```js\r\nimport { globSync } from \"glob\";\r\n\r\nconst allConfigs = globSync(\"**/eslint.config.json\");\r\n\r\nexport default [\r\n    // ...\r\n    allConfigs.map((f) => {\r\n        // Somehow read in the config, then remap all of its internal `files` globs to match a subdir?\r\n    })\r\n];\r\n```\r\n\r\nBut, now you're loading more configs than may be needed for a given file. This is especially a problem for DefinitelyTyped; the _9244_ package monorepo currently has _2247_ `.eslintrc.json` files:\r\n\r\n```console\r\n$ find . -iname 'package.json' | wc -l\r\n9244\r\n$ find . -iname '.eslintrc.json' | wc -l\r\n2247\r\n```\r\n\r\nNormally, this would make me quite worried because if you run eslint in parallel per package (like DT does), that could mean `9,244 * 2,247 = 2,0771,268` config loads. But, under flat config, each config is a module, so the runtime should theoretically be reusing that module, so the reality would likely be closer to just \"load 2000 JSON files once\" so long as the config is not invalidated.\r\n\r\nThat doesn't solve the problem of \"what does this config file look like\", however; not everything can be represented in JSON anymore with flat config.\n\n### What do you think is the correct solution?\n\nESLint could look for the closest `eslint.config.js` file. This is similar to old configs, but explicitly _without_ the merging semantics. This would make ESLint working directory invariant; no matter where you run things, you get the same result.\r\n\r\nI understand that there is some concern about the performance of this, but I don't actually think it will cost too much; you only need to walk a given dir once and remember which config applied to it. All in all, that's no more accesses to the disk than you already need to actually be able to list the files you're going to lint.\r\n\r\nHowever, this does not fix the other flaw; inheriting another directory's config does not imply any modifications of file globs. If I spread in a parent dir's eslint config, none of the paths will line up, and I have no solution to that.\r\n\r\n---\r\n\r\nAnother thing I thought of was to have/suggest a layout like:\r\n\r\n```\r\n.\r\n├── eslint.base.config.js - contains the actual shared config\r\n├── eslint.config.js      - imports shared config, all child dir configs\r\n└── packages/\r\n    ├── foo/\r\n    │   └── eslint.config.js  - imports only shared config\r\n    └── bar/\r\n        └── eslint.config.js  - imports only shared config\r\n```\r\n\r\nThis would also be cwd-invariant, but is pretty complicated, and also does not solve the problem of re-rooting paths from other configs / removing ones that don't apply to the subdir.\n\n### Participation\n\n- [X] I am willing to submit a pull request for this change.\n\n### Additional comments\n\nI have yet to do perf testing on the \"load 2247 config files\" method or the \"base config\" idea; I've been really busy and have not had time to work on DT related stuff like this.","closed_by":{"login":"mdjermanovic","id":44349756,"node_id":"MDQ6VXNlcjQ0MzQ5NzU2","avatar_url":"https://avatars.githubusercontent.com/u/44349756?v=4","gravatar_id":"","url":"https://api.github.com/users/mdjermanovic","html_url":"https://github.com/mdjermanovic","followers_url":"https://api.github.com/users/mdjermanovic/followers","following_url":"https://api.github.com/users/mdjermanovic/following{/other_user}","gists_url":"https://api.github.com/users/mdjermanovic/gists{/gist_id}","starred_url":"https://api.github.com/users/mdjermanovic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdjermanovic/subscriptions","organizations_url":"https://api.github.com/users/mdjermanovic/orgs","repos_url":"https://api.github.com/users/mdjermanovic/repos","events_url":"https://api.github.com/users/mdjermanovic/events{/privacy}","received_events_url":"https://api.github.com/users/mdjermanovic/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eslint/eslint/issues/18385/reactions","total_count":30,"+1":30,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eslint/eslint/issues/18385/timeline","performed_via_github_app":null,"state_reason":"completed"}