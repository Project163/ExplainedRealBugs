{"url":"https://api.github.com/repos/eslint/eslint/issues/13639","repository_url":"https://api.github.com/repos/eslint/eslint","labels_url":"https://api.github.com/repos/eslint/eslint/issues/13639/labels{/name}","comments_url":"https://api.github.com/repos/eslint/eslint/issues/13639/comments","events_url":"https://api.github.com/repos/eslint/eslint/issues/13639/events","html_url":"https://github.com/eslint/eslint/issues/13639","id":689406185,"node_id":"MDU6SXNzdWU2ODk0MDYxODU=","number":13639,"title":"Exceptions when traversing using sibling, adjacent and nth-child selectors and non-standard AST nodes","user":{"login":"bradzacher","id":7462525,"node_id":"MDQ6VXNlcjc0NjI1MjU=","avatar_url":"https://avatars.githubusercontent.com/u/7462525?v=4","gravatar_id":"","url":"https://api.github.com/users/bradzacher","html_url":"https://github.com/bradzacher","followers_url":"https://api.github.com/users/bradzacher/followers","following_url":"https://api.github.com/users/bradzacher/following{/other_user}","gists_url":"https://api.github.com/users/bradzacher/gists{/gist_id}","starred_url":"https://api.github.com/users/bradzacher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bradzacher/subscriptions","organizations_url":"https://api.github.com/users/bradzacher/orgs","repos_url":"https://api.github.com/users/bradzacher/repos","events_url":"https://api.github.com/users/bradzacher/events{/privacy}","received_events_url":"https://api.github.com/users/bradzacher/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":45711350,"node_id":"MDU6TGFiZWw0NTcxMTM1MA==","url":"https://api.github.com/repos/eslint/eslint/labels/bug","name":"bug","color":"fc2929","default":true,"description":"ESLint is working incorrectly"},{"id":45711352,"node_id":"MDU6TGFiZWw0NTcxMTM1Mg==","url":"https://api.github.com/repos/eslint/eslint/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":"This change enhances an existing feature of ESLint"},{"id":82922548,"node_id":"MDU6TGFiZWw4MjkyMjU0OA==","url":"https://api.github.com/repos/eslint/eslint/labels/core","name":"core","color":"c7def8","default":false,"description":"Relates to ESLint's core APIs and features"},{"id":131106229,"node_id":"MDU6TGFiZWwxMzExMDYyMjk=","url":"https://api.github.com/repos/eslint/eslint/labels/accepted","name":"accepted","color":"0052cc","default":false,"description":"There is consensus among the team that this change meets the criteria for inclusion"},{"id":829215248,"node_id":"MDU6TGFiZWw4MjkyMTUyNDg=","url":"https://api.github.com/repos/eslint/eslint/labels/archived%20due%20to%20age","name":"archived due to age","color":"eeeeee","default":false,"description":"This issue has been archived; please open a new issue for any further discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-08-31T18:30:36Z","updated_at":"2021-08-12T00:18:17Z","closed_at":"2021-02-12T14:38:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n    ESLint adheres to the Open JS Foundation Code of Conduct:\r\n    https://eslint.org/conduct\r\n\r\n    This template is for bug reports. If you are here for another reason, please see below:\r\n\r\n    1. To propose a new rule: https://eslint.org/docs/developer-guide/contributing/new-rules\r\n    2. To request a rule change: https://eslint.org/docs/developer-guide/contributing/rule-changes\r\n    3. To request a change that is not a bug fix, rule change, or new rule: https://eslint.org/docs/developer-guide/contributing/changes\r\n    4. If you have any questions, please stop by our chatroom: https://eslint.org/chat\r\n\r\n    Note that leaving sections blank will make it difficult for us to troubleshoot and we may have to close the issue.\r\n-->\r\n\r\n\r\n**Tell us about your environment**\r\n\r\n<!--\r\n    If you are using ESLint v6.5.0 or later, you can run ESLint with the `--env-info` flag and paste the output here.\r\n-->\r\n\r\n* **ESLint Version:** v7.7.0\r\n* **Node Version:** v12.14.1\r\n* **npm Version:** v6.13.4\r\n\r\n**What parser (default, `@babel/eslint-parser`, `@typescript-eslint/parser`, etc.) are you using?**\r\n\r\n`@typescript-eslint/parser`\r\n\r\n**Please show your full configuration:**\r\n\r\n<details>\r\n<summary>Configuration</summary>\r\n\r\n<!-- Paste your configuration below: -->\r\n```js\r\nmodule.exports = {\r\n  \"parser\": \"@typescript-eslint/parser\",\r\n  \"plugins\": [ \"eslint-plugin-test\" ],\r\n  \"rules\": { \"test/test\": \"error\" }\r\n};\r\n```\r\n\r\n</details>\r\n\r\n**What did you do? Please include the actual source code causing the issue, as well as the command that you used to run ESLint.**\r\n\r\n<!-- Paste the source code below: -->\r\n\r\n**`eslint-plugin-test` source:**\r\n```js\r\nexports.rules = {\r\n    test: {\r\n        create(context) {\r\n            return {\r\n                \"Program ~ *\": node => {\r\n                    context.report({\r\n                        message: \"test\",\r\n                        node\r\n                    })\r\n\r\n                    // this code doesn't get a chance to get called :(\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n**lint file source:**\r\n```js\r\nconst foo: string = \"bar\"\r\n```\r\n\r\n<!-- Paste the command you used to run ESLint: -->\r\n```bash\r\neslint ./test.ts\r\n```\r\n\r\n**What actually happened? Please include the actual, raw output from ESLint.**\r\n\r\n```\r\nOops! Something went wrong! :(\r\n\r\nESLint: 7.7.0\r\n\r\nTypeError: Cannot read property 'length' of undefined\r\nOccurred while linting /home/samual/test/index.ts:1\r\n    at u (/home/samual/test/node_modules/esquery/dist/esquery.min.js:1:31904)\r\n    at Function.l [as matches] (/home/samual/test/node_modules/esquery/dist/esquery.min.js:1:30807)\r\n    at NodeEventGenerator.applySelector (/home/samual/test/node_modules/eslint/lib/linter/node-event-generator.js:253:21)\r\n    at NodeEventGenerator.applySelectors (/home/samual/test/node_modules/eslint/lib/linter/node-event-generator.js:281:22)\r\n    at NodeEventGenerator.enterNode (/home/samual/test/node_modules/eslint/lib/linter/node-event-generator.js:297:14)\r\n    at CodePathAnalyzer.enterNode (/home/samual/test/node_modules/eslint/lib/linter/code-path-analysis/code-path-analyzer.js:673:23)\r\n    at /home/samual/test/node_modules/eslint/lib/linter/linter.js:949:32\r\n    at Array.forEach (<anonymous>)\r\n    at runRules (/home/samual/test/node_modules/eslint/lib/linter/linter.js:944:15)\r\n    at Linter._verifyWithoutProcessors (/home/samual/test/node_modules/eslint/lib/linter/linter.js:1170:31)\r\n```\r\n\r\n**Context**\r\n\r\nOriginal issue: https://github.com/typescript-eslint/typescript-eslint/issues/2439\r\n\r\nInvestigation so far:\r\n\r\nOur parser (`@typescript-eslint/parser`) returns an extended list of [visitor-keys](https://github.com/typescript-eslint/typescript-eslint/tree/master/packages/visitor-keys) (as specified [by the ESLint docs](https://eslint.org/docs/developer-guide/working-with-custom-parsers)) [right here](https://github.com/typescript-eslint/typescript-eslint/blob/2cb66205de797479d9b2d362652c42fe032e913b/packages/parser/src/parser.ts#L140)\r\n\r\nHowever `esquery` uses its own (hard coded) visitor keys for 3 selectors:\r\n- sibling `~`:\r\nhttps://github.com/estools/esquery/blob/e27e73d8cde63a2eb1aba3424510ce1b714d207e/esquery.js#L239\r\n- adjacent `+`\r\nhttps://github.com/estools/esquery/blob/e27e73d8cde63a2eb1aba3424510ce1b714d207e/esquery.js#L275\r\n- and nth-child `:nth-child(n)`\r\nhttps://github.com/estools/esquery/blob/e27e73d8cde63a2eb1aba3424510ce1b714d207e/esquery.js#L309\r\n\r\nSo I *think* that this is this something we'll have to PR into the underlying esquery library?","closed_by":{"login":"mdjermanovic","id":44349756,"node_id":"MDQ6VXNlcjQ0MzQ5NzU2","avatar_url":"https://avatars.githubusercontent.com/u/44349756?v=4","gravatar_id":"","url":"https://api.github.com/users/mdjermanovic","html_url":"https://github.com/mdjermanovic","followers_url":"https://api.github.com/users/mdjermanovic/followers","following_url":"https://api.github.com/users/mdjermanovic/following{/other_user}","gists_url":"https://api.github.com/users/mdjermanovic/gists{/gist_id}","starred_url":"https://api.github.com/users/mdjermanovic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdjermanovic/subscriptions","organizations_url":"https://api.github.com/users/mdjermanovic/orgs","repos_url":"https://api.github.com/users/mdjermanovic/repos","events_url":"https://api.github.com/users/mdjermanovic/events{/privacy}","received_events_url":"https://api.github.com/users/mdjermanovic/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eslint/eslint/issues/13639/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eslint/eslint/issues/13639/timeline","performed_via_github_app":null,"state_reason":"completed"}