{"url":"https://api.github.com/repos/eslint/eslint/issues/12850","repository_url":"https://api.github.com/repos/eslint/eslint","labels_url":"https://api.github.com/repos/eslint/eslint/issues/12850/labels{/name}","comments_url":"https://api.github.com/repos/eslint/eslint/issues/12850/comments","events_url":"https://api.github.com/repos/eslint/eslint/issues/12850/events","html_url":"https://github.com/eslint/eslint/issues/12850","id":557824792,"node_id":"MDU6SXNzdWU1NTc4MjQ3OTI=","number":12850,"title":"AssertionError [ERR_ASSERTION]: 'newBasePath' should be an absolute path","user":{"login":"drkestel","id":48810581,"node_id":"MDQ6VXNlcjQ4ODEwNTgx","avatar_url":"https://avatars.githubusercontent.com/u/48810581?v=4","gravatar_id":"","url":"https://api.github.com/users/drkestel","html_url":"https://github.com/drkestel","followers_url":"https://api.github.com/users/drkestel/followers","following_url":"https://api.github.com/users/drkestel/following{/other_user}","gists_url":"https://api.github.com/users/drkestel/gists{/gist_id}","starred_url":"https://api.github.com/users/drkestel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drkestel/subscriptions","organizations_url":"https://api.github.com/users/drkestel/orgs","repos_url":"https://api.github.com/users/drkestel/repos","events_url":"https://api.github.com/users/drkestel/events{/privacy}","received_events_url":"https://api.github.com/users/drkestel/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":45711350,"node_id":"MDU6TGFiZWw0NTcxMTM1MA==","url":"https://api.github.com/repos/eslint/eslint/labels/bug","name":"bug","color":"fc2929","default":true,"description":"ESLint is working incorrectly"},{"id":82922548,"node_id":"MDU6TGFiZWw4MjkyMjU0OA==","url":"https://api.github.com/repos/eslint/eslint/labels/core","name":"core","color":"c7def8","default":false,"description":"Relates to ESLint's core APIs and features"},{"id":131106229,"node_id":"MDU6TGFiZWwxMzExMDYyMjk=","url":"https://api.github.com/repos/eslint/eslint/labels/accepted","name":"accepted","color":"0052cc","default":false,"description":"There is consensus among the team that this change meets the criteria for inclusion"},{"id":829215248,"node_id":"MDU6TGFiZWw4MjkyMTUyNDg=","url":"https://api.github.com/repos/eslint/eslint/labels/archived%20due%20to%20age","name":"archived due to age","color":"eeeeee","default":false,"description":"This issue has been archived; please open a new issue for any further discussion"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2020-01-30T23:45:14Z","updated_at":"2020-10-06T17:28:10Z","closed_at":"2020-04-08T00:09:09Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Windows\r\nNode v12.13.0\r\nnpm v6.13.6\r\neslint 6.8.0\r\nParser: @typescript-eslint/parser\r\nBash terminal\r\n\r\neslint config:\r\n```\r\n\"use strict\";\r\nconst allExtensions = [\".ts\", \".tsx\", \".d.ts\", \".js\", \".jsx\"];\r\nmodule.exports = {\r\n    env: {\r\n        \"browser\": true,\r\n        \"es6\": true,\r\n    },\r\n    parser: \"@typescript-eslint/parser\",\r\n    parserOptions: {\r\n        project: \"./tsconfig.json\",\r\n        sourceType: \"module\",\r\n    },\r\n    plugins: [\r\n        \"import\",\r\n        \"@typescript-eslint\",\r\n        \"@typescript-eslint/tslint\",\r\n    ],\r\n    settings: {\r\n        \"import/extensions\": allExtensions,\r\n        \"import/parsers\": {\r\n            \"@typescript-eslint/parser\": [\".ts\", \".tsx\", \".d.ts\"],\r\n        },\r\n        \"import/resolver\": {\r\n            \"node\": {\r\n                \"extensions\": allExtensions,\r\n            },\r\n        },\r\n    },\r\n    rules: {\r\n     \r\n        \"import/no-deprecated\": \"warn\",\r\n        \"@typescript-eslint/no-unused-vars\": \"error\",\r\n        \"@typescript-eslint/tslint/config\": [\r\n            \"warn\",\r\n            {\r\n                \"rules\": {\r\n                    \"deprecation\": true,\r\n                },\r\n            },\r\n        ],\r\n    },\r\n};\r\n```\r\n\r\nI'm currently using a globally installed npm package (call it foo cli) that wraps eslint. I have a workspace in c:\\src\\myproject. foo cli has an internal reference to eslint 6.8.0. When I run `ap lint` from c:\\src\\myproject, foo cli invokes eslint with some default parameters, and I get the error from the bug title. Here's the raw output:\r\n\r\n```\r\n/c/myproject (master)\r\n$ ap lint\r\nRunning C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\.bin\\eslint.cmd **/*.ts --ignore-path C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\lint\\.eslintignore -c C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\lint\\.eslintrc.json --resolve-plugins-relative-to C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\lint\r\nAssertionError [ERR_ASSERTION]: 'newBasePath' should be an absolute path.\r\n    at IgnorePattern.getPatternsRelativeTo (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\config-array\\ignore-pattern.js:210:9)\r\n    at C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\config-array\\ignore-pattern.js:150:42\r\n    at Array.map (<anonymous>)\r\n    at Function.createIgnore (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\config-array\\ignore-pattern.js:150:31)\r\n    at createConfig (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\config-array\\config-array.js:282:40)\r\n    at ConfigArray.extractConfig (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\config-array\\config-array.js:452:33)\r\n    at FileEnumerator._isIgnoredFile (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\file-enumerator.js:479:24)\r\n    at FileEnumerator._iterateFilesRecursive (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\file-enumerator.js:407:38)\r\n    at _iterateFilesRecursive.next (<anonymous>)\r\n    at FileEnumerator.iterateFiles (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\file-enumerator.js:251:49)\r\n```\r\n\r\nI believe the problem exists in ignore-pattern.js and was introduced in this pull request: https://github.com/eslint/eslint/pull/12274/files\r\n\r\nIf I add some debug logging to IgnorePattern.getCommonAncestorPath:\r\n```\r\nfunction getCommonAncestorPath(sourcePaths) {\r\n    let result = sourcePaths[0];\r\n\r\n    for (let i = 1; i < sourcePaths.length; ++i) {\r\n        const a = result;\r\n        const b = sourcePaths[i];\r\n\r\n        // Set the shorter one (it's the common ancestor if one includes the other).\r\n        result = a.length < b.length ? a : b;\r\n\r\n        // Set the common ancestor.\r\n        for (let j = 0, lastSepPos = 0; j < a.length && j < b.length; ++j) {\r\n            if (a[j] !== b[j]) {\r\n                result = a.slice(0, lastSepPos);\r\n                break;\r\n            }\r\n            if (a[j] === path.sep) {\r\n                lastSepPos = j;\r\n            }\r\n        }\r\n    }\r\n    console.log(\"**: \", { result: result, sep: path.sep, sourcePaths: sourcePaths }); // new line here\r\n    return result || path.sep;\r\n}\r\n```\r\n\r\nI see the following output:\r\n```\r\n/c/myproject (master)\r\n$ ap lint\r\nRunning C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\.bin\\eslint.cmd **/*.ts --ignore-path C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\lint\\.eslintignore -c C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\lint\\.eslintrc.json --resolve-plugins-relative-to C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\lint\r\n**:  {\r\n  result: 'C:\\\\src\\\\myproject',\r\n  sep: '\\\\',\r\n  sourcePaths: [ 'C:\\\\src\\\\myproject' ]\r\n}\r\n**:  {\r\n  result: 'C:\\\\src\\\\myproject',\r\n  sep: '\\\\',\r\n  sourcePaths: [ 'C:\\\\src\\\\myproject' ]\r\n}\r\n**:  {\r\n  result: 'C:',\r\n  sep: '\\\\',\r\n  sourcePaths: [\r\n    'C:\\\\src\\\\myproject',\r\n    'C:\\\\Users\\\\drkestel\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\@foocli\\\\lint'\r\n  ]\r\n}\r\nAssertionError [ERR_ASSERTION]: 'newBasePath' should be an absolute path.\r\n    at IgnorePattern.getPatternsRelativeTo (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\config-array\\ignore-pattern.js:210:9)\r\n    at C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\config-array\\ignore-pattern.js:150:42\r\n    at Array.map (<anonymous>)\r\n    at Function.createIgnore (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\config-array\\ignore-pattern.js:150:31)\r\n    at createConfig (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\config-array\\config-array.js:282:40)\r\n    at ConfigArray.extractConfig (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\config-array\\config-array.js:452:33)\r\n    at FileEnumerator._isIgnoredFile (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\file-enumerator.js:479:24)\r\n    at FileEnumerator._iterateFilesRecursive (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\file-enumerator.js:407:38)\r\n    at _iterateFilesRecursive.next (<anonymous>)\r\n    at FileEnumerator.iterateFiles (C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\eslint\\lib\\cli-engine\\file-enumerator.js:251:49)\r\n\r\n/c/myproject (master)\r\n$\r\n```\r\n\r\nNotice the `result: 'C:',` - that is not considered a valid absolute path.\r\n\r\nInterestingly enough, I can mitigate the problem by using windows cmd.exe and setting my current prompt to `c:\\` (lowercase, as opposed to `C:\\`). Because `c:\\ != C:\\`, it works. See the output:\r\n\r\n```\r\nc:\\src\\myproject>ap lint\r\nRunning C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\node_modules\\.bin\\eslint.cmd **/*.ts --ignore-path C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\lint\\.eslintignore -c C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\lint\\.eslintrc.json --resolve-plugins-relative-to C:\\Users\\drkestel\\AppData\\Roaming\\npm\\node_modules\\@foocli\\lint\r\n**:  {\r\n  result: 'c:\\\\src\\\\myproject',\r\n  sep: '\\\\',\r\n  sourcePaths: [ 'c:\\\\src\\\\myproject' ]\r\n}\r\n**:  {\r\n  result: 'c:\\\\src\\\\myproject',\r\n  sep: '\\\\',\r\n  sourcePaths: [ 'c:\\\\src\\\\myproject' ]\r\n}\r\n**:  {\r\n  result: '',\r\n  sep: '\\\\',\r\n  sourcePaths: [\r\n    'c:\\\\src\\\\myproject',\r\n    'C:\\\\Users\\\\drkestel\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\@foocli\\\\lint'\r\n  ]\r\n}\r\n**:  {\r\n  result: '',\r\n  sep: '\\\\',\r\n  sourcePaths: [\r\n    'c:\\\\src\\\\myproject',\r\n    'C:\\\\Users\\\\drkestel\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\@foocli\\\\lint'\r\n  ]\r\n}\r\n\r\nc:\\src\\myproject\\Client\\Index.ts\r\n  66:5   warning  Missing return type on function                 @typescript-eslint/explicit-function-return-type\r\n  67:17  error    'container' is assigned a value but never used  @typescript-eslint/no-unused-vars\r\n  68:15  error    'id' is assigned a value but never used         @typescript-eslint/no-unused-vars\r\n\r\n... more valid linting\r\n```\r\n\r\nI can also mitigate the problem by making the following code change to ignore-pattern.js:\r\n```\r\nfunction getCommonAncestorPath(sourcePaths) {\r\n    let result = sourcePaths[0];\r\n\r\n    for (let i = 1; i < sourcePaths.length; ++i) {\r\n        const a = result;\r\n        const b = sourcePaths[i];\r\n\r\n        // Set the shorter one (it's the common ancestor if one includes the other).\r\n        result = a.length < b.length ? a : b;\r\n\r\n        // Set the common ancestor.\r\n        for (let j = 0, lastSepPos = 0; j < a.length && j < b.length; ++j) {\r\n            if (a[j] !== b[j]) {\r\n                result = a.slice(0, lastSepPos);\r\n                break;\r\n            }\r\n            if (a[j] === path.sep) {\r\n                lastSepPos = j;\r\n            }\r\n        }\r\n    }\r\n    // this was the previous return statement\r\n    // return result || path.sep;\r\n\r\n    // new return statement\r\n    let resolvedResult = result || path.sep;\r\n    if (resolvedResult && resolvedResult.endsWith(\":\")) {\r\n        resolvedResult = resolvedResult + path.sep;\r\n    }\r\n    return resolvedResult;\r\n}\r\n```","closed_by":{"login":"nzakas","id":38546,"node_id":"MDQ6VXNlcjM4NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/38546?v=4","gravatar_id":"","url":"https://api.github.com/users/nzakas","html_url":"https://github.com/nzakas","followers_url":"https://api.github.com/users/nzakas/followers","following_url":"https://api.github.com/users/nzakas/following{/other_user}","gists_url":"https://api.github.com/users/nzakas/gists{/gist_id}","starred_url":"https://api.github.com/users/nzakas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nzakas/subscriptions","organizations_url":"https://api.github.com/users/nzakas/orgs","repos_url":"https://api.github.com/users/nzakas/repos","events_url":"https://api.github.com/users/nzakas/events{/privacy}","received_events_url":"https://api.github.com/users/nzakas/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eslint/eslint/issues/12850/reactions","total_count":10,"+1":10,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eslint/eslint/issues/12850/timeline","performed_via_github_app":null,"state_reason":"completed"}