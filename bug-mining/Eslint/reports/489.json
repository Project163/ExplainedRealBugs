{"url":"https://api.github.com/repos/eslint/eslint/issues/14862","repository_url":"https://api.github.com/repos/eslint/eslint","labels_url":"https://api.github.com/repos/eslint/eslint/issues/14862/labels{/name}","comments_url":"https://api.github.com/repos/eslint/eslint/issues/14862/comments","events_url":"https://api.github.com/repos/eslint/eslint/issues/14862/events","html_url":"https://github.com/eslint/eslint/issues/14862","id":957335672,"node_id":"MDU6SXNzdWU5NTczMzU2NzI=","number":14862,"title":"Support Lazy Loading Rules from 3rd Party Plugins","user":{"login":"bradzacher","id":7462525,"node_id":"MDQ6VXNlcjc0NjI1MjU=","avatar_url":"https://avatars.githubusercontent.com/u/7462525?v=4","gravatar_id":"","url":"https://api.github.com/users/bradzacher","html_url":"https://github.com/bradzacher","followers_url":"https://api.github.com/users/bradzacher/followers","following_url":"https://api.github.com/users/bradzacher/following{/other_user}","gists_url":"https://api.github.com/users/bradzacher/gists{/gist_id}","starred_url":"https://api.github.com/users/bradzacher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bradzacher/subscriptions","organizations_url":"https://api.github.com/users/bradzacher/orgs","repos_url":"https://api.github.com/users/bradzacher/repos","events_url":"https://api.github.com/users/bradzacher/events{/privacy}","received_events_url":"https://api.github.com/users/bradzacher/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":45711352,"node_id":"MDU6TGFiZWw0NTcxMTM1Mg==","url":"https://api.github.com/repos/eslint/eslint/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":"This change enhances an existing feature of ESLint"},{"id":45711354,"node_id":"MDU6TGFiZWw0NTcxMTM1NA==","url":"https://api.github.com/repos/eslint/eslint/labels/triage","name":"triage","color":"cc317c","default":false,"description":"An ESLint team member will look at this issue soon"},{"id":82922548,"node_id":"MDU6TGFiZWw4MjkyMjU0OA==","url":"https://api.github.com/repos/eslint/eslint/labels/core","name":"core","color":"c7def8","default":false,"description":"Relates to ESLint's core APIs and features"},{"id":829215248,"node_id":"MDU6TGFiZWw4MjkyMTUyNDg=","url":"https://api.github.com/repos/eslint/eslint/labels/archived%20due%20to%20age","name":"archived due to age","color":"eeeeee","default":false,"description":"This issue has been archived; please open a new issue for any further discussion"},{"id":3455102856,"node_id":"LA_kwDOAKjKDc7N8K-I","url":"https://api.github.com/repos/eslint/eslint/labels/Stale","name":"Stale","color":"ededed","default":false,"description":null}],"state":"closed","locked":true,"assignee":{"login":"nzakas","id":38546,"node_id":"MDQ6VXNlcjM4NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/38546?v=4","gravatar_id":"","url":"https://api.github.com/users/nzakas","html_url":"https://github.com/nzakas","followers_url":"https://api.github.com/users/nzakas/followers","following_url":"https://api.github.com/users/nzakas/following{/other_user}","gists_url":"https://api.github.com/users/nzakas/gists{/gist_id}","starred_url":"https://api.github.com/users/nzakas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nzakas/subscriptions","organizations_url":"https://api.github.com/users/nzakas/orgs","repos_url":"https://api.github.com/users/nzakas/repos","events_url":"https://api.github.com/users/nzakas/events{/privacy}","received_events_url":"https://api.github.com/users/nzakas/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"nzakas","id":38546,"node_id":"MDQ6VXNlcjM4NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/38546?v=4","gravatar_id":"","url":"https://api.github.com/users/nzakas","html_url":"https://github.com/nzakas","followers_url":"https://api.github.com/users/nzakas/followers","following_url":"https://api.github.com/users/nzakas/following{/other_user}","gists_url":"https://api.github.com/users/nzakas/gists{/gist_id}","starred_url":"https://api.github.com/users/nzakas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nzakas/subscriptions","organizations_url":"https://api.github.com/users/nzakas/orgs","repos_url":"https://api.github.com/users/nzakas/repos","events_url":"https://api.github.com/users/nzakas/events{/privacy}","received_events_url":"https://api.github.com/users/nzakas/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":6,"created_at":"2021-07-31T23:06:45Z","updated_at":"2022-06-03T00:57:44Z","closed_at":"2021-12-04T01:31:14Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n    ESLint adheres to the Open JS Foundation Code of Conduct:\r\n    https://eslint.org/conduct\r\n\r\n    This template is for requesting a change that is not a bug fix, rule change, or new rule. If you are here for another reason, please see below:\r\n\r\n    1. To report a bug: https://eslint.org/docs/developer-guide/contributing/reporting-bugs\r\n    2. To request a rule change: https://eslint.org/docs/developer-guide/contributing/rule-changes\r\n    3. To propose a new rule: https://eslint.org/docs/developer-guide/contributing/new-rules\r\n    4. If you have any questions, please stop by our chatroom: https://eslint.org/chat\r\n\r\n    Note that leaving sections blank will make it difficult for us to troubleshoot and we may have to close the issue.\r\n-->\r\n\r\n\r\n\r\n**The version of ESLint you are using.**\r\n7.27.0\r\n\r\n**The problem you want to solve.**\r\n\r\nLarge 3rd-party ESLint plugins can often define hundreds of rules.\r\n\r\nLoading all of these rules if the user only configures one or two can be wasteful, especially if the rule sets up some global state as part of being loaded.\r\n\r\nAs an example - at Facebook our internal ESLint plugin defines ~570 rules.\r\nSome of these rules are only enabled on parts of the codeabse and read configuration files from the repo that in some cases can be hundreds of KB (or even a few MB in some cases).\r\nOr some rules read in GraphQL schema information (which at FB is sized in the gigabytes and takes tens of seconds to produce).\r\n\r\n\r\nFor 3rd-party plugins ESLint will explicitly and forcefully iterate and resolve every single one of a plugin's rules, regardless of if they are actually used:\r\nhttps://github.com/eslint/eslintrc/blob/9bf2ba12e6c0bfe7296774531fd79dea23d4c805/lib/config-array/config-array.js#L326-L337\r\n\r\nOTOH, ESLint wraps its core rules object in a [`LazyLoadingRuleMap`](https://github.com/eslint/eslint/blob/master/lib/rules/utils/lazy-loading-rule-map.js) which allows the engine to load in lint rules if and only if they are explicitly used by the user.\r\nESLint's engine is hard-coded to respects this lazy-loading style only for the core rules.\r\n\r\nI've tried playing around with a few solutions in user-land, like using a `Proxy`:\r\n```\r\nconst rules = {\r\n  'rule': () => require('./rule');\r\n};\r\n\r\nmodule.exports = new Proxy(rules, {\r\n  get(target, key) {\r\n    if (key in target) {\r\n      return target[key]();\r\n    }\r\n    return undefined;\r\n  },\r\n});\r\n```\r\n\r\nBut because of ESLint's usage of `Object.entries` to collect and normalise all of a plugin's rules - it is no different to just defining an object.\r\n\r\n\r\n**Your take on the correct solution to problem.**\r\nESLint should treat 3rd-party plugins the same as its core rules - it should *not* iterate the set of plugin rules automatically and should instead only access the rules that the configuration explicitly enables.\r\n\r\nAlternately ESLint could expose its `LazyLoadingRuleMap` utility publicly and then do feature detection like `plugin.rules instanceof LazyLoadingRuleMap` to conditionally enable the lazy-loading feature, in case you are concerned about an unintentional breaking change.\r\n\r\n**Are you willing to submit a pull request to implement this change?**\r\nI'm short on OSS time, but I could look into it at some point.","closed_by":{"login":"mdjermanovic","id":44349756,"node_id":"MDQ6VXNlcjQ0MzQ5NzU2","avatar_url":"https://avatars.githubusercontent.com/u/44349756?v=4","gravatar_id":"","url":"https://api.github.com/users/mdjermanovic","html_url":"https://github.com/mdjermanovic","followers_url":"https://api.github.com/users/mdjermanovic/followers","following_url":"https://api.github.com/users/mdjermanovic/following{/other_user}","gists_url":"https://api.github.com/users/mdjermanovic/gists{/gist_id}","starred_url":"https://api.github.com/users/mdjermanovic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mdjermanovic/subscriptions","organizations_url":"https://api.github.com/users/mdjermanovic/orgs","repos_url":"https://api.github.com/users/mdjermanovic/repos","events_url":"https://api.github.com/users/mdjermanovic/events{/privacy}","received_events_url":"https://api.github.com/users/mdjermanovic/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eslint/eslint/issues/14862/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eslint/eslint/issues/14862/timeline","performed_via_github_app":null,"state_reason":"completed"}