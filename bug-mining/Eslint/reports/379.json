{"url":"https://api.github.com/repos/eslint/eslint/issues/11279","repository_url":"https://api.github.com/repos/eslint/eslint","labels_url":"https://api.github.com/repos/eslint/eslint/issues/11279/labels{/name}","comments_url":"https://api.github.com/repos/eslint/eslint/issues/11279/comments","events_url":"https://api.github.com/repos/eslint/eslint/issues/11279/events","html_url":"https://github.com/eslint/eslint/issues/11279","id":400043409,"node_id":"MDU6SXNzdWU0MDAwNDM0MDk=","number":11279,"title":"Rule proposal: Disallow number literals that lose precision","user":{"login":"not-an-aardvark","id":11638619,"node_id":"MDQ6VXNlcjExNjM4NjE5","avatar_url":"https://avatars.githubusercontent.com/u/11638619?v=4","gravatar_id":"","url":"https://api.github.com/users/not-an-aardvark","html_url":"https://github.com/not-an-aardvark","followers_url":"https://api.github.com/users/not-an-aardvark/followers","following_url":"https://api.github.com/users/not-an-aardvark/following{/other_user}","gists_url":"https://api.github.com/users/not-an-aardvark/gists{/gist_id}","starred_url":"https://api.github.com/users/not-an-aardvark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/not-an-aardvark/subscriptions","organizations_url":"https://api.github.com/users/not-an-aardvark/orgs","repos_url":"https://api.github.com/users/not-an-aardvark/repos","events_url":"https://api.github.com/users/not-an-aardvark/events{/privacy}","received_events_url":"https://api.github.com/users/not-an-aardvark/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":45798639,"node_id":"MDU6TGFiZWw0NTc5ODYzOQ==","url":"https://api.github.com/repos/eslint/eslint/labels/rule","name":"rule","color":"fbca04","default":false,"description":"Relates to ESLint's core rules"},{"id":131106229,"node_id":"MDU6TGFiZWwxMzExMDYyMjk=","url":"https://api.github.com/repos/eslint/eslint/labels/accepted","name":"accepted","color":"0052cc","default":false,"description":"There is consensus among the team that this change meets the criteria for inclusion"},{"id":253473350,"node_id":"MDU6TGFiZWwyNTM0NzMzNTA=","url":"https://api.github.com/repos/eslint/eslint/labels/feature","name":"feature","color":"bfd4f2","default":false,"description":"This change adds a new feature to ESLint"},{"id":829215248,"node_id":"MDU6TGFiZWw4MjkyMTUyNDg=","url":"https://api.github.com/repos/eslint/eslint/labels/archived%20due%20to%20age","name":"archived due to age","color":"eeeeee","default":false,"description":"This issue has been archived; please open a new issue for any further discussion"}],"state":"closed","locked":true,"assignee":{"login":"not-an-aardvark","id":11638619,"node_id":"MDQ6VXNlcjExNjM4NjE5","avatar_url":"https://avatars.githubusercontent.com/u/11638619?v=4","gravatar_id":"","url":"https://api.github.com/users/not-an-aardvark","html_url":"https://github.com/not-an-aardvark","followers_url":"https://api.github.com/users/not-an-aardvark/followers","following_url":"https://api.github.com/users/not-an-aardvark/following{/other_user}","gists_url":"https://api.github.com/users/not-an-aardvark/gists{/gist_id}","starred_url":"https://api.github.com/users/not-an-aardvark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/not-an-aardvark/subscriptions","organizations_url":"https://api.github.com/users/not-an-aardvark/orgs","repos_url":"https://api.github.com/users/not-an-aardvark/repos","events_url":"https://api.github.com/users/not-an-aardvark/events{/privacy}","received_events_url":"https://api.github.com/users/not-an-aardvark/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"not-an-aardvark","id":11638619,"node_id":"MDQ6VXNlcjExNjM4NjE5","avatar_url":"https://avatars.githubusercontent.com/u/11638619?v=4","gravatar_id":"","url":"https://api.github.com/users/not-an-aardvark","html_url":"https://github.com/not-an-aardvark","followers_url":"https://api.github.com/users/not-an-aardvark/followers","following_url":"https://api.github.com/users/not-an-aardvark/following{/other_user}","gists_url":"https://api.github.com/users/not-an-aardvark/gists{/gist_id}","starred_url":"https://api.github.com/users/not-an-aardvark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/not-an-aardvark/subscriptions","organizations_url":"https://api.github.com/users/not-an-aardvark/orgs","repos_url":"https://api.github.com/users/not-an-aardvark/repos","events_url":"https://api.github.com/users/not-an-aardvark/events{/privacy}","received_events_url":"https://api.github.com/users/not-an-aardvark/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":18,"created_at":"2019-01-16T23:25:37Z","updated_at":"2020-11-17T17:28:22Z","closed_at":"2020-05-20T00:07:21Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n    ESLint adheres to the [JS Foundation Code of Conduct](https://js.foundation/community/code-of-conduct).\r\n\r\n    This template is for new rule proposals. If you are proposing a new rule, please continue on. If you are here for another reason, please see below:\r\n\r\n    1. To report a bug: https://eslint.org/docs/developer-guide/contributing/reporting-bugs\r\n    2. To request a rule change: https://eslint.org/docs/developer-guide/contributing/rule-changes\r\n    3. To request a change that is not a bug fix, rule change, or new rule: https://eslint.org/docs/developer-guide/contributing/changes\r\n    4. If you have any questions, please stop by our chatroom: https://gitter.im/eslint/eslint\r\n\r\n    Note that leaving sections blank will make it difficult for us to troubleshoot and we may have to close the issue.\r\n-->\r\n\r\n**Please describe what the rule should do:**\r\n\r\nThis rule would report number literals that immediately lose precision at runtime when converted to a JS `Number` (due to 64-bit floating-point rounding).\r\n\r\n**What category of rule is this? (place an \"X\" next to just one item)**\r\n\r\n[x] Warns about a potential error (problem)\r\n\r\n**Provide 2-3 code examples that this rule will warn about:**\r\n\r\n<!-- Put your code examples here -->\r\n```js\r\n// invalid\r\nconst largeConstant1 = 1234567890123456789;\r\nconst largeConstant2 = 1.234567890123456789e19;\r\n```\r\n\r\n`largeConstant1` and `largeConstant2` will actually end up with a `Number` of `1123456789012345676800`, because the mathematical value 1234567890123456789 is not precisely representable as a JS `Number`. The use of the digits `89` at the end of the literal are an attempt by the programmer to provide extra precision, but this extra precision doesn't appear at runtime, so the code probably contains a bug.\r\n\r\n```js\r\n// invalid\r\nconst longDecimal1 = 1.234567890123456789\r\n```\r\n\r\nSimilarly, `longDecimal1` will end up with a `Number` value of 1.2345678901234567, effectively dropping the digits `89`. The use of the trailing `89` is potentially confusing and probably a bug.\r\n\r\nThe rule uses [significant digits](https://en.wikipedia.org/wiki/Significant_figures) in order to determine the \"precision\" of a literal. As a result, there are a few cases where the rule would consider a literal to be valid despite the fact that the literal is not precisely representable as a `Number`. For example, the following examples would be considered valid:\r\n\r\n```js\r\n// valid\r\nconst shortDecimal1 = 0.11;\r\nconst largeConstant3 = 1e23;\r\nconst largeConstant4 = 100000000000000000000000;\r\n```\r\n\r\nAlthough the literal `0.11` gets converted to a mathematical value of 0.11000000000000000056..., the literal `0.11` is a correct approximation of that mathematical value to two significant digits. As a result, the use of the literal `0.11` is probably not a bug.\r\n\r\nSimilarly, although `largeConstant3` and `largeConstant4` get converted to a mathematical value of 99999999999999991611392, `1e23` and `100000000000000000000000` are both correct approximations of that mathematical value to one significant digit. As a result, the usage of these literals is probably not a bug.\r\n\r\nThe choice to not report an error for these cases is the main difference between this proposal and https://github.com/eslint/eslint/issues/8447.\r\n\r\nNote that the rule *would* report an error for a literal like `100000000000000000000000.0` (with a decimal point and a zero at the end), because that literal contains 25 significant digits rather than one significant digit, and the literal is not a correct approximation of that mathematical value to 25 significant digits.\r\n\r\nThe above rules also apply to other representations of number literals (binary, hex, and octal), although those literal representations only support integers. However, the rule would not report an error for `BigInt` literals, because `BigInt` literals don't have precision loss.\r\n\r\nI considered always reporting an error for imprecise binary/hex/octal literals (without looking at significant digits) because large binary/hex/octal literals are more often used to represent exact values (e.g. memory addresses) rather than approximate measurements. However, I decided to keep the behavior consistent to minimize false positives (e.g. to allow it to be added to `eslint:recommended` in the future).\r\n\r\n**Why should this rule be included in ESLint (instead of a plugin)?**\r\n\r\nThis rule would identify bugs resulting from a potentially-confusing aspect of the language, with very few false positives.\r\n\r\nFor an example of a bug like this, see https://github.com/tc39/proposal-bigint/issues/170. (The code in that example uses the experimental `BigInt` proposal, but fundamentally the footgun exists independent of the `BigInt` proposal.)\r\n\r\n**Are you willing to submit a pull request to implement this rule?**\r\n\r\nYes","closed_by":{"login":"nzakas","id":38546,"node_id":"MDQ6VXNlcjM4NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/38546?v=4","gravatar_id":"","url":"https://api.github.com/users/nzakas","html_url":"https://github.com/nzakas","followers_url":"https://api.github.com/users/nzakas/followers","following_url":"https://api.github.com/users/nzakas/following{/other_user}","gists_url":"https://api.github.com/users/nzakas/gists{/gist_id}","starred_url":"https://api.github.com/users/nzakas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nzakas/subscriptions","organizations_url":"https://api.github.com/users/nzakas/orgs","repos_url":"https://api.github.com/users/nzakas/repos","events_url":"https://api.github.com/users/nzakas/events{/privacy}","received_events_url":"https://api.github.com/users/nzakas/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eslint/eslint/issues/11279/reactions","total_count":9,"+1":9,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eslint/eslint/issues/11279/timeline","performed_via_github_app":null,"state_reason":"completed"}