{"url":"https://api.github.com/repos/eslint/eslint/issues/15467","repository_url":"https://api.github.com/repos/eslint/eslint","labels_url":"https://api.github.com/repos/eslint/eslint/issues/15467/labels{/name}","comments_url":"https://api.github.com/repos/eslint/eslint/issues/15467/comments","events_url":"https://api.github.com/repos/eslint/eslint/issues/15467/events","html_url":"https://github.com/eslint/eslint/issues/15467","id":1090766458,"node_id":"I_kwDOAKjKDc5BA8Z6","number":15467,"title":"Bug: False positives with no-constant-condition","user":{"login":"captbaritone","id":162735,"node_id":"MDQ6VXNlcjE2MjczNQ==","avatar_url":"https://avatars.githubusercontent.com/u/162735?v=4","gravatar_id":"","url":"https://api.github.com/users/captbaritone","html_url":"https://github.com/captbaritone","followers_url":"https://api.github.com/users/captbaritone/followers","following_url":"https://api.github.com/users/captbaritone/following{/other_user}","gists_url":"https://api.github.com/users/captbaritone/gists{/gist_id}","starred_url":"https://api.github.com/users/captbaritone/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captbaritone/subscriptions","organizations_url":"https://api.github.com/users/captbaritone/orgs","repos_url":"https://api.github.com/users/captbaritone/repos","events_url":"https://api.github.com/users/captbaritone/events{/privacy}","received_events_url":"https://api.github.com/users/captbaritone/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":45711350,"node_id":"MDU6TGFiZWw0NTcxMTM1MA==","url":"https://api.github.com/repos/eslint/eslint/labels/bug","name":"bug","color":"fc2929","default":true,"description":"ESLint is working incorrectly"},{"id":131106229,"node_id":"MDU6TGFiZWwxMzExMDYyMjk=","url":"https://api.github.com/repos/eslint/eslint/labels/accepted","name":"accepted","color":"0052cc","default":false,"description":"There is consensus among the team that this change meets the criteria for inclusion"},{"id":829215248,"node_id":"MDU6TGFiZWw4MjkyMTUyNDg=","url":"https://api.github.com/repos/eslint/eslint/labels/archived%20due%20to%20age","name":"archived due to age","color":"eeeeee","default":false,"description":"This issue has been archived; please open a new issue for any further discussion"},{"id":2786823532,"node_id":"MDU6TGFiZWwyNzg2ODIzNTMy","url":"https://api.github.com/repos/eslint/eslint/labels/repro:yes","name":"repro:yes","color":"7A14E9","default":false,"description":"Issues with a reproducible example"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2021-12-29T21:54:35Z","updated_at":"2022-07-11T00:57:42Z","closed_at":"2022-01-11T00:56:06Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Environment\r\n\r\nOnline Playground\r\n\r\n### What parser are you using?\r\n\r\nDefault (Espree)\r\n\r\n### What did you do?\r\n\r\n```js\r\nif(`${[...a]}`) {\r\n  //\r\n};\r\n\r\nif(`${[{toString: () => a}]}`) {\r\n  //\r\n};\r\n\r\n\r\nif(\"\" + {toString: () => a}) {\r\n  //\r\n}\r\n\r\nif(\"\" + [{toString: () => a}]) {\r\n  //\r\n};\r\n\r\nif(+[{toString: () => a}]) {\r\n  //\r\n};\r\n\r\n\r\n\r\n```\r\n\r\n[Playground Link](https://eslint.org/demo#eyJ0ZXh0IjoiXG5pZihgJHtbLi4uYV19YCkge1xuICAvL1xufTtcblxuaWYoYCR7W3t0b1N0cmluZzogKCkgPT4gYX1dfWApIHtcbiAgLy9cbn07XG5cblxuaWYoXCJcIiArIHt0b1N0cmluZzogKCkgPT4gYX0pIHtcbiAgLy9cbn1cblxuaWYoXCJcIiArIFt7dG9TdHJpbmc6ICgpID0+IGF9XSkge1xuICAvL1xufTtcblxuaWYoK1t7dG9TdHJpbmc6ICgpID0+IGF9XSkge1xuICAvL1xufTtcblxuXG4iLCJvcHRpb25zIjp7InBhcnNlck9wdGlvbnMiOnsiZWNtYVZlcnNpb24iOiJsYXRlc3QiLCJzb3VyY2VUeXBlIjoic2NyaXB0IiwiZWNtYUZlYXR1cmVzIjp7fX0sInJ1bGVzIjp7Im5vLWNvbnN0YW50LWNvbmRpdGlvbiI6Mn0sImVudiI6e319fQ==)\r\n\r\n### What did you expect to happen?\r\n\r\nNo errors\r\n\r\n### What actually happened?\r\n\r\nEach condition triggers `no-constant-condition`\r\n\r\n### Participation\r\n\r\n- [ ] I am willing to submit a pull request for this issue.\r\n\r\n### Additional comments\r\n\r\nI was looking into the implementation of the `isConstant` function in `no-constant-condition` as part of #15296. Specifically I was trying to understand the meaning of the case where the `inBooleanPosition` flag is set to false.\r\n\r\nI realized that the reason I was having such a hard time understanding it is that it's not really sound. For example, we call `isConstant` with `inBooleanPosition = false` in cases where values are going to get coerced into numbers or strings and we want to know if the resulting string/number will have constant truthiness. However, the checks are not sufficient to actually validate that.\r\n\r\nI think that currently isConstant with inBooleanPosition set to false is supposed to check if a value has constant truthiness, even when that value is being first coerced to some other type (string/number/...). I'm not sure that's a function which is feasible to write correctly. Instead, I suspect we will want individual functions that handle the string and number cases, or something along those lines.\r\n\r\nRather than trying to solve this by adding more special cases to `isConstant` (which is already rather hard to grock), I wonder if we could break it up into a collection of simpler helper functions which check for more explicit cases.","closed_by":{"login":"nzakas","id":38546,"node_id":"MDQ6VXNlcjM4NTQ2","avatar_url":"https://avatars.githubusercontent.com/u/38546?v=4","gravatar_id":"","url":"https://api.github.com/users/nzakas","html_url":"https://github.com/nzakas","followers_url":"https://api.github.com/users/nzakas/followers","following_url":"https://api.github.com/users/nzakas/following{/other_user}","gists_url":"https://api.github.com/users/nzakas/gists{/gist_id}","starred_url":"https://api.github.com/users/nzakas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nzakas/subscriptions","organizations_url":"https://api.github.com/users/nzakas/orgs","repos_url":"https://api.github.com/users/nzakas/repos","events_url":"https://api.github.com/users/nzakas/events{/privacy}","received_events_url":"https://api.github.com/users/nzakas/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eslint/eslint/issues/15467/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eslint/eslint/issues/15467/timeline","performed_via_github_app":null,"state_reason":"completed"}