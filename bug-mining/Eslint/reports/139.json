{"url":"https://api.github.com/repos/eslint/eslint/issues/10893","repository_url":"https://api.github.com/repos/eslint/eslint","labels_url":"https://api.github.com/repos/eslint/eslint/issues/10893/labels{/name}","comments_url":"https://api.github.com/repos/eslint/eslint/issues/10893/comments","events_url":"https://api.github.com/repos/eslint/eslint/issues/10893/events","html_url":"https://github.com/eslint/eslint/issues/10893","id":363756624,"node_id":"MDU6SXNzdWUzNjM3NTY2MjQ=","number":10893,"title":"require-atomic-updates takes a very long time to run on large files","user":{"login":"reintroducing","id":259901,"node_id":"MDQ6VXNlcjI1OTkwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/259901?v=4","gravatar_id":"","url":"https://api.github.com/users/reintroducing","html_url":"https://github.com/reintroducing","followers_url":"https://api.github.com/users/reintroducing/followers","following_url":"https://api.github.com/users/reintroducing/following{/other_user}","gists_url":"https://api.github.com/users/reintroducing/gists{/gist_id}","starred_url":"https://api.github.com/users/reintroducing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reintroducing/subscriptions","organizations_url":"https://api.github.com/users/reintroducing/orgs","repos_url":"https://api.github.com/users/reintroducing/repos","events_url":"https://api.github.com/users/reintroducing/events{/privacy}","received_events_url":"https://api.github.com/users/reintroducing/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":45711350,"node_id":"MDU6TGFiZWw0NTcxMTM1MA==","url":"https://api.github.com/repos/eslint/eslint/labels/bug","name":"bug","color":"fc2929","default":true,"description":"ESLint is working incorrectly"},{"id":45798639,"node_id":"MDU6TGFiZWw0NTc5ODYzOQ==","url":"https://api.github.com/repos/eslint/eslint/labels/rule","name":"rule","color":"fbca04","default":false,"description":"Relates to ESLint's core rules"},{"id":131106229,"node_id":"MDU6TGFiZWwxMzExMDYyMjk=","url":"https://api.github.com/repos/eslint/eslint/labels/accepted","name":"accepted","color":"0052cc","default":false,"description":"There is consensus among the team that this change meets the criteria for inclusion"},{"id":829215248,"node_id":"MDU6TGFiZWw4MjkyMTUyNDg=","url":"https://api.github.com/repos/eslint/eslint/labels/archived%20due%20to%20age","name":"archived due to age","color":"eeeeee","default":false,"description":"This issue has been archived; please open a new issue for any further discussion"}],"state":"closed","locked":true,"assignee":{"login":"not-an-aardvark","id":11638619,"node_id":"MDQ6VXNlcjExNjM4NjE5","avatar_url":"https://avatars.githubusercontent.com/u/11638619?v=4","gravatar_id":"","url":"https://api.github.com/users/not-an-aardvark","html_url":"https://github.com/not-an-aardvark","followers_url":"https://api.github.com/users/not-an-aardvark/followers","following_url":"https://api.github.com/users/not-an-aardvark/following{/other_user}","gists_url":"https://api.github.com/users/not-an-aardvark/gists{/gist_id}","starred_url":"https://api.github.com/users/not-an-aardvark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/not-an-aardvark/subscriptions","organizations_url":"https://api.github.com/users/not-an-aardvark/orgs","repos_url":"https://api.github.com/users/not-an-aardvark/repos","events_url":"https://api.github.com/users/not-an-aardvark/events{/privacy}","received_events_url":"https://api.github.com/users/not-an-aardvark/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"not-an-aardvark","id":11638619,"node_id":"MDQ6VXNlcjExNjM4NjE5","avatar_url":"https://avatars.githubusercontent.com/u/11638619?v=4","gravatar_id":"","url":"https://api.github.com/users/not-an-aardvark","html_url":"https://github.com/not-an-aardvark","followers_url":"https://api.github.com/users/not-an-aardvark/followers","following_url":"https://api.github.com/users/not-an-aardvark/following{/other_user}","gists_url":"https://api.github.com/users/not-an-aardvark/gists{/gist_id}","starred_url":"https://api.github.com/users/not-an-aardvark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/not-an-aardvark/subscriptions","organizations_url":"https://api.github.com/users/not-an-aardvark/orgs","repos_url":"https://api.github.com/users/not-an-aardvark/repos","events_url":"https://api.github.com/users/not-an-aardvark/events{/privacy}","received_events_url":"https://api.github.com/users/not-an-aardvark/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2018-09-25T20:38:32Z","updated_at":"2019-03-28T19:16:48Z","closed_at":"2018-09-28T17:11:45Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n    ESLint adheres to the [JS Foundation Code of Conduct](https://js.foundation/community/code-of-conduct).\r\n\r\n    This template is for bug reports. If you are here for another reason, please see below:\r\n\r\n    1. To propose a new rule: https://eslint.org/docs/developer-guide/contributing/new-rules\r\n    2. To request a rule change: https://eslint.org/docs/developer-guide/contributing/rule-changes\r\n    3. To request a change that is not a bug fix, rule change, or new rule: https://eslint.org/docs/developer-guide/contributing/changes\r\n    4. If you have any questions, please stop by our chatroom: https://gitter.im/eslint/eslint\r\n\r\n    Note that leaving sections blank will make it difficult for us to troubleshoot and we may have to close the issue.\r\n-->\r\n\r\n**Tell us about your environment**\r\n\r\n* **ESLint Version:** 5.6 (though issue starts at 5.3)\r\n* **Node Version:** 10.3.0\r\n* **npm Version:** 6.1.0\r\n\r\n**What parser (default, Babel-ESLint, etc.) are you using?**\r\nbabel-eslint\r\n\r\n**Please show your full configuration:**\r\n\r\n<details>\r\n<summary>Configuration</summary>\r\n\r\n<!-- Paste your configuration below: -->\r\n```js\r\n{\r\n    \"extends\": \"@spothero\",\r\n    \"settings\": {\r\n        \"react\": {\r\n            \"version\": \"latest\"\r\n        }\r\n    },\r\n    \"rules\": {\r\n        \"require-atomic-updates\": 2\r\n    }\r\n}\r\n\r\n```\r\n\r\n</details>\r\n\r\n**What did you do? Please include the actual source code causing the issue, as well as the command that you used to run ESLint.**\r\n\r\n<!-- Paste the source code below: -->\r\n```js\r\nimport includes from 'lodash/includes';\r\nimport moment from 'moment';\r\nimport APIUtils from '@spothero/utils/api';\r\nimport StorageUtils from '@spothero/utils/storage';\r\nimport Config from 'config';\r\nimport UserUtils from 'user/user-utils';\r\nimport SearchTracking from 'utils/search-tracking';\r\nimport SegmentUtils from 'utils/segment';\r\n\r\nconst ReservationAPI = {\r\n    async add({\r\n        checkoutData,\r\n        selectedRate,\r\n        monthlyStarts = null,\r\n        facility,\r\n        onError,\r\n        stripeToken = false,\r\n        stripePaymentType = 'cc',\r\n        setNewCardAsDefault = false,\r\n        onSuccess = null,\r\n        includeVehicleInResponse = false,\r\n        includeFacilityInResponse = false,\r\n        source = null,\r\n        rentalSourceReferrer = null,\r\n        checkoutStartTime = null\r\n    }) {\r\n        const {\r\n            user,\r\n            promoCode,\r\n            isMonthly,\r\n            eventId,\r\n            paymentRequired,\r\n            purchaseForCustomer,\r\n            purchaseForCustomerReferralSource,\r\n            purchaseForCustomerDescription,\r\n            purchaseOnBehalfOfCustomer,\r\n            affiliate,\r\n            phoneNumberRequired,\r\n            selectedCreditCard,\r\n            licensePlateRequired,\r\n            selectedLicensePlate,\r\n            licensePlateState,\r\n            newLicensePlate,\r\n            newLicensePlateName,\r\n            newLicensePlateIsDefault,\r\n            referralSource,\r\n            smsParkingPass,\r\n            forceRedundantMonthly,\r\n            vehicleMake,\r\n            vehicleModel,\r\n            vehicleYear,\r\n            vehicleColor,\r\n            saveVehicleAsDefault,\r\n            acceptedTerms,\r\n            contractFullName\r\n        } = checkoutData;\r\n        const ratePrice = (selectedRate.price / 100);\r\n        const phoneNumberCleaned = (user.phoneNumber) ? user.phoneNumber.replace(/\\D/g, '') : null;\r\n        const isUserSavingNewCard = (user.status === UserUtils.AUTH_STATE.USER && selectedCreditCard === 'new' && !purchaseForCustomer && paymentRequired);\r\n        const isMonthlyRecurringNewCard = (selectedCreditCard === 'new' && isMonthly && selectedRate.recurrable);\r\n        const isPaymentRequired = (selectedCreditCard === 'admin') ? false : paymentRequired;\r\n        const {\r\n            searchUUID,\r\n            actionUUID\r\n        } = SearchTracking.getValues();\r\n        const postData = {\r\n            email: user.email,\r\n            price: parseInt(Math.round(Number(ratePrice) * 100), 10),\r\n            facility: facility.parking_spot_id,\r\n            apply_sh_credit: (user.status === UserUtils.AUTH_STATE.USER),\r\n            search_id: searchUUID,\r\n            action_id: actionUUID\r\n        };\r\n        const config = {};\r\n        const shExperimentVariations = StorageUtils.get('sh-experiment-variations', 'cookie');\r\n\r\n        if (includeFacilityInResponse) {\r\n            postData.include = 'facility';\r\n        }\r\n\r\n        if (includeVehicleInResponse) {\r\n            if (postData.include) {\r\n                postData.include += ',vehicle_info';\r\n            } else {\r\n                postData.include = 'vehicle_info';\r\n            }\r\n        }\r\n\r\n        if (isMonthly) {\r\n            postData.monthly_start_date = moment(monthlyStarts).format(Config.apiDateFormat);\r\n            postData.rule = selectedRate.fullRule;\r\n        } else {\r\n            postData.starts = selectedRate.starts;\r\n            postData.ends = selectedRate.ends;\r\n            postData.rule_group_id = selectedRate.rule_group_id;\r\n        }\r\n\r\n        if (eventId) {\r\n            postData.event = eventId;\r\n        }\r\n\r\n        if (user.phoneNumber && !phoneNumberCleaned) {\r\n            postData.phone_number = user.phoneNumber;\r\n        } else {\r\n            if (phoneNumberCleaned) {\r\n                postData.phone_number = phoneNumberCleaned;\r\n            }\r\n        }\r\n    },\r\n};\r\n\r\nexport default ReservationAPI;\r\n```\r\n\r\n<!-- Paste the command you used to run ESLint: -->\r\n```bash\r\neslint test.js\r\n```\r\n\r\n**What did you expect to happen?**\r\nESLint runs quickly on that file and shows all errors.\r\n\r\n**What actually happened? Please include the actual, raw output from ESLint.**\r\nThe expected behavior happened, however it took WAY longer than it should have on this file. The file is contrived, its just a part of a file in our codebase where I started to see issues when I started to drill down into this.  We just upgraded from ESLint 5.2 to 5.6 on a large codebase and ESLint was stalling. We use our own config (https://github.com/spothero/eslint-config) so I naturally thought it was something I had messed up in the config.\r\n\r\nI then created a repo that just had the `test.js` file and the above `.eslintrc` file. Through editing various things, I was finally able to realize that the `require-atomic-updates` rule was the culprit. If you disable it in the config with `0`, the file executes quickly. If you enable it, the file takes MUCH longer to execute. This becomes magnified when you have many files in the codebase and ESLint just seems to hang without ever finishing them and moving on to the next build step.","closed_by":{"login":"not-an-aardvark","id":11638619,"node_id":"MDQ6VXNlcjExNjM4NjE5","avatar_url":"https://avatars.githubusercontent.com/u/11638619?v=4","gravatar_id":"","url":"https://api.github.com/users/not-an-aardvark","html_url":"https://github.com/not-an-aardvark","followers_url":"https://api.github.com/users/not-an-aardvark/followers","following_url":"https://api.github.com/users/not-an-aardvark/following{/other_user}","gists_url":"https://api.github.com/users/not-an-aardvark/gists{/gist_id}","starred_url":"https://api.github.com/users/not-an-aardvark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/not-an-aardvark/subscriptions","organizations_url":"https://api.github.com/users/not-an-aardvark/orgs","repos_url":"https://api.github.com/users/not-an-aardvark/repos","events_url":"https://api.github.com/users/not-an-aardvark/events{/privacy}","received_events_url":"https://api.github.com/users/not-an-aardvark/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/eslint/eslint/issues/10893/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/eslint/eslint/issues/10893/timeline","performed_via_github_app":null,"state_reason":"completed"}