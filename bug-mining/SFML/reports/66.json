{"url":"https://api.github.com/repos/SFML/SFML/issues/2057","repository_url":"https://api.github.com/repos/SFML/SFML","labels_url":"https://api.github.com/repos/SFML/SFML/issues/2057/labels{/name}","comments_url":"https://api.github.com/repos/SFML/SFML/issues/2057/comments","events_url":"https://api.github.com/repos/SFML/SFML/issues/2057/events","html_url":"https://github.com/SFML/SFML/issues/2057","id":1191810393,"node_id":"I_kwDOABdDzM5HCZVZ","number":2057,"title":"Crash accessing DirectInput in Release build with optimizations enabled","user":{"login":"eigenl","id":5843337,"node_id":"MDQ6VXNlcjU4NDMzMzc=","avatar_url":"https://avatars.githubusercontent.com/u/5843337?v=4","gravatar_id":"","url":"https://api.github.com/users/eigenl","html_url":"https://github.com/eigenl","followers_url":"https://api.github.com/users/eigenl/followers","following_url":"https://api.github.com/users/eigenl/following{/other_user}","gists_url":"https://api.github.com/users/eigenl/gists{/gist_id}","starred_url":"https://api.github.com/users/eigenl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eigenl/subscriptions","organizations_url":"https://api.github.com/users/eigenl/orgs","repos_url":"https://api.github.com/users/eigenl/repos","events_url":"https://api.github.com/users/eigenl/events{/privacy}","received_events_url":"https://api.github.com/users/eigenl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":85849,"node_id":"MDU6TGFiZWw4NTg0OQ==","url":"https://api.github.com/repos/SFML/SFML/labels/bug","name":"bug","color":"ff4242","default":true,"description":null},{"id":85855,"node_id":"MDU6TGFiZWw4NTg1NQ==","url":"https://api.github.com/repos/SFML/SFML/labels/m:sfml-window","name":"m:sfml-window","color":"cccccc","default":false,"description":null},{"id":100769559,"node_id":"MDU6TGFiZWwxMDA3Njk1NTk=","url":"https://api.github.com/repos/SFML/SFML/labels/p:windows","name":"p:windows","color":"888888","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/SFML/SFML/milestones/13","html_url":"https://github.com/SFML/SFML/milestone/13","labels_url":"https://api.github.com/repos/SFML/SFML/milestones/13/labels","id":1194243,"node_id":"MDk6TWlsZXN0b25lMTE5NDI0Mw==","number":13,"title":"3.0","description":"Next major version, SFML 3","creator":{"login":"Bromeon","id":708488,"node_id":"MDQ6VXNlcjcwODQ4OA==","avatar_url":"https://avatars.githubusercontent.com/u/708488?v=4","gravatar_id":"","url":"https://api.github.com/users/Bromeon","html_url":"https://github.com/Bromeon","followers_url":"https://api.github.com/users/Bromeon/followers","following_url":"https://api.github.com/users/Bromeon/following{/other_user}","gists_url":"https://api.github.com/users/Bromeon/gists{/gist_id}","starred_url":"https://api.github.com/users/Bromeon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Bromeon/subscriptions","organizations_url":"https://api.github.com/users/Bromeon/orgs","repos_url":"https://api.github.com/users/Bromeon/repos","events_url":"https://api.github.com/users/Bromeon/events{/privacy}","received_events_url":"https://api.github.com/users/Bromeon/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":1094,"state":"closed","created_at":"2015-07-06T06:56:33Z","updated_at":"2025-07-17T21:59:55Z","due_on":null,"closed_at":"2024-12-21T00:00:13Z"},"comments":2,"created_at":"2022-04-04T13:40:19Z","updated_at":"2022-04-07T06:48:21Z","closed_at":"2022-04-07T06:48:21Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Crash accessing DirectInput in Release build with optimizations enabled\r\n\r\nWanted to try out the latest master build and after upgrading my toolchain it seems to build fine. But I ran into an issue with running the Release build, in particular when compiled with any optimizations (O1, O2, O3). It simply crashes as soon as RenderWindow is created. Through trial and error I managed to track down the commit and through even more trial and error the particular change causing the issue.\r\n\r\nhttps://github.com/SFML/SFML/commit/9a0cc4b7dc8dae79fc912a04a9d4679d42815a4a#diff-656b585bfaca15adbabda9a47820c2741686549a2c5391c030feb497a77c9fc3L406\r\n\r\nThis change in src/SFML/Window/Win32/JoystickImpl.cpp:\r\n```cpp\r\n- typedef HRESULT(WINAPI *DirectInput8CreateFunc)(HINSTANCE, DWORD, REFIID, LPVOID*, LPUNKNOWN);\r\n+ using DirectInput8CreateFunc = HRESULT (*)(HINSTANCE, DWORD, const IID &, LPVOID *, LPUNKNOWN);\r\n```\r\nAdding back WINAPI to the function signature seems to resolve the issue, so that it becomes:\r\n```cpp\r\nusing DirectInput8CreateFunc = HRESULT (WINAPI *)(HINSTANCE, DWORD, const IID &, LPVOID *, LPUNKNOWN);\r\n```\r\nI'm not sure why that is and why it's not an issue elsewhere. WINAPI is also removed in setProcessDpiAware function in the same commit and doesn't seem to cause an issue. This doesn't happen in the debug build or in release build if optimizations are not performed.\r\n\r\n## Your environment\r\n\r\n* Windows 7 SP1\r\n* Latest master build\r\n* MinGW32, GCC 11.2.0 (posix thread model)\r\n\r\n```cpp\r\n#include <SFML/Graphics.hpp>\r\n\r\nint main()\r\n{\r\n    sf::RenderWindow window(sf::VideoMode(1280, 720), \"Minimal, complete and verifiable example\");\r\n    return 0;\r\n}\r\n```\r\n\r\n## Expected behavior\r\n\r\nProcess should terminate with status code 0\r\n\r\n## Actual behavior\r\n\r\nApplication crashes as soon as render window is created.\r\n","closed_by":{"login":"eXpl0it3r","id":920861,"node_id":"MDQ6VXNlcjkyMDg2MQ==","avatar_url":"https://avatars.githubusercontent.com/u/920861?v=4","gravatar_id":"","url":"https://api.github.com/users/eXpl0it3r","html_url":"https://github.com/eXpl0it3r","followers_url":"https://api.github.com/users/eXpl0it3r/followers","following_url":"https://api.github.com/users/eXpl0it3r/following{/other_user}","gists_url":"https://api.github.com/users/eXpl0it3r/gists{/gist_id}","starred_url":"https://api.github.com/users/eXpl0it3r/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eXpl0it3r/subscriptions","organizations_url":"https://api.github.com/users/eXpl0it3r/orgs","repos_url":"https://api.github.com/users/eXpl0it3r/repos","events_url":"https://api.github.com/users/eXpl0it3r/events{/privacy}","received_events_url":"https://api.github.com/users/eXpl0it3r/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/SFML/SFML/issues/2057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/SFML/SFML/issues/2057/timeline","performed_via_github_app":null,"state_reason":"completed"}