<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4677] Display failure information on stop on failure</title>
                <link>https://issues.apache.org/jira/browse/PIG-4677</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;When stop on failure option is specified, pig abruptly exits without displaying any job stats or failed job information which it usually does in case of failures.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-06-04 20:35:38,170 [uber-SubtaskRunner] INFO  org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher  - 9% complete
2015-06-04 20:35:38,171 [uber-SubtaskRunner] INFO  org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher  - Running jobs are [job_1428329756093_3741748,job_1428329756093_3741752,job_1428329756093_3741753,job_1428329756093_3741754,job_1428329756093_3741756]
2015-06-04 20:35:40,201 [uber-SubtaskRunner] ERROR org.apache.pig.tools.grunt.Grunt  - ERROR 6017: Job failed!
Hadoop Job IDs executed by Pig: job_1428329756093_3739816,job_1428329756093_3741752,job_1428329756093_3739814,job_1428329756093_3741748,job_1428329756093_3741756,job_1428329756093_3741753,job_1428329756093_3741754

&amp;lt;&amp;lt;&amp;lt; Invocation of Main &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;completed &amp;lt;&amp;lt;&amp;lt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12864037">PIG-4677</key>
            <summary>Display failure information on stop on failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rohini">Rohini Palaniswamy</assignee>
                                    <reporter username="mitdesai">Mit Desai</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Sep 2015 21:27:37 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:33 +0000</updated>
                            <resolved>Thu, 30 Mar 2017 14:38:53 +0000</resolved>
                                    <version>0.11.1</version>
                                    <fixVersion>0.17.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14744308" author="mitdesai" created="Mon, 14 Sep 2015 21:29:25 +0000"  >&lt;p&gt;Attaching the patch&lt;/p&gt;</comment>
                            <comment id="14791270" author="rohini" created="Wed, 16 Sep 2015 23:05:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mitdesai&quot; class=&quot;user-hover&quot; rel=&quot;mitdesai&quot;&gt;mitdesai&lt;/a&gt;,&lt;br/&gt;
   checkStopOnFailure currently throws an exception which makes it exit early. So it ends up skipping cleanupOnFailure, printing &quot;Job Stats&quot; information, etc. i.e all code starting from MRScriptState.get().emitProgressUpdatedNotification(100);. &lt;/p&gt;

&lt;p&gt;  So instead of throwing exception and exiting early and relying on system shutdown hook to kill the remaining jobs, you will have to call failJob(message) on JobControl.getReadyJobsList() and  JobControl.getRunningJobList() in checkStopOnFailure. That will kill all jobs and will then follow the regular code path.&lt;/p&gt;</comment>
                            <comment id="14804566" author="mitdesai" created="Thu, 17 Sep 2015 21:42:01 +0000"  >&lt;p&gt;Oh.&lt;br/&gt;
I will update the patch.&lt;/p&gt;</comment>
                            <comment id="14876414" author="mitdesai" created="Fri, 18 Sep 2015 21:07:03 +0000"  >&lt;p&gt;Updated the patch.&lt;/p&gt;</comment>
                            <comment id="14876652" author="rohini" created="Fri, 18 Sep 2015 23:06:55 +0000"  >&lt;p&gt;It should still be assertFalse(server.existsFile(&quot;done&quot;)); . With this change it is still not stopping execution of the script when it is compiled in two phases due to fs statements. Will have to make checkStopOnFailure return true instead of void, and throw new ExecException(msg.toString(), errCode, PigException.REMOTE_ENVIRONMENT); instead of return pigStats at the end in launchPig if checkStopOnFailure returned true. &lt;/p&gt;</comment>
                            <comment id="14900701" author="mitdesai" created="Mon, 21 Sep 2015 13:42:51 +0000"  >&lt;p&gt;Thanks for the Review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;. Updated the patch.&lt;/p&gt;

&lt;p&gt;In the ExecException, the message used to be &quot;job_id Job Failed!&quot;. I have changed it to &quot;Some jobs failed. stop.on.failure set true. Stopping execution&quot;. What job failed can now be easily found out by looking at the Script Status which will look something like this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Error: org.apache.pig.backend.executionengine.ExecException: ERROR 2055: Received Error while processing the map plan: &apos;false (stdin-org.apache.pig.builtin.PigStreaming/stdout-org.apache.pig.builtin.PigStreaming)&apos; failed with exit status: 1
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.runPipeline(PigGenericMapBase.java:307)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:274)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:64)
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:784)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:341)
	at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:163)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:415)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1628)
	at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)

2015-09-20 16:44:56,874 [main] ERROR org.apache.pig.tools.pigstats.PigStats  - ERROR 0: org.apache.pig.backend.executionengine.ExecException: ERROR 2055: Received Error while processing the map plan: &apos;false (stdin-org.apache.pig.builtin.PigStreaming/stdout-org.apache.pig.builtin.PigStreaming)&apos; failed with exit status: 1
2015-09-20 16:44:56,874 [main] ERROR org.apache.pig.tools.pigstats.mapreduce.MRPigStatsUtil  - 1 map reduce job(s) failed!
2015-09-20 16:44:56,875 [main] INFO  org.apache.pig.tools.pigstats.mapreduce.SimplePigStats  - Script Statistics: 

HadoopVersion	PigVersion	UserId	StartedAt	FinishedAt	Features
2.6.0	0.16.0-SNAPSHOT	mitdesai	2015-09-20 16:44:38	2015-09-20 16:44:56	STREAMING

Failed!

Failed Jobs:
JobId	Alias	Feature	Message	Outputs
job_1442785471589_0001	A,B	STREAMING,MAP_ONLY	Message: Job failed!	hdfs://localhost:63266/user/mitdesai/bar,

Input(s):

Output(s):
Failed to produce result in &quot;hdfs://localhost:63266/user/mitdesai/bar&quot;

Counters:
Total records written : 0
Total bytes written : 0
Spillable Memory Manager spill count : 0
Total bags proactively spilled: 0
Total records proactively spilled: 0

Job DAG:
job_1442785471589_0001	-&amp;gt;	null,
null


2015-09-20 16:44:56,875 [main] INFO  org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher  - Failed!
2015-09-20 16:44:56,876 [IPC Server handler 8 on 63266] INFO  org.apache.hadoop.hdfs.server.namenode.FSNamesystem.audit  - allowed=true	ugi=mitdesai (auth:SIMPLE)	ip=/127.0.0.1	cmd=getfileinfo	src=/user/mitdesai/bar	dst=null	perm=null	proto=rpc
2015-09-20 16:44:56,878 [IPC Server handler 9 on 63266] INFO  org.apache.hadoop.hdfs.server.namenode.FSNamesystem.audit  - allowed=true	ugi=mitdesai (auth:SIMPLE)	ip=/127.0.0.1	cmd=delete	src=/user/mitdesai/bar	dst=null	perm=null	proto=rpc
2015-09-20 16:44:56,879 [main] ERROR org.apache.pig.tools.grunt.Grunt  - ERROR 6017: stop.on.failure set true. Some jobs failed. Stopping Execution
2015-09-20 16:44:56,879 [main] WARN  org.apache.pig.tools.grunt.Grunt  - There is no log file to write to.
2015-09-20 16:44:56,879 [main] ERROR org.apache.pig.tools.grunt.Grunt  - org.apache.pig.backend.executionengine.ExecException: ERROR 6017: stop.on.failure set true. Some jobs failed. Stopping Execution
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.launchPig(MapReduceLauncher.java:546)
	at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.launchPig(HExecutionEngine.java:304)
	at org.apache.pig.PigServer.launchPlan(PigServer.java:1390)
	at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:1375)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14900703" author="mitdesai" created="Mon, 21 Sep 2015 13:44:59 +0000"  >&lt;p&gt;The ExecException message is different in the log here. I forgot to rerun the test after modifying the error message.&lt;/p&gt;</comment>
                            <comment id="15123890" author="mitdesai" created="Fri, 29 Jan 2016 18:03:57 +0000"  >&lt;p&gt;Updated the patch.&lt;/p&gt;</comment>
                            <comment id="15945995" author="rohini" created="Tue, 28 Mar 2017 21:28:20 +0000"  >&lt;p&gt;With the attached patch, it display job stats when stop on failure is set as below in mapreduce.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2017-03-28 14:15:04,580 [main] ERROR org.apache.pig.tools.pigstats.PigStats - ERROR 0: org.apache.pig.backend.executionengine.ExecException: ERROR 2055: Received Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; processing the map plan: &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; (stdin-org.apache.pig.builtin.PigStreaming/stdout-org.apache.pig.builtin.PigStreaming)&apos;&lt;/span&gt; failed with exit status: 1
2017-03-28 14:15:04,580 [main] ERROR org.apache.pig.tools.pigstats.mapreduce.MRPigStatsUtil - 2 map reduce job(s) failed!
2017-03-28 14:15:04,580 [main] INFO  org.apache.pig.tools.pigstats.mapreduce.SimplePigStats - Script Statistics:

HadoopVersion   PigVersion      UserId  StartedAt       FinishedAt      Features
2.7.3   0.17.0-SNAPSHOT rohinip 2017-03-28 14:14:41     2017-03-28 14:15:04     STREAMING

Failed!

Failed Jobs:
JobId   Alias   Feature Message Outputs
job_1490735309298_0017  A,B     STREAMING,MAP_ONLY      Message: Job failed!    hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:56480/bar,
&lt;/span&gt;job_1490735309298_0018  A1      MAP_ONLY        Message: Failing running job &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; -stop_on_failure: job_1490735309298_0018       hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:56480/bar1,
&lt;/span&gt;
Input(s):

Output(s):
Failed to produce result in &lt;span class=&quot;code-quote&quot;&gt;&quot;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:56480/bar&quot;&lt;/span&gt;
&lt;/span&gt;Failed to produce result in &lt;span class=&quot;code-quote&quot;&gt;&quot;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:56480/bar1&quot;&lt;/span&gt;
&lt;/span&gt;
Counters:
Total records written : 0
Total bytes written : 0
Spillable Memory Manager spill count : 0
Total bags proactively spilled: 0
Total records proactively spilled: 0

Job DAG:
job_1490735309298_0017  -&amp;gt;      &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
job_1490735309298_0018
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15948477" author="daijy" created="Thu, 30 Mar 2017 06:12:44 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15949189" author="rohini" created="Thu, 30 Mar 2017 14:38:53 +0000"  >&lt;p&gt;Committed to trunk. Thanks for the review Daniel.&lt;/p&gt;</comment>
                            <comment id="15951691" author="rohini" created="Fri, 31 Mar 2017 21:52:02 +0000"  >&lt;p&gt;The test was flaky based on the order of jobs launched. Fixed the assert statements for that in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4677&quot; title=&quot;Display failure information on stop on failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4677&quot;&gt;&lt;del&gt;PIG-4677&lt;/del&gt;&lt;/a&gt;-fixflakytest.patch.&lt;/p&gt;</comment>
                            <comment id="15951709" author="daijy" created="Fri, 31 Mar 2017 22:08:11 +0000"  >&lt;p&gt;+1 on &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4677&quot; title=&quot;Display failure information on stop on failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4677&quot;&gt;&lt;del&gt;PIG-4677&lt;/del&gt;&lt;/a&gt;-fixflakytest.patch.&lt;/p&gt;</comment>
                            <comment id="15951726" author="rohini" created="Fri, 31 Mar 2017 22:29:29 +0000"  >&lt;p&gt;Committed  &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4677&quot; title=&quot;Display failure information on stop on failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4677&quot;&gt;&lt;del&gt;PIG-4677&lt;/del&gt;&lt;/a&gt;-fixflakytest.patch to trunk. Thanks Daniel for the review.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12860941" name="PIG-4677-5.patch" size="13318" author="rohini" created="Tue, 28 Mar 2017 21:28:20 +0000"/>
                            <attachment id="12861520" name="PIG-4677-fixflakytest.patch" size="2117" author="rohini" created="Fri, 31 Mar 2017 21:52:01 +0000"/>
                            <attachment id="12761195" name="PIG-4677.2.patch" size="2874" author="mitdesai" created="Fri, 18 Sep 2015 21:07:03 +0000"/>
                            <attachment id="12761432" name="PIG-4677.3.patch" size="4590" author="mitdesai" created="Mon, 21 Sep 2015 13:42:51 +0000"/>
                            <attachment id="12785202" name="PIG-4677.4.patch" size="5029" author="mitdesai" created="Fri, 29 Jan 2016 18:03:57 +0000"/>
                            <attachment id="12755842" name="PIG-4677.patch" size="3384" author="mitdesai" created="Mon, 14 Sep 2015 21:29:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k5xb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>