<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:49:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-570] Large BZip files  Seem to loose data in Pig</title>
                <link>https://issues.apache.org/jira/browse/PIG-570</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;So I don&apos;t believe  bzip2 input to pig is working, at least not with large files. It seems as though map files are getting cut off. The maps complete way too quickly and the actual row of data that pig tries to process often randomly gets cut, and becomes incomplete. Here are my symptoms:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Maps seem to be completing in a unbelievably fast rate&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With uncompressed data&lt;br/&gt;
Status: Succeeded&lt;br/&gt;
Started at: Wed Dec 17 21:31:10 EST 2008&lt;br/&gt;
Finished at: Wed Dec 17 22:42:09 EST 2008&lt;br/&gt;
Finished in: 1hrs, 10mins, 59sec&lt;br/&gt;
map	100.00%&lt;br/&gt;
4670	0	0	4670	0	0 / 21&lt;br/&gt;
reduce	57.72%&lt;br/&gt;
13	0	0	13	0	0 / 4&lt;/p&gt;


&lt;p&gt;With bzip compressed data&lt;/p&gt;

&lt;p&gt;Started at: Wed Dec 17 21:17:28 EST 2008&lt;br/&gt;
Failed at: Wed Dec 17 21:17:52 EST 2008&lt;br/&gt;
Failed in: 24sec&lt;br/&gt;
Black-listed TaskTrackers: 2&lt;br/&gt;
Kind	% Complete	Num Tasks	Pending	Running	Complete	Killed	Failed/Killed&lt;br/&gt;
Task Attempts&lt;br/&gt;
map	100.00%&lt;br/&gt;
183	0	0	15	168	54 / 22&lt;br/&gt;
reduce	100.00%&lt;br/&gt;
13	0	0	0	13	0 / 0&lt;/p&gt;

&lt;p&gt;The errors we get:&lt;br/&gt;
ava.lang.IndexOutOfBoundsException: Requested index 11 from tuple (rec	A, 0HAW, CHIX, )&lt;br/&gt;
	at org.apache.pig.data.Tuple.getField(Tuple.java:176)&lt;br/&gt;
	at org.apache.pig.impl.eval.ProjectSpec.eval(ProjectSpec.java:84)&lt;br/&gt;
	at org.apache.pig.impl.eval.SimpleEvalSpec$1.add(SimpleEvalSpec.java:38)&lt;br/&gt;
	at org.apache.pig.impl.eval.EvalSpec.simpleEval(EvalSpec.java:223)&lt;br/&gt;
	at org.apache.pig.impl.eval.cond.CompCond.eval(CompCond.java:58)&lt;br/&gt;
	at org.apache.pig.impl.eval.FilterSpec$1.add(FilterSpec.java:60)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapreduceExec.PigMapReduce.run(PigMapReduce.java:117)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:227)&lt;br/&gt;
	at org.apache.hadoop.mapred.TaskTracker$Child.main(TaskTracker.java:2207)&lt;br/&gt;
Last 4KB&lt;br/&gt;
attempt_200812161759_0045_m_000007_0	task_200812161759_0045_m_000007	tsdhb06.factset.com	FAILED	&lt;br/&gt;
java.lang.IndexOutOfBoundsException: Requested index 11 from tuple (rec	A, CSGN, VTX, VTX, 0, 20080303, 90919, 380, 1543, 206002)&lt;br/&gt;
	at org.apache.pig.data.Tuple.getField(Tuple.java:176)&lt;br/&gt;
	at org.apache.pig.impl.eval.ProjectSpec.eval(ProjectSpec.java:84)&lt;br/&gt;
	at org.apache.pig.impl.eval.SimpleEvalSpec$1.add(SimpleEvalSpec.java:38)&lt;br/&gt;
	at org.apache.pig.impl.eval.EvalSpec.simpleEval(EvalSpec.java:223)&lt;br/&gt;
	at org.apache.pig.impl.eval.cond.CompCond.eval(CompCond.java:58)&lt;br/&gt;
	at org.apache.pig.impl.eval.FilterSpec$1.add(FilterSpec.java:60)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapreduceExec.PigMapReduce.run(PigMapReduce.java:117)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:227)&lt;br/&gt;
	at org.apache.hadoop.mapred.TaskTracker$Child.main(TaskTracker.java:2207)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Pig 0.1.1/Linux / 8 Nodes hadoop 0.18.2&lt;/p&gt;</environment>
        <key id="12410972">PIG-570</key>
            <summary>Large BZip files  Seem to loose data in Pig</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="breed">Benjamin Reed</assignee>
                                    <reporter username="posix4e">Alex Newman</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Dec 2008 13:31:45 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:15 +0000</updated>
                            <resolved>Wed, 7 Jan 2009 01:39:21 +0000</resolved>
                                    <version>0.0.0</version>
                    <version>0.1.0</version>
                    <version>0.2.0</version>
                    <version>site</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12659768" author="breed" created="Tue, 30 Dec 2008 08:22:03 +0000"  >&lt;p&gt;I believe the problem is due to bad position tracking. In the current version of the code, we chop up the input into blocks, but unfortunately when using bzip there are bzip block boundaries, HDFS block boundaries, and record boundaries. if the bzip block boundaries line up too closely, a record could get skipped or possibly corrupted.&lt;/p&gt;

&lt;p&gt;i was able to reproduce a problem, hopefully it is the same as your problem in the attached test case.&lt;/p&gt;

&lt;p&gt;the root cause turn out to be improper tracking of &quot;position&quot;. if we blindly use the position of the underlying stream and a bzip block and HDFS block line up we may think that we have read the first record of the next slice when in fact we have only read the bzip block header.&lt;/p&gt;

&lt;p&gt;the attached patch fixes the problem by defining the position of the stream as the position of the start of the current block header in the underlying stream.&lt;/p&gt;</comment>
                            <comment id="12659770" author="breed" created="Tue, 30 Dec 2008 08:29:28 +0000"  >&lt;p&gt;this is the test data for the bzip unit test. it should go under test/org/apache/pig/test/data/bzipTest.bz2&lt;/p&gt;</comment>
                            <comment id="12659994" author="olgan" created="Wed, 31 Dec 2008 00:42:54 +0000"  >&lt;p&gt;Ben, thanks. This is great!&lt;/p&gt;

&lt;p&gt;I tried to apply your patch but it failed. Can you make sure that you patch is relative to latest code in types branch. Also, is it possible to have smaller test data or is this the smallest data that shows the problem?&lt;/p&gt;</comment>
                            <comment id="12660518" author="breed" created="Sun, 4 Jan 2009 00:18:30 +0000"  >&lt;p&gt;Ah sorry, i did the patch with respect to trunk. i&apos;ll regen. it is probably possible to create a smaller test case, but it will take awhile. i did simple brute force trial an error to get the test case. (i thought it was pretty good that i was able to keep it to under 2M &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; are you concerned about the size or the run time?&lt;/p&gt;</comment>
                            <comment id="12660838" author="olgan" created="Mon, 5 Jan 2009 18:15:26 +0000"  >&lt;p&gt;Ok, lets keep the size and just make the patch against types branch, thanks.&lt;/p&gt;</comment>
                            <comment id="12661058" author="breed" created="Tue, 6 Jan 2009 06:44:09 +0000"  >&lt;p&gt;Regenerated patch against types branch&lt;/p&gt;</comment>
                            <comment id="12661189" author="breed" created="Tue, 6 Jan 2009 16:17:40 +0000"  >&lt;p&gt;Tightened up the test case and increased the number of bits used for the signature to the full 48-bits. (Since I now use the start of the block boundary as the offset we can use the whole thing.)&lt;/p&gt;</comment>
                            <comment id="12661372" author="breed" created="Tue, 6 Jan 2009 23:31:16 +0000"  >&lt;p&gt;Fixed the bzip for the test cases to have carefully crafted bad corner cases.&lt;/p&gt;</comment>
                            <comment id="12661402" author="olgan" created="Wed, 7 Jan 2009 01:39:21 +0000"  >&lt;p&gt;patch committed; thanks, Ben!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12397242" name="PIG-570.patch" size="5748" author="breed" created="Tue, 6 Jan 2009 23:31:16 +0000"/>
                            <attachment id="12397241" name="bzipTest.bz2" size="552066" author="breed" created="Tue, 6 Jan 2009 23:31:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164166</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 47 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gltz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94967</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>