<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:49:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-457] pig produces errors after a job is said to be 100% done</title>
                <link>https://issues.apache.org/jira/browse/PIG-457</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;It is possible that we get errors for all tasks even the ones we retried. Need to look at the code that handles detecting end of processing and producing errors.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12405092">PIG-457</key>
            <summary>pig produces errors after a job is said to be 100% done</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shravanmn">Shravan Matthur Narayanamurthy</assignee>
                                    <reporter username="olgan">Olga Natkovich</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Sep 2008 18:14:57 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:11 +0000</updated>
                            <resolved>Mon, 6 Oct 2008 18:05:46 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12634805" author="shravanmn" created="Fri, 26 Sep 2008 10:30:59 +0000"  >&lt;p&gt;There are two issues that this patch tries to address:&lt;br/&gt;
1) Exceptions and traces even after a successful completion:&lt;br/&gt;
Currently, we have the same code path for both the success case &amp;amp; failure case for getting &amp;amp; printing error messages. So this fix breaks the code path to use debug for failures in a successful completion which are solved by retries &amp;amp; to use error for failures in an unsuccessful run.&lt;/p&gt;

&lt;p&gt;2) Shows 100% even if there are failures&lt;br/&gt;
This is a direct result of what hadoop does. It marks the map and reduce tasks as 100 % complete irrespective of their success or failure. In some sense these are unrelated dimensions. Since its better to relate these two, we need to make sure that we don&apos;t report 100% complete in case of a failed execution. This is a hack where I check if the progress has become 100% and postpone its display till I am sure that the job has completed successfully.&lt;/p&gt;

&lt;p&gt;There are some other fixes to the completion percentage display logic which displays the percentage completion. In the code as we are chasing a moving target and when we assume that the job is in a particular state &amp;amp; try to do some processing based on that assumption, we might get spurious results. One example is we get the list of running jobs and try to get the progress for each job. While doing this, the state of this job might change from running to something else and its not easy to construct all the possible scenarios into the code. Thus when we try to fetch the progress of a previously running job which has changed state, we will get spurious results. To mitigate this, we make a simple assumption that the job can&apos;t regress and if we see such a condition, we ignore it as we know its temporary.&lt;/p&gt;

&lt;p&gt;Another thing that has been introduced into the logic is an exponential delay scheme which will be useful when we are in a job which is not progressing may be due to bag spilling or some udf running. In this case each progress reported is the same for some time. During this time, we can either implement something where we hard limit saying if we don&apos;t see progress we don&apos;t report it or we can just report the same progress. There are cons with both approaches: for 1) it might seem like the job is stuck or there is processing happening if we don&apos;t display anything. for 2)its surely going to fill the screen with something that is not adding any more information. So we try to introduce delays between each batch of same progress display which increase exponentially with each batch completing. Currently the batch size is half the number of retries which is 6 since sleep time is 5 sec now; like trying to have a progress reported every 30 sec but delaying future displays of the same progress using an exponential delay scheme.&lt;/p&gt;</comment>
                            <comment id="12634970" author="alangates" created="Fri, 26 Sep 2008 19:03:23 +0000"  >&lt;p&gt;I propose we split this patch into two.  The first part I think we all agree on and we want to get it soon.  The second part I think we want to review further.  I&apos;ve tried to split out the stuff for the first part and attached it in this 457-3.patch.&lt;/p&gt;</comment>
                            <comment id="12634971" author="olgan" created="Fri, 26 Sep 2008 19:08:13 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12634984" author="shravanmn" created="Fri, 26 Sep 2008 19:56:50 +0000"  >&lt;p&gt;The patch also removes the fix which resolves 2 where it shows hundred percent even after failures. Also, pls call jc.stop before returning false from the failure case.  Also, the LocalJobRunner.compile has the StreamVisitor thingy missing which I think causes the stream tests in local mode to fail. If thats actually the case, i would keep that in too.&lt;/p&gt;

&lt;p&gt;Optionally we might want to keep the check that discards progress which is decreasing because it causes the condition we have there of prog&amp;lt;lastProg to fail. The progress is like x and lastProg is also x. This goes on for a while and suddenly, probably during failure, the prog becomes zero which causes the condition to hold in the next iteration and makes us print the same progress again and again.&lt;/p&gt;

&lt;p&gt;The exponential backoff needs some review I agree&lt;/p&gt;</comment>
                            <comment id="12635054" author="alangates" created="Fri, 26 Sep 2008 22:54:41 +0000"  >&lt;p&gt;Here&apos;s another whack at splitting the patch.  I addressed Shravan&apos;s request to add in the MRStreaming stuff into LocalLauncher, and put in the jc.stop() calls after failed jobs in both Local and MapReduceLauncher.&lt;/p&gt;</comment>
                            <comment id="12635066" author="olgan" created="Fri, 26 Sep 2008 23:33:08 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12635074" author="alangates" created="Sat, 27 Sep 2008 00:02:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-457&quot; title=&quot;pig produces errors after a job is said to be 100% done&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-457&quot;&gt;&lt;del&gt;PIG-457&lt;/del&gt;&lt;/a&gt;-4 has been checked in.  I&apos;m not closing the bug because this doesn&apos;t address the issue of reporting 100% progress and then reporting failures, which is also part of the bug.&lt;/p&gt;</comment>
                            <comment id="12635793" author="shravanmn" created="Tue, 30 Sep 2008 17:27:02 +0000"  >&lt;p&gt;Separated the 2nd part&lt;/p&gt;</comment>
                            <comment id="12636230" author="olgan" created="Wed, 1 Oct 2008 22:54:16 +0000"  >&lt;p&gt;I reviewed the current code and the proposed changes.&lt;/p&gt;

&lt;p&gt;The current code looks fine and should be doing the right thing. So it seems like the patch is adding quite a bit of complexity to hide some sort of issues with hadoop progress.&lt;/p&gt;

&lt;p&gt;I winder if the easiest change for now would be to check the progress and if it adds to 100% not to report it until we check that the job successfully finished.&lt;/p&gt;</comment>
                            <comment id="12636261" author="shravanmn" created="Thu, 2 Oct 2008 01:03:25 +0000"  >&lt;p&gt;Actually, the final progress check is exactly that. It doesn&apos;t report 100% until it is also sure that the job completed successfully. However, there are 2 other changes: 1) to mask some issue with hadoop progress 2) When the issue (1) is masked we would not see any kind of progress if the job is not showing progress after a certain point of time. So instead appearing frozen, there is some logic which displays the same percentage with an exponentially increasing delay between each report of the same progress just to say that we are alive. Once we get a different progress all counters are reset and it resumes normal progress reporting until the progress is blocked again. (Not exactly right but just to simplify understanding. It actually adds exponential delay between a bunch of same progress reports).&lt;/p&gt;</comment>
                            <comment id="12636263" author="olgan" created="Thu, 2 Oct 2008 01:14:41 +0000"  >&lt;p&gt;Yes, I realize that but I question whether we need to add this complexity. My preference is just extract the part of the patch that delays 100% reporting&lt;/p&gt;</comment>
                            <comment id="12636708" author="shravanmn" created="Fri, 3 Oct 2008 18:49:02 +0000"  >&lt;p&gt;just delaying the progress part.&lt;/p&gt;</comment>
                            <comment id="12636710" author="olgan" created="Fri, 3 Oct 2008 18:59:20 +0000"  >&lt;p&gt;shravan, we do want to display 100% once the job successfully finishes. I don&apos;t the latest version of the patch does that.&lt;/p&gt;</comment>
                            <comment id="12637010" author="shravanmn" created="Mon, 6 Oct 2008 06:13:36 +0000"  >&lt;p&gt;Sorry, missed that one. The new patch with the changes for the progress&lt;/p&gt;</comment>
                            <comment id="12637157" author="olgan" created="Mon, 6 Oct 2008 18:05:46 +0000"  >&lt;p&gt;patch committed; thanks, shravan&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12391009" name="457-2.patch" size="14154" author="shravanmn" created="Fri, 26 Sep 2008 10:31:26 +0000"/>
                            <attachment id="12391043" name="457-3.patch" size="4459" author="gates" created="Fri, 26 Sep 2008 19:03:23 +0000"/>
                            <attachment id="12391068" name="457-4.patch" size="5467" author="gates" created="Fri, 26 Sep 2008 22:54:40 +0000"/>
                            <attachment id="12391222" name="457-part2.patch" size="11383" author="shravanmn" created="Tue, 30 Sep 2008 17:27:02 +0000"/>
                            <attachment id="12391516" name="457-prog.patch" size="2528" author="shravanmn" created="Mon, 6 Oct 2008 06:13:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164070</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 8 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gkgv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94746</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>