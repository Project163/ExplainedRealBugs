<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:00:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4327] Schema of map with value that has an alias can&apos;t be parsed again</title>
                <link>https://issues.apache.org/jira/browse/PIG-4327</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Tried to create a map of a primitive type, the resulting schema can&apos;t be parsed again by the parser if there is a alias set for the value.&lt;/p&gt;

&lt;p&gt;I could not set an alias, but the alias gets set by pig itself, e.g. when converting avro schemas to pig schemas and there was a map of records in avro.&lt;/p&gt;

&lt;p&gt;See also my other bug report &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4326&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PIG-4326&lt;/a&gt; , even without that fix, pig produces schemas of maps with values that have an alias.&lt;/p&gt;

&lt;p&gt;You can easily reproduce the crash, using those two unit tests. The second one should actually succeed but throws a ParserException instead&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testWorksWithoutAlias() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FrontendException {
    List&amp;lt;FieldSchema&amp;gt; innerFields = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
    innerFields.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FieldSchema(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, DataType.LONG));
    List&amp;lt;FieldSchema&amp;gt; fields = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
    fields.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FieldSchema(&lt;span class=&quot;code-quote&quot;&gt;&quot;mapAlias&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema(innerFields), DataType.MAP));

    Schema inputSchema = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema(fields);
    Schema fromString = Utils.getSchemaFromBagSchemaString(inputSchema.toString());
    assertEquals(inputSchema.toString(), fromString.toString());
}

@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testBreaksWithAlias() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FrontendException {
    List&amp;lt;FieldSchema&amp;gt; innerFields = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
    innerFields.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FieldSchema(&lt;span class=&quot;code-quote&quot;&gt;&quot;valueAlias&quot;&lt;/span&gt;, DataType.LONG));
    List&amp;lt;FieldSchema&amp;gt; fields = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
    fields.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FieldSchema(&lt;span class=&quot;code-quote&quot;&gt;&quot;mapAlias&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema(innerFields), DataType.MAP));

    Schema inputSchema = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Schema(fields);
    Schema fromString = Utils.getSchemaFromBagSchemaString(inputSchema.toString());
    assertEquals(inputSchema.toString(), fromString.toString());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I suppose that the issue is in the grammar itself and easy to fix for someone knowing antlr. I don&apos;t think the issue is related to the actual type of the value, as I could also provide tests that fail if we don&apos;t use a primitive but complex type with an alias.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12754812">PIG-4327</key>
            <summary>Schema of map with value that has an alias can&apos;t be parsed again</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mprim">Michael Prim</assignee>
                                    <reporter username="mprim">Michael Prim</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Nov 2014 17:21:24 +0000</created>
                <updated>Sun, 7 Jun 2015 03:48:15 +0000</updated>
                            <resolved>Fri, 14 Nov 2014 19:14:27 +0000</resolved>
                                    <version>0.12.0</version>
                    <version>0.13.0</version>
                                    <fixVersion>0.15.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14209587" author="mprim" created="Thu, 13 Nov 2014 11:07:50 +0000"  >&lt;p&gt;I attached a patch to the pig grammar and extended the test cases.&lt;/p&gt;</comment>
                            <comment id="14211589" author="daijy" created="Fri, 14 Nov 2014 00:33:02 +0000"  >&lt;p&gt;LGTM. Will check in after tests.&lt;/p&gt;</comment>
                            <comment id="14212663" author="daijy" created="Fri, 14 Nov 2014 19:14:27 +0000"  >&lt;p&gt;Patch committed to trunk. Thanks Michael!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12681310" name="0001-Extend-map-type-to-allow-for-alias-of-its-values.patch" size="6028" author="mprim" created="Thu, 13 Nov 2014 11:07:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22ah3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>