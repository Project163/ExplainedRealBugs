<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:01:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4833] TestBuiltin.testURIWithCurlyBrace in TEZ failing after PIG-4819</title>
                <link>https://issues.apache.org/jira/browse/PIG-4833</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;From &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4819?focusedCommentId=15179448#comment-15179448&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PIG-4819?focusedCommentId=15179448#comment-15179448&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;TestBuiltin.testURIWithCurlyBrace is failing after addition of testRandomJob with -Dhadoopversion=23 -Dexectype=tez. Possible to take a look at it? &lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12948091">PIG-4833</key>
            <summary>TestBuiltin.testURIWithCurlyBrace in TEZ failing after PIG-4819</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2016 17:52:57 +0000</created>
                <updated>Wed, 8 Jun 2016 20:48:31 +0000</updated>
                            <resolved>Wed, 9 Mar 2016 18:30:36 +0000</resolved>
                                                    <fixVersion>0.16.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15185422" author="knoguchi" created="Tue, 8 Mar 2016 18:24:01 +0000"  >&lt;p&gt;This was weird to me since my patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4819&quot; title=&quot;RANDOM() udf can lead to missing or redundant records&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4819&quot;&gt;&lt;del&gt;PIG-4819&lt;/del&gt;&lt;/a&gt; didn&apos;t touch &lt;tt&gt;TestBuiltin.testURIWithCurlyBrace&lt;/tt&gt; at all.&lt;/p&gt;

&lt;p&gt;Looking further, it seems like an issue with tez test environment when local mode and mapreduce/tez mode are intermixed.  Test code does call &lt;tt&gt;Util. resetStateForExecModeSwitch()&lt;/tt&gt;, which states &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Util.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  1337     /**
  1338      * Called to reset ThreadLocal or &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; states that PigServer depends on
  1339      * when a test suite has testcases switching between LOCAL and MAPREDUCE/TEZ
  1340      * execution modes
  1341      */
  1342     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void resetStateForExecModeSwitch() {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but &lt;tt&gt;TezResourceManager&lt;/tt&gt; caches an instance from &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3978&quot; title=&quot;Container reuse does not across PigServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3978&quot;&gt;&lt;del&gt;PIG-3978&lt;/del&gt;&lt;/a&gt; and would not re-initialize when we move from tez mode to local mode.  Uploading a patch, pig-4833-v01.patch,  that explicitly drops this instance for every Util.resetStateForExecModeSwitch call.&lt;br/&gt;
Not sure if adding a public method just for testing is justified or not.  &lt;/p&gt;

&lt;p&gt;Besides from this issue, made minor changes in &lt;tt&gt;testUniqueID&lt;/tt&gt; and &lt;tt&gt;testRANDOMWithJob&lt;/tt&gt; in TestBuiltin.java to &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;use its own copy for setting PigServer properties.&lt;/li&gt;
	&lt;li&gt;delete the input file when test is done.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;These minor changes were things I&apos;ve tried before finding out the issue above.&lt;/p&gt;</comment>
                            <comment id="15185966" author="daijy" created="Tue, 8 Mar 2016 22:30:26 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15187594" author="knoguchi" created="Wed, 9 Mar 2016 18:30:36 +0000"  >&lt;p&gt;Thanks for the review Daniel!  Committed to trunk.&lt;/p&gt;</comment>
                            <comment id="15256969" author="rohini" created="Mon, 25 Apr 2016 20:18:47 +0000"  >&lt;p&gt;This patch breaks tests in Hadoop 1.x mode.&lt;/p&gt;

&lt;p&gt;ant clean test -Dtestcase=TestBatchAliases -logfile /tmp/pig.log&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   [javac] /apache/pig/trunk/test/org/apache/pig/test/Util.java:78: error: &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.apache.pig.backend.hadoop.executionengine.tez does not exist
    [javac] &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pig.backend.hadoop.executionengine.tez.TezResourceManager;
    [javac]                                                         ^
    [javac] /apache/pig/trunk/test/org/apache/pig/test/Util.java:1347: error: cannot find symbol
    [javac]         TezResourceManager.dropInstance();
    [javac]         ^
    [javac]   symbol:   variable TezResourceManager
    [javac]   location: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Util

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15261038" author="knoguchi" created="Wed, 27 Apr 2016 22:04:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;This patch breaks tests in Hadoop 1.x mode.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ouch.  Sorry about that.  Uploading a patch that does &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Reflection on Tez class.  Rohini pointed out that using shim for testcode is too much.&lt;/li&gt;
	&lt;li&gt;Also added @VisibleForTesting annotation suggested by Rohini.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Running tests with this patch.&lt;/p&gt;

&lt;p&gt;Besides from this, I see that I somehow set &quot;Incompatible change&quot; flag on this jira.  Taking it out.&lt;/p&gt;</comment>
                            <comment id="15261042" author="rohini" created="Wed, 27 Apr 2016 22:06:11 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15262273" author="knoguchi" created="Thu, 28 Apr 2016 14:55:40 +0000"  >&lt;p&gt;Thanks Rohini.  Now committed &lt;tt&gt;pig-4833-v01_fixregression_1.patch&lt;/tt&gt; to trunk (0.16).&lt;/p&gt;</comment>
                            <comment id="15262326" author="knoguchi" created="Thu, 28 Apr 2016 15:23:48 +0000"  >&lt;p&gt;With the last patch, test now compiles with hadoop 1.x.&lt;br/&gt;
However, I see that TestBuiltin.testUniqueID is somehow failing (from the original patch of pig-4833-v01.patch).  It runs fine with hadoop 2.x.  &lt;/p&gt;

&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4881&quot; title=&quot;TestBuiltin.testUniqueID failing on hadoop-1.x&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4881&quot;&gt;&lt;del&gt;PIG-4881&lt;/del&gt;&lt;/a&gt;.  Hopefully I can stop breaking things and actually start fixing some issues... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12792051" name="pig-4833-v01.patch" size="4383" author="knoguchi" created="Tue, 8 Mar 2016 18:24:01 +0000"/>
                            <attachment id="12801130" name="pig-4833-v01_fixregression_1.patch" size="2645" author="knoguchi" created="Wed, 27 Apr 2016 22:04:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 29 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ucjj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>