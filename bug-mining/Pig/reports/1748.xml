<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:01:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4623] Fixed the &apos;new line&apos; character inside double-quote causing the csv parsing failure</title>
                <link>https://issues.apache.org/jira/browse/PIG-4623</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>

&lt;p&gt;A new line character should be allowed inside a double quote as a valid csv document. For example, the following csv document should be treated as a SINGLE valid csv data&lt;/p&gt;

&lt;p&gt;Iphone,&quot;&lt;/p&gt;
{ ItemName : Cheez-It
21 Ounce}
&lt;p&gt;&quot;,&lt;/p&gt;

&lt;p&gt;However, the current implementation of the getNext() inside org.apache.pig.piggybank.storage.CSVLoader class fails to take care of this case and it sees two lines of data while in fact it should be treated as single line of data.&lt;/p&gt;

&lt;p&gt;This pull request fixes the above issue.&lt;/p&gt;

&lt;p&gt;(Note: here is a linke to validate whether a csv document: &lt;a href=&quot;http://csvlint.io/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://csvlint.io/&lt;/a&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12842939">PIG-4623</key>
            <summary>Fixed the &apos;new line&apos; character inside double-quote causing the csv parsing failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="ken11223">Ken Wu</assignee>
                                    <reporter username="ken11223">Ken Wu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Jul 2015 17:29:38 +0000</created>
                <updated>Fri, 13 Jun 2025 16:49:44 +0000</updated>
                                            <version>0.15.0</version>
                                    <fixVersion>0.20.0</fixVersion>
                                    <component>piggybank</component>
                        <due>Tue, 7 Jul 2015 00:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="14615348" author="ken11223" created="Mon, 6 Jul 2015 17:30:22 +0000"  >&lt;p&gt;This has been fixed and the pull request is available at:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/pig/pull/20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/pig/pull/20&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14654796" author="daijy" created="Wed, 5 Aug 2015 04:40:20 +0000"  >&lt;p&gt;Can you generate a patch and attach to the ticket?&lt;/p&gt;</comment>
                            <comment id="14658843" author="daijy" created="Wed, 5 Aug 2015 20:28:01 +0000"  >&lt;p&gt;I also mean to generate a patch and attach the patch file to the Jira. Pig don&apos;t use pull request to track patches.&lt;/p&gt;</comment>
                            <comment id="14658854" author="ken11223" created="Wed, 5 Aug 2015 20:33:33 +0000"  >&lt;p&gt;Here are the patches&lt;/p&gt;</comment>
                            <comment id="14658931" author="daijy" created="Wed, 5 Aug 2015 21:04:52 +0000"  >&lt;p&gt;Attach patch. Next time, please use svn diff, or git diff/git show to generate patch file and attach to Jira ticket.&lt;/p&gt;</comment>
                            <comment id="14658933" author="daijy" created="Wed, 5 Aug 2015 21:05:18 +0000"  >&lt;p&gt;Patch committed to trunk. Thanks Ken!&lt;/p&gt;</comment>
                            <comment id="14659175" author="rohini" created="Wed, 5 Aug 2015 23:23:45 +0000"  >&lt;p&gt;The patch has a couple of bugs&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;So if you encounter EOF while looping you will return null instead of returning what has been processed so far in previousBufferToBeRead.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(!doneThisLineLogically)	{
+	            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!in.nextKeyValue()) {
+	                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+	            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Also I don&apos;t see how you are handling the case if it was not a quoted field but quote was just in the data. For eg: FieldA1,fieldB1,fieldC1,fieldD1apples&quot;oranges\nFieldA2,fieldB2,fieldC2,fieldD2 would now output&lt;br/&gt;
FieldA1,fieldB1,fieldC1,fieldD1apples&quot;oranges\nFieldA2   and drop fieldB2,fieldC2,fieldD2 altogether.  The previous code would correctly output 2 records.&lt;br/&gt;
FieldA1,fieldB1,fieldC1,fieldD1apples&quot;oranges&lt;br/&gt;
FieldA2,fieldB2,fieldC2,fieldD2&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The patch goes ahead and reads the next line if it sees a quote that does not end. It does not handle records boundaries across tasks. There will be duplicate partial records if a line with quotes spans split boundaries. For eg: For the data&lt;br/&gt;
FieldA1,&quot;fieldB1 apples\noranges&quot;,fieldC1,fieldD1\nFieldA2,fieldB2,fieldC2,fieldD2 with split boundary ending at B1, TextInputFormat of task1 will read  &lt;tt&gt;FieldA1,&quot;fieldB1 apples&lt;/tt&gt;. The current patch would go ahead and read next line  &lt;tt&gt;oranges&quot;,fieldC1,fieldD1&lt;/tt&gt;.  The TextInputFormat of task2 will also read &lt;tt&gt;oranges&quot;,fieldC1,fieldD1&lt;/tt&gt; and output that as record.&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="14659199" author="daijy" created="Wed, 5 Aug 2015 23:34:50 +0000"  >&lt;p&gt;Thanks Rohini for capturing this. Rollback the patch to address the issue raised.&lt;/p&gt;</comment>
                            <comment id="14659206" author="rohini" created="Wed, 5 Aug 2015 23:43:28 +0000"  >&lt;p&gt;Actually my 3rd comment was wrong. That cannot happen as TextInputFormat will only read till &lt;tt&gt;FieldA1,&quot;fieldB1 apples&lt;/tt&gt;. After that it will give false for in.nextKeyValue(). So &lt;tt&gt;oranges&quot;,fieldC1,fieldD1&lt;/tt&gt; cannot be read and it will hit the 1st case where the whole line will be missed.  Previously also it was no better with only difference being it will output two wrong records - first record will have partial columns and nulls for rest. Second record will have wrong data in each of its columns.  &lt;/p&gt;

&lt;p&gt;Unless a custom input format is used which handles quotes along with field and line delimiters while parsing records, I don&apos;t think this problem can have a clean solution and handle all cases.&lt;/p&gt;
</comment>
                            <comment id="14659338" author="ken11223" created="Thu, 6 Aug 2015 01:57:53 +0000"  >&lt;p&gt;Hi Rohini Palaniswamy,&lt;/p&gt;

&lt;p&gt;Thanks for your comments.  Let me comment on your first two items (since the third item is invalid claimed by you)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;On the second item, the input you gave: fieldD1apples&quot;oranges\nFieldA2,fieldB2 (I took a short form of it for the sake of conciseness), it is not a valid csv format.  Please check it here: &lt;a href=&quot;http://csvlint.io/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://csvlint.io/&lt;/a&gt;  .  Therefore, anything can go wrong if you give an invalid csv format as input.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;On the first item, i preserved the semantic of the original code - If nothing was to be read, it would return null.  At any time, either two cases can happen:&lt;br/&gt;
  a) Inside a double quote:  If we encounter a EOF character, by my above point, it is not a valid csv file.  Therefore, we do not need to consider this case.&lt;br/&gt;
  b) Outside a double quote (or double quote is not present at all) : Then the semantic would just be exactly the same as the original one. &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Therefore, i still see my patch is correct now.  Please let me know if anyone still see any error.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12748923" name="CSVLoader.java" size="9244" author="ken11223" created="Wed, 5 Aug 2015 20:33:33 +0000"/>
                            <attachment id="12748930" name="PIG-4623-1.patch" size="7798" author="daijy" created="Wed, 5 Aug 2015 21:04:52 +0000"/>
                            <attachment id="12748924" name="TestCSVStorage.java" size="4759" author="ken11223" created="Wed, 5 Aug 2015 20:33:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gw9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>