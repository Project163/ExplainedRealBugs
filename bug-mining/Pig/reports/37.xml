<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:48:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-331] Combiner needs to be used in the types branch</title>
                <link>https://issues.apache.org/jira/browse/PIG-331</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The initial implementation in the types branch does not make use of the combiner.  For performance, it needs to make use of the combiner.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12400765">PIG-331</key>
            <summary>Combiner needs to be used in the types branch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gates">Alan Gates</assignee>
                                    <reporter username="gates">Alan Gates</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Jul 2008 18:54:53 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:05 +0000</updated>
                            <resolved>Mon, 4 Aug 2008 19:28:53 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12615955" author="pi_song" created="Wed, 23 Jul 2008 11:00:10 +0000"  >&lt;p&gt;This has been blocking me from implementing OLAP operators.&lt;/p&gt;</comment>
                            <comment id="12616613" author="alangates" created="Thu, 24 Jul 2008 19:50:35 +0000"  >&lt;p&gt;A first pass at using the combiner.  This patch contains a couple of things:&lt;/p&gt;

&lt;p&gt;1) Foreachs that have only simple projection and algebraic functions make use of the combiner.&lt;br/&gt;
2) Distincts were optimized to not carry the bags of data along.  There is no actual need for them to use the combiner because we&apos;re only passing they keys.  hadoop takes care of collecting the keys and not passing multiple instances from map to reduce.&lt;/p&gt;

&lt;p&gt;Things this patch does not contain:&lt;/p&gt;

&lt;p&gt;1) Foreachs that have a combination of algebraic and non-algebraic.  These should be do-able, with the non-algebraic functions just being replaced by simple projections of the appropriate fields in the combiner plan.&lt;/p&gt;

&lt;p&gt;2) Foreachs that include inner plans.  This is in particular useful for inner plans that use distinct, as this is the way to emulate count(distinct x) from SQL, a fairly common operation.  Some inner plans (such as those containing filters) cannot be split.  This is a little more challenging because it requiring duplicating parts of the inner plan in the combiner and reducer and not duplicating other parts.&lt;/p&gt;

&lt;p&gt;These two should be added later. &lt;/p&gt;</comment>
                            <comment id="12616902" author="pi_song" created="Fri, 25 Jul 2008 14:14:23 +0000"  >&lt;p&gt;I agree with the patch.&lt;/p&gt;

&lt;p&gt;Filter can be done as Filter Pusher and we should even get a better result.&lt;/p&gt;</comment>
                            <comment id="12617011" author="alangates" created="Fri, 25 Jul 2008 19:02:32 +0000"  >&lt;p&gt;I attached the wrong file previously.  That was an earlier version of the patch.  Here&apos;s the right version.&lt;/p&gt;</comment>
                            <comment id="12617972" author="sms" created="Tue, 29 Jul 2008 21:53:04 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;File: src/org/apache/pig/backend/local/executionengine/LocalJob.java&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In the anonymous Iterator that is returned, I noticed that the public member variables are not initialized but they are used in the hasNext() method.&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Iterator&amp;lt;Tuple&amp;gt;() {

+            Tuple   t;
+            &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; atEnd;
+            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; hasNext() {
+                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (atEnd)
+                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (t == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;File:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/CombinerOptimizer.java&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Minor Comment:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The log message indicates a leaf while the checks are being made for the roots.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (reduceRoots.size() != 1) {
+            log.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Expected reduce to have single leaf&quot;&lt;/span&gt;);
+            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
+        }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
	&lt;li&gt;Minor Comment:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The condition to check for the existence of at least one algebraic and no instances of non-algebraic types is probably better written using &amp;amp;&amp;amp; instead of || Method: +    private List&amp;lt;ExprType&amp;gt; algebraic(&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;//current code
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!atLeastOneAlgebraic || !noNonAlgebraics) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;

&lt;span class=&quot;code-comment&quot;&gt;//more readable code?
&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (atLeastOneAlgebraic &amp;amp;&amp;amp; noNonAlgebraics) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;File: src/org/apache/pig/impl/plan/OperatorPlan.java&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Major Comment:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The new replace(oldNode, newNode) method is similar to the private replaceNode(src, replacement, dst, multiMap) method added as part of  &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-290&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PIG-290&lt;/a&gt;. The difference lies in the method signature and the access specifier.&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void replace(E oldNode, E newNode) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; PlanException {
&lt;span class=&quot;code-comment&quot;&gt;//Pig-290 change below
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; replaceNode(E src, E replacement, E dst, MultiMap&amp;lt;E, E&amp;gt; multiMap) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;File: src/org/apache/pig/impl/util/Pair.java&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Minor Comment:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Do we need equals() and hashCode() methods to make the class usable in containers?&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;File:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/expressionOperators/POUserComparisonFunc.java&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Major Comment:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In the clone() method, the ComparisonFunc func is not cloned&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;File:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/expressionOperators/POUserFunc.java&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Major Comment:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In the clone method, the final two constructor arguments are in the wrong order. POUserFunc expects FuncSpec, EvalFunc while the clone method uses null, funcSpec.clone. This should not compile in the first place.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+        POUserFunc clone = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; POUserFunc(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OperatorKey(mKey.scope, 
+            NodeIdGenerator.getGenerator().getNextNodeId(mKey.scope)),
+            requestedParallelism, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, funcSpec.clone());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;File:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/expressionOperators/BinaryExpressionOperator.java&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Major Comment:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In the cloneHelper method, the operator&apos;s resultType is not set. In the corresponding cloneHelper method in UnaryExpressionOperator, the restultType is set. The resultType is also set in PhysicalOperator&apos;s cloneHelper method.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;//in UnaryExpressionOperator.java&apos;s cloneHelper
&lt;/span&gt;
+        resultType = op.getResultType();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;File:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/relationalOperators/PODistinct.java&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Minor Comment:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The clone method is missing in PODistinct. Is this due to the re-write of distinct in LocalRearrange?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12386911" name="combiner.patch" size="158823" author="gates" created="Fri, 25 Jul 2008 19:02:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163968</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 18 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gixj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94497</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>