<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4933] TestDataBagAccess.testBagConstantFlatten1/TestLogicalPlanBuilder.testQuery90  broken after PIG-2315</title>
                <link>https://issues.apache.org/jira/browse/PIG-4933</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;A = load &lt;span class=&quot;code-quote&quot;&gt;&apos;1line.txt&apos;&lt;/span&gt;;
B = foreach A generate {((&lt;span class=&quot;code-quote&quot;&gt;&apos;p1-t1-e1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;p1-t1-e2&apos;&lt;/span&gt;),(&lt;span class=&quot;code-quote&quot;&gt;&apos;p1-t2-e1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;p1-t2-e2&apos;&lt;/span&gt;)),((&lt;span class=&quot;code-quote&quot;&gt;&apos;p2-t1-e1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;p2-t1-e2&apos;&lt;/span&gt;), (&lt;span class=&quot;code-quote&quot;&gt;&apos;p2-t2-e1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;p2-t2-e2&apos;&lt;/span&gt;))};
C = foreach B generate $0 as pairbag : { pair: ( t1: (e1, e2), t2: (e1, e2) ) };
DUMP C;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Above results in empty &apos;()&apos;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12981975">PIG-4933</key>
            <summary>TestDataBagAccess.testBagConstantFlatten1/TestLogicalPlanBuilder.testQuery90  broken after PIG-2315</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Jun 2016 17:12:33 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:27 +0000</updated>
                            <resolved>Thu, 11 Aug 2016 15:29:04 +0000</resolved>
                                                    <fixVersion>0.17.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15348790" author="knoguchi" created="Fri, 24 Jun 2016 22:31:23 +0000"  >&lt;p&gt;Found one more test, TestLogicalPlanBuilder.testQuery90, failing.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;test3.txt&apos;&lt;/span&gt; as (name:chararray, age:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa:&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;);
b = group a by (name, age);
c = foreach b generate group as mygroup:(myname, myage)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;Schema for mygroup is becoming (bytearray, bytearray).  &lt;/p&gt;

&lt;p&gt;Basically a same pattern from the description when tuple/bag(and probably map) is renamed, it still inserts the casting corrupting the schema.&lt;/p&gt;

&lt;p&gt;Two separate issues.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;casts should not be inserted in the first place&lt;/li&gt;
	&lt;li&gt;Even if casts are inserted, they shouldn&apos;t be casting to &quot;bytearray&quot;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ll see if I can work on it next week, but until then trunk is broken for these cases.  If quick fix is needed, we can skip this feature for tuple/map/bag and bring back the previous behavior.    Cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Sorry again for not catching these failures before committing the patch.&lt;/p&gt;</comment>
                            <comment id="15348808" author="daijy" created="Fri, 24 Jun 2016 22:47:19 +0000"  >&lt;p&gt;The statement doesn&apos;t mean to cast to bytearray, it means don&apos;t cast. We shall remove the bytearray cast. Also if the cast is unnecessary (the original type is the same as the cast), we shall remove the cast.&lt;/p&gt;</comment>
                            <comment id="15402934" author="knoguchi" created="Mon, 1 Aug 2016 22:20:33 +0000"  >&lt;p&gt;Attaching my initial patch (pig-4933-v01.patch).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The statement doesn&apos;t mean to cast to bytearray, it means don&apos;t cast. We shall remove the bytearray cast. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Updated POCast to make toByteArray cast as no-op.&lt;br/&gt;
(Before, it was returning empty fields.)&lt;br/&gt;
Also added testAsWithByteArrayCast to test this condition.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also if the cast is unnecessary (the original type is the same as the cast), we shall remove the cast.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Updated ForEachUserSchemaVisitor to &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Check if userDefinedSchema do not have type specified in &lt;tt&gt;hasOnlyNullOrByteArraySchema&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;Merge expectedschema and userschema so that we don&apos;t overwrite field schema as bytearray when only alias is provided. &lt;tt&gt;replaceNullByteArraySchema&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;When resetting the schema to null (for the original foreach), made sure to reset the type for complicate types (bag/tuple/map). &lt;tt&gt;resetTypeToNull&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And in TestLogicalPlanBuilder.java, uncommented part of the testQuery90 that were being skipped for some reasons.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;, appreciate if you can take a look when you have time.   &lt;/p&gt;</comment>
                            <comment id="15403956" author="knoguchi" created="Tue, 2 Aug 2016 13:26:20 +0000"  >&lt;p&gt;I forgot to use &lt;tt&gt;--no-prefix&lt;/tt&gt; when taking a diff.  Re-attaching.&lt;/p&gt;</comment>
                            <comment id="15404381" author="knoguchi" created="Tue, 2 Aug 2016 16:57:59 +0000"  >&lt;p&gt;Some tests were failing with NPE with the previous patch.&lt;br/&gt;
Added one null check.&lt;/p&gt;

&lt;p&gt;With this patch, at least the tests seem to be going through.&lt;/p&gt;</comment>
                            <comment id="15416472" author="daijy" created="Thu, 11 Aug 2016 03:36:22 +0000"  >&lt;p&gt;Thanks for dealing with nested schema. Though the code is lengthy, I cannot find a way to make simpler. +1.&lt;/p&gt;</comment>
                            <comment id="15417429" author="knoguchi" created="Thu, 11 Aug 2016 15:29:04 +0000"  >&lt;p&gt;Thanks for the review Daniel!  &lt;/p&gt;

&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12995871">PIG-4968</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12526132">PIG-2315</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12821605" name="pig-4933-v01.patch" size="14665" author="knoguchi" created="Tue, 2 Aug 2016 13:26:20 +0000"/>
                            <attachment id="12821651" name="pig-4933-v02.patch" size="14739" author="knoguchi" created="Tue, 2 Aug 2016 16:57:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zx3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>