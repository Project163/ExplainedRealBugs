<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:49:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-558] Distinct followed by a Join results in Invalid size 0 for a tuple error</title>
                <link>https://issues.apache.org/jira/browse/PIG-558</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The following Pig script does a right outer join after the DISTINCT.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;nonuniqtable1 = LOAD &lt;span class=&quot;code-quote&quot;&gt;&apos;table1&apos;&lt;/span&gt; AS (f1:chararray);
table1 = DISTINCT nonuniqtable1;
table2 = LOAD &lt;span class=&quot;code-quote&quot;&gt;&apos;table2&apos;&lt;/span&gt; AS (f1:chararray, f2:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
temp = COGROUP table1 BY f1 INNER, table2 BY f1;
DESCRIBE temp;
explain temp;
dump temp;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;========================================================================================================&lt;br/&gt;
It results in the following error. This is true for other join types as well.&lt;br/&gt;
========================================================================================================&lt;br/&gt;
java.io.IOException: Invalid size 0 for a tuple&lt;br/&gt;
	at org.apache.pig.data.DataReaderWriter.readDatum(DataReaderWriter.java:57)&lt;br/&gt;
	at org.apache.pig.data.DataReaderWriter.readDatum(DataReaderWriter.java:62)&lt;br/&gt;
	at org.apache.pig.builtin.BinStorage.getNext(BinStorage.java:90)&lt;br/&gt;
	at org.apache.pig.backend.executionengine.PigSlice.next(PigSlice.java:103)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.SliceWrapper$1.next(SliceWrapper.java:157)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.SliceWrapper$1.next(SliceWrapper.java:133)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapTask$TrackedRecordReader.next(MapTask.java:165)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:45)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:227)&lt;br/&gt;
	at org.apache.hadoop.mapred.TaskTracker$Child.main(TaskTracker.java:2209)&lt;br/&gt;
========================================================================================================&lt;/p&gt;</description>
                <environment></environment>
        <key id="12410128">PIG-558</key>
            <summary>Distinct followed by a Join results in Invalid size 0 for a tuple error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pkamath">Pradeep Kamath</assignee>
                                    <reporter username="viraj">Viraj Bhat</reporter>
                        <labels>
                    </labels>
                <created>Sat, 6 Dec 2008 02:28:41 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:14 +0000</updated>
                            <resolved>Tue, 6 Jan 2009 01:24:21 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12654024" author="viraj" created="Sat, 6 Dec 2008 02:30:21 +0000"  >&lt;p&gt;Table1 for test&lt;/p&gt;</comment>
                            <comment id="12654025" author="viraj" created="Sat, 6 Dec 2008 02:31:51 +0000"  >&lt;p&gt;Table2 for test&lt;/p&gt;</comment>
                            <comment id="12660428" author="pkamath" created="Fri, 2 Jan 2009 23:59:40 +0000"  >&lt;p&gt;The issue was that table 1 has only one column which is also the join key. Due to a recent optimization wherein parts of the value which are in the key would be omitted, this results in an empty tuple being sent as the value from POLocalRearrange.  The POPackage following the POLocalRearrange would look at metadata stored in itself to figure out how to construct the value out of the key if necessary. However when the POLocalRearrange is in a reduce and the POPackage is in the next map, the POLocalRearrange output gets written to DFS in BinStorage format resulting in a tuple of size 0 being written out. BinStorage while reading considers a tuple of size 0 to be a fatal error.&lt;/p&gt;

&lt;p&gt;Fix:&lt;br/&gt;
The patch fixes BinStorage to consider a tuple of size 0 to be a valid tuple which is reconstructed as such. The POPackage then builds up the correct value from the key. The patch also has a unit test to test this.&lt;/p&gt;

&lt;p&gt;The unit test depends on certain functions introduced in MiniCluster and test/org/apache/pig/test/Util.java as of the patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-580&quot; title=&quot;PERFORMANCE: Combiner should also be used when there are distinct aggregates in a foreach following a group provided there are no non-algebraics in the foreach &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-580&quot;&gt;&lt;del&gt;PIG-580&lt;/del&gt;&lt;/a&gt;. If &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-580&quot; title=&quot;PERFORMANCE: Combiner should also be used when there are distinct aggregates in a foreach following a group provided there are no non-algebraics in the foreach &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-580&quot;&gt;&lt;del&gt;PIG-580&lt;/del&gt;&lt;/a&gt; is not committed before this patch, then the &quot;additional&quot; patch (&quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-558&quot; title=&quot;Distinct followed by a Join results in Invalid size 0 for a tuple error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-558&quot;&gt;&lt;del&gt;PIG-558&lt;/del&gt;&lt;/a&gt;-additional.patch&quot;) attached here should also be applied.&lt;/p&gt;</comment>
                            <comment id="12661017" author="olgan" created="Tue, 6 Jan 2009 01:24:21 +0000"  >&lt;p&gt;patch committed; thanks, pradeep&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12397046" name="PIG-558-additional.patch" size="3312" author="pkamath" created="Sat, 3 Jan 2009 00:00:35 +0000"/>
                            <attachment id="12397045" name="PIG-558.patch" size="3572" author="pkamath" created="Sat, 3 Jan 2009 00:00:34 +0000"/>
                            <attachment id="12395468" name="table1" size="96" author="viraj" created="Sat, 6 Dec 2008 02:30:21 +0000"/>
                            <attachment id="12395469" name="table2" size="71" author="viraj" created="Sat, 6 Dec 2008 02:31:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164154</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 47 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0glon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94943</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>