<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:00:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4299] SpillableMemoryManager assumes tenured heap incorrectly</title>
                <link>https://issues.apache.org/jira/browse/PIG-4299</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (MemoryPoolMXBean b: mpbeans) {
            log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Found heap (&quot;&lt;/span&gt; + b.getName() +
                &lt;span class=&quot;code-quote&quot;&gt;&quot;) of type &quot;&lt;/span&gt; + b.getType());
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (b.getType() == MemoryType.HEAP) {
                /* Here we are making the leap of faith that the biggest
                 * heap is the tenured heap
                 */
                &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; size = b.getUsage().getMax();
                totalSize += size;
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (size &amp;gt; biggestSize) {
                    biggestSize = size;
                    biggestHeap = b;
                }
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A memory pool being the biggest MemoryType.HEAP does not guarantee it being tenured. Moreover, we must check whether usage threshold is supported by heap before trying to set usage threshold on it.&lt;/p&gt;

&lt;p&gt;Here is the stacktrace that resulted from this bug&lt;/p&gt;

&lt;p&gt;java.lang.UnsupportedOperationException: Usage threshold is not supported&lt;br/&gt;
at sun.management.MemoryPoolImpl.setUsageThreshold(MemoryPoolImpl.java:114)&lt;br/&gt;
at org.apache.pig.impl.util.SpillableMemoryManager.&amp;lt;init&amp;gt;(SpillableMemoryManager.java:130)&lt;br/&gt;
at org.apache.pig.impl.util.SpillableMemoryManager.getInstance(SpillableMemoryManager.java:135)&lt;br/&gt;
at org.apache.pig.data.BagFactory.&amp;lt;init&amp;gt;(BagFactory.java:123)&lt;br/&gt;
at org.apache.pig.data.DefaultBagFactory.&amp;lt;init&amp;gt;(DefaultBagFactory.java:69)&lt;br/&gt;
at org.apache.pig.data.BagFactory.getInstance(BagFactory.java:81)&lt;br/&gt;
at search.dashboard.VariableLengthTupleToBag.&amp;lt;clinit&amp;gt;(VariableLengthTupleToBag.java:27)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12753229">PIG-4299</key>
            <summary>SpillableMemoryManager assumes tenured heap incorrectly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="prkommireddi">Prashant Kommireddi</assignee>
                                    <reporter username="prkommireddi">Prashant Kommireddi</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Nov 2014 23:47:46 +0000</created>
                <updated>Fri, 21 Nov 2014 05:58:16 +0000</updated>
                            <resolved>Fri, 7 Nov 2014 23:28:45 +0000</resolved>
                                    <version>0.13.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14201688" author="prkommireddi" created="Fri, 7 Nov 2014 06:38:27 +0000"  >&lt;p&gt;Tenured (oldgen) is not always the largest.&lt;br/&gt;
In an environment running with larger young gen (so to increase the chances that object die young), this will be a problem as per the current code which makes the assumption that the largest pool is &quot;tenured&quot;.&lt;/p&gt;

&lt;p&gt;Changed the way a pool is determined as tenured. &quot;Old gen&quot; or tenured is the only memory pool that allows setting usage threshold.&lt;/p&gt;

&lt;p&gt;Unit tests pass around SpillableMemoryManager, namely TestDataBag and TestPOPartialAgg.&lt;/p&gt;</comment>
                            <comment id="14202869" author="daijy" created="Fri, 7 Nov 2014 22:47:19 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14202931" author="daijy" created="Fri, 7 Nov 2014 23:28:45 +0000"  >&lt;p&gt;Patch committed to both trunk and 0.14 branch. Thanks Prashant!&lt;/p&gt;</comment>
                            <comment id="14202951" author="prkommireddi" created="Fri, 7 Nov 2014 23:43:15 +0000"  >&lt;p&gt;Thanks Daniel! Seems like our commits to branch 0.14 went around the same time and mine messed up the earlier commit. I just did a fresh commit once again. I didn&apos;t touch trunk so your commit was fine.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12680104" name="PIG-4299_1.patch" size="3183" author="prkommireddi" created="Fri, 7 Nov 2014 06:38:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2212f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>