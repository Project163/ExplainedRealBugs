<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:00:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4426] RowNumber(simple) Rank not producing correct results</title>
                <link>https://issues.apache.org/jira/browse/PIG-4426</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4392&quot; title=&quot;RANK BY fails when default_parallel is greater than cardinality of field being ranked by&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4392&quot;&gt;&lt;del&gt;PIG-4392&lt;/del&gt;&lt;/a&gt;, started seeing TestRank3.testRankWithSplitInMap (and some others) failing with &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Comparing actual and expected results.  expected:&amp;lt;[(1,1,2), (1,1,2), (1,3,1), (2,1,2), (3,1,2), (3,2,3), (3,2,4), (4,2,3), (5,2,4), (5,3,1)]&amp;gt; but was:&amp;lt;[(1,1,2), (1,1,2), (3,2,3), (3,2,4), (5,3,1)]&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12776308">PIG-4426</key>
            <summary>RowNumber(simple) Rank not producing correct results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Feb 2015 23:11:21 +0000</created>
                <updated>Sun, 7 Jun 2015 03:47:31 +0000</updated>
                            <resolved>Tue, 24 Feb 2015 23:14:30 +0000</resolved>
                                    <version>0.15.0</version>
                                    <fixVersion>0.15.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14328300" author="knoguchi" created="Thu, 19 Feb 2015 23:21:22 +0000"  >&lt;p&gt;I haven&apos;t fully understood the Rank (mapreduce) implementation, but it seems like for simple(rownumber) rank, it runs POCounter on the mapper side whereas for others it uses reducer.&lt;/p&gt;

&lt;p&gt;As a result, &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;JobControlCompiler.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 381     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void saveCounters(Job job, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; operationID) {
...
 412             &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0;i&amp;lt;job.getJob().getNumReduceTasks();i++) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I believe we need to getNumMapTasks() for simple rownumber ranks.&lt;/p&gt;

&lt;p&gt;Simple test (TestRank1) should have also failed but the results weren&apos;t compared for an exact match.  Changed the test a bit so that it will fail.&lt;br/&gt;
Running unit and e2e tests with this patch.&lt;/p&gt;</comment>
                            <comment id="14333794" author="knoguchi" created="Mon, 23 Feb 2015 20:48:22 +0000"  >&lt;p&gt;From v01 patch, getting rid of unnecessary comparisons in tests and improving error messages.&lt;/p&gt;

&lt;p&gt;To summarize,  the patch itself fixes,&lt;/p&gt;

&lt;p&gt;Unit test TestRank3.testRankWithSplitIn{Map,Reduce} and E2E test Rank1,4,5,6.&lt;/p&gt;

&lt;p&gt;Also the change to unit test TestRank{1,2,3} makes the test fail without the patch for TestRank1.testRank01RowNumber, TestRank1.testRank02RowNumber and TestRank3.testRankCascade  and succeed with the patch.&lt;/p&gt;

</comment>
                            <comment id="14335271" author="knoguchi" created="Tue, 24 Feb 2015 19:13:51 +0000"  >&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4392&quot; title=&quot;RANK BY fails when default_parallel is greater than cardinality of field being ranked by&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4392&quot;&gt;&lt;del&gt;PIG-4392&lt;/del&gt;&lt;/a&gt;, it was pointed out that the trunk doesn&apos;t compile on hadoop-1.2. &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    [javac]             for (int i=0;i&amp;lt;job.getJob().getNumReduceTasks();i++) {
    [javac]                               ^
    [javac]   symbol:   method getJob()
    [javac]   location: variable job of type Job
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My patch on this ticket (v01&amp;amp;v02) also had this issue.  Uploading another one which simply calls job.getJobConf().&lt;/p&gt;</comment>
                            <comment id="14335580" author="daijy" created="Tue, 24 Feb 2015 22:29:02 +0000"  >&lt;p&gt;+1 for v03. Sorry for introducing the test failure, thanks for the fix!&lt;/p&gt;</comment>
                            <comment id="14335640" author="knoguchi" created="Tue, 24 Feb 2015 23:14:30 +0000"  >&lt;p&gt;Thanks for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt; !  Committed to trunk.&lt;/p&gt;</comment>
                            <comment id="14335810" author="daijy" created="Wed, 25 Feb 2015 01:31:55 +0000"  >&lt;p&gt;Also note current counter based approach is not scalable. It would easily hit system counter limit. Need to switch to a hdfs file based approach.&lt;/p&gt;</comment>
                            <comment id="14336605" author="knoguchi" created="Wed, 25 Feb 2015 15:19:40 +0000"  >&lt;p&gt;+1 on moving away from counter based approach. (I believe Tez version of Rank already does that.)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12699772" name="pig-4426-v01.txt" size="11668" author="knoguchi" created="Thu, 19 Feb 2015 23:21:22 +0000"/>
                            <attachment id="12700257" name="pig-4426-v02.txt" size="13844" author="knoguchi" created="Mon, 23 Feb 2015 20:48:22 +0000"/>
                            <attachment id="12700550" name="pig-4426-v03.txt" size="13752" author="knoguchi" created="Tue, 24 Feb 2015 19:13:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25u1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>