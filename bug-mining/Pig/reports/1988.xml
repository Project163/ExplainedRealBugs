<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:03:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-5355] Negative progress report by HBaseTableRecordReader</title>
                <link>https://issues.apache.org/jira/browse/PIG-5355</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The logic for padding the current row does not consider the updated padded row during the comparison. It ends up with different length then expected. This results in negative value for &lt;tt&gt;processed&lt;/tt&gt;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] lastPadded = currRow_;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (currRow_.length &amp;lt; endRow_.length) {
                lastPadded = Bytes.padTail(currRow_, endRow_.length - currRow_.length);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (currRow_.length &amp;lt; startRow_.length) {
                lastPadded = Bytes.padTail(currRow_, startRow_.length - currRow_.length);
            }

            &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] prependHeader = {1, 0};
            BigInteger bigLastRow = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigInteger(Bytes.add(prependHeader, lastPadded));
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (bigLastRow.compareTo(bigEnd_) &amp;gt; 0) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; progressSoFar_;
            }
            BigDecimal processed = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(bigLastRow.subtract(bigStart_));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The fix is to use &lt;tt&gt;lastPadded&lt;/tt&gt; in the second &lt;tt&gt;if&lt;/tt&gt; comparison and &lt;tt&gt;Bytes.padTail&lt;/tt&gt; call inside that &lt;tt&gt;if&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4700&quot; title=&quot;Enable progress reporting for Tasks in Tez&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4700&quot;&gt;&lt;del&gt;PIG-4700&lt;/del&gt;&lt;/a&gt; added progress reporting. This enabled ProgressHelper in Tez. It calls &lt;tt&gt;getProgress&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/tez/blob/master/tez-api/src/main/java/org/apache/tez/common/ProgressHelper.java#L50&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here &lt;/a&gt; on &lt;tt&gt;PigRecrodReader&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/pig/blob/trunk/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/PigRecordReader.java#L159&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/pig/blob/trunk/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/PigRecordReader.java#L159&lt;/a&gt; . Since Pig is reporting negative progress, job is getting killed by AM.&lt;br/&gt;
&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13181976">PIG-5355</key>
            <summary>Negative progress report by HBaseTableRecordReader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="satishsaley">Satish Saley</assignee>
                                    <reporter username="satishsaley">Satish Saley</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Aug 2018 19:35:06 +0000</created>
                <updated>Thu, 27 Sep 2018 18:16:19 +0000</updated>
                            <resolved>Thu, 27 Sep 2018 18:16:19 +0000</resolved>
                                                    <fixVersion>0.17.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16603624" author="rohini" created="Tue, 4 Sep 2018 21:38:26 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16609497" author="rohini" created="Mon, 10 Sep 2018 16:58:04 +0000"  >&lt;p&gt;It should be &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (currRow_.length &amp;lt; maxRowLength) {		
              lastPadded = Bytes.padTail(currRow_, maxRowLength - currRow_.length);		
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; in your first patch. Sorry I missed it. Thanks Koji for catching it&lt;/p&gt;</comment>
                            <comment id="16609512" author="satishsaley" created="Mon, 10 Sep 2018 17:12:32 +0000"  >&lt;p&gt;updated patch&lt;/p&gt;</comment>
                            <comment id="16609725" author="knoguchi" created="Mon, 10 Sep 2018 20:06:03 +0000"  >&lt;p&gt;Thanks for the fix.&#160; Looks good to me.&#160; +1&#160;&lt;/p&gt;

&lt;p&gt;Outside of this jira, I still don&apos;t like the logic of &lt;tt&gt;HBaseTableInputFormat.getProgress()&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (bigLastRow.compareTo(bigEnd_) &amp;gt; 0) {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; progressSoFar_;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which means when records have longer key length than &lt;tt&gt;max(startRow_.length,endRow_.length)&lt;/tt&gt;, progress stays the same.&lt;/p&gt;</comment>
                            <comment id="16620669" author="knoguchi" created="Wed, 19 Sep 2018 14:28:24 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Outside of this jira, I still don&apos;t like the logic of &lt;tt&gt;HBaseTableInputFormat.getProgress()&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (bigLastRow.compareTo(bigEnd_) &amp;gt; 0) {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; progressSoFar_;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which means when records have longer key length than &lt;tt&gt;max(startRow_.length,endRow_.length)&lt;/tt&gt;, progress stays the same.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=satishsaley&quot; class=&quot;user-hover&quot; rel=&quot;satishsaley&quot;&gt;satishsaley&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;, how about we truncate (by calling Bytes.head) when  &lt;br/&gt;
&lt;tt&gt;maxRowLength &amp;lt; currRow_.length&lt;/tt&gt; ?&lt;/p&gt;

&lt;p&gt;Or, I&apos;m fine committing as is.  Most important of the patch is avoiding the negative progress report.&lt;/p&gt;</comment>
                            <comment id="16624228" author="rohini" created="Fri, 21 Sep 2018 21:49:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;Or, I&apos;m fine committing as is.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt; I think better to leave it at this. Logic seems to be taken from here - &lt;a href=&quot;https://github.com/apache/hbase/blob/master/hbase-common/src/main/java/org/apache/hadoop/hbase/util/Bytes.java#L1846-L1867&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hbase/blob/master/hbase-common/src/main/java/org/apache/hadoop/hbase/util/Bytes.java#L1846-L1867&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16630852" author="knoguchi" created="Thu, 27 Sep 2018 18:16:19 +0000"  >&lt;p&gt;Committed to 0.17 branch and trunk. &lt;/p&gt;

&lt;p&gt;Thanks Satish!!! &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12904938">PIG-4700</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12938361" name="PIG-5355-1.patch" size="2966" author="satishsaley" created="Tue, 4 Sep 2018 21:13:11 +0000"/>
                            <attachment id="12938901" name="PIG-5355-2.patch" size="2430" author="satishsaley" created="Fri, 7 Sep 2018 21:25:23 +0000"/>
                            <attachment id="12939125" name="PIG-5355-3.patch" size="2825" author="satishsaley" created="Mon, 10 Sep 2018 17:12:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3xkbz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>