<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-5108] AvroStorage on Tez with exception on nested records</title>
                <link>https://issues.apache.org/jira/browse/PIG-5108</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;While migrating to the latest Pig version we have seen a general issue when using nested Avro records on Tez:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: java.io.IOException: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.pig.impl.util.avro.AvroTupleWrapper.write called, but not implemented yet
	at org.apache.pig.impl.util.avro.AvroTupleWrapper.write(AvroTupleWrapper.java:68)
	at org.apache.pig.impl.io.PigNullableWritable.write(PigNullableWritable.java:139)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The setup is&lt;br/&gt;
schema&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{
    &lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt;: [
        {
            &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;
        },
        {
            &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;property&quot;&lt;/span&gt;,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: {
                &lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt;: [
                    {
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;,
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;
                    }
                ],
                &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;Property&quot;&lt;/span&gt;,
                &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;
            }
        }
    ],
    &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;Person&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;namespace&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;com.github.ouyi.avro&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pig script group_person.pig&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;loaded_person =
    LOAD &lt;span class=&quot;code-quote&quot;&gt;&apos;$input&apos;&lt;/span&gt;
    USING AvroStorage();

grouped_records =
    GROUP
        loaded_person BY (property.id);

STORE grouped_records
    INTO &lt;span class=&quot;code-quote&quot;&gt;&apos;$output&apos;&lt;/span&gt;
    USING AvroStorage();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;sample data&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;property&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:1}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Execution on Tez&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;pig -x tez_local -p input=file:&lt;span class=&quot;code-comment&quot;&gt;///usr/lib/pig/pig-0.16.0/person-prop.avro -p output=file:///output group_person.pig
&lt;/span&gt;...
Caused by: java.io.IOException: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.pig.impl.util.avro.AvroTupleWrapper.write called, but not implemented yet
	at org.apache.pig.impl.util.avro.AvroTupleWrapper.write(AvroTupleWrapper.java:68)
	at org.apache.pig.impl.io.PigNullableWritable.write(PigNullableWritable.java:139)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Execution on mapred&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;pig -x local -p input=file:&lt;span class=&quot;code-comment&quot;&gt;///usr/lib/pig/pig-0.16.0/person-prop.avro -p output=file:///output7 group_person.pig
&lt;/span&gt;...
Output(s):
Successfully stored 1 records in: &lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///output7&quot;&lt;/span&gt;
&lt;/span&gt;...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am going to attach the complete log files of both runs.&lt;/p&gt;

&lt;p&gt;I assume that the Pig script should work regardless of Tez or mapreduce? Is there any underlying change when migrating to Tez which makes the schema invalid?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Sebastian&lt;/p&gt;</description>
                <environment>&lt;p&gt;HadoopVersion: 2.6.0-cdh5.8.0&lt;br/&gt;
PigVersion: 0.16.0&lt;br/&gt;
TezVersion: 0.7.0&lt;/p&gt;</environment>
        <key id="13035581">PIG-5108</key>
            <summary>AvroStorage on Tez with exception on nested records</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="sgeller@teamaol.com">Sebastian Geller</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Jan 2017 15:51:48 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:31 +0000</updated>
                            <resolved>Mon, 23 Jan 2017 17:31:51 +0000</resolved>
                                    <version>0.16.0</version>
                                    <fixVersion>0.17.0</fixVersion>
                    <fixVersion>0.16.1</fixVersion>
                                    <component>tez</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15826870" author="rohini" created="Tue, 17 Jan 2017 21:31:24 +0000"  >&lt;p&gt;Deleted the original PIG-5103 which was faulty having been created during maintenance.&lt;/p&gt;</comment>
                            <comment id="15827070" author="daijy" created="Tue, 17 Jan 2017 23:44:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sgeller&quot; class=&quot;user-hover&quot; rel=&quot;sgeller&quot;&gt;sgeller&lt;/a&gt;, can you upload person-prop.avro to make our reproduce easier?&lt;/p&gt;</comment>
                            <comment id="15827560" author="sgeller@teamaol.com" created="Wed, 18 Jan 2017 07:49:05 +0000"  >&lt;p&gt;Attached person-prop.&lt;/p&gt;</comment>
                            <comment id="15827771" author="ouyi" created="Wed, 18 Jan 2017 10:08:16 +0000"  >&lt;p&gt;The issue was also reproduced on AWS EMR 5.2.1, with the following Pig, Tez, and Hadoop versions:&lt;/p&gt;

&lt;p&gt;tez.noarch                    0.8.4-1.amzn1                            @Bigtop&lt;br/&gt;
pig.noarch                    0.16.0.amzn.0-1.amzn1                    @Bigtop&lt;br/&gt;
hadoop.x86_64                 2.7.3.amzn.1-1.amzn1                     @Bigtop&lt;/p&gt;</comment>
                            <comment id="15828907" author="daijy" created="Wed, 18 Jan 2017 22:43:43 +0000"  >&lt;p&gt;AvroTupleWrapper.write needs implementation to cross vertex boundary. The script success in MR because all tuple will be converted to BinSedesTuple first (PigGenericMapBase:271).&lt;/p&gt;</comment>
                            <comment id="15828911" author="rohini" created="Wed, 18 Jan 2017 22:46:46 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15829003" author="daijy" created="Wed, 18 Jan 2017 23:51:29 +0000"  >&lt;p&gt;Patch committed to both trunk and 0.16 branch. Thanks Rohini for super fast review!&lt;/p&gt;</comment>
                            <comment id="15829484" author="sgeller@teamaol.com" created="Thu, 19 Jan 2017 07:56:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;&lt;br/&gt;
Thank you very much!&lt;/p&gt;</comment>
                            <comment id="15829556" author="ouyi" created="Thu, 19 Jan 2017 09:04:41 +0000"  >&lt;p&gt;Thanks guys!&lt;/p&gt;</comment>
                            <comment id="15830809" author="rohini" created="Thu, 19 Jan 2017 23:21:38 +0000"  >&lt;p&gt;Reopening issue as it only fixes the problem for this tuple type. Came across another one which extended DefaultTuple and it errored out with &quot;Unexpected datatype 110 while reading tuplefrom binary file&quot;&lt;/p&gt;</comment>
                            <comment id="15830816" author="rohini" created="Thu, 19 Jan 2017 23:27:24 +0000"  >&lt;p&gt;Attaching patch which does a tuple copy in POSimpleTezLoad similar to PigGenericMapReduce which Daniel pointed out.&lt;/p&gt;</comment>
                            <comment id="15834129" author="daijy" created="Mon, 23 Jan 2017 09:33:43 +0000"  >&lt;p&gt;+1 for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-5108&quot; title=&quot;AvroStorage on Tez with exception on nested records&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-5108&quot;&gt;&lt;del&gt;PIG-5108&lt;/del&gt;&lt;/a&gt;-2-addendum.patch.&lt;/p&gt;</comment>
                            <comment id="15834920" author="rohini" created="Mon, 23 Jan 2017 17:31:51 +0000"  >&lt;p&gt;Committed to branch-0.16 and trunk. Thanks for the review Daniel.&lt;/p&gt;</comment>
                            <comment id="16023133" author="rohini" created="Wed, 24 May 2017 15:59:06 +0000"  >&lt;p&gt;Deleted PIG-5090 to PIG-5099 which are duplicates of this jira created during a jira outage.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12848154" name="PIG-5108-1.patch" size="2997" author="daijy" created="Wed, 18 Jan 2017 22:43:43 +0000"/>
                            <attachment id="12848414" name="PIG-5108-2-addendum.patch" size="2402" author="rohini" created="Thu, 19 Jan 2017 23:27:24 +0000"/>
                            <attachment id="12848008" name="person-prop.avro" size="279" author="sgeller@teamaol.com" created="Wed, 18 Jan 2017 07:48:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38tov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>