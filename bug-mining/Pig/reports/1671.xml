<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:00:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4412] Race condition in writing multiple outputs from STREAM op</title>
                <link>https://issues.apache.org/jira/browse/PIG-4412</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Basically copying the issue described here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/28327044/pig-streaming-some-output-files-are-missing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/28327044/pig-streaming-some-output-files-are-missing&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Roughly, I believe the issue is that there is a race condition in the code in the HadoopExecutableManager that moves multiple output files from a script into HDFS and the MapReduce task that is shutting down after it writes the last bits from the &quot;main&quot; output of the STREAM task. Pig needs to make sure that the ExecutableManager is closed (and thus the files are moved from the local dir to HDFS) before it returns the end-of-stream tuple to signal that the stream is finished.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12774012">PIG-4412</key>
            <summary>Race condition in writing multiple outputs from STREAM op</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="jwills">Josh Wills</assignee>
                                    <reporter username="jwills">Josh Wills</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Feb 2015 23:12:26 +0000</created>
                <updated>Fri, 13 Jun 2025 16:49:35 +0000</updated>
                                                            <fixVersion>0.20.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14315153" author="jwills" created="Tue, 10 Feb 2015 23:14:12 +0000"  >&lt;p&gt;Patch I wrote for this. It seems plausible that it works, but I don&apos;t know Pig well enough to know if there is a better way to do this.&lt;/p&gt;</comment>
                            <comment id="14340523" author="daijy" created="Fri, 27 Feb 2015 18:34:14 +0000"  >&lt;p&gt;LGTM. Committed to trunk. Thanks Josh!&lt;/p&gt;</comment>
                            <comment id="14344031" author="rohini" created="Mon, 2 Mar 2015 23:46:16 +0000"  >&lt;p&gt;Had TestStreamingLocal.testSimpleMapSideStreaming fail with below error in one of the runs. Succeeded next time. Believe it is introduced by this patch.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;WARN  org.apache.hadoop.mapred.LocalJobRunner  - job_local1751597657_0011
java.lang.Exception: org.apache.pig.backend.executionengine.ExecException: ERROR 2083: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; trying to get next result in POStream.
	at org.apache.hadoop.mapred.LocalJobRunner$Job.runTasks(LocalJobRunner.java:462)
	at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:522)
Caused by: org.apache.pig.backend.executionengine.ExecException: ERROR 2083: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; trying to get next result in POStream.
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POStream.getNextTuple(POStream.java:251)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.runPipeline(PigGenericMapBase.java:279)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.cleanup(PigGenericMapBase.java:123)
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:148)
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:340)
	at org.apache.hadoop.mapred.LocalJobRunner$Job$MapTaskRunnable.run(LocalJobRunner.java:243)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)
	at java.util.concurrent.FutureTask.run(FutureTask.java:166)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:722)
Caused by: java.lang.NullPointerException
	at org.apache.pig.impl.streaming.ExecutableManager.close(ExecutableManager.java:132)
	at org.apache.pig.backend.hadoop.streaming.HadoopExecutableManager.close(HadoopExecutableManager.java:131)
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POStream.finish(POStream.java:363)
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POStream.getNextTuple(POStream.java:172)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14345566" author="daijy" created="Tue, 3 Mar 2015 19:22:49 +0000"  >&lt;p&gt;How about making ExecutableManager.close synchronized?&lt;/p&gt;</comment>
                            <comment id="14345683" author="daijy" created="Tue, 3 Mar 2015 20:30:12 +0000"  >&lt;p&gt;Seems TestStreaming also hang due to the patch and I don&apos;t have a quick answer why. Rollback the patch temporary until we figure out the reason.&lt;/p&gt;</comment>
                            <comment id="14345779" author="rohini" created="Tue, 3 Mar 2015 21:34:20 +0000"  >&lt;p&gt;StreamingIO_3.pig also hung.&lt;/p&gt;</comment>
                            <comment id="14345910" author="rohini" created="Tue, 3 Mar 2015 22:40:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;How about making ExecutableManager.close synchronized?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;  Based on the stackoverflow problem description, the problem that the user is saying is that ExecutableManager.close is not called in some cases.  Before this patch the POStream.finish() method was never called by any code. The ExecutableManager.close() was directly called, but only in ProcessInputThread. We need to find the exact case and add close() there. Adding it in all probable places is closing it prematurely in some cases and causing the NPE and hanging problems.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12697913" name="PIG-4412.patch" size="3493" author="jwills" created="Tue, 10 Feb 2015 23:14:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 38 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25g73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>