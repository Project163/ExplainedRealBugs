<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:49:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-597] Pig does not handdle correctly the case where &quot;*&quot; is passed to UDF</title>
                <link>https://issues.apache.org/jira/browse/PIG-597</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Script:&lt;br/&gt;
======&lt;br/&gt;
A = LOAD &apos;foo&apos; USING PigStorage(&apos;\t&apos;);&lt;br/&gt;
B = FILTER A BY ARITY&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &amp;lt; 5;&lt;br/&gt;
DUMP B;&lt;/p&gt;

&lt;p&gt;Error:&lt;br/&gt;
=====&lt;/p&gt;

&lt;p&gt;2009-01-05 21:46:56,355 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; ERROR&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POUserFunc&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Caught error from UDF&lt;br/&gt;
org.apache.pig.builtin.ARITY[org.apache.pig.data.DataByteArray cannot be cast to org.apache.pig.data.Tuple &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.pig.data.DataByteArray cannot be cast to org.apache.pig.data.Tuple&amp;#93;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Problem:&lt;br/&gt;
=======&lt;/p&gt;

&lt;p&gt;Santhosh tracked this to the following code in POUserFunc.java:&lt;/p&gt;

&lt;p&gt;if(op instanceof POProject &amp;amp;&amp;amp;&lt;br/&gt;
                        op.getResultType() == DataType.TUPLE){&lt;br/&gt;
                    POProject projOp = (POProject)op;&lt;br/&gt;
                    if(projOp.isStar())&lt;/p&gt;
{
                        Tuple trslt = (Tuple) temp.result;
                        Tuple rslt = (Tuple) res.result;
                        for(int i=0;i&amp;lt;trslt.size();i++)
                            rslt.append(trslt.get(i));
                        continue;
                    }
&lt;p&gt;                }&lt;/p&gt;

&lt;p&gt;It seems to be unwrapping the tuple before passing it to the function. There is no comments so we are not sure why it is there; will need to run tests to see if removing it would solve this issue and not create others.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12411727">PIG-597</key>
            <summary>Pig does not handdle correctly the case where &quot;*&quot; is passed to UDF</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shravanmn">Shravan Matthur Narayanamurthy</assignee>
                                    <reporter username="olgan">Olga Natkovich</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Jan 2009 23:27:52 +0000</created>
                <updated>Thu, 25 Mar 2010 00:12:44 +0000</updated>
                            <resolved>Sat, 17 Jan 2009 00:30:59 +0000</resolved>
                                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12663008" author="olgan" created="Mon, 12 Jan 2009 17:09:29 +0000"  >&lt;p&gt;Commenting this code breaks ORDER BY. I believe that this change is still correct and the sampling code need to be changed to work with it.&lt;/p&gt;</comment>
                            <comment id="12663306" author="shravanmn" created="Tue, 13 Jan 2009 11:18:02 +0000"  >&lt;p&gt;The exception is being thrown from ARITY where it is trying to convert the first field of the tuple into a tuple. However, since we have a star, the tuple is not wrapped inside another tuple and hence the exception.&lt;/p&gt;

&lt;p&gt;This was done in order to model the trunk behavior which is that there is an implicit flatten in front of a *. If we want to retain this behavior, then we need to change ARITY &amp;amp; other functions which were written with the assumption that POUserFunc will wrap anything inside a tuple though most of these functions will be useless when we have a UDF which outputs a tuple. To give an example, say we have a function which returns a tuple and we want to find its arity, ARITY(TupleRetUDF&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;) will always return one since POUserFunc will wrap the output of TupleRetUDF into another tuple and ARITY is changed to return just the size of the input tuple and not the size of the first field.&lt;/p&gt;

&lt;p&gt;However, if we comment this code, then we need to modify FindQuantiles to consider the fact that everything will be wrapped inside a tuple &amp;amp; the behavior is not conditional upon the use of a star. I think this is better and Olga seems to agree as per her previous comment. Any other thoughts? Retain trunk behavior or change it?&lt;/p&gt;</comment>
                            <comment id="12663950" author="olgan" created="Thu, 15 Jan 2009 00:34:00 +0000"  >&lt;p&gt;Shravan, thanks for providing the background.&lt;/p&gt;

&lt;p&gt;I still believe that we need to make &quot;&lt;b&gt;&quot; work like any other tuple. One reason is that a UDF that works with&quot;&lt;/b&gt;&quot; would not be able to work if any other tuple is passed to it which seems wrong. I don&apos;t know of any UDFs other than ARITY and SIZE that are specifically written for * so I think the impact to the users would be minimal.&lt;/p&gt;</comment>
                            <comment id="12664534" author="shravanmn" created="Fri, 16 Jan 2009 14:47:41 +0000"  >&lt;p&gt;Fixed by commenting the POStar code in POUserFunc and made minor changes to FindQuantiles &amp;amp; TestFRJoin. Changes TestBuiltin to include the commented assert statement for arity.&lt;/p&gt;</comment>
                            <comment id="12664751" author="olgan" created="Sat, 17 Jan 2009 00:30:58 +0000"  >&lt;p&gt;patch committed. Thanks, SHravan&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12398076" name="597.patch" size="3287" author="shravanmn" created="Fri, 16 Jan 2009 14:50:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164190</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 45 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gm5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95020</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>