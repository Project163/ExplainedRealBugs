<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-5067] Revisit union on numeric type and chararray to bytearray</title>
                <link>https://issues.apache.org/jira/browse/PIG-5067</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2071&quot; title=&quot;casting numeric type to chararray during schema merge for union is inconsistent with other schema merge cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2071&quot;&gt;&lt;del&gt;PIG-2071&lt;/del&gt;&lt;/a&gt;, we changed the behavior of union on numeric and chararray to bytearray.&lt;/p&gt;

&lt;p&gt;This itself was always failing at runtime until we changed to skip the bytearray typecast for union-onschema in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3270&quot; title=&quot;Union onschema failing at runtime when merging incompatible types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3270&quot;&gt;&lt;del&gt;PIG-3270&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
(For union, it still fails with typecast to bytearray error. )&lt;/p&gt;

&lt;p&gt;Now, seeing users getting inconsistent results due to this union-ed bytearray.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13021851">PIG-5067</key>
            <summary>Revisit union on numeric type and chararray to bytearray</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Nov 2016 20:50:44 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:13 +0000</updated>
                            <resolved>Fri, 2 Dec 2016 15:59:29 +0000</resolved>
                                                    <fixVersion>0.17.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15677729" author="knoguchi" created="Fri, 18 Nov 2016 20:54:28 +0000"  >&lt;p&gt;Discussed with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt; offline and she pointed out &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Either chararray should be converted to numeric or other way round. Doesn&apos;t make sense to consider them as bytearray. All key based operations (order by, join, group by) will give wrong output&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;, asking for your input.&lt;/p&gt;</comment>
                            <comment id="15677928" author="daijy" created="Fri, 18 Nov 2016 22:14:02 +0000"  >&lt;p&gt;bytearray is a wrong name, it means unknown type in Pig. Union chararray and numeric result an unknown type is reasonable. Order by mixed type makes nonsense. join/&quot;group by&quot; should deal with unknown type, any particular issue did you see?&lt;/p&gt;</comment>
                            <comment id="15677987" author="knoguchi" created="Fri, 18 Nov 2016 22:40:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;any particular issue did you see?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The one I looked at was from user unknowingly mixing two incompatible types in union-onschema and order-by showing completely off results.  &lt;/p&gt;

&lt;p&gt;Also, I prefer to avoid mixed type inside bytearray when possible.  &lt;br/&gt;
Following result is counter-intuitive to me (although I understand why it&apos;s like that).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; A = load &lt;span class=&quot;code-quote&quot;&gt;&apos;1.txt&apos;&lt;/span&gt; as (a1:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
 B = load &lt;span class=&quot;code-quote&quot;&gt;&apos;2.txt&apos;&lt;/span&gt; as (a1:chararray);
 C = UNION onschema A, B; &apos;
 describe C;
 D = GROUP C by a1;
 dump D;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;% cat 1.txt 
1
% cat 2.txt 
1
% pig test.pig 
C: {a1: bytearray}
(1,{(1)})
(1,{(1)})
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15678008" author="daijy" created="Fri, 18 Nov 2016 22:48:00 +0000"  >&lt;p&gt;It produce theoretically right result, but I agree that&apos;s misleading. How about throw a frontend exception if mixing incompatible types?&lt;/p&gt;</comment>
                            <comment id="15678037" author="knoguchi" created="Fri, 18 Nov 2016 23:01:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;How about throw a frontend exception if mixing incompatible types?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1.  With just  &apos;union&apos;, it already fail at compile time since I only took out the (bytearray) typecast for union-onschema and not union in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3270&quot; title=&quot;Union onschema failing at runtime when merging incompatible types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3270&quot;&gt;&lt;del&gt;PIG-3270&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15684919" author="knoguchi" created="Mon, 21 Nov 2016 22:19:11 +0000"  >&lt;p&gt;While looking at the current testcase, saw &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;TestUnionOnSchema.testUnionOnSchemaIncompatibleTypes&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;          query =
              &lt;span class=&quot;code-quote&quot;&gt;&quot;  l1 = load &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt; + INP_FILE_2NUMS + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt; as (x : &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;, y : chararray);&quot;&lt;/span&gt;
              + &lt;span class=&quot;code-quote&quot;&gt;&quot;l2 = load &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt; + INP_FILE_2NUMS + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt; as (x : map[ ], y : chararray);&quot;&lt;/span&gt;
              + &lt;span class=&quot;code-quote&quot;&gt;&quot;u = union onschema l1, l2;&quot;&lt;/span&gt;
          ;
          checkSchemaEquals(query, &lt;span class=&quot;code-quote&quot;&gt;&quot;x : bytearray, y : chararray&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&quot;Union&quot; itself fails while trying to typecast to bytearray but Union-onschema currently passes by skipping bytearray typecast...&lt;br/&gt;
Shall we fail this use-case as well?   Not sure how many users depend on these incompatible type union.&lt;/p&gt;</comment>
                            <comment id="15702964" author="daijy" created="Mon, 28 Nov 2016 20:03:29 +0000"  >&lt;p&gt;We shall mark it a backward incompatible change and document how to fix existing script. But I think this is a reasonable change and we shall go ahead.&lt;/p&gt;</comment>
                            <comment id="15712931" author="knoguchi" created="Thu, 1 Dec 2016 20:04:51 +0000"  >&lt;p&gt;Attaching &lt;tt&gt;pig-5067-v01.patch&lt;/tt&gt; that would &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Fail for incompatible union with &quot;onschema&quot;. Regular union has been failing already.&lt;/li&gt;
	&lt;li&gt;union with different internal column types for tuples or bags are still allowed (with empty schema)&lt;/li&gt;
	&lt;li&gt;Add line-number for &quot;union&quot; failures.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15713461" author="daijy" created="Thu, 1 Dec 2016 23:53:51 +0000"  >&lt;p&gt;+1 pending test.&lt;/p&gt;</comment>
                            <comment id="15715433" author="knoguchi" created="Fri, 2 Dec 2016 15:41:50 +0000"  >&lt;p&gt;Thanks for the review Daniel.&lt;/p&gt;

&lt;p&gt;Tests passed, committing shortly.  &lt;br/&gt;
Found one typo in my error message.  &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt; String msg = &quot;Union of incompatible types now allowed. &quot;
&amp;gt; String msg = &quot;Union of incompatible types not allowed. &quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Obviously, it should be &quot;NOT&quot; allowed.  Updating the patch and committing this one.&lt;/p&gt;</comment>
                            <comment id="15715483" author="knoguchi" created="Fri, 2 Dec 2016 15:59:29 +0000"  >&lt;p&gt;Thanks again for the review Daniel!  &lt;/p&gt;

&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12841342" name="pig-5067-v01.patch" size="14663" author="knoguchi" created="Thu, 1 Dec 2016 20:04:51 +0000"/>
                            <attachment id="12841518" name="pig-5067-v02.patch" size="14663" author="knoguchi" created="Fri, 2 Dec 2016 15:41:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36is7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This change now disallows union-onschema of incompatible types,  (for example, numeric types and chararray). It makes it consistent with plain union.&lt;br/&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>