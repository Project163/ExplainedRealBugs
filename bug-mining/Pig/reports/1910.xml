<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4260] SpillableMemoryManager.spill should revert spill on all exception</title>
                <link>https://issues.apache.org/jira/browse/PIG-4260</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Found by Rohini when working on &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4250&quot; title=&quot;Fix Security Risks found by Coverity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4250&quot;&gt;&lt;del&gt;PIG-4250&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If there is a exception during spill() called by SpillableMemoryManager it will be just ignored. We do not track that there was an exception during spill and throw that back when the bag is accessed next time&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12752207">PIG-4260</key>
            <summary>SpillableMemoryManager.spill should revert spill on all exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rohini">Rohini Palaniswamy</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Sat, 1 Nov 2014 17:49:17 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:35 +0000</updated>
                            <resolved>Wed, 18 Jan 2017 15:41:53 +0000</resolved>
                                                    <fixVersion>0.17.0</fixVersion>
                    <fixVersion>0.16.1</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15819428" author="rohini" created="Wed, 11 Jan 2017 22:46:20 +0000"  >&lt;p&gt;Ran into this when one user had below code in his UDF.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;List&amp;lt;Tuple&amp;gt; data = Arrays.asList(result.getSamples()); &lt;span class=&quot;code-comment&quot;&gt;// Returns a ArrayList implementation which is different from java.util.ArrayList
&lt;/span&gt;DataBag sampleBag = BagFactory.getInstance().newDefaultBag(data);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Arrays.asList creates a ArrayList which does not implement the clear() method. So it throws error when we call mContents.clear() when spilling. Since we swallow that error, next time when that bag is accessed it has twice the records - in mContents and in spill file.&lt;/p&gt;

&lt;p&gt;With this patch, if there is any error we revert the spill. So it would either end up working fine or fail hitting OOM.&lt;/p&gt;</comment>
                            <comment id="15819444" author="knoguchi" created="Wed, 11 Jan 2017 22:54:39 +0000"  >&lt;p&gt;Please add a testcase.&lt;/p&gt;</comment>
                            <comment id="15819545" author="rohini" created="Wed, 11 Jan 2017 23:36:05 +0000"  >&lt;p&gt;Only DefaultDataBag can be made to fail with the problem mentioned above.  Updated patch with test case for that. &lt;/p&gt;</comment>
                            <comment id="15822146" author="knoguchi" created="Fri, 13 Jan 2017 18:49:19 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void warn(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg, Enum warningEnum, Exception e) {
+        warn(msg, warningEnum, e);
+    }
+
+    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void warn(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg, Enum warningEnum, Throwable e) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think this would create an infinite loop with stackoverflow when called with &lt;tt&gt;Exception&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;warn(msg, warningEnum, (Throwable) e);&lt;/tt&gt;  ?&lt;/p&gt;</comment>
                            <comment id="15822347" author="knoguchi" created="Fri, 13 Jan 2017 21:09:16 +0000"  >&lt;p&gt;Other than the above &apos;warn&apos; issue, +1. &lt;/p&gt;</comment>
                            <comment id="15822436" author="rohini" created="Fri, 13 Jan 2017 22:17:11 +0000"  >&lt;p&gt;Actually removed the overloaded method and just changed the method signature. Should be fine as it is just a protected method and not public. &lt;/p&gt;</comment>
                            <comment id="15828281" author="knoguchi" created="Wed, 18 Jan 2017 15:35:11 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15828294" author="rohini" created="Wed, 18 Jan 2017 15:41:47 +0000"  >&lt;p&gt;Committed to branch-0.16 and trunk. Thanks Koji for the review.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12847095" name="PIG-4260-1.patch" size="5888" author="rohini" created="Wed, 11 Jan 2017 22:40:51 +0000"/>
                            <attachment id="12847108" name="PIG-4260-2-nowhitespacechanges.patch" size="8270" author="rohini" created="Wed, 11 Jan 2017 23:34:25 +0000"/>
                            <attachment id="12847109" name="PIG-4260-2.patch" size="33102" author="rohini" created="Wed, 11 Jan 2017 23:34:25 +0000"/>
                            <attachment id="12847429" name="PIG-4260-3-nowhitespacechanges.patch" size="8231" author="rohini" created="Fri, 13 Jan 2017 22:17:11 +0000"/>
                            <attachment id="12847430" name="PIG-4260-3.patch" size="33063" author="rohini" created="Fri, 13 Jan 2017 22:17:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 44 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21uvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>