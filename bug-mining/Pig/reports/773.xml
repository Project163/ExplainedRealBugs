<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:54:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-2137] SAMPLE should not be pushed above DISTINCT</title>
                <link>https://issues.apache.org/jira/browse/PIG-2137</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;I have an input file that contains 50,000 distinct integers. Each integer is repeated twice, for a total of 100,000 lines.&lt;/p&gt;

&lt;p&gt;Script 1, using GROUP BY to get distinct entries in the data, works:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
grunt&amp;gt; f = load &lt;span class=&quot;code-quote&quot;&gt;&apos;tmp/dupnumbers.txt&apos;&lt;/span&gt;;              
grunt&amp;gt; d = foreach (group f by $0) generate group; 
grunt&amp;gt; s = sample d 0.01;                          
grunt&amp;gt; n = foreach (group s all) generate COUNT(s);
grunt&amp;gt; dump n;
(493)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Script 2, using DISTINCT for the same purpose, allows sampling to be done before DISTINCT:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;grunt&amp;gt; f = load &lt;span class=&quot;code-quote&quot;&gt;&apos;tmp/dupnumbers.txt&apos;&lt;/span&gt;;              
grunt&amp;gt; d = distinct f;
grunt&amp;gt; s = sample d 0.01;                          
grunt&amp;gt; n = foreach (group s all) generate COUNT(s);
(980)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12511192">PIG-2137</key>
            <summary>SAMPLE should not be pushed above DISTINCT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dvryaboy">Dmitriy V. Ryaboy</assignee>
                                    <reporter username="dvryaboy">Dmitriy V. Ryaboy</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Jun 2011 03:33:41 +0000</created>
                <updated>Thu, 4 Aug 2011 00:35:02 +0000</updated>
                            <resolved>Fri, 24 Jun 2011 02:39:20 +0000</resolved>
                                    <version>0.8.0</version>
                    <version>0.8.1</version>
                    <version>0.9.0</version>
                    <version>0.10.0</version>
                                    <fixVersion>0.9.0</fixVersion>
                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13053023" author="dvryaboy" created="Wed, 22 Jun 2011 03:42:07 +0000"  >&lt;p&gt;Turning off PushUpFilter fixes the issue. It seems like the fix to &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2014&quot; title=&quot;SAMPLE shouldn&amp;#39;t be pushed up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2014&quot;&gt;&lt;del&gt;PIG-2014&lt;/del&gt;&lt;/a&gt; was incomplete.&lt;/p&gt;</comment>
                            <comment id="13053037" author="dvryaboy" created="Wed, 22 Jun 2011 04:31:17 +0000"  >&lt;p&gt;Easy fix. Attached. Please review.&lt;/p&gt;</comment>
                            <comment id="13053551" author="thejas" created="Thu, 23 Jun 2011 00:02:36 +0000"  >&lt;p&gt;It helps to push filter before distinct operation (ie discard the rows early), and the results will be correct if the udf is deterministic .&lt;br/&gt;
I think the filter pushup should be disabled only for non deterministic udfs.&lt;/p&gt;</comment>
                            <comment id="13053569" author="dvryaboy" created="Thu, 23 Jun 2011 00:43:06 +0000"  >&lt;p&gt;Thejas, I believe my fix still allows that &amp;#8211; it just doesn&apos;t early-terminate the optimizer when encountered distinct, but proceeds to check if the other conditions required for a successful filter push (such as the udf being deterministic) apply.&lt;/p&gt;</comment>
                            <comment id="13053572" author="thejas" created="Thu, 23 Jun 2011 00:49:35 +0000"  >&lt;p&gt;Sorry, my mistake, I didn&apos;t go through the function properly. Changes look good . +1&lt;/p&gt;</comment>
                            <comment id="13053575" author="thejas" created="Thu, 23 Jun 2011 01:00:09 +0000"  >&lt;p&gt;(Sorry again!) Actually, it does disable the optimization for all filters with distinct as predecessor. Patch &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2137&quot; title=&quot;SAMPLE should not be pushed above DISTINCT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2137&quot;&gt;&lt;del&gt;PIG-2137&lt;/del&gt;&lt;/a&gt;.1.patch has fix.&lt;/p&gt;</comment>
                            <comment id="13053577" author="dvryaboy" created="Thu, 23 Jun 2011 01:03:24 +0000"  >&lt;p&gt;Thanks&lt;br/&gt;
I&apos;ll commit &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2137&quot; title=&quot;SAMPLE should not be pushed above DISTINCT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2137&quot;&gt;&lt;del&gt;PIG-2137&lt;/del&gt;&lt;/a&gt;.1 to 0.8, 0.9, and trunk.&lt;/p&gt;</comment>
                            <comment id="13053585" author="thejas" created="Thu, 23 Jun 2011 01:19:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2137&quot; title=&quot;SAMPLE should not be pushed above DISTINCT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2137&quot;&gt;&lt;del&gt;PIG-2137&lt;/del&gt;&lt;/a&gt;.2.patch has a test case for the case when filter should be pushed above distinct. &lt;br/&gt;
I haven&apos;t run unit tests and test-patch with my changes to the patch. I will start them today and it will take couple of hours. If you are able to run them they finish before i get back on results, please feel free to commit.&lt;/p&gt;</comment>
                            <comment id="13053588" author="dvryaboy" created="Thu, 23 Jun 2011 01:24:34 +0000"  >&lt;p&gt;I&apos;ll wait for the test-patch results.&lt;/p&gt;</comment>
                            <comment id="13054155" author="thejas" created="Thu, 23 Jun 2011 22:51:25 +0000"  >&lt;p&gt;Dmitriy,&lt;br/&gt;
Unit tests and test-patch have passed. You can commit the patch.&lt;br/&gt;
But this patch can&apos;t be committed to 0.8, as the Nondeterministic annotation was added only in 0.9.&lt;/p&gt;</comment>
                            <comment id="13054195" author="dvryaboy" created="Fri, 24 Jun 2011 00:38:26 +0000"  >&lt;p&gt;For 0.8 I was going to backport &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2014&quot; title=&quot;SAMPLE shouldn&amp;#39;t be pushed up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2014&quot;&gt;&lt;del&gt;PIG-2014&lt;/del&gt;&lt;/a&gt; before this one.. we are running both in production right now (on top of 8.1), they are fine.&lt;br/&gt;
Although I did have trouble backporting the tests, a bunch of the optimizer interfaces seem to have changed. I don&apos;t think 8 is as important, since it doesn&apos;t seem likely we&apos;ll release 8.2 what with 0.9.0 being almost out the door.&lt;/p&gt;</comment>
                            <comment id="13054220" author="dvryaboy" created="Fri, 24 Jun 2011 02:39:20 +0000"  >&lt;p&gt;Committed to 0.9 and 0.10 (trunk)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12505198">PIG-2014</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12483534" name="PIG-2137.1.patch" size="4120" author="thejas" created="Thu, 23 Jun 2011 00:58:24 +0000"/>
                            <attachment id="12483536" name="PIG-2137.2.patch" size="5416" author="thejas" created="Thu, 23 Jun 2011 01:19:57 +0000"/>
                            <attachment id="12483402" name="PIG-2137.patch" size="3730" author="dvryaboy" created="Wed, 22 Jun 2011 04:31:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>41693</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h17b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97457</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>