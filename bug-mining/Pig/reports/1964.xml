<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:03:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-5299] PartitionFilterOptimizer failing at compile time</title>
                <link>https://issues.apache.org/jira/browse/PIG-5299</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Following (rather simple) code &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;A = LOAD &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/testinput&apos;&lt;/span&gt; using org.apache.pig.test.TestLoader (&lt;span class=&quot;code-quote&quot;&gt;&apos;srcid:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, mrkt:chararray, dstid:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, name:chararray&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;srcid&apos;&lt;/span&gt;); --srcid is the partition-key
B= filter A by dstid != 10 OR ((dstid &amp;lt; 3000 and srcid == 1000) OR (dstid &amp;gt;= 3000 and srcid == 2000));
dump B;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is failing with &lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;2017-09-07 16:37:03,210 [main] ERROR org.apache.pig.tools.grunt.Grunt - ERROR 2243: Attempt to remove operator GreaterThanEqual that is still connected in the plan&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13100579">PIG-5299</key>
            <summary>PartitionFilterOptimizer failing at compile time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Sep 2017 21:00:19 +0000</created>
                <updated>Tue, 19 Sep 2017 18:30:09 +0000</updated>
                            <resolved>Tue, 19 Sep 2017 18:30:09 +0000</resolved>
                                                    <fixVersion>0.17.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16157650" author="knoguchi" created="Thu, 7 Sep 2017 21:02:57 +0000"  >&lt;p&gt;Log file showing the trace.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Pig Stack Trace
---------------
ERROR 2243: Attempt to remove operator GreaterThanEqual that is still connected in the plan

org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1066: Unable to open iterator for alias B
        at org.apache.pig.PigServer.openIterator(PigServer.java:1020)
        at org.apache.pig.tools.grunt.GruntParser.processDump(GruntParser.java:782)
        at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:383)
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:230)
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:205)
        at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:81)
        at org.apache.pig.Main.run(Main.java:630)
        at org.apache.pig.Main.main(Main.java:175)
Caused by: org.apache.pig.PigException: ERROR 1002: Unable to store alias B
        at org.apache.pig.PigServer.storeEx(PigServer.java:1123)
        at org.apache.pig.PigServer.store(PigServer.java:1082)
        at org.apache.pig.PigServer.openIterator(PigServer.java:995)
        ... 7 more
Caused by: org.apache.pig.impl.logicalLayer.FrontendException: ERROR 2000: Error processing rule PartitionFilterOptimizer. Try -t PartitionFilterOptimizer
        at org.apache.pig.newplan.optimizer.PlanOptimizer.optimize(PlanOptimizer.java:125)
        at org.apache.pig.newplan.logical.relational.LogicalPlan.optimize(LogicalPlan.java:281)
        at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:1458)
        at org.apache.pig.PigServer.storeEx(PigServer.java:1119)
        ... 9 more
Caused by: org.apache.pig.impl.logicalLayer.FrontendException: ERROR 2243: Attempt to remove operator GreaterThanEqual that is still connected in the plan
        at org.apache.pig.newplan.BaseOperatorPlan.remove(BaseOperatorPlan.java:172)
        at org.apache.pig.newplan.FilterExtractor.removeFromFilteredPlan(FilterExtractor.java:340)
        at org.apache.pig.newplan.FilterExtractor.removeFromFilteredPlan(FilterExtractor.java:337)
        at org.apache.pig.newplan.FilterExtractor.removeFromFilteredPlan(FilterExtractor.java:337)
        at org.apache.pig.newplan.FilterExtractor.checkPushDown(FilterExtractor.java:255)
        at org.apache.pig.newplan.FilterExtractor.visit(FilterExtractor.java:106)
        at org.apache.pig.newplan.logical.rules.PartitionFilterOptimizer$PartitionFilterPushDownTransformer.transform(PartitionFilterOptimizer.java:155)
        at org.apache.pig.newplan.optimizer.PlanOptimizer.optimize(PlanOptimizer.java:110)
        ... 12 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Basically when PartitionFilterOptimizer gives up on pushing down certain filter condition, updating the filteredPlan is failing.&lt;/p&gt;</comment>
                            <comment id="16157678" author="knoguchi" created="Thu, 7 Sep 2017 21:30:30 +0000"  >&lt;p&gt;Pasting filter plan with hashcode (to check the uniqueness)&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;|---(Name: Constant Type: null Uid: null):1947185929
(Name: And Type: null Uid: null):1774720883
|
|---(Name: Or Type: null Uid: null):1605851606
|   |
|   |---(Name: Equal Type: null Uid: null):1534754611
|   |   |
|   |   |---(Name: Project Type: null Uid: null Input: 0 Column: 0):944140566
|   |   |
|   |   |---(Name: Constant Type: null Uid: null):1551446957
|   |
|   |---(Name: GreaterThanEqual Type: null Uid: null):1020154737
|       |
|       |---(Name: Project Type: null Uid: null Input: 0 Column: 2):987249254
|       |
|       |---(Name: Constant Type: null Uid: null):1850954068
|
|---(Name: And Type: null Uid: null):1440621772
    |
    |---(Name: Or Type: null Uid: null):352083716
    |   |
    |   |---(Name: LessThan Type: null Uid: null):713312506
    |   |   |
    |   |   |---(Name: Project Type: null Uid: null Input: 0 Column: 2):597307515
    |   |   |
    |   |   |---(Name: Constant Type: null Uid: null):770010802
    |   |
    |   |---(Name: Equal Type: null Uid: null):223693919
    |       |
    |       |---(Name: Project Type: null Uid: null Input: 0 Column: 0):1758056825
    |       |
    |       |---(Name: Constant Type: null Uid: null):361268035
    |
    |---(Name: Or Type: null Uid: null):1787189503
        |
        |---(Name: LessThan Type: null Uid: null):713312506
        |   |
        |   |---(Name: Project Type: null Uid: null Input: 0 Column: 2):597307515
        |   |
        |   |---(Name: Constant Type: null Uid: null):770010802
        |
        |---(Name: GreaterThanEqual Type: null Uid: null):1020154737
            |
            |---(Name: Project Type: null Uid: null Input: 0 Column: 2):987249254
            |
            |---(Name: Constant Type: null Uid: null):1850954068
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This &lt;tt&gt;|---(Name: GreaterThanEqual Type: null Uid: null):1020154737&lt;/tt&gt; is used twice in the plan.&lt;br/&gt;
One from&lt;br/&gt;
&lt;tt&gt;|---(Name: Or Type: null Uid: null):1605851606&lt;/tt&gt; &lt;br/&gt;
and another from&lt;br/&gt;
&lt;tt&gt;|---(Name: Or Type: null Uid: null):1787189503&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Error message &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Attempt to remove operator GreaterThanEqual that is still connected in the plan&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;is coming when FilterExtractor tries to remove GreaterThanEqual from the first OR:1605851606 but failing when GreaterThanEqual is still connected to OR:1787189503.&lt;/p&gt;</comment>
                            <comment id="16157747" author="knoguchi" created="Thu, 7 Sep 2017 22:07:03 +0000"  >&lt;p&gt;Two ways of handling this.&lt;br/&gt;
(1) Deepcopy the expressions everywhere so that same expression is not used in multiple locations.&lt;br/&gt;
Or&lt;br/&gt;
(2) Delay the removal for expression that is used elsewhere. &lt;/p&gt;

&lt;p&gt;I&apos;ll try getting a patch with (2) and see how it looks.&lt;/p&gt;</comment>
                            <comment id="16158717" author="knoguchi" created="Fri, 8 Sep 2017 14:39:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;(2) Delay the removal for expression that is used elsewhere.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Attaching a patch and running a full test now.&lt;/p&gt;</comment>
                            <comment id="16167986" author="knoguchi" created="Fri, 15 Sep 2017 15:08:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;Attaching a patch and running a full test now.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Tests look good.  Making it patch-available. &lt;/p&gt;</comment>
                            <comment id="16172110" author="rohini" created="Tue, 19 Sep 2017 18:10:11 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16172135" author="knoguchi" created="Tue, 19 Sep 2017 18:30:09 +0000"  >&lt;p&gt;Thanks for the review Rohini! &lt;/p&gt;

&lt;p&gt;Committed to branch 0.17 and trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12886091" name="pig-5299-delayremoval-v1.patch" size="1875" author="knoguchi" created="Fri, 8 Sep 2017 14:38:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3js7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>