<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4734] TOMAP schema inferring breaks some scripts in type checking for bincond</title>
                <link>https://issues.apache.org/jira/browse/PIG-4734</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4674&quot; title=&quot;TOMAP should infer schema&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4674&quot;&gt;&lt;del&gt;PIG-4674&lt;/del&gt;&lt;/a&gt; added schema inferring for TOMAP.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;FOREACH A GENERATE (val == &lt;span class=&quot;code-quote&quot;&gt;&apos;x&apos;&lt;/span&gt; ? TOMAP(&lt;span class=&quot;code-quote&quot;&gt;&apos;key&apos;&lt;/span&gt;, floatfield1) : (val == &lt;span class=&quot;code-quote&quot;&gt;&apos;y&apos;&lt;/span&gt; ? GenerateFloatMap(&lt;span class=&quot;code-quote&quot;&gt;&apos;key&apos;&lt;/span&gt;, floatfield2) : NULL)) as floatmap:map[&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;],
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The following line fails with&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Two inputs of BinCond must have compatible schemas. left hand side: #675:map(#676:&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;) right hand side: #801:map
	at org.apache.pig.newplan.logical.visitor.TypeCheckingExpVisitor.visit(TypeCheckingExpVisitor.java:616)
	... 45 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;GenerateFloatMap is a UDF that returns new HashMap&amp;lt;String, Float&amp;gt;(), but does not have outputSchema() defined. It worked earlier because TOMAP also did not have outputSchema() defined.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12912950">PIG-4734</key>
            <summary>TOMAP schema inferring breaks some scripts in type checking for bincond</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="rohini">Rohini Palaniswamy</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Nov 2015 20:05:12 +0000</created>
                <updated>Wed, 8 Jun 2016 20:48:20 +0000</updated>
                            <resolved>Tue, 31 May 2016 19:49:31 +0000</resolved>
                                                    <fixVersion>0.16.0</fixVersion>
                    <fixVersion>0.17.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15004722" author="rohini" created="Fri, 13 Nov 2015 21:09:13 +0000"  >&lt;p&gt;Doesn&apos;t it relax the type checking too much?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; LogicalFieldSchema merge(LogicalFieldSchema fs1, LogicalFieldSchema fs2, MergeMode mode) {
.....
            /&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                &lt;span class=&quot;code-comment&quot;&gt;// Union schema
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fs1.type==DataType.BYTEARRAY) {
                    mergedType=fs2.type;
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fs2.type==DataType.BYTEARRAY) {
                    mergedType = fs1.type;
                }
                &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                    &lt;span class=&quot;code-comment&quot;&gt;// Take the more specific type
&lt;/span&gt;                    mergedType = DataType.mergeType(fs1.type, fs2.type);
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (mergedType == DataType.ERROR) {
                        &lt;span class=&quot;code-comment&quot;&gt;// True incompatible, set to bytearray
&lt;/span&gt;                        mergedType = DataType.BYTEARRAY;
                    }
                }
            }
....
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15004751" author="rohini" created="Fri, 13 Nov 2015 21:35:42 +0000"  >&lt;p&gt;Any udf not implementing outputSchema() method is good for reproducing. But the UDF that hit the issue had another slight property in addition to not implementing outputSchema() method.  It does GenerateMap extends EvalFunc&amp;lt;Map&amp;lt;String, String&amp;gt;&amp;gt; making returnType of EvalFunc to be Map&amp;lt;String, String&amp;gt;, but can also return Map&amp;lt;String, Float&amp;gt;.  It would be good to have that in the testcase as well as EvalFunc.getReturnType() is used when outputSchema() returns null.&lt;/p&gt;

&lt;p&gt;DEFINE GenerateMapFloat GenerateMap(&apos;FLOAT&apos;, &apos;xyz&apos;);&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.ArrayList;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Arrays;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.HashMap;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Map;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pig.EvalFunc;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pig.data.Tuple;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;GenerateMap &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; EvalFunc&amp;lt;Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;&amp;gt;{
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; ArrayList&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; map_keys = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; mapType = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; GenerateMap(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;... args ) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-comment&quot;&gt;// TODO Auto-generated constructor stub
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; args.length; i++)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (args[i] == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || args[i].length() &amp;lt;= 0)
            {
                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(i);
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot have &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; or empty string map key&quot;&lt;/span&gt;);
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(i &amp;gt; 0) {
                map_keys.add(args[i]);
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                map_keys = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
                mapType = args[i];
            }
        }
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Map exec(Tuple input) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (input.size() != map_keys.size())
        {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;tuple size of: &quot;&lt;/span&gt; + input.size() + &lt;span class=&quot;code-quote&quot;&gt;&quot; must match number of arguments: &quot;&lt;/span&gt; + map_keys.size() + &lt;span class=&quot;code-quote&quot;&gt;&quot; in constructor&quot;&lt;/span&gt;);
        }
        Map pig_map;
        
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(mapType.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;STRING&quot;&lt;/span&gt;)) {
            pig_map = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
        }
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;  {
            pig_map = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;&amp;gt;();
        }
        
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; input.size(); i++)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (input.get(i) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            {
                &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value = input.get(i).toString();
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value.length() != 0)
                {
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(mapType.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;STRING&quot;&lt;/span&gt;)) {
                        pig_map.put(map_keys.get(i), value);
                    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                        pig_map.put(map_keys.get(i), &lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;.parseFloat(value));
                    }
                
                }
            }
            
        }
        
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; pig_map;
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="15305543" author="daijy" created="Sat, 28 May 2016 18:52:16 +0000"  >&lt;p&gt;Use a restrictive way to do the check. GenerateMapFloat is no special in terms of type checking. I manually verified it works. I tend not to include it in the case since most of the code there is not related to the case. Is that Ok&amp;gt;&lt;/p&gt;</comment>
                            <comment id="15306095" author="rohini" created="Sun, 29 May 2016 22:28:24 +0000"  >&lt;p&gt;Should we relax the type checking for all types? Can we just do it for map? I am not sure what errors relaxing for everything might introduce.&lt;/p&gt;</comment>
                            <comment id="15307281" author="daijy" created="Tue, 31 May 2016 06:31:30 +0000"  >&lt;p&gt;The issue is not limited to map. Tuple/bag has similar issue. Attach a patch to include other test cases.&lt;/p&gt;</comment>
                            <comment id="15308156" author="rohini" created="Tue, 31 May 2016 17:18:09 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15308466" author="daijy" created="Tue, 31 May 2016 19:49:31 +0000"  >&lt;p&gt;Patch committed to both trunk and 0.16 branch. Thanks Rohini for review!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12863300">PIG-4674</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12772289" name="PIG-4734-1.patch" size="1916" author="daijy" created="Fri, 13 Nov 2015 20:54:44 +0000"/>
                            <attachment id="12806824" name="PIG-4734-2.patch" size="3930" author="daijy" created="Sat, 28 May 2016 18:52:16 +0000"/>
                            <attachment id="12807050" name="PIG-4734-3.patch" size="6464" author="daijy" created="Tue, 31 May 2016 06:31:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 25 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2odpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>