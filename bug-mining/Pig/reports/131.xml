<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:49:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-517] Custom Loader Function which takes in a constructor argument fails during typecast</title>
                <link>https://issues.apache.org/jira/browse/PIG-517</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;I have a custom loader function,  known as RegexLoader that parses a line of input into fields using regex and then sets the fields. This RegexLoader extends Utf8StorageConverter and implements the LoadFunc. It takes in a constructor argument a regex string supplied by the user.&lt;br/&gt;
The following piece of code, works when the loaded fields are not typecasted.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;REGISTER pigudf2.0/java/build/loader.jar
fullfile = load &lt;span class=&quot;code-quote&quot;&gt;&apos;phonenumber.txt&apos;&lt;/span&gt;
               using loader.RegexLoader(&lt;span class=&quot;code-quote&quot;&gt;&apos;4*8&apos;&lt;/span&gt;)
               as   (a,z,n) ;
-- project required fields
phonerecords = foreach fullfile {
          generate
           a                as area,
           z               as zone,
           n               as number;
        }
dump phonerecords;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But when the alias a is cast to int, the piece of script fails with the error java.io.IOException: Unable to open iterator for alias: phonerecords [Unable to store for alias: phonerecords &lt;span class=&quot;error&quot;&gt;&amp;#91;could not instantiate &amp;#39;loader.RegexLoader&amp;#39; with arguments &amp;#39;null&amp;#39;&amp;#93;&lt;/span&gt;]&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;REGISTER pigudf2.0/java/build/loader.jar
fullfile = load &lt;span class=&quot;code-quote&quot;&gt;&apos;phonenumber.txt&apos;&lt;/span&gt;
             using loader.RegexLoader(&lt;span class=&quot;code-quote&quot;&gt;&apos;4*8&apos;&lt;/span&gt;)
        as   (a,z,n) ;
-- project required fields
phonerecords = foreach fullfile {
          generate
           (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)a          as area,
           z               as zone,
           n               as number;
        }
dump phonerecords;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Full stack trace of the error:&lt;br/&gt;
==================================================================================================================&lt;br/&gt;
java.io.IOException: Unable to open iterator for alias: phonerecords [Unable to store for alias: phonerecords &lt;span class=&quot;error&quot;&gt;&amp;#91;could not instantiate &amp;#39;loader.RegexLoader&amp;#39; with arguments &amp;#39;null&amp;#39;&amp;#93;&lt;/span&gt;]&lt;br/&gt;
     at org.apache.pig.impl.PigContext.instantiateFuncFromSpec(PigContext.java:448)&lt;br/&gt;
     at org.apache.pig.impl.PigContext.instantiateFuncFromSpec(PigContext.java:454)&lt;br/&gt;
     at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POCast.instantiateFunc(POCast.java:67)&lt;br/&gt;
     at org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POCast.setLoadFSpec(POCast.java:73)&lt;br/&gt;
     at org.apache.pig.backend.hadoop.executionengine.physicalLayer.LogToPhyTranslationVisitor.visit(LogToPhyTranslationVisitor.java:1157)&lt;br/&gt;
     at org.apache.pig.impl.logicalLayer.LOCast.visit(LOCast.java:60)&lt;br/&gt;
     at org.apache.pig.impl.logicalLayer.LOCast.visit(LOCast.java:28)&lt;br/&gt;
     at org.apache.pig.impl.plan.DependencyOrderWalkerWOSeenChk.walk(DependencyOrderWalkerWOSeenChk.java:68)&lt;br/&gt;
     at org.apache.pig.backend.hadoop.executionengine.physicalLayer.LogToPhyTranslationVisitor.visit(LogToPhyTranslationVisitor.java:805)&lt;br/&gt;
     at org.apache.pig.impl.logicalLayer.LOForEach.visit(LOForEach.java:121)&lt;br/&gt;
     at org.apache.pig.impl.logicalLayer.LOForEach.visit(LOForEach.java:40)&lt;br/&gt;
     at org.apache.pig.impl.plan.DependencyOrderWalker.walk(DependencyOrderWalker.java:68)&lt;br/&gt;
     at org.apache.pig.impl.plan.PlanVisitor.visit(PlanVisitor.java:51)&lt;br/&gt;
     at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.compile(HExecutionEngine.java:232)&lt;br/&gt;
     at org.apache.pig.PigServer.compilePp(PigServer.java:731)&lt;br/&gt;
     at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:644)&lt;br/&gt;
     at org.apache.pig.PigServer.store(PigServer.java:452)&lt;br/&gt;
     at org.apache.pig.PigServer.store(PigServer.java:421)&lt;br/&gt;
     at org.apache.pig.PigServer.openIterator(PigServer.java:384)&lt;br/&gt;
     at org.apache.pig.tools.grunt.GruntParser.processDump(GruntParser.java:269)&lt;br/&gt;
     at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:178)&lt;br/&gt;
     at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:84)&lt;br/&gt;
     at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:64)&lt;br/&gt;
     at org.apache.pig.Main.main(Main.java:306)&lt;br/&gt;
Caused by: java.io.IOException: Unable to store for alias: phonerecords &lt;span class=&quot;error&quot;&gt;&amp;#91;could not instantiate &amp;#39;loader.RegexLoader&amp;#39; with arguments &amp;#39;null&amp;#39;&amp;#93;&lt;/span&gt;&lt;br/&gt;
     ... 24 more&lt;br/&gt;
Caused by: java.lang.RuntimeException: could not instantiate &apos;loader.RegexLoader&apos; with arguments &apos;null&apos;&lt;br/&gt;
     ... 24 more&lt;br/&gt;
Caused by: java.lang.InstantiationException: loader.RegexLoader&lt;br/&gt;
     at java.lang.Class.newInstance0(Class.java:340)&lt;br/&gt;
     at java.lang.Class.newInstance(Class.java:308)&lt;br/&gt;
     at org.apache.pig.impl.PigContext.instantiateFuncFromSpec(PigContext.java:418)&lt;br/&gt;
     ... 23 more&lt;br/&gt;
==================================================================================================================&lt;br/&gt;
Attaching the custom RegexLoader with this Jira&lt;/p&gt;</description>
                <environment></environment>
        <key id="12407807">PIG-517</key>
            <summary>Custom Loader Function which takes in a constructor argument fails during typecast</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pkamath">Pradeep Kamath</assignee>
                                    <reporter username="viraj">Viraj Bhat</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Nov 2008 19:26:43 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:13 +0000</updated>
                            <resolved>Mon, 10 Nov 2008 20:28:36 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12645051" author="viraj" created="Tue, 4 Nov 2008 19:28:16 +0000"  >&lt;p&gt;Custom loader function: RegexLoader&lt;/p&gt;</comment>
                            <comment id="12645052" author="viraj" created="Tue, 4 Nov 2008 19:29:33 +0000"  >&lt;p&gt;Sample dataset&lt;/p&gt;</comment>
                            <comment id="12645113" author="pkamath" created="Tue, 4 Nov 2008 23:54:28 +0000"  >&lt;p&gt;Attached patch - details on the issue:&lt;br/&gt;
In case of a &quot;cast&quot; from bytearray to any other type, TypeCheckingVisitor tries to match the cast to the corresponding load function for the source of the data so that the load function can do the cast correctly ( since there is no generic way to convert from bytearray to other types - only the load function which is the source of the bytearray knows how to interpret the bytes present in the bytearray). The TypeCheckingVisitor in the current code is setting a &quot;LoadFunc&quot; reference in LOCast for this purpose. The LoadFunc reference does not have information of the arguments needed to create the Loader object at runtime. This manifests as a problem in the LogToPhyTranslator when it tries to create a POCast from the LOCast. &lt;/p&gt;

&lt;p&gt;The patch now uses FuncSpec to represent the loader function rather than a LoadFunc reference. The FuncSpec has both the classname and the arguments to the constructor of the loader.&lt;/p&gt;</comment>
                            <comment id="12645637" author="ckunz" created="Fri, 7 Nov 2008 00:39:17 +0000"  >&lt;p&gt;+1 on the patch.&lt;br/&gt;
Works now for me.&lt;/p&gt;

&lt;p&gt;It should be noted, that before the patch load functions with a default constructor, but invoked with non-default argument, did not throw an exception but got called with the default constructor in LogToPhyTranslationVisitor, potentially resulting in unexpected results&lt;/p&gt;</comment>
                            <comment id="12646353" author="olgan" created="Mon, 10 Nov 2008 20:28:36 +0000"  >&lt;p&gt;patch committed; thanks, pradeep&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12393341" name="PIG-517.patch" size="62400" author="pkamath" created="Tue, 4 Nov 2008 23:54:49 +0000"/>
                            <attachment id="12393323" name="RegexLoader.java" size="4448" author="viraj" created="Tue, 4 Nov 2008 19:28:16 +0000"/>
                            <attachment id="12393324" name="phonenumber.txt" size="92" author="viraj" created="Tue, 4 Nov 2008 19:29:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164120</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gl6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94862</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>