<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:49:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-430] Projections in nested filter and inside foreach do not work</title>
                <link>https://issues.apache.org/jira/browse/PIG-430</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The following queries do not work:&lt;/p&gt;

&lt;p&gt;Nested filter:&lt;/p&gt;

&lt;p&gt;a = load &apos;studenttab10k&apos; as (name, age, gpa);&lt;br/&gt;
b = filter a by age &amp;lt; 20;&lt;br/&gt;
c = group b by age;&lt;br/&gt;
d = foreach c &lt;/p&gt;
{ cf = filter b by gpa &amp;lt; 3.0; cp = cf.gpa; cd = distinct cp; co = order cd by $0; generate group, flatten(co); }
&lt;p&gt;store d into &apos;output&apos;;&lt;/p&gt;

&lt;p&gt;Nested Distinct:&lt;/p&gt;

&lt;p&gt;a = load &apos;/user/pig/tests/data/singlefile/studenttab10k&apos; as (name, age, gpa);&lt;br/&gt;
b = group a by name;&lt;br/&gt;
c = foreach b &lt;/p&gt;
{ aa = distinct a.age; generate group, COUNT(aa); }
&lt;p&gt;store c into &apos;output&apos;;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12404283">PIG-430</key>
            <summary>Projections in nested filter and inside foreach do not work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sms">Santhosh Muthur Srinivasan</assignee>
                                    <reporter username="sms">Santhosh Muthur Srinivasan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Sep 2008 23:08:35 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:09 +0000</updated>
                            <resolved>Mon, 22 Sep 2008 20:20:09 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12631924" author="shravanmn" created="Wed, 17 Sep 2008 20:25:05 +0000"  >&lt;p&gt;I have fixed part of the problem that addresses the project issue. The issue mentioned in distinct still remains. The problem here is that we see that projects are being introduced into the input of distinct which creates a unique case where the projection chaining will not work. The problem is similar to the one where you can assign a nested project to a variable inside a nested block. This has been solved by replacing the nested project with a foreach statement. The solution to the distinct problem should be something similar where the input to the distinct can also be a nested project. I made a local change by replacing BaseEvalSpec by NestedProject in my code for this and it works. However, I don&apos;t want to mess up something because I am not completely aware of the side-effects of changing this in the parser. Its better if someone more comfortable with the parser took a look at this one.&lt;/p&gt;

&lt;p&gt;Also, I think there are some issues with the parsing of nested things. I tried the following and the parser just doesn&apos;t terminate the nested block waiting and keeps waiting for more input:&lt;/p&gt;

&lt;p&gt;A = load &apos;file&apos;;&lt;br/&gt;
B = group A by $0;&lt;br/&gt;
C = foreach B &lt;/p&gt;
{ C1=distinct &quot;const&quot;; generate C1;}
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;I was clueless as  to why this is happening but I tried this because I thought that the input to a nested distinct shouldn&apos;t be BaseEvalSpec which can FuncEvalSpecs and Constants. I think we need to change things a bit here.&lt;/p&gt;</comment>
                            <comment id="12631933" author="sms" created="Wed, 17 Sep 2008 20:34:52 +0000"  >&lt;p&gt;Replace the double quotes with the single quotes and it should work.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;A = load &lt;span class=&quot;code-quote&quot;&gt;&apos;file&apos;&lt;/span&gt;;
B = group A by $0;
C = foreach B { C1=distinct &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt;&apos;&lt;/span&gt;; generate C1;};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12632370" author="shravanmn" created="Thu, 18 Sep 2008 20:14:57 +0000"  >&lt;p&gt;Hmm, I have hit a bug accidentally! Shouldn&apos;t it have terminated the nested block instead of waiting for more input when there is nothing to?&lt;/p&gt;</comment>
                            <comment id="12633024" author="sms" created="Sun, 21 Sep 2008 00:03:44 +0000"  >&lt;p&gt;New patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-430&quot; title=&quot;Projections in nested filter and inside foreach do not work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-430&quot;&gt;&lt;del&gt;PIG-430&lt;/del&gt;&lt;/a&gt;_2.patch), includes the rewrite of nested projects as foreach generates for the nested sort, nested distinct and nested filter inputs. Shravan&apos;s patch is included as part of this patch. His patch for fixing the BracketedProject projection was fine. Thanks Shravan!&lt;/p&gt;

&lt;p&gt;Unit tests that still fail are:&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestEvalPipeline&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 8, Failures: 1, Errors: 0, Time elapsed: 175.711 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestEvalPipeline FAILED&lt;/p&gt;</comment>
                            <comment id="12633472" author="olgan" created="Mon, 22 Sep 2008 20:20:09 +0000"  >&lt;p&gt;patch committed. thanks santhosh&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12390300" name="430-1.patch" size="2808" author="shravanmn" created="Wed, 17 Sep 2008 20:25:28 +0000"/>
                            <attachment id="12390584" name="PIG-430_2.patch" size="6808" author="sms" created="Sun, 21 Sep 2008 00:03:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38494</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 10 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gk4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94692</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>