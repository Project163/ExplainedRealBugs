<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:03:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-5373] InterRecordReader might skip records if certain sync markers are used</title>
                <link>https://issues.apache.org/jira/browse/PIG-5373</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Due to bug in InterRecordReader#skipUntilMarkerOrSplitEndOrEOF(), it can happen that sync markers are not identified while reading the interim binary file used to hold data between jobs.&lt;/p&gt;

&lt;p&gt;In such files sync markers are placed upon writing, which later help during reading the data. These are random generated and it seems like that in some rare combinations of markers and data preceding it, they&#160;cannot be&#160;not found. This can result in reading through all the bytes (looking for the marker) and reaching split end or EOF, and&#160;extracting no records at all.&lt;/p&gt;

&lt;p&gt;This symptom is also&#160;observable from JobHistory stats, where if a job is affected by this issue, will have tasks that have&#160;HDFS_BYTES_READ or&#160;FILE_BYTES_READ about equal to the number bytes of the split, but at the same time having&#160;MAP_INPUT_RECORDS=0&lt;/p&gt;

&lt;p&gt;One such (test) example is this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
marker: [-128, -128, 4] , data: [127, -1, 2, -128, -128, -128, 4, 1, 2, 3]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Due to&#160;a bug, such markers&#160;whose prefix overlap with the last data chunk are not seen by the reader.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13205719">PIG-5373</key>
            <summary>InterRecordReader might skip records if certain sync markers are used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="szita">&#193;d&#225;m Szita</assignee>
                                    <reporter username="szita">&#193;d&#225;m Szita</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Dec 2018 13:16:02 +0000</created>
                <updated>Mon, 15 Sep 2025 11:29:01 +0000</updated>
                            <resolved>Thu, 3 Jan 2019 15:57:24 +0000</resolved>
                                                    <fixVersion>0.18.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16725831" author="szita" created="Thu, 20 Dec 2018 13:23:30 +0000"  >&lt;p&gt;Attached &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12952532/12952532_PIG-5373.0.patch&quot; title=&quot;PIG-5373.0.patch attached to PIG-5373&quot;&gt;PIG-5373.0.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; which corrects the reading of sync markers using a fifo, and&#160;compares&#160;the fifo content with the expected marker.&lt;/p&gt;

&lt;p&gt;Test case attached, which verifies in a brute force way, that such prefix scenarios are handled well.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkollar&quot; class=&quot;user-hover&quot; rel=&quot;nkollar&quot;&gt;nkollar&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt; can you take a look please?&lt;/p&gt;</comment>
                            <comment id="16726963" author="rohini" created="Fri, 21 Dec 2018 18:36:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szita&quot; class=&quot;user-hover&quot; rel=&quot;szita&quot;&gt;szita&lt;/a&gt;,&lt;br/&gt;
   This is broken by &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3655&quot; title=&quot;BinStorage and InterStorage approach to record markers is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3655&quot;&gt;&lt;del&gt;PIG-3655&lt;/del&gt;&lt;/a&gt; right? If so affected version should be  0.18.0 &lt;/p&gt;</comment>
                            <comment id="16728019" author="szita" created="Sun, 23 Dec 2018 17:53:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;, right, it is not even released yet, so I just leave it blank then&lt;/p&gt;</comment>
                            <comment id="16732007" author="nkollar" created="Wed, 2 Jan 2019 12:29:49 +0000"  >&lt;p&gt;I have one observation to the patch: to be future-proof, instead CircularFifoBuffer from commons-collection I think we should use CircularFifoQueue from commons-collections4. On one hand CircularFifoBuffer was removed from the latest commons collections code, on the other hand CircularFifoQueue is generic, so we can eliminated iterating through Object items and casting to integer. Be aware of one thing: the semantic of isFull has changed, CircularFifoQueue is never full. The isFull call should be replaced to &lt;tt&gt;queue.size() == queue.maxSize()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16732852" author="szita" created="Thu, 3 Jan 2019 10:16:38 +0000"  >&lt;p&gt;Thanks for taking a look &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkollar&quot; class=&quot;user-hover&quot; rel=&quot;nkollar&quot;&gt;nkollar&lt;/a&gt;, I&apos;ve uploaded a new patch that uses&#160;CircularFifoQueue from commons-collections4.&lt;/p&gt;</comment>
                            <comment id="16733121" author="nkollar" created="Thu, 3 Jan 2019 14:45:50 +0000"  >&lt;p&gt;+1 on &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-5373&quot; title=&quot;InterRecordReader might skip records if certain sync markers are used&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-5373&quot;&gt;&lt;del&gt;PIG-5373&lt;/del&gt;&lt;/a&gt;.1.patch&lt;/p&gt;</comment>
                            <comment id="16733171" author="szita" created="Thu, 3 Jan 2019 15:57:11 +0000"  >&lt;p&gt;Committed to trunk, thanks a lot for reviewing Nandor!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12687778">PIG-3655</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12952532" name="PIG-5373.0.patch" size="6484" author="szita" created="Thu, 20 Dec 2018 13:20:01 +0000"/>
                            <attachment id="12953633" name="PIG-5373.1.patch" size="6495" author="szita" created="Thu, 3 Jan 2019 13:32:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u006uw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>