<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:03:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-5387] Test failures on JRE 11</title>
                <link>https://issues.apache.org/jira/browse/PIG-5387</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;I tried to compile Pig with JDK 8 and execute the test with Java 11, and faced with several test failures. For example TestCommit#testCheckin2 failed with the following exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2019-05-08 16:06:09,712 WARN  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-108] mapred.LocalJobRunner (LocalJobRunner.java:run(590)) - job_local1000317333_0003
java.lang.Exception: java.io.IOException: Deserialization error: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.hadoop.mapred.LocalJobRunner$Job.runTasks(LocalJobRunner.java:492)
	at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:552)
Caused by: java.io.IOException: Deserialization error: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.pig.impl.util.ObjectSerializer.deserialize(ObjectSerializer.java:62)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.setup(PigGenericMapBase.java:183)
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:143)
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:799)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:347)
	at org.apache.hadoop.mapred.LocalJobRunner$Job$MapTaskRunnable.run(LocalJobRunner.java:271)
	at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)
Caused by: java.lang.NullPointerException
	at org.apache.pig.impl.plan.Operator.hashCode(Operator.java:106)
	at java.base/java.util.HashMap.hash(HashMap.java:339)
	at java.base/java.util.HashMap.readObject(HashMap.java:1461)
	at java.base/jdk.internal.reflect.GeneratedMethodAccessor12.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at java.base/java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1160)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It deserialization of one of the map plan failed, it appears we ran into &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8201131&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JDK-8201131&lt;/a&gt;. I seems that the workaround in the issue report works, adding a readObject method to org.apache.pig.impl.plan.Operator:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void readObject(ObjectInputStream in) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ClassNotFoundException, IOException {
        in.defaultReadObject();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;solves the problem, however I&apos;m not sure that this is the optimal solution.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13232229">PIG-5387</key>
            <summary>Test failures on JRE 11</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkollar">N&#225;ndor Koll&#225;r</assignee>
                                    <reporter username="nkollar">N&#225;ndor Koll&#225;r</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 May 2019 14:11:30 +0000</created>
                <updated>Mon, 15 Sep 2025 11:29:03 +0000</updated>
                            <resolved>Tue, 21 May 2019 11:53:24 +0000</resolved>
                                    <version>0.17.0</version>
                                    <fixVersion>0.18.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16837576" author="knoguchi" created="Fri, 10 May 2019 20:16:11 +0000"  >&lt;p&gt;Confirmed there&apos;s no new test failures(regression) when tested with jdk8 + this patch. &lt;br/&gt;
But I don&apos;t know much about these class loader handling to +1. Asking  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szita&quot; class=&quot;user-hover&quot; rel=&quot;szita&quot;&gt;szita&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16837645" author="rohini" created="Fri, 10 May 2019 22:00:16 +0000"  >&lt;p&gt;If registerNewResource is same code, can it be moved to test Utils class. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;But I don&apos;t know much about these class loader handling&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;  Not familiar with what changed in jdk 11 regarding classloading either. Nandor can you explain what is the reason behind those changes and leave few lines of comments in the code itself. Does the behavior change cause any issues with register command in pig adding files to classloader ?&lt;/p&gt;</comment>
                            <comment id="16838353" author="nkollar" created="Mon, 13 May 2019 08:14:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knoguchi&quot; class=&quot;user-hover&quot; rel=&quot;knoguchi&quot;&gt;knoguchi&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt; the class loading related changes is an ugly hack which I&apos;m not proud of, but I didn&apos;t find any easy fix which is compatible with Java 11 as well as Java 8, and this one seems to work. Fortunately it is only a test problem, not a production code issue. Until Java 8 the system class loader (&lt;a href=&quot;https://github.com/openjdk/jdk/blob/jdk8-b120/jdk/src/share/classes/sun/misc/Launcher.java#L259&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;AppClassLoader&lt;/a&gt;) extends URLClassLoader, thus casting and registering the jar at runtime works fine. This has changes in Java 11 (I think since Java 9, but didn&apos;t verify this): system class loader no longer extends URLClassLoader (see &lt;a href=&quot;https://github.com/openjdk/jdk11u/blob/master/src/java.base/share/classes/jdk/internal/loader/ClassLoaders.java#L151&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;). I tried to create a new URLClassLoader and set the Thread&apos;s context class loader to it, but Pig uses &lt;a href=&quot;https://github.com/apache/pig/blob/trunk/src/org/apache/pig/PigServer.java#L575&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;getSystemResources&lt;/a&gt; to locate the jars, which will ask system classloader, for the locations, and won&apos;t find resources registered below it. That&apos;s why I came up with this hack: on Java 8 it will work as before, on Java 11, it will register the new URLClassLoader as the parent of system class loader, and will find the jars. I know that this is an ugly hack, I guess the correct answer to this problem would be Java 11 module loading, but to remain compatible with Java 8 we should either introduce several reflective invocations, or we should introduce something like Java 11 shim. I don&apos;t think either option pays off for a single test fix like this one. The only incompatibility in this case is the casting of system class loader to URLClassLoader, and since we don&apos;t do it in any other place apart from these two test classes, I don&apos;t think it causes any issue with registering commands in Pig. Refactoring registerNewResource to Utils class is a good idea, as well as adding a comment which briefly describes the aforementioned situation.&lt;/p&gt;</comment>
                            <comment id="16838374" author="nkollar" created="Mon, 13 May 2019 08:39:35 +0000"  >&lt;p&gt;Attached &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-5387&quot; title=&quot;Test failures on JRE 11&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-5387&quot;&gt;&lt;del&gt;PIG-5387&lt;/del&gt;&lt;/a&gt;_2.patch with a comment and removal of registerNewResource from TestPigServerLocal. It seemed to me that registering temp folder is unnecessary in this test case, it is required only in TestPigServer.&lt;/p&gt;</comment>
                            <comment id="16841368" author="szita" created="Thu, 16 May 2019 13:54:34 +0000"  >&lt;p&gt;So as far as I understand:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;in the testing part you are injecting an URLClassLoader if we&apos;re running java11. Quite hacky but not worse than the current implementation which uses reflection to invoke addURL on URLClassLoader;&lt;/li&gt;
	&lt;li&gt;in&#160;Operator&#160;class I think using readObject like this will be fine, but please add javadoc or comments to the readObject method that includes some reference to the JVM bug. We don&apos;t want ppl to remove it by mistake &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Having this in mind&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12968531/12968531_PIG-5387_2.patch&quot; title=&quot;PIG-5387_2.patch attached to PIG-5387&quot;&gt;PIG-5387_2.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; looks good to me.&lt;/p&gt;</comment>
                            <comment id="16843746" author="szita" created="Mon, 20 May 2019 07:51:39 +0000"  >&lt;p&gt;Thanks Nandor, +1 for &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12968916/12968916_PIG-5387_3.patch&quot; title=&quot;PIG-5387_3.patch attached to PIG-5387&quot;&gt;PIG-5387_3.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knoguchi&quot; class=&quot;user-hover&quot; rel=&quot;knoguchi&quot;&gt;knoguchi&lt;/a&gt; any objections?&lt;/p&gt;</comment>
                            <comment id="16844161" author="rohini" created="Mon, 20 May 2019 17:54:44 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16844757" author="nkollar" created="Tue, 21 May 2019 11:53:11 +0000"  >&lt;p&gt;Committed to trunk, thanks Rohini, Adam and Koji for the reviews!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12968379" name="PIG-5387_1.patch" size="5020" author="nkollar" created="Fri, 10 May 2019 11:36:34 +0000"/>
                            <attachment id="12968531" name="PIG-5387_2.patch" size="4789" author="nkollar" created="Mon, 13 May 2019 08:37:09 +0000"/>
                            <attachment id="12968916" name="PIG-5387_3.patch" size="4876" author="nkollar" created="Thu, 16 May 2019 14:10:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 26 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z02i2g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>