<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:48:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-310] Some nested order by queries fail in logical to physical translator</title>
                <link>https://issues.apache.org/jira/browse/PIG-310</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The query:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;myfile&apos;&lt;/span&gt;;                                                                                            
b = group a by $0;                                                                                                                                              
c = foreach b {c1 = order $1 by $1; generate flatten(c1); };                                                                                                    
store c into &lt;span class=&quot;code-quote&quot;&gt;&apos;outfile&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;dies with the error message:&lt;/p&gt;

&lt;p&gt;java.io.IOException: Unable to store for alias: c &lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt;&lt;br/&gt;
    at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.compile(HExecutionEngine.java:232)&lt;br/&gt;
    at org.apache.pig.PigServer.compilePp(PigServer.java:556)&lt;br/&gt;
    at org.apache.pig.PigServer.execute(PigServer.java:482)&lt;br/&gt;
    at org.apache.pig.PigServer.store(PigServer.java:324)&lt;br/&gt;
    at org.apache.pig.PigServer.store(PigServer.java:310)&lt;br/&gt;
    at org.apache.pig.tools.grunt.GruntParser.processStore(GruntParser.java:173)&lt;br/&gt;
    at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:317)&lt;br/&gt;
    at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:77)&lt;br/&gt;
    at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:58)&lt;br/&gt;
    at org.apache.pig.Main.main(Main.java:311)&lt;br/&gt;
Caused by: org.apache.pig.backend.executionengine.ExecException&lt;br/&gt;
    ... 10 more&lt;br/&gt;
Caused by: org.apache.pig.impl.plan.VisitorException&lt;br/&gt;
    at org.apache.pig.impl.logicalLayer.LogToPhyTranslationVisitor.visit(LogToPhyTranslationVisitor.java:726)&lt;br/&gt;
    at org.apache.pig.impl.logicalLayer.LOSort.visit(LOSort.java:141)&lt;br/&gt;
    at org.apache.pig.impl.logicalLayer.LOSort.visit(LOSort.java:35)&lt;br/&gt;
    at org.apache.pig.impl.plan.DependencyOrderWalkerWOSeenChk.walk(DependencyOrderWalkerWOSeenChk.java:68)&lt;br/&gt;
    at org.apache.pig.impl.logicalLayer.LogToPhyTranslationVisitor.visit(LogToPhyTranslationVisitor.java:651)&lt;br/&gt;
    at org.apache.pig.impl.logicalLayer.LOForEach.visit(LOForEach.java:87)&lt;br/&gt;
    at org.apache.pig.impl.logicalLayer.LOForEach.visit(LOForEach.java:36)&lt;br/&gt;
    at org.apache.pig.impl.plan.DependencyOrderWalker.walk(DependencyOrderWalker.java:68)&lt;br/&gt;
    at org.apache.pig.impl.plan.PlanVisitor.visit(PlanVisitor.java:51)&lt;br/&gt;
    at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.compile(HExecutionEngine.java:229)&lt;br/&gt;
    ... 9 more&lt;br/&gt;
Caused by: org.apache.pig.impl.plan.PlanException: Attempt to connect operator Project&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - gates-Sat Jul 12 17:57:09 PDT 2008-16 which is not in the pla&lt;br/&gt;
    at org.apache.pig.impl.plan.OperatorPlan.checkInPlan(OperatorPlan.java:254)&lt;br/&gt;
    at org.apache.pig.impl.plan.OperatorPlan.connect(OperatorPlan.java:140)&lt;br/&gt;
    at org.apache.pig.impl.physicalLayer.plans.PhysicalPlan.connect(PhysicalPlan.java:77)&lt;br/&gt;
    at org.apache.pig.impl.logicalLayer.LogToPhyTranslationVisitor.visit(LogToPhyTranslationVisitor.java:723)&lt;br/&gt;
    ... 18 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12400254">PIG-310</key>
            <summary>Some nested order by queries fail in logical to physical translator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sms">Santhosh Muthur Srinivasan</assignee>
                                    <reporter username="gates">Alan Gates</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Jul 2008 21:33:10 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:03 +0000</updated>
                            <resolved>Thu, 24 Jul 2008 12:24:13 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12614791" author="alangates" created="Fri, 18 Jul 2008 17:08:02 +0000"  >&lt;p&gt;It looks to me like the logical plan isn&apos;t being constructed quite correctly.  It appears that one project is being connected in two different places in the plan.&lt;/p&gt;

&lt;p&gt;Here is the logical plan for the above script:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Logical Plan:
ForEach gates-Fri Jul 18 09:28:13 PDT 2008-8 Schema: {bytearray} Type: bag
|   |
|   Project gates-Fri Jul 18 09:28:13 PDT 2008-6 Projections:  [*]  Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: CA: bag Type: bag
|   Input: SORT gates-Fri Jul 18 09:28:13 PDT 2008-5|
|   |---SORT gates-Fri Jul 18 09:28:13 PDT 2008-5 Schema: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; Type: bag
|       |   |
|       |   Project gates-Fri Jul 18 09:28:13 PDT 2008-4 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: bytearray Type: bytearray
|       |   Input: Project gates-Fri Jul 18 09:28:13 PDT 2008-3 Projections: [1] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;|
|       |   |---Project gates-Fri Jul 18 09:28:13 PDT 2008-3 Projections: [1] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; FieldSchema: A: tuple Type: tuple
|       |       Input: CoGroup gates-Fri Jul 18 09:28:13 PDT 2008-2
|       |
|       |---Project gates-Fri Jul 18 09:28:13 PDT 2008-3 Projections: [1] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; FieldSchema: A: tuple Type: tuple
|           Input: CoGroup gates-Fri Jul 18 09:28:13 PDT 2008-2
|
|---CoGroup gates-Fri Jul 18 09:28:13 PDT 2008-2 Schema: {group: bytearray,A: (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)} Type: bag
    |   |
    |   Project gates-Fri Jul 18 09:28:13 PDT 2008-1 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: bytearray Type: bytearray
    |   Input: Load gates-Fri Jul 18 09:28:13 PDT 2008-
    |
    |---Load gates-Fri Jul 18 09:28:13 PDT 2008-0 Schema: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; Type: bag
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice that the project named &quot;Project gates-Fri Jul 18 09:28:13 PDT 2008-3&quot; is connected both directly to the sort (that is, it&apos;s sorts input), and it is in the plan of sort.  This does not look correct.  And if you change the script from &quot;order by $1&quot; to &quot;order by *&quot;, then the two projects are different, and the script works.&lt;/p&gt;

&lt;p&gt;Assigning to Santhosh to take a look.  If this isn&apos;t an issue please assign it back to me.&lt;/p&gt;</comment>
                            <comment id="12616212" author="sms" created="Wed, 23 Jul 2008 18:34:49 +0000"  >&lt;p&gt;The issue has been fixed. The logical, type checked and physical plans for the query will now look like:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ForEach Test-Plan-Builder-8 Schema: {bytearray} Type: bag
|   |
|   Project Test-Plan-Builder-6 Projections:  [*]  Overloaded: false FieldSchema: c1: tuple Type: tuple
|   Input: SORT Test-Plan-Builder-5|
|   |---SORT Test-Plan-Builder-5 Schema: null Type: bag
|       |   |
|       |   Project Test-Plan-Builder-4 Projections: [1] Overloaded: false FieldSchema: bytearray Type: bytearray
|       |   Input: Project Test-Plan-Builder-3 Projections: [1] Overloaded: fals
|       |
|       |---Project Test-Plan-Builder-3 Projections: [1] Overloaded: false FieldSchema: a: bag Type: bag
|           Input: CoGroup Test-Plan-Builder-2
|
|---CoGroup Test-Plan-Builder-2 Schema: {group: bytearray,a: {null}} Type: Unknown
    |   |
    |   Project Test-Plan-Builder-1 Projections: [0] Overloaded: false FieldSchema: bytearray Type: bytearray
    |   Input: Load Test-Plan-Builder-
    |
    |---Load Test-Plan-Builder-0 Schema: null Type: bag
Printing the logical plan
ForEach Test-Plan-Builder-8 Schema: {bytearray} Type: bag
|   |
|   Project Test-Plan-Builder-6 Projections:  [*]  Overloaded: false FieldSchema: c1: bag Type: bag
|   Input: SORT Test-Plan-Builder-5|
|   |---SORT Test-Plan-Builder-5 Schema: null Type: bag
|       |   |
|       |   Project Test-Plan-Builder-4 Projections: [1] Overloaded: false FieldSchema: bytearray Type: bytearray
|       |   Input: Project Test-Plan-Builder-3 Projections: [1] Overloaded: tru
|       |
|       |---Project Test-Plan-Builder-3 Projections: [1] Overloaded: true FieldSchema: a: tuple Type: tuple
|           Input: CoGroup Test-Plan-Builder-2
|
|---CoGroup Test-Plan-Builder-2 Schema: {group: bytearray,a: (null)} Type: bag
    |   |
    |   Project Test-Plan-Builder-1 Projections: [0] Overloaded: false FieldSchema: bytearray Type: bytearray
    |   Input: Load Test-Plan-Builder-
    |
    |---Load Test-Plan-Builder-0 Schema: null Type: bag
Printing the physical  plan
New For Each(true)[bag] - Test-Plan-Builder-18
|   |
|   Project[bag][*] - Test-Plan-Builder-17
|   |
|   |---POSort[bag]() - Test-Plan-Builder-16
|       |   |
|       |   Project[bytearray][1] - Test-Plan-Builder-15
|       |
|       |---Project[tuple][1] - Test-Plan-Builder-14
|
|---Package[tuple]{bytearray} - Test-Plan-Builder-11
    |
    |---Global Rearrange[tuple] - Test-Plan-Builder-10
        |
        |---Local Rearrange[tuple]{bytearray} - Test-Plan-Builder-12
            |   |
            |   Project[bytearray][0] - Test-Plan-Builder-13
            |
            |---Load(myfile:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-9
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12616224" author="sms" created="Wed, 23 Jul 2008 19:04:18 +0000"  >&lt;p&gt;The patch fixes the following issue:&lt;/p&gt;

&lt;p&gt;1. In LOSort&apos;s nested plans, the projections will not be connected to their inputs. Earlier, due to the connection, the same operator was playing dual roles: &lt;br/&gt;
   i. Sort&apos;s input&lt;br/&gt;
   ii. The sort column&apos;s input&lt;/p&gt;

&lt;p&gt;Unit test cases that still fail are:&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestEvalPipeline&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 8, Failures: 0, Errors: 1, Time elapsed: 179.904 sec&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestEvalPipeline FAILED&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestFilterOpNumeric&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 8, Failures: 0, Errors: 1, Time elapsed: 56.124 sec&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestFilterOpNumeric FAILED&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestBuiltin&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 23, Failures: 1, Errors: 1, Time elapsed: 14.8 sec&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestBuiltin FAILED&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestStoreOld&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 3, Failures: 0, Errors: 2, Time elapsed: 21.453 sec&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestStoreOld FAILED&lt;/p&gt;</comment>
                            <comment id="12616459" author="pi_song" created="Thu, 24 Jul 2008 12:24:13 +0000"  >&lt;p&gt;Committed&lt;/p&gt;

&lt;p&gt;Thanks Santhosh.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12386749" name="sort_with_nested_project.patch" size="4128" author="sms" created="Wed, 23 Jul 2008 19:04:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38593</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ginj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94452</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>