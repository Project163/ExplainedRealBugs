<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:57:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-3469] Skewed join can cause unrecoverable NullPointerException when one of its inputs is missing.</title>
                <link>https://issues.apache.org/jira/browse/PIG-3469</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Run this script in the local execution environment (affects cluster mode too):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;%declare DATA_EXISTS /tmp/test_data_exists.tsv
%declare DATA_MISSING /tmp/test_data_missing.tsv
%declare DUMMY `bash -c &apos;(for (( i=0; \$i &amp;lt; 10; i++ )); do echo \$i; done) &amp;gt; /tmp/test_data_exists.tsv; true&apos;`

exists = LOAD &apos;$DATA_EXISTS&apos; AS (a:long);
missing = LOAD &apos;$DATA_MISSING&apos; AS (a:long);

missing = FOREACH ( GROUP missing BY a ) GENERATE $0 AS a, COUNT_STAR($1);

joined = JOIN exists BY a, missing BY a USING &apos;skewed&apos;;

STORE joined INTO &apos;/tmp/test_out.tsv&apos;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Results in NullPointerException which halts entire pig execution, including unrelated jobs. Expected: only dependencies of the error&apos;d LOAD statement should fail. &lt;/p&gt;

&lt;p&gt;Error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-09-18 11:42:31,518 [main] ERROR org.apache.pig.tools.grunt.Grunt - ERROR 2017: Internal error creating job configuration.
2013-09-18 11:42:31,518 [main] ERROR org.apache.pig.tools.grunt.Grunt - org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobCreationException: ERROR 2017: Internal error creating job configuration.
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.getJob(JobControlCompiler.java:848)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.compile(JobControlCompiler.java:294)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.launchPig(MapReduceLauncher.java:177)
	at org.apache.pig.PigServer.launchPlan(PigServer.java:1266)
	at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:1251)
	at org.apache.pig.PigServer.execute(PigServer.java:1241)
	at org.apache.pig.PigServer.executeBatch(PigServer.java:335)
	at org.apache.pig.tools.grunt.GruntParser.executeBatch(GruntParser.java:137)
	at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:198)
	at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:170)
	at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:84)
	at org.apache.pig.Main.run(Main.java:604)
	at org.apache.pig.Main.main(Main.java:157)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.hadoop.util.RunJar.main(RunJar.java:208)
Caused by: java.lang.NullPointerException
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.adjustNumReducers(JobControlCompiler.java:868)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.getJob(JobControlCompiler.java:480)
	... 17 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Script above is as small as I can make it while still reproducing the issue. Removing the group-foreach causes the join to fail harmlessly (not stopping pig execution), as does using the default join. Did not occur on 0.10.1.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Apache Pig version 0.11.0-cdh4.4.0&lt;br/&gt;
Happens in both local execution environment (os x) and cluster environment (linux)&lt;/p&gt;</environment>
        <key id="12669315">PIG-3469</key>
            <summary>Skewed join can cause unrecoverable NullPointerException when one of its inputs is missing.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jarcec">Jarek Jarcec Cecho</assignee>
                                    <reporter username="xton">Christon DeWan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Sep 2013 19:26:17 +0000</created>
                <updated>Mon, 7 Jul 2014 18:07:51 +0000</updated>
                            <resolved>Thu, 3 Oct 2013 21:35:44 +0000</resolved>
                                    <version>0.11</version>
                                    <fixVersion>0.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13771182" author="xton" created="Wed, 18 Sep 2013 20:13:15 +0000"  >&lt;p&gt;...and still occurs with Pig 0.11.1 downloaded just now.&lt;/p&gt;</comment>
                            <comment id="13778225" author="jarcec" created="Wed, 25 Sep 2013 23:28:33 +0000"  >&lt;p&gt;I believe that I do have understanding of this issue, will upload patch after running all tests.&lt;/p&gt;</comment>
                            <comment id="13778851" author="jarcec" created="Thu, 26 Sep 2013 15:02:09 +0000"  >&lt;p&gt;The NPE is thrown in &lt;tt&gt;JobControlCompiler.adjustNumReducers&lt;/tt&gt; when getting successor nodes from plan. This method is called from &lt;tt&gt;JobControlCompiler.getJob()&lt;/tt&gt; that is called from &lt;tt&gt;MapReduceLauncher.launchPig()&lt;/tt&gt; through &lt;tt&gt;JobControlCompiler.compile()&lt;/tt&gt;. There is a while loop in &lt;tt&gt;MapReduceLauncher.launchPig()&lt;/tt&gt;, that is calling the &lt;tt&gt;compile()&lt;/tt&gt; on every iteration. The loop itself is however changing the plan, by for example removing failed failed jobs with all their dependencies. As a result the call &lt;tt&gt;getSuccessors()&lt;/tt&gt; can return &lt;tt&gt;NULL&lt;/tt&gt; in case of a job failure as the nodes has been removed from the plan.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching patch that will verify that the &lt;tt&gt;getSuccessors()&lt;/tt&gt; is indeed not &lt;tt&gt;NULL&lt;/tt&gt; prior using it. I&apos;ve run all the tests and they seem to be passing.&lt;/p&gt;</comment>
                            <comment id="13778857" author="jarcec" created="Thu, 26 Sep 2013 15:04:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;, the patch is quite simple, so I&apos;m wondering if there is any chance to get it into 0.12?&lt;/p&gt;</comment>
                            <comment id="13783229" author="jarcec" created="Tue, 1 Oct 2013 19:05:05 +0000"  >&lt;p&gt;Attached patch with test case to ensure that PigServer won&apos;t die on the incorrect input.&lt;/p&gt;</comment>
                            <comment id="13784580" author="xuefuz" created="Wed, 2 Oct 2013 22:43:21 +0000"  >&lt;p&gt;+1 Patch looks good. Will commit after running tests.&lt;/p&gt;</comment>
                            <comment id="13785561" author="xuefuz" created="Thu, 3 Oct 2013 21:35:44 +0000"  >&lt;p&gt;Patch committed to trunk. Thanks, Jarces!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12606164" name="PIG-3469.patch" size="2239" author="jarcec" created="Tue, 1 Oct 2013 19:08:07 +0000"/>
                            <attachment id="12606162" name="PIG-3469.patch" size="12671" author="jarcec" created="Tue, 1 Oct 2013 19:05:05 +0000"/>
                            <attachment id="12605262" name="PIG-3469.patch" size="926" author="jarcec" created="Thu, 26 Sep 2013 15:02:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349247</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1o7xr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349545</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>