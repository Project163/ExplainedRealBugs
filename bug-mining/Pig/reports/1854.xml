<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4921] Kill running jobs on InterruptedException</title>
                <link>https://issues.apache.org/jira/browse/PIG-4921</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Shutdown hook kills running jobs, but when running in Oozie launcher sometimes NodeManager can issue a SIGKILL after AM unregisters and before shutdown hook gets to execute causing orphaned jobs that continue to run. So it is better to kill when we see the InterruptedException.&lt;/p&gt;

&lt;p&gt;Added additional System.err logging to code in shutdown hooks as LogManager.shutdown() is called by mapreduce AM (Oozie launcher job is mapreduce) and log4j logging does not appear anymore.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12975608">PIG-4921</key>
            <summary>Kill running jobs on InterruptedException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rohini">Rohini Palaniswamy</assignee>
                                    <reporter username="rohini">Rohini Palaniswamy</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Jun 2016 19:50:15 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:23 +0000</updated>
                            <resolved>Wed, 8 Jun 2016 09:26:44 +0000</resolved>
                                                    <fixVersion>0.17.0</fixVersion>
                    <fixVersion>0.16.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15314687" author="rohini" created="Fri, 3 Jun 2016 19:53:34 +0000"  >&lt;p&gt;Also removed HangingJobKiller shutdown hook for Tez. It was redundant and duplicating effort as TezSessionManager shutdown hook already takes care of shutting down all applications.&lt;/p&gt;</comment>
                            <comment id="15315120" author="daijy" created="Fri, 3 Jun 2016 23:48:23 +0000"  >&lt;p&gt;TezLaucher.kill still kill individual job, is that redundant as well?&lt;/p&gt;

&lt;p&gt;For MR, kill will be invoked in both exception handling and shutdown hook, will this an issue?&lt;/p&gt;</comment>
                            <comment id="15315646" author="rohini" created="Sat, 4 Jun 2016 21:29:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;TezLaucher.kill still kill individual job, is that redundant as well?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;   TezLaucher.kill is now not called as part of HangingJobKiller shutdown hook. Only called on interrupted exception. TezSessionManager shutdown hook will shutdown all sessions.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;For MR, kill will be invoked in both exception handling and shutdown hook, will this an issue?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;   No. If already killed in exception handling then shutdown hook will be a no-op as it kills jc.getRunningJobs. Actually found that &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3524&quot; title=&quot;Clean up Launcher and MapReduceLauncher after PIG-3419&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3524&quot;&gt;&lt;del&gt;PIG-3524&lt;/del&gt;&lt;/a&gt; broke HangingJobKiller for mapreduce as it was setting jc = null and it skipped killing jobs because of that. That was a unnecessary change. Reverted that to fix the issue and also added System.err logging statement to mapreduce as well.&lt;/p&gt;</comment>
                            <comment id="15317501" author="rohini" created="Mon, 6 Jun 2016 23:43:01 +0000"  >&lt;p&gt;Updated patch to have shutdown hooks ordered taking into account issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4916&quot; title=&quot;Pig on Tez fail to remove temporary HDFS files in some cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4916&quot;&gt;&lt;del&gt;PIG-4916&lt;/del&gt;&lt;/a&gt;.  One side effect of this is that shutdown hook all run in a single thread now. But it should be fine as only when running via Oozie launcher time is of concern and in that case we kill the running jobs before shutdown hook. So shutdown hook will only have to cleanup tmp files and close TimelineClient which have to be done before filesystem is closed.&lt;/p&gt;</comment>
                            <comment id="15317951" author="daijy" created="Tue, 7 Jun 2016 06:20:42 +0000"  >&lt;p&gt;Thanks for taking care of shutdown hook with priority. In case of InterruptedException of a Tez job, do you actually want to call TezSessionManager.shutdown()? TezLauncher.kill only kill the running job and may leave idle AM behind.&lt;/p&gt;</comment>
                            <comment id="15318596" author="rohini" created="Tue, 7 Jun 2016 14:41:26 +0000"  >&lt;p&gt;No. Killing the running job does both dagClient.tryKillDAG(); and tezClient.stop(); . So we are good.&lt;/p&gt;</comment>
                            <comment id="15318870" author="daijy" created="Tue, 7 Jun 2016 16:59:28 +0000"  >&lt;p&gt;It kills active session but not idle sessions. Idle session will go away when expire, so probably no big deal. But when you say HangingJobKiller duplicates TezSessionManager.shutdown, it&apos;s not true, TezSessionManager.shutdown does more than HangingJobKiller.&lt;/p&gt;</comment>
                            <comment id="15318938" author="rohini" created="Tue, 7 Jun 2016 17:24:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;It kills active session but not idle sessions. Idle session will go away when expire, so probably no big deal.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;  Yes. Also they will not be running any code as there is no DAG submitted to them. So idle sessions are not a problem. The problem was active sessions as many times the orphaned jobs interfered with job reruns.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;But when you say HangingJobKiller duplicates TezSessionManager.shutdown, it&apos;s not true, TezSessionManager.shutdown does more than HangingJobKiller.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;  Yes. TezSessionManager.shutdown does all that HangingJobKiller does and more. That is why getting rid of HangingJobKiller.&lt;/p&gt;</comment>
                            <comment id="15318964" author="daijy" created="Tue, 7 Jun 2016 17:36:48 +0000"  >&lt;p&gt;Then in case of Oozie interruption, Pig call HangingJobKiller; In case of other interruption, Pig call TezSessionManager.shutdown. Can we make it consistent?&lt;/p&gt;</comment>
                            <comment id="15319414" author="rohini" created="Tue, 7 Jun 2016 21:01:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;in case of Oozie interruption, Pig call HangingJobKiller; In case of other interruption, Pig call TezSessionManager.shutdown&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;   In case of Oozie interruption, Pig will call kill directly and HangingJobKiller(mapreduce)/TezSessionManager.shutdown will also be invoked as part of shutdown hook. In commandline, only HangingJobKiller(mapreduce)/TezSessionManager.shutdown is called. This is required because with launcher is killed, enough time is not given for the shutdown hook to execute before the container is shot down with SIGTERM (kill -9).  In case of command line, when user does Ctrl+C shutdown hook has all the time to execute. Also there is no InterruptedException as no one interrupts the Thread like in launcher.&lt;/p&gt;</comment>
                            <comment id="15320189" author="daijy" created="Wed, 8 Jun 2016 07:37:56 +0000"  >&lt;p&gt;You mentioned TezSessionManager.shutdown is not effective in Oozie. If that happen, idle AM will left behind. But I agree compare to dangling job, it is less a worry. +1 for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4921&quot; title=&quot;Kill running jobs on InterruptedException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4921&quot;&gt;&lt;del&gt;PIG-4921&lt;/del&gt;&lt;/a&gt;-3.patch.&lt;/p&gt;</comment>
                            <comment id="15320287" author="rohini" created="Wed, 8 Jun 2016 09:26:44 +0000"  >&lt;p&gt;Committed to trunk. Thanks for the review Daniel.&lt;/p&gt;</comment>
                            <comment id="15390244" author="daijy" created="Fri, 22 Jul 2016 21:43:24 +0000"  >&lt;p&gt;See lots of &quot;Received kill signal&quot; message after the patch. Created &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4957&quot; title=&quot;See &amp;quot;Received kill signal&amp;quot; message for a normal run after PIG-4921&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4957&quot;&gt;&lt;del&gt;PIG-4957&lt;/del&gt;&lt;/a&gt; for that.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12979427">PIG-4928</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12674257">PIG-3524</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12808045" name="PIG-4921-1.patch" size="8925" author="rohini" created="Fri, 3 Jun 2016 19:53:34 +0000"/>
                            <attachment id="12808188" name="PIG-4921-2.patch" size="10569" author="rohini" created="Sat, 4 Jun 2016 21:29:46 +0000"/>
                            <attachment id="12808506" name="PIG-4921-3.patch" size="15844" author="rohini" created="Mon, 6 Jun 2016 23:43:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 17 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yyrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>