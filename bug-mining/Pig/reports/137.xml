<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:49:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-537] Failure in Hadoop map collect stage due to type mismatch in the keys used in cogroup</title>
                <link>https://issues.apache.org/jira/browse/PIG-537</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Consider the following pig query, which demonstrates various problems during the Logical Plan creation and the subsequent execution of the M/R job. In this query we do two cogroups, one between A and B to generate an alias ABtemptable. Then we again cogroup A with ABtemptable based on marks which was read in as an int. &lt;br/&gt;
==================================================================================&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;A = load &lt;span class=&quot;code-quote&quot;&gt;&apos;mymarks.txt&apos;&lt;/span&gt; as (marks:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, username:chararray);
B = load &lt;span class=&quot;code-quote&quot;&gt;&apos;mygrades.txt&apos;&lt;/span&gt; as (username:chararray,grade:chararray);
ABtemp = cogroup A by username, B  by username;
ABtemptable = foreach ABtemp generate
           group as username,
           flatten(A.marks) as newmarks;
--describe ABtemptable;
C = cogroup A by marks, ABtemptable by newmarks;
--describe C;
explain C;
dump C;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;==================================================================================&lt;br/&gt;
The schema for C and ABtemptable which pig reports:&lt;br/&gt;
==================================================================================&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;describe ABtemptable;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; ABtemptable: &lt;/p&gt;
{username: chararray,newmarks: int}
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;describe C;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; C: {group: int,A: &lt;/p&gt;
{username: chararray,marks: int}
&lt;p&gt;,ABtemptable: {username: chararray,newmarks: int}}&lt;br/&gt;
==================================================================================&lt;br/&gt;
If you run the above query you get the following error:&lt;br/&gt;
==================================================================================&lt;br/&gt;
2008-11-18 03:57:14,372 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; ERROR org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.Launcher - Error message from task (map) task_200810152105_0156_m_000000java.io.IOException: Type mismatch in key from map: expected org.apache.pig.impl.io.NullableText, recieved org.apache.pig.impl.io.NullableIntWritable&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask$MapOutputBuffer.collect(MapTask.java:415)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapReduce$Map.collect(PigMapReduce.java:97)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapBase.runPipeline(PigMapBase.java:172)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapBase.map(PigMapBase.java:158)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapReduce$Map.map(PigMapReduce.java:82)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapRunner.run(MapRunner.java:47)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:227)&lt;br/&gt;
        at org.apache.hadoop.mapred.TaskTracker$Child.main(TaskTracker.java:2209)&lt;br/&gt;
==================================================================================&lt;br/&gt;
Looking at the &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;explain C;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; output, you see that newmarks has become a chararray (surprising!!)&lt;br/&gt;
==================================================================================&lt;br/&gt;
---CoGroup viraj-Tue Nov 18 03:49:42 UTC 2008-25 Schema: {group: Unknown,&lt;/p&gt;
{username: bytearray,marks: int}
&lt;p&gt;,ABtemptable: {username: chararray,newmarks: chararray}} Type: bag&lt;br/&gt;
      Project viraj-Tue Nov 18 03:49:42 UTC 2008-23 Projections: &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; Overloaded: false FieldSchema: marks: int Type: int&lt;br/&gt;
      Input: SplitOutput&lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt; viraj-Tue Nov 18 03:49:42 UTC 2008-29&lt;br/&gt;
      Project viraj-Tue Nov 18 03:49:42 UTC 2008-24 Projections: &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; Overloaded: false FieldSchema: newmarks: chararray Type: chararray&lt;br/&gt;
       Input: ForEach viraj-Tue Nov 18 03:49:42 UTC 2008-22&lt;br/&gt;
    ---ForEach viraj-Tue Nov 18 03:49:42 UTC 2008-22 Schema: &lt;/p&gt;
{username: chararray,newmarks: chararray}
&lt;p&gt; Type: bag&lt;br/&gt;
==================================================================================&lt;br/&gt;
In Summary this script demonstrates the following problems:&lt;br/&gt;
1) Logical Plan creation&lt;br/&gt;
2) When cogrouping with fields of different types which results in group unknown is not caught during compile phase.&lt;br/&gt;
Additionally I am enclosing the explain output of alias C and testfiles to run the script which is on this jira!!&lt;br/&gt;
Viraj&lt;/p&gt;</description>
                <environment></environment>
        <key id="12408707">PIG-537</key>
            <summary>Failure in Hadoop map collect stage due to type mismatch in the keys used in cogroup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pkamath">Pradeep Kamath</assignee>
                                    <reporter username="viraj">Viraj Bhat</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Nov 2008 04:22:42 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:13 +0000</updated>
                            <resolved>Thu, 20 Nov 2008 20:05:27 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12648490" author="viraj" created="Tue, 18 Nov 2008 04:26:31 +0000"  >&lt;p&gt;Explain output for alias C&lt;/p&gt;</comment>
                            <comment id="12648491" author="viraj" created="Tue, 18 Nov 2008 04:29:32 +0000"  >&lt;p&gt;Test file mygrades.txt&lt;/p&gt;</comment>
                            <comment id="12648492" author="viraj" created="Tue, 18 Nov 2008 04:30:10 +0000"  >&lt;p&gt;Test file mymarks.txt&lt;/p&gt;</comment>
                            <comment id="12649426" author="pkamath" created="Thu, 20 Nov 2008 17:27:24 +0000"  >&lt;p&gt;The issue was in Implicit Split inserter. In this query, the same load provides input to two cogroups. Hence an implicit split needs to be introduced. However the ImplicitSplitInserter was changing the order of the inputs to the first cogroup as it was rewiring the plan with the new Split and SplitOutput operators. The patch changes the algorithm for introducing these new operators so that the order of the inputs for the successors of the load is maintained.&lt;/p&gt;</comment>
                            <comment id="12649459" author="olgan" created="Thu, 20 Nov 2008 20:05:27 +0000"  >&lt;p&gt;patch committed; thanks, pradeep&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12394354" name="PIG-537.patch" size="32293" author="pkamath" created="Thu, 20 Nov 2008 17:29:06 +0000"/>
                            <attachment id="12394132" name="explain_aliasC.log" size="15357" author="viraj" created="Tue, 18 Nov 2008 04:26:31 +0000"/>
                            <attachment id="12394133" name="mygrades.txt" size="17" author="viraj" created="Tue, 18 Nov 2008 04:29:32 +0000"/>
                            <attachment id="12394134" name="mymarks.txt" size="70" author="viraj" created="Tue, 18 Nov 2008 04:30:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164136</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0glfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94902</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>