<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:49:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-449] Schemas for bags should contain tuples all the time</title>
                <link>https://issues.apache.org/jira/browse/PIG-449</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The front end treats relations as operators that return bags.  When the schema of a load statement is specified, the bag is associated with the schema specified by the user. Ideally, the schema corresponds to the tuple contained in the bag. &lt;/p&gt;

&lt;p&gt;With &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-380&quot; title=&quot;invalid schema for databag constant&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-380&quot;&gt;&lt;del&gt;PIG-380&lt;/del&gt;&lt;/a&gt;, the schema for bag constants are computed by the front end. The schema for the bag contains the tuple which in turn contains the schema of the columns. This results in errors when columns are accessed directly just like the load statements.&lt;/p&gt;

&lt;p&gt;The front end should then treat access to the columns as a double dereference, i.e., access the tuple inside the bag and then the column inside the tuple.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;grunt&amp;gt; a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;/user/sms/data/student.data&apos;&lt;/span&gt; using PigStorage(&lt;span class=&quot;code-quote&quot;&gt;&apos; &apos;&lt;/span&gt;) as (name, age, gpa);
grunt&amp;gt; b = foreach a generate {(16, 4.0e-2, &lt;span class=&quot;code-quote&quot;&gt;&apos;hello&apos;&lt;/span&gt;)} as b:{t:(i: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, d: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;, c: chararray)};

grunt&amp;gt; describe b;
b: {b: {t: (i: integer,d: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,c: chararray)}}

grunt&amp;gt; c = foreach b generate b.i;
111064 [main] ERROR org.apache.pig.tools.grunt.GruntParser  - java.io.IOException: Invalid alias: i in {t: (i: integer,d: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,c: chararray)}
        at org.apache.pig.PigServer.parseQuery(PigServer.java:293)
        at org.apache.pig.PigServer.registerQuery(PigServer.java:258)
        at org.apache.pig.tools.grunt.GruntParser.processPig(GruntParser.java:432)
        at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:242)
        at org.apache.pig.tools.grunt.GruntParser.parseContOnError(GruntParser.java:93)
        at org.apache.pig.tools.grunt.Grunt.run(Grunt.java:58)
        at org.apache.pig.Main.main(Main.java:282)
Caused by: org.apache.pig.impl.logicalLayer.parser.ParseException: Invalid alias: i in {t: (i: integer,d: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,c: chararray)}
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.AliasFieldOrSpec(QueryParser.java:5851)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.ColOrSpec(QueryParser.java:5709)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.BracketedSimpleProj(QueryParser.java:5242)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.BaseEvalSpec(QueryParser.java:4040)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.UnaryExpr(QueryParser.java:3909)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.CastExpr(QueryParser.java:3863)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.MultiplicativeExpr(QueryParser.java:3772)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.AdditiveExpr(QueryParser.java:3698)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.InfixExpr(QueryParser.java:3664)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.FlattenedGenerateItem(QueryParser.java:3590)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.FlattenedGenerateItemList(QueryParser.java:3500)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.GenerateStatement(QueryParser.java:3457)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.NestedBlock(QueryParser.java:2933)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.ForEachClause(QueryParser.java:2336)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.BaseExpr(QueryParser.java:973)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.Expr(QueryParser.java:748)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.Parse(QueryParser.java:549)
        at org.apache.pig.impl.logicalLayer.LogicalPlanBuilder.parse(LogicalPlanBuilder.java:60)
        at org.apache.pig.PigServer.parseQuery(PigServer.java:290)
        ... 6 more

111064 [main] ERROR org.apache.pig.tools.grunt.GruntParser  - Invalid alias: i in {t: (i: integer,d: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,c: chararray)}
111064 [main] ERROR org.apache.pig.tools.grunt.GruntParser  - java.io.IOException: Invalid alias: i in {t: (i: integer,d: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,c: chararray)}
grunt&amp;gt; c = foreach b generate b.t;
grunt&amp;gt; describe c;
c: {t: {i: integer,d: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;,c: chararray}}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12404925">PIG-449</key>
            <summary>Schemas for bags should contain tuples all the time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pkamath">Pradeep Kamath</assignee>
                                    <reporter username="sms">Santhosh Muthur Srinivasan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Sep 2008 02:46:26 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:10 +0000</updated>
                            <resolved>Tue, 9 Dec 2008 02:02:12 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12635050" author="pkamath" created="Fri, 26 Sep 2008 22:47:40 +0000"  >&lt;p&gt;Another script snippet which shows the above inconsistency:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;grunt&amp;gt; a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;bla&apos;&lt;/span&gt; as (b:bag{t:(x,y,z)}, t:tuple(a,b,c), m:[]);
grunt&amp;gt; describe a;
a: {b: {t: (x: bytearray,y: bytearray,z: bytearray)},t: (a: bytearray,b: bytearray,c: bytearray),m: map[ ]}
grunt&amp;gt; b = foreach a generate b.y;
2008-09-26 15:35:22,673 [main] ERROR org.apache.pig.tools.grunt.GruntParser - java.io.IOException: Invalid alias: y in {t: (x: bytearray,y: bytearray,z: bytearray)}
        at org.apache.pig.PigServer.parseQuery(PigServer.java:293)
        at org.apache.pig.PigServer.registerQuery(PigServer.java:258)
        at org.apache.pig.tools.grunt.GruntParser.processPig(GruntParser.java:434)
        at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:242)
        at org.apache.pig.tools.grunt.GruntParser.parseContOnError(GruntParser.java:94)
        at org.apache.pig.tools.grunt.Grunt.run(Grunt.java:58)
        at org.apache.pig.Main.main(Main.java:282)
Caused by: org.apache.pig.impl.logicalLayer.parser.ParseException: Invalid alias: y in {t: (x: bytearray,y: bytearray,z: bytearray)}
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.AliasFieldOrSpec(QueryParser.java:5851)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.ColOrSpec(QueryParser.java:5709)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.BracketedSimpleProj(QueryParser.java:5242)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.BaseEvalSpec(QueryParser.java:4040)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.UnaryExpr(QueryParser.java:3909)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.CastExpr(QueryParser.java:3863)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.MultiplicativeExpr(QueryParser.java:3772)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.AdditiveExpr(QueryParser.java:3698)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.InfixExpr(QueryParser.java:3664)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.FlattenedGenerateItem(QueryParser.java:3590)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.FlattenedGenerateItemList(QueryParser.java:3500)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.GenerateStatement(QueryParser.java:3457)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.NestedBlock(QueryParser.java:2933)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.ForEachClause(QueryParser.java:2336)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.BaseExpr(QueryParser.java:973)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.Expr(QueryParser.java:748)
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.Parse(QueryParser.java:549)
        at org.apache.pig.impl.logicalLayer.LogicalPlanBuilder.parse(LogicalPlanBuilder.java:60)
        at org.apache.pig.PigServer.parseQuery(PigServer.java:290)
        ... 6 more

2008-09-26 15:35:22,674 [main] ERROR org.apache.pig.tools.grunt.GruntParser - Invalid alias: y in {t: (x: bytearray,y: bytearray,z: bytearray)}
2008-09-26 15:35:22,674 [main] ERROR org.apache.pig.tools.grunt.GruntParser - java.io.IOException: Invalid alias: y in {t: (x: bytearray,y: bytearray,z: bytearray)}
grunt&amp;gt; b = foreach a generate b.t.y;
grunt&amp;gt; describe b; 
b: {y: {y: bytearray}} --&amp;gt; THIS ALSO LOOKS WRONG

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12646712" author="sms" created="Tue, 11 Nov 2008 22:51:07 +0000"  >&lt;p&gt;Currently, bags in Pig are containers of tuples. Accessing elements inside a bag should translate to accessing elements inside the tuple contained in the bag. In addition, accessing tuples inside a bag should be restricted to the FLATTEN keyword in a FOREACH statement. A few examples shown below will demonstrate the point.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;/user/pig/data/student.data&apos;&lt;/span&gt; using PigStorage(&lt;span class=&quot;code-quote&quot;&gt;&apos; &apos;&lt;/span&gt;) as (name, age, gpa);
b = foreach a generate {(16, 4.0e-2, &lt;span class=&quot;code-quote&quot;&gt;&apos;hello&apos;&lt;/span&gt;)} as b:{t:(i: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, d: &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;, c: chararray)};
c = foreach b generate b.i; -- Here b.i should generate a bag of integers by accessing the column called &lt;span class=&quot;code-quote&quot;&gt;&apos;i&apos;&lt;/span&gt; inside each tuple
d = foeach b generate b.t; -- This should be outlawed as the tuple inside the bag does not have a column called &lt;span class=&quot;code-quote&quot;&gt;&apos;t&apos;&lt;/span&gt; although the tuple inside the bag are named &lt;span class=&quot;code-quote&quot;&gt;&apos;t&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Summary:&lt;/p&gt;

&lt;p&gt;1. The frontend should translate access to columns in a bag to columns inside the tuple in the bag&lt;br/&gt;
2. The frontend should prevent access to tuples inside the bag via projections and allow access only via the FLATTEN keyword&lt;/p&gt;

&lt;p&gt;Thoughts/suggestions/comments are welcome.&lt;/p&gt;</comment>
                            <comment id="12654626" author="pkamath" created="Mon, 8 Dec 2008 23:02:04 +0000"  >&lt;p&gt;A new flag has been introduced in schema to distinguish bag schemas which have only one field schema of a tuple containing a list of field schemas for the elements in the bag (these kind of bag schemas occur in two cases explained in the code comment below). This flag is will be used to solve the problems reported in this issue by resolving access to fields in such bags as access to the fields present in the inner tuple schema. This is explained in the comment for this flag pasted here for reference:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    // In bags which have a schema with a tuple which contains
    // the fields present in it, if we access the second field (say)
    // we are actually trying to access the second field in the
    // tuple in the bag. This is currently true for two cases:
    // 1) bag constants - the schema of bag constant has a tuple
    // which internally has the actual elements
    // 2) When bags are loaded from input data, if the user 
    // specifies a schema with the &quot;bag&quot; type, he has to specify
    // the bag as containing a tuple with the actual elements in 
    // the schema declaration. However in both the cases above,
    // the user can still say b.i where b is the bag and i is 
    // an element in the bag&apos;s tuple schema. So in these cases,
    // the access should translate to a lookup for &quot;i&quot; in the 
    // tuple schema present in the bag. To indicate this, the
    // flag below is used. It is false by default because, 
    // currently we use bag as the type for relations. However 
    // the schema of a relation does NOT have a tuple fieldschema
    // with items in it. Instead, the schema directly has the 
    // field schema of the items. So for a relation &quot;b&quot;, the 
    // above b.i access would be a direct single level access
    // of i in b&apos;s schema. This is treated as the &quot;default&quot; case
    private boolean twoLevelAccessRequired = false;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The changes are in getPosition() in Schema.java to use the above flag to do a two level access whenever an access to the above kind of bag is involved. Besides this there are changes in getSchema() of LOForEach and getFieldSchema() of LOProject to use the inner tuple schema in cases of these kinds of bags. A new unit test case, TestDataBagAccess has also been added to test out various access scenarios for the above cases of bag schemas which have a tuple field schema with a list of item field schemas.&lt;/p&gt;</comment>
                            <comment id="12654676" author="olgan" created="Tue, 9 Dec 2008 02:02:12 +0000"  >&lt;p&gt;patch committed; thanks, pradeep&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12395600" name="PIG-449.patch" size="27841" author="pkamath" created="Mon, 8 Dec 2008 23:02:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164063</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gkdb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94730</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>