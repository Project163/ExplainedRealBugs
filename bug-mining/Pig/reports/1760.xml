<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:01:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4679] Performance degradation due to InputSizeReducerEstimator since PIG-3754</title>
                <link>https://issues.apache.org/jira/browse/PIG-4679</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;On encountering a non-HDFS location in the input (for example a JOIN involving both HBase tables and intermediate temp files), Pig 0.14 ReducerEstimator is returning total input size as -1 (unknown) where as in Pig 0.12.1 it was returning the sum of temp file sizes as the total size. Since -1 is returned as the input size, Pig end up using only one reducer for the job.&lt;/p&gt;

&lt;p&gt;STEPS TO REPRODUCE:&lt;br/&gt;
1.	Create an HBase table with enough data.  Using PerformanceEvaluation tool to generate data&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;hbase org.apache.hadoop.hbase.PerformanceEvaluation --presplit=20 --rows=1000000 sequentialWrite 10
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.	Dump the table data into a file which we can then use in a Pig JOIN.  Following Pig script generates the data file&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ pig
A = LOAD &lt;span class=&quot;code-quote&quot;&gt;&apos;hbase:&lt;span class=&quot;code-comment&quot;&gt;//TestTable&apos;&lt;/span&gt; USING org.apache.pig.backend.hadoop.hbase.HBaseStorage(&lt;span class=&quot;code-quote&quot;&gt;&apos;info:data&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;-loadKey&apos;&lt;/span&gt;) AS (row_key: chararray, data: chararray);
&lt;/span&gt;STORE A INTO &lt;span class=&quot;code-quote&quot;&gt;&apos;hdfs:&lt;span class=&quot;code-comment&quot;&gt;///tmp/re_test/test_table_data&apos;&lt;/span&gt; USING PigStorage(&lt;span class=&quot;code-quote&quot;&gt;&apos;|&apos;&lt;/span&gt;);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3.	Check file size to make sure that it is more than 1,000,000,000 which is the default bytes per reducer Pig configuration&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ hdfs dfs -count hdfs:&lt;span class=&quot;code-comment&quot;&gt;///tmp/re_test/test_table_data
&lt;/span&gt;QA:           1           41        10280000000 hdfs:&lt;span class=&quot;code-comment&quot;&gt;///tmp/re_test/test_table_data
&lt;/span&gt;PROD:         1           57        10280000000 hdfs:&lt;span class=&quot;code-comment&quot;&gt;///tmp/re_test/test_table_data&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4.	Run a Pig script that joins the HBase table with the data file.  QA and PROD will use different number of reducers.  QA (176243) should run 1 reducer and PROD (176258) should run 11 reducers (10,280,000,000 / 1,000,000,000)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ pig
A = LOAD &lt;span class=&quot;code-quote&quot;&gt;&apos;hbase:&lt;span class=&quot;code-comment&quot;&gt;//TestTable&apos;&lt;/span&gt; USING org.apache.pig.backend.hadoop.hbase.HBaseStorage(&lt;span class=&quot;code-quote&quot;&gt;&apos;info:data&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;-loadKey&apos;&lt;/span&gt;) AS (row_key: chararray, data: chararray);
&lt;/span&gt;B = LOAD &lt;span class=&quot;code-quote&quot;&gt;&apos;hdfs:&lt;span class=&quot;code-comment&quot;&gt;///tmp/re_test/test_table_data&apos;&lt;/span&gt; USING PigStorage(&lt;span class=&quot;code-quote&quot;&gt;&apos;|&apos;&lt;/span&gt;) AS (row_key: chararray, data: chararray);
&lt;/span&gt;C = JOIN A BY row_key, B BY row_key;
STORE C INTO &lt;span class=&quot;code-quote&quot;&gt;&apos;hdfs:&lt;span class=&quot;code-comment&quot;&gt;///tmp/re_test/test_table_data_join&apos;&lt;/span&gt; USING PigStorage(&lt;span class=&quot;code-quote&quot;&gt;&apos;|&apos;&lt;/span&gt;);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pig 0.12.1 ran 11 reduce, Pig 0.13+ run only 1 reduce.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12864440">PIG-4679</key>
            <summary>Performance degradation due to InputSizeReducerEstimator since PIG-3754</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Sep 2015 04:12:28 +0000</created>
                <updated>Wed, 8 Jun 2016 20:48:25 +0000</updated>
                            <resolved>Thu, 17 Sep 2015 02:39:21 +0000</resolved>
                                                    <fixVersion>0.16.0</fixVersion>
                    <fixVersion>0.15.1</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14746810" author="daijy" created="Wed, 16 Sep 2015 04:14:53 +0000"  >&lt;p&gt;We don&apos;t estimate size for non-hdfs inputs before 0.12. However, we will use the size of the other input. Though it is still wrong, but it is not -1, which leads to 1 reduce. Attach a draft patch.&lt;/p&gt;</comment>
                            <comment id="14791110" author="rohini" created="Wed, 16 Sep 2015 20:56:33 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14791485" author="daijy" created="Thu, 17 Sep 2015 02:39:21 +0000"  >&lt;p&gt;Patch committed to trunk. Thanks Rohini for review!&lt;/p&gt;</comment>
                            <comment id="14903985" author="daijy" created="Wed, 23 Sep 2015 05:35:04 +0000"  >&lt;p&gt;Fix a unit test failure.&lt;/p&gt;</comment>
                            <comment id="14904026" author="prkommireddi" created="Wed, 23 Sep 2015 06:13:22 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14985895" author="daijy" created="Mon, 2 Nov 2015 19:52:24 +0000"  >&lt;p&gt;Backport to 0.15 branch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12694047">PIG-3754</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12756156" name="PIG-4679-0.patch" size="920" author="daijy" created="Wed, 16 Sep 2015 04:14:53 +0000"/>
                            <attachment id="12756314" name="PIG-4679-1.patch" size="3694" author="daijy" created="Wed, 16 Sep 2015 18:11:57 +0000"/>
                            <attachment id="12761809" name="PIG-4679-fixtest.patch" size="649" author="daijy" created="Wed, 23 Sep 2015 05:35:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 3 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k8cf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>