<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:48:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-129] need to create temp files in the task&apos;s working directory</title>
                <link>https://issues.apache.org/jira/browse/PIG-129</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Currently, pig creates temp data such is spilled bags in the directory specified by java.io.tmpdir. The problem is that this directory is usually shared by all tasks and can easily run out of space.&lt;/p&gt;

&lt;p&gt;A better approach would be to create this files in the temp dir inside of the taks working directory as these locations usually have much mor space and also they can be hosted on different disks so the performance could be better.&lt;/p&gt;

&lt;p&gt;There are 2 parts to this fix:&lt;/p&gt;

&lt;p&gt;(1) in org.apache.pig.data.DataBag to check if the temp directory exists and create it if not before trying to create the temp file. This is somewhere around line 390 in the code.&lt;br/&gt;
(2) Change the mapred.child.java.opts in hadoop-site.xml to include new value for tmpdir property to point to ./tmp. For instance: &lt;br/&gt;
&amp;lt;property&amp;gt;&lt;br/&gt;
        &amp;lt;name&amp;gt;mapred.child.java.opts&amp;lt;/name&amp;gt;&lt;br/&gt;
        &amp;lt;value&amp;gt;-Xmx1024M -Djava.io.tmpdir=&quot;./tmp&quot;&amp;lt;/value&amp;gt;&lt;br/&gt;
        &amp;lt;description&amp;gt;arguments passed to child jvms&amp;lt;/description&amp;gt;&lt;br/&gt;
&amp;lt;/property&amp;gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12389916">PIG-129</key>
            <summary>need to create temp files in the task&apos;s working directory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="amirhyoussefi">Amir Youssefi</assignee>
                                    <reporter username="olgan">Olga Natkovich</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Feb 2008 20:08:05 +0000</created>
                <updated>Wed, 24 Mar 2010 22:01:22 +0000</updated>
                            <resolved>Fri, 7 Mar 2008 01:09:18 +0000</resolved>
                                                    <fixVersion>0.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12574019" author="pi_song" created="Sat, 1 Mar 2008 00:05:32 +0000"  >&lt;p&gt;I think the concept of multi-dir temp file creator (LocalDirAllocator in Hadoop) should be adopted to Pig.  What it does is:-&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;You can set up a set of tmp file dirs in configuration (They can be on different physical drives so you can utilize more disk space)&lt;/li&gt;
	&lt;li&gt;When a temp file is being created, the system will probe the given temp dirs in round-robin fashion&lt;/li&gt;
	&lt;li&gt;For a selected temp dir, if it exists and you have permission to write, temp file will be created&lt;/li&gt;
	&lt;li&gt;For a selected temp dir, it it doesn&apos;t exist or you don&apos;t have permission to write, the temp dir will be kept in the black list, thus not being used later on.&lt;/li&gt;
	&lt;li&gt;For the next temp file, move on to the next temp dir&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12574215" author="pi_song" created="Sun, 2 Mar 2008 12:59:26 +0000"  >&lt;p&gt;Olga,&lt;br/&gt;
I want to clarify a bit more about what I think and &lt;b&gt;I really need you opinion&lt;/b&gt; on this bit. Regarding temp file creation due to DataBag spill,  this can happen in 2 places:-&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In Hadoop Map Reduce execution engine&lt;/li&gt;
	&lt;li&gt;In Local execution engine&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I agree with you that the working dir mechanism in hadoop is already good and you&apos;re trying to adopt it &lt;b&gt;BUT&lt;/b&gt; what about local execution engine? &lt;/p&gt;

&lt;p&gt;I think even most people pay more attention on Hadoop backend and that&apos;s where Pig started, but the local engine still has its use.&lt;/p&gt;

&lt;p&gt;A sample use case would be if I have a big data file on my harddisk(thus cannot be too big) and what I do is I just download Pig and then quickly write a pig script to perform processing in my local machine using local execution engine (without running Hadoop)&lt;/p&gt;

&lt;p&gt;A good local engine implementation will help improve usability of Pig!!!&lt;/p&gt;

&lt;p&gt;Can we handle this issue in 2 different ways? One for hadoop backend, one for local engine. I&apos;m willing to implement what I&apos;ve proposed in the last comment for the local engine.&lt;/p&gt;</comment>
                            <comment id="12574217" author="amirhyoussefi" created="Sun, 2 Mar 2008 13:37:29 +0000"  >&lt;p&gt;I think it&apos;s a good idea to have multiple tmp dirs. Having several physical drives is common these days. I brought up the same idea earlier this week as next logical step.  &lt;/p&gt;

&lt;p&gt;A new feature in Hadoop 0.16.1 will partially address the tmp dir issue. But it takes a while for it to go through pipeline and reach users. Currently tmp directory is a hot issue for us so we plan to address this in Pig.&lt;/p&gt;

&lt;p&gt;I will probably do this in two stages. &lt;/p&gt;

&lt;p&gt;1) ./tmp directory under working directory. This automatically gets cleaned.&lt;br/&gt;
2) open discussion on details of using multiple tmp directories (possibly over multiple physical drives). We need to take into account cleaning scenarios as well.&lt;/p&gt;

&lt;p&gt;-Amir&lt;/p&gt;</comment>
                            <comment id="12574734" author="olgan" created="Mon, 3 Mar 2008 21:07:24 +0000"  >&lt;p&gt;Hi Pi,&lt;/p&gt;

&lt;p&gt;On hadoop side, I am hoping that by using tasks directory we can get the multi-disk distribution and cleaning for free.&lt;/p&gt;

&lt;p&gt;For local pig, I think that the idea is good but I question the priority of this feature. The use case is fairly limitted. Local pig is mostly for coming up to speed on the system not to run large scale processes.&lt;/p&gt;</comment>
                            <comment id="12574903" author="pi_song" created="Tue, 4 Mar 2008 09:56:56 +0000"  >&lt;p&gt;Olga,&lt;/p&gt;

&lt;p&gt;I agree with you. But don&apos;t forget we&apos;re in an open source project. What you can also do for a low priority task is to give a good direction and leave until someone will do it.&lt;/p&gt;

&lt;p&gt;Go ahead on Hadoop side and please don&apos;t forget to keep implementation generic.&lt;/p&gt;

&lt;p&gt;Here I will leave a simple implementation that will give an idea what I expect as a guideline. If I have time on the weekend, I may come back to complete it.&lt;/p&gt;</comment>
                            <comment id="12574904" author="pi_song" created="Tue, 4 Mar 2008 09:57:58 +0000"  >&lt;p&gt;The mentioned sample code&lt;/p&gt;</comment>
                            <comment id="12575958" author="amirhyoussefi" created="Thu, 6 Mar 2008 23:44:13 +0000"  >&lt;p&gt;Patch to create temporary directory. &lt;/p&gt;</comment>
                            <comment id="12575968" author="amirhyoussefi" created="Fri, 7 Mar 2008 00:07:53 +0000"  >&lt;p&gt;Here is summary of decisions made with Olga:&lt;/p&gt;

&lt;p&gt;Goal of this JIRA is to have a means to create a temporary directory under Hadoop Task Dir. I will open a new JIRA  so others (Pi Song) can continue work on local mode and multiple directories.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;We address the case in which Hadoop Platform is used.&lt;/li&gt;
	&lt;li&gt;We rely on Hadoop to clean up the directory.&lt;/li&gt;
	&lt;li&gt;We tested this on a cluster and observed logs showing creation of directory and actual directory/file being generated.&lt;/li&gt;
	&lt;li&gt;Added Code Block is actually called by a synchronized block of code. Second checking of directory creation is because of an observed case on a cluster.&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="12575974" author="amirhyoussefi" created="Fri, 7 Mar 2008 00:25:28 +0000"  >&lt;p&gt;Moved Pi Song&apos;s additional improvement requests to &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-138&quot; title=&quot;Support for Multiple tmp directories and clean up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-138&quot;&gt;&lt;del&gt;PIG-138&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12575998" author="olgan" created="Fri, 7 Mar 2008 01:09:18 +0000"  >&lt;p&gt;I committed the patch. Thanks Amir for contributing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12377297" name="PIG-129.patch" size="2637" author="amirhyoussefi" created="Thu, 6 Mar 2008 23:44:13 +0000"/>
                            <attachment id="12377051" name="TempAllocator0.patch" size="12888" author="pi_song" created="Tue, 4 Mar 2008 09:57:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163788</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gggn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94097</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>