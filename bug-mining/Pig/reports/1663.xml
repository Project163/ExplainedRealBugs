<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:00:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4392] RANK BY fails when default_parallel is greater than cardinality of field being ranked by</title>
                <link>https://issues.apache.org/jira/browse/PIG-4392</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;To reproduce:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;input.txt&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1 2 3
4 5 6
7 8 9
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;rank.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;set default_parallel 4;

d = load &lt;span class=&quot;code-quote&quot;&gt;&apos;input.txt&apos;&lt;/span&gt; using PigStorage(&lt;span class=&quot;code-quote&quot;&gt;&apos; &apos;&lt;/span&gt;) as (a:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, b:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, c:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
e = rank d by a;
dump e;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If &lt;tt&gt;default_parallel&lt;/tt&gt; is set to &lt;tt&gt;3&lt;/tt&gt;, the script succeeds. So I&apos;m guessing RANK BY has issues if the &lt;tt&gt;default_parallel&lt;/tt&gt; exceeds the cardinality of the field being ranked by.&lt;/p&gt;

&lt;p&gt;I&apos;m seeing this issue with Pig 0.11.1 (which has the &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2932&quot; title=&quot;Setting high default_parallel causes IOException in local mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2932&quot;&gt;&lt;del&gt;PIG-2932&lt;/del&gt;&lt;/a&gt; patch applied) and Hadoop 2.3.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12769896">PIG-4392</key>
            <summary>RANK BY fails when default_parallel is greater than cardinality of field being ranked by</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="erwaman">Anthony Hsu</reporter>
                        <labels>
                    </labels>
                <created>Sat, 24 Jan 2015 21:32:49 +0000</created>
                <updated>Sun, 7 Jun 2015 03:48:15 +0000</updated>
                            <resolved>Wed, 4 Feb 2015 22:14:05 +0000</resolved>
                                    <version>0.11.1</version>
                                    <fixVersion>0.15.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14299299" author="daijy" created="Fri, 30 Jan 2015 22:32:02 +0000"  >&lt;p&gt;Counter value 0 does not show up in the counter list. So for empty reduce, we didn&apos;t have the counter. Shall pad 0 for this case.&lt;/p&gt;</comment>
                            <comment id="14302792" author="erwaman" created="Tue, 3 Feb 2015 05:42:11 +0000"  >&lt;p&gt;Patch looks good to me. Just some minor comments and questions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Add a space after the semicolons in the for loop declaration: &lt;tt&gt;for (int i=0;i&amp;lt;job.getJob().getNumReduceTasks();i++) {&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Is the order of the tuples in &lt;tt&gt;iter&lt;/tt&gt; in the test case guaranteed?&lt;/li&gt;
	&lt;li&gt;Why does the order of the tuples get reversed?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14304961" author="azaroth" created="Wed, 4 Feb 2015 11:13:48 +0000"  >&lt;p&gt;Yes, the order is guaranteed by RANK, which uses ORDER BY.&lt;br/&gt;
Not sure about the reversed order either, otherwise LGTM +1.&lt;/p&gt;</comment>
                            <comment id="14306008" author="daijy" created="Wed, 4 Feb 2015 21:33:37 +0000"  >&lt;p&gt;Thanks for the review. I found another issue when working on the patch. The sort job does not take the parallelism of rank operator. The new patch also fix this issue. The order reverse is caused by the logic Pig combining small splits. Small splits are reversely sorted by the part file size. In this case, part-00003 is the largest and part-00001 is the smallest. That&apos;s why the tuple in part-00003 (7 8 9) appears first.&lt;/p&gt;

&lt;p&gt;I also find some issue in tez mode. Will create a separate ticket for it.&lt;/p&gt;</comment>
                            <comment id="14306029" author="rohini" created="Wed, 4 Feb 2015 21:46:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;Counter value 0 does not show up in the counter list. So for empty reduce, we didn&apos;t have the counter.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;    Koji addressed this issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4220&quot; title=&quot;MapReduce-based Rank failing with NPE due to missing Counters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4220&quot;&gt;&lt;del&gt;PIG-4220&lt;/del&gt;&lt;/a&gt; by initializing the counter value to 0. Does it still exist in 0.14?&lt;/p&gt;</comment>
                            <comment id="14306055" author="rohini" created="Wed, 4 Feb 2015 21:57:53 +0000"  >&lt;p&gt;+1. This is still a good fix to have on the client side in addition to &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4220&quot; title=&quot;MapReduce-based Rank failing with NPE due to missing Counters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4220&quot;&gt;&lt;del&gt;PIG-4220&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14306087" author="daijy" created="Wed, 4 Feb 2015 22:14:05 +0000"  >&lt;p&gt;Patch committed to trunk. Thanks for review, Anthony, Gianmarco, Rohini!&lt;/p&gt;</comment>
                            <comment id="14306102" author="daijy" created="Wed, 4 Feb 2015 22:20:32 +0000"  >&lt;p&gt;One more clarification, Hadoop does not report the counter with value 0 in this case, so &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4220&quot; title=&quot;MapReduce-based Rank failing with NPE due to missing Counters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4220&quot;&gt;&lt;del&gt;PIG-4220&lt;/del&gt;&lt;/a&gt; does not work.&lt;/p&gt;</comment>
                            <comment id="14326463" author="knoguchi" created="Wed, 18 Feb 2015 19:55:44 +0000"  >&lt;p&gt;&amp;gt; One more clarification, Hadoop does not report the counter with value 0 in this case, so &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4220&quot; title=&quot;MapReduce-based Rank failing with NPE due to missing Counters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4220&quot;&gt;&lt;del&gt;PIG-4220&lt;/del&gt;&lt;/a&gt; does not work.&lt;br/&gt;
&amp;gt;&lt;br/&gt;
Hmm. It worked for us in hadoop 2.X.  So maybe it depends on the hadoop version.&lt;/p&gt;

&lt;p&gt;Apart from this, I&apos;m seeing test failures after this jira (on hadoopversion=23).&lt;/p&gt;

&lt;p&gt;Unit tests&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; org.apache.pig.test.TestRank3.testRankWithSplitInMap 	&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; org.apache.pig.test.TestRank3.testRankWithSplitInReduce &lt;/p&gt;

&lt;p&gt;E2E tests&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; Rank.Rank_1 &lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; Rank.Rank_4 &lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; Rank.Rank_5 &lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; Rank.Rank_6 &lt;/p&gt;

&lt;p&gt;Haven&apos;t had time to take a look.&lt;/p&gt;</comment>
                            <comment id="14328303" author="knoguchi" created="Thu, 19 Feb 2015 23:23:54 +0000"  >&lt;p&gt;&amp;gt; Hmm. It worked for us in hadoop 2.X. So maybe it depends on the hadoop version.&lt;br/&gt;
&amp;gt;&lt;br/&gt;
Never mind.  &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4220&quot; title=&quot;MapReduce-based Rank failing with NPE due to missing Counters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4220&quot;&gt;&lt;del&gt;PIG-4220&lt;/del&gt;&lt;/a&gt; was handling a different case.&lt;/p&gt;

&lt;p&gt;&amp;gt; Apart from this, I&apos;m seeing test failures after this jira (on hadoopversion=23).&lt;br/&gt;
&amp;gt;&lt;br/&gt;
Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4426&quot; title=&quot;RowNumber(simple) Rank not producing correct results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4426&quot;&gt;&lt;del&gt;PIG-4426&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14335115" author="erwaman" created="Tue, 24 Feb 2015 17:25:31 +0000"  >&lt;p&gt;I&apos;m also getting a build error when I run &lt;tt&gt;ant compile gen&lt;/tt&gt; with this patch applied:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    [javac] /home/ahsu/github/apache/pig/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/JobControlCompiler.java:412: error: cannot find symbol
    [javac]             &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0;i&amp;lt;job.getJob().getNumReduceTasks();i++) {
    [javac]                               ^
    [javac]   symbol:   method getJob()
    [javac]   location: variable job of type Job
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;m using Java 1.7 and Ant 1.8.4.&lt;/p&gt;</comment>
                            <comment id="14335122" author="erwaman" created="Tue, 24 Feb 2015 17:29:00 +0000"  >&lt;p&gt;Seems like &lt;tt&gt;Job.getJob()&lt;/tt&gt; only exists in Hadoop 2 but not Hadoop 1:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Hadoop 1: &lt;a href=&quot;https://hadoop.apache.org/docs/r1.2.1/api/org/apache/hadoop/mapred/jobcontrol/Job.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hadoop.apache.org/docs/r1.2.1/api/org/apache/hadoop/mapred/jobcontrol/Job.html&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Hadoop 2: &lt;a href=&quot;https://hadoop.apache.org/docs/r2.3.0/api/org/apache/hadoop/mapred/jobcontrol/Job.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hadoop.apache.org/docs/r2.3.0/api/org/apache/hadoop/mapred/jobcontrol/Job.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14335127" author="erwaman" created="Tue, 24 Feb 2015 17:31:49 +0000"  >&lt;p&gt;If I run &lt;tt&gt;ant compile gen -Dhadoopversion=23&lt;/tt&gt;, it succeeds.&lt;/p&gt;</comment>
                            <comment id="14335273" author="knoguchi" created="Tue, 24 Feb 2015 19:15:34 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erwaman&quot; class=&quot;user-hover&quot; rel=&quot;erwaman&quot;&gt;erwaman&lt;/a&gt;. My patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4426&quot; title=&quot;RowNumber(simple) Rank not producing correct results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4426&quot;&gt;&lt;del&gt;PIG-4426&lt;/del&gt;&lt;/a&gt; also had the same issue.  Uploaded another one.  &lt;br/&gt;
Can you check to see if this works for you?&lt;/p&gt;</comment>
                            <comment id="14335749" author="erwaman" created="Wed, 25 Feb 2015 00:50:11 +0000"  >&lt;p&gt;Thanks for the fix, Koji.  Synced with trunk and now &lt;tt&gt;ant compile gen&lt;/tt&gt; succeeds.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12772501">PIG-4410</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12609238">PIG-2932</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12695628" name="PIG-4392-1.patch" size="2423" author="daijy" created="Fri, 30 Jan 2015 22:32:02 +0000"/>
                            <attachment id="12696565" name="PIG-4392-2.patch" size="3344" author="daijy" created="Wed, 4 Feb 2015 21:33:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24rm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>