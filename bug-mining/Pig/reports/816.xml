<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:54:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-2152] Null pointer exception while reporting progress</title>
                <link>https://issues.apache.org/jira/browse/PIG-2152</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;We have observed the following issues with code built from Pig 0.9 branch. We have not seen this with earlier versions; however, since this happens once in a while and is not reproducible at will it is not clear whether the issue is specific to 0.9 or not.&lt;/p&gt;

&lt;p&gt;Here is the stack:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.ProgressableReporter.progress(ProgressableReporter.java:37)&lt;br/&gt;
at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POForEach.processPlan(POForEach.java:399)&lt;br/&gt;
at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POForEach.getNext(POForEach.java:284)&lt;br/&gt;
at org.apache.pig.backend.hadoop.executionengine.physicalLayer.PhysicalOperator.processInput(PhysicalOperator.java:290)&lt;br/&gt;
at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POLocalRearrange.getNext(POLocalRearrange.java:256)&lt;br/&gt;
at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapBase.runPipeline(PigMapBase.java:261) at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapBase.map(PigMapBase.java:256) at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapBase.map(PigMapBase.java:58) at&lt;br/&gt;
org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:144) at&lt;br/&gt;
org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764) at&lt;br/&gt;
org.apache.hadoop.mapred.MapTask.run(MapTask.java:370) at org.apache.hadoop.mapred.Child$4.run(Child.java:261) at&lt;br/&gt;
java.security.AccessController.doPrivileged(Native Method) at javax.security.auth.Subject.doAs(Subject.java:396) at&lt;br/&gt;
org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1059) at&lt;br/&gt;
org.apache.hadoop.mapred.Child.main(Child.java:255) &lt;/p&gt;


&lt;p&gt;Note that the code in progress function looks as follows:&lt;/p&gt;

&lt;p&gt;public void progress() &lt;/p&gt;
{
        if(rep!=null)
            rep.progress();
    }

&lt;p&gt;This points to some sort of synchronization issue &lt;/p&gt;
</description>
                <environment></environment>
        <key id="12512499">PIG-2152</key>
            <summary>Null pointer exception while reporting progress</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thejas">Thejas Nair</assignee>
                                    <reporter username="olgan">Olga Natkovich</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Jul 2011 20:33:54 +0000</created>
                <updated>Wed, 5 Oct 2011 17:20:42 +0000</updated>
                            <resolved>Tue, 6 Sep 2011 18:03:01 +0000</resolved>
                                    <version>0.9.0</version>
                                    <fixVersion>0.9.1</fixVersion>
                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13061889" author="vivekp" created="Fri, 8 Jul 2011 10:51:15 +0000"  >&lt;p&gt;Attaching a list of different traces&lt;/p&gt;</comment>
                            <comment id="13061891" author="vivekp" created="Fri, 8 Jul 2011 10:56:43 +0000"  >&lt;p&gt;Even though not reproducible , the exception is happening randomly and quite frequently. &lt;br/&gt;
From most of the failed jobs it looks like this is happening towards end of the task execution. Till now, it is seen only in Map Tasks.&lt;br/&gt;
The below is one NullPointer from progess() with a different call heirachy;&lt;/p&gt;

&lt;p&gt;at&lt;br/&gt;
org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.ProgressableReporter.progress(ProgressableReporter.java:37)&lt;br/&gt;
        at org.apache.pig.data.DefaultAbstractBag.reportProgress(DefaultAbstractBag.java:369)&lt;br/&gt;
        at org.apache.pig.data.DefaultDataBag$DefaultDataBagIterator.next(DefaultDataBag.java:165)&lt;br/&gt;
        at org.apache.pig.data.DefaultDataBag$DefaultDataBagIterator.hasNext(DefaultDataBag.java:157)&lt;br/&gt;
        at org.apache.pig.data.BinInterSedes.writeBag(BinInterSedes.java:522)&lt;br/&gt;
        at org.apache.pig.data.BinInterSedes.writeDatum(BinInterSedes.java:361)&lt;br/&gt;
        at org.apache.pig.data.BinInterSedes.writeTuple(BinInterSedes.java:542)&lt;br/&gt;
        at org.apache.pig.data.BinInterSedes.writeDatum(BinInterSedes.java:357)&lt;br/&gt;
        at org.apache.pig.data.BinInterSedes.writeTuple(BinInterSedes.java:542)&lt;br/&gt;
        at org.apache.pig.data.BinInterSedes.writeDatum(BinInterSedes.java:357)&lt;br/&gt;
        at org.apache.pig.data.BinSedesTuple.write(BinSedesTuple.java:57)&lt;br/&gt;
        at org.apache.pig.impl.io.PigNullableWritable.write(PigNullableWritable.java:123)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.hadoop.io.serializer.WritableSerialization$WritableSerializer.serialize(WritableSerialization.java:90)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.hadoop.io.serializer.WritableSerialization$WritableSerializer.serialize(WritableSerialization.java:77)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask$MapOutputBuffer.collect(MapTask.java:1069)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask$NewOutputCollector.write(MapTask.java:691)&lt;br/&gt;
        at org.apache.hadoop.mapreduce.TaskInputOutputContext.write(TaskInputOutputContext.java:80)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapReduce$Map.collect(PigMapReduce.java:124)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapBase.runPipeline(PigMapBase.java:263)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapBase.map(PigMapBase.java:256)&lt;br/&gt;
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapBase.map(PigMapBase.java:58)&lt;br/&gt;
        at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:144)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)&lt;br/&gt;
        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:370)&lt;br/&gt;
        at org.apache.hadoop.mapred.Child$4.run(Child.java:261)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at javax.security.auth.Subject.doAs(Subject.java:396)&lt;br/&gt;
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1059)&lt;br/&gt;
        at org.apache.hadoop.mapred.Child.main(Child.java:255)&lt;/p&gt;</comment>
                            <comment id="13089226" author="jwills" created="Tue, 23 Aug 2011 02:27:41 +0000"  >&lt;p&gt;Hey, I hit this issue too, using CDH3u1. I&apos;m wondering if you&apos;re hitting it when a) you&apos;re running over lots of data and b) using combiners. It looks to me that the issue is the setRep(null) call in the cleanup() method in PigCombiner, which is impacting the Map tasks b/c PhysicalOperator only uses a single global PigReporter and the Map tasks and the Combiner tasks run in the same JVM.&lt;/p&gt;

&lt;p&gt;Could we reproduce this by messing with the settings to force spills more often than just once?&lt;/p&gt;
</comment>
                            <comment id="13089624" author="olgan" created="Tue, 23 Aug 2011 18:00:40 +0000"  >&lt;p&gt;Vivek has discovered the following:&lt;/p&gt;

&lt;p&gt;ProgressableReporter object is set to null in the combiner cleanup.&lt;/p&gt;

&lt;p&gt;protected void cleanup(Context context) throws IOException, InterruptedException &lt;/p&gt;
{
            super.cleanup(context);
            leaf = null;
            pack = null;
&amp;gt;            pigReporter.setRep(null);
            pigReporter = null;
            pigContext = null;
            roots = null;
            cp = null;
        }

&lt;p&gt;The same object (pigReporter) is retained and used by all PhysicalOperators&lt;br/&gt;
(PhysicalOperator.setReporter(pigReporter)&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
This may have caused for the NullPointerException. The above changes were introduced as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1815&quot; title=&quot;pig task retains used instances of PhysicalPlan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1815&quot;&gt;&lt;del&gt;PIG-1815&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="13089800" author="daijy" created="Tue, 23 Aug 2011 22:00:22 +0000"  >&lt;p&gt;Or we can make ProgressableReporter.progress synchronized.&lt;/p&gt;</comment>
                            <comment id="13089803" author="jwills" created="Tue, 23 Aug 2011 22:03:36 +0000"  >&lt;p&gt;I think that simply removing the line:&lt;/p&gt;

&lt;p&gt;pigReporter.setRep(null);&lt;/p&gt;

&lt;p&gt;is the best solution-- I don&apos;t see what purpose it was supposed to serve.&lt;/p&gt;</comment>
                            <comment id="13089852" author="thejas" created="Tue, 23 Aug 2011 23:04:45 +0000"  >&lt;p&gt;Vivek and Josh, thanks for tracing the issue. I have the change to fix this in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2152&quot; title=&quot;Null pointer exception while reporting progress&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2152&quot;&gt;&lt;del&gt;PIG-2152&lt;/del&gt;&lt;/a&gt;.1.patch, but I don&apos;t have the setup and query that I can use to verify the fix. It is not easy to test this in a unit test, so it does not have any.&lt;/p&gt;</comment>
                            <comment id="13090606" author="daijy" created="Wed, 24 Aug 2011 23:09:34 +0000"  >&lt;p&gt;+1 for patch. Can anyone give a try?&lt;/p&gt;</comment>
                            <comment id="13098215" author="daijy" created="Tue, 6 Sep 2011 17:47:57 +0000"  >&lt;p&gt;I would suggest to commit the patch as is.&lt;/p&gt;</comment>
                            <comment id="13098230" author="thejas" created="Tue, 6 Sep 2011 18:03:01 +0000"  >&lt;p&gt;Patch committed to 0.9 branch and trunk.&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12491402" name="PIG-2152.1.patch" size="603" author="thejas" created="Tue, 23 Aug 2011 23:04:45 +0000"/>
                            <attachment id="12485721" name="null_pointer_traces (copy)" size="262427" author="vivekp" created="Fri, 8 Jul 2011 10:51:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35760</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i09zq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56229</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>