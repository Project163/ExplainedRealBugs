<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-5231] PigStorage with -schema may produce inconsistent outputs with more fields</title>
                <link>https://issues.apache.org/jira/browse/PIG-5231</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;When multiple directories are passed to PigStorage(&apos;,&apos;,&apos;-schema&apos;), pig will &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;No attempt to merge conflicting schemas is made during loading. The first schema encountered during a file system scan is used.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;For two directories input with schema&lt;br/&gt;
file1: (f1:chararray, f2:int) and &lt;br/&gt;
file2: (f1:chararray, f2:int, f3:int) &lt;/p&gt;

&lt;p&gt;Pig will pick the first schema from file1 and only allow f1, f2 access. &lt;br/&gt;
However, output would still contain 3 fields for tuples from file2.  This later leads to complete corrupt outputs due to shifted fields resulting in incorrect references. &lt;br/&gt;
(This may also happen when input itself contains the delimiter.)&lt;/p&gt;

&lt;p&gt;If file2 schema is picked, this is already handled by filling the missing fields with null.  (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3100&quot; title=&quot;If a .pig_schema file is present, can get an index out of bounds error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3100&quot;&gt;&lt;del&gt;PIG-3100&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13069254">PIG-5231</key>
            <summary>PigStorage with -schema may produce inconsistent outputs with more fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 May 2017 19:24:50 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:29 +0000</updated>
                            <resolved>Thu, 25 May 2017 20:20:23 +0000</resolved>
                                                    <fixVersion>0.17.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15997374" author="knoguchi" created="Thu, 4 May 2017 20:19:37 +0000"  >&lt;p&gt;I understand that PigStorage is not designed for handling multiple schemas, but it would be nice if we can still handle this limited case where user simply added more fields leaving the rest of schema untouched.  &lt;/p&gt;

&lt;p&gt;In general, we ask our users to use AvroStorage or HcatLoader when they expect schema evolution(merging).&lt;/p&gt;

&lt;p&gt;A couple of approaches I can think of.&lt;br/&gt;
(1) Scan all schemas and fail if any are different&lt;br/&gt;
or&lt;br/&gt;
(2) Scan all schemas and pick the schema with longest &lt;br/&gt;
or &lt;br/&gt;
(3) Drop any fields not part of the schema&lt;/p&gt;

&lt;p&gt;Attaching a patch for approach (3).&lt;/p&gt;</comment>
                            <comment id="16025155" author="daijy" created="Thu, 25 May 2017 18:20:15 +0000"  >&lt;p&gt;Vote for 3. We pick the first schema in dirs in all LoadFunc, such as OrcStorage, AvroStorage. I don&apos;t think we shall make an exception for PigStorage. +1 for the patch.&lt;/p&gt;</comment>
                            <comment id="16025329" author="knoguchi" created="Thu, 25 May 2017 20:20:23 +0000"  >&lt;p&gt;Thanks for the review Daniel!   Committed it to trunk.&lt;/p&gt;

&lt;p&gt;Another option I was dreaming about would check all the schema files and dynamically create load statement for each unique schema, then add all of them with Union onschema. Have no idea if this is even feasible or not &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;For now, I think my quick fix is a good step forward since it fixes the issue with one common use case when PigStorage schema evolves by adding more fields.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12866487" name="pig-5231-v01.patch" size="2959" author="knoguchi" created="Thu, 4 May 2017 20:19:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3eib3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>