<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:57:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-2828] Handle nulls in DataType.compare</title>
                <link>https://issues.apache.org/jira/browse/PIG-2828</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;While using TOP, and if the DataBag contains null value to compare, it will generate the following exception:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.pig.data.DataType.compare(DataType.java:427)&lt;br/&gt;
	at org.apache.pig.builtin.TOP$TupleComparator.compare(TOP.java:97)&lt;br/&gt;
	at org.apache.pig.builtin.TOP$TupleComparator.compare(TOP.java:1)&lt;br/&gt;
	at java.util.PriorityQueue.siftUpUsingComparator(PriorityQueue.java:649)&lt;br/&gt;
	at java.util.PriorityQueue.siftUp(PriorityQueue.java:627)&lt;br/&gt;
	at java.util.PriorityQueue.offer(PriorityQueue.java:329)&lt;br/&gt;
	at java.util.PriorityQueue.add(PriorityQueue.java:306)&lt;br/&gt;
	at org.apache.pig.builtin.TOP.updateTop(TOP.java:141)&lt;br/&gt;
	at org.apache.pig.builtin.TOP.exec(TOP.java:116)&lt;/p&gt;


&lt;p&gt;code: (TOP.java, starts with line 91)&lt;br/&gt;
                Object field1 = o1.get(fieldNum);&lt;br/&gt;
                Object field2 = o2.get(fieldNum);&lt;br/&gt;
                if (!typeFound) &lt;/p&gt;
{
                    datatype = DataType.findType(field1);
                    typeFound = true;
                }
&lt;p&gt;                return DataType.compare(field1, field2, datatype, datatype);&lt;/p&gt;

&lt;p&gt;The reason is that if the typeFound is true , and the dataType is not null, and field1 is null, the script failed.&lt;br/&gt;
So we need to judge the field1 whether is null.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12599437">PIG-2828</key>
            <summary>Handle nulls in DataType.compare</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aniket486">Aniket Namadeo Mokashi</assignee>
                                    <reporter username="haitao.yao">Haitao Yao</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Jul 2012 10:03:16 +0000</created>
                <updated>Mon, 14 Oct 2013 16:46:30 +0000</updated>
                            <resolved>Tue, 4 Jun 2013 07:02:17 +0000</resolved>
                                                    <fixVersion>0.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13418195" author="haitao.yao" created="Thu, 19 Jul 2012 10:04:45 +0000"  >&lt;p&gt;here&apos;s my patch. &lt;/p&gt;</comment>
                            <comment id="13418870" author="haitao.yao" created="Fri, 20 Jul 2012 01:37:05 +0000"  >&lt;p&gt;I&apos;ve read the latest code from github, and the code is patched from the github master&lt;/p&gt;</comment>
                            <comment id="13481775" author="jcoveney" created="Mon, 22 Oct 2012 20:50:53 +0000"  >&lt;p&gt;It would be nice to add a unit test that isolates this case.&lt;/p&gt;</comment>
                            <comment id="13482074" author="haitao.yao" created="Tue, 23 Oct 2012 02:56:14 +0000"  >&lt;p&gt;unit test  for the DataType&lt;/p&gt;</comment>
                            <comment id="13672880" author="aniket486" created="Mon, 3 Jun 2013 07:59:10 +0000"  >&lt;p&gt;DataType compare api is little broken.&lt;br/&gt;
public static int compare(Object o1, Object o2) - uses reflection to infer datatypes of o1 and o2.&lt;br/&gt;
public static int compare(Object o1, Object o2, byte dt1, byte dt2) - doesn&apos;t use reflection, however callers of this api use reflection and also deal with NULLs. &lt;br/&gt;
Currently, callers of second API handle NULLs somewhat similarly but its not consistent. We can refactor the api to avoid reflection and handle NULLs consistently in a separate jira.&lt;br/&gt;
Right now, TOP that uses second api directly fails with NPE if o1 or o2 has null data. We should fix that with NULL &amp;lt; non-NULL semantics. &lt;/p&gt;</comment>
                            <comment id="13672896" author="julienledem" created="Mon, 3 Jun 2013 08:34:29 +0000"  >&lt;p&gt;Sounds good to me.&lt;/p&gt;</comment>
                            <comment id="13673318" author="aniket486" created="Mon, 3 Jun 2013 17:00:39 +0000"  >&lt;p&gt;I have created &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3343&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PIG-3343&lt;/a&gt; to track api refactor.&lt;/p&gt;</comment>
                            <comment id="13673377" author="cheolsoo" created="Mon, 3 Jun 2013 18:06:02 +0000"  >&lt;p&gt;+1 to &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2828&quot; title=&quot;Handle nulls in DataType.compare&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2828&quot;&gt;&lt;del&gt;PIG-2828&lt;/del&gt;&lt;/a&gt;.patch. Looks good to me.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aniket486&quot; class=&quot;user-hover&quot; rel=&quot;aniket486&quot;&gt;aniket486&lt;/a&gt;, can you please replace all the tabs with 4 spaces when committing your patch? Thanks!&lt;/p&gt;</comment>
                            <comment id="13674121" author="aniket486" created="Tue, 4 Jun 2013 07:00:32 +0000"  >&lt;p&gt;Committed to trunk. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;cheolsoo&lt;/a&gt; for the review.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12650685">PIG-3343</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12537156" name="DataType.patch" size="646" author="haitao.yao" created="Thu, 19 Jul 2012 10:04:45 +0000"/>
                            <attachment id="12585921" name="PIG-2828-format.patch" size="2290" author="aniket486" created="Mon, 3 Jun 2013 19:11:56 +0000"/>
                            <attachment id="12585808" name="PIG-2828.patch" size="2433" author="aniket486" created="Mon, 3 Jun 2013 08:04:51 +0000"/>
                            <attachment id="12550405" name="test.patch" size="978" author="haitao.yao" created="Tue, 23 Oct 2012 02:56:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250436</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 25 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ayhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61862</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>