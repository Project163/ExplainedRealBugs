<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4934] SET command does not work well with deprecated settings</title>
                <link>https://issues.apache.org/jira/browse/PIG-4934</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;For eg: If mapred.job.map.memory.mb was specified in the script using set command and mapreduce.map.memory.mb was present in mapred-site.xml, that takes effect.  This is because of the use of Properties and not Configuration.&lt;/p&gt;

&lt;p&gt;GruntParser.processSet() calls HExecutionEngine.setProperty which just updates pigContext.getProperties()&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setProperty(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; property, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value) {
        Properties properties = pigContext.getProperties();
        properties.put(property, value);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12982506">PIG-4934</key>
            <summary>SET command does not work well with deprecated settings</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="szita">&#193;d&#225;m Szita</assignee>
                                    <reporter username="rohini">Rohini Palaniswamy</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Jun 2016 23:06:20 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:21 +0000</updated>
                            <resolved>Thu, 27 Oct 2016 20:25:05 +0000</resolved>
                                                    <fixVersion>0.17.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15347402" author="rohini" created="Thu, 23 Jun 2016 23:13:08 +0000"  >&lt;p&gt;Fix would be to do &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setProperty(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; property, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value) {
        Properties properties = pigContext.getProperties();
        Configuration conf = ConfigurationUtil.toConfiguration(properties);
        conf.set(property, value);
        properties.clear();
        Iterator&amp;lt;Map.Entry&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;&amp;gt; iter = conf.iterator();
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (iter.hasNext()) {
            Map.Entry&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; entry = iter.next();
            properties.put(entry.getKey(), entry.getValue());
        }
        
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but that is a overkill when there are lot of set commands. Configuration.getAlternateNames() gives all possible deprecated and new keys and would be easy to check if the value if properties contains any of those names and overwrite or add it if none of the names are present. &lt;br/&gt;
Unfortunately it is a private method.  Wondering if I should access that method using reflection as it would be lot simpler in terms of processing. But it will be hacky as we are accessing a private method. Thoughts or any other ideas?&lt;/p&gt;</comment>
                            <comment id="15600263" author="szita" created="Sun, 23 Oct 2016 20:27:19 +0000"  >&lt;p&gt;We could create a util function for this that acts as getAlternateNames and returns an enriched set of properties from a single key-value pair. See &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12834854/12834854_PIG-4934.patch&quot; title=&quot;PIG-4934.patch attached to PIG-4934&quot;&gt;PIG-4934.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; as example (without error-handling and testing just yet)&lt;/p&gt;</comment>
                            <comment id="15602844" author="daijy" created="Mon, 24 Oct 2016 18:40:18 +0000"  >&lt;p&gt;For optimization, you can check isDeprecated before invoking costly expandForAlternativeNames.&lt;/p&gt;</comment>
                            <comment id="15605450" author="szita" created="Tue, 25 Oct 2016 14:22:46 +0000"  >&lt;p&gt;That&apos;d be a good idea, but we can&apos;t expect that only non-deprecated properties are set at the time when SET command comes in.&lt;br/&gt;
For example:&lt;br/&gt;
-we specify something using the old key: &lt;em&gt;mapred.job.map.memory.mb&lt;/em&gt;=1 in a config xml&lt;br/&gt;
-then we&apos;ll have &lt;em&gt;mapred.job.map.memory.mb&lt;/em&gt;=1 and &lt;b&gt;mapreduce.map.memory.mb&lt;/b&gt;=1 at startup already.&lt;br/&gt;
-if a user now uses the current name and gives: SET &lt;b&gt;mapreduce.map.memory.mb&lt;/b&gt; 2, we would only be setting the new name and leave the old one (&lt;em&gt;mapred.job.map.memory.mb&lt;/em&gt;=1) &lt;br/&gt;
... so I don&apos;t think we can use the isDeprecated() check unfortunately.&lt;/p&gt;

&lt;p&gt;Anyhow I&apos;ve uploaded a second revision including a test case: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12835124/12835124_PIG-4934.2.patch&quot; title=&quot;PIG-4934.2.patch attached to PIG-4934&quot;&gt;PIG-4934.2.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="15609905" author="daijy" created="Wed, 26 Oct 2016 22:38:24 +0000"  >&lt;p&gt;If you have both old and new key set to different value, engine will take the new key, why it matters?&lt;/p&gt;</comment>
                            <comment id="15612037" author="szita" created="Thu, 27 Oct 2016 14:23:17 +0000"  >&lt;p&gt;I see, in this case we can indeed do the optimization. Revised &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12835601/12835601_PIG-4934.3.patch&quot; title=&quot;PIG-4934.3.patch attached to PIG-4934&quot;&gt;PIG-4934.3.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="15613107" author="daijy" created="Thu, 27 Oct 2016 20:25:05 +0000"  >&lt;p&gt;+1. Patch committed to trunk. Thanks Adam!&lt;/p&gt;</comment>
                            <comment id="15615055" author="szita" created="Fri, 28 Oct 2016 10:32:44 +0000"  >&lt;p&gt;Thanks for the review, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12835124" name="PIG-4934.2.patch" size="3782" author="szita" created="Tue, 25 Oct 2016 14:21:34 +0000"/>
                            <attachment id="12835601" name="PIG-4934.3.patch" size="3987" author="szita" created="Thu, 27 Oct 2016 14:19:02 +0000"/>
                            <attachment id="12834854" name="PIG-4934.patch" size="1527" author="szita" created="Sun, 23 Oct 2016 20:20:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3004f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>