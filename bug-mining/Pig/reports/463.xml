<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:51:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-1492] DefaultTuple and DefaultMemory understimate their memory footprint</title>
                <link>https://issues.apache.org/jira/browse/PIG-1492</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;There are several places where we highly underestimate the memory footprint . For example, for map datatypes, we don&apos;t account for the per entry cost for the map container data structures. The estimated size of a tuple having map with 100 integer key-value entries , as per current version of code is 3260 bytes, while what is observed is around 6775 bytes .  To verify the memory footprint, i checked free memory before and after creating multiple instances of the object , using code on the lines of &lt;a href=&quot;http://www.javaspecialists.eu/archive/Issue029.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.javaspecialists.eu/archive/Issue029.html&lt;/a&gt; . &lt;/p&gt;

&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-1443&quot; title=&quot;DefaultTuple underestimate the memory footprint for string&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-1443&quot;&gt;&lt;del&gt;PIG-1443&lt;/del&gt;&lt;/a&gt; similar change was done to fix this for CHARARRAY .&lt;/p&gt;</description>
                <environment></environment>
        <key id="12468965">PIG-1492</key>
            <summary>DefaultTuple and DefaultMemory understimate their memory footprint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thejas">Thejas Nair</assignee>
                                    <reporter username="thejas">Thejas Nair</reporter>
                        <labels>
                    </labels>
                <created>Sat, 10 Jul 2010 01:39:42 +0000</created>
                <updated>Fri, 17 Dec 2010 22:44:46 +0000</updated>
                            <resolved>Wed, 21 Jul 2010 18:30:42 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12888683" author="thejas" created="Thu, 15 Jul 2010 03:12:31 +0000"  >&lt;p&gt;This patch updates the memory size calculations . This changes were made so that the estimated sizes are closer to what is seen in 32 bit Java HotSpot(TM) Server VM (build 10.0-b19, mixed mode). &lt;/p&gt;

&lt;p&gt;It is based on some of the observations in &lt;a href=&quot;http://www.javamex.com/tutorials/memory/string_memory_usage.shtm&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.javamex.com/tutorials/memory/string_memory_usage.shtm&lt;/a&gt; .  The header sizes of objects has been taken to be 8 bytes. The objects size is rounded to multiple of 8 bytes. Some other adjustments for minimum size of array in a ArrayList were made based on observed size values.&lt;/p&gt;

&lt;p&gt;The follow tables shows the tuple estimated sizes before/after the patch and what is actually observed, for the types whose calculation logic changed -&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; type &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; num of columns of this type in the tuple &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; before &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; patched &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; observed &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; BYTEARRAY with 5 bytes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 10&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;254 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 504&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;495 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; BYTEARRAY with 5 bytes&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1000&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 21044&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 44064&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;44127 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; DOUBLE&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 10&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;364 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 264&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;255 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; DOUBLE&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1000&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;32044 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 20064&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 20127 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; LONG &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;10 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 284&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;264 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;255 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; LONG &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1000 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 24044 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 20064 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 20127 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;





&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Tuple containing a single - &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; patched &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; observed &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  BAG with 10 empty tuples&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;524&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1092&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1159 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  BAG with 1000 empty tuples&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 48044&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 100092&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 100211&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  map with 10 integer key-value pairs&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 380&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 824&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 775&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  map with 1000 integer key-value pairs&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 32060&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 64184&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 64346&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="12888905" author="daijy" created="Thu, 15 Jul 2010 20:20:32 +0000"  >&lt;p&gt;Talked with Tejas, he get more observations than listed above. So I believe the formula should be good. +1 for commit once hudson pass.&lt;/p&gt;</comment>
                            <comment id="12888952" author="hadoopqa" created="Thu, 15 Jul 2010 23:32:13 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12449531/PIG-1492.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12449531/PIG-1492.1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 964182.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    -1 contrib tests.  The patch failed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/370/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/370/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/370/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/370/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/370/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Pig-Patch-h7.grid.sp2.yahoo.net/370/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12890792" author="thejas" created="Wed, 21 Jul 2010 17:47:15 +0000"  >&lt;p&gt;Committed to trunk.&lt;br/&gt;
The contrib tests pass in my machine. The errors in hudson run seem to be caused by some environment specific issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12449531" name="PIG-1492.1.patch" size="10788" author="thejas" created="Thu, 15 Jul 2010 03:12:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164977</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gwh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96691</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>