<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:48:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-176] pig creates many small files when it spills</title>
                <link>https://issues.apache.org/jira/browse/PIG-176</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Currently, on spill pig can generate millions of small (under 128K) files. Partially this is due to &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-170&quot; title=&quot;Memory manager spills bags in the wrong order&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-170&quot;&gt;&lt;del&gt;PIG-170&lt;/del&gt;&lt;/a&gt; but even with that patch, you can still try and spill small bags.&lt;/p&gt;

&lt;p&gt;The proposal is to not spill small files. Alan told me that the logic is already there but we just need to bump the size limit.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12392793">PIG-176</key>
            <summary>pig creates many small files when it spills</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gates">Alan Gates</assignee>
                                    <reporter username="olgan">Olga Natkovich</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Apr 2008 00:38:20 +0000</created>
                <updated>Wed, 24 Mar 2010 22:01:23 +0000</updated>
                            <resolved>Fri, 2 May 2008 20:55:00 +0000</resolved>
                                                    <fixVersion>0.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12585069" author="pi_song" created="Thu, 3 Apr 2008 11:59:04 +0000"  >&lt;p&gt;So let&apos;s say if the size is smaller than something, don&apos;t spill right? This is very easy to fix but we will be able to reclaim a bit less memory than before therefore causing some tasks to fail more often in exchange for some tasks running faster. Is this acceptable?&lt;/p&gt;

&lt;p&gt;Probably the best way to go is to make it configurable but Pig-111 isn&apos;t in yet. Sighhh..... I want to have more time.&lt;/p&gt;</comment>
                            <comment id="12585163" author="olgan" created="Thu, 3 Apr 2008 16:08:50 +0000"  >&lt;p&gt;Pi,&lt;/p&gt;

&lt;p&gt;Running faster is part of it. The other part is not to fill up disks with tiny files which causes disk frgamentation and also takes forever to cleanup at the end of processing though you suggestion of cleaning as we go might help that a bit.&lt;/p&gt;</comment>
                            <comment id="12586385" author="pi_song" created="Mon, 7 Apr 2008 13:32:00 +0000"  >&lt;p&gt;Based on the fact that now we spill big bags first, my observation is that there are still cases where a big container bag is spilled and therefore its mContent becomes empty but most of its inner bags&apos; WeakReferences aren&apos;t clean-up by GC yet. In such cases, if we haven&apos;t freed up enough memory, those inner bags will be unnecessarily spilled (however all their contents were already spilled in the big bag spill). Possibly that are 2 simple ways to solve this:- &lt;/p&gt;

&lt;p&gt;1) In SpillableMemoryManager, we try putting Thread.yield() in between each spill. This should allow some more time for GC to do more clean-up without degrading performance too much. However, if the main execution thread doesn&apos;t produce any bag (e.g. a map task where all keys and values are tuples and atomic data), this will give more time to the main execution thread to use up more memory more quickly.&lt;/p&gt;

&lt;p&gt;2) Check the size of the current spillable being spilled. If it is larger than constant X, do a System.GC(). This is safer than (1) but due to the fact that we explicitly call GC more often, it may have some impact on performance. However, by considering the fact that spilling small files is much slower than doing System.GC(), this approach should then generally give a better performance.&lt;/p&gt;

&lt;p&gt;I don&apos;t really have a processing task that incurs spilling that much. Can anyone please try (2) out?&lt;/p&gt;</comment>
                            <comment id="12587215" author="pi_song" created="Wed, 9 Apr 2008 14:29:37 +0000"  >&lt;p&gt;This patch implements (1) Spill file size threshold  (2)My idea in the last comment&lt;/p&gt;

&lt;p&gt;&quot;spill.size.threshold&quot; and &quot;spill.gc.activation.size&quot; are to be set as JVM parameters or .pigrc in order to use this new feature. Default values are 0 and Long.MAX_VALUE respectively.&lt;/p&gt;

&lt;p&gt;There is a bit of problem in (1) that Bag.getMemorySize() sometimes doesn&apos;t return accurate value so even the threshold is set, it&apos;s still possible that files smaller than the threshold are created.&lt;/p&gt;

&lt;p&gt;The configuration code is still messy in MapReduceLauncher. This needs a clean-up after the configuration patch gets in.&lt;/p&gt;</comment>
                            <comment id="12590074" author="alangates" created="Thu, 17 Apr 2008 15:47:57 +0000"  >&lt;p&gt;Pi,&lt;/p&gt;

&lt;p&gt;Did you want to rework this patch now since &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-111&quot; title=&quot;Configuration of Pig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-111&quot;&gt;&lt;del&gt;PIG-111&lt;/del&gt;&lt;/a&gt; is in and you can read the properties from pig&apos;s Properties object rather than System.getProperties()?&lt;/p&gt;</comment>
                            <comment id="12590238" author="pi_song" created="Thu, 17 Apr 2008 23:10:24 +0000"  >&lt;p&gt;OK, will do that.&lt;/p&gt;</comment>
                            <comment id="12590467" author="pi_song" created="Fri, 18 Apr 2008 14:28:28 +0000"  >&lt;p&gt;Updated with the latest trunk + make use of the new configuration structure&lt;/p&gt;</comment>
                            <comment id="12593882" author="alangates" created="Fri, 2 May 2008 20:55:00 +0000"  >&lt;p&gt;Patch checked in at revision 652906.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12380505" name="pig176_v2.patch" size="8917" author="pi_song" created="Fri, 18 Apr 2008 14:28:28 +0000"/>
                            <attachment id="12379732" name="pig_176_smallbags_v1.patch" size="6068" author="pi_song" created="Wed, 9 Apr 2008 14:29:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163830</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gh1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94190</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>