<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4897] Scope of param substitution for run/exec commands</title>
                <link>https://issues.apache.org/jira/browse/PIG-4897</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3359&quot; title=&quot;Register Statements and Param Substitution in Macros&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3359&quot;&gt;&lt;del&gt;PIG-3359&lt;/del&gt;&lt;/a&gt;, pig param substitution became global in that parameter declared in the pig script called from &lt;tt&gt;run&lt;/tt&gt; or &lt;tt&gt;exec&lt;/tt&gt; would live after that script finishes.  &lt;/p&gt;

&lt;p&gt;This created an interesting situation.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test1.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;exec -param output=/tmp/deleteme111 test1_1.pig
exec -param output=/tmp/deleteme222 test1_1.pig
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test1_1.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;%&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; myout &lt;span class=&quot;code-quote&quot;&gt;&apos;$output.out&apos;&lt;/span&gt;;
A = load &lt;span class=&quot;code-quote&quot;&gt;&apos;input.txt&apos;&lt;/span&gt; as (a0:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
store A into &lt;span class=&quot;code-quote&quot;&gt;&apos;$myout&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running &lt;tt&gt;test1.pig&lt;/tt&gt; would try to run two jobs that both tries to write to /tmp/deleteme111 and fail.  (Second param output=/tmp/deleteme222 is ignored.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12970170">PIG-4897</key>
            <summary>Scope of param substitution for run/exec commands</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 May 2016 22:09:16 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:26 +0000</updated>
                            <resolved>Tue, 10 Jan 2017 21:15:50 +0000</resolved>
                                                    <fixVersion>0.17.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15289823" author="knoguchi" created="Wed, 18 May 2016 21:06:45 +0000"  >&lt;p&gt;A better example.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test10.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;exec HADOOPPF-12103/test10_1.pig
exec HADOOPPF-12103/test10_2.pig
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test10_1.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;%&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; output &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/deleteme111&apos;&lt;/span&gt;;
A = load &lt;span class=&quot;code-quote&quot;&gt;&apos;input.txt&apos;&lt;/span&gt; as (a0:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
store A into &lt;span class=&quot;code-quote&quot;&gt;&apos;$output&apos;&lt;/span&gt;; --writes to /tmp/deleteme111
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test10_2.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;%&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; output &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/deleteme222&apos;&lt;/span&gt;;
A = load &lt;span class=&quot;code-quote&quot;&gt;&apos;input.txt&apos;&lt;/span&gt; as (a0:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
store A into &lt;span class=&quot;code-quote&quot;&gt;&apos;$output&apos;&lt;/span&gt;; --&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; tries to write to /tmp/deleteme111 unexpectedly.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15289957" author="knoguchi" created="Wed, 18 May 2016 22:10:04 +0000"  >&lt;p&gt;Attaching a patch that reverts part of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3359&quot; title=&quot;Register Statements and Param Substitution in Macros&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3359&quot;&gt;&lt;del&gt;PIG-3359&lt;/del&gt;&lt;/a&gt; and make &apos;run/exec command&apos; NOT to share the param substitution variables outside.&lt;/p&gt;

&lt;p&gt;This would be considered a &quot;Incompatible change&quot; if any users were depending on this param sharing among run/exec-ed scripts.&lt;/p&gt;

&lt;p&gt;I&apos;ll add a testcase tomorrow but I&apos;m still not sure if this is a right approach.&lt;/p&gt;</comment>
                            <comment id="15294220" author="knoguchi" created="Fri, 20 May 2016 21:15:29 +0000"  >&lt;p&gt;Attaching &lt;tt&gt;pig-4897-v02.patch&lt;/tt&gt; with a test case.&lt;/p&gt;</comment>
                            <comment id="15296879" author="knoguchi" created="Mon, 23 May 2016 18:56:26 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;Two jobs should have run.&quot;&lt;/span&gt;, 2, stats.getNumberJobs());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This was clearly wrong for local-tez mode since it only run one job. &lt;br/&gt;
Took out the line since we already have necessary check for making sure we have two unique outputs. &lt;/p&gt;</comment>
                            <comment id="15297135" author="knoguchi" created="Mon, 23 May 2016 21:34:49 +0000"  >&lt;p&gt;Setting &quot;incompatible change&quot; flag.  &lt;br/&gt;
Please let me know your thought.&lt;/p&gt;

&lt;p&gt;If we have any users started using &apos;run/exec&apos; for setting some params after &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3359&quot; title=&quot;Register Statements and Param Substitution in Macros&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3359&quot;&gt;&lt;del&gt;PIG-3359&lt;/del&gt;&lt;/a&gt;, this patch will break it.&lt;/p&gt;

&lt;p&gt;For example, &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;run setparams.pig
A = load &lt;span class=&quot;code-quote&quot;&gt;&apos;${useparamfrompreviousrun}&apos;&lt;/span&gt; using PigStorage(); 
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15300847" author="knoguchi" created="Wed, 25 May 2016 21:04:21 +0000"  >&lt;p&gt;Rohini brought up another (more valid) case that would break with my patch.&lt;/p&gt;

&lt;p&gt;This works.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;knoguchi &amp;gt; pig -param output=/tmp/deleteme test12-1.pig
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test12-1.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;test12-2.macro&apos;&lt;/span&gt;;
A = load &lt;span class=&quot;code-quote&quot;&gt;&apos;input.txt&apos;&lt;/span&gt;;
mymacro(A);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test12-2.macro&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;DEFINE mymacro (A) RETURNS void {
store A into &lt;span class=&quot;code-quote&quot;&gt;&apos;$output&apos;&lt;/span&gt;;
};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But calling the above pig script with run/exec would now break even though it is still passing output param.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;knoguchi &amp;gt; pig test12.pig
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test12.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;run -param output=/tmp/deleteme111 test12-1.pig
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&quot;Macro inline failed for macro &apos;mymacro&apos;. Reason: Undefined parameter : output&quot;&lt;/p&gt;

&lt;p&gt;This is happening since only the param set at the root script (test12.pig) is propagated to the macro with my patch.&lt;/p&gt;

&lt;p&gt;One approach I can think of to satisfy this test case as well as my &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4897?focusedCommentId=15289823#comment-15289823&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;previous case&lt;/a&gt; would be to introduce a &quot;scope&quot; so that param is propagated to called script but then dropped when the corresponding script exits.&lt;/p&gt;

&lt;p&gt;But that would still leave &apos;exec setparams.pig&apos; like usage.  Do we need to support this usecase? &lt;/p&gt;</comment>
                            <comment id="15336500" author="rohini" created="Fri, 17 Jun 2016 17:19:47 +0000"  >&lt;p&gt;Makes sense to have scope for run/exec. Anything defined in the main script is always applicable, but those introduced in the run/exec scripts are scoped and only apply or override the main settings during its execution.&lt;/p&gt;</comment>
                            <comment id="15342470" author="knoguchi" created="Tue, 21 Jun 2016 19:03:14 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Makes sense to have scope for run/exec. Anything defined in the main script is always applicable, but those introduced in the run/exec scripts are scoped and only apply or override the main settings during its execution.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks Rohini.  Attaching &lt;tt&gt;pig-4897-v04.patch&lt;/tt&gt; that would add the scope for run/exec calls.&lt;br/&gt;
Now the patch matches with what the description says, &quot;Scope of param substitution for run/exec commands&quot;.&lt;/p&gt;

&lt;p&gt;In addition to this scope change, I also took out one public constructor which seemed not used anywhere.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; PreprocessorContext(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; paramVal)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15375970" author="rohini" created="Wed, 13 Jul 2016 23:11:41 +0000"  >&lt;p&gt;Few minor comments&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;We would always want to deleteOnExit. So not sure if that needs to be a method argument&lt;/li&gt;
	&lt;li&gt;Can we have one testcase with run -param output=xxx which will override the %default output value in the script?&lt;/li&gt;
	&lt;li&gt;Can we have one testcase for the macro case?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15399710" author="knoguchi" created="Fri, 29 Jul 2016 17:18:55 +0000"  >&lt;blockquote&gt;
&lt;ul&gt;
	&lt;li&gt;We would always want to deleteOnExit. So not sure if that needs to be a method argument&lt;/li&gt;
	&lt;li&gt;Can we have one testcase with run -param output=xxx which will override the %default output value in the script?&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;Attaching a new patch that does the above.  (pig-4897-v05.patch)&lt;br/&gt;
However, &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can we have one testcase for the macro case?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This turns out to be a major feedback.&lt;/p&gt;

&lt;p&gt;After writing a test for this, realized that PigMacro has almost nothing to do with the changes I&apos;m making here. &lt;br/&gt;
General param saving and substitution happens from PigScriptParser.jj but Macro expansion is done through QueryParser.g.  I&apos;ve seen it mentioned elsewhere but never hit me how this would affect my patch here.&lt;/p&gt;

&lt;p&gt;I wish we didn&apos;t enable &quot; global param substitutions in macros.&quot; in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3359&quot; title=&quot;Register Statements and Param Substitution in Macros&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3359&quot;&gt;&lt;del&gt;PIG-3359&lt;/del&gt;&lt;/a&gt;.  It&apos;s pretty confusing even without this jira.&lt;/p&gt;

&lt;p&gt;For example, &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;example1.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;DEFINE mymacro (A) RETURNS void {
  store $A into &lt;span class=&quot;code-quote&quot;&gt;&apos;${output}&apos;&lt;/span&gt;;
}

A = load &lt;span class=&quot;code-quote&quot;&gt;&apos;input.txt&apos;&lt;/span&gt;
%declare output &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/abc&apos;&lt;/span&gt;;
mymacro(A);
%declare output &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/def&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;would save the output to /tmp/def.  &lt;br/&gt;
Irrespective of where the macro is defined or called, it&apos;ll use the values defined after all the scripts are read.&lt;/p&gt;</comment>
                            <comment id="15399728" author="knoguchi" created="Fri, 29 Jul 2016 17:32:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt; can correct me if I&apos;m mistaken, but to correct the PigMacro behavior, we probably need &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2597&quot; title=&quot;Move grunt from javacc to ANTLR&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2597&quot;&gt;PIG-2597&lt;/a&gt; where we want to move out of javacc (PigScriptParser.jj) to ANTLR(QueryParser.g). &lt;/p&gt;

&lt;p&gt;And coming back to non-macro, general param substitution issue with run/exec command, we have three options so far.&lt;/p&gt;

&lt;p&gt;(1) All global.  (current behavior since 0.12 from &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3359&quot; title=&quot;Register Statements and Param Substitution in Macros&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3359&quot;&gt;&lt;del&gt;PIG-3359&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
(2) All private.  (pig-4897-v03.patch).  Only way to transfer params from one script to another would be to pass it through commandline params.   run/exec -param k=v abc.pig &lt;br/&gt;
(3) Scoped. (pig-4897-v04/05.patch).   &lt;/p&gt;

&lt;p&gt;I don&apos;t like (1) given the example I&apos;ve shown in the description and the &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4897?focusedCommentId=15289823#comment-15289823&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;first comment&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I like (2) the best with no sharing but I&apos;m afraid it may break too many scripts that started to depend on (1) behavior.  &lt;br/&gt;
(I don&apos;t know how many)&lt;/p&gt;

&lt;p&gt;(3) is a compromise and hopefully won&apos;t break too many scripts who depend on (1) behavior but still fixes the two example cases from this jira.&lt;/p&gt;

&lt;p&gt;As for fixing the PigMacro, I prefer to create a new jira and revisit once we have &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2597&quot; title=&quot;Move grunt from javacc to ANTLR&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2597&quot;&gt;PIG-2597&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15410510" author="daijy" created="Sat, 6 Aug 2016 06:15:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;can correct me if I&apos;m mistaken, but to correct the PigMacro behavior, we probably need &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2597&quot; title=&quot;Move grunt from javacc to ANTLR&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2597&quot;&gt;PIG-2597&lt;/a&gt; where we want to move out of javacc (PigScriptParser.jj) to ANTLR(QueryParser.g)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, make macro use all commands/statements is one of the major goal of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2597&quot; title=&quot;Move grunt from javacc to ANTLR&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2597&quot;&gt;PIG-2597&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15468798" author="rohini" created="Tue, 6 Sep 2016 22:19:25 +0000"  >&lt;p&gt;I think we should only scope for exec and not run. For run we should overwrite the passed parameter as declare inside run should be available outside it as per definition from Pig book. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;exec [-param param_name = param_value] [-param_file filename] [script] Execute the Pig Latin script script. Aliases defined in script are not imported into Grunt. This command is useful &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; testing your Pig Latin scripts &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; inside a Grunt session. You can also run exec without paramter to only run the Pig statements before exec. The difference is Pig will not combine them with the &lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt; of the script in execution.
run [-param param_name = param_value] [-param_file filename] script Execute the Pig Latin script script in the current Grunt shell. Thus all aliases referenced in script are available to Grunt, and the commands in script are accessible via the shell history. This is another option &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; testing Pig Latin scripts &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; inside a Grunt session.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15470745" author="knoguchi" created="Wed, 7 Sep 2016 14:11:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think we should only scope for exec and not run. For run we should overwrite the passed parameter as declare inside run should be available outside it as per definition from Pig book.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Definition only talks about &quot;aliases referenced in script&quot; but not on params or macros.&lt;/p&gt;

&lt;p&gt;Also, it&apos;s not black and white in that, what would you do when we have both.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;script1.pig 
      -&amp;gt; exec script2.pig 
               -&amp;gt; run script3.pig 
                         -&amp;gt; exec script4.pig
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Params defined inside script3.pig would be visible to script2.pig but not to script1.pig ? Or should it be global and script1.pig should be able to see it?&lt;/p&gt;</comment>
                            <comment id="15474922" author="rohini" created="Thu, 8 Sep 2016 20:36:47 +0000"  >&lt;p&gt;Makes sense. We can just go with the current patch which keeps things simple and clear. testScopeOfParamWithNestedRunCommand is in v04 patch but missing in v05 though. Can you also create a new jira for the macro case and update the comment for the testScopeOfParamWithMacro with that jira number.&lt;/p&gt;</comment>
                            <comment id="15474991" author="knoguchi" created="Thu, 8 Sep 2016 21:01:03 +0000"  >&lt;p&gt;Thanks Rohini!  I&apos;ll create a new jira for the macro and patch shortly. &lt;/p&gt;

&lt;p&gt;But given this is an incompatible change if we have user depending on the global param behavior, can I have one more +1?  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;, appreciate if you could take a brief look.  (Not for the patch itself but for the idea of making the parameters scoped for exec&amp;amp;run.)&lt;/p&gt;</comment>
                            <comment id="15475085" author="rohini" created="Thu, 8 Sep 2016 21:32:02 +0000"  >&lt;p&gt;Sure. I don&apos;t see it as a incompatible change though &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. See it as a bug introduced in Pig 0.12 as it broke old scripts and doing something no user would expect. &lt;/p&gt;</comment>
                            <comment id="15478180" author="knoguchi" created="Fri, 9 Sep 2016 20:36:22 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Makes sense. We can just go with the current patch which keeps things simple and clear. testScopeOfParamWithNestedRunCommand is in v04 patch but missing in v05 though. Can you also create a new jira for the macro case and update the comment for the testScopeOfParamWithMacro with that jira number.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks Rohini.&lt;br/&gt;
Added back testScopeOfParamWithNestedRunCommand, created &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-5028&quot; title=&quot;Param expansion in macro is confusing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-5028&quot;&gt;PIG-5028&lt;/a&gt; for tracking the macro issue and updated the comment in testScopeOfParamWithMacro.&lt;/p&gt;</comment>
                            <comment id="15478483" author="rohini" created="Fri, 9 Sep 2016 22:36:29 +0000"  >&lt;p&gt;Just realized that the testCommandLineParamOverwritingDefault is not what I intended. It calls PigRunner.run with -param output=&amp;lt;path&amp;gt;. What I wanted was a mainscript.pig that had &quot;run runscript1.pig -param output=&amp;lt;path&amp;gt;&quot; similar to testScopeOfParamWithRunCommand. Could you just update that test with a additional run command which takes a parameter as below and asserts for it?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; +        File mainscript = Util.createFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;mainscript.pig&quot;&lt;/span&gt;,                 
  +                  &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] { &lt;span class=&quot;code-quote&quot;&gt;&quot;run &quot;&lt;/span&gt; + script1.getAbsolutePath() + &lt;span class=&quot;code-quote&quot;&gt;&quot;;&quot;&lt;/span&gt;,  
  +                                 &lt;span class=&quot;code-quote&quot;&gt;&quot;run &quot;&lt;/span&gt; + script2.getAbsolutePath() + &lt;span class=&quot;code-quote&quot;&gt;&quot;;&quot;&lt;/span&gt; 
 +                                 &lt;span class=&quot;code-quote&quot;&gt;&quot;run &quot;&lt;/span&gt; + script1.getAbsolutePath() + -param output output3.getAbsolutePath()&lt;span class=&quot;code-quote&quot;&gt;&quot;;&quot;&lt;/span&gt; 
});
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="15484756" author="knoguchi" created="Mon, 12 Sep 2016 17:45:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;Just realized that the testCommandLineParamOverwritingDefault is not what I intended.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry, misunderstood your initial comment of &lt;br/&gt;
  &quot;Can we have one testcase with run -param output=xxx which will override the %default output value in the script?&quot;&lt;br/&gt;
as to, we should be testing &apos;-param&apos; in general. &lt;/p&gt;

&lt;p&gt;Leaving that test case but also updated &lt;tt&gt;testScopeOfParamWithNestedRunCommand&lt;/tt&gt; with run -param call for script2.pig so that your case is covered.&lt;/p&gt;</comment>
                            <comment id="15488169" author="knoguchi" created="Tue, 13 Sep 2016 19:32:20 +0000"  >&lt;p&gt;Rohini wanted one specific test with run+param overwriting &apos;%default&apos;.  Added &lt;tt&gt;testRunWithParamOverwritingDefault&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15488253" author="rohini" created="Tue, 13 Sep 2016 20:02:29 +0000"  >&lt;p&gt;+1. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;, can you review once?&lt;/p&gt;</comment>
                            <comment id="15492656" author="daijy" created="Thu, 15 Sep 2016 07:37:52 +0000"  >&lt;p&gt;+1, the new behavior is more useful. We shall also document it.&lt;/p&gt;</comment>
                            <comment id="15496788" author="rohini" created="Fri, 16 Sep 2016 16:47:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;We shall also document it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;  Thanks for reminding. We missed that in the patch.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knoguchi&quot; class=&quot;user-hover&quot; rel=&quot;knoguchi&quot;&gt;knoguchi&lt;/a&gt;,&lt;br/&gt;
   There are some test failures with TestMacroExpansion. Can you look into them? &lt;/p&gt;</comment>
                            <comment id="15533403" author="knoguchi" created="Thu, 29 Sep 2016 17:24:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;We shall also document it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Added. Please check my English to see if it makes sense.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There are some test failures with TestMacroExpansion. Can you look into them?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Worked around the issue by skipping scoping when the &apos;loadscript&apos; method is called outside of run/exec.&lt;/p&gt;

&lt;p&gt;But more I look, I cannot wait to drop javacc in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2597&quot; title=&quot;Move grunt from javacc to ANTLR&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2597&quot;&gt;PIG-2597&lt;/a&gt;...&lt;/p&gt;</comment>
                            <comment id="15543299" author="daijy" created="Mon, 3 Oct 2016 20:14:36 +0000"  >&lt;p&gt;+1 for doc addition.&lt;/p&gt;</comment>
                            <comment id="15743537" author="rohini" created="Mon, 12 Dec 2016 23:40:19 +0000"  >&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="15816216" author="knoguchi" created="Tue, 10 Jan 2017 21:15:50 +0000"  >&lt;p&gt;Thanks for the review Rohini, Daniel!&lt;/p&gt;

&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13003963">PIG-5028</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12654011">PIG-3359</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12804804" name="pig-4897-v01-notestyet.patch" size="2790" author="knoguchi" created="Wed, 18 May 2016 22:10:04 +0000"/>
                            <attachment id="12805307" name="pig-4897-v02.patch" size="7123" author="knoguchi" created="Fri, 20 May 2016 21:15:29 +0000"/>
                            <attachment id="12805716" name="pig-4897-v03.patch" size="7045" author="knoguchi" created="Mon, 23 May 2016 18:56:26 +0000"/>
                            <attachment id="12812272" name="pig-4897-v04.patch" size="14671" author="knoguchi" created="Tue, 21 Jun 2016 19:03:14 +0000"/>
                            <attachment id="12821027" name="pig-4897-v05.patch" size="15098" author="knoguchi" created="Fri, 29 Jul 2016 17:18:55 +0000"/>
                            <attachment id="12827826" name="pig-4897-v06.patch" size="17994" author="knoguchi" created="Fri, 9 Sep 2016 20:36:22 +0000"/>
                            <attachment id="12828078" name="pig-4897-v07.patch" size="17961" author="knoguchi" created="Mon, 12 Sep 2016 17:45:03 +0000"/>
                            <attachment id="12828317" name="pig-4897-v08.patch" size="19635" author="knoguchi" created="Tue, 13 Sep 2016 19:32:20 +0000"/>
                            <attachment id="12830931" name="pig-4897-v09.patch" size="22007" author="knoguchi" created="Thu, 29 Sep 2016 17:24:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 45 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2y1mf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>With run/exec command, parameters are now scoped and caller would not see the parameters declared within the callee&amp;#39;s scripts.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>