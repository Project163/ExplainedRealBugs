<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:48:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-306] count with multiple group by keys fails</title>
                <link>https://issues.apache.org/jira/browse/PIG-306</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The query:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;myfile&apos;&lt;/span&gt; as (name, age, gpa);                                                                        
b = group a by (name, age);                                                                                                                                     
c = foreach b generate group.name, group.age, COUNT(a.gpa);                                                                                                     
store c into &lt;span class=&quot;code-quote&quot;&gt;&apos;outfile&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;generates&lt;/p&gt;

&lt;p&gt;07-12 16:55:54,348 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; ERROR org.apache.pig.impl.mapReduceLayer.Launcher - Error message from task (reduce) tip_200807090821_0580_r_000000 java.lang.ClassCastException: org.apache.pig.data.DataByteArray cannot be cast to org.apache.pig.data.Tuple&lt;br/&gt;
at org.apache.pig.impl.physicalLayer.expressionOperators.POProject.getNext(POProject.java:262)&lt;br/&gt;
at org.apache.pig.impl.physicalLayer.relationalOperators.POForEach.processPlan(POForEach.java:189)&lt;br/&gt;
at org.apache.pig.impl.physicalLayer.relationalOperators.POForEach.getNext(POForEach.java:148)&lt;br/&gt;
at org.apache.pig.impl.mapReduceLayer.PigMapReduce$Reduce.reduce(PigMapReduce.java:164)&lt;br/&gt;
at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:333)&lt;br/&gt;
at org.apache.hadoop.mapred.TaskTracker$Child.main(TaskTracker.java:2071)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12400250">PIG-306</key>
            <summary>count with multiple group by keys fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sms">Santhosh Muthur Srinivasan</assignee>
                                    <reporter username="gates">Alan Gates</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Jul 2008 21:21:06 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:03 +0000</updated>
                            <resolved>Wed, 23 Jul 2008 10:43:33 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12614805" author="alangates" created="Fri, 18 Jul 2008 17:23:57 +0000"  >&lt;p&gt;The issue is that the type of one of the projects is not being set correctly.  The logical plan for this query looks like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Logical Plan:
ForEach gates-Fri Jul 18 10:11:47 PDT 2008-12 Schema: {name: (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;),age: (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;),&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;} Type: bag
|   |
|   Project gates-Fri Jul 18 10:11:47 PDT 2008-5 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: name: tuple Type: tuple
|   Input: Project gates-Fri Jul 18 10:11:47 PDT 2008-4 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;|
|   |---Project gates-Fri Jul 18 10:11:47 PDT 2008-4 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: group: tuple({bytearray,bytearray}) Type: tuple
|       Input: CoGroup gates-Fri Jul 18 10:11:47 PDT 2008-3
|   |
|   Project gates-Fri Jul 18 10:11:47 PDT 2008-7 Projections: [1] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: age: tuple Type: tuple
|   Input: Project gates-Fri Jul 18 10:11:47 PDT 2008-6 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;|
|   |---Project gates-Fri Jul 18 10:11:47 PDT 2008-6 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: group: tuple({bytearray,bytearray}) Type: tuple
|       Input: CoGroup gates-Fri Jul 18 10:11:47 PDT 2008-3
|   |
|   UserFunc gates-Fri Jul 18 10:11:47 PDT 2008-10 function: org.apache.pig.builtin.COUNT FieldSchema: &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; Type: &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;
|   |
|   |---Project gates-Fri Jul 18 10:11:47 PDT 2008-9 Projections: [2] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: gpa: bag({gpa: bytearray}) Type: bag
|       Input: Project gates-Fri Jul 18 10:11:47 PDT 2008-8 Projections: [1] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;|
|       |---Project gates-Fri Jul 18 10:11:47 PDT 2008-8 Projections: [1] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: a: bag({name: bytearray,age: bytearray,gpa: bytearray}) Type: bag
|           Input: CoGroup gates-Fri Jul 18 10:11:47 PDT 2008-3
|
|---CoGroup gates-Fri Jul 18 10:11:47 PDT 2008-3 Schema: {group: (bytearray,bytearray),a: {name: bytearray,age: bytearray,gpa: bytearray}} Type: bag
    |   |
    |   Project gates-Fri Jul 18 10:11:47 PDT 2008-1 Projections: [0] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: name: bytearray cn: 0 Type: bytearray
    |   Input: Load gates-Fri Jul 18 10:11:47 PDT 2008-
    |   |
    |   Project gates-Fri Jul 18 10:11:47 PDT 2008-2 Projections: [1] Overloaded: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; FieldSchema: age: bytearray cn: 1 Type: bytearray
    |   Input: Load gates-Fri Jul 18 10:11:47 PDT 2008-
    |
    |---Load gates-Fri Jul 18 10:11:47 PDT 2008-0 Schema: {name: bytearray,age: bytearray,gpa: bytearray} Type: bag
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Projects &quot;Project gates-Fri Jul 18 10:11:47 PDT 2008-5&quot; and &quot;Project gates-Fri Jul 18 10:11:47 PDT 2008-7&quot; should have type bytearray, not type tuple.&lt;/p&gt;</comment>
                            <comment id="12615849" author="sms" created="Wed, 23 Jul 2008 00:55:12 +0000"  >&lt;p&gt;Fixed the issue with the cogroup schema computation. The logical plan for the query in the bug report will now look like:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ForEach Test-Plan-Builder-12 Schema: {name: bytearray,age: bytearray,long} Type: bag
|   |
|   Project Test-Plan-Builder-5 Projections: [0] Overloaded: false FieldSchema: name: bytearray Type: bytearray
|   Input: Project Test-Plan-Builder-4 Projections: [0] Overloaded: false|
|   |---Project Test-Plan-Builder-4 Projections: [0] Overloaded: false FieldSchema: group: tuple({name: bytearray,age: bytearray}) Type: tuple
|       Input: CoGroup Test-Plan-Builder-3
|   |
|   Project Test-Plan-Builder-7 Projections: [1] Overloaded: false FieldSchema: age: bytearray Type: bytearray
|   Input: Project Test-Plan-Builder-6 Projections: [0] Overloaded: false|
|   |---Project Test-Plan-Builder-6 Projections: [0] Overloaded: false FieldSchema: group: tuple({name: bytearray,age: bytearray}) Type: tuple
|       Input: CoGroup Test-Plan-Builder-3
|   |
|   UserFunc Test-Plan-Builder-10 function: org.apache.pig.builtin.COUNT FieldSchema: long Type: long
|   |
|   |---Project Test-Plan-Builder-9 Projections: [2] Overloaded: false FieldSchema: gpa: bytearray cn: 2 Type: bytearray
|       Input: Project Test-Plan-Builder-8 Projections: [1] Overloaded: false|
|       |---Project Test-Plan-Builder-8 Projections: [1] Overloaded: false FieldSchema: a: bag({name: bytearray,age: bytearray,gpa: bytearray}) Type: bag
|           Input: CoGroup Test-Plan-Builder-3
|
|---CoGroup Test-Plan-Builder-3 Schema: {group: (name: bytearray,age: bytearray),a: {name: bytearray,age: bytearray,gpa: bytearray}} Type: Unknown
    |   |
    |   Project Test-Plan-Builder-1 Projections: [0] Overloaded: false FieldSchema: name: bytearray cn: 0 Type: bytearray
    |   Input: Load Test-Plan-Builder-
    |   |
    |   Project Test-Plan-Builder-2 Projections: [1] Overloaded: false FieldSchema: age: bytearray cn: 1 Type: bytearray
    |   Input: Load Test-Plan-Builder-
    |
    |---Load Test-Plan-Builder-0 Schema: {name: bytearray,age: bytearray,gpa: bytearray} Type: bag

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12615851" author="sms" created="Wed, 23 Jul 2008 00:57:00 +0000"  >&lt;p&gt;The patch fixes the following:&lt;/p&gt;

&lt;p&gt;1. Cogroup schema compuation&lt;br/&gt;
2. LOMapLookup fieldSchema computation&lt;/p&gt;


&lt;p&gt;Unit test cases that still fail are:&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestEvalPipeline&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 8, Failures: 0, Errors: 1, Time elapsed: 179.904 sec&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestEvalPipeline FAILED&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestFilterOpNumeric&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 8, Failures: 0, Errors: 1, Time elapsed: 56.124 sec&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestFilterOpNumeric FAILED&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestBuiltin&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 23, Failures: 1, Errors: 1, Time elapsed: 14.8 sec&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestBuiltin FAILED&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestStoreOld&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 3, Failures: 0, Errors: 2, Time elapsed: 21.453 sec&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestStoreOld FAILED&lt;/p&gt;</comment>
                            <comment id="12615945" author="pi_song" created="Wed, 23 Jul 2008 10:43:33 +0000"  >&lt;p&gt;Totally agree.&lt;/p&gt;

&lt;p&gt;Committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12386675" name="cogroup_schema.patch" size="15847" author="sms" created="Wed, 23 Jul 2008 00:57:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163946</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gilr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94444</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>