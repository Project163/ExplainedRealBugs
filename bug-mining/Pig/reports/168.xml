<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:49:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-577] outer join query looses name information</title>
                <link>https://issues.apache.org/jira/browse/PIG-577</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The following query:&lt;/p&gt;

&lt;p&gt;A = LOAD &apos;student_data&apos; AS (name: chararray, age: int, gpa: float);&lt;br/&gt;
B = LOAD &apos;voter_data&apos; AS (name: chararray, age: int, registration: chararray, contributions: float);&lt;br/&gt;
C = COGROUP A BY name, B BY name;&lt;br/&gt;
D = FOREACH C GENERATE group, flatten((IsEmpty(A) ? null : A)), flatten((IsEmpty(B) ? null : B));&lt;br/&gt;
describe D;&lt;br/&gt;
E = FOREACH D GENERATE A::gpa, B::contributions;&lt;/p&gt;

&lt;p&gt;Give the following error: (Even though describe shows correct information: D: &lt;/p&gt;
{group: chararray,A::name: chararray,A::age: int,A::gpa: float,B::name: chararray,B::age: int,B::registration: chararray,B::contributions: float}

&lt;p&gt;java.io.IOException: Invalid alias: A::gpa in &lt;/p&gt;
{group: chararray,bytearray,bytearray}
&lt;p&gt;        at org.apache.pig.PigServer.parseQuery(PigServer.java:298)&lt;br/&gt;
        at org.apache.pig.PigServer.registerQuery(PigServer.java:263)&lt;br/&gt;
        at org.apache.pig.tools.grunt.GruntParser.processPig(GruntParser.java:439)&lt;br/&gt;
        at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:249)&lt;br/&gt;
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:84)&lt;br/&gt;
        at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:64)&lt;br/&gt;
        at org.apache.pig.Main.main(Main.java:306)&lt;br/&gt;
Caused by: org.apache.pig.impl.logicalLayer.parser.ParseException: Invalid alias: A::gpa in &lt;/p&gt;
{group: chararray,bytearray,bytearray}
&lt;p&gt;        at org.apache.pig.impl.logicalLayer.parser.QueryParser.AliasFieldOrSpec(QueryParser.java:5930)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.ColOrSpec(QueryParser.java:5788)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.BaseEvalSpec(QueryParser.java:3974)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.UnaryExpr(QueryParser.java:3871)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.CastExpr(QueryParser.java:3825)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.MultiplicativeExpr(QueryParser.java:3734)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.AdditiveExpr(QueryParser.java:3660)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.InfixExpr(QueryParser.java:3626)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.FlattenedGenerateItem(QueryParser.java:3552)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.FlattenedGenerateItemList(QueryParser.java:3462)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.GenerateStatement(QueryParser.java:3419)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.NestedBlock(QueryParser.java:2894)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.ForEachClause(QueryParser.java:2309)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.BaseExpr(QueryParser.java:966)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.Expr(QueryParser.java:742)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.parser.QueryParser.Parse(QueryParser.java:537)&lt;br/&gt;
        at org.apache.pig.impl.logicalLayer.LogicalPlanBuilder.parse(LogicalPlanBuilder.java:60)&lt;br/&gt;
        at org.apache.pig.PigServer.parseQuery(PigServer.java:295)&lt;br/&gt;
        ... 6 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12411279">PIG-577</key>
            <summary>outer join query looses name information</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sms">Santhosh Muthur Srinivasan</assignee>
                                    <reporter username="olgan">Olga Natkovich</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Dec 2008 01:03:34 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:15 +0000</updated>
                            <resolved>Tue, 3 Mar 2009 23:51:39 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12659016" author="sms" created="Wed, 24 Dec 2008 01:44:34 +0000"  >&lt;p&gt;The workaround is to invert the condition of the bincond and swap the two elements of the bincond. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;D = FOREACH C GENERATE group, flatten((not IsEmpty(A) ? A: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ), flatten((not IsEmpty(B) ? B: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The root cause for this issue is the schema computation in LOBinCond. The assumption is that the schemas of the LHS and RHS of the bincond match all the time. The type checker ensures that this assumption is true. However, after each statement is parsed we do not run the type checker. The type checker is run only when describe, explain, dump or store is encountered.&lt;/p&gt;

&lt;p&gt;As a result for the script reported in the bug, the type of the null constant is seen as bytearray and not as the schema of the RHS which is a bag.&lt;/p&gt;

&lt;p&gt;The type checking logic should be invoked early by invoking the type checker after each statement or the type checking logic for bincond should be invoked by the getFieldSchema method to ensure the equivalence of the LHS and RHS schemas.&lt;/p&gt;</comment>
                            <comment id="12659119" author="ciemo" created="Wed, 24 Dec 2008 17:11:43 +0000"  >&lt;p&gt;Note that while this workaround does solve the schema problem, the resulting tuples in D will not have sufficient null elements if either A or B is null.  Especially if A is null.&lt;/p&gt;

&lt;p&gt;Semantically, &#239;t seems that the correct D statement should be something like:&lt;/p&gt;

&lt;p&gt;D = FOREACH C GENERATE group, flatten((not IsEmpty(A) ? A: (null,null,null) ), flatten((not IsEmpty(B) ? B: (null,null,null) ));&lt;/p&gt;

&lt;p&gt;However, this generates all sorts of parse errors.&lt;/p&gt;</comment>
                            <comment id="12659144" author="sms" created="Wed, 24 Dec 2008 18:53:14 +0000"  >&lt;p&gt;The correct statement to make mimic the outer join semantics will be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;D = FOREACH C GENERATE group, flatten((not IsEmpty(A) ? A : (bag{tuple(chararray, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)}){(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)})), flatten((not IsEmpty(B) ? B : (bag{tuple(chararray, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, chararray, &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)}){(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)}));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, this exposed a bag in the type checker where the schemas of the LHS and RHS do not match. The bag with the null constants has a tuple and relation A(or B) has a schema without the tuple. This issue was resolved in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-449&quot; title=&quot;Schemas for bags should contain tuples all the time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-449&quot;&gt;&lt;del&gt;PIG-449&lt;/del&gt;&lt;/a&gt;. The solution proposed in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-449&quot; title=&quot;Schemas for bags should contain tuples all the time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-449&quot;&gt;&lt;del&gt;PIG-449&lt;/del&gt;&lt;/a&gt; has to be extended to schema comparisons that involve bags.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2008-12-24 10:31:58,529 [main] ERROR org.apache.pig.tools.grunt.Grunt - Two inputs of BinCond must have compatible schemas

2008-12-24 10:31:58,529 [main] ERROR org.apache.pig.tools.grunt.Grunt - org.apache.pig.impl.logicalLayer.FrontendException: Unable to describe schema &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; alias D
        at org.apache.pig.PigServer.dumpSchema(PigServer.java:367)
        at org.apache.pig.tools.grunt.GruntParser.processDescribe(GruntParser.java:153)
        at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:188)
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:84)
        at org.apache.pig.tools.grunt.Grunt.run(Grunt.java:71)
        at org.apache.pig.Main.main(Main.java:302)
Caused by: org.apache.pig.impl.plan.PlanValidationException: An unexpected exception caused the validation to stop
        at org.apache.pig.impl.plan.PlanValidator.validateSkipCollectException(PlanValidator.java:104)
        at org.apache.pig.impl.logicalLayer.validators.TypeCheckingValidator.validate(TypeCheckingValidator.java:40)
        at org.apache.pig.impl.logicalLayer.validators.TypeCheckingValidator.validate(TypeCheckingValidator.java:30)
        at org.apache.pig.impl.logicalLayer.validators.LogicalPlanValidationExecutor.validate(LogicalPlanValidationExecutor.java:79)
        at org.apache.pig.PigServer.compileLp(PigServer.java:687)
        at org.apache.pig.PigServer.dumpSchema(PigServer.java:360)
        ... 5 more
Caused by: org.apache.pig.impl.logicalLayer.validators.TypeCheckerException: Cannot resolve ForEach output schema.
        at org.apache.pig.impl.logicalLayer.validators.TypeCheckingVisitor.visit(TypeCheckingVisitor.java:2731)
        at org.apache.pig.impl.logicalLayer.LOForEach.visit(LOForEach.java:122)
        at org.apache.pig.impl.logicalLayer.LOForEach.visit(LOForEach.java:41)
        at org.apache.pig.impl.plan.DependencyOrderWalker.walk(DependencyOrderWalker.java:68)
        at org.apache.pig.impl.plan.PlanVisitor.visit(PlanVisitor.java:51)
        at org.apache.pig.impl.plan.PlanValidator.validateSkipCollectException(PlanValidator.java:101)
        ... 10 more
Caused by: org.apache.pig.impl.logicalLayer.validators.TypeCheckerException: Problem during evaluaton of BinCond output type
        at org.apache.pig.impl.logicalLayer.validators.TypeCheckingVisitor.visit(TypeCheckingVisitor.java:1913)
        at org.apache.pig.impl.logicalLayer.LOBinCond.visit(LOBinCond.java:88)
        at org.apache.pig.impl.logicalLayer.LOBinCond.visit(LOBinCond.java:27)
        at org.apache.pig.impl.plan.DependencyOrderWalker.walk(DependencyOrderWalker.java:68)
        at org.apache.pig.impl.plan.PlanVisitor.visit(PlanVisitor.java:51)
        at org.apache.pig.impl.logicalLayer.validators.TypeCheckingVisitor.checkInnerPlan(TypeCheckingVisitor.java:2812)
        at org.apache.pig.impl.logicalLayer.validators.TypeCheckingVisitor.visit(TypeCheckingVisitor.java:2720)
        ... 15 more
Caused by: org.apache.pig.impl.logicalLayer.validators.TypeCheckerException: Two inputs of BinCond must have compatible schemas
        at org.apache.pig.impl.logicalLayer.validators.TypeCheckingVisitor.visit(TypeCheckingVisitor.java:1903)
        ... 21 more

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12659152" author="sms" created="Wed, 24 Dec 2008 19:59:10 +0000"  >&lt;p&gt;The use of the null constant in the bincond in the context of a flatten should handle the following cases:&lt;/p&gt;

&lt;p&gt;Assumption: one of the columns in the bincond is a null constant.&lt;/p&gt;

&lt;p&gt;1. If the other column is a simple type or a map then cast the null to the other type.&lt;br/&gt;
2. If the other column is a complex type other than a map then remove the null constant and supplant it with &lt;br/&gt;
a bag or a tuple or a map constant with the appropriate elements, i.e., if the other column&lt;br/&gt;
is a bag with a tuple that contains three columns (say int, float, chararray) then replace the&lt;br/&gt;
null constant with a bag that contains a tuple with three null constants. The same reasoning&lt;br/&gt;
applies to a tuple column.&lt;/p&gt;

&lt;p&gt;Upon flattening the complex types will give out the appropriate number of columns.&lt;/p&gt;

&lt;p&gt;Handling null constants for complex type has implications when the constant is materialized either&lt;br/&gt;
via dump or store. If the null constant is replaced with an appropriate bag/tuple/map then the materialized&lt;br/&gt;
constant will look like &lt;/p&gt;
{(,,)}
&lt;p&gt; or (,,) or []. This conflicts with our existing view of nulls being empty when&lt;br/&gt;
materialized.&lt;/p&gt;</comment>
                            <comment id="12678395" author="sms" created="Tue, 3 Mar 2009 18:41:19 +0000"  >&lt;p&gt;Attached patch fixes the issue of schema comparisons that fail during an outer join specification. In addition a minor issue regarding the creation of the log file for PIG errors has been resolved. All unit tests pass.&lt;/p&gt;</comment>
                            <comment id="12678516" author="pkamath" created="Tue, 3 Mar 2009 23:52:12 +0000"  >&lt;p&gt;+1, Patch committed - thanks for the fix Santhosh.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12401328" name="PIG-577.patch" size="12899" author="sms" created="Tue, 3 Mar 2009 18:41:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164173</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0glx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94981</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>