<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4908] JythonFunction refers to Oozie launcher script absolute path</title>
                <link>https://issues.apache.org/jira/browse/PIG-4908</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;  We had a scenario where a user had multiple udfs all named udfs.py. JythonFunction was referring to the absolute localized path of udfs.py in the Oozie launcher. Tasks which ran on a node and which had a different version of udfs.py localized to same path (hashcode conflict) as the Oozie launcher failed.  We should be referring to relative path of the files. The current code check is the canonical path starts with cwd, but that does not work as the files are downloaded to a different location and symlinked to the current working directory of the task attempt.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12972104">PIG-4908</key>
            <summary>JythonFunction refers to Oozie launcher script absolute path</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rohini">Rohini Palaniswamy</assignee>
                                    <reporter username="rohini">Rohini Palaniswamy</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 May 2016 16:22:20 +0000</created>
                <updated>Tue, 14 Jun 2016 20:19:00 +0000</updated>
                            <resolved>Mon, 23 May 2016 22:39:05 +0000</resolved>
                                                    <fixVersion>0.16.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15297083" author="daijy" created="Mon, 23 May 2016 21:05:01 +0000"  >&lt;p&gt;+1. The &quot;starts with cwd&quot; check is very buggy. There are other situations such as &quot;xxx/.././&quot; which will fail the match.&lt;/p&gt;</comment>
                            <comment id="15297267" author="rohini" created="Mon, 23 May 2016 22:39:05 +0000"  >&lt;p&gt;Committed to branch 0.16 and trunk. Thanks for the review Daniel.&lt;/p&gt;</comment>
                            <comment id="15298718" author="rohini" created="Tue, 24 May 2016 18:57:44 +0000"  >&lt;p&gt;The ./ and ../ paths actually have issue with this patch and Scripting e2e tests failed. Attached &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4908&quot; title=&quot;JythonFunction refers to Oozie launcher script absolute path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4908&quot;&gt;&lt;del&gt;PIG-4908&lt;/del&gt;&lt;/a&gt;-2-fixtest.patch to revert back to the old behavior if we have those.&lt;/p&gt;</comment>
                            <comment id="15300182" author="knoguchi" created="Wed, 25 May 2016 15:01:20 +0000"  >&lt;blockquote&gt;
&lt;p&gt;The ./ and ../ paths actually have issue with this patch and Scripting e2e tests failed. Attached &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4908&quot; title=&quot;JythonFunction refers to Oozie launcher script absolute path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4908&quot;&gt;&lt;del&gt;PIG-4908&lt;/del&gt;&lt;/a&gt;-2-fixtest.patch to revert back to the old behavior if we have those.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Confirmed this fixes the e2e failures I was seeing. +1.&lt;/p&gt;

&lt;p&gt;But for this jira, can you share the steps on how the conflict happened?  &lt;br/&gt;
Without a testcase, I&apos;m not seeing how the incorrect udfs.py was picked.&lt;/p&gt;</comment>
                            <comment id="15300586" author="rohini" created="Wed, 25 May 2016 18:22:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;Without a testcase, I&apos;m not seeing how the incorrect udfs.py was picked.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;   Explanation is in description. We put the absolute path in the JythonFunction in the pig client (Oozie launcher). If a different file with same name exists on that backend task node in that path it runs into errors. It is hard to write a testcase for it as it you can&apos;t have two different files in the local filesytem on the same machine.&lt;/p&gt;

&lt;p&gt;I am going to look a little bit more into ScriptEngine.getScriptAsStream() to see if there is a better way to fix this.&lt;/p&gt;</comment>
                            <comment id="15308190" author="rohini" created="Tue, 31 May 2016 17:36:31 +0000"  >&lt;p&gt;  When absolute path is used, the nameInJar finally has the leading / removed and added to jar. For eg:  /tmp/sleep.py will be added to jar as tmp/sleep.py so that it is accessible through ScriptEngine.class.getResourceAsStream(scriptPath) when the jar is in classpath. &lt;/p&gt;

&lt;p&gt;Problem was we were looking for the absolute path first before trying the jar. So additionally fixed that code to look for local file first if frontend else look at the last in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4908&quot; title=&quot;JythonFunction refers to Oozie launcher script absolute path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4908&quot;&gt;&lt;del&gt;PIG-4908&lt;/del&gt;&lt;/a&gt;-3-fixtest.patch.&lt;/p&gt;

&lt;p&gt;Saw that during compilation we were initializing the function too many times with the different visitors. Will file a separate jira to cut down on that.&lt;/p&gt;</comment>
                            <comment id="15308454" author="daijy" created="Tue, 31 May 2016 19:44:43 +0000"  >&lt;p&gt;+1.&lt;/p&gt;

&lt;p&gt;Further, I don&apos;t see a reason to make relative path different. We shall remove the relative path handling code in a separate ticket, which is already very fragile, eg:&lt;br/&gt;
path.indexOf(&quot;.&quot; + File.separator)&lt;br/&gt;
Why path contain . make a difference.&lt;/p&gt;</comment>
                            <comment id="15308472" author="rohini" created="Tue, 31 May 2016 19:52:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;Why path contain . make a difference.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;  It does not work with paths in jar and getResourceAsStream.&lt;/p&gt;</comment>
                            <comment id="15308499" author="rohini" created="Tue, 31 May 2016 20:03:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;We shall remove the relative path handling code in a separate ticket, &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;  I think we should be ok to do that. It will have longer path names in the jar which should not be a problem. Relative path names allow picking up from local directory when the scripts are part of distributed cache files though. Cannot think of anything else now, but to be on the safer side will do after this release.&lt;/p&gt;

&lt;p&gt;Committed &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4908&quot; title=&quot;JythonFunction refers to Oozie launcher script absolute path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4908&quot;&gt;&lt;del&gt;PIG-4908&lt;/del&gt;&lt;/a&gt;-3-fixtest.patch to trunk and branch-0.16. Thanks for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=knoguchi&quot; class=&quot;user-hover&quot; rel=&quot;knoguchi&quot;&gt;knoguchi&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15330485" author="knoguchi" created="Tue, 14 Jun 2016 20:14:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;but to be on the safer side will do after this release.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;, should we have a new jira so that we won&apos;t forget about it? &lt;/p&gt;</comment>
                            <comment id="15330494" author="rohini" created="Tue, 14 Jun 2016 20:19:00 +0000"  >&lt;p&gt;Already made a note to take care of that in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4908&quot; title=&quot;JythonFunction refers to Oozie launcher script absolute path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4908&quot;&gt;&lt;del&gt;PIG-4908&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12805661" name="PIG-4908-1.patch" size="1800" author="rohini" created="Mon, 23 May 2016 16:29:39 +0000"/>
                            <attachment id="12805942" name="PIG-4908-2-fixtest.patch" size="745" author="rohini" created="Tue, 24 May 2016 18:57:44 +0000"/>
                            <attachment id="12807211" name="PIG-4908-3-fixtest.patch" size="2747" author="rohini" created="Tue, 31 May 2016 17:36:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ydjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>