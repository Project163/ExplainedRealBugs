<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:03:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-5283] Configuration is not passed to SparkPigSplits on the backend</title>
                <link>https://issues.apache.org/jira/browse/PIG-5283</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;When a Hadoop ObjectWritable is created during a Spark job, the instantiated PigSplit (wrapped into a SparkPigSplit) is given an empty Configuration instance.&lt;br/&gt;
This happens &lt;a href=&quot;https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/SerializableWritable.scala#L44&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13091909">PIG-5283</key>
            <summary>Configuration is not passed to SparkPigSplits on the backend</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="szita">&#193;d&#225;m Szita</assignee>
                                    <reporter username="szita">&#193;d&#225;m Szita</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Aug 2017 14:57:01 +0000</created>
                <updated>Mon, 15 Sep 2025 11:29:06 +0000</updated>
                            <resolved>Wed, 9 Aug 2017 08:43:14 +0000</resolved>
                                                    <fixVersion>0.18.0</fixVersion>
                                    <component>spark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16111076" author="szita" created="Wed, 2 Aug 2017 15:06:57 +0000"  >&lt;p&gt;I propose we make use of SparkPigSplit and write the conf along with the split as seen in: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12880058/12880058_PIG-5283.0.patch&quot; title=&quot;PIG-5283.0.patch attached to PIG-5283&quot;&gt;PIG-5283.0.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kellyzly&quot; class=&quot;user-hover&quot; rel=&quot;kellyzly&quot;&gt;kellyzly&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkollar&quot; class=&quot;user-hover&quot; rel=&quot;nkollar&quot;&gt;nkollar&lt;/a&gt; let me know what you think&lt;/p&gt;</comment>
                            <comment id="16112449" author="kellyzly" created="Thu, 3 Aug 2017 08:59:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szita&quot; class=&quot;user-hover&quot; rel=&quot;szita&quot;&gt;szita&lt;/a&gt;: In  &lt;a href=&quot;https://github.com/apache/pig/blob/trunk/src/org/apache/pig/backend/hadoop/executionengine/spark/running/PigInputFormatSpark.java#L59&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PigInputFormatSpark#createRecordReader&lt;/a&gt;,  it  initialize pigSplit configuration.  In my understanding,the configuration of pigSplit is initialized correctly, so currently you met a problem of invalid initialization of pigSplit&apos;s configuration?  If yes, can you provide simple script to show your problem.&lt;/p&gt;</comment>
                            <comment id="16112500" author="nkollar" created="Thu, 3 Aug 2017 09:41:46 +0000"  >&lt;p&gt;This is a problem with Hadoop 3 (&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-14459&quot; title=&quot;SerializationFactory shouldn&amp;#39;t throw a NullPointerException if the serializations list is not defined&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-14459&quot;&gt;&lt;del&gt;HADOOP-14459&lt;/del&gt;&lt;/a&gt;) and Spark with Pig. Any Pig script will fail on Hadoop 3 with spark exec type, and like Adam mentioned in the description, the problem might be with &lt;tt&gt;ow.setConf(new Configuration(false))&lt;/tt&gt; in Spark SerializableWritable class. It creates a new configuration, so whatever was set before is gone. &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8588&quot; title=&quot;SerializationFactory shouldn&amp;#39;t throw a NullPointerException if the serializations list is empty&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8588&quot;&gt;&lt;del&gt;HADOOP-8588&lt;/del&gt;&lt;/a&gt; was committed in Hadoop 3, supposed to fix an NPE, but actually causes an other one, if the required key is not set in Configuration (that&apos;s why it is fine on Hadoop 2).&lt;/p&gt;</comment>
                            <comment id="16112502" author="nkollar" created="Thu, 3 Aug 2017 09:43:27 +0000"  >&lt;p&gt;I think Adam&apos;s patch is a good workaround for this problem, looks good to me.&lt;/p&gt;</comment>
                            <comment id="16113817" author="kellyzly" created="Fri, 4 Aug 2017 02:19:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkollar&quot; class=&quot;user-hover&quot; rel=&quot;nkollar&quot;&gt;nkollar&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szita&quot; class=&quot;user-hover&quot; rel=&quot;szita&quot;&gt;szita&lt;/a&gt;: Can we set the correct value of CommonConfigurationKeys.IO_SERIALIZATIONS_KEY in  pig on spark to avoid the problem?&lt;br/&gt;
If we can not  ,+1 for the patch.&lt;/p&gt;</comment>
                            <comment id="16115582" author="rohini" created="Sun, 6 Aug 2017 01:48:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8588&quot; title=&quot;SerializationFactory shouldn&amp;#39;t throw a NullPointerException if the serializations list is empty&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8588&quot;&gt;&lt;del&gt;HADOOP-8588&lt;/del&gt;&lt;/a&gt; was committed in Hadoop 3, supposed to fix an NPE, but actually causes an other one, if the required key is not set in Configuration &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;  You should comment on the hadoop jira and have them fix it properly instead of working around in Pig.&lt;/p&gt;</comment>
                            <comment id="16116368" author="szita" created="Mon, 7 Aug 2017 10:02:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kellyzly&quot; class=&quot;user-hover&quot; rel=&quot;kellyzly&quot;&gt;kellyzly&lt;/a&gt;, it doesn&apos;t matter what we set in the configuration, unfortunately &lt;b&gt;Spark will always set an empty configuration to the deserialized PigSplit&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;, this is a problem by itself, but we didn&apos;t see it before, with Hadoop 2. Hadoop 3 on the other hand has another bug - as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkollar&quot; class=&quot;user-hover&quot; rel=&quot;nkollar&quot;&gt;nkollar&lt;/a&gt; explains - which depends on &lt;tt&gt;io.serializations&lt;/tt&gt; property being null or not. (In H2 this is handled by Hadoop code properly, in H3 it became buggy) This however doesn&apos;t change the fact that the configuration is not passed down properly to the deseralized PigSplits.&lt;/p&gt;

&lt;p&gt;I don&apos;t see a way to go around the Spark code that creates the empty config during deseralization so I intend to package the conf along with the SparkPigSplit instances.&lt;br/&gt;
My only question is that if we should only write those properties that are required for a PigSplit instead of writing the full jobConf (6-700 entries) for optimization.&lt;/p&gt;

&lt;p&gt;At first glance I see that only the following properties are needed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;CommonConfigurationKeys.IO_SERIALIZATIONS_KEY (&lt;span class=&quot;code-quote&quot;&gt;&quot;io.serializations&quot;&lt;/span&gt;)
PigConfiguration.PIG_COMPRESS_INPUT_SPLITS
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="16116449" author="rohini" created="Mon, 7 Aug 2017 11:23:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;My only question is that if we should only write those properties that are required for a PigSplit instead of writing the full jobConf (6-700 entries) for optimization.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;  I would suggest trimming down and also see if it is possible to serialize only once. You are serializing the config with each split which is not good. That is a lot of overhead and will impact performance. Had run into performance issues and OOMs with Tez on huge configs and serializing configs multiple times and had to trim down.&lt;/p&gt;
</comment>
                            <comment id="16118075" author="kellyzly" created="Tue, 8 Aug 2017 08:59:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szita&quot; class=&quot;user-hover&quot; rel=&quot;szita&quot;&gt;szita&lt;/a&gt;:  &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;My only question is that if we should only write those properties that are required for a PigSplit instead of writing the full jobConf (6-700 entries) for optimization.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;not initialize all the items. it is ok to just initialize few items to make it work. Will PigInputFormatSpark#createRecordReader initialize all items after bypassing current issue?&lt;/p&gt;</comment>
                            <comment id="16118306" author="szita" created="Tue, 8 Aug 2017 13:02:23 +0000"  >&lt;p&gt;Attached &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12880823/12880823_PIG-5283.1.patch&quot; title=&quot;PIG-5283.1.patch attached to PIG-5283&quot;&gt;PIG-5283.1.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; with the feature of only writing out the necessary keys of the configuration.&lt;br/&gt;
Unfortunately I don&apos;t see any way to write the config only once (instead of per split), as I need to have it ready at the very first stages of Spark task execution: the deseralization of the task.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kellyzly&quot; class=&quot;user-hover&quot; rel=&quot;kellyzly&quot;&gt;kellyzly&lt;/a&gt; yes, the PigInputFormatSpark#createRecordReader part comes much later in the execution, and will work just like before. In a way it is irrelevant of the current issue, because it will set the full configuration on each split, but it&apos;s too late for this issue since we need the configuration during task deseralization time already.&lt;/p&gt;</comment>
                            <comment id="16119287" author="kellyzly" created="Wed, 9 Aug 2017 01:34:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szita&quot; class=&quot;user-hover&quot; rel=&quot;szita&quot;&gt;szita&lt;/a&gt;:  I can understand the reason why need set &lt;tt&gt;CommonConfigurationKeys.IO_SERIALIZATIONS_KEY&lt;/tt&gt;. why need set &lt;tt&gt;PigConfiguration.PIG_COMPRESS_INPUT_SPLITS&lt;/tt&gt; in the configuration?&lt;/p&gt;</comment>
                            <comment id="16119467" author="szita" created="Wed, 9 Aug 2017 06:25:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kellyzly&quot; class=&quot;user-hover&quot; rel=&quot;kellyzly&quot;&gt;kellyzly&lt;/a&gt; because insisde &lt;tt&gt;readFields&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/pig/blob/trunk/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/PigSplit.java#L307&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;compression configs are used&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16119488" author="kellyzly" created="Wed, 9 Aug 2017 06:46:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szita&quot; class=&quot;user-hover&quot; rel=&quot;szita&quot;&gt;szita&lt;/a&gt;: thanks for your explaination. +1&lt;/p&gt;</comment>
                            <comment id="16119583" author="szita" created="Wed, 9 Aug 2017 08:42:50 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12880823/12880823_PIG-5283.1.patch&quot; title=&quot;PIG-5283.1.patch attached to PIG-5283&quot;&gt;PIG-5283.1.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; committed to trunk. Thanks for the review Rohini, Liyun and Nandor&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12880058" name="PIG-5283.0.patch" size="1313" author="szita" created="Wed, 2 Aug 2017 15:05:08 +0000"/>
                            <attachment id="12880823" name="PIG-5283.1.patch" size="3458" author="szita" created="Tue, 8 Aug 2017 12:51:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 15 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ibsf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>