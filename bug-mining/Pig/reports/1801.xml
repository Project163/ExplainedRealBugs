<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:01:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4790] Join after union fail due to UnionOptimizer</title>
                <link>https://issues.apache.org/jira/browse/PIG-4790</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The following script fail to run:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;rmf ooo

a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;student.txt&apos;&lt;/span&gt; as (name:chararray, age:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;);
b = filter a by age &amp;gt; 65;
c = filter a by age &amp;lt;=10;
d = union b, c;
e = join a by name left, d by name;
store e into &lt;span class=&quot;code-quote&quot;&gt;&apos;ooo&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Exception stack:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: java.lang.IllegalArgumentException: Edge [scope-43 : org.apache.pig.backend.hadoop.executionengine.tez.runtime.PigProcessor] -&amp;gt; [scope-55 : org.apache.pig.backend.hadoop.executionengine.tez.runtime.PigProcessor] ({ SCATTER_GATHER : org.apache.tez.runtime.library.input.OrderedGroupedKVInput &amp;gt;&amp;gt; PERSISTED &amp;gt;&amp;gt; org.apache.tez.runtime.library.output.OrderedPartitionedKVOutput &amp;gt;&amp;gt; NullEdgeManager }) already defined!
        at org.apache.tez.dag.api.DAG.addEdge(DAG.java:272)
        at org.apache.pig.backend.hadoop.executionengine.tez.TezDagBuilder.visitTezOp(TezDagBuilder.java:311)
        at org.apache.pig.backend.hadoop.executionengine.tez.plan.TezOperator.visit(TezOperator.java:252)
        at org.apache.pig.backend.hadoop.executionengine.tez.plan.TezOperator.visit(TezOperator.java:56)
        at org.apache.pig.impl.plan.DependencyOrderWalker.walk(DependencyOrderWalker.java:87)
        at org.apache.pig.impl.plan.PlanVisitor.visit(PlanVisitor.java:46)
        at org.apache.pig.backend.hadoop.executionengine.tez.TezJobCompiler.buildDAG(TezJobCompiler.java:65)
        at org.apache.pig.backend.hadoop.executionengine.tez.TezJobCompiler.getJob(TezJobCompiler.java:111)
        ... 20 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Disable pig.tez.opt.union the script runs fine.&lt;/p&gt;

&lt;p&gt;Seems we shall detect this patten and disallow merge vertex group into a pair already has an edge.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12934979">PIG-4790</key>
            <summary>Join after union fail due to UnionOptimizer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rohini">Rohini Palaniswamy</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Jan 2016 01:44:58 +0000</created>
                <updated>Wed, 8 Jun 2016 20:48:28 +0000</updated>
                            <resolved>Wed, 10 Feb 2016 18:12:47 +0000</resolved>
                                                    <fixVersion>0.16.0</fixVersion>
                                    <component>tez</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15125191" author="rohini" created="Sun, 31 Jan 2016 01:55:12 +0000"  >&lt;p&gt;Additionally modified TezCompiler.testCrossScalarSplit added in &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4690&quot; title=&quot;Union with self replicate join will fail in Tez&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4690&quot;&gt;&lt;del&gt;PIG-4690&lt;/del&gt;&lt;/a&gt; as the golden file generated for JDK 7 and 8 were different due to ordering and the test was failing.&lt;/p&gt;</comment>
                            <comment id="15140157" author="daijy" created="Wed, 10 Feb 2016 01:20:08 +0000"  >&lt;p&gt;The patch fix the script above. However, a more complex script fail for the same stack:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;a = LOAD &lt;span class=&quot;code-quote&quot;&gt;&apos;studenttab10k&apos;&lt;/span&gt; AS (name:chararray, age:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;);

SPLIT a INTO b IF age &amp;gt; 40,
             c IF age &amp;lt;= 40;

d = FOREACH c GENERATE name, age, gpa;

e = FILTER d BY gpa &amp;gt; 3;
f = FILTER d BY gpa &amp;lt;= 3;

g = JOIN e BY name LEFT, f BY name;
h = FOREACH g GENERATE e::name as name, e::age as age, e::gpa as gpa;

i = DISTINCT h;

j = FILTER b BY gpa &amp;gt; 3;
k = FILTER b by gpa &amp;lt;= 3;

l = JOIN j BY name LEFT, k BY name;
m = FOREACH l generate j::name as name, j::age as age, j::gpa as gpa;
n = DISTINCT m;

m = UNION e, i, j, n;

n = JOIN a BY name, m BY name;

STORE n INTO &lt;span class=&quot;code-quote&quot;&gt;&apos;ooo&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Attach another patch to fix both.&lt;/p&gt;</comment>
                            <comment id="15140582" author="rohini" created="Wed, 10 Feb 2016 09:53:45 +0000"  >&lt;p&gt;The difference in the complex script is that one of the edges is a vertex group. The fix has a problem though. It turns of UnionOptimizer for the simple case as well where the edges are normal which the previous patch handled. We should avoid turning off UnionOptimizer as much as possible because the performance of UnorderedPartitionedKVOutput is currently very bad and is not fixed yet. Would be good to add the script to TestTezCompiler as well. &lt;/p&gt;</comment>
                            <comment id="15140606" author="rohini" created="Wed, 10 Feb 2016 10:31:55 +0000"  >&lt;p&gt;Attached patch that takes care of it. It was just addition of simple check on uniqueMembers to your existing condition and putting back my initial checks.&lt;/p&gt;</comment>
                            <comment id="15141299" author="daijy" created="Wed, 10 Feb 2016 17:50:41 +0000"  >&lt;p&gt;+1 for &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4790&quot; title=&quot;Join after union fail due to UnionOptimizer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4790&quot;&gt;&lt;del&gt;PIG-4790&lt;/del&gt;&lt;/a&gt;-3.patch.&lt;/p&gt;</comment>
                            <comment id="15141352" author="rohini" created="Wed, 10 Feb 2016 18:12:47 +0000"  >&lt;p&gt;Committed to trunk. Thanks for the review and the patch Daniel.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12785388" name="PIG-4790-1.patch" size="12367" author="rohini" created="Sun, 31 Jan 2016 01:55:12 +0000"/>
                            <attachment id="12787196" name="PIG-4790-2.patch" size="12454" author="daijy" created="Wed, 10 Feb 2016 01:20:08 +0000"/>
                            <attachment id="12787238" name="PIG-4790-3.patch" size="18000" author="rohini" created="Wed, 10 Feb 2016 10:31:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2s4hr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>