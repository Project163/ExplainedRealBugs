<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:48:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-303] POCast does not cast chararray to bytearray</title>
                <link>https://issues.apache.org/jira/browse/PIG-303</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;When chararray is cast to bytearray, the query execution fails due to ClassCastException. The problem is inside the getNext(DataByteArray) code in POCast.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12400069">PIG-303</key>
            <summary>POCast does not cast chararray to bytearray</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sms">Santhosh Muthur Srinivasan</assignee>
                                    <reporter username="sms">Santhosh Muthur Srinivasan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jul 2008 22:00:55 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:03 +0000</updated>
                            <resolved>Thu, 31 Jul 2008 17:59:49 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12612937" author="sms" created="Fri, 11 Jul 2008 17:31:18 +0000"  >&lt;p&gt;The conversion from any pig type to byte array is broken. &lt;/p&gt;

&lt;p&gt;The cast functionality is used in the following scenarios:&lt;/p&gt;

&lt;p&gt;1. Cast bytes to appropriate pig types during load&lt;br/&gt;
2. Cast one pig type to another during execution&lt;br/&gt;
3. Cast pig types to appropriate storage representation during a store&lt;/p&gt;

&lt;p&gt;Out of these three scenarios, POCast plays a role in the first two. The third scenario influences the behavior of POCast.&lt;/p&gt;

&lt;p&gt;Currently, POCast uses the load function to convert bytes to the appropriate pig type (scenario 1). During the pipeline execution, after the load, users can use casts as they deem fit. This covers scenarios like converting a pig type (other than byte array) to byte array followed by a conversion of the byte array to the same or a different pig type (Scenario 2). Consider the hypothetical use of the cast below.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;myfile&apos;&lt;/span&gt; as (t: tuple(i: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, f: &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;));

b = foreach a generate (bytearray) $0;

c = foreach b generate (tuple(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)) $0;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The tuple is first cast to a byte array and then cast back to a tuple. In order to facilitate these types of casts, the byte array representation should retain information about the original type it was cast from. This information is conceptually encapsulated in the load function, which supports the ability to convert bytes to pig types. The inverse mechanism of converting pig types to bytes will nicely fit in the context of the load function. This will enable pig to use the conversion and inversion hooks in the load function to convert bytes to pig types and vice versa in the context of the pipeline execution (Scenario 2).&lt;/p&gt;

&lt;p&gt;The obvious benefit of this approach: Store functions which understand the byte representation of the data can now convert the bytes back in  the format of choice (Scenario 3).&lt;/p&gt;

&lt;p&gt;Summary:&lt;/p&gt;

&lt;p&gt;1. Load function interface supports  toBytes for each pig type in addition to bytesToInteger, bytesToLong, etc.&lt;br/&gt;
2. POCast uses the load function to convert bytes to pig types and vice versa&lt;br/&gt;
3. PigStorage will be extended to support complex types (tuples, bags, maps) and provide inverse functions, i.e., convert pig types to bytes representation&lt;/p&gt;</comment>
                            <comment id="12614107" author="sms" created="Wed, 16 Jul 2008 21:17:16 +0000"  >&lt;p&gt;This issue will be fixed a bit later, i.e., lowering the priority.&lt;/p&gt;</comment>
                            <comment id="12615448" author="sms" created="Mon, 21 Jul 2008 21:57:11 +0000"  >&lt;p&gt;The patch (pig_type_to_bytearray.patch) includes the following:&lt;/p&gt;

&lt;p&gt;1. The load function interface is extended to include toBytes, a method that will convert Pig Types to the appropriate byte representation that can be used with the bytesToPigType routine&lt;/p&gt;

&lt;p&gt;2. The methods are implemented in all the classes that implement the load function interface, i.e., PigStorage, BinStorage, TextLoader, private classes used in the unit test cases, etc.&lt;/p&gt;

&lt;p&gt;3. A text data parser that converts text data to Pig Types&lt;/p&gt;

&lt;p&gt;4. Unit test cases for the conversion routines and the casts.&lt;/p&gt;

&lt;p&gt;5. Helper methods in DataType.java for checking equal byte arrays and converting Pig Map to strings.&lt;/p&gt;


&lt;p&gt;TODO:&lt;/p&gt;

&lt;p&gt;The byte arrays are parsed as strings as the parser cannot distinguish between the two.&lt;/p&gt;

&lt;p&gt;Unit test cases that still fail are:&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestEvalPipeline&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 8, Failures: 0, Errors: 1, Time elapsed: 179.904 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestEvalPipeline FAILED&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestFilterOpNumeric&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 8, Failures: 0, Errors: 1, Time elapsed: 56.124 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestFilterOpNumeric FAILED&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestBuiltin&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 23, Failures: 1, Errors: 1, Time elapsed: 14.8 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestBuiltin FAILED&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestStoreOld&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 3, Failures: 0, Errors: 2, Time elapsed: 21.453 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestStoreOld FAILED&lt;/p&gt;</comment>
                            <comment id="12615451" author="sms" created="Mon, 21 Jul 2008 22:21:22 +0000"  >&lt;p&gt;Ignore my previous patch. I will be uploading a new one shortly. One of the new files was not added to the patch.&lt;/p&gt;</comment>
                            <comment id="12615453" author="sms" created="Mon, 21 Jul 2008 22:41:46 +0000"  >&lt;p&gt;Replacing the old patch with the new one. The new patch includes the TextDataParser.jjt file.&lt;/p&gt;</comment>
                            <comment id="12616492" author="pi_song" created="Thu, 24 Jul 2008 14:38:26 +0000"  >&lt;p&gt;Is there really a scenario where users might want to cast a known type to bytearray and cast it back? I think users should be more happy to always work with the known type.&lt;/p&gt;

&lt;p&gt;According to the Jira title, I guess if a user, for example, wants UTF-8 representation of Chararray, then he should use a UDF which returns ByteArray, not casting.&lt;/p&gt;

&lt;p&gt;My concern is that we shouldn&apos;t make LoadFunc more complex just to support an operation which doesn&apos;t actually have a real use.&lt;/p&gt;</comment>
                            <comment id="12616493" author="pi_song" created="Thu, 24 Jul 2008 14:40:13 +0000"  >&lt;p&gt;BTW, Sorry for late reply.&lt;/p&gt;</comment>
                            <comment id="12616671" author="olgan" created="Thu, 24 Jul 2008 21:52:16 +0000"  >&lt;p&gt;I reviewed the patch.&lt;/p&gt;

&lt;p&gt;My feedback is that I don&apos;t think we need to support cast to bytearray. I can think of any reasonable use cases for it and makes a more common case of writing custom load function more complex.&lt;/p&gt;</comment>
                            <comment id="12617241" author="sms" created="Sun, 27 Jul 2008 05:15:06 +0000"  >&lt;p&gt;Casts to bytearray are no longer allowed. The patch includes the following:&lt;/p&gt;

&lt;p&gt;1. Parser throws an exception when explicit casts to bytearray are seen&lt;/p&gt;

&lt;p&gt;2. Type checker throws an exception when implicit casts to bytearray are used&lt;/p&gt;

&lt;p&gt;3. The load interface does not have toBytes(PigType) methods&lt;/p&gt;

&lt;p&gt;4. The toBytes method in Utf8StorageConverter.java, BinStorage.java and TextLoader.java are retained for future use&lt;/p&gt;

&lt;p&gt;5. A text data parser that converts text data to Pig Types&lt;/p&gt;

&lt;p&gt;6. Unit test cases for the conversion routines and the casts.&lt;/p&gt;

&lt;p&gt;7. Helper methods in DataType.java for checking equal byte arrays and converting Pig Map to strings.&lt;/p&gt;

&lt;p&gt;TODO:&lt;/p&gt;

&lt;p&gt;The byte arrays are parsed as strings as the parser cannot distinguish between the two.&lt;/p&gt;

&lt;p&gt;Unit tests that still fail are:&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestBuiltin&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 23, Failures: 1, Errors: 1, Time elapsed: 14.986 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestBuiltin FAILED&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestEvalPipeline&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 9, Failures: 0, Errors: 1, Time elapsed: 159.046 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestEvalPipeline FAILED&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestFilterOpNumeric&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 8, Failures: 0, Errors: 1, Time elapsed: 56.258 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestFilterOpNumeric FAILED&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestStoreOld&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 3, Failures: 0, Errors: 2, Time elapsed: 41.005 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestStoreOld FAILED&lt;/p&gt;</comment>
                            <comment id="12617548" author="alangates" created="Mon, 28 Jul 2008 21:16:21 +0000"  >&lt;p&gt;One question on parsing complex types in PigStorage.  In the function parseFromBytes, which is called on every complex field that is parsed, you construct a new TextDataParser to parse that field.  Is that necessary?  Can the same one not be used repeatedly?&lt;/p&gt;</comment>
                            <comment id="12618014" author="sms" created="Tue, 29 Jul 2008 23:30:02 +0000"  >&lt;p&gt;The text data parser is reused in the parseFromBytes() method in Utf8StorageConverter.&lt;/p&gt;

&lt;p&gt;Unit tests that still fail are:&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestBuiltin&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 23, Failures: 1, Errors: 1, Time elapsed: 14.732 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestBuiltin FAILED&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestFilterOpNumeric&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 8, Failures: 0, Errors: 1, Time elapsed: 56.902 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestFilterOpNumeric FAILED&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestStoreOld&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 3, Failures: 0, Errors: 2, Time elapsed: 41.091 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestStoreOld FAILED&lt;/p&gt;</comment>
                            <comment id="12618783" author="alangates" created="Thu, 31 Jul 2008 17:59:49 +0000"  >&lt;p&gt;remove_cast_to_bytearray_reuse_parser.patch checked in.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12386582" name="pig_type_to_bytearray.patch" size="47426" author="sms" created="Mon, 21 Jul 2008 22:41:46 +0000"/>
                            <attachment id="12386968" name="remove_cast_to_bytearray.patch" size="54994" author="sms" created="Sun, 27 Jul 2008 05:15:06 +0000"/>
                            <attachment id="12387149" name="remove_cast_to_bytearray_reuse_parser.patch" size="52922" author="sms" created="Tue, 29 Jul 2008 23:30:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38591</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gikv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94440</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>