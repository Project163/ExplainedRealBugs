<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:03:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-5375] NullPointerException for multi-level self unions with Tez UnionOptimizer</title>
                <link>https://issues.apache.org/jira/browse/PIG-5375</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
A = load &lt;span class=&quot;code-quote&quot;&gt;&apos;input.txt&apos;&lt;/span&gt; as (a0:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, a1: chararray, a2:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
B = load &lt;span class=&quot;code-quote&quot;&gt;&apos;input.txt&apos;&lt;/span&gt; as (a0:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, a1: chararray, a2:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
C = load &lt;span class=&quot;code-quote&quot;&gt;&apos;input.txt&apos;&lt;/span&gt; as (a0:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, a1: chararray, a2:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);

A_and_B = UNION A, B;
SPLIT A_and_B INTO A_and_B2 IF a0 &amp;gt; 10, A_and_B3 OTHERWISE;

A_and_B_and_C = UNION ONSCHEMA C, A_and_B;

X = UNION ONSCHEMA A_and_B_and_C, A_and_B2, A_and_B3;

X2 = GROUP X ALL ;

dump X2;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This fails &lt;em&gt;on Tez&lt;/em&gt; with &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Pig Stack Trace
---------------
ERROR 1002: Unable to store alias X2

org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1066: Unable to open iterator for alias X2
        at org.apache.pig.PigServer.openIterator(PigServer.java:1024)
        at org.apache.pig.tools.grunt.GruntParser.processDump(GruntParser.java:790)
        at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:383)
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:231)
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:206)
        at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:81)
        at org.apache.pig.Main.run(Main.java:630)
        at org.apache.pig.Main.main(Main.java:175)
Caused by: org.apache.pig.PigException: ERROR 1002: Unable to store alias X2
        at org.apache.pig.PigServer.storeEx(PigServer.java:1127)
        at org.apache.pig.PigServer.store(PigServer.java:1086)
        at org.apache.pig.PigServer.openIterator(PigServer.java:999)
        ... 7 more
Caused by: org.apache.pig.backend.executionengine.ExecException: ERROR 0: java.lang.NullPointerException
        at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.launchPig(HExecutionEngine.java:296)
        at org.apache.pig.PigServer.launchPlan(PigServer.java:1479)
        at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:1464)
        at org.apache.pig.PigServer.storeEx(PigServer.java:1123)
        ... 9 more
Caused by: java.lang.NullPointerException
        at org.apache.pig.backend.hadoop.executionengine.tez.plan.TezPOPackageAnnotator.patchPackage(TezPOPackageAnnotator.java:97)
        at org.apache.pig.backend.hadoop.executionengine.tez.plan.TezPOPackageAnnotator.handlePackage(TezPOPackageAnnotator.java:78)
        at org.apache.pig.backend.hadoop.executionengine.tez.plan.TezPOPackageAnnotator.visitTezOp(TezPOPackageAnnotator.java:61)
        at org.apache.pig.backend.hadoop.executionengine.tez.plan.TezOperator.visit(TezOperator.java:265)
        at org.apache.pig.backend.hadoop.executionengine.tez.plan.TezOperator.visit(TezOperator.java:56)
        at org.apache.pig.impl.plan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:69)
        at org.apache.pig.impl.plan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:71)
        at org.apache.pig.impl.plan.DepthFirstWalker.depthFirst(DepthFirstWalker.java:71)
        at org.apache.pig.impl.plan.DepthFirstWalker.walk(DepthFirstWalker.java:52)
        at org.apache.pig.impl.plan.PlanVisitor.visit(PlanVisitor.java:46)
        at org.apache.pig.backend.hadoop.executionengine.tez.TezLauncher.launchPig(TezLauncher.java:197)
        at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.launchPig(HExecutionEngine.java:290)
        ... 12 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13208414">PIG-5375</key>
            <summary>NullPointerException for multi-level self unions with Tez UnionOptimizer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jan 2019 22:12:48 +0000</created>
                <updated>Mon, 15 Sep 2025 11:29:03 +0000</updated>
                            <resolved>Wed, 3 Jul 2019 17:51:29 +0000</resolved>
                                                    <fixVersion>0.18.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16738553" author="knoguchi" created="Wed, 9 Jan 2019 19:08:46 +0000"  >&lt;p&gt;Script in the description works when last union only has store-outputs.&lt;br/&gt;
 (Doing &lt;tt&gt;dump X&lt;/tt&gt; instead of &lt;tt&gt;dump X2&lt;/tt&gt;.)&lt;/p&gt;

&lt;p&gt;This is because Tez&apos;s UnionOptimizer.java has slightly different logic for store-outputs&#160;compared to handling of non-store-outputs.&lt;/p&gt;

&lt;p&gt;Attaching a patch that changes the logic of non-store-outputs and making it similar to how store-outputs finds&#160;existingVertexGroup at the beginning.&lt;/p&gt;</comment>
                            <comment id="16744494" author="knoguchi" created="Wed, 16 Jan 2019 22:05:27 +0000"  >&lt;p&gt;For my reference (and maybe for the reviewer) attaching how the plan evolved with vertexgroup by the UnionOptimizer before my patch.&#160; (using the script from the description)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12955153/pig-5375.png&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12955153/pig-5375.png&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Note the bottom of the vertex group output&lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;Tez vertex group scope-87 &amp;lt;- &lt;span class=&quot;error&quot;&gt;&amp;#91;&lt;font color=&quot;#FF0000&quot;&gt;scope-56&lt;/font&gt;, scope-53, &lt;font color=&quot;#FF0000&quot;&gt;scope-56&lt;/font&gt;, scope-54, scope-55&amp;#93;&lt;/span&gt; -&amp;gt; scope-81&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;where the scope-56 no longer exist. What my patch does is, instead of replacing one scope-56 with scope-54&amp;amp;scope-55, it replaces all three scope-56 with scope-54&amp;amp;scope-55.&lt;br/&gt;
 &#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16871741" author="rohini" created="Mon, 24 Jun 2019 19:55:18 +0000"  >&lt;p&gt;+1. Thanks for cleaning up the code and simplifying it Koji.&lt;/p&gt;</comment>
                            <comment id="16878031" author="knoguchi" created="Wed, 3 Jul 2019 17:51:29 +0000"  >&lt;p&gt;Thanks for the review Rohini!  Committed to trunk(0.18).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12954344" name="pig-5375-v1.patch" size="19631" author="knoguchi" created="Wed, 9 Jan 2019 19:06:11 +0000"/>
                            <attachment id="12955153" name="pig-5375.png" size="240209" author="knoguchi" created="Wed, 16 Jan 2019 22:08:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00n8g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>