<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:49:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-665] Map key type not correctly set (for use when key is null) when map plan does not have localrearrange</title>
                <link>https://issues.apache.org/jira/browse/PIG-665</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;KeyTypeDiscoveryVisitor visits the map plan to figure out the datatype of the map key. This is required so that when the map key is null, we can still construct a valid NullableXXXWritable object to pass on to hadoop in the collect() call (hadoop needs a valid object even for null objects). Currently the KeyTypeDiscoveryVisitor only looks at POPackage and POLocalRearrange to figure out the key type. In a pig script which results in multiple Map reduce jobs, one of the jobs could have a map plan with only POLoads in it. In such a case, the map key type is not discovered and this results in a null being returned from HDataType.getWritableComparableTypes() method. This in turn will result in a NullPointerException in the collect().&lt;/p&gt;

&lt;p&gt;Here is a script which can prompt this behavior:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;a.txt&apos;&lt;/span&gt; as (x:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, y:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, z:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
b = load &lt;span class=&quot;code-quote&quot;&gt;&apos;b.txt&apos;&lt;/span&gt; as (x:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, y:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;);
b_group = group b by x;
b_sum = foreach b_group generate flatten(group) as x, SUM(b.y) as clicks;
a_group = group a by (x, y);
a_aggs = foreach a_group {
            generate 
                flatten(group) as (x, y),
                SUM(a.z) as zs;
                };
join_a_b = join b_sum by x, a_aggs by x; --&amp;gt; the map plan &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; join will only have two POLoads which will result in the NullPointerException at runtime in collect()
dump join_a_b;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;Contents of a.txt (columns are tab separated):&lt;br/&gt;
The first column of the first two rows is null (represented by an empty column)&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        7       8
        8       9
1       20      30
1       20      40
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Contents of b.txt (columns are tab separated):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;7       2
1       5
1       10
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12414608">PIG-665</key>
            <summary>Map key type not correctly set (for use when key is null) when map plan does not have localrearrange</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pkamath">Pradeep Kamath</assignee>
                                    <reporter username="pkamath">Pradeep Kamath</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Feb 2009 20:06:59 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:17 +0000</updated>
                            <resolved>Thu, 12 Feb 2009 22:54:39 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12673041" author="pkamath" created="Thu, 12 Feb 2009 20:19:27 +0000"  >&lt;p&gt;The issue as described in the description was that when the map plan has only POLoad, KeyTypeDiscoveryVisitor fails to find the map Key type (since it is only visiting POPackage and POLocalRearrange). The fix has the following changes to address the issue:&lt;br/&gt;
1) The visitor no longer visits POPackage since map key type information should only come from a POLocalRearrange&lt;br/&gt;
2) First the visitor tries to visit POLocalRearranges in the map plan - if it does not find the key type, it looks visits the reduce plans of its predecessor MapReduceOpers. If there are no predecessors, then this could be a simple load-store script, so the visitor normally terminates. If it discovers the same key types from its predecessors, it succeeds else it aborts since it should be getting identical key type from all its predecessors (which should be having the corresponding POLocalRearranges). If the visitor is unable to discover the key type in the map plan or in the predecessors, then a check is made if there is reduce phase to curent mapReduceOper. Only if there is a reduce phase and we are unable to discover the key type, the visitor aborts with a failure.&lt;/p&gt;

&lt;p&gt;I have added a unit test case for the script in this issue. I have also added a visit method in POCombinerPackage as part of this patch since it was missing one.  &lt;/p&gt;</comment>
                            <comment id="12673079" author="olgan" created="Thu, 12 Feb 2009 22:40:43 +0000"  >&lt;p&gt;+1; please, commit&lt;/p&gt;</comment>
                            <comment id="12673082" author="pkamath" created="Thu, 12 Feb 2009 22:54:39 +0000"  >&lt;p&gt;Patch committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12400127" name="PIG-665.patch" size="11053" author="pkamath" created="Thu, 12 Feb 2009 20:19:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164247</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 41 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gmwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95140</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>