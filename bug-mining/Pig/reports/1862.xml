<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4940] Predicate push-down filtering unary expressions can be pushed.</title>
                <link>https://issues.apache.org/jira/browse/PIG-4940</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;While testing predicate push-down, I ran into the following error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Pig Exception&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR 0: Unsupported conversion of LogicalExpression to Expression: Map
        at org.apache.pig.newplan.FilterExtractor.getExpression(FilterExtractor.java:389)
        at org.apache.pig.newplan.FilterExtractor.getExpression(FilterExtractor.java:401)
        at org.apache.pig.newplan.FilterExtractor.getExpression(FilterExtractor.java:378)
        at org.apache.pig.newplan.FilterExtractor.getExpression(FilterExtractor.java:401)
        at org.apache.pig.newplan.FilterExtractor.getExpression(FilterExtractor.java:380)
        at org.apache.pig.newplan.FilterExtractor.visit(FilterExtractor.java:109)
        at org.apache.pig.newplan.PredicatePushDownFilterExtractor.visit(PredicatePushDownFilterExtractor.java:70)
        at org.apache.pig.newplan.logical.rules.PredicatePushdownOptimizer$PredicatePushDownTransformer.transform(PredicatePushdownOptimizer.java:146)
        at org.apache.pig.newplan.optimizer.PlanOptimizer.optimize(PlanOptimizer.java:110)
        ... 19 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is that the code is trying to push a map access operation, that isn&apos;t supported. The cause appears to be the logic in &lt;tt&gt;checkPushDown(UnaryExpression)&lt;/tt&gt; that separates expressions that can be pushed from expressions that must be run by Pig. This function assumes that any expression under &lt;tt&gt;IsNullExpression&lt;/tt&gt; or &lt;tt&gt;NotExpression&lt;/tt&gt; can be pushed and adds the unary node&apos;s child expression to the pushdown expression without calling &lt;tt&gt;checkPushDown&lt;/tt&gt; on it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12984474">PIG-4940</key>
            <summary>Predicate push-down filtering unary expressions can be pushed.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rdblue">Ryan Blue</assignee>
                                    <reporter username="rdblue">Ryan Blue</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Jun 2016 19:16:47 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:11 +0000</updated>
                            <resolved>Tue, 19 Jul 2016 00:49:03 +0000</resolved>
                                                    <fixVersion>0.17.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15353570" author="githubbot" created="Tue, 28 Jun 2016 19:21:21 +0000"  >&lt;p&gt;GitHub user rdblue opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/pig/pull/25&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/pig/pull/25&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4940&quot; title=&quot;Predicate push-down filtering unary expressions can be pushed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4940&quot;&gt;&lt;del&gt;PIG-4940&lt;/del&gt;&lt;/a&gt;: Fix predicate push-down Unary expressions.&lt;/p&gt;

&lt;p&gt;    Rather than assuming any child expression of `IsNullExpression` and&lt;br/&gt;
    `NotExpression` can be pushed down, this calls `checkPushDown` on the child&lt;br/&gt;
    and will push the entire expression if and only if the entire child can&lt;br/&gt;
    be pushed.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rdblue/pig&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rdblue/pig&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4940&quot; title=&quot;Predicate push-down filtering unary expressions can be pushed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4940&quot;&gt;&lt;del&gt;PIG-4940&lt;/del&gt;&lt;/a&gt;-unary-expression-push-down&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/pig/pull/25.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/pig/pull/25.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #25&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0b23e3af0d6432a3736e7101f6fdea20b03382cc&lt;br/&gt;
Author: Ryan Blue &amp;lt;blue@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-06-28T19:02:28Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4940&quot; title=&quot;Predicate push-down filtering unary expressions can be pushed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4940&quot;&gt;&lt;del&gt;PIG-4940&lt;/del&gt;&lt;/a&gt;: Fix predicate push-down Unary expressions.&lt;/p&gt;

&lt;p&gt;    Rather than assuming any child expression of IsNullExpression and&lt;br/&gt;
    NotExpression can be pushed down, this calls checkPushDown on the child&lt;br/&gt;
    and will push the entire expression if and only if the entire child can&lt;br/&gt;
    be pushed.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15353571" author="rdblue" created="Tue, 28 Jun 2016 19:21:51 +0000"  >&lt;p&gt;Fixed by PR #25.&lt;/p&gt;</comment>
                            <comment id="15353620" author="rdblue" created="Tue, 28 Jun 2016 20:02:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cheolsoo&quot; class=&quot;user-hover&quot; rel=&quot;cheolsoo&quot;&gt;cheolsoo&lt;/a&gt;, you may be interested in this.&lt;/p&gt;</comment>
                            <comment id="15353741" author="cheolsoo" created="Tue, 28 Jun 2016 21:24:37 +0000"  >&lt;p&gt;Sorry, but I&apos;ll let someone who is still active in the community review your patch...&lt;/p&gt;</comment>
                            <comment id="15359503" author="daijy" created="Fri, 1 Jul 2016 19:16:22 +0000"  >&lt;p&gt;Can you attach patch instead? Would you mind a test case?&lt;/p&gt;</comment>
                            <comment id="15371646" author="rdblue" created="Mon, 11 Jul 2016 21:17:49 +0000"  >&lt;p&gt;I attached a patch with my changes. The case that we hit is a &quot;not map_column#&apos;prop&apos; is null&quot; expression. The map access can&apos;t be pushed down, but the code assumes that anything under a unary expression can be.&lt;/p&gt;

&lt;p&gt;I looked at writing a test, but I don&apos;t see a test suite for predicate push-down in the FilterExpression code already there so it will take me a while to wrap my head around what needs to be done. I&apos;m not very familiar with the Pig internals necessary to cleanly test this. If someone can help with the setup, I can get a test case written pretty quickly. Otherwise, it may take me some time so I&apos;m posting the patch now so you can get started looking at it in the mean time.&lt;/p&gt;</comment>
                            <comment id="15371684" author="rohini" created="Mon, 11 Jul 2016 21:34:20 +0000"  >&lt;p&gt;You can add the test to TestOrcStoragePushdown.java&lt;/p&gt;</comment>
                            <comment id="15371908" author="rdblue" created="Mon, 11 Jul 2016 23:40:43 +0000"  >&lt;p&gt;Adding a test for this, testUnSupportedFieldsWithUnaryExpression, in the Orc push-down suite. The case demonstrates that &quot;not browser#&apos;type&apos; is null&quot; is not pushed down. The testNot and testAndOr cases already verify that the &quot;is null&quot;  predicate (and the negated form) works when the column is not a map access and can be pushed.&lt;/p&gt;</comment>
                            <comment id="15371909" author="rdblue" created="Mon, 11 Jul 2016 23:41:06 +0000"  >&lt;p&gt;Thanks for your help! I added a test to the Orc suite.&lt;/p&gt;</comment>
                            <comment id="15381221" author="daijy" created="Sun, 17 Jul 2016 08:18:08 +0000"  >&lt;p&gt;The fix looks good. However, the test case fits better in TestNewPartitionFilterPushDown since it is not Orc specific. Can you move it?&lt;/p&gt;</comment>
                            <comment id="15381566" author="rdblue" created="Sun, 17 Jul 2016 22:53:24 +0000"  >&lt;p&gt;That&apos;s where we get back to my lack of knowledge of Pig. The tests in TestNewPartitionFilterPushDown require a lot of knowledge of Pig internals that I don&apos;t have. I can try over the next few months if someone can help me out with where to start.&lt;/p&gt;</comment>
                            <comment id="15381588" author="daijy" created="Sun, 17 Jul 2016 23:54:53 +0000"  >&lt;p&gt;No worry, I can move it.&lt;/p&gt;</comment>
                            <comment id="15381620" author="rdblue" created="Mon, 18 Jul 2016 01:40:18 +0000"  >&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="15383286" author="daijy" created="Mon, 18 Jul 2016 23:29:42 +0000"  >&lt;p&gt;Move the test to TestNewPartitionFilterPushDown.&lt;/p&gt;</comment>
                            <comment id="15383391" author="rdblue" created="Tue, 19 Jul 2016 00:48:43 +0000"  >&lt;p&gt;+1. Thanks for your help!&lt;/p&gt;</comment>
                            <comment id="15383393" author="daijy" created="Tue, 19 Jul 2016 00:49:04 +0000"  >&lt;p&gt;Patch committed to trunk. Thanks Ryan!&lt;/p&gt;</comment>
                            <comment id="15383396" author="rdblue" created="Tue, 19 Jul 2016 00:50:40 +0000"  >&lt;p&gt;I also just noticed that the &lt;tt&gt;visit&lt;/tt&gt; method in FilterExtractor assumes that the root expression is going to be a binary expression. If you try to filter with just &quot;is null&quot; or &quot;is not null&quot; then predicate push-down isn&apos;t triggered. There&apos;s a simple patch. Should I attach it here based on &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;&apos;s latest changes, or should I open a new issue?&lt;/p&gt;</comment>
                            <comment id="15383397" author="rdblue" created="Tue, 19 Jul 2016 00:51:32 +0000"  >&lt;p&gt;Nevermind, this was committed. I&apos;ll fix the second problme in a new JIRA issue. From looking at Daniel&apos;s test, I think I can replicate it this time.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12990814">PIG-4953</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12817231" name="PIG-4940.1.patch" size="2481" author="rdblue" created="Mon, 11 Jul 2016 20:16:21 +0000"/>
                            <attachment id="12817292" name="PIG-4940.2.patch" size="3681" author="rdblue" created="Mon, 11 Jul 2016 23:40:43 +0000"/>
                            <attachment id="12818696" name="PIG-4940.3.patch" size="3882" author="daijy" created="Mon, 18 Jul 2016 23:29:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 18 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i309wn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>