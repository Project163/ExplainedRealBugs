<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:00:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4345] e2e test &quot;RubyUDFs_13&quot; fails because of the different result of &quot;group a all&quot; in different engines like &quot;spark&quot;, &quot;mapreduce&quot;</title>
                <link>https://issues.apache.org/jira/browse/PIG-4345</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;RubyUDFs e2e scrip is on the line 3818 of nightly.conf : &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                    &lt;span class=&quot;code-quote&quot;&gt;&apos;num&apos;&lt;/span&gt; =&amp;gt; 13,
                    &lt;span class=&quot;code-quote&quot;&gt;&apos;java_params&apos;&lt;/span&gt; =&amp;gt; [&lt;span class=&quot;code-quote&quot;&gt;&apos;-Dpig.accumulative.batchsize=5&apos;&lt;/span&gt;],
                    &lt;span class=&quot;code-quote&quot;&gt;&apos;pig&apos;&lt;/span&gt; =&amp;gt; q\
register &lt;span class=&quot;code-quote&quot;&gt;&apos;:SCRIPTHOMEPATH:/ruby/morerubyudfs.rb&apos;&lt;/span&gt; using jruby as myfuncs;
a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;:INPATH:/singlefile/studenttab10k&apos;&lt;/span&gt; using PigStorage() as (name, age:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;);
b = foreach (group a all) generate FLATTEN(myfuncs.AppendIndex(a));
store b into &lt;span class=&quot;code-quote&quot;&gt;&apos;:OUTPATH:&apos;&lt;/span&gt;;\,
                    &lt;span class=&quot;code-quote&quot;&gt;&apos;verify_pig_script&apos;&lt;/span&gt; =&amp;gt; q\
register :FUNCPATH:/testudf.jar;
a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;:INPATH:/singlefile/studenttab10k&apos;&lt;/span&gt; using PigStorage() as (name, age:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;);
b = foreach (group a all) generate FLATTEN(org.apache.pig.test.udf.evalfunc.AppendIndex(a));
store b into &lt;span class=&quot;code-quote&quot;&gt;&apos;:OUTPATH:&apos;&lt;/span&gt;;\,
                    },
                ]
            },
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;RubyUDFs_13.pig tests ruby udf &quot;AppendIndex&quot; in &quot;morerubyudfs.rb&quot;.  The output is compared with verified script which use java udf &quot;org.apache.pig.test.udf.evalfunc.AppendIndex&quot;. The output of &quot;RubyUDFs_13.pig&quot; is like following:&lt;/p&gt;

&lt;p&gt;If test file &#8220;studemttab10k&#8221; is &lt;/p&gt;

&lt;p&gt;tom thompson	42	0.53&lt;br/&gt;
nick johnson	34	0.47&lt;br/&gt;
priscilla falkner	55	1.16&lt;/p&gt;

&lt;p&gt;the result in spark engine will be:&lt;br/&gt;
tom thompson	42	0.53   1&lt;br/&gt;
nick johnson	34	0.47   2&lt;br/&gt;
priscilla falkner	55	1.16  3&lt;/p&gt;


&lt;p&gt;the result in mapreduce engine which verified script uses  will be &lt;br/&gt;
priscilla falkner	55	1.16  1&lt;br/&gt;
nick johnson	34	0.47  2&lt;br/&gt;
tom thompson	42	0.53  3&lt;/p&gt;

&lt;p&gt;The difference between the result in spark and mapreduce engine cause RubyUDFs_13 e2e test failure .&lt;br/&gt;
The root cause of the difference is because &#8220;group a all&#8221; has  different result in different engines. &lt;br/&gt;
 In Spark engine, &#8220;group a all&#8221; :&lt;br/&gt;
all &lt;/p&gt;
{ (tom thompson	42	0.53),( nick johnson	34	0.47),( priscilla falkner	55	1.16)}
&lt;p&gt;In mapreduce engine , &#8220;group a all&#8221;:&lt;br/&gt;
all &lt;/p&gt;
{( priscilla falkner	55	1.16), ( nick johnson	34	0.47),(tom thompson	42	0.53)}

&lt;p&gt;Using &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4345&quot; title=&quot;e2e test &amp;quot;RubyUDFs_13&amp;quot; fails because of the different result of &amp;quot;group a all&amp;quot; in different engines like &amp;quot;spark&amp;quot;, &amp;quot;mapreduce&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4345&quot;&gt;&lt;del&gt;PIG-4345&lt;/del&gt;&lt;/a&gt;.patch, RubyUDF_13 e2e test passes.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{
                    &lt;span class=&quot;code-quote&quot;&gt;&apos;num&apos;&lt;/span&gt; =&amp;gt; 13,
                    &lt;span class=&quot;code-quote&quot;&gt;&apos;java_params&apos;&lt;/span&gt; =&amp;gt; [&lt;span class=&quot;code-quote&quot;&gt;&apos;-Dpig.accumulative.batchsize=5&apos;&lt;/span&gt;],
                    &lt;span class=&quot;code-quote&quot;&gt;&apos;pig&apos;&lt;/span&gt; =&amp;gt; q\
register &lt;span class=&quot;code-quote&quot;&gt;&apos;:SCRIPTHOMEPATH:/ruby/morerubyudfs.rb&apos;&lt;/span&gt; using jruby as myfuncs;
a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;:INPATH:/singlefile/studenttab10k&apos;&lt;/span&gt; using PigStorage() as (name, age:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;);
a1 = filter a by name == &lt;span class=&quot;code-quote&quot;&gt;&apos;nick johnson&apos;&lt;/span&gt;;
a2 = filter a1 by age == 34;
b =  foreach (group a2 all) generate FLATTEN(myfuncs.AppendIndex(a2));
store b into &lt;span class=&quot;code-quote&quot;&gt;&apos;:OUTPATH:&apos;&lt;/span&gt;;\,
                    &lt;span class=&quot;code-quote&quot;&gt;&apos;verify_pig_script&apos;&lt;/span&gt; =&amp;gt; q\
register :FUNCPATH:/testudf.jar;
a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;:INPATH:/singlefile/studenttab10k&apos;&lt;/span&gt; using PigStorage() as (name, age:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;);
a1 = filter a by name == &lt;span class=&quot;code-quote&quot;&gt;&apos;nick johnson&apos;&lt;/span&gt;;
a2 = filter a1 by age == 34;
b =  foreach (group a2 all) generate FLATTEN(org.apache.pig.test.udf.evalfunc.AppendIndex(a2));
store b into &lt;span class=&quot;code-quote&quot;&gt;&apos;:OUTPATH:&apos;&lt;/span&gt;;\,
                    },
                ]
            },
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;using &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4345&quot; title=&quot;e2e test &amp;quot;RubyUDFs_13&amp;quot; fails because of the different result of &amp;quot;group a all&amp;quot; in different engines like &amp;quot;spark&amp;quot;, &amp;quot;mapreduce&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4345&quot;&gt;&lt;del&gt;PIG-4345&lt;/del&gt;&lt;/a&gt;.patch, the result in spark and mapreduce engine will be:&lt;/p&gt;

&lt;p&gt;nick johnson	34	0.47  1&lt;/p&gt;</description>
                <environment></environment>
        <key id="12758111">PIG-4345</key>
            <summary>e2e test &quot;RubyUDFs_13&quot; fails because of the different result of &quot;group a all&quot; in different engines like &quot;spark&quot;, &quot;mapreduce&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kellyzly">liyunzhang</assignee>
                                    <reporter username="kellyzly">liyunzhang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Nov 2014 02:06:56 +0000</created>
                <updated>Sun, 7 Jun 2015 03:48:36 +0000</updated>
                            <resolved>Mon, 1 Dec 2014 19:42:33 +0000</resolved>
                                                    <fixVersion>0.15.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14229376" author="rohini" created="Mon, 1 Dec 2014 03:10:37 +0000"  >&lt;p&gt;Can you just add a order by in nested foreach instead? i.e&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;b =  foreach (group a all) {
 a1= ORDER a by name;
 generate FLATTEN(myfuncs.AppendIndex(a1));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14229524" author="kellyzly" created="Mon, 1 Dec 2014 08:24:36 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;&apos;s comment.  I have uploaded &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4345&quot; title=&quot;e2e test &amp;quot;RubyUDFs_13&amp;quot; fails because of the different result of &amp;quot;group a all&amp;quot; in different engines like &amp;quot;spark&amp;quot;, &amp;quot;mapreduce&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4345&quot;&gt;&lt;del&gt;PIG-4345&lt;/del&gt;&lt;/a&gt;_1.patch.  The changes are:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; register &lt;span class=&quot;code-quote&quot;&gt;&apos;:SCRIPTHOMEPATH:/ruby/morerubyudfs.rb&apos;&lt;/span&gt; using jruby as myfuncs;
    a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;:INPATH:/singlefile/studenttab10k&apos;&lt;/span&gt; using PigStorage() as (name, age:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa    :&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;);
   -b = foreach (group a all) generate FLATTEN(myfuncs.AppendIndex(a));
  +b = foreach (group a all){
  +   a1= order a by name,age,gpa;
  +   generate FLATTEN(myfuncs.AppendIndex(a1));
  +}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When ordering by name,age and gpa these three field, the output of b in &apos;spark&apos; and &apos;mapreduce&apos; engines are same.&lt;/p&gt;</comment>
                            <comment id="14229526" author="kellyzly" created="Mon, 1 Dec 2014 08:25:32 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;, can you help review &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4345&quot; title=&quot;e2e test &amp;quot;RubyUDFs_13&amp;quot; fails because of the different result of &amp;quot;group a all&amp;quot; in different engines like &amp;quot;spark&amp;quot;, &amp;quot;mapreduce&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4345&quot;&gt;&lt;del&gt;PIG-4345&lt;/del&gt;&lt;/a&gt;_1.patch?&lt;/p&gt;</comment>
                            <comment id="14230313" author="rohini" created="Mon, 1 Dec 2014 19:42:33 +0000"  >&lt;p&gt;+1. Committed to trunk (0.15). Thanks Liyun.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12683978" name="PIG-4345.patch" size="1196" author="kellyzly" created="Thu, 27 Nov 2014 02:08:28 +0000"/>
                            <attachment id="12684366" name="PIG-4345_1.patch" size="1131" author="kellyzly" created="Mon, 1 Dec 2014 08:24:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 51 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22tzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>