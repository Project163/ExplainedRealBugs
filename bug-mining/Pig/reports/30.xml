<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:48:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-320] The parser/type checker should use the getSchema method of UDFs to deduce return type/schema</title>
                <link>https://issues.apache.org/jira/browse/PIG-320</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Currently, the parser/type checker uses the getReturnType to deduce the return type of the user defined function (UDF). This mechanism is satisfactory only for basic types (int, long, ...); for composite types (tuple, bag), the schema is also required.The abstract class EvalFunc interface exposes the outputSchema to deduce the return type/schema of the UDF. The parser/type checker should use this method to figure out the return type/schema of the UDF and use it appropriately. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12400416">PIG-320</key>
            <summary>The parser/type checker should use the getSchema method of UDFs to deduce return type/schema</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sms">Santhosh Muthur Srinivasan</assignee>
                                    <reporter username="sms">Santhosh Muthur Srinivasan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Jul 2008 21:24:44 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:04 +0000</updated>
                            <resolved>Mon, 28 Jul 2008 21:07:30 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12614242" author="sms" created="Thu, 17 Jul 2008 06:26:43 +0000"  >&lt;p&gt;The patch udf_outputSchema.patch adds the following:&lt;/p&gt;

&lt;p&gt;1. The type checker uses the outputSchema method in EvalFunc to deduce the output schema of the UDF&lt;/p&gt;

&lt;p&gt;2. The TestEvalPipeline.java:testBagFunctionWithFlattening passes the unit test cases with the addition of outputSchema method to the UDFs used inside the test case&lt;/p&gt;

&lt;p&gt;3. Adds resetSchema method to relational operators that rely on nested plans to compute schemas.&lt;/p&gt;

&lt;p&gt;4. Resets schema of all the relational operators in the type checker to ensure correctness of the computed schema due to changes in the inputs of the operators. &lt;/p&gt;

&lt;p&gt;Unit test cases that still fail are:&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestFilterOpNumeric&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 8, Failures: 0, Errors: 1, Time elapsed: 56.735 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestFilterOpNumeric FAILED&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.pig.test.TestStoreOld&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 3, Failures: 0, Errors: 2, Time elapsed: 21.46 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.pig.test.TestStoreOld FAILED&lt;/p&gt;</comment>
                            <comment id="12614550" author="alangates" created="Thu, 17 Jul 2008 22:25:11 +0000"  >&lt;p&gt;Pi, since much of these changes are in the type checker, I&apos;d like to get your feedback on them.&lt;/p&gt;

&lt;p&gt;One comment from me.  Why do POForeach and POCogroup have resetSchema() in addition to unsetSchema()?  Shouldn&apos;t their unsetSchema methods do the work that&apos;s in resetSchema?  Is there ever a case you&apos;ll want to unset the foreach&apos;s schema with unsetting it&apos;s plan&apos;s schemas?&lt;/p&gt;</comment>
                            <comment id="12614751" author="pi_song" created="Fri, 18 Jul 2008 15:08:35 +0000"  >&lt;p&gt;First, let&apos;s define a concrete EvalFunc semantic:-&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;EvalFunc: U -&amp;gt; T
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;T is hardcoded in UDF implementation but in case that T is a complex type then its schema can be determined by U&lt;/p&gt;

&lt;p&gt;getReturnType() should return the hardcoded type (e.g. Int, Double, Bag). outputSchema() should return schemas of complex types (always returning null for simple types). &lt;/p&gt;

&lt;p&gt;I think this should be simple enough for users to understand. The most common case would be users creating UDF: simpleType -&amp;gt; simpleType , they don&apos;t have to override outputSchema().&lt;/p&gt;

&lt;p&gt;Some of the current built-in functions will be broken following this semantic but they can be easily fixed.&lt;/p&gt;

&lt;p&gt;Agree?&lt;/p&gt;</comment>
                            <comment id="12614769" author="sms" created="Fri, 18 Jul 2008 16:12:48 +0000"  >&lt;p&gt;EvalFunc implements the outputSchema method and returns null. UDF writers need not implement the outputSchema method. In th typechecker code, we verify the return value of outputSchema method and if it is NULL, then the return type is set to the type returned by getReturnType().&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;//In &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void setUdfSchema
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; != udfSchema) {
...
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    func.setType(DataType.findType(ef.getReturnType()));
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12615247" author="pi_song" created="Mon, 21 Jul 2008 14:00:03 +0000"  >&lt;p&gt;I&apos;m curios about this.&lt;br/&gt;
Then if the outputSchema implementation is provided, why do extract only the first field? Isn&apos;t it more intuitive to use the whole schema directly? My suggestion might break some stuffs but it seems a bit better for users.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        Schema udfSchema = ef.outputSchema(inputSchema);
        if (null != udfSchema) {
            Schema.FieldSchema fs;
            try {
                fs = udfSchema.getField(0);
            } catch (ParseException pe) {
                throw new VisitorException(pe.getMessage());
            }
            func.setType(fs.type);
            try {
                func.setFieldSchema(fs);
            } catch (FrontendException fe) {
                throw new VisitorException(fe.getMessage());
            }
        } else {
            func.setType(DataType.findType(ef.getReturnType()));
        }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12615445" author="sms" created="Mon, 21 Jul 2008 21:49:29 +0000"  >&lt;p&gt;UDFs are expression operators that are expected to return a FieldSchema. The schema returned by outputSchema should always have a single FieldSchema inside. Hence, only the first field is extracted.&lt;/p&gt;</comment>
                            <comment id="12615593" author="pi_song" created="Tue, 22 Jul 2008 11:56:45 +0000"  >&lt;p&gt;I think it&apos;s fine in terms of internal implementation but can&apos;t we make it simpler for users by exposing simpler interface?&lt;/p&gt;</comment>
                            <comment id="12616229" author="sms" created="Wed, 23 Jul 2008 19:17:18 +0000"  >&lt;p&gt;The interface outputSchema in EvalFunc has remained unchanged from trunk. Prior to submitting the patch, I tried to change the interface and found that it broke a whole bunch of existing UDFs. There are two things that require a change:&lt;/p&gt;

&lt;p&gt;1. The outputSchema method should not take any inputs. It should be outputSchema()&lt;br/&gt;
2. The return type of the method should be a FieldSchema and not a Schema&lt;/p&gt;

&lt;p&gt;If we decide that these changes are required, I will go ahead and make these changes.&lt;/p&gt;</comment>
                            <comment id="12616461" author="pi_song" created="Thu, 24 Jul 2008 12:25:54 +0000"  >&lt;p&gt;EvalFunc interface is a bit confusing.&lt;br/&gt;
Let&apos;s wait for clarification from the mailing-list first.&lt;/p&gt;</comment>
                            <comment id="12617402" author="pi_song" created="Mon, 28 Jul 2008 10:22:27 +0000"  >&lt;p&gt;Since we don&apos;t know how EvalFunc is expected to be used. You choice of doing it at outputSchema() is one way to do and doesn&apos;t bad.&lt;br/&gt;
I agree with the patch.&lt;/p&gt;

&lt;p&gt;Please note that EvalFunc should be consolidated at some stage.&lt;/p&gt;</comment>
                            <comment id="12617544" author="alangates" created="Mon, 28 Jul 2008 21:07:30 +0000"  >&lt;p&gt;udf_outputSchema.patch checked in.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12386266" name="udf_outputSchema.patch" size="7522" author="sms" created="Thu, 17 Jul 2008 06:26:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38592</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 18 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0girz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94472</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>