<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-5223] TestLimitVariable.testNestedLimitVariable1 and TestSecondarySortMR.testNestedLimitedSort  failing</title>
                <link>https://issues.apache.org/jira/browse/PIG-5223</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;TestLimitVariable.testNestedLimitVariable1 &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Comparing actual and expected results.  expected:&amp;lt;[(1,11), (2,3), (3,10), (6,15)]&amp;gt; but was:&amp;lt;[(1,11), (2,3), (3,10), (4,11), (5,10), (6,15)]&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;TestSecondarySortMR.testNestedLimitedSort&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Error during parsing. &amp;lt;line 1, column 158&amp;gt;  mismatched input &apos;in&apos; expecting INTO&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Latter is probably a simple syntax error.  Former looks serious. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13063857">PIG-5223</key>
            <summary>TestLimitVariable.testNestedLimitVariable1 and TestSecondarySortMR.testNestedLimitedSort  failing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jins">Jin Sun</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Apr 2017 17:35:02 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:24 +0000</updated>
                            <resolved>Sat, 15 Apr 2017 05:31:51 +0000</resolved>
                                                    <fixVersion>0.17.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15968253" author="knoguchi" created="Thu, 13 Apr 2017 21:40:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jins&quot; class=&quot;user-hover&quot; rel=&quot;jins&quot;&gt;jins&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;, let me know if one of you can take this. &lt;br/&gt;
If not, I&apos;ll take a look tomorrow.&lt;/p&gt;</comment>
                            <comment id="15968342" author="jins" created="Thu, 13 Apr 2017 22:42:05 +0000"  >&lt;p&gt;I will take a look later today. Probably need some help from you guys later on.&lt;/p&gt;</comment>
                            <comment id="15968655" author="jins" created="Fri, 14 Apr 2017 05:36:06 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;&lt;br/&gt;
The second test failed should be easily fixed by changing &quot;in&quot; to &quot;into&quot;. It is just a syntax mistake.&lt;br/&gt;
However I want your opinion on the first one:&lt;br/&gt;
In this test case, limit is derived from a variable. Due to lazy evaluation, LOLimit.mLimit is -1 until execution. When we merge LOLimit into LOSort, LOSort will have limit = -1, which later gets converted to POSort with limit = -1. This is how we lost limit and fails this test. I think we should disable NestedLimitOptimizer when we find LOLimit.mLimit is -1. Please correct me if I am wrong.&lt;br/&gt;
I just made a patch and seems like tests are passing.&lt;br/&gt;
Thanks,&lt;br/&gt;
Jin&lt;/p&gt;</comment>
                            <comment id="15968656" author="jins" created="Fri, 14 Apr 2017 05:37:55 +0000"  >&lt;p&gt;1. Do not invoked NestedLimitOptimizer if LOLimit has mLimit = -1&lt;br/&gt;
2. Add more tests&lt;br/&gt;
3. Fix syntax error&lt;/p&gt;</comment>
                            <comment id="15968670" author="daijy" created="Fri, 14 Apr 2017 05:53:45 +0000"  >&lt;p&gt;Yes, you can use the condition (mLimit == -1 &amp;amp;&amp;amp; mlimitPlan != null), and if true, disable the optimization. It is possible to push the limitPlan to LimitedSortedDataBag, but it is not a one line change and we can do it in followup.&lt;/p&gt;</comment>
                            <comment id="15969105" author="jins" created="Fri, 14 Apr 2017 14:54:33 +0000"  >&lt;p&gt;Can you explain what is mlimitplan or LogicalExpressionPlan in general, and why do we want to disable the optimizer when mLimit is -1 and mlimitPlan is not null ? Thanks!&lt;/p&gt;</comment>
                            <comment id="15969250" author="daijy" created="Fri, 14 Apr 2017 16:56:41 +0000"  >&lt;p&gt;mlimitplan is an expression to calculate limit variable. That is, the number of limited rows is determined at runtime by evaluation expressionPlan (the physical plan equivalence of mlimitplan). If (mLimit == -1 &amp;amp;&amp;amp; mlimitPlan != null), that means limiting by variable not constant. It is basically the same as your (mLimit = -1) condition, but add another condition for assurance.&lt;/p&gt;</comment>
                            <comment id="15969257" author="jins" created="Fri, 14 Apr 2017 17:06:49 +0000"  >&lt;p&gt;then should it be mLimit is -1 || mlimitPlan is not null ? Please correct me if I am wrong.&lt;/p&gt;</comment>
                            <comment id="15969265" author="daijy" created="Fri, 14 Apr 2017 17:10:46 +0000"  >&lt;p&gt;Both conditions should be met in limit by variable case. It should not happen if mLimit==-1 and mlimitPlan==null.&lt;/p&gt;</comment>
                            <comment id="15969360" author="knoguchi" created="Fri, 14 Apr 2017 18:25:36 +0000"  >&lt;p&gt;Thanks Jin Sun, Daniel!  With the proposed patch, confirmed that it fixed the two failing tests and no news tests failed. &lt;/p&gt;</comment>
                            <comment id="15969542" author="jins" created="Fri, 14 Apr 2017 21:16:58 +0000"  >&lt;p&gt;Thanks Koji. I will make a small fix later today before we merge to trunk.&lt;/p&gt;</comment>
                            <comment id="15969783" author="jins" created="Sat, 15 Apr 2017 02:17:00 +0000"  >&lt;p&gt;Address Daniel&apos;s advice, adding mLimitPlan != null&lt;br/&gt;
Feel free to leave some comments or merge &lt;/p&gt;</comment>
                            <comment id="15969822" author="daijy" created="Sat, 15 Apr 2017 05:31:51 +0000"  >&lt;p&gt;+1. Both tests pass. Thanks for additional test.&lt;/p&gt;

&lt;p&gt;Patch committed to trunk. Thanks Jin!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13061176">PIG-5211</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12863426" name="PIG-5223-1.patch" size="4775" author="jins" created="Fri, 14 Apr 2017 05:50:33 +0000"/>
                            <attachment id="12863532" name="PIG-5223-2.patch" size="5161" author="jins" created="Sat, 15 Apr 2017 02:17:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3dlm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>