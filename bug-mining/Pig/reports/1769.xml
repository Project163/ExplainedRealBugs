<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:01:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4707] [Pig on Tez] Streaming job hangs with pig.exec.mapPartAgg=true</title>
                <link>https://issues.apache.org/jira/browse/PIG-4707</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description></description>
                <environment></environment>
        <key id="12906117">PIG-4707</key>
            <summary>[Pig on Tez] Streaming job hangs with pig.exec.mapPartAgg=true</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rohini">Rohini Palaniswamy</assignee>
                                    <reporter username="rohini">Rohini Palaniswamy</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Oct 2015 01:17:57 +0000</created>
                <updated>Wed, 8 Jun 2016 20:48:29 +0000</updated>
                            <resolved>Sun, 25 Oct 2015 12:56:07 +0000</resolved>
                                                    <fixVersion>0.16.0</fixVersion>
                    <fixVersion>0.15.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14964371" author="rohini" created="Tue, 20 Oct 2015 01:46:16 +0000"  >&lt;p&gt;Unlike MR, parentPlan.endOfAllInput can become true in different conditions (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4020?focusedCommentId=14036346&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14036346&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PIG-4020?focusedCommentId=14036346&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14036346&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;So need to set allOutputFromBinaryProcessed to true in all the branch conditions we encounter STATUS_EOS.&lt;/p&gt;</comment>
                            <comment id="14965850" author="knoguchi" created="Tue, 20 Oct 2015 22:00:52 +0000"  >&lt;p&gt;I haven&apos;t had time to understand the patch but at least the new e2e testing from this patch needs to be fixed.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR 1200: _file ./out/pigtest/gtrain/gtrain-1445373986-nightly.conf/MapPartialAgg_6_benchmark.pig, line 6, column 29_  mismatched input &apos;otherwise&apos; expecting IF

org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1000: Error during parsing. _file ./out/pigtest/gtrain/gtrain-1445373986-nightly.conf/MapPartialAgg_6_benchmark.pig, line 6, column 29_  mismatched input &apos;otherwise&apos; expecting IF
	at org.apache.pig.PigServer$Graph.parseQuery(PigServer.java:1646)
	at org.apache.pig.PigServer$Graph.registerQuery(PigServer.java:1589)
	at org.apache.pig.PigServer.registerQuery(PigServer.java:589)
	at org.apache.pig.tools.grunt.GruntParser.processPig(GruntParser.java:969)
	at org.apache.pig.tools.pigscript.parser.PigScriptParser.parse(PigScriptParser.java:386)
	at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:189)
	at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:165)
	at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:84)
	at org.apache.pig.Main.run(Main.java:561)
	at org.apache.pig.Main.main(Main.java:111)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:483)
	at org.apache.hadoop.util.RunJar.run(RunJar.java:221)
	at org.apache.hadoop.util.RunJar.main(RunJar.java:136)
Caused by: Failed to parse: _file ./out/pigtest/gtrain/gtrain-1445373986-nightly.conf/MapPartialAgg_6_benchmark.pig, line 6, column 29_  mismatched input &apos;otherwise&apos; expecting IF
	at org.apache.pig.parser.QueryParserDriver.parse(QueryParserDriver.java:222)
	at org.apache.pig.parser.QueryParserDriver.parse(QueryParserDriver.java:164)
	at org.apache.pig.PigServer$Graph.parseQuery(PigServer.java:1638)
	... 15 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14965977" author="rohini" created="Tue, 20 Oct 2015 23:32:59 +0000"  >&lt;p&gt;Actually the e2e runs fine for me. Can you paste the contents of ./out/pigtest/gtrain/gtrain-1445373986-nightly.conf/MapPartialAgg_6_benchmark.pig ?&lt;/p&gt;</comment>
                            <comment id="14967841" author="daijy" created="Wed, 21 Oct 2015 20:36:26 +0000"  >&lt;p&gt;The test pass for me. However, the new test pass even before I apply the patch. Is there any condition to reproduce it?&lt;/p&gt;</comment>
                            <comment id="14967855" author="knoguchi" created="Wed, 21 Oct 2015 20:40:00 +0000"  >&lt;p&gt;Test failure was due to my e2e test trying with pig-0.9.  &lt;br/&gt;
Rohini pointed out my mistake.  Thank you and sorry~.&lt;/p&gt;</comment>
                            <comment id="14969720" author="rohini" created="Thu, 22 Oct 2015 19:24:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;,&lt;br/&gt;
   The test does hang for me without the fix to POStream.java. Below is the stacktrace of the hung thread. Can you recheck?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;TezChild&quot;&lt;/span&gt; daemon prio=5 tid=0x00007fd92c237000 nid=0x4d07 waiting on condition [0x000000010c5ce000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (parking)
        at sun.misc.Unsafe.park(Native Method)
        - parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x00000007fbc47b68&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
        at java.util.concurrent.ArrayBlockingQueue.take(ArrayBlockingQueue.java:374)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POStream.getNextTuple(POStream.java:157)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.PhysicalOperator.processInput(PhysicalOperator.java:307)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POFilter.getNextTuple(POFilter.java:91)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.PhysicalOperator.processInput(PhysicalOperator.java:307)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POSplit.getStreamCloseResult(POSplit.java:277)
        at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POSplit.getNextTuple(POSplit.java:213)
        at org.apache.pig.backend.hadoop.executionengine.tez.runtime.PigProcessor.runPipeline(PigProcessor.java:334)
        at org.apache.pig.backend.hadoop.executionengine.tez.runtime.PigProcessor.run(PigProcessor.java:199)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14969826" author="daijy" created="Thu, 22 Oct 2015 20:24:42 +0000"  >&lt;p&gt;Yes, it hangs without fix. I probably run with MR. I will review shortly.&lt;/p&gt;</comment>
                            <comment id="14972483" author="daijy" created="Sat, 24 Oct 2015 08:20:17 +0000"  >&lt;p&gt;This fix should be quite safe. Once Pig see a EOS (stream process finishes), Pig shall remember and return EOP without doing anything else. So +1 on patch.&lt;/p&gt;

&lt;p&gt;I still need to think through the interaction between split and stream. We&apos;ve already get several fixes around it (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4480&quot; title=&quot;Pig script failure on Tez with split and order by due to missing sample collection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4480&quot;&gt;&lt;del&gt;PIG-4480&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4493&quot; title=&quot;Pig on Tez gives wrong results if Union is followed by Split&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4493&quot;&gt;&lt;del&gt;PIG-4493&lt;/del&gt;&lt;/a&gt;). But that should not block this Jira.&lt;/p&gt;</comment>
                            <comment id="14973226" author="rohini" created="Sun, 25 Oct 2015 12:56:07 +0000"  >&lt;p&gt;Committed to trunk. Thanks for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14985902" author="daijy" created="Mon, 2 Nov 2015 19:55:37 +0000"  >&lt;p&gt;Backport to 0.15 branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12767511" name="PIG-4707-1-withoutwhitespacechanges.patch" size="7646" author="rohini" created="Tue, 20 Oct 2015 01:46:16 +0000"/>
                            <attachment id="12767512" name="PIG-4707-1.patch" size="16045" author="rohini" created="Tue, 20 Oct 2015 01:46:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 3 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2n7sn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>