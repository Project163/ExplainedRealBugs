<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4930] Skewed Join Breaks On Empty Sampled Input When Key is From Map</title>
                <link>https://issues.apache.org/jira/browse/PIG-4930</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;When using a skewed join, if the left relation gets its key from a map and said relation is empty, then the skewed join fails during the sampling phase with:&lt;/p&gt;

&lt;p&gt;org.apache.pig.backend.executionengine.ExecException: ERROR 0: Exception while executing (Name: Local Rearrange&lt;span class=&quot;error&quot;&gt;&amp;#91;tuple&amp;#93;&lt;/span&gt;&lt;/p&gt;
{tuple}
&lt;p&gt;(false) - scope-27 Operator Key: scope-27): org.apache.pig.backend.executionengine.ExecException: ERROR 0: Exception while executing [POMapLookUp (Name: POMapLookUp&lt;span class=&quot;error&quot;&gt;&amp;#91;bytearray&amp;#93;&lt;/span&gt; - scope-14 Operator Key: scope-14) children: null at [null&lt;span class=&quot;error&quot;&gt;&amp;#91;3,17&amp;#93;&lt;/span&gt;]]: java.lang.ClassCastException: java.lang.String cannot be cast to java.util.Map&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.PhysicalOperator.processInput(PhysicalOperator.java:314)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POLocalRearrange.getNextTuple(POLocalRearrange.java:287)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.runPipeline(PigGenericMapBase.java:280)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:275)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:65)&lt;br/&gt;
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:144)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:370)&lt;br/&gt;
	at org.apache.hadoop.mapred.Child$4.run(Child.java:255)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at javax.security.auth.Subject.doAs(Subject.java:415)&lt;br/&gt;
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1121)&lt;br/&gt;
	at org.apache.hadoop.mapred.Child.main(Child.java:249)&lt;/p&gt;


&lt;p&gt;I think the problem is more fundamental to Pig&apos;s skewed join implementation than maps, but it is easily demonstrable with them. I have written an additional test in TestSkewedJoin that demonstrates the problem. The join works correctly if we remove &quot;using &apos;skewed&apos;&quot;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12979925">PIG-4930</key>
            <summary>Skewed Join Breaks On Empty Sampled Input When Key is From Map</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkollar">N&#225;ndor Koll&#225;r</assignee>
                                    <reporter username="butlerw">William Butler</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Jun 2016 18:38:47 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:19 +0000</updated>
                            <resolved>Sat, 7 Jan 2017 20:20:58 +0000</resolved>
                                    <version>0.9.2</version>
                    <version>0.16.0</version>
                                    <fixVersion>0.17.0</fixVersion>
                    <fixVersion>0.16.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15334415" author="butlerw" created="Thu, 16 Jun 2016 18:42:46 +0000"  >&lt;p&gt;Attached empty_skew.diff&lt;br/&gt;
This contains a test that errors as is on Pig 0.16 but passes if we remove &quot;using &apos;skewed&apos;&quot;&lt;/p&gt;</comment>
                            <comment id="15754306" author="nkollar" created="Fri, 16 Dec 2016 12:35:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt; would you mind if I would work on this item?&lt;/p&gt;</comment>
                            <comment id="15758196" author="daijy" created="Sun, 18 Dec 2016 04:45:17 +0000"  >&lt;p&gt;Sure, go ahead.&lt;/p&gt;</comment>
                            <comment id="15759565" author="nkollar" created="Sun, 18 Dec 2016 22:03:54 +0000"  >&lt;p&gt;When there is no data, PoissonSampleLoader still emits one tuple: (NUMROWS_TUPLE_MARKER, 0) and then later in the physical plan processing, the cast fails (in this case it fails because the join key is expected to be a map, but would fail for tuple key too). I think PoissonSampleLoader shouldn&apos;t emit any tuple if the dataset is empty. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt; what do you think? Should I add an e2e test to cover the empty dataset case, or the test what William provided is enough?&lt;/p&gt;</comment>
                            <comment id="15764770" author="rohini" created="Tue, 20 Dec 2016 17:40:01 +0000"  >&lt;p&gt;Is this only a problem with MR and not Tez?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think PoissonSampleLoader shouldn&apos;t emit any tuple if the dataset is empty. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;  Need to check if there are other cases where it might become a problem. Will get back on this.&lt;/p&gt;
</comment>
                            <comment id="15765292" author="nkollar" created="Tue, 20 Dec 2016 21:29:03 +0000"  >&lt;p&gt;No, it looks like the test (testSkewedJoinMapLeftEmpty) fails only in MR mode.&lt;/p&gt;</comment>
                            <comment id="15802841" author="rohini" created="Thu, 5 Jan 2017 23:17:51 +0000"  >&lt;p&gt;Code is ok and I was going to commit it. But saw that TestSkewedJoin is hanging in testSkewedJoinMapKey. Even without the patch it seems to be hanging. Can you look into it?&lt;/p&gt;</comment>
                            <comment id="15804038" author="nkollar" created="Fri, 6 Jan 2017 08:53:01 +0000"  >&lt;p&gt;Sure, I can, could you please assign the Jira to me?&lt;/p&gt;</comment>
                            <comment id="15805142" author="rohini" created="Fri, 6 Jan 2017 18:01:01 +0000"  >&lt;p&gt;There is no jira. But I was wondering if it was result of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3417&quot; title=&quot;Job fails when skewed join is done on tuple key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3417&quot;&gt;&lt;del&gt;PIG-3417&lt;/del&gt;&lt;/a&gt; as there has been no other recent changes. &lt;/p&gt;</comment>
                            <comment id="15808085" author="rohini" created="Sat, 7 Jan 2017 20:20:58 +0000"  >&lt;p&gt;I accidentally committed this also as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4923&quot; title=&quot;Drop Hadoop 1.x support in Pig 0.17&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4923&quot;&gt;&lt;del&gt;PIG-4923&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://builds.apache.org/job/Pig-trunk-commit/lastCompletedBuild/testReport/org.apache.pig.test/TestSkewedJoin/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Pig-trunk-commit/lastCompletedBuild/testReport/org.apache.pig.test/TestSkewedJoin/&lt;/a&gt; was fine. So must be something with my laptop.&lt;/p&gt;

&lt;p&gt;Just made a minor change of adding PARALLEL 2 to the testcase. With Parallelism of 1, the Partitioner is not exercised. So it is always best to have paralellism of &amp;gt; 1 for order by and skewed join tests which use custom partitioner.&lt;/p&gt;

&lt;p&gt;Committed to branch-0.16 as well. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkollar&quot; class=&quot;user-hover&quot; rel=&quot;nkollar&quot;&gt;nkollar&lt;/a&gt; for fixing this. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12846197" name="PIG-4930-2.patch" size="3320" author="rohini" created="Sat, 7 Jan 2017 20:21:19 +0000"/>
                            <attachment id="12843729" name="PIG-4930.patch" size="3583" author="nkollar" created="Sat, 17 Dec 2016 21:15:36 +0000"/>
                            <attachment id="12811176" name="empty_skew.diff" size="2656" author="butlerw" created="Thu, 16 Jun 2016 18:41:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 45 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zkzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>