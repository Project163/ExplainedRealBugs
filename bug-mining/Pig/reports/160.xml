<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:49:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-553] EvalFunc.finish() not getting called</title>
                <link>https://issues.apache.org/jira/browse/PIG-553</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;My EvalFunc&apos;s finish() method doesn&apos;t seem to get invoked.&lt;/p&gt;</description>
                <environment>&lt;p&gt;&quot;local&quot; mode&lt;/p&gt;</environment>
        <key id="12409610">PIG-553</key>
            <summary>EvalFunc.finish() not getting called</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shravanmn">Shravan Matthur Narayanamurthy</assignee>
                                    <reporter username="olston">Christopher Olston</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Dec 2008 02:29:58 +0000</created>
                <updated>Thu, 25 Mar 2010 00:12:44 +0000</updated>
                            <resolved>Sat, 7 Feb 2009 06:50:46 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12664218" author="olgan" created="Thu, 15 Jan 2009 18:52:26 +0000"  >&lt;p&gt;Shravan, could you take a look.&lt;/p&gt;</comment>
                            <comment id="12665074" author="shravanmn" created="Mon, 19 Jan 2009 09:20:48 +0000"  >&lt;p&gt;I think the finish method in EvalFunc is just a remnant of our earlier code(prev trunk). I do not think we planned to include it because I don&apos;t see any infrastructure to call it. Though Chris&apos;s concern is only in local mode and it can be fixed temporarily by just calling a visitor that visits all the operators and if a POUserFunc is found calls its finish method. But what do we do for the MapRed case? Should we implement a similar behaviour in the close method? Do we need to support this kind of an operation for all operators? If so then should we also give a place holder for open()? &lt;/p&gt;</comment>
                            <comment id="12665400" author="shravanmn" created="Tue, 20 Jan 2009 10:51:49 +0000"  >&lt;p&gt;Fixed the local mode by writing a visitor that calls the EvalFunc.finish() method. Waiting for comments from others on my earlier query&lt;/p&gt;</comment>
                            <comment id="12665475" author="alangates" created="Tue, 20 Jan 2009 17:10:42 +0000"  >&lt;p&gt;We don&apos;t want a different interface for local and MR mode.  This should work in both modes.&lt;/p&gt;

&lt;p&gt;Users aren&apos;t currently asking for an open method, and it&apos;s possible to work around no open by keeping a state variable to see if you&apos;ve been called before.&lt;/p&gt;</comment>
                            <comment id="12665504" author="olgan" created="Tue, 20 Jan 2009 19:05:51 +0000"  >&lt;p&gt;Shravan,&lt;/p&gt;

&lt;p&gt;I agree with Alan we should have the same code for local and MR mode. We actually have users who are interested in this functionality in MR mode. They want to generate footer information.&lt;/p&gt;</comment>
                            <comment id="12665811" author="shravanmn" created="Wed, 21 Jan 2009 12:11:55 +0000"  >&lt;p&gt;Ok. Will create a modified patch.&lt;/p&gt;</comment>
                            <comment id="12666456" author="shravanmn" created="Fri, 23 Jan 2009 09:23:37 +0000"  >&lt;p&gt;Added a Visitor(UDFFuncVisitor that calls the EvalFunc.finish() method)&lt;br/&gt;
Made modifications to LocalPigLauncher. After finishing plan execution, the visitor is called to call EvalFunc.finish() on all UDFs present in the plan&lt;br/&gt;
Made similar modifications to PigMapBase.close(), PigMapReduce.Reduce.close(). No change to PigCombiner.Combine.close() as only intermediate versions of the Algebraic functions are called and only in the reduce do they finish. So the PigMapReduce.Reduce.close() takes care of that.&lt;/p&gt;

&lt;p&gt;Another thing, is that this being a visitor call might be expensive but considering that its done in the close method and executes once per task it should be ok I guess.&lt;/p&gt;</comment>
                            <comment id="12666652" author="sms" created="Fri, 23 Jan 2009 19:02:47 +0000"  >&lt;p&gt;I will be reviewing this patch.&lt;/p&gt;</comment>
                            <comment id="12666679" author="sms" created="Fri, 23 Jan 2009 20:04:30 +0000"  >&lt;p&gt;Review comments:&lt;/p&gt;

&lt;p&gt;1. The code looks fine.&lt;br/&gt;
2. There are no unit test cases. We need unit test cases to ensure that the code path is exercised in all cases (preferably at least map reduce case)&lt;br/&gt;
3. In algebraic functions, since intermediate is called only in PigCombiner and the UDF visitor is never called in the PigCombiner, users should be aware that finish() is never called for intermediate methods. The UDF documentation has to be updated to reflect this caveat.&lt;/p&gt;</comment>
                            <comment id="12668012" author="shravanmn" created="Wed, 28 Jan 2009 12:17:40 +0000"  >&lt;p&gt;Created TestCase that tests calling of finish in both MR &amp;amp; local mode and in each mode both scenarios: one where udf is in map phase &amp;amp; another where udf is in reduce phase.&lt;/p&gt;

&lt;p&gt;Note that I have not used the minicluster because the MR job will run in another VM and its an overkill to use IPC to figure out whether finish() was called.&lt;/p&gt;</comment>
                            <comment id="12671414" author="sms" created="Sat, 7 Feb 2009 06:50:46 +0000"  >&lt;p&gt;Patch has been committed. Thanks for the fix Shravan.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12398897" name="553.patch" size="11859" author="shravanmn" created="Wed, 28 Jan 2009 12:17:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164149</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0glmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94934</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>