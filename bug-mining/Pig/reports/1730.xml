<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:01:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4506] binstorage fails to write biginteger</title>
                <link>https://issues.apache.org/jira/browse/PIG-4506</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;When trying to store a biginteger using binstorage the following error is issued (The error might manifest elsewhere too):&lt;br/&gt;
java.lang.RuntimeException: Unexpected data type -1 found in stream&lt;/p&gt;

&lt;p&gt;This is caused by a bug in the writeDatum method of the DataReaderWriter.java class. When writeDatum is called with a BigInteger as a argument, the BigInteger is converted to a byte[] and the writeDatum method is recursively called on the byte[]. writeDatum cannon handle byte[] objects but instead expects DataByteArray objects.&lt;/p&gt;

&lt;p&gt;Suggested fix - wrap byte[] to DataByteArray:&lt;br/&gt;
change this line:&lt;br/&gt;
&lt;em&gt;writeDatum(out, ((BigInteger)val).toByteArray());&lt;/em&gt;&lt;br/&gt;
to this:&lt;br/&gt;
&lt;em&gt;writeDatum(out, new DataByteArray(((BigInteger)val).toByteArray()));&lt;/em&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12820772">PIG-4506</key>
            <summary>binstorage fails to write biginteger</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ssavvides">Savvas Savvides</assignee>
                                    <reporter username="ssavvides">Savvas Savvides</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Apr 2015 09:54:06 +0000</created>
                <updated>Sun, 7 Jun 2015 03:48:34 +0000</updated>
                            <resolved>Tue, 19 May 2015 23:47:03 +0000</resolved>
                                                    <fixVersion>0.15.0</fixVersion>
                                    <component>data</component>
                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="300">5m</timeoriginalestimate>
                            <timeestimate seconds="300">5m</timeestimate>
                                        <comments>
                            <comment id="14520018" author="daijy" created="Wed, 29 Apr 2015 19:28:30 +0000"  >&lt;p&gt;The fix looks good. Adding a test case.&lt;/p&gt;</comment>
                            <comment id="14542802" author="rohini" created="Wed, 13 May 2015 21:55:11 +0000"  >&lt;p&gt;  The fix might be easy, but it is bad as it wastes one byte per biginteger and bigdecimal.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; DataType.BIGINTEGER:
                out.writeByte(DataType.BIGINTEGER);
                writeDatum(out, ((BigInteger)val).toByteArray());
                &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; DataType.BIGDECIMAL:
                out.writeByte(DataType.BIGDECIMAL);
                writeDatum(out, ((BigDecimal)val).toString());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Instead of actually writing DataType.BIGINTEGER + length of bytearray + byte array, the code is writing DataType.BIGINTEGER + DATATYPE.BYTEARRAY + length of bytearray + byte array. In case of BigDecimal it is DataType.BIGDECIMAL + DataType.CHARARRAY/DataType.BIGCHARARRAY + short/int length of bytearray + byte array.   We should get rid of the DATATYPE.BYTEARRAY  and DataType.CHARARRAY/DataType.BIGCHARARRAY. Though it makes for easy coding it is inefficient.&lt;/p&gt;

&lt;p&gt;Can we extract out the writing and reading of bytearray and its length and reuse that code instead of calling writeDatum(databytearray).  For BigDecimal, we can always do out.writeShort(length) as the length of the length of the BigDecimal String should not be &amp;gt; 65535. &lt;/p&gt;</comment>
                            <comment id="14542819" author="rohini" created="Wed, 13 May 2015 22:04:00 +0000"  >&lt;p&gt;For the test, could you just add biginteger and bigdecimal to TestEvalPipeline2.testBinStorageByteArrayCastsSimple instead of adding a new one in TestStore. That is a more logical fit place for the test as it already tests other datatypes for BinStorage there.&lt;/p&gt;</comment>
                            <comment id="14547430" author="daijy" created="Mon, 18 May 2015 00:58:08 +0000"  >&lt;p&gt;Update the patch according to Rohini&apos;s comments.&lt;/p&gt;</comment>
                            <comment id="14551312" author="rohini" created="Tue, 19 May 2015 21:58:40 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14551484" author="daijy" created="Tue, 19 May 2015 23:47:04 +0000"  >&lt;p&gt;Patch committed to both 0.15 branch and trunk. Thanks Savvas, Rohini!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12729269" name="PIG-4506-1.patch" size="2356" author="daijy" created="Wed, 29 Apr 2015 19:28:30 +0000"/>
                            <attachment id="12733426" name="PIG-4506-2.patch" size="4662" author="daijy" created="Mon, 18 May 2015 00:58:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2d7xz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>