<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4748] DateTimeWritable forgets Chronology</title>
                <link>https://issues.apache.org/jira/browse/PIG-4748</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;The following test fails:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void foo() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    DateTime nowIn = DateTime.now();
    DateTimeWritable in = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DateTimeWritable(nowIn);

    ByteArrayOutputStream outputStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
    DataOutputStream dataOut = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DataOutputStream(outputStream);
    in.write(dataOut);
    dataOut.flush();

    &lt;span class=&quot;code-comment&quot;&gt;// read from &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]
&lt;/span&gt;    DateTimeWritable out = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DateTimeWritable();
    ByteArrayInputStream inputStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(
      outputStream.toByteArray());
    DataInputStream dataIn = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DataInputStream(inputStream);
    out.readFields(dataIn);

    assertEquals(in.get(), out.get());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In equals(), the original instance has&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ISOChronology[Europe/Berlin]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;while the deserialized instance has&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ISOChronology[+01:00]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12916806">PIG-4748</key>
            <summary>DateTimeWritable forgets Chronology</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="szita">&#193;d&#225;m Szita</assignee>
                                    <reporter username="mju">Martin Junghanns</reporter>
                        <labels>
                    </labels>
                <created>Sun, 29 Nov 2015 12:59:32 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:19 +0000</updated>
                            <resolved>Mon, 22 May 2017 19:53:33 +0000</resolved>
                                    <version>0.16.0</version>
                                    <fixVersion>0.17.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15745190" author="szita" created="Tue, 13 Dec 2016 13:39:51 +0000"  >&lt;p&gt;Relying on timezone ID rather then offset millis solves this. Attached fix in &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12842998/12842998_PIG-4748.patch&quot; title=&quot;PIG-4748.patch attached to PIG-4748&quot;&gt;PIG-4748.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt; can take a look please?&lt;/p&gt;</comment>
                            <comment id="15754626" author="nkollar" created="Fri, 16 Dec 2016 15:00:03 +0000"  >&lt;p&gt;Using zone ID instead of offset looks good to me.&lt;/p&gt;</comment>
                            <comment id="15796722" author="daijy" created="Wed, 4 Jan 2017 00:43:01 +0000"  >&lt;p&gt;It might bloat the output too much. Is there some enum, or we have to rely on compression?&lt;/p&gt;</comment>
                            <comment id="15797798" author="szita" created="Wed, 4 Jan 2017 09:43:09 +0000"  >&lt;p&gt;I think we&apos;ll have to rely on compression. Using enums would make it hard to follow ever-updating timezones: &lt;a href=&quot;http://joda-interest.219941.n2.nabble.com/Are-there-enums-of-the-timezone-id-strings-somewhere-td6274470.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://joda-interest.219941.n2.nabble.com/Are-there-enums-of-the-timezone-id-strings-somewhere-td6274470.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15847362" author="szita" created="Tue, 31 Jan 2017 19:24:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;, what&apos;s your opinion?&lt;/p&gt;</comment>
                            <comment id="15847381" author="daijy" created="Tue, 31 Jan 2017 19:42:58 +0000"  >&lt;p&gt;Some customer might not compress intermediate file, so that might be a problem. Can we do getAvailableIDs() on the frontend and create enum on the fly?&lt;/p&gt;</comment>
                            <comment id="15847521" author="rohini" created="Tue, 31 Jan 2017 21:10:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can we do getAvailableIDs() on the frontend and create enum on the fly?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;  It is a good idea. Can sort the DateTimeZone.getAvailableIDs()  in a list and use the index of that list in the serialization. One problem I see with it though is if more than two versions of jodatime is in classpath then DateTimeZone.getAvailableIDs() might differ and might produce different results in different tasks. Somehow have to ensure we get same result in both frontend and all tasks in backend for DateTimeZone.getAvailableIDs(). &lt;/p&gt;</comment>
                            <comment id="15847532" author="daijy" created="Tue, 31 Jan 2017 21:15:33 +0000"  >&lt;p&gt;You may pass the mapping to conf. It is around 9k, guess it is ok.&lt;/p&gt;</comment>
                            <comment id="15850147" author="szita" created="Thu, 2 Feb 2017 16:38:15 +0000"  >&lt;p&gt;I upgraded the patch for this, see &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12850653/12850653_PIG-4748.2.patch&quot; title=&quot;PIG-4748.2.patch attached to PIG-4748&quot;&gt;PIG-4748.2.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;.&lt;br/&gt;
DateTimeWritables now write (long,int,int) corresponding to the DateTime instant (millis), offsetInMillis, position in the zone ID list respectively.&lt;br/&gt;
Zone list itself is carried along to backends via JobConf. For some inputs we can only rely on offsetInMillis (e.g. +01:00), on others we rely on ZoneID (e.g. America/Los_Angeles).&lt;/p&gt;</comment>
                            <comment id="15858161" author="szita" created="Wed, 8 Feb 2017 16:05:24 +0000"  >&lt;p&gt;Would &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12850653/12850653_PIG-4748.2.patch&quot; title=&quot;PIG-4748.2.patch attached to PIG-4748&quot;&gt;PIG-4748.2.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; be something you had in mind &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="15893878" author="daijy" created="Fri, 3 Mar 2017 07:54:42 +0000"  >&lt;p&gt;Looks good to me. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;, do you mind adding the mapping to configuration?&lt;/p&gt;</comment>
                            <comment id="15898009" author="rohini" created="Mon, 6 Mar 2017 20:23:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=szita&quot; class=&quot;user-hover&quot; rel=&quot;szita&quot;&gt;szita&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Couple of questions:&lt;br/&gt;
  1) When will zone id be -1 ? When user specifies just offset?&lt;br/&gt;
  2) Why not do writeShort for offset as before?&lt;/p&gt;

&lt;p&gt;Comments:&lt;br/&gt;
1) Can you move the config from PigConfiguration to PigImplConstants which is for configs used internally for implementation purposes.&lt;br/&gt;
2) availableZoneIDs.size() &amp;gt; 0 check is redundant in availableZoneIDs != null &amp;amp;&amp;amp; availableZoneIDs.size() &amp;gt; 0&lt;br/&gt;
3) Does it work with Tez e2e? Currently it is only set in the vertex conf which will only be available to PigProcessor and not available to the PigInputFormat or PigOutputFormat which will actually be deserializing the input or serializing it as output. I would suggest adding it to UDFContext instead like a UDF does. That will take care of compressing the setting as well so that it occupies less space.&lt;br/&gt;
4) testDateTimeZoneOnCluster - Please validate the value of DateTime objects as well. You can use Util.checkQueryOutputsAfterSort for comparing exact values with a expected list.&lt;br/&gt;
5) Can you move testDateTimeWritables from TestDataModel.java to TestDateTime.java?&lt;br/&gt;
5) Can you move tests from TestDefaultDateTimeZone.java into TestDateTime.java and delete TestDefaultDateTimeZone.java? Each new test class is fork of a new jvm which makes the tests take more time. So wherever possible would be good to avoid creating a new class.&lt;/p&gt;
</comment>
                            <comment id="15930015" author="szita" created="Fri, 17 Mar 2017 14:10:50 +0000"  >&lt;p&gt;Thanks for the comments &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;, I&apos;ve uploaded a new patch to address them: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12859294/12859294_PIG-4748.3.patch&quot; title=&quot;PIG-4748.3.patch attached to PIG-4748&quot;&gt;PIG-4748.3.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Questions:&lt;br/&gt;
1, Yes, if we only supply the zone as offset (e.g +01:00) we won&apos;t find this in the zone list, so -1 will be the position in the zone list.&lt;br/&gt;
This is why we have to send the offset as millis as well.&lt;br/&gt;
2, Joda time returns offsetAsMillis in integer. If we want to keep a general approach we should leave this as is. We could argue that a +00:00:00.001 zone offset doesn&apos;t make sense and we could programatically save some memory by transforming it to short by dividing it and loosing some precision. However I would rather go with the general approach.&lt;/p&gt;

&lt;p&gt;Comments:&lt;br/&gt;
1, Done&lt;br/&gt;
2, Done&lt;br/&gt;
3, Done, I think the previous solution would have worked as well but in the new patch I made this cleaner and made use of UDFContext()&lt;br/&gt;
4, Done, one of the tuples has a DateTime object where the zone information is deliberately left to be default. So I had to apply a little trick at result comparation.&lt;br/&gt;
5, Done, test classes are merged&lt;/p&gt;</comment>
                            <comment id="16014811" author="rohini" created="Wed, 17 May 2017 21:35:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;one of the tuples has a DateTime object where the zone information is deliberately left to be default. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;  What was the output before this patch? Ideally simple load+store should produce same data as original input. Currently it is adding the system zone to it which we should try to avoid. &lt;/p&gt;

&lt;p&gt;Everything else is perfect.&lt;/p&gt;</comment>
                            <comment id="16019555" author="szita" created="Mon, 22 May 2017 13:02:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt; I think this behaviour is consistent with what we have in trunk now:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;grunt&amp;gt; cat fruits.csv
apple   1       red     1971-01-01T00:00:00.000+00:00
orange  2       orange  1972-01-01T00:00:00.000+00:00
kiwi    3       green   1973-01-01T00:00:00.000+01:00
orange  4       orange  1974-01-01T00:00:00.000
grunt&amp;gt; A = LOAD &lt;span class=&quot;code-quote&quot;&gt;&apos;fruits.csv&apos;&lt;/span&gt; as (name:chararray, id:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, fruit:chararray, fut:datetime);
grunt&amp;gt; dump A;
(apple,1,red,1971-01-01T00:00:00.000Z)
(orange,2,orange,1972-01-01T00:00:00.000Z)
(kiwi,3,green,1973-01-01T00:00:00.000+01:00)
(orange,4,orange,1974-01-01T00:00:00.000+01:00)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(On my US-based cluster I get (-07:00) for the last record using the same data and query)&lt;/p&gt;</comment>
                            <comment id="16019896" author="rohini" created="Mon, 22 May 2017 17:45:52 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16020077" author="szita" created="Mon, 22 May 2017 19:53:19 +0000"  >&lt;p&gt;This is now committed to trunk, thanks for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12850653" name="PIG-4748.2.patch" size="13617" author="szita" created="Thu, 2 Feb 2017 16:32:54 +0000"/>
                            <attachment id="12859294" name="PIG-4748.3.patch" size="26604" author="szita" created="Fri, 17 Mar 2017 13:59:33 +0000"/>
                            <attachment id="12842998" name="PIG-4748.patch" size="4296" author="szita" created="Tue, 13 Dec 2016 13:37:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 26 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2p1g7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>