<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:01:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4569] Fix e2e test Rank_1 failure</title>
                <link>https://issues.apache.org/jira/browse/PIG-4569</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;It fails on Hadoop 1, but the issue could exist on Hadoop 2 as well.&lt;/p&gt;

&lt;p&gt;Error message:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.pig.backend.executionengine.ExecException: ERROR 0: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; executing ForEach at [C[6,4]]
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POForEach.getNextTuple(POForEach.java:325)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.runPipeline(PigGenericMapBase.java:279)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:274)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:64)
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:144)
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:370)
	at org.apache.hadoop.mapred.Child$4.run(Child.java:255)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:415)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1121)
	at org.apache.hadoop.mapred.Child.main(Child.java:249)
Caused by: java.lang.RuntimeException: Unable to read counter pig.counters.counter_6929257954538808410_2
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.PORank.getRankCounterOffset(PORank.java:185)
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.PORank.addRank(PORank.java:160)
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.PORank.getNextTuple(PORank.java:141)
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.PhysicalOperator.processInput(PhysicalOperator.java:307)
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POForEach.getNextTuple(POForEach.java:252)
	... 11 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12832060">PIG-4569</key>
            <summary>Fix e2e test Rank_1 failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daijy">Daniel Dai</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 May 2015 06:25:07 +0000</created>
                <updated>Sun, 7 Jun 2015 03:47:34 +0000</updated>
                            <resolved>Sat, 23 May 2015 06:47:08 +0000</resolved>
                                                    <fixVersion>0.15.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14555660" author="daijy" created="Fri, 22 May 2015 06:26:30 +0000"  >&lt;p&gt;Attach patch. JobConf.getNumMapTasks() cannot get the right #maps, it returns the default value 2. Change to use counters to get #maps.&lt;/p&gt;</comment>
                            <comment id="14556923" author="rohini" created="Fri, 22 May 2015 22:22:42 +0000"  >&lt;p&gt;Counter.TOTAL_LAUNCHED_MAPS includes failed/killed and speculative attempts. We need to find some other way.&lt;/p&gt;</comment>
                            <comment id="14556949" author="daijy" created="Fri, 22 May 2015 22:45:53 +0000"  >&lt;p&gt;Seems the only option is from taskreport. Attach &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4569&quot; title=&quot;Fix e2e test Rank_1 failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4569&quot;&gt;&lt;del&gt;PIG-4569&lt;/del&gt;&lt;/a&gt;-2.patch.&lt;/p&gt;</comment>
                            <comment id="14556986" author="rohini" created="Fri, 22 May 2015 23:25:06 +0000"  >&lt;p&gt;Taskreports are huge and can cause OOM. Have seen that many times. So a previously running rank job might fail and require more memory on the pig client or oozie launcher with this patch.&lt;/p&gt;

&lt;p&gt;I see that we switched to getNumReduceTasks because of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4392&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PIG-4392&lt;/a&gt; .  Can we go back to the code before &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4392&quot; title=&quot;RANK BY fails when default_parallel is greater than cardinality of field being ranked by&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4392&quot;&gt;&lt;del&gt;PIG-4392&lt;/del&gt;&lt;/a&gt; on iterating on the counters, but if the counterList size is less than job.getJob().getNumReduceTasks() in case of !isRowNumber, then initialize 0 for the missing counters ? This way can avoid getting the number of map tasks, but still have &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4392&quot; title=&quot;RANK BY fails when default_parallel is greater than cardinality of field being ranked by&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4392&quot;&gt;&lt;del&gt;PIG-4392&lt;/del&gt;&lt;/a&gt; fixed.&lt;/p&gt;</comment>
                            <comment id="14557042" author="daijy" created="Sat, 23 May 2015 00:21:35 +0000"  >&lt;p&gt;Totally agree. I don&apos;t like task report approach either. Though we can refactor the code not pull task report twice, but task report is not reliable and the execution code should not rely on it. &lt;/p&gt;

&lt;p&gt;We can go back to &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4392&quot; title=&quot;RANK BY fails when default_parallel is greater than cardinality of field being ranked by&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4392&quot;&gt;&lt;del&gt;PIG-4392&lt;/del&gt;&lt;/a&gt; and find an alternative fix. Attach &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4569&quot; title=&quot;Fix e2e test Rank_1 failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4569&quot;&gt;&lt;del&gt;PIG-4569&lt;/del&gt;&lt;/a&gt;-3.patch which rollback part of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4392&quot; title=&quot;RANK BY fails when default_parallel is greater than cardinality of field being ranked by&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4392&quot;&gt;&lt;del&gt;PIG-4392&lt;/del&gt;&lt;/a&gt; and fix differently.&lt;/p&gt;</comment>
                            <comment id="14557163" author="rohini" created="Sat, 23 May 2015 06:22:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;,&lt;br/&gt;
    Attached a patch that solves the issue in JobControlCompiler itself by creating the counter offsets correctly skipping the empty tasks.  Instead of using counterSize index as the taskId in the counterPair keys, it uses the actual taskIds in ascending order. Makes it easier to understand.&lt;/p&gt;</comment>
                            <comment id="14557172" author="daijy" created="Sat, 23 May 2015 06:40:39 +0000"  >&lt;p&gt;+1, that&apos;s even better.&lt;/p&gt;</comment>
                            <comment id="14557176" author="rohini" created="Sat, 23 May 2015 06:47:08 +0000"  >&lt;p&gt;Committed to branch-0.15 and trunk. Thanks Daniel.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12734751" name="PIG-4569-1.patch" size="966" author="daijy" created="Fri, 22 May 2015 06:26:30 +0000"/>
                            <attachment id="12734955" name="PIG-4569-2.patch" size="1618" author="daijy" created="Fri, 22 May 2015 22:45:53 +0000"/>
                            <attachment id="12734971" name="PIG-4569-3.patch" size="3124" author="daijy" created="Sat, 23 May 2015 00:21:35 +0000"/>
                            <attachment id="12734989" name="PIG-4569-4.patch" size="3041" author="rohini" created="Sat, 23 May 2015 06:22:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 26 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f38n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>