<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:54:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-2195] AvroStorage fails to STORE when LOADing via PigStorage</title>
                <link>https://issues.apache.org/jira/browse/PIG-2195</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Reading data via &lt;tt&gt;PigStorage&lt;/tt&gt; and writing it via &lt;tt&gt;AvroStorage&lt;/tt&gt; fails with an exception like this&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;java.lang.ClassCastException: org.apache.pig.data.BinSedesTuple cannot be cast to org.apache.avro.generic.IndexedRecord&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;The Pig script in this section of the documentation shows an example like this that fails:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://linkedin.jira.com/wiki/display/HTOOLS/AvroStorage+-+Pig+support+for+Avro+data#AvroStorage-PigsupportforAvrodata-A.Howtostoredataindifferentways&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://linkedin.jira.com/wiki/display/HTOOLS/AvroStorage+-+Pig+support+for+Avro+data#AvroStorage-PigsupportforAvrodata-A.Howtostoredataindifferentways&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;A workaround currently exists to produce avro from TSVs like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;avro = LOAD &apos;inputPath/&apos; AS (foo);
STORE avro INTO &apos;outputPath/&apos; USING oap.piggybank.storage.avro.AvroStorage(
  &apos;{&quot;data&quot;:&quot;data_file.avro&quot;,
    &quot;same&quot;:&quot;data_file.avro&quot;, &quot;field0&quot;:&quot;def:bar&quot;}&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is redundant though and &lt;tt&gt;data&lt;/tt&gt; and &lt;tt&gt;same&lt;/tt&gt; seem to indicate the same thing. This approach also requires an existing avro data file to exist. This patch will make the following alternate constructor syntax&apos;s work as well.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Read schema from an existing data file:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  &apos;{&quot;data&quot;:&quot;data_file.avro&quot;, &quot;field0&quot;:&quot;def:bar&quot;}&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;Read schema from an existing schema file:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  &apos;{&quot;schema_file&quot;:&quot;data_file.avsc&quot;, &quot;field0&quot;:&quot;def:bar&quot;}&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="12515714">PIG-2195</key>
            <summary>AvroStorage fails to STORE when LOADing via PigStorage</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="billgraham">William W. Graham Jr</assignee>
                                    <reporter username="billgraham">William W. Graham Jr</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Jul 2011 22:28:04 +0000</created>
                <updated>Thu, 26 Apr 2012 20:32:42 +0000</updated>
                            <resolved>Mon, 15 Aug 2011 23:25:00 +0000</resolved>
                                                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="13078394" author="billgraham" created="Tue, 2 Aug 2011 19:52:03 +0000"  >&lt;p&gt;After spending many hours getting my head around what AvroStorage does, I&apos;ve learned a few things some of which lead me to amend my initial assessment of the issue:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Reading from PigStorage and writing via AvroStorage works as advertised when using Avro 1.4.1. The ClassCastException I initially referenced happens when using Avro 1.5.1. Also the current trunk doesn&apos;t build against 1.5.1. We can address this in a separate JIRA.&lt;/li&gt;
	&lt;li&gt;There is a nasty hidden bug that causes the unit tests to not run in isolation. This can cause newly added unit tests or re-ordered tests to fail. The issue is that &lt;tt&gt;PigSchema2Avro&lt;/tt&gt; has a &lt;tt&gt;static int tupleIndex&lt;/tt&gt; that it increments after each call to &lt;tt&gt;getRecordName()&lt;/tt&gt; and the tests expect record names to have a certain &lt;tt&gt;tupleIndex&lt;/tt&gt; value included. As a temporary hack I&apos;ve added a &lt;tt&gt;public static void setTupleIndex(int index)&lt;/tt&gt; method to that class to allow unit tests to reset it, but this static int approach should really be revisited.&lt;/li&gt;
	&lt;li&gt;I&apos;ve added additional unit tests for reading from a text file and producing Avro.&lt;/li&gt;
	&lt;li&gt;I&apos;ve added support for passing a &lt;tt&gt;schema_file&lt;/tt&gt; value instead of a data file as shown above.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;ll upload a patch shortly.&lt;/p&gt;

</comment>
                            <comment id="13078517" author="billgraham" created="Tue, 2 Aug 2011 23:47:24 +0000"  >&lt;p&gt;Attached is a first patch that has:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;More unit tests reading from text files.&lt;/li&gt;
	&lt;li&gt;A fix to how unit tests are run as described above.&lt;/li&gt;
	&lt;li&gt;Support for specifying a JSON &lt;tt&gt;schema_file&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Also included are 2 new expected test result files that are needed for one of the new tests. The should live here:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;contrib/piggybank/java/src/test/java/org/apache/pig/piggybank/test/storage/avro/avro_test_files&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="13080300" author="billgraham" created="Fri, 5 Aug 2011 23:54:47 +0000"  >&lt;p&gt;This first patch is ready for review FYI. Also FYI, I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2202&quot; title=&quot;AvroStorage doesn&amp;#39;t work with Avro 1.5.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2202&quot;&gt;&lt;del&gt;PIG-2202&lt;/del&gt;&lt;/a&gt; to track upgrading AvroStorage to work with Avro 1.5.1 and &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2201&quot; title=&quot;AvroStorage bug in testRecordWithSplit() unit test&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2201&quot;&gt;PIG-2201&lt;/a&gt; to track a separate issue with the unit tests.&lt;/p&gt;</comment>
                            <comment id="13084343" author="alangates" created="Fri, 12 Aug 2011 20:09:30 +0000"  >&lt;p&gt;I&apos;ll be reviewing this patch.&lt;/p&gt;</comment>
                            <comment id="13084462" author="billgraham" created="Fri, 12 Aug 2011 23:24:40 +0000"  >&lt;p&gt;Thanks Alan. Regarding the naming of the new &lt;tt&gt;schema_file&lt;/tt&gt; field, with the recent commit of &lt;a href=&quot;https://issues.apache.org/jira/browse/AVRO-872&quot; title=&quot;Allow interdependancies across IDL schema imports&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AVRO-872&quot;&gt;&lt;del&gt;AVRO-872&lt;/del&gt;&lt;/a&gt;, Avro will supports parsing multiple schema files in 1.6.0. I&apos;d like to contribute a patch to &lt;tt&gt;AvroStorage&lt;/tt&gt; to support that at some point.&lt;/p&gt;

&lt;p&gt;With that in mind, should &lt;tt&gt;schema_file&lt;/tt&gt; instead be &lt;tt&gt;schema_files&lt;/tt&gt; so it can at some point accept a comma-separated list perhaps? Or we could allow multiple files to be passed to &lt;tt&gt;schema_file&lt;/tt&gt; at some point. Or we can later introduce &lt;tt&gt;schema_files&lt;/tt&gt; with an &lt;tt&gt;s&lt;/tt&gt;. Many options, but something to plan for now.&lt;/p&gt;</comment>
                            <comment id="13085428" author="alangates" created="Mon, 15 Aug 2011 23:25:00 +0000"  >&lt;p&gt;Patch checked in.  Thanks Bill.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12489137" name="PIG-2195_1.patch" size="20003" author="billgraham" created="Tue, 2 Aug 2011 23:47:24 +0000"/>
                            <attachment id="12489138" name="expected_testRecordSplitFromText1.avro" size="187" author="billgraham" created="Tue, 2 Aug 2011 23:47:24 +0000"/>
                            <attachment id="12489139" name="expected_testRecordSplitFromText2.avro" size="302" author="billgraham" created="Tue, 2 Aug 2011 23:47:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37461</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05igf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30087</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>AvroStorage support for using a schema from an Avro schema file.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>