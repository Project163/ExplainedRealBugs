<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:00:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4448] AvroMapWrapper leaks Avro data types when the map values are complex avro records</title>
                <link>https://issues.apache.org/jira/browse/PIG-4448</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;AvroMapWrapper does not convert value objects in it&apos;s inner map to Pig types when queried. This could lead to problems when the value object is a complex Avro type. &lt;/p&gt;

&lt;p&gt;Attaching a preliminary patch. Please let me know if this is not the best way to fix it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12779857">PIG-4448</key>
            <summary>AvroMapWrapper leaks Avro data types when the map values are complex avro records</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rdsr">Ratandeep Ratti</assignee>
                                    <reporter username="rdsr">Ratandeep Ratti</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Mar 2015 18:29:21 +0000</created>
                <updated>Sun, 7 Jun 2015 03:47:27 +0000</updated>
                            <resolved>Wed, 11 Mar 2015 17:16:59 +0000</resolved>
                                    <version>0.13.0</version>
                                    <fixVersion>0.15.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14349206" author="rdsr" created="Thu, 5 Mar 2015 18:30:39 +0000"  >&lt;p&gt;Fix with a simple testcase&lt;/p&gt;</comment>
                            <comment id="14349265" author="rdsr" created="Thu, 5 Mar 2015 18:54:52 +0000"  >&lt;p&gt;I&apos;m realizing that this is not the right way to fix this. This also breaks the AvroStorage tests. I&apos;ll look into it a little more deeply tomorrow&lt;/p&gt;</comment>
                            <comment id="14350543" author="rdsr" created="Fri, 6 Mar 2015 16:30:27 +0000"  >&lt;p&gt;For instance, below is the Avro schema and Pig schema for an Avro record which contains a map which contain a record.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Avro schema
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;recordInMap&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;namespace&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.pig.test.builtin&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt;: [
    {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;
    },
    {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;
    },
    {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;parameters&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;map&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;values&quot;&lt;/span&gt;: {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt;: [
            {
              &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;,
              &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: [
                &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;,
                &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;
              ]
            }
          ]
        }
      }
    }
  ]
}

Pig schema
key:chararray,value:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,parameters:[A:(id:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;According to this, the Pig representation should contain a tuple for the the map&apos;s value record, but instead it currently contains an Avro GenericRecord&lt;/p&gt;

&lt;p&gt;Updating the patch. Now I&apos;m using the logic from org.apache.pig.impl.util.avro.AvroBagWrapper on how it is converting each element of the Bag to an equivalent Pig type.&lt;/p&gt;

&lt;p&gt;My only gripe now is that the name of the method which helps to convert types from avro to Pig in AvroTupleWrapper is &quot;resolveUnion&quot; . Ideally I&apos;d love to name it avroToPig or something similar but since its scope is  public  I&apos;m refraining to do so.&lt;/p&gt;</comment>
                            <comment id="14350549" author="rdsr" created="Fri, 6 Mar 2015 16:31:03 +0000"  >&lt;p&gt;Attaching updated patch&lt;/p&gt;</comment>
                            <comment id="14350864" author="daijy" created="Fri, 6 Mar 2015 20:43:17 +0000"  >&lt;p&gt;If &quot;resolveUnion&quot; is not the right name, can you change it? Also a minor comment, testRecordAsMapValue does not seem to justify a separate test suite, can you merge into TestAvroStorage or TestAvroStorageSchemaConversionUtilities?&lt;/p&gt;</comment>
                            <comment id="14351358" author="rdsr" created="Sat, 7 Mar 2015 03:14:01 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt; . I&apos; ll move the test under TestAvroStorageSchemaConversionUtilities and fix the name&lt;/p&gt;</comment>
                            <comment id="14351474" author="rdsr" created="Sat, 7 Mar 2015 07:53:53 +0000"  >&lt;p&gt;Attaching the updated patch.&lt;br/&gt;
I hope I don&apos;t break anything with the name change of a public method. &lt;/p&gt;</comment>
                            <comment id="14355212" author="rdsr" created="Tue, 10 Mar 2015 17:06:49 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;  I&apos;ve updated the patch. Do let me know if it looks ok or it needs modifications or even if there&apos;s a better approach to this problem.&lt;/p&gt;</comment>
                            <comment id="14357230" author="daijy" created="Wed, 11 Mar 2015 17:16:52 +0000"  >&lt;p&gt;Patch committed to trunk. Thanks Ratandeep!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12702865" name="avro_map_wrapper_fix.patch" size="5947" author="rdsr" created="Thu, 5 Mar 2015 18:30:39 +0000"/>
                            <attachment id="12703075" name="avro_map_wrapper_fix2.patch" size="4328" author="rdsr" created="Fri, 6 Mar 2015 16:31:03 +0000"/>
                            <attachment id="12703228" name="avro_map_wrapper_fix3.patch" size="5928" author="rdsr" created="Sat, 7 Mar 2015 07:53:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26ew7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>