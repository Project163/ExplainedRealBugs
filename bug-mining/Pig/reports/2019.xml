<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:03:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-5416] Spark unit tests failing randomly with &quot;java.lang.RuntimeException: Unexpected job execution status RUNNING&quot;</title>
                <link>https://issues.apache.org/jira/browse/PIG-5416</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Spark unit tests fail randomly with same errors. &lt;br/&gt;
 Sample stack trace showing &quot;Caused by: java.lang.RuntimeException: Unexpected job execution status RUNNING&quot;.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;TestBuiltInBagToTupleOrString.testPigScriptForBagToTupleUDF&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Unable to store alias B

org.apache.pig.impl.logicalLayer.FrontendException: ERROR 1002: Unable to store alias B
at org.apache.pig.PigServer$Graph.registerQuery(PigServer.java:1783)
at org.apache.pig.PigServer.registerQuery(PigServer.java:708)
at org.apache.pig.PigServer.registerQuery(PigServer.java:721)
at org.apache.pig.test.TestBuiltInBagToTupleOrString.testPigScriptForBagToTupleUDF(TestBuiltInBagToTupleOrString.java:429)
Caused by: org.apache.pig.impl.plan.VisitorException: ERROR 0: fail to get the rdds of this spark operator:
at org.apache.pig.backend.hadoop.executionengine.spark.JobGraphBuilder.visitSparkOp(JobGraphBuilder.java:115)
at org.apache.pig.backend.hadoop.executionengine.spark.plan.SparkOperator.visit(SparkOperator.java:140)
at org.apache.pig.backend.hadoop.executionengine.spark.plan.SparkOperator.visit(SparkOperator.java:37)
at org.apache.pig.impl.plan.DependencyOrderWalker.walk(DependencyOrderWalker.java:87)
at org.apache.pig.impl.plan.PlanVisitor.visit(PlanVisitor.java:46)
at org.apache.pig.backend.hadoop.executionengine.spark.SparkLauncher.launchPig(SparkLauncher.java:240)
at org.apache.pig.backend.hadoop.executionengine.HExecutionEngine.launchPig(HExecutionEngine.java:290)
at org.apache.pig.PigServer.launchPlan(PigServer.java:1479)
at org.apache.pig.PigServer.executeCompiledLogicalPlan(PigServer.java:1464)
at org.apache.pig.PigServer.execute(PigServer.java:1453)
at org.apache.pig.PigServer.access$500(PigServer.java:119)
at org.apache.pig.PigServer$Graph.registerQuery(PigServer.java:1778)
Caused by: java.lang.RuntimeException: Unexpected job execution status RUNNING
at org.apache.pig.tools.pigstats.spark.SparkStatsUtil.isJobSuccess(SparkStatsUtil.java:138)
at org.apache.pig.tools.pigstats.spark.SparkPigStats.addJobStats(SparkPigStats.java:75)
at org.apache.pig.tools.pigstats.spark.SparkStatsUtil.waitForJobAddStats(SparkStatsUtil.java:59)
at org.apache.pig.backend.hadoop.executionengine.spark.JobGraphBuilder.sparkOperToRDD(JobGraphBuilder.java:225)
at org.apache.pig.backend.hadoop.executionengine.spark.JobGraphBuilder.visitSparkOp(JobGraphBuilder.java:112)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13406437">PIG-5416</key>
            <summary>Spark unit tests failing randomly with &quot;java.lang.RuntimeException: Unexpected job execution status RUNNING&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Oct 2021 20:27:59 +0000</created>
                <updated>Mon, 15 Sep 2025 11:29:10 +0000</updated>
                            <resolved>Tue, 14 May 2024 20:33:17 +0000</resolved>
                                                    <fixVersion>0.18.0</fixVersion>
                                    <component>spark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17428481" author="knoguchi" created="Wed, 13 Oct 2021 20:38:54 +0000"  >&lt;p&gt;Not sure what&apos;s happening since the code is going through the below method before hitting the error...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;SparkStatsUtil.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 45     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void waitForJobAddStats(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; jobID,
 46                                           POStore poStore, SparkOperator sparkOperator,
 47                                           JobStatisticCollector jobStatisticCollector,
 48                                           JavaSparkContext sparkContext,
 49                                           SparkPigStats sparkPigStats)
 50             &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException {
 51         &lt;span class=&quot;code-comment&quot;&gt;// Even though we are not making any async calls to spark,
&lt;/span&gt; 52         &lt;span class=&quot;code-comment&quot;&gt;// the SparkStatusTracker can still &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; RUNNING status
&lt;/span&gt; 53         &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a finished job.
&lt;/span&gt; 54         &lt;span class=&quot;code-comment&quot;&gt;// Looks like there is a race condition between spark
&lt;/span&gt; 55         &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;event bus&quot;&lt;/span&gt; thread updating it&apos;s internal listener and
&lt;/span&gt; 56         &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; driver thread calling SparkStatusTracker.
&lt;/span&gt; 57         &lt;span class=&quot;code-comment&quot;&gt;// To workaround &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, we will wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; job to &lt;span class=&quot;code-quote&quot;&gt;&quot;finish&quot;&lt;/span&gt;.
&lt;/span&gt; 58         jobStatisticCollector.waitForJobToEnd(jobID);  ********************************************************
 59         sparkPigStats.addJobStats(poStore, sparkOperator, jobID, jobStatisticCollector,
 60                 sparkContext);
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17428484" author="knoguchi" created="Wed, 13 Oct 2021 20:52:15 +0000"  >&lt;p&gt;This was supposed to be fixed in&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-5320&quot; title=&quot;TestCubeOperator#testRollupBasic is flaky on Spark 2.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-5320&quot;&gt;&lt;del&gt;PIG-5320&lt;/del&gt;&lt;/a&gt; but somehow still popping up in spark 2.4 testings.&lt;/p&gt;</comment>
                            <comment id="17815770" author="knoguchi" created="Thu, 8 Feb 2024 17:34:45 +0000"  >&lt;p&gt;Issue seems to be on the Spark side.  &lt;br/&gt;
For now, added a silly polling after &quot;waitForJobToEnd&quot; to double check that job is finished.&lt;/p&gt;</comment>
                            <comment id="17826790" author="rohini" created="Wed, 13 Mar 2024 16:37:53 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17846430" author="knoguchi" created="Tue, 14 May 2024 20:33:17 +0000"  >&lt;p&gt;Thanks for the review Rohini!&#160;&lt;br/&gt;
Committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13066608" name="pig-5416-v01.patch" size="1605" author="knoguchi" created="Thu, 8 Feb 2024 17:32:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0vtog:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>