<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:49:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-335] Casting does not work in certain cases with multiple loads</title>
                <link>https://issues.apache.org/jira/browse/PIG-335</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Given a script like:&lt;/p&gt;

&lt;p&gt;A = load &apos;bla&apos; as (x, y) using Loader1();&lt;br/&gt;
B = load &apos;morebla&apos; as (s, t) using Loader2();&lt;br/&gt;
C = cogroup A by x, B by s;&lt;br/&gt;
D = foreach C generate flatten(A), flatten(B);&lt;br/&gt;
E = foreach D generate x, y, t + 1;&lt;/p&gt;

&lt;p&gt;In this case, in the last foreach, a cast will need to be added to t + 1 to allow t (a byte array) to be added to an integer.  We use load functions to handle this late casting.  The issue is that we do not currently have a way to know whether to use Loader1 or Loader2 to cast the data.  We need to track the lineage of fields so that the cast operator can select the correct loader.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12400940">PIG-335</key>
            <summary>Casting does not work in certain cases with multiple loads</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sms">Santhosh Muthur Srinivasan</assignee>
                                    <reporter username="gates">Alan Gates</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Jul 2008 18:27:36 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:05 +0000</updated>
                            <resolved>Thu, 2 Oct 2008 20:37:17 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12624326" author="shravanmn" created="Thu, 21 Aug 2008 11:19:41 +0000"  >&lt;p&gt;I think Santosh is the right person to fix this. I can swap something you have on the physical side.&lt;/p&gt;</comment>
                            <comment id="12628510" author="sms" created="Thu, 4 Sep 2008 23:05:54 +0000"  >&lt;p&gt;The proposed design for computing the lineage for load functions:&lt;/p&gt;

&lt;p&gt;The FieldSchema class will include an additional member variable that will contain a  list of parent/ancestral canonical names. The list of parent canonical names corresponds to the canonical names required by the operator to compute the field schema.&lt;/p&gt;

&lt;p&gt;The parent list will be empty for canonical names that originate from the load statement and remain unchanged as they move from operator to operator. Only expressions (like arithmentic expressions, etc) will create new canonical names.&lt;/p&gt;

&lt;p&gt;The load operator corresponding to the parent canonical name is required only to cast byte arrays into Pig types. Other than UDFs, there are no operators that generate byte arrays. CONCAT (also an UDF) can generate byte arrays. For now, its an UDF.&lt;/p&gt;

&lt;p&gt;To compute the load function associated with field schema, each canonical name in the parent list of canonical names is matched against the operator responsible for the canonical name. If the operator is an UDF, then we throw an exception as we will not know how to convert a byte array generated by the UDF into a Pig type. The check bubbles up the graph until we hit the load operator corresponding to the canonical name under question.&lt;/p&gt;

&lt;p&gt;Breakdown of the changes:&lt;/p&gt;

&lt;p&gt;1. The logic mentioned in the previous paragraph will reside in the type checker. &lt;br/&gt;
2. The changes to the FieldSchema will (of course) be in limited to the FieldSchema class. &lt;br/&gt;
3. The computation of the list of the parent canonical names will happen in each logical operator.&lt;/p&gt;

&lt;p&gt;Thoughts/comments on the proposed design are welcome.&lt;/p&gt;</comment>
                            <comment id="12628522" author="olgan" created="Thu, 4 Sep 2008 23:37:20 +0000"  >&lt;p&gt;+1. Also streaming would have the same impact as UDFs&lt;/p&gt;</comment>
                            <comment id="12635286" author="sms" created="Mon, 29 Sep 2008 05:10:40 +0000"  >&lt;p&gt;The attached patch, PIG_335.patch adds the lineage feature to PIG. The patch adds more than 50 test cases to TestTypeCheckingValidator as the feature touches all the logical operators.&lt;/p&gt;

&lt;p&gt;All unit tests pass. TestStreaming had 1 failure which was not reproducible when it was run on a standalone basis.&lt;/p&gt;</comment>
                            <comment id="12635465" author="sms" created="Mon, 29 Sep 2008 18:05:19 +0000"  >&lt;p&gt;New patch which fixes the logical to physical translator to use the load function interface only in the case of bytearrays to pig types during object construction and serialization.&lt;/p&gt;</comment>
                            <comment id="12635494" author="sms" created="Mon, 29 Sep 2008 19:07:14 +0000"  >&lt;p&gt;All unit tests pass. TestStreaming had 1 failure which was not reproducible when it was run on a standalone basis.&lt;/p&gt;</comment>
                            <comment id="12635886" author="alangates" created="Tue, 30 Sep 2008 22:51:49 +0000"  >&lt;p&gt;Comments:&lt;/p&gt;

&lt;p&gt;This new method of tracking lineage of data through the script is complex.  It would be good to add a couple of paragraphs to the class level comments in Schema.java describing how it works.&lt;/p&gt;

&lt;p&gt;LOProject, around line 206, you added mFieldSchema.setParent(null, expressionOperator).  If I understand the code correctly this is the case where you are projecting star from a relational operator.  Why is the parent canonical name null in this case?  And what are the ramifications of that?&lt;/p&gt;

&lt;p&gt;If the user writes a query like:&lt;/p&gt;

&lt;p&gt;A = load &apos;Alpha&apos; using MyLoadFunc;&lt;br/&gt;
B = load &apos;Beta&apos; using TheirLoadFunc;&lt;br/&gt;
C = cogroup A by $0, B by $0;&lt;br/&gt;
D = foreach c generate group + 1;&lt;/p&gt;

&lt;p&gt;they will get &quot;Found more than one load function interface to use: MyLoadFunc, TheirLoadFunc&quot; as an error message.  That doesn&apos;t make clear what the issue is (of course there&apos;s more than one load func interface, I gave you two load funcs!).  Something like:  &quot;Cannot resolve load function to use for casting $0 to integer, two possibilities:  MyLoadFunc, TheirLoadFunc&quot; would be much more helpful.&lt;/p&gt;

&lt;p&gt;Same with some of the other error messages that just mention load func interface.  They should at the very least mention that they&apos;re trying to find the right cast to use.&lt;/p&gt;

&lt;p&gt;In TypeCheckingVisitor.getLoadFunc(LogicalOperator, String) I see a list of relational operators (Filter, etc.).  But I don&apos;t see Cogroup, Union, or Cross in that list.  How are you tracing data that comes through those operators?  Those are the ones with the special case, where if the load functions match we know how to do the cast, and if they don&apos;t match we don&apos;t know.  But I don&apos;t see where they&apos;re tracing the lineage of their data.&lt;/p&gt;</comment>
                            <comment id="12636426" author="sms" created="Thu, 2 Oct 2008 18:48:37 +0000"  >&lt;p&gt;1. Added documentation to Schema.java describing the use of the canonical maps&lt;/p&gt;

&lt;p&gt;2. This is a bug. It requires a change in the front end design to handle multi-column projects. I will open a new JIRA for this.&lt;/p&gt;

&lt;p&gt;3. Changed the error message to &quot;Cannot resolve load function to use for casting from &quot; + DataType.findTypeName(inputType) + &quot; to  ...&lt;/p&gt;

&lt;p&gt;4. The error message in the getLoadFunc message is appropriate, the correction I made here was to drop the word interface.&lt;/p&gt;

&lt;p&gt;5. For Unions, Cross and Cogroup, depending on the column accessed, it will either result in the  appropriate traversal or a branch and unbound find.&lt;/p&gt;</comment>
                            <comment id="12636456" author="olgan" created="Thu, 2 Oct 2008 20:37:17 +0000"  >&lt;p&gt;patch committed; thanks, santhosh!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12391112" name="PIG_335.patch" size="166581" author="sms" created="Mon, 29 Sep 2008 05:25:02 +0000"/>
                            <attachment id="12391150" name="PIG_335_1.patch" size="167885" author="sms" created="Mon, 29 Sep 2008 18:05:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163971</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gizj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94506</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>