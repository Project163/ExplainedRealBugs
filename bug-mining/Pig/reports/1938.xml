<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-5235] Typecast with as-clause fails for tuple/bag with an empty schema</title>
                <link>https://issues.apache.org/jira/browse/PIG-5235</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;Following script fails with trunk(0.17).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;a = load &lt;span class=&quot;code-quote&quot;&gt;&apos;test.txt&apos;&lt;/span&gt; as (mytuple:tuple (), gpa:&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;);
b = foreach a generate mytuple as (mytuple2:(name:&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, age:&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;));
store b into &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/deleteme&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2017-05-16 09:52:31,280 [main] ERROR org.apache.pig.tools.grunt.Grunt - ERROR 2999: Unexpected internal error. null&lt;/p&gt;

&lt;p&gt;(This is a continuation from the as-clause fix at &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2315&quot; title=&quot;Make as clause work in generate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2315&quot;&gt;&lt;del&gt;PIG-2315&lt;/del&gt;&lt;/a&gt; and follow up jira &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4933&quot; title=&quot;TestDataBagAccess.testBagConstantFlatten1/TestLogicalPlanBuilder.testQuery90  broken after PIG-2315&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4933&quot;&gt;&lt;del&gt;PIG-4933&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13072454">PIG-5235</key>
            <summary>Typecast with as-clause fails for tuple/bag with an empty schema</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 May 2017 13:57:09 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:30 +0000</updated>
                            <resolved>Thu, 25 May 2017 15:14:47 +0000</resolved>
                                                    <fixVersion>0.17.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16012463" author="knoguchi" created="Tue, 16 May 2017 14:16:15 +0000"  >&lt;p&gt;Log file showed&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Pig Stack Trace
---------------
ERROR 2999: Unexpected internal error. null

java.lang.NullPointerException
        at org.apache.pig.newplan.logical.relational.LogicalSchema$LogicalFieldSchema.typeMatch(LogicalSchema.java:174)
        at org.apache.pig.newplan.logical.visitor.ForEachUserSchemaVisitor.visit(ForEachUserSchemaVisitor.java:190)
        at org.apache.pig.newplan.logical.relational.LOForEach.accept(LOForEach.java:87)
        at org.apache.pig.newplan.DependencyOrderWalker.walk(DependencyOrderWalker.java:75)
        at org.apache.pig.newplan.PlanVisitor.visit(PlanVisitor.java:52)
        at org.apache.pig.newplan.logical.relational.LogicalPlan.validate(LogicalPlan.java:179)
        at org.apache.pig.PigServer$Graph.compile(PigServer.java:1851)
        at org.apache.pig.PigServer$Graph.access$300(PigServer.java:1527)
        at org.apache.pig.PigServer.execute(PigServer.java:1440)
        at org.apache.pig.PigServer.executeBatch(PigServer.java:488)
        at org.apache.pig.PigServer.executeBatch(PigServer.java:471)
        at org.apache.pig.tools.grunt.GruntParser.executeBatch(GruntParser.java:170)
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:233)
        at org.apache.pig.tools.grunt.GruntParser.parseStopOnError(GruntParser.java:204)
        at org.apache.pig.tools.grunt.Grunt.exec(Grunt.java:81)
        at org.apache.pig.Main.run(Main.java:630)
        at org.apache.pig.Main.main(Main.java:175)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;First issue is, &lt;tt&gt;LogicalSchema.typeMatch&lt;/tt&gt; was not properly comparing the null schema.  Fixed.&lt;/p&gt;

&lt;p&gt;After that, script failed with&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: org.apache.pig.impl.logicalLayer.validators.TypeCheckerException: ERROR 1052: Cannot cast tuple with schema mytuple2:tuple(name:NULL,age:NULL) to tuple with schema mytuple2:tuple(name:int,age:double)
        at org.apache.pig.newplan.logical.visitor.TypeCheckingExpVisitor.visit(TypeCheckingExpVisitor.java:518)
        at org.apache.pig.newplan.logical.expression.CastExpression.accept(CastExpression.java:44)
        at org.apache.pig.newplan.ReverseDependencyOrderWalker.walk(ReverseDependencyOrderWalker.java:70)
        at org.apache.pig.newplan.PlanVisitor.visit(PlanVisitor.java:52)
        at org.apache.pig.newplan.logical.visitor.TypeCheckingRelVisitor.visitExpressionPlan(TypeCheckingRelVisitor.java:191)
        at org.apache.pig.newplan.logical.visitor.TypeCheckingRelVisitor.visit(TypeCheckingRelVisitor.java:157)
        at org.apache.pig.newplan.logical.relational.LOGenerate.accept(LOGenerate.java:254)
        at org.apache.pig.newplan.DependencyOrderWalker.walk(DependencyOrderWalker.java:75)
        at org.apache.pig.newplan.PlanVisitor.visit(PlanVisitor.java:52)
        at org.apache.pig.newplan.logical.visitor.TypeCheckingRelVisitor.visit(TypeCheckingRelVisitor.java:174)
        ... 15 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In LOGenearte, we&apos;re converting NULL type to BYTEARRAY for simple types but not for nested-types with TUPLE and BAGs.  Fixed. &lt;/p&gt;

&lt;p&gt;Also while debugging, I got confused on why the schema didn&apos;t change after ForEachUserSchemaVisitor.  I added extra &lt;tt&gt;resetSchema&lt;/tt&gt; for consistency purposes although schema was properly reset after this phase already.&lt;/p&gt;
</comment>
                            <comment id="16014449" author="knoguchi" created="Wed, 17 May 2017 17:26:07 +0000"  >&lt;p&gt;Another display issue I noticed while debugging, &apos;describe&apos; now shows the types BEFORE the typecast.   For example, &lt;tt&gt;describe b&lt;/tt&gt; using the script in description would show &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;b: {mytuple2: (name: bytearray,age: bytearray)}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;since as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-2315&quot; title=&quot;Make as clause work in generate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-2315&quot;&gt;&lt;del&gt;PIG-2315&lt;/del&gt;&lt;/a&gt;, I&apos;ve reset the original user defined schema and let the next typecast foreach take care of this.  Trying to see if I can fix this but may push to another jira.&lt;/p&gt;</comment>
                            <comment id="16015951" author="nkollar" created="Thu, 18 May 2017 15:30:10 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16024288" author="daijy" created="Thu, 25 May 2017 06:37:11 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="16024849" author="knoguchi" created="Thu, 25 May 2017 15:14:47 +0000"  >&lt;p&gt;Thanks for the review Daniel, Nandor !!! &lt;/p&gt;

&lt;p&gt;For the &quot;describe&quot; issue, created &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-5243&quot; title=&quot;describe with typecast on as-clause shows the types before the typecasting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-5243&quot;&gt;&lt;del&gt;PIG-5243&lt;/del&gt;&lt;/a&gt; to follow up.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12868327" name="pig-5235-v01.patch" size="5898" author="knoguchi" created="Tue, 16 May 2017 14:16:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 25 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3f213:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>