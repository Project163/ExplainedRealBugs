<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4967] NPE in PigJobControl.run() when job status is null</title>
                <link>https://issues.apache.org/jira/browse/PIG-4967</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[JobControl] ERROR org.apache.pig.backend.hadoop23.PigJobControl  - Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; trying to run jobs.
java.lang.NullPointerException
	at org.apache.hadoop.mapreduce.Job.getJobName(Job.java:426)
	at org.apache.hadoop.mapreduce.lib.jobcontrol.ControlledJob.toString(ControlledJob.java:93)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.java:2982)
	at java.lang.StringBuilder.append(StringBuilder.java:131)
	at org.apache.pig.backend.hadoop23.PigJobControl.run(PigJobControl.java:182)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher$1.run(MapReduceLauncher.java:276)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12995673">PIG-4967</key>
            <summary>NPE in PigJobControl.run() when job status is null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xiangli">Xiang Li</assignee>
                                    <reporter username="xiangli">Xiang Li</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Aug 2016 15:19:04 +0000</created>
                <updated>Fri, 18 Nov 2016 08:43:45 +0000</updated>
                            <resolved>Thu, 1 Sep 2016 06:49:12 +0000</resolved>
                                    <version>0.15.0</version>
                                    <fixVersion>0.16.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15411966" author="water" created="Mon, 8 Aug 2016 15:38:13 +0000"  >&lt;p&gt;Line 181 and 182 of PigJobControl are&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ControlledJob j = it.next();
log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Checking state of job &quot;&lt;/span&gt;+j);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then it gets into Hadoop&apos;s code&lt;br/&gt;
Line 93 of ControlledJob &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;job name:\t&quot;&lt;/span&gt;).append(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.job.getJobName()).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;\n&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then in Job&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getJobName() {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state == JobState.DEFINE) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.getJobName();
  }
  ensureState(JobState.RUNNING);
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; status.getJobName();   &amp;lt;-- status is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; somehow
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15411967" author="water" created="Mon, 8 Aug 2016 15:38:40 +0000"  >&lt;p&gt;We are using Pig 0.15.0 and Hadoop 2.7.1&lt;/p&gt;</comment>
                            <comment id="15411975" author="water" created="Mon, 8 Aug 2016 15:42:54 +0000"  >&lt;p&gt;Hadoop should fix this, but I think we can do something on Pig side.&lt;/p&gt;</comment>
                            <comment id="15412351" author="daijy" created="Mon, 8 Aug 2016 19:56:00 +0000"  >&lt;p&gt;Sure, you can decompose ControlledJob and do null check on individual variable. Would you like to give a try?&lt;/p&gt;</comment>
                            <comment id="15412884" author="water" created="Tue, 9 Aug 2016 03:56:38 +0000"  >&lt;p&gt;Hi Daniel, thanks for the comments!&lt;/p&gt;

&lt;p&gt;1. Could you please elaborate more on &quot;decompose ControlledJob&quot;?&lt;br/&gt;
Do you mean that we should do some checkings before calling line 182 in PigJobControl as follow:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Checking state of job &quot;&lt;/span&gt;+j);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. When null is detected, do you think I can throw an Exception(May be IOException?) here, or I just log a waring, and give up logging in line 182 and make Pig continue. I prefer the latter one, as line 182 is only to write a log for debug, we should not stop Pig running if the logging has something wrong? Does it make sense to you?&lt;/p&gt;</comment>
                            <comment id="15412955" author="daijy" created="Tue, 9 Aug 2016 05:22:06 +0000"  >&lt;p&gt;Decompose means instead of invoking j.toString, you can construct the string yourself:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;....
sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;job name:\t&quot;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
  sb.append(j.getJobName());
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (NPE) {
}
log.debug(sb);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I am not sure what&apos;s the nature of status=null. If it is truly a bug in Hadoop, we shall just warn and continue.&lt;/p&gt;</comment>
                            <comment id="15424807" author="water" created="Wed, 17 Aug 2016 16:05:23 +0000"  >&lt;p&gt;Hi Daniel, thanks for the explanation!&lt;/p&gt;

&lt;p&gt;Regarding&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I am not sure what&apos;s the nature of status=null&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Something I found so far:&lt;br/&gt;
In the class of Job of Hadoop, JobStatus status is updated by the function called updateStatus(), starting from line 318&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void updateStatus() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.status = ugi.doAs(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrivilegedExceptionAction&amp;lt;JobStatus&amp;gt;() {
        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; JobStatus run() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, InterruptedException {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; cluster.getClient().getJobStatus(status.getJobID());
        }
      });
    }
    &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException ie) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(ie);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.status == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Job status not available &quot;&lt;/span&gt;);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.statustime = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think it is not safe, because this.status will be set no matter what is returned by ugi.doAs(). Even if it returns null (maybe due to some network problems), this.status will be set to null directly. Another thread calling getJobName() has status=null.&lt;br/&gt;
The code followed will check if this.status is null and throw IOException. But it is weird that I did not this IOException in the hadoop log.&lt;/p&gt;

&lt;p&gt;We also found the following message in app-master log&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;INFO org.apache.hadoop.service.AbstractService: Service org.apache.hadoop.yarn.exceptions.YarnRuntimeException: java.net.SocketTimeoutException: 70000 millis timeout while waiting for channel to be ready for read. ch : java.nio.channels.SocketChannel[connected local=xxxx remote=xxxx&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;but so far I could not tell if status=null has something to do with that timeout.&lt;/p&gt;

&lt;p&gt;Anyway, I will upload the patch soon. Thanks!&lt;/p&gt;</comment>
                            <comment id="15427814" author="water" created="Fri, 19 Aug 2016 08:16:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt; &lt;br/&gt;
I uploaded the very first patch&lt;br/&gt;
1. It is almost to clone ControlledJob.toString() and then add try and catch to handle NPE.&lt;br/&gt;
2. The patch applies to branch-0.15, branch-0.16 and trunk.&lt;br/&gt;
3. PigJobControl for hadoop20 (shims/src/hadoop20/org/apache/pig/backend/hadoop20/PigJobControl.java) does not have the same issue&lt;br/&gt;
4. PigJobControl originally has indent=2 spaces.&lt;/p&gt;

&lt;p&gt;I am trying to see if I can add UT for this fix, but currently, I have no idea how to simulate the condition of status=null. Keep studying.&lt;/p&gt;

&lt;p&gt;Would you please review the patch at your earliest convenience? Thanks for your patience and guidance.&lt;/p&gt;</comment>
                            <comment id="15431866" author="daijy" created="Tue, 23 Aug 2016 00:31:09 +0000"  >&lt;p&gt;Thank for your patch, but it is longer than I expected. Can we try to detect if j.getJob().getStatus()==null? That seems doable. I don&apos;t think it is easy for unit test for this, so I am fine without a test.&lt;/p&gt;</comment>
                            <comment id="15432529" author="water" created="Tue, 23 Aug 2016 09:53:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt; Thanks for the comments.&lt;br/&gt;
Regarding &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Can we try to detect if j.getJob().getStatus()==null? That seems doable&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It is addressed by patch 1 uploaded just now. Some comments are also refined.&lt;br/&gt;
Please review, thanks!&lt;/p&gt;</comment>
                            <comment id="15433011" author="water" created="Tue, 23 Aug 2016 15:25:17 +0000"  >&lt;p&gt;Hi Daniel, sorry, patch 1 breaks some core set UT (launched by &quot;ant -Djavac.args=&quot;-Xlint -Xmaxwarns 1000&quot; clean test-commit -Dhadoopversion=23&quot;)&lt;br/&gt;
The error is like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2016-08-23 21:31:37,226 [JobControl] ERROR org.apache.pig.backend.hadoop23.PigJobControl  - Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; trying to run jobs.
java.lang.IllegalStateException: Job in state DEFINE instead of RUNNING
        at org.apache.hadoop.mapreduce.Job.ensureState(Job.java:292)
        at org.apache.hadoop.mapreduce.Job.getStatus(Job.java:337)
        at org.apache.pig.backend.hadoop23.PigJobControl.run(PigJobControl.java:190)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher$1.run(MapReduceLauncher.java:276)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I will study it tomorrow. Sorry for the inconvenience.&lt;/p&gt;</comment>
                            <comment id="15433214" author="daijy" created="Tue, 23 Aug 2016 17:11:40 +0000"  >&lt;p&gt;I assume by doing &quot; j.getJob().getStatus()==null&quot;, we don&apos;t need to pull Job.toString() into Pig, is that right?&lt;/p&gt;</comment>
                            <comment id="15436519" author="water" created="Thu, 25 Aug 2016 08:48:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-6762&quot; title=&quot;ControlledJob#toString failed with NPE when job status is not successfully updated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAPREDUCE-6762&quot;&gt;&lt;del&gt;MAPREDUCE-6762&lt;/del&gt;&lt;/a&gt; fixes this issue on Hadoop side. When status=null, the logic is changed to get job name from the super class of Job, which is JobContextImpl, and eventually get job name from conf.&lt;br/&gt;
The patch is applied into branch-2 (and trunk) of Hadoop, which will be picked up by the next 2.x release (maybe 2.9?). Pig currently picks up Hadoop 2.6.0 in trunk. I think I need to add a TODO in the pig fix to remind revisiting it after Pig picks up a Hadoop version with &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-6762&quot; title=&quot;ControlledJob#toString failed with NPE when job status is not successfully updated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAPREDUCE-6762&quot;&gt;&lt;del&gt;MAPREDUCE-6762&lt;/del&gt;&lt;/a&gt; applied.&lt;/p&gt;</comment>
                            <comment id="15436580" author="water" created="Thu, 25 Aug 2016 09:43:46 +0000"  >&lt;p&gt;HI Daniel,&lt;br/&gt;
do you mean &quot;ControlledJob.toString&quot; rather than &quot;Job.toString&quot; in your comment above?&lt;/p&gt;</comment>
                            <comment id="15436729" author="water" created="Thu, 25 Aug 2016 12:04:29 +0000"  >&lt;p&gt;Looking into the exception which breaks UT against patch 1. It seems that I can not call the following statement&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;j.getJob().getStatus() 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to check if status is null, in order to avoid NPE.&lt;br/&gt;
Here is the code of Job#getStatus():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; JobStatus getStatus() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, InterruptedException {
    ensureState(JobState.RUNNING);
    updateStatus();
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; status;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;At the beginning, job state is DEFINE which causes the exception in ensureState(JobState.RUNNING).&lt;br/&gt;
When calling Job#getJobName() directly(the original code or in patch 0), it will check if state is DEFINE firstly and returns conf.getJobName() if state is DEFINE.&lt;/p&gt;

&lt;p&gt;I might need to change it back to use try...catch. Does it make any sense to you?&lt;/p&gt;</comment>
                            <comment id="15436747" author="water" created="Thu, 25 Aug 2016 12:21:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt; I reviewed all your previous comments and need to check with you if I get you correctly. &lt;br/&gt;
When you mentioned&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Decompose means instead of invoking j.toString, you can construct the string yourself&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;and &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;it is longer than I expected&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;do you mean that I could clone what ControlledJob#toString() does but do not need to include too much details so as to make it shorter?&lt;/p&gt;</comment>
                            <comment id="15437217" author="daijy" created="Thu, 25 Aug 2016 16:58:09 +0000"  >&lt;p&gt;Sorry for confusion. When I say clone ControlledJob#toString(), I don&apos;t realize it is very long. Now I prefer just do a null check on &quot;j.getJob().getStatus()&quot;. If it is null, don&apos;t invoke j.toString(). I don&apos;t want to copy the toString() to Pig now.&lt;/p&gt;</comment>
                            <comment id="15438597" author="water" created="Fri, 26 Aug 2016 07:23:25 +0000"  >&lt;p&gt;Daniel, thanks for clarification! Got your idea.&lt;/p&gt;

&lt;p&gt;I found it breaks UT (and also breaks Pig run on a cluster) if we would like to use j.getJob().getStatus() to check if job status is null.&lt;br/&gt;
Job#getStatus() calls ensureState() at the very beginning, to check if the state is RUNNING. If it is not, throw IllegalStateException, as&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[JobControl] ERROR org.apache.pig.backend.hadoop23.PigJobControl  - Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; trying to run jobs.
java.lang.IllegalStateException: Job in state DEFINE instead of RUNNING
        at org.apache.hadoop.mapreduce.Job.ensureState(Job.java:292)
        at org.apache.hadoop.mapreduce.Job.getStatus(Job.java:337)
        at org.apache.pig.backend.hadoop23.PigJobControl.run(PigJobControl.java:190)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher$1.run(MapReduceLauncher.java:276)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The code of Job#getStatus() is &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; JobStatus getStatus() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, InterruptedException {
    ensureState(JobState.RUNNING);
    updateStatus();
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; status;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think the easiest way to fix this JIRA is to surround&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Checking state of job &quot;&lt;/span&gt; + j);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;with try block and catch NPE.&lt;br/&gt;
Do you think so?&lt;/p&gt;</comment>
                            <comment id="15438626" author="water" created="Fri, 26 Aug 2016 07:45:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;, I uploaded patch 2 to use a try block to surround log.debug(). &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If job status is not null, it calls ControlledJob#toString() as before&lt;/li&gt;
	&lt;li&gt;if job status is null, the NPE will be caught and a warning is logged&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;UT (test-commit) has no failure and I also tested the patch on a cluster with Pig 0.15.0.&lt;/p&gt;

&lt;p&gt;Could you please review at your earliest convenience?&lt;/p&gt;</comment>
                            <comment id="15447855" author="water" created="Tue, 30 Aug 2016 03:06:48 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt;, any comments?&lt;/p&gt;</comment>
                            <comment id="15448412" author="daijy" created="Tue, 30 Aug 2016 08:16:24 +0000"  >&lt;p&gt;I am fine with the fix. The line &quot;Because &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-6762&quot; title=&quot;ControlledJob#toString failed with NPE when job status is not successfully updated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAPREDUCE-6762&quot;&gt;&lt;del&gt;MAPREDUCE-6762&lt;/del&gt;&lt;/a&gt; fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4967&quot; title=&quot;NPE in PigJobControl.run() when job status is null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4967&quot;&gt;&lt;del&gt;PIG-4967&lt;/del&gt;&lt;/a&gt; from Hadoop side&quot; can be removed as it is a little wordy. Will commit shortly.&lt;/p&gt;</comment>
                            <comment id="15448539" author="water" created="Tue, 30 Aug 2016 09:17:41 +0000"  >&lt;p&gt;Daniel, thanks for the comments! I uploaded patch 3 with the following sentence removed from the comment.&lt;br/&gt;
&lt;del&gt;// Because &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-6762&quot; title=&quot;ControlledJob#toString failed with NPE when job status is not successfully updated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAPREDUCE-6762&quot;&gt;&lt;del&gt;MAPREDUCE-6762&lt;/del&gt;&lt;/a&gt; fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-4967&quot; title=&quot;NPE in PigJobControl.run() when job status is null&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-4967&quot;&gt;&lt;del&gt;PIG-4967&lt;/del&gt;&lt;/a&gt; from Hadoop side.&lt;/del&gt;&lt;/p&gt;</comment>
                            <comment id="15454516" author="daijy" created="Thu, 1 Sep 2016 06:49:14 +0000"  >&lt;p&gt;Patch committed to trunk. Thanks Xiang for the first patch get committed!&lt;/p&gt;</comment>
                            <comment id="15454938" author="water" created="Thu, 1 Sep 2016 09:50:53 +0000"  >&lt;p&gt;Hi Daniel, thanks very much for the review and guide! My pleasure to be a part of Pig community.&lt;/p&gt;</comment>
                            <comment id="15464177" author="water" created="Mon, 5 Sep 2016 05:57:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt; I set the fix version to 0.16.0, will you consider to commit this JIRA to origin/branch-0.16 as well?&lt;/p&gt;</comment>
                            <comment id="15473036" author="daijy" created="Thu, 8 Sep 2016 07:06:40 +0000"  >&lt;p&gt;That&apos;s fine for me. Patch committed to branch-0.16 as well.&lt;/p&gt;</comment>
                            <comment id="15474033" author="knoguchi" created="Thu, 8 Sep 2016 14:38:21 +0000"  >&lt;p&gt;0.16.0 is already released.  &lt;br/&gt;
Changing it to 0.16.1.  &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12998390">MAPREDUCE-6762</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12824514" name="PIG-4967-0.patch" size="2650" author="xiangli" created="Fri, 19 Aug 2016 08:06:14 +0000"/>
                            <attachment id="12825019" name="PIG-4967-1.patch" size="2870" author="xiangli" created="Tue, 23 Aug 2016 09:50:13 +0000"/>
                            <attachment id="12825628" name="PIG-4967-2.patch" size="1200" author="xiangli" created="Fri, 26 Aug 2016 07:45:40 +0000"/>
                            <attachment id="12826154" name="PIG-4967-3.patch" size="1128" author="xiangli" created="Tue, 30 Aug 2016 09:18:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i321i7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>