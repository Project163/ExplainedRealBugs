<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4896] Param substitution ignored when redefined </title>
                <link>https://issues.apache.org/jira/browse/PIG-4896</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3359&quot; title=&quot;Register Statements and Param Substitution in Macros&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3359&quot;&gt;&lt;del&gt;PIG-3359&lt;/del&gt;&lt;/a&gt;, the way we cache parameter substitution results changed a bit.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;test.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;A = load &lt;span class=&quot;code-quote&quot;&gt;&apos;input.txt&apos;&lt;/span&gt; ;
%declare output &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/abc&apos;&lt;/span&gt;;
%declare actualoutput &lt;span class=&quot;code-quote&quot;&gt;&apos;$output.out&apos;&lt;/span&gt;;
store A into &lt;span class=&quot;code-quote&quot;&gt;&apos;$actualoutput&apos;&lt;/span&gt;;

%declare output &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/def&apos;&lt;/span&gt;;
%declare actualoutput &lt;span class=&quot;code-quote&quot;&gt;&apos;$output.out&apos;&lt;/span&gt;;
store A into &lt;span class=&quot;code-quote&quot;&gt;&apos;$actualoutput&apos;&lt;/span&gt;;

%declare number &lt;span class=&quot;code-quote&quot;&gt;&apos;1d&apos;&lt;/span&gt;;
%declare shellout `bash -c &lt;span class=&quot;code-quote&quot;&gt;&quot;date -v-$number +&lt;span class=&quot;code-quote&quot;&gt;&apos;%Y%m%d_%H:%S_%s&apos;&lt;/span&gt;; sleep 1&quot;&lt;/span&gt; `
store A into &lt;span class=&quot;code-quote&quot;&gt;&apos;$shellout&apos;&lt;/span&gt;;

%declare shellout `bash -c &lt;span class=&quot;code-quote&quot;&gt;&quot;date -v-$number +&lt;span class=&quot;code-quote&quot;&gt;&apos;%Y%m%d_%H:%S_%s&apos;&lt;/span&gt;; sleep 1&quot;&lt;/span&gt; `
store A into &lt;span class=&quot;code-quote&quot;&gt;&apos;$shellout&apos;&lt;/span&gt;;

%declare number &lt;span class=&quot;code-quote&quot;&gt;&apos;2d&apos;&lt;/span&gt;;
%declare shellout `bash -c &lt;span class=&quot;code-quote&quot;&gt;&quot;date -v-$number +&lt;span class=&quot;code-quote&quot;&gt;&apos;%Y%m%d_%H:%S_%s&apos;&lt;/span&gt;; sleep 1&quot;&lt;/span&gt; `
store A into &lt;span class=&quot;code-quote&quot;&gt;&apos;$shellout&apos;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Result from pig 0.11 (almost correct)&lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;A = load &apos;input.txt&apos; ;&lt;br/&gt;
store A into &apos;/tmp/abc.out&apos;;&lt;br/&gt;
store A into &apos;/tmp/def.out&apos;;&lt;br/&gt;
store A into &apos;20160515_17:32_1463346752&apos;;&lt;br/&gt;
store A into &apos;20160515_17:33_1463346753&apos;; &lt;font color=&quot;red&quot;&gt;NO&lt;/font&gt;&lt;br/&gt;
store A into &apos;20160514_17:34_1463260354&apos;;&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Result from trunk &lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;A = load &apos;input.txt&apos; ;&lt;br/&gt;
store A into &apos;/tmp/abc.out&apos;;&lt;br/&gt;
store A into &apos;/tmp/abc.out&apos;;  &lt;font color=&quot;red&quot;&gt; NO&lt;/font&gt;&lt;br/&gt;
store A into &apos;20160515_15:10_1463338810&apos;;&lt;br/&gt;
store A into &apos;20160515_15:10_1463338810&apos;;&lt;br/&gt;
store A into &apos;20160515_15:10_1463338810&apos;; &lt;font color=&quot;red&quot;&gt;NO&lt;/font&gt;&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12970153">PIG-4896</key>
            <summary>Param substitution ignored when redefined </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="knoguchi">Koji Noguchi</assignee>
                                    <reporter username="knoguchi">Koji Noguchi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 May 2016 21:22:30 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:11 +0000</updated>
                            <resolved>Wed, 15 Jun 2016 19:21:12 +0000</resolved>
                                                    <fixVersion>0.17.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15285367" author="knoguchi" created="Mon, 16 May 2016 21:35:05 +0000"  >&lt;p&gt;For pig 0.11 shell call, it doesn&apos;t reuse the previous result because PreprocessorContext simply compare the result of the shell call &lt;tt&gt;20160515_17:32_1463346752&apos;&lt;/tt&gt; with the shell command line &lt;tt&gt;bash &amp;#45;c &quot;date &amp;#45;v&amp;#45;$number +&apos;%Y%m%d_%H:%S_%s&apos;; sleep 1&quot;&lt;/tt&gt; and simply decides they are different. &lt;/p&gt;

&lt;p&gt;They should be comparing the command themselves. &lt;/p&gt;

&lt;p&gt;For trunk, non-shell parameter substitution is comparing &lt;tt&gt;$output.out&lt;/tt&gt; and &lt;tt&gt;$output.out&lt;/tt&gt; and deciding they represent the same value even though{{$output}} was different for each.  Same for its shell calls. &lt;/p&gt;</comment>
                            <comment id="15285490" author="knoguchi" created="Mon, 16 May 2016 21:54:05 +0000"  >&lt;p&gt;Original issue was from &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3359&quot; title=&quot;Register Statements and Param Substitution in Macros&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3359&quot;&gt;&lt;del&gt;PIG-3359&lt;/del&gt;&lt;/a&gt; where we added &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;There&apos;s a slight complication with the handling of the warnings in that &quot;val&quot; passed to those functions in PreprocessorContext is the raw string, which might not be the same as the val put into param_val. I added a separate hashtable &quot;param_source&quot; to keep track of this original argument, and if it&apos;s seen again to skip it instead of logging the warning.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For non-shell &lt;tt&gt;processOrdLine&lt;/tt&gt;, I&apos;ve simply took out this &quot;param_source&quot; and compare the result from &quot;param_value&quot;.&lt;br/&gt;
For shell &lt;tt&gt;processShellCmd&lt;/tt&gt;, I&apos;ve kept the &quot;param_source&apos; but using the value after the param replacement so that we only use the cache result when command-line matches,&lt;/p&gt;

&lt;p&gt;Running test.&lt;/p&gt;</comment>
                            <comment id="15287180" author="knoguchi" created="Tue, 17 May 2016 18:21:39 +0000"  >&lt;p&gt;Testcase in my patch doesn&apos;t work on linux.  Need to think of one that works with my mac laptop and linux.&lt;/p&gt;</comment>
                            <comment id="15287246" author="knoguchi" created="Tue, 17 May 2016 18:42:26 +0000"  >&lt;p&gt;Changed the test case so that it would run on both platforms. (mac/linux)&lt;/p&gt;</comment>
                            <comment id="15287341" author="knoguchi" created="Tue, 17 May 2016 19:20:01 +0000"  >&lt;p&gt;Sorry for the spam.  Took out two logging I&apos;ve added for my debugging.&lt;/p&gt;</comment>
                            <comment id="15299029" author="rohini" created="Tue, 24 May 2016 22:11:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;store A into &apos;20160515_17:33_1463346753&apos;; NO&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;   I would say that we should go with Pig 0.11 on this behavior and it looks correct to me. User most likely will not be redefining the same shell cmd if value is expected to be same.&lt;/p&gt;</comment>
                            <comment id="15300698" author="knoguchi" created="Wed, 25 May 2016 19:27:39 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;store A into &apos;20160515_17:33_1463346753&apos;; NO&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I would say that we should go with Pig 0.11 on this behavior and it looks correct to me. User most likely will not be redefining the same shell cmd if value is expected to be same.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Got it.  &lt;br/&gt;
Uploading &lt;tt&gt;pig-4896-v04.patch&lt;/tt&gt; which now &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Re-executes even when command-line is identical as long as ovewrite is set&lt;/li&gt;
	&lt;li&gt;Updating a testcase to make sure this re-execution happen&lt;/li&gt;
	&lt;li&gt;Updating the warning message of ovewrites to show the previous and new values.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15300767" author="knoguchi" created="Wed, 25 May 2016 20:12:32 +0000"  >&lt;p&gt;Rohini pointed out that testcase is testing equal instead of not-equal which makes a big difference.  Updated. &lt;/p&gt;</comment>
                            <comment id="15300812" author="rohini" created="Wed, 25 May 2016 20:37:31 +0000"  >&lt;p&gt;Shouldn&apos;t this be not equals?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;Identical shell param should be reexecuted.&quot;&lt;/span&gt;,
+                     filenames[0],
+                     filenames[1]);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15330257" author="knoguchi" created="Tue, 14 Jun 2016 19:32:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;Shouldn&apos;t this be not equals?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;.&lt;br/&gt;
This is fixed with my last &lt;tt&gt;pig-4896-v05.patch&lt;/tt&gt;.  When you have time, can you take a (hopefully final) look? &lt;/p&gt;</comment>
                            <comment id="15330489" author="rohini" created="Tue, 14 Jun 2016 20:16:21 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15332362" author="knoguchi" created="Wed, 15 Jun 2016 19:21:12 +0000"  >&lt;p&gt;Thanks for the review Rohini.&lt;br/&gt;
Committed to trunk(0.17).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12654011">PIG-3359</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12804267" name="pig-4896-v01.patch" size="9369" author="knoguchi" created="Mon, 16 May 2016 21:54:05 +0000"/>
                            <attachment id="12804485" name="pig-4896-v02.patch" size="9344" author="knoguchi" created="Tue, 17 May 2016 18:42:26 +0000"/>
                            <attachment id="12804499" name="pig-4896-v03.patch" size="8879" author="knoguchi" created="Tue, 17 May 2016 19:20:01 +0000"/>
                            <attachment id="12806195" name="pig-4896-v04.patch" size="8139" author="knoguchi" created="Wed, 25 May 2016 19:27:39 +0000"/>
                            <attachment id="12806202" name="pig-4896-v05.patch" size="8142" author="knoguchi" created="Wed, 25 May 2016 20:12:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2y1in:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>