<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:02:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-3087] Refactor TestLogicalPlanBuilder to be meaningful</title>
                <link>https://issues.apache.org/jira/browse/PIG-3087</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;I started doing this as part of another patch, but there are some bigger issues, and I don&apos;t have the time to dig in atm.&lt;/p&gt;

&lt;p&gt;That said, a lot of the tests as written don&apos;t test anything. I used more modern junit patterns, and discovered we had a lot of tests that weren&apos;t functioning properly. Making them function properly unveiled that the general buildLp pattern doesn&apos;t work properly anymore for many cases where it would throw an error in grunt, but for whatever reason no error is thrown in the tests.&lt;/p&gt;

&lt;p&gt;Any test with _1 is a test that previous failed, that now doesn&apos;t. Some, however, don&apos;t make sense so I think what really needs to be done is figure out which should be failing, which shouldn&apos;t, and then fix buildLp accordingly.&lt;/p&gt;

&lt;p&gt;I will attach my pass at it, but it is incomplete and needs work.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12623202">PIG-3087</key>
            <summary>Refactor TestLogicalPlanBuilder to be meaningful</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="szita">&#193;d&#225;m Szita</assignee>
                                    <reporter username="jcoveney">Jonathan Coveney</reporter>
                        <labels>
                            <label>newbie</label>
                    </labels>
                <created>Mon, 10 Dec 2012 19:59:42 +0000</created>
                <updated>Wed, 21 Jun 2017 09:15:18 +0000</updated>
                            <resolved>Thu, 6 Oct 2016 19:10:43 +0000</resolved>
                                                    <fixVersion>0.17.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14111354" author="haogao" created="Tue, 26 Aug 2014 21:15:19 +0000"  >&lt;p&gt;Can I try this?&lt;/p&gt;</comment>
                            <comment id="14111401" author="jcoveney" created="Tue, 26 Aug 2014 21:52:59 +0000"  >&lt;p&gt;Please do!&lt;/p&gt;</comment>
                            <comment id="15496268" author="szita" created="Fri, 16 Sep 2016 12:57:42 +0000"  >&lt;p&gt;Taken a look on this. It seems that quite some mysterious (failing in grunt if inputted manually, but passing in unit test mode) test cases are resulted from query validation being off.&lt;br/&gt;
In the patch I attached (&lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3087&quot; title=&quot;Refactor TestLogicalPlanBuilder to be meaningful&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3087&quot;&gt;&lt;del&gt;PIG-3087&lt;/del&gt;&lt;/a&gt;.1.patch) I have this enabled and also went through and fixed several test cases so that they pass (or fail with expected exception) properly.&lt;br/&gt;
I also found a bug in ForEachUserSchemaVisitor during the process: it seems that it can&apos;t handle use cases where casting is in the latest (foreach) step of the plan - so I fixed this as well: testQuery90a tests this.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daijy&quot; class=&quot;user-hover&quot; rel=&quot;daijy&quot;&gt;daijy&lt;/a&gt; can you please take a look when you get a chance?&lt;/p&gt;</comment>
                            <comment id="15550171" author="daijy" created="Wed, 5 Oct 2016 22:39:00 +0000"  >&lt;p&gt;The bug fix in ForEachUserSchemaVisitor looks good. I have comments on the test fix:&lt;br/&gt;
1. ExecType.LOCAL-&amp;gt;Util.getLocalTestMode()&lt;br/&gt;
2. Seems now you are validate plan for most test, why we miss some validation exception (eg, testQuery22_a)&lt;/p&gt;</comment>
                            <comment id="15551429" author="szita" created="Thu, 6 Oct 2016 09:18:14 +0000"  >&lt;p&gt;Thanks for taking a look.&lt;br/&gt;
1. Fixed - see &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-3087&quot; title=&quot;Refactor TestLogicalPlanBuilder to be meaningful&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-3087&quot;&gt;&lt;del&gt;PIG-3087&lt;/del&gt;&lt;/a&gt;.2.patch&lt;br/&gt;
2. testQuery22_a was testQuery22Fail before, indicating that is should fail and exception should be caught. This is not the case with that Pig script (at least with the trunk version), plan is built successfully without throwing any errors. So all-in-all this one is not expected to fail anymore. (We just didn&apos;t see this because this test case always went through, just not entering in the catch clause)&lt;/p&gt;</comment>
                            <comment id="15552503" author="daijy" created="Thu, 6 Oct 2016 16:58:52 +0000"  >&lt;p&gt;I think the original test is intended to test the fail path. It&apos;s better to change the query to trigger the validation exception:&lt;br/&gt;
A = load &apos;a&apos;;&lt;br/&gt;
B = group A by (*, $0);&lt;/p&gt;</comment>
                            <comment id="15552552" author="szita" created="Thu, 6 Oct 2016 17:15:04 +0000"  >&lt;p&gt;Ah I see your point. Patch revised&lt;/p&gt;</comment>
                            <comment id="15552584" author="jcoveney" created="Thu, 6 Oct 2016 17:24:15 +0000"  >&lt;p&gt;So cool to see this get some love! Adam, you are a prince!&lt;/p&gt;</comment>
                            <comment id="15552793" author="daijy" created="Thu, 6 Oct 2016 18:42:57 +0000"  >&lt;p&gt;Another question, why setting &quot;pigServer.setValidateEachStatement(false);&quot; in testQueryFail67? Doesn&apos;t seem necessary.&lt;/p&gt;</comment>
                            <comment id="15552841" author="szita" created="Thu, 6 Oct 2016 19:01:17 +0000"  >&lt;p&gt;Indeed that&apos;s not needed there - apparently we&apos;ll end up in the catch clause either way: with the validation_on we get a ParserException, with validation_off we get the same, just wrapped into a FrontendException&lt;/p&gt;</comment>
                            <comment id="15552870" author="daijy" created="Thu, 6 Oct 2016 19:10:44 +0000"  >&lt;p&gt;Patch committed to trunk. Thanks Adam, Jonathan!&lt;/p&gt;</comment>
                            <comment id="15553065" author="szita" created="Thu, 6 Oct 2016 20:16:55 +0000"  >&lt;p&gt;Thanks for the review&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12560262" name="PIG-3087-0.patch" size="60649" author="jcoveney" created="Mon, 10 Dec 2012 20:00:41 +0000"/>
                            <attachment id="12828825" name="PIG-3087.1.patch" size="63866" author="szita" created="Fri, 16 Sep 2016 12:31:11 +0000"/>
                            <attachment id="12831925" name="PIG-3087.2.patch" size="64513" author="szita" created="Thu, 6 Oct 2016 09:12:48 +0000"/>
                            <attachment id="12831993" name="PIG-3087.3.patch" size="64754" author="szita" created="Thu, 6 Oct 2016 17:14:40 +0000"/>
                            <attachment id="12832010" name="PIG-3087.4.patch" size="64680" author="szita" created="Thu, 6 Oct 2016 19:01:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>296814</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14hgv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234293</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>