<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:01:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-4689] CSV Writes incorrect header if two CSV files are created in one script</title>
                <link>https://issues.apache.org/jira/browse/PIG-4689</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;From a single Pig script I write two completely different and unrelated CSV files; both with the flag &apos;WRITE_OUTPUT_HEADER&apos;.&lt;/p&gt;

&lt;p&gt;The bug is that both files get the SAME header at the top of the output file even though the data is different.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Reproduction:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;foo.txt&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;bar.txt (Tab separated)&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1	a
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;WriteTwoCSV.pig&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;FOO =
    LOAD &lt;span class=&quot;code-quote&quot;&gt;&apos;foo.txt&apos;&lt;/span&gt;
    USING PigStorage(&lt;span class=&quot;code-quote&quot;&gt;&apos;\t&apos;&lt;/span&gt;)
    AS (a:chararray);

BAR =
    LOAD &lt;span class=&quot;code-quote&quot;&gt;&apos;bar.txt&apos;&lt;/span&gt;
    USING PigStorage(&lt;span class=&quot;code-quote&quot;&gt;&apos;\t&apos;&lt;/span&gt;)
    AS (b:chararray, c:chararray);

STORE FOO into &lt;span class=&quot;code-quote&quot;&gt;&apos;Foo&apos;&lt;/span&gt;
USING org.apache.pig.piggybank.storage.CSVExcelStorage(&lt;span class=&quot;code-quote&quot;&gt;&apos;\t&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;NO_MULTILINE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNIX&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;WRITE_OUTPUT_HEADER&apos;&lt;/span&gt;);

STORE BAR into &lt;span class=&quot;code-quote&quot;&gt;&apos;Bar&apos;&lt;/span&gt;
USING org.apache.pig.piggybank.storage.CSVExcelStorage(&lt;span class=&quot;code-quote&quot;&gt;&apos;\t&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;NO_MULTILINE&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;UNIX&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;WRITE_OUTPUT_HEADER&apos;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;Command:&lt;/b&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;pig -x local WriteTwoCSV.pig&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;b&gt;Result:&lt;/b&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;cat Bar/part-*&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;b	c
1	a
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;&lt;p&gt;cat Foo/part-*&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;b	c
1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;The error is that the &lt;tt&gt;Foo&lt;/tt&gt; output has a the two column header from the &lt;tt&gt;Bar&lt;/tt&gt; output.&lt;/b&gt;&lt;br/&gt;
&lt;b&gt;One of the effects is that parsing the &lt;tt&gt;Foo&lt;/tt&gt; data will probably fail due to the varying number of columns&lt;/b&gt;&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12902403">PIG-4689</key>
            <summary>CSV Writes incorrect header if two CSV files are created in one script</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nielsbasjes">Niels Basjes</assignee>
                                    <reporter username="nielsbasjes">Niels Basjes</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Oct 2015 12:00:58 +0000</created>
                <updated>Wed, 8 Jun 2016 20:48:24 +0000</updated>
                            <resolved>Fri, 6 Nov 2015 20:04:53 +0000</resolved>
                                    <version>0.14.0</version>
                    <version>0.15.0</version>
                                    <fixVersion>0.16.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14944755" author="nielsbasjes" created="Tue, 6 Oct 2015 09:04:22 +0000"  >&lt;p&gt;I double checked and the effect is identical to running on a cluster.&lt;/p&gt;</comment>
                            <comment id="14944799" author="nielsbasjes" created="Tue, 6 Oct 2015 09:42:28 +0000"  >&lt;p&gt;Quick first analysis of the problem:&lt;br/&gt;
In the [checkSchema method the schema is stored with the class and the udfContextSignature as the &apos;key&apos; for this class (&lt;a href=&quot;https://github.com/apache/pig/blob/trunk/contrib/piggybank/java/src/main/java/org/apache/pig/piggybank/storage/CSVExcelStorage.java#L245&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Link&lt;/a&gt;).&lt;br/&gt;
Because in both instances we have the same class AND the same the argumentlist they apparently get the same udfContextSignature : Thus one of them overwrites the schema for the other.&lt;/p&gt;

&lt;p&gt;At this point my best guess is that the actual values that Pig calls the &apos;setUDFContextSignature&apos; with is not unique enough.&lt;/p&gt;</comment>
                            <comment id="14944807" author="nielsbasjes" created="Tue, 6 Oct 2015 09:47:47 +0000"  >&lt;p&gt;&lt;b&gt;Found it&lt;/b&gt;&lt;br/&gt;
Turns out the CSVExcelStorage implemented the WRONG setter for receiving the unique UDFContextSignature. &lt;br/&gt;
Hence no unique value was ever set and all instances used &apos;null&apos; as their &apos;unique value&apos;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Foo/part-m-00000&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;a
1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Bar/part-m-00000&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;b	c
1	a
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14944808" author="nielsbasjes" created="Tue, 6 Oct 2015 09:49:27 +0000"  >&lt;p&gt;Please verify the patch I wrote (&quot;It works in my machine&quot;).&lt;/p&gt;</comment>
                            <comment id="14944992" author="nielsbasjes" created="Tue, 6 Oct 2015 13:00:31 +0000"  >&lt;p&gt;I am uncertain if the rename is correct.&lt;br/&gt;
Possibly adding the new method is better (setting the same value).&lt;/p&gt;</comment>
                            <comment id="14957110" author="nielsbasjes" created="Wed, 14 Oct 2015 15:43:22 +0000"  >&lt;p&gt;Needs rework&lt;/p&gt;</comment>
                            <comment id="14957300" author="rohini" created="Wed, 14 Oct 2015 17:13:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;Possibly adding the new method is better (setting the same value).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;   Yes. You need both. setUDFContextSignature is for LoadFunc and setStoreFuncUDFContextSignature is for StoreFunc. &lt;/p&gt;</comment>
                            <comment id="14960457" author="nielsbasjes" created="Fri, 16 Oct 2015 10:07:28 +0000"  >&lt;p&gt;Revised patch that adds the new function setStoreFuncUDFContextSignature.&lt;br/&gt;
This passes the TestCSVExcelStorage and also solves the reported reproduction path.&lt;/p&gt;</comment>
                            <comment id="14975131" author="daijy" created="Mon, 26 Oct 2015 21:30:41 +0000"  >&lt;p&gt;Can you add your test case to TestCSVExcelStorage?&lt;/p&gt;</comment>
                            <comment id="14976657" author="nielsbasjes" created="Tue, 27 Oct 2015 16:27:15 +0000"  >&lt;p&gt;Yes, will do.&lt;/p&gt;</comment>
                            <comment id="14991611" author="nielsbasjes" created="Thu, 5 Nov 2015 12:43:53 +0000"  >&lt;p&gt;I created a unit test to reproduce the problem.&lt;br/&gt;
I validated this test in a separate project because after fighting &apos;ant&apos; for 2 hours I gave up. (Please let&apos;s switch to something different from ant)&lt;/p&gt;

&lt;p&gt;Please validate if I did it correctly because running and testing code in piggybank is near impossible for me.&lt;/p&gt;</comment>
                            <comment id="14994336" author="daijy" created="Fri, 6 Nov 2015 20:04:53 +0000"  >&lt;p&gt;+1, verified the test case works. Patch committed to trunk. Thanks Niels!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12765152" name="PIG-4689-2015-10-06.patch" size="724" author="nielsbasjes" created="Tue, 6 Oct 2015 09:47:47 +0000"/>
                            <attachment id="12767040" name="PIG-4689-20151016.patch" size="801" author="nielsbasjes" created="Fri, 16 Oct 2015 10:07:28 +0000"/>
                            <attachment id="12770798" name="PIG-4689-20151105.patch" size="4054" author="nielsbasjes" created="Thu, 5 Nov 2015 12:43:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|hzzzyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>