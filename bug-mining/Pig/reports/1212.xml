<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:57:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-3329] RANK operator failed when working with SPLIT </title>
                <link>https://issues.apache.org/jira/browse/PIG-3329</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;input.txt:&lt;br/&gt;
1 2 3&lt;br/&gt;
4 5 6&lt;br/&gt;
7 8 9&lt;/p&gt;

&lt;p&gt;script:&lt;br/&gt;
a = load &apos;input.txt&apos; using PigStorage(&apos; &apos;) as (a:int, b:int, c:int);&lt;br/&gt;
SPLIT a into b if a &amp;gt; 0, c if a &amp;gt; 5;&lt;br/&gt;
d = RANK b;&lt;br/&gt;
dump d;&lt;/p&gt;

&lt;p&gt;job will fail with error message:&lt;br/&gt;
java.lang.RuntimeException: Unable to read counter pig.counters.counter_4929375455335572575_-1&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.PORank.addRank(PORank.java:161)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.PORank.getNext(PORank.java:134)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.PhysicalOperator.processInput(PhysicalOperator.java:308)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POSplit.getNext(POSplit.java:214)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.runPipeline(PigGenericMapBase.java:283)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:278)&lt;br/&gt;
	at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigGenericMapBase.map(PigGenericMapBase.java:64)&lt;br/&gt;
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:157)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:673)&lt;br/&gt;
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:324)&lt;br/&gt;
	at org.apache.hadoop.mapred.Child$4.run(Child.java:275)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at javax.security.auth.Subject.doAs(Subject.java:396)&lt;br/&gt;
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1340)&lt;br/&gt;
	at org.apache.hadoop.mapred.Child.main(Child.java:269)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12648108">PIG-3329</key>
            <summary>RANK operator failed when working with SPLIT </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xalan">Allan Avenda&#241;o</assignee>
                                    <reporter username="redisliu">Redis Liu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 May 2013 03:44:41 +0000</created>
                <updated>Mon, 14 Oct 2013 16:46:02 +0000</updated>
                            <resolved>Sun, 9 Jun 2013 22:13:00 +0000</resolved>
                                    <version>0.11.1</version>
                                    <fixVersion>0.12.0</fixVersion>
                    <fixVersion>0.11.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="13665071" author="redisliu" created="Thu, 23 May 2013 11:06:41 +0000"  >&lt;p&gt;Anybody working on this?&lt;/p&gt;</comment>
                            <comment id="13665400" author="dreambird" created="Thu, 23 May 2013 17:41:53 +0000"  >&lt;p&gt;Redis, I actually can reproduce the issue with queries&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;d = load &apos;input1&apos; as (a:int, b:int, c:int);
SPLIT d into e if a &amp;gt; 0, f if a &amp;lt; 0;
g = RANK e;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the error I got is from JobControlCompiler, it complains missing OperationID in MROperPlan. I guess the reason is when compile from physical plan to MROperPlan, the operators order is wrong, but not sure. I don&apos;t have a fix yet....&lt;/p&gt;

&lt;p&gt;The workaround for now is using FILTER BY&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;d = load &apos;input1&apos; as (a:int, b:int, c:int);
e = filter d by a &amp;gt; 0;
g = RANK e;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I post comment when I have new find. Thanks.&lt;/p&gt;</comment>
                            <comment id="13665403" author="dreambird" created="Thu, 23 May 2013 17:43:27 +0000"  >&lt;p&gt;The issue doesn&apos;t happen when using RANK BY, so another workaround is using &quot;g = RANK e BY a;&quot;. &lt;/p&gt;</comment>
                            <comment id="13665478" author="xalan" created="Thu, 23 May 2013 18:44:41 +0000"  >&lt;p&gt;Hi to everybody,&lt;/p&gt;

&lt;p&gt;I&apos;m working on this, Redis. In the meanwhile, a workaround is through a FILTER BY and then a RANK operator. &lt;/p&gt;

&lt;p&gt;In fact, Johnny, the RANK BY provides a ranking by considering the values of column a. Instead, RANK assigns a sequential number to each tuple. &lt;/p&gt;</comment>
                            <comment id="13665532" author="mwagner" created="Thu, 23 May 2013 19:35:04 +0000"  >&lt;p&gt;Allan/Johnny: I took a look at this and got an exception using a filter also:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.lang.RuntimeException: Error to read counters into Rank operation counterSize 0
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.saveCounters(JobControlCompiler.java:386)
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.updateMROpPlan(JobControlCompiler.java:332)
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceLauncher.launchPig(MapReduceLauncher.java:380)
        at org.apache.pig.PigServer.launchPlan(PigServer.java:1322)
        ... 11 more
Caused by: java.lang.NullPointerException
        at org.apache.hadoop.mapred.Counters.getShortName(Counters.java:669)
        at org.apache.hadoop.mapred.Counters.getGroup(Counters.java:405)
        at org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.JobControlCompiler.saveCounters(JobControlCompiler.java:360)
        ... 14 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13665611" author="xalan" created="Thu, 23 May 2013 20:21:30 +0000"  >&lt;p&gt;Hi Mark,&lt;/p&gt;

&lt;p&gt;Could you post your script?&lt;/p&gt;

&lt;p&gt;I guess, the output of FILTER is empty. &lt;/p&gt;</comment>
                            <comment id="13665637" author="mwagner" created="Thu, 23 May 2013 20:40:52 +0000"  >&lt;p&gt;Ah, my load was broken. The workaround seems right in that case. Thanks, Allan&lt;/p&gt;</comment>
                            <comment id="13669057" author="dreambird" created="Wed, 29 May 2013 07:22:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xalan&quot; class=&quot;user-hover&quot; rel=&quot;xalan&quot;&gt;xalan&lt;/a&gt;, thanks for your comments.&lt;br/&gt;
&quot;the RANK BY provides a ranking by considering the values of column a. Instead, RANK assigns a sequential number to each tuple.&quot;&lt;br/&gt;
does this refers to LogToPhyTranslationVisitor.visit(LORank loRank) function ?&lt;/p&gt;</comment>
                            <comment id="13673936" author="dreambird" created="Tue, 4 Jun 2013 01:54:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xalan&quot; class=&quot;user-hover&quot; rel=&quot;xalan&quot;&gt;xalan&lt;/a&gt;, are you working this right now? I got the similar exception when I was working on another patch, so it will be very nice if I can understand how will you resolve this issue. Thanks a lot!&lt;/p&gt;</comment>
                            <comment id="13675758" author="xalan" created="Wed, 5 Jun 2013 09:46:44 +0000"  >&lt;p&gt;Hi Johnny, &lt;/p&gt;

&lt;p&gt;As I understood of your question: &quot;does this refers to LogToPhyTranslationVisitor.visit(LORank loRank) function ?&quot;&lt;br/&gt;
Yes, at LogToPhyTranslationVisitor is differentiated the functionality of RANK BY and RANK. On simple words, this is how it works:&lt;br/&gt;
RANK: Counter + Rank&lt;br/&gt;
RANK BY: Group + ForEach + Sort + Counter + Rank + ForEach &lt;/p&gt;

&lt;p&gt;And yes, I&apos;m working on it. I guess this weekend I&apos;ll publish a patch for it. &lt;/p&gt;</comment>
                            <comment id="13676006" author="xalan" created="Wed, 5 Jun 2013 15:11:08 +0000"  >&lt;p&gt;According to my local tests, it&apos;s working fine. I&apos;ll proceed with nightly tests on this week. &lt;/p&gt;</comment>
                            <comment id="13678689" author="redisliu" created="Sat, 8 Jun 2013 05:52:57 +0000"  >&lt;p&gt;Thanks Allan ! the patch works fine for me too.&lt;/p&gt;</comment>
                            <comment id="13678695" author="xalan" created="Sat, 8 Jun 2013 07:00:26 +0000"  >&lt;p&gt;Yesterday, it passed e2e tests on a local machine, I hadn&apos;t tried it on a cluster, yet.&lt;/p&gt;</comment>
                            <comment id="13678917" author="cheolsoo" created="Sun, 9 Jun 2013 02:43:51 +0000"  >&lt;p&gt;Hi Allan, thank you for the patch. I can run e2e tests on cluster. Let me also run unit tests.&lt;/p&gt;</comment>
                            <comment id="13678954" author="xalan" created="Sun, 9 Jun 2013 06:13:25 +0000"  >&lt;p&gt;Thanks Cheolsoo for testing it! I tested it before with unit tests and it passed them.&lt;/p&gt;</comment>
                            <comment id="13679122" author="cheolsoo" created="Sun, 9 Jun 2013 18:03:26 +0000"  >&lt;p&gt;All the Rank-related e2e test cases (Rank_1..10) pass on cluster too. I will commit it soon.&lt;/p&gt;

&lt;p&gt;+1. &lt;/p&gt;</comment>
                            <comment id="13679124" author="xalan" created="Sun, 9 Jun 2013 18:15:40 +0000"  >&lt;p&gt;Thanks again Cheolsoo! Yesterday, I created an specific test for it, included on this patch. &lt;/p&gt;</comment>
                            <comment id="13679197" author="cheolsoo" created="Sun, 9 Jun 2013 22:12:43 +0000"  >&lt;p&gt;I committed the patch to both trunk and branch-0.11.&lt;/p&gt;

&lt;p&gt;I fixed CHANGES.txt while doing so, so I am attaching the diff files for the record.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12586993" name="PIG-3329-branch-11.patch" size="8274" author="cheolsoo" created="Sun, 9 Jun 2013 22:12:43 +0000"/>
                            <attachment id="12586994" name="PIG-3329-trunk.patch" size="9464" author="cheolsoo" created="Sun, 9 Jun 2013 22:12:43 +0000"/>
                            <attachment id="12586331" name="patch01" size="5476" author="xalan" created="Wed, 5 Jun 2013 15:11:08 +0000"/>
                            <attachment id="12586960" name="patch02" size="7854" author="xalan" created="Sun, 9 Jun 2013 18:15:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328464</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 24 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ko73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328808</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>