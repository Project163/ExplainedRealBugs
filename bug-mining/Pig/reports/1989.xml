<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:03:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-5362] Parameter substitution of shell cmd results doesn&apos;t handle backslash	</title>
                <link>https://issues.apache.org/jira/browse/PIG-5362</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;It looks like there is a bug in how parameter substitution is handled in PreprocessorContext.java that causes parameter values that contain backslashed to not be processed correctly, resulting in the backslashes being lost. For example, if you had the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
%DECLARE A `echo \$foo\\bar`
B = LOAD $A 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You would expect the echo command to produce the output&#160;&lt;tt&gt;$foo\bar&lt;/tt&gt;&#160;but the actual value that gets substituted is&#160;&lt;tt&gt;\$foobar&lt;/tt&gt;. This is happening because the&#160;&lt;tt&gt;substitute&lt;/tt&gt;&#160;method in PreprocessorContext.java uses a regular expression replacement instead of a basic string substitution and $&#160;and&#160;\ are special characters. The code attempts to escape $, but does not escape backslash.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13189530">PIG-5362</key>
            <summary>Parameter substitution of shell cmd results doesn&apos;t handle backslash	</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="wlauer@yahoo-inc.com">Will Lauer</assignee>
                                    <reporter username="wlauer@yahoo-inc.com">Will Lauer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Oct 2018 18:55:43 +0000</created>
                <updated>Mon, 15 Sep 2025 11:29:09 +0000</updated>
                            <resolved>Thu, 23 Apr 2020 11:34:44 +0000</resolved>
                                                    <fixVersion>0.18.0</fixVersion>
                                    <component>parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16645619" author="rohini" created="Wed, 10 Oct 2018 22:16:16 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
echo $\\stuff becomes echo $stuff, but echo $\\\\stuff becomes $\\stuff. Does not sound right to me.Shouldn&apos;t $\\stuff become  $\stuff ?
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16647981" author="wlauer@yahoo-inc.com" created="Fri, 12 Oct 2018 14:40:42 +0000"  >&lt;p&gt;Updating the patch to clarify the unit test.&lt;/p&gt;

&lt;p&gt;Backslash is treated by the shell as an escape character when not surrounded by appropriate quotes. This gets confusing when combined with Java&apos;s quoting of slashes. So &lt;tt&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;}} in java becomes {{&lt;/tt&gt; being passed to the shell. Depending on how &lt;tt&gt;$\stuff&lt;/tt&gt; gets interpretted by both the shell and by echo, the &lt;tt&gt;}} character may or may not be considered an unassociated escape. To avoid all this confusion, quoting the command with single quotes clarifies for the shell how escapes should be handled. So {{&quot;echo &apos;$&lt;br class=&quot;atl-forced-newline&quot; /&gt;stuff&apos;&quot;&lt;/tt&gt; becomes the command &lt;tt&gt;echo &apos;$\stuff&apos;&lt;/tt&gt; passed to the shell, and produces the output &lt;tt&gt;$\stuff&lt;/tt&gt; for java to ingest and assign back to the parameter in Pig.&lt;/p&gt;</comment>
                            <comment id="16648140" author="rohini" created="Fri, 12 Oct 2018 17:06:39 +0000"  >&lt;p&gt;+1. Committed to trunk. Fixed typo testEscaing to testEscaping before committing. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wlauer%40yahoo-inc.com&quot; class=&quot;user-hover&quot; rel=&quot;wlauer@yahoo-inc.com&quot;&gt;wlauer@yahoo-inc.com&lt;/a&gt; for fixing this.&lt;/p&gt;</comment>
                            <comment id="16648417" author="satishsaley" created="Fri, 12 Oct 2018 20:27:09 +0000"  >&lt;p&gt;There are test failures in&#160;TestParamSubPreproc. I have attached test log.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16701104" author="knoguchi" created="Tue, 27 Nov 2018 22:02:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;There are test failures in TestParamSubPreproc. I have attached test log.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;9 failures total&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestParamSubPreproc.testCmdlineFileDeclareCombo
TestParamSubPreproc.testSameParamInMultipleFiles
TestParamSubPreproc.testCmdlineFileComboDuplicate
TestParamSubPreproc.testCmdlineFileCombo
TestParamSubPreproc.testMultipleParamsinSingleLine
TestParamSubPreproc.testCmdlineFileDeclareDefaultComboDuplicates
TestParamSubPreproc.testFileParamsFromMultipleFiles
TestParamSubPreproc.testMultipleDeclareScope
TestParamSubPreproc.testCmdlineFileDeclareComboDuplicates
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rohini&quot; class=&quot;user-hover&quot; rel=&quot;rohini&quot;&gt;rohini&lt;/a&gt;, do we want to revert this?  Or create a new jira?&lt;/p&gt;</comment>
                            <comment id="16701153" author="rohini" created="Tue, 27 Nov 2018 23:13:07 +0000"  >&lt;p&gt;Reopening it. Will said he had a fix for the issue. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wlauer%40yahoo-inc.com&quot; class=&quot;user-hover&quot; rel=&quot;wlauer@yahoo-inc.com&quot;&gt;wlauer@yahoo-inc.com&lt;/a&gt;,&lt;br/&gt;
   Can you upload the test fix?&lt;/p&gt;</comment>
                            <comment id="16701389" author="wlauer@yahoo-inc.com" created="Wed, 28 Nov 2018 04:39:28 +0000"  >&lt;p&gt;I&apos;ve uploaded a new patch that changes how the parser detects and handles quoted strings. I think this is probably the correct approach for fixing the quoting issues, but I&apos;m not sure yet whether there are any backward incompatibilities introduced by this fix.&lt;/p&gt;</comment>
                            <comment id="16703421" author="knoguchi" created="Thu, 29 Nov 2018 16:09:25 +0000"  >&lt;p&gt;With &lt;tt&gt;pig4.patch&lt;/tt&gt;, it fixes the failed tests mentioned above but now 3 different tests are failing.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.pig.test.TestPigScriptParser.testBackSlashOnly
org.apache.pig.test.TestPigScriptParser.testBackSlashReplace
org.apache.pig.test.TestPigScriptParser.testBackSlashSingleQuote
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16703430" author="wlauer@yahoo-inc.com" created="Thu, 29 Nov 2018 16:12:12 +0000"  >&lt;p&gt;I suspected something like that might happen. I&apos;ve had issues building locally, and wasn&apos;t able to run all the tests to verify that something else wasn&apos;t breaking. I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="16735845" author="szita" created="Mon, 7 Jan 2019 14:00:00 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wlauer%40yahoo-inc.com&quot; class=&quot;user-hover&quot; rel=&quot;wlauer@yahoo-inc.com&quot;&gt;wlauer@yahoo-inc.com&lt;/a&gt;, is there any update on fixing the failing tests?&lt;/p&gt;</comment>
                            <comment id="16735984" author="wlauer@yahoo-inc.com" created="Mon, 7 Jan 2019 15:50:26 +0000"  >&lt;p&gt;I&apos;ve been talking with Rohini offline about a possible fix. The most recent attachment (pig5.patch) is an attempt at addressing them, but its a deeper rewrite of the parser to handle quoting more correctly and has more risk.&lt;/p&gt;</comment>
                            <comment id="17019575" author="szita" created="Mon, 20 Jan 2020 16:11:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wlauer%40yahoo-inc.com&quot; class=&quot;user-hover&quot; rel=&quot;wlauer@yahoo-inc.com&quot;&gt;wlauer@yahoo-inc.com&lt;/a&gt;, I just had a look on &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12950227/12950227_pig5.patch&quot; title=&quot;pig5.patch attached to PIG-5362&quot;&gt;pig5.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;. In general the changes in the .jj files look good to me.&lt;/p&gt;

&lt;p&gt;However:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The new patch should only contain the difference from the current trunk HEAD (so as I see it now: only the .jj files), because the original change was not reverted.&lt;/li&gt;
	&lt;li&gt;I&apos;d also like to see a testcase that is failing without this fix, but passing with it. The current one (TestPreprocessorContext#testEscaping) is passing now.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17024252" author="szita" created="Mon, 27 Jan 2020 11:04:35 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wlauer%40yahoo-inc.com&quot; class=&quot;user-hover&quot; rel=&quot;wlauer@yahoo-inc.com&quot;&gt;wlauer@yahoo-inc.com&lt;/a&gt;, can you please take a look at this? We&apos;d like to have this fix for the upcoming Pig release (0.18.0).&lt;/p&gt;</comment>
                            <comment id="17089515" author="szita" created="Wed, 22 Apr 2020 09:50:48 +0000"  >&lt;p&gt;Not waiting any longer here..&lt;/p&gt;

&lt;p&gt;I looked into this again and uploaded &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13000818/13000818_PIG-5362.addendum.0.patch&quot; title=&quot;PIG-5362.addendum.0.patch attached to PIG-5362&quot;&gt;PIG-5362.addendum.0.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; based on pig5.patch..&lt;/p&gt;

&lt;p&gt;I removed the unnecessary parts, and tested that&#160;TestPreprocessorContext#testEscaping would indeed actually fail without the original &lt;a href=&quot;https://issues.apache.org/jira/browse/PIG-5362&quot; title=&quot;Parameter substitution of shell cmd results doesn&amp;#39;t handle backslash	&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PIG-5362&quot;&gt;&lt;del&gt;PIG-5362&lt;/del&gt;&lt;/a&gt; commit, so we should be fine with it.&lt;/p&gt;

&lt;p&gt;I&apos;m currently waiting for a full test result with this addendum patch.&lt;/p&gt;</comment>
                            <comment id="17090393" author="szita" created="Thu, 23 Apr 2020 08:33:05 +0000"  >&lt;p&gt;I&apos;ve run all tests and all have passed with &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13000818/13000818_PIG-5362.addendum.0.patch&quot; title=&quot;PIG-5362.addendum.0.patch attached to PIG-5362&quot;&gt;PIG-5362.addendum.0.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; in place. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkollar&quot; class=&quot;user-hover&quot; rel=&quot;nkollar&quot;&gt;nkollar&lt;/a&gt;&#160;can you please take a look and approve this change?&lt;/p&gt;</comment>
                            <comment id="17090397" author="nkollar" created="Thu, 23 Apr 2020 08:37:15 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17090531" author="szita" created="Thu, 23 Apr 2020 11:34:32 +0000"  >&lt;p&gt;Thanks Nandor for reviewing, this is now committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13000818" name="PIG-5362.addendum.0.patch" size="6232" author="szita" created="Wed, 22 Apr 2020 09:48:13 +0000"/>
                            <attachment id="12942431" name="pig.patch" size="2500" author="wlauer@yahoo-inc.com" created="Thu, 4 Oct 2018 18:56:56 +0000"/>
                            <attachment id="12943300" name="pig2.patch" size="2502" author="wlauer@yahoo-inc.com" created="Wed, 10 Oct 2018 19:58:52 +0000"/>
                            <attachment id="12943654" name="pig3.patch" size="2611" author="wlauer@yahoo-inc.com" created="Fri, 12 Oct 2018 14:28:13 +0000"/>
                            <attachment id="12949790" name="pig4.patch" size="8399" author="wlauer@yahoo-inc.com" created="Wed, 28 Nov 2018 04:38:26 +0000"/>
                            <attachment id="12950227" name="pig5.patch" size="8267" author="wlauer@yahoo-inc.com" created="Fri, 30 Nov 2018 21:11:43 +0000"/>
                            <attachment id="12943715" name="test-failure.txt" size="12567" author="satishsaley" created="Fri, 12 Oct 2018 20:28:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 29 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3yujz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>