<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 19:48:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PIG-359] Semantics of generate * have changed</title>
                <link>https://issues.apache.org/jira/browse/PIG-359</link>
                <project id="12310730" key="PIG">Pig</project>
                    <description>&lt;p&gt;In the main trunk, the script&lt;/p&gt;

&lt;p&gt;A = load &apos;myfile&apos;;&lt;br/&gt;
B = foreach A generate *;&lt;/p&gt;

&lt;p&gt;returns:&lt;/p&gt;

&lt;p&gt;(x, y, z)&lt;/p&gt;

&lt;p&gt;In the types branch, it returns:&lt;/p&gt;

&lt;p&gt;((x, y, z))&lt;/p&gt;

&lt;p&gt;There is an extra level of tuple in it.  In the main branch generate * seems to include an implicit flatten.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12401714">PIG-359</key>
            <summary>Semantics of generate * have changed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shravanmn">Shravan Matthur Narayanamurthy</assignee>
                                    <reporter username="gates">Alan Gates</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Aug 2008 17:45:47 +0000</created>
                <updated>Wed, 24 Mar 2010 22:04:06 +0000</updated>
                            <resolved>Wed, 27 Aug 2008 21:43:07 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                    <component>impl</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12623497" author="olgan" created="Mon, 18 Aug 2008 23:32:33 +0000"  >&lt;p&gt;Bumping the priority since we see users who are trying this code running into this issue&lt;/p&gt;</comment>
                            <comment id="12624478" author="olgan" created="Thu, 21 Aug 2008 21:15:02 +0000"  >&lt;p&gt;Shravan, could you take a look please&lt;/p&gt;</comment>
                            <comment id="12624839" author="shravanmn" created="Fri, 22 Aug 2008 14:20:31 +0000"  >&lt;p&gt;Added a check in CreateTuple to see if we have a Single Tuple inside a Tuple and added logic to return the inner tuple if so.&lt;/p&gt;</comment>
                            <comment id="12624859" author="olgan" created="Fri, 22 Aug 2008 14:54:16 +0000"  >&lt;p&gt;Shravan, why is it always a good idea to do this? This is not * specific?&lt;/p&gt;</comment>
                            <comment id="12625316" author="shravanmn" created="Mon, 25 Aug 2008 10:47:15 +0000"  >&lt;p&gt;You are right olga. This is * specific. Changed the patch to include the following:&lt;br/&gt;
In foreach when the operator gets created it also creates a list of the leaves of its inner plans for optimization. Here I also check if the leaf of an innerplan is a project&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. If so I set flatten true for that plan. This causes the foreach logic to flatten tuples.&lt;/p&gt;

&lt;p&gt;The same was the case in POUserFunc when you process * as an input. The semantics were different from the trunk. So changed it in a similar way to ensure the trunk behaviour. &lt;/p&gt;

&lt;p&gt;Because of the changes, needed to change a test case and a golden file.&lt;/p&gt;

&lt;p&gt;All of them inculded in 359-1. Thanks Olga for reviewing.&lt;/p&gt;</comment>
                            <comment id="12625885" author="alangates" created="Tue, 26 Aug 2008 21:45:45 +0000"  >&lt;p&gt;I don&apos;t think we want the changes to POUserFunc.  In the cases of udf&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; the right thing will happen in the existing code because lines 159-161 handle making sure we don&apos;t double wrap tuples.  And removing these lines causes problems for scripts like this:&lt;/p&gt;

&lt;p&gt;A = load &apos;myfile&apos; as a:tuple (...);&lt;br/&gt;
B = foreach A generate udf(a);&lt;/p&gt;

&lt;p&gt;Now &apos;a&apos; will be double wrapped (that is, there will be a tuple containing just the tuple &apos;a&apos;).  This isn&apos;t what we want.&lt;/p&gt;

&lt;p&gt;The changes to POForEach look good.&lt;/p&gt;</comment>
                            <comment id="12625967" author="shravanmn" created="Wed, 27 Aug 2008 04:04:12 +0000"  >&lt;p&gt;Alan, two things. &lt;br/&gt;
1) The current code isn&apos;t enough because of the following:&lt;br/&gt;
A = load &apos;file:/etc/passwd&apos; using PigStorage(&apos;:&apos;);&lt;br/&gt;
B = foreach A generate ARITY(&lt;b&gt;,&lt;/b&gt;);&lt;br/&gt;
dump B;&lt;/p&gt;

&lt;p&gt;Trunk emits 14(2 times the artiy of each tuple in A which is 7). The current code would emit two. Another example of what current code doesn&apos;t handle is&lt;/p&gt;

&lt;p&gt;A = load &apos;file:/etc/passwd&apos; using PigStorage(&apos;:&apos;);&lt;br/&gt;
B = foreach A generate ARITY($0, &apos;---&apos;, *);&lt;br/&gt;
Trunk emits 9(2 + 7). Current code would emit 3.&lt;/p&gt;

&lt;p&gt;2) You are right in saying that &apos;a&apos; will be double wrapped. But thats how trunk works right now and I think its right because consider this script:&lt;/p&gt;

&lt;p&gt;A = load &apos;myfile&apos; as (a:tuple(...), b:tuple(...));&lt;br/&gt;
B = foreach A generate udf(a,b);&lt;/p&gt;

&lt;p&gt;We want &apos;a&apos;, &apos;b&apos; to be intact inside the tuple input that is being passed to the UDF. So we would expect the arity to be two instead of 2 times the arity of &apos;a&apos; &amp;amp; &apos;b&apos;. Generalizing this, I think double wrapping should be ok. The way I tested this behaviour in trunk is by writing a UDF that returns a Tuple say TupleOutputUDF, which just copies the input tuple to the output. I tried the following script in trunk:&lt;br/&gt;
A = load &apos;file:/etc/passwd&apos; using PigStorage(&apos;:&apos;);&lt;br/&gt;
B = foreach A generate ARITY(TupleOutputUDF&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;);&lt;br/&gt;
dump B;&lt;/p&gt;

&lt;p&gt;with a return value of 1. The current code returns 7.&lt;/p&gt;</comment>
                            <comment id="12626335" author="alangates" created="Wed, 27 Aug 2008 21:43:07 +0000"  >&lt;p&gt;I still don&apos;t like the double wrapping.  But Shravan is correct that this matches the previous behavior, and there&apos;s no good reason to change it so we shouldn&apos;t.  The patch has been checked in.&lt;/p&gt;</comment>
                            <comment id="12626647" author="sms" created="Thu, 28 Aug 2008 16:58:55 +0000"  >&lt;p&gt;In POUserFunc.java, the following code makes an assumption that project( * ) always returns a tuple. In the foreach nested block, we could be projecting bags, at which point the code will fail with ClassCastException. E.g: testNestedPlan in TestEvalPipeline.java&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                
+                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(op &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; POProject){
+                    POProject projOp = (POProject)op;
+                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(projOp.isStar()){
+                        Tuple trslt = (Tuple) temp.result;
+                        Tuple rslt = (Tuple) res.result;
+                        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0;i&amp;lt;trslt.size();i++)
+                            rslt.append(trslt.get(i));
+                        &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
+                    }
+                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12626759" author="alangates" created="Thu, 28 Aug 2008 21:40:19 +0000"  >&lt;p&gt;This patch addresses the issues Santhosh identified with the patch 359-1.&lt;/p&gt;</comment>
                            <comment id="12626779" author="sms" created="Thu, 28 Aug 2008 22:52:49 +0000"  >&lt;p&gt;+1 for Pig-359-2.patch. Looks good.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12388839" name="359-1.patch" size="3972" author="shravanmn" created="Mon, 25 Aug 2008 10:47:15 +0000"/>
                            <attachment id="12388741" name="359.patch" size="646" author="shravanmn" created="Fri, 22 Aug 2008 14:20:47 +0000"/>
                            <attachment id="12389126" name="PIG-359-2.patch" size="2913" author="gates" created="Thu, 28 Aug 2008 21:40:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163994</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gj9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>94552</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>