diff --git a/src/org/apache/pig/impl/logicalLayer/LOCogroup.java b/src/org/apache/pig/impl/logicalLayer/LOCogroup.java
index d17204379..0839d61c6 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOCogroup.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOCogroup.java
@@ -273,4 +273,23 @@ public class LOCogroup extends LogicalOperator {
         v.visit(this);
     }
 
+    /***
+     *
+     * This does switch the mapping
+     *
+     * oldOp -> List of inner plans
+     *         to
+     * newOp -> List of inner plans
+     *
+     * which is useful when there is a structural change in LogicalPlan
+     *
+     * @param oldOp the old operator
+     * @param newOp the new operator
+     */
+    public void switchGroupByPlanOp(LogicalOperator oldOp,
+                                    LogicalOperator newOp) {
+        Collection<LogicalPlan> innerPlans = mGroupByPlans.removeKey(oldOp) ;
+        mGroupByPlans.put(newOp, innerPlans);
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/optimizer/LogicalTransformer.java b/src/org/apache/pig/impl/logicalLayer/optimizer/LogicalTransformer.java
index a27f838ed..cd6d558a8 100644
--- a/src/org/apache/pig/impl/logicalLayer/optimizer/LogicalTransformer.java
+++ b/src/org/apache/pig/impl/logicalLayer/optimizer/LogicalTransformer.java
@@ -130,7 +130,7 @@ public abstract class LogicalTransformer extends Transformer<LogicalOperator, Lo
      * successors and reconnecting them to the new node as well as rebuilding
      * all of the schemas.
      * @param after Node to insert the new node after
-     * @param newnode New node to insert
+     * @param newNode New node to insert
      * @param before Node to insert this node before
      * @param projectionMapping A map that defines how projections in after
      * relate to projections in newnode.  Keys are the projection offsets in
@@ -148,6 +148,12 @@ public abstract class LogicalTransformer extends Transformer<LogicalOperator, Lo
         mPlan.add(newNode);
         mPlan.insertBetween(after, newNode, before);
 
+        // Fix up COGroup internal wiring
+        if (before instanceof LOCogroup) {
+            LOCogroup cg = (LOCogroup) before ;
+            cg.switchGroupByPlanOp(after, newNode);
+        }
+
         // Visit all the inner plans of before and change their projects to
         // connect to newNode instead of after.
         // Find right inner plan(s) to visit
@@ -181,7 +187,7 @@ public abstract class LogicalTransformer extends Transformer<LogicalOperator, Lo
      * all of the schemas.  This function
      * assumes that the node has only one predecessor.
      * @param after Node to insert the new node after
-     * @param newnode New node to insert
+     * @param newNode New node to insert
      * @param projectionMapping A map that defines how projections in after
      * relate to projections in newnode.  Keys are the projection offsets in
      * after, values are the new offsets in newnode.  If this field is null,
diff --git a/src/org/apache/pig/impl/logicalLayer/optimizer/SchemaCalculator.java b/src/org/apache/pig/impl/logicalLayer/optimizer/SchemaCalculator.java
index 8c3941a4b..fea16361b 100644
--- a/src/org/apache/pig/impl/logicalLayer/optimizer/SchemaCalculator.java
+++ b/src/org/apache/pig/impl/logicalLayer/optimizer/SchemaCalculator.java
@@ -186,7 +186,7 @@ public class SchemaCalculator extends LOVisitor {
      * 
      * @param regexp
      *            the logical regexp operator that has to be visited
-     * @throws ParseException
+     * @throws VisitorException
      */
     protected void visit(LORegexp regexp) throws VisitorException {
         try {
@@ -207,12 +207,7 @@ public class SchemaCalculator extends LOVisitor {
     }
     
     protected void visit(LOStore store) throws VisitorException{
-        try {
-            store.getSchema();
-            super.visit(store);
-        } catch (FrontendException fe) {
-            throw new VisitorException(fe);
-        }
+        // We don't calculate schema of LOStore
     }
     
     protected void visit(LOConst c) throws VisitorException{
diff --git a/src/org/apache/pig/impl/plan/MultiMap.java b/src/org/apache/pig/impl/plan/MultiMap.java
index 9bf97bfa8..5b43820dd 100644
--- a/src/org/apache/pig/impl/plan/MultiMap.java
+++ b/src/org/apache/pig/impl/plan/MultiMap.java
@@ -113,6 +113,15 @@ public class MultiMap<K, V> implements Serializable {
         return keeper;
     }
 
+    /**
+     * Remove all the values associated with the given key
+     * @param key the key to be removed
+     * @return list of all value being removed
+     */
+    public Collection<V> removeKey(K key) {
+        return mMap.remove(key) ;
+    }
+
     /**
      * Get a set of all the keys in this map.
      * @return Set of keys.
