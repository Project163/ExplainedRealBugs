diff --git a/CHANGES.txt b/CHANGES.txt
index 020ecfc03..d6beb265f 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -287,6 +287,12 @@ Trunk (unreleased changes)
 
     PIG-494: invalid handling of UTF-8 data in PigStorage (pradeepk via olgan)
 
+    PIG-501: Make branches/types work under cygwin (daijy via olgan)
+
+    PIG-504: cleanup illustrate not to produce cn= (shubham via olgan)
+
+    PIG-469: make sure that describe says "int" not "integer" (sms via olgan)
+
     PIG-495: projecting of bags only give 1 field (olgan)
 
     PIG-500: Load Func for POCast is not being set in some cases (sms via
diff --git a/src/org/apache/pig/builtin/PigStorage.java b/src/org/apache/pig/builtin/PigStorage.java
index 5ba88a06a..f9fd95c4c 100644
--- a/src/org/apache/pig/builtin/PigStorage.java
+++ b/src/org/apache/pig/builtin/PigStorage.java
@@ -22,6 +22,7 @@ import java.io.IOException;
 import java.io.OutputStream;
 import java.net.URL;
 import java.util.ArrayList;
+import java.util.Arrays;
 import java.util.Map;
 
 import org.apache.commons.logging.LogFactory;
@@ -55,8 +56,14 @@ public class PigStorage extends Utf8StorageConverter
     private byte fieldDel = '\t';
     private ByteArrayOutputStream mBuf = null;
     private ArrayList<Object> mProtoTuple = null;
+    private int os;
+    private static final int OS_UNIX = 0;
+    private static final int OS_WINDOWS = 1;
     
     public PigStorage() {
+        os = OS_UNIX;
+        if (System.getProperty("os.name").toUpperCase().startsWith("WINDOWS"))
+            os = OS_WINDOWS;
     }
 
     /**
@@ -67,6 +74,7 @@ public class PigStorage extends Utf8StorageConverter
      *            ("\t" is the default.)
      */
     public PigStorage(String delimiter) {
+        this();
         if (delimiter.length() == 1) {
             this.fieldDel = (byte)delimiter.charAt(0);
         } else if (delimiter.length() > 1 && delimiter.charAt(0) == '\\') {
@@ -214,7 +222,13 @@ public class PigStorage extends Utf8StorageConverter
             // TODO, once this can take schemas, we need to figure out
             // if the user requested this to be viewed as a certain
             // type, and if so, then construct it appropriately.
-            mProtoTuple.add(new DataByteArray(mBuf.toByteArray()));
+            byte[] array = mBuf.toByteArray();
+            if (array[array.length-1]=='\r' && os==OS_WINDOWS)
+                array = Arrays.copyOf(array, array.length-1);
+            if (array.length==0)
+                mProtoTuple.add(null);
+            else
+                mProtoTuple.add(new DataByteArray(array));
         }
         mBuf.reset();
     }
diff --git a/src/org/apache/pig/builtin/TextLoader.java b/src/org/apache/pig/builtin/TextLoader.java
index e40adb8c5..57148974e 100644
--- a/src/org/apache/pig/builtin/TextLoader.java
+++ b/src/org/apache/pig/builtin/TextLoader.java
@@ -59,6 +59,8 @@ public class TextLoader implements LoadFunc{
             return null;
         String line;
         if ((line = in.readLine(utf8, (byte)'\n')) != null) {
+            if (line.length()>0 && line.charAt(line.length()-1)=='\r' && System.getProperty("os.name").toUpperCase().startsWith("WINDOWS"))
+                line = line.substring(0, line.length()-1);
             return mTupleFactory.newTuple(new DataByteArray(line.getBytes()));
         }
         return null;
diff --git a/src/org/apache/pig/data/DataType.java b/src/org/apache/pig/data/DataType.java
index 9fc369a0c..33d31fc6d 100644
--- a/src/org/apache/pig/data/DataType.java
+++ b/src/org/apache/pig/data/DataType.java
@@ -192,7 +192,7 @@ public class DataType {
         case NULL:      return "NULL";
         case BOOLEAN:   return "boolean";
         case BYTE:      return "byte";
-        case INTEGER:   return "integer";
+        case INTEGER:   return "int";
         case LONG:      return "long";
         case FLOAT:     return "float";
         case DOUBLE:    return "double";
diff --git a/src/org/apache/pig/impl/io/FileLocalizer.java b/src/org/apache/pig/impl/io/FileLocalizer.java
index 1848e8693..926b01aa5 100644
--- a/src/org/apache/pig/impl/io/FileLocalizer.java
+++ b/src/org/apache/pig/impl/io/FileLocalizer.java
@@ -17,13 +17,13 @@
  */
 package org.apache.pig.impl.io;
 
-import java.io.BufferedInputStream;
+import java.io.BufferedReader;
 import java.io.File;
-import java.io.FileInputStream;
 import java.io.FileNotFoundException;
 import java.io.FileOutputStream;
 import java.io.IOException;
 import java.io.InputStream;
+import java.io.InputStreamReader;
 import java.io.OutputStream;
 import java.util.ArrayList;
 import java.util.Iterator;
@@ -51,6 +51,8 @@ public class FileLocalizer {
     private static final Log log = LogFactory.getLog(FileLocalizer.class);
     
     static public final String LOCAL_PREFIX  = "file:";
+    static public final int STYLE_UNIX = 0;
+    static public final int STYLE_WINDOWS = 1;
 
     public static class DataStorageInputStreamIterator extends InputStream {
         InputStream current;
@@ -535,4 +537,42 @@ public class FileLocalizer {
             }
     	}
     }
+    /**
+     * Convert path from Windows convention to Unix convention. Invoked under
+     * cygwin.
+     * 
+     * @param path
+     *            path in Windows convention
+     * @return path in Unix convention, null if fail
+     */
+    static public String parseCygPath(String path, int style) {
+        String[] command; 
+        if (style==STYLE_WINDOWS)
+            command = new String[] { "cygpath", "-w", path };
+        else
+            command = new String[] { "cygpath", "-u", path };
+        Process p = null;
+        try {
+            p = Runtime.getRuntime().exec(command);
+        } catch (IOException e) {
+            return null;
+        }
+        int exitVal = 0;
+        try {
+            exitVal = p.waitFor();
+        } catch (InterruptedException e) {
+            return null;
+        }
+        if (exitVal != 0)
+            return null;
+        String line = null;
+        try {
+            InputStreamReader isr = new InputStreamReader(p.getInputStream());
+            BufferedReader br = new BufferedReader(isr);
+            line = br.readLine();
+        } catch (IOException e) {
+            return null;
+        }
+        return line;
+    }
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/schema/Schema.java b/src/org/apache/pig/impl/logicalLayer/schema/Schema.java
index 8c1844e6c..09be8d8b4 100644
--- a/src/org/apache/pig/impl/logicalLayer/schema/Schema.java
+++ b/src/org/apache/pig/impl/logicalLayer/schema/Schema.java
@@ -386,10 +386,10 @@ public class Schema implements Serializable, Cloneable {
                 sb.append(")");
             }
 
-            if (canonicalName != null) {
-                sb.append(" cn: ");
-                sb.append(canonicalName);
-            }
+//            if (canonicalName != null) {
+//                sb.append(" cn: ");
+//                sb.append(canonicalName);
+//            }
 
             return sb.toString();
         }
diff --git a/src/org/apache/pig/impl/streaming/ExecutableManager.java b/src/org/apache/pig/impl/streaming/ExecutableManager.java
index d26b7f2ef..9d3bc5b94 100644
--- a/src/org/apache/pig/impl/streaming/ExecutableManager.java
+++ b/src/org/apache/pig/impl/streaming/ExecutableManager.java
@@ -40,6 +40,7 @@ import org.apache.pig.backend.hadoop.executionengine.physicalLayer.Result;
 import org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POStream;
 import org.apache.pig.data.Tuple;
 import org.apache.pig.impl.io.BufferedPositionedInputStream;
+import org.apache.pig.impl.io.FileLocalizer;
 import org.apache.pig.impl.streaming.InputHandler.InputType;
 import org.apache.pig.impl.streaming.OutputHandler.OutputType;
 
@@ -198,41 +199,6 @@ public class ExecutableManager {
         process.destroy();
     }
 
-    /**
-     * Convert path from Windows convention to Unix convention. Invoked under
-     * cygwin.
-     * 
-     * @param path
-     *            path in Windows convention
-     * @return path in Unix convention, null if fail
-     */
-    private String parseCygPath(String path) {
-        String[] command = new String[] { "cygpath", "-u", path };
-        Process p = null;
-        try {
-            p = Runtime.getRuntime().exec(command);
-        } catch (IOException e) {
-            return null;
-        }
-        int exitVal = 0;
-        try {
-            exitVal = p.waitFor();
-        } catch (InterruptedException e) {
-            return null;
-        }
-        if (exitVal != 0)
-            return null;
-        String line = null;
-        try {
-            InputStreamReader isr = new InputStreamReader(p.getInputStream());
-            BufferedReader br = new BufferedReader(isr);
-            line = br.readLine();
-        } catch (IOException e) {
-            return null;
-        }
-        return line;
-    }
-
     /**
      * Set up the run-time environment of the managed process.
      * 
@@ -249,7 +215,7 @@ public class ExecutableManager {
                 .getProperty("user.dir");
 
         if (System.getProperty("os.name").toUpperCase().startsWith("WINDOWS")) {
-            String unixCwd = parseCygPath(cwd);
+            String unixCwd = FileLocalizer.parseCygPath(cwd, FileLocalizer.STYLE_UNIX);
             if (unixCwd == null)
                 throw new RuntimeException(
                         "Can not convert Windows path to Unix path under cygwin");
diff --git a/test/org/apache/pig/test/TestAlgebraicEval.java b/test/org/apache/pig/test/TestAlgebraicEval.java
index 3145d3467..2b841ee06 100644
--- a/test/org/apache/pig/test/TestAlgebraicEval.java
+++ b/test/org/apache/pig/test/TestAlgebraicEval.java
@@ -95,7 +95,7 @@ public class TestAlgebraicEval extends TestCase {
                 }
                 ps.close();                
             }
-            pig.registerQuery(" a = group (load 'file:" + tmpFile + "') by ($0,$1);");
+            pig.registerQuery(" a = group (load '" + Util.generateURI(tmpFile.toString()) + "') by ($0,$1);");
             pig.registerQuery("b = foreach a generate flatten(group), SUM($1.$2);");
             Iterator<Tuple> it = pig.openIterator("b");
             int count = 0;
@@ -134,7 +134,7 @@ public class TestAlgebraicEval extends TestCase {
         
             PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
             int numNulls = generateInput(ps, nullFlags[i]);
-            String query = "myid =  foreach (group (load 'file:" + tmpFile + "') all) generate COUNT($1);";
+            String query = "myid =  foreach (group (load '" + Util.generateURI(tmpFile.toString()) + "') all) generate COUNT($1);";
             System.out.println(query);
             pig.registerQuery(query);
             Iterator it = pig.openIterator("myid");
@@ -153,7 +153,7 @@ public class TestAlgebraicEval extends TestCase {
         
             PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
             int numNulls = generateInput(ps, nullFlags[i]);
-            String query = "myid = foreach (group (load 'file:" + tmpFile + "') all) generate group, COUNT($1) ;";
+            String query = "myid = foreach (group (load '" + Util.generateURI(tmpFile.toString()) + "') all) generate group, COUNT($1) ;";
             System.out.println(query);
             pig.registerQuery(query);
             Iterator it = pig.openIterator("myid");
@@ -171,7 +171,7 @@ public class TestAlgebraicEval extends TestCase {
             System.err.println("Testing testGroupCount with null flag:" + nullFlags[i]);
             PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
             int numNulls = generateInput(ps, nullFlags[i]);
-            String query = "myid = foreach (group (load 'file:" + tmpFile + "') all) generate COUNT($1), group ;";
+            String query = "myid = foreach (group (load '" + Util.generateURI(tmpFile.toString()) + "') all) generate COUNT($1), group ;";
             System.out.println(query);
             pig.registerQuery(query);
             Iterator it = pig.openIterator("myid");
@@ -210,7 +210,7 @@ public class TestAlgebraicEval extends TestCase {
                 }
             }         
             ps.close();
-            String query = "myid = foreach (group (load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':')) by $0) generate group, COUNT($1.$1) ;";
+            String query = "myid = foreach (group (load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':')) by $0) generate group, COUNT($1.$1) ;";
             System.out.println(query);
             pig.registerQuery(query);
             Iterator it = pig.openIterator("myid");
@@ -257,7 +257,7 @@ public class TestAlgebraicEval extends TestCase {
                 }
             }
             ps.close();
-            String query = "myid = foreach (group (load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':')) by $0) generate group, COUNT($1.$1), COUNT($1.$0) ;";
+            String query = "myid = foreach (group (load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':')) by $0) generate group, COUNT($1.$1), COUNT($1.$0) ;";
             System.out.println(query);
             pig.registerQuery(query);
             Iterator it = pig.openIterator("myid");
diff --git a/test/org/apache/pig/test/TestBZip.java b/test/org/apache/pig/test/TestBZip.java
index 03c4db5b9..77d88115c 100644
--- a/test/org/apache/pig/test/TestBZip.java
+++ b/test/org/apache/pig/test/TestBZip.java
@@ -43,16 +43,16 @@ public class TestBZip extends TestCase {
             cos.write((-i + "\n").getBytes());
         }
         cos.close();
-        pig.registerQuery("AA=load 'file:" + in.getAbsolutePath() + "';");
+        pig.registerQuery("AA=load '" + Util.generateURI(in.getAbsolutePath()) + "';");
         pig.registerQuery("A=foreach (group (filter AA by $0 > 0) all) generate flatten($1);");
-        pig.store("A", "file:" + out.getAbsolutePath());
+        pig.store("A", Util.generateURI(out.getAbsolutePath()));
         CBZip2InputStream cis = new CBZip2InputStream(
                 new LocalSeekableInputStream(new File(out, "part-00000.bz")));
         // Just a sanity check, to make sure it was a bzip file; we
         // will do the value verification later
         assertEquals(100, cis.read(new byte[100]));
         cis.close();
-        pig.registerQuery("B=load 'file:" + out.getAbsolutePath() + "';");
+        pig.registerQuery("B=load '" + Util.generateURI(out.getAbsolutePath()) + "';");
         Iterator<Tuple> i = pig.openIterator("B");
         HashMap<Integer, Integer> map = new HashMap<Integer, Integer>();
         while (i.hasNext()) {
@@ -87,15 +87,15 @@ public class TestBZip extends TestCase {
         fos.write("55\n".getBytes());
         fos.close();
         System.out.println(in.getAbsolutePath());
-        pig.registerQuery("AA=load 'file:" + in.getAbsolutePath() + "';");
+        pig.registerQuery("AA=load '" + Util.generateURI(in.getAbsolutePath()) + "';");
         pig
                 .registerQuery("A=foreach (group (filter AA by $0 < '0') all) generate flatten($1);");
-        pig.store("A", "file:" + out.getAbsolutePath());
+        pig.store("A", Util.generateURI(out.getAbsolutePath()));
         CBZip2InputStream cis = new CBZip2InputStream(
                 new LocalSeekableInputStream(new File(out, "part-00000.bz")));
         assertEquals(-1, cis.read(new byte[100]));
         cis.close();
-        pig.registerQuery("B=load 'file:" + out.getAbsolutePath() + "';");
+        pig.registerQuery("B=load '" + Util.generateURI(out.getAbsolutePath()) + "';");
         pig.openIterator("B");
         in.delete();
         out.delete();
diff --git a/test/org/apache/pig/test/TestBestFitCast.java b/test/org/apache/pig/test/TestBestFitCast.java
index 8d3637c10..53bb99a6a 100644
--- a/test/org/apache/pig/test/TestBestFitCast.java
+++ b/test/org/apache/pig/test/TestBestFitCast.java
@@ -91,7 +91,7 @@ public class TestBestFitCast extends TestCase {
         //Passing (long, int)
         //Possible matches: (float, float) , (long, double)
         //Chooses (long, double) as it has only one cast compared to two for (float, float)
-        pigServer.registerQuery("A = LOAD 'file:" + tmpFile + "' as (x:long, y:int);");
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "' as (x:long, y:int);");
         pigServer.registerQuery("B = FOREACH A generate x, " + UDF1.class.getName() + "(x,y);");
         Iterator<Tuple> iter = pigServer.openIterator("B");
         if(!iter.hasNext()) fail("No Output received");
@@ -110,7 +110,7 @@ public class TestBestFitCast extends TestCase {
         //Passing (int, int)
         //Possible matches: (float, float) , (long, double)
         //Throws Exception as ambiguous definitions found
-        pigServer.registerQuery("A = LOAD 'file:" + tmpFile + "' as (x:long, y:int);");
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "' as (x:long, y:int);");
         pigServer.registerQuery("B = FOREACH A generate x, " + UDF1.class.getName() + "(y,y);");
         try{
             pigServer.openIterator("B");
@@ -126,7 +126,7 @@ public class TestBestFitCast extends TestCase {
         //Passing (int, int)
         //Possible matches: (float, float) , (long, double)
         //Chooses (float, float) as both options lead to same score and (float, float) occurs first.
-        pigServer.registerQuery("A = LOAD 'file:" + tmpFile + "' as (x:long, y:int);");
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "' as (x:long, y:int);");
         pigServer.registerQuery("B = FOREACH A generate x, " + UDF1.class.getName() + "((float)y,(float)y);");
         Iterator<Tuple> iter = pigServer.openIterator("B");
         if(!iter.hasNext()) fail("No Output received");
@@ -145,7 +145,7 @@ public class TestBestFitCast extends TestCase {
         //Passing (long)
         //Possible matches: (float), (integer), (double)
         //Chooses (float) as it leads to a better score that to (double)
-        pigServer.registerQuery("A = LOAD 'file:" + tmpFile + "' as (x:long, y:int);");
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "' as (x:long, y:int);");
         pigServer.registerQuery("B = FOREACH A generate x, " + UDF1.class.getName() + "(x);");
         Iterator<Tuple> iter = pigServer.openIterator("B");
         if(!iter.hasNext()) fail("No Output received");
@@ -163,7 +163,7 @@ public class TestBestFitCast extends TestCase {
         //Passing bytearrays
         //Possible matches: (float, float) , (long, double)
         //Throws exception since more than one funcSpec and inp is bytearray
-        pigServer.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pigServer.registerQuery("B = FOREACH A generate $0, " + UDF1.class.getName() + "($1,$1);");
         try{
             pigServer.openIterator("B");
diff --git a/test/org/apache/pig/test/TestCombiner.java b/test/org/apache/pig/test/TestCombiner.java
index 143162411..5fc3e97b0 100644
--- a/test/org/apache/pig/test/TestCombiner.java
+++ b/test/org/apache/pig/test/TestCombiner.java
@@ -78,8 +78,8 @@ public class TestCombiner extends TestCase {
             ps.println(line);
         }
         ps.close();
-        pig.registerQuery(loadAlias + " = load 'file:"
-                + inputFile + "' using "
+        pig.registerQuery(loadAlias + " = load '"
+                + Util.generateURI(inputFile.toString()) + "' using "
                 + PigStorage.class.getName() + "(',');");
     }
 
diff --git a/test/org/apache/pig/test/TestCompressedFiles.java b/test/org/apache/pig/test/TestCompressedFiles.java
index 36d62b0e1..6463671b7 100644
--- a/test/org/apache/pig/test/TestCompressedFiles.java
+++ b/test/org/apache/pig/test/TestCompressedFiles.java
@@ -74,7 +74,7 @@ public class TestCompressedFiles extends TestCase {
     @Test
     public void testCompressed1() throws Throwable {
         PigServer pig = new PigServer(ExecType.MAPREDUCE, cluster.getProperties());
-        pig.registerQuery("A = foreach (cogroup (load 'file:"+gzFile+"') by $1, (load 'file:"+datFile + "') by $1) generate flatten( " + DIFF.class.getName() + "($1.$1,$2.$1)) ;");
+        pig.registerQuery("A = foreach (cogroup (load '"+Util.generateURI(gzFile.toString())+"') by $1, (load '"+Util.generateURI(datFile.toString()) + "') by $1) generate flatten( " + DIFF.class.getName() + "($1.$1,$2.$1)) ;");
         Iterator it = pig.openIterator("A");
         boolean success = true;
         while(it.hasNext()) {
diff --git a/test/org/apache/pig/test/TestEvalPipeline.java b/test/org/apache/pig/test/TestEvalPipeline.java
index c58256d61..fff0474fc 100644
--- a/test/org/apache/pig/test/TestEvalPipeline.java
+++ b/test/org/apache/pig/test/TestEvalPipeline.java
@@ -96,7 +96,7 @@ public class TestEvalPipeline extends TestCase {
         
         File f1 = createFile(new String[]{"a:1","b:1","a:1"});
 
-        pigServer.registerQuery("a = load 'file:" + f1 + "' using " + PigStorage.class.getName() + "(':');");
+        pigServer.registerQuery("a = load '" + Util.generateURI(f1.toString()) + "' using " + PigStorage.class.getName() + "(':');");
         pigServer.registerQuery("b = foreach a generate 1-1/1;");
         Iterator<Tuple> iter  = pigServer.openIterator("b");
         
@@ -112,8 +112,8 @@ public class TestEvalPipeline extends TestCase {
         File f1 = createFile(new String[]{"a:1","b:1","a:1"});
         File f2 = createFile(new String[]{"b","b","a"});
         
-        pigServer.registerQuery("a = load 'file:" + f1 + "' using " + PigStorage.class.getName() + "(':');");
-        pigServer.registerQuery("b = load 'file:" + f2 + "';");
+        pigServer.registerQuery("a = load '" + Util.generateURI(f1.toString()) + "' using " + PigStorage.class.getName() + "(':');");
+        pigServer.registerQuery("b = load '" + Util.generateURI(f2.toString()) + "';");
         pigServer.registerQuery("c = cogroup a by $0, b by $0;");        
         pigServer.registerQuery("d = foreach c generate flatten($1),flatten($2);");
         
@@ -134,7 +134,7 @@ public class TestEvalPipeline extends TestCase {
         pw.println("a");
         pw.println("a");
         pw.close();
-        pigServer.registerQuery("a = foreach (load 'file:" + f + "') generate 1, flatten(" + MyBagFunction.class.getName() + "(*));");
+        pigServer.registerQuery("a = foreach (load '" + Util.generateURI(f.toString()) + "') generate 1, flatten(" + MyBagFunction.class.getName() + "(*));");
 //        pigServer.registerQuery("b = foreach a generate $0, flatten($1);");
         Iterator<Tuple> iter = pigServer.openIterator("a");
         int count = 0;
@@ -170,7 +170,7 @@ public class TestEvalPipeline extends TestCase {
         f.store(b, new BinStorage(), pigServer.getPigContext());
         
         
-        pigServer.registerQuery("a = load '" + fileName + "' using BinStorage();");
+        pigServer.registerQuery("a = load '" + Util.encodeEscape(fileName) + "' using BinStorage();");
         pigServer.registerQuery("b = foreach a generate $0#'apple',flatten($1#'orange');");
         Iterator<Tuple> iter = pigServer.openIterator("b");
         t = iter.next();
@@ -291,8 +291,8 @@ public class TestEvalPipeline extends TestCase {
         expectedResults.put("world", 1);
         expectedResults.put("conference", 1);
         
-        pigServer.registerQuery("newsArticles = LOAD 'file:" + newsFile + "' USING " + TextLoader.class.getName() + "();");
-        pigServer.registerQuery("queryLog = LOAD 'file:" + queryLogFile + "';");
+        pigServer.registerQuery("newsArticles = LOAD '" + Util.generateURI(newsFile.toString()) + "' USING " + TextLoader.class.getName() + "();");
+        pigServer.registerQuery("queryLog = LOAD '" + Util.generateURI(queryLogFile.toString()) + "';");
 
         pigServer.registerQuery("titleNGrams = FOREACH newsArticles GENERATE flatten(" + TitleNGrams.class.getName() + "(*));");
         pigServer.registerQuery("cogrouped = COGROUP titleNGrams BY $0 INNER, queryLog BY $0 INNER;");
@@ -345,7 +345,7 @@ public class TestEvalPipeline extends TestCase {
         ps.close(); 
         
         String tmpOutputFile = FileLocalizer.getTemporaryPath(null, pigServer.getPigContext()).toString();
-        pigServer.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         if (eliminateDuplicates){
             pigServer.registerQuery("B = DISTINCT (FOREACH A GENERATE $0) PARALLEL 10;");
         }else{
@@ -393,7 +393,7 @@ public class TestEvalPipeline extends TestCase {
 
         String tmpOutputFile = FileLocalizer.getTemporaryPath(null, 
         pigServer.getPigContext()).toString();
-        pigServer.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pigServer.registerQuery("B = group A by $0;");
         String query = "C = foreach B {"
         + "C1 = filter A by $0 > -1;"
@@ -434,7 +434,7 @@ public class TestEvalPipeline extends TestCase {
 
         String tmpOutputFile = FileLocalizer.getTemporaryPath(null, 
         pigServer.getPigContext()).toString();
-        pigServer.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pigServer.registerQuery("B = group A by $0;");
         String query = "C = foreach B {"
         + "C1 = filter A by $0 > -1;"
@@ -477,7 +477,7 @@ public class TestEvalPipeline extends TestCase {
 
         String tmpOutputFile = FileLocalizer.getTemporaryPath(null, 
         pigServer.getPigContext()).toString();
-        pigServer.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pigServer.registerQuery("B = limit A 5;");
         Iterator<Tuple> iter = pigServer.openIterator("B");
         if(!iter.hasNext()) fail("No output found");
@@ -495,7 +495,7 @@ public class TestEvalPipeline extends TestCase {
         File input = Util.createInputFile("tmp", "", 
                 new String[] {"{(f1, f2),(f3, f4)}\t(1,2)\t[key1#value1,key2#value2]"});
         
-        pigServer.registerQuery("a = load 'file:" + Util.encodeEscape(input.toString()) + "' using PigStorage() " +
+        pigServer.registerQuery("a = load '" + Util.generateURI(input.toString()) + "' using PigStorage() " +
                 "as (b:bag{t:tuple(x,y)}, t2:tuple(a,b), m:map[]);");
         pigServer.registerQuery("b = foreach a generate COUNT(b), t2.a, t2.b, m#'key1', m#'key2';");
         Iterator<Tuple> it = pigServer.openIterator("b");
@@ -507,7 +507,7 @@ public class TestEvalPipeline extends TestCase {
         assertEquals("value2", t.get(4).toString());
         
         //test with BinStorage
-        pigServer.registerQuery("a = load 'file:" + Util.encodeEscape(input.toString()) + "' using PigStorage() " +
+        pigServer.registerQuery("a = load '" + Util.generateURI(input.toString()) + "' using PigStorage() " +
                 "as (b:bag{t:tuple(x,y)}, t2:tuple(a,b), m:map[]);");
         String output = "/pig/out/TestEvalPipeline-testComplexData";
         pigServer.deleteFile(output);
diff --git a/test/org/apache/pig/test/TestFilterOpNumeric.java b/test/org/apache/pig/test/TestFilterOpNumeric.java
index cdb9a8321..4ecee0fc3 100644
--- a/test/org/apache/pig/test/TestFilterOpNumeric.java
+++ b/test/org/apache/pig/test/TestFilterOpNumeric.java
@@ -62,7 +62,7 @@ public class TestFilterOpNumeric extends TestCase {
             }
         }
         ps.close();
-        pig.registerQuery("A=load 'file:" + tmpFile + "' using "+PigStorage.class.getName() +"(':');");
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "' using "+PigStorage.class.getName() +"(':');");
         String query = "A = filter A by $0 == $1;";
         log.info(query);
         pig.registerQuery(query);
@@ -92,7 +92,7 @@ public class TestFilterOpNumeric extends TestCase {
             }
         }
         ps.close();
-        pig.registerQuery("A=load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':');");
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':');");
         String query = "A = filter A by $0 != $1;";
         log.info(query);
         pig.registerQuery(query);
@@ -118,7 +118,7 @@ public class TestFilterOpNumeric extends TestCase {
             }
         }
         ps.close();
-        pig.registerQuery("A=load 'file:" + tmpFile + "' using " +
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "' using " +
                 PigStorage.class.getName() +
                 "(':') as (f1: double, f2:double);");
         String query = "A = filter A by $0 > $1;";
@@ -143,7 +143,7 @@ public class TestFilterOpNumeric extends TestCase {
             ps.println(i + "\t" + i + "\t1");            
         }
         ps.close();
-        pig.registerQuery("A=load 'file:" + tmpFile + "';");
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "';");
         String query = "A = foreach A generate ($1 >= "+ LOOP_COUNT+"-10?'1':'0');";
         log.info(query);
         pig.registerQuery(query);
@@ -171,7 +171,7 @@ public class TestFilterOpNumeric extends TestCase {
             ps.println(i + "\t" + i + "\t1");            
         }
         ps.close();
-        pig.registerQuery("A=load 'file:" + tmpFile + "';");
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "';");
         String query = "A = foreach A generate ($0 < 10?($1 >= 5 ? 2: 1) : 0);";
         log.info(query);
         pig.registerQuery(query);
@@ -200,7 +200,7 @@ public class TestFilterOpNumeric extends TestCase {
             }
         }
         ps.close();
-        pig.registerQuery("A=load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':') as (a: double, b:double);");
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':') as (a: double, b:double);");
         String query = "A = filter A by $0 < $1;";
 
         log.info(query);
@@ -231,7 +231,7 @@ public class TestFilterOpNumeric extends TestCase {
             }
         }
         ps.close();
-        pig.registerQuery("A=load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':');");
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':');");
         String query = "A = filter A by $0 >= $1;";
 
         log.info(query);
@@ -260,7 +260,7 @@ public class TestFilterOpNumeric extends TestCase {
             }
         }
         ps.close();
-        pig.registerQuery("A=load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':') as (a: double, b:double);");
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':') as (a: double, b:double);");
         String query = "A = filter A by $0 <= $1;";
 
         log.info(query);
diff --git a/test/org/apache/pig/test/TestFilterOpString.java b/test/org/apache/pig/test/TestFilterOpString.java
index 80891ca00..1b7399622 100644
--- a/test/org/apache/pig/test/TestFilterOpString.java
+++ b/test/org/apache/pig/test/TestFilterOpString.java
@@ -68,7 +68,7 @@ public class TestFilterOpString extends TestCase {
             }
         }
         ps.close();
-        pig.registerQuery("A=load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':');");
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':');");
         String query = "A = filter A by $0 eq $1;";
 
         log.info(query);
@@ -105,7 +105,7 @@ public class TestFilterOpString extends TestCase {
             }
         }
         ps.close();
-        pig.registerQuery("A=load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':');");
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':');");
         String query = "A = filter A by $0 neq $1;";
 
         log.info(query);
@@ -142,7 +142,7 @@ public class TestFilterOpString extends TestCase {
             }
         }
         ps.close();
-        pig.registerQuery("A=load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':');");
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':');");
         String query = "A = filter A by $0 gt $1;";
 
         log.info(query);
@@ -184,7 +184,7 @@ public class TestFilterOpString extends TestCase {
         }
         ps.close();
         
-        pig.registerQuery("A=load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':');");
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':');");
         String query = "A = filter A by $0 gte $1;";
 
         log.info(query);
@@ -221,7 +221,7 @@ public class TestFilterOpString extends TestCase {
         }
         ps.close();
         
-        pig.registerQuery("A=load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':');");
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':');");
         String query = "A = filter A by $0 lt $1;";
 
         log.info(query);
@@ -262,7 +262,7 @@ public class TestFilterOpString extends TestCase {
         }
         ps.close();
         
-        pig.registerQuery("A=load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':');");
+        pig.registerQuery("A=load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':');");
         String query = "A = filter A by $0 lte $1;";
 
         log.info(query);
diff --git a/test/org/apache/pig/test/TestFilterUDF.java b/test/org/apache/pig/test/TestFilterUDF.java
index 73ce3ed24..0d45690d6 100644
--- a/test/org/apache/pig/test/TestFilterUDF.java
+++ b/test/org/apache/pig/test/TestFilterUDF.java
@@ -67,7 +67,7 @@ public class TestFilterUDF extends TestCase {
     @Test
     public void testFilterUDF() throws Exception{
         
-        pigServer.registerQuery("A = LOAD 'file:" + tmpFile + "' as (x:int);");
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "' as (x:int);");
         pigServer.registerQuery("B = filter A by " + MyFilterFunction.class.getName() + "();");
         Iterator<Tuple> iter = pigServer.openIterator("B");
         if(!iter.hasNext()) fail("No Output received");
diff --git a/test/org/apache/pig/test/TestForEachNestedPlan.java b/test/org/apache/pig/test/TestForEachNestedPlan.java
index 2d42a57d9..e1cb12ca6 100644
--- a/test/org/apache/pig/test/TestForEachNestedPlan.java
+++ b/test/org/apache/pig/test/TestForEachNestedPlan.java
@@ -49,7 +49,7 @@ public class TestForEachNestedPlan extends TestCase {
         for (int i = 0; i < nullFlags.length; i++) {
             System.err.println("Running testInnerOrderBy with nullFlags set to :" + nullFlags[i]);
             File tmpFile = genDataSetFile1(nullFlags[i]);
-            pig.registerQuery("a = load 'file:" + tmpFile + "'; ");
+            pig.registerQuery("a = load '" + Util.generateURI(tmpFile.toString()) + "'; ");
             pig.registerQuery("b = group a by $0; ");
             pig.registerQuery("c = foreach b { " + "     c1 = order $1 by *; "
                     + "    generate flatten(c1); " + "};");
diff --git a/test/org/apache/pig/test/TestImplicitSplit.java b/test/org/apache/pig/test/TestImplicitSplit.java
index f220d66b8..7110251fc 100644
--- a/test/org/apache/pig/test/TestImplicitSplit.java
+++ b/test/org/apache/pig/test/TestImplicitSplit.java
@@ -36,7 +36,7 @@ public class TestImplicitSplit extends TestCase{
             ps.println(i);
         }
         ps.close();
-        pigServer.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pigServer.registerQuery("B = filter A by $0<=10;");
         pigServer.registerQuery("C = filter A by $0>10;");
         pigServer.registerQuery("D = union B,C;");
diff --git a/test/org/apache/pig/test/TestInfixArithmetic.java b/test/org/apache/pig/test/TestInfixArithmetic.java
index bd6779930..b42a7473e 100644
--- a/test/org/apache/pig/test/TestInfixArithmetic.java
+++ b/test/org/apache/pig/test/TestInfixArithmetic.java
@@ -63,7 +63,7 @@ public class TestInfixArithmetic extends TestCase {
             System.err.println("Testing with nulls: " + nullFlags[i]);
             PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
             generateInput(ps, nullFlags[i]);
-            String query = "A = foreach (load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':')) generate $0, $0 + $1, $1;";
+            String query = "A = foreach (load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':')) generate $0, $0 + $1, $1;";
             log.info(query);
             pig.registerQuery(query);
             Iterator it = pig.openIterator("A");
@@ -92,7 +92,7 @@ public class TestInfixArithmetic extends TestCase {
             System.err.println("Testing with nulls: " + nullFlags[i]);
             PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
             generateInput(ps, nullFlags[i]);
-            String query = "A = foreach (load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':')) generate $0, $0 - $1, $1 ;";
+            String query = "A = foreach (load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':')) generate $0, $0 - $1, $1 ;";
             log.info(query);
             pig.registerQuery(query);
             Iterator it = pig.openIterator("A");
@@ -119,7 +119,7 @@ public class TestInfixArithmetic extends TestCase {
             System.err.println("Testing with nulls: " + nullFlags[i]);
             PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
             generateInput(ps, nullFlags[i]);
-            String query = "A = foreach (load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':')) generate $0, $0 * $1, $1 ;";
+            String query = "A = foreach (load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':')) generate $0, $0 * $1, $1 ;";
             log.info(query);
             pig.registerQuery(query);
             Iterator it = pig.openIterator("A");
@@ -146,7 +146,7 @@ public class TestInfixArithmetic extends TestCase {
             System.err.println("Testing with nulls: " + nullFlags[i]);
             PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
             generateInput(ps, nullFlags[i]);
-            String query = "A = foreach (load 'file:" + tmpFile + "' using " + PigStorage.class.getName() + "(':')) generate $0, $0 / $1, $1 ;";
+            String query = "A = foreach (load '" + Util.generateURI(tmpFile.toString()) + "' using " + PigStorage.class.getName() + "(':')) generate $0, $0 / $1, $1 ;";
             log.info(query);
             pig.registerQuery(query);
             Iterator it = pig.openIterator("A");
diff --git a/test/org/apache/pig/test/TestInputOutputFileValidator.java b/test/org/apache/pig/test/TestInputOutputFileValidator.java
index c075a11fc..881755885 100644
--- a/test/org/apache/pig/test/TestInputOutputFileValidator.java
+++ b/test/org/apache/pig/test/TestInputOutputFileValidator.java
@@ -7,6 +7,7 @@ import org.apache.pig.ExecType;
 import org.apache.pig.FuncSpec;
 import org.apache.pig.backend.datastorage.ElementDescriptor;
 import org.apache.pig.impl.PigContext;
+import org.apache.pig.impl.io.FileLocalizer;
 import org.apache.pig.impl.io.FileSpec;
 import org.apache.pig.impl.logicalLayer.LOLoad;
 import org.apache.pig.impl.logicalLayer.LOStore;
@@ -153,7 +154,11 @@ public class TestInputOutputFileValidator extends TestCase {
         ElementDescriptor localElem =
             ctx.getLfs().asElement(fp1.getAbsolutePath());           
             
-        ElementDescriptor distribElem = ctx.getDfs().asElement(fp1.getAbsolutePath()) ;
+        String path = fp1.getAbsolutePath();
+        if (System.getProperty("os.name").toUpperCase().startsWith("WINDOWS"))
+            path = FileLocalizer.parseCygPath(path, FileLocalizer.STYLE_UNIX);
+            
+        ElementDescriptor distribElem = ctx.getDfs().asElement(path) ;
     
         localElem.copy(distribElem, null, false);
             
@@ -163,8 +168,12 @@ public class TestInputOutputFileValidator extends TestCase {
     private String createHadoopNonExistenceTempFile(PigContext ctx) throws Throwable {
         
         File fp1 = generateTempFile() ;         
-            
-        ElementDescriptor distribElem = ctx.getDfs().asElement(fp1.getAbsolutePath()) ;
+         
+        String path = fp1.getAbsolutePath();
+        if (System.getProperty("os.name").toUpperCase().startsWith("WINDOWS"))
+            path = FileLocalizer.parseCygPath(path, FileLocalizer.STYLE_UNIX);
+        
+        ElementDescriptor distribElem = ctx.getDfs().asElement(path) ;
         
         if (distribElem.exists()) {
             distribElem.delete() ;
diff --git a/test/org/apache/pig/test/TestJobSubmission.java b/test/org/apache/pig/test/TestJobSubmission.java
index c22824529..d8bdca097 100644
--- a/test/org/apache/pig/test/TestJobSubmission.java
+++ b/test/org/apache/pig/test/TestJobSubmission.java
@@ -105,7 +105,11 @@ public class TestJobSubmission extends junit.framework.TestCase{
     public void setUp() throws Exception{
         curDir = System.getProperty("user.dir");
         inpDir = curDir + File.separatorChar + "test/org/apache/pig/test/data/InputFiles/";
+        if ((System.getProperty("os.name").toUpperCase().startsWith("WINDOWS")))
+            inpDir="/"+FileLocalizer.parseCygPath(inpDir, FileLocalizer.STYLE_WINDOWS);
         golDir = curDir + File.separatorChar + "test/org/apache/pig/test/data/GoldenFiles/";
+        if ((System.getProperty("os.name").toUpperCase().startsWith("WINDOWS")))
+            golDir="/"+FileLocalizer.parseCygPath(golDir, FileLocalizer.STYLE_WINDOWS);
     }
     
     @After
diff --git a/test/org/apache/pig/test/TestLocalJobSubmission.java b/test/org/apache/pig/test/TestLocalJobSubmission.java
index ff6582f53..80770101f 100644
--- a/test/org/apache/pig/test/TestLocalJobSubmission.java
+++ b/test/org/apache/pig/test/TestLocalJobSubmission.java
@@ -93,7 +93,19 @@ public class TestLocalJobSubmission extends junit.framework.TestCase{
         inpDir = curDir + File.separatorChar + "test/org/apache/pig/test/data/InputFiles/";
         outDir = curDir + File.separatorChar + "test/org/apache/pig/test/data/OutputFiles/";
         golDir = curDir + File.separatorChar + "test/org/apache/pig/test/data/GoldenFiles/";
+        inpDir = curDir + File.separatorChar + "test/org/apache/pig/test/data/InputFiles/";
+        
+        if ((System.getProperty("os.name").toUpperCase().startsWith("WINDOWS")))
+            inpDir="/"+FileLocalizer.parseCygPath(inpDir, FileLocalizer.STYLE_WINDOWS);
+        
+        if ((System.getProperty("os.name").toUpperCase().startsWith("WINDOWS")))
+            golDir="/"+FileLocalizer.parseCygPath(golDir, FileLocalizer.STYLE_WINDOWS);
+        
         File f = new File(outDir);
+        
+        if ((System.getProperty("os.name").toUpperCase().startsWith("WINDOWS")))
+            outDir="/"+FileLocalizer.parseCygPath(outDir, FileLocalizer.STYLE_WINDOWS);
+        
         boolean didMakeDir = f.mkdirs();
         /*if(!didMakeDir)
             throw new Exception("Could not Create Directory " + outDir);*/
diff --git a/test/org/apache/pig/test/TestLocalPOSplit.java b/test/org/apache/pig/test/TestLocalPOSplit.java
index fd53dd008..6637d44d3 100644
--- a/test/org/apache/pig/test/TestLocalPOSplit.java
+++ b/test/org/apache/pig/test/TestLocalPOSplit.java
@@ -80,7 +80,7 @@ public class TestLocalPOSplit extends TestCase {
 
         dat.close();
 
-        String query = "split (load '" + datFile.getAbsolutePath()
+        String query = "split (load '" + Util.encodeEscape(datFile.getAbsolutePath())
                 + "') into a if $0 == 2, b if $0 == 9, c if $0 == 7 ;";
 
         LogicalPlan plan = buildPlan(query);
diff --git a/test/org/apache/pig/test/TestMapReduce.java b/test/org/apache/pig/test/TestMapReduce.java
index 20e59897b..c7da842d9 100644
--- a/test/org/apache/pig/test/TestMapReduce.java
+++ b/test/org/apache/pig/test/TestMapReduce.java
@@ -113,7 +113,7 @@ public class TestMapReduce extends TestCase {
     @Test
     public Double bigGroupAll( File tmpFile ) throws Throwable {
 
-        String query = "foreach (group (load 'file:" + tmpFile + "') all) generate " + COUNT.class.getName() + "($1) ;";
+        String query = "foreach (group (load '" + Util.generateURI(tmpFile.toString()) + "') all) generate " + COUNT.class.getName() + "($1) ;";
         System.out.println(query);
         pig.registerQuery("asdf_id = " + query);
         Iterator it = pig.openIterator("asdf_id");
@@ -301,7 +301,7 @@ public class TestMapReduce extends TestCase {
         ps.close();
 
 	//Load, Execute and Store query
-        String query = "foreach (load 'file:"+tmpFile+"') generate $0,$1;";
+        String query = "foreach (load '"+Util.generateURI(tmpFile.toString())+"') generate $0,$1;";
         System.out.println(query);
         pig.registerQuery("asdf_id = " + query);
         try {
@@ -350,7 +350,7 @@ public class TestMapReduce extends TestCase {
         File tmpFile=TestHelper.createTempFile(data) ;
 
 	//Load, Execute and Store query
-        String query = "foreach (load 'file:"+tmpFile+"') generate $0,$1;";
+        String query = "foreach (load '"+Util.generateURI(tmpFile.toString())+"') generate $0,$1;";
         System.out.println(query);
         pig.registerQuery("asdf_id = " + query);
         try {
@@ -393,7 +393,7 @@ public class TestMapReduce extends TestCase {
         ps.close();
 
         // execute query
-        String query = "foreach (group (load 'file:"+tmpFile+"' using " + MyStorage.class.getName() + "()) by " + MyGroup.class.getName() + "('all')) generate flatten(" + MyApply.class.getName() + "($1)) ;";
+        String query = "foreach (group (load '"+Util.generateURI(tmpFile.toString())+"' using " + MyStorage.class.getName() + "()) by " + MyGroup.class.getName() + "('all')) generate flatten(" + MyApply.class.getName() + "($1)) ;";
         System.out.println(query);
         pig.registerQuery("asdf_id = " + query);
 
@@ -427,7 +427,7 @@ public class TestMapReduce extends TestCase {
         ps.close();
 
         // execute query
-        String query = "foreach (group (load 'file:"+tmpFile+"' using " + MyStorage.class.getName() + "()) by " + MyGroup.class.getName() + "('all')) generate flatten(" + MyApply.class.getName() + "($1)) ;";
+        String query = "foreach (group (load '"+Util.generateURI(tmpFile.toString())+"' using " + MyStorage.class.getName() + "()) by " + MyGroup.class.getName() + "('all')) generate flatten(" + MyApply.class.getName() + "($1)) ;";
         System.out.println(query);
         pig.registerQuery("asdf_id = " + query);
 
@@ -457,7 +457,7 @@ public class TestMapReduce extends TestCase {
         ps.close();
         pig.registerFunction("foo",
             new FuncSpec(MyApply.class.getName()+"('foo')"));
-        String query = "foreach (group (load 'file:"+tmpFile+"' using " + MyStorage.class.getName() + "()) by " + MyGroup.class.getName() + "('all')) generate flatten(foo($1)) ;";
+        String query = "foreach (group (load '"+Util.generateURI(tmpFile.toString())+"' using " + MyStorage.class.getName() + "()) by " + MyGroup.class.getName() + "('all')) generate flatten(foo($1)) ;";
         System.out.println(query);
         pig.registerQuery("asdf_id = " + query);
         Iterator it = pig.openIterator("asdf_id");
@@ -502,7 +502,7 @@ public class TestMapReduce extends TestCase {
         ps.close();
         pig.registerFunction("foo",
             new FuncSpec(MyApply.class.getName()+"('foo')"));
-        String query = "foreach (group (load 'file:"+tmpFile+"' using " + MyStorage.class.getName() + "()) by " + MyGroup.class.getName() + "('all')) generate flatten(foo($1)) ;";
+        String query = "foreach (group (load '"+Util.generateURI(tmpFile.toString())+"' using " + MyStorage.class.getName() + "()) by " + MyGroup.class.getName() + "('all')) generate flatten(foo($1)) ;";
         System.out.println(query);
         pig.registerQuery("asdf_id = " + query);
         Iterator it = pig.openIterator("asdf_id");
diff --git a/test/org/apache/pig/test/TestMapReduce2.java b/test/org/apache/pig/test/TestMapReduce2.java
index 5632d8655..28854043b 100644
--- a/test/org/apache/pig/test/TestMapReduce2.java
+++ b/test/org/apache/pig/test/TestMapReduce2.java
@@ -46,8 +46,8 @@ public class TestMapReduce2 extends TestCase {
     public void testUnion1() throws Exception {
         File tmpFile1 = genDataSetFile(false, 30 ) ;
         File tmpFile2 = genDataSetFile(false, 50 ) ;
-        pig.registerQuery("a = load 'file:" + tmpFile1 + "'; ") ;
-        pig.registerQuery("b = load 'file:" + tmpFile2 + "'; ") ;
+        pig.registerQuery("a = load '" + Util.generateURI(tmpFile1.toString()) + "'; ") ;
+        pig.registerQuery("b = load '" + Util.generateURI(tmpFile2.toString()) + "'; ") ;
         pig.registerQuery("c = union a, b; ") ;
         
         verifyUnion( "c", 30 + 50 );
@@ -58,8 +58,8 @@ public class TestMapReduce2 extends TestCase {
 
         File tmpFile1 = genDataSetFile(true, 30 ) ;
         File tmpFile2 = genDataSetFile(true, 50 ) ;
-        pig.registerQuery("a = load 'file:" + tmpFile1 + "'; ") ;
-        pig.registerQuery("b = load 'file:" + tmpFile2 + "'; ") ;
+        pig.registerQuery("a = load '" + Util.generateURI(tmpFile1.toString()) + "'; ") ;
+        pig.registerQuery("b = load '" + Util.generateURI(tmpFile2.toString()) + "'; ") ;
         pig.registerQuery("c = union a, b; ") ;
 
         verifyUnion( "c", 30 + 50 );
@@ -70,8 +70,8 @@ public class TestMapReduce2 extends TestCase {
 
         File tmpFile1 = genDataSetFile(false, 30) ;
         File tmpFile2 = genDataSetFile(false, 50) ;
-        pig.registerQuery("a = load 'file:" + tmpFile1 + "'; ") ;
-        pig.registerQuery("b = load 'file:" + tmpFile2 + "'; ") ;
+        pig.registerQuery("a = load '" + Util.generateURI(tmpFile1.toString()) + "'; ") ;
+        pig.registerQuery("b = load '" + Util.generateURI(tmpFile2.toString()) + "'; ") ;
         pig.registerQuery("a1 = foreach a generate $0, $1; ") ;
         pig.registerQuery("b1 = foreach b generate $0, $1; ") ;
         pig.registerQuery("c = union a1, b1; ") ;
@@ -83,8 +83,8 @@ public class TestMapReduce2 extends TestCase {
     public void testUnion2WithNulls() throws Exception {
         File tmpFile1 = genDataSetFile(true, 30) ;
         File tmpFile2 = genDataSetFile(true, 50) ;
-        pig.registerQuery("a = load 'file:" + tmpFile1 + "'; ") ;
-        pig.registerQuery("b = load 'file:" + tmpFile2 + "'; ") ;
+        pig.registerQuery("a = load '" + Util.generateURI(tmpFile1.toString()) + "'; ") ;
+        pig.registerQuery("b = load '" + Util.generateURI(tmpFile2.toString()) + "'; ") ;
         pig.registerQuery("a1 = foreach a generate $0, $1; ") ;
         pig.registerQuery("b1 = foreach b generate $0, $1; ") ;
         pig.registerQuery("c = union a1, b1; ") ;
diff --git a/test/org/apache/pig/test/TestParamSubPreproc.java b/test/org/apache/pig/test/TestParamSubPreproc.java
index c2fcd8719..6820a89ea 100644
--- a/test/org/apache/pig/test/TestParamSubPreproc.java
+++ b/test/org/apache/pig/test/TestParamSubPreproc.java
@@ -1197,6 +1197,8 @@ public class TestParamSubPreproc extends TestCase {
             pigOStream = new FileWriter(basedir + "/output1.pig");
 
             String[] arg = {"date=`perl -e 'print \"20080228\n20070101\"' | head -n 1`"};
+            if (System.getProperty("os.name").toUpperCase().startsWith("WINDOWS"))
+                arg[0] = "date=`perl -e 'print \\\"20080228\n20070101\\\"' | head -n 1`";
             String[] argFiles = null;
             ps.genSubstitutedFile(pigIStream , pigOStream , arg , argFiles);
 
diff --git a/test/org/apache/pig/test/TestPigContext.java b/test/org/apache/pig/test/TestPigContext.java
index d3d506e61..575781841 100644
--- a/test/org/apache/pig/test/TestPigContext.java
+++ b/test/org/apache/pig/test/TestPigContext.java
@@ -100,7 +100,7 @@ public class TestPigContext extends TestCase {
 
     private List<String> getCommands() {
         List<String> commands = new ArrayList<String>();
-        commands.add("my_input = LOAD '" + input.getAbsolutePath() + "' USING PigStorage();");
+        commands.add("my_input = LOAD '" + Util.encodeEscape(input.getAbsolutePath()) + "' USING PigStorage();");
         commands.add("words = FOREACH my_input GENERATE FLATTEN(TOKENIZE(*));");
         commands.add("grouped = GROUP words BY $0;");
         commands.add("counts = FOREACH grouped GENERATE group, COUNT(words);");
diff --git a/test/org/apache/pig/test/TestPigScriptParser.java b/test/org/apache/pig/test/TestPigScriptParser.java
index 44bf32dc0..4294219ee 100644
--- a/test/org/apache/pig/test/TestPigScriptParser.java
+++ b/test/org/apache/pig/test/TestPigScriptParser.java
@@ -36,7 +36,7 @@ public class TestPigScriptParser extends TestCase {
         // Start the real parsing job
         {
         	// Initial statement
-        	String query = String.format("A = LOAD '%s' ;", tempFile) ;
+        	String query = String.format("A = LOAD '%s' ;", Util.encodeEscape(tempFile)) ;
         	ByteArrayInputStream in = new ByteArrayInputStream(query.getBytes()); 
         	QueryParser parser = new QueryParser(in, pigContext, "scope", aliases, opTable, aliasOp) ;
         	LogicalPlan lp = parser.Parse() ; 
diff --git a/test/org/apache/pig/test/TestPigServer.java b/test/org/apache/pig/test/TestPigServer.java
index 756936a5c..01b1da2d4 100644
--- a/test/org/apache/pig/test/TestPigServer.java
+++ b/test/org/apache/pig/test/TestPigServer.java
@@ -15,254 +15,544 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-
-package org.apache.pig.test;
-
-import java.io.File;
-import java.io.IOException;
-import java.io.FileOutputStream;
-import java.io.OutputStreamWriter;
-import java.util.List;
-import java.util.Iterator;
-import java.net.URL;
-import java.net.URLClassLoader;
-import java.lang.reflect.Method;
-
+
+package org.apache.pig.test;
+
+import java.io.File;
+import java.io.IOException;
+import java.io.FileOutputStream;
+import java.io.OutputStreamWriter;
+import java.io.BufferedInputStream;
+import java.io.BufferedOutputStream;
+import java.io.BufferedReader;
+import java.io.DataInputStream;
+import java.io.FileInputStream;
+import java.io.InputStream;
+import java.io.InputStreamReader;
+import java.io.PrintStream;
+import java.util.List;
+import java.util.Iterator;
+import java.net.URL;
+import java.net.URLClassLoader;
+import java.lang.reflect.Method;
+
 import org.apache.pig.ExecType;
-import org.apache.pig.PigServer;
-
-import org.junit.Test;
-import junit.framework.TestCase;
-
-
-public class TestPigServer extends TestCase {
-    private PigServer pig = null;
-    MiniCluster cluster = MiniCluster.buildCluster();
-    
-    private void initPigServer() throws Throwable {
-        if (pig == null) {
-            pig = new PigServer(ExecType.MAPREDUCE, cluster.getProperties());
-        }
-    }
-    
-    
-    private final static String FILE_SEPARATOR = System.getProperty("file.separator");
-    
-    // make sure that name is included or not (depending on flag "included") 
-    // in the given list of stings
-    private static void verifyStringContained(List<URL> list, String name, boolean included) {
-        Iterator<URL> iter = list.iterator();
-        boolean nameIsSubstring = false;
-        int count = 0;
-        
-        while (iter.hasNext()) {
-            if (iter.next().toString().contains(name)) {
-                nameIsSubstring = true;
-                ++count;
-            }
-        }
-        
-        if (included) {
-            assertTrue(nameIsSubstring);
-            assertTrue(count == 1);
-        }
-        else {
-            assertFalse(nameIsSubstring);
-        }
-    }
-    
-    // creates an empty jar file
-    private static void createFakeJarFile(String location, String name) 
-            throws IOException {
-        assertFalse((new File(name)).canRead());
-        
-        assertTrue((new File(location)).mkdirs());
-        
-        assertTrue((new File(location + FILE_SEPARATOR + name)).
-                    createNewFile());
-    }
-    
-    // dynamically add more resources to the system class loader
-    private static void registerNewResource(String file) throws Exception {
-        URL urlToAdd = new File(file).toURI().toURL();
-        URLClassLoader sysLoader = (URLClassLoader) ClassLoader.getSystemClassLoader();
-        Method addMethod = URLClassLoader.class.
-                            getDeclaredMethod("addURL",
-                                              new Class[]{URL.class});
-        addMethod.setAccessible(true);
-        addMethod.invoke(sysLoader, new Object[]{urlToAdd});
-    }
-    
-    private static void executeShellCommand(String cmd) throws Exception {
-        Process cmdProc = Runtime.getRuntime().exec(cmd);
-        
-        cmdProc.waitFor();
-        
-        assertTrue(cmdProc.exitValue() == 0);
-    }
-    
-    /**
-     * The jar file to register is not present
-     */
-    @Test
-    public void testRegisterJarFileNotPresent() throws Throwable {
-        // resister a jar file that does not exist
-        
-        String jarName = "BadFileNameTestJarNotPresent.jar";
-        
-        // jar name is not present to start with
-        initPigServer();
-        verifyStringContained(pig.getPigContext().extraJars, jarName, false);
-
-        boolean exceptionRaised = false;
-        try {
-            pig.registerJar(jarName);
-        }
-        catch (IOException e) {
-            exceptionRaised = true;
-        }        
-        assertTrue(exceptionRaised);
-        verifyStringContained(pig.getPigContext().extraJars, jarName, false);
-    }
-
-    /**
-     * Jar file to register is not present in the system resources
-     * in this case name of jar file is relative to current working dir
-     */
-    @Test
-    public void testRegisterJarLocalDir() throws Throwable {
-        String dir1 = "test1_register_jar_local";
-        String dir2 = "test2_register_jar_local";
-        String jarLocation = dir1 + FILE_SEPARATOR +
-                              dir2 + FILE_SEPARATOR;
-        String jarName = "TestRegisterJarLocal.jar";
-        
-        initPigServer();
-        
-        createFakeJarFile(jarLocation, jarName);
-        
-        verifyStringContained(pig.getPigContext().extraJars, jarName, false);
-        
-        boolean exceptionRaised = false;
-        try {
-            pig.registerJar(jarLocation + jarName);
-        }
-        catch (IOException e) {
-            exceptionRaised = true;
-        }        
-        assertFalse(exceptionRaised);
-        verifyStringContained(pig.getPigContext().extraJars, jarName, true);
-
-        // clean-up
-        assertTrue((new File(jarLocation + jarName)).delete());
-        (new File(dir1 + FILE_SEPARATOR + dir2)).delete();
-        (new File(dir1)).delete();
-    }
-
-    /**
-     * Jar file is located via system resources
-     * Test verifies that even with multiple resources matching,
-     * only one of them is registered.
-     */
-    @Test
-    public void testRegisterJarFromResources () throws Throwable {
-        String dir = "test_register_jar_res_dir";
-        String subDir1 = "test_register_jar_res_sub_dir1";
-        String subDir2 = "test_register_jar_res_sub_dir2";
-        String jarName = "TestRegisterJarFromRes.jar";
-        String jarLocation1 = dir + FILE_SEPARATOR + subDir1 + FILE_SEPARATOR;
-        String jarLocation2 = dir + FILE_SEPARATOR + subDir2 + FILE_SEPARATOR;
-        
-        initPigServer();
-        
-        createFakeJarFile(jarLocation1, jarName);
-        createFakeJarFile(jarLocation2, jarName);
-        
-        verifyStringContained(pig.getPigContext().extraJars, jarName, false);
-        
-        registerNewResource(jarLocation1);
-        registerNewResource(jarLocation2);
-        
-        boolean exceptionRaised = false;
-        try {
-            pig.registerJar(jarName);
-        }
-        catch (IOException e) {
-            exceptionRaised = true;
-        }
-        assertFalse(exceptionRaised);
-        verifyStringContained(pig.getPigContext().extraJars, jarName, true);
-
-        // clean-up
-        assertTrue((new File(jarLocation1 + jarName)).delete());
-        assertTrue((new File(jarLocation2 + jarName)).delete());
-        (new File(jarLocation1)).delete();
-        (new File(jarLocation2)).delete();
-        (new File(dir)).delete();
-    }
-
-    /**
-     * Use a resource inside a jar file.
-     * Verify that the containing jar file is registered correctly.
-     * @throws Exception
-     */
-    @Test
-    public void testRegisterJarResourceInJar() throws Throwable {
-        String dir = "test_register_jar_res_in_jar";
-        String subDir = "sub_dir";
-        String jarName = "TestRegisterJarNonEmpty.jar";
-        String className = "TestRegisterJar";
-        String javaSrc = "package " + subDir + "; class " + className + " { }";
-
-        initPigServer();
-        
-        // create dirs
-        (new File(dir + FILE_SEPARATOR + subDir)).mkdirs();
-
-        // generate java file
-        FileOutputStream outStream = 
-            new FileOutputStream(new File(dir + FILE_SEPARATOR + subDir +
-                                    FILE_SEPARATOR + className + ".java"));
-        
-        OutputStreamWriter outWriter = new OutputStreamWriter(outStream);
-        outWriter.write(javaSrc);
-        outWriter.close();
-        
-        // compile
-        executeShellCommand("javac " + dir + FILE_SEPARATOR + subDir +
-                               FILE_SEPARATOR + className + ".java");
-
-        // remove src file
-        (new File(dir + FILE_SEPARATOR + subDir +
-                  FILE_SEPARATOR + className + ".java")).delete();
-
-        // generate jar file
-        executeShellCommand("jar -cf " + dir + FILE_SEPARATOR + jarName + " " +
-                              "-C " + dir + " " + subDir);
-        
-        // remove class file and sub_dir
-        (new File(dir + FILE_SEPARATOR + subDir +
-                  FILE_SEPARATOR + className + ".class")).delete();
-        (new File(dir + FILE_SEPARATOR + subDir)).delete();
-        
-        // register resource
-        registerNewResource(dir + FILE_SEPARATOR + jarName);
-        
-        // load the specific resource
-        boolean exceptionRaised = false;
-        try {
-            pig.registerJar("sub_dir/TestRegisterJar.class");
-        }
-        catch (IOException e) {
-            exceptionRaised = true;
-        }
-        
-        // verify proper jar file is located
-        assertFalse(exceptionRaised);
-        verifyStringContained(pig.getPigContext().extraJars, jarName, true);
-
-        // clean up Jar file and test dir
-        (new File(dir + FILE_SEPARATOR + jarName)).delete();
-        (new File(dir)).delete();
-    }
+import org.apache.pig.PigServer;
+
+import org.junit.Before;
+import org.junit.After;
+import org.junit.Test;
+import junit.framework.TestCase;
+
+
+public class TestPigServer extends TestCase {
+    private PigServer pig = null;
+    MiniCluster cluster = MiniCluster.buildCluster();
+    private File stdOutRedirectedFile;
+
+    @Before
+    @Override
+    public void setUp() throws Exception{
+        pig = new PigServer(ExecType.MAPREDUCE, cluster.getProperties());
+        stdOutRedirectedFile = new File("stdout.redirected");
+        // Create file if it does not exist
+        try {
+            if(!stdOutRedirectedFile.createNewFile())
+                fail("Unable to create input files");
+        } catch (IOException e) {
+            fail("Unable to create input files:" + e.getMessage());
+        }
+    }
+    
+    @After
+    @Override
+    public void tearDown() throws Exception{
+        pig = null;
+        stdOutRedirectedFile.delete();
+    }
+    
+    
+    private final static String FILE_SEPARATOR = System.getProperty("file.separator");
+    
+    // make sure that name is included or not (depending on flag "included") 
+    // in the given list of stings
+    private static void verifyStringContained(List<URL> list, String name, boolean included) {
+        Iterator<URL> iter = list.iterator();
+        boolean nameIsSubstring = false;
+        int count = 0;
+        
+        while (iter.hasNext()) {
+            if (iter.next().toString().contains(name)) {
+                nameIsSubstring = true;
+                ++count;
+            }
+        }
+        
+        if (included) {
+            assertTrue(nameIsSubstring);
+            assertTrue(count == 1);
+        }
+        else {
+            assertFalse(nameIsSubstring);
+        }
+    }
+    
+    // creates an empty jar file
+    private static void createFakeJarFile(String location, String name) 
+            throws IOException {
+        assertFalse((new File(name)).canRead());
+        
+        assertTrue((new File(location)).mkdirs());
+        
+        assertTrue((new File(location + FILE_SEPARATOR + name)).
+                    createNewFile());
+    }
+    
+    // dynamically add more resources to the system class loader
+    private static void registerNewResource(String file) throws Exception {
+        URL urlToAdd = new File(file).toURI().toURL();
+        URLClassLoader sysLoader = (URLClassLoader) ClassLoader.getSystemClassLoader();
+        Method addMethod = URLClassLoader.class.
+                            getDeclaredMethod("addURL",
+                                              new Class[]{URL.class});
+        addMethod.setAccessible(true);
+        addMethod.invoke(sysLoader, new Object[]{urlToAdd});
+    }
+    
+    private static void executeShellCommand(String cmd) throws Exception {
+        Process cmdProc = Runtime.getRuntime().exec(cmd);
+        
+        cmdProc.waitFor();
+        
+        assertTrue(cmdProc.exitValue() == 0);
+    }
+    
+    /**
+     * The jar file to register is not present
+     */
+    @Test
+    public void testRegisterJarFileNotPresent() throws Throwable {
+        // resister a jar file that does not exist
+        
+        String jarName = "BadFileNameTestJarNotPresent.jar";
+        
+        // jar name is not present to start with
+        verifyStringContained(pig.getPigContext().extraJars, jarName, false);
+
+        boolean exceptionRaised = false;
+        try {
+            pig.registerJar(jarName);
+        }
+        catch (IOException e) {
+            exceptionRaised = true;
+        }        
+        assertTrue(exceptionRaised);
+        verifyStringContained(pig.getPigContext().extraJars, jarName, false);
+    }
+
+    /**
+     * Jar file to register is not present in the system resources
+     * in this case name of jar file is relative to current working dir
+     */
+    @Test
+    public void testRegisterJarLocalDir() throws Throwable {
+        String dir1 = "test1_register_jar_local";
+        String dir2 = "test2_register_jar_local";
+        String jarLocation = dir1 + FILE_SEPARATOR +
+                              dir2 + FILE_SEPARATOR;
+        String jarName = "TestRegisterJarLocal.jar";
+        
+        
+        createFakeJarFile(jarLocation, jarName);
+        
+        verifyStringContained(pig.getPigContext().extraJars, jarName, false);
+        
+        boolean exceptionRaised = false;
+        try {
+            pig.registerJar(jarLocation + jarName);
+        }
+        catch (IOException e) {
+            exceptionRaised = true;
+        }        
+        assertFalse(exceptionRaised);
+        verifyStringContained(pig.getPigContext().extraJars, jarName, true);
+
+        // clean-up
+        assertTrue((new File(jarLocation + jarName)).delete());
+        (new File(dir1 + FILE_SEPARATOR + dir2)).delete();
+        (new File(dir1)).delete();
+    }
+
+    /**
+     * Jar file is located via system resources
+     * Test verifies that even with multiple resources matching,
+     * only one of them is registered.
+     */
+    @Test
+    public void testRegisterJarFromResources () throws Throwable {
+        String dir = "test_register_jar_res_dir";
+        String subDir1 = "test_register_jar_res_sub_dir1";
+        String subDir2 = "test_register_jar_res_sub_dir2";
+        String jarName = "TestRegisterJarFromRes.jar";
+        String jarLocation1 = dir + FILE_SEPARATOR + subDir1 + FILE_SEPARATOR;
+        String jarLocation2 = dir + FILE_SEPARATOR + subDir2 + FILE_SEPARATOR;
+        
+        
+        createFakeJarFile(jarLocation1, jarName);
+        createFakeJarFile(jarLocation2, jarName);
+        
+        verifyStringContained(pig.getPigContext().extraJars, jarName, false);
+        
+        registerNewResource(jarLocation1);
+        registerNewResource(jarLocation2);
+        
+        boolean exceptionRaised = false;
+        try {
+            pig.registerJar(jarName);
+        }
+        catch (IOException e) {
+            exceptionRaised = true;
+        }
+        assertFalse(exceptionRaised);
+        verifyStringContained(pig.getPigContext().extraJars, jarName, true);
+
+        // clean-up
+        assertTrue((new File(jarLocation1 + jarName)).delete());
+        assertTrue((new File(jarLocation2 + jarName)).delete());
+        (new File(jarLocation1)).delete();
+        (new File(jarLocation2)).delete();
+        (new File(dir)).delete();
+    }
+
+    /**
+     * Use a resource inside a jar file.
+     * Verify that the containing jar file is registered correctly.
+     * @throws Exception
+     */
+    @Test
+    public void testRegisterJarResourceInJar() throws Throwable {
+        String dir = "test_register_jar_res_in_jar";
+        String subDir = "sub_dir";
+        String jarName = "TestRegisterJarNonEmpty.jar";
+        String className = "TestRegisterJar";
+        String javaSrc = "package " + subDir + "; class " + className + " { }";
+
+        
+        // create dirs
+        (new File(dir + FILE_SEPARATOR + subDir)).mkdirs();
+
+        // generate java file
+        FileOutputStream outStream = 
+            new FileOutputStream(new File(dir + FILE_SEPARATOR + subDir +
+                                    FILE_SEPARATOR + className + ".java"));
+        
+        OutputStreamWriter outWriter = new OutputStreamWriter(outStream);
+        outWriter.write(javaSrc);
+        outWriter.close();
+        
+        // compile
+        executeShellCommand("javac " + dir + FILE_SEPARATOR + subDir +
+                               FILE_SEPARATOR + className + ".java");
+
+        // remove src file
+        (new File(dir + FILE_SEPARATOR + subDir +
+                  FILE_SEPARATOR + className + ".java")).delete();
+
+        // generate jar file
+        executeShellCommand("jar -cf " + dir + FILE_SEPARATOR + jarName + " " +
+                              "-C " + dir + " " + subDir);
+        
+        // remove class file and sub_dir
+        (new File(dir + FILE_SEPARATOR + subDir +
+                  FILE_SEPARATOR + className + ".class")).delete();
+        (new File(dir + FILE_SEPARATOR + subDir)).delete();
+        
+        // register resource
+        registerNewResource(dir + FILE_SEPARATOR + jarName);
+        
+        // load the specific resource
+        boolean exceptionRaised = false;
+        try {
+            pig.registerJar("sub_dir/TestRegisterJar.class");
+        }
+        catch (IOException e) {
+            exceptionRaised = true;
+        }
+        
+        // verify proper jar file is located
+        assertFalse(exceptionRaised);
+        verifyStringContained(pig.getPigContext().extraJars, jarName, true);
+
+        // clean up Jar file and test dir
+        (new File(dir + FILE_SEPARATOR + jarName)).delete();
+        (new File(dir)).delete();
+    }
+
+    @Test
+    public void testDescribeLoad() throws Throwable {
+        PrintStream console = System.out;
+        PrintStream out = new PrintStream(new BufferedOutputStream(new FileOutputStream(stdOutRedirectedFile)));
+
+        pig.registerQuery("a = load 'a' as (field1: int, field2: float, field3: chararray );") ;
+        System.setOut(out);
+        pig.dumpSchema("a") ;
+        out.close(); // Remember this!
+        System.setOut(console);
+
+        String s;
+        InputStream fileWithStdOutContents = new DataInputStream( new BufferedInputStream( new FileInputStream(stdOutRedirectedFile)));
+        BufferedReader reader = new BufferedReader(new InputStreamReader(fileWithStdOutContents));
+        while ((s = reader.readLine()) != null) {
+            assertTrue(s.equals("a: {field1: int,field2: float,field3: chararray}") == true);
+        }
+
+    }
+
+    @Test
+    public void testDescribeFilter() throws Throwable {
+        PrintStream console = System.out;
+        PrintStream out = new PrintStream(new BufferedOutputStream(new FileOutputStream(stdOutRedirectedFile)));
+
+        pig.registerQuery("a = load 'a' as (field1: int, field2: float, field3: chararray );") ;
+        pig.registerQuery("b = filter a by field1 > 10;") ;
+        System.setOut(out);
+        pig.dumpSchema("b") ;
+        out.close(); // Remember this!
+        System.setOut(console);
+
+        String s;
+        InputStream fileWithStdOutContents = new DataInputStream( new BufferedInputStream( new FileInputStream(stdOutRedirectedFile)));
+        BufferedReader reader = new BufferedReader(new InputStreamReader(fileWithStdOutContents));
+        while ((s = reader.readLine()) != null) {
+            assertTrue(s.equals("b: {field1: int,field2: float,field3: chararray}") == true);
+        }
+
+    }
+
+    @Test
+    public void testDescribeDistinct() throws Throwable {
+        PrintStream console = System.out;
+        PrintStream out = new PrintStream(new BufferedOutputStream(new FileOutputStream(stdOutRedirectedFile)));
+
+        pig.registerQuery("a = load 'a' as (field1: int, field2: float, field3: chararray );") ;
+        pig.registerQuery("b = distinct a ;") ;
+        System.setOut(out);
+        pig.dumpSchema("b") ;
+        out.close(); // Remember this!
+        System.setOut(console);
+
+        String s;
+        InputStream fileWithStdOutContents = new DataInputStream( new BufferedInputStream( new FileInputStream(stdOutRedirectedFile)));
+        BufferedReader reader = new BufferedReader(new InputStreamReader(fileWithStdOutContents));
+        while ((s = reader.readLine()) != null) {
+            assertTrue(s.equals("b: {field1: int,field2: float,field3: chararray}") == true);
+        }
+
+    }
+
+    @Test
+    public void testDescribeSort() throws Throwable {
+        PrintStream console = System.out;
+        PrintStream out = new PrintStream(new BufferedOutputStream(new FileOutputStream(stdOutRedirectedFile)));
+
+        pig.registerQuery("a = load 'a' as (field1: int, field2: float, field3: chararray );") ;
+        pig.registerQuery("b = order a by * desc;") ;
+        System.setOut(out);
+        pig.dumpSchema("b") ;
+        out.close(); // Remember this!
+        System.setOut(console);
+
+        String s;
+        InputStream fileWithStdOutContents = new DataInputStream( new BufferedInputStream( new FileInputStream(stdOutRedirectedFile)));
+        BufferedReader reader = new BufferedReader(new InputStreamReader(fileWithStdOutContents));
+        while ((s = reader.readLine()) != null) {
+            assertTrue(s.equals("b: {field1: int,field2: float,field3: chararray}") == true);
+        }
+
+    }
+
+    @Test
+    public void testDescribeLimit() throws Throwable {
+        PrintStream console = System.out;
+        PrintStream out = new PrintStream(new BufferedOutputStream(new FileOutputStream(stdOutRedirectedFile)));
+
+        pig.registerQuery("a = load 'a' as (field1: int, field2: float, field3: chararray );") ;
+        pig.registerQuery("b = limit a 10;") ;
+        System.setOut(out);
+        pig.dumpSchema("b") ;
+        out.close(); // Remember this!
+        System.setOut(console);
+
+        String s;
+        InputStream fileWithStdOutContents = new DataInputStream( new BufferedInputStream( new FileInputStream(stdOutRedirectedFile)));
+        BufferedReader reader = new BufferedReader(new InputStreamReader(fileWithStdOutContents));
+        while ((s = reader.readLine()) != null) {
+            assertTrue(s.equals("b: {field1: int,field2: float,field3: chararray}") == true);
+        }
+
+    }
+
+    @Test
+    public void testDescribeForeach() throws Throwable {
+        PrintStream console = System.out;
+        PrintStream out = new PrintStream(new BufferedOutputStream(new FileOutputStream(stdOutRedirectedFile)));
+
+        pig.registerQuery("a = load 'a' as (field1: int, field2: float, field3: chararray );") ;
+        pig.registerQuery("b = foreach a generate field1 + 10;") ;
+        System.setOut(out);
+        pig.dumpSchema("b") ;
+        out.close(); 
+        System.setOut(console);
+
+        String s;
+        InputStream fileWithStdOutContents = new DataInputStream( new BufferedInputStream( new FileInputStream(stdOutRedirectedFile)));
+        BufferedReader reader = new BufferedReader(new InputStreamReader(fileWithStdOutContents));
+        while ((s = reader.readLine()) != null) {
+            assertTrue(s.equals("b: {int}") == true);
+        }
+
+    }
+
+    @Test
+    public void testDescribeForeachFail() throws Throwable {
+
+        pig.registerQuery("a = load 'a' as (field1: int, field2: float, field3: chararray );") ;
+        pig.registerQuery("b = foreach a generate field1 + 10;") ;
+        try {
+            pig.dumpSchema("c") ;
+            fail("Error expected");
+        } catch (Exception e) {
+            assertTrue(e.getMessage().contains("Unable to describe schema for alias c"));
+        }
+    }
+
+    @Test
+    public void testDescribeForeachNoSchema() throws Throwable {
+        PrintStream console = System.out;
+        PrintStream out = new PrintStream(new BufferedOutputStream(new FileOutputStream(stdOutRedirectedFile)));
+
+        pig.registerQuery("a = load 'a' ;") ;
+        pig.registerQuery("b = foreach a generate *;") ;
+        System.setOut(out);
+        pig.dumpSchema("b") ;
+        out.close(); 
+        System.setOut(console);
+
+        String s;
+        InputStream fileWithStdOutContents = new DataInputStream( new BufferedInputStream( new FileInputStream(stdOutRedirectedFile)));
+        BufferedReader reader = new BufferedReader(new InputStreamReader(fileWithStdOutContents));
+        while ((s = reader.readLine()) != null) {
+            assertTrue(s.equals("Schema for b unknown.") == true);
+        }
+
+    }
+
+    @Test
+    public void testDescribeCogroup() throws Throwable {
+        PrintStream console = System.out;
+        PrintStream out = new PrintStream(new BufferedOutputStream(new FileOutputStream(stdOutRedirectedFile)));
+
+        pig.registerQuery("a = load 'a' as (field1: int, field2: float, field3: chararray );") ;
+        pig.registerQuery("b = load 'b' as (field4, field5: double, field6: chararray );") ;
+        pig.registerQuery("c = cogroup a by field1, b by field4;") ;
+        System.setOut(out);
+        pig.dumpSchema("c") ;
+        out.close(); 
+        System.setOut(console);
+
+        String s;
+        InputStream fileWithStdOutContents = new DataInputStream( new BufferedInputStream( new FileInputStream(stdOutRedirectedFile)));
+        BufferedReader reader = new BufferedReader(new InputStreamReader(fileWithStdOutContents));
+        while ((s = reader.readLine()) != null) {
+            assertTrue(s.equals("c: {group: int,a: {field1: int,field2: float,field3: chararray},b: {field4: bytearray,field5: double,field6: chararray}}") == true);
+        }
+
+    }
+
+    @Test
+    public void testDescribeCross() throws Throwable {
+        PrintStream console = System.out;
+        PrintStream out = new PrintStream(new BufferedOutputStream(new FileOutputStream(stdOutRedirectedFile)));
+
+        pig.registerQuery("a = load 'a' as (field1: int, field2: float, field3: chararray );") ;
+        pig.registerQuery("b = load 'b' as (field4, field5: double, field6: chararray );") ;
+        pig.registerQuery("c = cross a, b;") ;
+        System.setOut(out);
+        pig.dumpSchema("c") ;
+        out.close(); 
+        System.setOut(console);
+
+        String s;
+        InputStream fileWithStdOutContents = new DataInputStream( new BufferedInputStream( new FileInputStream(stdOutRedirectedFile)));
+        BufferedReader reader = new BufferedReader(new InputStreamReader(fileWithStdOutContents));
+        while ((s = reader.readLine()) != null) {
+            assertTrue(s.equals("c: {a::field1: int,a::field2: float,a::field3: chararray,b::field4: bytearray,b::field5: double,b::field6: chararray}") == true);
+        }
+
+    }
+
+    @Test
+    public void testDescribeJoin() throws Throwable {
+        PrintStream console = System.out;
+        PrintStream out = new PrintStream(new BufferedOutputStream(new FileOutputStream(stdOutRedirectedFile)));
+
+        pig.registerQuery("a = load 'a' as (field1: int, field2: float, field3: chararray );") ;
+        pig.registerQuery("b = load 'b' as (field4, field5: double, field6: chararray );") ;
+        pig.registerQuery("c = join a by field1, b by field4;") ;
+        System.setOut(out);
+        pig.dumpSchema("c") ;
+        out.close(); 
+        System.setOut(console);
+
+        String s;
+        InputStream fileWithStdOutContents = new DataInputStream( new BufferedInputStream( new FileInputStream(stdOutRedirectedFile)));
+        BufferedReader reader = new BufferedReader(new InputStreamReader(fileWithStdOutContents));
+        while ((s = reader.readLine()) != null) {
+            assertTrue(s.equals("c: {a::field1: int,a::field2: float,a::field3: chararray,b::field4: bytearray,b::field5: double,b::field6: chararray}") == true);
+        }
+
+    }
+
+    @Test
+    public void testDescribeUnion() throws Throwable {
+        PrintStream console = System.out;
+        PrintStream out = new PrintStream(new BufferedOutputStream(new FileOutputStream(stdOutRedirectedFile)));
+
+        pig.registerQuery("a = load 'a' as (field1: int, field2: float, field3: chararray );") ;
+        pig.registerQuery("b = load 'b' as (field4, field5: double, field6: chararray );") ;
+        pig.registerQuery("c = union a, b;") ;
+        System.setOut(out);
+        pig.dumpSchema("c") ;
+        out.close(); 
+        System.setOut(console);
+
+        String s;
+        InputStream fileWithStdOutContents = new DataInputStream( new BufferedInputStream( new FileInputStream(stdOutRedirectedFile)));
+        BufferedReader reader = new BufferedReader(new InputStreamReader(fileWithStdOutContents));
+        while ((s = reader.readLine()) != null) {
+            assertTrue(s.equals("c: {field1: int,field2: double,field3: chararray}") == true);
+        }
+
+    }
+
+    @Test
+    public void testDescribeComplex() throws Throwable {
+        PrintStream console = System.out;
+        PrintStream out = new PrintStream(new BufferedOutputStream(new FileOutputStream(stdOutRedirectedFile)));
+
+        pig.registerQuery("a = load 'a' as (site: chararray, count: int, itemCounts: bag { itemCountsTuple: tuple (type: chararray, typeCount: int, f: float, m: map[]) } ) ;") ;
+        pig.registerQuery("b = foreach a generate site, count, FLATTEN(itemCounts);") ;
+        System.setOut(out);
+        pig.dumpSchema("b") ;
+        out.close();
+        System.setOut(console);
+
+        String s;
+        InputStream fileWithStdOutContents = new DataInputStream( new BufferedInputStream( new FileInputStream(stdOutRedirectedFile)));
+        BufferedReader reader = new BufferedReader(new InputStreamReader(fileWithStdOutContents));
+        while ((s = reader.readLine()) != null) {
+            assertTrue(s.equals("b: {site: chararray,count: int,itemCounts::itemCountsTuple: (type: chararray,typeCount: int,f: float,m: map[ ])}") == true);
+        }
+
+    }
 }
diff --git a/test/org/apache/pig/test/TestPigSplit.java b/test/org/apache/pig/test/TestPigSplit.java
index faafe207e..0e13ec07f 100644
--- a/test/org/apache/pig/test/TestPigSplit.java
+++ b/test/org/apache/pig/test/TestPigSplit.java
@@ -90,7 +90,7 @@ public class TestPigSplit extends PigExecTestCase {
         }
         pw.close();
         
-        pigServer.registerQuery("a = load 'file:" + f + "';");
+        pigServer.registerQuery("a = load '" + Util.generateURI(f.toString()) + "';");
         pigServer.registerQuery("a = filter a by $0 == '1';");
 
         Iterator<Tuple> iter = pigServer.openIterator("a");
diff --git a/test/org/apache/pig/test/TestSplitStore.java b/test/org/apache/pig/test/TestSplitStore.java
index 75eacca32..df1871ca1 100644
--- a/test/org/apache/pig/test/TestSplitStore.java
+++ b/test/org/apache/pig/test/TestSplitStore.java
@@ -45,7 +45,7 @@ public class TestSplitStore extends TestCase{
     
     @Test
     public void test1() throws Exception{
-        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
         pig.store("A1", "'" + FileLocalizer.getTemporaryPath(null, pigContext) + "'");
         pig.store("A2", "'" + FileLocalizer.getTemporaryPath(null, pigContext) + "'");
@@ -53,7 +53,7 @@ public class TestSplitStore extends TestCase{
     
     @Test
     public void test2() throws Exception{
-        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
         pig.openIterator("A1");
         pig.store("A2", "'" + FileLocalizer.getTemporaryPath(null, pigContext) + "'");
@@ -61,7 +61,7 @@ public class TestSplitStore extends TestCase{
     
     @Test
     public void test3() throws Exception{
-        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
         pig.openIterator("A2");
         pig.store("A1", "'" + FileLocalizer.getTemporaryPath(null, pigContext) + "'");
@@ -69,7 +69,7 @@ public class TestSplitStore extends TestCase{
     
     @Test
     public void test4() throws Exception{
-        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
         pig.store("A1", "'" + FileLocalizer.getTemporaryPath(null, pigContext) + "'");
         pig.openIterator("A2");
@@ -77,7 +77,7 @@ public class TestSplitStore extends TestCase{
     
     @Test
     public void test5() throws Exception{
-        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
         pig.store("A2", "'" + FileLocalizer.getTemporaryPath(null, pigContext) + "'");
         pig.openIterator("A1");
@@ -85,7 +85,7 @@ public class TestSplitStore extends TestCase{
     
     @Test
     public void test6() throws Exception{
-        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
         pig.openIterator("A1");
         pig.registerQuery("Store A2 into '" + FileLocalizer.getTemporaryPath(null, pigContext) + "';");
@@ -93,7 +93,7 @@ public class TestSplitStore extends TestCase{
     
     @Test
     public void test7() throws Exception{
-        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
         pig.openIterator("A2");
         pig.registerQuery("Store A1 into '" + FileLocalizer.getTemporaryPath(null, pigContext) + "';");
@@ -101,7 +101,7 @@ public class TestSplitStore extends TestCase{
     
     @Test
     public void test8() throws Exception{
-        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
         pig.registerQuery("Store A1 into '" + FileLocalizer.getTemporaryPath(null, pigContext) + "';");
         pig.openIterator("A2");
@@ -109,7 +109,7 @@ public class TestSplitStore extends TestCase{
     
     @Test
     public void test9() throws Exception{
-        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
         pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
         pig.registerQuery("Store A2 into '" + FileLocalizer.getTemporaryPath(null, pigContext) + "';");
         pig.openIterator("A1");
diff --git a/test/org/apache/pig/test/TestStore.java b/test/org/apache/pig/test/TestStore.java
index 5d0b05464..1ccd8db70 100644
--- a/test/org/apache/pig/test/TestStore.java
+++ b/test/org/apache/pig/test/TestStore.java
@@ -58,7 +58,7 @@ public class TestStore extends junit.framework.TestCase {
     @Before
     public void setUp() throws Exception {
         st = GenPhyOp.topStoreOp();
-        fSpec = new FileSpec("file:////tmp/storeTest.txt",
+        fSpec = new FileSpec("file:/tmp/storeTest.txt",
                       new FuncSpec(PigStorage.class.getName(), new String[]{":"}));
         st.setSFile(fSpec);
         pc = new PigContext();
diff --git a/test/org/apache/pig/test/Util.java b/test/org/apache/pig/test/Util.java
index 6352aca23..70cdc006a 100644
--- a/test/org/apache/pig/test/Util.java
+++ b/test/org/apache/pig/test/Util.java
@@ -219,4 +219,19 @@ public class Util {
 	    String replacement = quoteReplacement("\\\\");
 	    return str.replaceAll(regex, replacement);
 	}
+	
+	   /**
+     * Helper method to construct URI for local file system. For unix, it will
+     * put "file:" in the front of the path; For Windows, it will put "file:/" in 
+     * front of the path, and also call encodeEscape to replace "\" with "\\"
+     * 
+     * @param str absolute path (under cygwin, should be a windows style path)
+     * @return The resulting string
+     */
+    public static String generateURI(String path)
+    {
+        if (System.getProperty("os.name").toUpperCase().startsWith("WINDOWS"))
+            return "file:/"+encodeEscape(path);
+        return "file:"+path;
+    }
 }
