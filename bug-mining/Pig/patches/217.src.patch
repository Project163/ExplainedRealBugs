diff --git a/CHANGES.txt b/CHANGES.txt
index 8e79b005e..91652e237 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -40,6 +40,9 @@ OPTIMIZATIONS
 
 BUG FIXES
 
+    PIG-877: Push up filter does not account for added columns in foreach
+    (sms)
+
     PIG-883: udf import list does not send to the backend (daijy)
 
     PIG-881: Pig should ship load udfs to the backend (daijy)
diff --git a/src/org/apache/pig/impl/logicalLayer/optimizer/PushUpFilter.java b/src/org/apache/pig/impl/logicalLayer/optimizer/PushUpFilter.java
index fce10de7d..0d1b388e9 100644
--- a/src/org/apache/pig/impl/logicalLayer/optimizer/PushUpFilter.java
+++ b/src/org/apache/pig/impl/logicalLayer/optimizer/PushUpFilter.java
@@ -402,6 +402,10 @@ public class PushUpFilter extends LogicalTransformer {
         for (Integer input : predInputs) {
             List<ProjectionMap.Column> inputList = (List<ProjectionMap.Column>) mappedFields
                     .get(input);
+            // inputList is null -> the required field is added
+            if(inputList == null) {
+                return new Pair<Boolean, Set<Integer>>(false, null);
+            }
             for (ProjectionMap.Column column : inputList) {
                 // TODO
                 // Check if the column has a cast
diff --git a/test/org/apache/pig/test/TestPushUpFilter.java b/test/org/apache/pig/test/TestPushUpFilter.java
index 2cbdc8114..040b36b64 100644
--- a/test/org/apache/pig/test/TestPushUpFilter.java
+++ b/test/org/apache/pig/test/TestPushUpFilter.java
@@ -276,6 +276,24 @@ public class TestPushUpFilter extends junit.framework.TestCase {
         assertEquals(filter, lp.getPredecessors(foreach).get(0));
         
     }
+    
+    @Test
+    public void testFilterForeachAddedField() throws Exception {
+        planTester.buildPlan("A = load 'myfile' as (name, age, gpa);");
+        planTester.buildPlan("B = foreach A generate $1, $2, COUNT({(1)});");        
+        LogicalPlan lp = planTester.buildPlan("C = filter B by $2 < 18;");
+        
+        planTester.setPlan(lp);
+        planTester.setProjectionMap(lp);
+        
+        PushUpFilter pushUpFilter = new PushUpFilter(lp);
+        
+        assertTrue(!pushUpFilter.check(lp.getLeaves()));
+        assertTrue(pushUpFilter.getSwap() == false);
+        assertTrue(pushUpFilter.getPushBefore() == false);
+        assertTrue(pushUpFilter.getPushBeforeInput() == -1);
+        
+    }
 
     @Test
     public void testFilterForeachCast() throws Exception {
