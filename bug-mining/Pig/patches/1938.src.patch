diff --git a/CHANGES.txt b/CHANGES.txt
index 2a3683d58..c8d1947c3 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -101,6 +101,8 @@ OPTIMIZATIONS
 Â 
 BUG FIXES
 
+PIG-5235: Typecast with as-clause fails for tuple/bag with an empty schema (knoguchi)
+
 PIG-5238: Fix datetime related test issues after PIG-4748 (szita)
 
 PIG-5185: Job name show "DefaultJobName" when running a Python script (daijy)
diff --git a/src/org/apache/pig/newplan/logical/relational/LOGenerate.java b/src/org/apache/pig/newplan/logical/relational/LOGenerate.java
index 2af71bcf1..2609c2dfe 100644
--- a/src/org/apache/pig/newplan/logical/relational/LOGenerate.java
+++ b/src/org/apache/pig/newplan/logical/relational/LOGenerate.java
@@ -168,10 +168,8 @@ public class LOGenerate extends LogicalRelationalOperator {
                     mergedSchema.mergeUid(expSchema);
 
                 }
+                setNullTypeToByteArrayType(mergedSchema);
                 for (LogicalFieldSchema fs : mergedSchema.getFields()) {
-                    if (fs.type==DataType.NULL) {
-                        fs.type = DataType.BYTEARRAY;
-                    }
                     planSchema.addField(fs);
                 }
             } else {
@@ -323,4 +321,16 @@ public class LOGenerate extends LogicalRelationalOperator {
     public List<LogicalSchema> getExpSchemas() {
         return expSchemas;
     }
+
+    private void setNullTypeToByteArrayType (LogicalSchema s1) {
+        if( s1 != null ) {
+            for (LogicalFieldSchema fs : s1.getFields()) {
+                if( DataType.isSchemaType(fs.type) ) {
+                    setNullTypeToByteArrayType(fs.schema);
+                } else if(fs.type == DataType.NULL) {
+                    fs.type = DataType.BYTEARRAY;
+                }
+            }
+        }
+    }
 }
diff --git a/src/org/apache/pig/newplan/logical/relational/LogicalSchema.java b/src/org/apache/pig/newplan/logical/relational/LogicalSchema.java
index abc309206..077c5e396 100644
--- a/src/org/apache/pig/newplan/logical/relational/LogicalSchema.java
+++ b/src/org/apache/pig/newplan/logical/relational/LogicalSchema.java
@@ -168,7 +168,7 @@ public class LogicalSchema {
                 if (s1==null && s2==null) {
                     return true;
                 }
-                if (fs1==null || fs2==null) {
+                if (s1==null || s2==null) {
                     return false;
                 }
                 if (s1.size()!=s2.size()) {
diff --git a/src/org/apache/pig/newplan/logical/visitor/ForEachUserSchemaVisitor.java b/src/org/apache/pig/newplan/logical/visitor/ForEachUserSchemaVisitor.java
index c387de10c..ee6c4c5ea 100644
--- a/src/org/apache/pig/newplan/logical/visitor/ForEachUserSchemaVisitor.java
+++ b/src/org/apache/pig/newplan/logical/visitor/ForEachUserSchemaVisitor.java
@@ -217,6 +217,10 @@ public class ForEachUserSchemaVisitor extends LogicalRelationalNodesVisitor {
             for( LogicalSchema mUserDefinedSchema : mUserDefinedSchemas ) {
                 resetTypeToNull( mUserDefinedSchema );
             }
+
+            // Given mUserDefinedSchema was changed, we should drop the cached schema
+            foreach.resetSchema();
+            generate.resetSchema();
         }
     }
 
diff --git a/test/org/apache/pig/test/TestPlanGeneration.java b/test/org/apache/pig/test/TestPlanGeneration.java
index 745e7a340..8a150c769 100644
--- a/test/org/apache/pig/test/TestPlanGeneration.java
+++ b/test/org/apache/pig/test/TestPlanGeneration.java
@@ -535,4 +535,45 @@ public class TestPlanGeneration {
             Assert.assertEquals(expectedRes[i], list.get(i).toString());
         }
     }
+
+    @Test
+    public void testAsWithTypeTuple() throws Exception {
+        Data data = Storage.resetData(ps);
+        data.set("input_testAsWithTypeTuple", "t1:tuple(), f2:chararray",
+                 tuple(tuple(1.1,1.2), "a"), tuple(tuple(2.8, 3.1), "b"));
+
+        String query =
+            "A = load 'input_testAsWithTypeTuple' USING mock.Storage(); \n"
+            + "B = FOREACH A GENERATE t1 as (newt1:tuple(f1_1:int, f1_2:double));\n"
+            + "store B into 'out' using mock.Storage;" ;
+
+        Util.registerMultiLineQuery(ps, query);
+        List<Tuple> list = data.get("out");
+        // making sure typecast from double to int worked.
+        // first field is 1 instead of 1.1, and 2 instead of 2.8.
+        List<Tuple> expectedRes =
+                Util.getTuplesFromConstantTupleStrings(
+                        new String[] {"((1,1.2))", "((2,3.1))"});
+        Util.checkQueryOutputsAfterSort(list, expectedRes);
+    }
+
+    @Test
+    public void testAsWithTypeBag() throws Exception {
+        Data data = Storage.resetData(ps);
+        data.set("input_testAsWithTypeBag", "b1:bag{}, f2:chararray",
+                 tuple(bag(tuple(1.1),tuple(1.2)), "a"), tuple(bag(tuple(2.8), tuple(3.1)), "b"));
+
+        String query =
+            "A = load 'input_testAsWithTypeBag' USING mock.Storage(); \n"
+            + "B = FOREACH A GENERATE b1 as (newbag:bag{tuple(f1:int)}); \n"
+            + "store B into 'out' using mock.Storage;" ;
+
+        Util.registerMultiLineQuery(ps, query);
+        List<Tuple> list = data.get("out");
+        // making sure typecast from double to int worked.
+        List<Tuple> expectedRes =
+                Util.getTuplesFromConstantTupleStrings(
+                        new String[] {"({(1),(1)})","({(2),(3)})"});
+        Util.checkQueryOutputsAfterSort(list, expectedRes);
+    }
 }
diff --git a/test/org/apache/pig/test/TestProjectStarRangeInUdf.java b/test/org/apache/pig/test/TestProjectStarRangeInUdf.java
index e46686fb4..405135f8f 100644
--- a/test/org/apache/pig/test/TestProjectStarRangeInUdf.java
+++ b/test/org/apache/pig/test/TestProjectStarRangeInUdf.java
@@ -301,7 +301,7 @@ public class TestProjectStarRangeInUdf  {
             ; 
         Schema sch = Utils.getSchemaFromString("tt : {(NullALias)}");
         sch.getField(0).schema.getField(0).schema.getField(0).alias = null;
-        sch.getField(0).schema.getField(0).schema.getField(0).type = DataType.NULL;
+        sch.getField(0).schema.getField(0).schema.getField(0).type = DataType.BYTEARRAY;
         
         compileAndCompareSchema(sch, query, "f");
         Iterator<Tuple> it = pigServer.openIterator("f");
