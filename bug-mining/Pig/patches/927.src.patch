diff --git a/CHANGES.txt b/CHANGES.txt
index acd121771..9ce64e408 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -279,6 +279,8 @@ PIG-2228: support partial aggregation in map task (thejas)
 
 BUG FIXES
 
+PIG-2563: IndexOutOfBoundsException: while projecting fields from a bag (daijy)
+
 PIG-2411: AvroStorage UDF in PiggyBank fails to STORE a bag of single-field tuples as Avro arrays (russell.jurney via daijy)
 
 PIG-2565: Support IMPORT for macros stored in S3 Buckets (daijy)
diff --git a/src/org/apache/pig/newplan/logical/expression/ProjectExpression.java b/src/org/apache/pig/newplan/logical/expression/ProjectExpression.java
index 16687eccc..88e1fc460 100644
--- a/src/org/apache/pig/newplan/logical/expression/ProjectExpression.java
+++ b/src/org/apache/pig/newplan/logical/expression/ProjectExpression.java
@@ -24,6 +24,7 @@ import org.apache.pig.PigException;
 import org.apache.pig.data.DataType;
 import org.apache.pig.impl.logicalLayer.FrontendException;
 import org.apache.pig.impl.plan.PlanValidationException;
+import org.apache.pig.impl.util.Pair;
 import org.apache.pig.newplan.Operator;
 import org.apache.pig.newplan.OperatorPlan;
 import org.apache.pig.newplan.PlanVisitor;
@@ -273,7 +274,10 @@ public class ProjectExpression extends ColumnExpression {
             if (!(findReferent() instanceof LOInnerLoad)||
                     ((LOInnerLoad)findReferent()).sourceIsBag()) {
                 String alias = findReferent().getAlias();
-                List<LOInnerLoad> innerLoads = LOForEach.findReacheableInnerLoadFromBoundaryProject(this);
+
+                Pair<List<LOInnerLoad>, Boolean> innerLoadsPair = LOForEach.findReacheableInnerLoadFromBoundaryProject(this);
+                List<LOInnerLoad> innerLoads = innerLoadsPair.first;
+                boolean needNewUid = innerLoadsPair.second;
                 
                 // pull tuple information from innerload
                 if (innerLoads.get(0).getProjection().getFieldSchema().schema!=null &&
@@ -281,7 +285,12 @@ public class ProjectExpression extends ColumnExpression {
                     LogicalFieldSchema originalTupleFieldSchema = innerLoads.get(0).getProjection().getFieldSchema().schema.getField(0);
                     LogicalFieldSchema newTupleFieldSchema = new LogicalFieldSchema(originalTupleFieldSchema.alias,
                             schema, DataType.TUPLE);
-                    newTupleFieldSchema.uid = originalTupleFieldSchema.uid;
+                    if (needNewUid) {
+                        newTupleFieldSchema.uid = LogicalExpression.getNextUid();
+                    }
+                    else {
+                        newTupleFieldSchema.uid = originalTupleFieldSchema.uid;
+                    }
                     LogicalSchema newTupleSchema = new LogicalSchema();
                     newTupleSchema.addField(newTupleFieldSchema);
                     fieldSchema = new LogicalSchema.LogicalFieldSchema(alias, newTupleSchema, DataType.BAG);
@@ -289,7 +298,10 @@ public class ProjectExpression extends ColumnExpression {
                 else {
                     fieldSchema = new LogicalSchema.LogicalFieldSchema(alias, schema, DataType.BAG);
                 }
-                fieldSchema.uid = innerLoads.get(0).getProjection().getFieldSchema().uid;
+                if (needNewUid)
+                    fieldSchema.uid = LogicalExpression.getNextUid();
+                else
+                    fieldSchema.uid = innerLoads.get(0).getProjection().getFieldSchema().uid;
             }
             else {
                 // InnerLoad and source is not bag
diff --git a/src/org/apache/pig/newplan/logical/relational/LOForEach.java b/src/org/apache/pig/newplan/logical/relational/LOForEach.java
index 8c6b55c4e..1137b190a 100644
--- a/src/org/apache/pig/newplan/logical/relational/LOForEach.java
+++ b/src/org/apache/pig/newplan/logical/relational/LOForEach.java
@@ -22,6 +22,7 @@ import java.util.List;
 import java.util.Stack;
 
 import org.apache.pig.impl.logicalLayer.FrontendException;
+import org.apache.pig.impl.util.Pair;
 import org.apache.pig.newplan.Operator;
 import org.apache.pig.newplan.OperatorPlan;
 import org.apache.pig.newplan.PlanVisitor;
@@ -74,8 +75,14 @@ public class LOForEach extends LogicalRelationalOperator {
         ((LogicalRelationalNodesVisitor)v).visit(this);
     }
     
-    public static List<LOInnerLoad> findReacheableInnerLoadFromBoundaryProject(ProjectExpression project) throws FrontendException {
+    // Find the LOInnerLoad of the inner plan corresponding to the project, and 
+    // also find whether there is a LOForEach in inner plan along the way
+    public static Pair<List<LOInnerLoad>, Boolean> findReacheableInnerLoadFromBoundaryProject(ProjectExpression project) throws FrontendException {
+        boolean needNewUid = false;
         LogicalRelationalOperator referred = project.findReferent();
+        // If it is nested foreach, generate new uid
+        if (referred instanceof LOForEach)
+            needNewUid = true;
         List<Operator> srcs = referred.getPlan().getSources();
         List<LOInnerLoad> innerLoads = new ArrayList<LOInnerLoad>();
         for (Operator src:srcs) {
@@ -85,7 +92,7 @@ public class LOForEach extends LogicalRelationalOperator {
             		continue;
             	}
             	
-                Stack<Operator> stack = new Stack<Operator>();
+            	Stack<Operator> stack = new Stack<Operator>();
                 List<Operator> succs = referred.getPlan().getSuccessors( src );
                 if( succs != null ) {
                 	for( Operator succ : succs ) {
@@ -110,7 +117,7 @@ public class LOForEach extends LogicalRelationalOperator {
                 }
             }
         }
-        return innerLoads;
+        return new Pair<List<LOInnerLoad>, Boolean>(innerLoads, needNewUid);
     }
     
     public LogicalSchema dumpNestedSchema(String alias, String nestedAlias) throws FrontendException {
diff --git a/src/org/apache/pig/newplan/logical/rules/ColumnPruneHelper.java b/src/org/apache/pig/newplan/logical/rules/ColumnPruneHelper.java
index cd15fbd42..369f5c268 100644
--- a/src/org/apache/pig/newplan/logical/rules/ColumnPruneHelper.java
+++ b/src/org/apache/pig/newplan/logical/rules/ColumnPruneHelper.java
@@ -478,7 +478,7 @@ public class ColumnPruneHelper {
                          List<Operator> srcs = exp.getSinks();
                          for (Operator src : srcs) {
                              if (src instanceof ProjectExpression) {
-                                 List<LOInnerLoad> innerLoads = LOForEach.findReacheableInnerLoadFromBoundaryProject((ProjectExpression)src);
+                                 List<LOInnerLoad> innerLoads = LOForEach.findReacheableInnerLoadFromBoundaryProject((ProjectExpression)src).first;
                                  for (LOInnerLoad innerLoad : innerLoads) {
                                      ProjectExpression prj = innerLoad.getProjection();
                                      if (prj.isProjectStar()) {
@@ -514,7 +514,7 @@ public class ColumnPruneHelper {
                  for (Operator src : srcs) {
                      if (!(src instanceof ProjectExpression))
                          continue;
-                     List<LOInnerLoad> innerLoads = LOForEach.findReacheableInnerLoadFromBoundaryProject((ProjectExpression)src);
+                     List<LOInnerLoad> innerLoads = LOForEach.findReacheableInnerLoadFromBoundaryProject((ProjectExpression)src).first;
                      for (LOInnerLoad innerLoad : innerLoads) {
                          ProjectExpression prj = innerLoad.getProjection();
                          if (prj.isProjectStar()) {
diff --git a/test/org/apache/pig/test/TestNestedForeach.java b/test/org/apache/pig/test/TestNestedForeach.java
index 61a6cc5d1..352b3eb9c 100644
--- a/test/org/apache/pig/test/TestNestedForeach.java
+++ b/test/org/apache/pig/test/TestNestedForeach.java
@@ -181,4 +181,26 @@ public class TestNestedForeach {
 		t = iter.next();
 		Assert.assertTrue(t.toString().equals("({(7)})"));
 	}
+	
+	// See PIG-2563
+	@Test
+    public void testNestedForeach() throws Exception {
+        String[] input = {
+                "1\t2\t3",
+                "2\t5\t2"
+        };
+
+        Util.createInputFile(cluster, "table_nf_project", input);
+
+        pig.registerQuery("A = load 'table_nf_project' as (a,b,c:chararray);");
+        pig.registerQuery("B = GROUP A BY a;");
+        pig.registerQuery("C = foreach B {tmp = A.a;generate A, tmp; };");
+        pig.registerQuery("D = foreach C generate A.(a,b) as v;");
+        Iterator<Tuple> iter = pig.openIterator("D");
+        Tuple t = iter.next();
+        Assert.assertTrue(t.toString().equals("({(1,2)})"));
+
+        t = iter.next();
+        Assert.assertTrue(t.toString().equals("({(2,5)})"));
+    }
 }
