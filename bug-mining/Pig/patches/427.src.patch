diff --git a/CHANGES.txt b/CHANGES.txt
index af982d168..9efc8fa87 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -225,6 +225,8 @@ OPTIMIZATIONS
 
 BUG FIXES
 
+PIG-1374: PushDownForeachFlatten shall not push ForEach below Join if the flattened fields is used in the next statement (daijy)
+
 PIG-1336: Optimize POStore serialized into JobConf (daijy)
 
 PIG-1335: UDFFinder should find LoadFunc used by POCast (daijy)
diff --git a/src/org/apache/pig/impl/logicalLayer/optimizer/PushDownForeachFlatten.java b/src/org/apache/pig/impl/logicalLayer/optimizer/PushDownForeachFlatten.java
index 29cf92768..fb895e232 100644
--- a/src/org/apache/pig/impl/logicalLayer/optimizer/PushDownForeachFlatten.java
+++ b/src/org/apache/pig/impl/logicalLayer/optimizer/PushDownForeachFlatten.java
@@ -35,6 +35,7 @@ import org.apache.pig.impl.logicalLayer.LOProject;
 import org.apache.pig.impl.logicalLayer.LOSort;
 import org.apache.pig.impl.logicalLayer.LogicalOperator;
 import org.apache.pig.impl.logicalLayer.LogicalPlan;
+import org.apache.pig.impl.logicalLayer.RelationalOperator;
 import org.apache.pig.impl.logicalLayer.UDFFinder;
 import org.apache.pig.impl.logicalLayer.schema.Schema;
 import org.apache.pig.impl.plan.DepthFirstWalker;
@@ -181,6 +182,23 @@ public class PushDownForeachFlatten extends LogicalTransformer {
             IndexHelper<LogicalOperator> indexHelper = new IndexHelper<LogicalOperator>(peers);
             Integer foreachPosition = indexHelper.getIndex(foreach);
             
+            // Check if flattened fields is required by successor, if so, don't optimize
+            List<RequiredFields> requiredFieldsList = ((RelationalOperator)successor).getRequiredFields();
+            RequiredFields requiredFields = requiredFieldsList.get(foreachPosition.intValue());
+            
+            MultiMap<Integer, Column> foreachMappedFields = foreachProjectionMap.getMappedFields();
+            
+            if (requiredFields.getFields()!=null) {
+                for (Pair<Integer, Integer> pair : requiredFields.getFields()) {
+                    Collection<Column> columns = foreachMappedFields.get(pair.second);
+                    for (Column column : columns) {
+                        Pair<Integer, Integer> foreachInputColumn = column.getInputColumn();
+                        if (foreach.isInputFlattened(foreachInputColumn.second))
+                            return false;
+                    }
+                }
+            }
+            
             // the foreach with flatten can be swapped with an order by
             // as the order by will have lesser number of records to sort
             // also the sort does not alter the records that are processed
@@ -285,23 +303,6 @@ public class PushDownForeachFlatten extends LogicalTransformer {
                     }
                 }
                 
-                // Check if flattened fields is required by LOJoin, if so, don't optimize
-                if (successor instanceof LOJoin) {
-                    List<RequiredFields> requiredFieldsList = ((LOJoin)successor).getRequiredFields();
-                    RequiredFields requiredFields = requiredFieldsList.get(foreachPosition.intValue());
-                    
-                    MultiMap<Integer, Column> foreachMappedFields = foreachProjectionMap.getMappedFields();
-                    
-                    for (Pair<Integer, Integer> pair : requiredFields.getFields()) {
-                        Collection<Column> columns = foreachMappedFields.get(pair.second);
-                        for (Column column : columns) {
-                            Pair<Integer, Integer> foreachInputColumn = column.getInputColumn();
-                            if (foreach.isInputFlattened(foreachInputColumn.second))
-                                return false;
-                        }
-                    }
-                }
-                
                 mInsertBetween = true;
                 return true;
             }
diff --git a/test/org/apache/pig/test/TestPushDownForeachFlatten.java b/test/org/apache/pig/test/TestPushDownForeachFlatten.java
index 19c6a717d..ad713336a 100644
--- a/test/org/apache/pig/test/TestPushDownForeachFlatten.java
+++ b/test/org/apache/pig/test/TestPushDownForeachFlatten.java
@@ -1002,6 +1002,25 @@ public class TestPushDownForeachFlatten extends junit.framework.TestCase {
         assertTrue(pushDownForeach.getSwap() == false);
         assertTrue(pushDownForeach.getInsertBetween() == false);
     }
+    
+    // See PIG-1374
+    @Test
+    public void testForeachRequiredField() throws Exception {
+        planTester.buildPlan("A = load 'myfile' as (b{t(a0:chararray,a1:int)});");
+        planTester.buildPlan("B = foreach A generate flatten($0);");
+        LogicalPlan lp = planTester.buildPlan("C = order B by $1 desc;");
+        
+        planTester.setPlan(lp);
+        planTester.setProjectionMap(lp);
+        planTester.rebuildSchema(lp);
+        
+        PushDownForeachFlatten pushDownForeach = new PushDownForeachFlatten(lp);
 
+        LOLoad loada = (LOLoad) lp.getRoots().get(0);
+        
+        assertTrue(!pushDownForeach.check(lp.getSuccessors(loada)));
+        assertTrue(pushDownForeach.getSwap() == false);
+        assertTrue(pushDownForeach.getInsertBetween() == false);
+    }
 }
 
