diff --git a/CHANGES.txt b/CHANGES.txt
index 4dedfa4d8..426977594 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -44,6 +44,8 @@ PIG-626: Add access to hadoop counters (shubhamc via gates).
 
 BUG FIXES
 
+PIG-804: problem with lineage with double map redirection (pradeepkth)
+
 PIG-733: Order by sampling dumps entire sample to hdfs which causes dfs
 "FileSystem closed" error on large input (pradeepkth)
 
diff --git a/src/org/apache/pig/impl/logicalLayer/parser/QueryParser.jjt b/src/org/apache/pig/impl/logicalLayer/parser/QueryParser.jjt
index bd60c6c15..7712f402c 100644
--- a/src/org/apache/pig/impl/logicalLayer/parser/QueryParser.jjt
+++ b/src/org/apache/pig/impl/logicalLayer/parser/QueryParser.jjt
@@ -2646,6 +2646,13 @@ ExpressionOperator CastExpr(Schema over, Map<String, LogicalOperator> specs,Logi
         if(castRequired) {
             cast = new LOCast(lp, new OperatorKey(scope, getNextId()), fs.type);
             fs.alias = exprOp.getFieldSchema().alias;
+            // unset the field schema computed above since it should
+            // be recomputed later from the TypeCheckingVisitor
+            // This is because operators might be added/removed
+            // from the plan which might affect the field schema. So
+            // the TypeCheckingVisitor would be right place to
+            // compute the field schema
+            exprOp.unsetFieldSchema();
             cast.setFieldSchema(fs);
             lp.add(cast);
 		    log.debug("Added operator " + cast.getClass().getName() + " " + cast + " to logical plan " + lp);
diff --git a/test/org/apache/pig/test/TestTypeCheckingValidator.java b/test/org/apache/pig/test/TestTypeCheckingValidator.java
index aa8a8ff8f..0f676830e 100644
--- a/test/org/apache/pig/test/TestTypeCheckingValidator.java
+++ b/test/org/apache/pig/test/TestTypeCheckingValidator.java
@@ -31,8 +31,10 @@ import org.apache.pig.impl.logicalLayer.validators.*;
 import org.apache.pig.impl.logicalLayer.* ;
 import org.apache.pig.impl.logicalLayer.schema.Schema;
 import org.apache.pig.impl.logicalLayer.schema.Schema.FieldSchema ;
+import org.apache.pig.impl.plan.DepthFirstWalker;
 import org.apache.pig.impl.plan.PlanValidationException;
 import org.apache.pig.impl.plan.CompilationMessageCollector;
+import org.apache.pig.impl.plan.VisitorException;
 import org.apache.pig.impl.util.MultiMap;
 import org.apache.pig.data.*;
 import org.apache.pig.impl.io.FileSpec;
@@ -5533,6 +5535,52 @@ public class TestTypeCheckingValidator extends TestCase {
 
     }
 
+    @Test
+    public void testMapLookupLineage3() throws Throwable {
+        planTester.buildPlan("a = load 'a' as (s, m, l);") ;
+        planTester.buildPlan("b = foreach a generate s#'src_spaceid' AS vspaceid, flatten(l#'viewinfo') as viewinfo ;") ;
+        LogicalPlan plan = planTester.buildPlan("c = foreach b generate (chararray)vspaceid#'foo', (chararray)viewinfo#'pos' as position;") ;
+
+        // validate
+        CompilationMessageCollector collector = new CompilationMessageCollector() ;
+        TypeCheckingValidator typeValidator = new TypeCheckingValidator() ;
+        typeValidator.validate(plan, collector) ;
+
+        printMessageCollector(collector) ;
+        printTypeGraph(plan) ;
+        planTester.printPlan(plan, TypeCheckingTestUtil.getCurrentMethodName());
+
+        if (collector.hasError()) {
+            throw new AssertionError("Expect no  error") ;
+        }
+
+        CastFinder cf = new CastFinder(plan);
+        cf.visit();
+        List<LOCast> casts = cf.casts;
+        for (LOCast cast : casts) {
+            assertTrue(cast.getLoadFuncSpec().getClassName().startsWith("org.apache.pig.builtin.PigStorage"));    
+        }
+    }
+    
+    class CastFinder extends LOVisitor {
+        List<LOCast> casts = new ArrayList<LOCast>();
+        /**
+         * 
+         */
+        public CastFinder(LogicalPlan lp) {
+            // TODO Auto-generated constructor stub
+            super(lp, new DepthFirstWalker<LogicalOperator, LogicalPlan>(lp));
+        }
+        
+        /* (non-Javadoc)
+         * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOCast)
+         */
+        @Override
+        protected void visit(LOCast cast) throws VisitorException {
+            casts.add(cast);
+        }
+    }
+    
     @Test
     public void testBincond() throws Throwable {
         planTester.buildPlan("a = load 'a' as (name: chararray, age: int, gpa: float);") ;
