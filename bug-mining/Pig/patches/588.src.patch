diff --git a/CHANGES.txt b/CHANGES.txt
index 5089b96c4..db660d798 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -220,6 +220,8 @@ PIG-1309: Map-side Cogroup (ashutoshc)
 
 BUG FIXES
 
+PIG-1725: New logical plan: uidOnlySchema bug in LOGenerate (daijy)
+
 PIG-1729: New logical plan: Dereference does not add into plan after deepCopy (daijy)
 
 PIG-1721: New logical plan: script fail when reuse foreach inner alias (daijy)
diff --git a/src/org/apache/pig/newplan/logical/relational/LOGenerate.java b/src/org/apache/pig/newplan/logical/relational/LOGenerate.java
index 3bc6f6ba5..1564a4a8a 100644
--- a/src/org/apache/pig/newplan/logical/relational/LOGenerate.java
+++ b/src/org/apache/pig/newplan/logical/relational/LOGenerate.java
@@ -167,7 +167,7 @@ public class LOGenerate extends LogicalRelationalOperator {
             
             // If the schema is generated by user defined schema, keep uid
             if (expSchema==null) {
-                LogicalSchema uidOnlySchema = schema.mergeUid(uidOnlySchemas.get(i));
+                LogicalSchema uidOnlySchema = planSchema.mergeUid(uidOnlySchemas.get(i));
                 uidOnlySchemas.set(i, uidOnlySchema);
             }
             outputPlanSchemas.add(planSchema);
diff --git a/src/org/apache/pig/newplan/logical/rules/ColumnPruneVisitor.java b/src/org/apache/pig/newplan/logical/rules/ColumnPruneVisitor.java
index a7e666720..919d5322c 100644
--- a/src/org/apache/pig/newplan/logical/rules/ColumnPruneVisitor.java
+++ b/src/org/apache/pig/newplan/logical/rules/ColumnPruneVisitor.java
@@ -344,6 +344,10 @@ public class ColumnPruneVisitor extends LogicalRelationalNodesVisitor {
         Set<Integer> inputsRemoved = new HashSet<Integer>();
         List<LogicalSchema> outputPlanSchemas = new ArrayList<LogicalSchema>();
         List<LogicalSchema> uidOnlySchemas = new ArrayList<LogicalSchema>();
+        List<LogicalSchema> userDefinedSchemas = null;
+        
+        if (gen.getUserDefinedSchema()!=null)
+            userDefinedSchemas = new ArrayList<LogicalSchema>();
         
         for (int i=0;i<genPlans.size();i++) {
             LogicalExpressionPlan genPlan = genPlans.get(i);
@@ -351,6 +355,9 @@ public class ColumnPruneVisitor extends LogicalRelationalNodesVisitor {
                 flattenList.add(gen.getFlattenFlags()[i]);
                 outputPlanSchemas.add(gen.getOutputPlanSchemas().get(i));
                 uidOnlySchemas.add(gen.getUidOnlySchemas().get(i));
+                if (gen.getUserDefinedSchema()!=null) {
+                    userDefinedSchemas.add(gen.getUserDefinedSchema().get(i));
+                }
                 List<Operator> sinks = genPlan.getSinks();
                 for(Operator s: sinks) {
                     if (s instanceof ProjectExpression) {
@@ -379,6 +386,7 @@ public class ColumnPruneVisitor extends LogicalRelationalNodesVisitor {
         gen.setFlattenFlags(flatten);
         gen.setOutputPlanSchemas(outputPlanSchemas);
         gen.setUidOnlySchemas(uidOnlySchemas);
+        gen.setUserDefinedSchema(userDefinedSchemas);
         
         for (LogicalExpressionPlan genPlanToRemove : genPlansToRemove) {
             genPlans.remove(genPlanToRemove);
diff --git a/test/org/apache/pig/test/TestEvalPipeline2.java b/test/org/apache/pig/test/TestEvalPipeline2.java
index 3d04db2b9..be369a716 100644
--- a/test/org/apache/pig/test/TestEvalPipeline2.java
+++ b/test/org/apache/pig/test/TestEvalPipeline2.java
@@ -870,4 +870,25 @@ public class TestEvalPipeline2 extends TestCase {
         
         assertFalse(iter.hasNext());
     }
+    
+    @Test
+    // See PIG-1725
+    public void testLOGenerateSchema() throws Exception{
+        String[] input1 = {
+                "1\t2\t{(1)}",
+        };
+        
+        Util.createInputFile(cluster, "table_testLOGenerateSchema", input1);
+        pigServer.registerQuery("a = load 'table_testLOGenerateSchema' as (a0:int, a1, a2:bag{});");
+        pigServer.registerQuery("b = foreach a generate a0 as b0, a1 as b1, flatten(a2) as b2:int;");
+        pigServer.registerQuery("c = filter b by b0==1;");
+        pigServer.registerQuery("d = foreach c generate b0+1, b2;");
+        
+        Iterator<Tuple> iter = pigServer.openIterator("d");
+        
+        Tuple t = iter.next();
+        assertTrue(t.toString().equals("(2,1)"));
+        
+        assertFalse(iter.hasNext());
+    }
 }
