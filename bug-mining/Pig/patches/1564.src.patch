diff --git a/CHANGES.txt b/CHANGES.txt
index 40b6110c1..55c14b449 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -70,6 +70,8 @@ OPTIMIZATIONS
  
 BUG FIXES
 
+PIG-4170: Multiquery with different type of key gives wrong result (daijy)
+
 PIG-4104: Accumulator UDF throws OOM in Tez (rohini)
 
 PIG-4169: NPE in ConstantCalculator (cheolsoo)
diff --git a/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/relationalOperators/MultiQueryPackager.java b/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/relationalOperators/MultiQueryPackager.java
index 622f2aa8d..e46fa57ab 100644
--- a/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/relationalOperators/MultiQueryPackager.java
+++ b/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/relationalOperators/MultiQueryPackager.java
@@ -242,9 +242,15 @@ public class MultiQueryPackager extends Packager {
 
     @Override
     public Tuple getValueTuple(PigNullableWritable keyWritable,
-            NullableTuple ntup, int index) throws ExecException {
+            NullableTuple ntup, int origIndex) throws ExecException {
         this.keyWritable = keyWritable;
-        return packagers.get(((int) index) & idxPart).getValueTuple(
-                keyWritable, ntup, index);
+        int index = origIndex & idxPart;
+        PigNullableWritable newKey = keyWritable;
+        if (!sameMapKeyType && !inCombiner && isKeyWrapped.get(index)) {                                       
+            Tuple tup = (Tuple)this.keyWritable.getValueAsPigType();
+            newKey = HDataType.getWritableComparableTypes(tup.get(0), packagers.get(index).getKeyType());
+            newKey.setIndex((byte)origIndex);
+        }
+        return packagers.get(index).getValueTuple(newKey, ntup, origIndex);
     }
 }
diff --git a/test/org/apache/pig/test/TestMultiQuery.java b/test/org/apache/pig/test/TestMultiQuery.java
index f9833523d..107496436 100644
--- a/test/org/apache/pig/test/TestMultiQuery.java
+++ b/test/org/apache/pig/test/TestMultiQuery.java
@@ -813,6 +813,32 @@ public class TestMultiQuery {
         }
     }
 
+    @Test
+    public void testMultiQueryJiraPig4170() throws Exception {
+
+        Storage.Data data = Storage.resetData(myPig);
+        data.set("inputLocation", Storage.tuple(1, "hello"), Storage.tuple(2, "world"));
+
+        myPig.setBatchOn();
+        myPig.registerQuery("A = load 'inputLocation' using mock.Storage() as (a:int, b:chararray);");
+        myPig.registerQuery("A1 = group A by a;");
+        myPig.registerQuery("A2 = group A by b;");
+        myPig.registerQuery("store A1 into 'output1' using mock.Storage();");
+        myPig.registerQuery("store A2 into 'output2' using mock.Storage();");
+
+        myPig.executeBatch();
+
+        myPig.registerQuery("A = load 'output1' using mock.Storage() as (a:int, c:bag{(i:int, s:chararray)});");
+        Iterator<Tuple> iter = myPig.openIterator("A");
+        iter.next().toString().equals("(1,{(1,hello)})");
+        iter.next().toString().equals("(2,{(2,world)})");
+
+        myPig.registerQuery("A = load 'output2' using mock.Storage() as (b:chararray, c:bag{(i:int, s:chararray)});");
+        iter = myPig.openIterator("A");
+        iter.next().toString().equals("(hello,{(1,hello)})");
+        iter.next().toString().equals("(world,{(2,world)})");
+    }
+
     // --------------------------------------------------------------------------
     // Helper methods
 
