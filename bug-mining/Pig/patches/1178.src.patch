diff --git a/CHANGES.txt b/CHANGES.txt
index e6ade9bcb..6fa4d2be8 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -154,6 +154,8 @@ PIG-3013: BinInterSedes improve chararray sort performance (rohini)
 
 BUG FIXES
 
+PIG-2265: Test case TestSecondarySort failure (daijy)
+
 PIG-3060: FLATTEN in nested foreach fails when the input contains an empty bag (daijy)
 
 PIG-2247: Pig parser does not detect multiple arguments with the same name passed to macro (dreambird via daijy)
diff --git a/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/MRCompiler.java b/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/MRCompiler.java
index eddffadd7..fd596d185 100644
--- a/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/MRCompiler.java
+++ b/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/MRCompiler.java
@@ -2396,7 +2396,7 @@ public class MRCompiler extends PhyPlanVisitor {
                 prj.setResultType(DataType.TUPLE);
                 ep.add(prj);
                 eps1.add(ep);
-                flat1.add(true);
+                flat1.add(false);
             } else {
                 for (Pair<POProject, Byte> sortProj : sortProjs) {
                     // Check for proj being null, null is used by getSortCols for a non POProject
@@ -2419,7 +2419,7 @@ public class MRCompiler extends PhyPlanVisitor {
                     }
                     ep.add(prj);
                     eps1.add(ep);
-                    flat1.add(true);
+                    flat1.add(false);
                 }
             }
         }else{
diff --git a/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/SecondaryKeyOptimizer.java b/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/SecondaryKeyOptimizer.java
index 50f26704b..1578630db 100644
--- a/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/SecondaryKeyOptimizer.java
+++ b/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/SecondaryKeyOptimizer.java
@@ -481,10 +481,10 @@ public class SecondaryKeyOptimizer extends MROpPlanVisitor {
                     sawInvalidPhysicalOper = processSort((POSort)currentNode);
                 else if (currentNode instanceof POProject)
                     sawInvalidPhysicalOper = processProject((POProject)currentNode);
-                else if (currentNode instanceof POForEach)
-                    sawInvalidPhysicalOper = processForEach((POForEach)currentNode);
                 else if (currentNode instanceof POUserFunc ||
-                         currentNode instanceof POUnion)
+                         currentNode instanceof POUnion ||
+                         // We don't process foreach, since foreach is too complex to get right
+                         currentNode instanceof POForEach)
                     break;
                 
                 if (sawInvalidPhysicalOper)
@@ -543,25 +543,6 @@ public class SecondaryKeyOptimizer extends MROpPlanVisitor {
             return false;
         }
 
-        // Accumulate column info from nested project
-        public boolean processForEach(POForEach fe) throws FrontendException {
-            if (fe.getInputPlans().size() > 1) {
-                // We don't optimize the case when POForEach has more than 1 input plan
-                return true;
-            }
-            boolean r = false;
-            try {
-                r = collectColumnChain(fe.getInputPlans().get(0),
-                        columnChainInfo);
-            } catch (PlanException e) {
-                int errorCode = 2205;
-                throw new FrontendException("Error visiting POForEach inner plan",
-                        errorCode, e);
-            }
-            // See something other than POProject in POForEach, set the flag to stop further processing
-            return r;
-        }
-
         // We see POSort, check which key it is using
         public boolean processSort(POSort sort) throws FrontendException{
             SortKeyInfo keyInfo = new SortKeyInfo();
diff --git a/test/org/apache/pig/test/TestSecondarySort.java b/test/org/apache/pig/test/TestSecondarySort.java
index 620318a51..b19a2b8b6 100644
--- a/test/org/apache/pig/test/TestSecondarySort.java
+++ b/test/org/apache/pig/test/TestSecondarySort.java
@@ -68,27 +68,8 @@ public class TestSecondarySort {
         pigServer = new PigServer(ExecType.MAPREDUCE, cluster.getProperties());
     }
 
-//    @Test // Currently failing due to PIG-2009
-//    public void testDistinctOptimization1() throws Exception {
-//        // Limit in the foreach plan
-//        String query = ("A=LOAD 'input1' AS (a0, a1, a2);"+
-//        "B = LOAD 'input2' AS (b0, b1, b2);" +
-//        "C = cogroup A by a0, B by b0;" +
-//        "D = foreach C { E = limit A 10; F = E.a1; G = DISTINCT F; generate group, COUNT(G);};" +
-//        "store D into 'output';");
-//        PhysicalPlan pp = Util.buildPp(pigServer, query);
-//        MROperPlan mrPlan = Util.buildMRPlan(pp, pc);
-//
-//        SecondaryKeyOptimizer so = new SecondaryKeyOptimizer(mrPlan);
-//        so.visit();
-//
-//        assertEquals( 1, so.getNumMRUseSecondaryKey() );
-//        assertTrue(so.getNumSortRemoved() == 0);
-//        assertTrue(so.getDistinctChanged() == 1);
-//    }
-
     @Test
-    public void testDistinctOptimization2() throws Exception {
+    public void testDistinctOptimization1() throws Exception {
         // Distinct on one entire input
         String query = ("A=LOAD 'input1' AS (a0, a1, a2);"+
         "B = group A by $0;"+
@@ -106,139 +87,6 @@ public class TestSecondarySort {
         assertEquals(1, so.getDistinctChanged());
     }
 
-    @Test
-    public void testDistinctOptimization3() throws Exception {
-        // Distinct on the prefix of main sort key
-        String query = ("A=LOAD 'input1' AS (a0, a1, a2);"+
-        "B = group A by $0;"+
-        "C = foreach B { D = A.a0; E = distinct D; generate group, E;};"+
-
-        "store C into 'output';");
-        PhysicalPlan pp = Util.buildPp(pigServer, query);
-        MROperPlan mrPlan = Util.buildMRPlan(pp, pc);
-
-        SecondaryKeyOptimizer so = new SecondaryKeyOptimizer(mrPlan);
-        so.visit();
-
-        assertEquals(0, so.getNumMRUseSecondaryKey());
-        assertEquals(0, so.getNumSortRemoved());
-        assertEquals(1, so.getDistinctChanged());
-    }
-
-    @Test
-    public void testDistinctOptimization4() throws Exception {
-        // Distinct on secondary key again, should remove
-        String query = ("A=LOAD 'input1' AS (a0, a1, a2);"+
-        "B = group A by $0;"+
-        "C = foreach B { D = A.a1; E = distinct D; F = distinct E; generate group, F;};"+
-
-        "store C into 'output';");
-        PhysicalPlan pp = Util.buildPp(pigServer, query);
-        MROperPlan mrPlan = Util.buildMRPlan(pp, pc);
-
-        SecondaryKeyOptimizer so = new SecondaryKeyOptimizer(mrPlan);
-        so.visit();
-
-        assertEquals(1, so.getNumMRUseSecondaryKey());
-        assertEquals(0, so.getNumSortRemoved());
-        assertEquals(2, so.getDistinctChanged());
-    }
-
-    @Test
-    public void testDistinctOptimization5() throws Exception {
-        // Filter in foreach plan
-        String query = ("A=LOAD 'input1' AS (a0, a1, a2);" +
-        "B = group A by $0;" +
-        "C = foreach B { D = A.a1; E = distinct D; F = filter E by $0=='1'; generate group, F;};" +
-
-        "store C into 'output';");
-        PhysicalPlan pp = Util.buildPp(pigServer, query);
-        MROperPlan mrPlan = Util.buildMRPlan(pp, pc);
-
-        SecondaryKeyOptimizer so = new SecondaryKeyOptimizer(mrPlan);
-        so.visit();
-
-        assertTrue(so.getNumMRUseSecondaryKey() == 1);
-        assertTrue(so.getNumSortRemoved() == 0);
-        assertTrue(so.getDistinctChanged() == 1);
-    }
-
-    @Test
-    public void testDistinctOptimization6() throws Exception {
-        // group by * with no schema, and distinct key is not part of main key
-        String query = ("A=LOAD 'input1';" +
-        "B = group A by *;" +
-        "C = foreach B { D = limit A 10; E = D.$1; F = DISTINCT E; generate group, COUNT(F);};" +
-
-        "store C into 'output';");
-        PhysicalPlan pp = Util.buildPp(pigServer, query);
-        MROperPlan mrPlan = Util.buildMRPlan(pp, pc);
-
-        SecondaryKeyOptimizer so = new SecondaryKeyOptimizer(mrPlan);
-        so.visit();
-
-        assertEquals(1, so.getNumMRUseSecondaryKey());
-        assertEquals(0, so.getNumSortRemoved());
-        assertEquals(1, so.getDistinctChanged());
-    }
-
-    @Test
-    public void testDistinctOptimization7() throws Exception {
-        // group by * with no schema, distinct key is more specific than the main key
-        String query = ("A=LOAD 'input1';" +
-        "B = group A by *;" +
-        "C = foreach B { D = limit A 10; E = D.$0; F = DISTINCT E; generate group, COUNT(F);};" +
-
-        "store C into 'output';");
-        PhysicalPlan pp = Util.buildPp(pigServer, query);
-        MROperPlan mrPlan = Util.buildMRPlan(pp, pc);
-
-        SecondaryKeyOptimizer so = new SecondaryKeyOptimizer(mrPlan);
-        so.visit();
-
-        assertEquals(1, so.getNumMRUseSecondaryKey());
-        assertEquals(0, so.getNumSortRemoved());
-        assertEquals(1, so.getDistinctChanged());
-    }
-
-    @Test
-    public void testDistinctOptimization8() throws Exception {
-        // local arrange plan is an expression
-        String query = ("A=LOAD 'input1' AS (a0, a1, a2);" +
-        "B = group A by $0+$1;" +
-        "C = foreach B { D = limit A 10; E = D.$0; F = DISTINCT E; generate group, COUNT(F);};" +
-
-        "store C into 'output';");
-        PhysicalPlan pp = Util.buildPp(pigServer, query);
-        MROperPlan mrPlan = Util.buildMRPlan(pp, pc);
-
-        SecondaryKeyOptimizer so = new SecondaryKeyOptimizer(mrPlan);
-        so.visit();
-
-        assertEquals(1, so.getNumMRUseSecondaryKey());
-        assertEquals(0, so.getNumSortRemoved());
-        assertEquals(1, so.getDistinctChanged());
-    }
-
-    @Test
-    public void testDistinctOptimization9() throws Exception {
-        // local arrange plan is nested project
-        String query = ("A=LOAD 'input1' as (a:tuple(a0:int, a1:chararray));" +
-        "B = group A by a.a1;" +
-        "C = foreach B { D = A.a; E = DISTINCT D; generate group, COUNT(E);};" +
-
-        "store C into 'output';");
-        PhysicalPlan pp = Util.buildPp(pigServer, query);
-        MROperPlan mrPlan = Util.buildMRPlan(pp, pc);
-
-        SecondaryKeyOptimizer so = new SecondaryKeyOptimizer(mrPlan);
-        so.visit();
-
-        assertEquals(1, so.getNumMRUseSecondaryKey());
-        assertEquals(0, so.getNumSortRemoved());
-        assertEquals(1, so.getDistinctChanged());
-    }
-
     @Test
     public void testSortOptimization1() throws Exception {
         // Sort on something other than the main key
@@ -516,7 +364,7 @@ public class TestSecondarySort {
         Util.deleteFile(cluster, clusterPath);
     }
 
-//    @Test
+    @Test
     public void testNestedSortEndToEnd3() throws Exception {
         File tmpFile1 = Util.createTempFileDelOnExit("test", "txt");
         PrintStream ps1 = new PrintStream(new FileOutputStream(tmpFile1));
