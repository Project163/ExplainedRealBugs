diff --git a/CHANGES.txt b/CHANGES.txt
index f206c27f7..b3e44afb4 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -334,6 +334,8 @@ OPTIMIZATIONS
 
 BUG FIXES
 
+PIG-2968: ColumnMapKeyPrune fails to prune a subtree inside foreach (knoguchi via cheolsoo)
+
 PIG-2999: Regression after PIG-2975: BinInterSedesTupleRawComparator secondary sort failing (knoguchi via azaroth)
 
 PIG-2998: Fix TestScriptLanguage and TestMacroExpansion (cheolsoo via jcoveney)
diff --git a/src/org/apache/pig/newplan/logical/rules/ColumnPruneVisitor.java b/src/org/apache/pig/newplan/logical/rules/ColumnPruneVisitor.java
index 6ce8eef32..a45817341 100644
--- a/src/org/apache/pig/newplan/logical/rules/ColumnPruneVisitor.java
+++ b/src/org/apache/pig/newplan/logical/rules/ColumnPruneVisitor.java
@@ -448,7 +448,7 @@ public class ColumnPruneVisitor extends LogicalRelationalNodesVisitor {
         LogicalPlan p = (LogicalPlan)op.getPlan();
         List<Operator> ll = p.getPredecessors(op);
         if (ll != null) {
-            for(Operator pred: ll) {
+            for(Operator pred: ll.toArray(new Operator[ll.size()])) {
                 removeSubTree((LogicalRelationalOperator)pred);
             }
         }
diff --git a/test/org/apache/pig/test/TestNewPlanColumnPrune.java b/test/org/apache/pig/test/TestNewPlanColumnPrune.java
index bed006e15..c2d439173 100644
--- a/test/org/apache/pig/test/TestNewPlanColumnPrune.java
+++ b/test/org/apache/pig/test/TestNewPlanColumnPrune.java
@@ -390,7 +390,26 @@ public class TestNewPlanColumnPrune extends TestCase {
         
         assertTrue(expected.isEqual(newLogicalPlan));
     }
-    
+
+    public void testPruneSubTreeForEach() throws Exception  {
+        String query = "a =load 'd.txt' as (id, v1);" +
+            "b = group a by id;" +
+            "c = foreach b { d = a.v1; " +
+                          " e = distinct d; " +
+                          " generate group, e; };" +
+            "f = foreach c generate group ;" +
+            "store f into 'empty';";
+        LogicalPlan newLogicalPlan = buildPlan(query);
+        PlanOptimizer optimizer = new MyPlanOptimizer(newLogicalPlan, 3);
+        try {
+            optimizer.optimize();
+        } catch (Exception e) {
+            //PIG-2968 throws ConcurrentModificationException
+            e.printStackTrace();
+            fail("Unexpected Exception: " + e);
+        }
+    }
+
     public class MyPlanOptimizer extends LogicalPlanOptimizer {
 
         protected MyPlanOptimizer(OperatorPlan p,  int iterations) {
