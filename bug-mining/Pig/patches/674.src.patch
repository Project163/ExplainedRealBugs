diff --git a/CHANGES.txt b/CHANGES.txt
index 06186f03c..7897c7871 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -140,6 +140,8 @@ PIG-1696: Performance: Use System.arraycopy() instead of manually copying the by
 
 BUG FIXES
 
+PIG-1911: Infinite loop with accumulator function in nested foreach (thejas)
+
 PIG-1923: Jython UDFs fail to convert Maps of Integer values back to Pig types (julien)
 
 PIG-1944: register javascript UDFs does not work (julien)
diff --git a/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/expressionOperators/POUserFunc.java b/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/expressionOperators/POUserFunc.java
index 50c1d4b44..76ce4d2fc 100644
--- a/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/expressionOperators/POUserFunc.java
+++ b/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/expressionOperators/POUserFunc.java
@@ -65,6 +65,7 @@ public class POUserFunc extends ExpressionOperator {
     private MonitoredUDFExecutor executor = null;
 
     private PhysicalOperator referencedOperator = null;
+    private boolean isAccumulationDone;
 
     public PhysicalOperator getReferencedOperator() {
         return referencedOperator;
@@ -189,9 +190,24 @@ public class POUserFunc extends ExpressionOperator {
                         ((Accumulator)func).accumulate((Tuple)result.result);
                         result.returnStatus = POStatus.STATUS_BATCH_OK;
                         result.result = null;
+                        isAccumulationDone = false;
                     }else{
-                        result.result = ((Accumulator)func).getValue();
-                        ((Accumulator)func).cleanup();
+                        if(isAccumulationDone){
+                            //PORelationToExprProject does not return STATUS_EOP
+                            // so that udf gets called both when isAccumStarted
+                            // is first true and then set to false, even
+                            //when the input relation is empty.
+                            // so the STATUS_EOP has to be sent from POUserFunc, 
+                            // after the results have been sent.
+                            result.result = null;
+                            result.returnStatus = POStatus.STATUS_EOP;
+                        }
+                        else{
+                            result.result = ((Accumulator)func).getValue();
+                            result.returnStatus = POStatus.STATUS_OK;
+                            ((Accumulator)func).cleanup();
+                            isAccumulationDone = true;
+                        }
                     }
                 } else {
                     if (executor != null) {
diff --git a/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/relationalOperators/POForEach.java b/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/relationalOperators/POForEach.java
index 13f9032c4..e8df4312f 100644
--- a/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/relationalOperators/POForEach.java
+++ b/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/relationalOperators/POForEach.java
@@ -256,6 +256,7 @@ public class POForEach extends PhysicalOperator {
                     }
                 }
 
+                setAccumStart();
                 while(true) {
                     if (buffer.hasNextBatch()) {
                         try {
@@ -263,7 +264,6 @@ public class POForEach extends PhysicalOperator {
                         }catch(IOException e) {
                             throw new ExecException(e);
                         }
-                        setAccumStart();
                     }else{
                         inpTuple = ((POPackage.POPackageTupleBuffer) buffer).illustratorMarkup(null, inpTuple, 0);
  //                       buffer.clear();
diff --git a/test/org/apache/pig/test/TestAccumulator.java b/test/org/apache/pig/test/TestAccumulator.java
index 01e805e19..fb84f9121 100644
--- a/test/org/apache/pig/test/TestAccumulator.java
+++ b/test/org/apache/pig/test/TestAccumulator.java
@@ -20,12 +20,15 @@ package org.apache.pig.test;
 import java.io.*;
 import java.util.HashMap;
 import java.util.Iterator;
+import java.util.List;
+
 import junit.framework.TestCase;
 
 import org.apache.pig.ExecType;
 import org.apache.pig.PigServer;
 import org.apache.pig.backend.executionengine.ExecException;
 import org.apache.pig.data.Tuple;
+import org.apache.pig.impl.logicalLayer.parser.ParseException;
 import org.junit.After;
 import org.junit.AfterClass;
 import org.junit.Before;
@@ -613,5 +616,67 @@ public class TestAccumulator extends TestCase{
         }      
     }
     
+    /**
+     * see PIG-1911 . 
+     * accumulator udf reading from a nested relational op. generate projects
+     * only the accumulator udf.
+     * @throws IOException
+     * @throws ParseException
+     */
+    @Test
+    public void testAccumAfterNestedOp() throws IOException, ParseException{
+        // test group by
+        pigServer.registerQuery("A = load '" + INPUT_FILE + "' as (id:int, fruit);");
+        pigServer.registerQuery("B = group A by id;");
+        pigServer.registerQuery("C = foreach B " +
+                        "{ o = order A by id; " +
+                        "  generate org.apache.pig.test.utils.AccumulatorBagCount(o);}; ");                     
+                 
+        Iterator<Tuple> iter = pigServer.openIterator("C");
+        List<Tuple> expectedRes = 
+            Util.getTuplesFromConstantTupleStrings(
+                    new String[] {
+                            "(2)",
+                            "(1)",
+                            "(3)",
+                            "(1)"
+                    });
+        Util.checkQueryOutputsAfterSort(iter, expectedRes);
+    } 
+
+    /**
+     * see PIG-1911 . 
+     * accumulator udf reading from a nested relational op. generate projects
+     * only the accumulator udf. using co-group
+     * @throws IOException
+     * @throws ParseException
+     */
+    @Test
+    public void testAccumAfterNestedOpCoGroup() throws IOException, ParseException{
+        // test group by
+        pigServer.registerQuery("A = load '" + INPUT_FILE + "' as (id:int, fruit);");
+        pigServer.registerQuery("B = load '" + INPUT_FILE + "' as (id:int, fruit);");
+        pigServer.registerQuery("C = cogroup A by id, B by id;");
+        pigServer.registerQuery("D = foreach C " +
+                "{ OA = order A by fruit;" +
+                "  FB = filter B by fruit != 'strawberry'; " +
+                "  generate" +
+                "     org.apache.pig.test.utils.AccumulatorBagCount(OA)," +
+                "     org.apache.pig.test.utils.AccumulativeSumBag(FB.fruit);" +
+        "}; ");                     
+
+        Iterator<Tuple> iter = pigServer.openIterator("D");
+ 
+        List<Tuple> expectedRes = 
+            Util.getTuplesFromConstantTupleStrings(
+                    new String[] {
+                            "(2,'(apple)(apple)')",
+                            "(1,'(orange)')",
+                            "(3,'(pear)(pear)')",
+                            "(1,'(apple)')"
+                    });
+        Util.checkQueryOutputsAfterSort(iter, expectedRes);
+    }    
+    
 
 }
