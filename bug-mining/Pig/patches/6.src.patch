diff --git a/CHANGES.txt b/CHANGES.txt
index aae4f5749..5e7215a99 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -137,3 +137,5 @@ Trunk (unreleased changes)
     PIG-284: target for building source jar (oae via olgan)
 
     PIG-294: string comparator unit tests (sms via pi_song)
+
+    PIG-258: cleaning up directories on failure (daijy via olgan)
diff --git a/src/org/apache/pig/PigServer.java b/src/org/apache/pig/PigServer.java
index 57bf13e0c..bad1442a8 100644
--- a/src/org/apache/pig/PigServer.java
+++ b/src/org/apache/pig/PigServer.java
@@ -466,7 +466,11 @@ public class PigServer {
 //        typeCheckedLp.explain(System.out, System.err);
         PhysicalPlan pp = compilePp(typeCheckedLp);
         // execute using appropriate engine
-        return pigContext.getExecutionEngine().execute(pp, "execute");
+        FileLocalizer.clearDeleteOnFail();
+        ExecJob execJob = pigContext.getExecutionEngine().execute(pp, "execute");
+        if (execJob.getStatus()==ExecJob.JOB_STATUS.FAILED)
+            FileLocalizer.triggerDeleteOnFail();
+        return execJob;
     }
 
     private LogicalPlan compileLp(
diff --git a/src/org/apache/pig/impl/io/FileLocalizer.java b/src/org/apache/pig/impl/io/FileLocalizer.java
index 169179e5f..f2e51476c 100644
--- a/src/org/apache/pig/impl/io/FileLocalizer.java
+++ b/src/org/apache/pig/impl/io/FileLocalizer.java
@@ -303,6 +303,8 @@ public class FileLocalizer {
 
     static Stack<ElementDescriptor> toDelete    = 
         new Stack<ElementDescriptor>();
+    static Stack<ElementDescriptor> deleteOnFail    = 
+        new Stack<ElementDescriptor>();
     static Random      r           = new Random();
     static ContainerDescriptor relativeRoot;
     static boolean     initialized = false;
@@ -439,5 +441,34 @@ public class FileLocalizer {
     public static void setR(Random r) {
         FileLocalizer.r = r;
     }
-
+    
+    public static void clearDeleteOnFail()
+    {
+    	deleteOnFail.clear();
+    }
+    public static void registerDeleteOnFail(String filename, PigContext pigContext) throws IOException
+    {
+    	try {
+    		ElementDescriptor elem = pigContext.getDfs().asElement(filename);
+    		if (!toDelete.contains(elem))
+    		    deleteOnFail.push(elem);
+    	}
+        catch (DataStorageException e) {
+            log.warn("Unable to register output file to delete on failure: " + filename);
+        }
+    }
+    public static void triggerDeleteOnFail()
+    {
+    	ElementDescriptor elem = null;
+    	while (!deleteOnFail.empty()) {
+            try {
+                elem = deleteOnFail.pop();
+                if (elem.exists())
+                	elem.delete();
+            } 
+            catch (IOException e) {
+                log.warn("Unable to delete output file on failure: " + elem.toString());
+            }
+    	}
+    }
 }
diff --git a/src/org/apache/pig/impl/mapReduceLayer/MRCompiler.java b/src/org/apache/pig/impl/mapReduceLayer/MRCompiler.java
index 239aedb08..eb45b0591 100644
--- a/src/org/apache/pig/impl/mapReduceLayer/MRCompiler.java
+++ b/src/org/apache/pig/impl/mapReduceLayer/MRCompiler.java
@@ -180,6 +180,7 @@ public class MRCompiler extends PhyPlanVisitor {
     public MROperPlan compile() throws IOException, PlanException, VisitorException {
         List<PhysicalOperator> leaves = plan.getLeaves();
         POStore store = (POStore)leaves.get(0);
+        FileLocalizer.registerDeleteOnFail(store.getSFile().getFileName(), pigContext);
         compile(store);
         
         return MRPlan;
