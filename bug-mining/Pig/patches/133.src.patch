diff --git a/CHANGES.txt b/CHANGES.txt
index d12f2ee6a..a136ed85d 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -312,3 +312,5 @@ Trunk (unreleased changes)
     via olgan)
 
     PIG-525: make sure cast for udf parameters works (olgan)
+
+    PIG-512: Expressions in foreach lead to errors (sms via olgan)
diff --git a/src/org/apache/pig/impl/logicalLayer/BinaryExpressionOperator.java b/src/org/apache/pig/impl/logicalLayer/BinaryExpressionOperator.java
index 6184d5a00..89ec0fe4f 100644
--- a/src/org/apache/pig/impl/logicalLayer/BinaryExpressionOperator.java
+++ b/src/org/apache/pig/impl/logicalLayer/BinaryExpressionOperator.java
@@ -100,4 +100,15 @@ public abstract class BinaryExpressionOperator extends ExpressionOperator {
         return true;
     }
 
+    /**
+     * @see org.apache.pig.impl.logicalLayer.ExpressionOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        BinaryExpressionOperator binExOpClone = (BinaryExpressionOperator)super.clone();
+        return binExOpClone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/ExpressionOperator.java b/src/org/apache/pig/impl/logicalLayer/ExpressionOperator.java
index add8f3948..57b344c63 100644
--- a/src/org/apache/pig/impl/logicalLayer/ExpressionOperator.java
+++ b/src/org/apache/pig/impl/logicalLayer/ExpressionOperator.java
@@ -132,6 +132,18 @@ public abstract class ExpressionOperator extends LogicalOperator {
         }
     }
 
+    /**
+     * @see org.apache.pig.impl.plan.LogicalOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        ExpressionOperator exOpClone = (ExpressionOperator)super.clone();
+        if(mFieldSchema != null)
+            exOpClone.mFieldSchema = this.mFieldSchema.clone();
+        return exOpClone;
+    }
 
 }
 
diff --git a/src/org/apache/pig/impl/logicalLayer/LOBinCond.java b/src/org/apache/pig/impl/logicalLayer/LOBinCond.java
index 14298b8d6..f07579a81 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOBinCond.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOBinCond.java
@@ -72,6 +72,10 @@ public class LOBinCond extends ExpressionOperator {
         return mRhsOp;
     }
     
+    public void setCond(ExpressionOperator cond) {
+        mCond = cond;
+    }
+
     public void setLhsOp(ExpressionOperator op) {
         mLhsOp = op ;
     }
@@ -117,4 +121,15 @@ public class LOBinCond extends ExpressionOperator {
         return true;
     }
 
+    /**
+     * @see org.apache.pig.impl.logicalLayer.ExpressionOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LOBinCond clone = (LOBinCond)super.clone();
+        return clone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOCast.java b/src/org/apache/pig/impl/logicalLayer/LOCast.java
index 7cb2197fa..8af5cfc39 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOCast.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOCast.java
@@ -56,6 +56,10 @@ public class LOCast extends ExpressionOperator {
         return mExpr;
     }
 
+    public void setExpression(ExpressionOperator expr) {
+        mExpr = expr;
+    }
+
     @Override
     public void visit(LOVisitor v) throws VisitorException {
         v.visit(this);
@@ -93,4 +97,18 @@ public class LOCast extends ExpressionOperator {
         mLoadFuncSpec = loadFuncSpec;
     }
 
+    /**
+     * @see org.apache.pig.impl.logicalLayer.ExpressionOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LOCast clone = (LOCast)super.clone();
+        if(mLoadFuncSpec != null) {
+            clone.mLoadFuncSpec = mLoadFuncSpec.clone();
+        }
+        return clone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOCogroup.java b/src/org/apache/pig/impl/logicalLayer/LOCogroup.java
index 8d52d51cc..1701af760 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOCogroup.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOCogroup.java
@@ -24,6 +24,7 @@ import java.util.Map;
 import java.util.Set;
 import java.util.HashSet;
 import java.util.HashMap;
+import java.util.Iterator;
 
 import org.apache.pig.data.DataType;
 import org.apache.pig.impl.plan.OperatorKey;
@@ -79,6 +80,10 @@ public class LOCogroup extends LogicalOperator {
         return mGroupByPlans;
     }    
 
+    public void setGroupByPlans(MultiMap<LogicalOperator, LogicalPlan> groupByPlans) {
+        mGroupByPlans = groupByPlans;
+    }    
+
     public boolean[] getInner() {
         return mIsInner;
     }
@@ -473,4 +478,35 @@ public class LOCogroup extends LogicalOperator {
             fs.setParent(null, op);
         }
     }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LogicalOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        
+        // first start with LogicalOperator clone
+        LOCogroup  cogroupClone = (LOCogroup)super.clone();
+        
+        // create deep copy of other cogroup specific members
+        cogroupClone.mIsInner = new boolean[mIsInner.length];
+        for (int i = 0; i < mIsInner.length; i++) {
+            cogroupClone.mIsInner[i] = mIsInner[i];
+        }
+        
+        cogroupClone.mGroupByPlans = new MultiMap<LogicalOperator, LogicalPlan>();
+        for (Iterator<LogicalOperator> it = mGroupByPlans.keySet().iterator(); it.hasNext();) {
+            LogicalOperator relOp = it.next();
+            Collection<LogicalPlan> values = mGroupByPlans.get(relOp);
+            for (Iterator<LogicalPlan> planIterator = values.iterator(); planIterator.hasNext();) {
+                LogicalPlanCloneHelper lpCloneHelper = new LogicalPlanCloneHelper(planIterator.next());
+                cogroupClone.mGroupByPlans.put(relOp, lpCloneHelper.getClonedPlan());
+            }
+        }
+        
+        return cogroupClone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOConst.java b/src/org/apache/pig/impl/logicalLayer/LOConst.java
index 14d0e732c..dbfd3fdc0 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOConst.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOConst.java
@@ -92,4 +92,15 @@ public class LOConst extends ExpressionOperator {
         return true;
     }
 
+    /**
+     * @see org.apache.pig.impl.logicalLayer.ExpressionOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LOConst clone = (LOConst)super.clone();
+        return clone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LODistinct.java b/src/org/apache/pig/impl/logicalLayer/LODistinct.java
index e5e062e23..0c1984284 100644
--- a/src/org/apache/pig/impl/logicalLayer/LODistinct.java
+++ b/src/org/apache/pig/impl/logicalLayer/LODistinct.java
@@ -103,4 +103,16 @@ public class LODistinct extends LogicalOperator {
     public byte getType() {
         return DataType.BAG ;
     }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LogicalOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LODistinct distinctClone = (LODistinct)super.clone();
+        return distinctClone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOFilter.java b/src/org/apache/pig/impl/logicalLayer/LOFilter.java
index 399fe0c95..d24f6c186 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOFilter.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOFilter.java
@@ -112,5 +112,17 @@ public class LOFilter extends LogicalOperator {
         super.unsetSchema();
     }
 
+    /**
+     * @see org.apache.pig.impl.plan.Operator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LOFilter filterClone = (LOFilter)super.clone();
+        LogicalPlanCloneHelper lpCloner = new LogicalPlanCloneHelper(mComparisonPlan);
+        filterClone.mComparisonPlan = lpCloner.getClonedPlan();
+        return filterClone;
+    }
 
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOForEach.java b/src/org/apache/pig/impl/logicalLayer/LOForEach.java
index 6a3bd86be..844487c58 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOForEach.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOForEach.java
@@ -395,4 +395,40 @@ public class LOForEach extends LogicalOperator {
         super.unsetSchema();
     }
 
+    /**
+     * @see org.apache.pig.impl.plan.Operator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        // Do generic LogicalOperator cloning
+        LOForEach forEachClone = (LOForEach)super.clone();
+        
+        // create deep copies of attributes specific to foreach
+        if(mFlatten != null) {
+            forEachClone.mFlatten = new ArrayList<Boolean>();
+            for (Iterator<Boolean> it = mFlatten.iterator(); it.hasNext();) {
+                forEachClone.mFlatten.add(new Boolean(it.next()));
+            }
+        }
+        
+        if(mForEachPlans != null) {
+            forEachClone.mForEachPlans = new ArrayList<LogicalPlan>();
+            for (Iterator<LogicalPlan> it = mForEachPlans.iterator(); it.hasNext();) {
+                LogicalPlanCloneHelper lpCloneHelper = new LogicalPlanCloneHelper(it.next());
+                forEachClone.mForEachPlans.add(lpCloneHelper.getClonedPlan());
+            }
+        }
+        
+        if(mUserDefinedSchema != null) {
+            forEachClone.mUserDefinedSchema = new ArrayList<Schema>();
+            for (Iterator<Schema> it = mUserDefinedSchema.iterator(); it.hasNext();) {
+                Schema s = it.next();
+                forEachClone.mUserDefinedSchema.add(s != null ? s.clone() : null);
+            }
+        }
+        return forEachClone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOGenerate.java b/src/org/apache/pig/impl/logicalLayer/LOGenerate.java
index 0720cbcf7..18ddd3f40 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOGenerate.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOGenerate.java
@@ -151,4 +151,38 @@ public class LOGenerate extends LogicalOperator {
         v.visit(this);
     }
 
+    /* (non-Javadoc)
+     * @see org.apache.pig.impl.plan.Operator#clone()
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        // Do generic LogicalOperator cloning
+        LOGenerate generateClone = (LOGenerate)super.clone();
+        
+        // create deep copies of attributes specific to foreach
+        if(mFlatten != null) {
+            generateClone.mFlatten = new ArrayList<Boolean>();
+            for (Iterator<Boolean> it = mFlatten.iterator(); it.hasNext();) {
+                generateClone.mFlatten.add(new Boolean(it.next()));
+            }
+        }
+        
+        if(mGeneratePlans != null) {
+            generateClone.mGeneratePlans = new ArrayList<LogicalPlan>();
+            for (Iterator<LogicalPlan> it = mGeneratePlans.iterator(); it.hasNext();) {
+                LogicalPlanCloneHelper lpCloneHelper = new LogicalPlanCloneHelper(it.next());
+                generateClone.mGeneratePlans.add(lpCloneHelper.getClonedPlan());
+            }
+        }
+        
+        if(mUserDefinedSchema != null) {
+            generateClone.mUserDefinedSchema = new ArrayList<Schema>();
+            for (Iterator<Schema> it = mUserDefinedSchema.iterator(); it.hasNext();) {
+                Schema s = it.next();
+                generateClone.mUserDefinedSchema.add(s != null ? s.clone() : null);
+            }
+        }
+        return generateClone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOLimit.java b/src/org/apache/pig/impl/logicalLayer/LOLimit.java
index 6d49ed399..ce3a7700d 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOLimit.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOLimit.java
@@ -81,4 +81,15 @@ public class LOLimit extends LogicalOperator {
     {
     	return new LOLimit(mPlan, OperatorKey.genOpKey(mKey.scope), mLimit);
     }
+
+    /**
+     * @see org.apache.pig.impl.plan.Operator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LOLimit limitClone = (LOLimit)super.clone();
+        return limitClone;
+    }
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOMapLookup.java b/src/org/apache/pig/impl/logicalLayer/LOMapLookup.java
index f7fa20288..6af6ff86e 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOMapLookup.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOMapLookup.java
@@ -77,6 +77,10 @@ public class LOMapLookup extends ExpressionOperator {
         return mMap;
     }
 
+    public void setMap(ExpressionOperator map) {
+        mMap = map;
+    }
+
     public Object getLookUpKey() {
         return mMapKey;
     }
@@ -120,4 +124,21 @@ public class LOMapLookup extends ExpressionOperator {
         v.visit(this);
     }
 
+    /**
+     * @see org.apache.pig.impl.logicalLayer.ExpressionOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LOMapLookup clone = (LOMapLookup)super.clone();
+        
+        // deep copy project specific attributes
+        if(mValueSchema != null) {
+            clone.mValueSchema = mValueSchema.clone();
+        }
+
+        return clone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOProject.java b/src/org/apache/pig/impl/logicalLayer/LOProject.java
index 780ed7002..4e960e314 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOProject.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOProject.java
@@ -20,6 +20,7 @@ package org.apache.pig.impl.logicalLayer;
 import java.io.IOException;
 import java.util.ArrayList;
 import java.util.List;
+import java.util.Iterator;
 
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
@@ -407,4 +408,22 @@ public class LOProject extends ExpressionOperator {
         return sb.toString() ;
     }
 
+    /**
+     * @see org.apache.pig.impl.logicalLayer.ExpressionOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LOProject clone = (LOProject)super.clone();
+        
+        // deep copy project specific attributes
+        clone.mProjection = new ArrayList<Integer>();
+        for (Iterator<Integer> it = mProjection.iterator(); it.hasNext();) {
+            clone.mProjection.add(new Integer(it.next()));
+        }
+        
+        return clone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOSort.java b/src/org/apache/pig/impl/logicalLayer/LOSort.java
index 155d67d48..24e5c0e6c 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOSort.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOSort.java
@@ -21,6 +21,7 @@ import java.util.ArrayList;
 import java.util.Collection;
 import java.util.List;
 import java.util.Map;
+import java.util.Iterator;
 
 import org.apache.pig.FuncSpec;
 import org.apache.pig.impl.logicalLayer.FrontendException;
@@ -169,4 +170,35 @@ public class LOSort extends LogicalOperator {
     public byte getType() {
         return DataType.BAG ;
     }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LogicalOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LOSort clone = (LOSort) super.clone();
+        
+        // deep copy sort related attributes
+        if(mAscCols != null) {
+            clone.mAscCols = new ArrayList<Boolean>();
+            for (Iterator<Boolean> it = mAscCols.iterator(); it.hasNext();) {
+                clone.mAscCols.add(new Boolean(it.next()));
+            }
+        }
+        
+        if(mSortFunc != null)
+            clone.mSortFunc = mSortFunc.clone();
+        
+        if(mSortColPlans != null) {
+            clone.mSortColPlans = new ArrayList<LogicalPlan>();
+            for (Iterator<LogicalPlan> it = mSortColPlans.iterator(); it.hasNext();) {
+                LogicalPlanCloneHelper lpCloneHelper = new LogicalPlanCloneHelper(it.next());
+                clone.mSortColPlans.add(lpCloneHelper.getClonedPlan());            
+            }
+        }
+        return clone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOSplit.java b/src/org/apache/pig/impl/logicalLayer/LOSplit.java
index e3ba6e850..6b2b9b543 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOSplit.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOSplit.java
@@ -56,6 +56,10 @@ public class LOSplit extends LogicalOperator {
         return mOutputs;
     }
 
+    public void setOutputs(ArrayList<LogicalOperator> outputs) {
+        mOutputs = outputs;
+    }
+
     public void addOutput(LogicalOperator lOp) {
         mOutputs.add(lOp);
     }
@@ -105,4 +109,14 @@ public class LOSplit extends LogicalOperator {
         return DataType.BAG;
     }
     
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LogicalOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LOSplit splitClone = (LOSplit)super.clone();
+        return splitClone;
+    }
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOSplitOutput.java b/src/org/apache/pig/impl/logicalLayer/LOSplitOutput.java
index 563e2482d..ae21afa5f 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOSplitOutput.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOSplitOutput.java
@@ -109,4 +109,17 @@ public class LOSplitOutput extends LogicalOperator {
         super.unsetSchema();
     }
 
+    /**
+     * @see org.apache.pig.impl.plan.Operator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LOSplitOutput splitOutputClone = (LOSplitOutput)super.clone();
+        LogicalPlanCloneHelper lpCloner = new LogicalPlanCloneHelper(mCondPlan);
+        splitOutputClone.mCondPlan = lpCloner.getClonedPlan();
+        return splitOutputClone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOUnion.java b/src/org/apache/pig/impl/logicalLayer/LOUnion.java
index f903ddd07..65d15e93c 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOUnion.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOUnion.java
@@ -113,4 +113,15 @@ public class LOUnion extends LogicalOperator {
         return DataType.BAG;
     }
 
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LogicalOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LOUnion unionClone = (LOUnion)super.clone();
+        return unionClone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LOUserFunc.java b/src/org/apache/pig/impl/logicalLayer/LOUserFunc.java
index ab501b778..d15c4d203 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOUserFunc.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOUserFunc.java
@@ -18,6 +18,7 @@
 package org.apache.pig.impl.logicalLayer;
 
 import java.util.List;
+import java.util.ArrayList;
 
 import org.apache.pig.EvalFunc;
 import org.apache.pig.FuncSpec;
@@ -63,6 +64,10 @@ public class LOUserFunc extends ExpressionOperator {
         return mArgs;
     }
 
+    public void setArguments(List<ExpressionOperator> args) {
+        mArgs = args;
+    }
+
     @Override
     public boolean supportsMultipleInputs() {
         return true;
@@ -132,4 +137,17 @@ public class LOUserFunc extends ExpressionOperator {
         mArgs = args;
     }
 
+    /**
+     * @see org.apache.pig.impl.logicalLayer.ExpressionOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LOUserFunc clone = (LOUserFunc)super.clone();
+        //note that mFuncSpec cannot be null in LOUserFunc
+        clone.mFuncSpec = mFuncSpec.clone();
+        return clone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LogicalOperator.java b/src/org/apache/pig/impl/logicalLayer/LogicalOperator.java
index 590bae315..5c9a91f7c 100644
--- a/src/org/apache/pig/impl/logicalLayer/LogicalOperator.java
+++ b/src/org/apache/pig/impl/logicalLayer/LogicalOperator.java
@@ -274,4 +274,17 @@ abstract public class LogicalOperator extends Operator<LOVisitor> {
         return true;
     }
 
+    /**
+     * @see org.apache.pig.impl.plan.Operator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        LogicalOperator loClone = (LogicalOperator)super.clone();
+        if(mSchema != null)
+            loClone.mSchema = this.mSchema.clone();
+        return loClone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LogicalPlan.java b/src/org/apache/pig/impl/logicalLayer/LogicalPlan.java
index ff5ca0ed2..e8eba6356 100644
--- a/src/org/apache/pig/impl/logicalLayer/LogicalPlan.java
+++ b/src/org/apache/pig/impl/logicalLayer/LogicalPlan.java
@@ -27,9 +27,11 @@ import java.util.HashMap;
 import java.util.Iterator;
 import java.util.List;
 import java.util.Map;
+import java.util.Collection;
 
 import org.apache.pig.impl.plan.OperatorPlan;
 import org.apache.pig.impl.plan.VisitorException;
+import org.apache.pig.impl.plan.PlanException;
 
 public class LogicalPlan extends OperatorPlan<LogicalOperator> {
     private static final long serialVersionUID = 2L;
@@ -75,4 +77,59 @@ public class LogicalPlan extends OperatorPlan<LogicalOperator> {
 //            return baos.toString();
 //        }
 //    }
+
+    /**
+     * Do not use the clone method directly. Use {@link LogicalPlanCloner} instead.
+     */
+    @Override
+    public LogicalPlan clone() throws CloneNotSupportedException {
+        LogicalPlan clone = new LogicalPlan();
+
+        // Get all the nodes in this plan, and clone them.  As we make
+        // clones, create a map between clone and original.  Then walk the
+        // connections in this plan and create equivalent connections in the
+        // clone.
+        Map<LogicalOperator, LogicalOperator> matches = 
+            //new HashMap<LogicalOperator, LogicalOperator>(mOps.size());
+            LogicalPlanCloneHelper.mOpToCloneMap;
+        for (LogicalOperator op : mOps.keySet()) {
+            try {
+            LogicalOperator c = (LogicalOperator)op.clone();
+            clone.add(c);
+            matches.put(op, c);
+            } catch (CloneNotSupportedException cnse) {
+                cnse.printStackTrace();
+                throw cnse;
+            }
+        }
+
+        // Build the edges
+        for (LogicalOperator op : mToEdges.keySet()) {
+            LogicalOperator cloneTo = matches.get(op);
+            if (cloneTo == null) {
+                String msg = new String("Unable to find clone for op "
+                    + op.name());
+                log.error(msg);
+                throw new RuntimeException(msg);
+            }
+            Collection<LogicalOperator> fromOps = mToEdges.get(op);
+            for (LogicalOperator fromOp : fromOps) {
+                LogicalOperator cloneFrom = matches.get(fromOp);
+                if (cloneFrom == null) {
+                    String msg = new String("Unable to find clone for op "
+                        + fromOp.name());
+                    log.error(msg);
+                    throw new RuntimeException(msg);
+                }
+                try {
+                    clone.connect(cloneFrom, cloneTo);
+                } catch (PlanException pe) {
+                    throw new RuntimeException(pe);
+                }
+            }
+        }
+
+        return clone;
+    }
+    
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/LogicalPlanCloneHelper.java b/src/org/apache/pig/impl/logicalLayer/LogicalPlanCloneHelper.java
new file mode 100644
index 000000000..839ab44f0
--- /dev/null
+++ b/src/org/apache/pig/impl/logicalLayer/LogicalPlanCloneHelper.java
@@ -0,0 +1,477 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.pig.impl.logicalLayer;
+
+import java.util.Iterator;
+import java.util.List;
+import java.util.ArrayList;
+import java.util.Map;
+
+import org.apache.pig.impl.plan.PlanException;
+import org.apache.pig.impl.plan.DependencyOrderWalker;
+import org.apache.pig.impl.plan.VisitorException;
+import org.apache.pig.impl.util.MultiMap;
+
+/**
+ * LogicalPlanCloneHelper implements a visitor mechanism to clone a logical plan
+ * and then patch up the connections held within the operators of the logical plan.
+ * This class should not be used for cloning the logical plan. Use {@link LogicalPlanCloner}
+ * instead.
+ */
+public class LogicalPlanCloneHelper extends LOVisitor {
+    
+    public static Map<LogicalOperator, LogicalOperator> mOpToCloneMap;
+    private LogicalPlan mOriginalPlan;
+
+    /**
+     * @param plan logical plan to be cloned
+     * @param walker walker used for traversing the logical plan
+     */
+    public LogicalPlanCloneHelper(LogicalPlan plan) throws CloneNotSupportedException {
+        super(plan, new DependencyOrderWalker<LogicalOperator, LogicalPlan>(plan));
+        mOriginalPlan = plan;
+        //LOVisitor does not have a default constructor and super needs to be the first
+        //statement in the constructor. As a result, mPlan and mCurrentWalker are being
+        //re-initialized here
+        mPlan = plan.clone();
+        mCurrentWalker = new DependencyOrderWalker<LogicalOperator, LogicalPlan>(mPlan);
+    }
+    
+    /**
+     * @param plan
+     * @param walker
+     * @param origCloneMap the lookup table used for tracking operators cloned in the plan
+     */
+    public LogicalPlanCloneHelper(LogicalPlan plan,
+            Map<LogicalOperator, LogicalOperator> origCloneMap) throws CloneNotSupportedException {
+        super(plan, new DependencyOrderWalker<LogicalOperator, LogicalPlan>(plan));
+        mOpToCloneMap = origCloneMap;
+        mOriginalPlan = plan;
+        //LOVisitor does not have a default constructor and super needs to be the first
+        //statement in the constructor. As a result, mPlan and mCurrentWalker are being
+        //re-initialized here
+        mPlan = plan.clone();
+        mCurrentWalker = new DependencyOrderWalker<LogicalOperator, LogicalPlan>(mPlan);
+    }
+    
+    public LogicalPlan getClonedPlan() throws CloneNotSupportedException {
+        
+        // set the "mPlan" member of all the Logical operators 
+        // in the cloned plan to the cloned plan
+        PlanSetter ps = new PlanSetter(mPlan);
+        try {
+            ps.visit();
+            //patch up the connections
+            this.visit();
+        
+        } catch (VisitorException e) {
+            CloneNotSupportedException cnse = new CloneNotSupportedException("Unable to set plan correctly during cloning");
+            cnse.initCause(e);
+            throw cnse;
+        }
+
+        return mPlan;
+    }
+
+    public static void resetState() {
+        mOpToCloneMap.clear();
+    }
+    
+    @Override
+    public void visit(BinaryExpressionOperator binOp) {
+        ExpressionOperator lhsOperandClone = (ExpressionOperator)mOpToCloneMap.get(binOp.getLhsOperand());
+        if(lhsOperandClone != null) {
+            binOp.setLhsOperand(lhsOperandClone);
+        }
+        ExpressionOperator rhsOperandClone = (ExpressionOperator)mOpToCloneMap.get(binOp.getRhsOperand());
+        if(rhsOperandClone != null) {
+            binOp.setRhsOperand(rhsOperandClone);
+        }
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOAdd)
+     */
+    @Override
+    public void visit(LOAdd op) throws VisitorException {
+        this.visit((BinaryExpressionOperator)op);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOAnd)
+     */
+    @Override
+    public void visit(LOAnd binOp) throws VisitorException {
+        this.visit((BinaryExpressionOperator)binOp);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOBinCond)
+     */
+    @Override
+    protected void visit(LOBinCond binCond) throws VisitorException {
+        ExpressionOperator condClone = (ExpressionOperator)mOpToCloneMap.get(binCond.getCond());
+        if(condClone != null) {
+            binCond.setCond(condClone);
+        }
+
+        ExpressionOperator lhsOpClone = (ExpressionOperator)mOpToCloneMap.get(binCond.getLhsOp());
+        if(lhsOpClone != null) {
+            binCond.setLhsOp(lhsOpClone);
+        }
+
+        ExpressionOperator rhsOpClone = (ExpressionOperator)mOpToCloneMap.get(binCond.getRhsOp());
+        if(rhsOpClone != null) {
+            binCond.setRhsOp(rhsOpClone);
+        }
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOCast)
+     */
+    @Override
+    protected void visit(LOCast cast) throws VisitorException {
+        ExpressionOperator exprClone = (ExpressionOperator)mOpToCloneMap.get(cast.getExpression());
+        if(exprClone != null) {
+            cast.setExpression(exprClone);
+        }
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOCogroup)
+     */
+    @Override
+    protected void visit(LOCogroup cg) throws VisitorException {
+        MultiMap<LogicalOperator, LogicalPlan> groupByPlans = cg.getGroupByPlans();
+        MultiMap<LogicalOperator, LogicalPlan> groupByPlansClone = new MultiMap<LogicalOperator, LogicalPlan>();
+        for(LogicalOperator cgInput: groupByPlans.keySet()) {
+            LogicalOperator cgInputClone = mOpToCloneMap.get(cgInput);
+            if(cgInputClone != null) {
+                groupByPlansClone.put(cgInputClone, groupByPlans.get(cgInput));
+            } else {
+                groupByPlansClone.put(cgInput, groupByPlans.get(cgInput));
+            }
+        }
+        cg.setGroupByPlans(groupByPlansClone);
+        super.visit(cg);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOConst)
+     */
+    @Override
+    protected void visit(LOConst constant) throws VisitorException {
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOCross)
+     */
+    @Override
+    protected void visit(LOCross cs) throws VisitorException {
+        super.visit(cs);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LODistinct)
+     */
+    @Override
+    protected void visit(LODistinct dt) throws VisitorException {
+        super.visit(dt);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LODivide)
+     */
+    @Override
+    public void visit(LODivide op) throws VisitorException {
+        this.visit((BinaryExpressionOperator)op);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOEqual)
+     */
+    @Override
+    public void visit(LOEqual op) throws VisitorException {
+        this.visit((BinaryExpressionOperator)op);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOFilter)
+     */
+    @Override
+    protected void visit(LOFilter filter) throws VisitorException {
+        super.visit(filter);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOForEach)
+     */
+    @Override
+    protected void visit(LOForEach forEach) throws VisitorException {
+        super.visit(forEach);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOGenerate)
+     */
+    @Override
+    protected void visit(LOGenerate g) throws VisitorException {
+        super.visit(g);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LogicalOperator)
+     */
+    @Override
+    protected void visit(LogicalOperator op) throws VisitorException {
+        super.visit(op);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOGreaterThan)
+     */
+    @Override
+    public void visit(LOGreaterThan op) throws VisitorException {
+        this.visit((BinaryExpressionOperator)op);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOGreaterThanEqual)
+     */
+    @Override
+    public void visit(LOGreaterThanEqual op) throws VisitorException {
+        this.visit((BinaryExpressionOperator)op);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOIsNull)
+     */
+    @Override
+    public void visit(LOIsNull uniOp) throws VisitorException {
+        this.visit((UnaryExpressionOperator) uniOp);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOLesserThan)
+     */
+    @Override
+    public void visit(LOLesserThan op) throws VisitorException {
+        this.visit((BinaryExpressionOperator)op);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOLesserThanEqual)
+     */
+    @Override
+    public void visit(LOLesserThanEqual op) throws VisitorException {
+        this.visit((BinaryExpressionOperator)op);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOLimit)
+     */
+    @Override
+    protected void visit(LOLimit limOp) throws VisitorException {
+        super.visit(limOp);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOLoad)
+     */
+    @Override
+    protected void visit(LOLoad load) throws VisitorException {
+        //TODO
+        //LOLoad cloning is not implemented
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOMapLookup)
+     */
+    @Override
+    public void visit(LOMapLookup op) throws VisitorException {
+        ExpressionOperator mapClone = (ExpressionOperator)mOpToCloneMap.get(op.getMap());
+        if(mapClone != null) {
+            op.setMap(mapClone);
+        }
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOMod)
+     */
+    @Override
+    public void visit(LOMod op) throws VisitorException {
+        this.visit((BinaryExpressionOperator)op);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOMultiply)
+     */
+    @Override
+    public void visit(LOMultiply op) throws VisitorException {
+        this.visit((BinaryExpressionOperator)op);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LONegative)
+     */
+    @Override
+    public void visit(LONegative op) throws VisitorException {
+        this.visit((UnaryExpressionOperator) op);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LONot)
+     */
+    @Override
+    public void visit(LONot uniOp) throws VisitorException {
+        this.visit((UnaryExpressionOperator) uniOp);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LONotEqual)
+     */
+    @Override
+    public void visit(LONotEqual op) throws VisitorException {
+        this.visit((BinaryExpressionOperator)op);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOOr)
+     */
+    @Override
+    public void visit(LOOr binOp) throws VisitorException {
+        this.visit((BinaryExpressionOperator)binOp);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOProject)
+     */
+    @Override
+    protected void visit(LOProject project) throws VisitorException {
+        LogicalOperator projectInputClone = mOpToCloneMap.get(project.getExpression());
+        if(projectInputClone != null) {
+            project.setExpression(projectInputClone);
+        }
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LORegexp)
+     */
+    @Override
+    protected void visit(LORegexp binOp) throws VisitorException {
+        this.visit((BinaryExpressionOperator)binOp);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOSort)
+     */
+    @Override
+    protected void visit(LOSort s) throws VisitorException {
+        super.visit(s);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOSplit)
+     */
+    @Override
+    protected void visit(LOSplit split) throws VisitorException {
+        List<LogicalOperator> splitOutputs = split.getOutputs();
+        ArrayList<LogicalOperator> splitOutputClones = new ArrayList<LogicalOperator>(splitOutputs.size());
+        for(LogicalOperator splitOutput: splitOutputs) {
+            LogicalOperator splitOutputClone = mOpToCloneMap.get(splitOutput);
+            if(splitOutputClone != null) {
+                splitOutputClones.add(splitOutputClone);
+            } else {
+                splitOutputClones.add(splitOutput);
+            }
+        }
+        split.setOutputs(splitOutputClones);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOSplitOutput)
+     */
+    @Override
+    protected void visit(LOSplitOutput sop) throws VisitorException {
+        super.visit(sop);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOStore)
+     */
+    @Override
+    protected void visit(LOStore store) throws VisitorException {
+        //TODO
+        //LOStore cloning is not implemented
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOStream)
+     */
+    @Override
+    protected void visit(LOStream stream) throws VisitorException {
+        //TODO
+        //LOStream cloning is not implemented
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOSubtract)
+     */
+    @Override
+    public void visit(LOSubtract op) throws VisitorException {
+        this.visit((BinaryExpressionOperator)op);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOUnion)
+     */
+    @Override
+    protected void visit(LOUnion u) throws VisitorException {
+        super.visit(u);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.LOUserFunc)
+     */
+    @Override
+    protected void visit(LOUserFunc func) throws VisitorException {
+        List<ExpressionOperator> args = func.getArguments();
+        List<ExpressionOperator> argsClone = new ArrayList<ExpressionOperator>(args.size());
+        for(ExpressionOperator arg: args) {
+            ExpressionOperator argClone = (ExpressionOperator)mOpToCloneMap.get(arg);
+            if(argClone != null) {
+                argsClone.add(argClone);
+            } else {
+                argsClone.add(arg);
+            }
+        }
+        func.setArguments(argsClone);
+    }
+
+    /**
+     * @see org.apache.pig.impl.logicalLayer.LOVisitor#visit(org.apache.pig.impl.logicalLayer.UnaryExpressionOperator)
+     */
+    @Override
+    protected void visit(UnaryExpressionOperator uniOp) throws VisitorException {
+        ExpressionOperator operandClone = (ExpressionOperator)mOpToCloneMap.get(uniOp.getOperand());
+        if(operandClone != null) {
+            uniOp.setOperand(operandClone);
+        }
+    }
+    
+}
diff --git a/src/org/apache/pig/impl/logicalLayer/LogicalPlanCloner.java b/src/org/apache/pig/impl/logicalLayer/LogicalPlanCloner.java
new file mode 100644
index 000000000..647907c6c
--- /dev/null
+++ b/src/org/apache/pig/impl/logicalLayer/LogicalPlanCloner.java
@@ -0,0 +1,51 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.pig.impl.logicalLayer;
+
+import java.util.Iterator;
+import java.util.List;
+import java.util.Map;
+import java.util.HashMap;
+
+import org.apache.pig.impl.plan.PlanException;
+import org.apache.pig.impl.plan.PlanWalker;
+import org.apache.pig.impl.plan.VisitorException;
+
+/**
+ * LogicalPlanCloner provides the only mechanism of cloning a logical plan and hence the
+ * the logical operators in the plan.
+ */
+public class LogicalPlanCloner {
+    
+    private LogicalPlan mPlan;
+
+    /**
+     * @param plan logical plan to be cloned
+     */
+    public LogicalPlanCloner(LogicalPlan plan) {
+        mPlan = plan;
+    }
+    
+    public LogicalPlan getClonedPlan() throws CloneNotSupportedException {
+        LogicalPlanCloneHelper lpCloneHelper = new LogicalPlanCloneHelper(mPlan, new HashMap<LogicalOperator, LogicalOperator>());
+        LogicalPlan clonedPlan = lpCloneHelper.getClonedPlan();
+        LogicalPlanCloneHelper.resetState();
+        return clonedPlan;
+    }
+    
+}
diff --git a/src/org/apache/pig/impl/logicalLayer/RemoveRedundantOperators.java b/src/org/apache/pig/impl/logicalLayer/RemoveRedundantOperators.java
new file mode 100644
index 000000000..f5546a634
--- /dev/null
+++ b/src/org/apache/pig/impl/logicalLayer/RemoveRedundantOperators.java
@@ -0,0 +1,155 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.pig.impl.logicalLayer;
+
+import java.util.List;
+import java.util.Iterator;
+import java.util.Set;
+import java.util.Map;
+import java.util.ArrayList;
+
+import org.apache.pig.impl.plan.PlanVisitor;
+import org.apache.pig.impl.plan.PlanWalker;
+import org.apache.pig.impl.plan.DepthFirstWalker;
+import org.apache.pig.impl.plan.DependencyOrderWalker;
+import org.apache.pig.impl.plan.VisitorException;
+import org.apache.pig.impl.plan.PlanException;
+import org.apache.pig.impl.logicalLayer.parser.ParseException;
+import org.apache.pig.impl.plan.OperatorKey;
+import org.apache.pig.impl.util.MultiMap;
+import org.apache.pig.impl.logicalLayer.schema.Schema;
+import org.apache.pig.data.DataType;
+
+/**
+ * A visitor to remove redundant operators in a plan
+ */
+public class RemoveRedundantOperators extends
+        LOVisitor {
+
+    public RemoveRedundantOperators(LogicalPlan plan) {
+        super(plan, new DependencyOrderWalker<LogicalOperator, LogicalPlan>(plan));
+    }
+
+    /**
+     * 
+     * @param project
+     *            the logical project operator that has to be visited
+     * @throws VisitorException
+     */
+    protected void visit(LOProject project) throws VisitorException {
+        LogicalPlan currentPlan = (LogicalPlan)mCurrentWalker.getPlan();
+        
+        //if the project is a project(*) and if there are predecessors and successors that are
+        //1. both relational operators OR
+        //2. both expression operators
+        //then the project(*) can be removed and the input and outputs short circuited, i.e. directly connected
+        if(project.isStar()) {
+
+            List<LogicalOperator> projectSuccessors = currentPlan.getSuccessors(project);
+            List<LogicalOperator> projectPredecessors = currentPlan.getPredecessors(project);
+
+            if(((projectSuccessors != null) && (projectSuccessors.size() > 0)) 
+                && ((projectPredecessors != null) && (projectPredecessors.size() > 0))) {
+
+                //Making copies to avoid concurrent modification exceptions
+                List<LogicalOperator> successors = new ArrayList(currentPlan.getSuccessors(project));
+                List<LogicalOperator> predecessors = new ArrayList(currentPlan.getPredecessors(project));
+
+                //if the project(*) cannot be removed
+                boolean removeProject = true;
+
+                for(LogicalOperator projectPred: predecessors) {
+                    for(LogicalOperator projectSucc: successors) {
+                        if (((projectPred instanceof ExpressionOperator) && (projectSucc instanceof ExpressionOperator))
+                            || (!(projectPred instanceof ExpressionOperator) && !(projectSucc instanceof ExpressionOperator))) {
+                            try {
+                                currentPlan.disconnect(projectPred, project);
+                                currentPlan.disconnect(project, projectSucc);
+                                currentPlan.connect(projectPred, projectSucc);
+                                patchInputReference(projectSucc, project, projectPred);
+                            } catch (PlanException pe) {
+                                throw new VisitorException(pe.getMessage(), pe);
+                            }
+                        } else {
+                            removeProject = false;
+                        }
+                    }
+                }
+                if(removeProject) {
+                    currentPlan.remove(project);
+                }
+            }
+        }
+    }
+
+    private void patchInputReference(LogicalOperator op, LogicalOperator prevInput, LogicalOperator newInput) {
+        //TODO
+        //Using reference comparison here as operators do not have equals() method yet
+        //Depending on the successor of prevInput, fix the referenes to point to newInput
+        if(op instanceof BinaryExpressionOperator) {
+            BinaryExpressionOperator binOp = (BinaryExpressionOperator)op;
+            if(prevInput == binOp.getLhsOperand()) {
+                binOp.setLhsOperand((ExpressionOperator)newInput);
+            } else if(prevInput == binOp.getRhsOperand()) {
+                binOp.setRhsOperand((ExpressionOperator)newInput);
+            }
+        } else if (op instanceof UnaryExpressionOperator) {
+            UnaryExpressionOperator uniOp = (UnaryExpressionOperator)op;
+            if(prevInput == uniOp.getOperand()) {
+                uniOp.setOperand((ExpressionOperator)newInput);
+            }
+        } else if (op instanceof LOBinCond) {
+            LOBinCond binCond = (LOBinCond)op;
+            if(prevInput == binCond.getLhsOp()) {
+                binCond.setLhsOp((ExpressionOperator)newInput);
+            } else if(prevInput == binCond.getRhsOp()) {
+                binCond.setRhsOp((ExpressionOperator)newInput);
+            } else if(prevInput == binCond.getCond()) {
+                binCond.setCond((ExpressionOperator)newInput);
+            }
+        } else if (op instanceof LOCast) {
+            LOCast cast = (LOCast)op;
+            if(prevInput == cast.getExpression()) {
+                cast.setExpression((ExpressionOperator)newInput);
+            }
+        } else if (op instanceof LOMapLookup) {
+            LOMapLookup map = (LOMapLookup)op;
+            if(prevInput == map.getMap()) {
+                map.setMap((ExpressionOperator)newInput);
+            }
+        } else if (op instanceof LOUserFunc) {
+            LOUserFunc userFunc = (LOUserFunc)op;
+            List<ExpressionOperator> args = userFunc.getArguments();
+            ArrayList<ExpressionOperator> newArgs = new ArrayList<ExpressionOperator>(args.size());
+            for(ExpressionOperator expOp: args) {
+                if(prevInput == expOp) {
+                    newArgs.add((ExpressionOperator)newInput);
+                } else {
+                    newArgs.add(expOp);
+                }
+            }
+            userFunc.setArguments(newArgs);
+        } else if (op instanceof LOProject) {
+            LOProject proj = (LOProject)op;
+            if(prevInput == proj.getExpression()) {
+                proj.setExpression(newInput);
+            }
+        }
+    }
+
+}
diff --git a/src/org/apache/pig/impl/logicalLayer/UnaryExpressionOperator.java b/src/org/apache/pig/impl/logicalLayer/UnaryExpressionOperator.java
index fe1b1ba44..de502a331 100644
--- a/src/org/apache/pig/impl/logicalLayer/UnaryExpressionOperator.java
+++ b/src/org/apache/pig/impl/logicalLayer/UnaryExpressionOperator.java
@@ -70,6 +70,10 @@ public abstract class UnaryExpressionOperator extends ExpressionOperator {
         return mOperand;
     }
 
+    public void setOperand(ExpressionOperator eOp) {
+        mOperand = eOp;
+    }
+
     @Override
     public void visit(LOVisitor v) throws VisitorException {
         v.visit(this);
@@ -80,4 +84,15 @@ public abstract class UnaryExpressionOperator extends ExpressionOperator {
         return false;
     }
 
+    /**
+     * @see org.apache.pig.impl.logicalLayer.ExpressionOperator#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        UnaryExpressionOperator unExOpClone = (UnaryExpressionOperator)super.clone();
+        return unExOpClone;
+    }
+
 }
diff --git a/src/org/apache/pig/impl/logicalLayer/parser/QueryParser.jjt b/src/org/apache/pig/impl/logicalLayer/parser/QueryParser.jjt
index 943aa6005..db885fcca 100644
--- a/src/org/apache/pig/impl/logicalLayer/parser/QueryParser.jjt
+++ b/src/org/apache/pig/impl/logicalLayer/parser/QueryParser.jjt
@@ -55,7 +55,7 @@ import org.apache.pig.data.BagFactory;
 import org.apache.pig.data.DataBag;
 import org.apache.pig.EvalFunc;
 import org.apache.pig.FuncSpec;
-import org.apache.pig.impl.logicalLayer.ProjectStarTranslator;
+import org.apache.pig.impl.plan.VisitorException;
 
 
 public class QueryParser {
@@ -1699,7 +1699,24 @@ LogicalOperator ForEachClause(LogicalPlan lp) :
                     }
                 }
             }
-            foreachPlans.add(generatePlan);
+            LogicalPlanCloner lpCloner = new LogicalPlanCloner(generatePlan);
+            LogicalPlan generatePlanClone;
+            try {
+                generatePlanClone = lpCloner.getClonedPlan();
+            } catch (CloneNotSupportedException cnse) {
+                log.error(cnse.getMessage());
+                cnse.printStackTrace();
+                ParseException pe = new ParseException("Not able to clone foreach plan");
+                pe.initCause(cnse);
+                throw pe;
+            }
+            RemoveRedundantOperators removeOperators = new RemoveRedundantOperators(generatePlanClone);
+            try {
+                removeOperators.visit();
+            } catch (VisitorException ve) {
+                throw new ParseException("Could not remove redundant operators in foreach plan.").initCause(ve);
+            }
+            foreachPlans.add(generatePlanClone);
         }
 
 		resetGenerateState();
diff --git a/src/org/apache/pig/impl/logicalLayer/validators/TypeCheckingVisitor.java b/src/org/apache/pig/impl/logicalLayer/validators/TypeCheckingVisitor.java
index d9bd99541..2988e5f4a 100644
--- a/src/org/apache/pig/impl/logicalLayer/validators/TypeCheckingVisitor.java
+++ b/src/org/apache/pig/impl/logicalLayer/validators/TypeCheckingVisitor.java
@@ -1161,6 +1161,7 @@ public class TypeCheckingVisitor extends LOVisitor {
         OperatorKey newKey = genNewOperatorKey(uniOp) ;
         LOCast cast = new LOCast(currentPlan, newKey, input, toType) ;
         
+        currentPlan.add(cast);
         currentPlan.disconnect(input, uniOp) ;
         try {
             currentPlan.connect(input, cast) ;
@@ -1172,6 +1173,7 @@ public class TypeCheckingVisitor extends LOVisitor {
             throw err ;
         }
 
+        uniOp.setOperand(cast);
         this.visit(cast);
 
     }
diff --git a/src/org/apache/pig/impl/plan/Operator.java b/src/org/apache/pig/impl/plan/Operator.java
index 737ac50e4..a5ae3db6f 100644
--- a/src/org/apache/pig/impl/plan/Operator.java
+++ b/src/org/apache/pig/impl/plan/Operator.java
@@ -28,7 +28,7 @@ import org.apache.pig.impl.plan.OperatorKey;
 /**
  * Base class for all types of operators.
  */
-abstract public class Operator<V extends PlanVisitor> implements Serializable, Comparable<Operator> {
+abstract public class Operator<V extends PlanVisitor> implements Serializable, Comparable<Operator>, Cloneable {
     private static final long serialVersionUID = 1L;
 
     /**
@@ -115,7 +115,17 @@ abstract public class Operator<V extends PlanVisitor> implements Serializable, C
         return mKey.compareTo(o.mKey);
     }
     
-    
-    
+    /**
+     * @see java.lang.Object#clone()
+     * Do not use the clone method directly. Operators are cloned when logical plans
+     * are cloned using {@link LogicalPlanCloner}
+     */
+    @Override
+    protected Object clone() throws CloneNotSupportedException {
+        Object o = super.clone();
+        Operator opClone = (Operator)o;
+        opClone.mKey = new OperatorKey(mKey.scope, NodeIdGenerator.getGenerator().getNextNodeId(mKey.scope));
+        return opClone;
+    }
     
 }
diff --git a/src/org/apache/pig/impl/plan/OperatorPlan.java b/src/org/apache/pig/impl/plan/OperatorPlan.java
index f3286ed27..aa3ac8f14 100644
--- a/src/org/apache/pig/impl/plan/OperatorPlan.java
+++ b/src/org/apache/pig/impl/plan/OperatorPlan.java
@@ -48,7 +48,7 @@ import org.apache.commons.logging.LogFactory;
  * for graph manipulators (such as the validators and optimizers) to
  * understand the internals of various nodes.
  */
-public abstract class OperatorPlan<E extends Operator> implements Iterable, Serializable {
+public abstract class OperatorPlan<E extends Operator> implements Iterable, Serializable, Cloneable {
     protected Map<E, OperatorKey> mOps;
     protected Map<OperatorKey, E> mKeys;
     protected MultiMap<E, E> mFromEdges;
diff --git a/test/org/apache/pig/test/TestEvalPipeline.java b/test/org/apache/pig/test/TestEvalPipeline.java
index edec7c439..bc3333970 100644
--- a/test/org/apache/pig/test/TestEvalPipeline.java
+++ b/test/org/apache/pig/test/TestEvalPipeline.java
@@ -833,4 +833,139 @@ public class TestEvalPipeline extends TestCase {
         
     }
 
+    @Test
+    public void testNestedPlanForCloning() throws Exception{
+        int LOOP_COUNT = 10;
+        File tmpFile = File.createTempFile("test", "txt");
+        PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
+        Random r = new Random();
+        for(int i = 0; i < LOOP_COUNT; i++) {
+            for(int j=0;j<LOOP_COUNT;j+=2){
+                ps.println(i+"\t"+j);
+                ps.println(i+"\t"+j);
+            }
+        }
+        ps.close();
+
+        String tmpOutputFile = FileLocalizer.getTemporaryPath(null, 
+        pigServer.getPigContext()).toString();
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
+        pigServer.registerQuery("B = group A by $0;");
+        String query = "C = foreach B {"
+        + "C1 = filter A by not($0 <= -1);"
+        + "C2 = distinct C1;"
+        + "C3 = distinct A;"
+        + "C4 = order A by $0;"
+        + "generate (group + 1) * 10, COUNT(C4), COUNT(C2), SUM(C2.$1)," +  TitleNGrams.class.getName() + "(C3), MAX(C3.$1), C2;"
+        + "};";
+
+        pigServer.registerQuery(query);
+        Iterator<Tuple> iter = pigServer.openIterator("C");
+        if(!iter.hasNext()) fail("No output found");
+        int numIdentity = 0;
+        while(iter.hasNext()){
+            Tuple t = iter.next();
+            assertEquals((Integer)((numIdentity + 1) * 10), (Integer)t.get(0));
+            assertEquals((Long)10L, (Long)t.get(1));
+            assertEquals((Long)5L, (Long)t.get(2));
+            assertEquals(LOOP_COUNT*2.0, (Double)t.get(3), 0.01);
+            assertEquals(8.0, (Double)t.get(5), 0.01);
+            assertEquals(5L, ((DataBag)t.get(6)).size());
+            assertEquals(7, t.size());
+            ++numIdentity;
+        }
+        assertEquals(LOOP_COUNT, numIdentity);
+    }
+
+    @Test
+    public void testArithmeticCloning() throws Exception{
+        int LOOP_COUNT = 10;
+        File tmpFile = File.createTempFile("test", "txt");
+        PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
+        Random r = new Random();
+        for(int i = 0; i < LOOP_COUNT; i++) {
+            for(int j=0;j<LOOP_COUNT;j+=2){
+                ps.println(i+"\t"+j);
+                ps.println(i+"\t"+j);
+            }
+        }
+        ps.close();
+
+        String tmpOutputFile = FileLocalizer.getTemporaryPath(null, 
+        pigServer.getPigContext()).toString();
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
+        pigServer.registerQuery("B = distinct A;");
+        String query = "C = foreach B {"
+        + "C1 = $1 - $0;"
+        + "C2 = $1%2;"
+        + "C3 = ($1 == 0? 0 : $0/$1);"
+        + "generate C1, C2, C3;"
+        + "};";
+
+        pigServer.registerQuery(query);
+        Iterator<Tuple> iter = pigServer.openIterator("C");
+        if(!iter.hasNext()) fail("No output found");
+
+        int numRows = 0;
+        for(int i = 0; i < LOOP_COUNT; i++) {
+            for(int j = 0; j < LOOP_COUNT; j+=2){
+                Tuple t = null;
+                if(iter.hasNext()) t = iter.next();
+                assertEquals(3, t.size());
+                assertEquals(new Double(j - i), (Double)t.get(0), 0.01);
+                assertEquals((Integer)(j%2), (Integer)t.get(1));
+                if(j == 0) {
+                    assertEquals(0.0, (Double)t.get(2), 0.01);
+                } else {
+                    assertEquals((Double)((double)i/j), (Double)t.get(2), 0.01);
+                }
+                ++numRows;
+            }
+        }
+
+        assertEquals((LOOP_COUNT * LOOP_COUNT)/2, numRows);
+    }
+
+    @Test
+    public void testExpressionReUse() throws Exception{
+        int LOOP_COUNT = 10;
+        File tmpFile = File.createTempFile("test", "txt");
+        PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
+        Random r = new Random();
+        for(int i = 0; i < LOOP_COUNT; i++) {
+            for(int j=0;j<LOOP_COUNT;j+=2){
+                ps.println(i+"\t"+j);
+                ps.println(i+"\t"+j);
+            }
+        }
+        ps.close();
+
+        String tmpOutputFile = FileLocalizer.getTemporaryPath(null, 
+        pigServer.getPigContext()).toString();
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile.toString()) + "';");
+        pigServer.registerQuery("B = distinct A;");
+        String query = "C = foreach B {"
+        + "C1 = $0 + $1;"
+        + "C2 = C1 + $0;"
+        + "generate C1, C2;"
+        + "};";
+
+        pigServer.registerQuery(query);
+        Iterator<Tuple> iter = pigServer.openIterator("C");
+        if(!iter.hasNext()) fail("No output found");
+
+        int numRows = 0;
+        for(int i = 0; i < LOOP_COUNT; i++) {
+            for(int j = 0; j < LOOP_COUNT; j+=2){
+                Tuple t = null;
+                if(iter.hasNext()) t = iter.next();
+                assertEquals(2, t.size());
+                assertEquals(new Double(i + j), (Double)t.get(0), 0.01);
+                assertEquals(new Double(i + j + i), (Double)t.get(1));
+                ++numRows;
+            }
+        }
+
+        assertEquals((LOOP_COUNT * LOOP_COUNT)/2, numRows);
+    }
 }
diff --git a/test/org/apache/pig/test/TestLogToPhyCompiler.java b/test/org/apache/pig/test/TestLogToPhyCompiler.java
index ccd50c7cf..301466593 100644
--- a/test/org/apache/pig/test/TestLogToPhyCompiler.java
+++ b/test/org/apache/pig/test/TestLogToPhyCompiler.java
@@ -111,6 +111,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
     	int MAX_SIZE = 100000;
     	ByteArrayOutputStream baos = new ByteArrayOutputStream();
         pp.explain(baos);
+        baos.write((int)'\n');
         String compiledPlan = baos.toString();
         
         if(generate){
@@ -128,7 +129,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
         System.out.println(compiledPlan);
         System.out.println("-------------");
         //System.out.println(compiledPlan.compareTo(goldenPlan)==0);
-        assertEquals(true, compiledPlan.compareTo(goldenPlan) == 0);
+        assertEquals(compiledPlan, goldenPlan);
     }
         
     public void testSort() throws VisitorException, IOException {
@@ -139,6 +140,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
     	int MAX_SIZE = 100000;
     	ByteArrayOutputStream baos = new ByteArrayOutputStream();
         pp.explain(baos);
+        baos.write((int)'\n');
         String compiledPlan = baos.toString();
         
         if(generate){
@@ -158,7 +160,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
         System.out.println("-------------");
         
         //System.out.println(compiledPlan.compareTo(goldenPlan)==0);
-        assertEquals(true, compiledPlan.compareTo(goldenPlan) == 0);
+        assertEquals(compiledPlan, goldenPlan);
     }
         
     public void testDistinct() throws VisitorException, IOException {
@@ -169,6 +171,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
     	int MAX_SIZE = 100000;
     	ByteArrayOutputStream baos = new ByteArrayOutputStream();
         pp.explain(baos);
+        baos.write((int)'\n');
         String compiledPlan = baos.toString();
         
         if(generate){
@@ -187,7 +190,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
         System.out.println(compiledPlan);
         System.out.println("-------------");
         //System.out.println(compiledPlan.compareTo(goldenPlan)==0);
-        assertEquals(true, compiledPlan.compareTo(goldenPlan) == 0);
+        assertEquals(compiledPlan, goldenPlan);
     }
     
     public void testCogroup() throws VisitorException, IOException {
@@ -200,6 +203,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
     	int MAX_SIZE = 100000;
     	ByteArrayOutputStream baos = new ByteArrayOutputStream();
         pp.explain(baos);
+        baos.write((int)'\n');
         String compiledPlan = baos.toString();
         
         if(generate){
@@ -235,6 +239,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
     	int MAX_SIZE = 100000;
     	ByteArrayOutputStream baos = new ByteArrayOutputStream();
         pp.explain(baos);
+        baos.write((int)'\n');
         String compiledPlan = baos.toString();
         
         if(generate){
@@ -253,7 +258,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
         System.out.println(compiledPlan);
         System.out.println("-------------");
         //System.out.println(compiledPlan.compareTo(goldenPlan)==0);
-        assertEquals(true, compiledPlan.compareTo(goldenPlan) == 0);
+        assertEquals(compiledPlan, goldenPlan);
     }
     
     public void testComparison() throws VisitorException, IOException {
@@ -267,6 +272,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
     	int MAX_SIZE = 100000;
     	ByteArrayOutputStream baos = new ByteArrayOutputStream();
         pp.explain(baos);
+        baos.write((int)'\n');
         String compiledPlan = baos.toString();
         
         if(generate){
@@ -285,7 +291,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
         System.out.println(compiledPlan);
         System.out.println("-------------");
         //System.out.println(compiledPlan.compareTo(goldenPlan)==0);
-        assertEquals(true, compiledPlan.compareTo(goldenPlan) == 0);
+        assertEquals(compiledPlan, goldenPlan);
     }
 
     @Test
@@ -299,6 +305,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
         int MAX_SIZE = 100000;
     	ByteArrayOutputStream baos = new ByteArrayOutputStream();
         pp.explain(baos);
+        baos.write((int)'\n');
         String compiledPlan = baos.toString();
         
         if(generate){
@@ -317,7 +324,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
         System.out.println(compiledPlan);
         System.out.println("-------------");
         //System.out.println(compiledPlan.compareTo(goldenPlan)==0);
-        assertEquals(true, compiledPlan.compareTo(goldenPlan) == 0);
+        assertEquals(compiledPlan, goldenPlan);
     }
     
     
@@ -332,6 +339,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
         int MAX_SIZE = 100000;
     	ByteArrayOutputStream baos = new ByteArrayOutputStream();
         pp.explain(baos);
+        baos.write((int)'\n');
         String compiledPlan = baos.toString();
         
         if(generate){
@@ -350,7 +358,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
         System.out.println(compiledPlan);
         System.out.println("-------------");
         
-        assertEquals(true, compiledPlan.compareTo(goldenPlan) == 0);
+        assertEquals(compiledPlan, goldenPlan);
     }
 
     @Test
@@ -362,6 +370,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
     	int MAX_SIZE = 100000;
     	ByteArrayOutputStream baos = new ByteArrayOutputStream();
         pp.explain(baos);
+        baos.write((int)'\n');
         String compiledPlan = baos.toString();
         
         if(generate){
@@ -380,7 +389,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
         System.out.println(compiledPlan);
         System.out.println("-------------");
         
-        assertEquals(true, compiledPlan.compareTo(goldenPlan) == 0);
+        assertEquals(compiledPlan, goldenPlan);
     }
     
     @Test
@@ -393,6 +402,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
     	int MAX_SIZE = 100000;
     	ByteArrayOutputStream baos = new ByteArrayOutputStream();
         pp.explain(baos);
+        baos.write((int)'\n');
         String compiledPlan = baos.toString();
         
         if(generate){
@@ -415,8 +425,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
         System.out.println();
         System.out.println(compiledPlan);
         System.out.println("-------------");
-        boolean flag = false;
-        //System.out.println("GoldenPlan1\n" + goldenPlan1 + "\nGoldenPlan2\n" + goldenPlan2);
+
         if(compiledPlan.compareTo(goldenPlan1) == 0 || compiledPlan.compareTo(goldenPlan2) == 0) {
             // good
         }
@@ -446,6 +455,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
     	int MAX_SIZE = 100000;
     	ByteArrayOutputStream baos = new ByteArrayOutputStream();
         pp.explain(baos);
+        baos.write((int)'\n');
         String compiledPlan = baos.toString();
         
         if(generate){
@@ -454,7 +464,6 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
             return;
         }
         
-//        compiledPlan += "\n"; //for the string compare, the files contain an additional \n
     	FileInputStream fis1 = new FileInputStream("test/org/apache/pig/test/data/GoldenFiles/IsNull1.gld");
     	FileInputStream fis2 = new FileInputStream("test/org/apache/pig/test/data/GoldenFiles/IsNull2.gld");
         byte[] b1 = new byte[MAX_SIZE];
@@ -469,8 +478,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
         System.out.println();
         System.out.println(compiledPlan);
         System.out.println("-------------");
-        boolean flag = false;
-        //System.out.println("GoldenPlan1\n" + goldenPlan1 + "\nGoldenPlan2\n" + goldenPlan2);
+
         if(compiledPlan.compareTo(goldenPlan1) == 0 || compiledPlan.compareTo(goldenPlan2) == 0)  {
             // good
         }
@@ -496,6 +504,7 @@ public class TestLogToPhyCompiler extends junit.framework.TestCase {
         int MAX_SIZE = 100000;
         ByteArrayOutputStream baos = new ByteArrayOutputStream();
         pp.explain(baos);
+        baos.write((int)'\n');
         String compiledPlan = baos.toString();
 
         if(generate){
diff --git a/test/org/apache/pig/test/TestLogicalOptimizer.java b/test/org/apache/pig/test/TestLogicalOptimizer.java
index 7df346146..8ac207355 100644
--- a/test/org/apache/pig/test/TestLogicalOptimizer.java
+++ b/test/org/apache/pig/test/TestLogicalOptimizer.java
@@ -67,7 +67,7 @@ public class TestLogicalOptimizer extends junit.framework.TestCase {
         String actualPlan = printLimitGraph(plan);
         System.out.println("We get:");
         System.out.println(actualPlan);
-		assertEquals(goldenPlan, actualPlan);
+		assertEquals(goldenPlan, actualPlan + "\n");
     }
     
     @Test
diff --git a/test/org/apache/pig/test/TestLogicalPlanBuilder.java b/test/org/apache/pig/test/TestLogicalPlanBuilder.java
index f4e106a43..8d04a066b 100644
--- a/test/org/apache/pig/test/TestLogicalPlanBuilder.java
+++ b/test/org/apache/pig/test/TestLogicalPlanBuilder.java
@@ -1698,6 +1698,24 @@ public class TestLogicalPlanBuilder extends junit.framework.TestCase {
 
     }
 
+    @Test
+    public void testQuery113()  throws FrontendException, ParseException {
+        LogicalPlan lp;
+        LOForEach foreach;
+        LOSort sort;
+
+        buildPlan("a = load 'one' as (name, age, gpa);");
+
+        lp = buildPlan("b = foreach a {exp1 = age + gpa; exp2 = exp1 + age; generate exp1, exp2;};");
+        foreach = (LOForEach) lp.getLeaves().get(0);
+
+        for(LogicalPlan foreachPlan: foreach.getForEachPlans()) {
+            printPlan(foreachPlan);
+            assertTrue(checkPlanForProjectStar(foreachPlan) == false);
+        }
+
+    }
+
     private Schema getSchemaFromString(String schemaString) throws ParseException {
         return getSchemaFromString(schemaString, DataType.BYTEARRAY);
     }
diff --git a/test/org/apache/pig/test/data/DotFiles/optlimitplan1.dot b/test/org/apache/pig/test/data/DotFiles/optlimitplan1.dot
index 8496967c7..f43aea2d3 100644
--- a/test/org/apache/pig/test/data/DotFiles/optlimitplan1.dot
+++ b/test/org/apache/pig/test/data/DotFiles/optlimitplan1.dot
@@ -1,4 +1,4 @@
 digraph graph1 {
     LOLoad18 -> LOSort20;
     LOSort20 [limit="100"];
-}
\ No newline at end of file
+}
diff --git a/test/org/apache/pig/test/data/DotFiles/optlimitplan2.dot b/test/org/apache/pig/test/data/DotFiles/optlimitplan2.dot
index 6018d513e..b80dc6014 100644
--- a/test/org/apache/pig/test/data/DotFiles/optlimitplan2.dot
+++ b/test/org/apache/pig/test/data/DotFiles/optlimitplan2.dot
@@ -1,4 +1,4 @@
 digraph graph1 {
     LOLoad22 -> LOLimit23;
     LOLimit23 [limit="10"];
-}
\ No newline at end of file
+}
diff --git a/test/org/apache/pig/test/data/DotFiles/optlimitplan3.dot b/test/org/apache/pig/test/data/DotFiles/optlimitplan3.dot
index cab8958af..758de6cdc 100644
--- a/test/org/apache/pig/test/data/DotFiles/optlimitplan3.dot
+++ b/test/org/apache/pig/test/data/DotFiles/optlimitplan3.dot
@@ -7,4 +7,4 @@ digraph graph1 {
     LOLimit30 -> LOCross27;
     LOCross27 -> LOLimit28;
     LOLimit28 [limit="100"];
-}
\ No newline at end of file
+}
diff --git a/test/org/apache/pig/test/data/DotFiles/optlimitplan4.dot b/test/org/apache/pig/test/data/DotFiles/optlimitplan4.dot
index 0336a6476..c1b9cf4eb 100644
--- a/test/org/apache/pig/test/data/DotFiles/optlimitplan4.dot
+++ b/test/org/apache/pig/test/data/DotFiles/optlimitplan4.dot
@@ -1,7 +1,7 @@
 digraph graph1 {
     LOLoad31 -> LOCogroup33;
-    LOCogroup33 -> LOForEach36;
-    LOForEach36 [hasflat="true"];
-    LOForEach36 -> LOLimit37;
-    LOLimit37 [limit="100"];
-}
\ No newline at end of file
+    LOCogroup33 -> LOForEach37;
+    LOForEach37 [hasflat="true"];
+    LOForEach37 -> LOLimit38;
+    LOLimit38 [limit="100"];
+}
diff --git a/test/org/apache/pig/test/data/DotFiles/optlimitplan5.dot b/test/org/apache/pig/test/data/DotFiles/optlimitplan5.dot
index 08ab805a9..85e657be0 100644
--- a/test/org/apache/pig/test/data/DotFiles/optlimitplan5.dot
+++ b/test/org/apache/pig/test/data/DotFiles/optlimitplan5.dot
@@ -1,6 +1,6 @@
 digraph graph1 {
-    LOLoad38 -> LOLimit42;
-    LOLimit42 [limit="100"];
-    LOLimit42 -> LOForEach41;
-    LOForEach41 [hasflat="false"];
-}
\ No newline at end of file
+    LOLoad39 -> LOLimit44;
+    LOLimit44 [limit="100"];
+    LOLimit44 -> LOForEach43;
+    LOForEach43 [hasflat="false"];
+}
diff --git a/test/org/apache/pig/test/data/DotFiles/optlimitplan6.dot b/test/org/apache/pig/test/data/DotFiles/optlimitplan6.dot
index b933b364d..b5ea348ec 100644
--- a/test/org/apache/pig/test/data/DotFiles/optlimitplan6.dot
+++ b/test/org/apache/pig/test/data/DotFiles/optlimitplan6.dot
@@ -1,4 +1,4 @@
 digraph graph1 {
-    LOLoad43 -> LOLimit44;
-    LOLimit44 [limit="20"];
-}
\ No newline at end of file
+    LOLoad45 -> LOLimit46;
+    LOLimit46 [limit="20"];
+}
diff --git a/test/org/apache/pig/test/data/DotFiles/optlimitplan7.dot b/test/org/apache/pig/test/data/DotFiles/optlimitplan7.dot
index 70088e746..2f0087fb8 100644
--- a/test/org/apache/pig/test/data/DotFiles/optlimitplan7.dot
+++ b/test/org/apache/pig/test/data/DotFiles/optlimitplan7.dot
@@ -1,6 +1,6 @@
 digraph graph1 {
-    LOLoad47 -> LOForEach50;
-    LOForEach50 [hasflat="true"];
-    LOForEach50 -> LOLimit51;
-    LOLimit51 [limit="100"];
-}
\ No newline at end of file
+    LOLoad49 -> LOForEach53;
+    LOForEach53 [hasflat="true"];
+    LOForEach53 -> LOLimit54;
+    LOLimit54 [limit="100"];
+}
diff --git a/test/org/apache/pig/test/data/GoldenFiles/Arithmetic.gld b/test/org/apache/pig/test/data/GoldenFiles/Arithmetic.gld
index f63f39301..9f235581b 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/Arithmetic.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/Arithmetic.gld
@@ -1,25 +1,25 @@
-New For Each(false,false,false)[bag] - Test-Plan-Builder-86
+New For Each(false,false,false)[bag] - Test-Plan-Builder-103
 |   |
-|   Add[chararray] - Test-Plan-Builder-79
+|   Add[chararray] - Test-Plan-Builder-96
 |   |
-|   |---Add[bytearray] - Test-Plan-Builder-77
+|   |---Add[bytearray] - Test-Plan-Builder-94
 |   |   |
-|   |   |---Project[bytearray][0] - Test-Plan-Builder-75
+|   |   |---Project[bytearray][0] - Test-Plan-Builder-92
 |   |   |
-|   |   |---Project[bytearray][1] - Test-Plan-Builder-76
+|   |   |---Project[bytearray][1] - Test-Plan-Builder-93
 |   |
-|   |---Constant(5) - Test-Plan-Builder-78
+|   |---Constant(5) - Test-Plan-Builder-95
 |   |
-|   Subtract[chararray] - Test-Plan-Builder-84
+|   Subtract[chararray] - Test-Plan-Builder-101
 |   |
-|   |---Subtract[chararray] - Test-Plan-Builder-82
+|   |---Subtract[chararray] - Test-Plan-Builder-99
 |   |   |
-|   |   |---Project[bytearray][0] - Test-Plan-Builder-80
+|   |   |---Project[bytearray][0] - Test-Plan-Builder-97
 |   |   |
-|   |   |---Constant(5) - Test-Plan-Builder-81
+|   |   |---Constant(5) - Test-Plan-Builder-98
 |   |
-|   |---Project[bytearray][1] - Test-Plan-Builder-83
+|   |---Project[bytearray][1] - Test-Plan-Builder-100
 |   |
-|   Constant(hello) - Test-Plan-Builder-85
+|   Constant(hello) - Test-Plan-Builder-102
 |
-|---Load(A:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-74
\ No newline at end of file
+|---Load(A:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-91
diff --git a/test/org/apache/pig/test/data/GoldenFiles/BinCond.gld b/test/org/apache/pig/test/data/GoldenFiles/BinCond.gld
index d15c3ffa3..7f1a4a4c7 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/BinCond.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/BinCond.gld
@@ -1,23 +1,23 @@
-New For Each(false)[bag] - Test-Plan-Builder-137
+New For Each(false)[bag] - Test-Plan-Builder-164
 |   |
-|   POBinCond[bytearray] - Test-Plan-Builder-136
+|   POBinCond[bytearray] - Test-Plan-Builder-163
 |   |
-|   |---Equal To[boolean] - Test-Plan-Builder-129
+|   |---Equal To[boolean] - Test-Plan-Builder-156
 |   |   |
-|   |   |---Project[bytearray][1] - Test-Plan-Builder-127
+|   |   |---Project[bytearray][1] - Test-Plan-Builder-154
 |   |   |
-|   |   |---Constant(3) - Test-Plan-Builder-128
+|   |   |---Constant(3) - Test-Plan-Builder-155
 |   |
-|   |---Add[bytearray] - Test-Plan-Builder-132
+|   |---Add[bytearray] - Test-Plan-Builder-159
 |   |   |
-|   |   |---Project[bytearray][2] - Test-Plan-Builder-130
+|   |   |---Project[bytearray][2] - Test-Plan-Builder-157
 |   |   |
-|   |   |---Project[bytearray][3] - Test-Plan-Builder-131
+|   |   |---Project[bytearray][3] - Test-Plan-Builder-158
 |   |
-|   |---Subtract[bytearray] - Test-Plan-Builder-135
+|   |---Subtract[bytearray] - Test-Plan-Builder-162
 |       |
-|       |---Project[bytearray][2] - Test-Plan-Builder-133
+|       |---Project[bytearray][2] - Test-Plan-Builder-160
 |       |
-|       |---Project[bytearray][3] - Test-Plan-Builder-134
+|       |---Project[bytearray][3] - Test-Plan-Builder-161
 |
-|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-126
\ No newline at end of file
+|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-153
diff --git a/test/org/apache/pig/test/data/GoldenFiles/Cogroup.gld b/test/org/apache/pig/test/data/GoldenFiles/Cogroup.gld
index 9ec46f3ed..7a45cdb15 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/Cogroup.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/Cogroup.gld
@@ -1,35 +1,35 @@
-Package[tuple]{tuple} - Test-Plan-Builder-45
+Package[tuple]{tuple} - Test-Plan-Builder-51
 |
-|---Global Rearrange[tuple] - Test-Plan-Builder-44
+|---Global Rearrange[tuple] - Test-Plan-Builder-50
     |
-    |---Local Rearrange[tuple]{tuple}(false) - Test-Plan-Builder-46
+    |---Local Rearrange[tuple]{tuple}(false) - Test-Plan-Builder-52
     |   |   |
-    |   |   Add[bytearray] - Test-Plan-Builder-49
+    |   |   Add[bytearray] - Test-Plan-Builder-55
     |   |   |
-    |   |   |---Project[bytearray][0] - Test-Plan-Builder-47
+    |   |   |---Project[bytearray][0] - Test-Plan-Builder-53
     |   |   |
-    |   |   |---Project[bytearray][1] - Test-Plan-Builder-48
+    |   |   |---Project[bytearray][1] - Test-Plan-Builder-54
     |   |   |
-    |   |   Subtract[bytearray] - Test-Plan-Builder-52
+    |   |   Subtract[bytearray] - Test-Plan-Builder-58
     |   |   |
-    |   |   |---Project[bytearray][0] - Test-Plan-Builder-50
+    |   |   |---Project[bytearray][0] - Test-Plan-Builder-56
     |   |   |
-    |   |   |---Project[bytearray][1] - Test-Plan-Builder-51
+    |   |   |---Project[bytearray][1] - Test-Plan-Builder-57
     |   |
-    |   |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-42
+    |   |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-48
     |
-    |---Local Rearrange[tuple]{tuple}(false) - Test-Plan-Builder-53
+    |---Local Rearrange[tuple]{tuple}(false) - Test-Plan-Builder-59
         |   |
-        |   Add[bytearray] - Test-Plan-Builder-56
+        |   Add[bytearray] - Test-Plan-Builder-62
         |   |
-        |   |---Project[bytearray][0] - Test-Plan-Builder-54
+        |   |---Project[bytearray][0] - Test-Plan-Builder-60
         |   |
-        |   |---Project[bytearray][1] - Test-Plan-Builder-55
+        |   |---Project[bytearray][1] - Test-Plan-Builder-61
         |   |
-        |   Subtract[bytearray] - Test-Plan-Builder-59
+        |   Subtract[bytearray] - Test-Plan-Builder-65
         |   |
-        |   |---Project[bytearray][0] - Test-Plan-Builder-57
+        |   |---Project[bytearray][0] - Test-Plan-Builder-63
         |   |
-        |   |---Project[bytearray][1] - Test-Plan-Builder-58
+        |   |---Project[bytearray][1] - Test-Plan-Builder-64
         |
-        |---Load(b:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-43
\ No newline at end of file
+        |---Load(b:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-49
diff --git a/test/org/apache/pig/test/data/GoldenFiles/Comparison.gld b/test/org/apache/pig/test/data/GoldenFiles/Comparison.gld
index 7b0181a76..5dcf9944e 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/Comparison.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/Comparison.gld
@@ -1,25 +1,25 @@
-Filter[bag] - Test-Plan-Builder-101
+Filter[bag] - Test-Plan-Builder-118
 |   |
-|   Greater Than[boolean] - Test-Plan-Builder-112
+|   Greater Than[boolean] - Test-Plan-Builder-129
 |   |
-|   |---Add[bytearray] - Test-Plan-Builder-104
+|   |---Add[bytearray] - Test-Plan-Builder-121
 |   |   |
-|   |   |---Project[bytearray][0] - Test-Plan-Builder-102
+|   |   |---Project[bytearray][0] - Test-Plan-Builder-119
 |   |   |
-|   |   |---Project[bytearray][1] - Test-Plan-Builder-103
+|   |   |---Project[bytearray][1] - Test-Plan-Builder-120
 |   |
-|   |---Multiply[chararray] - Test-Plan-Builder-111
+|   |---Multiply[chararray] - Test-Plan-Builder-128
 |       |
-|       |---Subtract[bytearray] - Test-Plan-Builder-107
+|       |---Subtract[bytearray] - Test-Plan-Builder-124
 |       |   |
-|       |   |---Project[bytearray][0] - Test-Plan-Builder-105
+|       |   |---Project[bytearray][0] - Test-Plan-Builder-122
 |       |   |
-|       |   |---Project[bytearray][1] - Test-Plan-Builder-106
+|       |   |---Project[bytearray][1] - Test-Plan-Builder-123
 |       |
-|       |---Divide[chararray] - Test-Plan-Builder-110
+|       |---Divide[chararray] - Test-Plan-Builder-127
 |           |
-|           |---Constant(4) - Test-Plan-Builder-108
+|           |---Constant(4) - Test-Plan-Builder-125
 |           |
-|           |---Constant(2) - Test-Plan-Builder-109
+|           |---Constant(2) - Test-Plan-Builder-126
 |
-|---Load(a:org.apache.pig.builtin.PigStorage(':')) - Test-Plan-Builder-100
\ No newline at end of file
+|---Load(a:org.apache.pig.builtin.PigStorage(':')) - Test-Plan-Builder-117
diff --git a/test/org/apache/pig/test/data/GoldenFiles/ComplexForeach.gld b/test/org/apache/pig/test/data/GoldenFiles/ComplexForeach.gld
index 8d9d62802..a80d97547 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/ComplexForeach.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/ComplexForeach.gld
@@ -1,15 +1,15 @@
-New For Each(false)[bag] - Test-Plan-Builder-16
+New For Each(false)[bag] - Test-Plan-Builder-22
 |   |
-|   Project[bag][*] - Test-Plan-Builder-15
+|   Project[bag][*] - Test-Plan-Builder-21
 |   |
-|   |---Filter[bag] - Test-Plan-Builder-11
+|   |---Filter[bag] - Test-Plan-Builder-17
 |       |   |
-|       |   Equal To[boolean] - Test-Plan-Builder-14
+|       |   Equal To[boolean] - Test-Plan-Builder-20
 |       |   |
-|       |   |---Project[Unknown][1] - Test-Plan-Builder-12
+|       |   |---Project[Unknown][1] - Test-Plan-Builder-18
 |       |   |
-|       |   |---Project[Unknown][2] - Test-Plan-Builder-13
+|       |   |---Project[Unknown][2] - Test-Plan-Builder-19
 |       |
-|       |---Project[tuple][0] - Test-Plan-Builder-10
+|       |---Project[tuple][0] - Test-Plan-Builder-16
 |
-|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-9
\ No newline at end of file
+|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-15
diff --git a/test/org/apache/pig/test/data/GoldenFiles/Distinct.gld b/test/org/apache/pig/test/data/GoldenFiles/Distinct.gld
index 9cf2f8b01..8d959c819 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/Distinct.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/Distinct.gld
@@ -1,3 +1,3 @@
-PODistinct[bag] - Test-Plan-Builder-26
+PODistinct[bag] - Test-Plan-Builder-32
 |
-|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-25
\ No newline at end of file
+|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-31
diff --git a/test/org/apache/pig/test/data/GoldenFiles/Generate.gld b/test/org/apache/pig/test/data/GoldenFiles/Generate.gld
index 3d9efbd91..c0c7c4cc6 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/Generate.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/Generate.gld
@@ -1,37 +1,37 @@
-New For Each(false,false,false,false,false,false)[bag] - Test-Plan-Builder-176
+New For Each(false,false,false,false,false,false)[bag] - Test-Plan-Builder-220
 |   |
-|   Add[bytearray] - Test-Plan-Builder-161
+|   Add[bytearray] - Test-Plan-Builder-205
 |   |
-|   |---Project[bytearray][1] - Test-Plan-Builder-159
+|   |---Project[bytearray][1] - Test-Plan-Builder-203
 |   |
-|   |---Project[bytearray][2] - Test-Plan-Builder-160
+|   |---Project[bytearray][2] - Test-Plan-Builder-204
 |   |
-|   Subtract[bytearray] - Test-Plan-Builder-164
+|   Subtract[bytearray] - Test-Plan-Builder-208
 |   |
-|   |---Project[bytearray][1] - Test-Plan-Builder-162
+|   |---Project[bytearray][1] - Test-Plan-Builder-206
 |   |
-|   |---Project[bytearray][2] - Test-Plan-Builder-163
+|   |---Project[bytearray][2] - Test-Plan-Builder-207
 |   |
-|   Multiply[bytearray] - Test-Plan-Builder-167
+|   Multiply[bytearray] - Test-Plan-Builder-211
 |   |
-|   |---Project[bytearray][1] - Test-Plan-Builder-165
+|   |---Project[bytearray][1] - Test-Plan-Builder-209
 |   |
-|   |---Project[bytearray][2] - Test-Plan-Builder-166
+|   |---Project[bytearray][2] - Test-Plan-Builder-210
 |   |
-|   Divide[bytearray] - Test-Plan-Builder-170
+|   Divide[bytearray] - Test-Plan-Builder-214
 |   |
-|   |---Project[bytearray][1] - Test-Plan-Builder-168
+|   |---Project[bytearray][1] - Test-Plan-Builder-212
 |   |
-|   |---Project[bytearray][2] - Test-Plan-Builder-169
+|   |---Project[bytearray][2] - Test-Plan-Builder-213
 |   |
-|   Mod[bytearray] - Test-Plan-Builder-173
+|   Mod[bytearray] - Test-Plan-Builder-217
 |   |
-|   |---Project[bytearray][1] - Test-Plan-Builder-171
+|   |---Project[bytearray][1] - Test-Plan-Builder-215
 |   |
-|   |---Project[bytearray][2] - Test-Plan-Builder-172
+|   |---Project[bytearray][2] - Test-Plan-Builder-216
 |   |
-|   PONegative[tuple] - Test-Plan-Builder-175
+|   PONegative[tuple] - Test-Plan-Builder-219
 |   |
-|   |---Project[bytearray][1] - Test-Plan-Builder-174
+|   |---Project[bytearray][1] - Test-Plan-Builder-218
 |
-|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-158
\ No newline at end of file
+|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-202
diff --git a/test/org/apache/pig/test/data/GoldenFiles/IsNull1.gld b/test/org/apache/pig/test/data/GoldenFiles/IsNull1.gld
index cb96f36bf..7ebad7774 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/IsNull1.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/IsNull1.gld
@@ -1,21 +1,21 @@
-Filter[tuple] - Test-Plan-Builder-214
+Filter[tuple] - Test-Plan-Builder-258
 |   |
-|   POIsNull[tuple] - Test-Plan-Builder-216
+|   POIsNull[tuple] - Test-Plan-Builder-260
 |   |
-|   |---Project[bytearray][0] - Test-Plan-Builder-215
+|   |---Project[bytearray][0] - Test-Plan-Builder-259
 |
-|---Split - Test-Plan-Builder-213
+|---Split - Test-Plan-Builder-257
     |
-    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-212
+    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-256
 
-Filter[tuple] - Test-Plan-Builder-217
+Filter[tuple] - Test-Plan-Builder-261
 |   |
-|   Not[boolean] - Test-Plan-Builder-220
+|   Not[boolean] - Test-Plan-Builder-264
 |   |
-|   |---POIsNull[tuple] - Test-Plan-Builder-219
+|   |---POIsNull[tuple] - Test-Plan-Builder-263
 |       |
-|       |---Project[bytearray][0] - Test-Plan-Builder-218
+|       |---Project[bytearray][0] - Test-Plan-Builder-262
 |
-|---Split - Test-Plan-Builder-213
+|---Split - Test-Plan-Builder-257
     |
-    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-212
\ No newline at end of file
+    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-256
diff --git a/test/org/apache/pig/test/data/GoldenFiles/IsNull2.gld b/test/org/apache/pig/test/data/GoldenFiles/IsNull2.gld
index eb63b9c35..7a1b61cb0 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/IsNull2.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/IsNull2.gld
@@ -1,21 +1,21 @@
-Filter[tuple] - Test-Plan-Builder-214
+Filter[tuple] - Test-Plan-Builder-258
 |   |
-|   Not[boolean] - Test-Plan-Builder-217
+|   Not[boolean] - Test-Plan-Builder-261
 |   |
-|   |---POIsNull[tuple] - Test-Plan-Builder-216
+|   |---POIsNull[tuple] - Test-Plan-Builder-260
 |       |
-|       |---Project[bytearray][0] - Test-Plan-Builder-215
+|       |---Project[bytearray][0] - Test-Plan-Builder-259
 |
-|---Split - Test-Plan-Builder-213
+|---Split - Test-Plan-Builder-257
     |
-    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-212
+    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-256
 
-Filter[tuple] - Test-Plan-Builder-218
+Filter[tuple] - Test-Plan-Builder-262
 |   |
-|   POIsNull[tuple] - Test-Plan-Builder-220
+|   POIsNull[tuple] - Test-Plan-Builder-264
 |   |
-|   |---Project[bytearray][0] - Test-Plan-Builder-219
+|   |---Project[bytearray][0] - Test-Plan-Builder-263
 |
-|---Split - Test-Plan-Builder-213
+|---Split - Test-Plan-Builder-257
     |
-    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-212
+    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-256
diff --git a/test/org/apache/pig/test/data/GoldenFiles/Limit.gld b/test/org/apache/pig/test/data/GoldenFiles/Limit.gld
index 4f1753f03..dae04b309 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/Limit.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/Limit.gld
@@ -1,3 +1,3 @@
-Limit - Test-Plan-Builder-224
+Limit - Test-Plan-Builder-268
 |
-|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-223
\ No newline at end of file
+|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-267
diff --git a/test/org/apache/pig/test/data/GoldenFiles/Sort.gld b/test/org/apache/pig/test/data/GoldenFiles/Sort.gld
index 3d72a78ba..9c759c405 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/Sort.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/Sort.gld
@@ -1,5 +1,5 @@
-POSort[bag]() - Test-Plan-Builder-22
+POSort[bag]() - Test-Plan-Builder-28
 |   |
-|   Project[bytearray][0] - Test-Plan-Builder-21
+|   Project[bytearray][0] - Test-Plan-Builder-27
 |
-|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-20
\ No newline at end of file
+|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-26
diff --git a/test/org/apache/pig/test/data/GoldenFiles/Split1.gld b/test/org/apache/pig/test/data/GoldenFiles/Split1.gld
index f991fcebf..3323ebf1b 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/Split1.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/Split1.gld
@@ -1,23 +1,23 @@
-Filter[tuple] - Test-Plan-Builder-196
+Filter[tuple] - Test-Plan-Builder-240
 |   |
-|   Less Than[boolean] - Test-Plan-Builder-199
+|   Greater Than[boolean] - Test-Plan-Builder-243
 |   |
-|   |---Project[bytearray][0] - Test-Plan-Builder-197
+|   |---Project[bytearray][0] - Test-Plan-Builder-241
 |   |
-|   |---Constant(7) - Test-Plan-Builder-198
+|   |---Constant(7) - Test-Plan-Builder-242
 |
-|---Split - Test-Plan-Builder-195
+|---Split - Test-Plan-Builder-239
     |
-    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-194
+    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-238
 
-Filter[tuple] - Test-Plan-Builder-200
+Filter[tuple] - Test-Plan-Builder-244
 |   |
-|   Greater Than[boolean] - Test-Plan-Builder-203
+|   Less Than[boolean] - Test-Plan-Builder-247
 |   |
-|   |---Project[bytearray][0] - Test-Plan-Builder-201
+|   |---Project[bytearray][0] - Test-Plan-Builder-245
 |   |
-|   |---Constant(7) - Test-Plan-Builder-202
+|   |---Constant(7) - Test-Plan-Builder-246
 |
-|---Split - Test-Plan-Builder-195
+|---Split - Test-Plan-Builder-239
     |
-    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-194
\ No newline at end of file
+    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-238
diff --git a/test/org/apache/pig/test/data/GoldenFiles/Split2.gld b/test/org/apache/pig/test/data/GoldenFiles/Split2.gld
index df21fe2b4..61d3e5ea2 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/Split2.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/Split2.gld
@@ -1,23 +1,23 @@
-Filter[tuple] - Test-Plan-Builder-196
+Filter[tuple] - Test-Plan-Builder-240
 |   |
-|   Greater Than[boolean] - Test-Plan-Builder-199
+|   Less Than[boolean] - Test-Plan-Builder-243
 |   |
-|   |---Project[bytearray][0] - Test-Plan-Builder-197
+|   |---Project[bytearray][0] - Test-Plan-Builder-241
 |   |
-|   |---Constant(7) - Test-Plan-Builder-198
+|   |---Constant(7) - Test-Plan-Builder-242
 |
-|---Split - Test-Plan-Builder-195
+|---Split - Test-Plan-Builder-239
     |
-    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-194
+    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-238
 
-Filter[tuple] - Test-Plan-Builder-200
+Filter[tuple] - Test-Plan-Builder-244
 |   |
-|   Less Than[boolean] - Test-Plan-Builder-203
+|   Greater Than[boolean] - Test-Plan-Builder-247
 |   |
-|   |---Project[bytearray][0] - Test-Plan-Builder-201
+|   |---Project[bytearray][0] - Test-Plan-Builder-245
 |   |
-|   |---Constant(7) - Test-Plan-Builder-202
+|   |---Constant(7) - Test-Plan-Builder-246
 |
-|---Split - Test-Plan-Builder-195
+|---Split - Test-Plan-Builder-239
     |
-    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-194
\ No newline at end of file
+    |---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-238
diff --git a/test/org/apache/pig/test/data/GoldenFiles/Union.gld b/test/org/apache/pig/test/data/GoldenFiles/Union.gld
index edc683b4e..5cf84a1fa 100644
--- a/test/org/apache/pig/test/data/GoldenFiles/Union.gld
+++ b/test/org/apache/pig/test/data/GoldenFiles/Union.gld
@@ -1,7 +1,7 @@
-Union[bag] - Test-Plan-Builder-184
+Union[bag] - Test-Plan-Builder-228
 |
-|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-181
+|---Load(a:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-225
 |
-|---Load(b:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-182
+|---Load(b:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-226
 |
-|---Load(c:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-183
\ No newline at end of file
+|---Load(c:org.apache.pig.builtin.PigStorage) - Test-Plan-Builder-227
