diff --git a/CHANGES.txt b/CHANGES.txt
index d4bc2521e..bfeb66b29 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -105,6 +105,8 @@ OPTIMIZATIONS
  
 BUG FIXES
 
+PIG-4166: Collected group drops last record when combined with merge join (bridiver via daijy)
+
 PIG-2495: Using merge JOIN from a HBaseStorage produces an error (bridiver via daijy)
 
 PIG-4182: e2e tests Scripting_[1-12] fail on Windows (daijy)
diff --git a/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/relationalOperators/POCollectedGroup.java b/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/relationalOperators/POCollectedGroup.java
index 738e5e4af..bcbfe2b62 100644
--- a/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/relationalOperators/POCollectedGroup.java
+++ b/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/relationalOperators/POCollectedGroup.java
@@ -124,18 +124,14 @@ public class POCollectedGroup extends PhysicalOperator {
     @Override
     public Result getNextTuple() throws ExecException {
 
-        // Since the output is buffered, we need to flush the last
-        // set of records when the close method is called by mapper.
-        if (this.parentPlan.endOfAllInput) {
-            return getStreamCloseResult();
-        }
-
         Result inp = null;
         Result res = null;
 
         while (true) {
             inp = processInput();
             if (inp.returnStatus == POStatus.STATUS_EOP) {
+                // Since the output is buffered, we need to flush the last
+                // set of records when the close method is called by mapper.
                 if (this.parentPlan.endOfAllInput) {
                     return getStreamCloseResult();
                 } else {
diff --git a/test/org/apache/pig/test/TestCollectedGroup.java b/test/org/apache/pig/test/TestCollectedGroup.java
index 16a67d386..a958d335a 100644
--- a/test/org/apache/pig/test/TestCollectedGroup.java
+++ b/test/org/apache/pig/test/TestCollectedGroup.java
@@ -25,6 +25,7 @@ import java.util.Iterator;
 import java.util.List;
 
 import org.apache.pig.CollectableLoadFunc;
+import org.apache.pig.ExecType;
 import org.apache.pig.PigServer;
 import org.apache.pig.backend.executionengine.ExecException;
 import org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MRCompilerException;
@@ -292,6 +293,43 @@ public class TestCollectedGroup {
         }
     }
 
+    @Test
+    public void testMapsideGroupWithMergeJoin() throws IOException{
+        pigServer = new PigServer(cluster.getExecType(), cluster.getProperties());
+        pigServer.registerQuery("A = LOAD '" + INPUT_FILE + "' using "+DummyCollectableLoader.class.getName() +"() as (id, name, grade);");
+        pigServer.registerQuery("B = LOAD '" + INPUT_FILE + "' using "+DummyCollectableLoader.class.getName() +"() as (id, name, grade);");
+        try {
+            DataBag dbfrj = BagFactory.getInstance().newDefaultBag();
+            DataBag dbshj = BagFactory.getInstance().newDefaultBag();
+            {
+            	pigServer.registerQuery("C = join A by id, B by id using 'merge';");
+                pigServer.registerQuery("D = group C by A::id using 'collected';");
+                pigServer.registerQuery("E = foreach D generate group, COUNT(C);");
+                Iterator<Tuple> iter = pigServer.openIterator("E");
+
+                while (iter.hasNext()) {
+                    dbfrj.add(iter.next());
+                }
+            }
+            {
+            	pigServer.registerQuery("F = join A by id, B by id;");
+                pigServer.registerQuery("G = group F by A::id;");
+                pigServer.registerQuery("H = foreach G generate group, COUNT(F);");
+                Iterator<Tuple> iter = pigServer.openIterator("H");
+
+                while (iter.hasNext()) {
+                    dbshj.add(iter.next());
+                }
+            }
+            Assert.assertTrue(dbfrj.size()>0 && dbshj.size()>0);
+            Assert.assertEquals(true, TestHelper.compareBags(dbfrj, dbshj));
+
+        } catch (Exception e) {
+            e.printStackTrace();
+            Assert.fail(e.getMessage());
+        }
+    }
+
     public static class DummyCollectableLoader extends PigStorage implements CollectableLoadFunc{
 
         @Override
