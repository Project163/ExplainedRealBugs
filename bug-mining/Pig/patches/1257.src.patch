diff --git a/CHANGES.txt b/CHANGES.txt
index 9994abe29..84e203276 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -251,6 +251,8 @@ PIG-3013: BinInterSedes improve chararray sort performance (rohini)
 
 BUG FIXES
 
+PIG-3458: ScalarExpression lost with multiquery optimization (knoguchi)
+
 PIG-3360: Some intermittent negative e2e tests fail on hadoop 2 (daijy)
 
 PIG-3468: PIG-3123 breaks e2e test Jython_Diagnostics_2 (daijy)
diff --git a/src/org/apache/pig/newplan/logical/visitor/ScalarVisitor.java b/src/org/apache/pig/newplan/logical/visitor/ScalarVisitor.java
index 62aa143e7..1e427099e 100644
--- a/src/org/apache/pig/newplan/logical/visitor/ScalarVisitor.java
+++ b/src/org/apache/pig/newplan/logical/visitor/ScalarVisitor.java
@@ -71,9 +71,13 @@ public class ScalarVisitor extends AllExpressionVisitor {
                 LogicalPlan lp = (LogicalPlan) attachedOp.getPlan();
                 List<Operator> succs = lp.getSuccessors( refOp );
                 LOStore store = null;
+                FuncSpec interStorageFuncSpec = new FuncSpec(InterStorage.class.getName());
                 if( succs != null ) {
                     for( Operator succ : succs ) {
-                        if( succ instanceof LOStore ) {
+                        if( succ instanceof LOStore
+                                && ((LOStore)succ).isTmpStore()
+                                && interStorageFuncSpec.equals(
+                                    ((LOStore)succ).getOutputSpec().getFuncSpec() ) ) {
                             store = (LOStore)succ;
                             break;
                         }
@@ -81,14 +85,13 @@ public class ScalarVisitor extends AllExpressionVisitor {
                 }
 
                 if( store == null ) {
-                    FuncSpec funcSpec = new FuncSpec(InterStorage.class.getName());
                     FileSpec fileSpec;
                     try {
-                        fileSpec = new FileSpec( FileLocalizer.getTemporaryPath( pigContext ).toString(), funcSpec );                    // TODO: need to hookup the pigcontext.
+                        fileSpec = new FileSpec( FileLocalizer.getTemporaryPath( pigContext ).toString(), interStorageFuncSpec );                    // TODO: need to hookup the pigcontext.
                     } catch (IOException e) {
                         throw new PlanValidationException( expr, "Failed to process scalar" + e);
                     }
-                    StoreFuncInterface stoFunc = (StoreFuncInterface)PigContext.instantiateFuncFromSpec(funcSpec);
+                    StoreFuncInterface stoFunc = (StoreFuncInterface)PigContext.instantiateFuncFromSpec(interStorageFuncSpec);
                     String sig = LogicalPlanBuilder.newOperatorKey(scope);
                     stoFunc.setStoreFuncUDFContextSignature(sig);
                     store = new LOStore(lp, fileSpec, stoFunc, sig);
diff --git a/test/org/apache/pig/test/TestMultiQueryBasic.java b/test/org/apache/pig/test/TestMultiQueryBasic.java
index 6dbc9a8fd..ae796d114 100644
--- a/test/org/apache/pig/test/TestMultiQueryBasic.java
+++ b/test/org/apache/pig/test/TestMultiQueryBasic.java
@@ -577,6 +577,44 @@ public class TestMultiQueryBasic {
         Util.deleteFile(new PigContext(ExecType.LOCAL, new Properties()), "output1_checkOutputSpec_test");
         Util.deleteFile(new PigContext(ExecType.LOCAL, new Properties()), "output2_checkOutputSpec_test");
     }
+
+    /**
+     * Test that MultiQuery optimization won't use user's output for
+     * ScalarExpression (and get empty output) at the end
+     */
+    @Test
+    public void testMultiQueryWithScalarExpression() throws Exception {
+
+        System.out.println("===== multi-query with ScalarExpression =====");
+
+        String[] inputData = {"john","henry", "adam"};
+        Util.createLocalInputFile("queryInput.txt", inputData);
+
+        myPig.setBatchOn();
+
+        myPig.registerQuery("a = load 'queryInput.txt' using PigStorage() as (uname:chararray);");
+        myPig.registerQuery("b = group a ALL;");
+        myPig.registerQuery("c = foreach b generate COUNT(a) as count;");
+        myPig.registerQuery("store c into 'output1';");
+        myPig.registerQuery("z = load 'queryInput.txt' using PigStorage() as (uname:chararray);");
+        myPig.registerQuery("y = foreach z generate uname, c.count;");
+        myPig.registerQuery("store y into 'output2';");
+
+        List<ExecJob> jobs = myPig.executeBatch();
+
+        for (ExecJob job : jobs) {
+            assertTrue(job.getStatus() == ExecJob.JOB_STATUS.COMPLETED);
+        }
+        myPig.registerQuery("aa = load 'output2' as (uname:chararray, cnt:int) ;");
+        Iterator<Tuple> it = myPig.openIterator("aa");
+        int i = 0;
+        while(it.hasNext()) {
+            Tuple t = it.next();
+            i++;
+            assertEquals(3, t.get(1));
+        }
+        assertEquals(3, i);
+    }
         
     private static final String DUMMY_STORE_WITH_OUTPUTFORMAT_CLASS
             = "org.apache.pig.test.TestMultiQueryBasic\\$DummyStoreWithOutputFormat";
