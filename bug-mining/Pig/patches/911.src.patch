diff --git a/CHANGES.txt b/CHANGES.txt
index f3d794534..a84ff007f 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -417,6 +417,8 @@ Release 0.9.3 - Unreleased
 
 BUG FIXES
 
+PIG-2535: Bug in new logical plan results in no output for join (daijy)
+
 PIG-2534: Pig generating infinite map outputs (daijy)
 
 PIG-2493: UNION causes casting issues (vivekp via daijy)
diff --git a/src/org/apache/pig/newplan/logical/rules/MapKeysPruneHelper.java b/src/org/apache/pig/newplan/logical/rules/MapKeysPruneHelper.java
index f421c6d04..af967740c 100644
--- a/src/org/apache/pig/newplan/logical/rules/MapKeysPruneHelper.java
+++ b/src/org/apache/pig/newplan/logical/rules/MapKeysPruneHelper.java
@@ -260,7 +260,10 @@ public class MapKeysPruneHelper {
         
         @Override
         public void visit(LOSplitOutput splitOutput) throws FrontendException {
-            super.visit(splitOutput);
+            currentOp = splitOutput;
+            MapExprMarker v = (MapExprMarker) getVisitor(splitOutput.getFilterPlan());
+            v.visit();
+            mergeUidKeys( v.inputUids );
             if (splitOutput.getSchema()!=null) {
                 for (LogicalFieldSchema fs : splitOutput.getSchema().getFields()) {
                     long inputUid = splitOutput.getInputUids(fs.uid);
diff --git a/test/org/apache/pig/test/TestPruneColumn.java b/test/org/apache/pig/test/TestPruneColumn.java
index 9bfa59e3f..03139a5d8 100644
--- a/test/org/apache/pig/test/TestPruneColumn.java
+++ b/test/org/apache/pig/test/TestPruneColumn.java
@@ -2102,4 +2102,29 @@ public class TestPruneColumn extends TestCase {
         assertTrue(checkLogFileMessage(new String[]{"Map key required for event_serve: $0->[key4, key3]", 
                 "Map key required for cm_data_raw: $0->[key4, key3, key5]"}));
     }
+
+    // See PIG-2535
+    @Test
+    public void testStream3() throws Exception {
+
+        pigServer.registerQuery("event_serve = LOAD 'input1' AS (s, m, l);");
+        pigServer.registerQuery("raw = LOAD 'input2' AS (s, m, l);");
+
+        pigServer.registerQuery("SPLIT raw INTO " +
+            "serve_raw IF (( (chararray) (s#'type') == '0') AND ( (chararray) (s#'source') == '5'))," +
+            "cm_click_raw IF (( (chararray) (s#'type') == '1') AND ( (chararray) (s#'source') == '5'));");
+        pigServer.registerQuery("cm_serve = FOREACH serve_raw GENERATE  s#'cm_serve_id' AS cm_event_guid,  s#'cm_serve_timestamp_ms' AS cm_receive_time, s#'p_url' AS ctx ;");
+        pigServer.registerQuery("cm_serve_lowercase = stream cm_serve through `tr [:upper:] [:lower:]`;");
+        pigServer.registerQuery("cm_serve_final = FOREACH cm_serve_lowercase GENERATE  $0 AS cm_event_guid, $1 AS cm_receive_time, $2 AS ctx;");
+        pigServer.registerQuery("filtered = FILTER event_serve BY (chararray) (s#'filter_key') neq 'xxxx' AND (chararray) (s#'filter_key') neq 'yyyy';");
+        pigServer.registerQuery("event_serve_project = FOREACH filtered GENERATE s#'event_guid' AS event_guid, s#'receive_time' AS receive_time;");
+        pigServer.registerQuery("event_serve_join = join cm_serve_final by (cm_event_guid), event_serve_project by (event_guid);");
+
+
+        pigServer.explain("event_serve_join", System.out);
+
+        assertTrue(checkLogFileMessage(new String[]{"Map key required for event_serve: $0->[event_guid, receive_time, filter_key]",
+                "Map key required for raw: $0->[source, p_url, cm_serve_timestamp_ms, cm_serve_id, type]"}));
+    }
+
 }
