diff --git a/src/org/apache/pig/impl/logicalLayer/validators/SchemaAliasVisitor.java b/src/org/apache/pig/impl/logicalLayer/validators/SchemaAliasVisitor.java
index fa6d99f84..bf0da4924 100644
--- a/src/org/apache/pig/impl/logicalLayer/validators/SchemaAliasVisitor.java
+++ b/src/org/apache/pig/impl/logicalLayer/validators/SchemaAliasVisitor.java
@@ -57,6 +57,8 @@ public class SchemaAliasVisitor extends LOVisitor {
                     for (int j = i + 1; j < schema.size(); j++) {
                         if (schema.getField(i) != null
                                 && schema.getField(j) != null
+                                && schema.getField(i).alias != null 
+                                && schema.getField(j).alias != null
                                 && schema.getField(i).alias.equals(schema
                                         .getField(j).alias)) {
                             int errCode = 1108;
diff --git a/test/org/apache/pig/test/TestEvalPipeline.java b/test/org/apache/pig/test/TestEvalPipeline.java
index 556e7aade..d139b1c65 100644
--- a/test/org/apache/pig/test/TestEvalPipeline.java
+++ b/test/org/apache/pig/test/TestEvalPipeline.java
@@ -574,7 +574,7 @@ public class TestEvalPipeline extends TestCase {
                 "as (b, t2, m);",
                 "p = load '" + output +"' using BinStorage() ;"};
         // the corresponding generate statements
-        String[] generates = {"q = foreach p generate COUNT(b), t2.a, t2.b, m#'key1', m#'key2', b;",
+        String[] generates = {"q = foreach p generate COUNT(b), t2.a, t2.b as t2b, m#'key1', m#'key2', b;",
                 "q = foreach p generate COUNT(b), t2.$0, t2.$1, m#'key1', m#'key2', b;",
                 "q = foreach p generate COUNT($0), $1.$0, $1.$1, $2#'key1', $2#'key2', $0;"};
         
diff --git a/test/org/apache/pig/test/TestEvalPipelineLocal.java b/test/org/apache/pig/test/TestEvalPipelineLocal.java
index af1ddff06..a4e5dfdc8 100644
--- a/test/org/apache/pig/test/TestEvalPipelineLocal.java
+++ b/test/org/apache/pig/test/TestEvalPipelineLocal.java
@@ -587,7 +587,7 @@ public class TestEvalPipelineLocal extends TestCase {
                 "as (b, t2, m);",
                 "p = load '" + output +"' using BinStorage() ;"};
         // the corresponding generate statements
-        String[] generates = {"q = foreach p generate COUNT(b), t2.a, t2.b, m#'key1', m#'key2', b;",
+        String[] generates = {"q = foreach p generate COUNT(b), t2.a, t2.b as t2b, m#'key1', m#'key2', b;",
                 "q = foreach p generate COUNT(b), t2.$0, t2.$1, m#'key1', m#'key2', b;",
                 "q = foreach p generate COUNT($0), $1.$0, $1.$1, $2#'key1', $2#'key2', $0;"};
         
diff --git a/test/org/apache/pig/test/TestJoin.java b/test/org/apache/pig/test/TestJoin.java
index 5d35ac09a..302098592 100644
--- a/test/org/apache/pig/test/TestJoin.java
+++ b/test/org/apache/pig/test/TestJoin.java
@@ -176,7 +176,7 @@ public class TestJoin extends TestCase {
             String script = "a = load '"+ firstInput +"' as (i:int, j:int); " +
                     "b = load '"+ secondInput +"' as (k:int, l:chararray); " +
                     "c = join a by $0, b by $0;" +
-                    "d = foreach c generate i,j,k,l,a::i,a::j,b::k,b::l;";
+                    "d = foreach c generate i,j,k,l,a::i as ai,a::j as aj,b::k as bk,b::l as bl;";
             Util.registerMultiLineQuery(pigServer, script);
             Iterator<Tuple> it = pigServer.openIterator("d");
             assertEquals(true, it.hasNext());
@@ -187,7 +187,7 @@ public class TestJoin extends TestCase {
             script = "a = load '"+ firstInput +"' as (i:int, j:int); " +
             "b = load '"+ secondInput +"' as (i:int, l:chararray); " +
             "c = join a by $0, b by $0;" +
-            "d = foreach c generate i,j,l,a::i,a::j,b::i,b::l;";
+            "d = foreach c generate i,j,l,a::i as ai,a::j as aj,b::i as bi,b::l as bl;";
             boolean exceptionThrown = false;
             try{
                 Util.registerMultiLineQuery(pigServer, script);
@@ -202,7 +202,7 @@ public class TestJoin extends TestCase {
             script = "a = load '"+ firstInput +"' as (i:int, j:int); " +
             "b = load '"+ secondInput +"' as (i:int, l:chararray); " +
             "c = join a by $0, b by $0;" +
-            "d = foreach c generate a::i,j,b::i,l,a::i,a::j,b::i,b::l;";
+            "d = foreach c generate a::i as ai1,j,b::i as bi1,l,a::i as ai2,a::j as aj2,b::i as bi3,b::l as bl3;";
             Util.registerMultiLineQuery(pigServer, script);
             it = pigServer.openIterator("d");
             assertEquals(true, it.hasNext());
