diff --git a/CHANGES.txt b/CHANGES.txt
index 09f2054c0..269c4bb9a 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -78,6 +78,8 @@ OPTIMIZATIONS
  
 BUG FIXES
 
+PIG-4187: Fix Orc e2e tests (daijy)
+
 PIG-4177: BigData_1 fail after PIG-4149 (daijy)
 
 PIG-3507: Pig fails to run in local mode on a Kerberos enabled Hadoop cluster (kellyzly via rohini)
diff --git a/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/PhyPlanSetter.java b/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/PhyPlanSetter.java
index c4ceb9957..d75c29294 100644
--- a/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/PhyPlanSetter.java
+++ b/src/org/apache/pig/backend/hadoop/executionengine/mapReduceLayer/PhyPlanSetter.java
@@ -349,6 +349,7 @@ public class PhyPlanSetter extends PhyPlanVisitor {
     @Override
     public void visitPreCombinerLocalRearrange(
             POPreCombinerLocalRearrange preCombinerLocalRearrange) throws VisitorException {
+        super.visitPreCombinerLocalRearrange(preCombinerLocalRearrange);
         preCombinerLocalRearrange.setParentPlan(parent);
     }
 
diff --git a/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/plans/PhyPlanVisitor.java b/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/plans/PhyPlanVisitor.java
index b9b5b5c2a..3bad98bfc 100644
--- a/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/plans/PhyPlanVisitor.java
+++ b/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/plans/PhyPlanVisitor.java
@@ -347,7 +347,12 @@ public class PhyPlanVisitor extends PlanVisitor<PhysicalOperator,PhysicalPlan> {
      */
     public void visitPreCombinerLocalRearrange(
             POPreCombinerLocalRearrange preCombinerLocalRearrange) throws VisitorException {
-        // TODO Auto-generated method stub
+        List<PhysicalPlan> inpPlans = preCombinerLocalRearrange.getPlans();
+        for (PhysicalPlan plan : inpPlans) {
+            pushWalker(mCurrentWalker.spawnChildWalker(plan));
+            visit();
+            popWalker();
+        }
     }
 
     public void visitPartialAgg(POPartialAgg poPartialAgg) throws VisitorException {
diff --git a/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/plans/UdfCacheShipFilesVisitor.java b/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/plans/UdfCacheShipFilesVisitor.java
index e5070cea4..033fff7c2 100644
--- a/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/plans/UdfCacheShipFilesVisitor.java
+++ b/src/org/apache/pig/backend/hadoop/executionengine/physicalLayer/plans/UdfCacheShipFilesVisitor.java
@@ -20,10 +20,13 @@ package org.apache.pig.backend.hadoop.executionengine.physicalLayer.plans;
 import java.util.HashSet;
 import java.util.Set;
 
+import org.apache.pig.LoadFunc;
 import org.apache.pig.backend.hadoop.executionengine.physicalLayer.PhysicalOperator;
+import org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POCast;
 import org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOperators.POUserFunc;
 import org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POLoad;
 import org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POStore;
+import org.apache.pig.impl.PigContext;
 import org.apache.pig.impl.plan.DepthFirstWalker;
 import org.apache.pig.impl.plan.VisitorException;
 
@@ -64,6 +67,22 @@ public class UdfCacheShipFilesVisitor extends PhyPlanVisitor {
         }
     }
 
+    @Override
+    public void visitCast(POCast cast) {
+        if (cast.getFuncSpec()!=null) {
+            Object obj = PigContext.instantiateFuncFromSpec(cast.getFuncSpec());
+            if (obj instanceof LoadFunc) {
+                LoadFunc loadFunc = (LoadFunc)obj;
+                if (loadFunc.getCacheFiles()!=null) {
+                    cacheFiles.addAll(loadFunc.getCacheFiles());
+                }
+                if (loadFunc.getShipFiles()!=null) {
+                    shipFiles.addAll(loadFunc.getShipFiles());
+                }
+            }
+        }
+    }
+
     public Set<String> getCacheFiles() {
         return cacheFiles;
     }
diff --git a/src/org/apache/pig/backend/hadoop/executionengine/util/MapRedUtil.java b/src/org/apache/pig/backend/hadoop/executionengine/util/MapRedUtil.java
index f3c5ad7fb..5fba418f3 100644
--- a/src/org/apache/pig/backend/hadoop/executionengine/util/MapRedUtil.java
+++ b/src/org/apache/pig/backend/hadoop/executionengine/util/MapRedUtil.java
@@ -172,7 +172,7 @@ public class MapRedUtil {
         UDFContext udfc = UDFContext.getUDFContext();
         udfc.addJobConf(job);
         // don't deserialize in front-end
-        if (udfc.isUDFConfEmpty()) {
+        if (!udfc.isFrontend()) {
             udfc.deserialize();
         }
     }
diff --git a/src/org/apache/pig/builtin/OrcStorage.java b/src/org/apache/pig/builtin/OrcStorage.java
index 561a5279b..5bd9c7484 100644
--- a/src/org/apache/pig/builtin/OrcStorage.java
+++ b/src/org/apache/pig/builtin/OrcStorage.java
@@ -94,6 +94,7 @@ import org.apache.pig.impl.util.Utils;
 import org.apache.pig.impl.util.orc.OrcUtils;
 import org.joda.time.DateTime;
 
+import com.esotericsoftware.kryo.io.Input;
 import com.google.common.annotations.VisibleForTesting;
 
 /**
@@ -400,7 +401,8 @@ public class OrcStorage extends LoadFunc implements StoreFuncInterface, LoadMeta
             throw new RuntimeException("Cannot find Hadoop" + hadoopVersion + "ShimsClass in classpath");
         }
         Class[] classList = new Class[] {OrcFile.class, HiveConf.class, AbstractSerDe.class,
-                org.apache.hadoop.hive.shims.HadoopShims.class, HadoopShimsSecure.class, hadoopVersionShimsClass};
+                org.apache.hadoop.hive.shims.HadoopShims.class, HadoopShimsSecure.class, hadoopVersionShimsClass,
+                Input.class};
         return FuncUtils.getShipFiles(classList);
     }
 
diff --git a/test/org/apache/pig/test/TestLoaderStorerShipCacheFiles.java b/test/org/apache/pig/test/TestLoaderStorerShipCacheFiles.java
index c7b030795..04415dfb8 100644
--- a/test/org/apache/pig/test/TestLoaderStorerShipCacheFiles.java
+++ b/test/org/apache/pig/test/TestLoaderStorerShipCacheFiles.java
@@ -50,9 +50,10 @@ public abstract class TestLoaderStorerShipCacheFiles {
             hadoopVersion = "23";
         }
         String[] expectedJars = new String[] {"hive-common", "hive-exec", "hive-serde", 
-                "hive-shims-0." + hadoopVersion, "hive-shims-common-0", "hive-shims-common-secure"};
+                "hive-shims-0." + hadoopVersion, "hive-shims-common-0", "hive-shims-common-secure",
+                "kryo"};
 
-        checkPlan(pp, expectedJars, 6, pigServer.getPigContext());
+        checkPlan(pp, expectedJars, 7, pigServer.getPigContext());
     }
 
     @Test
@@ -66,9 +67,10 @@ public abstract class TestLoaderStorerShipCacheFiles {
             hadoopVersion = "23";
         }
         String[] expectedJars = new String[] {"hive-common", "hive-exec", "hive-serde", 
-                "hive-shims-0." + hadoopVersion, "hive-shims-common-0", "hive-shims-common-secure"};
+                "hive-shims-0." + hadoopVersion, "hive-shims-common-0", "hive-shims-common-secure",
+                "kryo"};
 
-        checkPlan(pp, expectedJars, 6, pigServer.getPigContext());
+        checkPlan(pp, expectedJars, 7, pigServer.getPigContext());
     }
 
     @Test
