diff --git a/src/org/apache/pig/PigServer.java b/src/org/apache/pig/PigServer.java
index da9badd3f..8c447cce9 100644
--- a/src/org/apache/pig/PigServer.java
+++ b/src/org/apache/pig/PigServer.java
@@ -41,6 +41,7 @@ import org.apache.pig.backend.executionengine.ExecJob;
 import org.apache.pig.backend.executionengine.ExecPhysicalPlan;
 import org.apache.pig.backend.executionengine.ExecJob.JOB_STATUS;
 import org.apache.pig.backend.executionengine.ExecutionEngine;
+import org.apache.pig.builtin.BinStorage;
 import org.apache.pig.builtin.PigStorage;
 import org.apache.pig.data.Tuple;
 import org.apache.pig.impl.PigContext;
@@ -307,7 +308,8 @@ public class PigServer {
             if(null == op) {
                 throw new IOException("Unable to find an operator for alias " + id);
             }
-            ExecJob job = execute(getPlanFromAlias(id, op.getClass().getName()));
+//            ExecJob job = execute(getPlanFromAlias(id, op.getClass().getName()));
+            ExecJob job = store(id, FileLocalizer.getTemporaryPath(null, pigContext).toString(), BinStorage.class.getName() + "()");
             // invocation of "execute" is synchronous!
             if (job.getStatus() == JOB_STATUS.COMPLETED) {
                     return job.getResults();
@@ -328,14 +330,14 @@ public class PigServer {
      * @throws IOException
      */
 
-    public void store(String id, String filename) throws IOException {
-        store(id, filename, PigStorage.class.getName() + "()");   // SFPig is the default store function
+    public ExecJob store(String id, String filename) throws IOException {
+        return store(id, filename, PigStorage.class.getName() + "()");   // SFPig is the default store function
     }
         
     /**
      *  forces execution of query (and all queries from which it reads), in order to store result in file
      */
-    public void store(
+    public ExecJob store(
             String id,
             String filename,
             String func) throws IOException{
@@ -344,13 +346,13 @@ public class PigServer {
         
         try {
             LogicalPlan readFrom = getPlanFromAlias(id, "store");
-            store(id, readFrom, filename, func);
+            return store(id, readFrom, filename, func);
         } catch (FrontendException fe) {
             throw WrappedIOException.wrap("Unable to store alias " + id, fe);
         }
     }
         
-    public void store(
+    public ExecJob store(
             String id,
             LogicalPlan readFrom,
             String filename,
@@ -358,7 +360,7 @@ public class PigServer {
         try {
             LogicalPlan storePlan = QueryParser.generateStorePlan(opTable,
                 scope, readFrom, filename, func, aliasOp.get(id), aliases);
-            execute(storePlan);
+            return execute(storePlan);
         } catch (Exception e) {
             throw WrappedIOException.wrap("Unable to store for alias: " +
                 id, e);
diff --git a/src/org/apache/pig/impl/logicalLayer/LOSplitOutput.java b/src/org/apache/pig/impl/logicalLayer/LOSplitOutput.java
index 5ab3508c6..dbb9bef8c 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOSplitOutput.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOSplitOutput.java
@@ -70,6 +70,7 @@ public class LOSplitOutput extends LogicalOperator {
         if (!mIsSchemaComputed) {
             // get our parent's schema
             Collection<LogicalOperator> s = mPlan.getPredecessors(this);
+            if(s==null) return null;
             try {
                 LogicalOperator op = s.iterator().next();
                 if (null == op) {
diff --git a/test/org/apache/pig/test/TestFilterUDF.java b/test/org/apache/pig/test/TestFilterUDF.java
index c441de6d1..73ce3ed24 100644
--- a/test/org/apache/pig/test/TestFilterUDF.java
+++ b/test/org/apache/pig/test/TestFilterUDF.java
@@ -24,10 +24,23 @@ import org.junit.Test;
 
 public class TestFilterUDF extends TestCase {
     private PigServer pigServer;
+    private MiniCluster cluster = MiniCluster.buildCluster();
+    private File tmpFile;
+    
+    public TestFilterUDF() throws ExecException, IOException{
+        pigServer = new PigServer(ExecType.MAPREDUCE, cluster.getProperties());
+        int LOOP_SIZE = 20;
+        tmpFile = File.createTempFile("test", "txt");
+        PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
+        for(int i = 1; i <= LOOP_SIZE; i++) {
+            ps.println(i);
+        }
+        ps.close();
+    }
     
     @Before
     public void setUp() throws Exception {
-        pigServer = new PigServer(ExecType.LOCAL);
+        
     }
 
     @After
@@ -53,13 +66,7 @@ public class TestFilterUDF extends TestCase {
     
     @Test
     public void testFilterUDF() throws Exception{
-        int LOOP_SIZE = 20;
-        File tmpFile = File.createTempFile("test", "txt");
-        PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
-        for(int i = 1; i <= LOOP_SIZE; i++) {
-            ps.println(i);
-        }
-        ps.close();
+        
         pigServer.registerQuery("A = LOAD 'file:" + tmpFile + "' as (x:int);");
         pigServer.registerQuery("B = filter A by " + MyFilterFunction.class.getName() + "();");
         Iterator<Tuple> iter = pigServer.openIterator("B");
diff --git a/test/org/apache/pig/test/TestSplitStore.java b/test/org/apache/pig/test/TestSplitStore.java
new file mode 100644
index 000000000..75eacca32
--- /dev/null
+++ b/test/org/apache/pig/test/TestSplitStore.java
@@ -0,0 +1,117 @@
+package org.apache.pig.test;
+
+
+import java.io.File;
+import java.io.FileOutputStream;
+import java.io.IOException;
+import java.io.PrintStream;
+
+import org.apache.pig.ExecType;
+import org.apache.pig.PigServer;
+import org.apache.pig.backend.executionengine.ExecException;
+import org.apache.pig.impl.PigContext;
+import org.apache.pig.impl.io.FileLocalizer;
+import org.junit.After;
+import org.junit.Before;
+import org.junit.Test;
+
+import junit.framework.TestCase;
+
+public class TestSplitStore extends TestCase{
+    private PigServer pig;
+    private PigContext pigContext;
+    private File tmpFile;
+    private MiniCluster cluster = MiniCluster.buildCluster();
+    
+    public TestSplitStore() throws ExecException, IOException{
+        pig = new PigServer(ExecType.MAPREDUCE, cluster.getProperties());
+        pigContext = pig.getPigContext();
+        int LOOP_SIZE = 20;
+        tmpFile = File.createTempFile("test", "txt");
+        PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
+        for(int i = 1; i <= LOOP_SIZE; i++) {
+            ps.println(i);
+        }
+        ps.close();
+    }
+    @Before
+    public void setUp() throws Exception {
+        
+    }
+
+    @After
+    public void tearDown() throws Exception {
+    }
+    
+    @Test
+    public void test1() throws Exception{
+        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
+        pig.store("A1", "'" + FileLocalizer.getTemporaryPath(null, pigContext) + "'");
+        pig.store("A2", "'" + FileLocalizer.getTemporaryPath(null, pigContext) + "'");
+    }
+    
+    @Test
+    public void test2() throws Exception{
+        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
+        pig.openIterator("A1");
+        pig.store("A2", "'" + FileLocalizer.getTemporaryPath(null, pigContext) + "'");
+    }
+    
+    @Test
+    public void test3() throws Exception{
+        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
+        pig.openIterator("A2");
+        pig.store("A1", "'" + FileLocalizer.getTemporaryPath(null, pigContext) + "'");
+    }
+    
+    @Test
+    public void test4() throws Exception{
+        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
+        pig.store("A1", "'" + FileLocalizer.getTemporaryPath(null, pigContext) + "'");
+        pig.openIterator("A2");
+    }
+    
+    @Test
+    public void test5() throws Exception{
+        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
+        pig.store("A2", "'" + FileLocalizer.getTemporaryPath(null, pigContext) + "'");
+        pig.openIterator("A1");
+    }
+    
+    @Test
+    public void test6() throws Exception{
+        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
+        pig.openIterator("A1");
+        pig.registerQuery("Store A2 into '" + FileLocalizer.getTemporaryPath(null, pigContext) + "';");
+    }
+    
+    @Test
+    public void test7() throws Exception{
+        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
+        pig.openIterator("A2");
+        pig.registerQuery("Store A1 into '" + FileLocalizer.getTemporaryPath(null, pigContext) + "';");
+    }
+    
+    @Test
+    public void test8() throws Exception{
+        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
+        pig.registerQuery("Store A1 into '" + FileLocalizer.getTemporaryPath(null, pigContext) + "';");
+        pig.openIterator("A2");
+    }
+    
+    @Test
+    public void test9() throws Exception{
+        pig.registerQuery("A = LOAD 'file:" + tmpFile + "';");
+        pig.registerQuery("Split A into A1 if $0<=10, A2 if $0>10;");
+        pig.registerQuery("Store A2 into '" + FileLocalizer.getTemporaryPath(null, pigContext) + "';");
+        pig.openIterator("A1");
+    }
+}
