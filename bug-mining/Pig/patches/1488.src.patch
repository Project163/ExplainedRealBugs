diff --git a/CHANGES.txt b/CHANGES.txt
index 38189ce70..b59efe616 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -211,6 +211,8 @@ PIG-3882: Multiquery off mode execution is not done in batch and very inefficien
  
 BUG FIXES
 
+PIG-4021: Fix TestHBaseStorage failure after auto local mode change (PIG-3463) (daijy)
+
 PIG-4029: TestMRCompiler is broken after PIG-3874 (daijy)
 
 PIG-4030: TestGrunt, TestPigRunner fail after PIG-3892 (daijy)
diff --git a/src/org/apache/pig/backend/hadoop/executionengine/HExecutionEngine.java b/src/org/apache/pig/backend/hadoop/executionengine/HExecutionEngine.java
index 5c5953c33..41c2b7c41 100644
--- a/src/org/apache/pig/backend/hadoop/executionengine/HExecutionEngine.java
+++ b/src/org/apache/pig/backend/hadoop/executionengine/HExecutionEngine.java
@@ -110,14 +110,6 @@ public abstract class HExecutionEngine implements ExecutionEngine {
     public JobConf getLocalConf(Properties properties) {
         JobConf jc = new JobConf(false);
 
-        // If we are running in local mode we dont read the hadoop conf file
-        if (properties.getProperty(MAPREDUCE_FRAMEWORK_NAME) == null) {
-            jc.set(MAPREDUCE_FRAMEWORK_NAME, LOCAL);
-        }
-        jc.set(JOB_TRACKER_LOCATION, LOCAL);
-        jc.set(FILE_SYSTEM_LOCATION, "file:///");
-        jc.set(ALTERNATIVE_FILE_SYSTEM_LOCATION, "file:///");
-
         jc.addResource(MAPRED_DEFAULT_SITE);
         jc.addResource(YARN_DEFAULT_SITE);
         jc.addResource(CORE_DEFAULT_SITE);
@@ -182,6 +174,14 @@ public abstract class HExecutionEngine implements ExecutionEngine {
             // add hdfs-default.xml into configuration
             new DistributedFileSystem();
         } else {
+            // If we are running in local mode we dont read the hadoop conf file
+            if (properties.getProperty(MAPREDUCE_FRAMEWORK_NAME) == null) {
+                properties.setProperty(MAPREDUCE_FRAMEWORK_NAME, LOCAL);
+            }
+            properties.setProperty(JOB_TRACKER_LOCATION, LOCAL);
+            properties.setProperty(FILE_SYSTEM_LOCATION, "file:///");
+            properties.setProperty(ALTERNATIVE_FILE_SYSTEM_LOCATION, "file:///");
+
             jc = getLocalConf(properties);
         }
 
