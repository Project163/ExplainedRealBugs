diff --git a/src/org/apache/pig/impl/logicalLayer/optimizer/PushDownForeachFlatten.java b/src/org/apache/pig/impl/logicalLayer/optimizer/PushDownForeachFlatten.java
index fb895e232..01a19d4b5 100644
--- a/src/org/apache/pig/impl/logicalLayer/optimizer/PushDownForeachFlatten.java
+++ b/src/org/apache/pig/impl/logicalLayer/optimizer/PushDownForeachFlatten.java
@@ -191,10 +191,12 @@ public class PushDownForeachFlatten extends LogicalTransformer {
             if (requiredFields.getFields()!=null) {
                 for (Pair<Integer, Integer> pair : requiredFields.getFields()) {
                     Collection<Column> columns = foreachMappedFields.get(pair.second);
-                    for (Column column : columns) {
-                        Pair<Integer, Integer> foreachInputColumn = column.getInputColumn();
-                        if (foreach.isInputFlattened(foreachInputColumn.second))
-                            return false;
+                    if (columns!=null) {
+                        for (Column column : columns) {
+                            Pair<Integer, Integer> foreachInputColumn = column.getInputColumn();
+                            if (foreach.isInputFlattened(foreachInputColumn.second))
+                                return false;
+                        }
                     }
                 }
             }
