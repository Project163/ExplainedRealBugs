diff --git a/CHANGES.txt b/CHANGES.txt
index 544d5c114..83fc3498d 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -110,6 +110,8 @@ OPTIMIZATIONS
  
 BUG FIXES
 
+PIG-4258: Fix several e2e tests on Windows (daijy)
+
 PIG-4256: Fix StreamingPythonUDFs e2e test failure on Windows (daijy)
 
 PIG-4166: Collected group drops last record when combined with merge join (bridiver via daijy)
diff --git a/test/e2e/pig/conf/local.conf b/test/e2e/pig/conf/local.conf
index 3ef25e02a..a29da635a 100644
--- a/test/e2e/pig/conf/local.conf
+++ b/test/e2e/pig/conf/local.conf
@@ -15,7 +15,7 @@
 #  limitations under the License.                                                      
                                                                                        
 my $me = `whoami`;
-chomp $me;
+$me =~ s/[^a-zA-Z0-9]*//g;
 
 # The contents of this file can be rewritten to fit your installation.
 # Also, you can define the following environment variables and set things up as in the test setup
@@ -40,7 +40,7 @@ $cfg = {
     #TEST
     , 'benchmarkPath'    => "$ENV{PH_OUT}/benchmarks"
     , 'scriptPath'       => "$ENV{PH_ROOT}/libexec"
-    , 'tmpPath'          => '/tmp/pigtest'
+    , 'tmpPath'          => 'tmp/pigtest'
 
     #PIG
     , 'testconfigpath'   => "$ENV{PH_CLUSTER}/conf/"
diff --git a/test/e2e/pig/conf/rpm.conf b/test/e2e/pig/conf/rpm.conf
index 1db3a2e55..3b5eb3150 100644
--- a/test/e2e/pig/conf/rpm.conf
+++ b/test/e2e/pig/conf/rpm.conf
@@ -15,7 +15,7 @@
 #  limitations under the License.                                                      
                                                                                        
 my $me = `whoami`;
-chomp $me;
+$me =~ s/[^a-zA-Z0-9]*//g;
 
 # The contents of this file can be rewritten to fit your installation.
 # Also, you can define the following environment variables and set things up as in the test setup
@@ -43,14 +43,13 @@ $cfg = {
     #TEST
     , 'benchmarkPath'    => "$ENV{PH_OUT}/benchmarks"
     , 'scriptPath'       => "$ENV{PH_ROOT}/libexec"
-    , 'tmpPath'          => '/tmp/pigtest'
+    , 'tmpPath'          => 'tmp/pigtest'
 
     #PIG
     , 'testconfigpath'   => "$ENV{HADOOP_CONF_DIR}"
     , 'funcjarPath'      => "$ENV{PH_ROOT}/lib/java"
-    , 'piggybankjarPath' => "/usr/lib/pig"
+    , 'piggybankjarPath' => "/usr/lib/pig/lib/piggybank.jar"
     , 'paramPath'        => "$ENV{PH_ROOT}/paramfiles"
-    , 'piggybankjarPath' => "/usr/lib/pig"
     , 'pigpath'          => "/usr"
     , 'oldpigpath'       => "$ENV{PH_OLDPIG}"
     , 'hcatbin'          => "$ENV{HCAT_BIN}"
diff --git a/test/e2e/pig/conf/tez.conf b/test/e2e/pig/conf/tez.conf
index 08fffcab7..1f97dbbe0 100644
--- a/test/e2e/pig/conf/tez.conf
+++ b/test/e2e/pig/conf/tez.conf
@@ -43,7 +43,7 @@ $cfg = {
     #TEST
     , 'benchmarkPath'    => "$ENV{PH_OUT}/benchmarks"
     , 'scriptPath'       => "$ENV{PH_ROOT}/libexec"
-    , 'tmpPath'          => '/tmp/pigtest'
+    , 'tmpPath'          => 'tmp/pigtest'
 
     #PIG
     , 'testconfigpath'   => "$ENV{HADOOP_CONF_DIR}"
diff --git a/test/e2e/pig/tests/grunt.conf b/test/e2e/pig/tests/grunt.conf
index 583bcf971..79cb6a909 100644
--- a/test/e2e/pig/tests/grunt.conf
+++ b/test/e2e/pig/tests/grunt.conf
@@ -44,7 +44,7 @@ $cfg = {
                         'num' => 2,
                         'pig' => "pwd",
                         'execonly' => 'mapred,tez', # don't have a clue what their cwd will be for local mode
-                        'expected_out_regex' => "hdfs:",
+                        'expected_out_regex' => "/user",
                         'rc' => 0
 
                       },{
@@ -55,10 +55,8 @@ $cfg = {
 
                       },{
                         'num' => 6,
-                        'pig' => q\
-sh touch /bin/bad
-\,
-                          ,'expected_err_regex' => "Permission denied"
+                        'pig' => "cat nonexist"
+                          ,'expected_err_regex' => "does not exist"
                           ,'rc' => 5
 
                         },{
diff --git a/test/e2e/pig/tests/macro.conf b/test/e2e/pig/tests/macro.conf
index 6e684f256..e73bdec37 100644
--- a/test/e2e/pig/tests/macro.conf
+++ b/test/e2e/pig/tests/macro.conf
@@ -370,13 +370,19 @@ $cfg = {
                           $B = stream $in through CMD as (name, age, gpa);
                       }
 
+                      A = load ':INPATH:/singlefile/studenttab10k' as (name, age, gpa);
+                      x = test(A);
+                      store x into ':OUTPATH:';#,
+          'pig_win' => q#define CMD `perl -ne "print $_;"`;
+                      define test(in) returns B {
+                          $B = stream $in through CMD as (name, age, gpa);
+                      }
+
                       A = load ':INPATH:/singlefile/studenttab10k' as (name, age, gpa);
                       x = test(A);
                       store x into ':OUTPATH:';#,
           'verify_pig_script' => q#A = load ':INPATH:/singlefile/studenttab10k' as (name, age, gpa);
-                                   define CMD `perl -ne 'print $_;'`;
-                                   B = stream A through CMD as (name, age, gpa);
-                                   store B into ':OUTPATH:';#,
+                                   store A into ':OUTPATH:';#,
           'floatpostprocess' => 1,
           'delimiter' => '  ' 
         },
diff --git a/test/e2e/pig/tests/multiquery.conf b/test/e2e/pig/tests/multiquery.conf
index 9c4c5fcd7..a51a30537 100644
--- a/test/e2e/pig/tests/multiquery.conf
+++ b/test/e2e/pig/tests/multiquery.conf
@@ -236,6 +236,14 @@ $cfg = {
                         C = stream B through CMD2 as (name, age, gpa);
                         D = JOIN B by name, C by name;
                         store D into ':OUTPATH:.2'; #,
+            'pig_win' => q# define CMD1 `perl -ne "print $_;"`;
+                        define CMD2 `perl -ne "print $_;"`;
+                        A = load ':INPATH:/singlefile/studenttab10k' as (name, age, gpa);
+                        B = stream A through CMD1 as (name, age, gpa);
+                        store B into ':OUTPATH:.1';
+                        C = stream B through CMD2 as (name, age, gpa);
+                        D = JOIN B by name, C by name;
+                        store D into ':OUTPATH:.2'; #,
             'sql' => "select name, age, gpa from studenttab10k;
                       select A.name, A.age, A.gpa, B.name, B.age, B.gpa 
                       from studenttab10k as A join studenttab10k as B using(name);",
diff --git a/test/e2e/pig/tests/streaming.conf b/test/e2e/pig/tests/streaming.conf
index 30297d21a..8f25ed1ed 100644
--- a/test/e2e/pig/tests/streaming.conf
+++ b/test/e2e/pig/tests/streaming.conf
@@ -406,6 +406,15 @@ B = stream A through CMD1 as (name, age, gpa);
 store B into ':OUTPATH:.intermediate';
 C = stream B through CMD2 as (name, age, gpa);
 D = JOIN B by name, C by name;
+store D into ':OUTPATH:';#,
+			'pig_win' => q#
+define CMD1 `perl -ne "print $_;"`;
+define CMD2 `perl -ne "print $_;"`;
+A = load ':INPATH:/singlefile/studenttab10k' as (name, age, gpa);
+B = stream A through CMD1 as (name, age, gpa);
+store B into ':OUTPATH:.intermediate';
+C = stream B through CMD2 as (name, age, gpa);
+D = JOIN B by name, C by name;
 store D into ':OUTPATH:';#,
                         'notmq' => 1,
                         'sql' => "select A.name, A.age, A.gpa, B.name, B.age, B.gpa from studenttab10k as A join studenttab10k as B using(name);",	
@@ -421,6 +430,14 @@ A = load ':INPATH:/singlefile//studenttab10k';
 B = stream A through CMD1;
 C = stream B through CMD1;
 D = stream C through CMD2;
+store D into ':OUTPATH:';#,
+			'pig_win' => q#
+define CMD1 `perl -ne "print $_;print STDERR "stderr $_";"`;
+define CMD2 `Split.pl 3` input(stdin using PigStreaming(',')) ship(':SCRIPTHOMEPATH:/Split.pl');
+A = load ':INPATH:/singlefile//studenttab10k';
+B = stream A through CMD1;
+C = stream B through CMD1;
+D = stream C through CMD2;
 store D into ':OUTPATH:';#,
                         'sql' => "select name, age, gpa from studenttab10k;",	
 			},
@@ -437,6 +454,16 @@ store B into ':OUTPATH:.intermediate';
 C = stream B through CMD1;
 D = stream C through CMD2;
 E = JOIN B by $0, D by $0;
+store E into ':OUTPATH:';#,
+			'pig_win' => q#
+define CMD1 `perl -ne "print $_;"`;
+define CMD2 `Split.pl 3` input(stdin using PigStreaming(',')) ship(':SCRIPTHOMEPATH:/Split.pl');
+A = load ':INPATH:/singlefile/studenttab10k';
+B = stream A through CMD1;
+store B into ':OUTPATH:.intermediate';
+C = stream B through CMD1;
+D = stream C through CMD2;
+E = JOIN B by $0, D by $0;
 store E into ':OUTPATH:';#,
                         'notmq' => 1,
                         'sql' => "select A.name, A.age, A.gpa, B.name, B.age, B.gpa from studenttab10k as A join studenttab10k as B using(name);",	
diff --git a/test/e2e/pig/udfs/java/build.xml b/test/e2e/pig/udfs/java/build.xml
index 6f46969b0..bbd918f83 100644
--- a/test/e2e/pig/udfs/java/build.xml
+++ b/test/e2e/pig/udfs/java/build.xml
@@ -21,17 +21,26 @@
     <property name="pig.jarfile" value="${lib.dir}/pig.jar" /> -->
     <property name="udf.src.dir" value="${basedir}/org/" />
 
-
     <path id="udf-classpath">
     <!-- <fileset dir="lib">
             <include name="**/*.jar"/> 
     </fileset>-->
-        <fileset dir="${pig.base.dir}/build/ivy/lib/Pig">
+        <fileset dir="${pig.base.dir}/build/ivy/lib/Pig" erroronmissingdir="false">
             <include name="*.jar"/>
         </fileset>
-        <fileset dir="${pig.base.dir}">
+        <fileset dir="${pig.dir}">
             <include name="pig*-core-*.jar"/>
         </fileset>
+        <fileset dir="${hadoop.common.dir}" erroronmissingdir="false">
+            <include name="hadoop-common*.jar"/>
+        </fileset>
+        <fileset dir="${hadoop.common.lib.dir}" erroronmissingdir="false">
+            <include name="commons-codec*.jar"/>
+            <include name="commons-logging*.jar"/>
+        </fileset>
+        <fileset dir="${hadoop.mapreduce.dir}" erroronmissingdir="false">
+            <include name="hadoop-mapreduce-client-core*.jar"/>
+        </fileset>
     </path>
 
     <target name="init">
