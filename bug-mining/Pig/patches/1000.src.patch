diff --git a/CHANGES.txt b/CHANGES.txt
index 9eea6457e..64a34ee37 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -24,6 +24,8 @@ INCOMPATIBLE CHANGES
 
 IMPROVEMENTS
 
+PIG-2820: relToAbsolutePath is not replayed properly when Grunt reparses the script after PIG-2699 (julien)
+
 PIG-2763: Groovy UDFs (herberts via julien)
 
 PIG-2780: MapReduceLauncher should break early when one of the jobs throws an exception (jay23jack via daijy)
diff --git a/src/org/apache/pig/parser/LogicalPlanBuilder.java b/src/org/apache/pig/parser/LogicalPlanBuilder.java
index 653f6f524..1af87dc49 100644
--- a/src/org/apache/pig/parser/LogicalPlanBuilder.java
+++ b/src/org/apache/pig/parser/LogicalPlanBuilder.java
@@ -94,15 +94,18 @@ import org.apache.pig.newplan.logical.visitor.ProjStarInUdfExpander;
 import org.apache.pig.newplan.logical.visitor.ProjectStarExpander;
 
 public class LogicalPlanBuilder {
+
     private LogicalPlan plan = new LogicalPlan();
 
     private Map<String, Operator> operators = new HashMap<String, Operator>();
-    
+
     Map<String, String> fileNameMap;
-    
+
     private PigContext pigContext = null;
     private String scope = null;
     private IntStream intStream;
+    private int storeIndex = 0;
+    private int loadIndex = 0;
     
     private static NodeIdGenerator nodeIdGen = NodeIdGenerator.getGenerator();
     
@@ -654,15 +657,15 @@ public class LogicalPlanBuilder {
                         funcSpec;
 
             loFunc = (LoadFunc)PigContext.instantiateFuncFromSpec(instantiatedFuncSpec);
-            String sig = QueryParserUtils.constructFileNameSignature(filename, instantiatedFuncSpec);
-            absolutePath = fileNameMap.get(sig);
+            String fileNameKey = QueryParserUtils.constructFileNameSignature(filename, instantiatedFuncSpec) + "_" + (loadIndex++);
+            absolutePath = fileNameMap.get(fileNameKey);
             if (absolutePath == null) {
                 absolutePath = loFunc.relativeToAbsolutePath( filename, QueryParserUtils.getCurrentDir( pigContext ) );
 
                 if (absolutePath!=null) {
                     QueryParserUtils.setHdfsServers( absolutePath, pigContext );
                 }
-                fileNameMap.put( sig, absolutePath );
+                fileNameMap.put( fileNameKey, absolutePath );
             }
         } catch(Exception ex) {
             throw new ParserValidationException( intStream, loc, ex );
@@ -714,9 +717,9 @@ public class LogicalPlanBuilder {
                             funcSpec;
 
             StoreFuncInterface stoFunc = (StoreFuncInterface)PigContext.instantiateFuncFromSpec(instantiatedFuncSpec);
-            String sig = inputAlias + "_" + newOperatorKey();
-            stoFunc.setStoreFuncUDFContextSignature(sig);
-            String absolutePath = fileNameMap.get(sig);
+            String fileNameKey = inputAlias + "_" + (storeIndex++) ;
+            stoFunc.setStoreFuncUDFContextSignature(fileNameKey);
+            String absolutePath = fileNameMap.get(fileNameKey);
             if (absolutePath == null) {
                 absolutePath = stoFunc.relToAbsPathForStoreLocation(
                         filename,
@@ -724,10 +727,10 @@ public class LogicalPlanBuilder {
                 if (absolutePath!=null) {
                     QueryParserUtils.setHdfsServers(absolutePath, pigContext);
                 }
-                fileNameMap.put(sig, absolutePath);
+                fileNameMap.put(fileNameKey, absolutePath);
             }
             FileSpec fileSpec = new FileSpec(absolutePath, funcSpec);
-            LOStore op = new LOStore(plan, fileSpec, stoFunc, sig);
+            LOStore op = new LOStore(plan, fileSpec, stoFunc, inputAlias + "_" + newOperatorKey());
             return buildOp(loc, op, alias, inputAlias, null);
         } catch(Exception ex) {
             throw new ParserValidationException(intStream, loc, ex);
diff --git a/test/org/apache/pig/test/TestGrunt.java b/test/org/apache/pig/test/TestGrunt.java
index 39ffecbcd..02a850032 100644
--- a/test/org/apache/pig/test/TestGrunt.java
+++ b/test/org/apache/pig/test/TestGrunt.java
@@ -17,16 +17,28 @@
  */
 package org.apache.pig.test;
 
-import static org.junit.Assert.*;
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertFalse;
+import static org.junit.Assert.assertTrue;
+import static org.junit.Assert.fail;
 
-import org.junit.AfterClass;
-import org.junit.BeforeClass;
-import org.junit.Test;
-import org.junit.runner.RunWith;
-import org.junit.runners.JUnit4;
+import java.io.BufferedReader;
+import java.io.ByteArrayInputStream;
+import java.io.File;
+import java.io.FileInputStream;
+import java.io.FileReader;
+import java.io.FileWriter;
+import java.io.InputStream;
+import java.io.InputStreamReader;
+import java.io.PrintWriter;
+import java.io.StringReader;
+import java.io.StringWriter;
+import java.util.ArrayList;
+import java.util.List;
+import java.util.Properties;
 
 import junit.framework.Assert;
-import junit.framework.TestCase;
+
 import org.apache.log4j.Appender;
 import org.apache.log4j.FileAppender;
 import org.apache.log4j.PatternLayout;
@@ -37,28 +49,15 @@ import org.apache.pig.backend.executionengine.ExecException;
 import org.apache.pig.backend.executionengine.ExecJob;
 import org.apache.pig.backend.executionengine.ExecJob.JOB_STATUS;
 import org.apache.pig.impl.PigContext;
+import org.apache.pig.impl.io.FileLocalizer;
+import org.apache.pig.impl.logicalLayer.FrontendException;
 import org.apache.pig.test.Util.ProcessReturnInfo;
 import org.apache.pig.tools.grunt.Grunt;
 import org.apache.pig.tools.parameters.ParameterSubstitutionPreprocessor;
 import org.apache.pig.tools.pigscript.parser.ParseException;
-import org.apache.pig.tools.pigstats.ScriptState;
-import org.apache.pig.impl.io.FileLocalizer;
-import org.apache.pig.impl.logicalLayer.FrontendException;
-
-import java.io.ByteArrayInputStream;
-import java.io.File;
-import java.io.FileInputStream;
-import java.io.FileReader;
-import java.io.FileWriter;
-import java.io.InputStream;
-import java.io.InputStreamReader;
-import java.io.BufferedReader;
-import java.io.PrintWriter;
-import java.io.StringReader;
-import java.io.StringWriter;
-import java.util.ArrayList;
-import java.util.List;
-import java.util.Properties;
+import org.junit.AfterClass;
+import org.junit.BeforeClass;
+import org.junit.Test;
 
 public class TestGrunt {
  
@@ -796,7 +795,7 @@ public class TestGrunt {
     public void testCD() throws Throwable {
         PigServer server = new PigServer(ExecType.MAPREDUCE, cluster.getProperties());
         PigContext context = server.getPigContext();
-        
+
         String strCmd = 
             "mkdir /tmp;"
             +"mkdir /tmp/foo;"
@@ -989,38 +988,30 @@ public class TestGrunt {
     }
     
     @Test
-    public void testFsCommand(){
-        
-        try {
-            PigServer server = new PigServer(ExecType.MAPREDUCE,cluster.getProperties());
-            PigContext context = server.getPigContext();
-            
-            String strCmd = 
+    public void testFsCommand() throws Throwable {
+
+        PigServer server = new PigServer(ExecType.MAPREDUCE,cluster.getProperties());
+        PigContext context = server.getPigContext();
+
+        String strCmd = 
                 "fs -ls /;"
-                +"fs -mkdir /fstmp;"
-                +"fs -mkdir /fstmp/foo;"
-                +"cd /fstmp;"                
-                +"fs -copyFromLocal test/org/apache/pig/test/data/passwd bar;"
-                +"a = load 'bar';"
-                +"cd foo;"
-                +"store a into 'baz';"
-                +"cd /;"
-                +"fs -ls .;"
-                +"fs -rmr /fstmp/foo/baz;";
-            
-            ByteArrayInputStream cmd = new ByteArrayInputStream(strCmd.getBytes());
-            InputStreamReader reader = new InputStreamReader(cmd);
-            
-            Grunt grunt = new Grunt(new BufferedReader(reader), context);
-            grunt.exec();
+                        +"fs -mkdir /fstmp;"
+                        +"fs -mkdir /fstmp/foo;"
+                        +"cd /fstmp;"                
+                        +"fs -copyFromLocal test/org/apache/pig/test/data/passwd bar;"
+                        +"a = load 'bar';"
+                        +"cd foo;"
+                        +"store a into 'baz';"
+                        +"cd /;"
+                        +"fs -ls .;"
+                        +"fs -rmr /fstmp/foo/baz;";
+
+        ByteArrayInputStream cmd = new ByteArrayInputStream(strCmd.getBytes());
+        InputStreamReader reader = new InputStreamReader(cmd);
+
+        Grunt grunt = new Grunt(new BufferedReader(reader), context);
+        grunt.exec();
 
-        } catch (ExecException e) {
-            e.printStackTrace();
-            fail();
-        } catch (Throwable e) {
-            e.printStackTrace(System.out);
-            fail();
-        }
     }
    
     @Test
@@ -1163,7 +1154,8 @@ public class TestGrunt {
         Grunt grunt = new Grunt(new BufferedReader(reader), context);
 
         grunt.exec();
-        assertTrue(context.extraJars.contains(ClassLoader.getSystemResource("pig-withouthadoop.jar")));
+        assertEquals(context.extraJars+ " of size 1", 1, context.extraJars.size());
+        assertTrue(context.extraJars.get(0)+" ends with /pig-withouthadoop.jar", context.extraJars.get(0).toString().endsWith("/pig-withouthadoop.jar"));
     }
     
     @Test    
@@ -1179,7 +1171,8 @@ public class TestGrunt {
         Grunt grunt = new Grunt(new BufferedReader(reader), context);
 
         grunt.exec();
-        assertTrue(context.extraJars.contains(ClassLoader.getSystemResource("pig-withouthadoop.jar")));
+        assertEquals(context.extraJars+ " of size 1", 1, context.extraJars.size());
+        assertTrue(context.extraJars.get(0)+" ends with /pig-withouthadoop.jar", context.extraJars.get(0).toString().endsWith("/pig-withouthadoop.jar"));
     }
     
     @Test
