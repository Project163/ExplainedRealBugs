diff --git a/CHANGES.txt b/CHANGES.txt
index 1a51d997e..a53941bf4 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -290,6 +290,8 @@ BUG FIXES
 
 PIG-2320: Error: "projection with nothing to reference" (daijy)
 
+PIG-2346: TypeCastInsert should not insert Foreach if there is no as statement (daijy)
+
 Release 0.9.1 - Unreleased
 
 IMPROVEMENTS
diff --git a/src/org/apache/pig/newplan/logical/relational/LOLoad.java b/src/org/apache/pig/newplan/logical/relational/LOLoad.java
index 9b8ff21e7..c19505ea7 100644
--- a/src/org/apache/pig/newplan/logical/relational/LOLoad.java
+++ b/src/org/apache/pig/newplan/logical/relational/LOLoad.java
@@ -278,4 +278,8 @@ public class LOLoad extends LogicalRelationalOperator {
         this.signature = signature;
         loadFunc.setUDFContextSignature(signature);
     }
+    
+    public LogicalSchema getScriptSchema() {
+        return scriptSchema;
+    }
 }
diff --git a/src/org/apache/pig/newplan/logical/relational/LOStream.java b/src/org/apache/pig/newplan/logical/relational/LOStream.java
index e1e487a4e..7b2b945be 100644
--- a/src/org/apache/pig/newplan/logical/relational/LOStream.java
+++ b/src/org/apache/pig/newplan/logical/relational/LOStream.java
@@ -113,4 +113,8 @@ public class LOStream extends LogicalRelationalOperator {
     public void resetUid() {
         uidOnlySchema = null;
     }
+    
+    public LogicalSchema getScriptSchema() {
+        return scriptSchema;
+    }
 }
diff --git a/src/org/apache/pig/newplan/logical/rules/TypeCastInserter.java b/src/org/apache/pig/newplan/logical/rules/TypeCastInserter.java
index a1fbffc65..a526a372d 100644
--- a/src/org/apache/pig/newplan/logical/rules/TypeCastInserter.java
+++ b/src/org/apache/pig/newplan/logical/rules/TypeCastInserter.java
@@ -77,9 +77,11 @@ public abstract class TypeCastInserter extends Rule {
             if (s == null) return false;
     
             if (op instanceof LOLoad) {
+                if (((LOLoad)op).getScriptSchema()==null) return false;
                 if (((LOLoad)op).isCastInserted()) return false;
             }
             else {
+                if (((LOStream)op).getScriptSchema()==null) return false;
                 if (((LOStream)op).isCastInserted()) return false;
             }
             
diff --git a/test/org/apache/pig/test/TestPartitionFilterPushDown.java b/test/org/apache/pig/test/TestPartitionFilterPushDown.java
index 27bd25a00..de7fa1ec3 100644
--- a/test/org/apache/pig/test/TestPartitionFilterPushDown.java
+++ b/test/org/apache/pig/test/TestPartitionFilterPushDown.java
@@ -568,7 +568,7 @@ public class TestPartitionFilterPushDown {
             Assert.assertTrue(!(iter.next() instanceof LOFilter));
             counter++;
         }      
-        Assert.assertEquals(counter, 7);
+        Assert.assertEquals(counter, 5);
     }
 
     //// helper methods ///////
diff --git a/test/org/apache/pig/test/TestPlanGeneration.java b/test/org/apache/pig/test/TestPlanGeneration.java
index dc79f1fde..15f2ee842 100644
--- a/test/org/apache/pig/test/TestPlanGeneration.java
+++ b/test/org/apache/pig/test/TestPlanGeneration.java
@@ -17,11 +17,18 @@
  */
 package org.apache.pig.test;
 
+import java.io.IOException;
 import java.util.Properties;
 
 import junit.framework.Assert;
 
+import org.apache.hadoop.mapreduce.Job;
 import org.apache.pig.ExecType;
+import org.apache.pig.Expression;
+import org.apache.pig.LoadFunc;
+import org.apache.pig.LoadMetadata;
+import org.apache.pig.ResourceSchema;
+import org.apache.pig.ResourceStatistics;
 import org.apache.pig.backend.executionengine.ExecException;
 import org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.MapReduceOper;
 import org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.plans.MROperPlan;
@@ -29,17 +36,25 @@ import org.apache.pig.backend.hadoop.executionengine.physicalLayer.expressionOpe
 import org.apache.pig.backend.hadoop.executionengine.physicalLayer.plans.PhysicalPlan;
 import org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POSort;
 import org.apache.pig.backend.hadoop.executionengine.physicalLayer.relationalOperators.POStore;
+import org.apache.pig.builtin.PigStorage;
 import org.apache.pig.data.DataType;
 import org.apache.pig.impl.PigContext;
+import org.apache.pig.impl.logicalLayer.FrontendException;
+import org.apache.pig.impl.logicalLayer.schema.Schema;
+import org.apache.pig.impl.util.Utils;
 import org.apache.pig.newplan.Operator;
 import org.apache.pig.newplan.logical.expression.LogicalExpression;
 import org.apache.pig.newplan.logical.relational.LOCogroup;
+import org.apache.pig.newplan.logical.relational.LOFilter;
 import org.apache.pig.newplan.logical.relational.LOForEach;
+import org.apache.pig.newplan.logical.relational.LOLoad;
 import org.apache.pig.newplan.logical.relational.LOSort;
 import org.apache.pig.newplan.logical.relational.LOStore;
 import org.apache.pig.newplan.logical.relational.LogicalPlan;
 import org.apache.pig.newplan.logical.relational.LogicalSchema;
 import org.apache.pig.newplan.logical.relational.LogicalSchema.LogicalFieldSchema;
+import org.apache.pig.parser.ParserException;
+import org.apache.pig.test.TestPartitionFilterPushDown.TestLoader;
 import org.junit.BeforeClass;
 import org.junit.Test;
 
@@ -191,4 +206,49 @@ public class TestPlanGeneration extends junit.framework.TestCase {
         LogicalPlan lp = Util.parse(query, pc);
         Util.optimizeNewLP(lp);
     }
+    
+    public static class SchemaLoader extends PigStorage implements LoadMetadata {
+
+        Schema schema;
+        public SchemaLoader(String schemaString) throws ParserException {
+            schema = Utils.getSchemaFromString(schemaString);
+        }
+        @Override
+        public ResourceSchema getSchema(String location, Job job)
+                throws IOException {
+            return new ResourceSchema(schema);
+        }
+
+        @Override
+        public ResourceStatistics getStatistics(String location, Job job)
+                throws IOException {
+            return null;
+        }
+
+        @Override
+        public String[] getPartitionKeys(String location, Job job)
+                throws IOException {
+            return null;
+        }
+
+        @Override
+        public void setPartitionFilter(Expression partitionFilter)
+                throws IOException {
+        }
+    }
+    
+    @Test
+    public void testLoaderWithSchema() throws Exception {
+        String query = "a = load 'foo' using " + SchemaLoader.class.getName() + "('name,age,gpa');\n"
+                + "b = filter a by age==20;"
+                + "store b into 'output';";
+        LogicalPlan lp = Util.parse(query, pc);
+        Util.optimizeNewLP(lp);
+        
+        LOLoad loLoad = (LOLoad)lp.getSources().get(0);
+        LOFilter loFilter = (LOFilter)lp.getSuccessors(loLoad).get(0);
+        LOStore loStore = (LOStore)lp.getSuccessors(loFilter).get(0);
+        
+        Assert.assertTrue(lp.getSuccessors(loStore)==null);
+    }
 }
