diff --git a/CHANGES.txt b/CHANGES.txt
index 40d261adb..b01135652 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -225,6 +225,9 @@ PIG-1309: Map-side Cogroup (ashutoshc)
 
 BUG FIXES
 
+PIG-1751: New logical plan: PushDownForEachFlatten fail in UDF with unknown
+output schema (daijy)
+
 PIG-1741: Lineage fail when flatten a bag (daijy)
 
 PIG-1739: zero status is returned when pig script fails (yanz)
diff --git a/src/org/apache/pig/newplan/logical/rules/PushDownForEachFlatten.java b/src/org/apache/pig/newplan/logical/rules/PushDownForEachFlatten.java
index 9edbaf5aa..36ee625ce 100644
--- a/src/org/apache/pig/newplan/logical/rules/PushDownForEachFlatten.java
+++ b/src/org/apache/pig/newplan/logical/rules/PushDownForEachFlatten.java
@@ -164,7 +164,7 @@ public class PushDownForEachFlatten extends Rule {
         } 
         
         private List<ProjectExpression> getProjectExpressions(LogicalExpressionPlan expr) {
-            List<Operator> ops = expr.getSources();
+            List<Operator> ops = expr.getSinks();
             List<ProjectExpression> projs = new ArrayList<ProjectExpression>( ops.size() );
             for( Operator op : ops ) {
                 if( op instanceof ProjectExpression ) {
diff --git a/test/org/apache/pig/test/TestNewPlanPushDownForeachFlatten.java b/test/org/apache/pig/test/TestNewPlanPushDownForeachFlatten.java
index 4a16a8dbf..37abcd3b3 100644
--- a/test/org/apache/pig/test/TestNewPlanPushDownForeachFlatten.java
+++ b/test/org/apache/pig/test/TestNewPlanPushDownForeachFlatten.java
@@ -1039,6 +1039,20 @@ public class TestNewPlanPushDownForeachFlatten {
         Assert.assertTrue(foreach.getSchema().getField(1).alias.equals("q1"));
         Assert.assertTrue(foreach.getSchema().getField(2).alias.equals("q2"));
     }
+    
+    // See PIG-1751
+    @Test
+    public void testForeachWithUserDefinedSchema2() throws Exception {
+        planTester.buildPlan("a = load '1.txt' as (a0:chararray);");
+        planTester.buildPlan("b = load '2.txt' as (b0:chararray);");
+        planTester.buildPlan("c = foreach b generate flatten(STRSPLIT(b0)) as c0;");
+        org.apache.pig.impl.logicalLayer.LogicalPlan  lp = planTester.buildPlan("d = join c by (chararray)c0, a by a0;");
+        
+        LogicalPlan newLogicalPlan = migrateAndOptimizePlan( lp );
+        
+        Operator op = newLogicalPlan.getSinks().get( 0 );
+        Assert.assertTrue(op instanceof LOJoin);
+    }
 
     public class MyPlanOptimizer extends LogicalPlanOptimizer {
         protected MyPlanOptimizer(OperatorPlan p,  int iterations) {
