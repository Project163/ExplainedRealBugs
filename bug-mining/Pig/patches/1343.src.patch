diff --git a/CHANGES.txt b/CHANGES.txt
index 40df81012..d7ec6043d 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -76,6 +76,8 @@ OPTIMIZATIONS
  
 BUG FIXES
 
+PIG-3722: Udf deserialization for registered classes fails in local_mode (aniket486)
+
 PIG-3641: Split "otherwise" producing incorrect output when combined with ColumnPruning (knoguchi)
 
 PIG-3682: mvn-inst target does not install pig-h2.jar into local .m2 (raluri via aniket486)
diff --git a/src/org/apache/pig/impl/util/ObjectSerializer.java b/src/org/apache/pig/impl/util/ObjectSerializer.java
index 82faaad5f..0b0a76930 100644
--- a/src/org/apache/pig/impl/util/ObjectSerializer.java
+++ b/src/org/apache/pig/impl/util/ObjectSerializer.java
@@ -29,6 +29,8 @@ import java.util.zip.DeflaterOutputStream;
 import java.util.zip.InflaterInputStream;
 
 import org.apache.commons.codec.binary.Base64;
+import org.apache.commons.io.IOUtils;
+import org.apache.commons.io.input.ClassLoaderObjectInputStream;
 
 public class ObjectSerializer {
 
@@ -51,12 +53,15 @@ public class ObjectSerializer {
     public static Object deserialize(String str) throws IOException {
         if (str == null || str.length() == 0)
             return null;
+        ObjectInputStream objStream = null;
         try {
             ByteArrayInputStream serialObj = new ByteArrayInputStream(decodeBytes(str));
-            ObjectInputStream objStream = new ObjectInputStream(new InflaterInputStream(serialObj));
+            objStream = new ClassLoaderObjectInputStream(Thread.currentThread().getContextClassLoader(), new InflaterInputStream(serialObj));
             return objStream.readObject();
         } catch (Exception e) {
             throw new IOException("Deserialization error: " + e.getMessage(), e);
+        } finally {
+            IOUtils.closeQuietly(objStream);
         }
     }
 
diff --git a/test/org/apache/pig/test/TestRegisteredJarVisibility.java b/test/org/apache/pig/test/TestRegisteredJarVisibility.java
index 120dd3d04..e9850f091 100644
--- a/test/org/apache/pig/test/TestRegisteredJarVisibility.java
+++ b/test/org/apache/pig/test/TestRegisteredJarVisibility.java
@@ -37,23 +37,20 @@ import javax.tools.JavaFileObject;
 import javax.tools.StandardJavaFileManager;
 import javax.tools.ToolProvider;
 
-import com.google.common.collect.Lists;
-import com.google.common.collect.Maps;
-import com.google.common.io.ByteStreams;
-
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
-import org.apache.hadoop.fs.Path;
 import org.apache.pig.ExecType;
 import org.apache.pig.PigServer;
 import org.apache.pig.impl.util.JarManager;
-import org.junit.After;
 import org.junit.AfterClass;
 import org.junit.Assert;
-import org.junit.Before;
 import org.junit.BeforeClass;
 import org.junit.Test;
 
+import com.google.common.collect.Lists;
+import com.google.common.collect.Maps;
+import com.google.common.io.ByteStreams;
+
 /**
  * Ensure classes from a registered jar are available in the UDFContext.
  * Please see PIG-2532 for additional details.
@@ -99,6 +96,7 @@ public class TestRegisteredJarVisibility {
         jar(filesToJar);
 
         cluster = MiniCluster.buildCluster();
+        Util.copyFromLocalToCluster(cluster, INPUT_FILE.getPath(), INPUT_FILE.getName());
     }
 
     @AfterClass()
@@ -116,14 +114,22 @@ public class TestRegisteredJarVisibility {
         }
         Assert.assertTrue(exceptionThrown);
     }
-
-    @Test()
-    public void testRegisteredJarVisibility() throws IOException {
-        Util.copyFromLocalToCluster(cluster, INPUT_FILE.getPath(), INPUT_FILE.getName());
+    
+    @Test
+    public void testRegisterJarVisibilityMR() throws IOException {
         PigServer pigServer = new PigServer(ExecType.MAPREDUCE, cluster.getProperties());
+        testRegisteredJarVisibility(pigServer, INPUT_FILE.getName());
+    }
 
+    @Test
+    public void testRegisteredJarVisibilityLocal() throws IOException {
+        PigServer pigServer = new PigServer(ExecType.LOCAL, new Properties());
+        testRegisteredJarVisibility(pigServer, INPUT_FILE.getAbsolutePath());
+    }
+    
+    public void testRegisteredJarVisibility(PigServer pigServer, String inputPath) throws IOException {
         String query = "register " + jarFile.getAbsolutePath() + ";\n"
-                + "a = load '" + INPUT_FILE.getName()
+                + "a = load '" + inputPath
                 + "' using org.apache.pig.test.RegisteredJarVisibilityLoader();\n"
                 // register again to test classloader consistency
                 + "register " +  jarFile.getAbsolutePath() + ";\n"
