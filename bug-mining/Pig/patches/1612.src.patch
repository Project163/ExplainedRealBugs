diff --git a/CHANGES.txt b/CHANGES.txt
index fb8bae7ab..6ca478d3b 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -105,6 +105,8 @@ OPTIMIZATIONS
  
 BUG FIXES
 
+PIG-4235: Fix unit test failures on Windows (daijy)
+
 PIG-4245: 1-1 edge vertices should use same jvm opts (rohini)
 
 PIG-4252: Tez container reuse fail when using script udf (daijy)
diff --git a/build.xml b/build.xml
index e5855b39e..8c6559eab 100644
--- a/build.xml
+++ b/build.xml
@@ -144,9 +144,8 @@
 
     <!-- env properties -->
     <property environment="env"/>
-    <property name="windows" value="false"/>
     <condition property="isWindows">
-      <equals arg1="${windows}" arg2="true" />
+      <os family="windows"/>
     </condition>
 	
     <target name="setTezEnv">
@@ -915,7 +914,7 @@
             <sysproperty key="hod.server" value="${hod.server}" />
             <sysproperty key="java.io.tmpdir" value="${junit.tmp.dir}" />
             <sysproperty key="hadoop.log.dir" value="${test.log.dir}"/>
-            <jvmarg line="-XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=128M ${debugArgs}"/>
+            <jvmarg line="-XX:+CMSClassUnloadingEnabled -XX:MaxPermSize=128M ${debugArgs} -Djava.library.path=${hadoop.root}\bin"/>
             <sysproperty key="java.security.krb5.realm" value="" />
             <sysproperty key="java.security.krb5.kdc" value="" />
             <sysproperty key="log4j.configuration" value="file:${basedir}/conf/test-log4j.properties"/>
diff --git a/shims/test/hadoop23/org/apache/pig/test/TezMiniCluster.java b/shims/test/hadoop23/org/apache/pig/test/TezMiniCluster.java
index 953477f3f..d2a631e0a 100644
--- a/shims/test/hadoop23/org/apache/pig/test/TezMiniCluster.java
+++ b/shims/test/hadoop23/org/apache/pig/test/TezMiniCluster.java
@@ -65,9 +65,7 @@ public class TezMiniCluster extends MiniGenericCluster {
             CONF_DIR.mkdirs();
 
             // Build mini DFS cluster
-            Configuration hdfsConf = new Configuration(false);
-            hdfsConf.addResource("core-default.xml");
-            hdfsConf.addResource("hdfs-default.xml");
+            Configuration hdfsConf = new Configuration();
             m_dfs = new MiniDFSCluster.Builder(hdfsConf)
                     .numDataNodes(2)
                     .format(true)
diff --git a/src/python/streaming/controller.py b/src/python/streaming/controller.py
index 28dfd1f33..29da765c7 100644
--- a/src/python/streaming/controller.py
+++ b/src/python/streaming/controller.py
@@ -157,7 +157,14 @@ class PythonStreamingController:
         input_str = input_stream.readline()
 
         while input_str.endswith(END_RECORD_DELIM) == False:
-            input_str += input_stream.readline()
+            line = input_stream.readline()
+            if line == '':
+                input_str = ''
+                break
+            input_str += line
+
+        if input_str == '':
+            return END_OF_STREAM
 
         if input_str == TURN_ON_OUTPUT_CAPTURING:
             logging.debug("Turned on Output Capturing")
diff --git a/test/org/apache/pig/backend/hadoop/accumulo/TestAccumuloPigCluster.java b/test/org/apache/pig/backend/hadoop/accumulo/TestAccumuloPigCluster.java
index 2ed49bfc3..7ceebd140 100644
--- a/test/org/apache/pig/backend/hadoop/accumulo/TestAccumuloPigCluster.java
+++ b/test/org/apache/pig/backend/hadoop/accumulo/TestAccumuloPigCluster.java
@@ -93,6 +93,7 @@ public class TestAccumuloPigCluster {
     @AfterClass
     public static void stopClusters() throws Exception {
         accumuloCluster.stop();
+        Thread.sleep(5000);
         FileUtils.deleteDirectory(tmpdir);
     }
 
diff --git a/test/org/apache/pig/builtin/TestOrcStorage.java b/test/org/apache/pig/builtin/TestOrcStorage.java
index 5c31f90c4..197f2c1d4 100644
--- a/test/org/apache/pig/builtin/TestOrcStorage.java
+++ b/test/org/apache/pig/builtin/TestOrcStorage.java
@@ -230,6 +230,7 @@ public class TestOrcStorage {
         assertEquals(t.get(1), "hello");
 
         assertFalse(iter.hasNext());
+        rows.close();
     }
 
     @Test
@@ -348,6 +349,8 @@ public class TestOrcStorage {
         assertEquals(expectedRows, actualRows);
         assertEquals(expectedTotalRows, actualRows);
 
+        readerExpected.close();
+        readerActual.close();
     }
 
     @SuppressWarnings("rawtypes")
diff --git a/test/org/apache/pig/builtin/TestOrcStoragePushdown.java b/test/org/apache/pig/builtin/TestOrcStoragePushdown.java
index 1a3a3ed7f..eadf4c6d7 100644
--- a/test/org/apache/pig/builtin/TestOrcStoragePushdown.java
+++ b/test/org/apache/pig/builtin/TestOrcStoragePushdown.java
@@ -22,8 +22,10 @@ import static org.junit.Assert.assertTrue;
 
 import java.io.BufferedWriter;
 import java.io.File;
+import java.io.FileOutputStream;
 import java.io.FileWriter;
 import java.io.IOException;
+import java.io.OutputStreamWriter;
 import java.math.BigDecimal;
 import java.util.ArrayList;
 import java.util.Arrays;
@@ -72,8 +74,8 @@ public class TestOrcStoragePushdown {
     private OrcStorage orcStorage;
 
     private static final String basedir = "test/org/apache/pig/builtin/orc/";
-    private static final String inpbasedir = System.getProperty("user.dir") + "/build/test/TestOrcStorage_in/";
-    private static final String outbasedir = System.getProperty("user.dir") + "/build/test/TestOrcStorage_out/";
+    private static final String inpbasedir = "build/test/TestOrcStorage_in/";
+    private static final String outbasedir = "build/test/TestOrcStorage_out/";
     private static String INPUT = inpbasedir + "TestOrcStorage_1";
     private static String OUTPUT1 = outbasedir + "TestOrcStorage_1";
     private static String OUTPUT2 = outbasedir + "TestOrcStorage_2";
@@ -125,7 +127,7 @@ public class TestOrcStoragePushdown {
         new File(inpbasedir).mkdirs();
         new File(outbasedir).mkdirs();
         String inputTxtFile = inpbasedir + File.separator + "input.txt";
-        BufferedWriter bw = new BufferedWriter(new FileWriter(inputTxtFile));
+        BufferedWriter bw = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(inputTxtFile), "UTF-8"));
         long[] lVal = new long[] {100L, 200L, 300L};
         float[] fVal = new float[] {50.0f, 100.0f, 200.0f, 300.0f};
         double[] dVal = new double[] {1000.11, 2000.22, 3000.33};
@@ -164,8 +166,8 @@ public class TestOrcStoragePushdown {
         bw.close();
 
         // Store only 1000 rows in each row block (MIN_ROW_INDEX_STRIDE is 1000. So can't use less than that)
-        pigServer.registerQuery("A = load '" + inputTxtFile + "' as (f1:boolean, f2:int, f3:int, f4:int, f5:long, f6:float, f7:double, f8:bytearray, f9:chararray, f10:datetime, f11:bigdecimal);");
-        pigServer.registerQuery("store A into '" + INPUT +"' using OrcStorage('-r 1000 -s 100000');");
+        pigServer.registerQuery("A = load '" + Util.generateURI(inputTxtFile, pigServer.getPigContext()) + "' as (f1:boolean, f2:int, f3:int, f4:int, f5:long, f6:float, f7:double, f8:bytearray, f9:chararray, f10:datetime, f11:bigdecimal);");
+        pigServer.registerQuery("store A into '" + Util.generateURI(INPUT, pigServer.getPigContext()) +"' using OrcStorage('-r 1000 -s 100000');");
         Util.copyFromLocalToCluster(cluster, INPUT, INPUT);
     }
 
diff --git a/test/org/apache/pig/test/TestAlgebraicEvalLocal.java b/test/org/apache/pig/test/TestAlgebraicEvalLocal.java
index b10392de8..ee63c208b 100644
--- a/test/org/apache/pig/test/TestAlgebraicEvalLocal.java
+++ b/test/org/apache/pig/test/TestAlgebraicEvalLocal.java
@@ -92,7 +92,7 @@ public class TestAlgebraicEvalLocal {
                 ps.close();
             }
             pig.registerQuery(" a = group (load '"
-                    + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                    + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                     + "') by ($0,$1);");
             pig.registerQuery("b = foreach a generate flatten(group), SUM($1.$2);");
             Iterator<Tuple> it = pig.openIterator("b");
@@ -141,7 +141,7 @@ public class TestAlgebraicEvalLocal {
             PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
             generateInput(ps, nullFlags[i]);
             String query = "myid =  foreach (group (load '"
-                    + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                    + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                     + "') all) generate COUNT($1);";
             System.out.println(query);
             pig.registerQuery(query);
@@ -163,7 +163,7 @@ public class TestAlgebraicEvalLocal {
             PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
             generateInput(ps, nullFlags[i]);
             String query = "myid = foreach (group (load '"
-                    + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                    + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                     + "') all) generate group, COUNT($1) ;";
             System.out.println(query);
             pig.registerQuery(query);
@@ -184,7 +184,7 @@ public class TestAlgebraicEvalLocal {
             PrintStream ps = new PrintStream(new FileOutputStream(tmpFile));
             generateInput(ps, nullFlags[i]);
             String query = "myid = foreach (group (load '"
-                    + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                    + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                     + "') all) generate COUNT($1), group ;";
             System.out.println(query);
             pig.registerQuery(query);
@@ -227,7 +227,7 @@ public class TestAlgebraicEvalLocal {
             }
             ps.close();
             String query = "myid = foreach (group (load '"
-                    + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                    + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                     + "' using " + PigStorage.class.getName()
                     + "(':')) by $0) generate group, COUNT($1.$1) ;";
             System.out.println(query);
@@ -278,7 +278,7 @@ public class TestAlgebraicEvalLocal {
             }
             ps.close();
             String query = "myid = foreach (group (load '"
-                    + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                    + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                     + "' using "
                     + PigStorage.class.getName()
                     + "(':')) by $0) generate group, COUNT($1.$1), COUNT($1.$0) ;";
@@ -325,4 +325,4 @@ public class TestAlgebraicEvalLocal {
         ps.close();
         return numNulls;
     }
-}
\ No newline at end of file
+}
diff --git a/test/org/apache/pig/test/TestAutoLocalMode.java b/test/org/apache/pig/test/TestAutoLocalMode.java
index b970999c7..47c7e34f1 100644
--- a/test/org/apache/pig/test/TestAutoLocalMode.java
+++ b/test/org/apache/pig/test/TestAutoLocalMode.java
@@ -120,7 +120,7 @@ public class TestAutoLocalMode {
     @Test
     public void testSmallJob() throws IOException {
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(smallFileName), pigServer
+                + Util.generateURI(smallFileName, pigServer
                         .getPigContext()) + "' AS (num:int);");
         pigServer.registerQuery("B = filter A by 1 == 0;");
         pigServer.openIterator("B");
@@ -131,7 +131,7 @@ public class TestAutoLocalMode {
     @Test
     public void testBigJob() throws IOException {
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(bigFileName), pigServer
+                + Util.generateURI(bigFileName, pigServer
                         .getPigContext()) + "' AS (num:int);");
         pigServer.registerQuery("B = filter A by 1 == 0;");
         pigServer.openIterator("B");
@@ -142,10 +142,10 @@ public class TestAutoLocalMode {
     @Test
     public void testReplicatedJoin() throws IOException {
         pigServer.registerQuery("A1 = LOAD '"
-                + Util.generateURI(Util.encodeEscape(smallFileName), pigServer
+                + Util.generateURI(smallFileName, pigServer
                         .getPigContext()) + "' AS (num:int);");
         pigServer.registerQuery("A2 = LOAD '"
-                + Util.generateURI(Util.encodeEscape(miniFileName), pigServer
+                + Util.generateURI(miniFileName, pigServer
                         .getPigContext()) + "' AS (num:int);");
         pigServer.registerQuery("A = join A1 by num, A2 by num using 'replicated';");
         pigServer.registerQuery("B = filter A by 1 == 0;");
@@ -157,7 +157,7 @@ public class TestAutoLocalMode {
     @Test
     public void testOrderBy() throws IOException {
         pigServer.registerQuery("A1 = LOAD '"
-                + Util.generateURI(Util.encodeEscape(bigFileName), pigServer
+                + Util.generateURI(bigFileName, pigServer
                         .getPigContext()) + "' AS (num:int);");
         pigServer.registerQuery("A = filter A1 by num == 1;");
         pigServer.registerQuery("B = order A by num;");
diff --git a/test/org/apache/pig/test/TestBZip.java b/test/org/apache/pig/test/TestBZip.java
index 615396d50..8b7904e40 100644
--- a/test/org/apache/pig/test/TestBZip.java
+++ b/test/org/apache/pig/test/TestBZip.java
@@ -91,7 +91,7 @@ public class TestBZip {
         cos.close();
 
         pig.registerQuery("AA = load '"
-                + Util.generateURI(Util.encodeEscape(in.getAbsolutePath()), pig.getPigContext())
+                + Util.generateURI(in.getAbsolutePath(), pig.getPigContext())
                 + "';");
         pig.registerQuery("A = foreach (group (filter AA by $0 > 0) all) generate flatten($1);");
         pig.registerQuery("store A into '" + Util.encodeEscape(clusterOutput) + "';");
@@ -318,7 +318,7 @@ public class TestBZip {
         System.out.println(in.getAbsolutePath());
 
         pig.registerQuery("AA = load '"
-                + Util.generateURI(Util.encodeEscape(in.getAbsolutePath()), pig.getPigContext())
+                + Util.generateURI(in.getAbsolutePath(), pig.getPigContext())
                 + "';");
         pig.registerQuery("A=foreach (group (filter AA by $0 < '0') all) generate flatten($1);");
         pig.registerQuery("store A into '" + Util.encodeEscape(clusterOutputFilePath) + "';");
diff --git a/test/org/apache/pig/test/TestBlackAndWhitelistValidator.java b/test/org/apache/pig/test/TestBlackAndWhitelistValidator.java
index e1827f8f3..7634100e7 100644
--- a/test/org/apache/pig/test/TestBlackAndWhitelistValidator.java
+++ b/test/org/apache/pig/test/TestBlackAndWhitelistValidator.java
@@ -116,7 +116,7 @@ public class TestBlackAndWhitelistValidator {
 
             StringBuilder script = new StringBuilder();
             script.append("set io.sort.mb 1000;")
-            .append("%declare X `id`; ")
+            .append("%declare X `echo`; ")
             .append("%default input 'foo';")
                     .append("A = LOAD '$input' USING mock.Storage() AS (f1:chararray,f2:int,f3:chararray);")
                     .append("B = order A by f1,f2,f3 DESC;")
diff --git a/test/org/apache/pig/test/TestBuiltin.java b/test/org/apache/pig/test/TestBuiltin.java
index 0b5b5e368..ba9659a25 100644
--- a/test/org/apache/pig/test/TestBuiltin.java
+++ b/test/org/apache/pig/test/TestBuiltin.java
@@ -2854,6 +2854,8 @@ public class TestBuiltin {
     public void testURIwithCurlyBrace() throws Exception {
         String inputFileName = "input.txt";
         String inputFileName1 ="part-1";
+        Util.deleteFile(pigServer.getPigContext(), inputFileName);
+        Util.deleteFile(pigServer.getPigContext(), inputFileName1);
         String[] inputData = new String[] {
                 "1",
                 "a",
diff --git a/test/org/apache/pig/test/TestDataBagAccess.java b/test/org/apache/pig/test/TestDataBagAccess.java
index 058a29ee5..d86ec8952 100644
--- a/test/org/apache/pig/test/TestDataBagAccess.java
+++ b/test/org/apache/pig/test/TestDataBagAccess.java
@@ -89,7 +89,7 @@ public class TestDataBagAccess {
         File input = Util.createInputFile("tmp", "",
                 new String[] {"sampledata\tnot_used"});
         pigServer.registerQuery("a = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext()) + "';");
+                + Util.generateURI(input.toString(), pigServer.getPigContext()) + "';");
         pigServer.registerQuery("b = foreach a generate {(16, 4.0e-2, 'hello', -101)} as mybag:{t:(i: int, d: double, c: chararray, e : int)};");
         pigServer.registerQuery("c = foreach b generate mybag.i, mybag.d, mybag.c, mybag.e;");
         Iterator<Tuple> it = pigServer.openIterator("c");
@@ -112,7 +112,7 @@ public class TestDataBagAccess {
         pigServer.setValidateEachStatement(true);
         try {
             pigServer.registerQuery("a = load '"
-                    + Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext()) + "';");
+                    + Util.generateURI(input.toString(), pigServer.getPigContext()) + "';");
             pigServer.registerQuery("b = foreach a generate {(16, 4.0e-2, 'hello')} as mybag:{t:(i: int, d: double, c: chararray)};");
             pigServer.registerQuery("c = foreach b generate mybag.t;");
             pigServer.explain("c", System.out);
@@ -129,7 +129,7 @@ public class TestDataBagAccess {
         File input = Util.createInputFile("tmp", "",
                 new String[] {"sampledata\tnot_used"});
         pigServer.registerQuery("A = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext()) + "';");
+                + Util.generateURI(input.toString(), pigServer.getPigContext()) + "';");
         pigServer.registerQuery("B = foreach A generate {(('p1-t1-e1', 'p1-t1-e2'),('p1-t2-e1', 'p1-t2-e2'))," +
                 "(('p2-t1-e1', 'p2-t1-e2'), ('p2-t2-e1', 'p2-t2-e2'))};");
         pigServer.registerQuery("C = foreach B generate $0 as pairbag : { pair: ( t1: (e1, e2), t2: (e1, e2) ) };");
@@ -153,7 +153,7 @@ public class TestDataBagAccess {
         File input = Util.createInputFile("tmp", "",
                 new String[] {"somestring\t10\t{(a,10),(b,20)}"});
         pigServer.registerQuery("a = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext())
+                + Util.generateURI(input.toString(), pigServer.getPigContext())
                 + "' " + "as (str:chararray, intval:int, bg:bag{t:tuple(s:chararray, i:int)});");
         pigServer.registerQuery("b = foreach a generate str, intval, flatten(bg);");
         pigServer.registerQuery("c = foreach b generate str, intval, s, i;");
@@ -191,7 +191,7 @@ public class TestDataBagAccess {
         File input = Util.createInputFile("tmp", "",
                 new String[] {"a\tid1", "a\tid2", "a\tid3", "b\tid4", "b\tid5", "b\tid6"});
         pigServer.registerQuery("a = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext())
+                + Util.generateURI(input.toString(), pigServer.getPigContext())
                 + "' " + "as (s:chararray, id:chararray);");
         pigServer.registerQuery("b = group a by s;");
         Class[] loadStoreClasses = new Class[] { BinStorage.class, PigStorage.class };
diff --git a/test/org/apache/pig/test/TestEvalPipeline2.java b/test/org/apache/pig/test/TestEvalPipeline2.java
index e5ab04ee7..18459bb4e 100644
--- a/test/org/apache/pig/test/TestEvalPipeline2.java
+++ b/test/org/apache/pig/test/TestEvalPipeline2.java
@@ -354,7 +354,7 @@ public class TestEvalPipeline2 {
         ps.close();
 
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pigServer
+                + Util.generateURI(tmpFile.toString(), pigServer
                         .getPigContext()) + "' AS (num:int);");
         pigServer.registerQuery("B = order A by num parallel 2;");
         pigServer.registerQuery("C = limit B 10;");
@@ -383,7 +383,7 @@ public class TestEvalPipeline2 {
         ps.close();
 
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pigServer
+                + Util.generateURI(tmpFile.toString(), pigServer
                         .getPigContext()) + "' AS (num:int);");
         pigServer.registerQuery("B = order A by num parallel 2;");
         pigServer.registerQuery("C = limit B 10;");
@@ -416,7 +416,7 @@ public class TestEvalPipeline2 {
         ps.close();
 
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pigServer
+                + Util.generateURI(tmpFile.toString(), pigServer
                         .getPigContext()) + "' AS (num:int);");
         pigServer.registerQuery("B = order A by num desc parallel 2;");
         pigServer.registerQuery("C = limit B 10;");
@@ -463,8 +463,8 @@ public class TestEvalPipeline2 {
         ps2.println("2\t2");
         ps2.close();
 
-        pigServer.registerQuery("A = LOAD '" + Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
-        pigServer.registerQuery("B = LOAD '" + Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' AS (b0, b1);");
+        pigServer.registerQuery("A = LOAD '" + Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("B = LOAD '" + Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' AS (b0, b1);");
         pigServer.registerQuery("C = LIMIT B 100;");
         pigServer.registerQuery("D = COGROUP C BY b0, A BY a0 PARALLEL 2;");
         Iterator<Tuple> iter = pigServer.openIterator("D");
diff --git a/test/org/apache/pig/test/TestEvalPipelineLocal.java b/test/org/apache/pig/test/TestEvalPipelineLocal.java
index 8b4746f11..7582b8f7f 100644
--- a/test/org/apache/pig/test/TestEvalPipelineLocal.java
+++ b/test/org/apache/pig/test/TestEvalPipelineLocal.java
@@ -107,7 +107,7 @@ public class TestEvalPipelineLocal {
         File f1 = createFile(new String[]{"a:1","b:1","a:1"});
 
         pigServer.registerQuery("a = load '"
-                + Util.generateURI(Util.encodeEscape(f1.toString()), pigServer.getPigContext())
+                + Util.generateURI(f1.toString(), pigServer.getPigContext())
                 + "' using " + PigStorage.class.getName() + "(':');");
         pigServer.registerQuery("b = foreach a generate 1-1/1;");
         Iterator<Tuple> iter  = pigServer.openIterator("b");
@@ -125,10 +125,10 @@ public class TestEvalPipelineLocal {
         File f2 = createFile(new String[]{"b","b","a"});
         
         pigServer.registerQuery("a = load '"
-                + Util.generateURI(Util.encodeEscape(f1.toString()), pigServer.getPigContext())
+                + Util.generateURI(f1.toString(), pigServer.getPigContext())
                 + "' using " + PigStorage.class.getName() + "(':');");
         pigServer.registerQuery("b = load '"
-                + Util.generateURI(Util.encodeEscape(f2.toString()), pigServer.getPigContext())
+                + Util.generateURI(f2.toString(), pigServer.getPigContext())
                 + "';");
         pigServer.registerQuery("c = cogroup a by $0, b by $0;");        
         pigServer.registerQuery("d = foreach c generate flatten($1),flatten($2);");
@@ -151,7 +151,7 @@ public class TestEvalPipelineLocal {
         pw.println("a");
         pw.close();
         pigServer.registerQuery("a = foreach (load '"
-                + Util.generateURI(Util.encodeEscape(f.toString()), pigServer.getPigContext())
+                + Util.generateURI(f.toString(), pigServer.getPigContext())
                 + "') generate 1, flatten(" + MyBagFunction.class.getName()
                 + "(*));");
 //        pigServer.registerQuery("b = foreach a generate $0, flatten($1);");
@@ -340,11 +340,11 @@ public class TestEvalPipelineLocal {
         expectedResults.put("conference", 1);
         
         pigServer.registerQuery("newsArticles = LOAD '"
-                + Util.generateURI(Util.encodeEscape(newsFile.toString()), pigServer
+                + Util.generateURI(newsFile.toString(), pigServer
                         .getPigContext()) + "' USING "
                 + TextLoader.class.getName() + "();");
         pigServer.registerQuery("queryLog = LOAD '"
-                + Util.generateURI(Util.encodeEscape(queryLogFile.toString()), pigServer
+                + Util.generateURI(queryLogFile.toString(), pigServer
                         .getPigContext()) + "';");
 
         pigServer.registerQuery("titleNGrams = FOREACH newsArticles GENERATE flatten(" + TitleNGrams.class.getName() + "(*));");
@@ -401,7 +401,7 @@ public class TestEvalPipelineLocal {
         
         String tmpOutputFile = FileLocalizer.getTemporaryPath(pigServer.getPigContext()).toString();
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pigServer
+                + Util.generateURI(tmpFile.toString(), pigServer
                         .getPigContext()) + "';");
         if (eliminateDuplicates){
             pigServer.registerQuery("B = DISTINCT (FOREACH A GENERATE $0) PARALLEL 10;");
@@ -448,7 +448,7 @@ public class TestEvalPipelineLocal {
         ps.close();
 
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pigServer
+                + Util.generateURI(tmpFile.toString(), pigServer
                         .getPigContext()) + "';");
         pigServer.registerQuery("B = group A by $0;");
         String query = "C = foreach B {"
@@ -488,7 +488,7 @@ public class TestEvalPipelineLocal {
         ps.close();
 
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pigServer
+                + Util.generateURI(tmpFile.toString(), pigServer
                         .getPigContext()) + "';");
         pigServer.registerQuery("B = group A by $0;");
         String query = "C = foreach B {"
@@ -530,7 +530,7 @@ public class TestEvalPipelineLocal {
         ps.close();
 
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pigServer
+                + Util.generateURI(tmpFile.toString(), pigServer
                         .getPigContext()) + "';");
         pigServer.registerQuery("B = limit A 5;");
         Iterator<Tuple> iter = pigServer.openIterator("B");
@@ -550,7 +550,7 @@ public class TestEvalPipelineLocal {
                 new String[] {"{(f1, f2),(f3, f4)}\t(1,2)\t[key1#value1,key2#value2]"});
         
         pigServer.registerQuery("a = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext())
+                + Util.generateURI(input.toString(), pigServer.getPigContext())
                 + "' using PigStorage() "
                 + "as (b:bag{t:tuple(x,y)}, t2:tuple(a,b), m:map[]);");
         pigServer.registerQuery("b = foreach a generate COUNT(b), t2.a, t2.b, m#'key1', m#'key2';");
@@ -564,7 +564,7 @@ public class TestEvalPipelineLocal {
         
         //test with BinStorage
         pigServer.registerQuery("a = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext())
+                + Util.generateURI(input.toString(), pigServer.getPigContext())
                 + "' using PigStorage() "
                 + "as (b:bag{t:tuple(x,y)}, t2:tuple(a,b), m:map[]);");
         String output = "./TestEvalPipeline-testComplexData";
@@ -781,7 +781,7 @@ public class TestEvalPipelineLocal {
         ps.close();
 
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pigServer
+                + Util.generateURI(tmpFile.toString(), pigServer
                         .getPigContext()) + "';");
         pigServer.registerQuery("B = foreach A generate "
                 + MapUDF.class.getName() + "($0) as mymap;"); // the argument
@@ -825,7 +825,7 @@ public class TestEvalPipelineLocal {
         ps.close();
 
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pigServer
+                + Util.generateURI(tmpFile.toString(), pigServer
                         .getPigContext()) + "';");
         pigServer.registerQuery("B = foreach A generate "
                 + MapUDF.class.getName() + "($0) as mymap;"); // the argument
@@ -873,7 +873,7 @@ public class TestEvalPipelineLocal {
         ps.close();
 
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pigServer
+                + Util.generateURI(tmpFile.toString(), pigServer
                         .getPigContext()) + "';");
         pigServer.registerQuery("B = group A by $0;");
         String query = "C = foreach B {"
@@ -916,7 +916,7 @@ public class TestEvalPipelineLocal {
         ps.close();
 
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pigServer
+                + Util.generateURI(tmpFile.toString(), pigServer
                         .getPigContext()) + "';");
         pigServer.registerQuery("B = distinct A;");
         String query = "C = foreach B {"
@@ -964,7 +964,7 @@ public class TestEvalPipelineLocal {
         ps.close();
 
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pigServer
+                + Util.generateURI(tmpFile.toString(), pigServer
                         .getPigContext()) + "';");
         pigServer.registerQuery("B = distinct A;");
         String query = "C = foreach B {"
@@ -1006,7 +1006,7 @@ public class TestEvalPipelineLocal {
         ps.close();
 
         pigServer.registerQuery("A = LOAD '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pigServer
+                + Util.generateURI(tmpFile.toString(), pigServer
                         .getPigContext()) + "';");
         pigServer.registerQuery("B = distinct A ;"); //the argument does not matter
         pigServer.registerQuery("C = foreach B generate FLATTEN(" + Identity.class.getName() + "($0, $1));"); //the argument does not matter
@@ -1088,7 +1088,7 @@ public class TestEvalPipelineLocal {
     @Test
     public void testSetLocationCalledInFE() throws Exception {
         File f1 = createFile(new String[]{"a","b"});
-        pigServer.registerQuery("a = load '" + Util.generateURI(Util.encodeEscape(f1.toString()), pigServer.getPigContext())
+        pigServer.registerQuery("a = load '" + Util.generateURI(f1.toString(), pigServer.getPigContext())
                 + "' using " + SetLocationTestLoadFunc.class.getName()
                 + "();");
         pigServer.registerQuery("b = order a by $0;");
@@ -1101,7 +1101,7 @@ public class TestEvalPipelineLocal {
     @Test
     public void testGroupByTuple() throws Exception {
         File f1 = createFile(new String[]{"1\t2\t3","4\t5\t6"});
-        pigServer.registerQuery("a = load '" + Util.generateURI(Util.encodeEscape(f1.toString()), pigServer.getPigContext())
+        pigServer.registerQuery("a = load '" + Util.generateURI(f1.toString(), pigServer.getPigContext())
                 + "' as (x:int, y:int, z:int);");
         pigServer.registerQuery("b = foreach a generate TOTUPLE(x, y) as t, z;");
         pigServer.registerQuery("c = group b by t;");
@@ -1115,7 +1115,7 @@ public class TestEvalPipelineLocal {
     // See PIG-3060
     public void testFlattenEmptyBag() throws Exception {
         File f1 = createFile(new String[]{"2\t{}","3\t{(1),(2)}", "4\t{}"});
-        pigServer.registerQuery("A = load '" + Util.generateURI(Util.encodeEscape(f1.toString()), pigServer.getPigContext())
+        pigServer.registerQuery("A = load '" + Util.generateURI(f1.toString(), pigServer.getPigContext())
                 + "'  as (a0:int, a1:bag{(t:chararray)});");
         pigServer.registerQuery("B = group A by a0;");
         pigServer.registerQuery("C = foreach B { c1 = foreach A generate FLATTEN(a1); generate COUNT(c1);};");
diff --git a/test/org/apache/pig/test/TestForEachNestedPlanLocal.java b/test/org/apache/pig/test/TestForEachNestedPlanLocal.java
index f8a88c32c..af0336d38 100644
--- a/test/org/apache/pig/test/TestForEachNestedPlanLocal.java
+++ b/test/org/apache/pig/test/TestForEachNestedPlanLocal.java
@@ -52,7 +52,7 @@ public class TestForEachNestedPlanLocal {
             System.err.println("Running testInnerOrderBy with nullFlags set to :" + nullFlags[i]);
             File tmpFile = genDataSetFile1(nullFlags[i]);
             pig.registerQuery("a = load '"
-                    + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                    + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                     + "'; ");
             pig.registerQuery("b = group a by $0; ");
             pig.registerQuery("c = foreach b { " + "     c1 = order $1 by *; "
@@ -73,7 +73,7 @@ public class TestForEachNestedPlanLocal {
     public void testInnerLimit() throws Exception {
         File tmpFile = genDataSetFileOneGroup();
         pig.registerQuery("a = load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                 + "'; ");
         pig.registerQuery("b = group a by $0; ");
         pig.registerQuery("c = foreach b { " + "     c1 = limit $1 5; "
@@ -289,4 +289,4 @@ public class TestForEachNestedPlanLocal {
         profilePS.close();
         return new File[] { userFile, sessionFile, profileFile };
     }
-}
\ No newline at end of file
+}
diff --git a/test/org/apache/pig/test/TestGrunt.java b/test/org/apache/pig/test/TestGrunt.java
index c2307b1ed..5b9f79c34 100644
--- a/test/org/apache/pig/test/TestGrunt.java
+++ b/test/org/apache/pig/test/TestGrunt.java
@@ -1488,11 +1488,11 @@ public class TestGrunt {
                 });
         String scriptFileName = scriptFile.getAbsolutePath();
         String execTypeOptions = "-x " + cluster.getExecType() + " ";
-        String cmd = "java -cp " + System.getProperty("java.class.path") + ":" + jarFile +
+        String cmd = "java -cp " + System.getProperty("java.class.path") + File.pathSeparator + jarFile +
                 " org.apache.pig.Main " + execTypeOptions + scriptFileName;
         ProcessReturnInfo  pri  = Util.executeJavaCommandAndReturnInfo(cmd);
         assertEquals(pri.exitCode, 0);
-        String[] lines = pri.stderrContents.split(System.getProperty("line.separator"));
+        String[] lines = pri.stderrContents.split("\n");
         boolean found = false;
         for (String line : lines) {
             if (line.matches(".*Added jar .*" + jarName + ".*")) {
diff --git a/test/org/apache/pig/test/TestHBaseStorage.java b/test/org/apache/pig/test/TestHBaseStorage.java
index 0931de87a..c1b025b25 100644
--- a/test/org/apache/pig/test/TestHBaseStorage.java
+++ b/test/org/apache/pig/test/TestHBaseStorage.java
@@ -1127,7 +1127,7 @@ public class TestHBaseStorage {
                 "row4;Andre;Morton;[1#Nancy]",
                 "row3;Sonja;Webb;[]"
         });
-        pig.registerQuery("source = LOAD '" + Util.generateURI(Util.encodeEscape(inputFile.toString()), pig.getPigContext())
+        pig.registerQuery("source = LOAD '" + Util.generateURI(inputFile.toString(), pig.getPigContext())
                 + "' USING PigStorage(';')"
                 + " AS (row:chararray, first_name:chararray, last_name:chararray, friends:map[]);");
         pig.registerQuery("STORE source INTO 'hbase://" + tableName + "' USING" +
diff --git a/test/org/apache/pig/test/TestJoin.java b/test/org/apache/pig/test/TestJoin.java
index ae99e0d24..be897a4cf 100644
--- a/test/org/apache/pig/test/TestJoin.java
+++ b/test/org/apache/pig/test/TestJoin.java
@@ -87,7 +87,7 @@ public class TestJoin {
             fileName = fileNameHint;
         } else if (execType == ExecType.LOCAL) {
             File f = Util.createInputFile("test", fileNameHint, data);
-            fileName = Util.generateURI(Util.encodeEscape(f.getAbsolutePath()), pigServer.getPigContext());
+            fileName = Util.generateURI(f.getAbsolutePath(), pigServer.getPigContext());
         }
         return fileName;
     }
@@ -733,4 +733,4 @@ public class TestJoin {
         }
         assertTrue("All expected tuples should have been found, remaining: "+expected, expected.isEmpty());
     }
-}
\ No newline at end of file
+}
diff --git a/test/org/apache/pig/test/TestJsonLoaderStorage.java b/test/org/apache/pig/test/TestJsonLoaderStorage.java
index 38a329098..410eafb96 100644
--- a/test/org/apache/pig/test/TestJsonLoaderStorage.java
+++ b/test/org/apache/pig/test/TestJsonLoaderStorage.java
@@ -346,7 +346,7 @@ public class TestJsonLoaderStorage {
     tempJsonFile.delete();
 
     // Pig query to run
-    pigServer.registerQuery("IP = load '"+  Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext())
+    pigServer.registerQuery("IP = load '"+  Util.generateURI(input.toString(), pigServer.getPigContext())
         +"' using PigStorage (';') as (ID:chararray,DETAILS:chararray);");
     pigServer.registerQuery(
         "id_details = FOREACH IP GENERATE " +
diff --git a/test/org/apache/pig/test/TestLocal.java b/test/org/apache/pig/test/TestLocal.java
index 165054baa..0fa7e3e23 100644
--- a/test/org/apache/pig/test/TestLocal.java
+++ b/test/org/apache/pig/test/TestLocal.java
@@ -100,7 +100,7 @@ public class TestLocal {
     public Double bigGroupAll( File tmpFile ) throws Throwable {
 
         String query = "foreach (group (load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                 + "') all) generate " + COUNT.class.getName() + "($1) ;";
         System.out.println(query);
         pig.registerQuery("asdf_id = " + query);
@@ -188,7 +188,7 @@ public class TestLocal {
 
     //Load, Execute and Store query
         String query = "foreach (load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                 + "') generate $0,$1;";
         System.out.println(query);
         pig.registerQuery("asdf_id = " + query);
@@ -239,7 +239,7 @@ public class TestLocal {
 
     // Load, Execute and Store query
         String query = "foreach (load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                 + "') generate $0,$1;";
         System.out.println(query);
         pig.registerQuery("asdf_id = " + query);
@@ -284,7 +284,7 @@ public class TestLocal {
 
         // execute query
         String query = "foreach (group (load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                 + "' using " + MyStorage.class.getName() + "()) by "
                 + MyGroup.class.getName() + "('all')) generate flatten("
                 + MyApply.class.getName() + "($1)) ;";
@@ -323,7 +323,7 @@ public class TestLocal {
 
         // execute query
         String query = "foreach (group (load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                 + "' using " + MyStorage.class.getName() + "()) by "
                 + MyGroup.class.getName() + "('all')) generate flatten("
                 + MyApply.class.getName() + "($1)) ;";
@@ -358,7 +358,7 @@ public class TestLocal {
         pig.registerFunction("foo",
             new FuncSpec(MyApply.class.getName()+"('foo')"));
         String query = "foreach (group (load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                 + "' using " + MyStorage.class.getName() + "()) by "
                 + MyGroup.class.getName()
                 + "('all')) generate flatten(foo($1)) ;";
@@ -406,7 +406,7 @@ public class TestLocal {
         pig.registerFunction("foo",
             new FuncSpec(MyApply.class.getName()+"('foo')"));
         String query = "foreach (group (load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile.toString(), pig.getPigContext())
                 + "' using " + MyStorage.class.getName() + "()) by "
                 + MyGroup.class.getName()
                 + "('all')) generate flatten(foo($1)) ;";
@@ -515,4 +515,4 @@ public class TestLocal {
          return  data;
 
     }
-}
\ No newline at end of file
+}
diff --git a/test/org/apache/pig/test/TestLocal2.java b/test/org/apache/pig/test/TestLocal2.java
index bd2a9c840..e9db831c2 100644
--- a/test/org/apache/pig/test/TestLocal2.java
+++ b/test/org/apache/pig/test/TestLocal2.java
@@ -54,10 +54,10 @@ public class TestLocal2 {
         File tmpFile1 = genDataSetFile(false, 30 ) ;
         File tmpFile2 = genDataSetFile(false, 50 ) ;
         pig.registerQuery("a = load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile1.toString(), pig.getPigContext())
                 + "'; ");
         pig.registerQuery("b = load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile2.toString(), pig.getPigContext())
                 + "'; ");
         pig.registerQuery("c = union a, b; ") ;
 
@@ -70,10 +70,10 @@ public class TestLocal2 {
         File tmpFile1 = genDataSetFile(true, 30 ) ;
         File tmpFile2 = genDataSetFile(true, 50 ) ;
         pig.registerQuery("a = load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile1.toString(), pig.getPigContext())
                 + "'; ");
         pig.registerQuery("b = load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile2.toString(), pig.getPigContext())
                 + "'; ");
         pig.registerQuery("c = union a, b; ") ;
 
@@ -86,10 +86,10 @@ public class TestLocal2 {
         File tmpFile1 = genDataSetFile(false, 30) ;
         File tmpFile2 = genDataSetFile(false, 50) ;
         pig.registerQuery("a = load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile1.toString(), pig.getPigContext())
                 + "'; ");
         pig.registerQuery("b = load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile2.toString(), pig.getPigContext())
                 + "'; ");
         pig.registerQuery("a1 = foreach a generate $0, $1; ") ;
         pig.registerQuery("b1 = foreach b generate $0, $1; ") ;
@@ -103,10 +103,10 @@ public class TestLocal2 {
         File tmpFile1 = genDataSetFile(true, 30) ;
         File tmpFile2 = genDataSetFile(true, 50) ;
         pig.registerQuery("a = load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile1.toString(), pig.getPigContext())
                 + "'; ");
         pig.registerQuery("b = load '"
-                + Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pig.getPigContext())
+                + Util.generateURI(tmpFile2.toString(), pig.getPigContext())
                 + "'; ");
         pig.registerQuery("a1 = foreach a generate $0, $1; ") ;
         pig.registerQuery("b1 = foreach b generate $0, $1; ") ;
@@ -125,7 +125,7 @@ public class TestLocal2 {
         ps.close();
 
         pig.registerQuery("A = load '"
-                + Util.generateURI(Util.encodeEscape(fp1.toString()), pig.getPigContext())
+                + Util.generateURI(fp1.toString(), pig.getPigContext())
                 + "'; ");
         pig.registerQuery("B = foreach A generate flatten("
                 + Pig800Udf.class.getName() + "($0));");
@@ -148,7 +148,7 @@ public class TestLocal2 {
         ps.close();
 
         pig.registerQuery("A = load '"
-                + Util.generateURI(Util.encodeEscape(fp1.toString()), pig.getPigContext())
+                + Util.generateURI(fp1.toString(), pig.getPigContext())
                 + "'; ");
         pig.registerQuery("B = foreach A generate flatten("
                 + Pig800Udf.class.getName() + "($0));");
@@ -171,7 +171,7 @@ public class TestLocal2 {
         ps.close();
 
         pig.registerQuery("A = load '"
-                + Util.generateURI(Util.encodeEscape(fp1.toString()), pig.getPigContext())
+                + Util.generateURI(fp1.toString(), pig.getPigContext())
                 + "' AS (c1:int, c2:int); ");
         pig.registerQuery("B = filter A by c1 > 0;");
         pig.registerQuery("C = filter B by c1 < 2;");
@@ -207,10 +207,10 @@ public class TestLocal2 {
 
 
         pig.registerQuery("A = load '"
-                + Util.generateURI(Util.encodeEscape(fp1.toString()), pig.getPigContext())
+                + Util.generateURI(fp1.toString(), pig.getPigContext())
                 + "'AS (a0:int, a1:int); ");
         pig.registerQuery("B = load '"
-                + Util.generateURI(Util.encodeEscape(fp2.toString()), pig.getPigContext())
+                + Util.generateURI(fp2.toString(), pig.getPigContext())
                 + "'AS (b0:int, b1:int); ");
         pig.registerQuery("C = join A by a0, B by b0;");
 
diff --git a/test/org/apache/pig/test/TestParamSubPreproc.java b/test/org/apache/pig/test/TestParamSubPreproc.java
index 4b891750c..9e6ba5c68 100644
--- a/test/org/apache/pig/test/TestParamSubPreproc.java
+++ b/test/org/apache/pig/test/TestParamSubPreproc.java
@@ -33,10 +33,13 @@ import java.io.IOException;
 import java.io.InputStream;
 import java.io.InputStreamReader;
 import java.io.PrintWriter;
+import java.util.Properties;
 
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
 import org.apache.hadoop.util.Shell;
+import org.apache.pig.ExecType;
+import org.apache.pig.impl.PigContext;
 import org.apache.pig.tools.parameters.ParameterSubstitutionPreprocessor;
 import org.apache.pig.tools.parameters.ParseException;
 import org.junit.Test;
@@ -1352,9 +1355,11 @@ public class TestParamSubPreproc {
         File inputFile = Util.createFile(new String[]{"daniel\t10","jenny\t20"});
         File outputFile = File.createTempFile("tmp", "");
         outputFile.delete();
-        String command = "a = load '" + Util.encodeEscape(inputFile.toString()) + "' as ($param1:chararray, $param2:int);\n"
-                + "store a into '" + outputFile.toString() + "';\n"
+        PigContext pc = new PigContext(ExecType.LOCAL, new Properties());
+        String command = "a = load '" + Util.generateURI(inputFile.toString(), pc)  + "' as ($param1:chararray, $param2:int);\n"
+                + "store a into '" + Util.generateURI(outputFile.toString(), pc) + "';\n"
                 + "quit\n";
+        System.setProperty("jline.WindowsTerminal.directConsole", "false");
         System.setIn(new ByteArrayInputStream(command.getBytes()));
         org.apache.pig.PigRunner.run(new String[] {"-x", "local", "-p", "param1=name", "-p", "param2=age"}, null);
         File[] partFiles = outputFile.listFiles(new FilenameFilter() {
@@ -1387,4 +1392,4 @@ public class TestParamSubPreproc {
          }
          return result;
      }
-}
\ No newline at end of file
+}
diff --git a/test/org/apache/pig/test/TestPigScriptParser.java b/test/org/apache/pig/test/TestPigScriptParser.java
index 6a6d975b6..d7f8f32bb 100644
--- a/test/org/apache/pig/test/TestPigScriptParser.java
+++ b/test/org/apache/pig/test/TestPigScriptParser.java
@@ -115,7 +115,7 @@ public class TestPigScriptParser {
                 // backslash - hence 4. In a pig script in a file, this would be
                 // www\\.xyz\\.com
                 "define minelogs org.apache.pig.test.RegexGroupCount('www\\\\.xyz\\\\.com/sports');" ,
-                "A = load '" + Util.generateURI(Util.encodeEscape(f.getAbsolutePath()), ps.getPigContext()) + "'  using PigStorage() as (source : chararray);" ,
+                "A = load '" + Util.generateURI(f.getAbsolutePath(), ps.getPigContext()) + "'  using PigStorage() as (source : chararray);" ,
                 "B = foreach A generate minelogs(source) as sportslogs;" };
         for (String line : queryLines) {
             ps.registerQuery(line);
diff --git a/test/org/apache/pig/test/TestPigServer.java b/test/org/apache/pig/test/TestPigServer.java
index 649b0be79..bc21bf739 100644
--- a/test/org/apache/pig/test/TestPigServer.java
+++ b/test/org/apache/pig/test/TestPigServer.java
@@ -968,13 +968,13 @@ public class TestPigServer {
 
         pigServer.setValidateEachStatement(true);
         pigServer.registerQuery("A = LOAD 'foo' USING mock.Storage() AS (f1:chararray,f2:int,f3:chararray);");
-        pigServer.registerQuery("store A into '" + tempDir + "/testGruntValidation1';");
+        pigServer.registerQuery("store A into '" + Util.generateURI(tempDir.toString(), pigServer.getPigContext()) + "/testGruntValidation1';");
         pigServer.registerQuery("B = LOAD 'foo' USING mock.Storage() AS (f1:chararray,f2:int,f3:chararray);");
-        pigServer.registerQuery("store B into '" + tempDir + "/testGruntValidation2';"); // This should pass
+        pigServer.registerQuery("store B into '" + Util.generateURI(tempDir.toString(), pigServer.getPigContext()) + "/testGruntValidation2';"); // This should pass
         boolean validationExceptionCaptured = false;
         try {
             // This should fail due to output validation
-            pigServer.registerQuery("store A into '" + tempDir + "/testGruntValidation1';");
+            pigServer.registerQuery("store A into '" + Util.generateURI(tempDir.toString(),pigServer.getPigContext()) + "/testGruntValidation1';");
         } catch (FrontendException e) {
             validationExceptionCaptured = true;
         }
diff --git a/test/org/apache/pig/test/TestPruneColumn.java b/test/org/apache/pig/test/TestPruneColumn.java
index 6ced09bfd..d12b545fa 100644
--- a/test/org/apache/pig/test/TestPruneColumn.java
+++ b/test/org/apache/pig/test/TestPruneColumn.java
@@ -282,7 +282,7 @@ public class TestPruneColumn {
 
     @Test
     public void testLoadForEach1() throws Exception{
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
         pigServer.registerQuery("B = foreach A generate a1, a2;");
         Iterator<Tuple> iter = pigServer.openIterator("B");
 
@@ -305,7 +305,7 @@ public class TestPruneColumn {
 
     @Test
     public void testLoadForEach2() throws Exception{
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
         pigServer.registerQuery("B = foreach A generate a0, a2;");
         Iterator<Tuple> iter = pigServer.openIterator("B");
 
@@ -328,7 +328,7 @@ public class TestPruneColumn {
 
     @Test
     public void testLoadForEach3() throws Exception{
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
         pigServer.registerQuery("B = foreach A generate a0, a1;");
         Iterator<Tuple> iter = pigServer.openIterator("B");
 
@@ -351,8 +351,8 @@ public class TestPruneColumn {
 
     @Test
     public void testJoin1() throws Exception{
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' as (b0:int, b1:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' as (b0:int, b1:int);");
         pigServer.registerQuery("C = join A by a1, B by b1;");
         pigServer.registerQuery("D = foreach C generate a1, a2, b0, b1;");
 
@@ -373,8 +373,8 @@ public class TestPruneColumn {
 
     @Test
     public void testJoin2() throws Exception{
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' as (b0:int, b1:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' as (b0:int, b1:int);");
         pigServer.registerQuery("C = join A by a1, B by b1;");
         pigServer.registerQuery("D = foreach C generate a1, a2, b1;");
 
@@ -395,7 +395,7 @@ public class TestPruneColumn {
 
     @Test
     public void testForEachFilter() throws Exception{
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
         pigServer.registerQuery("B = filter A by a2==3;");
         pigServer.registerQuery("C = foreach B generate a0, a1;");
 
@@ -414,7 +414,7 @@ public class TestPruneColumn {
 
     @Test
     public void testForEach1() throws Exception{
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
         pigServer.registerQuery("B = foreach A generate a0, a1+a2;");
 
         Iterator<Tuple> iter = pigServer.openIterator("B");
@@ -438,7 +438,7 @@ public class TestPruneColumn {
 
     @Test
     public void testForEach2() throws Exception{
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
         pigServer.registerQuery("B = foreach A generate a0 as b0, *;");
 
         Iterator<Tuple> iter = pigServer.openIterator("B");
@@ -466,7 +466,7 @@ public class TestPruneColumn {
 
     @Test
     public void testSplit1() throws Exception{
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0, a1, a2);");
         pigServer.registerQuery("split A into B if $0<=1, C if $0>1;");
         pigServer.registerQuery("D = foreach B generate $1;");
 
@@ -484,7 +484,7 @@ public class TestPruneColumn {
 
     @Test
     public void testSplit2() throws Exception{
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0, a1, a2);");
         pigServer.registerQuery("split A into B if $0<=1, C if $0>1;");
         pigServer.registerQuery("D = foreach B generate $1;");
 
@@ -502,7 +502,7 @@ public class TestPruneColumn {
 
     @Test
     public void testForeachNoSchema1() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "';");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "';");
         pigServer.registerQuery("B = foreach A generate $1, $2;");
         Iterator<Tuple> iter = pigServer.openIterator("B");
 
@@ -525,7 +525,7 @@ public class TestPruneColumn {
 
     @Test
     public void testForeachNoSchema2() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "';");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "';");
         pigServer.registerQuery("B = foreach A generate $1, 'aoeuaoeu';");
         Iterator<Tuple> iter = pigServer.openIterator("B");
 
@@ -548,8 +548,8 @@ public class TestPruneColumn {
 
     @Test
     public void testCoGroup1() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1:int, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' AS (b0, b1:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1:int, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' AS (b0, b1:int);");
         pigServer.registerQuery("C = cogroup A by $1, B by $1;");
         pigServer.registerQuery("D = foreach C generate AVG($1.$1);");
         Iterator<Tuple> iter = pigServer.openIterator("D");
@@ -579,7 +579,7 @@ public class TestPruneColumn {
 
     @Test
     public void testCoGroup2() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1:int, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1:int, a2);");
         pigServer.registerQuery("B = group A all;");
         pigServer.registerQuery("C = foreach B generate $1;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -595,7 +595,7 @@ public class TestPruneColumn {
 
     @Test
     public void testCoGroup3() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1:int, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1:int, a2);");
         pigServer.registerQuery("B = group A by $1;");
         pigServer.registerQuery("C = foreach B generate $1, '1';");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -621,8 +621,8 @@ public class TestPruneColumn {
 
     @Test
     public void testCoGroup4() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1:int, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' AS (b0, b1:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1:int, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' AS (b0, b1:int);");
         pigServer.registerQuery("C = cogroup A by ($1), B by ($1);");
         pigServer.registerQuery("D = foreach C generate $1.$1, $2.$1;");
         Iterator<Tuple> iter = pigServer.openIterator("D");
@@ -655,7 +655,7 @@ public class TestPruneColumn {
 
     @Test
     public void testCoGroup5() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = group A by (a0, a1);");
         pigServer.registerQuery("C = foreach B generate flatten(group);");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -681,7 +681,7 @@ public class TestPruneColumn {
 
     @Test
     public void testDistinct1() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile4.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile4.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = distinct A;");
         pigServer.registerQuery("C = foreach B generate $0;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -699,7 +699,7 @@ public class TestPruneColumn {
 
     @Test
     public void testStream1() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = stream A through `" + simpleEchoStreamingCommand + "`;");
         pigServer.registerQuery("C = foreach B generate $0;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -723,7 +723,7 @@ public class TestPruneColumn {
 
     @Test
     public void testBinCond1() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile5.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2, a3);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile5.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2, a3);");
         pigServer.registerQuery("B = foreach A generate ($1 == '2'? $2 : $3);");
         pigServer.registerQuery("C = foreach B generate $0;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -747,8 +747,8 @@ public class TestPruneColumn {
 
     @Test
     public void testCoGroup6() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' AS (b0, b1);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' AS (b0, b1);");
         pigServer.registerQuery("C = cogroup A by ($1), B by ($1);");
         pigServer.registerQuery("D = foreach C generate A, flatten(B.($0, $1));");
         Iterator<Tuple> iter = pigServer.openIterator("D");
@@ -776,8 +776,8 @@ public class TestPruneColumn {
 
     @Test
     public void testCoGroup7() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' AS (b0, b1);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' AS (b0, b1);");
         pigServer.registerQuery("C = cogroup A by ($1), B by ($1);");
         pigServer.registerQuery("D = foreach C {B = order B by $0;generate FLATTEN(A), B.($1);};");
         Iterator<Tuple> iter = pigServer.openIterator("D");
@@ -807,8 +807,8 @@ public class TestPruneColumn {
 
     @Test
     public void testCross1() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' AS (b0, b1);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' AS (b0, b1);");
         pigServer.registerQuery("C = cross A, B;");
         pigServer.registerQuery("D = foreach C generate $0, $3;");
         Iterator<Tuple> iter = pigServer.openIterator("D");
@@ -851,8 +851,8 @@ public class TestPruneColumn {
 
     @Test
     public void testUnion1() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile4.toString()), pigServer.getPigContext()) + "' AS (b0, b1, b2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile4.toString(), pigServer.getPigContext()) + "' AS (b0, b1, b2);");
         pigServer.registerQuery("C = union A, B;");
         pigServer.registerQuery("D = foreach C generate $0, $2;");
         Iterator<Tuple> iter = pigServer.openIterator("D");
@@ -892,8 +892,8 @@ public class TestPruneColumn {
 
     @Test
     public void testFRJoin1() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' AS (b0, b1);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' AS (b0, b1);");
         pigServer.registerQuery("C = join A by $0, B by $0 using 'replicated';");
         pigServer.registerQuery("D = foreach C generate $0, $3;");
         Iterator<Tuple> iter = pigServer.openIterator("D");
@@ -920,7 +920,7 @@ public class TestPruneColumn {
 
     @Test
     public void testFilter1() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = order A by a1;");
         pigServer.registerQuery("C = limit B 10;");
         pigServer.registerQuery("D = foreach C generate $0;");
@@ -945,7 +945,7 @@ public class TestPruneColumn {
 
     @Test
     public void testFilter2() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = filter A by a0+a2 == 4;");
         pigServer.registerQuery("C = foreach B generate $0;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -969,7 +969,7 @@ public class TestPruneColumn {
 
     @Test
     public void testOrderBy1() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = order A by $0;");
         pigServer.registerQuery("C = foreach B generate $0;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -993,7 +993,7 @@ public class TestPruneColumn {
 
     @Test
     public void testOrderBy2() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = order A by *;");
         pigServer.registerQuery("C = foreach B generate $0;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -1017,7 +1017,7 @@ public class TestPruneColumn {
 
     @Test
     public void testCogroup8() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = group A by *;");
         pigServer.registerQuery("C = foreach B generate $0;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -1041,8 +1041,8 @@ public class TestPruneColumn {
 
     @Test
     public void testJoin3() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile4.toString()), pigServer.getPigContext()) + "' AS (b0, b1, b2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile4.toString(), pigServer.getPigContext()) + "' AS (b0, b1, b2);");
         pigServer.registerQuery("C = join A by *, B by * using 'replicated';");
         pigServer.registerQuery("D = foreach C generate $0;");
         Iterator<Tuple> iter = pigServer.openIterator("D");
@@ -1066,7 +1066,7 @@ public class TestPruneColumn {
 
     @Test
     public void testLoadForEach4() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = foreach A generate *;");
         pigServer.registerQuery("C = foreach B generate $0;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -1090,7 +1090,7 @@ public class TestPruneColumn {
 
     @Test
     public void testForEachUDF() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0:chararray, a1:chararray, a2:chararray);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0:chararray, a1:chararray, a2:chararray);");
         pigServer.registerQuery("B = foreach A generate StringSize(*);");
         pigServer.registerQuery("C = foreach B generate $0;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -1114,8 +1114,8 @@ public class TestPruneColumn {
 
     @Test
     public void testOutJoin1() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile6.toString()), pigServer.getPigContext()) + "' AS (a0:chararray, a1:chararray, a2:chararray);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' AS (a0:chararray, a1:chararray, a2:chararray);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile6.toString(), pigServer.getPigContext()) + "' AS (a0:chararray, a1:chararray, a2:chararray);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' AS (a0:chararray, a1:chararray, a2:chararray);");
         pigServer.registerQuery("C = join A by $0 left, B by $0;");
         pigServer.registerQuery("D = foreach C generate $0;");
         Iterator<Tuple> iter = pigServer.openIterator("D");
@@ -1144,7 +1144,7 @@ public class TestPruneColumn {
 
     @Test
     public void testFilter3() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = filter A by " + MyFilterFunc.class.getName() + "(*) ;");
         pigServer.registerQuery("C = foreach B generate $0;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -1168,7 +1168,7 @@ public class TestPruneColumn {
 
     @Test
     public void testMapKey1() throws Exception{
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile3.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:map[]);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile3.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:map[]);");
         pigServer.registerQuery("B = foreach A generate a0, a1#'key1';");
 
         Iterator<Tuple> iter = pigServer.openIterator("B");
@@ -1192,7 +1192,7 @@ public class TestPruneColumn {
 
     @Test
     public void testMapKey2() throws Exception{
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile3.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:map[]);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile3.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:map[]);");
         pigServer.registerQuery("B = foreach A generate a1, a1#'key1';");
         pigServer.registerQuery("C = foreach B generate $0#'key2', $1;");
 
@@ -1218,7 +1218,7 @@ public class TestPruneColumn {
 
     @Test
     public void testMapKey3() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile3.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:map[]);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile3.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:map[]);");
         pigServer.registerQuery("B = foreach A generate a1, a1#'key1';");
         pigServer.registerQuery("C = group B all;");
 
@@ -1235,7 +1235,7 @@ public class TestPruneColumn {
 
     @Test
     public void testMapKey4() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile3.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:map[]);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile3.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:map[]);");
         pigServer.registerQuery("B = limit A 10;");
         pigServer.registerQuery("C = foreach B generate $0, $1#'key1';");
 
@@ -1260,7 +1260,7 @@ public class TestPruneColumn {
 
     @Test
     public void testMapKey5() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile3.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:map[]);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile3.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:map[]);");
         pigServer.registerQuery("B = foreach A generate $0, $1#'key1';");
         pigServer.registerQuery("C = stream B through `" + simpleEchoStreamingCommand + "`;");
 
@@ -1285,7 +1285,7 @@ public class TestPruneColumn {
 
     @Test
     public void testMapKeyInSplit1() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile12.toString()), pigServer.getPigContext()) + "' as (m:map[]);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile12.toString(), pigServer.getPigContext()) + "' as (m:map[]);");
         pigServer.registerQuery("B = foreach A generate m#'key1' as key1;");
         pigServer.registerQuery("C = foreach A generate m#'key2' as key2;");
         pigServer.registerQuery("D = join B by key1, C by key2;");
@@ -1306,7 +1306,7 @@ public class TestPruneColumn {
     @SuppressWarnings("rawtypes")
     @Test
     public void testMapKeyInSplit2() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile12.toString()), pigServer.getPigContext()) + "' as (m:map[]);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile12.toString(), pigServer.getPigContext()) + "' as (m:map[]);");
         pigServer.registerQuery("B = filter A by m#'cond'==1;");
         pigServer.registerQuery("C = filter B by m#'key1'==1;");
         pigServer.registerQuery("D = filter B by m#'key2'==2;");
@@ -1331,7 +1331,7 @@ public class TestPruneColumn {
 
     @Test
     public void testConstantPlan() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0, a1, a2);");
         pigServer.registerQuery("B = foreach A generate 1, a2;");
 
         Iterator<Tuple> iter = pigServer.openIterator("B");
@@ -1355,7 +1355,7 @@ public class TestPruneColumn {
 
     @Test
     public void testPlainPlan() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0, a1, a2);");
         pigServer.registerQuery("B = order A by $0;");
 
         Iterator<Tuple> iter = pigServer.openIterator("B");
@@ -1386,7 +1386,7 @@ public class TestPruneColumn {
         intermediateFile.delete(); // delete since we don't want the file to be present
         String clusterPath = Util.removeColon(intermediateFile.getAbsolutePath());
 
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0, a1, a2);");
         pigServer.store("A", clusterPath, "BinStorage()");
 
         pigServer.registerQuery("A = load '"+ Util.encodeEscape(clusterPath)
@@ -1417,7 +1417,7 @@ public class TestPruneColumn {
         intermediateFile.delete(); // delete since we don't want the file to be present
         String clusterPath = Util.removeColon(intermediateFile.getAbsolutePath());
 
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0, a1, a2);");
         pigServer.store("A", clusterPath, "BinStorage()");
 
         pigServer.registerQuery("A = load '"+ Util.encodeEscape(clusterPath)
@@ -1448,7 +1448,7 @@ public class TestPruneColumn {
 
     @Test
     public void testProjectCastKeyLookup() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile3.toString()), pigServer.getPigContext())
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile3.toString(), pigServer.getPigContext())
                 + "' as (a0, a1);");
 
         pigServer.registerQuery("B = foreach A generate a1#'key1';");
@@ -1474,7 +1474,7 @@ public class TestPruneColumn {
 
     @Test
     public void testRelayFlattenMap() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile3.toString()), pigServer.getPigContext())
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile3.toString(), pigServer.getPigContext())
                 + "' as (a0, a1:map[]);");
 
         pigServer.registerQuery("B = foreach A generate flatten(a1);");
@@ -1500,8 +1500,8 @@ public class TestPruneColumn {
 
     @Test
     public void testCrossAtLeastOneColumnOneInput() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' as (b0:int, b1:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' as (a0:int, a1:int, a2:int);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' as (b0:int, b1:int);");
         pigServer.registerQuery("C = cross A, B;");
         pigServer.registerQuery("D = foreach C generate $0;");
 
@@ -1538,8 +1538,8 @@ public class TestPruneColumn {
 
     @Test
     public void testComplex1() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile7.toString()), pigServer.getPigContext()) + "' as (a0, a1, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile8.toString()), pigServer.getPigContext()) + "' as (b0, b1, b2, b3);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile7.toString(), pigServer.getPigContext()) + "' as (a0, a1, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile8.toString(), pigServer.getPigContext()) + "' as (b0, b1, b2, b3);");
         pigServer.registerQuery("B1 = foreach B generate b2, b0+b3;");
         pigServer.registerQuery("C = join A by $0, B1 by $0;");
         pigServer.registerQuery("D = order C by $4;");
@@ -1568,7 +1568,7 @@ public class TestPruneColumn {
         pigServer.getPigContext().getProperties().setProperty(
                 PigImplConstants.PIG_OPTIMIZER_RULES_KEY,
                 ObjectSerializer.serialize(optimizerRules));
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile13.toString()), pigServer.getPigContext()) + "' as (a:int, b:chararray);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile13.toString(), pigServer.getPigContext()) + "' as (a:int, b:chararray);");
         pigServer.registerQuery("B = FOREACH A generate a;");
         pigServer.registerQuery("C = GROUP B by a;");
         pigServer.registerQuery("D = filter C by group > 0 and group < 100;");
@@ -1598,8 +1598,8 @@ public class TestPruneColumn {
 
     @Test
     public void testCoGroup8() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1:int, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' AS (b0, b1:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1:int, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' AS (b0, b1:int);");
         pigServer.registerQuery("C = cogroup A by ($1), B by ($1);");
         pigServer.registerQuery("D = foreach C generate $0, $1;");
 
@@ -1631,7 +1631,7 @@ public class TestPruneColumn {
     // See PIG-1128
     @Test
     public void testUserDefinedSchema() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS ( c1 : chararray, c2 : int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS ( c1 : chararray, c2 : int);");
         pigServer.registerQuery("B = foreach A generate c1 as c1 : chararray, c2 as c2 : int, 'CA' as state : chararray;");
         pigServer.registerQuery("C = foreach B generate c1 as c1 : chararray;");
 
@@ -1653,7 +1653,7 @@ public class TestPruneColumn {
     // See PIG-1127
     @Test
     public void testSharedSchemaObject() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile10.toString()), pigServer.getPigContext()) + "' AS (a0, a1:map[], a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile10.toString(), pigServer.getPigContext()) + "' AS (a0, a1:map[], a2);");
         pigServer.registerQuery("B = foreach A generate a1;");
         pigServer.registerQuery("C = limit B 10;");
 
@@ -1671,8 +1671,8 @@ public class TestPruneColumn {
     // See PIG-1142
     @Test
     public void testJoin4() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (b0, b1, b2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (b0, b1, b2);");
         pigServer.registerQuery("C = join A by a2, B by b2;");
         pigServer.registerQuery("D = foreach C generate $0,  $1,  $2;");
 
@@ -1696,7 +1696,7 @@ public class TestPruneColumn {
 
     @Test
     public void testFilter4() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2:int);");
         pigServer.registerQuery("B = filter A by a2==3;");
         pigServer.registerQuery("C = foreach B generate $2;");
 
@@ -1713,7 +1713,7 @@ public class TestPruneColumn {
 
     @Test
     public void testSplit3() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2:int);");
         pigServer.registerQuery("split A into B if a2==3, C if a2<3;");
         pigServer.registerQuery("C = foreach B generate $2;");
 
@@ -1730,7 +1730,7 @@ public class TestPruneColumn {
 
     @Test
     public void testOrderBy3() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = order A by a2;");
         pigServer.registerQuery("C = foreach B generate a2;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -1754,9 +1754,9 @@ public class TestPruneColumn {
 
     @Test
     public void testCogroup9() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (b0, b1, b2);");
-        pigServer.registerQuery("C = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (c0, c1, c2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (b0, b1, b2);");
+        pigServer.registerQuery("C = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (c0, c1, c2);");
         pigServer.registerQuery("D = cogroup A by a2, B by b2, C by c2;");
         pigServer.registerQuery("E = foreach D generate $1, $2;");
         Iterator<Tuple> iter = pigServer.openIterator("E");
@@ -1781,8 +1781,8 @@ public class TestPruneColumn {
     // See PIG-1165
     @Test
     public void testOrderbyWrongSignature() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' AS (b0, b1);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' AS (b0, b1);");
         pigServer.registerQuery("C = order A by a1;");
         pigServer.registerQuery("D = join C by a1, B by b0;");
         pigServer.registerQuery("E = foreach D generate a1, b0, b1;");
@@ -1802,8 +1802,8 @@ public class TestPruneColumn {
     // See PIG-1146
     @Test
     public void testUnionMixedPruning() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1:chararray, a2);");
-        pigServer.registerQuery("B = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' AS (b0, b2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1:chararray, a2);");
+        pigServer.registerQuery("B = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' AS (b0, b2);");
         pigServer.registerQuery("C = foreach B generate b0, 'hello', b2;");
         pigServer.registerQuery("D = union A, C;");
         pigServer.registerQuery("E = foreach D generate $0, $2;");
@@ -1846,9 +1846,9 @@ public class TestPruneColumn {
     // See PIG-1176
     @Test
     public void testUnionMixedSchemaPruning() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = foreach A generate a0;;");
-        pigServer.registerQuery("C = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "';");
+        pigServer.registerQuery("C = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "';");
         pigServer.registerQuery("D = foreach C generate $0;");
         pigServer.registerQuery("E = union B, D;");
         Iterator<Tuple> iter = pigServer.openIterator("E");
@@ -1921,7 +1921,7 @@ public class TestPruneColumn {
     // See PIG-1210
     @Test
     public void testFieldsToReadDuplicatedEntry() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = foreach A generate a0+a0, a1, a2;");
         Iterator<Tuple> iter = pigServer.openIterator("B");
 
@@ -1941,7 +1941,7 @@ public class TestPruneColumn {
     // See PIG-1272
     @Test
     public void testSplit4() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2);");
         pigServer.registerQuery("B = foreach A generate a0;");
         pigServer.registerQuery("C = join A by a0, B by a0;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -1959,7 +1959,7 @@ public class TestPruneColumn {
 
     @Test
     public void testSplit5() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile11.toString()), pigServer.getPigContext()) + "' AS (a0:int, a1:int, a2:int);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile11.toString(), pigServer.getPigContext()) + "' AS (a0:int, a1:int, a2:int);");
         pigServer.registerQuery("B = foreach A generate a0, a1;");
         pigServer.registerQuery("C = join A by a0, B by a0;");
         pigServer.registerQuery("D = filter C by A::a1>=B::a1;");
@@ -1981,7 +1981,7 @@ public class TestPruneColumn {
     // See PIG-1493
     @Test
     public void testInconsistentPruning() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' AS (a0:chararray, a1:chararray, a2);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' AS (a0:chararray, a1:chararray, a2);");
         pigServer.registerQuery("B = foreach A generate CONCAT(a0,a1) as b0, a0, a2;");
         pigServer.registerQuery("C = foreach B generate a0, a2;");
         Iterator<Tuple> iter = pigServer.openIterator("C");
@@ -2003,12 +2003,12 @@ public class TestPruneColumn {
         Path output1 = FileLocalizer.getTemporaryPath(pigServer.getPigContext());
         Path output2 = FileLocalizer.getTemporaryPath(pigServer.getPigContext());
         pigServer.setBatchOn();
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile5.toString()), pigServer.getPigContext()) + "' AS (a0, a1, a2, a3);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile5.toString(), pigServer.getPigContext()) + "' AS (a0, a1, a2, a3);");
         pigServer.registerQuery("B = foreach A generate a0, a1, a2;");
-        pigServer.registerQuery("store B into '" + Util.generateURI(Util.encodeEscape(output1.toString()), pigServer.getPigContext()) + "';");
+        pigServer.registerQuery("store B into '" + Util.generateURI(output1.toString(), pigServer.getPigContext()) + "';");
         pigServer.registerQuery("C = order B by a2;");
         pigServer.registerQuery("D = foreach C generate a2;");
-        pigServer.registerQuery("store D into '" + Util.generateURI(Util.encodeEscape(output2.toString()), pigServer.getPigContext()) + "';");
+        pigServer.registerQuery("store D into '" + Util.generateURI(output2.toString(), pigServer.getPigContext()) + "';");
         pigServer.executeBatch();
 
         BufferedReader reader1 = new BufferedReader(new InputStreamReader(FileLocalizer.openDFSFile(output1.toString(), pigServer.getPigContext().getProperties())));
@@ -2093,7 +2093,7 @@ public class TestPruneColumn {
     }
 
     public void testAliasInRequiredFieldList() throws Exception{
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile1.toString()), pigServer.getPigContext()) + "' using "
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString(), pigServer.getPigContext()) + "' using "
                 + PruneColumnEvalFunc.class.getName() +"() as (a0, a1, a2);");
         pigServer.registerQuery("B = foreach A generate a1, a2;");
         Iterator<Tuple> iter = pigServer.openIterator("B");
@@ -2110,7 +2110,7 @@ public class TestPruneColumn {
 
     @Test
     public void testCogroup10() throws Exception {
-        pigServer.registerQuery("A = load '"+ Util.generateURI(Util.encodeEscape(tmpFile2.toString()), pigServer.getPigContext()) + "' AS (a0, a1:double);");
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile2.toString(), pigServer.getPigContext()) + "' AS (a0, a1:double);");
         pigServer.registerQuery("B = foreach A generate a0, a1, 0 as joinField;");
         pigServer.registerQuery("C = group B all;");
         pigServer.registerQuery("D = foreach C generate 0 as joinField, SUM(B.a1) as total;");
@@ -2179,4 +2179,4 @@ public class TestPruneColumn {
         assertTrue(checkLogFileMessage(new String[]{"Map key required for event_serve: $0->[event_guid, filter_key, receive_time]",
                 "Map key required for raw: $0->[cm_serve_id, cm_serve_timestamp_ms, p_url, source, type]"}));
     }
-}
\ No newline at end of file
+}
diff --git a/test/org/apache/pig/test/TestRegisteredJarVisibility.java b/test/org/apache/pig/test/TestRegisteredJarVisibility.java
index d8d792e0c..30e342a50 100644
--- a/test/org/apache/pig/test/TestRegisteredJarVisibility.java
+++ b/test/org/apache/pig/test/TestRegisteredJarVisibility.java
@@ -133,7 +133,7 @@ public class TestRegisteredJarVisibility {
     @Test
     public void testRegisterJarVisibilityMR() throws IOException {
         PigServer pigServer = new PigServer(cluster.getExecType(), cluster.getProperties());
-        testRegisteredJarVisibility(pigServer, INPUT_FILE.getName());
+        testRegisteredJarVisibility(pigServer, INPUT_FILE.getAbsolutePath());
     }
 
     @Test
@@ -144,7 +144,7 @@ public class TestRegisteredJarVisibility {
 
     public void testRegisteredJarVisibility(PigServer pigServer, String inputPath) throws IOException {
         String query = "register " + jarFile.getAbsolutePath() + ";\n"
-                + "a = load '" + inputPath
+                + "a = load '" + Util.generateURI(inputPath, pigServer.getPigContext())
                 + "' using org.apache.pig.test.RegisteredJarVisibilityLoader();\n"
                 // register again to test classloader consistency
                 + "register " +  jarFile.getAbsolutePath() + ";\n"
diff --git a/test/org/apache/pig/test/TestScriptUDF.java b/test/org/apache/pig/test/TestScriptUDF.java
index 9bcf13d9b..726609caf 100644
--- a/test/org/apache/pig/test/TestScriptUDF.java
+++ b/test/org/apache/pig/test/TestScriptUDF.java
@@ -231,7 +231,7 @@ public class TestScriptUDF{
         String userenv = Shell.WINDOWS?"USERNAME":"USER";
         String[] input = {
                 userenv,
-                "PATH"
+                "JAVA_HOME"
         };
 
         Util.createInputFile(cluster, "testPythonBuiltinModuleImport1", input);
diff --git a/test/org/apache/pig/test/TestStreaming.java b/test/org/apache/pig/test/TestStreaming.java
index fb8135389..7d7dd4d13 100644
--- a/test/org/apache/pig/test/TestStreaming.java
+++ b/test/org/apache/pig/test/TestStreaming.java
@@ -113,7 +113,7 @@ public class TestStreaming {
 
     		// Pig query to run
             pigServer.registerQuery("IP = load '"
-                    + Util.generateURI(Util.encodeEscape(input.toString()),
+                    + Util.generateURI(input.toString(),
                             pigServer.getPigContext()) + "' using "
                     + PigStorage.class.getName() + "(',');");
     		pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > '3';");
@@ -157,7 +157,7 @@ public class TestStreaming {
 		    }
 	        // Pig query to run
             pigServer.registerQuery("IP = load '"
-                    + Util.generateURI(Util.encodeEscape(input.toString()),
+                    + Util.generateURI(input.toString(),
                             pigServer.getPigContext()) + "' using "
                     + PigStorage.class.getName() + "(',');");
 	        pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > '3';");
@@ -200,7 +200,7 @@ public class TestStreaming {
 
     		// Pig query to run
             pigServer.registerQuery("IP = load '"
-                    + Util.generateURI(Util.encodeEscape(input.toString()),
+                    + Util.generateURI(input.toString(),
                             pigServer.getPigContext()) + "' using "
                     + PigStorage.class.getName() + "(',');");
     		pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > '3';");
@@ -250,7 +250,7 @@ public class TestStreaming {
 
 		// Pig query to run
         pigServer.registerQuery("IP = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()),
+                + Util.generateURI(input.toString(),
                         pigServer.getPigContext()) + "' using "
                 + PigStorage.class.getName() + "(',');");
 		pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > '3';");
@@ -318,7 +318,7 @@ public class TestStreaming {
                 "output(stdout using " + PigStreaming.class.getName() + "(',')) " +
                 "stderr();");
         pigServer.registerQuery("IP = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()),
+                + Util.generateURI(input.toString(),
                         pigServer.getPigContext())
                 + "' using PigStorage(',');");
         pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > 3;");
@@ -388,7 +388,7 @@ public class TestStreaming {
                 "output(stdout using PS ) " +
                 "stderr();");
         pigServer.registerQuery("IP = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()),
+                + Util.generateURI(input.toString(),
                         pigServer.getPigContext()) + "' using PigStorage(',');");
         pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > 3;");
         pigServer.registerQuery("STREAMED_DATA = stream FILTERED_DATA " +
@@ -458,7 +458,7 @@ public class TestStreaming {
                 "input('bar' using " + PigStreaming.class.getName() + "(',')) " +
                 "stderr();");
         pigServer.registerQuery("IP = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()),
+                + Util.generateURI(input.toString(),
                         pigServer.getPigContext()) + "' using "
                 + PigStorage.class.getName() + "(',');");
         pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > 3;");
@@ -520,7 +520,7 @@ public class TestStreaming {
         		"'bar' using " + PigStreaming.class.getName() + "(',')) " +
         		"stderr();");
         pigServer.registerQuery("IP = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()),
+                + Util.generateURI(input.toString(),
                         pigServer.getPigContext()) + "' using "
                 + PigStorage.class.getName() + "(',');");
         pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > 3;");
@@ -583,7 +583,7 @@ public class TestStreaming {
         		"'bar' using PS) " +
         		"stderr();");
         pigServer.registerQuery("IP = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()),
+                + Util.generateURI(input.toString(),
                         pigServer.getPigContext()) + "' using PigStorage(',');");
         pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > 3;");
         pigServer.registerQuery("OP = stream FILTERED_DATA through CMD;");
@@ -644,7 +644,7 @@ public class TestStreaming {
                 "'foobar' using " + PigStreaming.class.getName() + "(',')) " +
                 "stderr();");
         pigServer.registerQuery("IP = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()),
+                + Util.generateURI(input.toString(),
                         pigServer.getPigContext()) + "' using "
                 + PigStorage.class.getName() + "(',');");
         pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > 3;");
@@ -697,7 +697,7 @@ public class TestStreaming {
             pigServer.registerQuery("define CMD `" + simpleEchoStreamingCommand +
                                     " | " + simpleEchoStreamingCommand + "`;");
             pigServer.registerQuery("IP = load '"
-                    + Util.generateURI(Util.encodeEscape(input.toString()),
+                    + Util.generateURI(input.toString(),
                             pigServer.getPigContext()) + "' using "
                     + PigStorage.class.getName() + "(',');");
             if(withTypes[i] == true) {
@@ -738,7 +738,7 @@ public class TestStreaming {
             pigServer.registerQuery("define CMD `"+ simpleEchoStreamingCommand +
                                     "` input(stdin using " + PigStreamDump.class.getName() + ");");
             pigServer.registerQuery("IP = load '"
-                    + Util.generateURI(Util.encodeEscape(input.toString()),
+                    + Util.generateURI(input.toString(),
                             pigServer.getPigContext()) + "' using "
                     + PigStorage.class.getName() + "(',');");
             pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > '3';");
@@ -857,7 +857,7 @@ public class TestStreaming {
                 "output(stdout using " + PigStreaming.class.getName() + "(',')) " +
                 "stderr();");
         pigServer.registerQuery("IP = load '"
-                + Util.generateURI(Util.encodeEscape(input.toString()),
+                + Util.generateURI(input.toString(),
                         pigServer.getPigContext())
                 + "' using PigStorage();");
         pigServer.registerQuery("STREAMED_DATA = stream IP through CMD;");
diff --git a/test/org/apache/pig/test/TestStreamingLocal.java b/test/org/apache/pig/test/TestStreamingLocal.java
index 88ee43549..7f1d5f395 100644
--- a/test/org/apache/pig/test/TestStreamingLocal.java
+++ b/test/org/apache/pig/test/TestStreamingLocal.java
@@ -98,7 +98,7 @@ public class TestStreamingLocal {
 
             // Pig query to run
             pigServer.registerQuery("IP = load '" +
-                    Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext()) +
+                    Util.generateURI(input.toString(), pigServer.getPigContext()) +
                     "' using " + PigStorage.class.getName() + "(',');");
             pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > '3';");
             pigServer.registerQuery("S1 = stream FILTERED_DATA through `" +
@@ -141,7 +141,7 @@ public class TestStreamingLocal {
             }
             // Pig query to run
             pigServer.registerQuery("IP = load '" +
-                    Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext()) +
+                    Util.generateURI(input.toString(), pigServer.getPigContext()) +
                     "' using " + PigStorage.class.getName() + "(',');");
             pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > '3';");
             if(withTypes[i] == true) {
@@ -183,7 +183,7 @@ public class TestStreamingLocal {
 
             // Pig query to run
             pigServer.registerQuery("IP = load '" +
-                    Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext()) +
+                    Util.generateURI(input.toString(), pigServer.getPigContext()) +
                     "' using " + PigStorage.class.getName() + "(',');");
             pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > '3';");
             pigServer.registerQuery("GROUPED_DATA = group FILTERED_DATA by $0;");
@@ -232,7 +232,7 @@ public class TestStreamingLocal {
 
         // Pig query to run
         pigServer.registerQuery("IP = load '" +
-                Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext()) +
+                Util.generateURI(input.toString(), pigServer.getPigContext()) +
                 "' using " + PigStorage.class.getName() + "(',');");
         pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > '3';");
         pigServer.registerQuery("S1 = stream FILTERED_DATA through `" +
@@ -280,7 +280,7 @@ public class TestStreamingLocal {
             pigServer.registerQuery("define CMD `" + simpleEchoStreamingCommand +
                     " | " + simpleEchoStreamingCommand + "`;");
             pigServer.registerQuery("IP = load '" +
-                    Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext()) +
+                    Util.generateURI(input.toString(), pigServer.getPigContext()) +
                     "' using " + PigStorage.class.getName() + "(',');");
             if(withTypes[i] == true) {
                 pigServer.registerQuery("OP = stream IP through CMD as (f0:chararray, f1:int);");
@@ -310,11 +310,11 @@ public class TestStreamingLocal {
         expected.set(3, 0);
 
         pigServer.registerQuery("A = load '" +
-                Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext()) +
+                Util.generateURI(input.toString(), pigServer.getPigContext()) +
                 "' using " + PigStorage.class.getName() + "(',') as (a0, a1);");
         pigServer.registerQuery("B = stream A through `head -1` as (a0, a1);");
         pigServer.registerQuery("C = load '" +
-                Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext()) +
+                Util.generateURI(input.toString(), pigServer.getPigContext()) +
                 "' using " + PigStorage.class.getName() + "(',') as (a0, a1);");
         pigServer.registerQuery("D = stream C through `head -1` as (a0, a1);");
         pigServer.registerQuery("E = join B by a0, D by a0;");
@@ -359,7 +359,7 @@ public class TestStreamingLocal {
             pigServer.registerQuery("define CMD `"+ simpleEchoStreamingCommand +
             "` input(stdin);");
             pigServer.registerQuery("IP = load '" +
-                    Util.generateURI(Util.encodeEscape(input.toString()), pigServer.getPigContext()) +
+                    Util.generateURI(input.toString(), pigServer.getPigContext()) +
                     "' using " + PigStorage.class.getName() + "(',');");
             pigServer.registerQuery("FILTERED_DATA = filter IP by $1 > '3';");
             if(withTypes[i] == true) {
diff --git a/test/org/apache/pig/test/TestTypeCheckingValidatorNewLP.java b/test/org/apache/pig/test/TestTypeCheckingValidatorNewLP.java
index 5ba116d0a..228df0e63 100644
--- a/test/org/apache/pig/test/TestTypeCheckingValidatorNewLP.java
+++ b/test/org/apache/pig/test/TestTypeCheckingValidatorNewLP.java
@@ -3745,7 +3745,7 @@ public class TestTypeCheckingValidatorNewLP {
                      "[k1#good,k2#morning]" };
              PigServer ps = new PigServer(ExecType.LOCAL);
              File f = org.apache.pig.test.Util.createInputFile("test", ".txt", input);
-             String inputFileName = Util.generateURI(Util.encodeEscape(f.getAbsolutePath()), ps.getPigContext());
+             String inputFileName = Util.generateURI(f.getAbsolutePath(), ps.getPigContext());
              // load as bytearray and use as map
              String query = "a= load '" + inputFileName + "' as (m);"
              + " b = foreach a generate m#'k1';";
diff --git a/test/org/apache/pig/test/TestUDF.java b/test/org/apache/pig/test/TestUDF.java
index d1a4f2daa..bc4b6cfde 100644
--- a/test/org/apache/pig/test/TestUDF.java
+++ b/test/org/apache/pig/test/TestUDF.java
@@ -328,7 +328,7 @@ public class TestUDF {
         File inputFile = Util.createInputFile("tmp", "", 
                 new String[] {"\t", "2\t3"});
         pig.registerQuery("a = load '"
-                + Util.generateURI(Util.encodeEscape(inputFile.toString()), pig.getPigContext())
+                + Util.generateURI(inputFile.toString(), pig.getPigContext())
                 + "' as (i1:int, i2:int);");
         pig.registerQuery("b = foreach a generate " + IntToBool.class.getName() + "(i1);");
 
@@ -347,4 +347,4 @@ public class TestUDF {
             return (val == null || val == 0) ? false : true;
         }
     }
-}
\ No newline at end of file
+}
diff --git a/test/org/apache/pig/test/TestUnion.java b/test/org/apache/pig/test/TestUnion.java
index e3c30a779..c314f67c5 100644
--- a/test/org/apache/pig/test/TestUnion.java
+++ b/test/org/apache/pig/test/TestUnion.java
@@ -95,7 +95,7 @@ public class TestUnion {
         POLoad ld1 = GenPhyOp.topLoadOp();
         String curDir = System.getProperty("user.dir");
         String inpDir = curDir + File.separatorChar + "test/org/apache/pig/test/data/InputFiles/";
-        FileSpec fSpec = new FileSpec(Util.generateURI(Util.encodeEscape(inpDir + "passwd"), pc), new FuncSpec(PigStorage.class.getName() , new String[]{":"}));
+        FileSpec fSpec = new FileSpec(Util.generateURI(inpDir + "passwd", pc), new FuncSpec(PigStorage.class.getName() , new String[]{":"}));
         ld1.setLFile(fSpec);
 
         POLoad ld2 = GenPhyOp.topLoadOp();
@@ -290,8 +290,8 @@ public class TestUnion {
 
         PigServer ps = new PigServer(ExecType.LOCAL, new Properties());
         //PigStorage and TextLoader have different LoadCasters
-        ps.registerQuery("A = load '" + f1.getAbsolutePath() + "' as (a:bytearray);");
-        ps.registerQuery("B = load '" + f2.getAbsolutePath() + "' using TextLoader() as (b:bytearray);");
+        ps.registerQuery("A = load '" + Util.encodeEscape(f1.getAbsolutePath()) + "' as (a:bytearray);");
+        ps.registerQuery("B = load '" + Util.encodeEscape(f2.getAbsolutePath()) + "' using TextLoader() as (b:bytearray);");
         ps.registerQuery("C = union onschema A,B;");
         ps.registerQuery("D = foreach C generate (int)a as a,(chararray)b as b;");
 
@@ -321,9 +321,9 @@ public class TestUnion {
         File f3 = Util.createInputFile("tmp", "i3.txt", new String[] {"1","2","3"});
 
         PigServer ps = new PigServer(ExecType.LOCAL, new Properties());
-        ps.registerQuery("A = load '" + f1.getAbsolutePath() + "' as (a:bytearray);"); // Using PigStorage()
-        ps.registerQuery("B = load '" + f2.getAbsolutePath() + "' using TextLoader() as (i:bytearray);");
-        ps.registerQuery("C = load '" + f3.getAbsolutePath() + "' using TextLoader() as (i:bytearray);");
+        ps.registerQuery("A = load '" + Util.encodeEscape(f1.getAbsolutePath()) + "' as (a:bytearray);"); // Using PigStorage()
+        ps.registerQuery("B = load '" + Util.encodeEscape(f2.getAbsolutePath()) + "' using TextLoader() as (i:bytearray);");
+        ps.registerQuery("C = load '" + Util.encodeEscape(f3.getAbsolutePath()) + "' using TextLoader() as (i:bytearray);");
         ps.registerQuery("B2 = join B by i, A by a;");              //{A::a: bytearray,B::i: bytearray}
         ps.registerQuery("B3 = foreach B2 generate a, B::i as i;"); //{A::a: bytearray,i: bytearray}
         ps.registerQuery("C2 = join C by i, A by a;");              //{A::a: bytearray,C::i: bytearray}
@@ -347,8 +347,8 @@ public class TestUnion {
         PigServer ps = new PigServer(ExecType.LOCAL, new Properties());
         // PigStorage and PigStorageWithStatistics have the same
         // LoadCaster(== Utf8StorageConverter)
-        ps.registerQuery("A = load '" + f1.getAbsolutePath() + "' as (a:bytearray, b:bytearray);");
-        ps.registerQuery("B = load '" + f1.getAbsolutePath() +
+        ps.registerQuery("A = load '" + Util.encodeEscape(f1.getAbsolutePath()) + "' as (a:bytearray, b:bytearray);");
+        ps.registerQuery("B = load '" + Util.encodeEscape(f1.getAbsolutePath()) +
           "' using org.apache.pig.test.PigStorageWithStatistics() as (a:bytearray, b:bytearray);");
         ps.registerQuery("C = union onschema A,B;");
         ps.registerQuery("D = foreach C generate (int)a as a,(chararray)b as b;");
diff --git a/test/org/apache/pig/test/Util.java b/test/org/apache/pig/test/Util.java
index 2e0a46ce8..f85974f11 100644
--- a/test/org/apache/pig/test/Util.java
+++ b/test/org/apache/pig/test/Util.java
@@ -626,7 +626,11 @@ public class Util {
      static public void copyFromLocalToCluster(MiniGenericCluster cluster,
         String localFileName, String fileNameOnCluster) throws IOException {
         if(Util.WINDOWS){
-            localFileName = localFileName.replace('\\','/');
+            if (!localFileName.contains(":")) {
+                localFileName = localFileName.replace('\\','/');
+            } else {
+                localFileName = localFileName.replace('/','\\');
+            }
             fileNameOnCluster = fileNameOnCluster.replace('\\','/');
         }
         PigServer ps = new PigServer(cluster.getExecType(), cluster.getProperties());
@@ -907,6 +911,38 @@ public class Util {
         return executeJavaCommandAndReturnInfo(cmd).exitCode;
     }
 
+    public static class ReadStream implements Runnable {
+        InputStream is;
+        Thread thread;
+        String message = "";
+        public ReadStream(InputStream is) {
+            this.is = is;
+        }
+        public void start () {
+            thread = new Thread (this);
+            thread.start ();
+        }
+        public void run () {
+            try {
+                InputStreamReader isr = new InputStreamReader (is);
+                BufferedReader br = new BufferedReader (isr);
+                while (true) {
+                    String s = br.readLine ();
+                    if (s == null) break;
+                    if (!message.isEmpty()) {
+                        message += "\n";
+                    }
+                    message += s;
+                }
+                is.close ();
+            } catch (Exception ex) {
+                ex.printStackTrace ();
+            }
+        }
+        public String getMessage() {
+            return message;
+        }
+    }
 
     public static ProcessReturnInfo executeJavaCommandAndReturnInfo(String cmd)
     throws Exception {
@@ -917,24 +953,17 @@ public class Util {
         }
         Process cmdProc = Runtime.getRuntime().exec(cmd);
         ProcessReturnInfo pri = new ProcessReturnInfo();
-        pri.stderrContents = getContents(cmdProc.getErrorStream());
-        pri.stdoutContents = getContents(cmdProc.getInputStream());
+        ReadStream stdoutStream = new ReadStream(cmdProc.getInputStream ());
+        ReadStream stderrStream = new ReadStream(cmdProc.getErrorStream ());
+        stdoutStream.start();
+        stderrStream.start();
         cmdProc.waitFor();
         pri.exitCode = cmdProc.exitValue();
+        pri.stdoutContents = stdoutStream.getMessage();
+        pri.stderrContents = stderrStream.getMessage();
         return pri;
     }
 
-    private static String getContents(InputStream istr) throws IOException {
-        BufferedReader br = new BufferedReader(
-                new InputStreamReader(istr));
-        String s = "";
-        String line;
-        while ( (line = br.readLine()) != null) {
-            s += line + "\n";
-        }
-        return s;
-
-    }
     public static class ProcessReturnInfo {
         public int exitCode;
         public String stderrContents;
diff --git a/test/org/apache/pig/tez/TestTezJobControlCompiler.java b/test/org/apache/pig/tez/TestTezJobControlCompiler.java
index 3277d4876..4095fbe2c 100644
--- a/test/org/apache/pig/tez/TestTezJobControlCompiler.java
+++ b/test/org/apache/pig/tez/TestTezJobControlCompiler.java
@@ -190,7 +190,7 @@ public class TestTezJobControlCompiler {
         @Override
         public List<InputSplit> getSplits(JobContext job) throws IOException {
             String inputDir = job.getConfiguration().get(INPUT_DIR, "");
-            String numSplitString = inputDir.substring(inputDir.lastIndexOf(File.separator)+1);
+            String numSplitString = inputDir.substring(inputDir.lastIndexOf("/")+1);
             int numSplit = Integer.parseInt(numSplitString);
             List<InputSplit> splits = new ArrayList<InputSplit>();
             for (int i=0;i<numSplit;i++) {
