diff --git a/CHANGES.txt b/CHANGES.txt
index 14ee89df9..6639d37f1 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -147,6 +147,8 @@ PIG-1696: Performance: Use System.arraycopy() instead of manually copying the by
 
 BUG FIXES
 
+PIG-1979: New logical plan failing with ERROR 2229: Couldn't find matching uid -1 (daijy)
+
 PIG-1897: multiple star projection in a statement does not produce 
  the right plan (thejas)
 
diff --git a/src/org/apache/pig/newplan/logical/expression/DereferenceExpression.java b/src/org/apache/pig/newplan/logical/expression/DereferenceExpression.java
index da5599fd6..6564f302a 100644
--- a/src/org/apache/pig/newplan/logical/expression/DereferenceExpression.java
+++ b/src/org/apache/pig/newplan/logical/expression/DereferenceExpression.java
@@ -158,6 +158,7 @@ public class DereferenceExpression extends ColumnExpression {
                 bagSchema.addField(new LogicalSchema.LogicalFieldSchema(null, innerSchema, DataType.TUPLE, 
                         LogicalExpression.getNextUid()));
                 fieldSchema = new LogicalSchema.LogicalFieldSchema(null, bagSchema, DataType.BAG, LogicalExpression.getNextUid());
+                uidOnlyFieldSchema = fieldSchema.mergeUid(uidOnlyFieldSchema);
             }
             else { // Dereference a field out of a tuple
                 if (predFS.schema!=null) {
@@ -167,6 +168,7 @@ public class DereferenceExpression extends ColumnExpression {
                     fieldSchema = predFS.schema.getField(columns.get(0));
                 } else{
                     fieldSchema = new LogicalFieldSchema(null, null, DataType.BYTEARRAY);
+                    uidOnlyFieldSchema = fieldSchema.mergeUid(uidOnlyFieldSchema);
                 }
             }
         }
diff --git a/test/org/apache/pig/test/TestEvalPipeline2.java b/test/org/apache/pig/test/TestEvalPipeline2.java
index 46f862147..e75ce0a62 100644
--- a/test/org/apache/pig/test/TestEvalPipeline2.java
+++ b/test/org/apache/pig/test/TestEvalPipeline2.java
@@ -1459,5 +1459,29 @@ public class TestEvalPipeline2 {
         Assert.assertFalse(iter.hasNext());
     }
     
-    
+    // See PIG-1979
+    @Test
+    public void testDereferenceUidBug() throws Exception{
+        String[] input1 = {
+                "0\t0\t{(1,2)}\t1",
+        };
+        String[] input2 = {
+                "0\t0",
+        };
+        
+        Util.createInputFile(cluster, "table_testDereferenceUidBug1", input1);
+        Util.createInputFile(cluster, "table_testDereferenceUidBug2", input2);
+        pigServer.registerQuery("a = load 'table_testDereferenceUidBug1' as (a0:int, a1:int, a2:{t:(i0:int, i1:int)}, a3:int);");
+        pigServer.registerQuery("b = foreach a generate a0, a1, a0+a1 as sum, a2.i0 as a2, a3;");
+        pigServer.registerQuery("c = filter b by sum==0;");
+        pigServer.registerQuery("d = load 'table_testDereferenceUidBug2' as (d0:int, d1:int);");
+        pigServer.registerQuery("e = join c by a0, d by d0;");
+        pigServer.registerQuery("f = foreach e generate c::a2;");
+        
+        Iterator<Tuple> iter = pigServer.openIterator("f");
+        
+        Tuple t = iter.next();
+        Assert.assertTrue(t.toString().equals("({(1)})"));
+        Assert.assertFalse(iter.hasNext());
+    }    
 }
