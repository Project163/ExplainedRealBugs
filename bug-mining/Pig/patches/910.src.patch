diff --git a/CHANGES.txt b/CHANGES.txt
index 9509b2f1d..f3d794534 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -417,6 +417,8 @@ Release 0.9.3 - Unreleased
 
 BUG FIXES
 
+PIG-2534: Pig generating infinite map outputs (daijy)
+
 PIG-2493: UNION causes casting issues (vivekp via daijy)
 
 PIG-2497: Order of execution of fs, store and sh commands in Pig is not maintained (daijy)
diff --git a/src/org/apache/pig/newplan/logical/rules/ColumnPruneHelper.java b/src/org/apache/pig/newplan/logical/rules/ColumnPruneHelper.java
index e2dc33504..cd15fbd42 100644
--- a/src/org/apache/pig/newplan/logical/rules/ColumnPruneHelper.java
+++ b/src/org/apache/pig/newplan/logical/rules/ColumnPruneHelper.java
@@ -316,6 +316,9 @@ public class ColumnPruneHelper {
         
         @Override
         public void visit(LOStream stream) throws FrontendException {
+            // output is not used, setOutputUids is used to check if it has output schema
+            Set<Long> output = setOutputUids(stream);
+            
             // Every field is required
             LogicalRelationalOperator pred = (LogicalRelationalOperator)plan.getPredecessors(stream).get(0);
 
@@ -561,6 +564,8 @@ public class ColumnPruneHelper {
         }
         
         @SuppressWarnings("unchecked")
+        // Get output uid from output schema. If output schema does not exist,
+        // throw exception
         private Set<Long> setOutputUids(LogicalRelationalOperator op) throws FrontendException {
             
             List<Operator> ll = plan.getSuccessors(op);
diff --git a/test/findbugsExcludeFile.xml b/test/findbugsExcludeFile.xml
index a5416082d..a54c5b06e 100644
--- a/test/findbugsExcludeFile.xml
+++ b/test/findbugsExcludeFile.xml
@@ -445,4 +445,9 @@
         <Class name = "org.apache.pig.backend.hadoop.executionengine.mapReduceLayer.PigMapBase$IllustratorContext" />
         <Bug pattern = "SIC_INNER_SHOULD_BE_STATIC" />
     </Match>
+    <Match>
+        <Class name = "org.apache.pig.newplan.logical.rules.ColumnPruneHelper$ColumnDependencyVisitor" />
+        <Method name = "visit" />
+        <Bug pattern = "DLS_DEAD_LOCAL_STORE" />
+    </Match>
 </FindBugsFilter>
diff --git a/test/org/apache/pig/test/TestPruneColumn.java b/test/org/apache/pig/test/TestPruneColumn.java
index 84179370b..9bfa59e3f 100644
--- a/test/org/apache/pig/test/TestPruneColumn.java
+++ b/test/org/apache/pig/test/TestPruneColumn.java
@@ -2071,4 +2071,35 @@ public class TestPruneColumn extends TestCase {
         assertTrue(checkLogFileMessage(new String[]{"Columns pruned for A: $1"}));
     }
 
+    // See PIG-2534
+    @Test
+    public void testStream2() throws Exception {
+        File input1 = File.createTempFile("tmp", "");
+        input1.delete();
+        File input2 = File.createTempFile("tmp", "");
+        input2.delete();
+        
+        Util.createLocalInputFile(input1.getAbsolutePath(), new String[]
+                {"[key1#0,key2#5,key3#val3,key4#val4,key5#val5]"});
+        Util.createLocalInputFile(input2.getAbsolutePath(), new String[]
+                {"[key1#0,key2#5,key3#val3,key4#val4,key5#val5]"});
+        
+        pigServer.registerQuery("event_serve = LOAD '" + input1.getAbsolutePath() +
+                "' AS (s, m, l);");
+        pigServer.registerQuery("cm_data_raw = LOAD '" + input2.getAbsolutePath() +
+                "' AS (s, m, l);");
+        pigServer.registerQuery("cm_serve = FOREACH cm_data_raw GENERATE  s#'key3' AS f1,  s#'key4' AS f2, s#'key5' AS f3 ;");
+        pigServer.registerQuery("cm_serve_lowercase = stream cm_serve through `tr [:upper:] [:lower:]`;");
+        pigServer.registerQuery("cm_serve_final = FOREACH cm_serve_lowercase GENERATE  $0 AS cm_event_guid, $1 AS cm_receive_time, $2 AS cm_ctx_url;");
+        pigServer.registerQuery("event_serve_project = FOREACH  event_serve GENERATE  s#'key3' AS event_guid, s#'key4' AS receive_time;");
+        pigServer.registerQuery("event_serve_join = join cm_serve_final by (cm_event_guid), event_serve_project by (event_guid);");
+        Iterator<Tuple> iter = pigServer.openIterator("event_serve_join");
+        
+        String[] expected = new String[] {"(val3,val4,val5,val3,val4)"};
+
+        Util.checkQueryOutputsAfterSortRecursive(iter, expected, org.apache.pig.newplan.logical.Util.translateSchema(pigServer.dumpSchema("event_serve_join")));
+
+        assertTrue(checkLogFileMessage(new String[]{"Map key required for event_serve: $0->[key4, key3]", 
+                "Map key required for cm_data_raw: $0->[key4, key3, key5]"}));
+    }
 }
