diff --git a/CHANGES.txt b/CHANGES.txt
index e4fbc8f1e..2b18b4f0a 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -36,6 +36,9 @@ OPTIMIZATIONS
 
 BUG FIXES
 
+PIG-598: Parameter substitution ($PARAMETER) should not be performed in
+comments (thejas via olgan)
+
 PIG-1064: Behaviour of COGROUP with and without schema when using "*" operator
 (pradeepkth)
 
diff --git a/src/org/apache/pig/tools/parameters/ParamLoader.jj b/src/org/apache/pig/tools/parameters/ParamLoader.jj
index 1003106ac..36b462089 100644
--- a/src/org/apache/pig/tools/parameters/ParamLoader.jj
+++ b/src/org/apache/pig/tools/parameters/ParamLoader.jj
@@ -32,6 +32,11 @@ package org.apache.pig.tools.parameters;
 import java.io.IOException;
 import java.util.Hashtable;
 
+//warnings in by code generated by javacc cannot be fixed here, 
+// so suppressing all warnings for this class. But this does not help in 
+//supressing Warnings in other classes generated by this .jj file
+@SuppressWarnings("all")
+
 public class ParamLoader {
 
     private PreprocessorContext pc;
diff --git a/src/org/apache/pig/tools/parameters/ParameterSubstitutionPreprocessor.java b/src/org/apache/pig/tools/parameters/ParameterSubstitutionPreprocessor.java
index a47de871f..c03f09c93 100644
--- a/src/org/apache/pig/tools/parameters/ParameterSubstitutionPreprocessor.java
+++ b/src/org/apache/pig/tools/parameters/ParameterSubstitutionPreprocessor.java
@@ -52,7 +52,6 @@ public class ParameterSubstitutionPreprocessor {
 
         paramParser  = new ParamLoader(sr);
         paramParser.setContext(pc);
-
         pigParser = new PigFileParser(sr);
         pigParser.setContext(pc);
     }
@@ -87,33 +86,10 @@ public class ParameterSubstitutionPreprocessor {
     }
 
     private void parsePigFile(BufferedReader in, Writer out) throws ParseException {
-
+        pigParser.setOutputWriter(out);
+        pigParser.ReInit(in);
         try {
-            String line;
-            int lineNum=0;
-
-            while((line = in.readLine())!= null)
-            {
-                lineNum++;
-
-                if (line.length() == 0) {
-                    out.append("\n");
-                    continue;
-                }
-
-                if ( !(line.startsWith("%")) ) {
-                    //process an ordinary pig line - perform substitution
-                    String sub_line = pc.substitute(line);
-                    out.append(sub_line);
-                    out.append("\n");
-                    continue;
-                }
-
-                //parse the declare/default line
-                pigParser.ReInit(new StringReader(line));
-                pigParser.Parse();
-            }
-
+            pigParser.Parse();
             //close input and output streams
             in.close();
             out.flush();
@@ -122,7 +98,6 @@ public class ParameterSubstitutionPreprocessor {
             RuntimeException rte = new RuntimeException(e.getMessage() , e);
             throw rte;
         }
-
     }
 
     /* 
diff --git a/src/org/apache/pig/tools/parameters/PigFileParser.jj b/src/org/apache/pig/tools/parameters/PigFileParser.jj
index 2cebbf490..c5c4cb5a9 100644
--- a/src/org/apache/pig/tools/parameters/PigFileParser.jj
+++ b/src/org/apache/pig/tools/parameters/PigFileParser.jj
@@ -18,7 +18,7 @@
 
 /**
  * This grammar is used to process %declare and %default commands
- * within pig script
+ * within pig script, and substitute parameter values
  */
 
 options {
@@ -26,20 +26,34 @@ options {
     STATIC = false;
   	IGNORE_CASE = true;
     JAVA_UNICODE_ESCAPE = true;
+    //DEBUG_PARSER = true;
+    LOOKAHEAD = 2;          
+    
 }
 PARSER_BEGIN(PigFileParser)
+
 package org.apache.pig.tools.parameters;
 
 import java.io.IOException;
 import java.io.PrintWriter;
 import java.util.Hashtable;
+import java.io.Writer;
+import java.lang.StringBuilder;
+
+//warnings in by code generated by javacc cannot be fixed here, 
+// so suppressing all warnings for this class. But this does not help in 
+//supressing Warnings in other classes generated by this .jj file
+@SuppressWarnings("all")
 
 public class PigFileParser {
     private PreprocessorContext pc;
+    private Writer out;
     public void setContext(PreprocessorContext pc) {
         this.pc = pc;
     }
-
+    public void setOutputWriter(Writer out) {
+        this.out = out;
+    }
      private static String unquote(String s)
      {
         if (s.charAt(0) == '\'' && s.charAt(s.length()-1) == '\'')
@@ -53,12 +67,20 @@ public class PigFileParser {
 
 PARSER_END(PigFileParser)
 
-SKIP : 
+TOKEN : 
 {
-    "\n"
-|   "\r"
-|   " "
-|   "\t"
+    <NEWLINE: "\n" | "\r">
+    |    
+    <SPACE: " " | "\t">
+}
+
+// comments(single line and multi-line)
+TOKEN : 
+{
+   <COMMENT: "--"(~["\r","\n"])*
+          |  "#!" (~["\r","\n"])*
+          | "/*" (~["*"])* "*" ("*" | (~["*","/"] (~["*"])* "*"))* "/"
+   >   
 }
 
 TOKEN:
@@ -68,13 +90,15 @@ TOKEN:
     <#DIGIT : ["0"-"9"] >
     |
     <#SPECIALCHAR : ["_"] >
+    |
+    <#DOLLAR : ["$"]>
 }
 
 TOKEN :
 {
     <DECLARE: "%declare" >
     |
-    <PIGDEFAULT: "%default" >
+    <PIGDEFAULT: "%default" > 
 }
 
 TOKEN : 
@@ -85,30 +109,75 @@ TOKEN :
     |
     <SHELLCMD: "`" (~["`"])* "`" >
     |
-    <OTHER: ~["\"" , "'" , "`" , "a"-"z" , "A"-"Z" , "_" , "#" , "=" , " " , "\n" , "\t" , "\r", "%"] (~["\n","\r"])* >
+    // see others() rule for use of OTHER and NOT_OTHER_CHAR
+    // others() is supposed to match 'everything else'. To ensure that others()
+    // don't swallow other(all the ones above) tokens, it uses two tokens OTHER and NOT_OTHER_CHAR
+    // NOT_OTHER_CHAR consists of first characters of other tokens, and OTHER consists of one
+    // or more chars that don't belong to NOT_OTHER_CHAR. Since the tokeniser matches the longest 
+    // match, other tokens will get matched instead of NOT_OTHER_CHAR.
+    <OTHER: (~["\"" , "'" , "`" , "a"-"z" , "A"-"Z" , "_" , "#" , "=" , " " , "\n" , "\t" , "\r", "%", "/", "-", "$"])+ >
+    |
+    <NOT_OTHER_CHAR: ["\"" , "'" , "`" , "a"-"z" , "A"-"Z" , "_" , "#" , "=" , " " , "\n" , "\t" , "\r", "%", "/", "-", "$"] >
+ 
 }
 
+void Parse() throws IOException : {}
+{
+    (input())*<EOF>
+}
 
-
-void Parse() throws IOException  :
+void input() throws IOException  :
 {
-    Token id, val;
-    Boolean overwrite;
     String s;
+    Token strTok;
 }
 {
 
-    <DECLARE> { overwrite=true; }
+    <DECLARE> 
     (
-        id=<IDENTIFIER>
+        param_value(true) // overwrite=true
+    )
+    |
+    <PIGDEFAULT>
+    (
+        param_value(false) // overwrite=false
+    )
+    |
+    s = paramString(){}
+    {
+        //process an ordinary pig line - perform substitution
+        String sub_line = pc.substitute(s);
+        out.append(sub_line );
+    }
+    |
+    strTok = <IDENTIFIER>{}
+    {
+        out.append(strTok.image );
+    }
+    |
+    write_ignore_toks()
+
+}
+
+void param_value(boolean overwrite) throws IOException:
+{
+    Token id, val;
+    String s;
+    String other;
+    Token strTok;
+}
+{
+    (ignore_toks_nonewline())*         
+    id=<IDENTIFIER>
+    (ignore_toks_nonewline())*               
         (
-            val=<OTHER> { pc.processOrdLine(id.image , val.image);}
+            s=others() (ignore_toks_nonewline())* write_newline() { pc.processOrdLine(id.image , s, overwrite);}
             |
-            val=<IDENTIFIER>
+            val=<IDENTIFIER> // this construct is for cases like a.123
             {s = val.image;}
-            ( 
-                val =<OTHER>
-                {s += val.image;}
+            (   LOOKAHEAD( 2 )
+                other = others() (ignore_toks_nonewline())* write_newline()
+                { s += other; }
             )?
             {pc.processOrdLine(id.image , s, overwrite);}
             |
@@ -117,25 +186,136 @@ void Parse() throws IOException  :
             val=<LITERAL> { s = unquote(val.image); pc.processOrdLine(id.image, s, overwrite); }
 
         )
-    )
-    |
-    <PIGDEFAULT> { overwrite=false; }
+}
+
+//match others, see comments above 
+//on description of OTHER , NOT_OTHER_CHAR
+String others() throws IOException : 
+{ Token t;
+  StringBuilder sb = new StringBuilder();  
+}
+{
     (
-        id=<IDENTIFIER>
-        (
-            val=<OTHER> { pc.processOrdLine(id.image , val.image);}
-            |
-            val=<IDENTIFIER>
-            {s = val.image;}
-            ( 
-                val =<OTHER>
-                {s += val.image;}
-            )?
-            {pc.processOrdLine(id.image , s, overwrite);}
-            |
-            val=<SHELLCMD>  { pc.processShellCmd(id.image , val.image , overwrite); }
-            |
-            val=<LITERAL> { s = unquote(val.image); pc.processOrdLine(id.image , s, overwrite); }
-        )
+        t=<OTHER>
+        {
+            sb.append(t.image);
+        }
+        |
+        t=<NOT_OTHER_CHAR>
+        {
+            sb.append(t.image);
+        } 
     )   
+    (   
+        t=<OTHER>
+        { 
+            sb.append(t.image);
+        }   
+        |
+        t=<NOT_OTHER_CHAR>
+        {
+            sb.append(t.image);
+        }   
+        |
+        t=<IDENTIFIER>
+        {
+        //eg of this match is a unquoted filename - /d1/abc/
+            sb.append(t.image);
+        }   
+        |
+        t=<LITERAL>
+        {
+            sb.append(t.image);
+        }  
+        |
+        t=<SHELLCMD>
+        {
+            sb.append(t.image);
+        }   
+    )*{
+        return sb.toString();
+    }
+}
+
+
+// a string that can contain parameter
+String paramString() throws IOException : 
+{Token t;
+ String str;
+}
+{
+    str = others()
+    {
+        return str;
+    }    
+    |
+    t=<LITERAL>
+    {
+        return t.image;
+    }
+    |
+    t = <SHELLCMD>{}
+    {
+        return t.image;
+    }    
+}
+
+// write the newlines,spaces and comments to preserve formatting
+void write_ignore_toks() throws IOException : 
+{ String str;}
+{
+    str = ignore_toks(){
+        out.append(str);
+    }
+}
+
+
+// match the newlines,spaces and comments
+String ignore_toks_nonewline() throws IOException : 
+{   Token t; }
+{
+    t = <COMMENT>{
+        return t.image;
+    }
+    |
+    t = <SPACE>{
+        return t.image;
+    }
+}
+
+
+// match the newlines,spaces and comments
+String ignore_toks() throws IOException : 
+{   Token t;
+    String str;
 }
+{
+    t = <COMMENT>{
+        return t.image;
+    }
+    |
+    str = space_or_newline(){
+        return str;
+    }
+}
+
+String space_or_newline() :
+{ Token t; }
+{
+    t = <SPACE>{
+        return t.image;
+    }
+    |
+    t = <NEWLINE>{
+        return t.image;
+    }
+}
+
+void write_newline() throws IOException:
+{ Token t; }
+{
+    t = <NEWLINE>{
+        out.append(t.image);
+    }
+}
+
diff --git a/src/org/apache/pig/tools/parameters/PreprocessorContext.java b/src/org/apache/pig/tools/parameters/PreprocessorContext.java
index 00c002293..8220637bc 100644
--- a/src/org/apache/pig/tools/parameters/PreprocessorContext.java
+++ b/src/org/apache/pig/tools/parameters/PreprocessorContext.java
@@ -210,16 +210,16 @@ public class PreprocessorContext {
         return streamData.trim();
     }
 
-    private static String id_regex = "\\$[_]*[a-zA-Z][a-zA-Z_0-9]*";
+    private Pattern id_pattern = Pattern.compile("\\$[_]*[a-zA-Z][a-zA-Z_0-9]*");
+    
     public  String substitute(String line) {
 
         int index = line.indexOf('$');
         if (index == -1)	return line;
 
         String replaced_line = line;
-
-        Pattern identifier = Pattern.compile( id_regex );
-        Matcher keyMatcher = identifier.matcher( line );
+        
+        Matcher keyMatcher = id_pattern.matcher( line );
         String key="";
         String val="";
 
diff --git a/test/org/apache/pig/test/TestParamSubPreproc.java b/test/org/apache/pig/test/TestParamSubPreproc.java
index ab87cba95..d8ee9108c 100644
--- a/test/org/apache/pig/test/TestParamSubPreproc.java
+++ b/test/org/apache/pig/test/TestParamSubPreproc.java
@@ -167,7 +167,7 @@ public class TestParamSubPreproc extends TestCase {
             ps.genSubstitutedFile(pigIStream , pigOStream , arg , argFiles);
 
             FileInputStream pigResultStream = new FileInputStream(basedir + "/output1.pig");
-            pigExResultStream = new FileInputStream(basedir + "/ExpectedResult.pig");
+            pigExResultStream = new FileInputStream(basedir + "/ExpectedResultDefault.pig");
             BufferedReader inExpected = new BufferedReader(new InputStreamReader(pigExResultStream));
             BufferedReader inResult = new BufferedReader(new InputStreamReader(pigResultStream));
 
@@ -259,7 +259,7 @@ public class TestParamSubPreproc extends TestCase {
             ps.genSubstitutedFile(pigIStream , pigOStream , arg , argFiles);
 
             FileInputStream pigResultStream = new FileInputStream(basedir + "/output1.pig");
-            pigExResultStream = new FileInputStream(basedir + "/ExpectedResult.pig");
+            pigExResultStream = new FileInputStream(basedir + "/ExpectedResult4.pig");
             BufferedReader inExpected = new BufferedReader(new InputStreamReader(pigExResultStream));
             BufferedReader inResult = new BufferedReader(new InputStreamReader(pigResultStream));
 
@@ -310,7 +310,7 @@ public class TestParamSubPreproc extends TestCase {
             ps.genSubstitutedFile(pigIStream , pigOStream , arg , argFiles);
 
             FileInputStream pigResultStream = new FileInputStream(basedir + "/output1.pig");
-            pigExResultStream = new FileInputStream(basedir + "/ExpectedResult.pig");
+            pigExResultStream = new FileInputStream(basedir + "/ExpectedResult4.pig");
             BufferedReader inExpected = new BufferedReader(new InputStreamReader(pigExResultStream));
             BufferedReader inResult = new BufferedReader(new InputStreamReader(pigResultStream));
 
@@ -359,7 +359,7 @@ public class TestParamSubPreproc extends TestCase {
             ps.genSubstitutedFile(pigIStream , pigOStream , arg , argFiles);
 
             FileInputStream pigResultStream = new FileInputStream(basedir + "/output1.pig");
-            pigExResultStream = new FileInputStream(basedir + "/ExpectedResult.pig");
+            pigExResultStream = new FileInputStream(basedir + "/ExpectedResultCmdLnPriorDeclare.pig");
             BufferedReader inExpected = new BufferedReader(new InputStreamReader(pigExResultStream));
             BufferedReader inResult = new BufferedReader(new InputStreamReader(pigResultStream));
 
@@ -409,7 +409,7 @@ public class TestParamSubPreproc extends TestCase {
             ps.genSubstitutedFile(pigIStream , pigOStream , arg , argFiles);
 
             FileInputStream pigResultStream = new FileInputStream(basedir + "/output1.pig");
-            pigExResultStream = new FileInputStream(basedir + "/ExpectedResult.pig");
+            pigExResultStream = new FileInputStream(basedir + "/ExpectedResult4.pig");
             BufferedReader inExpected = new BufferedReader(new InputStreamReader(pigExResultStream));
             BufferedReader inResult = new BufferedReader(new InputStreamReader(pigResultStream));
 
@@ -913,7 +913,7 @@ public class TestParamSubPreproc extends TestCase {
             ps.genSubstitutedFile(pigIStream , pigOStream , arg , argFiles);
 
             FileInputStream pigResultStream = new FileInputStream(basedir + "/output1.pig");
-            pigExResultStream = new FileInputStream(basedir + "/ExpectedResult.pig");
+            pigExResultStream = new FileInputStream(basedir + "/ExpectedResultMulDecs.pig");
             BufferedReader inExpected = new BufferedReader(new InputStreamReader(pigExResultStream));
             BufferedReader inResult = new BufferedReader(new InputStreamReader(pigResultStream));
 
@@ -1336,4 +1336,51 @@ public class TestParamSubPreproc extends TestCase {
         log.info("Done");
 
     }
+    
+    /* Test case 25
+     *   Test that params in comments are untouched
+     */
+    @Test
+    public void testCommentWithParam() throws Exception{
+        try {
+            ParameterSubstitutionPreprocessor ps = new ParameterSubstitutionPreprocessor(50);
+            pigIStream = new BufferedReader(new FileReader(basedir + "/inputComment.pig"));
+            pigOStream = new FileWriter(basedir + "/output1.pig");
+
+            String[] arg = {"date='20080228'"};
+            String[] argFiles = null;
+            ps.genSubstitutedFile(pigIStream , pigOStream , arg , argFiles);
+
+            FileInputStream pigResultStream = new FileInputStream(basedir + "/output1.pig");
+            pigExResultStream = new FileInputStream(basedir + "/ExpectedResultComment.pig");
+            BufferedReader inExpected = new BufferedReader(new InputStreamReader(pigExResultStream));
+            BufferedReader inResult = new BufferedReader(new InputStreamReader(pigResultStream));
+
+            String exLine;
+            String resLine;
+            int lineNum=0;
+
+            while (true) {
+                lineNum++;
+                exLine = inExpected.readLine();
+                resLine = inResult.readLine();
+                if (exLine==null || resLine==null)
+                    break;
+                assertEquals("Expected : "+exLine+" , but got : "+resLine+" in line num : "+lineNum ,exLine.trim(), resLine.trim());
+            }
+            if (!(exLine==null && resLine==null)) {
+                fail ("Expected : "+exLine+" , but got : "+resLine+" in line num : "+lineNum);
+            }
+
+            inExpected.close();
+            inResult.close();
+        } catch (ParseException e) {
+            fail ("Got ParseException : " + e.getMessage());
+        } catch (RuntimeException e) {
+            fail ("Got RuntimeException : " + e.getMessage());
+        } catch (Error e) {
+            fail ("Got error : " + e.getMessage());
+        }
+
+    }
 }
diff --git a/test/org/apache/pig/test/data/ExpectedResult.pig b/test/org/apache/pig/test/data/ExpectedResult.pig
index bd4aedf37..7efa27d14 100644
--- a/test/org/apache/pig/test/data/ExpectedResult.pig
+++ b/test/org/apache/pig/test/data/ExpectedResult.pig
@@ -8,4 +8,4 @@ inactiveAccounts = filter a by ($1 neq '') and ($1 == '2') parallel 400;
 store inactiveAccounts into '/user/kaleidoscope/pow_stats/20080228/acct/InactiveAcct';
 grpInactiveAcct = group inactiveAccounts all;
 countInactiveAcct = foreach grpInactiveAcct { generate COUNT( inactiveAccounts ); }
-store countInactiveAcct into '/user/kaleidoscope/pow_stats/20080228/acct_stats/InactiveAcctCount';
\ No newline at end of file
+store countInactiveAcct into '/user/kaleidoscope/pow_stats/20080228/acct_stats/InactiveAcctCount';
diff --git a/test/org/apache/pig/test/data/ExpectedResult2.pig b/test/org/apache/pig/test/data/ExpectedResult2.pig
index 56f18b11f..26c78180b 100644
--- a/test/org/apache/pig/test/data/ExpectedResult2.pig
+++ b/test/org/apache/pig/test/data/ExpectedResult2.pig
@@ -8,4 +8,4 @@ inactiveAccounts = filter a by ($1 neq '$column1') and ($1 == '2') parallel 400;
 store inactiveAccounts into '/user/kaleidoscope/pow_stats/20080228/acct/InactiveAcct';
 grpInactiveAcct = group inactiveAccounts all;
 countInactiveAcct = foreach grpInactiveAcct { generate COUNT( inactiveAccounts ); }
-store countInactiveAcct into '/user/kaleidoscope/pow_stats/20080228/acct_stats/InactiveAcctCount';
\ No newline at end of file
+store countInactiveAcct into '/user/kaleidoscope/pow_stats/20080228/acct_stats/InactiveAcctCount';
diff --git a/test/org/apache/pig/test/data/ExpectedResult4.pig b/test/org/apache/pig/test/data/ExpectedResult4.pig
new file mode 100644
index 000000000..95a17bafa
--- /dev/null
+++ b/test/org/apache/pig/test/data/ExpectedResult4.pig
@@ -0,0 +1,14 @@
+
+
+
+
+aa = load '/data/intermediate/pow/elcarobootstrap/account/full/weekly/data/20080228' using PigStorage('\x01');
+bb = filter aa by (ARITY == '16') and ( $4 eq '' or $4 eq 'NULL' or $4 eq 'ss') parallel 400;
+a = foreach bb generate $0,$12,$7;
+
+--generate inactive accts
+inactiveAccounts = filter a by ($1 neq '') and ($1 == '2') parallel 400;
+store inactiveAccounts into '/user/kaleidoscope/pow_stats/20080228/acct/InactiveAcct';
+grpInactiveAcct = group inactiveAccounts all;
+countInactiveAcct = foreach grpInactiveAcct { generate COUNT( inactiveAccounts ); }
+store countInactiveAcct into '/user/kaleidoscope/pow_stats/20080228/acct_stats/InactiveAcctCount';
diff --git a/test/org/apache/pig/test/data/ExpectedResultCmdLnPriorDeclare.pig b/test/org/apache/pig/test/data/ExpectedResultCmdLnPriorDeclare.pig
new file mode 100644
index 000000000..eded249e6
--- /dev/null
+++ b/test/org/apache/pig/test/data/ExpectedResultCmdLnPriorDeclare.pig
@@ -0,0 +1,12 @@
+
+aa = load '/data/intermediate/pow/elcarobootstrap/account/full/weekly/data/20080228' using PigStorage('\x01');
+
+bb = filter aa by (ARITY == '16') and ( $4 eq '' or $4 eq 'NULL' or $4 eq 'ss') parallel 400;
+a = foreach bb generate $0,$12,$7;
+
+--generate inactive accts
+inactiveAccounts = filter a by ($1 neq '') and ($1 == '2') parallel 400;
+store inactiveAccounts into '/user/kaleidoscope/pow_stats/20080228/acct/InactiveAcct';
+grpInactiveAcct = group inactiveAccounts all;
+countInactiveAcct = foreach grpInactiveAcct { generate COUNT( inactiveAccounts ); }
+store countInactiveAcct into '/user/kaleidoscope/pow_stats/20080228/acct_stats/InactiveAcctCount';
diff --git a/test/org/apache/pig/test/data/ExpectedResultComment.pig b/test/org/apache/pig/test/data/ExpectedResultComment.pig
new file mode 100644
index 000000000..d8ab6a67a
--- /dev/null
+++ b/test/org/apache/pig/test/data/ExpectedResultComment.pig
@@ -0,0 +1,18 @@
+-- %declare date '20080228'
+-- l = load '$xyz';
+
+/* comment */ 
+
+/* l = load '$zxv';
+   store l into '$zxcv';
+*/
+aa = load '/data/intermediate/pow/elcarobootstrap/account/full/weekly/data/20080228' using PigStorage('\x01');
+bb = filter aa by (ARITY == '16') and ( $4 eq '' or $4 eq 'NULL' or $4 eq 'ss') parallel 400;
+a = foreach bb generate /* $col 1 */ $0,$12,$7;  
+/* $date /* */
+--generate inactive accts
+inactiveAccounts = filter a by ($1 neq '') and ($1 == '2') parallel 400; -- testing $comment
+store inactiveAccounts into '/user/kaleidoscope/pow_stats/20080228/acct/InactiveAcct';
+grpInactiveAcct = group inactiveAccounts all;
+countInactiveAcct = foreach grpInactiveAcct { generate COUNT( inactiveAccounts ); }
+store countInactiveAcct into '/user/kaleidoscope/pow_stats/20080228/acct_stats/InactiveAcctCount';
diff --git a/test/org/apache/pig/test/data/ExpectedResultDefault.pig b/test/org/apache/pig/test/data/ExpectedResultDefault.pig
new file mode 100644
index 000000000..9f8b9cf8e
--- /dev/null
+++ b/test/org/apache/pig/test/data/ExpectedResultDefault.pig
@@ -0,0 +1,12 @@
+
+
+aa = load '/data/intermediate/pow/elcarobootstrap/account/full/weekly/data/20080228' using PigStorage('\x01');
+bb = filter aa by (ARITY == '16') and ( $4 eq '' or $4 eq 'NULL' or $4 eq 'ss') parallel 400;
+a = foreach bb generate $0,$12,$7;
+
+--generate inactive accts
+inactiveAccounts = filter a by ($1 neq '') and ($1 == '2') parallel 400;
+store inactiveAccounts into '/user/kaleidoscope/pow_stats/20080228/acct/InactiveAcct';
+grpInactiveAcct = group inactiveAccounts all;
+countInactiveAcct = foreach grpInactiveAcct { generate COUNT( inactiveAccounts ); }
+store countInactiveAcct into '/user/kaleidoscope/pow_stats/20080228/acct_stats/InactiveAcctCount';
diff --git a/test/org/apache/pig/test/data/ExpectedResultMulDecs.pig b/test/org/apache/pig/test/data/ExpectedResultMulDecs.pig
new file mode 100644
index 000000000..47c78230d
--- /dev/null
+++ b/test/org/apache/pig/test/data/ExpectedResultMulDecs.pig
@@ -0,0 +1,13 @@
+
+aa = load '/data/intermediate/pow/elcarobootstrap/account/full/weekly/data/20080228' using PigStorage('\x01');
+bb = filter aa by (ARITY == '16') and ( $4 eq '' or $4 eq 'NULL' or $4 eq 'ss') parallel 400;
+a = foreach bb generate $0,$12,$7;
+
+--generate inactive accts
+
+inactiveAccounts = filter a by ($1 neq '') and ($1 == '2') parallel 400;
+store inactiveAccounts into '/user/kaleidoscope/pow_stats/20080228/acct/InactiveAcct';
+
+grpInactiveAcct = group inactiveAccounts all;
+countInactiveAcct = foreach grpInactiveAcct { generate COUNT( inactiveAccounts ); }
+store countInactiveAcct into '/user/kaleidoscope/pow_stats/20080228/acct_stats/InactiveAcctCount';
diff --git a/test/org/apache/pig/test/data/input5.pig b/test/org/apache/pig/test/data/input5.pig
index f0866068c..5a615442f 100644
--- a/test/org/apache/pig/test/data/input5.pig
+++ b/test/org/apache/pig/test/data/input5.pig
@@ -1,5 +1,4 @@
 %declare udfs /data/pigudf.jar
-
 register $udfs;
 
 aa = load '$loadfile ' using PigStorage('\x01');
diff --git a/test/org/apache/pig/test/data/inputComment.pig b/test/org/apache/pig/test/data/inputComment.pig
new file mode 100644
index 000000000..498d1aacc
--- /dev/null
+++ b/test/org/apache/pig/test/data/inputComment.pig
@@ -0,0 +1,18 @@
+-- %declare date '20080228'
+-- l = load '$xyz';
+%default date /* comment */ 1000 -- setting default
+/* comment */ %declare arity 16
+
+/* l = load '$zxv';
+   store l into '$zxcv';
+*/
+aa = load '/data/intermediate/pow/elcarobootstrap/account/full/weekly/data/$date' using PigStorage('\x01');
+bb = filter aa by (ARITY == '$arity') and ( $4 eq '' or $4 eq 'NULL' or $4 eq 'ss') parallel 400;
+a = foreach bb generate /* $col 1 */ $0,$12,$7;  
+/* $date /* */
+--generate inactive accts
+inactiveAccounts = filter a by ($1 neq '') and ($1 == '2') parallel 400; -- testing $comment
+store inactiveAccounts into '/user/kaleidoscope/pow_stats/20080228/acct/InactiveAcct';
+grpInactiveAcct = group inactiveAccounts all;
+countInactiveAcct = foreach grpInactiveAcct { generate COUNT( inactiveAccounts ); }
+store countInactiveAcct into '/user/kaleidoscope/pow_stats/20080228/acct_stats/InactiveAcctCount';
diff --git a/test/org/apache/pig/test/data/inputDefault.pig b/test/org/apache/pig/test/data/inputDefault.pig
index efb3766c9..a437e845a 100644
--- a/test/org/apache/pig/test/data/inputDefault.pig
+++ b/test/org/apache/pig/test/data/inputDefault.pig
@@ -1,5 +1,4 @@
 %default date '20080228'
-
 aa = load '/data/intermediate/pow/elcarobootstrap/account/full/weekly/data/$date' using PigStorage('\x01');
 bb = filter aa by (ARITY == '16') and ( $4 eq '' or $4 eq 'NULL' or $4 eq 'ss') parallel 400;
 a = foreach bb generate $0,$12,$7;
diff --git a/test/org/apache/pig/test/data/inputEscape.pig b/test/org/apache/pig/test/data/inputEscape.pig
index 1befdc46a..aa7e3cc86 100644
--- a/test/org/apache/pig/test/data/inputEscape.pig
+++ b/test/org/apache/pig/test/data/inputEscape.pig
@@ -1,5 +1,4 @@
 %default column1 'asdf'
-
 aa = load '/data/intermediate/pow/elcarobootstrap/account/full/weekly/data/20080228' using PigStorage('\x01');
 bb = filter aa by (ARITY == '16') and ( $4 eq '' or $4 eq 'NULL' or $4 eq 'ss') parallel 400;
 a = foreach bb generate $0,$12,$7;
diff --git a/test/org/apache/pig/test/data/inputSubstitutionWithinShellCommand.pig b/test/org/apache/pig/test/data/inputSubstitutionWithinShellCommand.pig
index 3fd67c5b5..634ff8d8b 100644
--- a/test/org/apache/pig/test/data/inputSubstitutionWithinShellCommand.pig
+++ b/test/org/apache/pig/test/data/inputSubstitutionWithinShellCommand.pig
@@ -1,4 +1,5 @@
 
+
 %DECLARE date '20080228'
 %DECLARE formatted_date `sh test/org/apache/pig/test/data/generate_date.sh $date`
 aa = load '/data/intermediate/pow/elcarobootstrap/account/full/weekly/data/$formatted_date' using PigStorage('\x01');
diff --git a/test/org/apache/pig/test/data/inputThreeParams.pig b/test/org/apache/pig/test/data/inputThreeParams.pig
index 50724672f..ed78c8b2f 100644
--- a/test/org/apache/pig/test/data/inputThreeParams.pig
+++ b/test/org/apache/pig/test/data/inputThreeParams.pig
@@ -1,9 +1,7 @@
 %default tableName 'value to be skipped'
-
 aa = load '/data/intermediate/pow/elcarobootstrap/account/full/weekly/data/$date' using PigStorage('\x01');
 bb = filter aa by (ARITY == '16') and ( $4 eq '' or $4 eq 'NULL' or $4 eq 'ss') parallel 400;
 a = foreach bb generate $0,$12,$7;
-
 %declare tableName 'inactiveAccounts'
 --generate inactive accts
 $tableName = filter a by ($1 neq '') and ($1 == '2') parallel 400;
diff --git a/test/org/apache/pig/test/data/output1.pig b/test/org/apache/pig/test/data/output1.pig
index f71307d75..d8ab6a67a 100644
--- a/test/org/apache/pig/test/data/output1.pig
+++ b/test/org/apache/pig/test/data/output1.pig
@@ -1,7 +1,18 @@
+-- %declare date '20080228'
+-- l = load '$xyz';
 
-register /data/pigudf.jar;
+/* comment */ 
 
-aa = load '/user/pig/tests/data/singlefile/textdoc.txt ' using PigStorage('\x01');
+/* l = load '$zxv';
+   store l into '$zxcv';
+*/
+aa = load '/data/intermediate/pow/elcarobootstrap/account/full/weekly/data/20080228' using PigStorage('\x01');
 bb = filter aa by (ARITY == '16') and ( $4 eq '' or $4 eq 'NULL' or $4 eq 'ss') parallel 400;
-a = foreach bb generate $0,$12,$7;
-store inactiveAccounts into '/user/pig/tests/results/DefineClause_4.out';
+a = foreach bb generate /* $col 1 */ $0,$12,$7;  
+/* $date /* */
+--generate inactive accts
+inactiveAccounts = filter a by ($1 neq '') and ($1 == '2') parallel 400; -- testing $comment
+store inactiveAccounts into '/user/kaleidoscope/pow_stats/20080228/acct/InactiveAcct';
+grpInactiveAcct = group inactiveAccounts all;
+countInactiveAcct = foreach grpInactiveAcct { generate COUNT( inactiveAccounts ); }
+store countInactiveAcct into '/user/kaleidoscope/pow_stats/20080228/acct_stats/InactiveAcctCount';
