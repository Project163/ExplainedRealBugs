diff --git a/CHANGES.txt b/CHANGES.txt
index 11c673720..915c8a36d 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -32,6 +32,8 @@ PIG-1876: Typed map for Pig (daijy)
 
 IMPROVEMENTS
 
+PIG-1947: Incorrect line number is reported during parsing(xuefu)
+
 PIG1918: Line number should be give for logical plan failures (xuefu)
 
 PIG-1961: Pig prints "null" as file name in case of grammar error (xuefu)
diff --git a/src/org/apache/pig/PigServer.java b/src/org/apache/pig/PigServer.java
index 9de3bc65a..3ef1b5ec6 100644
--- a/src/org/apache/pig/PigServer.java
+++ b/src/org/apache/pig/PigServer.java
@@ -1362,6 +1362,8 @@ public class PigServer {
 
         private LogicalPlan lp;
 
+        private int currentLineNum = 0;
+        
         Graph(boolean batchMode) {
             this.batchMode = batchMode;
             this.lp = new LogicalPlan();
@@ -1505,8 +1507,22 @@ public class PigServer {
          * an overall (raw) plan.
          */
         void registerQuery(String query, int startLine) throws IOException {
-            scriptCache.add( query );
-            
+            if( batchMode ) {
+                if( startLine == currentLineNum ) {
+                    String line = scriptCache.remove( scriptCache.size() - 1 );
+                    scriptCache.add( line + query );
+                } else {
+                    while( startLine > currentLineNum + 1 ) {
+                        scriptCache.add( "" );
+                        currentLineNum++;
+                    }
+                    scriptCache.add( query );
+                    currentLineNum = startLine;
+                }
+            } else {
+                scriptCache.add( query );
+            }
+           
             if( !batchMode ) {
                 validateQuery();
             }
diff --git a/test/org/apache/pig/test/TestGrunt.java b/test/org/apache/pig/test/TestGrunt.java
index 2339f4854..46b959807 100644
--- a/test/org/apache/pig/test/TestGrunt.java
+++ b/test/org/apache/pig/test/TestGrunt.java
@@ -23,6 +23,7 @@ import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.junit.runners.JUnit4;
 
+import junit.framework.Assert;
 import junit.framework.TestCase;
 import org.apache.log4j.Appender;
 import org.apache.log4j.FileAppender;
@@ -35,7 +36,6 @@ import org.apache.pig.impl.PigContext;
 import org.apache.pig.tools.grunt.Grunt;
 import org.apache.pig.tools.pigscript.parser.ParseException;
 import org.apache.pig.impl.io.FileLocalizer;
-import org.apache.pig.impl.util.LogUtils;
 
 import java.io.ByteArrayInputStream;
 import java.io.File;
@@ -426,6 +426,30 @@ public class TestGrunt extends TestCase {
         assertTrue(caught);
     }
     
+    @Test
+    public void testErrorLineNumber() throws Throwable {
+        PigServer server = new PigServer(ExecType.MAPREDUCE, cluster.getProperties());
+        PigContext context = server.getPigContext();
+        
+        String strCmd = "A = load 'x' as ( u:int, v:chararray );\n" +
+                        "sh ls\n" +
+                        "B = foreach A generate u , v; C = distinct 'xxx';\n" +
+                        "store C into 'y';";
+        
+        ByteArrayInputStream cmd = new ByteArrayInputStream(strCmd.getBytes());
+        InputStreamReader reader = new InputStreamReader(cmd);
+        
+        Grunt grunt = new Grunt(new BufferedReader(reader), context);
+        
+        try {
+            grunt.exec();
+        } catch (Exception e) {
+            assertTrue(e.getMessage().contains("line 3, column 42"));
+            return;
+        }
+        Assert.fail( "Test case is supposed to fail." );
+    }
+    
     @Test
     public void testExplainEmpty() throws Throwable {
         PigServer server = new PigServer(ExecType.MAPREDUCE, cluster.getProperties());
