diff --git a/CHANGES.txt b/CHANGES.txt
index d56e0e047..0fd18b246 100644
--- a/CHANGES.txt
+++ b/CHANGES.txt
@@ -45,8 +45,6 @@ PIG-1085:  Pass JobConf and UDF specific configuration information to UDFs
 
 OPTIMIZATIONS
 
-PIG-922: Logical optimizer: push up project (daijy)
-
 BUG FIXES
 
 PIG-1105: COUNT_STAR accumulate interface implementation cases failure
@@ -85,6 +83,8 @@ Release 0.6.0 - Unreleased
 
 INCOMPATIBLE CHANGES
 
+PIG-922: Logical optimizer: push up project (daijy)
+
 IMPROVEMENTS
 
 PIG-1084: Pig 0.6.0 Documentation improvements  (chandec via olgan)
@@ -182,6 +182,8 @@ PIG-979: Acummulator Interface for UDFs (yinghe via daijy)
 
 OPTIMIZATIONS
 
+PIG-922: Logical optimizer: push up project (daijy)
+
 BUG FIXES
 
 PIG-1080: PigStorage may miss records when loading a file (rding via olgan)
@@ -251,6 +253,9 @@ PIG-1001: Generate more meaningful error message when one input file does not ex
 
 PIG-1060: MultiQuery optimization throws error for multi-level splits (rding via daijy)
 
+PIG-1128: column pruning causing failure when foreach has user-specified
+schema (daijy)
+
 Release 0.5.0
 
 INCOMPATIBLE CHANGES
diff --git a/src/org/apache/pig/impl/logicalLayer/LOForEach.java b/src/org/apache/pig/impl/logicalLayer/LOForEach.java
index f03010092..9a19753c3 100644
--- a/src/org/apache/pig/impl/logicalLayer/LOForEach.java
+++ b/src/org/apache/pig/impl/logicalLayer/LOForEach.java
@@ -944,6 +944,12 @@ public class LOForEach extends RelationalOperator {
         }
         while (planToRemove.size() > 0) {
             int index = planToRemove.get(planToRemove.size()-1);
+            if (mUserDefinedSchema!=null) {
+                for (int i=mUserDefinedSchema.size()-1;i>=0;i--) {
+                    if (getRelevantPlan(0, i)==mForEachPlans.get(index))
+                        mUserDefinedSchema.remove(i);
+                }
+            }
             mForEachPlans.remove(index);
             mFlatten.remove(index);
             planToRemove.remove(planToRemove.size()-1);
diff --git a/test/org/apache/pig/test/TestPruneColumn.java b/test/org/apache/pig/test/TestPruneColumn.java
index b42d32266..bd3145be1 100644
--- a/test/org/apache/pig/test/TestPruneColumn.java
+++ b/test/org/apache/pig/test/TestPruneColumn.java
@@ -1453,5 +1453,28 @@ public class TestPruneColumn extends TestCase {
         assertTrue(checkLogFileMessage(new String[]{"No column pruned for A", 
                 "No map keys pruned for A", "Columns pruned for B: $0", 
                 "No map keys pruned for B"}));
-    } 
+    }
+    
+    // See PIG-1128
+    @Test
+    public void testUserDefinedSchema() throws Exception {
+        pigServer.registerQuery("A = load '"+ Util.generateURI(tmpFile1.toString()) + "' AS ( c1 : chararray, c2 : int);");
+        pigServer.registerQuery("B = foreach A generate c1 as c1 : chararray, c2 as c2 : int, 'CA' as state : chararray;");
+        pigServer.registerQuery("C = foreach B generate c1 as c1 : chararray;");
+        
+        Iterator<Tuple> iter = pigServer.openIterator("C");
+        
+        assertTrue(iter.hasNext());
+        Tuple t = iter.next();
+        assertTrue(t.toString().equals("(1)"));
+        
+        assertTrue(iter.hasNext());
+        t = iter.next();
+        assertTrue(t.toString().equals("(2)"));
+
+        assertFalse(iter.hasNext());
+        
+        assertTrue(checkLogFileMessage(new String[]{"Columns pruned for A: $1", 
+                "No map keys pruned for A"}));
+    }
 }
