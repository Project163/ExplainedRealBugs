<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:58:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-19516] S3A: SDK reads content twice during PUT to S3 Express store.</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-19516</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;The commit on trunk &lt;tt&gt;60c7d4fea010&lt;/tt&gt; and on branch 3.4 &lt;tt&gt;f3ec55b&lt;/tt&gt; fixes the logging, but does not&lt;br/&gt;
address the underlying issue.&lt;/p&gt;

&lt;h2&gt;&lt;a name=&quot;problem&quot;&gt;&lt;/a&gt;problem&lt;/h2&gt;

&lt;p&gt;During PUT calls, even of 0 byte objects, our UploadContentProver is reporting a recreation of &lt;br/&gt;
of the input stream of an UploadContentProvider, as seen by our logging at info of this happening&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 bin/hadoop fs -touchz $v3/4
2025-03-26 13:38:53,377 [main] INFO  impl.UploadContentProviders (UploadContentProviders.java:newStream(289)) - Stream recreated: FileWithOffsetContentProvider{file=/tmp/hadoop-stevel/s3a/s3ablock-0001-659277820991634509.tmp, offset=0} BaseContentProvider{size=0, initiated at 2025-03-26T13:38:53.355, streamCreationCount=2, currentStream=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This code was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-19221&quot; title=&quot;S3A: Unable to recover from failure of multipart block upload attempt &amp;quot;Status Code: 400; Error Code: RequestTimeout&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-19221&quot;&gt;&lt;del&gt;HADOOP-19221&lt;/del&gt;&lt;/a&gt;, S3A: Unable to recover from failure of multipart block upload attempt &quot;Status Code: 400; Error Code: RequestTimeout&quot;; it logs at INFO because it is considered both rare and serious enough that we should log it, based on our hypothesis that it was triggered by a transient failure of the S3 service front and and the inability of the SDK to recover from it&lt;/p&gt;

&lt;p&gt;It turns out that uploading even a zero byte file to S3 triggers the dual creation of the stream, apparently from a dual signing.&lt;/p&gt;

&lt;p&gt;This &lt;b&gt;does not&lt;/b&gt; happen on multipart uploads.&lt;/p&gt;</description>
                <environment>&lt;p&gt;client in uK talking to s3 express ucket in us-w-2&lt;/p&gt;</environment>
        <key id="13613176">HADOOP-19516</key>
            <summary>S3A: SDK reads content twice during PUT to S3 Express store.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stevel@apache.org">Steve Loughran</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Mar 2025 14:30:19 +0000</created>
                <updated>Tue, 3 Jun 2025 10:59:51 +0000</updated>
                                            <version>3.4.1</version>
                    <version>3.4.2</version>
                                                    <component>fs/s3</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17938663" author="stevel@apache.org" created="Wed, 26 Mar 2025 16:57:35 +0000"  >&lt;p&gt;This exists on older releases; i&apos;d just not noticed. That is why we MUST test  against so many different endpoints.&lt;/p&gt;

&lt;p&gt;A lot of the s3 express code path in the SDK is  different from the S3 standard client, and so needs to be tested independently.&lt;/p&gt;


&lt;p&gt;For the SDK upgrade I will downgrade the log to debug and leave it to the SDK team to fix themselves.&lt;/p&gt;</comment>
                            <comment id="17955851" author="stevel@apache.org" created="Tue, 3 Jun 2025 10:09:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iwasakims&quot; class=&quot;user-hover&quot; rel=&quot;iwasakims&quot;&gt;iwasakims&lt;/a&gt; not fixed in our code...this appears to be an AWS SDK bug. has it gone away there?&lt;/p&gt;</comment>
                            <comment id="17955856" author="iwasakims" created="Tue, 3 Jun 2025 10:58:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt; oops. I misunderstood by just seeing only the first line of &lt;a href=&quot;https://github.com/apache/hadoop/commit/f3ec55b5911d1e5e7da438c64f614a59a7db62a3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commit message&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13585039">HADOOP-19221</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310760">
                    <name>Testing</name>
                                                                <inwardlinks description="Discovered while testing">
                                        <issuelink>
            <issuekey id="13610938">HADOOP-19485</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1v088:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>