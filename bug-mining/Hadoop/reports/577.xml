<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:37:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-8408] MR doesn&apos;t work with a non-default ViewFS mount table and security enabled</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-8408</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;With security enabled, if one sets up a ViewFS mount table using the default mount table name, everything works as expected. However, if you try to create a ViewFS mount table with a non-default name, you&apos;ll end up getting an error like the following (in this case &quot;vfs-cluster&quot; was the name of the mount table) when running an MR job:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalArgumentException: java.net.UnknownHostException: vfs-cluster
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12556334">HADOOP-8408</key>
            <summary>MR doesn&apos;t work with a non-default ViewFS mount table and security enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="atm">Aaron Myers</assignee>
                                    <reporter username="atm">Aaron Myers</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 May 2012 01:24:00 +0000</created>
                <updated>Thu, 11 Oct 2012 17:45:06 +0000</updated>
                            <resolved>Tue, 22 May 2012 07:51:13 +0000</resolved>
                                    <version>2.0.0-alpha</version>
                                    <fixVersion>2.0.2-alpha</fixVersion>
                                    <component>viewfs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13278478" author="atm" created="Fri, 18 May 2012 01:29:29 +0000"  >&lt;p&gt;Here&apos;s a patch which addresses the issue. The trouble is that ViewFileSystem didn&apos;t override FileSystem#getCanonicalServiceName, and thus used the default which assumes that the host name of the URI can be turned into an IP address. Without this patch, running an MR job on a view filesystem with a non-default mount table name yields the following exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalArgumentException: java.net.UnknownHostException: vfs-cluster
	at org.apache.hadoop.security.SecurityUtil.buildTokenService(SecurityUtil.java:400)
	at org.apache.hadoop.security.SecurityUtil.buildDTServiceName(SecurityUtil.java:281)
	at org.apache.hadoop.fs.FileSystem.getCanonicalServiceName(FileSystem.java:235)
	at org.apache.hadoop.mapreduce.security.TokenCache.obtainTokensForNamenodesInternal(TokenCache.java:124)
	at org.apache.hadoop.mapreduce.security.TokenCache.obtainTokensForNamenodesInternal(TokenCache.java:101)
	at org.apache.hadoop.mapreduce.security.TokenCache.obtainTokensForNamenodes(TokenCache.java:81)
	at org.apache.hadoop.mapreduce.lib.output.FileOutputFormat.checkOutputSpecs(FileOutputFormat.java:137)
	at org.apache.hadoop.mapreduce.JobSubmitter.checkSpecs(JobSubmitter.java:410)
	at org.apache.hadoop.mapreduce.JobSubmitter.submitJobInternal(JobSubmitter.java:325)
	at org.apache.hadoop.mapreduce.Job$11.run(Job.java:1226)
	at org.apache.hadoop.mapreduce.Job$11.run(Job.java:1)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:396)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1232)
	at org.apache.hadoop.mapreduce.Job.submit(Job.java:1223)
	at org.apache.hadoop.mapreduce.Job.waitForCompletion(Job.java:1244)
	at org.apache.hadoop.examples.QuasiMonteCarlo.estimatePi(QuasiMonteCarlo.java:306)
	at org.apache.hadoop.examples.QuasiMonteCarlo.run(QuasiMonteCarlo.java:351)
	at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:70)
	at org.apache.hadoop.examples.QuasiMonteCarlo.main(QuasiMonteCarlo.java:360)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.hadoop.util.ProgramDriver$ProgramDescription.invoke(ProgramDriver.java:72)
	at org.apache.hadoop.util.ProgramDriver.driver(ProgramDriver.java:144)
	at org.apache.hadoop.examples.ExampleDriver.main(ExampleDriver.java:68)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.hadoop.util.RunJar.main(RunJar.java:208)
Caused by: java.net.UnknownHostException: vfs-cluster
	at org.apache.hadoop.security.SecurityUtil.buildTokenService(SecurityUtil.java:401)
	... 31 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In addition to the automated tests in this patch, I also verified manually that I can successfully run MR jobs on a secure cluster with a non-default mount table name.&lt;/p&gt;</comment>
                            <comment id="13278479" author="atm" created="Fri, 18 May 2012 01:31:35 +0000"  >&lt;p&gt;I should&apos;ve mentioned: this is basically the ViewFS analog of what &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-3062&quot; title=&quot;Fail to submit mapred job on a secured-HA-HDFS: logic URI cannot be picked up by job submission.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-3062&quot;&gt;&lt;del&gt;HDFS-3062&lt;/del&gt;&lt;/a&gt; was for HA.&lt;/p&gt;</comment>
                            <comment id="13278496" author="hadoopqa" created="Fri, 18 May 2012 02:00:26 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12527975/HDFS-8408.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12527975/HDFS-8408.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1005//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1005//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1005//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1005//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13278501" author="atm" created="Fri, 18 May 2012 02:04:32 +0000"  >&lt;p&gt;The javadoc warnings are unrelated. &lt;/p&gt;</comment>
                            <comment id="13278566" author="eli2" created="Fri, 18 May 2012 04:22:38 +0000"  >&lt;p&gt;+1 looks great&lt;/p&gt;</comment>
                            <comment id="13278567" author="eli2" created="Fri, 18 May 2012 04:23:01 +0000"  >&lt;p&gt;I&apos;ve committed this to trunk and merged to branch-2. Thanks ATM.&lt;/p&gt;</comment>
                            <comment id="13278576" author="hudson" created="Fri, 18 May 2012 04:52:52 +0000"  >&lt;p&gt;Integrated in Hadoop-Hdfs-trunk-Commit #2340 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/2340/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/2340/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8408&quot; title=&quot;MR doesn&amp;#39;t work with a non-default ViewFS mount table and security enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8408&quot;&gt;&lt;del&gt;HADOOP-8408&lt;/del&gt;&lt;/a&gt;. MR doesn&apos;t work with a non-default ViewFS mount table and security enabled. Contributed by Aaron T. Myers (Revision 1339970)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
eli : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1339970&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1339970&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/ViewFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemDelegationTokenSupport.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13278577" author="hudson" created="Fri, 18 May 2012 04:58:02 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk-Commit #2267 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Common-trunk-Commit/2267/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Common-trunk-Commit/2267/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8408&quot; title=&quot;MR doesn&amp;#39;t work with a non-default ViewFS mount table and security enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8408&quot;&gt;&lt;del&gt;HADOOP-8408&lt;/del&gt;&lt;/a&gt;. MR doesn&apos;t work with a non-default ViewFS mount table and security enabled. Contributed by Aaron T. Myers (Revision 1339970)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
eli : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1339970&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1339970&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/ViewFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemDelegationTokenSupport.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13278580" author="hudson" created="Fri, 18 May 2012 05:16:59 +0000"  >&lt;p&gt;Integrated in Hadoop-Mapreduce-trunk-Commit #2285 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/2285/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/2285/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8408&quot; title=&quot;MR doesn&amp;#39;t work with a non-default ViewFS mount table and security enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8408&quot;&gt;&lt;del&gt;HADOOP-8408&lt;/del&gt;&lt;/a&gt;. MR doesn&apos;t work with a non-default ViewFS mount table and security enabled. Contributed by Aaron T. Myers (Revision 1339970)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
eli : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1339970&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1339970&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/ViewFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemDelegationTokenSupport.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13278737" author="hudson" created="Fri, 18 May 2012 11:42:25 +0000"  >&lt;p&gt;Integrated in Hadoop-Hdfs-trunk #1049 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1049/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1049/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8408&quot; title=&quot;MR doesn&amp;#39;t work with a non-default ViewFS mount table and security enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8408&quot;&gt;&lt;del&gt;HADOOP-8408&lt;/del&gt;&lt;/a&gt;. MR doesn&apos;t work with a non-default ViewFS mount table and security enabled. Contributed by Aaron T. Myers (Revision 1339970)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
eli : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1339970&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1339970&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/ViewFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemDelegationTokenSupport.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13278808" author="hudson" created="Fri, 18 May 2012 14:04:05 +0000"  >&lt;p&gt;Integrated in Hadoop-Mapreduce-trunk #1083 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1083/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1083/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8408&quot; title=&quot;MR doesn&amp;#39;t work with a non-default ViewFS mount table and security enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8408&quot;&gt;&lt;del&gt;HADOOP-8408&lt;/del&gt;&lt;/a&gt;. MR doesn&apos;t work with a non-default ViewFS mount table and security enabled. Contributed by Aaron T. Myers (Revision 1339970)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
eli : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1339970&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1339970&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/ViewFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemDelegationTokenSupport.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13280335" author="daryn" created="Mon, 21 May 2012 18:23:52 +0000"  >&lt;p&gt;This actually isn&apos;t the right fix.  &lt;tt&gt;ViewFileSystem#getCanonicalServiceName&lt;/tt&gt; should be returning &lt;tt&gt;null&lt;/tt&gt; since it doesn&apos;t have any intrinsic tokens of its own.  Returning the raw uri&apos;s hostname is really returning the mount table name.  It &quot;accidentally works&quot;.&lt;/p&gt;</comment>
                            <comment id="13280401" author="atm" created="Mon, 21 May 2012 19:27:17 +0000"  >&lt;p&gt;Thanks for the input, Daryn. I&apos;ll try changing it as you describe, and we can amend this JIRA if it works. Do you think the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-3062&quot; title=&quot;Fail to submit mapred job on a secured-HA-HDFS: logic URI cannot be picked up by job submission.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-3062&quot;&gt;&lt;del&gt;HDFS-3062&lt;/del&gt;&lt;/a&gt; should also be corrected?&lt;/p&gt;

&lt;p&gt;It&apos;s not super clear to me what the flow of control is expected to be for file systems which don&apos;t have their own support for tokens, but rather delegate to underlying FS implementations. Would you mind explaining it? I see this comment in FileSystem, but it doesn&apos;t make it clear how tokens will end up getting cached for a file system which delegates token fetching:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Get a canonical service name for this file system.  The token cache is&lt;br/&gt;
the only user of this value, and uses it to lookup this filesystem&apos;s&lt;br/&gt;
service tokens.  The token cache will not attempt to acquire tokens if the&lt;br/&gt;
service is null.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13280425" author="daryn" created="Mon, 21 May 2012 19:59:17 +0000"  >&lt;p&gt;Yes, I noticed awhile back that &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-3062&quot; title=&quot;Fail to submit mapred job on a secured-HA-HDFS: logic URI cannot be picked up by job submission.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-3062&quot;&gt;&lt;del&gt;HDFS-3062&lt;/del&gt;&lt;/a&gt; was problematic, so it was superseded by my &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-3268&quot; title=&quot;Hdfs mishandles token service &amp;amp; incompatible with HA&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-3268&quot;&gt;&lt;del&gt;HDFS-3268&lt;/del&gt;&lt;/a&gt;.  The handling of tokens for multi-token filesystem is rather funky right now.  &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7967&quot; title=&quot;Need generalized multi-token filesystem support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7967&quot;&gt;&lt;del&gt;HADOOP-7967&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/MAPREDUCE-3825&quot; title=&quot;MR should not be getting duplicate tokens for a MR Job.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MAPREDUCE-3825&quot;&gt;&lt;del&gt;MAPREDUCE-3825&lt;/del&gt;&lt;/a&gt; aim to fix the problem.&lt;/p&gt;

&lt;p&gt;The way it&apos;s intended to work is a filesystem with no tokens is supposed to return null for its service name.  The &lt;tt&gt;TokenCache&lt;/tt&gt; used to skip a fs with a null service.  This was problematic for multi-token filesystems like &lt;tt&gt;ViewFileSystem&lt;/tt&gt;, so someone changed the &lt;tt&gt;TokenCache&lt;/tt&gt; to proceed to acquire tokens from a fs with a null service.  A better approach is to request tokens from a filesystem: a &quot;normal&quot; fs returns its token if its service is non-null, and a multi-token filesystem gets the tokens for the leaf fs-es that don&apos;t have a null service.  I hope that makes some sense...&lt;/p&gt;</comment>
                            <comment id="13280443" author="atm" created="Mon, 21 May 2012 20:21:19 +0000"  >&lt;p&gt;Re-opening to amend the patch per Daryn&apos;s feedback.&lt;/p&gt;</comment>
                            <comment id="13280445" author="atm" created="Mon, 21 May 2012 20:23:51 +0000"  >&lt;p&gt;Here&apos;s an amendment patch which should address Daryn&apos;s comments. Posting just this diff seems easier than reverting/posting the whole patch again.&lt;/p&gt;

&lt;p&gt;In addition to modifying the automated test, I also tested this patch manually on a secure cluster with both a default and non-default ViewFS mount table and confirmed that it works as expected.&lt;/p&gt;

&lt;p&gt;Daryn, does this patch look OK to you?&lt;/p&gt;</comment>
                            <comment id="13280447" author="atm" created="Mon, 21 May 2012 20:24:49 +0000"  >&lt;p&gt;Also, yes, that explanation makes sense. Thanks a lot for helping me out with this, and for your valuable feedback.&lt;/p&gt;</comment>
                            <comment id="13280471" author="daryn" created="Mon, 21 May 2012 20:47:38 +0000"  >&lt;p&gt;+1 Perfect!&lt;/p&gt;</comment>
                            <comment id="13280497" author="hadoopqa" created="Mon, 21 May 2012 21:13:19 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12528487/HADOOP-8408-amendment.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12528487/HADOOP-8408-amendment.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed these unit tests in hadoop-common-project/hadoop-common:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.fs.viewfs.TestViewFsTrash&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1015//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1015//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1015//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1015//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13280500" author="atm" created="Mon, 21 May 2012 21:15:17 +0000"  >&lt;p&gt;The test failure is unrelated.&lt;/p&gt;</comment>
                            <comment id="13280543" author="eli2" created="Mon, 21 May 2012 22:10:31 +0000"  >&lt;p&gt;+1  Replace the comment &quot;Ensure that a canonical service name can be determined for ViewFileSystem instances configured with a non-default mount table name&quot; with rationale for why a filesystem with no tokens is supposed to return null for its service name. Since it&apos;s just a comment no need for a new patch.&lt;/p&gt;

&lt;p&gt;Thanks Daryn!&lt;/p&gt;</comment>
                            <comment id="13280782" author="atm" created="Tue, 22 May 2012 07:46:04 +0000"  >&lt;p&gt;Thanks a lot for the reviews, Daryn and Eli. Here&apos;s an updated patch which includes Eli&apos;s feedback. I&apos;m going to commit this momentarily based on Eli&apos;s +1.&lt;/p&gt;</comment>
                            <comment id="13280784" author="atm" created="Tue, 22 May 2012 07:51:14 +0000"  >&lt;p&gt;I&apos;ve just committed the amendment patch to trunk and branch-2.&lt;/p&gt;</comment>
                            <comment id="13280791" author="hudson" created="Tue, 22 May 2012 08:02:29 +0000"  >&lt;p&gt;Integrated in Hadoop-Hdfs-trunk-Commit #2352 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/2352/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/2352/&lt;/a&gt;)&lt;br/&gt;
    Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8408&quot; title=&quot;MR doesn&amp;#39;t work with a non-default ViewFS mount table and security enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8408&quot;&gt;&lt;del&gt;HADOOP-8408&lt;/del&gt;&lt;/a&gt; per Daryn&apos;s post-commit feedback. (Revision 1341338)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
atm : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1341338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1341338&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/ViewFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemDelegationTokenSupport.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13280792" author="hudson" created="Tue, 22 May 2012 08:08:33 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk-Commit #2279 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Common-trunk-Commit/2279/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Common-trunk-Commit/2279/&lt;/a&gt;)&lt;br/&gt;
    Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8408&quot; title=&quot;MR doesn&amp;#39;t work with a non-default ViewFS mount table and security enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8408&quot;&gt;&lt;del&gt;HADOOP-8408&lt;/del&gt;&lt;/a&gt; per Daryn&apos;s post-commit feedback. (Revision 1341338)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
atm : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1341338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1341338&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/ViewFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemDelegationTokenSupport.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13280817" author="hudson" created="Tue, 22 May 2012 08:47:13 +0000"  >&lt;p&gt;Integrated in Hadoop-Mapreduce-trunk-Commit #2297 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/2297/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/2297/&lt;/a&gt;)&lt;br/&gt;
    Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8408&quot; title=&quot;MR doesn&amp;#39;t work with a non-default ViewFS mount table and security enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8408&quot;&gt;&lt;del&gt;HADOOP-8408&lt;/del&gt;&lt;/a&gt; per Daryn&apos;s post-commit feedback. (Revision 1341338)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
atm : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1341338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1341338&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/ViewFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemDelegationTokenSupport.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13280891" author="hudson" created="Tue, 22 May 2012 11:42:32 +0000"  >&lt;p&gt;Integrated in Hadoop-Hdfs-trunk #1053 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1053/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1053/&lt;/a&gt;)&lt;br/&gt;
    Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8408&quot; title=&quot;MR doesn&amp;#39;t work with a non-default ViewFS mount table and security enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8408&quot;&gt;&lt;del&gt;HADOOP-8408&lt;/del&gt;&lt;/a&gt; per Daryn&apos;s post-commit feedback. (Revision 1341338)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
atm : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1341338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1341338&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/ViewFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemDelegationTokenSupport.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13280970" author="hudson" created="Tue, 22 May 2012 14:05:06 +0000"  >&lt;p&gt;Integrated in Hadoop-Mapreduce-trunk #1087 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1087/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1087/&lt;/a&gt;)&lt;br/&gt;
    Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8408&quot; title=&quot;MR doesn&amp;#39;t work with a non-default ViewFS mount table and security enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8408&quot;&gt;&lt;del&gt;HADOOP-8408&lt;/del&gt;&lt;/a&gt; per Daryn&apos;s post-commit feedback. (Revision 1341338)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
atm : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1341338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1341338&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/viewfs/ViewFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/viewfs/TestViewFileSystemDelegationTokenSupport.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12528564" name="HADOOP-8408-amendment.patch" size="2143" author="atm" created="Tue, 22 May 2012 07:46:02 +0000"/>
                            <attachment id="12528487" name="HADOOP-8408-amendment.patch" size="1501" author="atm" created="Mon, 21 May 2012 20:23:51 +0000"/>
                            <attachment id="12527975" name="HDFS-8408.patch" size="3800" author="atm" created="Fri, 18 May 2012 01:29:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241103</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i018pj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5180</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>