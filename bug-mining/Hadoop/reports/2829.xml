<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:57:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-18085] S3 SDK Upgrade causes AccessPoint ARN endpoint mistranslation</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-18085</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;Since upgrading the &lt;a href=&quot;https://github.com/apache/hadoop/pull/3864&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;SDK to 1.12.132&lt;/a&gt; the access point endpoint translation was broken.&lt;/p&gt;

&lt;p&gt;Correct endpoints should start with &quot;s3-accesspoint.&quot;, after SDK upgrade they start with &quot;s3.accesspoint-&quot; which messes up tests + region detection by the SDK.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13423328">HADOOP-18085</key>
            <summary>S3 SDK Upgrade causes AccessPoint ARN endpoint mistranslation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bogthe">Bogdan Stolojan</assignee>
                                    <reporter username="bogthe">Bogdan Stolojan</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 18 Jan 2022 16:41:20 +0000</created>
                <updated>Thu, 1 Sep 2022 13:21:15 +0000</updated>
                            <resolved>Fri, 4 Feb 2022 16:23:50 +0000</resolved>
                                    <version>3.3.5</version>
                                    <fixVersion>3.3.4</fixVersion>
                                    <component>fs/s3</component>
                    <component>test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6600">1h 50m</timespent>
                                <comments>
                            <comment id="17480720" author="stevel@apache.org" created="Sun, 23 Jan 2022 19:29:06 +0000"  >&lt;p&gt;i&apos;m now getting another test failure. this irritates me as it implies i didn&apos;t get the builds right, or this would have surfaced. anyway, another arn test setup, i&apos;m afraid&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ERROR] Tests run: 6, Failures: 0, Errors: 2, Skipped: 0, Time elapsed: 13.81 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.hadoop.fs.s3a.ITestS3ABucketExistence
[ERROR] testAccessPointProbingV2(org.apache.hadoop.fs.s3a.ITestS3ABucketExistence)  Time elapsed: 5.51 s  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.IllegalArgumentException: The region field of the ARN being passed as a bucket parameter to an S3 operation does not match the region the client was configured with. Provided region: &lt;span class=&quot;code-quote&quot;&gt;&apos;eu-west-1&apos;&lt;/span&gt;; client region: &lt;span class=&quot;code-quote&quot;&gt;&apos;accesspoint-eu-west-1&apos;&lt;/span&gt;.
        at com.amazonaws.services.s3.AmazonS3Client.validateIsTrue(AmazonS3Client.java:6584)
        at com.amazonaws.services.s3.AmazonS3Client.validateS3ResourceArn(AmazonS3Client.java:5155)
        at com.amazonaws.services.s3.AmazonS3Client.createRequest(AmazonS3Client.java:4956)
        at com.amazonaws.services.s3.AmazonS3Client.createRequest(AmazonS3Client.java:4920)
        at com.amazonaws.services.s3.AmazonS3Client.getAcl(AmazonS3Client.java:4040)
        at com.amazonaws.services.s3.AmazonS3Client.getBucketAcl(AmazonS3Client.java:1278)
        at com.amazonaws.services.s3.AmazonS3Client.getBucketAcl(AmazonS3Client.java:1268)
        at org.apache.hadoop.fs.s3a.S3AFileSystem.lambda$verifyBucketExistsV2$2(S3AFileSystem.java:731)
        at org.apache.hadoop.fs.statistics.impl.IOStatisticsBinding.lambda$trackDurationOfOperation$5(IOStatisticsBinding.java:499)
        at org.apache.hadoop.fs.s3a.Invoker.once(Invoker.java:119)
        at org.apache.hadoop.fs.s3a.Invoker.lambda$retry$4(Invoker.java:348)
        at org.apache.hadoop.fs.s3a.Invoker.retryUntranslated(Invoker.java:440)
        at org.apache.hadoop.fs.s3a.Invoker.retry(Invoker.java:344)
        at org.apache.hadoop.fs.s3a.Invoker.retry(Invoker.java:319)
        at org.apache.hadoop.fs.s3a.S3AFileSystem.verifyBucketExistsV2(S3AFileSystem.java:724)
        at org.apache.hadoop.fs.s3a.S3AFileSystem.doBucketProbing(S3AFileSystem.java:611)
        at org.apache.hadoop.fs.s3a.S3AFileSystem.initialize(S3AFileSystem.java:506)
        at org.apache.hadoop.fs.FileSystem.createFileSystem(FileSystem.java:3459)
        at org.apache.hadoop.fs.FileSystem.get(FileSystem.java:535)
        at org.apache.hadoop.fs.s3a.ITestS3ABucketExistence.lambda$testAccessPointProbingV2$12(ITestS3ABucketExistence.java:172)
        at org.apache.hadoop.test.LambdaTestUtils.intercept(LambdaTestUtils.java:498)
        at org.apache.hadoop.test.LambdaTestUtils.intercept(LambdaTestUtils.java:384)
        at org.apache.hadoop.fs.s3a.ITestS3ABucketExistence.expectUnknownStore(ITestS3ABucketExistence.java:103)
        at org.apache.hadoop.fs.s3a.ITestS3ABucketExistence.testAccessPointProbingV2(ITestS3ABucketExistence.java:171)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
        at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
        at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
        at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
        at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
        at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:61)
        at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:299)
        at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:293)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)

[INFO] Running org.apache.hadoop.fs.s3a.ITestDowngradeSyncable
[ERROR] testAccessPointRequired(org.apache.hadoop.fs.s3a.ITestS3ABucketExistence)  Time elapsed: 0.612 s  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.IllegalArgumentException: The region field of the ARN being passed as a bucket parameter to an S3 operation does not match the region the client was configured with. Provided region: &lt;span class=&quot;code-quote&quot;&gt;&apos;eu-west-1&apos;&lt;/span&gt;; client region: &lt;span class=&quot;code-quote&quot;&gt;&apos;accesspoint-eu-west-1&apos;&lt;/span&gt;.
        at com.amazonaws.services.s3.AmazonS3Client.validateIsTrue(AmazonS3Client.java:6584)
        at com.amazonaws.services.s3.AmazonS3Client.validateS3ResourceArn(AmazonS3Client.java:5155)
        at com.amazonaws.services.s3.AmazonS3Client.createRequest(AmazonS3Client.java:4956)
        at com.amazonaws.services.s3.AmazonS3Client.createRequest(AmazonS3Client.java:4920)
        at com.amazonaws.services.s3.AmazonS3Client.getAcl(AmazonS3Client.java:4040)
        at com.amazonaws.services.s3.AmazonS3Client.getBucketAcl(AmazonS3Client.java:1278)
        at com.amazonaws.services.s3.AmazonS3Client.getBucketAcl(AmazonS3Client.java:1268)
        at org.apache.hadoop.fs.s3a.S3AFileSystem.lambda$verifyBucketExistsV2$2(S3AFileSystem.java:731)
        at org.apache.hadoop.fs.statistics.impl.IOStatisticsBinding.lambda$trackDurationOfOperation$5(IOStatisticsBinding.java:499)
        at org.apache.hadoop.fs.s3a.Invoker.once(Invoker.java:119)
        at org.apache.hadoop.fs.s3a.Invoker.lambda$retry$4(Invoker.java:348)
        at org.apache.hadoop.fs.s3a.Invoker.retryUntranslated(Invoker.java:440)
        at org.apache.hadoop.fs.s3a.Invoker.retry(Invoker.java:344)
        at org.apache.hadoop.fs.s3a.Invoker.retry(Invoker.java:319)
        at org.apache.hadoop.fs.s3a.S3AFileSystem.verifyBucketExistsV2(S3AFileSystem.java:724)
        at org.apache.hadoop.fs.s3a.S3AFileSystem.doBucketProbing(S3AFileSystem.java:611)
        at org.apache.hadoop.fs.s3a.S3AFileSystem.initialize(S3AFileSystem.java:506)
        at org.apache.hadoop.fs.FileSystem.createFileSystem(FileSystem.java:3459)
        at org.apache.hadoop.fs.FileSystem.get(FileSystem.java:535)
        at org.apache.hadoop.fs.s3a.ITestS3ABucketExistence.lambda$testAccessPointRequired$14(ITestS3ABucketExistence.java:189)
        at org.apache.hadoop.test.LambdaTestUtils.intercept(LambdaTestUtils.java:498)
        at org.apache.hadoop.test.LambdaTestUtils.intercept(LambdaTestUtils.java:384)
        at org.apache.hadoop.fs.s3a.ITestS3ABucketExistence.expectUnknownStore(ITestS3ABucketExistence.java:103)
        at org.apache.hadoop.fs.s3a.ITestS3ABucketExistence.testAccessPointRequired(ITestS3ABucketExistence.java:188)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
        at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
        at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
        at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
        at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
        at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:61)
        at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:299)
        at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:293)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17480721" author="stevel@apache.org" created="Sun, 23 Jan 2022 19:31:44 +0000"  >&lt;p&gt;serious question here: is this actually a change in AP ARNs, rather than just a test regression?&lt;/p&gt;

&lt;p&gt;The region field of the ARN being passed as a bucket parameter to an S3 operation does not match the region the client was configured with. Provided region: &apos;eu-west-1&apos;; client region: &apos;accesspoint-eu-west-1&apos;.&lt;/p&gt;</comment>
                            <comment id="17482540" author="bogthe" created="Wed, 26 Jan 2022 15:03:04 +0000"  >&lt;p&gt;Looked at the stack trace, yup I got this one too, this PR should address this.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&amp;gt;&#160;is this actually a change in AP ARNs, rather than just a test regression?&lt;/p&gt;

&lt;p&gt;So the way I understand it is:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;S3A inits and reads AP ARN config&lt;/li&gt;
	&lt;li&gt;It points S3A to the endpoint specified by the AP ARN (since ARN can contain regions).&lt;/li&gt;
	&lt;li&gt;To know the endpoint it relies on parsing from the SDK&lt;/li&gt;
	&lt;li&gt;Since the SDK changed their parsing for AP endpoints (for some reason??) it caused the tests to break in some confusing ways. It&apos;s confusing because AP endpoints are different than S3 endpoints (format wise). So now even though you&apos;re requesting an AP endpoint you get an bucket endpoint.&lt;/li&gt;
	&lt;li&gt;One of the &quot;confusing&quot; ways is highlighted by that stack trace
	&lt;ul&gt;
		&lt;li&gt;When S3 client builds requests, it looks at bucket URL and checks if the region you&apos;re trying to make a request is in the same region as the bucket&lt;/li&gt;
		&lt;li&gt;S3 client is also aware of access point ARNs so it knows how to parse the AP ARNs and do this trick for them too&lt;/li&gt;
		&lt;li&gt;However this backfires because you&apos;re using an ARN (as you should) and then pass an S3 bucket endpoint (because the endpoint parsing was messed up) and what you get is this confusing message.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Hope this helps.&lt;/p&gt;

&lt;p&gt;And this is why in the PR fix for this we&apos;re making sure the endpoint starts with `s3-accesspoint.` arguably quite weakly compared to how much confusion it caused. Which makes me think I should add some more checks to it.&lt;/p&gt;</comment>
                            <comment id="17483043" author="stevel@apache.org" created="Thu, 27 Jan 2022 10:23:22 +0000"  >&lt;p&gt;we should just be as minimal as needed to verify that the choice between ARN and bucket binding is handled; being over brittle to SDK updates just introduces maintenance pain on every update (eventually someone will disable the test)&lt;/p&gt;

&lt;p&gt;has the SDK update actually changed what it does there?&lt;/p&gt;</comment>
                            <comment id="17483748" author="bogthe" created="Fri, 28 Jan 2022 12:35:28 +0000"  >&lt;p&gt;&amp;gt; has the SDK update actually changed what it does there?&lt;/p&gt;

&lt;p&gt;Yup that changed.&lt;br/&gt;
&#160;&lt;br/&gt;
&amp;gt; we should just be as minimal as needed to verify that the choice between ARN and bucket binding is handled; being over brittle to SDK updates just introduces maintenance pain on every update (eventually someone will disable the test)&lt;br/&gt;
Exactly, want to not make it a pain and not too brittle, however I think breaking changes should&apos;ve been caught earlier with the SDK upgrade.&lt;/p&gt;</comment>
                            <comment id="17487161" author="stevel@apache.org" created="Fri, 4 Feb 2022 16:23:50 +0000"  >&lt;p&gt;this in branch-3 now, so all branches with the SDK update&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13478606">HADOOP-18423</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13478613">HADOOP-18436</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13420895">HADOOP-18068</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13321859">HADOOP-17198</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="13451378">HADOOP-18305</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 40 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0yp60:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>