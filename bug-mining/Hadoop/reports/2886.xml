<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:57:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-18456] NullPointerException in ObjectListingIterator&apos;s constructor</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-18456</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;We saw NullPointerExceptions in Impala&apos;s S3 tests: &lt;a href=&quot;https://issues.apache.org/jira/browse/IMPALA-11592&quot; title=&quot;NullPointerException from s3a.Listing.createObjectListingIterator in various S3 tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IMPALA-11592&quot;&gt;&lt;del&gt;IMPALA-11592&lt;/del&gt;&lt;/a&gt;. It&apos;s thrown from the hadoop jar:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.lang.NullPointerException
        at org.apache.hadoop.fs.s3a.Listing$ObjectListingIterator.&amp;lt;init&amp;gt;(Listing.java:621)
        at org.apache.hadoop.fs.s3a.Listing.createObjectListingIterator(Listing.java:163)
        at org.apache.hadoop.fs.s3a.Listing.createFileStatusListingIterator(Listing.java:144)
        at org.apache.hadoop.fs.s3a.Listing.getListFilesAssumingDir(Listing.java:212)
        at org.apache.hadoop.fs.s3a.S3AFileSystem.innerListFiles(S3AFileSystem.java:4790)
        at org.apache.hadoop.fs.s3a.S3AFileSystem.lambda$listFiles$37(S3AFileSystem.java:4732)
        at org.apache.hadoop.fs.statistics.impl.IOStatisticsBinding.invokeTrackingDuration(IOStatisticsBinding.java:543)
        at org.apache.hadoop.fs.statistics.impl.IOStatisticsBinding.lambda$trackDurationOfOperation$5(IOStatisticsBinding.java:524)
        at org.apache.hadoop.fs.statistics.impl.IOStatisticsBinding.trackDuration(IOStatisticsBinding.java:445)
        at org.apache.hadoop.fs.s3a.S3AFileSystem.trackDurationAndSpan(S3AFileSystem.java:2363)
        at org.apache.hadoop.fs.s3a.S3AFileSystem.trackDurationAndSpan(S3AFileSystem.java:2382)
        at org.apache.hadoop.fs.s3a.S3AFileSystem.listFiles(S3AFileSystem.java:4731)
        at org.apache.impala.common.FileSystemUtil.listFiles(FileSystemUtil.java:754)
        ... &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We are using a private build of the hadoop jar. Version: CDP 3.1.1.7.2.16.0-164&lt;br/&gt;
Code snipper of where the NPE throws:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
604     @Retries.RetryRaw
605     ObjectListingIterator(
606         Path listPath,
607         S3ListRequest request,
608         AuditSpan span) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
609       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.listPath = listPath;
610       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.maxKeys = listingOperationCallbacks.getMaxKeys();
611       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.request = request;
612       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.objectsPrev = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
613       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.iostats = iostatisticsStore()
614           .withDurationTracking(OBJECT_LIST_REQUEST)
615           .withDurationTracking(OBJECT_CONTINUE_LIST_REQUEST)
616           .build();
617       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.span = span;
618       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.s3ListResultFuture = listingOperationCallbacks
619           .listObjectsAsync(request, iostats, span);
620       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.aggregator = IOStatisticsContext.getCurrentIOStatisticsContext()
621           .getAggregator();           &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;---- thrown here
&lt;/span&gt;622     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13482086">HADOOP-18456</key>
            <summary>NullPointerException in ObjectListingIterator&apos;s constructor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stevel@apache.org">Steve Loughran</assignee>
                                    <reporter username="stigahuang">Quanlong Huang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 19 Sep 2022 02:31:24 +0000</created>
                <updated>Sun, 28 Jan 2024 00:09:18 +0000</updated>
                            <resolved>Fri, 23 Sep 2022 09:10:56 +0000</resolved>
                                    <version>3.3.5</version>
                                    <fixVersion>3.4.0</fixVersion>
                    <fixVersion>3.3.5</fixVersion>
                                    <component>fs/s3</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17606393" author="stiga-huang" created="Mon, 19 Sep 2022 02:33:03 +0000"  >&lt;p&gt;The code of the aggregator is recently added by &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17461&quot; title=&quot;Add thread-level IOStatistics Context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17461&quot;&gt;&lt;del&gt;HADOOP-17461&lt;/del&gt;&lt;/a&gt;. Do you have time to take a look? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mehakmeet&quot; class=&quot;user-hover&quot; rel=&quot;mehakmeet&quot;&gt;mehakmeet&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17606651" author="githubbot" created="Mon, 19 Sep 2022 15:49:10 +0000"  >&lt;p&gt;steveloughran opened a new pull request, #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   The fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-18456&quot; title=&quot;NullPointerException in ObjectListingIterator&amp;#39;s constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-18456&quot;&gt;&lt;del&gt;HADOOP-18456&lt;/del&gt;&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/browse/IMPALA-11592&quot; title=&quot;NullPointerException from s3a.Listing.createObjectListingIterator in various S3 tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IMPALA-11592&quot;&gt;&lt;del&gt;IMPALA-11592&lt;/del&gt;&lt;/a&gt; is, if our hypothesis is correct,&lt;br/&gt;
   in WeakReferenceMap.create() where a strong reference to the new value&lt;br/&gt;
   is kept in a local variable &lt;b&gt;and referred to later&lt;/b&gt; so that the JVM will not GC it.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Description of PR&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   WeakReferenceMap.create() is resistant and resilient to GC taking place during&lt;br/&gt;
   its creation process.&lt;/p&gt;

&lt;p&gt;   Local variables were renamed to show when refs are strong vs. weak.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;How was this patch tested?&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   There&apos;s a new test, but otherwise code review. &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;For code changes:&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;X&amp;#93;&lt;/span&gt; Does the title or this PR starts with the corresponding JIRA issue id (e.g. &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17799&quot; title=&quot;Improve the GitHub pull request template&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17799&quot;&gt;&lt;del&gt;HADOOP-17799&lt;/del&gt;&lt;/a&gt;. Your PR title ...&apos;)?&lt;/li&gt;
	&lt;li&gt;[ ] Object storage: have the integration tests been executed and the endpoint declared according to the connector-specific documentation?&lt;/li&gt;
	&lt;li&gt;[ ] If adding new dependencies to the code, are these dependencies licensed in a way that is compatible for inclusion under &lt;span class=&quot;error&quot;&gt;&amp;#91;ASF 2.0&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://www.apache.org/legal/resolved.html#category-a)?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/legal/resolved.html#category-a)?&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;[ ] If applicable, have you updated the `LICENSE`, `LICENSE-binary`, `NOTICE-binary` files?&lt;/li&gt;
&lt;/ul&gt;




</comment>
                            <comment id="17606652" author="githubbot" created="Mon, 19 Sep 2022 15:49:27 +0000"  >&lt;p&gt;steveloughran commented on PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#issuecomment-1251207353&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#issuecomment-1251207353&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   s3a testing in progress&lt;/p&gt;

</comment>
                            <comment id="17606736" author="githubbot" created="Mon, 19 Sep 2022 19:38:29 +0000"  >&lt;p&gt;hadoop-yetus commented on PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#issuecomment-1251465207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#issuecomment-1251465207&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   :broken_heart: *&lt;b&gt;-1 overall&lt;/b&gt;*&lt;/p&gt;






&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Vote &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Subsystem &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Runtime &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Logfile &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Comment &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:----:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;----------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;--------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:--------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:-------:&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  reexec  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  4s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Docker mode activated.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Prechecks _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  dupname  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  No case conflicting files found.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  codespell  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  1s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  codespell was not available.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  detsecrets  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  1s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  detect-secrets was not available.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  @author  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch does not contain any @author tags.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  test4tests  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch appears to include 1 new or modified test files.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ trunk Compile Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvninstall  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  41m 41s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  25m 38s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  22m  6s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  checkstyle  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 25s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvnsite  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 55s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 29s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 57s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  spotbugs  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   3m  4s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  shadedclient  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  26m 12s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  branch has no errors when building and testing our client artifacts.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Patch Compile Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvninstall  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  4s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  24m 48s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javac  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  24m 48s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  21m 56s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javac  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  21m 56s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  blanks  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch has no blanks issues.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  checkstyle  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 19s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvnsite  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 51s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 16s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 56s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  spotbugs  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   2m 57s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  shadedclient  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  25m 59s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  patch has no errors when building and testing our client artifacts.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Other Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; -1 :x: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  unit  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  18m 36s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;/patch-unit-hadoop-common-project_hadoop-common.txt&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/1/artifact/out/patch-unit-hadoop-common-project_hadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/1/artifact/out/patch-unit-hadoop-common-project_hadoop-common.txt&lt;/a&gt;) &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  hadoop-common in the patch passed.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  asflicense  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 11s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch does not generate ASF License warnings.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 227m 58s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Reason &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Tests &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;-------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:------&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Failed junit tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; hadoop.http.TestHttpServer &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Subsystem &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Report/Notes &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;----------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:-------------&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Docker &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ClientAPI=1.41 ServerAPI=1.41 base: &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/1/artifact/out/Dockerfile&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/1/artifact/out/Dockerfile&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; GITHUB PR &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux 0bf6843b6d26 4.15.0-191-generic #202-Ubuntu SMP Thu Aug 4 01:49:29 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; maven &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; dev-support/bin/hadoop.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; trunk / 3c7f5d5d7422812524c9ba1ae82d02de8fb02090 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Multi-JDK versions &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/1/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/1/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Max. process+thread count &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 3134 (vs. ulimit of 5500) &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/1/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/1/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; versions &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git=2.25.1 maven=3.6.3 spotbugs=4.2.2 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.14.0 &lt;a href=&quot;https://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;   This message was automatically generated.&lt;/p&gt;



</comment>
                            <comment id="17606974" author="githubbot" created="Tue, 20 Sep 2022 08:07:15 +0000"  >&lt;p&gt;mehakmeet commented on code in PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#discussion_r974970318&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#discussion_r974970318&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/util/TestWeakReferenceMap.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -147,7 +206,7 @@ private void assertMapContainsKey(int key) &lt;/p&gt;
{
         .isTrue();
   }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/**&lt;br/&gt;
+  /**y&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   nit: typo&lt;/p&gt;



&lt;p&gt;##########&lt;br/&gt;
hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/util/TestWeakReferenceMap.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -125,11 +128,67 @@ public void testDemandCreateEntries() {&lt;/p&gt;

&lt;p&gt;   }&lt;/p&gt;

&lt;p&gt;+  /**&lt;br/&gt;
+   * It is an error to have a factory which returns null.&lt;br/&gt;
+   */&lt;br/&gt;
+  @Test&lt;br/&gt;
+  public void testFactoryReturningNull() throws Throwable &lt;/p&gt;
{
+    referenceMap = new WeakReferenceMap&amp;lt;&amp;gt;(
+        (k) -&amp;gt; null,
+            null);
+    intercept(NullPointerException.class, () -&amp;gt;
+        referenceMap.get(0));
+  }&lt;br/&gt;
+&lt;br/&gt;
+  /**&lt;br/&gt;
+   * Test the WeakReferenceThreadMap extension.&lt;br/&gt;
+   */&lt;br/&gt;
+  @Test&lt;br/&gt;
+  public void testWeakReferenceThreadMapRejectsNullAssignment()&lt;br/&gt;
+      throws Throwable {&lt;br/&gt;
+    WeakReferenceThreadMap&amp;lt;String&amp;gt; threadMap = new WeakReferenceThreadMap&amp;lt;&amp;gt;(&lt;br/&gt;
+        id -&amp;gt; &quot;Entry for thread ID &quot; + id,&lt;br/&gt;
+        null);&lt;br/&gt;
+&lt;br/&gt;
+    Assertions.assertThat(threadMap.setForCurrentThread(&quot;hello&quot;))&lt;br/&gt;
+        .describedAs(&quot;current thread map value on first set&quot;)&lt;br/&gt;
+        .isNull();&lt;br/&gt;
+&lt;br/&gt;
+    // second attempt returns itself&lt;br/&gt;
+    Assertions.assertThat(threadMap.setForCurrentThread(&quot;hello&quot;))&lt;br/&gt;
&lt;br/&gt;
Review Comment:&lt;br/&gt;
   little doubt here: what happens if we set it to &quot;hello2&quot; this time, does the set return &quot;hello&quot; or &quot;hello2&quot;?&lt;br/&gt;
   &lt;br/&gt;
   Can you add the next assert to be of a different value than &quot;hello&quot;, just to confirm if set actually returns the previous set value?&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
##########&lt;br/&gt;
hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/WeakReferenceMap.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -132,35 +145,92 @@ public WeakReference&amp;lt;V&amp;gt; lookup(K key) {&lt;br/&gt;
    * @return an instance.&lt;br/&gt;
    */&lt;br/&gt;
   public V get(K key) {&lt;br/&gt;
-    final WeakReference&amp;lt;V&amp;gt; current = lookup(key);&lt;br/&gt;
-    V val = resolve(current);&lt;br/&gt;
-    if (val != null) {&lt;br/&gt;
+    final WeakReference&amp;lt;V&amp;gt; currentWeakRef = lookup(key);&lt;br/&gt;
+    // resolve it, after which if not null, we have a strong reference&lt;br/&gt;
+    V strongVal = resolve(currentWeakRef);&lt;br/&gt;
+    if (strongVal != null) {
       // all good.
-      return  val;
+      return  strongVal;
     }&lt;br/&gt;
 &lt;br/&gt;
-    // here, either no ref, or the value is null&lt;br/&gt;
-    if (current != null) {&lt;br/&gt;
+    // here, either currentWeakRef was null, or its reference was GC&apos;d.&lt;br/&gt;
+    if (currentWeakRef != null) {
+      // garbage collection removed the reference.
+
+      // explicitly remove the weak ref from the map if it has not
+      // been updated by this point
+      // this is here just for completeness.
+      map.remove(key, currentWeakRef);
+
+      // log/report the loss.
       noteLost(key);
     }&lt;br/&gt;
+&lt;br/&gt;
+    // create a new value and add it to the map&lt;br/&gt;
     return create(key);&lt;br/&gt;
   }&lt;br/&gt;
 &lt;br/&gt;
   /**&lt;br/&gt;
    * Create a new instance under a key.&lt;br/&gt;
+   * &amp;lt;p&amp;gt;&lt;br/&gt;
    * The instance is created, added to the map and then the&lt;br/&gt;
    * map value retrieved.&lt;br/&gt;
    * This ensures that the reference returned is that in the map,&lt;br/&gt;
    * even if there is more than one entry being created at the same time.&lt;br/&gt;
+   * If that race does occur, it will be logged the first time it happens&lt;br/&gt;
+   * for this specific map instance.&lt;br/&gt;
+   * &amp;lt;p&amp;gt;&lt;br/&gt;
+   * &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-18456&quot; title=&quot;NullPointerException in ObjectListingIterator&amp;#39;s constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-18456&quot;&gt;&lt;del&gt;HADOOP-18456&lt;/del&gt;&lt;/a&gt; highlighted the risk of a concurrent GC resulting a null&lt;br/&gt;
+   * value being retrieved and so returned.&lt;br/&gt;
+   * To prevent this:&lt;br/&gt;
+   * &amp;lt;ol&amp;gt;&lt;br/&gt;
+   *   &amp;lt;li&amp;gt;A strong reference is retained to the newly created instance&lt;br/&gt;
+   *       in a local variable.&amp;lt;/li&amp;gt;&lt;br/&gt;
+   *   &amp;lt;li&amp;gt;That variable is used after the resolution process, to ensure&lt;br/&gt;
+   *       the JVM doesn&apos;t consider it &quot;unreachable&quot; and so eligible for GC.&amp;lt;/li&amp;gt;&lt;br/&gt;
+   *   &amp;lt;li&amp;gt;A check is made for the resolved reference being null, and if so,&lt;br/&gt;
+   *       the put() is repeated&amp;lt;/li&amp;gt;&lt;br/&gt;
+   * &amp;lt;/ol&amp;gt;&lt;br/&gt;
    * @param key key&lt;br/&gt;
-   * @return the value&lt;br/&gt;
+   * @return the created value&lt;br/&gt;
    */&lt;br/&gt;
   public V create(K key) {&lt;br/&gt;
     entriesCreatedCount.incrementAndGet();&lt;br/&gt;
-    WeakReference&amp;lt;V&amp;gt; newRef = new WeakReference&amp;lt;&amp;gt;(&lt;br/&gt;
-        requireNonNull(factory.apply(key)));&lt;br/&gt;
-    map.put(key, newRef);&lt;br/&gt;
-    return map.get(key).get();&lt;br/&gt;
+    /*&lt;br/&gt;
+     Get a strong ref so even if a GC happens in this method the reference is not lost.&lt;br/&gt;
+     It is NOT enough to have a reference in a field, it MUST be used&lt;br/&gt;
+     so as to ensure the reference isn&apos;t optimized away prematurely.&lt;br/&gt;
+     &quot;A reachable object is any object that can be accessed in any potential continuing&lt;br/&gt;
+      computation from any live thread.&quot;&lt;br/&gt;
+    */&lt;br/&gt;
+&lt;br/&gt;
+    final V strongRef = requireNonNull(factory.apply(key));&lt;br/&gt;
+    V resolvedStrongRef;&lt;br/&gt;
+    do {&lt;br/&gt;
+      WeakReference&amp;lt;V&amp;gt; newWeakRef = new WeakReference&amp;lt;&amp;gt;(strongRef);&lt;br/&gt;
+&lt;br/&gt;
+      // put it in the map&lt;br/&gt;
+      map.put(key, newWeakRef);&lt;br/&gt;
+&lt;br/&gt;
+      // get it back from the map&lt;br/&gt;
+      WeakReference&amp;lt;V&amp;gt; retrievedWeakRef = map.get(key);&lt;br/&gt;
+      // resolve that reference, handling the situation where somehow it was removed from the map&lt;br/&gt;
+      // between the put() and the get()&lt;br/&gt;
+      resolvedStrongRef = resolve(retrievedWeakRef);&lt;br/&gt;
+      if (resolvedStrongRef == null) {
+        referenceLostDuringCreation.warn(&quot;reference to %s lost during creation&quot;, key);
+        noteLost(key);
+      }&lt;br/&gt;
+    } while (resolvedStrongRef == null);&lt;br/&gt;
+&lt;br/&gt;
+    // note if there was any change in the reference.&lt;br/&gt;
+    // as this forces strongRef to be kept in scope&lt;br/&gt;
+    if (strongRef != resolvedStrongRef) {&lt;br/&gt;
+      LOG.debug(&quot;Created instance for key {}: {} overwritten by {}&quot;,&lt;br/&gt;
&lt;br/&gt;
Review Comment:&lt;br/&gt;
   if this is the case, shouldn&apos;t we raise an exception? Are we not returning the wrong value then?&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
##########&lt;br/&gt;
hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/impl/WeakReferenceThreadMap.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -36,30 +38,55 @@ public WeakReferenceThreadMap(final Function&amp;lt;? super Long, ? extends V&amp;gt; factory,&lt;br/&gt;
     super(factory, referenceLost);&lt;br/&gt;
   }&lt;br/&gt;
 &lt;br/&gt;
+  /**&lt;br/&gt;
+   * Get the value for the current thread, creating if needed.&lt;br/&gt;
+   * @return an instance.&lt;br/&gt;
+   */&lt;br/&gt;
   public V getForCurrentThread() {
     return get(currentThreadId());
   }&lt;br/&gt;
 &lt;br/&gt;
+  /**&lt;br/&gt;
+   * Remove the reference for the current thread.&lt;br/&gt;
+   * @return any reference value which existed.&lt;br/&gt;
+   */&lt;br/&gt;
   public V removeForCurrentThread() {
     return remove(currentThreadId());
   }&lt;br/&gt;
 &lt;br/&gt;
+  /**&lt;br/&gt;
+   * Get the current thread ID.&lt;br/&gt;
+   * @return thread ID.&lt;br/&gt;
+   */&lt;br/&gt;
   public long currentThreadId() {
     return Thread.currentThread().getId();
   }&lt;br/&gt;
 &lt;br/&gt;
+  /**&lt;br/&gt;
+   * Set the new value for the current thread.&lt;br/&gt;
+   * @param newVal new reference to set for the active thread.&lt;br/&gt;
+   * @return any old value, possibly null&lt;br/&gt;
&lt;br/&gt;
Review Comment:&lt;br/&gt;
   nit: &quot;any old value&quot;, or should this be &quot;previously set value&quot;?&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
##########&lt;br/&gt;
hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/util/TestWeakReferenceMap.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -125,11 +128,67 @@ public void testDemandCreateEntries() {&lt;br/&gt;
 &lt;br/&gt;
   }&lt;br/&gt;
 &lt;br/&gt;
+  /**&lt;br/&gt;
+   * It is an error to have a factory which returns null.&lt;br/&gt;
+   */&lt;br/&gt;
+  @Test&lt;br/&gt;
+  public void testFactoryReturningNull() throws Throwable {+    referenceMap = new WeakReferenceMap&amp;lt;&amp;gt;(+        (k) -&amp;gt; null,+            null);+    intercept(NullPointerException.class, () -&amp;gt;+        referenceMap.get(0));+  }
&lt;p&gt;+&lt;br/&gt;
+  /**&lt;br/&gt;
+   * Test the WeakReferenceThreadMap extension.&lt;br/&gt;
+   */&lt;br/&gt;
+  @Test&lt;br/&gt;
+  public void testWeakReferenceThreadMapRejectsNullAssignment()&lt;br/&gt;
+      throws Throwable {&lt;br/&gt;
+    WeakReferenceThreadMap&amp;lt;String&amp;gt; threadMap = new WeakReferenceThreadMap&amp;lt;&amp;gt;(&lt;br/&gt;
+        id -&amp;gt; &quot;Entry for thread ID &quot; + id,&lt;br/&gt;
+        null);&lt;br/&gt;
+&lt;br/&gt;
+    Assertions.assertThat(threadMap.setForCurrentThread(&quot;hello&quot;))&lt;br/&gt;
+        .describedAs(&quot;current thread map value on first set&quot;)&lt;br/&gt;
+        .isNull();&lt;br/&gt;
+&lt;br/&gt;
+    // second attempt returns itself&lt;br/&gt;
+    Assertions.assertThat(threadMap.setForCurrentThread(&quot;hello&quot;))&lt;br/&gt;
+        .describedAs(&quot;current thread map value on second set&quot;)&lt;br/&gt;
+        .isEqualTo(&quot;hello&quot;);&lt;br/&gt;
+&lt;br/&gt;
+    // it is forbidden to explictly set to null via the set() call.&lt;/p&gt;

&lt;p&gt;Review Comment:&lt;br/&gt;
   nit: typo &quot;explictly&quot;&lt;/p&gt;



&lt;p&gt;##########&lt;br/&gt;
hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/WeakReferenceMap.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -132,35 +145,92 @@ public WeakReference&amp;lt;V&amp;gt; lookup(K key) {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@return an instance.&lt;br/&gt;
    */&lt;br/&gt;
   public V get(K key) {&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final WeakReference&amp;lt;V&amp;gt; current = lookup(key);&lt;/li&gt;
	&lt;li&gt;V val = resolve(current);&lt;/li&gt;
	&lt;li&gt;if (val != null) {&lt;br/&gt;
+    final WeakReference&amp;lt;V&amp;gt; currentWeakRef = lookup(key);&lt;br/&gt;
+    // resolve it, after which if not null, we have a strong reference&lt;br/&gt;
+    V strongVal = resolve(currentWeakRef);&lt;br/&gt;
+    if (strongVal != null) 
{
       // all good.
-      return  val;
+      return  strongVal;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// here, either no ref, or the value is null&lt;/li&gt;
	&lt;li&gt;if (current != null) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+    // here, either currentWeakRef was null, or its reference was GC&amp;#39;d.+    if (currentWeakRef != null) {
+      // garbage collection removed the reference.
+
+      // explicitly remove the weak ref from the map if it has not
+      // been updated by this point
+      // this is here just for completeness.
+      map.remove(key, currentWeakRef);
+
+      // log/report the loss.
       noteLost(key);
     }++    // create a new value and add it to the map     return create(key);   }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Create a new instance under a key.&lt;br/&gt;
+   * &amp;lt;p&amp;gt;&lt;/li&gt;
	&lt;li&gt;The instance is created, added to the map and then the&lt;/li&gt;
	&lt;li&gt;map value retrieved.&lt;/li&gt;
	&lt;li&gt;This ensures that the reference returned is that in the map,&lt;/li&gt;
	&lt;li&gt;even if there is more than one entry being created at the same time.&lt;br/&gt;
+   * If that race does occur, it will be logged the first time it happens&lt;br/&gt;
+   * for this specific map instance.&lt;br/&gt;
+   * &amp;lt;p&amp;gt;&lt;br/&gt;
+   * &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-18456&quot; title=&quot;NullPointerException in ObjectListingIterator&amp;#39;s constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-18456&quot;&gt;&lt;del&gt;HADOOP-18456&lt;/del&gt;&lt;/a&gt; highlighted the risk of a concurrent GC resulting a null&lt;br/&gt;
+   * value being retrieved and so returned.&lt;br/&gt;
+   * To prevent this:&lt;br/&gt;
+   * &amp;lt;ol&amp;gt;&lt;br/&gt;
+   *   &amp;lt;li&amp;gt;A strong reference is retained to the newly created instance&lt;br/&gt;
+   *       in a local variable.&amp;lt;/li&amp;gt;&lt;br/&gt;
+   *   &amp;lt;li&amp;gt;That variable is used after the resolution process, to ensure&lt;br/&gt;
+   *       the JVM doesn&apos;t consider it &quot;unreachable&quot; and so eligible for GC.&amp;lt;/li&amp;gt;&lt;br/&gt;
+   *   &amp;lt;li&amp;gt;A check is made for the resolved reference being null, and if so,&lt;br/&gt;
+   *       the put() is repeated&amp;lt;/li&amp;gt;&lt;br/&gt;
+   * &amp;lt;/ol&amp;gt;&lt;/li&gt;
	&lt;li&gt;@param key key&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @return the value&lt;br/&gt;
+   * @return the created value&lt;br/&gt;
    */&lt;br/&gt;
   public V create(K key) {&lt;br/&gt;
     entriesCreatedCount.incrementAndGet();&lt;/li&gt;
	&lt;li&gt;WeakReference&amp;lt;V&amp;gt; newRef = new WeakReference&amp;lt;&amp;gt;(&lt;/li&gt;
	&lt;li&gt;requireNonNull(factory.apply(key)));&lt;/li&gt;
	&lt;li&gt;map.put(key, newRef);&lt;/li&gt;
	&lt;li&gt;return map.get(key).get();&lt;br/&gt;
+    /*&lt;br/&gt;
+     Get a strong ref so even if a GC happens in this method the reference is not lost.&lt;br/&gt;
+     It is NOT enough to have a reference in a field, it MUST be used&lt;br/&gt;
+     so as to ensure the reference isn&apos;t optimized away prematurely.&lt;br/&gt;
+     &quot;A reachable object is any object that can be accessed in any potential continuing&lt;br/&gt;
+      computation from any live thread.&quot;&lt;br/&gt;
+    */&lt;br/&gt;
+&lt;br/&gt;
+    final V strongRef = requireNonNull(factory.apply(key));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   Message for a factory returning null instance.&lt;/p&gt;


</comment>
                            <comment id="17607046" author="githubbot" created="Tue, 20 Sep 2022 09:37:32 +0000"  >&lt;p&gt;steveloughran commented on code in PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#discussion_r975119488&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#discussion_r975119488&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/WeakReferenceMap.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -132,35 +145,92 @@ public WeakReference&amp;lt;V&amp;gt; lookup(K key) {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@return an instance.&lt;br/&gt;
    */&lt;br/&gt;
   public V get(K key) {&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final WeakReference&amp;lt;V&amp;gt; current = lookup(key);&lt;/li&gt;
	&lt;li&gt;V val = resolve(current);&lt;/li&gt;
	&lt;li&gt;if (val != null) {&lt;br/&gt;
+    final WeakReference&amp;lt;V&amp;gt; currentWeakRef = lookup(key);&lt;br/&gt;
+    // resolve it, after which if not null, we have a strong reference&lt;br/&gt;
+    V strongVal = resolve(currentWeakRef);&lt;br/&gt;
+    if (strongVal != null) 
{
       // all good.
-      return  val;
+      return  strongVal;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// here, either no ref, or the value is null&lt;/li&gt;
	&lt;li&gt;if (current != null) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+    // here, either currentWeakRef was null, or its reference was GC&amp;#39;d.+    if (currentWeakRef != null) {
+      // garbage collection removed the reference.
+
+      // explicitly remove the weak ref from the map if it has not
+      // been updated by this point
+      // this is here just for completeness.
+      map.remove(key, currentWeakRef);
+
+      // log/report the loss.
       noteLost(key);
     }++    // create a new value and add it to the map     return create(key);   }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Create a new instance under a key.&lt;br/&gt;
+   * &amp;lt;p&amp;gt;&lt;/li&gt;
	&lt;li&gt;The instance is created, added to the map and then the&lt;/li&gt;
	&lt;li&gt;map value retrieved.&lt;/li&gt;
	&lt;li&gt;This ensures that the reference returned is that in the map,&lt;/li&gt;
	&lt;li&gt;even if there is more than one entry being created at the same time.&lt;br/&gt;
+   * If that race does occur, it will be logged the first time it happens&lt;br/&gt;
+   * for this specific map instance.&lt;br/&gt;
+   * &amp;lt;p&amp;gt;&lt;br/&gt;
+   * &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-18456&quot; title=&quot;NullPointerException in ObjectListingIterator&amp;#39;s constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-18456&quot;&gt;&lt;del&gt;HADOOP-18456&lt;/del&gt;&lt;/a&gt; highlighted the risk of a concurrent GC resulting a null&lt;br/&gt;
+   * value being retrieved and so returned.&lt;br/&gt;
+   * To prevent this:&lt;br/&gt;
+   * &amp;lt;ol&amp;gt;&lt;br/&gt;
+   *   &amp;lt;li&amp;gt;A strong reference is retained to the newly created instance&lt;br/&gt;
+   *       in a local variable.&amp;lt;/li&amp;gt;&lt;br/&gt;
+   *   &amp;lt;li&amp;gt;That variable is used after the resolution process, to ensure&lt;br/&gt;
+   *       the JVM doesn&apos;t consider it &quot;unreachable&quot; and so eligible for GC.&amp;lt;/li&amp;gt;&lt;br/&gt;
+   *   &amp;lt;li&amp;gt;A check is made for the resolved reference being null, and if so,&lt;br/&gt;
+   *       the put() is repeated&amp;lt;/li&amp;gt;&lt;br/&gt;
+   * &amp;lt;/ol&amp;gt;&lt;/li&gt;
	&lt;li&gt;@param key key&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @return the value&lt;br/&gt;
+   * @return the created value&lt;br/&gt;
    */&lt;br/&gt;
   public V create(K key) {&lt;br/&gt;
     entriesCreatedCount.incrementAndGet();&lt;/li&gt;
	&lt;li&gt;WeakReference&amp;lt;V&amp;gt; newRef = new WeakReference&amp;lt;&amp;gt;(&lt;/li&gt;
	&lt;li&gt;requireNonNull(factory.apply(key)));&lt;/li&gt;
	&lt;li&gt;map.put(key, newRef);&lt;/li&gt;
	&lt;li&gt;return map.get(key).get();&lt;br/&gt;
+    /*&lt;br/&gt;
+     Get a strong ref so even if a GC happens in this method the reference is not lost.&lt;br/&gt;
+     It is NOT enough to have a reference in a field, it MUST be used&lt;br/&gt;
+     so as to ensure the reference isn&apos;t optimized away prematurely.&lt;br/&gt;
+     &quot;A reachable object is any object that can be accessed in any potential continuing&lt;br/&gt;
+      computation from any live thread.&quot;&lt;br/&gt;
+    */&lt;br/&gt;
+&lt;br/&gt;
+    final V strongRef = requireNonNull(factory.apply(key));&lt;br/&gt;
+    V resolvedStrongRef;&lt;br/&gt;
+    do 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+      WeakReference&amp;lt;V&amp;gt; newWeakRef = new WeakReference&amp;lt;&amp;gt;(strongRef);++      // put it in the map+      map.put(key, newWeakRef);++      // get it back from the map+      WeakReference&amp;lt;V&amp;gt; retrievedWeakRef = map.get(key);+      // resolve that reference, handling the situation where somehow it was removed from the map+      // between the put() and the get()+      resolvedStrongRef = resolve(retrievedWeakRef);+      if (resolvedStrongRef == null) {
+        referenceLostDuringCreation.warn(&quot;reference to %s lost during creation&quot;, key);
+        noteLost(key);
+      }+    }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; while (resolvedStrongRef == null);&lt;br/&gt;
+&lt;br/&gt;
+    // note if there was any change in the reference.&lt;br/&gt;
+    // as this forces strongRef to be kept in scope&lt;br/&gt;
+    if (strongRef != resolvedStrongRef) {&lt;br/&gt;
+      LOG.debug(&quot;Created instance for key {}: {} overwritten by {}&quot;,&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   no, it&apos;s just addressing a race condition...the reason we do the lookup is to ensure that all threads share the same instance. the exact choice of which one is not considered relevant&lt;/p&gt;


</comment>
                            <comment id="17607051" author="githubbot" created="Tue, 20 Sep 2022 09:41:03 +0000"  >&lt;p&gt;steveloughran commented on code in PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#discussion_r975123137&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#discussion_r975123137&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/util/TestWeakReferenceMap.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -125,11 +128,67 @@ public void testDemandCreateEntries() {&lt;/p&gt;

&lt;p&gt;   }&lt;/p&gt;

&lt;p&gt;+  /**&lt;br/&gt;
+   * It is an error to have a factory which returns null.&lt;br/&gt;
+   */&lt;br/&gt;
+  @Test&lt;br/&gt;
+  public void testFactoryReturningNull() throws Throwable &lt;/p&gt;
{
+    referenceMap = new WeakReferenceMap&amp;lt;&amp;gt;(
+        (k) -&amp;gt; null,
+            null);
+    intercept(NullPointerException.class, () -&amp;gt;
+        referenceMap.get(0));
+  }
&lt;p&gt;+&lt;br/&gt;
+  /**&lt;br/&gt;
+   * Test the WeakReferenceThreadMap extension.&lt;br/&gt;
+   */&lt;br/&gt;
+  @Test&lt;br/&gt;
+  public void testWeakReferenceThreadMapRejectsNullAssignment()&lt;br/&gt;
+      throws Throwable {&lt;br/&gt;
+    WeakReferenceThreadMap&amp;lt;String&amp;gt; threadMap = new WeakReferenceThreadMap&amp;lt;&amp;gt;(&lt;br/&gt;
+        id -&amp;gt; &quot;Entry for thread ID &quot; + id,&lt;br/&gt;
+        null);&lt;br/&gt;
+&lt;br/&gt;
+    Assertions.assertThat(threadMap.setForCurrentThread(&quot;hello&quot;))&lt;br/&gt;
+        .describedAs(&quot;current thread map value on first set&quot;)&lt;br/&gt;
+        .isNull();&lt;br/&gt;
+&lt;br/&gt;
+    // second attempt returns itself&lt;br/&gt;
+    Assertions.assertThat(threadMap.setForCurrentThread(&quot;hello&quot;))&lt;/p&gt;

&lt;p&gt;Review Comment:&lt;br/&gt;
   ok&lt;/p&gt;


</comment>
                            <comment id="17607056" author="githubbot" created="Tue, 20 Sep 2022 09:48:03 +0000"  >&lt;p&gt;steveloughran commented on code in PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#discussion_r975130598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#discussion_r975130598&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/util/TestWeakReferenceMap.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -125,11 +128,67 @@ public void testDemandCreateEntries() {&lt;/p&gt;

&lt;p&gt;   }&lt;/p&gt;

&lt;p&gt;+  /**&lt;br/&gt;
+   * It is an error to have a factory which returns null.&lt;br/&gt;
+   */&lt;br/&gt;
+  @Test&lt;br/&gt;
+  public void testFactoryReturningNull() throws Throwable &lt;/p&gt;
{
+    referenceMap = new WeakReferenceMap&amp;lt;&amp;gt;(
+        (k) -&amp;gt; null,
+            null);
+    intercept(NullPointerException.class, () -&amp;gt;
+        referenceMap.get(0));
+  }
&lt;p&gt;+&lt;br/&gt;
+  /**&lt;br/&gt;
+   * Test the WeakReferenceThreadMap extension.&lt;br/&gt;
+   */&lt;br/&gt;
+  @Test&lt;br/&gt;
+  public void testWeakReferenceThreadMapRejectsNullAssignment()&lt;br/&gt;
+      throws Throwable {&lt;br/&gt;
+    WeakReferenceThreadMap&amp;lt;String&amp;gt; threadMap = new WeakReferenceThreadMap&amp;lt;&amp;gt;(&lt;br/&gt;
+        id -&amp;gt; &quot;Entry for thread ID &quot; + id,&lt;br/&gt;
+        null);&lt;br/&gt;
+&lt;br/&gt;
+    Assertions.assertThat(threadMap.setForCurrentThread(&quot;hello&quot;))&lt;br/&gt;
+        .describedAs(&quot;current thread map value on first set&quot;)&lt;br/&gt;
+        .isNull();&lt;br/&gt;
+&lt;br/&gt;
+    // second attempt returns itself&lt;br/&gt;
+    Assertions.assertThat(threadMap.setForCurrentThread(&quot;hello&quot;))&lt;/p&gt;

&lt;p&gt;Review Comment:&lt;br/&gt;
   added it at the end, to show the dynamic value is returned on the overwrite...easiest place to add&lt;/p&gt;


</comment>
                            <comment id="17607058" author="githubbot" created="Tue, 20 Sep 2022 09:49:37 +0000"  >&lt;p&gt;steveloughran commented on PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#issuecomment-1252110214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#issuecomment-1252110214&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   problem with the gc stuff is what it took to trigger it in the earlier test for that...you need to make a lot of attempts and put memory load on the system before that gc() call does anything. it&apos;s more of a request than a command, and the JVM is free to ignore it&lt;/p&gt;

</comment>
                            <comment id="17607060" author="githubbot" created="Tue, 20 Sep 2022 09:54:50 +0000"  >&lt;p&gt;steveloughran commented on PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#issuecomment-1252116554&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#issuecomment-1252116554&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   test failure is already fixed in #4900&lt;/p&gt;

</comment>
                            <comment id="17607062" author="githubbot" created="Tue, 20 Sep 2022 10:01:21 +0000"  >&lt;p&gt;steveloughran commented on PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#issuecomment-1252123682&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#issuecomment-1252123682&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   merged with trunk to fix the failure. &lt;/p&gt;

&lt;p&gt;   one test failure against s3 london, ` -Dparallel-tests -DtestsThreadCount=10`&lt;/p&gt;

&lt;p&gt;   ```&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Running org.apache.hadoop.fs.s3a.commit.ITestCommitOperationCost&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Tests run: 44, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 79.159 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.hadoop.fs.contract.s3a.ITestS3AContractVectoredRead&lt;br/&gt;
   &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; testStopVectoredIoOperationsUnbuffer&lt;span class=&quot;error&quot;&gt;&amp;#91;Buffer type : direct&amp;#93;&lt;/span&gt;(org.apache.hadoop.fs.contract.s3a.ITestS3AContractVectoredRead)  Time elapsed: 1.26 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
   java.lang.AssertionError: Expected an exception of type class java.io.InterruptedIOException&lt;br/&gt;
           at org.apache.hadoop.test.LambdaTestUtils.intercept(LambdaTestUtils.java:409)&lt;br/&gt;
           at org.apache.hadoop.fs.contract.s3a.ITestS3AContractVectoredRead.testStopVectoredIoOperationsUnbuffer(ITestS3AContractVectoredRead.java:143)&lt;br/&gt;
           at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
           at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;br/&gt;
           at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
           at java.lang.reflect.Method.invoke(Method.java:498)&lt;br/&gt;
           at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)&lt;br/&gt;
           at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)&lt;br/&gt;
           at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)&lt;br/&gt;
           at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)&lt;br/&gt;
           at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)&lt;br/&gt;
           at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)&lt;br/&gt;
           at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:61)&lt;br/&gt;
           at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:299)&lt;br/&gt;
           at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:293)&lt;br/&gt;
           at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
           at java.lang.Thread.run(Thread.java:750)&lt;br/&gt;
   ```&lt;br/&gt;
   anyone else seen this? race condition maybe?&lt;/p&gt;

</comment>
                            <comment id="17607208" author="githubbot" created="Tue, 20 Sep 2022 13:47:18 +0000"  >&lt;p&gt;hadoop-yetus commented on PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#issuecomment-1252380830&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#issuecomment-1252380830&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   :confetti_ball: *&lt;b&gt;+1 overall&lt;/b&gt;*&lt;/p&gt;






&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Vote &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Subsystem &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Runtime &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Logfile &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Comment &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:----:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;----------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;--------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:--------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:-------:&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  reexec  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  5s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Docker mode activated.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Prechecks _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  dupname  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  No case conflicting files found.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  codespell  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  codespell was not available.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  detsecrets  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  detect-secrets was not available.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  @author  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch does not contain any @author tags.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  test4tests  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch appears to include 1 new or modified test files.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ trunk Compile Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvninstall  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  41m 45s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  25m 37s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  22m 14s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  checkstyle  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 24s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvnsite  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 54s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 24s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 58s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  spotbugs  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   2m 59s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  shadedclient  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  25m 52s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  branch has no errors when building and testing our client artifacts.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Patch Compile Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvninstall  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  4s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  24m 43s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javac  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  24m 43s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  22m 15s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javac  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  22m 15s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  blanks  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch has no blanks issues.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  checkstyle  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 18s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvnsite  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 51s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 17s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 59s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  spotbugs  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   2m 58s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  shadedclient  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  25m 56s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  patch has no errors when building and testing our client artifacts.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Other Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  unit  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  18m 28s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  hadoop-common in the patch passed.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  asflicense  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  9s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch does not generate ASF License warnings.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 227m 32s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Subsystem &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Report/Notes &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;----------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:-------------&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Docker &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ClientAPI=1.41 ServerAPI=1.41 base: &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/3/artifact/out/Dockerfile&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/3/artifact/out/Dockerfile&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; GITHUB PR &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux e1ad260a3dbe 4.15.0-191-generic #202-Ubuntu SMP Thu Aug 4 01:49:29 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; maven &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; dev-support/bin/hadoop.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; trunk / 1d37051d7c0908e1be688a12e9d41c8206c18294 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Multi-JDK versions &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/3/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/3/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Max. process+thread count &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1255 (vs. ulimit of 5500) &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/3/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/3/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; versions &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git=2.25.1 maven=3.6.3 spotbugs=4.2.2 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.14.0 &lt;a href=&quot;https://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;   This message was automatically generated.&lt;/p&gt;



</comment>
                            <comment id="17607211" author="githubbot" created="Tue, 20 Sep 2022 13:49:57 +0000"  >&lt;p&gt;hadoop-yetus commented on PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#issuecomment-1252384728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#issuecomment-1252384728&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   :confetti_ball: *&lt;b&gt;+1 overall&lt;/b&gt;*&lt;/p&gt;






&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Vote &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Subsystem &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Runtime &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Logfile &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Comment &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:----:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;----------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;--------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:--------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:-------:&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  reexec  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 58s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Docker mode activated.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Prechecks _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  dupname  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  No case conflicting files found.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  codespell  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  1s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  codespell was not available.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  detsecrets  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  1s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  detect-secrets was not available.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  @author  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch does not contain any @author tags.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  test4tests  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch appears to include 1 new or modified test files.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ trunk Compile Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvninstall  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  42m 50s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  29m 37s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  22m 15s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  checkstyle  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 23s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvnsite  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   2m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 25s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 57s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  spotbugs  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   3m  3s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  shadedclient  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  26m  5s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  branch has no errors when building and testing our client artifacts.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Patch Compile Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvninstall  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  4s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  24m 35s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javac  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  24m 35s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  22m  2s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javac  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  22m  2s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  blanks  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch has no blanks issues.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  checkstyle  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 18s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvnsite  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 49s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 18s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 57s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  spotbugs  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   2m 58s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  shadedclient  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  25m 36s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  patch has no errors when building and testing our client artifacts.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Other Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  unit  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  18m 37s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  hadoop-common in the patch passed.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  asflicense  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  9s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch does not generate ASF License warnings.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 232m 23s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Subsystem &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Report/Notes &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;----------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:-------------&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Docker &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ClientAPI=1.41 ServerAPI=1.41 base: &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/2/artifact/out/Dockerfile&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/2/artifact/out/Dockerfile&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; GITHUB PR &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux 324be4d4deff 4.15.0-191-generic #202-Ubuntu SMP Thu Aug 4 01:49:29 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; maven &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; dev-support/bin/hadoop.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; trunk / 1d37051d7c0908e1be688a12e9d41c8206c18294 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Multi-JDK versions &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/2/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/2/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Max. process+thread count &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 3037 (vs. ulimit of 5500) &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/2/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/2/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; versions &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git=2.25.1 maven=3.6.3 spotbugs=4.2.2 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.14.0 &lt;a href=&quot;https://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;   This message was automatically generated.&lt;/p&gt;



</comment>
                            <comment id="17607241" author="stevel@apache.org" created="Tue, 20 Sep 2022 14:25:31 +0000"  >&lt;p&gt;theory: if a GC is triggered during the creation of a new entry in the map, the newly created weak reference is lost before it is returned; there&apos;s currently no checking for that state.&lt;/p&gt;

&lt;p&gt;changes in the PR&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;keep ref to the new value in a local variable, &lt;b&gt;and use it in a debug statement to ensure it really is retained&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;if a gc does lose the entry, detect and recreate&lt;/li&gt;
	&lt;li&gt;add requireNonNull() checks at places in the code so if the bug hasn&apos;t been fixed, it&apos;ll be found and reported more accurately&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17607411" author="githubbot" created="Tue, 20 Sep 2022 21:57:45 +0000"  >&lt;p&gt;hadoop-yetus commented on PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#issuecomment-1252956879&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#issuecomment-1252956879&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   :confetti_ball: *&lt;b&gt;+1 overall&lt;/b&gt;*&lt;/p&gt;






&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Vote &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Subsystem &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Runtime &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Logfile &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Comment &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:----:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;----------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;--------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:--------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:-------:&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  reexec  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 59s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Docker mode activated.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Prechecks _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  dupname  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  No case conflicting files found.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  codespell  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  codespell was not available.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  detsecrets  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  detect-secrets was not available.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  @author  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch does not contain any @author tags.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  test4tests  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch appears to include 1 new or modified test files.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ trunk Compile Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvninstall  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  41m 25s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  25m 27s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  23m 39s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  checkstyle  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 41s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvnsite  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   2m 11s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 48s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 17s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  spotbugs  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   3m 26s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  shadedclient  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  27m  4s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  branch has no errors when building and testing our client artifacts.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Patch Compile Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvninstall  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  6s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  24m 44s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javac  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  24m 44s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  22m  8s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javac  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  22m  8s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  blanks  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch has no blanks issues.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; -0 :warning: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  checkstyle  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 16s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;/results-checkstyle-hadoop-common-project_hadoop-common.txt&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/4/artifact/out/results-checkstyle-hadoop-common-project_hadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/4/artifact/out/results-checkstyle-hadoop-common-project_hadoop-common.txt&lt;/a&gt;) &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  hadoop-common-project/hadoop-common: The patch generated 1 new + 0 unchanged - 0 fixed = 1 total (was 0)  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvnsite  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 51s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 17s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 57s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  spotbugs  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   2m 56s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  shadedclient  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  26m 10s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  patch has no errors when building and testing our client artifacts.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Other Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  unit  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  18m 37s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  hadoop-common in the patch passed.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  asflicense  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 10s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch does not generate ASF License warnings.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 231m  8s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Subsystem &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Report/Notes &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;----------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:-------------&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Docker &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ClientAPI=1.41 ServerAPI=1.41 base: &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/4/artifact/out/Dockerfile&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/4/artifact/out/Dockerfile&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; GITHUB PR &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux 114c5bcce017 4.15.0-191-generic #202-Ubuntu SMP Thu Aug 4 01:49:29 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; maven &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; dev-support/bin/hadoop.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; trunk / 7579bef7b051b33d86f054053964c9e4976b86d4 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Multi-JDK versions &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/4/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/4/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Max. process+thread count &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 3134 (vs. ulimit of 5500) &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/4/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/4/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; versions &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git=2.25.1 maven=3.6.3 spotbugs=4.2.2 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.14.0 &lt;a href=&quot;https://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;   This message was automatically generated.&lt;/p&gt;



</comment>
                            <comment id="17608338" author="githubbot" created="Thu, 22 Sep 2022 16:15:35 +0000"  >&lt;p&gt;hadoop-yetus commented on PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#issuecomment-1255253339&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#issuecomment-1255253339&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   :confetti_ball: *&lt;b&gt;+1 overall&lt;/b&gt;*&lt;/p&gt;






&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Vote &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Subsystem &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Runtime &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Logfile &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Comment &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:----:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;----------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;--------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:--------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:-------:&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  reexec  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 50s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Docker mode activated.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Prechecks _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  dupname  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  No case conflicting files found.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  codespell  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  codespell was not available.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +0 :ok: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  detsecrets  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  detect-secrets was not available.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  @author  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch does not contain any @author tags.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  test4tests  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch appears to include 1 new or modified test files.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ trunk Compile Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvninstall  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  44m  8s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  27m 26s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  24m 23s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  checkstyle  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 27s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvnsite  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   2m  6s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 34s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  spotbugs  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   3m 15s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  trunk passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  shadedclient  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  28m 34s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  branch has no errors when building and testing our client artifacts.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Patch Compile Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvninstall  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 11s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  28m  3s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javac  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  28m  3s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  compile  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  25m 51s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javac  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  25m 51s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  blanks  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch has no blanks issues.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  checkstyle  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 34s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  mvnsite  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   2m  3s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 25s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  javadoc  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  5s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed with JDK Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  spotbugs  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   3m 24s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  the patch passed  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  shadedclient  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  29m 18s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  patch has no errors when building and testing our client artifacts.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; _ Other Tests _ &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  unit  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  19m 39s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  hadoop-common in the patch passed.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; +1 :green_heart: &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  asflicense  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 17s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  The patch does not generate ASF License warnings.  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 249m 52s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Subsystem &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Report/Notes &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;----------:&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;:-------------&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Docker &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ClientAPI=1.41 ServerAPI=1.41 base: &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/5/artifact/out/Dockerfile&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/5/artifact/out/Dockerfile&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; GITHUB PR &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; dupname asflicense compile javac javadoc mvninstall mvnsite unit shadedclient spotbugs checkstyle codespell detsecrets &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux 19c7685402c7 4.15.0-191-generic #202-Ubuntu SMP Thu Aug 4 01:49:29 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Build tool &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; maven &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Personality &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; dev-support/bin/hadoop.sh &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; trunk / 6670c043e0b7a4a58715283dac4102cf46357369 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Default Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Multi-JDK versions &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; /usr/lib/jvm/java-11-openjdk-amd64:Ubuntu-11.0.16+8-post-Ubuntu-0ubuntu120.04 /usr/lib/jvm/java-8-openjdk-amd64:Private Build-1.8.0_342-8u342-b07-0ubuntu1~20.04-b07 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/5/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/5/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Max. process+thread count &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1284 (vs. ulimit of 5500) &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; modules &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; C: hadoop-common-project/hadoop-common U: hadoop-common-project/hadoop-common &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/5/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-4909/5/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; versions &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git=2.25.1 maven=3.6.3 spotbugs=4.2.2 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Powered by &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Apache Yetus 0.14.0 &lt;a href=&quot;https://yetus.apache.org&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://yetus.apache.org&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;   This message was automatically generated.&lt;/p&gt;



</comment>
                            <comment id="17608638" author="githubbot" created="Fri, 23 Sep 2022 08:54:33 +0000"  >&lt;p&gt;steveloughran merged PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17608688" author="githubbot" created="Fri, 23 Sep 2022 10:32:57 +0000"  >&lt;p&gt;dannycjones commented on code in PR #4909:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4909#discussion_r978470575&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4909#discussion_r978470575&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/WeakReferenceMap.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -132,35 +145,93 @@ public WeakReference&amp;lt;V&amp;gt; lookup(K key) {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@return an instance.&lt;br/&gt;
    */&lt;br/&gt;
   public V get(K key) {&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final WeakReference&amp;lt;V&amp;gt; current = lookup(key);&lt;/li&gt;
	&lt;li&gt;V val = resolve(current);&lt;/li&gt;
	&lt;li&gt;if (val != null) {&lt;br/&gt;
+    final WeakReference&amp;lt;V&amp;gt; currentWeakRef = lookup(key);&lt;br/&gt;
+    // resolve it, after which if not null, we have a strong reference&lt;br/&gt;
+    V strongVal = resolve(currentWeakRef);&lt;br/&gt;
+    if (strongVal != null) 
{
       // all good.
-      return  val;
+      return  strongVal;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// here, either no ref, or the value is null&lt;/li&gt;
	&lt;li&gt;if (current != null) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+    // here, either currentWeakRef was null, or its reference was GC&amp;#39;d.+    if (currentWeakRef != null) {
+      // garbage collection removed the reference.
+
+      // explicitly remove the weak ref from the map if it has not
+      // been updated by this point
+      // this is here just for completeness.
+      map.remove(key, currentWeakRef);
+
+      // log/report the loss.
       noteLost(key);
     }++    // create a new value and add it to the map     return create(key);   }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Create a new instance under a key.&lt;br/&gt;
+   * &amp;lt;p&amp;gt;&lt;/li&gt;
	&lt;li&gt;The instance is created, added to the map and then the&lt;/li&gt;
	&lt;li&gt;map value retrieved.&lt;/li&gt;
	&lt;li&gt;This ensures that the reference returned is that in the map,&lt;/li&gt;
	&lt;li&gt;even if there is more than one entry being created at the same time.&lt;br/&gt;
+   * If that race does occur, it will be logged the first time it happens&lt;br/&gt;
+   * for this specific map instance.&lt;br/&gt;
+   * &amp;lt;p&amp;gt;&lt;br/&gt;
+   * &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-18456&quot; title=&quot;NullPointerException in ObjectListingIterator&amp;#39;s constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-18456&quot;&gt;&lt;del&gt;HADOOP-18456&lt;/del&gt;&lt;/a&gt; highlighted the risk of a concurrent GC resulting a null&lt;br/&gt;
+   * value being retrieved and so returned.&lt;br/&gt;
+   * To prevent this:&lt;br/&gt;
+   * &amp;lt;ol&amp;gt;&lt;br/&gt;
+   *   &amp;lt;li&amp;gt;A strong reference is retained to the newly created instance&lt;br/&gt;
+   *       in a local variable.&amp;lt;/li&amp;gt;&lt;br/&gt;
+   *   &amp;lt;li&amp;gt;That variable is used after the resolution process, to ensure&lt;br/&gt;
+   *       the JVM doesn&apos;t consider it &quot;unreachable&quot; and so eligible for GC.&amp;lt;/li&amp;gt;&lt;br/&gt;
+   *   &amp;lt;li&amp;gt;A check is made for the resolved reference being null, and if so,&lt;br/&gt;
+   *       the put() is repeated&amp;lt;/li&amp;gt;&lt;br/&gt;
+   * &amp;lt;/ol&amp;gt;&lt;/li&gt;
	&lt;li&gt;@param key key&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @return the value&lt;br/&gt;
+   * @return the created value&lt;br/&gt;
    */&lt;br/&gt;
   public V create(K key) {&lt;br/&gt;
     entriesCreatedCount.incrementAndGet();&lt;/li&gt;
	&lt;li&gt;WeakReference&amp;lt;V&amp;gt; newRef = new WeakReference&amp;lt;&amp;gt;(&lt;/li&gt;
	&lt;li&gt;requireNonNull(factory.apply(key)));&lt;/li&gt;
	&lt;li&gt;map.put(key, newRef);&lt;/li&gt;
	&lt;li&gt;return map.get(key).get();&lt;br/&gt;
+    /*&lt;br/&gt;
+     Get a strong ref so even if a GC happens in this method the reference is not lost.&lt;br/&gt;
+     It is NOT enough to have a reference in a field, it MUST be used&lt;br/&gt;
+     so as to ensure the reference isn&apos;t optimized away prematurely.&lt;br/&gt;
+     &quot;A reachable object is any object that can be accessed in any potential continuing&lt;br/&gt;
+      computation from any live thread.&quot;&lt;br/&gt;
+    */&lt;br/&gt;
+&lt;br/&gt;
+    final V strongRef = requireNonNull(factory.apply(key),&lt;br/&gt;
+        &quot;factory returned a null instance&quot;);&lt;br/&gt;
+    V resolvedStrongRef;&lt;br/&gt;
+    do {&lt;br/&gt;
+      WeakReference&amp;lt;V&amp;gt; newWeakRef = new WeakReference&amp;lt;&amp;gt;(strongRef);&lt;br/&gt;
+&lt;br/&gt;
+      // put it in the map&lt;br/&gt;
+      map.put(key, newWeakRef);&lt;br/&gt;
+&lt;br/&gt;
+      // get it back from the map&lt;br/&gt;
+      WeakReference&amp;lt;V&amp;gt; retrievedWeakRef = map.get(key);&lt;br/&gt;
+      // resolve that reference, handling the situation where somehow it was removed from the map&lt;br/&gt;
+      // between the put() and the get()&lt;br/&gt;
+      resolvedStrongRef = resolve(retrievedWeakRef);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   If we have a strong reference on L207, why do we expect to lose it?&lt;/p&gt;

&lt;p&gt;   I could see it happening in the old `create(K key)` implementation, but less so here.&lt;/p&gt;


</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13482005">IMPALA-11592</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13351135">HADOOP-17461</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13424167">HADOOP-18091</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13539636">HADOOP-18767</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 7 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18nio:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12346894">3.4.0</customfieldvalue>
    <customfieldvalue id="12350632">3.3.5</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>