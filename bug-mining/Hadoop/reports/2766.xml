<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:56:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-17028] ViewFS should initialize target filesystems lazily</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-17028</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;Currently viewFS initialize all configured target filesystems when viewfs#init itself.&lt;/p&gt;

&lt;p&gt;Some target file system initialization involve creating heavy objects and proxy connections. Ex: DistributedFileSystem#initialize will create DFSClient object which will create proxy connections to NN etc.&lt;br/&gt;
For example: if ViewFS configured with 10 target fs with hdfs uri and 2 targets with s3a.&lt;/p&gt;

&lt;p&gt;If one of the client only work with s3a target, But ViewFS will initialize all targets irrespective of what clients interested to work with. That means, here client will create 10 DFS initializations and 2 s3a initializations. Its unnecessary to have DFS initialization here. So, it will be a good idea to initialize the target fs only when first time usage call come to particular target fs scheme.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13302792">HADOOP-17028</key>
            <summary>ViewFS should initialize target filesystems lazily</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="abhishekd">Abhishek Das</assignee>
                                    <reporter username="umamaheswararao">Uma Maheswara Rao G</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 5 May 2020 06:09:02 +0000</created>
                <updated>Wed, 21 Jul 2021 01:30:31 +0000</updated>
                            <resolved>Wed, 21 Jul 2021 01:30:31 +0000</resolved>
                                    <version>3.2.1</version>
                                    <fixVersion>3.4.0</fixVersion>
                    <fixVersion>2.10.2</fixVersion>
                    <fixVersion>3.2.3</fixVersion>
                    <fixVersion>3.3.2</fixVersion>
                    <fixVersion>3.1.5</fixVersion>
                                    <component>client-mounts</component>
                    <component>fs</component>
                    <component>viewfs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="28200">7h 50m</timespent>
                                <comments>
                            <comment id="17099863" author="stevel@apache.org" created="Tue, 5 May 2020 13:10:58 +0000"  >&lt;p&gt;this would be good. All the object stores can be slow.&lt;/p&gt;

&lt;p&gt;FWIW,  if you set fs.s3a.bucket.probe = 0 we skip that check for a bucket, but s3guard still kicks off its conversation with DynamoDB&lt;/p&gt;</comment>
                            <comment id="17127459" author="abhishekd" created="Sun, 7 Jun 2020 00:30:08 +0000"  >&lt;p&gt;The filesystems for both the non-leaf nodes (InternalDirOfViewFs) and leaf nodes (ChRootedFileSystem) gets constructed during the viewfs initialize phase. During this the fs object gets created though FsGetter. Here is my rough idea about the implementation.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Make sure the FsGetter.getNewInstance() doesn&apos;t initialize the FileSystem object when asked for.&lt;/li&gt;
	&lt;li&gt;For InternalDirOfViewFs, the initialize is called at the constructor but this call is calling base initailize method.&lt;/li&gt;
	&lt;li&gt;For ChRootedFileSystem, if the constructor gets invoked through ChRootedFileSystem(final URI uri, Configuration conf) then it gets the fs object from FileSystem.get(uri, conf) which will initalize the fs object but this constructor is not used except in tests, so we are good. The other constructor gets the fs object as argument, so we have to make sure caller wont initialize the fs object before invoking this constructor.&lt;/li&gt;
	&lt;li&gt;When a FileSystem api gets invoked for ChRootedFileSystem, before calling the actual implementation of the underlying fs object through FilterFileSystem, it can check whether the fs object has been initialized, so that the fs object gets initialized only once. We can tap at&#160;ChRootedFileSystem.fullPath(path) to check the initialization (through a class level variable)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=umamaheswararao&quot; class=&quot;user-hover&quot; rel=&quot;umamaheswararao&quot;&gt;umamaheswararao&lt;/a&gt;&#160;let me know your thoughts about the approach. I can start working on this.&lt;/p&gt;</comment>
                            <comment id="17186870" author="abhishekd" created="Sat, 29 Aug 2020 01:28:11 +0000"  >&lt;p&gt;PR for this:&#160;&lt;a href=&quot;https://github.com/apache/hadoop/pull/2260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/2260&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=umamaheswararao&quot; class=&quot;user-hover&quot; rel=&quot;umamaheswararao&quot;&gt;umamaheswararao&lt;/a&gt;&#160;can you please review the change when you get a chance. Thanks in advance&lt;/p&gt;</comment>
                            <comment id="17188186" author="umamaheswararao" created="Tue, 1 Sep 2020 07:02:52 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abhishekd&quot; class=&quot;user-hover&quot; rel=&quot;abhishekd&quot;&gt;abhishekd&lt;/a&gt;&#160;for the patch. I have this in my list, I will provide my feedback soon. Thank you.&lt;/p&gt;</comment>
                            <comment id="17356063" author="shv" created="Thu, 3 Jun 2021 00:49:53 +0000"  >&lt;p&gt;Left minor comments on the PR. The approach looks reasonable to me.&lt;br/&gt;
The important thing is to get a Jenkins build. Looks like it could not run. May be you fork got stale. You should probably rebase on current trunk.&lt;/p&gt;</comment>
                            <comment id="17357581" author="shv" created="Fri, 4 Jun 2021 19:19:42 +0000"  >&lt;p&gt;I&apos;ll re-post here my comment from the linked PR for visibility.&lt;br/&gt;
It looks like &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt; deprecated this class later after his comment. Don&apos;t know what prompted the refactoring, but&lt;br/&gt;
&lt;tt&gt;org.apache.hadoop.fs.impl.FunctionsRaisingIOE.FunctionRaisingIOE&lt;/tt&gt;&lt;br/&gt;
should be now&lt;br/&gt;
&lt;tt&gt;org.apache.hadoop.util.functional.FunctionRaisingIOE&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Moving interfaces, which are public by default, from one package to another is considered an incompatible change, especially since the previous variant had been released. Besides, it has been committed only to branch-3.3 contributing to further divergence of the supported branches and making backporting yet harder.&lt;br/&gt;
So &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abhishekd&quot; class=&quot;user-hover&quot; rel=&quot;abhishekd&quot;&gt;abhishekd&lt;/a&gt;, I prefer to avoid using &lt;tt&gt;FunctionRaisingIOE&lt;/tt&gt; in this patch if possible. This will simplify the backport and avoid using unstable APIs.&lt;/p&gt;</comment>
                            <comment id="17358592" author="stevel@apache.org" created="Mon, 7 Jun 2021 13:22:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;It looks like Steve Loughran deprecated this class later after his comment. Don&apos;t know what prompted the refactoring, but&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;tt&gt;org.apache.hadoop.fs.impl.FunctionsRaisingIOE.FunctionRaisingIOE&lt;/tt&gt; should be now &lt;tt&gt;org.apache.hadoop.util.functional.FunctionRaisingIOE&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I moved it because it turns out that wrapping/unwrapping IOEs is critical to using this in applications using the FS API, and since the relevant methods/interfaces were not public, the only way to do that is to have them public. &lt;/p&gt;

&lt;p&gt;Accordingly I&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;replicated the functional interfaces in the public/unstable package &lt;tt&gt;org.apache.hadoop.util.functional&lt;/tt&gt; where I&apos;m trying to make it possible to use IOE-raising stuff (including RemoteIterator) in apps.&lt;/li&gt;
	&lt;li&gt;tagged the old ones, as Deprecated, so new code will use it.&lt;/li&gt;
&lt;/ol&gt;



&lt;blockquote&gt;&lt;p&gt;Moving interfaces, which are public by default, from one package to another is considered an incompatible change, especially since the previous variant had been released&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Two points to note&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;I tagged the original package &quot;Fs.impl&quot; as not public then, isn&apos;t it?&lt;/li&gt;
	&lt;li&gt;left the old interface alone, on the basis that if filesystems outside the hadoop codebase (gcs?) were using them, all would be good.&lt;/li&gt;
&lt;/ol&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@InterfaceAudience.LimitedPrivate(&lt;span class=&quot;code-quote&quot;&gt;&quot;Filesystems&quot;&lt;/span&gt;)
@InterfaceStability.Unstable
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;therefore, I do not consider this to be an incompatible change since&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;it wasn&apos;t public, outside filesystems&lt;/li&gt;
	&lt;li&gt;it hasn&apos;t been removed, just deprecated.&lt;/li&gt;
&lt;/ol&gt;


&lt;blockquote&gt;&lt;p&gt;I prefer to avoid using FunctionRaisingIOE in this patch if possible&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Use the o.a.h.fs.impl for compatibility across Hadoop 3.3+&lt;/p&gt;

&lt;p&gt;For older releases, no, it&apos;s not there. Not sure what to do there.&lt;/p&gt;</comment>
                            <comment id="17370329" author="shv" created="Sun, 27 Jun 2021 21:19:06 +0000"  >&lt;p&gt;Steve, this looks like incompatible change as it replaced the parameter to a different class:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &amp;lt;T&amp;gt; CompletableFuture&amp;lt;T&amp;gt; eval(
-      FunctionsRaisingIOE.CallableRaisingIOE&amp;lt;T&amp;gt; callable) {
+      CallableRaisingIOE&amp;lt;T&amp;gt; callable) {
     CompletableFuture&amp;lt;T&amp;gt; result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CompletableFuture&amp;lt;&amp;gt;();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also introduction of dead code should have been avoided. Looking at the history, you introduced &lt;tt&gt;org.apache.hadoop.fs.impl.FunctionsRaisingIOE.FunctionRaisingIOE&lt;/tt&gt; as a part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-15183&quot; title=&quot;S3Guard store becomes inconsistent after partial failure of rename&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-15183&quot;&gt;&lt;del&gt;HADOOP-15183&lt;/del&gt;&lt;/a&gt;. But it wasn&apos;t used anywhere. Then &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17450&quot; title=&quot;hadoop-common to add IOStatistics API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17450&quot;&gt;&lt;del&gt;HADOOP-17450&lt;/del&gt;&lt;/a&gt; deprecated it. One good thing about it that you can remove the deprecated classes as they have never been used.&lt;br/&gt;
Supporting dead code is just a waste of energy it also makes back porting really hard. You don&apos;t seem to care about older versions, but many people do.&lt;/p&gt;</comment>
                            <comment id="17370546" author="stevel@apache.org" created="Mon, 28 Jun 2021 11:00:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;Steve, this looks like incompatible change as it replaced the parameter to a different class...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In a world of @Functional params, it is compatible. But I suspect that you are right about link-time matching; the JVM probably isn&apos;t going to blindly treat them as equivalent.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;One good thing about it that you can remove the deprecated classes as they have never been used.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;not used in hadoop-*. My fear was that they had been picked up/used in google GCS. I&apos;ve been building that connector and I don&apos;t see it in use. &lt;/p&gt;

&lt;p&gt;Given that I&apos;ll target it for removal in 3.3.2&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;You don&apos;t seem to care about older versions, but many people do.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I really do. I am the one currently staring at the ABFS Code and a branch-2 build. At the same time, being more isolated (and, let&apos;s be ruthless: lower risk), the object storage code has been able to evolve faster than other bits of the codebase. &lt;/p&gt;

&lt;p&gt;FWIW the main troublespot in backporting cloud storage changes, esp in hadoop-azure, is actually mockito versions. something which works on mockito 2 is still likely to compile on mockito 1.x but then fail with some &quot;impossible&quot; stack trace, and I&apos;m left trying to distinguish between &quot;mockito lib version issues, fix test or cut&quot;, &quot;different codepath breaks mockito test&quot; and &quot;test has actually found a regression&quot;. It&apos;s a key reason why I don&apos;t like mockito-based testing. &lt;/p&gt;</comment>
                            <comment id="17380242" author="shv" created="Wed, 14 Jul 2021 01:32:20 +0000"  >&lt;p&gt;I committed this to trunk and branches 3.1, 3.2, 3.3. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abhishekd&quot; class=&quot;user-hover&quot; rel=&quot;abhishekd&quot;&gt;abhishekd&lt;/a&gt; for working on it.&lt;br/&gt;
Will need a separate patch for branch-2.10. Too many conflicts.&lt;/p&gt;</comment>
                            <comment id="17384553" author="shv" created="Wed, 21 Jul 2021 01:28:34 +0000"  >&lt;p&gt;Committed PR #3218 to branch-2.10.&lt;br/&gt;
Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abhishekd&quot; class=&quot;user-hover&quot; rel=&quot;abhishekd&quot;&gt;abhishekd&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13299780">HDFS-15289</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 16 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0edog:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12346894">3.4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>