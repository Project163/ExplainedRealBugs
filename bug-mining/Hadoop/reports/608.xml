<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:40:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-8573] Configuration tries to read from an inputstream resource multiple times. </title>
                <link>https://issues.apache.org/jira/browse/HADOOP-8573</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;If someone calls Configuration.addResource(InputStream) and then reloadConfiguration is called for any reason, Configruation will try to reread the contents of the InputStream, after it has already closed it.&lt;/p&gt;

&lt;p&gt;This never showed up in 1.0 because the framework itself does not call addResource with an InputStream, and typically by the time user code starts running that might call this, all of the default and site resources have already been loaded.&lt;/p&gt;

&lt;p&gt;In 0.23 mapreduce is now a client library, and mapred-site.xml and mapred-default.xml are loaded much later in the process.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12597780">HADOOP-8573</key>
            <summary>Configuration tries to read from an inputstream resource multiple times. </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="revans2">Robert Joseph Evans</assignee>
                                    <reporter username="revans2">Robert Joseph Evans</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jul 2012 15:05:20 +0000</created>
                <updated>Thu, 12 May 2016 18:23:24 +0000</updated>
                            <resolved>Tue, 10 Jul 2012 20:57:57 +0000</resolved>
                                    <version>1.0.2</version>
                    <version>0.23.3</version>
                    <version>2.0.0-alpha</version>
                    <version>3.0.0-alpha1</version>
                                    <fixVersion>0.23.3</fixVersion>
                    <fixVersion>2.0.2-alpha</fixVersion>
                                    <component>conf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="13408061" author="revans2" created="Fri, 6 Jul 2012 15:22:28 +0000"  >&lt;p&gt;The only real way to fix this is to cache the contents of the InputStream, or a parsed version of it.  The question is how do we reduce the potential memory impact of this?  We could change configuration so that it is a list of properties instead of a single combined properties object, but this is a very large change to fix this issue. Because of this I am inclined to not really worry about the memory impact right now.  This feature is not that commonly used, and most configuration objects tend to be shared a lot so I don&apos;t see the impact being that large.&lt;/p&gt;</comment>
                            <comment id="13408103" author="revans2" created="Fri, 6 Jul 2012 16:01:19 +0000"  >&lt;p&gt;This patch just does basic caching on the parsed properties for an InputStream.  It replaces the InputStream in the resources array with the properties themselves.&lt;/p&gt;</comment>
                            <comment id="13408105" author="revans2" created="Fri, 6 Jul 2012 16:02:56 +0000"  >&lt;p&gt;I forgot to add in that this patch feels like a hack to me, with loadResource returning the properties to be added in, but I could not think of a cleaner way to do it without completely refactoring a lot of that code.  If someone else has a better way to do this I would be very happy to switch.&lt;/p&gt;</comment>
                            <comment id="13408542" author="hadoopqa" created="Sat, 7 Jul 2012 02:20:17 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12535381/HADOOP-8573.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12535381/HADOOP-8573.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed these unit tests in hadoop-common-project/hadoop-common:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.ha.TestZKFailoverController&lt;br/&gt;
                  org.apache.hadoop.metrics2.impl.TestMetricsSystemImpl&lt;br/&gt;
                  org.apache.hadoop.io.file.tfile.TestTFileByteArrays&lt;br/&gt;
                  org.apache.hadoop.io.file.tfile.TestTFileJClassComparatorByteArrays&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1178//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1178//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1178//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1178//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13410363" author="tgraves" created="Tue, 10 Jul 2012 14:07:52 +0000"  >&lt;p&gt;Mostly looks good, a couple minor things.&lt;/p&gt;

&lt;p&gt;nits:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add a space in Configuration.java line 1772 and 1905 after if before (  and 1926 between for and (&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;suggestions:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;could add a comment describing new behavior when using InputStreams - perhaps a warning about memory usage&lt;/li&gt;
	&lt;li&gt;we might change org.apache.hadoop.mapreduce.v2.app.job.impl.JobImpl.loadConfFile to use addResource(Path file) instead of the inputStream. Only used in one place right now but might be better to change it in case it gets used more.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13410503" author="revans2" created="Tue, 10 Jul 2012 16:37:14 +0000"  >&lt;p&gt;I have addressed your comments with this latest patch.  I did not change the behavior of reading in the configuration form HDFS, because Configuration.addResource(Path) only works for the local file system &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file://&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13410565" author="hadoopqa" created="Tue, 10 Jul 2012 17:19:56 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12535868/HADOOP-8573.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12535868/HADOOP-8573.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    -1 core tests.  The patch failed these unit tests in hadoop-common-project/hadoop-common:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.ha.TestZKFailoverController&lt;br/&gt;
                  org.apache.hadoop.io.file.tfile.TestTFileByteArrays&lt;br/&gt;
                  org.apache.hadoop.io.file.tfile.TestTFileJClassComparatorByteArrays&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1181//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1181//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1181//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1181//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13410635" author="revans2" created="Tue, 10 Jul 2012 17:58:44 +0000"  >&lt;p&gt;Upmerged the changes to deal with another patch that was just merged in. Oh and the test failures are unrelated.&lt;/p&gt;</comment>
                            <comment id="13410659" author="hadoopqa" created="Tue, 10 Jul 2012 18:24:07 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12535885/HADOOP-8573.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12535885/HADOOP-8573.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 eclipse:eclipse.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1182//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1182//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1182//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1182//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13410874" author="tgraves" created="Tue, 10 Jul 2012 20:45:11 +0000"  >&lt;p&gt;+1. Thanks Bobby!&lt;/p&gt;</comment>
                            <comment id="13411412" author="hudson" created="Wed, 11 Jul 2012 11:41:12 +0000"  >&lt;p&gt;Integrated in Hadoop-Hdfs-trunk #1100 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1100/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1100/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8573&quot; title=&quot;Configuration tries to read from an inputstream resource multiple times. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8573&quot;&gt;&lt;del&gt;HADOOP-8573&lt;/del&gt;&lt;/a&gt;. Configuration tries to read from an inputstream resource multiple times (Robert Evans via tgraves) (Revision 1359891)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tgraves : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1359891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1359891&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/conf/Configuration.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/conf/TestConfiguration.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13411479" author="hudson" created="Wed, 11 Jul 2012 13:26:54 +0000"  >&lt;p&gt;Integrated in Hadoop-Hdfs-0.23-Build #310 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/310/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/310/&lt;/a&gt;)&lt;br/&gt;
    merge -r 1359891:1359892 from branch-2. FIXES: &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8573&quot; title=&quot;Configuration tries to read from an inputstream resource multiple times. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8573&quot;&gt;&lt;del&gt;HADOOP-8573&lt;/del&gt;&lt;/a&gt; (Revision 1359896)&lt;/p&gt;

&lt;p&gt;     Result = UNSTABLE&lt;br/&gt;
tgraves : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1359896&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1359896&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/conf/Configuration.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/conf/TestConfiguration.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13411526" author="hudson" created="Wed, 11 Jul 2012 14:03:44 +0000"  >&lt;p&gt;Integrated in Hadoop-Mapreduce-trunk #1133 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1133/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1133/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8573&quot; title=&quot;Configuration tries to read from an inputstream resource multiple times. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8573&quot;&gt;&lt;del&gt;HADOOP-8573&lt;/del&gt;&lt;/a&gt;. Configuration tries to read from an inputstream resource multiple times (Robert Evans via tgraves) (Revision 1359891)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tgraves : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1359891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1359891&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/conf/Configuration.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/conf/TestConfiguration.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12535885" name="HADOOP-8573.txt" size="8026" author="revans2" created="Tue, 10 Jul 2012 17:58:44 +0000"/>
                            <attachment id="12535868" name="HADOOP-8573.txt" size="7881" author="revans2" created="Tue, 10 Jul 2012 16:37:14 +0000"/>
                            <attachment id="12535381" name="HADOOP-8573.txt" size="7144" author="revans2" created="Fri, 6 Jul 2012 16:01:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>240823</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i015t3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4710</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12320059">0.23.3</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>