<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:47:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-11400] GraphiteSink does not reconnect to Graphite after &apos;broken pipe&apos;</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-11400</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;I see that after network error GraphiteSink does not reconnects to Graphite server and in effect metrics are not sent. &lt;/p&gt;

&lt;p&gt;Here is stacktrace I see (this is from nodemanager):&lt;/p&gt;

&lt;p&gt;2014-12-11 16:39:21,655 ERROR org.apache.hadoop.metrics2.impl.MetricsSinkAdapter: Got sink exception, retry in 4806ms&lt;br/&gt;
org.apache.hadoop.metrics2.MetricsException: Error flushing metrics&lt;br/&gt;
        at org.apache.hadoop.metrics2.sink.GraphiteSinkFixed.flush(GraphiteSinkFixed.java:120)&lt;br/&gt;
        at org.apache.hadoop.metrics2.impl.MetricsSinkAdapter.consume(MetricsSinkAdapter.java:184)&lt;br/&gt;
        at org.apache.hadoop.metrics2.impl.MetricsSinkAdapter.consume(MetricsSinkAdapter.java:43)&lt;br/&gt;
        at org.apache.hadoop.metrics2.impl.SinkQueue.consumeAll(SinkQueue.java:87)&lt;br/&gt;
        at org.apache.hadoop.metrics2.impl.MetricsSinkAdapter.publishMetricsFromQueue(MetricsSinkAdapter.java:129)&lt;br/&gt;
        at org.apache.hadoop.metrics2.impl.MetricsSinkAdapter$1.run(MetricsSinkAdapter.java:88)&lt;br/&gt;
Caused by: java.net.SocketException: Broken pipe&lt;br/&gt;
        at java.net.SocketOutputStream.socketWrite0(Native Method)&lt;br/&gt;
        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:113)&lt;br/&gt;
        at java.net.SocketOutputStream.write(SocketOutputStream.java:159)&lt;br/&gt;
        at sun.nio.cs.StreamEncoder.writeBytes(StreamEncoder.java:221)&lt;br/&gt;
        at sun.nio.cs.StreamEncoder.implFlushBuffer(StreamEncoder.java:291)&lt;br/&gt;
        at sun.nio.cs.StreamEncoder.implFlush(StreamEncoder.java:295)&lt;br/&gt;
        at sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:141)&lt;br/&gt;
        at java.io.OutputStreamWriter.flush(OutputStreamWriter.java:229)&lt;br/&gt;
        at org.apache.hadoop.metrics2.sink.GraphiteSinkFixed.flush(GraphiteSinkFixed.java:118)&lt;br/&gt;
        ... 5 more&lt;br/&gt;
2014-12-11 16:39:26,463 ERROR org.apache.hadoop.metrics2.impl.MetricsSinkAdapter: Got sink exception and over retry limit, suppressing further error messages&lt;br/&gt;
org.apache.hadoop.metrics2.MetricsException: Error flushing metrics&lt;br/&gt;
        at org.apache.hadoop.metrics2.sink.GraphiteSinkFixed.flush(GraphiteSinkFixed.java:120)&lt;br/&gt;
        at org.apache.hadoop.metrics2.impl.MetricsSinkAdapter.consume(MetricsSinkAdapter.java:184)&lt;br/&gt;
        at org.apache.hadoop.metrics2.impl.MetricsSinkAdapter.consume(MetricsSinkAdapter.java:43)&lt;br/&gt;
        at org.apache.hadoop.metrics2.impl.SinkQueue.consumeAll(SinkQueue.java:87)&lt;br/&gt;
        at org.apache.hadoop.metrics2.impl.MetricsSinkAdapter.publishMetricsFromQueue(MetricsSinkAdapter.java:129)&lt;br/&gt;
        at org.apache.hadoop.metrics2.impl.MetricsSinkAdapter$1.run(MetricsSinkAdapter.java:88)&lt;br/&gt;
Caused by: java.net.SocketException: Broken pipe&lt;br/&gt;
        at java.net.SocketOutputStream.socketWrite0(Native Method)&lt;br/&gt;
        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:113)&lt;br/&gt;
        at java.net.SocketOutputStream.write(SocketOutputStream.java:159)&lt;br/&gt;
        at sun.nio.cs.StreamEncoder.writeBytes(StreamEncoder.java:221)&lt;br/&gt;
        at sun.nio.cs.StreamEncoder.implFlushBuffer(StreamEncoder.java:291)&lt;br/&gt;
        at sun.nio.cs.StreamEncoder.implFlush(StreamEncoder.java:295)&lt;br/&gt;
        at sun.nio.cs.StreamEncoder.flush(StreamEncoder.java:141)&lt;br/&gt;
        at java.io.OutputStreamWriter.flush(OutputStreamWriter.java:229)&lt;br/&gt;
        at org.apache.hadoop.metrics2.sink.GraphiteSinkFixed.flush(GraphiteSinkFixed.java:118)&lt;br/&gt;
        ... 5 more&lt;/p&gt;


&lt;p&gt;GraphiteSinkFixed.java is simply GraphiteSink.java from Hadoop 2.6.0 (with fixed &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11182&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HADOOP-11182&lt;/a&gt;) because I cannot simply upgrade Hadoop (I am using CDH5).&lt;/p&gt;

&lt;p&gt;I see that GraphiteSink is using OutputStreamWriter which is created only in init method (which is probably called only once per application runtime) and there is no reconnection logic.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12761317">HADOOP-11400</key>
            <summary>GraphiteSink does not reconnect to Graphite after &apos;broken pipe&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kgs">Kamil Gorlo</assignee>
                                    <reporter username="kgs">Kamil Gorlo</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Dec 2014 10:05:52 +0000</created>
                <updated>Wed, 28 Oct 2015 00:51:32 +0000</updated>
                            <resolved>Sat, 10 Jan 2015 16:40:10 +0000</resolved>
                                    <version>2.5.1</version>
                    <version>2.6.0</version>
                                    <fixVersion>2.7.0</fixVersion>
                                    <component>metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14247566" author="raviprak" created="Tue, 16 Dec 2014 01:26:51 +0000"  >&lt;p&gt;Thanks for the report Kamil! Do you plan on uploading a patch to fix the issue? I&apos;d be happy to review and commit it promptly&lt;/p&gt;</comment>
                            <comment id="14249070" author="kgs" created="Tue, 16 Dec 2014 22:21:38 +0000"  >&lt;p&gt;I&apos;ll try to upload patch, do you have any guidelines for newcomers?&lt;/p&gt;</comment>
                            <comment id="14256069" author="raviprak" created="Mon, 22 Dec 2014 19:19:53 +0000"  >&lt;p&gt;Hi Kamil! &lt;a href=&quot;https://wiki.apache.org/hadoop/HowToContribute&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://wiki.apache.org/hadoop/HowToContribute&lt;/a&gt;&lt;br/&gt;
Just follow the same code formatting and create a patch file to upload onto this JIRA.&lt;/p&gt;</comment>
                            <comment id="14256992" author="kgs" created="Tue, 23 Dec 2014 14:13:24 +0000"  >&lt;p&gt;I&apos;ve attached patch which should fix this issue. &lt;/p&gt;

&lt;p&gt;I&apos;ve tried to follow codestyle used in GraphiteSink class, but since there is no one consisten style it was hard &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14257067" author="hadoopqa" created="Tue, 23 Dec 2014 15:15:16 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12688856/HADOOP-11400.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12688856/HADOOP-11400.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 5caebba.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 4 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5334//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5334//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5334//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5334//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5334//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5334//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14257075" author="kgs" created="Tue, 23 Dec 2014 15:24:47 +0000"  >&lt;p&gt;Hmm, I am not sure if this findbugs report is correct, 4 new Findbugs?&lt;/p&gt;</comment>
                            <comment id="14257112" author="ozawa" created="Tue, 23 Dec 2014 15:47:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kgs&quot; class=&quot;user-hover&quot; rel=&quot;kgs&quot;&gt;kgs&lt;/a&gt; DM_DEFAULT_ENCODING is a related warning. Could you fix it?&lt;/p&gt;</comment>
                            <comment id="14257446" author="raviprak" created="Tue, 23 Dec 2014 20:08:28 +0000"  >&lt;p&gt;Thanks for the patch Kamil. Here are my thoughts:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Please explicitly import all classes.&lt;/li&gt;
	&lt;li&gt;Let&apos;s connect during init() rather than on first write.&lt;/li&gt;
	&lt;li&gt;We can move the logic to check if graphite.isConnected() within the functions graphite.write() and graphite.flush() . Instead maybe check if graphite != null ?&lt;/li&gt;
	&lt;li&gt;Should we also set a limit to the number of times a connection will be allowed to be retried?&lt;/li&gt;
	&lt;li&gt;Any reason for class Graphite to be public?&lt;/li&gt;
	&lt;li&gt;In Graphite.connect(), the condition should be isConnected() instead of socket != null&lt;/li&gt;
	&lt;li&gt;In general let&apos;s try to move all the conditions and error checking related to the connection within the Graphite class.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14271144" author="kgs" created="Fri, 9 Jan 2015 15:26:15 +0000"  >&lt;p&gt;Thanks for your thoughts - I&apos;ve uploaded fixed version. Here are my comments:&lt;/p&gt;

&lt;p&gt;1. Done.&lt;br/&gt;
2. I&apos;ve already done this in first version.&lt;br/&gt;
3. Logic moved to Graphite class. In my opinion graphite != null is not necessary.&lt;br/&gt;
4. I&apos;ve created limit, setting it arbitrarily to 5 (after limit is reached, there is ERROR in logs and no more errors is raported and no further connection attempts are made)&lt;br/&gt;
5. Because of tests - I now this is ugly, but I have no better solution.&lt;br/&gt;
6. Fixed.&lt;br/&gt;
7. Done.&lt;/p&gt;</comment>
                            <comment id="14271474" author="hadoopqa" created="Fri, 9 Jan 2015 16:22:56 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12691187/HADOOP-11400.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12691187/HADOOP-11400.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision ae91b13.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5386//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5386//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5386//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5386//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14271640" author="raviprak" created="Fri, 9 Jan 2015 18:18:39 +0000"  >&lt;p&gt;Thanks a lot Kamil! The latest patch looks good to me. +1 . I&apos;ll commit by end of day today if there are no objections.&lt;/p&gt;</comment>
                            <comment id="14272578" author="raviprak" created="Sat, 10 Jan 2015 16:40:10 +0000"  >&lt;p&gt;Thanks Kamil for your contribution! I&apos;ve committed the patch to trunk and branch-2&lt;/p&gt;</comment>
                            <comment id="14272581" author="hudson" created="Sat, 10 Jan 2015 16:43:06 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-trunk-Commit #6840 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/6840/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/6840/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11400&quot; title=&quot;GraphiteSink does not reconnect to Graphite after &amp;#39;broken pipe&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11400&quot;&gt;&lt;del&gt;HADOOP-11400&lt;/del&gt;&lt;/a&gt;. GraphiteSink does not reconnect to Graphite after &apos;broken pipe&apos; (raviprak: rev 4d2914210053f28c95094aa59e48f8e84c55a2c7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/impl/TestGraphiteMetrics.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/GraphiteSink.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14272880" author="hudson" created="Sun, 11 Jan 2015 11:44:01 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #70 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/70/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/70/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11400&quot; title=&quot;GraphiteSink does not reconnect to Graphite after &amp;#39;broken pipe&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11400&quot;&gt;&lt;del&gt;HADOOP-11400&lt;/del&gt;&lt;/a&gt;. GraphiteSink does not reconnect to Graphite after &apos;broken pipe&apos; (raviprak: rev 4d2914210053f28c95094aa59e48f8e84c55a2c7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/impl/TestGraphiteMetrics.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/GraphiteSink.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14272882" author="hudson" created="Sun, 11 Jan 2015 11:55:06 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Yarn-trunk #804 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/804/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/804/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11400&quot; title=&quot;GraphiteSink does not reconnect to Graphite after &amp;#39;broken pipe&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11400&quot;&gt;&lt;del&gt;HADOOP-11400&lt;/del&gt;&lt;/a&gt;. GraphiteSink does not reconnect to Graphite after &apos;broken pipe&apos; (raviprak: rev 4d2914210053f28c95094aa59e48f8e84c55a2c7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/GraphiteSink.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/impl/TestGraphiteMetrics.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14272908" author="hudson" created="Sun, 11 Jan 2015 14:23:48 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Hdfs-trunk #2002 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/2002/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/2002/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11400&quot; title=&quot;GraphiteSink does not reconnect to Graphite after &amp;#39;broken pipe&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11400&quot;&gt;&lt;del&gt;HADOOP-11400&lt;/del&gt;&lt;/a&gt;. GraphiteSink does not reconnect to Graphite after &apos;broken pipe&apos; (raviprak: rev 4d2914210053f28c95094aa59e48f8e84c55a2c7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/GraphiteSink.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/impl/TestGraphiteMetrics.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14272911" author="hudson" created="Sun, 11 Jan 2015 14:32:30 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Hdfs-trunk-Java8 #67 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/67/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/67/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11400&quot; title=&quot;GraphiteSink does not reconnect to Graphite after &amp;#39;broken pipe&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11400&quot;&gt;&lt;del&gt;HADOOP-11400&lt;/del&gt;&lt;/a&gt;. GraphiteSink does not reconnect to Graphite after &apos;broken pipe&apos; (raviprak: rev 4d2914210053f28c95094aa59e48f8e84c55a2c7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/GraphiteSink.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/impl/TestGraphiteMetrics.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14272933" author="hudson" created="Sun, 11 Jan 2015 15:28:56 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Mapreduce-trunk #2021 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2021/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2021/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11400&quot; title=&quot;GraphiteSink does not reconnect to Graphite after &amp;#39;broken pipe&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11400&quot;&gt;&lt;del&gt;HADOOP-11400&lt;/del&gt;&lt;/a&gt;. GraphiteSink does not reconnect to Graphite after &apos;broken pipe&apos; (raviprak: rev 4d2914210053f28c95094aa59e48f8e84c55a2c7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/impl/TestGraphiteMetrics.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/GraphiteSink.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14273673" author="hudson" created="Mon, 12 Jan 2015 15:04:12 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #72 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/72/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/72/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11400&quot; title=&quot;GraphiteSink does not reconnect to Graphite after &amp;#39;broken pipe&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11400&quot;&gt;&lt;del&gt;HADOOP-11400&lt;/del&gt;&lt;/a&gt;. GraphiteSink does not reconnect to Graphite after &apos;broken pipe&apos; (raviprak: rev 4d2914210053f28c95094aa59e48f8e84c55a2c7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/impl/TestGraphiteMetrics.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/metrics2/sink/GraphiteSink.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14973870" author="manish.hadoop.work@gmail.com" created="Mon, 26 Oct 2015 07:54:33 +0000"  >&lt;p&gt;Thanks Kamil for the patch !! &lt;/p&gt;

&lt;p&gt;Though I have few questions regarding MetricSystem in general (so may be someone can also please comment), and for GraphiteSink : &lt;/p&gt;

&lt;p&gt;1. Case, target Graphite Server is down, or not reachable: &lt;/p&gt;

&lt;p&gt;In case of putMetrics throws exception, client gets &quot;broken pipe&quot; exception which goes till MetricSinkAdapter. &lt;br/&gt;
Then Hadoop MetricSystem in general has notion of retry and wait-time, but after retry it just stop using the errored Sink.&lt;br/&gt;
Even after few mins if the target server is up, it doesn&apos;t try to publish metric again. &lt;/p&gt;

&lt;p&gt;I tested this scenario with GraphiteSink.&lt;/p&gt;

&lt;p&gt;My understanding of this flow, might be wrong &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, but if not then I think best place to fix this in the MetricSystem framework, and it should check the sinks availability after every few secs / mins based on the config. &lt;/p&gt;


&lt;p&gt;2. GraphiteSink is using single TCP connection, should it uses a TCP connection pool? &lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Manish&lt;/p&gt;</comment>
                            <comment id="14977496" author="manish.hadoop.work@gmail.com" created="Wed, 28 Oct 2015 00:51:32 +0000"  >&lt;p&gt;&quot; 1. Case, target Graphite Server is down, or not reachable:&lt;br/&gt;
In case of putMetrics throws exception, client gets &quot;broken pipe&quot; exception which goes till MetricSinkAdapter. &lt;br/&gt;
Then Hadoop MetricSystem in general has notion of retry and wait-time, but after retry it just stop using the errored Sink.&lt;br/&gt;
Even after few mins if the target server is up, it doesn&apos;t try to publish metric again.&lt;br/&gt;
I tested this scenario with GraphiteSink.&lt;br/&gt;
My understanding of this flow, might be wrong , but if not then I think best place to fix this in the MetricSystem framework, and it should check the sinks availability after every few secs / mins based on the config. &quot;&lt;/p&gt;

&lt;p&gt;Looks like the MetricSinkAdapter just suppresses the log.error  but still keep trying the putMetrics(....) method in a while loop on the sink object. &lt;br/&gt;
So, its bad on my part  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; , but then yes each sink needs to handle the reconnect etc. in case of failure which should hold true. &lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Manish&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12691187" name="HADOOP-11400.patch" size="15459" author="kgs" created="Fri, 9 Jan 2015 15:22:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23d4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>