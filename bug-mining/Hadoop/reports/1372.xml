<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:46:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-11274] ConcurrentModificationException in Configuration Copy Constructor</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-11274</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;Exception as below happens in doing some configuration update in parallel:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.util.ConcurrentModificationException
	at java.util.HashMap$HashIterator.nextEntry(HashMap.java:922)
	at java.util.HashMap$EntryIterator.next(HashMap.java:962)
	at java.util.HashMap$EntryIterator.next(HashMap.java:960)
	at java.util.HashMap.putAllForCreate(HashMap.java:554)
	at java.util.HashMap.&amp;lt;init&amp;gt;(HashMap.java:298)
	at org.apache.hadoop.conf.Configuration.&amp;lt;init&amp;gt;(Configuration.java:703)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In a constructor of Configuration - public Configuration(Configuration other), the copy of updatingResource data structure in copy constructor is not synchronized properly. &lt;br/&gt;
Configuration.get() eventually calls loadProperty() where updatingResource gets updated. So, whats happening here is one thread is trying to do copy of Configuration as demonstrated in stack trace and other thread is doing Configuration.get(key) and than ConcurrentModificationException occurs because copying of updatingResource is not synchronized in constructor. &lt;br/&gt;
We should make the update to updatingResource get synchronized, and also fix other tiny synchronized issues there.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12753083">HADOOP-11274</key>
            <summary>ConcurrentModificationException in Configuration Copy Constructor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="vinodkv">Vinod Kumar Vavilapalli</assignee>
                                    <reporter username="junping_du">Junping Du</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Nov 2014 16:24:12 +0000</created>
                <updated>Fri, 25 Oct 2019 20:25:46 +0000</updated>
                            <resolved>Sun, 1 Mar 2015 20:36:17 +0000</resolved>
                                                                    <component>conf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                                                                <comments>
                            <comment id="14198593" author="djp" created="Wed, 5 Nov 2014 16:29:00 +0000"  >&lt;p&gt;Deliver a quick patch to fix it.&lt;/p&gt;</comment>
                            <comment id="14198711" author="hadoopqa" created="Wed, 5 Nov 2014 17:36:19 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12679557/HADOOP-11274.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12679557/HADOOP-11274.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 8e9502e.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The following test timeouts occurred in hadoop-common-project/hadoop-common:&lt;/p&gt;

&lt;p&gt;org.apache.hadoop.http.TestHttpServerLifecycle&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5031//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5031//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5031//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5031//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14198965" author="zjshen" created="Wed, 5 Nov 2014 19:57:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junping_du&quot; class=&quot;user-hover&quot; rel=&quot;junping_du&quot;&gt;junping_du&lt;/a&gt;, I&apos;m afraid read and write access to other.updatingResource is still not completely synchronized after the patch.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.updatingResource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[]&amp;gt;(other.updatingResource);
     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.finalParameters = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;(other.finalParameters);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;updatingResource can be also modified by &lt;tt&gt;set(String name, String value, String source)&lt;/tt&gt; and &lt;tt&gt;readFields(DataInput in)&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14199686" author="djp" created="Thu, 6 Nov 2014 02:50:10 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjshen&quot; class=&quot;user-hover&quot; rel=&quot;zjshen&quot;&gt;zjshen&lt;/a&gt; for review and comments. Yes. there are more places need to be synchronized. Beside two places mentioned above, write() should also be synchronized. Also, for loadProperty(), replacing synchronized method with fine-grained synchronized block which should minimize the performance impact of adding synchronization here. Fix them in v2 patch.&lt;/p&gt;</comment>
                            <comment id="14199728" author="hadoopqa" created="Thu, 6 Nov 2014 03:51:50 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12679770/HADOOP-11274-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12679770/HADOOP-11274-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision e4b4901.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5040//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5040//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5040//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5040//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14200552" author="zjshen" created="Thu, 6 Nov 2014 17:55:29 +0000"  >&lt;p&gt;+1  the second patch looks good to me&lt;/p&gt;</comment>
                            <comment id="14200609" author="jingzhao" created="Thu, 6 Nov 2014 18:32:41 +0000"  >&lt;p&gt;Thanks for the fix, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junping_du&quot; class=&quot;user-hover&quot; rel=&quot;junping_du&quot;&gt;junping_du&lt;/a&gt;! One more minor comment is that can we move the following out of the &quot;other&quot;&apos;s monitor? In this way we can avoid in the future some careless code takes these two locks in reverse order.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+      &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt;(Configuration.class) {
+        REGISTRY.put(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14201235" author="jingzhao" created="Thu, 6 Nov 2014 23:52:04 +0000"  >&lt;p&gt;Since the change is simple, update the patch for &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junping_du&quot; class=&quot;user-hover&quot; rel=&quot;junping_du&quot;&gt;junping_du&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14201250" author="zjshen" created="Fri, 7 Nov 2014 00:01:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;One more minor comment is that can we move the following out of the &quot;other&quot;&apos;s monitor? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It makes sense. Thought the &lt;tt&gt;synchronized(Configuration.class)&lt;/tt&gt; are just used in two constructors no, let&apos;s keep cautious to avoid potential dead lock. +1&lt;/p&gt;</comment>
                            <comment id="14201316" author="hadoopqa" created="Fri, 7 Nov 2014 00:52:13 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12680005/HADOOP-11274.003.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12680005/HADOOP-11274.003.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 75b820c.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5044//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5044//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5044//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5044//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14201331" author="hudson" created="Fri, 7 Nov 2014 01:01:11 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-trunk-Commit #6471 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/6471/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/6471/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11274&quot; title=&quot;ConcurrentModificationException in Configuration Copy Constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11274&quot;&gt;&lt;del&gt;HADOOP-11274&lt;/del&gt;&lt;/a&gt;. ConcurrentModificationException in Configuration Copy Constructor. Contributed by Junping Du. (jing9: rev 16b34824673f5a50d464727b8fad98470e5e984a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/conf/Configuration.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14201342" author="jingzhao" created="Fri, 7 Nov 2014 01:04:42 +0000"  >&lt;p&gt;I&apos;ve committed this to trunk, branch-2 and branch-2.6. Thanks to Junping for the contribution and Zhijie for the review!&lt;/p&gt;</comment>
                            <comment id="14201355" author="ashutoshc" created="Fri, 7 Nov 2014 01:14:20 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jingzhao&quot; class=&quot;user-hover&quot; rel=&quot;jingzhao&quot;&gt;jingzhao&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junping_du&quot; class=&quot;user-hover&quot; rel=&quot;junping_du&quot;&gt;junping_du&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjshen&quot; class=&quot;user-hover&quot; rel=&quot;zjshen&quot;&gt;zjshen&lt;/a&gt; for quick turn around on this one. Appreciated !&lt;/p&gt;</comment>
                            <comment id="14201434" author="vinodkv" created="Fri, 7 Nov 2014 02:09:16 +0000"  >&lt;p&gt;I don&apos;t know the behavior of locking this in a constructor, but assuming so, I think there is a deadlock already.&lt;/p&gt;


&lt;p&gt;Thread 1: Copy constructor takes lock on object 2, and then calls setQuietly which waits on locking on itself&lt;br/&gt;
Thread 2: Same but the locking in reverse order.&lt;/p&gt;</comment>
                            <comment id="14201458" author="jingzhao" created="Fri, 7 Nov 2014 02:27:37 +0000"  >&lt;p&gt;Oops, I did not notice that setQuietly also takes the lock. The deadlock looks very hard to hit though, since the two configuration objects need to use each other for construction. However, considering this is a very critical part of the code, maybe we should revert the patch from trunk, branch-2 and branch-2.6 before we have a clear solution.&lt;/p&gt;</comment>
                            <comment id="14201461" author="gopalv" created="Fri, 7 Nov 2014 02:29:57 +0000"  >&lt;p&gt;Can you use an object before constructors are complete?&lt;/p&gt;</comment>
                            <comment id="14201476" author="jingzhao" created="Fri, 7 Nov 2014 02:37:46 +0000"  >&lt;p&gt;I&apos;ve reverted the patch.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can you use an object before constructors are complete?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No. But we need to take a more careful check of the current code I guess.&lt;/p&gt;</comment>
                            <comment id="14201477" author="vinodkv" created="Fri, 7 Nov 2014 02:38:29 +0000"  >&lt;p&gt;Tx for the clarification Jing, yes, my analysis is wrong.&lt;/p&gt;

&lt;p&gt;Still, locking the entire object for updateResources is plain bad along with locking during read and write conf operations. We should NOT be making these changes without careful analysis and testing - this Configuration class is the center piece of ten&apos;s of projects.&lt;/p&gt;</comment>
                            <comment id="14201481" author="hudson" created="Fri, 7 Nov 2014 02:41:07 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-trunk-Commit #6474 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/6474/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/6474/&lt;/a&gt;)&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11274&quot; title=&quot;ConcurrentModificationException in Configuration Copy Constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11274&quot;&gt;&lt;del&gt;HADOOP-11274&lt;/del&gt;&lt;/a&gt;. ConcurrentModificationException in Configuration Copy Constructor. Contributed by Junping Du.&quot; (jing9: rev ba0a42cf678f1bb53c2ad22e766b3b1a07b3800b)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/conf/Configuration.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14201737" author="djp" created="Fri, 7 Nov 2014 07:38:35 +0000"  >&lt;p&gt;Thanks for comments, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vinodkv&quot; class=&quot;user-hover&quot; rel=&quot;vinodkv&quot;&gt;vinodkv&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jingzhao&quot; class=&quot;user-hover&quot; rel=&quot;jingzhao&quot;&gt;jingzhao&lt;/a&gt;!&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The deadlock looks very hard to hit though, since the two configuration objects need to use each other for construction.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is not hard to hit but something never should happen. From Java spec, only the thread that creates an object should have access to it while it is being constructed. No thread should use an object being constructed to create an object already constructed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Still, locking the entire object for updateResources is plain bad along with locking during read and write conf operations. We should NOT be making these changes without careful analysis and testing - this Configuration class is the center piece of ten&apos;s of projects.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agree there is performance impact risk here. May be replace the object synchronization with read/write lock (and with different monitor object for different share resources) so that multiple reading thread won&apos;t block each other?&lt;/p&gt;</comment>
                            <comment id="14201758" author="gtcarrera9" created="Fri, 7 Nov 2014 07:55:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;May be replace the object synchronization with read/write lock (and with different monitor object for different share resources) so that multiple reading thread won&apos;t block each other?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agree. When concurrent read is frequent, a read-write lock would alleviate the performance degradation. However, maybe we would like to comprehensively understand the situation here before take any further action? &lt;/p&gt;</comment>
                            <comment id="14201953" author="hudson" created="Fri, 7 Nov 2014 11:42:38 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Yarn-trunk #736 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/736/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/736/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11274&quot; title=&quot;ConcurrentModificationException in Configuration Copy Constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11274&quot;&gt;&lt;del&gt;HADOOP-11274&lt;/del&gt;&lt;/a&gt;. ConcurrentModificationException in Configuration Copy Constructor. Contributed by Junping Du. (jing9: rev 16b34824673f5a50d464727b8fad98470e5e984a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/conf/Configuration.java&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11274&quot; title=&quot;ConcurrentModificationException in Configuration Copy Constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11274&quot;&gt;&lt;del&gt;HADOOP-11274&lt;/del&gt;&lt;/a&gt;. ConcurrentModificationException in Configuration Copy Constructor. Contributed by Junping Du.&quot; (jing9: rev ba0a42cf678f1bb53c2ad22e766b3b1a07b3800b)&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/conf/Configuration.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14202076" author="hudson" created="Fri, 7 Nov 2014 14:18:53 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Hdfs-trunk #1926 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1926/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1926/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11274&quot; title=&quot;ConcurrentModificationException in Configuration Copy Constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11274&quot;&gt;&lt;del&gt;HADOOP-11274&lt;/del&gt;&lt;/a&gt;. ConcurrentModificationException in Configuration Copy Constructor. Contributed by Junping Du. (jing9: rev 16b34824673f5a50d464727b8fad98470e5e984a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/conf/Configuration.java&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11274&quot; title=&quot;ConcurrentModificationException in Configuration Copy Constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11274&quot;&gt;&lt;del&gt;HADOOP-11274&lt;/del&gt;&lt;/a&gt;. ConcurrentModificationException in Configuration Copy Constructor. Contributed by Junping Du.&quot; (jing9: rev ba0a42cf678f1bb53c2ad22e766b3b1a07b3800b)&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/conf/Configuration.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14202150" author="hudson" created="Fri, 7 Nov 2014 15:25:28 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk #1950 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1950/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1950/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11274&quot; title=&quot;ConcurrentModificationException in Configuration Copy Constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11274&quot;&gt;&lt;del&gt;HADOOP-11274&lt;/del&gt;&lt;/a&gt;. ConcurrentModificationException in Configuration Copy Constructor. Contributed by Junping Du. (jing9: rev 16b34824673f5a50d464727b8fad98470e5e984a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/conf/Configuration.java&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11274&quot; title=&quot;ConcurrentModificationException in Configuration Copy Constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11274&quot;&gt;&lt;del&gt;HADOOP-11274&lt;/del&gt;&lt;/a&gt;. ConcurrentModificationException in Configuration Copy Constructor. Contributed by Junping Du.&quot; (jing9: rev ba0a42cf678f1bb53c2ad22e766b3b1a07b3800b)&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/conf/Configuration.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14203028" author="vinodkv" created="Sat, 8 Nov 2014 00:36:21 +0000"  >&lt;p&gt;Working on this to take a light-handed approach instead of global locks: Making updatedResources a ConcurrentHashMap. The reasons why this is sufficient are&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The updatedResources is only used in displays to show the lineage of the configuration properties&lt;/li&gt;
	&lt;li&gt;Further, the lineage information is useful to distinguish which files the properties are coming from: yarn-site.xml vs core-site.xml vs programmatic set. Multiple programmatic set calls still imply a programmatic lineage.&lt;/li&gt;
	&lt;li&gt;Even in the non-concurrent updates case, once the clone is done, all future updates in the old object are not tracked and rightly so. Consequently, there is no reason to have a prefect snapshot during the clone.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Overall, we don&apos;t need the updatedResources snapshot during copy to be strictly consistent - making it ConcurrentHashMap should be good enough.&lt;/p&gt;</comment>
                            <comment id="14203041" author="gtcarrera9" created="Sat, 8 Nov 2014 00:45:26 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vinodkv&quot; class=&quot;user-hover&quot; rel=&quot;vinodkv&quot;&gt;vinodkv&lt;/a&gt;, the solution looks good to me. Although the new implementation is not linearizable, I agree that under our current use cases this would be fine (eventual consistency is sufficient here, I believe). &lt;/p&gt;</comment>
                            <comment id="14203108" author="hadoopqa" created="Sat, 8 Nov 2014 01:38:39 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12680335/HADOOP-11274-v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12680335/HADOOP-11274-v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 4a114dd.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-common:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.ipc.TestDecayRpcScheduler&lt;br/&gt;
                  org.apache.hadoop.http.TestGlobalFilter&lt;br/&gt;
                  org.apache.hadoop.http.TestPathFilter&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestViewFileSystemDelegation&lt;br/&gt;
                  org.apache.hadoop.io.compress.TestCompressionStreamReuse&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestFcPermissionsLocalFs&lt;br/&gt;
                  org.apache.hadoop.ipc.TestRPCCompatibility&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestViewFsURIs&lt;br/&gt;
                  org.apache.hadoop.fs.shell.TestCopy&lt;br/&gt;
                  org.apache.hadoop.ha.TestHealthMonitor&lt;br/&gt;
                  org.apache.hadoop.ha.TestFailoverController&lt;br/&gt;
                  org.apache.hadoop.security.TestGroupsCaching&lt;br/&gt;
                  org.apache.hadoop.fs.permission.TestFsPermission&lt;br/&gt;
                  org.apache.hadoop.http.TestHttpServer&lt;br/&gt;
                  org.apache.hadoop.security.TestAuthenticationFilter&lt;br/&gt;
                  org.apache.hadoop.security.token.delegation.web.TestDelegationTokenAuthenticationHandlerWithMocks&lt;br/&gt;
                  org.apache.hadoop.crypto.key.TestKeyProviderFactory&lt;br/&gt;
                  org.apache.hadoop.conf.TestDeprecatedKeys&lt;br/&gt;
                  org.apache.hadoop.security.authorize.TestProxyUsers&lt;br/&gt;
                  org.apache.hadoop.security.token.delegation.web.TestDelegationTokenManager&lt;br/&gt;
                  org.apache.hadoop.conf.TestReconfiguration&lt;br/&gt;
                  org.apache.hadoop.net.TestStaticMapping&lt;br/&gt;
                  org.apache.hadoop.fs.TestDU&lt;br/&gt;
                  org.apache.hadoop.fs.contract.localfs.TestLocalFSContractSeek&lt;br/&gt;
                  org.apache.hadoop.fs.TestTruncatedInputBug&lt;br/&gt;
                  org.apache.hadoop.util.TestGenericOptionsParser&lt;br/&gt;
                  org.apache.hadoop.crypto.key.TestKeyShell&lt;br/&gt;
                  org.apache.hadoop.io.TestWritable&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestViewfsFileStatus&lt;br/&gt;
                  org.apache.hadoop.fs.TestTrash&lt;br/&gt;
                  org.apache.hadoop.ha.TestSshFenceByTcpPort&lt;br/&gt;
                  org.apache.hadoop.security.authorize.TestProxyServers&lt;br/&gt;
                  org.apache.hadoop.security.alias.TestCredShell&lt;br/&gt;
                  org.apache.hadoop.ipc.TestIdentityProviders&lt;br/&gt;
                  org.apache.hadoop.ipc.TestIPCServerResponder&lt;br/&gt;
                  org.apache.hadoop.ha.TestShellCommandFencer&lt;br/&gt;
                  org.apache.hadoop.fs.shell.TestCopyPreserveFlag&lt;br/&gt;
                  org.apache.hadoop.cli.TestCLI&lt;br/&gt;
                  org.apache.hadoop.http.TestSSLHttpServer&lt;br/&gt;
                  org.apache.hadoop.io.compress.zlib.TestZlibCompressorDecompressor&lt;br/&gt;
                  org.apache.hadoop.fs.contract.localfs.TestLocalFSContractOpen&lt;br/&gt;
                  org.apache.hadoop.crypto.TestCryptoStreamsForLocalFS&lt;br/&gt;
                  org.apache.hadoop.fs.contract.ftp.TestFTPContractOpen&lt;br/&gt;
                  org.apache.hadoop.fs.shell.TestCount&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestViewFsTrash&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestFcCreateMkdirLocalFs&lt;br/&gt;
                  org.apache.hadoop.http.TestServletFilter&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestFcMainOperationsLocalFs&lt;br/&gt;
                  org.apache.hadoop.ha.TestZKFailoverController&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestFSMainOperationsLocalFileSystem&lt;br/&gt;
                  org.apache.hadoop.conf.TestConfigurationDeprecation&lt;br/&gt;
                  org.apache.hadoop.fs.TestFilterFileSystem&lt;br/&gt;
                  org.apache.hadoop.security.ssl.TestSSLFactory&lt;br/&gt;
                  org.apache.hadoop.service.TestServiceLifecycle&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestViewFileSystemDelegationTokenSupport&lt;br/&gt;
                  org.apache.hadoop.fs.shell.TestXAttrCommands&lt;br/&gt;
                  org.apache.hadoop.ipc.TestMiniRPCBenchmark&lt;br/&gt;
                  org.apache.hadoop.io.file.tfile.TestTFileSeek&lt;br/&gt;
                  org.apache.hadoop.util.TestGenericsUtil&lt;br/&gt;
                  org.apache.hadoop.io.serializer.TestWritableSerialization&lt;br/&gt;
                  org.apache.hadoop.crypto.key.TestKeyProvider&lt;br/&gt;
                  org.apache.hadoop.ipc.TestRPC&lt;br/&gt;
                  org.apache.hadoop.io.TestGenericWritable&lt;br/&gt;
                  org.apache.hadoop.conf.TestConfServlet&lt;br/&gt;
                  org.apache.hadoop.fs.contract.rawlocal.TestRawlocalContractSeek&lt;br/&gt;
                  org.apache.hadoop.ipc.TestProtoBufRpc&lt;br/&gt;
                  org.apache.hadoop.security.TestWhitelistBasedResolver&lt;br/&gt;
                  org.apache.hadoop.ipc.TestSocketFactory&lt;br/&gt;
                  org.apache.hadoop.security.alias.TestCredentialProviderFactory&lt;br/&gt;
                  org.apache.hadoop.ipc.TestIPC&lt;br/&gt;
                  org.apache.hadoop.ipc.TestMultipleProtocolServer&lt;br/&gt;
                  org.apache.hadoop.ipc.TestWeightedRoundRobinMultiplexer&lt;br/&gt;
                  org.apache.hadoop.security.token.delegation.TestZKDelegationTokenSecretManager&lt;br/&gt;
                  org.apache.hadoop.fs.TestFsShellReturnCode&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestViewFileSystemLocalFileSystem&lt;br/&gt;
                  org.apache.hadoop.net.TestScriptBasedMappingWithDependency&lt;br/&gt;
                  org.apache.hadoop.fs.contract.rawlocal.TestRawlocalContractOpen&lt;br/&gt;
                  org.apache.hadoop.util.hash.TestHash&lt;br/&gt;
                  org.apache.hadoop.ipc.TestSaslRPC&lt;br/&gt;
                  org.apache.hadoop.net.TestSwitchMapping&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestViewFsWithAuthorityLocalFs&lt;br/&gt;
                  org.apache.hadoop.http.lib.TestStaticUserWebFilter&lt;br/&gt;
                  org.apache.hadoop.security.TestShellBasedIdMapping&lt;br/&gt;
                  org.apache.hadoop.ipc.TestRPCCallBenchmark&lt;br/&gt;
                  org.apache.hadoop.io.serializer.avro.TestAvroSerialization&lt;br/&gt;
                  org.apache.hadoop.fs.shell.TestMove&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestViewFsConfig&lt;br/&gt;
                  org.apache.hadoop.security.TestCompositeGroupMapping&lt;br/&gt;
                  org.apache.hadoop.security.authorize.TestServiceAuthorization&lt;br/&gt;
                  org.apache.hadoop.net.TestTableMapping&lt;br/&gt;
                  org.apache.hadoop.security.TestDoAsEffectiveUser&lt;br/&gt;
                  org.apache.hadoop.ha.TestZKFailoverControllerStress&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestViewFileSystemWithAuthorityLocalFileSystem&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestChRootedFileSystem&lt;br/&gt;
                  org.apache.hadoop.http.TestHttpCookieFlag&lt;br/&gt;
                  org.apache.hadoop.security.TestGroupFallback&lt;br/&gt;
                  org.apache.hadoop.security.token.delegation.web.TestWebDelegationToken&lt;br/&gt;
                  org.apache.hadoop.net.TestScriptBasedMapping&lt;br/&gt;
                  org.apache.hadoop.fs.viewfs.TestViewFsLocalFs&lt;br/&gt;
                  org.apache.hadoop.fs.TestLocalFileSystem&lt;br/&gt;
                  org.apache.hadoop.io.TestSequenceFileSerialization&lt;br/&gt;
                  org.apache.hadoop.conf.TestConfiguration&lt;br/&gt;
                  org.apache.hadoop.fs.shell.TestAclCommands&lt;br/&gt;
                  org.apache.hadoop.security.TestSecurityUtil&lt;br/&gt;
                  org.apache.hadoop.io.TestDefaultStringifier&lt;br/&gt;
                  org.apache.hadoop.ipc.TestFairCallQueue&lt;br/&gt;
                  org.apache.hadoop.io.file.tfile.TestTFileSeqFileComparison&lt;br/&gt;
                  org.apache.hadoop.io.compress.TestCodec&lt;br/&gt;
                  org.apache.hadoop.io.serializer.TestSerializationFactory&lt;br/&gt;
                  org.apache.hadoop.security.TestLdapGroupsMapping&lt;br/&gt;
                  org.apache.hadoop.io.compress.TestCodecFactory&lt;br/&gt;
                  org.apache.hadoop.ipc.TestServer&lt;/p&gt;

&lt;p&gt;                                      The following test timeouts occurred in hadoop-common-project/hadoop-common:&lt;/p&gt;

&lt;p&gt;org.apache.hadoop.fs.TestFileSystemCaching&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5050//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5050//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5050//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5050//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14203190" author="vinodkv" created="Sat, 8 Nov 2014 03:37:29 +0000"  >&lt;p&gt;That, my friends, is why you don&apos;t mess with Hadoop configuration!&lt;/p&gt;

&lt;p&gt;Didn&apos;t realize ConcurrentHashMap doesn&apos;t accept nulls. And the old HashMap based Configuration was masking a subtle bug, fixed that now.&lt;/p&gt;</comment>
                            <comment id="14203213" author="hadoopqa" created="Sat, 8 Nov 2014 04:32:00 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12680357/HADOOP-11274-v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12680357/HADOOP-11274-v4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 4a114dd.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5051//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5051//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5051//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5051//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14203326" author="djp" created="Sat, 8 Nov 2014 09:03:56 +0000"  >&lt;p&gt;Thanks for taking this, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vinodkv&quot; class=&quot;user-hover&quot; rel=&quot;vinodkv&quot;&gt;vinodkv&lt;/a&gt;! The way of using ConcurrentHashMap looks fine especially we don&apos;t want to spend time to evaluate performance impact on locking whole conf object. &lt;br/&gt;
The patch looks good to me. However, one thing need to be mentioned here is the Set of &quot;finalParameters&quot; meet the same situation as &quot;updatingResource&quot; that we should fix. This is get fixed in v2 patch where we were adding synchronized block in loadProperty(). If we want to get rid of any explicit lock in loading configuration, another way is to use Collections.synchronizedSet() to turn finalParameters into thread-safe.&lt;br/&gt;
Also, some minor indentation issues in Configuration(Configuration other).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt;(other) {
+
+     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.resources = (ArrayList&amp;lt;Resource&amp;gt;) other.resources.clone();
...
-     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.updatingResource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[]&amp;gt;(other.updatingResource);
+      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.updatingResource =
+          &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConcurrentHashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[]&amp;gt;(other.updatingResource);
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.finalParameters = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;(other.finalParameters);
+     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.classLoader = other.getClassLoader();
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14203682" author="acmurthy" created="Sat, 8 Nov 2014 23:28:48 +0000"  >&lt;p&gt;I&apos;m concerned this is too late to make this change to 2.6; particularly given that this has been around for a long time. Moving it to 2.7.&lt;/p&gt;</comment>
                            <comment id="14342453" author="vinodkv" created="Sun, 1 Mar 2015 20:36:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11209&quot; title=&quot;Configuration#updatingResource/finalParameters are not thread-safe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11209&quot;&gt;&lt;del&gt;HADOOP-11209&lt;/del&gt;&lt;/a&gt; got filed after this ticket but went in before. Nothing to do here - there is a small bit of lock cleanup left in my patch, but not of much value in isolation. Closing this as a dup.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12748986">HADOOP-11209</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13146706">HADOOP-15331</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12753481">HIVE-8760</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12679770" name="HADOOP-11274-v2.patch" size="5493" author="junping_du" created="Thu, 6 Nov 2014 02:50:31 +0000"/>
                            <attachment id="12680335" name="HADOOP-11274-v3.patch" size="3614" author="vinodkv" created="Sat, 8 Nov 2014 00:36:21 +0000"/>
                            <attachment id="12680357" name="HADOOP-11274-v4.patch" size="5258" author="vinodkv" created="Sat, 8 Nov 2014 03:37:29 +0000"/>
                            <attachment id="12680005" name="HADOOP-11274.003.patch" size="5409" author="jingzhao" created="Thu, 6 Nov 2014 23:52:04 +0000"/>
                            <attachment id="12679557" name="HADOOP-11274.patch" size="2385" author="junping_du" created="Wed, 5 Nov 2014 16:29:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 38 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2206v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327583">2.7.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>