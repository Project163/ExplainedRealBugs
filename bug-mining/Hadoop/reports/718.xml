<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:42:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-8901] GZip and Snappy support may not work without unversioned libraries</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-8901</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;Currently, we use &lt;tt&gt;dlopen&lt;/tt&gt; to open &lt;tt&gt;libz.so&lt;/tt&gt; and &lt;tt&gt;libsnappy.so&lt;/tt&gt;, to get Gzip and Snappy support, respectively.&lt;/p&gt;

&lt;p&gt;However, this is not correct; we should be dlopening &lt;tt&gt;libsnappy.so.1&lt;/tt&gt; instead.  The versionless form of the shared library is not commonly installed except by development packages.  Also, we may run into subtle compatibility problems if a new version of libsnappy comes out.&lt;/p&gt;

&lt;p&gt;Thanks to Brandon Vargo for reporting this bug.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12610910">HADOOP-8901</key>
            <summary>GZip and Snappy support may not work without unversioned libraries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cmccabe">Colin McCabe</assignee>
                                    <reporter username="cmccabe">Colin McCabe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Oct 2012 00:12:06 +0000</created>
                <updated>Wed, 3 Sep 2014 23:11:06 +0000</updated>
                            <resolved>Tue, 23 Oct 2012 17:23:57 +0000</resolved>
                                    <version>2.0.3-alpha</version>
                                    <fixVersion>2.0.3-alpha</fixVersion>
                                    <component>native</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="13471978" author="cmccabe" created="Tue, 9 Oct 2012 00:25:14 +0000"  >&lt;p&gt;I tested this patch on CentOS 5.8 and verified that I could run TestDFSIO without &lt;tt&gt;libz.so&lt;/tt&gt; present (but with &lt;tt&gt;libz.so.1&lt;/tt&gt; present), with &lt;tt&gt;mapred.map.output.compress.codec&lt;/tt&gt; set to &lt;tt&gt;org.apache.hadoop.io.compress.GzipCodec&lt;/tt&gt;. &lt;/p&gt;</comment>
                            <comment id="13471981" author="cmccabe" created="Tue, 9 Oct 2012 00:25:59 +0000"  >&lt;p&gt;Note that this is a regression introduced by the conversion from automake to cmake.&lt;/p&gt;</comment>
                            <comment id="13471989" author="tlipcon" created="Tue, 9 Oct 2012 00:32:02 +0000"  >&lt;p&gt;This seems to incorporate &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-6069&quot; title=&quot;Remove explicit dynamic loading of libz in native code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-6069&quot;&gt;&lt;del&gt;HADOOP-6069&lt;/del&gt;&lt;/a&gt;, which, the first time it was floated, had some objections. So rather than sneaking that change into this bug fix, we should have this just be a fix for the cmake regression, and use &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-6069&quot; title=&quot;Remove explicit dynamic loading of libz in native code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-6069&quot;&gt;&lt;del&gt;HADOOP-6069&lt;/del&gt;&lt;/a&gt; if we want to make libz non-dynamic.&lt;/p&gt;</comment>
                            <comment id="13472000" author="cmccabe" created="Tue, 9 Oct 2012 00:41:57 +0000"  >&lt;p&gt;I also tested this with snappy.&lt;/p&gt;</comment>
                            <comment id="13472011" author="adi2" created="Tue, 9 Oct 2012 00:54:10 +0000"  >&lt;p&gt;I agree with Todd, let&apos;s just fix the regression rather than adding zlib as a link-time dependency.&lt;/p&gt;</comment>
                            <comment id="13472013" author="cmccabe" created="Tue, 9 Oct 2012 00:55:42 +0000"  >&lt;p&gt;OK, here is a verison that doesn&apos;t remove the dlopen for libz.&lt;/p&gt;</comment>
                            <comment id="13472017" author="hadoopqa" created="Tue, 9 Oct 2012 01:01:53 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12548334/HADOOP-8901.001.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12548334/HADOOP-8901.001.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1580//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1580//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1580//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1580//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13472019" author="cmccabe" created="Tue, 9 Oct 2012 01:03:23 +0000"  >&lt;p&gt;Tests are not provided because this is a build change. &lt;/p&gt;</comment>
                            <comment id="13472038" author="hadoopqa" created="Tue, 9 Oct 2012 01:24:47 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12548340/HADOOP-8901.002.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12548340/HADOOP-8901.002.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1582//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1582//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1582//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1582//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13472045" author="tlipcon" created="Tue, 9 Oct 2012 01:30:29 +0000"  >&lt;p&gt;Can cmake currently build on Windows and Mac? If so, I think this would break that, since the Snappy and libz libraries wouldn&apos;t be .so.1 &amp;#8211; instead being .dll or .dylib or something.&lt;/p&gt;</comment>
                            <comment id="13472149" author="cmccabe" created="Tue, 9 Oct 2012 05:31:23 +0000"  >&lt;p&gt;Windows doesn&apos;t even have &lt;tt&gt;dlopen&lt;/tt&gt; at all.  Yet another reason to implement &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-6069&quot; title=&quot;Remove explicit dynamic loading of libz in native code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-6069&quot;&gt;&lt;del&gt;HADOOP-6069&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Anyway, I will add a platform check.  I could take a stab at doing the right thing on Mac OS X, but someone else would need to confirm, because I don&apos;t have access to a Mac.  It might be better to file a follow-on JIRA for that.&lt;/p&gt;</comment>
                            <comment id="13472184" author="cmccabe" created="Tue, 9 Oct 2012 06:50:34 +0000"  >&lt;p&gt;Multi-platform-ish version.&lt;/p&gt;</comment>
                            <comment id="13472191" author="hadoopqa" created="Tue, 9 Oct 2012 07:15:03 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12548366/HADOOP-8901.003.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12548366/HADOOP-8901.003.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1587//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1587//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1587//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1587//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13473547" author="cmccabe" created="Wed, 10 Oct 2012 20:45:54 +0000"  >&lt;p&gt;The latest patch should address the portability concerns.&lt;/p&gt;</comment>
                            <comment id="13475345" author="tlipcon" created="Fri, 12 Oct 2012 20:49:32 +0000"  >&lt;p&gt;+1, will commit this this afternoon unless there are any comments.&lt;/p&gt;</comment>
                            <comment id="13476295" author="tlipcon" created="Mon, 15 Oct 2012 17:44:43 +0000"  >&lt;p&gt;Committed to branch-2 and trunk, thanks Colin.&lt;/p&gt;</comment>
                            <comment id="13476301" author="hudson" created="Mon, 15 Oct 2012 17:54:25 +0000"  >&lt;p&gt;Integrated in Hadoop-Hdfs-trunk-Commit #2923 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/2923/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/2923/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8901&quot; title=&quot;GZip and Snappy support may not work without unversioned libraries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8901&quot;&gt;&lt;del&gt;HADOOP-8901&lt;/del&gt;&lt;/a&gt;. GZip and Snappy support may not work without unversioned libraries. Contributed by Colin Patrick McCabe. (Revision 1398416)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
todd : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398416&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/CMakeLists.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13476302" author="hudson" created="Mon, 15 Oct 2012 17:55:39 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk-Commit #2861 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Common-trunk-Commit/2861/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Common-trunk-Commit/2861/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8901&quot; title=&quot;GZip and Snappy support may not work without unversioned libraries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8901&quot;&gt;&lt;del&gt;HADOOP-8901&lt;/del&gt;&lt;/a&gt;. GZip and Snappy support may not work without unversioned libraries. Contributed by Colin Patrick McCabe. (Revision 1398416)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
todd : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398416&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/CMakeLists.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13476336" author="hudson" created="Mon, 15 Oct 2012 18:41:50 +0000"  >&lt;p&gt;Integrated in Hadoop-Mapreduce-trunk-Commit #2884 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/2884/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/2884/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8901&quot; title=&quot;GZip and Snappy support may not work without unversioned libraries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8901&quot;&gt;&lt;del&gt;HADOOP-8901&lt;/del&gt;&lt;/a&gt;. GZip and Snappy support may not work without unversioned libraries. Contributed by Colin Patrick McCabe. (Revision 1398416)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
todd : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398416&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/CMakeLists.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13477855" author="hudson" created="Wed, 17 Oct 2012 13:21:40 +0000"  >&lt;p&gt;Integrated in Hadoop-Mapreduce-trunk #1228 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1228/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1228/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8901&quot; title=&quot;GZip and Snappy support may not work without unversioned libraries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8901&quot;&gt;&lt;del&gt;HADOOP-8901&lt;/del&gt;&lt;/a&gt;. GZip and Snappy support may not work without unversioned libraries. Contributed by Colin Patrick McCabe. (Revision 1398416)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
todd : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398416&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398416&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/CMakeLists.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13481863" author="hsn" created="Mon, 22 Oct 2012 22:15:20 +0000"  >&lt;p&gt;This patch broke it on BSD because there is /lib/libz.so.5, not so.1 as you expect. Why not simple use &quot;find_package(ZLIB 1 REQUIRED)&quot; ?&lt;/p&gt;

&lt;p&gt;this works on bsd nicely:  Found ZLIB: /usr/lib/libz.so (found suitable version &quot;1.2.3&quot;, required is &quot;1&quot;)&lt;/p&gt;</comment>
                            <comment id="13481866" author="hsn" created="Mon, 22 Oct 2012 22:19:54 +0000"  >&lt;p&gt;on freebsd there is no /lib/libz.so and still cmake handles it nicely with find_package 1. This patch seems unnecessary, maybe bug reporter has outdated cmake.&lt;/p&gt;

&lt;p&gt;ponto:(crawler)hadoop-common-project/hadoop-common&amp;gt;ls -l /lib/libz*&lt;br/&gt;
&lt;del&gt;r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 root  wheel    85328 Jun 24 12:41 /lib/libz.so.5&lt;br/&gt;
&lt;del&gt;r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 root  wheel   275040 Jun 24 12:41 /lib/libzfs.so.2&lt;br/&gt;
&lt;del&gt;r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 root  wheel  1347800 Jun 24 12:41 /lib/libzpool.so.2&lt;br/&gt;
ponto:(crawler)hadoop-common-project/hadoop-common&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13481868" author="adi2" created="Mon, 22 Oct 2012 22:23:31 +0000"  >&lt;p&gt;Radim,&lt;/p&gt;

&lt;p&gt;Thanks for noting this issue! With &lt;tt&gt;find_package(ZLIB 1 REQUIRED)&lt;/tt&gt; , what path does dlopen end up using on BSD to open the libz.so?  If the pathname is &lt;tt&gt;&quot;/usr/lib/libz.so&quot;&lt;/tt&gt; then there&apos;s a dependency on that symlink pointing to the correct library.&lt;/p&gt;

&lt;p&gt;I&apos;ll test your suggestion on Linux to see if it has the needed behavior &amp;#8211; in order to support Linux systems without a &lt;tt&gt;&quot;libz.so&quot;&lt;/tt&gt; symlink, we need to ensure that dlopen gets a pathname like &lt;tt&gt;&quot;libz.so.1&quot;&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Also, just out of curiosity, what BSD are you testing this on?&lt;/p&gt;</comment>
                            <comment id="13481881" author="hsn" created="Mon, 22 Oct 2012 22:34:55 +0000"  >&lt;p&gt;I am testing on FreeBSD 8.3 64bit. There is no symlink as you can see zlibrary is sitting in /lib&lt;/p&gt;

&lt;p&gt;in config.h on bsd is:&lt;br/&gt;
#define HADOOP_ZLIB_LIBRARY &quot;libz.so&quot;&lt;/p&gt;</comment>
                            <comment id="13481884" author="hsn" created="Mon, 22 Oct 2012 22:37:02 +0000"  >&lt;p&gt;just discovered that on bsd is a symlink:  /usr/lib/libz.so -&amp;gt; /lib/libz.so.5&lt;/p&gt;</comment>
                            <comment id="13481890" author="adi2" created="Mon, 22 Oct 2012 22:41:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;ll test your suggestion on Linux to see if it has the needed behavior&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I tested with&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;--- a/hadoop-common-project/hadoop-common/src/CMakeLists.txt
+++ b/hadoop-common-project/hadoop-common/src/CMakeLists.txt
@@ -55,7 +55,7 @@ if (NOT GENERATED_JAVAH)
     MESSAGE(FATAL_ERROR &quot;You must set the cmake variable GENERATED_JAVAH&quot;)
 endif (NOT GENERATED_JAVAH)
 find_package(JNI REQUIRED)
-find_package(ZLIB REQUIRED)
+find_package(ZLIB 1 REQUIRED)
 
 set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} -g -Wall -O2&quot;)
 set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} -D_REENTRANT -D_FILE_OFFSET_BITS=64&quot;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and found that the resulting value for &lt;tt&gt;HADOOP_ZLIB_LIBRARY&lt;/tt&gt; remained &lt;tt&gt;&quot;libz.so&quot;&lt;/tt&gt;.  This doesn&apos;t work on standard Linux installs because &lt;tt&gt;dlopen&lt;/tt&gt; uses the string it is passed as an exact filename match, and without the &lt;tt&gt;-dev&lt;/tt&gt; packages, Linux installations do not have &lt;tt&gt;libfoo.so&lt;/tt&gt; symlinks installed.&lt;/p&gt;

&lt;p&gt;Colin&apos;s fix which was committed on this Jira addresses the problem by ensuring that &lt;tt&gt;HADOOP_ZLIB_LIBRARY&lt;/tt&gt; expands to a string that specifies the library ABI version, &lt;tt&gt;&quot;libz.so.1&quot;&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;It seems like you&apos;ve actually got the same problem on BSD, but the hardcoded &quot;1&quot; breaks because BSD considers zlib to have a larger ABI revision.  Possibly this is related to an issue in the upstream Linux system where the zlib ABI number is not properly being incremented when the ABI changes &amp;#8211; certainly BSD has been much more careful / aware of such issues over the years.&lt;/p&gt;

&lt;p&gt;I think the right fix is to figure out how to have CMake determine the correct ABI revision number at build time, no?&lt;/p&gt;</comment>
                            <comment id="13481896" author="hsn" created="Mon, 22 Oct 2012 22:52:12 +0000"  >&lt;p&gt;freebsd has always -dev packages installed because bsd do not splits include and other stuff out of base packages.&lt;/p&gt;

&lt;p&gt;determining correct version number at runtime should be fine. another problem is with libsnappy, on bsd it have abi number 2 not 1&lt;/p&gt;

&lt;p&gt;ls -l /usr/local/lib/libsnappy.*&lt;br/&gt;
&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-  1 root  wheel  39776 Sep 14 13:48 /usr/local/lib/libsnappy.a&lt;br/&gt;
-rwxr-xr-x  1 root  wheel    951 Sep 14 13:48 /usr/local/lib/libsnappy.la&lt;br/&gt;
lrwxr-xr-x  1 root  wheel     14 Sep 14 13:48 /usr/local/lib/libsnappy.so -&amp;gt; libsnappy.so.2&lt;br/&gt;
-rwxr-xr-x  1 root  wheel  37639 Sep 14 13:48 /usr/local/lib/libsnappy.so.2&lt;/p&gt;</comment>
                            <comment id="13481920" author="cmccabe" created="Mon, 22 Oct 2012 23:21:42 +0000"  >&lt;p&gt;One way to do it would be to use something like &lt;tt&gt;get_filename_component(HADOOP_ZLIB_LIBRARY ${HADOOP_ZLIB_LIBRARY} REALPATH)&lt;/tt&gt; to follow the symlinks all the way to the fully versioned library.  Then you need to strip off the minor version, which is a small bit of text manipulation.&lt;/p&gt;

&lt;p&gt;Another way would be to figure out what versions are in use on BSD and hardcode those.  Arguably, depending on a specific version is a feature not a bug, since the major version number should only be bumped when there was an incompatible zlib ABI change that could (in theory) break our code.&lt;/p&gt;

&lt;p&gt;If BSD users are convinced that the versionless variant will always be present, we could add an IF(BSD) or something to CMakeLists.txt and do it that way.  Personally I do not have enough knowledge of BSD to say if the devel packages are always installed there-- seems strange, to me.&lt;/p&gt;</comment>
                            <comment id="13482185" author="hsn" created="Tue, 23 Oct 2012 08:07:38 +0000"  >&lt;p&gt;If (BSD) seems fine. its easiest to fix it that way.&lt;/p&gt;</comment>
                            <comment id="13482243" author="hsn" created="Tue, 23 Oct 2012 10:14:50 +0000"  >&lt;p&gt;This fixes zlib on BSD but its still not enough to fix libsnappy. i could not determine why libsnappy is broken because version d2b46d18183ad70c0aad5ce278f49fbd52c88a08 works fine.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 
macro(set_find_shared_library_version LVERS)
    IF(${CMAKE_SYSTEM_NAME} MATCHES &quot;Darwin&quot;)
        # Mac OS uses .dylib
        SET(CMAKE_FIND_LIBRARY_SUFFIXES &quot;.${LVERS}.dylib&quot;)
    ELSEIF(${CMAKE_SYSTEM_NAME} MATCHES &quot;FreeBSD&quot;)
        # FreeBSD has always .so installed.
    ELSEIF(${CMAKE_SYSTEM_NAME} MATCHES &quot;Windows&quot;)
        # Windows doesn&apos;t support finding shared libraries by version.
    ELSE()
        # Most UNIX variants use .so
        SET(CMAKE_FIND_LIBRARY_SUFFIXES &quot;.so.${LVERS}&quot;)
    ENDIF()
endmacro(set_find_shared_library_version LVERS)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;on freebsd libsnappy is in /usr/local/lib and it has version 2&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;slush:(hduser)target/native&amp;gt;ls -l /usr/local/lib/libsnappy.*
-rw-r--r--  1 root  wheel  38336 Sep 18 00:17 /usr/local/lib/libsnappy.a
-rwxr-xr-x  1 root  wheel    951 Sep 18 00:17 /usr/local/lib/libsnappy.la
lrwxr-xr-x  1 root  wheel     14 Sep 18 00:17 /usr/local/lib/libsnappy.so -&amp;gt; libsnappy.so.2
-rwxr-xr-x  1 root  wheel  33767 Sep 18 00:17 /usr/local/lib/libsnappy.so.2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13482274" author="hsn" created="Tue, 23 Oct 2012 11:59:24 +0000"  >&lt;p&gt;fix for finding libraries on freebsd. Tested and it works with both zlib and snappy.&lt;/p&gt;</comment>
                            <comment id="13482286" author="hadoopqa" created="Tue, 23 Oct 2012 12:26:35 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12550445/freebsd-so.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12550445/freebsd-so.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1663//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1663//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1663//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1663//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13482460" author="hsn" created="Tue, 23 Oct 2012 16:41:48 +0000"  >&lt;p&gt;my bsd patch was committed as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8811&quot; title=&quot;Compile hadoop native library in FreeBSD&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8811&quot;&gt;&lt;del&gt;HADOOP-8811&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13482483" author="cmccabe" created="Tue, 23 Oct 2012 17:23:08 +0000"  >&lt;p&gt;Thanks, Radim.  And thanks for doing the work to get this stuff working on BSD.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12428144">HADOOP-6069</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12548334" name="HADOOP-8901.001.patch" size="9548" author="cmccabe" created="Tue, 9 Oct 2012 00:13:11 +0000"/>
                            <attachment id="12548340" name="HADOOP-8901.002.patch" size="1451" author="cmccabe" created="Tue, 9 Oct 2012 00:55:42 +0000"/>
                            <attachment id="12548366" name="HADOOP-8901.003.patch" size="2669" author="cmccabe" created="Tue, 9 Oct 2012 06:50:34 +0000"/>
                            <attachment id="12550445" name="freebsd-so.txt" size="758" author="hsn" created="Tue, 23 Oct 2012 11:59:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245709</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06cu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35014</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>native</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12323273">2.0.3-alpha</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>