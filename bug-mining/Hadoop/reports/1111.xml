<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:44:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-10442] Group look-up can cause segmentation fault when certain JNI-based mapping module is used.</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-10442</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;When JniBasedUnixGroupsNetgroupMapping or JniBasedUnixGroupsMapping is used, we get segmentation fault very often. The same system ran 2.2 for months without any problem, but as soon as upgrading to 2.3, it started crashing.  This resulted in multiple name node crashes per day.&lt;/p&gt;

&lt;p&gt;The server was running nslcd (nss-pam-ldapd-0.7.5-15.el6_3.2). We did not see this problem on the servers running sssd. &lt;/p&gt;

&lt;p&gt;There was one change in the C code and it modified the return code handling after getgrouplist() call. If the function returns 0 or a negative value less than -1, it will do realloc() instead of returning failure.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12703802">HADOOP-10442</key>
            <summary>Group look-up can cause segmentation fault when certain JNI-based mapping module is used.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kihwal">Kihwal Lee</assignee>
                                    <reporter username="kihwal">Kihwal Lee</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Mar 2014 19:22:56 +0000</created>
                <updated>Wed, 3 Sep 2014 20:39:01 +0000</updated>
                            <resolved>Thu, 27 Mar 2014 20:21:37 +0000</resolved>
                                    <version>2.3.0</version>
                    <version>2.4.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13948350" author="kihwal" created="Wed, 26 Mar 2014 19:26:04 +0000"  >&lt;p&gt;The return code handling was modified in &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10087&quot; title=&quot;UserGroupInformation.getGroupNames() fails to return primary group first when JniBasedUnixGroupsMappingWithFallback is used&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10087&quot;&gt;&lt;del&gt;HADOOP-10087&lt;/del&gt;&lt;/a&gt;. This is the only change in the JNI user-group mapping modules between 2.2 and 2.3.&lt;/p&gt;</comment>
                            <comment id="13948459" author="hadoopqa" created="Wed, 26 Mar 2014 21:03:29 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12636983/HADOOP-10442.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12636983/HADOOP-10442.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3721//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3721//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3721//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3721//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13948607" author="cnauroth" created="Wed, 26 Mar 2014 23:04:07 +0000"  >&lt;p&gt;+1 for the patch.  Thank you, Kihwal.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;-1 tests included. The patch doesn&apos;t appear to include any new or modified tests.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is not something easily covered with an automated test.  Have you been able to verify the patch manually in one your clusters that had the segfaults?&lt;/p&gt;</comment>
                            <comment id="13948832" author="kihwal" created="Thu, 27 Mar 2014 03:30:13 +0000"  >&lt;p&gt;A 2.3 NN has been running with this fix for some time.  The NN crashed every 3-5 hours before this. &lt;/p&gt;</comment>
                            <comment id="13949585" author="cnauroth" created="Thu, 27 Mar 2014 16:58:57 +0000"  >&lt;p&gt;That sounds great, Kihwal.  I think we can commit this and resolve the blocker.&lt;/p&gt;</comment>
                            <comment id="13949856" author="jeagles" created="Thu, 27 Mar 2014 19:52:10 +0000"  >&lt;p&gt;+1. Checking this into trunk, branch-2, branch-2.4&lt;/p&gt;</comment>
                            <comment id="13949862" author="hudson" created="Thu, 27 Mar 2014 20:06:49 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-trunk-Commit #5418 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/5418/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/5418/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10442&quot; title=&quot;Group look-up can cause segmentation fault when certain JNI-based mapping module is used.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10442&quot;&gt;&lt;del&gt;HADOOP-10442&lt;/del&gt;&lt;/a&gt;. Group look-up can cause segmentation fault when certain JNI-based mapping module is used. (Kihwal Lee via jeagles) (jeagles: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1582451&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1582451&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/native/src/org/apache/hadoop/security/hadoop_user_info.c&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13950125" author="cmccabe" created="Thu, 27 Mar 2014 23:27:38 +0000"  >&lt;p&gt;Thanks for this patch, Kihwal.&lt;/p&gt;

&lt;p&gt;To be honest, I find the behavior of &lt;tt&gt;getgrouplist&lt;/tt&gt; that you are seeing to be puzzling.  The man page doesn&apos;t describe any negative return codes other than -1.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;RETURN VALUE
       If the number of groups of which user is a member is less than or equal to *ngroups, then the value *ngroups is returned.

       If the user is a member of more than *ngroups groups, then getgrouplist() returns -1.  In &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; the value returned in *ngroups can  be  used  to
       resize the buffer passed to a further call getgrouplist().
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What negative return code did you see besides -1?  I guess what you&apos;re seeing is undocumented, and possibly a bug in nslcd (or the man page?)&lt;/p&gt;

&lt;p&gt;Also, looking at this more closely, I believe we mishandle the case where the user is a member of no groups.  This would be a pretty odd configuration (I wonder if it&apos;s possible?).  Just to be sure, I think we should consider getgrouplist returning 0 to be ok.&lt;/p&gt;</comment>
                            <comment id="13950607" author="hudson" created="Fri, 28 Mar 2014 11:51:20 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Yarn-trunk #523 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/523/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/523/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10442&quot; title=&quot;Group look-up can cause segmentation fault when certain JNI-based mapping module is used.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10442&quot;&gt;&lt;del&gt;HADOOP-10442&lt;/del&gt;&lt;/a&gt;. Group look-up can cause segmentation fault when certain JNI-based mapping module is used. (Kihwal Lee via jeagles) (jeagles: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1582451&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1582451&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/native/src/org/apache/hadoop/security/hadoop_user_info.c&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13950702" author="hudson" created="Fri, 28 Mar 2014 13:39:08 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-trunk #1715 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1715/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1715/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10442&quot; title=&quot;Group look-up can cause segmentation fault when certain JNI-based mapping module is used.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10442&quot;&gt;&lt;del&gt;HADOOP-10442&lt;/del&gt;&lt;/a&gt;. Group look-up can cause segmentation fault when certain JNI-based mapping module is used. (Kihwal Lee via jeagles) (jeagles: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1582451&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1582451&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/native/src/org/apache/hadoop/security/hadoop_user_info.c&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13950708" author="hudson" created="Fri, 28 Mar 2014 13:42:35 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk #1740 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1740/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1740/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10442&quot; title=&quot;Group look-up can cause segmentation fault when certain JNI-based mapping module is used.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10442&quot;&gt;&lt;del&gt;HADOOP-10442&lt;/del&gt;&lt;/a&gt;. Group look-up can cause segmentation fault when certain JNI-based mapping module is used. (Kihwal Lee via jeagles) (jeagles: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1582451&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1582451&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/native/src/org/apache/hadoop/security/hadoop_user_info.c&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13955576" author="kihwal" created="Mon, 31 Mar 2014 19:36:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmccabe&quot; class=&quot;user-hover&quot; rel=&quot;cmccabe&quot;&gt;cmccabe&lt;/a&gt;:  I also think the version of nslcd we used is buggy.  The return code handling before your change was just masking it, but it likely had other side effects.  I observed many lookup timeouts in NN prior to crashes, while my own program calling the same libc functions running on the same box at the same time had no issue.  The nslcd lookup timeout was configured to be 20 seconds in /etc/nslcd.conf.&lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;12:15:21,106  WARN security.Groups: Potential performance problem:&lt;br/&gt;
getGroups(user=xxxx) took 20020 milliseconds.&lt;br/&gt;
 12:15:21,107  WARN security.UserGroupInformation: No groups available for user xxxx&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;&lt;p&gt;Also, looking at this more closely, I believe we mishandle the case where the user is a member of no groups. This would be a pretty odd configuration (I wonder if it&apos;s possible?).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Getting no groups after a successful getpwnam() can probably only happen when the user was removed in between the two calls. All other cases might be considered as errors.  I saw cases of an admin user getting permission refused for certain operations. It was fixed after the refresh command was issued.  It must have hit the no-group error when building the acl and the result was negatively cached. If it didn&apos;t do negative caching, user-level retries would have worked.&lt;/p&gt;

&lt;p&gt;So, the solution might be letting the native code return 0 even on error conditions as you suggested, but making netgroup modules not do negative caching.  That&apos;s when a valid user name has no netgroups.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12636983" name="HADOOP-10442.patch" size="785" author="kihwal" created="Wed, 26 Mar 2014 19:36:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382136</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 34 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tu4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382409</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326144">2.4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>