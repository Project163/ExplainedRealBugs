<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:44:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-10081] Client.setupIOStreams can leak socket resources on exception or error</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-10081</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;The setupIOStreams method in org.apache.hadoop.ipc.Client can leak socket resources if an exception is thrown before the inStream and outStream local variables are assigned to this.in and this.out, respectively.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12677462">HADOOP-10081</key>
            <summary>Client.setupIOStreams can leak socket resources on exception or error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ozawa">Tsuyoshi Ozawa</assignee>
                                    <reporter username="jlowe">Jason Darrell Lowe</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Nov 2013 22:41:39 +0000</created>
                <updated>Wed, 3 Sep 2014 23:43:10 +0000</updated>
                            <resolved>Thu, 5 Dec 2013 16:15:07 +0000</resolved>
                                    <version>0.23.9</version>
                    <version>2.2.0</version>
                                    <fixVersion>0.23.11</fixVersion>
                    <fixVersion>2.3.0</fixVersion>
                                    <component>ipc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="13813400" author="jlowe" created="Mon, 4 Nov 2013 23:07:35 +0000"  >&lt;p&gt;The close method closes this.in and this.out but does not close this.socket which might have helped in these scenarios.  One mechanism that can trigger this having a client trying to connect to HDFS on the wrong port (e.g.: web port instead of RPC port).  Doing so makes the SASL setup blow up with an OOM error since it&apos;s not checking for sane boundaries on string lengths and trying to allocate gigantic byte arrays.  Sample backtrace snippet from a 0.23 client:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.io.IOException: Couldn&apos;t set up IO streams
        at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:623)
        at org.apache.hadoop.ipc.Client$Connection.access$2100(Client.java:207)
        at org.apache.hadoop.ipc.Client.getConnection(Client.java:1204)
        at org.apache.hadoop.ipc.Client.call(Client.java:1074)
        ... 25 more
Caused by: java.lang.OutOfMemoryError
        at sun.misc.Unsafe.allocateMemory(Native Method)
        at java.nio.DirectByteBuffer.&amp;lt;init&amp;gt;(DirectByteBuffer.java:127)
        at java.nio.ByteBuffer.allocateDirect(ByteBuffer.java:306)
        at sun.nio.ch.Util.getTemporaryDirectBuffer(Util.java:174)
        at sun.nio.ch.IOUtil.read(IOUtil.java:196)
        at sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:359)
        at org.apache.hadoop.net.SocketInputStream$Reader.performIO(SocketInputStream.java:54)
        at org.apache.hadoop.net.SocketIOWithTimeout.doIO(SocketIOWithTimeout.java:142)
        at org.apache.hadoop.net.SocketInputStream.read(SocketInputStream.java:154)
        at org.apache.hadoop.net.SocketInputStream.read(SocketInputStream.java:127)
        at java.io.FilterInputStream.read(FilterInputStream.java:133)
        at java.io.BufferedInputStream.read1(BufferedInputStream.java:273)
        at java.io.BufferedInputStream.read(BufferedInputStream.java:334)
        at java.io.DataInputStream.readFully(DataInputStream.java:195)
        at java.io.DataInputStream.readFully(DataInputStream.java:169)
        at org.apache.hadoop.io.WritableUtils.readString(WritableUtils.java:125)
        at org.apache.hadoop.security.SaslRpcClient.readStatus(SaslRpcClient.java:114)
        at org.apache.hadoop.security.SaslRpcClient.saslConnect(SaslRpcClient.java:150)
        at org.apache.hadoop.ipc.Client$Connection.setupSaslConnection(Client.java:409)
        at org.apache.hadoop.ipc.Client$Connection.access$1300(Client.java:207)
        at org.apache.hadoop.ipc.Client$Connection$2.run(Client.java:578)
        at org.apache.hadoop.ipc.Client$Connection$2.run(Client.java:575)
        at java.security.AccessController.doPrivileged(Native Method)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There&apos;s probably a separate JIRA here for the fact that the SASL layer isn&apos;t doing sanity checks on the lengths of strings it&apos;s trying to read.&lt;/p&gt;</comment>
                            <comment id="13819907" author="ozawa" created="Tue, 12 Nov 2013 08:05:40 +0000"  >&lt;p&gt;Fixed to call closeConnection() method in close() method.&lt;/p&gt;</comment>
                            <comment id="13820118" author="vinayrpet" created="Tue, 12 Nov 2013 14:16:23 +0000"  >&lt;p&gt;+1 Patch looks good for me. &lt;/p&gt;</comment>
                            <comment id="13820359" author="hadoopqa" created="Tue, 12 Nov 2013 19:05:07 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12613337/HADOOP-10081.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12613337/HADOOP-10081.1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3278//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3278//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3278//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3278//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13820799" author="ozawa" created="Wed, 13 Nov 2013 01:36:16 +0000"  >&lt;p&gt;Thank you for review, Vinay.&lt;/p&gt;</comment>
                            <comment id="13837334" author="ozawa" created="Tue, 3 Dec 2013 04:49:46 +0000"  >&lt;p&gt;I confirmed a latest patch can be applied to the trunk code. Any comments about this JIRA? &lt;/p&gt;</comment>
                            <comment id="13840195" author="jlowe" created="Thu, 5 Dec 2013 15:50:06 +0000"  >&lt;p&gt;Sorry for the delay.  +1, lgtm.  Committing this shortly.&lt;/p&gt;</comment>
                            <comment id="13840212" author="hudson" created="Thu, 5 Dec 2013 16:10:01 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-trunk-Commit #4836 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/4836/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/4836/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10081&quot; title=&quot;Client.setupIOStreams can leak socket resources on exception or error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10081&quot;&gt;&lt;del&gt;HADOOP-10081&lt;/del&gt;&lt;/a&gt;. Client.setupIOStreams can leak socket resources on exception or error. Contributed by Tsuyoshi OZAWA (jlowe: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548179&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Client.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13840215" author="jlowe" created="Thu, 5 Dec 2013 16:15:07 +0000"  >&lt;p&gt;Thanks, Tsuyoshi!  And thanks to Vinay for helping with the reviews.  I committed this to trunk, branch-2, branch-2.3, and branch-0.23.&lt;/p&gt;</comment>
                            <comment id="13840410" author="ozawa" created="Thu, 5 Dec 2013 18:55:18 +0000"  >&lt;p&gt;Thank you, Jason!&lt;/p&gt;</comment>
                            <comment id="13841184" author="hudson" created="Fri, 6 Dec 2013 11:00:41 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Yarn-trunk #413 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/413/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/413/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10081&quot; title=&quot;Client.setupIOStreams can leak socket resources on exception or error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10081&quot;&gt;&lt;del&gt;HADOOP-10081&lt;/del&gt;&lt;/a&gt;. Client.setupIOStreams can leak socket resources on exception or error. Contributed by Tsuyoshi OZAWA (jlowe: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548179&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Client.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13841200" author="hudson" created="Fri, 6 Dec 2013 11:33:49 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-0.23-Build #812 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/812/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-0.23-Build/812/&lt;/a&gt;)&lt;br/&gt;
svn merge -c 1548179 FIXES: &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10081&quot; title=&quot;Client.setupIOStreams can leak socket resources on exception or error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10081&quot;&gt;&lt;del&gt;HADOOP-10081&lt;/del&gt;&lt;/a&gt;. Client.setupIOStreams can leak socket resources on exception or error. Contributed by Tsuyoshi OZAWA (jlowe: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548190&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548190&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/branches/branch-0.23/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Client.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13841251" author="hudson" created="Fri, 6 Dec 2013 13:27:39 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk #1630 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1630/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1630/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10081&quot; title=&quot;Client.setupIOStreams can leak socket resources on exception or error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10081&quot;&gt;&lt;del&gt;HADOOP-10081&lt;/del&gt;&lt;/a&gt;. Client.setupIOStreams can leak socket resources on exception or error. Contributed by Tsuyoshi OZAWA (jlowe: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548179&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Client.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13841268" author="hudson" created="Fri, 6 Dec 2013 13:41:45 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Hdfs-trunk #1604 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1604/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1604/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10081&quot; title=&quot;Client.setupIOStreams can leak socket resources on exception or error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10081&quot;&gt;&lt;del&gt;HADOOP-10081&lt;/del&gt;&lt;/a&gt;. Client.setupIOStreams can leak socket resources on exception or error. Contributed by Tsuyoshi OZAWA (jlowe: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548179&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Client.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12613337" name="HADOOP-10081.1.patch" size="613" author="ozawa" created="Tue, 12 Nov 2013 08:05:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356837</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 50 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pilb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357127</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12324665">0.23.11</customfieldvalue>
    <customfieldvalue id="12325254">2.3.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>