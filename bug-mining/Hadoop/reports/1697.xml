<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:48:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-12252] LocalDirAllocator should not throw NPE with empty string configuration. </title>
                <link>https://issues.apache.org/jira/browse/HADOOP-12252</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;LocalDirAllocator should not throw NPE with empty string configuration. When an empty string is configured, &lt;tt&gt;LocalDirAllocator&lt;/tt&gt; will throw NPE. It will be better to throw IOException instead of NPE.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12846447">HADOOP-12252</key>
            <summary>LocalDirAllocator should not throw NPE with empty string configuration. </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zxu">Zhihai Xu</assignee>
                                    <reporter username="zxu">Zhihai Xu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Jul 2015 07:15:08 +0000</created>
                <updated>Tue, 30 Aug 2016 01:24:54 +0000</updated>
                            <resolved>Thu, 24 Sep 2015 19:54:40 +0000</resolved>
                                                    <fixVersion>2.8.0</fixVersion>
                    <fixVersion>3.0.0-alpha1</fixVersion>
                                    <component>fs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14634657" author="zxu" created="Tue, 21 Jul 2015 07:31:35 +0000"  >&lt;p&gt;I uploaded a patch &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12252&quot; title=&quot;LocalDirAllocator should not throw NPE with empty string configuration. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12252&quot;&gt;&lt;del&gt;HADOOP-12252&lt;/del&gt;&lt;/a&gt;.000.patch for review. The test in the patch will fail without the fix. The patch will throw IOException if an empty string is configured.&lt;/p&gt;</comment>
                            <comment id="14636395" author="brahmareddy" created="Wed, 22 Jul 2015 06:57:49 +0000"  >&lt;p&gt;dupe of &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8437&quot; title=&quot;getLocalPathForWrite should throw IOException for invalid paths&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8437&quot;&gt;&lt;del&gt;HADOOP-8437&lt;/del&gt;&lt;/a&gt;..?&lt;/p&gt;</comment>
                            <comment id="14636506" author="zxu" created="Wed, 22 Jul 2015 08:32:55 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brahmareddy&quot; class=&quot;user-hover&quot; rel=&quot;brahmareddy&quot;&gt;brahmareddy&lt;/a&gt; for the information, I looked at &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8437&quot; title=&quot;getLocalPathForWrite should throw IOException for invalid paths&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8437&quot;&gt;&lt;del&gt;HADOOP-8437&lt;/del&gt;&lt;/a&gt;. They looks like two different issues.&lt;br/&gt;
This NPE happened here is because the newLocalDirs with empty string configuration is equals to the initial value savedLocalDirs.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; savedLocalDirs = &quot;&quot;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So &lt;tt&gt;localDirs&lt;/tt&gt; is not updated. the initial value of &lt;tt&gt;localDirs&lt;/tt&gt; is null, which cause NPE at &lt;tt&gt;int numDirs = localDirs.length;&lt;/tt&gt;&lt;br/&gt;
This NPE issue is caused by NULL initial value of &lt;tt&gt;localDirs&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;For &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8437&quot; title=&quot;getLocalPathForWrite should throw IOException for invalid paths&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8437&quot;&gt;&lt;del&gt;HADOOP-8437&lt;/del&gt;&lt;/a&gt;, the problem is due to failing to create the path or DiskErrorException, which cause zero size directory list.&lt;/p&gt;</comment>
                            <comment id="14636525" author="brahmareddy" created="Wed, 22 Jul 2015 08:50:51 +0000"  >&lt;p&gt;Yes, you are correct.. thanks for you info..Just now I looked at your patch.&lt;/p&gt;</comment>
                            <comment id="14637691" author="zxu" created="Wed, 22 Jul 2015 21:44:05 +0000"  >&lt;p&gt;The following is the stack trace for the NPE:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-07-22 14:33:43,338 INFO  fs.TestLocalDirAllocator (TestLocalDirAllocator.java:testShouldNotthrowNPE(332)) - NPE
java.lang.NullPointerException
	at org.apache.hadoop.fs.LocalDirAllocator$AllocatorPerContext.getLocalPathForWrite(LocalDirAllocator.java:348)
	at org.apache.hadoop.fs.LocalDirAllocator.getLocalPathForWrite(LocalDirAllocator.java:150)
	at org.apache.hadoop.fs.LocalDirAllocator.getLocalPathForWrite(LocalDirAllocator.java:131)
	at org.apache.hadoop.fs.LocalDirAllocator.getLocalPathForWrite(LocalDirAllocator.java:115)
	at org.apache.hadoop.fs.TestLocalDirAllocator.testShouldNotthrowNPE(TestLocalDirAllocator.java:325)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:74)

2015-07-22 14:38:54,769 INFO  fs.TestLocalDirAllocator (TestLocalDirAllocator.java:testShouldNotthrowNPE(345)) - NPE
java.lang.NullPointerException
	at org.apache.hadoop.fs.LocalDirAllocator$AllocatorPerContext.getLocalPathToRead(LocalDirAllocator.java:436)
	at org.apache.hadoop.fs.LocalDirAllocator.getLocalPathToRead(LocalDirAllocator.java:164)
	at org.apache.hadoop.fs.TestLocalDirAllocator.testShouldNotthrowNPE(TestLocalDirAllocator.java:338)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:74)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt&gt;newLocalDirs.equals(savedLocalDirs)&lt;/tt&gt; will be true with empty string configuration in &lt;tt&gt;AllocatorPerContext#confChanged&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="14641782" author="hadoopqa" created="Sat, 25 Jul 2015 21:02:03 +0000"  >&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/check.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;blue&quot;&gt;0&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; pre-patch &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  16m 24s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Pre-patch trunk compilation is healthy. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; @author &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch does not contain any @author tags. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; tests included &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch appears to include 1 new or modified test files. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javac &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   7m 34s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; There were no new javac warning messages. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javadoc &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   9m 41s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; There were no new javadoc warning messages. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; release audit &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 23s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The applied patch does not increase the total number of release audit warnings. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; checkstyle &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  5s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; There were no new checkstyle issues. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; whitespace &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch has no lines that end in whitespace. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; install &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 19s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; mvn install still works. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; eclipse:eclipse &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 33s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch built with eclipse:eclipse. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; findbugs &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 52s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch does not introduce any new Findbugs (version 3.0.0) warnings. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; common tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  22m 20s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Tests passed in hadoop-common. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  61m 17s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12747211/HADOOP-12252.000.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12747211/HADOOP-12252.000.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javadoc javac unit findbugs checkstyle &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; trunk / 156f24e &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; hadoop-common test log &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7339/artifact/patchprocess/testrun_hadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7339/artifact/patchprocess/testrun_hadoop-common.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7339/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7339/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.7.0_55 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux asf906.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7339/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7339/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;</comment>
                            <comment id="14649478" author="zxu" created="Fri, 31 Jul 2015 17:02:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xgong&quot; class=&quot;user-hover&quot; rel=&quot;xgong&quot;&gt;xgong&lt;/a&gt;, Could you review the patch? Because the arrays &lt;tt&gt;dirDF&lt;/tt&gt; and &lt;tt&gt;localDirs&lt;/tt&gt; are not initialized, NPE will happen when accessing the arrays&apos; length at above corner case. The fix is to initialize &lt;tt&gt;dirDF&lt;/tt&gt; and &lt;tt&gt;localDirs&lt;/tt&gt; as zero length array, which should be safe I think. thanks&lt;/p&gt;</comment>
                            <comment id="14649480" author="xgong" created="Fri, 31 Jul 2015 17:06:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zxu&quot; class=&quot;user-hover&quot; rel=&quot;zxu&quot;&gt;zxu&lt;/a&gt; Sure. will review it shortly&lt;/p&gt;</comment>
                            <comment id="14649529" author="xgong" created="Fri, 31 Jul 2015 17:46:03 +0000"  >&lt;p&gt;Thanks for working on this. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zxu&quot; class=&quot;user-hover&quot; rel=&quot;zxu&quot;&gt;zxu&lt;/a&gt; But I am still not sure why we should make this changes. I think that this is only the test case issue. For the directory, such as NM_LOCAL_DIRS, if we do not set it in configuration, the default value will be used. So, i think that it will not be null.&lt;/p&gt;

&lt;p&gt;What do you think ?&lt;/p&gt;</comment>
                            <comment id="14649653" author="zxu" created="Fri, 31 Jul 2015 18:56:16 +0000"  >&lt;p&gt;thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xgong&quot; class=&quot;user-hover&quot; rel=&quot;xgong&quot;&gt;xgong&lt;/a&gt; for the review. Normally we won&apos;t see this issue, as you said the default value should not be empty string. But there is a usage case at LocalDirsHandlerService, we will change NM_LOCAL_DIRS/NM_LOG_DIRS after disk check.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; localDirs = getLocalDirs();
    conf.setStrings(YarnConfiguration.NM_LOCAL_DIRS,
                    localDirs.toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[localDirs.size()]));
    List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; logDirs = getLogDirs();
    conf.setStrings(YarnConfiguration.NM_LOG_DIRS,
                      logDirs.toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[logDirs.size()]));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Potentially all disks can be full, although it should very rarely happen. But if it happens, NM_LOCAL_DIRS/NM_LOG_DIRS will be set to empty string and this issue my happen.&lt;br/&gt;
By the way, I find this issue when I worked on the patch at &lt;a href=&quot;https://issues.apache.org/jira/browse/YARN-3925&quot; title=&quot;ContainerLogsUtils#getContainerLogFile fails to read container log files from full disks.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;YARN-3925&quot;&gt;&lt;del&gt;YARN-3925&lt;/del&gt;&lt;/a&gt;, the test case at &lt;a href=&quot;https://issues.apache.org/jira/browse/YARN-3925&quot; title=&quot;ContainerLogsUtils#getContainerLogFile fails to read container log files from full disks.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;YARN-3925&quot;&gt;&lt;del&gt;YARN-3925&lt;/del&gt;&lt;/a&gt; can also reproduce this issue.&lt;br/&gt;
Since this issue rarely happens, I will change its priority to minor.&lt;/p&gt;</comment>
                            <comment id="14704337" author="zxu" created="Thu, 20 Aug 2015 05:54:58 +0000"  >&lt;p&gt;Currently &lt;tt&gt;savedLocalDirs&lt;/tt&gt; at AllocatorPerContext is initialized as &quot;&quot;(empty string). I think it seems reasonable to initialize &lt;tt&gt;dirDF&lt;/tt&gt; and &lt;tt&gt;localDirs&lt;/tt&gt; as zero length array to match the initial value of &lt;tt&gt;savedLocalDirs&lt;/tt&gt; and fix the NPE. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xgong&quot; class=&quot;user-hover&quot; rel=&quot;xgong&quot;&gt;xgong&lt;/a&gt;, What do you think?&lt;/p&gt;</comment>
                            <comment id="14904999" author="xgong" created="Wed, 23 Sep 2015 18:32:53 +0000"  >&lt;p&gt;+1 LGTM&lt;/p&gt;</comment>
                            <comment id="14906898" author="zxu" created="Thu, 24 Sep 2015 19:54:29 +0000"  >&lt;p&gt;thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xgong&quot; class=&quot;user-hover&quot; rel=&quot;xgong&quot;&gt;xgong&lt;/a&gt; for the review! Committed it to branch-2 and trunk.&lt;/p&gt;</comment>
                            <comment id="14906927" author="hudson" created="Thu, 24 Sep 2015 20:14:15 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-trunk-Commit #8515 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/8515/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/8515/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12252&quot; title=&quot;LocalDirAllocator should not throw NPE with empty string configuration. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12252&quot;&gt;&lt;del&gt;HADOOP-12252&lt;/del&gt;&lt;/a&gt;. LocalDirAllocator should not throw NPE with empty string configuration. Contributed by Zhihai Xu (zxu: rev 52c1f272ecb6c29c81898a1ff50d03a1296df1f7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/LocalDirAllocator.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestLocalDirAllocator.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14907047" author="hudson" created="Thu, 24 Sep 2015 21:15:05 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #437 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/437/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/437/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12252&quot; title=&quot;LocalDirAllocator should not throw NPE with empty string configuration. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12252&quot;&gt;&lt;del&gt;HADOOP-12252&lt;/del&gt;&lt;/a&gt;. LocalDirAllocator should not throw NPE with empty string configuration. Contributed by Zhihai Xu (zxu: rev 52c1f272ecb6c29c81898a1ff50d03a1296df1f7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestLocalDirAllocator.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/LocalDirAllocator.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14907145" author="hudson" created="Thu, 24 Sep 2015 22:27:57 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Yarn-trunk #1176 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/1176/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/1176/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12252&quot; title=&quot;LocalDirAllocator should not throw NPE with empty string configuration. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12252&quot;&gt;&lt;del&gt;HADOOP-12252&lt;/del&gt;&lt;/a&gt;. LocalDirAllocator should not throw NPE with empty string configuration. Contributed by Zhihai Xu (zxu: rev 52c1f272ecb6c29c81898a1ff50d03a1296df1f7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/LocalDirAllocator.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestLocalDirAllocator.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14907155" author="hudson" created="Thu, 24 Sep 2015 22:30:09 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #443 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/443/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/443/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12252&quot; title=&quot;LocalDirAllocator should not throw NPE with empty string configuration. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12252&quot;&gt;&lt;del&gt;HADOOP-12252&lt;/del&gt;&lt;/a&gt;. LocalDirAllocator should not throw NPE with empty string configuration. Contributed by Zhihai Xu (zxu: rev 52c1f272ecb6c29c81898a1ff50d03a1296df1f7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/LocalDirAllocator.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestLocalDirAllocator.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14907225" author="hudson" created="Thu, 24 Sep 2015 23:15:26 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-trunk #2354 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/2354/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/2354/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12252&quot; title=&quot;LocalDirAllocator should not throw NPE with empty string configuration. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12252&quot;&gt;&lt;del&gt;HADOOP-12252&lt;/del&gt;&lt;/a&gt;. LocalDirAllocator should not throw NPE with empty string configuration. Contributed by Zhihai Xu (zxu: rev 52c1f272ecb6c29c81898a1ff50d03a1296df1f7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/LocalDirAllocator.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestLocalDirAllocator.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14907281" author="hudson" created="Fri, 25 Sep 2015 00:13:24 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #415 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/415/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/415/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12252&quot; title=&quot;LocalDirAllocator should not throw NPE with empty string configuration. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12252&quot;&gt;&lt;del&gt;HADOOP-12252&lt;/del&gt;&lt;/a&gt;. LocalDirAllocator should not throw NPE with empty string configuration. Contributed by Zhihai Xu (zxu: rev 52c1f272ecb6c29c81898a1ff50d03a1296df1f7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestLocalDirAllocator.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/LocalDirAllocator.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14907294" author="hudson" created="Fri, 25 Sep 2015 00:23:14 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk #2382 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2382/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2382/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12252&quot; title=&quot;LocalDirAllocator should not throw NPE with empty string configuration. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12252&quot;&gt;&lt;del&gt;HADOOP-12252&lt;/del&gt;&lt;/a&gt;. LocalDirAllocator should not throw NPE with empty string configuration. Contributed by Zhihai Xu (zxu: rev 52c1f272ecb6c29c81898a1ff50d03a1296df1f7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/LocalDirAllocator.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/TestLocalDirAllocator.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12558048">HADOOP-8436</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12845126">YARN-3925</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12747211" name="HADOOP-12252.000.patch" size="2826" author="zxu" created="Sat, 25 Jul 2015 19:53:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hhav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>