<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:42:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-9211] HADOOP_CLIENT_OPTS default setting fixes max heap size at 128m, disregards HADOOP_HEAPSIZE</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-9211</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;hadoop-env.sh as included in the 2.0.2alpha release tarball contains:&lt;br/&gt;
export HADOOP_CLIENT_OPTS=&quot;-Xmx128m $HADOOP_CLIENT_OPTS&quot;&lt;/p&gt;

&lt;p&gt;This overrides any heap settings in HADOOP_HEAPSIZE.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12627586">HADOOP-9211</key>
            <summary>HADOOP_CLIENT_OPTS default setting fixes max heap size at 128m, disregards HADOOP_HEAPSIZE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zero45">Plamen Jeliazkov</assignee>
                                    <reporter username="sew">Sarah Weissman</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Jan 2013 03:41:55 +0000</created>
                <updated>Tue, 12 Nov 2013 22:29:05 +0000</updated>
                            <resolved>Fri, 12 Apr 2013 18:17:56 +0000</resolved>
                                    <version>2.0.2-alpha</version>
                                    <fixVersion>2.1.0-beta</fixVersion>
                                    <component>conf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="60">1m</timeoriginalestimate>
                            <timeestimate seconds="60">1m</timeestimate>
                                        <comments>
                            <comment id="13553496" author="qwertymaniac" created="Tue, 15 Jan 2013 05:18:33 +0000"  >&lt;p&gt;Compared to past, the HADOOP_HEAPSIZE is only for services, going forward. The HADOOP_CLIENT_OPTS therefore applies to clients alone and is the config point for client-side heap.&lt;/p&gt;

&lt;p&gt;If an easier, numeric setting is needed for clients, we can perhaps have HADOOP_CLIENT_HEAPSIZE, but HADOOP_HEAPSIZE should not generally apply to clients given the newer HADOOP_CLIENT_OPTS.&lt;/p&gt;</comment>
                            <comment id="13553778" author="sew" created="Tue, 15 Jan 2013 13:15:48 +0000"  >&lt;p&gt;Maybe this can be better documented inside hadoop-env.sh? Out of the box changing HADOOP_HEAPSIZE adds a -Xmx argument to the beginning of the bin/hadoop java command, but the hard-coded 128M heap size in HADOOP_CLIENT_OPTS overrides that option with a second -Xmx. As a new user this was very unintuitive, especially since most advice given around the internet for earlier versions will refer to adjusting HADOOP_HEAPSIZE. &lt;/p&gt;

&lt;p&gt;Also, at least in my case, 128M was not enough to run various examples from the hadoop examples jar, so the first thing many new users might encounter is trying to figure out how to increase heap size. Maybe 128M is a bad value given the default settings of other variables?&lt;/p&gt;</comment>
                            <comment id="13553811" author="qwertymaniac" created="Tue, 15 Jan 2013 13:42:59 +0000"  >&lt;p&gt;In distributed mode, with no local tasks, the 128M should suffice for simply launching the apps/shell/etc. I think. We can surely improve docs around this, and if you wish, we can make default 256m?&lt;/p&gt;</comment>
                            <comment id="13553898" author="sew" created="Tue, 15 Jan 2013 15:35:20 +0000"  >&lt;p&gt;I do not know enough about hadoop to feel confident in making a recommendation on what the default max heap size should be. Also, I was running the examples in non-distributed mode. 256m does appear to be enough so that the pi and wordcount examples from share/hadoop/mapreduce/hadoop-mapreduce-examples-2.0.2-alpha.jar do not run out of memory in non-distributed mode.&lt;/p&gt;</comment>
                            <comment id="13554737" author="gopalv" created="Wed, 16 Jan 2013 04:43:03 +0000"  >&lt;p&gt;I&apos;ve been using the following patch locally to work around a similar problem.&lt;/p&gt;

&lt;p&gt;Java takes the last -xmx opt it can find as the actual value, so moving the arg to the end of the opts seemed to help.&lt;/p&gt;</comment>
                            <comment id="13624078" author="zero45" created="Fri, 5 Apr 2013 21:24:48 +0000"  >&lt;p&gt;Using the default 128m for services will actually cause crashes in DataNodes. I linked the closed JIRA I raised as a reference.&lt;/p&gt;

&lt;p&gt;Indeed the cause for my earlier was this default 128m hardcode. In order to workaround it I needed to add the heap size change into HADOOP_NAMENODE_OPTS manually.&lt;/p&gt;

&lt;p&gt;Is it possible to disable the 128m default for now, or maybe bump up the default heap to 256m or 512m? 512m seems to not cause any DataNode crashes during my runs of Slive on a small 3 node cluster.&lt;/p&gt;

&lt;p&gt;I will attach a simple patch for a bump request.&lt;/p&gt;</comment>
                            <comment id="13629591" author="shv" created="Thu, 11 Apr 2013 23:48:02 +0000"  >&lt;p&gt;+1. If there are no objections I&apos;ll commit this to avoid confusing OOMs.&lt;br/&gt;
Following formal Jenkins verification.&lt;/p&gt;</comment>
                            <comment id="13629640" author="hadoopqa" created="Fri, 12 Apr 2013 00:36:41 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12577296/HADOOP-9211.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12577296/HADOOP-9211.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/2445//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/2445//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/2445//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/2445//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13630415" author="hudson" created="Fri, 12 Apr 2013 18:05:48 +0000"  >&lt;p&gt;Integrated in Hadoop-trunk-Commit #3609 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/3609/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/3609/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-9211&quot; title=&quot;HADOOP_CLIENT_OPTS default setting fixes max heap size at 128m, disregards HADOOP_HEAPSIZE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-9211&quot;&gt;&lt;del&gt;HADOOP-9211&lt;/del&gt;&lt;/a&gt;. Set default max heap size in HADOOP_CLIENT_OPTS to 512m in order to avoid OOME. Contributed by Plamen Jeliazkov. (Revision 1467380)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
shv : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1467380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1467380&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/conf/hadoop-env.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13630432" author="shv" created="Fri, 12 Apr 2013 18:17:56 +0000"  >&lt;p&gt;I just committed this to trunk and branch-2. Thank you Plamen.&lt;/p&gt;</comment>
                            <comment id="13631008" author="hudson" created="Sat, 13 Apr 2013 10:49:26 +0000"  >&lt;p&gt;Integrated in Hadoop-Yarn-trunk #182 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/182/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/182/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-9211&quot; title=&quot;HADOOP_CLIENT_OPTS default setting fixes max heap size at 128m, disregards HADOOP_HEAPSIZE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-9211&quot;&gt;&lt;del&gt;HADOOP-9211&lt;/del&gt;&lt;/a&gt;. Set default max heap size in HADOOP_CLIENT_OPTS to 512m in order to avoid OOME. Contributed by Plamen Jeliazkov. (Revision 1467380)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
shv : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1467380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1467380&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/conf/hadoop-env.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13631029" author="hudson" created="Sat, 13 Apr 2013 13:06:03 +0000"  >&lt;p&gt;Integrated in Hadoop-Hdfs-trunk #1371 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1371/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1371/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-9211&quot; title=&quot;HADOOP_CLIENT_OPTS default setting fixes max heap size at 128m, disregards HADOOP_HEAPSIZE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-9211&quot;&gt;&lt;del&gt;HADOOP-9211&lt;/del&gt;&lt;/a&gt;. Set default max heap size in HADOOP_CLIENT_OPTS to 512m in order to avoid OOME. Contributed by Plamen Jeliazkov. (Revision 1467380)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
shv : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1467380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1467380&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/conf/hadoop-env.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13631055" author="hudson" created="Sat, 13 Apr 2013 14:05:55 +0000"  >&lt;p&gt;Integrated in Hadoop-Mapreduce-trunk #1398 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1398/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1398/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-9211&quot; title=&quot;HADOOP_CLIENT_OPTS default setting fixes max heap size at 128m, disregards HADOOP_HEAPSIZE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-9211&quot;&gt;&lt;del&gt;HADOOP-9211&lt;/del&gt;&lt;/a&gt;. Set default max heap size in HADOOP_CLIENT_OPTS to 512m in order to avoid OOME. Contributed by Plamen Jeliazkov. (Revision 1467380)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
shv : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1467380&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1467380&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/conf/hadoop-env.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13695571" author="billwarner" created="Fri, 28 Jun 2013 17:05:00 +0000"  >&lt;p&gt;I think the problem comes on line 17 of hadoop-env.sh&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Extra Java runtime options. Empty by default.&lt;br/&gt;
export HADOOP_OPTS=&quot;-Djava.net.preferIPv4Stack=true $HADOOP_CLIENT_OPTS&quot;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;this is assigning teh 128m or any other hadoop heap size to early to HADOOP_OPTS and places the -Xmx after the HADOOP_HEAPSIZE var is set so overriding that.  the HADOOP_CLIENT_OPTS should not be added to HADOOP_OPTS until it is determined to not be one of the nn/snn/jt/dn/tt servers and actually be a client.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12678893">HADOOP-10093</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12631148">HDFS-4475</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12577296" name="HADOOP-9211.patch" size="985" author="zero45" created="Fri, 5 Apr 2013 21:26:49 +0000"/>
                            <attachment id="12565071" name="hadoop-xmx.patch" size="529" author="gopalv" created="Wed, 16 Jan 2013 04:43:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>304370</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 21 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17m2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>252546</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>