<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:57:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-18024] SocketChannel is not closed when IOException happens in Server$Listener.doAccept</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-18024</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;This is a follow-up of &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17552&quot; title=&quot;Change ipc.client.rpc-timeout.ms from 0 to 120000 by default to avoid potential hang&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17552&quot;&gt;&lt;del&gt;HADOOP-17552&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;When the symptom described in &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17552&quot; title=&quot;Change ipc.client.rpc-timeout.ms from 0 to 120000 by default to avoid potential hang&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17552&quot;&gt;&lt;del&gt;HADOOP-17552&lt;/del&gt;&lt;/a&gt; happens, the client may time out in 2min, according to the default RPC timeout configuration specified in &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17552&quot; title=&quot;Change ipc.client.rpc-timeout.ms from 0 to 120000 by default to avoid potential hang&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17552&quot;&gt;&lt;del&gt;HADOOP-17552&lt;/del&gt;&lt;/a&gt;. Before this timeout, the client just waits, and does not know this issue happens.&lt;/p&gt;

&lt;p&gt;However, we recently found that actually the client doesn&#8217;t need to waste this 2min, and the server&#8217;s availability can be also improved. If the IOException happens in line 1402 or 1403 or 1404, we can just close this problematic `SocketChannel` and continue to accept new socket connections. The client side can also be aware of the close socket immediately, instead of waiting 2min.&lt;/p&gt;

&lt;p&gt;The old implementation:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Server.java
&lt;/span&gt;
&#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run() {
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (running) {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (iter.hasNext()) {
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (key.isValid()) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (key.isAcceptable())
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; doAccept(key); &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-comment&quot;&gt;// line 1348
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) { &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// line 1350
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (OutOfMemoryError e) {
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;&#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; }
&#160; &#160; } &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Server.java
&lt;/span&gt;
&#160; &#160; void doAccept(SelectionKey key) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException, IOException,&#160;
&#160; &#160; &#160; &#160; OutOfMemoryError {
&#160; &#160; &#160; ServerSocketChannel server = (ServerSocketChannel) key.channel();
&#160; &#160; &#160; SocketChannel channel;
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((channel = server.accept()) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) { &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// line 1400
&lt;/span&gt;
&#160; &#160; &#160; &#160; channel.configureBlocking(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;); &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// line 1402
&lt;/span&gt;&#160; &#160; &#160; &#160; channel.socket().setTcpNoDelay(tcpNoDelay); &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// line 1403
&lt;/span&gt;&#160; &#160; &#160; &#160; channel.socket().setKeepAlive(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;); &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-comment&quot;&gt;// line 1404
&lt;/span&gt;
&#160; &#160; &#160; &#160; Reader reader = getReader();
&#160; &#160; &#160; &#160; Connection c = connectionManager.register(channel,
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.listenPort, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isOnAuxiliaryPort);
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// If the connectionManager can&apos;t take it, close the connection.
&lt;/span&gt;&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (c == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (channel.isOpen()) {
&#160; &#160; &#160; &#160; &#160; &#160; IOUtils.cleanup(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, channel);
&#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; connectionManager.droppedConnections.getAndIncrement();
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; key.attach(c); &#160;&lt;span class=&quot;code-comment&quot;&gt;// so closeCurrentConnection can get the object
&lt;/span&gt;&#160; &#160; &#160; &#160; reader.addConnection(c);
&#160; &#160; &#160; }
&#160; &#160; } &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We propose that the following implementation is better:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &#160; void doAccept(SelectionKey key) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException, IOException,&#160;
&#160; &#160; &#160; &#160; OutOfMemoryError {
&#160; &#160; &#160; ServerSocketChannel server = (ServerSocketChannel) key.channel();
&#160; &#160; &#160; SocketChannel channel;
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((channel = server.accept()) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) { &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// line 1400
&lt;/span&gt;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; channel.configureBlocking(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;); &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// line 1402
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; channel.socket().setTcpNoDelay(tcpNoDelay); &#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// line 1403
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; channel.socket().setKeepAlive(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;); &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-comment&quot;&gt;// line 1404
&lt;/span&gt;&#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
&#160; &#160; &#160; &#160; &#160; LOG.warn(...);
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &#160; channel.socket().close();
&#160; &#160; &#160; &#160; &#160; &#160; channel.close();
&#160; &#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ignored) { }
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
&#160; &#160; &#160; &#160; }

&#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;&#160; &#160; &#160; }
&#160; &#160; }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The advantages include:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;&lt;b&gt;In the old implementation&lt;/b&gt;, the `ServerSocketChannel` was abandoned due to the single exception in this single `SocketChannel`, because the exception handler is in line 1350. &lt;b&gt;In the new implementation&lt;/b&gt;, we use a try-catch to handle the exception in line 1402 or 1403 or 1404, then the `ServerSocketChannel` can continue to accept new connections, and don&#8217;t need to go back to the line 1348 in the next while loop in the run method.&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;In the old implementation&lt;/b&gt;, the client (another endpoint of this `SocketChannel`) is not aware of this issue, because the `SocketChannel` is accepted and not closed. &lt;b&gt;In the new implementation&lt;/b&gt;, we close the `SocketChannel` when the IOException happens, then the client will immediately get EOF from the socket. Then the client can choose to retry or throw an exception, by the client&#8217;s discretion.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We have confirmed that this patch works as expected, in our local machine.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This code pattern was adopted by other communities. For example, in Kafka &lt;a href=&quot;https://github.com/apache/kafka/blob/23e9818e625976c22fe6d4297a5ab76b01f92ef6/core/src/main/scala/kafka/network/SocketServer.scala#L714-L740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/23e9818e625976c22fe6d4297a5ab76b01f92ef6/core/src/main/scala/kafka/network/SocketServer.scala#L714-L740&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &#160; /**
&#160; &#160;* Accept a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; connection
&#160; &#160;*/
&#160; &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; def accept(key: SelectionKey): Option[SocketChannel] = {
&#160; &#160; val serverSocketChannel = key.channel().asInstanceOf[ServerSocketChannel]
&#160; &#160; val socketChannel = serverSocketChannel.accept()
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&#160; &#160; &#160; connectionQuotas.inc(endPoint.listenerName, socketChannel.socket.getInetAddress, blockedPercentMeter)
&#160; &#160; &#160; configureAcceptedSocketChannel(socketChannel)
&#160; &#160; &#160; Some(socketChannel)
&#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; {
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; e: TooManyConnectionsException =&amp;gt;
&#160; &#160; &#160; &#160; info(...)
&#160; &#160; &#160; &#160; close(endPoint.listenerName, socketChannel)
&#160; &#160; &#160; &#160; None
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; e: ConnectionThrottledException =&amp;gt;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;&#160; &#160; &#160; &#160; None
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; e: IOException =&amp;gt;
&#160; &#160; &#160; &#160; error(...)
&#160; &#160; &#160; &#160; close(endPoint.listenerName, socketChannel)
&#160; &#160; &#160; &#160; None
&#160; &#160; }
&#160; }

&#160; /**
&#160; &#160;* Close `channel` and decrement the connection count.
&#160; &#160;*/
&#160; def close(listenerName: ListenerName, channel: SocketChannel): Unit = {
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (channel != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&#160; &#160; &#160; &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;&#160; &#160; &#160; closeSocket(channel)
&#160; &#160; }
&#160; }

&#160; &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; def closeSocket(channel: SocketChannel): Unit = {
&#160; &#160; CoreUtils.swallow(channel.socket().close(), &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, Level.ERROR)
&#160; &#160; CoreUtils.swallow(channel.close(), &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, Level.ERROR)
&#160; }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13413758">HADOOP-18024</key>
            <summary>SocketChannel is not closed when IOException happens in Server$Listener.doAccept</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="functioner">Haoze Wu</assignee>
                                    <reporter username="functioner">Haoze Wu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 25 Nov 2021 05:19:09 +0000</created>
                <updated>Tue, 1 Feb 2022 08:53:21 +0000</updated>
                                            <version>3.2.2</version>
                                                    <component>ipc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="13200">3h 40m</timespent>
                                <comments>
                            <comment id="17458850" author="ajisakaa" created="Tue, 14 Dec 2021 01:57:56 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=functioner&quot; class=&quot;user-hover&quot; rel=&quot;functioner&quot;&gt;functioner&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iwasakims&quot; class=&quot;user-hover&quot; rel=&quot;iwasakims&quot;&gt;iwasakims&lt;/a&gt;&lt;br/&gt;
After &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-18024&quot; title=&quot;SocketChannel is not closed when IOException happens in Server$Listener.doAccept&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-18024&quot;&gt;HADOOP-18024&lt;/a&gt; is fixed, TestIPC#testIOEOnListenerAccept fails. Would you check &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-18046&quot; title=&quot;TestIPC#testIOEOnListenerAccept fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-18046&quot;&gt;&lt;del&gt;HADOOP-18046&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17458855" author="functioner" created="Tue, 14 Dec 2021 02:06:01 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aajisaka&quot; class=&quot;user-hover&quot; rel=&quot;aajisaka&quot;&gt;aajisaka&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When we were working on &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-18024&quot; title=&quot;SocketChannel is not closed when IOException happens in Server$Listener.doAccept&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-18024&quot;&gt;HADOOP-18024&lt;/a&gt;, we triggered CI testing multiple times. I noticed that this test failed once (and only once). Since this symptom occurs again, I will take a closer look. Thanks for pointing out the issue.&lt;/p&gt;</comment>
                            <comment id="17458861" author="ajisakaa" created="Tue, 14 Dec 2021 02:19:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=functioner&quot; class=&quot;user-hover&quot; rel=&quot;functioner&quot;&gt;functioner&lt;/a&gt; Thank you for looking into this.&lt;/p&gt;

&lt;p&gt;FYI: The failure is not only once. The failed tests are retried at most 3 times in Jenkins job and finally it passed. For example: &lt;a href=&quot;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-3719/6/artifact/out/patch-unit-hadoop-common-project_hadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-hadoop.apache.org/job/hadoop-multibranch/job/PR-3719/6/artifact/out/patch-unit-hadoop-common-project_hadoop-common.txt&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[WARNING] Flakes: 
[WARNING] org.apache.hadoop.ipc.TestIPC.testIOEOnListenerAccept(org.apache.hadoop.ipc.TestIPC)
[ERROR]   Run 1: TestIPC.testIOEOnListenerAccept:652 Expected an EOFException to have been thrown
[ERROR]   Run 2: TestIPC.testIOEOnListenerAccept:652 Expected an EOFException to have been thrown
[INFO]   Run 3: PASS
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17469486" author="ayushtkn" created="Wed, 5 Jan 2022 19:01:53 +0000"  >&lt;p&gt;The introduced test is failing in the daily build. Was able to repro that locally as well,&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=functioner&quot; class=&quot;user-hover&quot; rel=&quot;functioner&quot;&gt;functioner&lt;/a&gt; Any plans to chase &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-18046&quot; title=&quot;TestIPC#testIOEOnListenerAccept fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-18046&quot;&gt;&lt;del&gt;HADOOP-18046&lt;/del&gt;&lt;/a&gt; which is raised for the test?&#160;&lt;/p&gt;</comment>
                            <comment id="17469527" author="functioner" created="Wed, 5 Jan 2022 19:56:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ayushtkn&quot; class=&quot;user-hover&quot; rel=&quot;ayushtkn&quot;&gt;ayushtkn&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Sorry for the delay. I should have fixed the issue earlier.&lt;/p&gt;

&lt;p&gt;Now I think the root cause is `org.apache.hadoop.ipc.Client$IpcStreams.readResponse(Client.java:1922)` which may throw IOException (Connection reset by peer) from time to time. In the test I only consider EOFException, which happens in most cases.&lt;/p&gt;

&lt;p&gt;IOException (Connection reset by peer) should also be an expected exception caught. I will raise a pr in github today.&lt;/p&gt;</comment>
                            <comment id="17484563" author="ayushtkn" created="Mon, 31 Jan 2022 08:24:36 +0000"  >&lt;p&gt;Seems,&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-19046&quot; title=&quot;S3A: update AWS sdk versions to 2.23.5 and 1.12.599&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-19046&quot;&gt;&lt;del&gt;HADOOP-19046&lt;/del&gt;&lt;/a&gt; is stuck for quite long, we don&apos;t have a solution for now.&lt;br/&gt;
Plan to revert this by tomorrow as we don&apos;t have a concrete convincing test fix and post that we can rework this here.&lt;/p&gt;</comment>
                            <comment id="17484799" author="iwasakims" created="Mon, 31 Jan 2022 17:17:57 +0000"  >&lt;p&gt;+1 on reverting. Since the patch is small, we can easily revisit this.&lt;/p&gt;</comment>
                            <comment id="17485057" author="functioner" created="Tue, 1 Feb 2022 06:06:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iwasakims&quot; class=&quot;user-hover&quot; rel=&quot;iwasakims&quot;&gt;iwasakims&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ayushtkn&quot; class=&quot;user-hover&quot; rel=&quot;ayushtkn&quot;&gt;ayushtkn&lt;/a&gt; I have some update at &lt;a href=&quot;https://github.com/apache/hadoop/pull/3872,&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/3872,&lt;/a&gt; PTAL. Thanks.&lt;/p&gt;

&lt;p&gt;I apologize that the test confuses the community for such a long time, and without much followup from me.&lt;/p&gt;</comment>
                            <comment id="17485125" author="ayushtkn" created="Tue, 1 Feb 2022 08:53:21 +0000"  >&lt;p&gt;Tried the test, it failed for me as well as it did for @&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iwasakims&quot; class=&quot;user-hover&quot; rel=&quot;iwasakims&quot;&gt;iwasakims&lt;/a&gt;&lt;br/&gt;
Have reverted it. Lets rework this here. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=functioner&quot; class=&quot;user-hover&quot; rel=&quot;functioner&quot;&gt;functioner&lt;/a&gt; Let us know if you get stuck and aren&apos;t able to root cause it, either of us will try to help you&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13411927">KAFKA-13457</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13361408">HADOOP-17552</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13416967">HADOOP-18046</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0x2p4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>