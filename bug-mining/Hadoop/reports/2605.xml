<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:55:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-16897] Sort fields in ReflectionUtils.java</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-16897</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;The tests in&#160;&lt;em&gt;org.apache.hadoop.metrics2.impl.TestMetricsSystemImpl#testInitFirstVerifyCallBacks&lt;/em&gt; and&#160;&lt;em&gt;org.apache.hadoop.metrics2.impl.TestMetricsSystemImpl#testInitFirstVerifyStopInvokedImmediately&lt;/em&gt; can fail.&lt;/p&gt;

&lt;p&gt;java.lang.AssertionError:&lt;/p&gt;

&lt;p&gt;Element 0 for metrics expected:&amp;lt;MetricCounterLong{info=MetricsInfoImpl&lt;/p&gt;

{name=C1, description=C1 desc}

&lt;p&gt;, value=1}&amp;gt;&lt;/p&gt;

&lt;p&gt;but was:&amp;lt;MetricGaugeLong{info=MetricsInfoImpl&lt;/p&gt;

{name=G1, description=G1 desc}

&lt;p&gt;, value=2}&amp;gt;&lt;/p&gt;

&lt;p&gt;at org.junit.Assert.fail(Assert.java:88)&lt;/p&gt;

&lt;p&gt;at org.junit.Assert.failNotEquals(Assert.java:834)&lt;/p&gt;

&lt;p&gt;at org.junit.Assert.assertEquals(Assert.java:118)&lt;/p&gt;

&lt;p&gt;at org.apache.hadoop.test.MoreAsserts.assertEquals(MoreAsserts.java:60)&lt;/p&gt;

&lt;p&gt;at org.apache.hadoop.metrics2.impl.TestMetricsSystemImpl.checkMetricsRecords(TestMetricsSystemImpl.java:439)&lt;/p&gt;

&lt;p&gt;at org.apache.hadoop.metrics2.impl.TestMetricsSystemImpl.testInitFirstVerifyCallBacks(TestMetricsSystemImpl.java:178)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The root cause of this failure can be analyzed in the following stack trace:&lt;/p&gt;

&lt;p&gt;&lt;em&gt;java.lang.Class.&lt;b&gt;getDeclaredFields&lt;/b&gt;(Class.java:1916)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;org.apache.hadoop.util.ReflectionUtils.getDeclaredFieldsIncludingInherited(ReflectionUtils.java:353)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;org.apache.hadoop.metrics2.lib.MetricsSourceBuilder.&amp;lt;init&amp;gt;(MetricsSourceBuilder.java:68)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;org.apache.hadoop.metrics2.lib.MetricsAnnotations.newSourceBuilder(MetricsAnnotations.java:43)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;org.apache.hadoop.metrics2.impl.MetricsSystemImpl.register(MetricsSystemImpl.java:223)&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;org.apache.hadoop.metrics2.impl.TestMetricsSystemImpl.testInitFirstVerifyCallBacks(TestMetricsSystemImpl.java:156)&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The specification about getDeclaredFields() says that &quot;the elements in the returned array are not sorted and are not in any particular order&quot;. The documentation is here for your reference: &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredFields--&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredFields--&lt;/a&gt;&lt;br/&gt;
 And the behaviour might be different for different JVM versions or vendors&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The fix is to sort the fields returned by getDeclaredFields() so that the non-deterministic behaviour can be eliminated completely. In this way, the test becomes more stable and it will not suffer from the failure above any more.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13288733">HADOOP-16897</key>
            <summary>Sort fields in ReflectionUtils.java</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cpugputpu">cpugputpu</assignee>
                                    <reporter username="cpugputpu">cpugputpu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Mar 2020 10:09:53 +0000</created>
                <updated>Mon, 2 Mar 2020 18:08:36 +0000</updated>
                            <resolved>Mon, 2 Mar 2020 17:54:59 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>test</component>
                    <component>util</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17049499" author="stevel@apache.org" created="Mon, 2 Mar 2020 17:55:00 +0000"  >&lt;p&gt;fixed in trunk -thanks!&lt;/p&gt;</comment>
                            <comment id="17049508" author="hudson" created="Mon, 2 Mar 2020 18:08:36 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #18020 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/18020/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/18020/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-16897&quot; title=&quot;Sort fields in ReflectionUtils.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-16897&quot;&gt;&lt;del&gt;HADOOP-16897&lt;/del&gt;&lt;/a&gt;. Sort fields in ReflectionUtils.java. (github: rev 5678b19b016934fecfb16177c849668d642c9c7a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/ReflectionUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0c28w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>