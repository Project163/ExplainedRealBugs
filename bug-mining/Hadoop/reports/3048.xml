<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:59:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-18090] Exclude com/jcraft/jsch classes from being shaded/relocated</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-18090</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;Spark 3.2.0 transitively introduces hadoop-client-api and hadoop-client-runtime dependencies.&lt;/p&gt;

&lt;p&gt;When we create a SFTPFileSystem instance (org.apache.hadoop.fs.sftp.SFTPFileSystem) it tries to load the relocated classes from &lt;em&gt;com.jcraft.jsch&lt;/em&gt; package.&lt;/p&gt;

&lt;p&gt;The filesystem instance creation fails with error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.ClassNotFoundException: org.apache.hadoop.shaded.com.jcraft.jsch.SftpException
&#160; &#160; at java.net.URLClassLoader.findClass(URLClassLoader.java:382)
&#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:424)
&#160; &#160; at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:349)
&#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:357) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Excluding client from transitive load of spark and directly using hadoop-common/hadoop-client is the way its working for us.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13424131">HADOOP-18090</key>
            <summary>Exclude com/jcraft/jsch classes from being shaded/relocated</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="manojkumarvohra9">mkv</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 22 Jan 2022 09:17:58 +0000</created>
                <updated>Thu, 6 Nov 2025 12:33:25 +0000</updated>
                            <resolved>Thu, 6 Nov 2025 12:33:25 +0000</resolved>
                                    <version>3.3.1</version>
                                    <fixVersion>3.5.0</fixVersion>
                                    <component>build</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17481598" author="manojkumarvohra9" created="Tue, 25 Jan 2022 07:11:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;busbey&lt;/a&gt; Can this be accepted as a bug?&lt;/p&gt;</comment>
                            <comment id="17481853" author="busbey" created="Tue, 25 Jan 2022 14:23:53 +0000"  >&lt;p&gt;I&apos;m not sure what kind of validation you&apos;re looking for. Generally, just about anyone can submit things as a bug against hadoop (as you have done here). I believe you have filed it against the correct component.&lt;/p&gt;

&lt;p&gt;If you mean &quot;can someone fix this&quot;, that&apos;s all done essentially by folks volunteering. If no one picks up this issue you might try discussing it on the dev list. It will get much more attention if you attempt to fix things.&lt;/p&gt;

&lt;p&gt;To me, this looks like a mismatch in expectations around SFTPFileSystem and our classpath isolated client libraries. The two questions that I would work out are&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;&lt;em&gt;should&lt;/em&gt; SFTPFileSystem be included in the client libraries or is it misplaced? This feels akin to the issue we had with s3a in &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-16080&quot; title=&quot;hadoop-aws does not work with hadoop-client-api&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-16080&quot;&gt;&lt;del&gt;HADOOP-16080&lt;/del&gt;&lt;/a&gt; and ideally solved akin to &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-15387&quot; title=&quot;Produce a shaded hadoop-cloud-storage JAR for applications to use&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-15387&quot;&gt;HADOOP-15387&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Presuming this should stay where it is, fixing it means changing the set of included relocated classes. Why isn&apos;t this class already present if it&apos;s reachable from a class we include? How extensive a change is correcting that.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17481871" author="manojkumarvohra9" created="Tue, 25 Jan 2022 14:57:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;busbey&lt;/a&gt; For the second question why the class isn&apos;t reachable, it seems hadoop-client-api has a compile time dependency on hadoop-common which gets shaded because of pattern.&lt;br/&gt;
However there are many transitive dependencies of hadoop-common which are excluded. The list of exlusions comprise &lt;em&gt;com.jcraft:jsch&lt;/em&gt;.&lt;br/&gt;
Hence in SFTPFileSystem, the pattern matching rewrites the imports to relocated path while at the same time the classes which were supposed to be relocated were excluded from POM. &lt;br/&gt;
Sheer text replacement without any class reloaction.&lt;/p&gt;

&lt;p&gt;Regarding first point, SFTPFileSystem is a part of hadoop-common. Now it would be good to have it land in its own module unlike hadoop-aws.&lt;/p&gt;

&lt;p&gt;For fixes, I am new in this space that&apos;s why was just checking if this is indeed a bug. I know in OSS community solves the issues. Not asking you to fix &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="18035711" author="githubbot" created="Thu, 6 Nov 2025 00:23:26 +0000"  >&lt;p&gt;github-actions&lt;span class=&quot;error&quot;&gt;&amp;#91;bot&amp;#93;&lt;/span&gt; commented on PR #4700:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4700#issuecomment-3494233982&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4700#issuecomment-3494233982&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   We&apos;re closing this stale PR because it has been open for 100 days with no activity. This isn&apos;t a judgement on the merit of the PR in any way. It&apos;s just a way of keeping the PR queue manageable.&lt;br/&gt;
   If you feel like this was a mistake, or you would like to continue working on it, please feel free to re-open it and ask for a committer to remove the stale tag and review again.&lt;br/&gt;
   Thanks all for your contribution.&lt;/p&gt;

</comment>
                            <comment id="18035816" author="githubbot" created="Thu, 6 Nov 2025 12:32:37 +0000"  >&lt;p&gt;steveloughran merged PR #4700:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4700&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="18035817" author="githubbot" created="Thu, 6 Nov 2025 12:33:15 +0000"  >&lt;p&gt;steveloughran commented on PR #4700:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/hadoop/pull/4700#issuecomment-3497054161&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4700#issuecomment-3497054161&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   merged. @tiki-sk can you do a cherrypick to branch-3.4, submit it as a PR and if yetus is happy I will merge there too. thanks!&lt;/p&gt;

</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0yu4g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>