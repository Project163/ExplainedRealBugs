<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:44:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-10158] SPNEGO should work with multiple interfaces/SPNs.</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-10158</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;This is the list of internal servlets added by namenode.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Name &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Auth &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Need to be accessible by end users &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; StartupProgressServlet &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; none &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; no &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; GetDelegationTokenServlet &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; internal SPNEGO &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; yes &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; RenewDelegationTokenServlet &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; internal SPNEGO &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; yes &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  CancelDelegationTokenServlet &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; internal SPNEGO &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; yes &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  FsckServlet &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; internal SPNEGO &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; yes &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  GetImageServlet &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; internal SPNEGO &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; no &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  ListPathsServlet &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; token in query &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; yes &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  FileDataServlet &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; token in query &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; yes &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  FileChecksumServlets &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; token in query &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; yes &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; ContentSummaryServlet &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; token in query &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; yes &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;GetDelegationTokenServlet, RenewDelegationTokenServlet, CancelDelegationTokenServlet and FsckServlet are accessed by end users, but hard-coded to use the internal SPNEGO filter.&lt;/p&gt;

&lt;p&gt;If a name node HTTP server binds to multiple external IP addresses, the internal SPNEGO service principal name may not work with an address to which end users are connecting.  The current SPNEGO implementation in Hadoop is limited to use a single service principal per filter.&lt;/p&gt;

&lt;p&gt;If the underlying hadoop kerberos authentication handler cannot easily be modified, we can at least create a separate auth filter for the end-user facing servlets so that their service principals can be independently configured. If not defined, it should fall back to the current behavior.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12682724">HADOOP-10158</key>
            <summary>SPNEGO should work with multiple interfaces/SPNs.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="daryn">Daryn Sharp</assignee>
                                    <reporter username="kihwal">Kihwal Lee</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Dec 2013 16:59:57 +0000</created>
                <updated>Sun, 6 Nov 2016 06:28:29 +0000</updated>
                            <resolved>Thu, 8 May 2014 18:28:56 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.5.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="13839419" author="kihwal" created="Wed, 4 Dec 2013 22:35:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daryn&quot; class=&quot;user-hover&quot; rel=&quot;daryn&quot;&gt;daryn&lt;/a&gt; thinks the kerberos auth handler may be modified to automatically pick the right principal and login on-demand if needed.  If the principal is not found in the keytab file, it will reject the client.  If this works, multi-SPN support will be possible by just adding right entries to the keytab without involving any upper layer changes (e.g. NameNodeHttpServer).&lt;/p&gt;</comment>
                            <comment id="13839506" author="wheat9" created="Wed, 4 Dec 2013 23:58:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-5570&quot; title=&quot;Deprecate hftp / hsftp and replace them with webhdfs / swebhdfs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-5570&quot;&gt;&lt;del&gt;HDFS-5570&lt;/del&gt;&lt;/a&gt; proposes to remove GetDelegationTokenServlet, RenewDelegationTokenServlet, CancelDelegationTokenServlet, ListPathsServlet, FileDataServlet, FileChecksumServlets, ContentSummaryServlet. Does it make things easier?&lt;/p&gt;</comment>
                            <comment id="13840676" author="kihwal" created="Thu, 5 Dec 2013 23:09:16 +0000"  >&lt;p&gt;The main thing is FsckServlet and the token sevlets. I do not care much about others, but was going to do them for the completeness.  We are experimenting with a change in kerberos auth handler, which will require no change in HDFS.  I think we will move this jira to the common project and update the tile eventually.&lt;/p&gt;</comment>
                            <comment id="13866874" author="daryn" created="Thu, 9 Jan 2014 18:22:04 +0000"  >&lt;p&gt;This patch allows multiple principals to be specified via the existing conf key.  There&apos;s effectively no functional change if only 1 principal is supplied.&lt;/p&gt;

&lt;p&gt;The main changes to the auth handler are:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Support logging in as multiple principals&lt;/li&gt;
	&lt;li&gt;Create the SPNEGO service principal based on the incoming interface&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;No tests due to inherent difficulty of writing portable tests that require multi-interface hosts.  It has been tested internally on secure grids.&lt;/p&gt;</comment>
                            <comment id="13866898" author="tucu00" created="Thu, 9 Jan 2014 18:47:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daryn&quot; class=&quot;user-hover&quot; rel=&quot;daryn&quot;&gt;daryn&lt;/a&gt;, looks good, a few things though:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;how about using a different config property &apos;principals&apos; when using multiple principals. And leave the current &apos;principal&apos; for just one.&lt;/li&gt;
	&lt;li&gt;the serverName value should be lowercased before creating the service principal.&lt;/li&gt;
	&lt;li&gt;can the serverName be NULL? if so, what is the behavior then?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13866917" author="hadoopqa" created="Thu, 9 Jan 2014 19:08:03 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12622229/HADOOP-10158.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12622229/HADOOP-10158.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-auth hadoop-common-project/hadoop-common:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.security.authentication.server.TestAltKerberosAuthenticationHandler&lt;br/&gt;
                  org.apache.hadoop.metrics2.impl.TestMetricsSystemImpl&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3415//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3415//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3415//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3415//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13875261" author="benoyantony" created="Fri, 17 Jan 2014 21:13:32 +0000"  >&lt;p&gt;I have tested this patch on our test cluster and works for me. &lt;br/&gt;
I had to make a small change since we have an additional SPN in different realm. &lt;br/&gt;
 For reference, I am attaching the patch with change I had to make. It will be great if this requirement  (principal in a different realm) can be accommodated .&lt;/p&gt;</comment>
                            <comment id="13875266" author="benoyantony" created="Fri, 17 Jan 2014 21:15:23 +0000"  >&lt;p&gt;The change &lt;br/&gt;
1. store the principals in map servername-&amp;gt;SPN in &lt;em&gt;init&lt;/em&gt;&lt;br/&gt;
2. Lookup SPN using servername in the URL&lt;/p&gt;</comment>
                            <comment id="13875272" author="tucu00" created="Fri, 17 Jan 2014 21:26:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benoyantony&quot; class=&quot;user-hover&quot; rel=&quot;benoyantony&quot;&gt;benoyantony&lt;/a&gt;, I&apos;ve quickly looked at your updated the patch but I don&apos;t see my comments being addressed, right?&lt;/p&gt;</comment>
                            <comment id="13875275" author="benoyantony" created="Fri, 17 Jan 2014 21:27:13 +0000"  >&lt;p&gt;Here is the difference in the KerberosAuthenticationHandler&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff KerberosAuthenticationHandler.java.new KerberosAuthenticationHandler.java.prev

&amp;lt;   Map&amp;lt;String,String&amp;gt; server_principalMap = new HashMap&amp;lt;String,String&amp;gt;();
190,192d188
&amp;lt;         String[] parts = servicePrincipal.split(&quot;[/@]&quot;);
&amp;lt;         LOG.trace(&quot;mapping &quot;+ parts[1] + &quot; to &quot; + servicePrincipal);
&amp;lt;         server_principalMap.put(parts[1], servicePrincipal);
327c323
&amp;lt;                 	  server_principalMap.get(serverName),
---
&amp;gt;                       KerberosUtil.getServicePrincipal(&quot;HTTP&quot;, serverName),

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13875278" author="benoyantony" created="Fri, 17 Jan 2014 21:30:40 +0000"  >&lt;p&gt;Sorry &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tucu00&quot; class=&quot;user-hover&quot; rel=&quot;tucu00&quot;&gt;tucu00&lt;/a&gt;, I did not  . I am not taking the feature over from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daryn&quot; class=&quot;user-hover&quot; rel=&quot;daryn&quot;&gt;daryn&lt;/a&gt; unless he wants me to.&lt;/p&gt;</comment>
                            <comment id="13875284" author="hadoopqa" created="Fri, 17 Jan 2014 21:37:42 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12623727/HADOOP-10158_multiplerealms.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12623727/HADOOP-10158_multiplerealms.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-auth:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.security.authentication.server.TestAltKerberosAuthenticationHandler&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3444//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3444//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3444//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3444//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13875307" author="hadoopqa" created="Fri, 17 Jan 2014 22:07:24 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12623729/HADOOP-10158_multiplerealms.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12623729/HADOOP-10158_multiplerealms.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-auth hadoop-common-project/hadoop-common:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.security.authentication.server.TestAltKerberosAuthenticationHandler&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3445//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3445//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3445//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3445//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13875315" author="daryn" created="Fri, 17 Jan 2014 22:17:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tucu00&quot; class=&quot;user-hover&quot; rel=&quot;tucu00&quot;&gt;tucu00&lt;/a&gt;, I&apos;m a bit hesitant to add yet another config key when extending the existing key to support multiple values seems straightforward and compatible.  If there were two keys and both are defined, what should we do?  Parse them both?&lt;/p&gt;

&lt;p&gt;KerberosUtil.getServicePrincipal is already handling the lowercasing and subbing of null with the hostname.&lt;/p&gt;

&lt;p&gt;I&apos;ll look at Benoy&apos;s patch too.&lt;/p&gt;</comment>
                            <comment id="13875321" author="tucu00" created="Fri, 17 Jan 2014 22:21:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daryn&quot; class=&quot;user-hover&quot; rel=&quot;daryn&quot;&gt;daryn&lt;/a&gt;, my problem with the current key is that it implies ONE principal as it is singular. How about adding &apos;principals&apos; and deprecating &apos;principal&apos; in favor of &apos;principals&apos;?&lt;/p&gt;</comment>
                            <comment id="13875336" author="daryn" created="Fri, 17 Jan 2014 22:34:48 +0000"  >&lt;p&gt;Deprecation is a good idea.  We may want to consider just host and maybe realm to satisfy Benoy&apos;s use case.  The reason being that spnego mandates HTTP/host@realm as the principal, so letting someone specify something other than HTTP is just letting them shoot themselves in the foot - although I&apos;ve been abusing it for negative testing. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Going back to the realm, I wonder if there&apos;s a way to let java figure out the realm instead of blindly assuming the default realm?  We should see if LoginContext given HTTP/host will find the correct keytab entry instead of assuming default realm.&lt;/p&gt;

&lt;p&gt;Additionally, my first idea was to look for principals for all the interfaces to which the web server is bound.  If that&apos;s possible, no configuration key would be required at all...&lt;/p&gt;</comment>
                            <comment id="13876575" author="tucu00" created="Mon, 20 Jan 2014 16:56:27 +0000"  >&lt;p&gt;We should mandate HTTP. &lt;/p&gt;

&lt;p&gt;Regarding different realms, then we verify, in the provided principals, there are no 2 principals with same host and different realm, as the only way to determine the realm is indirectly via the host extracted from the request URL.&lt;/p&gt;</comment>
                            <comment id="13879295" author="daryn" created="Wed, 22 Jan 2014 22:44:08 +0000"  >&lt;p&gt;I&apos;ll look into this further.  I&apos;ve been distracted by other SPNEGO issues as of late.&lt;/p&gt;</comment>
                            <comment id="13881403" author="benoyantony" created="Fri, 24 Jan 2014 20:31:10 +0000"  >&lt;p&gt;Attaching a patch with the following changes for consideration:&lt;/p&gt;

&lt;p&gt;1.  Add &lt;em&gt;getServerPrincipals&lt;/em&gt; method in &lt;em&gt;SecurityUtil&lt;/em&gt; which handles multiple principals&lt;br/&gt;
2. Invoked it from &lt;em&gt;NameNodeHttpServer&lt;/em&gt; (for webhdfs) and &lt;em&gt;AuthenticationFilterInitializer&lt;/em&gt;  (for external urls)  in addition to &lt;em&gt;HttpServer&lt;/em&gt; (for internal urls)&lt;/p&gt;</comment>
                            <comment id="13881810" author="hadoopqa" created="Sat, 25 Jan 2014 11:03:17 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12625103/HADOOP-10158_multiplerealms.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12625103/HADOOP-10158_multiplerealms.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-auth hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.security.authentication.server.TestAltKerberosAuthenticationHandler&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3468//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3468//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3468//artifact/trunk/patchprocess/newPatchFindbugsWarningshadoop-common.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3468//artifact/trunk/patchprocess/newPatchFindbugsWarningshadoop-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3468//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3468//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13882986" author="daryn" created="Mon, 27 Jan 2014 17:30:17 +0000"  >&lt;p&gt;I&apos;ve got a new patch that automatically logs in spnego principals w/o a config key and handles different realms.  I was hung up hacking minikdc to support testing multiple realms before other spnego issues sidetracked me.  I&apos;ll post a patch later today although the multi-realm minikdc changes might not make it in.&lt;/p&gt;</comment>
                            <comment id="13885854" author="daryn" created="Wed, 29 Jan 2014 21:44:00 +0000"  >&lt;p&gt;Dynamically use spnego principals in the keytab, including realm discovery for the service hosts.  Ideally the existing principal conf key can be removed in a future jira.  For now/compatibility, the principal will be immediately logged if the key is set.&lt;/p&gt;

&lt;p&gt;Introduced a &lt;tt&gt;SpnegoLoginManager&lt;/tt&gt; that caches the interface&apos;s hostname to a &lt;tt&gt;SpnegoLogin&lt;/tt&gt;.  &lt;tt&gt;SpnegoLogin&lt;/tt&gt; contains a &lt;tt&gt;LoginContext&lt;/tt&gt; or the exception that caused the login failure.  This allows negative caching of failed interface hostnames, and returns the same exception to subsequent clients.&lt;/p&gt;

&lt;p&gt;It&apos;s been tested on our secure clusters.  @Benoy, would you please verify the multi-realm support works? I tried to write tests by adding multi-realm support to minikdc which mostly worked with a bit of manual hackery.  I then realized that a unit test has no hope of working on an offline machine - there&apos;s not an interface other than localhost for using a second realm.&lt;/p&gt;</comment>
                            <comment id="13885928" author="hadoopqa" created="Wed, 29 Jan 2014 22:37:54 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12625980/HADOOP-10158.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12625980/HADOOP-10158.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-auth.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3501//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3501//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3501//artifact/trunk/patchprocess/newPatchFindbugsWarningshadoop-auth.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3501//artifact/trunk/patchprocess/newPatchFindbugsWarningshadoop-auth.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3501//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3501//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13886813" author="benoyantony" created="Thu, 30 Jan 2014 17:38:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daryn&quot; class=&quot;user-hover&quot; rel=&quot;daryn&quot;&gt;daryn&lt;/a&gt; I have reviewed the patch. Thanks for the effort put in to satisfy our requirements.&lt;/p&gt;

&lt;p&gt;This will not work for us since the patch canonicalizes the hostname with the call &lt;em&gt;request.getLocalName()&lt;/em&gt;. This restricts the server principals that can be used to the canonicalized one.  If I have CNAME to HOSTNAME and want to authenticate with  both &lt;/p&gt;
{HTTP/CNAME, HTTP/HOSTNAME}
&lt;p&gt; then that will not work. &lt;em&gt;request.getLocalName()&lt;/em&gt;  will always return HOSTNAME. &lt;/p&gt;

&lt;p&gt;An alternate implementation can be like this:&lt;/p&gt;

&lt;p&gt;1. During init, login all the principals specified in principal conf key . If no principals are specified, read all principals matching HTTP/&lt;b&gt;@&lt;/b&gt; from keytab and login all of them and cache them with a servername-Realm map&lt;br/&gt;
This avoids any synchronization , caching and Realm determination.  This is an optional improvement. If needed, I can provide an implementation for this. &lt;/p&gt;

&lt;p&gt;2. In authenticate, look up a principal with &lt;em&gt;request.getServerName() _ in addition to  _request.getLocalName()&lt;/em&gt;  .  This is required for us to work. This removes the canonicalization issue. &lt;/p&gt;</comment>
                            <comment id="13888020" author="daryn" created="Fri, 31 Jan 2014 19:04:29 +0000"  >&lt;p&gt;CNAMEs are rather problematic for spnego because the RFC doesn&apos;t specify behavior.  Historically service principals are considered/expected to use the canonicalized hostname.  The client resolves the host to ip and ip back to host to get the FQDN for the service principal.  For example, I believe Firefox and Safari canonicalize while Chrome does not.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;I don&apos;t think there&apos;s a way in java to dynamically discover all the principals in the keytab.  I wanted to do that but couldn&apos;t find a way to do so.  Did you?  If yes, I&apos;ll happily build a static cache.&lt;/li&gt;
	&lt;li&gt;I originally used request.getLocalName() but there&apos;s a problem.  I use negative entries to avoid clients causing the server to repeatedly try to login.  A malicious client can flood the server with bogus hostnames via the Host: header which will cause the negative cache entries to grow w/o bound until the server OOMs.  Using the interface&apos;s hostname prevents this problem.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;If #1 can be solved, a static cache requires no negative entries in which case we can safely use the Host: header.&lt;/p&gt;</comment>
                            <comment id="13888182" author="benoyantony" created="Fri, 31 Jan 2014 21:24:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daryn&quot; class=&quot;user-hover&quot; rel=&quot;daryn&quot;&gt;daryn&lt;/a&gt; , &lt;/p&gt;

&lt;p&gt;I added a utility method in &lt;em&gt;KerberosUtil&lt;/em&gt;  which reads a keytab file and returns all the principal names in it. Also wrote a unit test. &lt;br/&gt;
If it looks good , I can provide a method which returns principals for a specified short name (eg. HTTP) .&lt;/p&gt;</comment>
                            <comment id="13888206" author="hadoopqa" created="Fri, 31 Jan 2014 21:48:01 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12626384/HADOOP-10158-readkeytab.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12626384/HADOOP-10158-readkeytab.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;&lt;/font&gt;-1 javac&lt;font color=&quot;red&quot;&gt;&lt;/font&gt;.  The patch appears to cause the build to fail.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3513//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3513//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13888266" author="benoyantony" created="Fri, 31 Jan 2014 22:56:36 +0000"  >&lt;p&gt;Attaching the partial  patch which reads principals from keytab. This one compiles fine.&lt;/p&gt;</comment>
                            <comment id="13888300" author="hadoopqa" created="Fri, 31 Jan 2014 23:22:27 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12626404/HADOOP-10158-readkeytab.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12626404/HADOOP-10158-readkeytab.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-auth.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3514//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3514//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3514//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3514//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13888358" author="benoyantony" created="Sat, 1 Feb 2014 00:35:21 +0000"  >&lt;p&gt;Fixed the javadoc warnings and attached the patch in new jira  &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10322&quot; title=&quot;Add ability to read principal names from a keytab&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10322&quot;&gt;&lt;del&gt;HADOOP-10322&lt;/del&gt;&lt;/a&gt;  to avoid  confusion with two different patches in one jira.  Please review it.&lt;/p&gt;</comment>
                            <comment id="13889675" author="tucu00" created="Mon, 3 Feb 2014 17:49:43 +0000"  >&lt;p&gt;KerberosAuthenticationHandler.java:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;loginPrincipal(), it seems it is not considering the case of a &apos;HTTP@REALM&apos; principal and it would assume it is correct.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;getLoginForHost():&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        SpnegoLogin newLogin = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SpnegoLogin(principal);
        spnegoLogin = logins.putIfAbsent(host, newLogin);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (spnegoLogin == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          spnegoLogin = newLogin;
        }
        spnegoLogin.login(keytab);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We should add a comment on the spnegoLogin.login(keytab) invocation that in the case of a race condition the second login attempt is a NOP.&lt;/p&gt;

&lt;p&gt;KerberosUtil.java:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;getRealmForHost(), typo s/retun/return/. Please add an &apos;IMPORTANT:&#8217; comment here explaining we are tapping into implementation specific methods of the Oracle and IBM JDKs, it may break in other JDKs or in future versions, and it may blow if a SecurityManager is in place.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13891164" author="daryn" created="Tue, 4 Feb 2014 20:30:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tucu00&quot; class=&quot;user-hover&quot; rel=&quot;tucu00&quot;&gt;tucu00&lt;/a&gt;, if/after &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10322&quot; title=&quot;Add ability to read principal names from a keytab&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10322&quot;&gt;&lt;del&gt;HADOOP-10322&lt;/del&gt;&lt;/a&gt; is integrated, there won&apos;t be any dynamic login nor negative cache.  It&apos;ll be a static lookup to find the subject for a given host.&lt;/p&gt;</comment>
                            <comment id="13978565" author="daryn" created="Wed, 23 Apr 2014 18:16:25 +0000"  >&lt;p&gt;Will submit when dependency &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10322&quot; title=&quot;Add ability to read principal names from a keytab&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10322&quot;&gt;&lt;del&gt;HADOOP-10322&lt;/del&gt;&lt;/a&gt; is integrated.&lt;/p&gt;</comment>
                            <comment id="13980178" author="benoyantony" created="Thu, 24 Apr 2014 19:58:11 +0000"  >&lt;p&gt;Tested and works for me as well. &lt;br/&gt;
One improvement would be to support multiple principal names via config. &lt;/p&gt;</comment>
                            <comment id="13984686" author="kihwal" created="Tue, 29 Apr 2014 19:30:53 +0000"  >&lt;p&gt;Submitting the patch since the dependency is checked in.&lt;/p&gt;</comment>
                            <comment id="13984986" author="hadoopqa" created="Wed, 30 Apr 2014 00:00:15 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12641527/HADOOP-10158.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12641527/HADOOP-10158.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-auth hadoop-hdfs-project/hadoop-hdfs:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.fs.TestHdfsNativeCodeLoader&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3875//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3875//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3875//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3875//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13986722" author="daryn" created="Thu, 1 May 2014 16:14:24 +0000"  >&lt;p&gt;Native code loader test failure is unrelated.&lt;/p&gt;</comment>
                            <comment id="13992078" author="kihwal" created="Wed, 7 May 2014 18:28:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;One improvement would be to support multiple principal names via config. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We could probably address it in a separate jira. One of the old patches did that, but a reviewer did not want reusing the same config variable.&lt;/p&gt;

&lt;p&gt;+1 for the patch&lt;/p&gt;</comment>
                            <comment id="13992993" author="kihwal" created="Thu, 8 May 2014 18:28:56 +0000"  >&lt;p&gt;Committed to trunk and branch-2.&lt;/p&gt;</comment>
                            <comment id="13993111" author="hudson" created="Thu, 8 May 2014 21:06:58 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-trunk-Commit #5598 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/5598/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/5598/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10158&quot; title=&quot;SPNEGO should work with multiple interfaces/SPNs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10158&quot;&gt;&lt;del&gt;HADOOP-10158&lt;/del&gt;&lt;/a&gt;. SPNEGO should work with multiple interfaces/SPNs. Contributed by Daryn Sharp. (kihwal: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1593362&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1593362&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/server/KerberosAuthenticationHandler.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/server/TestKerberosAuthenticationHandler.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/site/apt/WebHDFS.apt.vm&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13994344" author="hudson" created="Sun, 11 May 2014 00:08:21 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Yarn-trunk #560 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/560/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/560/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10158&quot; title=&quot;SPNEGO should work with multiple interfaces/SPNs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10158&quot;&gt;&lt;del&gt;HADOOP-10158&lt;/del&gt;&lt;/a&gt;. SPNEGO should work with multiple interfaces/SPNs. Contributed by Daryn Sharp. (kihwal: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1593362&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1593362&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/server/KerberosAuthenticationHandler.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/server/TestKerberosAuthenticationHandler.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/site/apt/WebHDFS.apt.vm&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13994375" author="hudson" created="Sun, 11 May 2014 01:34:23 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk #1778 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1778/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1778/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10158&quot; title=&quot;SPNEGO should work with multiple interfaces/SPNs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10158&quot;&gt;&lt;del&gt;HADOOP-10158&lt;/del&gt;&lt;/a&gt;. SPNEGO should work with multiple interfaces/SPNs. Contributed by Daryn Sharp. (kihwal: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1593362&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1593362&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/server/KerberosAuthenticationHandler.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/server/TestKerberosAuthenticationHandler.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/site/apt/WebHDFS.apt.vm&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13994389" author="hudson" created="Sun, 11 May 2014 01:56:50 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Hdfs-trunk #1752 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1752/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1752/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10158&quot; title=&quot;SPNEGO should work with multiple interfaces/SPNs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10158&quot;&gt;&lt;del&gt;HADOOP-10158&lt;/del&gt;&lt;/a&gt;. SPNEGO should work with multiple interfaces/SPNs. Contributed by Daryn Sharp. (kihwal: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1593362&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1593362&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/server/KerberosAuthenticationHandler.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/server/TestKerberosAuthenticationHandler.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/src/site/apt/WebHDFS.apt.vm&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15641275" author="xyao" created="Sun, 6 Nov 2016 06:28:29 +0000"  >&lt;p&gt;The KerberosUtil#getDomainRealm always returns local realm. This prevents server from running principals with foreign realms.&lt;/p&gt;

&lt;p&gt;If we take the approach in some of the earlier patches with a servername-Realm/Principal map and use the principles from this map instead of rebuild SPN with local realm only, that should allow principals from both local realm and foreign realm to be configured and used as before &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10158&quot; title=&quot;SPNEGO should work with multiple interfaces/SPNs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10158&quot;&gt;&lt;del&gt;HADOOP-10158&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;cc: the original contributors &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benoyantony&quot; class=&quot;user-hover&quot; rel=&quot;benoyantony&quot;&gt;benoyantony&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daryn&quot; class=&quot;user-hover&quot; rel=&quot;daryn&quot;&gt;daryn&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kihwal&quot; class=&quot;user-hover&quot; rel=&quot;kihwal&quot;&gt;kihwal&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tucu00&quot; class=&quot;user-hover&quot; rel=&quot;tucu00&quot;&gt;tucu00&lt;/a&gt; for additional thoughts and comments.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12721285">HADOOP-10702</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12692115">HADOOP-10307</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12692627">HADOOP-10322</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12717705">OOZIE-1865</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12626404" name="HADOOP-10158-readkeytab.patch" size="5726" author="benoyantony" created="Fri, 31 Jan 2014 22:56:36 +0000"/>
                            <attachment id="12626384" name="HADOOP-10158-readkeytab.patch" size="5153" author="benoyantony" created="Fri, 31 Jan 2014 21:24:14 +0000"/>
                            <attachment id="12641527" name="HADOOP-10158.patch" size="13558" author="daryn" created="Wed, 23 Apr 2014 18:16:25 +0000"/>
                            <attachment id="12625980" name="HADOOP-10158.patch" size="15648" author="daryn" created="Wed, 29 Jan 2014 21:44:00 +0000"/>
                            <attachment id="12622229" name="HADOOP-10158.patch" size="7064" author="daryn" created="Thu, 9 Jan 2014 18:22:04 +0000"/>
                            <attachment id="12625103" name="HADOOP-10158_multiplerealms.patch" size="12735" author="benoyantony" created="Fri, 24 Jan 2014 20:31:10 +0000"/>
                            <attachment id="12623729" name="HADOOP-10158_multiplerealms.patch" size="7822" author="benoyantony" created="Fri, 17 Jan 2014 21:24:42 +0000"/>
                            <attachment id="12623727" name="HADOOP-10158_multiplerealms.patch" size="6066" author="benoyantony" created="Fri, 17 Jan 2014 21:15:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361981</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qeb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>362276</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12326263">2.5.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>