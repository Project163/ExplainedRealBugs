<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:45:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-11022] User replaced functions get lost 2-3 levels deep (e.g., sbin)</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-11022</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;The code that protects hadoop-env.sh from being re-executed is also causing functions that the user replaced to get overridden with the defaults.  This typically happens when running commands that nest, such as most of the content in sbin.  Just running stuff out of bin (e.g., bin/hdfs --daemon start namenode) does not trigger this behavior.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12737600">HADOOP-11022</key>
            <summary>User replaced functions get lost 2-3 levels deep (e.g., sbin)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aw">Allen Wittenauer</assignee>
                                    <reporter username="aw">Allen Wittenauer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Aug 2014 23:33:22 +0000</created>
                <updated>Thu, 12 May 2016 18:25:13 +0000</updated>
                            <resolved>Tue, 16 Sep 2014 23:06:59 +0000</resolved>
                                    <version>3.0.0-alpha1</version>
                                    <fixVersion>3.0.0-alpha1</fixVersion>
                                    <component>scripts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14114606" author="aw" created="Thu, 28 Aug 2014 23:43:58 +0000"  >&lt;p&gt;The basic problem is the export of HADOOP_ENV_PROCESSED.  This is used to prevent hadoop-env.sh from being re-read.  This protection makes sense if you have, e.g., FOO_OPT=&quot;$FOO_OPTS blah&quot; in this file.  But with the current state of the world, there&apos;s quite a few things going wrong here:&lt;/p&gt;

&lt;p&gt;1. We don&apos;t protect the other *-env.sh files like we do hadoop-env.sh.  i.e., yarn-env.sh will gets re-read multiple times.&lt;br/&gt;
2. This only works correctly because the vars in hadoop-env.sh are also exported.... which is probably the wrong thing to do as well.&lt;br/&gt;
3. Now that there are more than just vars in *-env.sh, the system really does need to re-read *-env.sh to pick those up.&lt;/p&gt;

&lt;p&gt;Some potential solutions worth exploring:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;What happens if we no longer export anything in *-env.sh and re-read them at every command run like we do with the other files?  (This brings Hadoop in line with most other OS utilities.)  One side effect: users upgrading to trunk would need to also remove the export lines as part of upgrading.&lt;/li&gt;
	&lt;li&gt;If we protect all the *-env.sh and move user defined functions to a new file?  This has a lot of potential!  One big problem is what to do about YARN_OPTS.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14114835" author="aw" created="Fri, 29 Aug 2014 04:27:47 +0000"  >&lt;p&gt;This patch implements the last bullet point:&lt;/p&gt;

&lt;p&gt;a) Protects all of the *-env.sh files&lt;br/&gt;
b) Moves user defined functions into a new hadoop-user-functions.sh script&lt;br/&gt;
c) Moves the examples from hadoop-env.sh to hadoop-user-functions.sh.example&lt;br/&gt;
d) Fixes the log rotation example (&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11023&quot; title=&quot;Example hadoop_log_rotate in hadoop-env.sh doesn&amp;#39;t work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11023&quot;&gt;&lt;del&gt;HADOOP-11023&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;The gotcha here is that this assumes that the *-env.sh vars are exported!  This is bw compat with previous versions of Hadoop.  This isn&apos;t ideal, but...&lt;/p&gt;</comment>
                            <comment id="14114844" author="hadoopqa" created="Fri, 29 Aug 2014 04:32:58 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12665209/HADOOP-11022.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12665209/HADOOP-11022.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/4579//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/4579//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14115445" author="aw" created="Fri, 29 Aug 2014 16:46:54 +0000"  >&lt;p&gt;Cancelling this patch since the example rotate function is incorrect.&lt;/p&gt;</comment>
                            <comment id="14115449" author="aw" created="Fri, 29 Aug 2014 16:48:31 +0000"  >&lt;p&gt;Argh, no the patch is fine. NM. not awake yet.&lt;/p&gt;</comment>
                            <comment id="14134320" author="aw" created="Mon, 15 Sep 2014 18:56:08 +0000"  >&lt;p&gt;Note that &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10950&quot; title=&quot;rework  heap management  vars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10950&quot;&gt;&lt;del&gt;HADOOP-10950&lt;/del&gt;&lt;/a&gt; will require more changes.&lt;/p&gt;</comment>
                            <comment id="14136375" author="aw" created="Tue, 16 Sep 2014 22:24:46 +0000"  >&lt;p&gt;Self +1 this one, after having a discussion with another committer about the changes (esp since I&apos;m adding another config file)&lt;/p&gt;</comment>
                            <comment id="14136450" author="aw" created="Tue, 16 Sep 2014 23:06:59 +0000"  >&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                            <comment id="14137092" author="hudson" created="Wed, 17 Sep 2014 11:31:25 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Yarn-trunk #683 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/683/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/683/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11022&quot; title=&quot;User replaced functions get lost 2-3 levels deep (e.g., sbin)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11022&quot;&gt;&lt;del&gt;HADOOP-11022&lt;/del&gt;&lt;/a&gt;. User replaced functions get lost 2-3 levels deep (e.g., sbin) (aw) (aw: rev 7971c97ec18f4fc6504f6a87d9ad02a1f5f01eea)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-hdfs-project/hadoop-hdfs/src/main/bin/hdfs-config.sh&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/bin/hadoop-config.sh&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/bin/hadoop-functions.sh&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/bin/yarn-config.sh&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/conf/hadoop-user-functions.sh.example&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/conf/hadoop-env.sh&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-mapreduce-project/bin/mapred-config.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14137243" author="hudson" created="Wed, 17 Sep 2014 13:46:58 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk #1899 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1899/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1899/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11022&quot; title=&quot;User replaced functions get lost 2-3 levels deep (e.g., sbin)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11022&quot;&gt;&lt;del&gt;HADOOP-11022&lt;/del&gt;&lt;/a&gt;. User replaced functions get lost 2-3 levels deep (e.g., sbin) (aw) (aw: rev 7971c97ec18f4fc6504f6a87d9ad02a1f5f01eea)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/conf/hadoop-user-functions.sh.example&lt;/li&gt;
	&lt;li&gt;hadoop-hdfs-project/hadoop-hdfs/src/main/bin/hdfs-config.sh&lt;/li&gt;
	&lt;li&gt;hadoop-mapreduce-project/bin/mapred-config.sh&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/conf/hadoop-env.sh&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/bin/hadoop-config.sh&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/bin/yarn-config.sh&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/bin/hadoop-functions.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14137270" author="hudson" created="Wed, 17 Sep 2014 13:57:40 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-trunk #1874 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1874/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1874/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11022&quot; title=&quot;User replaced functions get lost 2-3 levels deep (e.g., sbin)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11022&quot;&gt;&lt;del&gt;HADOOP-11022&lt;/del&gt;&lt;/a&gt;. User replaced functions get lost 2-3 levels deep (e.g., sbin) (aw) (aw: rev 7971c97ec18f4fc6504f6a87d9ad02a1f5f01eea)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-mapreduce-project/bin/mapred-config.sh&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/conf/hadoop-env.sh&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/bin/hadoop-functions.sh&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/bin/yarn-config.sh&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/conf/hadoop-user-functions.sh.example&lt;/li&gt;
	&lt;li&gt;hadoop-hdfs-project/hadoop-hdfs/src/main/bin/hdfs-config.sh&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/bin/hadoop-config.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="12737607">HADOOP-11023</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12737002">HADOOP-11010</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12732907">HADOOP-10950</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12665209" name="HADOOP-11022.patch" size="9022" author="aw" created="Fri, 29 Aug 2014 04:27:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 9 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zgrb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>