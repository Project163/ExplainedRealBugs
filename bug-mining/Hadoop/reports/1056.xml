<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:44:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-10277] setfacl -x fails to parse ACL spec if trying to remove the mask entry.</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-10277</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;You should be able to use setfacl -x to remove the mask entry (if also removing all other extended ACL entries).  Right now, this causes a failure to parse the ACL spec due to a bug in &lt;tt&gt;AclEntry#parseAclSpec&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12691127">HADOOP-10277</key>
            <summary>setfacl -x fails to parse ACL spec if trying to remove the mask entry.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vinayakumarb">Vinayakumar B</assignee>
                                    <reporter username="cnauroth">Chris Nauroth</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Jan 2014 21:41:46 +0000</created>
                <updated>Mon, 27 Jan 2014 18:06:24 +0000</updated>
                            <resolved>Mon, 27 Jan 2014 18:06:24 +0000</resolved>
                                    <version>HDFS ACLs (HDFS-4685)</version>
                                    <fixVersion>HDFS ACLs (HDFS-4685)</fixVersion>
                                    <component>fs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13881462" author="cnauroth" created="Fri, 24 Jan 2014 21:57:37 +0000"  >&lt;p&gt;Thank you to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sachinjose2007%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;sachinjose2007@gmail.com&quot;&gt;sachinjose2007@gmail.com&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=renil.joseph&quot; class=&quot;user-hover&quot; rel=&quot;renil.joseph&quot;&gt;renil.joseph&lt;/a&gt; for reporting this bug.&lt;/p&gt;</comment>
                            <comment id="13882181" author="vinayrpet" created="Sun, 26 Jan 2014 05:10:41 +0000"  >&lt;p&gt;Hi Chris,&lt;br/&gt;
I got the issue. &lt;br/&gt;
Issue was &lt;tt&gt;String.split()&lt;/tt&gt; will not add empty trailing strings to parsed array. &lt;br/&gt;
This can be fixed.&lt;/p&gt;

&lt;p&gt;But my doubt is, whether removing the mask is allowed ?&lt;/p&gt;

&lt;p&gt;My setfacl throws error when I try to remove mask entry in my suse linux box&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;vinay@host-10-18-40-99:~&amp;gt; setfacl -x mask:: testAcl/
setfacl: testAcl/: Malformed access ACL `user::rwx,user:vinay:r--,group::r-x,group:users:r-x,other::r-x&apos;: Missing or wrong entry at entry 5
vinay@host-10-18-40-99:~&amp;gt; setfacl -x mask testAcl/
setfacl: testAcl/: Malformed access ACL `user::rwx,user:vinay:r--,group::r-x,group:users:r-x,other::r-x&apos;: Missing or wrong entry at entry 5&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Please validate whether this is correct behaviour or whether we need to support removal of mask entries&lt;/p&gt;</comment>
                            <comment id="13882358" author="cnauroth" created="Sun, 26 Jan 2014 17:16:24 +0000"  >&lt;p&gt;Thanks for volunteering to take this, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vinayrpet&quot; class=&quot;user-hover&quot; rel=&quot;vinayrpet&quot;&gt;vinayrpet&lt;/a&gt;.  I did have a patch in progress, so I&apos;ll just attach the work I&apos;ve done so far and ask you if you want to do anything more with this.&lt;/p&gt;

&lt;p&gt;As part of this patch, I also wanted to refactor &lt;tt&gt;AclEntry#parseAclSpec&lt;/tt&gt; so that the logic of parsing a single entry is in a separate public static method: &lt;tt&gt;AclEntry#parseAclEntry&lt;/tt&gt;.  That&apos;s going to be helpful for the &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-5608&quot; title=&quot;WebHDFS: implement ACL APIs.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-5608&quot;&gt;&lt;del&gt;HDFS-5608&lt;/del&gt;&lt;/a&gt; WebHDFS patch.  I didn&apos;t get the refactoring done yet in this version of the patch.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;But my doubt is, whether removing the mask is allowed ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually, you are correct.  I was incorrect when I said earlier that you can remove the mask to trigger automatic recalculation.  It is invalid to attempt to remove the mask from an ACL that needs it, however, the error should get reported from the server side instead of a failure to parse the ACL spec.  We already have the code to do this in the NameNode in &lt;tt&gt;AclTransformation#buildAndValidateAcl&lt;/tt&gt;.  The parsing still needs to be able to parse a mask entry with no permission, because it is valid to remove the mask entry if you&apos;re also removing all other extended ACL entries (reducing it from an extended ACL back to a minimal ACL).  See below for an example on Linux.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[cnauroth@ubuntu:pts/0] acltest                                                                                     
&amp;gt; getfacl file1
# file: file1
# owner: cnauroth
# group: cnauroth
user::rw-
user:bruce:rwx			#effective:r--
group::rw-			#effective:r--
mask::r--
other::r--

[cnauroth@ubuntu:pts/0] acltest                                                                                     
&amp;gt; setfacl -x mask:: file1
setfacl: file1: Malformed access ACL `user::rw-,user:bruce:rwx,group::rw-,other::r--&apos;: Missing or wrong entry at entry 4

[cnauroth@ubuntu:pts/0] acltest                                                                                     
&amp;gt; setfacl -x mask::,user:bruce: file1

[cnauroth@ubuntu:pts/0] acltest                                                                                     
&amp;gt; getfacl file1
# file: file1
# owner: cnauroth
# group: cnauroth
user::rw-
group::rw-
other::r--
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13882560" author="vinayrpet" created="Mon, 27 Jan 2014 04:23:33 +0000"  >&lt;p&gt;Thanks Chris for clearing the doubt. I will post a patch soon for refactoring as well as the fix.&lt;/p&gt;</comment>
                            <comment id="13882585" author="vinayrpet" created="Mon, 27 Jan 2014 05:33:06 +0000"  >&lt;p&gt;Hi Chris, Attaching the refractored patch. &lt;br/&gt;
Its almost same as your initial work. &lt;br/&gt;
Please review.&lt;/p&gt;</comment>
                            <comment id="13883031" author="cnauroth" created="Mon, 27 Jan 2014 18:06:24 +0000"  >&lt;p&gt;+1.  I committed this to the feature branch.  Vinay, thank you for the patch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12682466">HADOOP-10187</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12686476">HADOOP-10184</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12625278" name="HADOOP-10277.1.patch" size="4815" author="cnauroth" created="Sun, 26 Jan 2014 17:16:24 +0000"/>
                            <attachment id="12625323" name="HADOOP-10277.patch" size="8139" author="vinayakumarb" created="Mon, 27 Jan 2014 05:33:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369870</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rqyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>370172</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12325672">HDFS ACLs (HDFS-4685)</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>