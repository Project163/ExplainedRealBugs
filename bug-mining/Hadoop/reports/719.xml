<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:42:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-8883] Anonymous fallback in KerberosAuthenticator is broken</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-8883</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8855&quot; title=&quot;SSL-based image transfer does not work when Kerberos is disabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8855&quot;&gt;&lt;del&gt;HADOOP-8855&lt;/del&gt;&lt;/a&gt; changed KerberosAuthenticator to handle when the JDK did the SPNEGO already; but this change broke using the fallback authenticator (PseudoAuthenticator) with an anonymous user (see &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1010&quot; title=&quot;Oozie CLI throws an NPE with Hadoop trunk with simple auth&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1010&quot;&gt;&lt;del&gt;OOZIE-1010&lt;/del&gt;&lt;/a&gt;).  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12610375">HADOOP-8883</key>
            <summary>Anonymous fallback in KerberosAuthenticator is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rkanter">Robert Kanter</assignee>
                                    <reporter username="rkanter">Robert Kanter</reporter>
                        <labels>
                            <label>security</label>
                    </labels>
                <created>Thu, 4 Oct 2012 19:21:11 +0000</created>
                <updated>Wed, 7 Jan 2015 21:21:41 +0000</updated>
                            <resolved>Tue, 16 Oct 2012 17:44:48 +0000</resolved>
                                    <version>2.0.3-alpha</version>
                                    <fixVersion>2.0.3-alpha</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="13471715" author="rkanter" created="Mon, 8 Oct 2012 18:13:30 +0000"  >&lt;p&gt;JDK SPNEGO puts the &quot;Authorization&quot; header in the request, so we can check that in the if statement that was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8855&quot; title=&quot;SSL-based image transfer does not work when Kerberos is disabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8855&quot;&gt;&lt;del&gt;HADOOP-8855&lt;/del&gt;&lt;/a&gt;.  &lt;/p&gt;</comment>
                            <comment id="13471763" author="hadoopqa" created="Mon, 8 Oct 2012 18:57:02 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12548267/HADOOP-8883.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12548267/HADOOP-8883.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-auth.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1574//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1574//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/1574//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/1574//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13471824" author="rkanter" created="Mon, 8 Oct 2012 20:08:15 +0000"  >&lt;p&gt;By the way, Jenkins didn&apos;t test it (because its not configured with Kerberos?), but I checked that all tests in &lt;tt&gt;org.apache.hadoop.security.authentication.client.TestKerberosAuthenticator&lt;/tt&gt; pass.  &lt;/p&gt;</comment>
                            <comment id="13477074" author="tucu00" created="Tue, 16 Oct 2012 15:16:27 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13477203" author="tucu00" created="Tue, 16 Oct 2012 17:44:48 +0000"  >&lt;p&gt;Thanks Robert. Committed to trunk and branch-2.&lt;/p&gt;</comment>
                            <comment id="13477204" author="hudson" created="Tue, 16 Oct 2012 17:44:56 +0000"  >&lt;p&gt;Integrated in Hadoop-trunk-Commit #2871 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/2871/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/2871/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8883&quot; title=&quot;Anonymous fallback in KerberosAuthenticator is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8883&quot;&gt;&lt;del&gt;HADOOP-8883&lt;/del&gt;&lt;/a&gt;. Anonymous fallback in KerberosAuthenticator is broken. (rkanter via tucu) (Revision 1398895)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tucu : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398895&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398895&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/client/KerberosAuthenticator.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/client/AuthenticatorTestCase.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/client/TestKerberosAuthenticator.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13477771" author="hudson" created="Wed, 17 Oct 2012 10:40:02 +0000"  >&lt;p&gt;Integrated in Hadoop-Yarn-trunk #6 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/6/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/6/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8883&quot; title=&quot;Anonymous fallback in KerberosAuthenticator is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8883&quot;&gt;&lt;del&gt;HADOOP-8883&lt;/del&gt;&lt;/a&gt;. Anonymous fallback in KerberosAuthenticator is broken. (rkanter via tucu) (Revision 1398895)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tucu : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398895&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398895&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/client/KerberosAuthenticator.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/client/AuthenticatorTestCase.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/client/TestKerberosAuthenticator.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13477840" author="hudson" created="Wed, 17 Oct 2012 13:02:31 +0000"  >&lt;p&gt;Integrated in Hadoop-Hdfs-trunk #1198 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1198/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1198/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8883&quot; title=&quot;Anonymous fallback in KerberosAuthenticator is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8883&quot;&gt;&lt;del&gt;HADOOP-8883&lt;/del&gt;&lt;/a&gt;. Anonymous fallback in KerberosAuthenticator is broken. (rkanter via tucu) (Revision 1398895)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tucu : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398895&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398895&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/client/KerberosAuthenticator.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/client/AuthenticatorTestCase.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/client/TestKerberosAuthenticator.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13477869" author="hudson" created="Wed, 17 Oct 2012 13:21:41 +0000"  >&lt;p&gt;Integrated in Hadoop-Mapreduce-trunk #1228 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1228/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1228/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8883&quot; title=&quot;Anonymous fallback in KerberosAuthenticator is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8883&quot;&gt;&lt;del&gt;HADOOP-8883&lt;/del&gt;&lt;/a&gt;. Anonymous fallback in KerberosAuthenticator is broken. (rkanter via tucu) (Revision 1398895)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tucu : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398895&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1398895&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/main/java/org/apache/hadoop/security/authentication/client/KerberosAuthenticator.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/client/AuthenticatorTestCase.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-auth/src/test/java/org/apache/hadoop/security/authentication/client/TestKerberosAuthenticator.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13807596" author="aklochkov" created="Tue, 29 Oct 2013 02:23:05 +0000"  >&lt;p&gt;Actually JDK does not allow to read the content of &quot;Authorization&quot; request property so this fix doesn&apos;t change the behavior. &lt;/p&gt;

&lt;p&gt;Here&apos;s an extract from OpenJDK 1.7 sources. OpenJDK 1.6 is similar. My experiments with Oracle JDK7 shows the same behavior (the property is not available to the user). &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      249     &lt;span class=&quot;code-comment&quot;&gt;// the following http request headers should NOT have their values
&lt;/span&gt;      250     &lt;span class=&quot;code-comment&quot;&gt;// returned &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; security reasons.
&lt;/span&gt;      251     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] EXCLUDE_HEADERS = {
      252             &lt;span class=&quot;code-quote&quot;&gt;&quot;Proxy-Authorization&quot;&lt;/span&gt;,
      253             &lt;span class=&quot;code-quote&quot;&gt;&quot;Authorization&quot;&lt;/span&gt;
      254     };


     2709     @Override
     2710     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getRequestProperty (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key) {
     2711         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (key == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
     2712             &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
     2713         }
     2714 
     2715         &lt;span class=&quot;code-comment&quot;&gt;// don&apos;t &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; headers containing security sensitive information
&lt;/span&gt;     2716         &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0; i &amp;lt; EXCLUDE_HEADERS.length; i++) {
     2717             &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (key.equalsIgnoreCase(EXCLUDE_HEADERS[i])) {
     2718                 &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
     2719             }
     2720         }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should this Jira be re-opened or another one created?&lt;/p&gt;</comment>
                            <comment id="13807696" author="rkanter" created="Tue, 29 Oct 2013 05:36:40 +0000"  >&lt;p&gt;Looking at that code snippet, it does indeed seem like that the &lt;tt&gt;Authorization&lt;/tt&gt; header would be excluded and return &lt;tt&gt;null&lt;/tt&gt;.  But then it seems weird that this had fixed the problem.  There&apos;s a unit test and we saw it fix the issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/OOZIE-1010&quot; title=&quot;Oozie CLI throws an NPE with Hadoop trunk with simple auth&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OOZIE-1010&quot;&gt;&lt;del&gt;OOZIE-1010&lt;/del&gt;&lt;/a&gt;.  &lt;/p&gt;

&lt;p&gt;Is it possible that OpenJDK 1.7, OpenJDK 1.6, and Oracle JDK 7 exclude the header but Oracle JDK 6 does not?  If so, then this could be a JDK compatibility issue, and we should create a new JIRA to figure out a new way of fixing this.&lt;/p&gt;

&lt;p&gt;Can you check if the unit test in the patch &lt;tt&gt;TestKerberosAuthenticator#testFallbacktoPseudoAuthenticatorAnonymous&lt;/tt&gt; fails on OpenJDK 1.7, OpenJDK 1.6, or Oracle JDK 7?  I&apos;m sure it passes on Oracle JDK 6.  &lt;/p&gt;</comment>
                            <comment id="13808231" author="rkanter" created="Tue, 29 Oct 2013 17:51:16 +0000"  >&lt;p&gt;Alejandro told me offline that he checked and Oracle JDK 1.6 does actually exclude the &lt;tt&gt;Authorization&lt;/tt&gt; header as well.  I know that the patch fixed the problem we were having, so now I&apos;m confused as to why it was even working...  I&apos;ll try to look into this.&lt;/p&gt;</comment>
                            <comment id="13808241" author="aklochkov" created="Tue, 29 Oct 2013 17:59:47 +0000"  >&lt;p&gt;Robert, &lt;tt&gt;TestKerberosAuthenticator#testFallbacktoPseudoAuthenticatorAnonymous&lt;/tt&gt; passes, but it doesn&apos;t verify the presence of the &lt;tt&gt;Authorization&lt;/tt&gt; header, it verifies &lt;em&gt;absence&lt;/em&gt; of it. Effectively the check &quot;conn.getRequestProperty(AUTHORIZATION) != null&quot; would never succeed, so the first block in the code below would never be used. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (conn.getRequestProperty(AUTHORIZATION) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; conn.getResponseCode() == HttpURLConnection.HTTP_OK) {
        LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;JDK performed authentication on our behalf.&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-comment&quot;&gt;// If the JDK already did the SPNEGO back-and-forth &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// us, just pull out the token.
&lt;/span&gt;        AuthenticatedURL.extractToken(conn, token);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isNegotiate()) {
        LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Performing our own SPNEGO sequence.&quot;&lt;/span&gt;);
        doSpnegoSequence(token);
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Using fallback authenticator sequence.&quot;&lt;/span&gt;);
        getFallBackAuthenticator().authenticate(url, token);
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can you please give me more context on why it is needed to do &quot;manual&quot; authorization, i.e. why JDK does not do the authentication every time, i.e. in what cases &lt;tt&gt;KerberosAuthenticator.doSpnegoSequence&lt;/tt&gt;  should be used? I&apos;m interested in this as we&apos;re fighting with a related issue - in some circumstances JDK just stops doing the authentication we rely on (it stops caching tokens), and so all requests associated with &lt;tt&gt;HttpOpParam.Op&lt;/tt&gt; instances with {requreAuth==false}} start failing &amp;#8211; effectively, it&apos;s all operations except &lt;tt&gt;GETDELEGATIONTOKEN&lt;/tt&gt;. If &lt;tt&gt;o.a.h.hdfs.web.URLConnectionFactory.openConnection&lt;/tt&gt; used &lt;tt&gt;KerberosAuthenticator&lt;/tt&gt; for all operations (not just getting delegation tokens), then we wouldn&apos;t have the problem. So I&apos;m wondering who can shed some light on how JDK is supposed to handle that, and in what cases &lt;tt&gt;KerberosAuthenticator.doSpnegoSequence&lt;/tt&gt; is really needed. Sorry, it&apos;s not related directly to this issue, I&apos;m just trying to find who can have answers.&lt;/p&gt;</comment>
                            <comment id="13810561" author="rkanter" created="Thu, 31 Oct 2013 19:03:30 +0000"  >&lt;p&gt;I was talking to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tucu00&quot; class=&quot;user-hover&quot; rel=&quot;tucu00&quot;&gt;tucu00&lt;/a&gt; about this, and he could go into more detail, but from what I understand, the JDK doesn&apos;t quite implement the spec correctly, and in some cases it will do SPNEGO when we weren&apos;t expecting it to yet.  So, while we can do it again (as the code always does now), that&apos;s wasteful and we can just extract the token in that case (what the code is supposed to be doing).  &lt;/p&gt;

&lt;p&gt;In any case, you are correct that the first &lt;tt&gt;if&lt;/tt&gt; block is never executed because of the change introduced by this JIRA.  I&apos;ll work on a fix for that and create a new JIRA soon.  &lt;/p&gt;</comment>
                            <comment id="13810713" author="rkanter" created="Thu, 31 Oct 2013 21:13:29 +0000"  >&lt;p&gt;I created &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10078&quot; title=&quot;KerberosAuthenticator always does SPNEGO&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10078&quot;&gt;&lt;del&gt;HADOOP-10078&lt;/del&gt;&lt;/a&gt; to fix the if statement.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12765466">HADOOP-11467</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12676957">HADOOP-10078</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12610174">OOZIE-1010</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12609289">HADOOP-8855</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12548267" name="HADOOP-8883.patch" size="3470" author="rkanter" created="Mon, 8 Oct 2012 18:13:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>240756</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i015bz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4633</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>