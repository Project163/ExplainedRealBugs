<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:45:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-10996] Stop violence in the *_HOME</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-10996</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;(Updated from original description)&lt;/p&gt;

&lt;p&gt;There are various places where the various HOME directories are missing or mis-defined. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12735965">HADOOP-10996</key>
            <summary>Stop violence in the *_HOME</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aw">Allen Wittenauer</assignee>
                                    <reporter username="aw">Allen Wittenauer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Aug 2014 01:21:55 +0000</created>
                <updated>Thu, 12 May 2016 18:25:40 +0000</updated>
                            <resolved>Wed, 27 Aug 2014 03:34:02 +0000</resolved>
                                    <version>3.0.0-alpha1</version>
                                    <fixVersion>3.0.0-alpha1</fixVersion>
                                    <component>scripts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14106305" author="aw" created="Fri, 22 Aug 2014 01:29:44 +0000"  >&lt;p&gt;(Source: &lt;a href=&quot;https://issues.apache.org/jira/secure/EditComment!default.jspa?id=12665400&amp;amp;commentId=14106278&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/EditComment!default.jspa?id=12665400&amp;amp;commentId=14106278&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Given this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ export HADOOP_COMMON_HOME=$(pwd)/$(ls -d hadoop-common-project/hadoop-common/target/hadoop-common-*/)
$ export HADOOP_HDFS_HOME=$(pwd)/$(ls -d hadoop-hdfs-project/hadoop-hdfs/target/hadoop-hdfs-*/)
$ export PATH=$HADOOP_COMMON_HOME/bin:$HADOOP_HDFS_HOME/bin:$PATH
$ hdfs
ERROR: Unable to exec (path)target/hadoop-hdfs-3.0.0-SNAPSHOT/bin/../libexec/hadoop-functions.sh.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;How do we make hdfs work properly?&lt;/p&gt;

&lt;p&gt;First, what is happening?&lt;/p&gt;

&lt;p&gt;The code tries to find where to look for hdfs-config.sh is located.  It does this by looking for ../libexec, where it finds it.  It now makes the (false) assumption that this must be the one, true libexec dir.  So it now tries to fire up hadoop-config.sh and hadoop-functions.sh which fail.&lt;/p&gt;

&lt;p&gt;There are a couple of different ways to solve this:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Look to see if HADOOP_COMMON_HOME is defined and look for hadoop-config.sh/hadoop-functions.sh is there as well.&lt;/li&gt;
	&lt;li&gt;Throw caution to the wind and see if this stuff is in our current path.&lt;/li&gt;
	&lt;li&gt;Recalculate HADOOP_LIBEXEC_DIR in hadoop-config.sh might work too, since clearly hdfs found it.&lt;/li&gt;
	&lt;li&gt;Do the full gamut of checks for HADOOP_HDFS_HOME, etc, for hdfs-config.sh + some of the stuff above.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;One sticking point is what happens if hadoop-layout.sh redefines the directory structure?  The code is sort of in a catch-22.&lt;/p&gt;</comment>
                            <comment id="14106321" author="aw" created="Fri, 22 Aug 2014 01:40:38 +0000"  >&lt;p&gt;OK, hdfs-config.sh does to the right thing (although it could be argued the order should be reversed):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; [ -e &lt;span class=&quot;code-quote&quot;&gt;&quot;${HADOOP_LIBEXEC_DIR}/hadoop-config.sh&quot;&lt;/span&gt; ]; then
  . &lt;span class=&quot;code-quote&quot;&gt;&quot;${HADOOP_LIBEXEC_DIR}/hadoop-config.sh&quot;&lt;/span&gt;
elif [ -e &lt;span class=&quot;code-quote&quot;&gt;&quot;${HADOOP_COMMON_HOME}/libexec/hadoop-config.sh&quot;&lt;/span&gt; ]; then
  . &lt;span class=&quot;code-quote&quot;&gt;&quot;${HADOOP_COMMON_HOME}/libexec/hadoop-config.sh&quot;&lt;/span&gt;
elif [ -e &lt;span class=&quot;code-quote&quot;&gt;&quot;${HADOOP_HOME}/libexec/hadoop-config.sh&quot;&lt;/span&gt; ]; then
  . &lt;span class=&quot;code-quote&quot;&gt;&quot;${HADOOP_HOME}/libexec/hadoop-config.sh&quot;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
  echo &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR: Hadoop common not found.&quot;&lt;/span&gt; 2&amp;gt;&amp;amp;1
  exit 1
fi
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it&apos;s really hadoop-config.sh that&apos;s broken here:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# get our functions defined &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; usage later
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; [[ -f &lt;span class=&quot;code-quote&quot;&gt;&quot;${HADOOP_LIBEXEC_DIR}/hadoop-functions.sh&quot;&lt;/span&gt; ]]; then
  . &lt;span class=&quot;code-quote&quot;&gt;&quot;${HADOOP_LIBEXEC_DIR}/hadoop-functions.sh&quot;&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
  echo &lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR: Unable to exec ${HADOOP_LIBEXEC_DIR}/hadoop-functions.sh.&quot;&lt;/span&gt; 1&amp;gt;&amp;amp;2
  exit 1
fi

# allow overrides of the above and pre-defines of the below
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; [[ -f &lt;span class=&quot;code-quote&quot;&gt;&quot;${HADOOP_LIBEXEC_DIR}/hadoop-layout.sh&quot;&lt;/span&gt; ]]; then
  . &lt;span class=&quot;code-quote&quot;&gt;&quot;${HADOOP_LIBEXEC_DIR}/hadoop-layout.sh&quot;&lt;/span&gt;
fi
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is going to be a relatively easy fix, I think.  We just need to add checks for HADOOP_COMMON_HOME prior to using HADOOP_LIBEXEC_DIR.&lt;/p&gt;</comment>
                            <comment id="14106347" author="aw" created="Fri, 22 Aug 2014 01:59:51 +0000"  >&lt;p&gt;Patch that fixes hadoop-config.sh to use HADOOP_COMMON_HOME/libexec if it can&apos;t find it in HADOOP_LIBEXEC_DIR as well as fixes two bugs in HADOOP_HDFS_HOME and HADOOP_MAPRED_HOME definitions when they aren&apos;t defined.&lt;/p&gt;</comment>
                            <comment id="14106350" author="aw" created="Fri, 22 Aug 2014 02:01:10 +0000"  >&lt;p&gt;FWIW, I opted to reverse the order because I remembered why I did it in the other code as well:  in NORMAL operating modes, HADOOP_LIBEXEC_DIR is the correct place.&lt;/p&gt;</comment>
                            <comment id="14106363" author="aw" created="Fri, 22 Aug 2014 02:16:55 +0000"  >

&lt;p&gt;-01:  Wait... wait... wait... We should NOT be using HADOOP_HOME for anything! So let&apos;s fix that too.&lt;/p&gt;</comment>
                            <comment id="14107643" author="hadoopqa" created="Fri, 22 Aug 2014 22:51:46 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12663573/HADOOP-10996-01.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12663573/HADOOP-10996-01.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.ha.TestZKFailoverController&lt;br/&gt;
                  org.apache.hadoop.ha.TestZKFailoverControllerStress&lt;br/&gt;
                  org.apache.hadoop.hdfs.server.namenode.ha.TestPipelinesFailover&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/4533//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/4533//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/4533//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/4533//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14109162" author="aw" created="Mon, 25 Aug 2014 14:53:50 +0000"  >&lt;p&gt;Cancelling patch -01.&lt;/p&gt;

&lt;p&gt;After working with it, I&apos;ve found some edge and not-so-edge cases that either:&lt;/p&gt;

&lt;p&gt;a) are made worse (e.g., usage of *_HOME should be viewed as exceptions to _PREFIX, not as an all or nothing scenario)&lt;br/&gt;
b) aren&apos;t covered (e.g., etc/hadoop/*-site.xml comes from *_HOME)&lt;/p&gt;
</comment>
                            <comment id="14110240" author="aw" created="Tue, 26 Aug 2014 03:56:10 +0000"  >&lt;p&gt;-02:&lt;/p&gt;

&lt;p&gt;Changed up the order. Reduces the amount of stat calls needed by checking if some of the *_HOME vars are defined.&lt;/p&gt;

&lt;p&gt;I started to poke around at enabling *_HOME/etc/hadoop (or whatever), but decided it probably isn&apos;t worth it since it will likely lead to unpredictable results.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andrew.wang&quot; class=&quot;user-hover&quot; rel=&quot;andrew.wang&quot;&gt;andrew.wang&lt;/a&gt;, please try this out and see if it fixes your specific issue. Thanks!&lt;/p&gt;</comment>
                            <comment id="14111738" author="andrew.wang" created="Wed, 27 Aug 2014 01:55:18 +0000"  >&lt;p&gt;Hey Allen, thanks for working on this. What&apos;s your recommendation on where to put config files? Right now I do something like:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;above stuff&amp;gt;
cp -r ~/configs/* $HADOOP_HDFS_HOME/etc/hadoop/
hdfs namenode
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This still works, but your comments about *_HOME/etc/hadoop being unpredictable made me wonder.&lt;/p&gt;

&lt;p&gt;+1 regardless though, thanks again.&lt;/p&gt;</comment>
                            <comment id="14111776" author="aw" created="Wed, 27 Aug 2014 03:27:24 +0000"  >&lt;p&gt;TL;DR: Absolute best bet is to put configs some place and assign HADOOP_CONF_DIR to it so that you have absolute certainty on where Hadoop is pulling settings.  &lt;/p&gt;

&lt;p&gt;Longer story:&lt;/p&gt;

&lt;p&gt;Currently, if HADOOP_CONF_DIR isn&apos;t defined, it uses a bit of interesting logic to locate it:&lt;/p&gt;

&lt;p&gt;1. Figure out where HADOOP_PREFIX is at. Is HADOOP_PREFIX defined? If not, then let&apos;s assume it&apos;s &quot;what&apos;s called us/..&quot;.&lt;br/&gt;
2. Does HADOOP_PREFIX/conf/hadoop-env.sh exist? OK, then that must be HADOOP_CONF_DIR&lt;br/&gt;
3. No? OK, then HADOOP_CONF_DIR must be HADOOP_PREFIX/etc/hadoop.&lt;/p&gt;

&lt;p&gt;What&apos;s fun about this and what you&apos;re doing is that HADOOP_CONF_DIR will get defined differently depending upon which bin dir you are using. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Fine, you say!  Let&apos;s just treat all _HOME/etc/hadoop and _HOME/conf as potentially valid.  Now we have a very interesting problem:  how do you define HADOOP_CONF_DIR?  Other stuff past Hadoop depends upon this being one directory.  We could pick the first one and then just shove the rest in the classpath and none would be the wiser!&lt;/p&gt;

&lt;p&gt;Aha! But they would.  Which one takes precedence? What happens if there are conflicts? etc, etc. It gets messy very very fast. So... ABORT! ABORT!&lt;/p&gt;

&lt;p&gt;(BTW, this is pretty much the same logic from branch-2. It could be argued that there should be a check to see if etc/hadoop is &apos;real&apos; too and abort on it.  Here&apos;s the fun part: the shell code works perfectly fine if -env.sh is empty now... the NN will still crash though.  That said, if &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10879&quot; title=&quot;Rename *-env.sh in the tree to *-env.sh.example&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10879&quot;&gt;&lt;del&gt;HADOOP-10879&lt;/del&gt;&lt;/a&gt; gets finished, this will almost certainly need to get revisited.  Probably better to look for core-site.xml, honestly, since all of the sub-projects all depend upon that.  In other words, we could run through all of the _HOME, HADOOP_PREFIX, etc, and use the first core-site.xml we find as the &apos;real&apos; HADOOP_CONF_DIR.)&lt;/p&gt;</comment>
                            <comment id="14111783" author="aw" created="Wed, 27 Aug 2014 03:34:02 +0000"  >&lt;p&gt;Thanks! I&apos;ll commit this as soon as the git repo opens up!&lt;/p&gt;</comment>
                            <comment id="14111787" author="andrew.wang" created="Wed, 27 Aug 2014 03:37:29 +0000"  >&lt;p&gt;Cool, thanks for the explanation &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; will do that in the future.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12737002">HADOOP-11010</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12663573" name="HADOOP-10996-01.patch" size="4236" author="aw" created="Fri, 22 Aug 2014 02:16:55 +0000"/>
                            <attachment id="12664305" name="HADOOP-10996-02.patch" size="7456" author="aw" created="Tue, 26 Aug 2014 03:56:10 +0000"/>
                            <attachment id="12663572" name="HADOOP-10996.patch" size="2417" author="aw" created="Fri, 22 Aug 2014 01:59:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1z7pz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>