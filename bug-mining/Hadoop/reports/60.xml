<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:32:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-6254] s3n fails with SocketTimeoutException</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-6254</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;If a user&apos;s map function is CPU intensive and doesn&apos;t read from the input very quickly, compounded by the buffering of input, then S3 might think the connection has been lost and will close the connection. Then when the user attempts to read from the input again, they&apos;ll receive a SocketTimeoutException and the task will fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12435482">HADOOP-6254</key>
            <summary>s3n fails with SocketTimeoutException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anhi">Andrew Hitchcock</assignee>
                                    <reporter username="anhi">Andrew Hitchcock</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Sep 2009 22:05:46 +0000</created>
                <updated>Mon, 29 Feb 2016 10:06:41 +0000</updated>
                            <resolved>Wed, 9 Dec 2009 04:17:43 +0000</resolved>
                                    <version>0.18.3</version>
                    <version>0.19.2</version>
                    <version>0.20.1</version>
                                    <fixVersion>0.21.0</fixVersion>
                                    <component>fs/s3</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="12754378" author="anhi" created="Fri, 11 Sep 2009 22:12:55 +0000"  >&lt;p&gt;Here is my proposed fix. This patch doesn&apos;t include a unit test yet.&lt;/p&gt;</comment>
                            <comment id="12755010" author="tomwhite" created="Mon, 14 Sep 2009 14:55:32 +0000"  >&lt;p&gt;Is it possible to set the read timeout on the socket? Setting httpclient.socket-timeout-ms looks like it would do it - &lt;a href=&quot;http://jets3t.s3.amazonaws.com/toolkit/configuration.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jets3t.s3.amazonaws.com/toolkit/configuration.html&lt;/a&gt;. This would mean you can set the timeout to be large but not infinite (although you can make it infinite if you like by setting it to the value of -1), whereas the approach in your patch effectively sets an infinite timeout.&lt;/p&gt;</comment>
                            <comment id="12755218" author="anhi" created="Mon, 14 Sep 2009 22:04:18 +0000"  >&lt;p&gt;I don&apos;t believe the patch sets an infinite timeout. Upon reopening the connection, it tries once and if that fails then the call fails. It doesn&apos;t recurse.&lt;/p&gt;

&lt;p&gt;I think this is better than fiddling with the timeout because now users don&apos;t have to worry about adjusting another setting, this should just work out of the box. In my testing, I was able to reproduce the SocketTimeoutException and this patch reliably fixed it.&lt;/p&gt;</comment>
                            <comment id="12756076" author="tomwhite" created="Wed, 16 Sep 2009 15:22:08 +0000"  >&lt;p&gt;You&apos;re right - your change doesn&apos;t introduce an infinite timeout. But it&apos;s not a particularly general-purpose solution since it effectively doubles the timeout (default 1 minute). It would be simpler to change the default value if lots of folks are hitting this.&lt;/p&gt;

&lt;p&gt;Also, any reason you didn&apos;t catch SocketTimeoutException directly, rather than catching IOException and re-throwing anything that&apos;s not SocketTimeoutException?&lt;/p&gt;</comment>
                            <comment id="12756889" author="anhi" created="Fri, 18 Sep 2009 00:58:10 +0000"  >&lt;p&gt;Hi Tom,&lt;/p&gt;

&lt;p&gt;The problem with changing the socket read timeout is Hadoop tasks can process at an arbitrarily rate, which means that mapper input data from Amazon S3 can be read at an arbitrary rate. There are two timeouts you can hit with Amazon S3 if you leave a socket open for long enough without pulling any data from it:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;You can hit a client side timeout, which is configurable, and appears as a SocketTimeoutException&lt;/li&gt;
	&lt;li&gt;You can hit an Amazon S3 server side timeout, which is not configurable, and appears as a SocketException(&quot;Connection reset by peer&quot;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Just increasing the client side timeout has 4 problems:&lt;/p&gt;

&lt;p&gt;1. Increasing timeouts will keep the connection open longer, whereas what we&apos;re trying to do is give up the connection after a reasonable timeout, but then reopen it when we need it again. This way we&apos;re playing nicer with various system resources.&lt;br/&gt;
2. No matter what we put it at, one can imagine a task pulling data slower, and so encountering this exception&lt;br/&gt;
3. There is some value of the client side timeout above which all that happens is that we get a server side timeout instead&lt;br/&gt;
4. As a generalization you don&apos;t want client socket timeouts to be too big because it is always possible for a server to get &quot;stuck&quot; and stop sending data, in which case you want to recognize this failure in a timely manner via the timeout. (Not that Amazon S3 is known to have any such issues, but its best to be defensive in error handling).&lt;/p&gt;

&lt;p&gt;Thus I now think the best solution is:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Catch all IOExceptions and then retry once&lt;/li&gt;
	&lt;li&gt;Keep the socket timeout at 60 seconds as it seems a reasonable trade-off between the cost of holding a connection open and the cost of reestablishing the connection.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ll prepare a new patch.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="12757488" author="anhi" created="Fri, 18 Sep 2009 22:24:59 +0000"  >&lt;p&gt;This patch incorporates the changes as per our discussion and my last comment. I&apos;ve included a unit test as well. The test necessitated a little refactoring of NativeS3FileSystem. &lt;/p&gt;</comment>
                            <comment id="12757566" author="hadoopqa" created="Sat, 19 Sep 2009 00:41:40 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12420090/HADOOP-6254.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12420090/HADOOP-6254.diff&lt;/a&gt;&lt;br/&gt;
  against trunk revision 816830.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/54/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/54/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/54/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/54/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/54/artifact/trunk/build/test/checkstyle-errors.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/54/artifact/trunk/build/test/checkstyle-errors.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/54/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/54/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12759163" author="tomwhite" created="Thu, 24 Sep 2009 16:19:24 +0000"  >&lt;p&gt;Thanks for the detailed explanation, Andrew. This looks good to me. I had couple of small comments:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Do we need to catch all IOExceptions, or would SocketTimeoutException and SocketException meet the needs of this issue?&lt;/li&gt;
	&lt;li&gt;Minor nit: would be nice to explain in a comment where 144 comes from in the test (128 + 16).&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="12772846" author="chris.douglas" created="Tue, 3 Nov 2009 02:47:33 +0000"  >&lt;p&gt;Cancelling while Tom&apos;s comments are addressed.&lt;/p&gt;</comment>
                            <comment id="12787830" author="anhi" created="Wed, 9 Dec 2009 00:24:05 +0000"  >&lt;p&gt;We could catch both of these Exceptions individually, but it is conceivable that other non-fatal IOExceptions could occur when reading from S3. I&apos;d prefer having it catch all IOExceptions (which encompass SocketTimeoutException and SocketException).&lt;/p&gt;</comment>
                            <comment id="12787832" author="anhi" created="Wed, 9 Dec 2009 00:30:18 +0000"  >&lt;p&gt;New version of the patch. The only difference between the last patch is the addition of two lines of comments to address Tom&apos;s concerns.&lt;/p&gt;</comment>
                            <comment id="12787848" author="hadoopqa" created="Wed, 9 Dec 2009 01:24:13 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12427397/HADOOP-6254-2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12427397/HADOOP-6254-2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision 888565.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h1.grid.sp2.yahoo.net/23/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h1.grid.sp2.yahoo.net/23/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h1.grid.sp2.yahoo.net/23/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h1.grid.sp2.yahoo.net/23/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h1.grid.sp2.yahoo.net/23/artifact/trunk/build/test/checkstyle-errors.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h1.grid.sp2.yahoo.net/23/artifact/trunk/build/test/checkstyle-errors.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h1.grid.sp2.yahoo.net/23/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h1.grid.sp2.yahoo.net/23/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12787906" author="tomwhite" created="Wed, 9 Dec 2009 04:17:43 +0000"  >&lt;p&gt;I&apos;ve just committed this. Thanks Andrew!&lt;/p&gt;</comment>
                            <comment id="12787910" author="hudson" created="Wed, 9 Dec 2009 04:37:25 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk-Commit #101 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Common-trunk-Commit/101/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Common-trunk-Commit/101/&lt;/a&gt;)&lt;br/&gt;
    . Slow reads cause s3n to fail with SocketTimeoutException. Contributed by Andrew Hitchcock.&lt;/p&gt;</comment>
                            <comment id="12788035" author="hudson" created="Wed, 9 Dec 2009 11:11:40 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk #182 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Common-trunk/182/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Common-trunk/182/&lt;/a&gt;)&lt;br/&gt;
    . Slow reads cause s3n to fail with SocketTimeoutException. Contributed by Andrew Hitchcock.&lt;/p&gt;</comment>
                            <comment id="13215922" author="ankushb" created="Fri, 24 Feb 2012 21:23:27 +0000"  >&lt;p&gt;Hi, Can we move this fix to hadoop 0.20.2 branch as well, Hive currently works with 0.20.2 branch and we want this fix there too.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12944934">HADOOP-12844</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12427397" name="HADOOP-6254-2.txt" size="5487" author="anhi" created="Wed, 9 Dec 2009 00:30:18 +0000"/>
                            <attachment id="12420090" name="HADOOP-6254.diff" size="5401" author="anhi" created="Fri, 18 Sep 2009 22:24:59 +0000"/>
                            <attachment id="12419347" name="HADOOP-6254.diff" size="1713" author="anhi" created="Fri, 11 Sep 2009 22:12:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37302</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02ss7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14264</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>