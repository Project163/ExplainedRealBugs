<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:47:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-11295] RPC Server Reader thread can&apos;t shutdown if RPCCallQueue is full</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-11295</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;If RPC server is asked to stop when RPCCallQueue is full, &lt;tt&gt;reader.join()&lt;/tt&gt; will just wait there. That is because&lt;/p&gt;

&lt;p&gt;1. The reader thread is blocked on &lt;tt&gt;callQueue.put(call);&lt;/tt&gt;.&lt;br/&gt;
2. When RPC server is asked to stop, it will interrupt all handler threads and thus no threads will drain the callQueue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12754392">HADOOP-11295</key>
            <summary>RPC Server Reader thread can&apos;t shutdown if RPCCallQueue is full</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mingma">Ming Ma</assignee>
                                    <reporter username="mingma">Ming Ma</reporter>
                        <labels>
                            <label>2.6.1-candidate</label>
                    </labels>
                <created>Tue, 11 Nov 2014 06:50:51 +0000</created>
                <updated>Tue, 30 Aug 2016 01:31:33 +0000</updated>
                            <resolved>Tue, 17 Feb 2015 23:17:08 +0000</resolved>
                                                    <fixVersion>2.6.1</fixVersion>
                    <fixVersion>2.7.0</fixVersion>
                    <fixVersion>3.0.0-alpha1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>15</watches>
                                                                                                                <comments>
                            <comment id="14208801" author="mingma" created="Wed, 12 Nov 2014 22:17:33 +0000"  >&lt;p&gt;The fix is to interrupt the reader threads when RPC Server is stopped.&lt;/p&gt;</comment>
                            <comment id="14208877" author="hadoopqa" created="Wed, 12 Nov 2014 23:21:52 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12681159/HADOOP-11295.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12681159/HADOOP-11295.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 782abbb.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5070//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5070//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5070//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5070//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14252993" author="mingma" created="Fri, 19 Dec 2014 05:43:30 +0000"  >&lt;p&gt;Rebased for trunk. Appreciate any input.&lt;/p&gt;</comment>
                            <comment id="14253061" author="hadoopqa" created="Fri, 19 Dec 2014 06:45:45 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12688254/HADOOP-11295-2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12688254/HADOOP-11295-2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 6635ccd.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 2 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5310//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5310//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5310//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5310//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5310//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5310//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14253785" author="sjlee0" created="Fri, 19 Dec 2014 18:53:20 +0000"  >&lt;p&gt;LGTM. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mingma&quot; class=&quot;user-hover&quot; rel=&quot;mingma&quot;&gt;mingma&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="14253996" author="jira.shegalov" created="Fri, 19 Dec 2014 20:47:00 +0000"  >&lt;p&gt;Thanks for reporting the issue, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mingma&quot; class=&quot;user-hover&quot; rel=&quot;mingma&quot;&gt;mingma&lt;/a&gt;!  The fix in Server.java is correct. &lt;br/&gt;
Some comments to &lt;tt&gt;testRPCServerShutdown&lt;/tt&gt;:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Use of the qualifier &lt;tt&gt;final&lt;/tt&gt; is inconsistent. More variables (conf, clientN) can be made final, or get rid of it.&lt;/li&gt;
	&lt;li&gt;Variable &lt;tt&gt;addr&lt;/tt&gt; is used only once, please inline it as a parameter of &lt;tt&gt;getProxy&lt;/tt&gt; for clarity&lt;/li&gt;
	&lt;li&gt;Don&apos;t swallow &lt;tt&gt;InterruptedException&lt;/tt&gt; around in the &lt;tt&gt;while&lt;/tt&gt; loops around sleep they can be legit. I think It&apos;s fine to to remove try/catch and have the test fail.&lt;/li&gt;
	&lt;li&gt;1000 millis is a little excessive. Let us do 100&lt;/li&gt;
	&lt;li&gt;Move the client interrupt/join logic into the finally block past server.stop. Then you actually don&apos;t need to call client.interrupt  because client calls will exit on its own.&lt;/li&gt;
	&lt;li&gt;Use client.join() without the timeout parameter, we are already protected by the Test timeout from blocking indefinitely.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="14254068" author="mingma" created="Fri, 19 Dec 2014 21:43:38 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jira.shegalov&quot; class=&quot;user-hover&quot; rel=&quot;jira.shegalov&quot;&gt;jira.shegalov&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjlee0&quot; class=&quot;user-hover&quot; rel=&quot;sjlee0&quot;&gt;sjlee0&lt;/a&gt;. Here is the updated patch to address all the comments.&lt;/p&gt;</comment>
                            <comment id="14254161" author="hadoopqa" created="Fri, 19 Dec 2014 22:45:06 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12688424/HADOOP-11295-3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12688424/HADOOP-11295-3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 8fa265a.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 2 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5322//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5322//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5322//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5322//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5322//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5322//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14254417" author="jira.shegalov" created="Sat, 20 Dec 2014 01:20:05 +0000"  >&lt;p&gt;Thanks for updating the patch, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mingma&quot; class=&quot;user-hover&quot; rel=&quot;mingma&quot;&gt;mingma&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;A couple more comments, we are close. To reproduce the problem in your setup, we need 3 concurrent clients. Thus we don&apos;t need to have wait loops after each individual &lt;tt&gt;clientX.start()&lt;/tt&gt;. So just after last &lt;tt&gt;client3.start&lt;/tt&gt; we can wait until all threads are active using the &lt;tt&gt;TestRPC#countThreads&lt;/tt&gt; methods:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (countThreads(&lt;span class=&quot;code-quote&quot;&gt;&quot;TestRPC$SleepRPCClient&quot;&lt;/span&gt;) != 3) {
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(100);
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After that we need to have another single sleep to be sure that the server-side problem is reproduced instead of &lt;tt&gt;while (!client3.isAlive())&lt;/tt&gt; loop.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;if (proxy != null)&lt;/tt&gt; is unnecessary because proxy is known to be non-null in the finally. &lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;SleepRPCClient#run&lt;/tt&gt;, we should catch Throwable and LOG it instead of completely ignoring the exception for better debugability.&lt;/p&gt;</comment>
                            <comment id="14254433" author="jira.shegalov" created="Sat, 20 Dec 2014 01:38:26 +0000"  >&lt;p&gt;Regarding SleepRPCClient exceptions. It&apos;s probably even better to use a Callable or to check otherwise whether only the expected InterruptedException is thrown. Otherwise the test may succeed because all calls failed.&lt;/p&gt;</comment>
                            <comment id="14256086" author="jira.shegalov" created="Mon, 22 Dec 2014 19:34:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mingma&quot; class=&quot;user-hover&quot; rel=&quot;mingma&quot;&gt;mingma&lt;/a&gt;, I took the liberty to incorporate my nit comments myself while you are on a break. Let me know whether it looks good to you when get a chance. &lt;/p&gt;

&lt;p&gt;It would also be good if some other committer takes a look as well.&lt;/p&gt;</comment>
                            <comment id="14256161" author="hadoopqa" created="Mon, 22 Dec 2014 20:33:58 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12688707/HADOOP-11295-4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12688707/HADOOP-11295-4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision a696fbb.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 3 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-common:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.ha.TestZKFailoverControllerStress&lt;br/&gt;
                  org.apache.hadoop.ipc.TestRPC&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5331//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5331//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5331//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5331//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5331//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5331//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14256609" author="jira.shegalov" created="Tue, 23 Dec 2014 05:18:09 +0000"  >&lt;p&gt;relaxed ConnectException to IOException as the expected exception. &lt;/p&gt;</comment>
                            <comment id="14256649" author="hadoopqa" created="Tue, 23 Dec 2014 06:14:03 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12688791/HADOOP-11295-5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12688791/HADOOP-11295-5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision fdf042d.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 3 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-common:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.ha.TestZKFailoverControllerStress&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5333//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5333//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5333//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5333//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5333//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5333//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14265054" author="mingma" created="Mon, 5 Jan 2015 20:28:26 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jira.shegalov&quot; class=&quot;user-hover&quot; rel=&quot;jira.shegalov&quot;&gt;jira.shegalov&lt;/a&gt;! Good idea to use ExecutorService. One minor thing, in the check if all client calls have been received  by the RPC server as in &lt;tt&gt;server.getCallQueueLen() != 1 &amp;amp;&amp;amp; countThreads(CallQueueManager.class.getName()) != 1&lt;/tt&gt;, it will be useful to add another check to make sure the handler thread is blocked, something like &lt;tt&gt;countThreads(TestProtocol.class.getName()) != 1&lt;/tt&gt;. This will cover the case where handler thread is slow to start up and thus the test code leaves the while loop a bit early. Otherwise, it looks good.&lt;/p&gt;</comment>
                            <comment id="14265270" author="daryn" created="Mon, 5 Jan 2015 22:53:55 +0000"  >&lt;p&gt;Per #2 in the description, I haven&apos;t thought about it too hard, but should we consider a more graceful shutdown?  Close the listener, and interrupt the readers, interrupt the handlers?&lt;/p&gt;</comment>
                            <comment id="14306746" author="mingma" created="Thu, 5 Feb 2015 06:42:33 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daryn&quot; class=&quot;user-hover&quot; rel=&quot;daryn&quot;&gt;daryn&lt;/a&gt;. Yes, we can change the shutdown order from the current &quot; handlers -&amp;gt; listener -&amp;gt; readers -&amp;gt; responder&quot; to &quot;listener -&amp;gt; readers -&amp;gt; handlers -&amp;gt; responder&quot;. But I don&apos;t know if it makes much of difference given the server is being shutdown anyway. If you meant draining the RPC queue before the server is shutdown, then we will have to wait for all requests to be processed by handlers and responder; it might not be worthy it. Thoughts?&lt;/p&gt;</comment>
                            <comment id="14323954" author="jira.shegalov" created="Tue, 17 Feb 2015 09:00:29 +0000"  >&lt;p&gt;Incorporating Ming&apos;s suggestion in 006. I am +1 for this version since it&apos;s non-invasive. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daryn&quot; class=&quot;user-hover&quot; rel=&quot;daryn&quot;&gt;daryn&lt;/a&gt;, do you mind handling your suggestion in a separate JIRA?  &lt;/p&gt;</comment>
                            <comment id="14324025" author="hadoopqa" created="Tue, 17 Feb 2015 10:06:38 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12699227/HADOOP-11295.006.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12699227/HADOOP-11295.006.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 500e6a0.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5721//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5721//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5721//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5721//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14325090" author="kihwal" created="Tue, 17 Feb 2015 23:12:28 +0000"  >&lt;p&gt;+1 I think it is fine for now. We may improve the shutdown later.&lt;/p&gt;</comment>
                            <comment id="14325094" author="kihwal" created="Tue, 17 Feb 2015 23:17:08 +0000"  >&lt;p&gt;Committed to trunk and branch-2.&lt;/p&gt;</comment>
                            <comment id="14325100" author="hudson" created="Tue, 17 Feb 2015 23:23:41 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-trunk-Commit #7138 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/7138/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/7138/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11295&quot; title=&quot;RPC Server Reader thread can&amp;#39;t shutdown if RPCCallQueue is full&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11295&quot;&gt;&lt;del&gt;HADOOP-11295&lt;/del&gt;&lt;/a&gt;. RPC Server Reader thread can&apos;t shutdown if RPCCallQueue is full. Contributed by Ming Ma. (kihwal: rev 685af8a3d0504724fe588daf3722519fedc45b01)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Server.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestRPC.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14325108" author="mingma" created="Tue, 17 Feb 2015 23:28:34 +0000"  >&lt;p&gt;Thanks, Gera, Sangjin, Daryn and Kihwal.&lt;/p&gt;</comment>
                            <comment id="14325438" author="ajisakaa" created="Wed, 18 Feb 2015 05:31:35 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kihwal&quot; class=&quot;user-hover&quot; rel=&quot;kihwal&quot;&gt;kihwal&lt;/a&gt;, I don&apos;t see the patch is committed to branch-2. Would you commit it?&lt;/p&gt;</comment>
                            <comment id="14325606" author="ozawa" created="Wed, 18 Feb 2015 08:57:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kihwal&quot; class=&quot;user-hover&quot; rel=&quot;kihwal&quot;&gt;kihwal&lt;/a&gt; cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ajisakaa&quot; class=&quot;user-hover&quot; rel=&quot;ajisakaa&quot;&gt;ajisakaa&lt;/a&gt; I checked this JIRA, and you did +1 for branch-2 commit. I cherry-picked from the commit 685af8a3d0504724fe588daf3722519fedc45b01 to branch-2 since it causes conflicts of other commits. Please revert it if you find a problem.&lt;/p&gt;</comment>
                            <comment id="14325752" author="hudson" created="Wed, 18 Feb 2015 11:35:51 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Yarn-trunk #842 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/842/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/842/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11295&quot; title=&quot;RPC Server Reader thread can&amp;#39;t shutdown if RPCCallQueue is full&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11295&quot;&gt;&lt;del&gt;HADOOP-11295&lt;/del&gt;&lt;/a&gt;. RPC Server Reader thread can&apos;t shutdown if RPCCallQueue is full. Contributed by Ming Ma. (kihwal: rev 685af8a3d0504724fe588daf3722519fedc45b01)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestRPC.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Server.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14325789" author="hudson" created="Wed, 18 Feb 2015 11:51:03 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Yarn-trunk-Java8 #108 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/108/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/108/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11295&quot; title=&quot;RPC Server Reader thread can&amp;#39;t shutdown if RPCCallQueue is full&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11295&quot;&gt;&lt;del&gt;HADOOP-11295&lt;/del&gt;&lt;/a&gt;. RPC Server Reader thread can&apos;t shutdown if RPCCallQueue is full. Contributed by Ming Ma. (kihwal: rev 685af8a3d0504724fe588daf3722519fedc45b01)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Server.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestRPC.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14325912" author="hudson" created="Wed, 18 Feb 2015 14:22:10 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #99 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/99/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/99/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11295&quot; title=&quot;RPC Server Reader thread can&amp;#39;t shutdown if RPCCallQueue is full&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11295&quot;&gt;&lt;del&gt;HADOOP-11295&lt;/del&gt;&lt;/a&gt;. RPC Server Reader thread can&apos;t shutdown if RPCCallQueue is full. Contributed by Ming Ma. (kihwal: rev 685af8a3d0504724fe588daf3722519fedc45b01)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Server.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestRPC.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14325938" author="hudson" created="Wed, 18 Feb 2015 14:27:18 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Hdfs-trunk #2040 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/2040/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/2040/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11295&quot; title=&quot;RPC Server Reader thread can&amp;#39;t shutdown if RPCCallQueue is full&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11295&quot;&gt;&lt;del&gt;HADOOP-11295&lt;/del&gt;&lt;/a&gt;. RPC Server Reader thread can&apos;t shutdown if RPCCallQueue is full. Contributed by Ming Ma. (kihwal: rev 685af8a3d0504724fe588daf3722519fedc45b01)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Server.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestRPC.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14325975" author="kihwal" created="Wed, 18 Feb 2015 14:57:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ajisakaa&quot; class=&quot;user-hover&quot; rel=&quot;ajisakaa&quot;&gt;ajisakaa&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ozawa&quot; class=&quot;user-hover&quot; rel=&quot;ozawa&quot;&gt;ozawa&lt;/a&gt;, sorry, apparently I didn&apos;t push it after the cherry-pick. Thanks for noticing and fixing it.&lt;/p&gt;</comment>
                            <comment id="14325999" author="hudson" created="Wed, 18 Feb 2015 15:06:43 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #109 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/109/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/109/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11295&quot; title=&quot;RPC Server Reader thread can&amp;#39;t shutdown if RPCCallQueue is full&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11295&quot;&gt;&lt;del&gt;HADOOP-11295&lt;/del&gt;&lt;/a&gt;. RPC Server Reader thread can&apos;t shutdown if RPCCallQueue is full. Contributed by Ming Ma. (kihwal: rev 685af8a3d0504724fe588daf3722519fedc45b01)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestRPC.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Server.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14326032" author="hudson" created="Wed, 18 Feb 2015 15:30:42 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk #2059 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2059/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2059/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11295&quot; title=&quot;RPC Server Reader thread can&amp;#39;t shutdown if RPCCallQueue is full&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11295&quot;&gt;&lt;del&gt;HADOOP-11295&lt;/del&gt;&lt;/a&gt;. RPC Server Reader thread can&apos;t shutdown if RPCCallQueue is full. Contributed by Ming Ma. (kihwal: rev 685af8a3d0504724fe588daf3722519fedc45b01)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ipc/TestRPC.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ipc/Server.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14695377" author="ajisakaa" created="Thu, 13 Aug 2015 15:39:08 +0000"  >&lt;p&gt;Rebased the patch for branch-2.6.&lt;/p&gt;</comment>
                            <comment id="14724524" author="vinodkv" created="Tue, 1 Sep 2015 01:14:34 +0000"  >&lt;p&gt;Pulled this into 2.6.1 following &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ajisakaa&quot; class=&quot;user-hover&quot; rel=&quot;ajisakaa&quot;&gt;ajisakaa&lt;/a&gt;&apos;s patch. Ran compilation and TestRPC before the push.&lt;/p&gt;</comment>
                            <comment id="14908492" author="xiaochen" created="Fri, 25 Sep 2015 18:47:16 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mingma&quot; class=&quot;user-hover&quot; rel=&quot;mingma&quot;&gt;mingma&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jira.shegalov&quot; class=&quot;user-hover&quot; rel=&quot;jira.shegalov&quot;&gt;jira.shegalov&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I was reading up this JIRA, and the fix in Server.java looks great. Thanks for the contribution!&lt;br/&gt;
However, in the test case in the latest patch, IMO instead of checking:&lt;br/&gt;
{{&lt;br/&gt;
while (server.getCallQueueLen() != 1&lt;br/&gt;
  &amp;amp;&amp;amp; countThreads(CallQueueManager.class.getName()) != 1&lt;br/&gt;
  &amp;amp;&amp;amp; countThreads(TestProtocol.class.getName()) != 1) &lt;/p&gt;
{
  Thread.sleep(100);
}
}}&lt;br/&gt;
we should check:&lt;br/&gt;
{{&lt;br/&gt;
while (server.getCallQueueLen() != 1&lt;br/&gt;
  || countThreads(CallQueueManager.class.getName()) != 1&lt;br/&gt;
  || countThreads(TestProtocol.class.getName()) != 1) {  Thread.sleep(100);}}}
&lt;p&gt;to guarantee that the threads are in expected states when we later call &lt;tt&gt;server.stop()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Also, it appears to me that the class name for the test protocol is org.apache.hadoop.ipc.TestRPC$TestImpl, as we &lt;tt&gt;setInstance(new TestImpl())&lt;/tt&gt; when creating the server. So I suggest instead of checking &lt;tt&gt;countThreads(TestProtocol.class.getName())&lt;/tt&gt;, we can check &lt;tt&gt;countThreads(TestImpl.class.getName())&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Please let me know if this makes sense to you. Thanks.&lt;/p&gt;</comment>
                            <comment id="14908821" author="mingma" created="Fri, 25 Sep 2015 22:56:08 +0000"  >&lt;p&gt;Good catch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xiaochen&quot; class=&quot;user-hover&quot; rel=&quot;xiaochen&quot;&gt;xiaochen&lt;/a&gt;! Please go ahead to attach your patch in a new jira.&lt;/p&gt;</comment>
                            <comment id="14908874" author="xiaochen" created="Fri, 25 Sep 2015 23:27:05 +0000"  >&lt;p&gt;Thanks Ming. I have created &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12440&quot; title=&quot;TestRPC#testRPCServerShutdown did not produce the desired thread states before shutting down&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12440&quot;&gt;&lt;del&gt;HADOOP-12440&lt;/del&gt;&lt;/a&gt; and linked to this JIRA.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12896518">HADOOP-12440</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12688254" name="HADOOP-11295-2.patch" size="3408" author="mingma" created="Fri, 19 Dec 2014 05:43:30 +0000"/>
                            <attachment id="12688424" name="HADOOP-11295-3.patch" size="3112" author="mingma" created="Fri, 19 Dec 2014 21:43:38 +0000"/>
                            <attachment id="12688707" name="HADOOP-11295-4.patch" size="4245" author="jira.shegalov" created="Mon, 22 Dec 2014 19:34:28 +0000"/>
                            <attachment id="12688791" name="HADOOP-11295-5.patch" size="4240" author="jira.shegalov" created="Tue, 23 Dec 2014 05:18:09 +0000"/>
                            <attachment id="12699227" name="HADOOP-11295.006.patch" size="4304" author="jira.shegalov" created="Tue, 17 Feb 2015 09:00:29 +0000"/>
                            <attachment id="12750299" name="HADOOP-11295.branch-2.6.patch" size="4179" author="aajisaka" created="Thu, 13 Aug 2015 15:39:08 +0000"/>
                            <attachment id="12681159" name="HADOOP-11295.patch" size="3396" author="mingma" created="Wed, 12 Nov 2014 22:17:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 8 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i227zz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>