<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:44:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-10251] Both NameNodes could be in STANDBY State if SNN network is unstable</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-10251</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;Following corner scenario happened in one of our cluster.&lt;/p&gt;

&lt;p&gt;1. NN1 was Active and NN2 was Standby&lt;br/&gt;
2. NN2 machine&apos;s network was slow &lt;br/&gt;
3. NN1 got shutdown.&lt;br/&gt;
4. NN2 ZKFC got the notification and trying to check for old active for fencing. (This took little more time, again due to slow network)&lt;br/&gt;
5. In between, NN1 got restarted by our automatic monitoring, and ZKFC made it Active.&lt;br/&gt;
6. Now NN2 ZKFC got Old Active as NN1 and it did graceful fencing of NN1 to STANBY.&lt;br/&gt;
7. Before writing ActiveBreadCrumb to ZK, NN2 ZKFC got session timeout and got shutdown before making NN2 Active.&lt;/p&gt;


&lt;p&gt;&lt;b&gt;Now cluster having both NameNodes as STANDBY.&lt;/b&gt;&lt;br/&gt;
NN1 ZKFC still thinks that its nameNode is in Active state. &lt;br/&gt;
NN2 ZKFC waiting for election.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12690252">HADOOP-10251</key>
            <summary>Both NameNodes could be in STANDBY State if SNN network is unstable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vinayakumarb">Vinayakumar B</assignee>
                                    <reporter username="vinayakumarb">Vinayakumar B</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Jan 2014 12:05:23 +0000</created>
                <updated>Fri, 12 Jun 2015 08:04:01 +0000</updated>
                            <resolved>Wed, 23 Apr 2014 19:05:54 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.5.0</fixVersion>
                                    <component>ha</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="13878576" author="vinayrpet" created="Wed, 22 Jan 2014 12:07:15 +0000"  >&lt;p&gt;ZKFC health check, checks the state of the NameNode, but it doesnot validate it with expected state.&lt;/p&gt;</comment>
                            <comment id="13878586" author="vinayrpet" created="Wed, 22 Jan 2014 12:16:05 +0000"  >&lt;p&gt;Attaching a patch for the above case. Please review&lt;/p&gt;</comment>
                            <comment id="13878739" author="hadoopqa" created="Wed, 22 Jan 2014 15:06:56 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12624335/HADOOP-10251.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12624335/HADOOP-10251.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-common:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.ha.TestZKFailoverController&lt;/p&gt;

&lt;p&gt;                                      The following test timeouts occurred in hadoop-common-project/hadoop-common:&lt;/p&gt;

&lt;p&gt;org.apache.hadoop.ha.TestZKFailoverControllerStress&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3457//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3457//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3457//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3457//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13879443" author="vinayrpet" created="Thu, 23 Jan 2014 05:12:56 +0000"  >&lt;p&gt;Updated the patch to fix test failures.&lt;br/&gt;
These are mainly time issues.&lt;/p&gt;</comment>
                            <comment id="13879454" author="vinayrpet" created="Thu, 23 Jan 2014 05:25:10 +0000"  >&lt;p&gt;Updated the patch again.&lt;br/&gt;
Also enabled tests in Windows.&lt;/p&gt;</comment>
                            <comment id="13879477" author="vinayrpet" created="Thu, 23 Jan 2014 06:12:50 +0000"  >&lt;p&gt;Attaching the updated patch, fixed some synchronization issue.&lt;/p&gt;</comment>
                            <comment id="13890860" author="vinayrpet" created="Tue, 4 Feb 2014 17:16:26 +0000"  >&lt;p&gt;Hi, Can someone please review the patch.. Thanks&lt;/p&gt;</comment>
                            <comment id="13890924" author="hadoopqa" created="Tue, 4 Feb 2014 17:55:06 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12624583/HADOOP-10251.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12624583/HADOOP-10251.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3528//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3528//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3528//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3528//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13913016" author="vinayrpet" created="Wed, 26 Feb 2014 15:27:16 +0000"  >&lt;p&gt;Hi.. &lt;br/&gt;
Can please someone review this patch? &lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="13969340" author="vinayrpet" created="Tue, 15 Apr 2014 08:40:05 +0000"  >&lt;p&gt;Hi.. &lt;br/&gt;
Can please someone review this patch? &lt;br/&gt;
Thanks in advance&lt;/p&gt;</comment>
                            <comment id="13973090" author="umamaheswararao" created="Thu, 17 Apr 2014 15:53:11 +0000"  >&lt;p&gt;I think your idea will work and patch almost looks good to me.&lt;/p&gt;

&lt;p&gt;One question:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; /**
+   * Callback &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; service state change events.
+   * 
+   * This &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; is called whenever there is a change in the service state.
+   */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Seems like this interface will be called on every health monitor status check. But doc says its a service state changed event. It is exposing impl details as you do that state comparisions in implementation and do necessary actions on state change. So, at this interface level, we are not sure whether service state changed from last state or not right. Can you update this something like Service state notification?&lt;/p&gt;</comment>
                            <comment id="13973859" author="vinayrpet" created="Fri, 18 Apr 2014 07:44:51 +0000"  >&lt;p&gt;Updated the java doc for the interface. &lt;br/&gt;
Removed the implementation level details in interface.&lt;/p&gt;</comment>
                            <comment id="13973893" author="hadoopqa" created="Fri, 18 Apr 2014 08:38:24 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12640785/HADOOP-10251.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12640785/HADOOP-10251.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3809//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3809//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3809//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3809//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13977851" author="umamaheswararao" created="Wed, 23 Apr 2014 05:26:17 +0000"  >&lt;p&gt;+1 on the latest patch. I will commit it shortly.&lt;/p&gt;</comment>
                            <comment id="13978716" author="umamaheswararao" created="Wed, 23 Apr 2014 19:05:54 +0000"  >&lt;p&gt;I have just committed this to trunk and branch-2 . Thanks a lot, Vinay for the patch!&lt;/p&gt;</comment>
                            <comment id="13978796" author="hudson" created="Wed, 23 Apr 2014 19:55:58 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-trunk-Commit #5554 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/5554/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/5554/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10251&quot; title=&quot;Both NameNodes could be in STANDBY State if SNN network is unstable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10251&quot;&gt;&lt;del&gt;HADOOP-10251&lt;/del&gt;&lt;/a&gt;. Both NameNodes could be in STANDBY State if SNN network is unstable. Contributed by Vinayakumar B. (umamahesh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1589494&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1589494&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ha/HealthMonitor.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ha/ZKFailoverController.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/TestZKFailoverController.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13979592" author="hudson" created="Thu, 24 Apr 2014 11:29:42 +0000"  >&lt;p&gt;ABORTED: Integrated in Hadoop-Yarn-trunk #550 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/550/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/550/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10251&quot; title=&quot;Both NameNodes could be in STANDBY State if SNN network is unstable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10251&quot;&gt;&lt;del&gt;HADOOP-10251&lt;/del&gt;&lt;/a&gt;. Both NameNodes could be in STANDBY State if SNN network is unstable. Contributed by Vinayakumar B. (umamahesh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1589494&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1589494&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ha/HealthMonitor.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ha/ZKFailoverController.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/TestZKFailoverController.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13979710" author="hudson" created="Thu, 24 Apr 2014 13:31:59 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk #1767 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1767/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1767/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10251&quot; title=&quot;Both NameNodes could be in STANDBY State if SNN network is unstable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10251&quot;&gt;&lt;del&gt;HADOOP-10251&lt;/del&gt;&lt;/a&gt;. Both NameNodes could be in STANDBY State if SNN network is unstable. Contributed by Vinayakumar B. (umamahesh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1589494&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1589494&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ha/HealthMonitor.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ha/ZKFailoverController.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/TestZKFailoverController.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13981004" author="hudson" created="Fri, 25 Apr 2014 13:40:13 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-trunk #1742 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1742/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1742/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10251&quot; title=&quot;Both NameNodes could be in STANDBY State if SNN network is unstable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10251&quot;&gt;&lt;del&gt;HADOOP-10251&lt;/del&gt;&lt;/a&gt;. Both NameNodes could be in STANDBY State if SNN network is unstable. Contributed by Vinayakumar B. (umamahesh: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1589494&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1589494&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ha/HealthMonitor.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/ha/ZKFailoverController.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/ha/TestZKFailoverController.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14578184" author="lvchuanwen" created="Tue, 9 Jun 2015 01:59:58 +0000"  >&lt;p&gt;hi&#65292;nn1 and nn2  are alternately transformed into active state, as long as running hdfs haadmin -failover nn1 nn2.&lt;br/&gt;
After removing the code // healthMonitor.addServiceStateCallback(new ServiceStateCallBacks());   failover command  recovery normal&lt;/p&gt;


&lt;p&gt;thank you .&lt;/p&gt;</comment>
                            <comment id="14578728" author="vinayrpet" created="Tue, 9 Jun 2015 11:07:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;After removing the code // healthMonitor.addServiceStateCallback(new ServiceStateCallBacks()); failover command recovery normal&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;i did not understand the problem, Can you elaborate more please?&lt;/p&gt;</comment>
                            <comment id="14579884" author="lvchuanwen" created="Wed, 10 Jun 2015 02:36:37 +0000"  >&lt;p&gt;Attaching some logs&#65306;&lt;/p&gt;

&lt;p&gt;2015-06-10 02:57:53,727 DEBUG org.apache.hadoop.ipc.Server: Successfully authorized userInfo {&lt;br/&gt;
  effectiveUser: &quot;hdfs&quot;&lt;br/&gt;
}&lt;br/&gt;
protocol: &quot;org.apache.hadoop.ha.ZKFCProtocol&quot;&lt;/p&gt;

&lt;p&gt;2015-06-10 02:57:53,728 DEBUG org.apache.hadoop.ipc.Server:  got #0&lt;br/&gt;
2015-06-10 02:57:53,728 DEBUG org.apache.hadoop.ipc.Server: IPC Server handler 2 on 8019: org.apache.hadoop.ha.ZKFCProtocol.gracefulFailover from 10.43.156.196:49132 Call#0 Retry#0 for RpcKind RPC_PROTOCOL_BUFFER&lt;br/&gt;
2015-06-10 02:57:53,730 DEBUG org.apache.hadoop.security.UserGroupInformation: PrivilegedAction as:hdfs (auth:SIMPLE) from:org.apache.hadoop.ipc.Server$Handler.run(Server.java:2007)&lt;br/&gt;
2015-06-10 02:57:53,755 DEBUG org.apache.hadoop.security.Groups: Returning fetched groups for &apos;hdfs&apos;&lt;br/&gt;
2015-06-10 02:57:53,755 INFO org.apache.hadoop.hdfs.tools.DFSZKFailoverController: Allowed RPC access from hdfs (auth:SIMPLE) at 10.43.156.196&lt;br/&gt;
2015-06-10 02:57:53,756 DEBUG org.apache.hadoop.security.UserGroupInformation: PrivilegedAction as:hdfs (auth:SIMPLE) from:org.apache.hadoop.ha.ZKFailoverController.gracefulFailoverToYou(ZKFailoverController.java:603)&lt;br/&gt;
2015-06-10 02:57:53,760 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x34dcf74b50a05d7, packet:: clientPath:null serverPath:null finished:false header:: 4,4  replyHeader:: 4,38654797504,0  request:: &apos;/hadoop-ha/cluster195/ActiveStandbyElectorLock,F  response:: #aa636c75737465723139351236e6e321a67a646831393620ffffffa84628ffffffd33e,s&lt;/p&gt;
{38654797500,38654797500,1433876199859,1433876199859,0,0,0,93891338261633392,31,0,38654797500}
&lt;p&gt; &lt;br/&gt;
2015-06-10 02:57:53,768 DEBUG org.apache.hadoop.hdfs.server.namenode.NameNode: Setting fs.defaultFS to hdfs://zdh196:9000&lt;br/&gt;
2015-06-10 02:57:53,770 INFO org.apache.hadoop.ha.ZKFailoverController: Asking NameNode at zdh196/10.43.156.196:9000 to cede its active state for 10000ms&lt;br/&gt;
2015-06-10 02:57:53,772 DEBUG org.apache.hadoop.ipc.Client: getting client out of cache: org.apache.hadoop.ipc.Client@7007cf85&lt;br/&gt;
2015-06-10 02:57:53,779 DEBUG org.apache.hadoop.ipc.Client: The ping interval is 60000 ms.&lt;br/&gt;
2015-06-10 02:57:53,779 DEBUG org.apache.hadoop.ipc.Client: Connecting to zdh196/10.43.156.196:8019&lt;br/&gt;
2015-06-10 02:57:53,781 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh196/10.43.156.196:8019 from hdfs: starting, having connections 2&lt;br/&gt;
2015-06-10 02:57:53,781 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh196/10.43.156.196:8019 from hdfs sending #147&lt;br/&gt;
2015-06-10 02:57:53,969 DEBUG org.apache.zookeeper.ClientCnxn: Got notification sessionid:0x34dcf74b50a05d7&lt;br/&gt;
2015-06-10 02:57:53,970 DEBUG org.apache.zookeeper.ClientCnxn: Got WatchedEvent state:SyncConnected type:NodeDeleted path:/hadoop-ha/cluster195/ActiveStandbyElectorLock for sessionid 0x34dcf74b50a05d7&lt;br/&gt;
2015-06-10 02:57:53,974 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Watcher event type: NodeDeleted with state:SyncConnected for path:/hadoop-ha/cluster195/ActiveStandbyElectorLock connectionState: CONNECTED for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:53,979 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh196/10.43.156.196:8019 from hdfs got value #147&lt;br/&gt;
2015-06-10 02:57:53,979 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x34dcf74b50a05d7, packet:: clientPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock serverPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock finished:false header:: 5,1  replyHeader:: 5,38654797507,0  request:: &apos;/hadoop-ha/cluster195/ActiveStandbyElectorLock,#aa636c75737465723139351236e6e311a67a646831393520ffffffa84628ffffffd33e,v{s{31,s&lt;/p&gt;
{&apos;world,&apos;anyone}}},1  response:: &apos;/hadoop-ha/cluster195/ActiveStandbyElectorLock &lt;br/&gt;
2015-06-10 02:57:53,979 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: cedeActive took 200ms&lt;br/&gt;
2015-06-10 02:57:53,982 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: CreateNode result: 0 for path: /hadoop-ha/cluster195/ActiveStandbyElectorLock connectionState: CONNECTED  for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:53,982 INFO org.apache.hadoop.ha.ActiveStandbyElector: Checking for any old active which needs to be fenced...&lt;br/&gt;
2015-06-10 02:57:53,985 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x34dcf74b50a05d7, packet:: clientPath:null serverPath:null finished:false header:: 6,4  replyHeader:: 6,38654797507,-101  request:: &apos;/hadoop-ha/cluster195/ActiveBreadCrumb,F  response::  &lt;br/&gt;
2015-06-10 02:57:53,996 INFO org.apache.hadoop.ha.ActiveStandbyElector: No old node to fence&lt;br/&gt;
2015-06-10 02:57:53,996 INFO org.apache.hadoop.ha.ActiveStandbyElector: Writing znode /hadoop-ha/cluster195/ActiveBreadCrumb to indicate that the local node is the most recent active...&lt;br/&gt;
2015-06-10 02:57:54,002 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x34dcf74b50a05d7, packet:: clientPath:null serverPath:null finished:false header:: 7,1  replyHeader:: 7,38654797508,0  request:: &apos;/hadoop-ha/cluster195/ActiveBreadCrumb,#aa636c75737465723139351236e6e311a67a646831393520ffffffa84628ffffffd33e,v{s{31,s{&apos;world,&apos;anyone}
&lt;p&gt;}},0  response:: &apos;/hadoop-ha/cluster195/ActiveBreadCrumb &lt;br/&gt;
2015-06-10 02:57:54,006 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Becoming active for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;/p&gt;

&lt;p&gt;2015-06-10 02:57:54,008 INFO org.apache.hadoop.ha.ZKFailoverController: Trying to make NameNode at zdh195/10.43.156.195:9000 active...&lt;br/&gt;
2015-06-10 02:57:54,010 DEBUG org.apache.hadoop.ipc.Client: getting client out of cache: org.apache.hadoop.ipc.Client@7007cf85&lt;br/&gt;
2015-06-10 02:57:54,012 DEBUG org.apache.hadoop.ipc.Client: The ping interval is 60000 ms.&lt;br/&gt;
2015-06-10 02:57:54,012 DEBUG org.apache.hadoop.ipc.Client: Connecting to zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:54,014 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs: starting, having connections 3&lt;br/&gt;
2015-06-10 02:57:54,014 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #148&lt;br/&gt;
2015-06-10 02:57:54,084 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #149&lt;/p&gt;

&lt;p&gt;2015-06-10 02:57:56,071 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #148&lt;br/&gt;
2015-06-10 02:57:56,071 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #149&lt;br/&gt;
2015-06-10 02:57:56,071 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: transitionToActive took 2059ms&lt;br/&gt;
2015-06-10 02:57:56,071 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: getServiceStatus took 1988ms&lt;br/&gt;
2015-06-10 02:57:56,072 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #150&lt;br/&gt;
2015-06-10 02:57:56,073 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #150&lt;br/&gt;
2015-06-10 02:57:56,073 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: monitorHealth took 2ms&lt;br/&gt;
2015-06-10 02:57:56,073 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh195/10.43.156.195:9000 to active state&lt;/p&gt;

&lt;p&gt;2015-06-10 02:57:56,079 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x34dcf74b50a05d7, packet:: clientPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock serverPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock finished:false header:: 8,3  replyHeader:: 8,38654797508,0  request:: &apos;/hadoop-ha/cluster195/ActiveStandbyElectorLock,T  response:: s&lt;/p&gt;
{38654797507,38654797507,1433876273975,1433876273975,0,0,0,238074455480993239,31,0,38654797507}
&lt;p&gt; &lt;br/&gt;
2015-06-10 02:57:56,081 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: StatNode result: 0 for path: /hadoop-ha/cluster195/ActiveStandbyElectorLock connectionState: CONNECTED for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;/p&gt;

&lt;p&gt;2015-06-10 02:57:56,092 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh196/10.43.156.196:8019 from hdfs got value #151&lt;br/&gt;
2015-06-10 02:57:56,092 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: cedeActive took 18ms&lt;br/&gt;
2015-06-10 02:57:56,092 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully became active. Successfully transitioned NameNode at zdh195/10.43.156.195:9000 to active state&lt;br/&gt;
2015-06-10 02:57:56,093 DEBUG org.apache.hadoop.ipc.Server: Served: gracefulFailover queueTime= 20 procesingTime= 2345&lt;br/&gt;
2015-06-10 02:57:56,094 DEBUG org.apache.hadoop.ipc.Server: IPC Server handler 2 on 8019: responding to org.apache.hadoop.ha.ZKFCProtocol.gracefulFailover from 10.43.156.196:49132 Call#0 Retry#0&lt;br/&gt;
2015-06-10 02:57:56,095 DEBUG org.apache.hadoop.ipc.Server: IPC Server handler 2 on 8019: responding to org.apache.hadoop.ha.ZKFCProtocol.gracefulFailover from 10.43.156.196:49132 Call#0 Retry#0 Wrote 32 bytes.&lt;br/&gt;
2015-06-10 02:57:56,120 DEBUG org.apache.hadoop.ipc.Server: Socket Reader #1 for port 8019: disconnecting client 10.43.156.196:49132. Number of active connections: 0&lt;br/&gt;
2015-06-10 02:57:57,077 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #152&lt;br/&gt;
2015-06-10 02:57:57,079 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #152&lt;br/&gt;
2015-06-10 02:57:57,079 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: getServiceStatus took 3ms&lt;br/&gt;
2015-06-10 02:57:57,080 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #153&lt;br/&gt;
2015-06-10 02:57:57,081 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #153&lt;br/&gt;
2015-06-10 02:57:57,082 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: monitorHealth took 3ms&lt;br/&gt;
2015-06-10 02:57:57,082 ERROR org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh195/10.43.156.195:9000 has changed the serviceState to active. Expected was standby. Quitting election marking fencing necessary.&lt;br/&gt;
2015-06-10 02:57:57,082 INFO org.apache.hadoop.ha.ActiveStandbyElector: Yielding from election&lt;br/&gt;
2015-06-10 02:57:57,085 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Terminating ZK connection for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:57,085 DEBUG org.apache.zookeeper.ZooKeeper: Closing session: 0x34dcf74b50a05d7&lt;br/&gt;
2015-06-10 02:57:57,085 DEBUG org.apache.zookeeper.ClientCnxn: Closing client for session: 0x34dcf74b50a05d7&lt;br/&gt;
2015-06-10 02:57:57,088 DEBUG org.apache.zookeeper.ClientCnxn: Got notification sessionid:0x34dcf74b50a05d7&lt;br/&gt;
2015-06-10 02:57:57,089 DEBUG org.apache.zookeeper.ClientCnxn: Got WatchedEvent state:SyncConnected type:NodeDeleted path:/hadoop-ha/cluster195/ActiveStandbyElectorLock for sessionid 0x34dcf74b50a05d7&lt;br/&gt;
2015-06-10 02:57:57,090 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x34dcf74b50a05d7, packet:: clientPath:null serverPath:null finished:false header:: 9,-11  replyHeader:: 9,38654797511,0  request:: null response:: null&lt;br/&gt;
2015-06-10 02:57:57,090 DEBUG org.apache.zookeeper.ClientCnxn: Disconnecting client for session: 0x34dcf74b50a05d7&lt;br/&gt;
2015-06-10 02:57:57,090 INFO org.apache.zookeeper.ZooKeeper: Session: 0x34dcf74b50a05d7 closed&lt;br/&gt;
2015-06-10 02:57:57,090 DEBUG org.apache.zookeeper.ClientCnxn: An exception was thrown while closing send thread for session 0x34dcf74b50a05d7 : Unable to read additional data from server sessionid 0x34dcf74b50a05d7, likely server has closed socket&lt;br/&gt;
2015-06-10 02:57:57,091 WARN org.apache.hadoop.ha.ActiveStandbyElector: Ignoring stale result from old client with sessionId 0x34dcf74b50a05d7&lt;br/&gt;
2015-06-10 02:57:57,091 INFO org.apache.zookeeper.ClientCnxn: EventThread shut down&lt;br/&gt;
2015-06-10 02:57:58,091 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #154&lt;br/&gt;
2015-06-10 02:57:58,093 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #154&lt;br/&gt;
2015-06-10 02:57:58,093 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: getServiceStatus took 3ms&lt;br/&gt;
2015-06-10 02:57:58,094 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #155&lt;br/&gt;
2015-06-10 02:57:58,095 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #155&lt;br/&gt;
2015-06-10 02:57:58,096 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: monitorHealth took 3ms&lt;br/&gt;
2015-06-10 02:57:58,096 DEBUG org.apache.hadoop.ha.ZKFailoverController: rechecking for electability from bad state&lt;br/&gt;
2015-06-10 02:57:58,099 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Attempting active election for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:58,102 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Establishing zookeeper connection for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:58,102 INFO org.apache.zookeeper.ZooKeeper: Initiating client connection, connectString=zdh196:2181,zdh195:2181,zdh197:2181 sessionTimeout=10000 watcher=org.apache.hadoop.ha.ActiveStandbyElector$WatcherWithClientRef@31b40327&lt;br/&gt;
2015-06-10 02:57:58,105 INFO org.apache.zookeeper.ClientCnxn: Opening socket connection to server zdh195/10.43.156.195:2181. Will not attempt to authenticate using SASL (unknown error)&lt;br/&gt;
2015-06-10 02:57:58,106 INFO org.apache.zookeeper.ClientCnxn: Socket connection established to zdh195/10.43.156.195:2181, initiating session&lt;br/&gt;
2015-06-10 02:57:58,106 DEBUG org.apache.zookeeper.ClientCnxn: Session establishment request sent on zdh195/10.43.156.195:2181&lt;br/&gt;
2015-06-10 02:57:58,109 INFO org.apache.zookeeper.ClientCnxn: Session establishment complete on server zdh195/10.43.156.195:2181, sessionid = 0x24d91acb5cb1967, negotiated timeout = 10000&lt;br/&gt;
2015-06-10 02:57:58,112 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Created new connection for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:58,116 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Watcher event type: None with state:SyncConnected for path:null connectionState: TERMINATED for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:58,116 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session connected.&lt;br/&gt;
2015-06-10 02:57:58,117 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x24d91acb5cb1967, packet:: clientPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock serverPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock finished:false header:: 1,1  replyHeader:: 1,38654797515,-110  request:: &apos;/hadoop-ha/cluster195/ActiveStandbyElectorLock,#aa636c75737465723139351236e6e311a67a646831393520ffffffa84628ffffffd33e,v{s{31,s&lt;/p&gt;
{&apos;world,&apos;anyone}}},1  response::  &lt;br/&gt;
2015-06-10 02:57:58,120 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: CreateNode result: -110 for path: /hadoop-ha/cluster195/ActiveStandbyElectorLock connectionState: CONNECTED  for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:58,123 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Becoming standby for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:58,123 INFO org.apache.hadoop.ha.ZKFailoverController: ZK Election indicated that NameNode at zdh195/10.43.156.195:9000 should become standby&lt;br/&gt;
2015-06-10 02:57:58,125 DEBUG org.apache.hadoop.ipc.Client: getting client out of cache: org.apache.hadoop.ipc.Client@7007cf85&lt;br/&gt;
2015-06-10 02:57:58,125 DEBUG org.apache.hadoop.ipc.Client: The ping interval is 60000 ms.&lt;br/&gt;
2015-06-10 02:57:58,126 DEBUG org.apache.hadoop.ipc.Client: Connecting to zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:58,128 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #156&lt;br/&gt;
2015-06-10 02:57:58,128 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs: starting, having connections 4&lt;br/&gt;
2015-06-10 02:57:58,132 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #156&lt;br/&gt;
2015-06-10 02:57:58,132 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: transitionToStandby took 7ms&lt;br/&gt;
2015-06-10 02:57:58,132 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh195/10.43.156.195:9000 to standby state&lt;br/&gt;
2015-06-10 02:57:58,135 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Monitoring active leader for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:58,138 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x24d91acb5cb1967, packet:: clientPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock serverPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock finished:false header:: 2,3  replyHeader:: 2,38654797515,0  request:: &apos;/hadoop-ha/cluster195/ActiveStandbyElectorLock,T  response:: s{38654797512,38654797512,1433876277092,1433876277092,0,0,0,165948932252965222,31,0,38654797512} &lt;br/&gt;
2015-06-10 02:57:58,141 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: StatNode result: 0 for path: /hadoop-ha/cluster195/ActiveStandbyElectorLock connectionState: CONNECTED for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:58,850 DEBUG org.apache.zookeeper.ClientCnxn: Got notification sessionid:0x24d91acb5cb1967&lt;br/&gt;
2015-06-10 02:57:58,850 DEBUG org.apache.zookeeper.ClientCnxn: Got WatchedEvent state:SyncConnected type:NodeDeleted path:/hadoop-ha/cluster195/ActiveStandbyElectorLock for sessionid 0x24d91acb5cb1967&lt;br/&gt;
2015-06-10 02:57:58,854 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Watcher event type: NodeDeleted with state:SyncConnected for path:/hadoop-ha/cluster195/ActiveStandbyElectorLock connectionState: CONNECTED for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:58,858 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x24d91acb5cb1967, packet:: clientPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock serverPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock finished:false header:: 3,1  replyHeader:: 3,38654797517,0  request:: &apos;/hadoop-ha/cluster195/ActiveStandbyElectorLock,#aa636c75737465723139351236e6e311a67a646831393520ffffffa84628ffffffd33e,v{s{31,s{&apos;world,&apos;anyone}
&lt;p&gt;}},1  response:: &apos;/hadoop-ha/cluster195/ActiveStandbyElectorLock &lt;br/&gt;
2015-06-10 02:57:58,861 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: CreateNode result: 0 for path: /hadoop-ha/cluster195/ActiveStandbyElectorLock connectionState: CONNECTED  for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:57:58,861 INFO org.apache.hadoop.ha.ActiveStandbyElector: Checking for any old active which needs to be fenced...&lt;br/&gt;
2015-06-10 02:57:58,863 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x24d91acb5cb1967, packet:: clientPath:null serverPath:null finished:false header:: 4,4  replyHeader:: 4,38654797517,0  request:: &apos;/hadoop-ha/cluster195/ActiveBreadCrumb,F  response:: #aa636c75737465723139351236e6e321a67a646831393620ffffffa84628ffffffd33e,s&lt;/p&gt;
{38654797508,38654797513,1433876273998,1433876277194,1,0,0,0,31,0,38654797508}
&lt;p&gt; &lt;br/&gt;
2015-06-10 02:57:58,864 INFO org.apache.hadoop.ha.ActiveStandbyElector: Old node exists: 0a0a636c757374657231393512036e6e321a067a646831393620a84628d33e&lt;br/&gt;
2015-06-10 02:57:58,867 DEBUG org.apache.hadoop.hdfs.server.namenode.NameNode: Setting fs.defaultFS to hdfs://zdh196:9000&lt;br/&gt;
2015-06-10 02:57:58,868 INFO org.apache.hadoop.ha.ZKFailoverController: Should fence: NameNode at zdh196/10.43.156.196:9000&lt;br/&gt;
2015-06-10 02:57:58,870 DEBUG org.apache.hadoop.ipc.Client: getting client out of cache: org.apache.hadoop.ipc.Client@7007cf85&lt;br/&gt;
2015-06-10 02:57:58,871 DEBUG org.apache.hadoop.ipc.Client: The ping interval is 60000 ms.&lt;br/&gt;
2015-06-10 02:57:58,871 DEBUG org.apache.hadoop.ipc.Client: Connecting to zdh196/10.43.156.196:9000&lt;br/&gt;
2015-06-10 02:57:58,872 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh196/10.43.156.196:9000 from hdfs sending #157&lt;br/&gt;
2015-06-10 02:57:58,873 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh196/10.43.156.196:9000 from hdfs: starting, having connections 5&lt;br/&gt;
2015-06-10 02:57:58,949 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh196/10.43.156.196:9000 from hdfs got value #157&lt;br/&gt;
2015-06-10 02:57:58,949 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: transitionToStandby took 79ms&lt;br/&gt;
2015-06-10 02:57:58,949 DEBUG org.apache.hadoop.ipc.Client: stopping client from cache: org.apache.hadoop.ipc.Client@7007cf85&lt;br/&gt;
2015-06-10 02:57:58,949 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh196/10.43.156.196:9000 to standby state without fencing&lt;br/&gt;
2015-06-10 02:57:58,949 INFO org.apache.hadoop.ha.ActiveStandbyElector: Writing znode /hadoop-ha/cluster195/ActiveBreadCrumb to indicate that the local node is the most recent active...&lt;br/&gt;
2015-06-10 02:57:58,954 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x24d91acb5cb1967, packet:: clientPath:null serverPath:null finished:false header:: 5,5  replyHeader:: 5,38654797518,0  request:: &apos;/hadoop-ha/cluster195/ActiveBreadCrumb,#aa636c75737465723139351236e6e311a67a646831393520ffffffa84628ffffffd33e,1  response:: s&lt;/p&gt;
{38654797508,38654797518,1433876273998,1433876278951,2,0,0,0,31,0,38654797508}
&lt;p&gt; &lt;br/&gt;
2015-06-10 02:57:58,955 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Becoming active for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;/p&gt;



&lt;p&gt;2015-06-10 02:57:58,955 INFO org.apache.hadoop.ha.ZKFailoverController: Trying to make NameNode at zdh195/10.43.156.195:9000 active...&lt;br/&gt;
2015-06-10 02:57:58,956 DEBUG org.apache.hadoop.ipc.Client: getting client out of cache: org.apache.hadoop.ipc.Client@7007cf85&lt;br/&gt;
2015-06-10 02:57:58,957 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #158&lt;/p&gt;

&lt;p&gt;2015-06-10 02:57:59,113 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #159&lt;br/&gt;
2015-06-10 02:58:00,545 DEBUG org.apache.hadoop.ipc.Server: IPC Server idle connection scanner for port 8019: task running&lt;br/&gt;
2015-06-10 02:58:00,573 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #159&lt;br/&gt;
2015-06-10 02:58:00,573 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #158&lt;br/&gt;
2015-06-10 02:58:00,574 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: getServiceStatus took 1461ms&lt;br/&gt;
2015-06-10 02:58:00,574 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: transitionToActive took 1617ms&lt;br/&gt;
2015-06-10 02:58:00,574 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh195/10.43.156.195:9000 to active state&lt;br/&gt;
2015-06-10 02:58:00,574 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #160&lt;/p&gt;

&lt;p&gt;2015-06-10 02:58:00,576 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #160&lt;br/&gt;
2015-06-10 02:58:00,576 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: monitorHealth took 2ms&lt;br/&gt;
2015-06-10 02:58:00,577 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Monitoring active leader for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:58:00,580 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x24d91acb5cb1967, packet:: clientPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock serverPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock finished:false header:: 6,3  replyHeader:: 6,38654797520,0  request:: &apos;/hadoop-ha/cluster195/ActiveStandbyElectorLock,T  response:: s&lt;/p&gt;
{38654797517,38654797517,1433876278854,1433876278854,0,0,0,165948932252965223,31,0,38654797517}
&lt;p&gt; &lt;/p&gt;

&lt;p&gt;2015-06-10 02:58:01,578 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #161&lt;br/&gt;
2015-06-10 02:58:01,580 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #161&lt;br/&gt;
2015-06-10 02:58:01,580 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: getServiceStatus took 2ms&lt;br/&gt;
2015-06-10 02:58:01,581 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #162&lt;br/&gt;
2015-06-10 02:58:01,582 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #162&lt;br/&gt;
2015-06-10 02:58:01,582 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: monitorHealth took 2ms&lt;br/&gt;
2015-06-10 02:58:01,583 ERROR org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh195/10.43.156.195:9000 has changed the serviceState to active. Expected was standby. Quitting election marking fencing necessary.&lt;br/&gt;
2015-06-10 02:58:01,583 INFO org.apache.hadoop.ha.ActiveStandbyElector: Yielding from election&lt;br/&gt;
2015-06-10 02:58:01,585 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Terminating ZK connection for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:58:01,586 DEBUG org.apache.zookeeper.ZooKeeper: Closing session: 0x24d91acb5cb1967&lt;br/&gt;
2015-06-10 02:58:01,586 DEBUG org.apache.zookeeper.ClientCnxn: Closing client for session: 0x24d91acb5cb1967&lt;br/&gt;
2015-06-10 02:58:01,588 DEBUG org.apache.zookeeper.ClientCnxn: Got notification sessionid:0x24d91acb5cb1967&lt;br/&gt;
2015-06-10 02:58:01,588 DEBUG org.apache.zookeeper.ClientCnxn: Got WatchedEvent state:SyncConnected type:NodeDeleted path:/hadoop-ha/cluster195/ActiveStandbyElectorLock for sessionid 0x24d91acb5cb1967&lt;br/&gt;
2015-06-10 02:58:01,589 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x24d91acb5cb1967, packet:: clientPath:null serverPath:null finished:false header:: 7,-11  replyHeader:: 7,38654797521,0  request:: null response:: null&lt;br/&gt;
2015-06-10 02:58:01,589 DEBUG org.apache.zookeeper.ClientCnxn: Disconnecting client for session: 0x24d91acb5cb1967&lt;br/&gt;
2015-06-10 02:58:01,589 DEBUG org.apache.zookeeper.ClientCnxn: An exception was thrown while closing send thread for session 0x24d91acb5cb1967 : Unable to read additional data from server sessionid 0x24d91acb5cb1967, likely server has closed socket&lt;br/&gt;
2015-06-10 02:58:01,589 INFO org.apache.zookeeper.ZooKeeper: Session: 0x24d91acb5cb1967 closed&lt;br/&gt;
2015-06-10 02:58:01,590 WARN org.apache.hadoop.ha.ActiveStandbyElector: Ignoring stale result from old client with sessionId 0x24d91acb5cb1967&lt;br/&gt;
2015-06-10 02:58:01,590 INFO org.apache.zookeeper.ClientCnxn: EventThread shut down&lt;br/&gt;
2015-06-10 02:58:02,590 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #163&lt;br/&gt;
2015-06-10 02:58:02,592 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #163&lt;br/&gt;
2015-06-10 02:58:02,593 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: getServiceStatus took 3ms&lt;br/&gt;
2015-06-10 02:58:02,593 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #164&lt;br/&gt;
2015-06-10 02:58:02,595 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #164&lt;br/&gt;
2015-06-10 02:58:02,595 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: monitorHealth took 2ms&lt;br/&gt;
2015-06-10 02:58:02,595 DEBUG org.apache.hadoop.ha.ZKFailoverController: rechecking for electability from bad state&lt;br/&gt;
2015-06-10 02:58:02,598 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Attempting active election for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:58:02,600 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Establishing zookeeper connection for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:58:02,600 INFO org.apache.zookeeper.ZooKeeper: Initiating client connection, connectString=zdh196:2181,zdh195:2181,zdh197:2181 sessionTimeout=10000 watcher=org.apache.hadoop.ha.ActiveStandbyElector$WatcherWithClientRef@6d4f0202&lt;br/&gt;
2015-06-10 02:58:02,603 INFO org.apache.zookeeper.ClientCnxn: Opening socket connection to server zdh195/10.43.156.195:2181. Will not attempt to authenticate using SASL (unknown error)&lt;br/&gt;
2015-06-10 02:58:02,603 INFO org.apache.zookeeper.ClientCnxn: Socket connection established to zdh195/10.43.156.195:2181, initiating session&lt;br/&gt;
2015-06-10 02:58:02,603 DEBUG org.apache.zookeeper.ClientCnxn: Session establishment request sent on zdh195/10.43.156.195:2181&lt;br/&gt;
2015-06-10 02:58:02,606 INFO org.apache.zookeeper.ClientCnxn: Session establishment complete on server zdh195/10.43.156.195:2181, sessionid = 0x24d91acb5cb1969, negotiated timeout = 10000&lt;br/&gt;
2015-06-10 02:58:02,610 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Created new connection for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:58:02,613 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Watcher event type: None with state:SyncConnected for path:null connectionState: TERMINATED for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:58:02,614 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session connected.&lt;br/&gt;
2015-06-10 02:58:02,614 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x24d91acb5cb1969, packet:: clientPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock serverPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock finished:false header:: 1,1  replyHeader:: 1,38654797525,-110  request:: &apos;/hadoop-ha/cluster195/ActiveStandbyElectorLock,#aa636c75737465723139351236e6e311a67a646831393520ffffffa84628ffffffd33e,v{s{31,s&lt;/p&gt;
{&apos;world,&apos;anyone}}},1  response::  &lt;br/&gt;
2015-06-10 02:58:02,618 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: CreateNode result: -110 for path: /hadoop-ha/cluster195/ActiveStandbyElectorLock connectionState: CONNECTED  for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:58:02,621 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Becoming standby for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:58:02,621 INFO org.apache.hadoop.ha.ZKFailoverController: ZK Election indicated that NameNode at zdh195/10.43.156.195:9000 should become standby&lt;br/&gt;
2015-06-10 02:58:02,622 DEBUG org.apache.hadoop.ipc.Client: getting client out of cache: org.apache.hadoop.ipc.Client@7007cf85&lt;br/&gt;
2015-06-10 02:58:02,622 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #165&lt;br/&gt;
2015-06-10 02:58:02,624 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs got value #165&lt;br/&gt;
2015-06-10 02:58:02,624 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: transitionToStandby took 2ms&lt;br/&gt;
2015-06-10 02:58:02,624 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh195/10.43.156.195:9000 to standby state&lt;br/&gt;
2015-06-10 02:58:02,625 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Monitoring active leader for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:58:02,627 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x24d91acb5cb1969, packet:: clientPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock serverPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock finished:false header:: 2,3  replyHeader:: 2,38654797525,0  request:: &apos;/hadoop-ha/cluster195/ActiveStandbyElectorLock,T  response:: s{38654797522,38654797522,1433876281592,1433876281592,0,0,0,165948932252965224,31,0,38654797522} &lt;br/&gt;
2015-06-10 02:58:02,628 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: StatNode result: 0 for path: /hadoop-ha/cluster195/ActiveStandbyElectorLock connectionState: CONNECTED for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:58:03,185 DEBUG org.apache.zookeeper.ClientCnxn: Got notification sessionid:0x24d91acb5cb1969&lt;br/&gt;
2015-06-10 02:58:03,185 DEBUG org.apache.zookeeper.ClientCnxn: Got WatchedEvent state:SyncConnected type:NodeDeleted path:/hadoop-ha/cluster195/ActiveStandbyElectorLock for sessionid 0x24d91acb5cb1969&lt;br/&gt;
2015-06-10 02:58:03,188 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Watcher event type: NodeDeleted with state:SyncConnected for path:/hadoop-ha/cluster195/ActiveStandbyElectorLock connectionState: CONNECTED for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:58:03,191 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x24d91acb5cb1969, packet:: clientPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock serverPath:/hadoop-ha/cluster195/ActiveStandbyElectorLock finished:false header:: 3,1  replyHeader:: 3,38654797527,0  request:: &apos;/hadoop-ha/cluster195/ActiveStandbyElectorLock,#aa636c75737465723139351236e6e311a67a646831393520ffffffa84628ffffffd33e,v{s{31,s{&apos;world,&apos;anyone}
&lt;p&gt;}},1  response:: &apos;/hadoop-ha/cluster195/ActiveStandbyElectorLock &lt;br/&gt;
2015-06-10 02:58:03,194 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: CreateNode result: 0 for path: /hadoop-ha/cluster195/ActiveStandbyElectorLock connectionState: CONNECTED  for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-10 02:58:03,194 INFO org.apache.hadoop.ha.ActiveStandbyElector: Checking for any old active which needs to be fenced...&lt;br/&gt;
2015-06-10 02:58:03,196 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x24d91acb5cb1969, packet:: clientPath:null serverPath:null finished:false header:: 4,4  replyHeader:: 4,38654797527,0  request:: &apos;/hadoop-ha/cluster195/ActiveBreadCrumb,F  response:: #aa636c75737465723139351236e6e321a67a646831393620ffffffa84628ffffffd33e,s&lt;/p&gt;
{38654797508,38654797523,1433876273998,1433876281689,3,0,0,0,31,0,38654797508}
&lt;p&gt; &lt;br/&gt;
2015-06-10 02:58:03,198 INFO org.apache.hadoop.ha.ActiveStandbyElector: Old node exists: 0a0a636c757374657231393512036e6e321a067a646831393620a84628d33e&lt;br/&gt;
2015-06-10 02:58:03,201 DEBUG org.apache.hadoop.hdfs.server.namenode.NameNode: Setting fs.defaultFS to hdfs://zdh196:9000&lt;br/&gt;
2015-06-10 02:58:03,202 INFO org.apache.hadoop.ha.ZKFailoverController: Should fence: NameNode at zdh196/10.43.156.196:9000&lt;br/&gt;
2015-06-10 02:58:03,204 DEBUG org.apache.hadoop.ipc.Client: getting client out of cache: org.apache.hadoop.ipc.Client@7007cf85&lt;br/&gt;
2015-06-10 02:58:03,205 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh196/10.43.156.196:9000 from hdfs sending #166&lt;br/&gt;
2015-06-10 02:58:03,269 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh196/10.43.156.196:9000 from hdfs got value #166&lt;br/&gt;
2015-06-10 02:58:03,270 DEBUG org.apache.hadoop.ipc.ProtobufRpcEngine: Call: transitionToStandby took 65ms&lt;br/&gt;
2015-06-10 02:58:03,270 DEBUG org.apache.hadoop.ipc.Client: stopping client from cache: org.apache.hadoop.ipc.Client@7007cf85&lt;br/&gt;
2015-06-10 02:58:03,270 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh196/10.43.156.196:9000 to standby state without fencing&lt;br/&gt;
2015-06-10 02:58:03,270 INFO org.apache.hadoop.ha.ActiveStandbyElector: Writing znode /hadoop-ha/cluster195/ActiveBreadCrumb to indicate that the local node is the most recent active...&lt;br/&gt;
2015-06-10 02:58:03,274 DEBUG org.apache.zookeeper.ClientCnxn: Reading reply sessionid:0x24d91acb5cb1969, packet:: clientPath:null serverPath:null finished:false header:: 5,5  replyHeader:: 5,38654797528,0  request:: &apos;/hadoop-ha/cluster195/ActiveBreadCrumb,#aa636c75737465723139351236e6e311a67a646831393520ffffffa84628ffffffd33e,3  response:: s&lt;/p&gt;
{38654797508,38654797528,1433876273998,1433876283271,4,0,0,0,31,0,38654797508}
&lt;p&gt; &lt;br/&gt;
2015-06-10 02:58:03,276 DEBUG org.apache.hadoop.ha.ActiveStandbyElector: Becoming active for elector id=1893177739 appData=0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e cb=Elector callbacks for NameNode at zdh195/10.43.156.195:9000&lt;/p&gt;

&lt;p&gt;2015-06-10 02:58:03,277 INFO org.apache.hadoop.ha.ZKFailoverController: Trying to make NameNode at zdh195/10.43.156.195:9000 active...&lt;br/&gt;
2015-06-10 02:58:03,278 DEBUG org.apache.hadoop.ipc.Client: getting client out of cache: org.apache.hadoop.ipc.Client@7007cf85&lt;br/&gt;
2015-06-10 02:58:03,278 DEBUG org.apache.hadoop.ipc.Client: IPC Client (256152889) connection to zdh195/10.43.156.195:9000 from hdfs sending #167&lt;/p&gt;</comment>
                            <comment id="14581560" author="lvchuanwen" created="Thu, 11 Jun 2015 07:02:07 +0000"  >&lt;p&gt;You can try the command hdfs haadmin -failover nn1 nn2 , and then see if the active node nn1 is normal.&lt;br/&gt;
nn1 will always change state .active -&amp;gt; standby -&amp;gt; active -&amp;gt; standby .......&lt;br/&gt;
sorry for my poor english ,hope you can understand.thanks.&lt;/p&gt;</comment>
                            <comment id="14581590" author="vinayrpet" created="Thu, 11 Jun 2015 07:38:47 +0000"  >&lt;p&gt;Which version of Hadoop You are using?&lt;br/&gt;
Because I can see below logs (excluded DEBUG),&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2015-06-10 02:57:56,073 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh195/10.43.156.195:9000 to active state
2015-06-10 02:57:56,092 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully became active. Successfully transitioned NameNode at zdh195/10.43.156.195:9000 to active state
2015-06-10 02:57:57,082 ERROR org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh195/10.43.156.195:9000 has changed the serviceState to active. Expected was standby. Quitting election marking fencing necessary.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Immediately after &lt;tt&gt;becomeActive()&lt;/tt&gt;, ERROR log is showing state expected is &lt;tt&gt;standby&lt;/tt&gt;. &lt;tt&gt;serviceState&lt;/tt&gt; is changed to &lt;tt&gt;active&lt;/tt&gt; in &lt;tt&gt;becomeActive()&lt;/tt&gt; immediately after above log.&lt;/p&gt;

&lt;p&gt;IMO, this is possible only if &lt;tt&gt;volatile&lt;/tt&gt; is not present while declaring &lt;tt&gt;serviceState&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;volatile&lt;/span&gt; HAServiceState serviceState = HAServiceState.INITIALIZING;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;do you have this  in your code?&lt;/p&gt;</comment>
                            <comment id="14581665" author="lvchuanwen" created="Thu, 11 Jun 2015 08:21:09 +0000"  >&lt;p&gt;version 2.5.0. &lt;br/&gt;
volatile is present &lt;/p&gt;</comment>
                            <comment id="14581700" author="vinayrpet" created="Thu, 11 Jun 2015 09:04:44 +0000"  >&lt;p&gt;There is no difference in the code for the normal auto failover and failover using haadmin.&lt;/p&gt;

&lt;p&gt;Normal auto failover is working for you?&lt;/p&gt;</comment>
                            <comment id="14581725" author="lvchuanwen" created="Thu, 11 Jun 2015 09:36:57 +0000"  >&lt;p&gt;auto failover is normal . when i kill the process of active namenode nn1 ,nn2 can transition to active .&lt;br/&gt;
I find if the key ha.health-monitor.check-interval.ms setting is two different values. hdfs haadmin is no problem.&lt;br/&gt;
nn1 setting&lt;br/&gt;
        &amp;lt;property&amp;gt;&lt;br/&gt;
        &amp;lt;name&amp;gt;ha.health-monitor.check-interval.ms&amp;lt;/name&amp;gt;&lt;br/&gt;
        &amp;lt;value&amp;gt;2000&amp;lt;/value&amp;gt;&lt;br/&gt;
        &amp;lt;/property&amp;gt;&lt;br/&gt;
nn2 setting&lt;br/&gt;
        &amp;lt;property&amp;gt;&lt;br/&gt;
        &amp;lt;name&amp;gt;ha.health-monitor.check-interval.ms&amp;lt;/name&amp;gt;&lt;br/&gt;
        &amp;lt;value&amp;gt;1000&amp;lt;/value&amp;gt;&lt;br/&gt;
        &amp;lt;/property&amp;gt;&lt;/p&gt;</comment>
                            <comment id="14581735" author="vinayrpet" created="Thu, 11 Jun 2015 09:44:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;when i kill the process of active namenode nn1 ,nn2 can transition to active .&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;When you kill active nn2, whether nn1 is transitioning to active?&lt;/p&gt;</comment>
                            <comment id="14581763" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:19 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581764" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:26 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581765" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:27 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581766" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:30 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581767" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:30 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581768" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:30 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581769" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:30 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581770" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:30 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581771" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:31 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581772" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:32 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581773" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:32 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581774" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:32 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581775" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:32 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581776" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:40 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581777" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:41 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581778" author="lvchuanwen" created="Thu, 11 Jun 2015 10:10:41 +0000"  >&lt;p&gt;yes .hadoop-deamon.sh start namenode nn1 then kill nn2 &#65292;nn1 can  transition to active&lt;/p&gt;</comment>
                            <comment id="14581795" author="vinayrpet" created="Thu, 11 Jun 2015 10:40:54 +0000"  >&lt;p&gt;I am not getting whats the problem in your cluster. That too only with haadmin failover where as auto failover works fine.&lt;/p&gt;

&lt;p&gt;Can you share the autofailover logs for zkfc.&lt;/p&gt;</comment>
                            <comment id="14582751" author="xinglong.li" created="Fri, 12 Jun 2015 00:55:33 +0000"  >&lt;p&gt;&#39030;&#65281;&lt;/p&gt;</comment>
                            <comment id="14582800" author="lvchuanwen" created="Fri, 12 Jun 2015 01:36:39 +0000"  >&lt;p&gt;Use Cases&#65306;&lt;br/&gt;
1.NN1 was Active and NN2 was Standby ,kill NN1 . NN2 transition to active.&lt;br/&gt;
2.hadoop-daemon.sh start namenode NN2. NOW.NN1 was Standby and NN2 was Active .&lt;br/&gt;
3.kill NN2 ,NN1 transition to active.&lt;br/&gt;
Attaching hdfs-nn1-zkfc-host195.log file and hdfs-nn2-zkfc-host196.log file&lt;/p&gt;</comment>
                            <comment id="14582802" author="lvchuanwen" created="Fri, 12 Jun 2015 01:37:50 +0000"  >&lt;p&gt;############################hdfs-nn1-zkfc-host195.log################################&lt;/p&gt;

&lt;p&gt;2015-06-12 02:25:38,799 WARN org.apache.hadoop.ha.HealthMonitor: Transport-level exception trying to monitor health of NameNode at zdh195/10.43.156.195:9000: Failed on local exception: java.io.EOFException; Host Details : local host is: &quot;zdh195/10.43.156.195&quot;; destination host is: &quot;zdh195&quot;:9000; &lt;br/&gt;
2015-06-12 02:25:38,799 INFO org.apache.hadoop.ha.HealthMonitor: Entering state SERVICE_NOT_RESPONDING&lt;br/&gt;
2015-06-12 02:25:38,800 INFO org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh195/10.43.156.195:9000 entered state: SERVICE_NOT_RESPONDING&lt;br/&gt;
2015-06-12 02:25:38,800 INFO org.apache.hadoop.ha.ZKFailoverController: Quitting master election for NameNode at zdh195/10.43.156.195:9000 and marking that fencing is necessary&lt;br/&gt;
2015-06-12 02:25:38,800 INFO org.apache.hadoop.ha.ActiveStandbyElector: Yielding from election&lt;br/&gt;
2015-06-12 02:25:38,803 INFO org.apache.zookeeper.ZooKeeper: Session: 0x24d91acb5cb1c33 closed&lt;br/&gt;
2015-06-12 02:25:38,803 WARN org.apache.hadoop.ha.ActiveStandbyElector: Ignoring stale result from old client with sessionId 0x24d91acb5cb1c33&lt;br/&gt;
2015-06-12 02:25:38,803 INFO org.apache.zookeeper.ClientCnxn: EventThread shut down&lt;br/&gt;
2015-06-12 02:25:40,805 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: zdh195/10.43.156.195:9000. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=1, sleepTime=1000 MILLISECONDS)&lt;br/&gt;
2015-06-12 02:25:40,807 WARN org.apache.hadoop.ha.HealthMonitor: Transport-level exception trying to monitor health of NameNode at zdh195/10.43.156.195:9000: Call From zdh195/10.43.156.195 to zdh195:9000 failed on connection exception: java.net.ConnectException: &#25298;&#32477;&#36830;&#25509;; For more details see:  &lt;a href=&quot;http://wiki.apache.org/hadoop/ConnectionRefused&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/hadoop/ConnectionRefused&lt;/a&gt;&lt;br/&gt;
...&lt;br/&gt;
...&lt;br/&gt;
...&lt;br/&gt;
2015-06-12 02:27:22,976 WARN org.apache.hadoop.ha.HealthMonitor: Transport-level exception trying to monitor health of NameNode at zdh195/10.43.156.195:9000: Call From zdh195/10.43.156.195 to zdh195:9000 failed on connection exception: java.net.ConnectException: &#25298;&#32477;&#36830;&#25509;; For more details see:  &lt;a href=&quot;http://wiki.apache.org/hadoop/ConnectionRefused&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/hadoop/ConnectionRefused&lt;/a&gt;&lt;br/&gt;
2015-06-12 02:27:24,978 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: zdh195/10.43.156.195:9000. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=1, sleepTime=1000 MILLISECONDS)&lt;br/&gt;
2015-06-12 02:27:24,979 WARN org.apache.hadoop.ha.HealthMonitor: Transport-level exception trying to monitor health of NameNode at zdh195/10.43.156.195:9000: Call From zdh195/10.43.156.195 to zdh195:9000 failed on connection exception: java.net.ConnectException: &#25298;&#32477;&#36830;&#25509;; For more details see:  &lt;a href=&quot;http://wiki.apache.org/hadoop/ConnectionRefused&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/hadoop/ConnectionRefused&lt;/a&gt;&lt;br/&gt;
2015-06-12 02:27:26,981 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: zdh195/10.43.156.195:9000. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=1, sleepTime=1000 MILLISECONDS)&lt;br/&gt;
2015-06-12 02:27:27,810 INFO org.apache.hadoop.ha.HealthMonitor: Entering state SERVICE_HEALTHY&lt;br/&gt;
2015-06-12 02:27:27,810 INFO org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh195/10.43.156.195:9000 entered state: SERVICE_HEALTHY&lt;br/&gt;
2015-06-12 02:27:27,811 INFO org.apache.zookeeper.ZooKeeper: Initiating client connection, connectString=zdh196:2181,zdh195:2181,zdh197:2181 sessionTimeout=10000 watcher=org.apache.hadoop.ha.ActiveStandbyElector$WatcherWithClientRef@651a6959&lt;br/&gt;
2015-06-12 02:27:27,812 INFO org.apache.zookeeper.ClientCnxn: Opening socket connection to server zdh195/10.43.156.195:2181. Will not attempt to authenticate using SASL (unknown error)&lt;br/&gt;
2015-06-12 02:27:27,812 INFO org.apache.zookeeper.ClientCnxn: Socket connection established to zdh195/10.43.156.195:2181, initiating session&lt;br/&gt;
2015-06-12 02:27:27,814 INFO org.apache.zookeeper.ClientCnxn: Session establishment complete on server zdh195/10.43.156.195:2181, sessionid = 0x24d91acb5cb1c51, negotiated timeout = 10000&lt;br/&gt;
2015-06-12 02:27:27,815 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session connected.&lt;br/&gt;
2015-06-12 02:27:27,816 INFO org.apache.hadoop.ha.ZKFailoverController: ZK Election indicated that NameNode at zdh195/10.43.156.195:9000 should become standby&lt;br/&gt;
2015-06-12 02:27:27,824 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh195/10.43.156.195:9000 to standby state&lt;br/&gt;
2015-06-12 02:27:48,662 INFO org.apache.hadoop.ha.ActiveStandbyElector: Checking for any old active which needs to be fenced...&lt;br/&gt;
2015-06-12 02:27:48,663 INFO org.apache.hadoop.ha.ActiveStandbyElector: Old node exists: 0a0a636c757374657231393512036e6e321a067a646831393620a84628d33e&lt;br/&gt;
2015-06-12 02:27:48,665 INFO org.apache.hadoop.ha.ZKFailoverController: Should fence: NameNode at zdh196/10.43.156.196:9000&lt;br/&gt;
2015-06-12 02:27:49,668 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: zdh196/10.43.156.196:9000. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=1, sleepTime=1000 MILLISECONDS)&lt;br/&gt;
2015-06-12 02:27:49,670 WARN org.apache.hadoop.ha.FailoverController: Unable to gracefully make NameNode at zdh196/10.43.156.196:9000 standby (unable to connect)&lt;br/&gt;
java.net.ConnectException: Call From zdh195/10.43.156.195 to zdh196:9000 failed on connection exception: java.net.ConnectException: &#25298;&#32477;&#36830;&#25509;; For more details see:  &lt;a href=&quot;http://wiki.apache.org/hadoop/ConnectionRefused&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/hadoop/ConnectionRefused&lt;/a&gt;&lt;br/&gt;
	at sun.reflect.GeneratedConstructorAccessor24.newInstance(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)&lt;br/&gt;
	at java.lang.reflect.Constructor.newInstance(Constructor.java:526)&lt;br/&gt;
	at org.apache.hadoop.net.NetUtils.wrapWithMessage(NetUtils.java:783)&lt;br/&gt;
	at org.apache.hadoop.net.NetUtils.wrapException(NetUtils.java:730)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client.call(Client.java:1415)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client.call(Client.java:1364)&lt;br/&gt;
	at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:206)&lt;br/&gt;
	at com.sun.proxy.$Proxy12.transitionToStandby(Unknown Source)&lt;br/&gt;
	at org.apache.hadoop.ha.protocolPB.HAServiceProtocolClientSideTranslatorPB.transitionToStandby(HAServiceProtocolClientSideTranslatorPB.java:112)&lt;br/&gt;
	at org.apache.hadoop.ha.FailoverController.tryGracefulFence(FailoverController.java:172)&lt;br/&gt;
	at org.apache.hadoop.ha.ZKFailoverController.doFence(ZKFailoverController.java:516)&lt;br/&gt;
	at org.apache.hadoop.ha.ZKFailoverController.fenceOldActive(ZKFailoverController.java:507)&lt;br/&gt;
	at org.apache.hadoop.ha.ZKFailoverController.access$1100(ZKFailoverController.java:61)&lt;br/&gt;
	at org.apache.hadoop.ha.ZKFailoverController$ElectorCallbacks.fenceOldActive(ZKFailoverController.java:894)&lt;br/&gt;
	at org.apache.hadoop.ha.ActiveStandbyElector.fenceOldActive(ActiveStandbyElector.java:901)&lt;br/&gt;
	at org.apache.hadoop.ha.ActiveStandbyElector.becomeActive(ActiveStandbyElector.java:800)&lt;br/&gt;
	at org.apache.hadoop.ha.ActiveStandbyElector.processResult(ActiveStandbyElector.java:415)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:605)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:499)&lt;br/&gt;
Caused by: java.net.ConnectException: &#25298;&#32477;&#36830;&#25509;&lt;br/&gt;
	at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)&lt;br/&gt;
	at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:739)&lt;br/&gt;
	at org.apache.hadoop.net.SocketIOWithTimeout.connect(SocketIOWithTimeout.java:206)&lt;br/&gt;
	at org.apache.hadoop.net.NetUtils.connect(NetUtils.java:529)&lt;br/&gt;
	at org.apache.hadoop.net.NetUtils.connect(NetUtils.java:493)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client$Connection.setupConnection(Client.java:606)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:700)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client$Connection.access$2800(Client.java:367)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client.getConnection(Client.java:1463)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client.call(Client.java:1382)&lt;br/&gt;
	... 14 more&lt;br/&gt;
2015-06-12 02:27:49,671 INFO org.apache.hadoop.ha.NodeFencer: ====== Beginning Service Fencing Process... ======&lt;br/&gt;
2015-06-12 02:27:49,671 INFO org.apache.hadoop.ha.NodeFencer: Trying method 1/2: org.apache.hadoop.ha.SshFenceByTcpPort(null)&lt;br/&gt;
2015-06-12 02:27:49,674 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Connecting to zdh196...&lt;br/&gt;
2015-06-12 02:27:49,674 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Connecting to zdh196 port 22&lt;br/&gt;
2015-06-12 02:27:49,676 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Connection established&lt;br/&gt;
2015-06-12 02:27:49,700 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Remote version string: SSH-2.0-OpenSSH_5.3&lt;br/&gt;
2015-06-12 02:27:49,700 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Local version string: SSH-2.0-JSCH-0.1.42&lt;br/&gt;
2015-06-12 02:27:49,700 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: CheckCiphers: aes256-ctr,aes192-ctr,aes128-ctr,aes256-cbc,aes192-cbc,aes128-cbc,3des-ctr,arcfour,arcfour128,arcfour256&lt;br/&gt;
2015-06-12 02:27:49,707 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: aes256-ctr is not available.&lt;br/&gt;
2015-06-12 02:27:49,707 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: aes192-ctr is not available.&lt;br/&gt;
2015-06-12 02:27:49,707 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: aes256-cbc is not available.&lt;br/&gt;
2015-06-12 02:27:49,707 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: aes192-cbc is not available.&lt;br/&gt;
2015-06-12 02:27:49,707 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: arcfour256 is not available.&lt;br/&gt;
2015-06-12 02:27:49,707 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_KEXINIT sent&lt;br/&gt;
2015-06-12 02:27:49,708 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_KEXINIT received&lt;br/&gt;
2015-06-12 02:27:49,708 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: kex: server-&amp;gt;client aes128-ctr hmac-md5 none&lt;br/&gt;
2015-06-12 02:27:49,708 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: kex: client-&amp;gt;server aes128-ctr hmac-md5 none&lt;br/&gt;
2015-06-12 02:27:49,712 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_KEXDH_INIT sent&lt;br/&gt;
2015-06-12 02:27:49,712 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: expecting SSH_MSG_KEXDH_REPLY&lt;br/&gt;
2015-06-12 02:27:49,719 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: ssh_rsa_verify: signature true&lt;br/&gt;
2015-06-12 02:27:49,720 WARN org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Permanently added &apos;zdh196&apos; (RSA) to the list of known hosts.&lt;br/&gt;
2015-06-12 02:27:49,720 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_NEWKEYS sent&lt;br/&gt;
2015-06-12 02:27:49,720 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_NEWKEYS received&lt;br/&gt;
2015-06-12 02:27:49,721 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_SERVICE_REQUEST sent&lt;br/&gt;
2015-06-12 02:27:49,721 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_SERVICE_ACCEPT received&lt;br/&gt;
2015-06-12 02:27:49,723 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Authentications that can continue: gssapi-with-mic,publickey,keyboard-interactive,password&lt;br/&gt;
2015-06-12 02:27:49,723 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Next authentication method: gssapi-with-mic&lt;br/&gt;
2015-06-12 02:27:49,727 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Authentications that can continue: publickey,keyboard-interactive,password&lt;br/&gt;
2015-06-12 02:27:49,727 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Next authentication method: publickey&lt;br/&gt;
2015-06-12 02:27:49,771 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Authentication succeeded (publickey).&lt;br/&gt;
2015-06-12 02:27:49,772 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Connected to zdh196&lt;br/&gt;
2015-06-12 02:27:49,772 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Looking for process running on port 9000&lt;br/&gt;
2015-06-12 02:27:51,758 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Indeterminate response from trying to kill service. Verifying whether it is running using nc...&lt;br/&gt;
2015-06-12 02:27:53,454 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Verified that the service is down.&lt;br/&gt;
2015-06-12 02:27:53,455 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Disconnecting from zdh196 port 22&lt;br/&gt;
2015-06-12 02:27:53,455 INFO org.apache.hadoop.ha.NodeFencer: ====== Fencing successful by method org.apache.hadoop.ha.SshFenceByTcpPort(null) ======&lt;br/&gt;
2015-06-12 02:27:53,455 INFO org.apache.hadoop.ha.ActiveStandbyElector: Writing znode /hadoop-ha/cluster195/ActiveBreadCrumb to indicate that the local node is the most recent active...&lt;br/&gt;
2015-06-12 02:27:53,455 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Caught an exception, leaving main loop due to Socket closed&lt;/p&gt;

&lt;p&gt;2015-06-12 02:27:53,458 INFO org.apache.hadoop.ha.ZKFailoverController: Trying to make NameNode at zdh195/10.43.156.195:9000 active...&lt;/p&gt;

&lt;p&gt;2015-06-12 02:27:54,871 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh195/10.43.156.195:9000 to active state&lt;/p&gt;

&lt;p&gt;2015-06-12 02:27:56,878 ERROR org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh195/10.43.156.195:9000 has changed the serviceState to active. Expected was standby. Quitting election marking fencing necessary.&lt;br/&gt;
2015-06-12 02:27:56,878 INFO org.apache.hadoop.ha.ActiveStandbyElector: Yielding from election&lt;br/&gt;
2015-06-12 02:27:56,882 INFO org.apache.zookeeper.ZooKeeper: Session: 0x24d91acb5cb1c51 closed&lt;br/&gt;
2015-06-12 02:27:56,882 WARN org.apache.hadoop.ha.ActiveStandbyElector: Ignoring stale result from old client with sessionId 0x24d91acb5cb1c51&lt;br/&gt;
2015-06-12 02:27:56,882 INFO org.apache.zookeeper.ClientCnxn: EventThread shut down&lt;br/&gt;
2015-06-12 02:27:57,885 INFO org.apache.zookeeper.ZooKeeper: Initiating client connection, connectString=zdh196:2181,zdh195:2181,zdh197:2181 sessionTimeout=10000 watcher=org.apache.hadoop.ha.ActiveStandbyElector$WatcherWithClientRef@70f0acec&lt;br/&gt;
2015-06-12 02:27:57,886 INFO org.apache.zookeeper.ClientCnxn: Opening socket connection to server zdh195/10.43.156.195:2181. Will not attempt to authenticate using SASL (unknown error)&lt;br/&gt;
2015-06-12 02:27:57,887 INFO org.apache.zookeeper.ClientCnxn: Socket connection established to zdh195/10.43.156.195:2181, initiating session&lt;br/&gt;
2015-06-12 02:27:57,889 INFO org.apache.zookeeper.ClientCnxn: Session establishment complete on server zdh195/10.43.156.195:2181, sessionid = 0x24d91acb5cb1c52, negotiated timeout = 10000&lt;br/&gt;
2015-06-12 02:27:57,891 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session connected.&lt;br/&gt;
2015-06-12 02:27:57,895 INFO org.apache.hadoop.ha.ActiveStandbyElector: Checking for any old active which needs to be fenced...&lt;br/&gt;
2015-06-12 02:27:57,896 INFO org.apache.hadoop.ha.ActiveStandbyElector: Old node exists: 0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e&lt;br/&gt;
2015-06-12 02:27:57,896 INFO org.apache.hadoop.ha.ActiveStandbyElector: But old node has our own data, so don&apos;t need to fence it.&lt;br/&gt;
2015-06-12 02:27:57,896 INFO org.apache.hadoop.ha.ActiveStandbyElector: Writing znode /hadoop-ha/cluster195/ActiveBreadCrumb to indicate that the local node is the most recent active...&lt;/p&gt;

&lt;p&gt;2015-06-12 02:27:57,899 INFO org.apache.hadoop.ha.ZKFailoverController: Trying to make NameNode at zdh195/10.43.156.195:9000 active...&lt;br/&gt;
2015-06-12 02:27:57,901 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh195/10.43.156.195:9000 to active state&lt;/p&gt;
</comment>
                            <comment id="14582806" author="lvchuanwen" created="Fri, 12 Jun 2015 01:39:08 +0000"  >&lt;p&gt;######################################hdfs-nn2-zkfc-host196.log file#######################################&lt;/p&gt;

&lt;p&gt;2015-06-12 02:25:54,146 INFO org.apache.hadoop.ha.ActiveStandbyElector: Checking for any old active which needs to be fenced...&lt;br/&gt;
2015-06-12 02:25:54,147 INFO org.apache.hadoop.ha.ActiveStandbyElector: Old node exists: 0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e&lt;br/&gt;
2015-06-12 02:25:54,149 INFO org.apache.hadoop.ha.ZKFailoverController: Should fence: NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-12 02:25:55,151 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: zdh195/10.43.156.195:9000. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=1, sleepTime=1000 MILLISECONDS)&lt;br/&gt;
2015-06-12 02:25:55,152 WARN org.apache.hadoop.ha.FailoverController: Unable to gracefully make NameNode at zdh195/10.43.156.195:9000 standby (unable to connect)&lt;br/&gt;
java.net.ConnectException: Call From zdh196/10.43.156.196 to zdh195:9000 failed on connection exception: java.net.ConnectException: &#25298;&#32477;&#36830;&#25509;; For more details see:  &lt;a href=&quot;http://wiki.apache.org/hadoop/ConnectionRefused&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/hadoop/ConnectionRefused&lt;/a&gt;&lt;br/&gt;
	at sun.reflect.GeneratedConstructorAccessor24.newInstance(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)&lt;br/&gt;
	at java.lang.reflect.Constructor.newInstance(Constructor.java:526)&lt;br/&gt;
	at org.apache.hadoop.net.NetUtils.wrapWithMessage(NetUtils.java:783)&lt;br/&gt;
	at org.apache.hadoop.net.NetUtils.wrapException(NetUtils.java:730)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client.call(Client.java:1415)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client.call(Client.java:1364)&lt;br/&gt;
	at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:206)&lt;br/&gt;
	at com.sun.proxy.$Proxy12.transitionToStandby(Unknown Source)&lt;br/&gt;
	at org.apache.hadoop.ha.protocolPB.HAServiceProtocolClientSideTranslatorPB.transitionToStandby(HAServiceProtocolClientSideTranslatorPB.java:112)&lt;br/&gt;
	at org.apache.hadoop.ha.FailoverController.tryGracefulFence(FailoverController.java:172)&lt;br/&gt;
	at org.apache.hadoop.ha.ZKFailoverController.doFence(ZKFailoverController.java:516)&lt;br/&gt;
	at org.apache.hadoop.ha.ZKFailoverController.fenceOldActive(ZKFailoverController.java:507)&lt;br/&gt;
	at org.apache.hadoop.ha.ZKFailoverController.access$1100(ZKFailoverController.java:61)&lt;br/&gt;
	at org.apache.hadoop.ha.ZKFailoverController$ElectorCallbacks.fenceOldActive(ZKFailoverController.java:894)&lt;br/&gt;
	at org.apache.hadoop.ha.ActiveStandbyElector.fenceOldActive(ActiveStandbyElector.java:901)&lt;br/&gt;
	at org.apache.hadoop.ha.ActiveStandbyElector.becomeActive(ActiveStandbyElector.java:800)&lt;br/&gt;
	at org.apache.hadoop.ha.ActiveStandbyElector.processResult(ActiveStandbyElector.java:415)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:605)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:499)&lt;br/&gt;
Caused by: java.net.ConnectException: &#25298;&#32477;&#36830;&#25509;&lt;br/&gt;
	at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)&lt;br/&gt;
	at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:739)&lt;br/&gt;
	at org.apache.hadoop.net.SocketIOWithTimeout.connect(SocketIOWithTimeout.java:206)&lt;br/&gt;
	at org.apache.hadoop.net.NetUtils.connect(NetUtils.java:529)&lt;br/&gt;
	at org.apache.hadoop.net.NetUtils.connect(NetUtils.java:493)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client$Connection.setupConnection(Client.java:606)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:700)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client$Connection.access$2800(Client.java:367)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client.getConnection(Client.java:1463)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client.call(Client.java:1382)&lt;br/&gt;
	... 14 more&lt;br/&gt;
2015-06-12 02:25:55,153 INFO org.apache.hadoop.ha.NodeFencer: ====== Beginning Service Fencing Process... ======&lt;br/&gt;
2015-06-12 02:25:55,154 INFO org.apache.hadoop.ha.NodeFencer: Trying method 1/2: org.apache.hadoop.ha.SshFenceByTcpPort(null)&lt;br/&gt;
2015-06-12 02:25:55,157 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Connecting to zdh195...&lt;br/&gt;
2015-06-12 02:25:55,157 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Connecting to zdh195 port 22&lt;br/&gt;
2015-06-12 02:25:55,159 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Connection established&lt;br/&gt;
2015-06-12 02:25:55,188 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Remote version string: SSH-2.0-OpenSSH_5.3&lt;br/&gt;
2015-06-12 02:25:55,188 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Local version string: SSH-2.0-JSCH-0.1.42&lt;br/&gt;
2015-06-12 02:25:55,189 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: CheckCiphers: aes256-ctr,aes192-ctr,aes128-ctr,aes256-cbc,aes192-cbc,aes128-cbc,3des-ctr,arcfour,arcfour128,arcfour256&lt;br/&gt;
2015-06-12 02:25:55,194 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: aes256-ctr is not available.&lt;br/&gt;
2015-06-12 02:25:55,194 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: aes192-ctr is not available.&lt;br/&gt;
2015-06-12 02:25:55,194 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: aes256-cbc is not available.&lt;br/&gt;
2015-06-12 02:25:55,194 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: aes192-cbc is not available.&lt;br/&gt;
2015-06-12 02:25:55,194 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: arcfour256 is not available.&lt;br/&gt;
2015-06-12 02:25:55,194 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_KEXINIT sent&lt;br/&gt;
2015-06-12 02:25:55,194 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_KEXINIT received&lt;br/&gt;
2015-06-12 02:25:55,194 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: kex: server-&amp;gt;client aes128-ctr hmac-md5 none&lt;br/&gt;
2015-06-12 02:25:55,194 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: kex: client-&amp;gt;server aes128-ctr hmac-md5 none&lt;br/&gt;
2015-06-12 02:25:55,197 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_KEXDH_INIT sent&lt;br/&gt;
2015-06-12 02:25:55,197 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: expecting SSH_MSG_KEXDH_REPLY&lt;br/&gt;
2015-06-12 02:25:55,205 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: ssh_rsa_verify: signature true&lt;br/&gt;
2015-06-12 02:25:55,205 WARN org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Permanently added &apos;zdh195&apos; (RSA) to the list of known hosts.&lt;br/&gt;
2015-06-12 02:25:55,205 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_NEWKEYS sent&lt;br/&gt;
2015-06-12 02:25:55,205 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_NEWKEYS received&lt;br/&gt;
2015-06-12 02:25:55,206 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_SERVICE_REQUEST sent&lt;br/&gt;
2015-06-12 02:25:55,207 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_SERVICE_ACCEPT received&lt;br/&gt;
2015-06-12 02:25:55,209 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Authentications that can continue: gssapi-with-mic,publickey,keyboard-interactive,password&lt;br/&gt;
2015-06-12 02:25:55,209 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Next authentication method: gssapi-with-mic&lt;br/&gt;
2015-06-12 02:25:55,215 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Authentications that can continue: publickey,keyboard-interactive,password&lt;br/&gt;
2015-06-12 02:25:55,215 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Next authentication method: publickey&lt;br/&gt;
2015-06-12 02:25:55,263 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Authentication succeeded (publickey).&lt;br/&gt;
2015-06-12 02:25:55,263 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Connected to zdh195&lt;br/&gt;
2015-06-12 02:25:55,263 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Looking for process running on port 9000&lt;br/&gt;
2015-06-12 02:25:57,418 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Indeterminate response from trying to kill service. Verifying whether it is running using nc...&lt;br/&gt;
2015-06-12 02:25:59,266 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Verified that the service is down.&lt;br/&gt;
2015-06-12 02:25:59,266 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Disconnecting from zdh195 port 22&lt;br/&gt;
2015-06-12 02:25:59,267 INFO org.apache.hadoop.ha.NodeFencer: ====== Fencing successful by method org.apache.hadoop.ha.SshFenceByTcpPort(null) ======&lt;br/&gt;
2015-06-12 02:25:59,267 INFO org.apache.hadoop.ha.ActiveStandbyElector: Writing znode /hadoop-ha/cluster195/ActiveBreadCrumb to indicate that the local node is the most recent active...&lt;br/&gt;
2015-06-12 02:25:59,267 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Caught an exception, leaving main loop due to Socket closed&lt;/p&gt;

&lt;p&gt;2015-06-12 02:25:59,271 INFO org.apache.hadoop.ha.ZKFailoverController: Trying to make NameNode at zdh196/10.43.156.196:9000 active...&lt;/p&gt;

&lt;p&gt;2015-06-12 02:26:00,596 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh196/10.43.156.196:9000 to active state&lt;/p&gt;

&lt;p&gt;2015-06-12 02:26:02,608 ERROR org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh196/10.43.156.196:9000 has changed the serviceState to active. Expected was standby. Quitting election marking fencing necessary.&lt;br/&gt;
2015-06-12 02:26:02,608 INFO org.apache.hadoop.ha.ActiveStandbyElector: Yielding from election&lt;br/&gt;
2015-06-12 02:26:02,614 INFO org.apache.zookeeper.ZooKeeper: Session: 0x24d91acb5cb1c4f closed&lt;br/&gt;
2015-06-12 02:26:02,615 WARN org.apache.hadoop.ha.ActiveStandbyElector: Ignoring stale result from old client with sessionId 0x24d91acb5cb1c4f&lt;br/&gt;
2015-06-12 02:26:02,615 INFO org.apache.zookeeper.ClientCnxn: EventThread shut down&lt;br/&gt;
2015-06-12 02:26:03,619 INFO org.apache.zookeeper.ZooKeeper: Initiating client connection, connectString=zdh196:2181,zdh195:2181,zdh197:2181 sessionTimeout=10000 watcher=org.apache.hadoop.ha.ActiveStandbyElector$WatcherWithClientRef@33f89c4e&lt;br/&gt;
2015-06-12 02:26:03,622 INFO org.apache.zookeeper.ClientCnxn: Opening socket connection to server zdh195/10.43.156.195:2181. Will not attempt to authenticate using SASL (unknown error)&lt;br/&gt;
2015-06-12 02:26:03,623 INFO org.apache.zookeeper.ClientCnxn: Socket connection established to zdh195/10.43.156.195:2181, initiating session&lt;br/&gt;
2015-06-12 02:26:03,626 INFO org.apache.zookeeper.ClientCnxn: Session establishment complete on server zdh195/10.43.156.195:2181, sessionid = 0x24d91acb5cb1c50, negotiated timeout = 10000&lt;br/&gt;
2015-06-12 02:26:03,627 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session connected.&lt;br/&gt;
2015-06-12 02:26:03,629 INFO org.apache.hadoop.ha.ActiveStandbyElector: Checking for any old active which needs to be fenced...&lt;br/&gt;
2015-06-12 02:26:03,631 INFO org.apache.hadoop.ha.ActiveStandbyElector: Old node exists: 0a0a636c757374657231393512036e6e321a067a646831393620a84628d33e&lt;br/&gt;
2015-06-12 02:26:03,631 INFO org.apache.hadoop.ha.ActiveStandbyElector: But old node has our own data, so don&apos;t need to fence it.&lt;br/&gt;
2015-06-12 02:26:03,631 INFO org.apache.hadoop.ha.ActiveStandbyElector: Writing znode /hadoop-ha/cluster195/ActiveBreadCrumb to indicate that the local node is the most recent active...&lt;/p&gt;

&lt;p&gt;2015-06-12 02:26:03,635 INFO org.apache.hadoop.ha.ZKFailoverController: Trying to make NameNode at zdh196/10.43.156.196:9000 active...&lt;br/&gt;
2015-06-12 02:26:03,638 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh196/10.43.156.196:9000 to active state&lt;/p&gt;

&lt;p&gt;2015-06-12 02:28:03,996 WARN org.apache.hadoop.ha.HealthMonitor: Transport-level exception trying to monitor health of NameNode at zdh196/10.43.156.196:9000: Failed on local exception: java.io.EOFException; Host Details : local host is: &quot;zdh196/10.43.156.196&quot;; destination host is: &quot;zdh196&quot;:9000; &lt;br/&gt;
2015-06-12 02:28:03,997 INFO org.apache.hadoop.ha.HealthMonitor: Entering state SERVICE_NOT_RESPONDING&lt;br/&gt;
2015-06-12 02:28:03,997 INFO org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh196/10.43.156.196:9000 entered state: SERVICE_NOT_RESPONDING&lt;br/&gt;
2015-06-12 02:28:03,997 INFO org.apache.hadoop.ha.ZKFailoverController: Quitting master election for NameNode at zdh196/10.43.156.196:9000 and marking that fencing is necessary&lt;br/&gt;
2015-06-12 02:28:03,997 INFO org.apache.hadoop.ha.ActiveStandbyElector: Yielding from election&lt;br/&gt;
2015-06-12 02:28:04,000 INFO org.apache.zookeeper.ZooKeeper: Session: 0x24d91acb5cb1c50 closed&lt;br/&gt;
2015-06-12 02:28:04,001 WARN org.apache.hadoop.ha.ActiveStandbyElector: Ignoring stale result from old client with sessionId 0x24d91acb5cb1c50&lt;br/&gt;
2015-06-12 02:28:04,001 INFO org.apache.zookeeper.ClientCnxn: EventThread shut down&lt;br/&gt;
2015-06-12 02:28:06,002 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: zdh196/10.43.156.196:9000. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=1, sleepTime=1000 MILLISECONDS)&lt;br/&gt;
2015-06-12 02:28:06,004 WARN org.apache.hadoop.ha.HealthMonitor: Transport-level exception trying to monitor health of NameNode at zdh196/10.43.156.196:9000: Call From zdh196/10.43.156.196 to zdh196:9000 failed on connection exception: java.net.ConnectException: &#25298;&#32477;&#36830;&#25509;; For more details see:  &lt;a href=&quot;http://wiki.apache.org/hadoop/ConnectionRefused&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/hadoop/ConnectionRefused&lt;/a&gt;&lt;br/&gt;
...&lt;br/&gt;
...&lt;br/&gt;
...&lt;br/&gt;
2015-06-12 02:30:26,197 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: zdh196/10.43.156.196:9000. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=1, sleepTime=1000 MILLISECONDS)&lt;br/&gt;
2015-06-12 02:30:26,198 WARN org.apache.hadoop.ha.HealthMonitor: Transport-level exception trying to monitor health of NameNode at zdh196/10.43.156.196:9000: Call From zdh196/10.43.156.196 to zdh196:9000 failed on connection exception: java.net.ConnectException: &#25298;&#32477;&#36830;&#25509;; For more details see:  &lt;a href=&quot;http://wiki.apache.org/hadoop/ConnectionRefused&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/hadoop/ConnectionRefused&lt;/a&gt;&lt;br/&gt;
2015-06-12 02:30:28,199 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: zdh196/10.43.156.196:9000. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=1, sleepTime=1000 MILLISECONDS)&lt;br/&gt;
2015-06-12 02:30:28,200 WARN org.apache.hadoop.ha.HealthMonitor: Transport-level exception trying to monitor health of NameNode at zdh196/10.43.156.196:9000: Call From zdh196/10.43.156.196 to zdh196:9000 failed on connection exception: java.net.ConnectException: &#25298;&#32477;&#36830;&#25509;; For more details see:  &lt;a href=&quot;http://wiki.apache.org/hadoop/ConnectionRefused&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/hadoop/ConnectionRefused&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14582914" author="vinayrpet" created="Fri, 12 Jun 2015 04:30:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;2015-06-12 02:26:02,608 ERROR org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh196/10.43.156.196:9000 has changed the serviceState to active. Expected was standby. Quitting election marking fencing necessary.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2015-06-12 02:27:56,878 ERROR org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh195/10.43.156.195:9000 has changed the serviceState to active. Expected was standby. Quitting election marking fencing necessary.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The use case mentioned is normal auto failover. Not the manual failover using haadmin commands.&lt;br/&gt;
And I am seeing both NN1 and NN2 are not staying in Active mode if the transition happens from standby-&amp;gt;active. This is strange.&lt;/p&gt;

&lt;p&gt;Can you check this ?&lt;/p&gt;

&lt;p&gt;1. Stop both ZKFCs. and NNs.&lt;br/&gt;
2. Start only one ZKFC and NN. It should successfully convert to active and check whether it is staying in ACTIVE for long time.&lt;br/&gt;
3. Attach the logs for ZKFC after restart, (logs from the restarted point, all lines)&lt;br/&gt;
4. Also attach the ZKFailoverController.java source code you are using.&lt;/p&gt;</comment>
                            <comment id="14583024" author="lvchuanwen" created="Fri, 12 Jun 2015 06:23:52 +0000"  >&lt;p&gt;Answer 2.when start only one ZKFC and NN &#65292;the NN  can be staying in ACTIVE for long time.&lt;/p&gt;

&lt;p&gt;############################hdfs-nn1-zkfc-host195.log################################&lt;/p&gt;

&lt;p&gt;2015-06-12 07:18:11,471 INFO org.apache.hadoop.hdfs.tools.DFSZKFailoverController: Failover controller configured for NameNode NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-12 07:18:11,608 INFO org.apache.zookeeper.ZooKeeper: Client environment:zookeeper.version=3.4.5-cdh5.3.2--1, built on 05/15/2015 03:44 GMT&lt;br/&gt;
2015-06-12 07:18:11,608 INFO org.apache.zookeeper.ZooKeeper: Client environment:host.name=zdh195&lt;br/&gt;
2015-06-12 07:18:11,608 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.version=1.7.0_55&lt;br/&gt;
2015-06-12 07:18:11,608 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.vendor=Oracle Corporation&lt;br/&gt;
2015-06-12 07:18:11,608 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.home=/usr/java/jdk/jre&lt;br/&gt;
2015-06-12 07:18:11,608 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.class.path=/home/hdfs/hdfs/etc/hadoop:/home/hdfs/hdfs/share/hadoop/common/lib/jsr305-1.3.9.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jets3t-0.9.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-cli-1.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/curator-client-2.6.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jsch-0.1.42.jar:/home/hdfs/hdfs/share/hadoop/common/lib/avro-1.7.6-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/api-asn1-api-1.0.0-M20.jar:/home/hdfs/hdfs/share/hadoop/common/lib/curator-framework-2.6.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/api-util-1.0.0-M20.jar:/home/hdfs/hdfs/share/hadoop/common/lib/slf4j-api-1.7.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jsp-api-2.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/httpclient-4.2.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/java-xmlbuilder-0.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/hadoop-auth-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jetty-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/xz-1.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jackson-jaxrs-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-net-3.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-io-2.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jersey-core-1.9.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-logging-1.1.3.jar:/home/hdfs/hdfs/share/hadoop/common/lib/guava-11.0.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-httpclient-3.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/asm-3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-digester-1.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-lang-2.6.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jackson-xc-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/curator-recipes-2.6.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/activation-1.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jasper-compiler-5.5.23.jar:/home/hdfs/hdfs/share/hadoop/common/lib/cdh-commons-1.04.03.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-math3-3.1.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/servlet-api-2.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-codec-1.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jersey-json-1.9.jar:/home/hdfs/hdfs/share/hadoop/common/lib/stax-api-1.0-2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/apacheds-i18n-2.0.0-M15.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-configuration-1.6.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-compress-1.4.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/apacheds-kerberos-codec-2.0.0-M15.jar:/home/hdfs/hdfs/share/hadoop/common/lib/mockito-all-1.8.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jackson-mapper-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/zookeeper-3.4.5-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jetty-util-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jaxb-api-2.2.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-el-1.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/httpcore-4.2.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-beanutils-core-1.8.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jasper-runtime-5.5.23.jar:/home/hdfs/hdfs/share/hadoop/common/lib/gson-2.2.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/log4j-1.2.17.jar:/home/hdfs/hdfs/share/hadoop/common/lib/hadoop-annotations-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/snappy-java-1.0.4.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jettison-1.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/netty-3.6.2.Final.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-collections-3.2.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jaxb-impl-2.2.3-1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/hamcrest-core-1.3.jar:/home/hdfs/hdfs/share/hadoop/common/lib/zdh-restclient-1.04.01.jar:/home/hdfs/hdfs/share/hadoop/common/lib/protobuf-java-2.5.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/cooma-0.4.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/xmlenc-0.52.jar:/home/hdfs/hdfs/share/hadoop/common/lib/junit-4.11.jar:/home/hdfs/hdfs/share/hadoop/common/lib/slf4j-log4j12-1.7.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/security-checkclients-1.04.03.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jersey-server-1.9.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jackson-core-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/paranamer-2.3.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-beanutils-1.7.0.jar:/home/hdfs/hdfs/share/hadoop/common/hadoop-nfs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/hadoop-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/hadoop-common-2.5.0-cdh5.3.2-tests.jar:/home/hdfs/hdfs/share/hadoop/hdfs:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jsr305-1.3.9.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-shuffle-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-cli-1.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-aws-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-databind-2.2.3.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/leveldbjni-all-1.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jersey-client-1.9.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jsp-api-2.1.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/httpclient-4.2.5.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-daemon-1.0.13.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-lzo-0.4.20.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jetty-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-jaxrs-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-client-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-io-2.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jersey-core-1.9.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-core-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-app-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-logging-1.1.3.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/guava-11.0.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/asm-3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-lang-2.6.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-xc-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-yarn-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/activation-1.1.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-core-2.2.3.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/servlet-api-2.5.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-yarn-api-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-codec-1.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/stax-api-1.0-2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-mapper-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-yarn-server-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-hdfs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jetty-util-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jaxb-api-2.2.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-el-1.0.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-annotations-2.2.3.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/httpcore-4.2.5.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jasper-runtime-5.5.23.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/log4j-1.2.17.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-jobclient-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/netty-3.6.2.Final.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/aws-java-sdk-1.7.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/protobuf-java-2.5.0.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/xmlenc-0.52.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jersey-server-1.9.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-yarn-client-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-core-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-hdfs-2.5.0-cdh5.3.2-tests.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-hdfs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-hdfs-nfs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-concurrent-copy-2.5.0-cdh5.3.2-tests.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-concurrent-copy-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jsr305-1.3.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-cli-1.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/leveldbjni-all-1.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-client-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/aopalliance-1.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/javax.inject-1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-guice-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jline-0.9.94.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jetty-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/xz-1.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jackson-jaxrs-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-io-2.4.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-core-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-logging-1.1.3.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/guava-11.0.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-httpclient-3.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/asm-3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-lang-2.6.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jackson-xc-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/guice-3.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/guice-servlet-3.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/activation-1.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/servlet-api-2.5.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-codec-1.4.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-json-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/stax-api-1.0-2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-compress-1.4.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jackson-mapper-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/zookeeper-3.4.5-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jetty-util-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jaxb-api-2.2.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/log4j-1.2.17.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jettison-1.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-collections-3.2.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jaxb-impl-2.2.3-1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/protobuf-java-2.5.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-server-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jackson-core-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-applications-unmanaged-am-launcher-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-resourcemanager-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-web-proxy-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-nodemanager-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-api-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-tests-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-applicationhistoryservice-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-applications-distributedshell-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-client-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/leveldbjni-all-1.8.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/aopalliance-1.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/javax.inject-1.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/avro-1.7.6-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jersey-guice-1.9.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/xz-1.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/commons-io-2.4.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jersey-core-1.9.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/asm-3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/guice-3.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/guice-servlet-3.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/commons-compress-1.4.1.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jackson-mapper-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/log4j-1.2.17.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/hadoop-annotations-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/snappy-java-1.0.4.1.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/netty-3.6.2.Final.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/hamcrest-core-1.3.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/protobuf-java-2.5.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/junit-4.11.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jersey-server-1.9.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jackson-core-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/paranamer-2.3.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-shuffle-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-hs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-nativetask-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-core-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-app-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-2.5.0-cdh5.3.2-tests.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-hs-plugins-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/contrib/capacity-scheduler/&lt;b&gt;.jar:/home/hdfs/hdfs/contrib/capacity-scheduler/&lt;/b&gt;.jar:/home/hdfs/hdfs/contrib/capacity-scheduler/*.jar&lt;br/&gt;
2015-06-12 07:18:11,608 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.library.path=/home/hdfs/hdfs/lib/native&lt;br/&gt;
2015-06-12 07:18:11,608 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.io.tmpdir=/tmp&lt;br/&gt;
2015-06-12 07:18:11,608 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.compiler=&amp;lt;NA&amp;gt;&lt;br/&gt;
2015-06-12 07:18:11,608 INFO org.apache.zookeeper.ZooKeeper: Client environment:os.name=Linux&lt;br/&gt;
2015-06-12 07:18:11,609 INFO org.apache.zookeeper.ZooKeeper: Client environment:os.arch=amd64&lt;br/&gt;
2015-06-12 07:18:11,609 INFO org.apache.zookeeper.ZooKeeper: Client environment:os.version=2.6.32-431.el6.x86_64&lt;br/&gt;
2015-06-12 07:18:11,609 INFO org.apache.zookeeper.ZooKeeper: Client environment:user.name=hdfs&lt;br/&gt;
2015-06-12 07:18:11,609 INFO org.apache.zookeeper.ZooKeeper: Client environment:user.home=/home/hdfs&lt;br/&gt;
2015-06-12 07:18:11,609 INFO org.apache.zookeeper.ZooKeeper: Client environment:user.dir=/home/hdfs/hdfs&lt;br/&gt;
2015-06-12 07:18:11,609 INFO org.apache.zookeeper.ZooKeeper: Initiating client connection, connectString=zdh196:2181,zdh195:2181,zdh197:2181 sessionTimeout=10000 watcher=org.apache.hadoop.ha.ActiveStandbyElector$WatcherWithClientRef@3c1e1fd3&lt;br/&gt;
2015-06-12 07:18:11,624 INFO org.apache.zookeeper.ClientCnxn: Opening socket connection to server zdh195/10.43.156.195:2181. Will not attempt to authenticate using SASL (unknown error)&lt;br/&gt;
2015-06-12 07:18:11,626 INFO org.apache.zookeeper.ClientCnxn: Socket connection established to zdh195/10.43.156.195:2181, initiating session&lt;br/&gt;
2015-06-12 07:18:11,632 INFO org.apache.zookeeper.ClientCnxn: Session establishment complete on server zdh195/10.43.156.195:2181, sessionid = 0x24d91acb5cb1c57, negotiated timeout = 10000&lt;br/&gt;
2015-06-12 07:18:11,636 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session connected.&lt;br/&gt;
2015-06-12 07:18:11,662 INFO org.apache.hadoop.ipc.CallQueueManager: Using callQueue class java.util.concurrent.LinkedBlockingQueue&lt;br/&gt;
2015-06-12 07:18:11,684 INFO org.apache.hadoop.ipc.Server: Starting Socket Reader #1 for port 8019&lt;br/&gt;
2015-06-12 07:18:11,712 INFO org.apache.hadoop.ipc.Server: IPC Server Responder: starting&lt;br/&gt;
2015-06-12 07:18:11,713 INFO org.apache.hadoop.ipc.Server: IPC Server listener on 8019: starting&lt;br/&gt;
2015-06-12 07:18:11,831 INFO org.apache.hadoop.ha.HealthMonitor: Entering state SERVICE_HEALTHY&lt;br/&gt;
2015-06-12 07:18:11,831 INFO org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh195/10.43.156.195:9000 entered state: SERVICE_HEALTHY&lt;br/&gt;
2015-06-12 07:18:11,854 INFO org.apache.hadoop.ha.ZKFailoverController: ZK Election indicated that NameNode at zdh195/10.43.156.195:9000 should become standby&lt;br/&gt;
2015-06-12 07:18:11,863 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh195/10.43.156.195:9000 to standby state&lt;br/&gt;
2015-06-12 07:20:02,104 INFO org.apache.hadoop.hdfs.tools.DFSZKFailoverController: Failover controller configured for NameNode NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-12 07:20:02,250 INFO org.apache.zookeeper.ZooKeeper: Client environment:zookeeper.version=3.4.5-cdh5.3.2--1, built on 05/15/2015 03:44 GMT&lt;br/&gt;
2015-06-12 07:20:02,250 INFO org.apache.zookeeper.ZooKeeper: Client environment:host.name=zdh195&lt;br/&gt;
2015-06-12 07:20:02,250 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.version=1.7.0_55&lt;br/&gt;
2015-06-12 07:20:02,250 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.vendor=Oracle Corporation&lt;br/&gt;
2015-06-12 07:20:02,250 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.home=/usr/java/jdk/jre&lt;br/&gt;
2015-06-12 07:20:02,250 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.class.path=/home/hdfs/hdfs/etc/hadoop:/home/hdfs/hdfs/share/hadoop/common/lib/jsr305-1.3.9.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jets3t-0.9.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-cli-1.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/curator-client-2.6.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jsch-0.1.42.jar:/home/hdfs/hdfs/share/hadoop/common/lib/avro-1.7.6-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/api-asn1-api-1.0.0-M20.jar:/home/hdfs/hdfs/share/hadoop/common/lib/curator-framework-2.6.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/api-util-1.0.0-M20.jar:/home/hdfs/hdfs/share/hadoop/common/lib/slf4j-api-1.7.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jsp-api-2.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/httpclient-4.2.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/java-xmlbuilder-0.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/hadoop-auth-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jetty-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/xz-1.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jackson-jaxrs-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-net-3.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-io-2.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jersey-core-1.9.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-logging-1.1.3.jar:/home/hdfs/hdfs/share/hadoop/common/lib/guava-11.0.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-httpclient-3.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/asm-3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-digester-1.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-lang-2.6.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jackson-xc-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/curator-recipes-2.6.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/activation-1.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jasper-compiler-5.5.23.jar:/home/hdfs/hdfs/share/hadoop/common/lib/cdh-commons-1.04.03.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-math3-3.1.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/servlet-api-2.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-codec-1.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jersey-json-1.9.jar:/home/hdfs/hdfs/share/hadoop/common/lib/stax-api-1.0-2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/apacheds-i18n-2.0.0-M15.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-configuration-1.6.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-compress-1.4.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/apacheds-kerberos-codec-2.0.0-M15.jar:/home/hdfs/hdfs/share/hadoop/common/lib/mockito-all-1.8.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jackson-mapper-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/zookeeper-3.4.5-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jetty-util-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jaxb-api-2.2.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-el-1.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/httpcore-4.2.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-beanutils-core-1.8.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jasper-runtime-5.5.23.jar:/home/hdfs/hdfs/share/hadoop/common/lib/gson-2.2.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/log4j-1.2.17.jar:/home/hdfs/hdfs/share/hadoop/common/lib/hadoop-annotations-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/snappy-java-1.0.4.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jettison-1.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/netty-3.6.2.Final.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-collections-3.2.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jaxb-impl-2.2.3-1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/hamcrest-core-1.3.jar:/home/hdfs/hdfs/share/hadoop/common/lib/zdh-restclient-1.04.01.jar:/home/hdfs/hdfs/share/hadoop/common/lib/protobuf-java-2.5.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/cooma-0.4.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/xmlenc-0.52.jar:/home/hdfs/hdfs/share/hadoop/common/lib/junit-4.11.jar:/home/hdfs/hdfs/share/hadoop/common/lib/slf4j-log4j12-1.7.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/security-checkclients-1.04.03.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jersey-server-1.9.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jackson-core-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/paranamer-2.3.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-beanutils-1.7.0.jar:/home/hdfs/hdfs/share/hadoop/common/hadoop-nfs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/hadoop-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/hadoop-common-2.5.0-cdh5.3.2-tests.jar:/home/hdfs/hdfs/share/hadoop/hdfs:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jsr305-1.3.9.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-shuffle-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-cli-1.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-aws-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-databind-2.2.3.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/leveldbjni-all-1.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jersey-client-1.9.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jsp-api-2.1.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/httpclient-4.2.5.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-daemon-1.0.13.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-lzo-0.4.20.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jetty-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-jaxrs-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-client-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-io-2.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jersey-core-1.9.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-core-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-app-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-logging-1.1.3.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/guava-11.0.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/asm-3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-lang-2.6.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-xc-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-yarn-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/activation-1.1.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-core-2.2.3.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/servlet-api-2.5.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-yarn-api-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-codec-1.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/stax-api-1.0-2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-mapper-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-yarn-server-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-hdfs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jetty-util-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jaxb-api-2.2.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-el-1.0.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-annotations-2.2.3.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/httpcore-4.2.5.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jasper-runtime-5.5.23.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/log4j-1.2.17.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-jobclient-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/netty-3.6.2.Final.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/aws-java-sdk-1.7.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/protobuf-java-2.5.0.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/xmlenc-0.52.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jersey-server-1.9.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-yarn-client-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-core-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-hdfs-2.5.0-cdh5.3.2-tests.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-hdfs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-hdfs-nfs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-concurrent-copy-2.5.0-cdh5.3.2-tests.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-concurrent-copy-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jsr305-1.3.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-cli-1.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/leveldbjni-all-1.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-client-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/aopalliance-1.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/javax.inject-1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-guice-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jline-0.9.94.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jetty-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/xz-1.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jackson-jaxrs-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-io-2.4.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-core-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-logging-1.1.3.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/guava-11.0.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-httpclient-3.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/asm-3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-lang-2.6.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jackson-xc-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/guice-3.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/guice-servlet-3.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/activation-1.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/servlet-api-2.5.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-codec-1.4.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-json-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/stax-api-1.0-2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-compress-1.4.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jackson-mapper-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/zookeeper-3.4.5-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jetty-util-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jaxb-api-2.2.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/log4j-1.2.17.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jettison-1.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-collections-3.2.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jaxb-impl-2.2.3-1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/protobuf-java-2.5.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-server-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jackson-core-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-applications-unmanaged-am-launcher-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-resourcemanager-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-web-proxy-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-nodemanager-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-api-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-tests-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-applicationhistoryservice-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-applications-distributedshell-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-client-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/leveldbjni-all-1.8.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/aopalliance-1.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/javax.inject-1.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/avro-1.7.6-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jersey-guice-1.9.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/xz-1.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/commons-io-2.4.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jersey-core-1.9.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/asm-3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/guice-3.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/guice-servlet-3.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/commons-compress-1.4.1.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jackson-mapper-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/log4j-1.2.17.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/hadoop-annotations-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/snappy-java-1.0.4.1.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/netty-3.6.2.Final.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/hamcrest-core-1.3.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/protobuf-java-2.5.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/junit-4.11.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jersey-server-1.9.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jackson-core-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/paranamer-2.3.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-shuffle-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-hs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-nativetask-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-core-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-app-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-2.5.0-cdh5.3.2-tests.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-hs-plugins-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/contrib/capacity-scheduler/&lt;b&gt;.jar:/home/hdfs/hdfs/contrib/capacity-scheduler/&lt;/b&gt;.jar:/home/hdfs/hdfs/contrib/capacity-scheduler/*.jar&lt;br/&gt;
2015-06-12 07:20:02,250 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.library.path=/home/hdfs/hdfs/lib/native&lt;br/&gt;
2015-06-12 07:20:02,251 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.io.tmpdir=/tmp&lt;br/&gt;
2015-06-12 07:20:02,251 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.compiler=&amp;lt;NA&amp;gt;&lt;br/&gt;
2015-06-12 07:20:02,251 INFO org.apache.zookeeper.ZooKeeper: Client environment:os.name=Linux&lt;br/&gt;
2015-06-12 07:20:02,251 INFO org.apache.zookeeper.ZooKeeper: Client environment:os.arch=amd64&lt;br/&gt;
2015-06-12 07:20:02,251 INFO org.apache.zookeeper.ZooKeeper: Client environment:os.version=2.6.32-431.el6.x86_64&lt;br/&gt;
2015-06-12 07:20:02,251 INFO org.apache.zookeeper.ZooKeeper: Client environment:user.name=hdfs&lt;br/&gt;
2015-06-12 07:20:02,251 INFO org.apache.zookeeper.ZooKeeper: Client environment:user.home=/home/hdfs&lt;br/&gt;
2015-06-12 07:20:02,251 INFO org.apache.zookeeper.ZooKeeper: Client environment:user.dir=/home/hdfs/hdfs&lt;br/&gt;
2015-06-12 07:20:02,252 INFO org.apache.zookeeper.ZooKeeper: Initiating client connection, connectString=zdh196:2181,zdh195:2181,zdh197:2181 sessionTimeout=10000 watcher=org.apache.hadoop.ha.ActiveStandbyElector$WatcherWithClientRef@3ddc25a9&lt;br/&gt;
2015-06-12 07:20:02,269 INFO org.apache.zookeeper.ClientCnxn: Opening socket connection to server zdh196/10.43.156.196:2181. Will not attempt to authenticate using SASL (unknown error)&lt;br/&gt;
2015-06-12 07:20:02,273 INFO org.apache.zookeeper.ClientCnxn: Socket connection established to zdh196/10.43.156.196:2181, initiating session&lt;br/&gt;
2015-06-12 07:20:02,285 INFO org.apache.zookeeper.ClientCnxn: Session establishment complete on server zdh196/10.43.156.196:2181, sessionid = 0x14d91acb8921ca0, negotiated timeout = 10000&lt;br/&gt;
2015-06-12 07:20:02,290 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session connected.&lt;br/&gt;
2015-06-12 07:20:02,319 INFO org.apache.hadoop.ipc.CallQueueManager: Using callQueue class java.util.concurrent.LinkedBlockingQueue&lt;br/&gt;
2015-06-12 07:20:02,342 INFO org.apache.hadoop.ipc.Server: Starting Socket Reader #1 for port 8019&lt;br/&gt;
2015-06-12 07:20:02,373 INFO org.apache.hadoop.ipc.Server: IPC Server Responder: starting&lt;br/&gt;
2015-06-12 07:20:02,373 INFO org.apache.hadoop.ipc.Server: IPC Server listener on 8019: starting&lt;br/&gt;
2015-06-12 07:20:03,442 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: zdh195/10.43.156.195:9000. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=1, sleepTime=1000 MILLISECONDS)&lt;br/&gt;
2015-06-12 07:20:03,446 WARN org.apache.hadoop.ha.HealthMonitor: Transport-level exception trying to monitor health of NameNode at zdh195/10.43.156.195:9000: Call From zdh195/10.43.156.195 to zdh195:9000 failed on connection exception: java.net.ConnectException: &#25298;&#32477;&#36830;&#25509;; For more details see:  &lt;a href=&quot;http://wiki.apache.org/hadoop/ConnectionRefused&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/hadoop/ConnectionRefused&lt;/a&gt;&lt;br/&gt;
2015-06-12 07:20:03,447 INFO org.apache.hadoop.ha.HealthMonitor: Entering state SERVICE_NOT_RESPONDING&lt;br/&gt;
2015-06-12 07:20:03,447 INFO org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh195/10.43.156.195:9000 entered state: SERVICE_NOT_RESPONDING&lt;br/&gt;
2015-06-12 07:20:03,448 INFO org.apache.hadoop.ha.ZKFailoverController: Quitting master election for NameNode at zdh195/10.43.156.195:9000 and marking that fencing is necessary&lt;br/&gt;
2015-06-12 07:20:03,448 INFO org.apache.hadoop.ha.ActiveStandbyElector: Yielding from election&lt;br/&gt;
2015-06-12 07:20:03,451 INFO org.apache.zookeeper.ZooKeeper: Session: 0x14d91acb8921ca0 closed&lt;br/&gt;
2015-06-12 07:20:03,451 INFO org.apache.zookeeper.ClientCnxn: EventThread shut down&lt;br/&gt;
2015-06-12 07:20:05,454 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: zdh195/10.43.156.195:9000. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=1, sleepTime=1000 MILLISECONDS)&lt;br/&gt;
2015-06-12 07:20:05,834 INFO org.apache.hadoop.ha.HealthMonitor: Entering state SERVICE_HEALTHY&lt;br/&gt;
2015-06-12 07:20:05,834 INFO org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh195/10.43.156.195:9000 entered state: SERVICE_HEALTHY&lt;br/&gt;
2015-06-12 07:20:05,844 INFO org.apache.zookeeper.ZooKeeper: Initiating client connection, connectString=zdh196:2181,zdh195:2181,zdh197:2181 sessionTimeout=10000 watcher=org.apache.hadoop.ha.ActiveStandbyElector$WatcherWithClientRef@14b867db&lt;br/&gt;
2015-06-12 07:20:05,845 INFO org.apache.zookeeper.ClientCnxn: Opening socket connection to server zdh197/10.43.156.197:2181. Will not attempt to authenticate using SASL (unknown error)&lt;br/&gt;
2015-06-12 07:20:05,846 INFO org.apache.zookeeper.ClientCnxn: Socket connection established to zdh197/10.43.156.197:2181, initiating session&lt;br/&gt;
2015-06-12 07:20:05,849 INFO org.apache.zookeeper.ClientCnxn: Session establishment complete on server zdh197/10.43.156.197:2181, sessionid = 0x34dcf74b50a0896, negotiated timeout = 10000&lt;br/&gt;
2015-06-12 07:20:05,854 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session connected.&lt;br/&gt;
2015-06-12 07:20:05,860 INFO org.apache.hadoop.ha.ActiveStandbyElector: Checking for any old active which needs to be fenced...&lt;br/&gt;
2015-06-12 07:20:05,865 INFO org.apache.hadoop.ha.ActiveStandbyElector: Old node exists: 0a0a636c757374657231393512036e6e321a067a646831393620a84628d33e&lt;br/&gt;
2015-06-12 07:20:05,868 INFO org.apache.hadoop.ha.ZKFailoverController: Should fence: NameNode at zdh196/10.43.156.196:9000&lt;br/&gt;
2015-06-12 07:20:06,873 INFO org.apache.hadoop.ipc.Client: Retrying connect to server: zdh196/10.43.156.196:9000. Already tried 0 time(s); retry policy is RetryUpToMaximumCountWithFixedSleep(maxRetries=1, sleepTime=1000 MILLISECONDS)&lt;br/&gt;
2015-06-12 07:20:06,877 WARN org.apache.hadoop.ha.FailoverController: Unable to gracefully make NameNode at zdh196/10.43.156.196:9000 standby (unable to connect)&lt;br/&gt;
java.net.ConnectException: Call From zdh195/10.43.156.195 to zdh196:9000 failed on connection exception: java.net.ConnectException: &#25298;&#32477;&#36830;&#25509;; For more details see:  &lt;a href=&quot;http://wiki.apache.org/hadoop/ConnectionRefused&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wiki.apache.org/hadoop/ConnectionRefused&lt;/a&gt;&lt;br/&gt;
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)&lt;br/&gt;
	at java.lang.reflect.Constructor.newInstance(Constructor.java:526)&lt;br/&gt;
	at org.apache.hadoop.net.NetUtils.wrapWithMessage(NetUtils.java:783)&lt;br/&gt;
	at org.apache.hadoop.net.NetUtils.wrapException(NetUtils.java:730)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client.call(Client.java:1415)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client.call(Client.java:1364)&lt;br/&gt;
	at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:206)&lt;br/&gt;
	at com.sun.proxy.$Proxy12.transitionToStandby(Unknown Source)&lt;br/&gt;
	at org.apache.hadoop.ha.protocolPB.HAServiceProtocolClientSideTranslatorPB.transitionToStandby(HAServiceProtocolClientSideTranslatorPB.java:112)&lt;br/&gt;
	at org.apache.hadoop.ha.FailoverController.tryGracefulFence(FailoverController.java:172)&lt;br/&gt;
	at org.apache.hadoop.ha.ZKFailoverController.doFence(ZKFailoverController.java:516)&lt;br/&gt;
	at org.apache.hadoop.ha.ZKFailoverController.fenceOldActive(ZKFailoverController.java:507)&lt;br/&gt;
	at org.apache.hadoop.ha.ZKFailoverController.access$1100(ZKFailoverController.java:61)&lt;br/&gt;
	at org.apache.hadoop.ha.ZKFailoverController$ElectorCallbacks.fenceOldActive(ZKFailoverController.java:894)&lt;br/&gt;
	at org.apache.hadoop.ha.ActiveStandbyElector.fenceOldActive(ActiveStandbyElector.java:901)&lt;br/&gt;
	at org.apache.hadoop.ha.ActiveStandbyElector.becomeActive(ActiveStandbyElector.java:800)&lt;br/&gt;
	at org.apache.hadoop.ha.ActiveStandbyElector.processResult(ActiveStandbyElector.java:415)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:605)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:499)&lt;br/&gt;
Caused by: java.net.ConnectException: &#25298;&#32477;&#36830;&#25509;&lt;br/&gt;
	at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)&lt;br/&gt;
	at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:739)&lt;br/&gt;
	at org.apache.hadoop.net.SocketIOWithTimeout.connect(SocketIOWithTimeout.java:206)&lt;br/&gt;
	at org.apache.hadoop.net.NetUtils.connect(NetUtils.java:529)&lt;br/&gt;
	at org.apache.hadoop.net.NetUtils.connect(NetUtils.java:493)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client$Connection.setupConnection(Client.java:606)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:700)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client$Connection.access$2800(Client.java:367)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client.getConnection(Client.java:1463)&lt;br/&gt;
	at org.apache.hadoop.ipc.Client.call(Client.java:1382)&lt;br/&gt;
	... 14 more&lt;br/&gt;
2015-06-12 07:20:06,881 INFO org.apache.hadoop.ha.NodeFencer: ====== Beginning Service Fencing Process... ======&lt;br/&gt;
2015-06-12 07:20:06,881 INFO org.apache.hadoop.ha.NodeFencer: Trying method 1/2: org.apache.hadoop.ha.SshFenceByTcpPort(null)&lt;br/&gt;
2015-06-12 07:20:06,899 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Connecting to zdh196...&lt;br/&gt;
2015-06-12 07:20:06,900 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Connecting to zdh196 port 22&lt;br/&gt;
2015-06-12 07:20:06,907 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Connection established&lt;br/&gt;
2015-06-12 07:20:06,931 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Remote version string: SSH-2.0-OpenSSH_5.3&lt;br/&gt;
2015-06-12 07:20:06,931 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Local version string: SSH-2.0-JSCH-0.1.42&lt;br/&gt;
2015-06-12 07:20:06,931 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: CheckCiphers: aes256-ctr,aes192-ctr,aes128-ctr,aes256-cbc,aes192-cbc,aes128-cbc,3des-ctr,arcfour,arcfour128,arcfour256&lt;br/&gt;
2015-06-12 07:20:07,105 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: aes256-ctr is not available.&lt;br/&gt;
2015-06-12 07:20:07,106 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: aes192-ctr is not available.&lt;br/&gt;
2015-06-12 07:20:07,106 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: aes256-cbc is not available.&lt;br/&gt;
2015-06-12 07:20:07,106 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: aes192-cbc is not available.&lt;br/&gt;
2015-06-12 07:20:07,106 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: arcfour256 is not available.&lt;br/&gt;
2015-06-12 07:20:07,106 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_KEXINIT sent&lt;br/&gt;
2015-06-12 07:20:07,106 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_KEXINIT received&lt;br/&gt;
2015-06-12 07:20:07,107 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: kex: server-&amp;gt;client aes128-ctr hmac-md5 none&lt;br/&gt;
2015-06-12 07:20:07,107 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: kex: client-&amp;gt;server aes128-ctr hmac-md5 none&lt;br/&gt;
2015-06-12 07:20:07,115 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_KEXDH_INIT sent&lt;br/&gt;
2015-06-12 07:20:07,115 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: expecting SSH_MSG_KEXDH_REPLY&lt;br/&gt;
2015-06-12 07:20:07,125 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: ssh_rsa_verify: signature true&lt;br/&gt;
2015-06-12 07:20:07,128 WARN org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Permanently added &apos;zdh196&apos; (RSA) to the list of known hosts.&lt;br/&gt;
2015-06-12 07:20:07,128 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_NEWKEYS sent&lt;br/&gt;
2015-06-12 07:20:07,128 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_NEWKEYS received&lt;br/&gt;
2015-06-12 07:20:07,132 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_SERVICE_REQUEST sent&lt;br/&gt;
2015-06-12 07:20:07,133 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: SSH_MSG_SERVICE_ACCEPT received&lt;br/&gt;
2015-06-12 07:20:07,135 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Authentications that can continue: gssapi-with-mic,publickey,keyboard-interactive,password&lt;br/&gt;
2015-06-12 07:20:07,135 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Next authentication method: gssapi-with-mic&lt;br/&gt;
2015-06-12 07:20:07,142 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Authentications that can continue: publickey,keyboard-interactive,password&lt;br/&gt;
2015-06-12 07:20:07,142 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Next authentication method: publickey&lt;br/&gt;
2015-06-12 07:20:07,188 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Authentication succeeded (publickey).&lt;br/&gt;
2015-06-12 07:20:07,189 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Connected to zdh196&lt;br/&gt;
2015-06-12 07:20:07,189 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Looking for process running on port 9000&lt;br/&gt;
2015-06-12 07:20:09,289 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Indeterminate response from trying to kill service. Verifying whether it is running using nc...&lt;br/&gt;
2015-06-12 07:20:11,049 INFO org.apache.hadoop.ha.SshFenceByTcpPort: Verified that the service is down.&lt;br/&gt;
2015-06-12 07:20:11,050 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Disconnecting from zdh196 port 22&lt;br/&gt;
2015-06-12 07:20:11,052 INFO org.apache.hadoop.ha.NodeFencer: ====== Fencing successful by method org.apache.hadoop.ha.SshFenceByTcpPort(null) ======&lt;br/&gt;
2015-06-12 07:20:11,052 INFO org.apache.hadoop.ha.ActiveStandbyElector: Writing znode /hadoop-ha/cluster195/ActiveBreadCrumb to indicate that the local node is the most recent active...&lt;br/&gt;
2015-06-12 07:20:11,053 INFO org.apache.hadoop.ha.SshFenceByTcpPort.jsch: Caught an exception, leaving main loop due to Socket closed&lt;br/&gt;
2015-06-12 07:20:11,061 INFO org.apache.hadoop.ha.ZKFailoverController: Trying to make NameNode at zdh195/10.43.156.195:9000 active...&lt;br/&gt;
2015-06-12 07:20:12,333 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh195/10.43.156.195:9000 to active state&lt;/p&gt;

&lt;p&gt;############################hdfs-nn2-zkfc-host196.log################################&lt;/p&gt;

&lt;p&gt;2015-06-12 07:18:26,905 INFO org.apache.hadoop.hdfs.tools.DFSZKFailoverController: Failover controller configured for NameNode NameNode at zdh196/10.43.156.196:9000&lt;br/&gt;
2015-06-12 07:18:27,042 INFO org.apache.zookeeper.ZooKeeper: Client environment:zookeeper.version=3.4.5-cdh5.3.2--1, built on 05/15/2015 03:44 GMT&lt;br/&gt;
2015-06-12 07:18:27,042 INFO org.apache.zookeeper.ZooKeeper: Client environment:host.name=zdh196&lt;br/&gt;
2015-06-12 07:18:27,042 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.version=1.7.0_55&lt;br/&gt;
2015-06-12 07:18:27,042 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.vendor=Oracle Corporation&lt;br/&gt;
2015-06-12 07:18:27,042 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.home=/usr/java/jdk/jre&lt;br/&gt;
2015-06-12 07:18:27,042 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.class.path=/home/hdfs/hdfs/etc/hadoop:/home/hdfs/hdfs/share/hadoop/common/lib/xz-1.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/hamcrest-core-1.3.jar:/home/hdfs/hdfs/share/hadoop/common/lib/curator-framework-2.6.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/activation-1.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-math3-3.1.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/cooma-0.4.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/zookeeper-3.4.5-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/paranamer-2.3.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-compress-1.4.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/curator-recipes-2.6.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/cdh-commons-1.04.03.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-cli-1.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jasper-compiler-5.5.23.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jsp-api-2.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/servlet-api-2.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jackson-core-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/mockito-all-1.8.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/asm-3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/apacheds-i18n-2.0.0-M15.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jetty-util-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/api-asn1-api-1.0.0-M20.jar:/home/hdfs/hdfs/share/hadoop/common/lib/slf4j-api-1.7.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-net-3.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/snappy-java-1.0.4.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/log4j-1.2.17.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jsch-0.1.42.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jackson-jaxrs-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-el-1.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jackson-mapper-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/xmlenc-0.52.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jackson-xc-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/stax-api-1.0-2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/junit-4.11.jar:/home/hdfs/hdfs/share/hadoop/common/lib/gson-2.2.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-digester-1.8.jar:/home/hdfs/hdfs/share/hadoop/common/lib/httpclient-4.2.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jaxb-impl-2.2.3-1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-codec-1.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jersey-server-1.9.jar:/home/hdfs/hdfs/share/hadoop/common/lib/java-xmlbuilder-0.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jersey-json-1.9.jar:/home/hdfs/hdfs/share/hadoop/common/lib/slf4j-log4j12-1.7.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-beanutils-1.7.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/httpcore-4.2.5.jar:/home/hdfs/hdfs/share/hadoop/common/lib/hadoop-auth-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/protobuf-java-2.5.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-io-2.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/hadoop-annotations-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jasper-runtime-5.5.23.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jetty-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jettison-1.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/apacheds-kerberos-codec-2.0.0-M15.jar:/home/hdfs/hdfs/share/hadoop/common/lib/zdh-restclient-1.04.01.jar:/home/hdfs/hdfs/share/hadoop/common/lib/avro-1.7.6-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jets3t-0.9.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/api-util-1.0.0-M20.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-collections-3.2.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-logging-1.1.3.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-lang-2.6.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jsr305-1.3.9.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jersey-core-1.9.jar:/home/hdfs/hdfs/share/hadoop/common/lib/curator-client-2.6.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-httpclient-3.1.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-beanutils-core-1.8.0.jar:/home/hdfs/hdfs/share/hadoop/common/lib/jaxb-api-2.2.2.jar:/home/hdfs/hdfs/share/hadoop/common/lib/netty-3.6.2.Final.jar:/home/hdfs/hdfs/share/hadoop/common/lib/security-checkclients-1.04.03.jar:/home/hdfs/hdfs/share/hadoop/common/lib/commons-configuration-1.6.jar:/home/hdfs/hdfs/share/hadoop/common/lib/guava-11.0.2.jar:/home/hdfs/hdfs/share/hadoop/common/hadoop-common-2.5.0-cdh5.3.2-tests.jar:/home/hdfs/hdfs/share/hadoop/common/hadoop-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/common/hadoop-nfs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs:/home/hdfs/hdfs/share/hadoop/hdfs/lib/activation-1.1.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-client-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/aws-java-sdk-1.7.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-cli-1.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jsp-api-2.1.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/leveldbjni-all-1.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/servlet-api-2.5.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-core-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-shuffle-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/asm-3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-app-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jetty-util-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-hdfs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-yarn-client-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/log4j-1.2.17.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-yarn-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-lzo-0.4.20.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-daemon-1.0.13.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-jaxrs-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-jobclient-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-el-1.0.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-mapper-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/xmlenc-0.52.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-xc-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/stax-api-1.0-2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-yarn-server-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-core-2.2.3.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-yarn-api-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/httpclient-4.2.5.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-codec-1.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jersey-server-1.9.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-annotations-2.2.3.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/httpcore-4.2.5.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/protobuf-java-2.5.0.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-io-2.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jasper-runtime-5.5.23.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jackson-databind-2.2.3.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-mapreduce-client-core-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jetty-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-logging-1.1.3.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/commons-lang-2.6.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jsr305-1.3.9.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jersey-core-1.9.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jaxb-api-2.2.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/jersey-client-1.9.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/netty-3.6.2.Final.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/hadoop-aws-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/lib/guava-11.0.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-hdfs-nfs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-concurrent-copy-2.5.0-cdh5.3.2-tests.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-hdfs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-hdfs-2.5.0-cdh5.3.2-tests.jar:/home/hdfs/hdfs/share/hadoop/hdfs/hadoop-concurrent-copy-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/xz-1.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/guice-3.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/activation-1.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/zookeeper-3.4.5-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-compress-1.4.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-cli-1.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/leveldbjni-all-1.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/servlet-api-2.5.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jackson-core-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-guice-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/asm-3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jetty-util-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jline-0.9.94.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/log4j-1.2.17.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/aopalliance-1.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jackson-jaxrs-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jackson-mapper-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jackson-xc-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/stax-api-1.0-2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/javax.inject-1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jaxb-impl-2.2.3-1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-codec-1.4.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-server-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-json-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/protobuf-java-2.5.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-io-2.4.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/guice-servlet-3.0.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jetty-6.1.26.cloudera.4.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jettison-1.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-collections-3.2.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-logging-1.1.3.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-lang-2.6.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jsr305-1.3.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-core-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/commons-httpclient-3.1.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jaxb-api-2.2.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/jersey-client-1.9.jar:/home/hdfs/hdfs/share/hadoop/yarn/lib/guava-11.0.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-resourcemanager-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-client-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-tests-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-applicationhistoryservice-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-api-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-nodemanager-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-server-web-proxy-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-applications-unmanaged-am-launcher-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/yarn/hadoop-yarn-applications-distributedshell-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/xz-1.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/hamcrest-core-1.3.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/guice-3.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/paranamer-2.3.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/commons-compress-1.4.1.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/leveldbjni-all-1.8.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jackson-core-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jersey-guice-1.9.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/asm-3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/snappy-java-1.0.4.1.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/log4j-1.2.17.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/aopalliance-1.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jackson-mapper-asl-1.8.8.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/junit-4.11.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/javax.inject-1.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jersey-server-1.9.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/protobuf-java-2.5.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/commons-io-2.4.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/guice-servlet-3.0.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/hadoop-annotations-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/avro-1.7.6-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/jersey-core-1.9.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/lib/netty-3.6.2.Final.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-hs-plugins-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-hs-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-shuffle-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-app-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-nativetask-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-common-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-core-2.5.0-cdh5.3.2.jar:/home/hdfs/hdfs/share/hadoop/mapreduce/hadoop-mapreduce-client-jobclient-2.5.0-cdh5.3.2-tests.jar:/home/hdfs/hdfs/contrib/capacity-scheduler/&lt;b&gt;.jar:/home/hdfs/hdfs/contrib/capacity-scheduler/&lt;/b&gt;.jar:/home/hdfs/hdfs/contrib/capacity-scheduler/*.jar&lt;br/&gt;
2015-06-12 07:18:27,043 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.library.path=/home/hdfs/hdfs/lib/native&lt;br/&gt;
2015-06-12 07:18:27,043 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.io.tmpdir=/tmp&lt;br/&gt;
2015-06-12 07:18:27,043 INFO org.apache.zookeeper.ZooKeeper: Client environment:java.compiler=&amp;lt;NA&amp;gt;&lt;br/&gt;
2015-06-12 07:18:27,043 INFO org.apache.zookeeper.ZooKeeper: Client environment:os.name=Linux&lt;br/&gt;
2015-06-12 07:18:27,043 INFO org.apache.zookeeper.ZooKeeper: Client environment:os.arch=amd64&lt;br/&gt;
2015-06-12 07:18:27,043 INFO org.apache.zookeeper.ZooKeeper: Client environment:os.version=2.6.32-431.el6.x86_64&lt;br/&gt;
2015-06-12 07:18:27,043 INFO org.apache.zookeeper.ZooKeeper: Client environment:user.name=hdfs&lt;br/&gt;
2015-06-12 07:18:27,044 INFO org.apache.zookeeper.ZooKeeper: Client environment:user.home=/home/hdfs&lt;br/&gt;
2015-06-12 07:18:27,044 INFO org.apache.zookeeper.ZooKeeper: Client environment:user.dir=/home/hdfs/hdfs&lt;br/&gt;
2015-06-12 07:18:27,044 INFO org.apache.zookeeper.ZooKeeper: Initiating client connection, connectString=zdh196:2181,zdh195:2181,zdh197:2181 sessionTimeout=10000 watcher=org.apache.hadoop.ha.ActiveStandbyElector$WatcherWithClientRef@1a722605&lt;br/&gt;
2015-06-12 07:18:27,060 INFO org.apache.zookeeper.ClientCnxn: Opening socket connection to server zdh196/10.43.156.196:2181. Will not attempt to authenticate using SASL (unknown error)&lt;br/&gt;
2015-06-12 07:18:27,065 INFO org.apache.zookeeper.ClientCnxn: Socket connection established to zdh196/10.43.156.196:2181, initiating session&lt;br/&gt;
2015-06-12 07:18:27,073 INFO org.apache.zookeeper.ClientCnxn: Session establishment complete on server zdh196/10.43.156.196:2181, sessionid = 0x14d91acb8921c9f, negotiated timeout = 10000&lt;br/&gt;
2015-06-12 07:18:27,077 INFO org.apache.hadoop.ha.ActiveStandbyElector: Session connected.&lt;br/&gt;
2015-06-12 07:18:27,104 INFO org.apache.hadoop.ipc.CallQueueManager: Using callQueue class java.util.concurrent.LinkedBlockingQueue&lt;br/&gt;
2015-06-12 07:18:27,125 INFO org.apache.hadoop.ipc.Server: Starting Socket Reader #1 for port 8019&lt;br/&gt;
2015-06-12 07:18:27,155 INFO org.apache.hadoop.ipc.Server: IPC Server Responder: starting&lt;br/&gt;
2015-06-12 07:18:27,155 INFO org.apache.hadoop.ipc.Server: IPC Server listener on 8019: starting&lt;br/&gt;
2015-06-12 07:18:27,277 INFO org.apache.hadoop.ha.HealthMonitor: Entering state SERVICE_HEALTHY&lt;br/&gt;
2015-06-12 07:18:27,277 INFO org.apache.hadoop.ha.ZKFailoverController: Local service NameNode at zdh196/10.43.156.196:9000 entered state: SERVICE_HEALTHY&lt;br/&gt;
2015-06-12 07:18:27,301 INFO org.apache.hadoop.ha.ActiveStandbyElector: Checking for any old active which needs to be fenced...&lt;br/&gt;
2015-06-12 07:18:27,309 INFO org.apache.hadoop.ha.ActiveStandbyElector: Old node exists: 0a0a636c757374657231393512036e6e311a067a646831393520a84628d33e&lt;br/&gt;
2015-06-12 07:18:27,312 INFO org.apache.hadoop.ha.ZKFailoverController: Should fence: NameNode at zdh195/10.43.156.195:9000&lt;br/&gt;
2015-06-12 07:18:27,338 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh195/10.43.156.195:9000 to standby state without fencing&lt;br/&gt;
2015-06-12 07:18:27,338 INFO org.apache.hadoop.ha.ActiveStandbyElector: Writing znode /hadoop-ha/cluster195/ActiveBreadCrumb to indicate that the local node is the most recent active...&lt;br/&gt;
2015-06-12 07:18:27,348 INFO org.apache.hadoop.ha.ZKFailoverController: Trying to make NameNode at zdh196/10.43.156.196:9000 active...&lt;br/&gt;
2015-06-12 07:18:39,494 INFO org.apache.hadoop.ha.ZKFailoverController: Successfully transitioned NameNode at zdh196/10.43.156.196:9000 to active state&lt;/p&gt;
</comment>
                            <comment id="14583029" author="lvchuanwen" created="Fri, 12 Jun 2015 06:27:31 +0000"  >&lt;p&gt;/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Licensed to the Apache Software Foundation (ASF) under one&lt;/li&gt;
	&lt;li&gt;or more contributor license agreements.  See the NOTICE file&lt;/li&gt;
	&lt;li&gt;distributed with this work for additional information&lt;/li&gt;
	&lt;li&gt;regarding copyright ownership.  The ASF licenses this file&lt;/li&gt;
	&lt;li&gt;to you under the Apache License, Version 2.0 (the&lt;/li&gt;
	&lt;li&gt;&quot;License&quot;); you may not use this file except in compliance&lt;/li&gt;
	&lt;li&gt;with the License.  You may obtain a copy of the License at&lt;br/&gt;
 *&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
 *&lt;/li&gt;
	&lt;li&gt;Unless required by applicable law or agreed to in writing, software&lt;/li&gt;
	&lt;li&gt;distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;/li&gt;
	&lt;li&gt;WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;/li&gt;
	&lt;li&gt;See the License for the specific language governing permissions and&lt;/li&gt;
	&lt;li&gt;limitations under the License.&lt;br/&gt;
 */&lt;br/&gt;
package org.apache.hadoop.ha;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;import java.io.IOException;&lt;br/&gt;
import java.net.InetSocketAddress;&lt;br/&gt;
import java.security.PrivilegedAction;&lt;br/&gt;
import java.security.PrivilegedExceptionAction;&lt;br/&gt;
import java.util.Collections;&lt;br/&gt;
import java.util.List;&lt;br/&gt;
import java.util.concurrent.Executors;&lt;br/&gt;
import java.util.concurrent.ScheduledExecutorService;&lt;br/&gt;
import java.util.concurrent.TimeUnit;&lt;/p&gt;

&lt;p&gt;import org.apache.commons.logging.Log;&lt;br/&gt;
import org.apache.commons.logging.LogFactory;&lt;br/&gt;
import org.apache.hadoop.HadoopIllegalArgumentException;&lt;br/&gt;
import org.apache.hadoop.classification.InterfaceAudience;&lt;br/&gt;
import org.apache.hadoop.conf.Configuration;&lt;br/&gt;
import org.apache.hadoop.ha.ActiveStandbyElector.ActiveNotFoundException;&lt;br/&gt;
import org.apache.hadoop.ha.ActiveStandbyElector.ActiveStandbyElectorCallback;&lt;br/&gt;
import org.apache.hadoop.ha.HAServiceProtocol.HAServiceState;&lt;br/&gt;
import org.apache.hadoop.ha.HAServiceProtocol.StateChangeRequestInfo;&lt;br/&gt;
import org.apache.hadoop.ha.HAServiceProtocol.RequestSource;&lt;br/&gt;
import org.apache.hadoop.util.ZKUtil;&lt;br/&gt;
import org.apache.hadoop.util.ZKUtil.ZKAuthInfo;&lt;br/&gt;
import org.apache.hadoop.ha.HealthMonitor.State;&lt;br/&gt;
import org.apache.hadoop.ipc.Server;&lt;br/&gt;
import org.apache.hadoop.security.AccessControlException;&lt;br/&gt;
import org.apache.hadoop.security.SecurityUtil;&lt;br/&gt;
import org.apache.hadoop.security.UserGroupInformation;&lt;br/&gt;
import org.apache.hadoop.security.authorize.PolicyProvider;&lt;br/&gt;
import org.apache.hadoop.util.StringUtils;&lt;br/&gt;
import org.apache.zookeeper.KeeperException;&lt;br/&gt;
import org.apache.zookeeper.ZooDefs.Ids;&lt;br/&gt;
import org.apache.hadoop.util.ToolRunner;&lt;br/&gt;
import org.apache.zookeeper.data.ACL;&lt;/p&gt;

&lt;p&gt;import com.google.common.annotations.VisibleForTesting;&lt;br/&gt;
import com.google.common.base.Preconditions;&lt;br/&gt;
import com.google.common.base.Throwables;&lt;br/&gt;
import com.google.common.util.concurrent.ThreadFactoryBuilder;&lt;/p&gt;


&lt;p&gt;@InterfaceAudience.LimitedPrivate(&quot;HDFS&quot;)&lt;br/&gt;
public abstract class ZKFailoverController {&lt;/p&gt;

&lt;p&gt;  static final Log LOG = LogFactory.getLog(ZKFailoverController.class);&lt;/p&gt;

&lt;p&gt;  public static final String ZK_QUORUM_KEY = &quot;ha.zookeeper.quorum&quot;;&lt;br/&gt;
  private static final String ZK_SESSION_TIMEOUT_KEY = &quot;ha.zookeeper.session-timeout.ms&quot;;&lt;br/&gt;
  private static final int ZK_SESSION_TIMEOUT_DEFAULT = 5*1000;&lt;br/&gt;
  private static final String ZK_PARENT_ZNODE_KEY = &quot;ha.zookeeper.parent-znode&quot;;&lt;br/&gt;
  public static final String ZK_ACL_KEY = &quot;ha.zookeeper.acl&quot;;&lt;br/&gt;
  private static final String ZK_ACL_DEFAULT = &quot;world:anyone:rwcda&quot;;&lt;br/&gt;
  public static final String ZK_AUTH_KEY = &quot;ha.zookeeper.auth&quot;;&lt;br/&gt;
  static final String ZK_PARENT_ZNODE_DEFAULT = &quot;/hadoop-ha&quot;;&lt;/p&gt;

&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;All of the conf keys used by the ZKFC. This is used in order to allow&lt;/li&gt;
	&lt;li&gt;them to be overridden on a per-nameservice or per-namenode basis.&lt;br/&gt;
   */&lt;br/&gt;
  protected static final String[] ZKFC_CONF_KEYS = new String[] 
{
    ZK_QUORUM_KEY,
    ZK_SESSION_TIMEOUT_KEY,
    ZK_PARENT_ZNODE_KEY,
    ZK_ACL_KEY,
    ZK_AUTH_KEY
  }
&lt;p&gt;;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  protected static final String USAGE = &lt;br/&gt;
      &quot;Usage: java zkfc [ -formatZK &lt;span class=&quot;error&quot;&gt;&amp;#91;-force&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;-nonInteractive&amp;#93;&lt;/span&gt; ]&quot;;&lt;/p&gt;

&lt;p&gt;  /** Unable to format the parent znode in ZK */&lt;br/&gt;
  static final int ERR_CODE_FORMAT_DENIED = 2;&lt;br/&gt;
  /** The parent znode doesn&apos;t exist in ZK */&lt;br/&gt;
  static final int ERR_CODE_NO_PARENT_ZNODE = 3;&lt;br/&gt;
  /** Fencing is not properly configured */&lt;br/&gt;
  static final int ERR_CODE_NO_FENCER = 4;&lt;br/&gt;
  /** Automatic failover is not enabled */&lt;br/&gt;
  static final int ERR_CODE_AUTO_FAILOVER_NOT_ENABLED = 5;&lt;br/&gt;
  /** Cannot connect to ZooKeeper */&lt;br/&gt;
  static final int ERR_CODE_NO_ZK = 6;&lt;/p&gt;

&lt;p&gt;  protected Configuration conf;&lt;br/&gt;
  private String zkQuorum;&lt;br/&gt;
  protected final HAServiceTarget localTarget;&lt;/p&gt;

&lt;p&gt;  private HealthMonitor healthMonitor;&lt;br/&gt;
  private ActiveStandbyElector elector;&lt;br/&gt;
  protected ZKFCRpcServer rpcServer;&lt;/p&gt;

&lt;p&gt;  private State lastHealthState = State.INITIALIZING;&lt;/p&gt;

&lt;p&gt;  private volatile HAServiceState serviceState = HAServiceState.INITIALIZING;&lt;/p&gt;

&lt;p&gt;  /** Set if a fatal error occurs */&lt;br/&gt;
  private String fatalError = null;&lt;/p&gt;

&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;A future nanotime before which the ZKFC will not join the election.&lt;/li&gt;
	&lt;li&gt;This is used during graceful failover.&lt;br/&gt;
   */&lt;br/&gt;
  private long delayJoiningUntilNanotime = 0;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  /** Executor on which &lt;/p&gt;
{@link #scheduleRecheck(long)}
&lt;p&gt; schedules events */&lt;br/&gt;
  private ScheduledExecutorService delayExecutor =&lt;br/&gt;
    Executors.newScheduledThreadPool(1,&lt;br/&gt;
        new ThreadFactoryBuilder().setDaemon(true)&lt;br/&gt;
            .setNameFormat(&quot;ZKFC Delay timer #%d&quot;)&lt;br/&gt;
            .build());&lt;/p&gt;

&lt;p&gt;  private ActiveAttemptRecord lastActiveAttemptRecord;&lt;br/&gt;
  private Object activeAttemptRecordLock = new Object();&lt;/p&gt;


&lt;p&gt;  protected ZKFailoverController(Configuration conf, HAServiceTarget localTarget) &lt;/p&gt;
{
    this.localTarget = localTarget;
    this.conf = conf;
  }


&lt;p&gt;  protected abstract byte[] targetToData(HAServiceTarget target);&lt;br/&gt;
  protected abstract HAServiceTarget dataToTarget(byte[] data);&lt;br/&gt;
  protected abstract void loginAsFCUser() throws IOException;&lt;br/&gt;
  protected abstract void checkRpcAdminAccess()&lt;br/&gt;
      throws AccessControlException, IOException;&lt;br/&gt;
  protected abstract InetSocketAddress getRpcAddressToBindTo();&lt;br/&gt;
  protected abstract PolicyProvider getPolicyProvider();&lt;/p&gt;

&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Return the name of a znode inside the configured parent znode in which&lt;/li&gt;
	&lt;li&gt;the ZKFC will do all of its work. This is so that multiple federated&lt;/li&gt;
	&lt;li&gt;nameservices can run on the same ZK quorum without having to manually&lt;/li&gt;
	&lt;li&gt;configure them to separate subdirectories.&lt;br/&gt;
   */&lt;br/&gt;
  protected abstract String getScopeInsideParentNode();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  public HAServiceTarget getLocalTarget() &lt;/p&gt;
{
    return localTarget;
  }

&lt;p&gt;  public int run(final String[] args) throws Exception {&lt;br/&gt;
    if (!localTarget.isAutoFailoverEnabled()) &lt;/p&gt;
{
      LOG.fatal(&quot;Automatic failover is not enabled for &quot; + localTarget + &quot;.&quot; +
          &quot; Please ensure that automatic failover is enabled in the &quot; +
          &quot;configuration before running the ZK failover controller.&quot;);
      return ERR_CODE_AUTO_FAILOVER_NOT_ENABLED;
    }
&lt;p&gt;    loginAsFCUser();&lt;br/&gt;
    try {&lt;br/&gt;
      return SecurityUtil.doAsLoginUserOrFatal(new PrivilegedAction&amp;lt;Integer&amp;gt;() {&lt;br/&gt;
        @Override&lt;br/&gt;
        public Integer run() {&lt;br/&gt;
          try &lt;/p&gt;
{
            return doRun(args);
          }
&lt;p&gt; catch (Exception t) &lt;/p&gt;
{
            throw new RuntimeException(t);
          }
&lt;p&gt; finally {&lt;br/&gt;
            if (elector != null) &lt;/p&gt;
{
              elector.terminateConnection();
            }
&lt;p&gt;          }&lt;br/&gt;
        }&lt;br/&gt;
      });&lt;br/&gt;
    } catch (RuntimeException rte) &lt;/p&gt;
{
      throw (Exception)rte.getCause();
    }
&lt;p&gt;  }&lt;/p&gt;


&lt;p&gt;  private int doRun(String[] args)&lt;br/&gt;
      throws HadoopIllegalArgumentException, IOException, InterruptedException {&lt;br/&gt;
    try &lt;/p&gt;
{
      initZK();
    }
&lt;p&gt; catch (KeeperException ke) &lt;/p&gt;
{
      LOG.fatal(&quot;Unable to start failover controller. Unable to connect &quot;
          + &quot;to ZooKeeper quorum at &quot; + zkQuorum + &quot;. Please check the &quot;
          + &quot;configured value for &quot; + ZK_QUORUM_KEY + &quot; and ensure that &quot;
          + &quot;ZooKeeper is running.&quot;);
      return ERR_CODE_NO_ZK;
    }
&lt;p&gt;    if (args.length &amp;gt; 0) {&lt;br/&gt;
      if (&quot;-formatZK&quot;.equals(args&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;)) {&lt;br/&gt;
        boolean force = false;&lt;br/&gt;
        boolean interactive = true;&lt;br/&gt;
        for (int i = 1; i &amp;lt; args.length; i++) {&lt;br/&gt;
          if (&quot;-force&quot;.equals(args&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;)) &lt;/p&gt;
{
            force = true;
          }
&lt;p&gt; else if (&quot;-nonInteractive&quot;.equals(args&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;)) &lt;/p&gt;
{
            interactive = false;
          }
&lt;p&gt; else &lt;/p&gt;
{
            badArg(args[i]);
          }
&lt;p&gt;        }&lt;br/&gt;
        return formatZK(force, interactive);&lt;br/&gt;
      } else &lt;/p&gt;
{
        badArg(args[0]);
      }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;    if (!elector.parentZNodeExists()) &lt;/p&gt;
{
      LOG.fatal(&quot;Unable to start failover controller. &quot;
          + &quot;Parent znode does not exist.\n&quot;
          + &quot;Run with -formatZK flag to initialize ZooKeeper.&quot;);
      return ERR_CODE_NO_PARENT_ZNODE;
    }

&lt;p&gt;    try &lt;/p&gt;
{
      localTarget.checkFencingConfigured();
    }
&lt;p&gt; catch (BadFencingConfigurationException e) &lt;/p&gt;
{
      LOG.fatal(&quot;Fencing is not configured for &quot; + localTarget + &quot;.\n&quot; +
          &quot;You must configure a fencing method before using automatic &quot; +
          &quot;failover.&quot;, e);
      return ERR_CODE_NO_FENCER;
    }

&lt;p&gt;    initRPC();&lt;br/&gt;
    initHM();&lt;br/&gt;
    startRPC();&lt;br/&gt;
    try &lt;/p&gt;
{
      mainLoop();
    }
&lt;p&gt; finally &lt;/p&gt;
{
      rpcServer.stopAndJoin();
      
      elector.quitElection(true);
      healthMonitor.shutdown();
      healthMonitor.join();
    }
&lt;p&gt;    return 0;&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;  private void badArg(String arg) &lt;/p&gt;
{
    printUsage();
    throw new HadoopIllegalArgumentException(
        &quot;Bad argument: &quot; + arg);
  }

&lt;p&gt;  private void printUsage() &lt;/p&gt;
{
    System.err.println(USAGE + &quot;\n&quot;);
  }

&lt;p&gt;  private int formatZK(boolean force, boolean interactive)&lt;br/&gt;
      throws IOException, InterruptedException {&lt;br/&gt;
    if (elector.parentZNodeExists()) {&lt;br/&gt;
      if (!force &amp;amp;&amp;amp; (!interactive || !confirmFormat())) &lt;/p&gt;
{
        return ERR_CODE_FORMAT_DENIED;
      }

&lt;p&gt;      try &lt;/p&gt;
{
        elector.clearParentZNode();
      }
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
        LOG.error(&quot;Unable to clear zk parent znode&quot;, e);
        return 1;
      }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;    elector.ensureParentZNode();&lt;br/&gt;
    return 0;&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;  private boolean confirmFormat() {&lt;br/&gt;
    String parentZnode = getParentZnode();&lt;br/&gt;
    System.err.println(&lt;br/&gt;
        &quot;===============================================\n&quot; +&lt;br/&gt;
        &quot;The configured parent znode &quot; + parentZnode + &quot; already exists.\n&quot; +&lt;br/&gt;
        &quot;Are you sure you want to clear all failover information from\n&quot; +&lt;br/&gt;
        &quot;ZooKeeper?\n&quot; +&lt;br/&gt;
        &quot;WARNING: Before proceeding, ensure that all HDFS services and\n&quot; +&lt;br/&gt;
        &quot;failover controllers are stopped!\n&quot; +&lt;br/&gt;
        &quot;===============================================&quot;);&lt;br/&gt;
    try &lt;/p&gt;
{
      return ToolRunner.confirmPrompt(&quot;Proceed formatting &quot; + parentZnode + &quot;?&quot;);
    }
&lt;p&gt; catch (IOException e) &lt;/p&gt;
{
      LOG.debug(&quot;Failed to confirm&quot;, e);
      return false;
    }
&lt;p&gt;  }&lt;/p&gt;

&lt;p&gt;  // ------------------------------------------&lt;br/&gt;
  // Begin actual guts of failover controller&lt;br/&gt;
  // ------------------------------------------&lt;/p&gt;

&lt;p&gt;  private void initHM() &lt;/p&gt;
{
    healthMonitor = new HealthMonitor(conf, localTarget);
    healthMonitor.addCallback(new HealthCallbacks());
    healthMonitor.addServiceStateCallback(new ServiceStateCallBacks());
    healthMonitor.start();
  }

&lt;p&gt;  protected void initRPC() throws IOException &lt;/p&gt;
{
    InetSocketAddress bindAddr = getRpcAddressToBindTo();
    rpcServer = new ZKFCRpcServer(conf, bindAddr, this, getPolicyProvider());
  }

&lt;p&gt;  protected void startRPC() throws IOException &lt;/p&gt;
{
    rpcServer.start();
  }


&lt;p&gt;  private void initZK() throws HadoopIllegalArgumentException, IOException,&lt;br/&gt;
      KeeperException {&lt;br/&gt;
    zkQuorum = conf.get(ZK_QUORUM_KEY);&lt;br/&gt;
    int zkTimeout = conf.getInt(ZK_SESSION_TIMEOUT_KEY,&lt;br/&gt;
        ZK_SESSION_TIMEOUT_DEFAULT);&lt;br/&gt;
    // Parse ACLs from configuration.&lt;br/&gt;
    String zkAclConf = conf.get(ZK_ACL_KEY, ZK_ACL_DEFAULT);&lt;br/&gt;
    zkAclConf = ZKUtil.resolveConfIndirection(zkAclConf);&lt;br/&gt;
    List&amp;lt;ACL&amp;gt; zkAcls = ZKUtil.parseACLs(zkAclConf);&lt;br/&gt;
    if (zkAcls.isEmpty()) &lt;/p&gt;
{
      zkAcls = Ids.CREATOR_ALL_ACL;
    }

&lt;p&gt;    // Parse authentication from configuration.&lt;br/&gt;
    String zkAuthConf = conf.get(ZK_AUTH_KEY);&lt;br/&gt;
    zkAuthConf = ZKUtil.resolveConfIndirection(zkAuthConf);&lt;br/&gt;
    List&amp;lt;ZKAuthInfo&amp;gt; zkAuths;&lt;br/&gt;
    if (zkAuthConf != null) &lt;/p&gt;
{
      zkAuths = ZKUtil.parseAuth(zkAuthConf);
    }
&lt;p&gt; else &lt;/p&gt;
{
      zkAuths = Collections.emptyList();
    }

&lt;p&gt;    // Sanity check configuration.&lt;br/&gt;
    Preconditions.checkArgument(zkQuorum != null,&lt;br/&gt;
        &quot;Missing required configuration &apos;%s&apos; for ZooKeeper quorum&quot;,&lt;br/&gt;
        ZK_QUORUM_KEY);&lt;br/&gt;
    Preconditions.checkArgument(zkTimeout &amp;gt; 0,&lt;br/&gt;
        &quot;Invalid ZK session timeout %s&quot;, zkTimeout);&lt;/p&gt;


&lt;p&gt;    elector = new ActiveStandbyElector(zkQuorum,&lt;br/&gt;
        zkTimeout, getParentZnode(), zkAcls, zkAuths,&lt;br/&gt;
        new ElectorCallbacks());&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;  private String getParentZnode() {&lt;br/&gt;
    String znode = conf.get(ZK_PARENT_ZNODE_KEY,&lt;br/&gt;
        ZK_PARENT_ZNODE_DEFAULT);&lt;br/&gt;
    if (!znode.endsWith(&quot;/&quot;)) &lt;/p&gt;
{
      znode += &quot;/&quot;;
    }
&lt;p&gt;    return znode + getScopeInsideParentNode();&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;  private synchronized void mainLoop() throws InterruptedException {&lt;br/&gt;
    while (fatalError == null) &lt;/p&gt;
{
      wait();
    }
&lt;p&gt;    assert fatalError != null; // only get here on fatal&lt;br/&gt;
    throw new RuntimeException(&lt;br/&gt;
        &quot;ZK Failover Controller failed: &quot; + fatalError);&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;  private synchronized void fatalError(String err) &lt;/p&gt;
{
    LOG.fatal(&quot;Fatal error occurred:&quot; + err);
    fatalError = err;
    notifyAll();
  }

&lt;p&gt;  private synchronized void becomeActive() throws ServiceFailedException {&lt;br/&gt;
    LOG.info(&quot;Trying to make &quot; + localTarget + &quot; active...&quot;);&lt;br/&gt;
    try &lt;/p&gt;
{
      HAServiceProtocolHelper.transitionToActive(localTarget.getProxy(
          conf, FailoverController.getRpcTimeoutToNewActive(conf)),
          createReqInfo());
      String msg = &quot;Successfully transitioned &quot; + localTarget +
          &quot; to active state&quot;;
      LOG.info(msg);
      recordActiveAttempt(new ActiveAttemptRecord(true, msg));

    }
&lt;p&gt; catch (Throwable t) {&lt;br/&gt;
      String msg = &quot;Couldn&apos;t make &quot; + localTarget + &quot; active&quot;;&lt;br/&gt;
      LOG.fatal(msg, t);&lt;/p&gt;

&lt;p&gt;      recordActiveAttempt(new ActiveAttemptRecord(false, msg + &quot;\n&quot; +&lt;br/&gt;
          StringUtils.stringifyException(t)));&lt;/p&gt;

&lt;p&gt;      if (t instanceof ServiceFailedException) &lt;/p&gt;
{
        throw (ServiceFailedException)t;
      }
&lt;p&gt; else &lt;/p&gt;
{
        throw new ServiceFailedException(&quot;Couldn&apos;t transition to active&quot;,
            t);
      }
&lt;p&gt;/*&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;TODO:&lt;/li&gt;
	&lt;li&gt;we need to make sure that if we get fenced and then quickly restarted,&lt;/li&gt;
	&lt;li&gt;none of these calls will retry across the restart boundary&lt;/li&gt;
	&lt;li&gt;perhaps the solution is that, whenever the nn starts, it gets a unique&lt;/li&gt;
	&lt;li&gt;ID, and when we start becoming active, we record it, and then any future&lt;/li&gt;
	&lt;li&gt;calls use the same ID&lt;br/&gt;
*/&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    }&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Store the results of the last attempt to become active.&lt;/li&gt;
	&lt;li&gt;This is used so that, during manually initiated failover,&lt;/li&gt;
	&lt;li&gt;we can report back the results of the attempt to become active&lt;/li&gt;
	&lt;li&gt;to the initiator of the failover.&lt;br/&gt;
   */&lt;br/&gt;
  private void recordActiveAttempt(&lt;br/&gt;
      ActiveAttemptRecord record) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    synchronized (activeAttemptRecordLock) {
      lastActiveAttemptRecord = record;
      activeAttemptRecordLock.notifyAll();
    }  }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Wait until one of the following events:&lt;/li&gt;
	&lt;li&gt;&amp;lt;ul&amp;gt;&lt;/li&gt;
	&lt;li&gt;&amp;lt;li&amp;gt;Another thread publishes the results of an attempt to become active&lt;/li&gt;
	&lt;li&gt;using 
{@link #recordActiveAttempt(ActiveAttemptRecord)}
&lt;p&gt;&amp;lt;/li&amp;gt;&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;&amp;lt;li&amp;gt;The node enters bad health status&amp;lt;/li&amp;gt;&lt;/li&gt;
	&lt;li&gt;&amp;lt;li&amp;gt;The specified timeout elapses&amp;lt;/li&amp;gt;&lt;/li&gt;
	&lt;li&gt;&amp;lt;/ul&amp;gt;&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;@param timeoutMillis number of millis to wait&lt;/li&gt;
	&lt;li&gt;@return the published record, or null if the timeout elapses or the&lt;/li&gt;
	&lt;li&gt;service becomes unhealthy&lt;/li&gt;
	&lt;li&gt;@throws InterruptedException if the thread is interrupted.&lt;br/&gt;
   */&lt;br/&gt;
  private ActiveAttemptRecord waitForActiveAttempt(int timeoutMillis)&lt;br/&gt;
      throws InterruptedException {&lt;br/&gt;
    long st = System.nanoTime();&lt;br/&gt;
    long waitUntil = st + TimeUnit.NANOSECONDS.convert(&lt;br/&gt;
        timeoutMillis, TimeUnit.MILLISECONDS);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    do {&lt;br/&gt;
      // periodically check health state, because entering an&lt;br/&gt;
      // unhealthy state could prevent us from ever attempting to&lt;br/&gt;
      // become active. We can detect this and respond to the user&lt;br/&gt;
      // immediately.&lt;br/&gt;
      synchronized (this) {&lt;br/&gt;
        if (lastHealthState != State.SERVICE_HEALTHY) &lt;/p&gt;
{
          // early out if service became unhealthy
          return null;
        }
&lt;p&gt;      }&lt;/p&gt;

&lt;p&gt;      synchronized (activeAttemptRecordLock) {&lt;br/&gt;
        if ((lastActiveAttemptRecord != null &amp;amp;&amp;amp;&lt;br/&gt;
            lastActiveAttemptRecord.nanoTime &amp;gt;= st)) &lt;/p&gt;
{
          return lastActiveAttemptRecord;
        }
&lt;p&gt;        // Only wait 1sec so that we periodically recheck the health state&lt;br/&gt;
        // above.&lt;br/&gt;
        activeAttemptRecordLock.wait(1000);&lt;br/&gt;
      }&lt;br/&gt;
    } while (System.nanoTime() &amp;lt; waitUntil);&lt;/p&gt;

&lt;p&gt;    // Timeout elapsed.&lt;br/&gt;
    LOG.warn(timeoutMillis + &quot;ms timeout elapsed waiting for an attempt &quot; +&lt;br/&gt;
        &quot;to become active&quot;);&lt;br/&gt;
    return null;&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;  private StateChangeRequestInfo createReqInfo() &lt;/p&gt;
{
    return new StateChangeRequestInfo(RequestSource.REQUEST_BY_ZKFC);
  }

&lt;p&gt;  private synchronized void becomeStandby() {&lt;br/&gt;
    LOG.info(&quot;ZK Election indicated that &quot; + localTarget +&lt;br/&gt;
        &quot; should become standby&quot;);&lt;br/&gt;
    try &lt;/p&gt;
{
      int timeout = FailoverController.getGracefulFenceTimeout(conf);
      localTarget.getProxy(conf, timeout).transitionToStandby(createReqInfo());
      LOG.info(&quot;Successfully transitioned &quot; + localTarget +
          &quot; to standby state&quot;);
    }
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
      LOG.error(&quot;Couldn&apos;t transition &quot; + localTarget + &quot; to standby state&quot;,
          e);
      // TODO handle this. It&apos;s a likely case since we probably got fenced
      // at the same time.
    }
&lt;p&gt;    serviceState = HAServiceState.STANDBY;&lt;br/&gt;
  }&lt;/p&gt;


&lt;p&gt;  private synchronized void fenceOldActive(byte[] data) {&lt;br/&gt;
    HAServiceTarget target = dataToTarget(data);&lt;/p&gt;

&lt;p&gt;    try &lt;/p&gt;
{
      doFence(target);
    }
&lt;p&gt; catch (Throwable t) &lt;/p&gt;
{
      recordActiveAttempt(new ActiveAttemptRecord(false, &quot;Unable to fence old active: &quot; + StringUtils.stringifyException(t)));
      Throwables.propagate(t);
    }
&lt;p&gt;  }&lt;/p&gt;

&lt;p&gt;  private void doFence(HAServiceTarget target) {&lt;br/&gt;
    LOG.info(&quot;Should fence: &quot; + target);&lt;br/&gt;
    boolean gracefulWorked = new FailoverController(conf,&lt;br/&gt;
        RequestSource.REQUEST_BY_ZKFC).tryGracefulFence(target);&lt;br/&gt;
    if (gracefulWorked) &lt;/p&gt;
{
      // It&apos;s possible that it&apos;s in standby but just about to go into active,
      // no? Is there some race here?
      LOG.info(&quot;Successfully transitioned &quot; + target + &quot; to standby &quot; +
          &quot;state without fencing&quot;);
      return;
    }

&lt;p&gt;    try &lt;/p&gt;
{
      target.checkFencingConfigured();
    }
&lt;p&gt; catch (BadFencingConfigurationException e) &lt;/p&gt;
{
      LOG.error(&quot;Couldn&apos;t fence old active &quot; + target, e);
      recordActiveAttempt(new ActiveAttemptRecord(false, &quot;Unable to fence old active&quot;));
      throw new RuntimeException(e);
    }

&lt;p&gt;    if (!target.getFencer().fence(target)) &lt;/p&gt;
{
      throw new RuntimeException(&quot;Unable to fence &quot; + target);
    }
&lt;p&gt;  }&lt;/p&gt;


&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Request from graceful failover to cede active role. Causes&lt;/li&gt;
	&lt;li&gt;this ZKFC to transition its local node to standby, then quit&lt;/li&gt;
	&lt;li&gt;the election for the specified period of time, after which it&lt;/li&gt;
	&lt;li&gt;will rejoin iff it is healthy.&lt;br/&gt;
   */&lt;br/&gt;
  void cedeActive(final int millisToCede)&lt;br/&gt;
      throws AccessControlException, ServiceFailedException, IOException {&lt;br/&gt;
    try {&lt;br/&gt;
      UserGroupInformation.getLoginUser().doAs(new PrivilegedExceptionAction&amp;lt;Void&amp;gt;() 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {        @Override        public Void run() throws Exception {
          doCedeActive(millisToCede);
          return null;
        }      }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;);&lt;br/&gt;
    } catch (InterruptedException e) &lt;/p&gt;
{
      throw new IOException(e);
    }&lt;br/&gt;
  }&lt;br/&gt;
  &lt;br/&gt;
  private void doCedeActive(int millisToCede) &lt;br/&gt;
      throws AccessControlException, ServiceFailedException, IOException {&lt;br/&gt;
    int timeout = FailoverController.getGracefulFenceTimeout(conf);&lt;br/&gt;
&lt;br/&gt;
    // Lock elector to maintain lock ordering of elector -&amp;gt; ZKFC&lt;br/&gt;
    synchronized (elector) {&lt;br/&gt;
      synchronized (this) {&lt;br/&gt;
        if (millisToCede &amp;lt;= 0) {
          delayJoiningUntilNanotime = 0;
          recheckElectability();
          return;
        }&lt;br/&gt;
  &lt;br/&gt;
        LOG.info(&quot;Requested by &quot; + UserGroupInformation.getCurrentUser() +&lt;br/&gt;
            &quot; at &quot; + Server.getRemoteAddress() + &quot; to cede active role.&quot;);&lt;br/&gt;
        boolean needFence = false;&lt;br/&gt;
        try {
          localTarget.getProxy(conf, timeout).transitionToStandby(createReqInfo());
          LOG.info(&quot;Successfully ensured local node is in standby mode&quot;);
        } catch (IOException ioe) {
          LOG.warn(&quot;Unable to transition local node to standby: &quot; +
              ioe.getLocalizedMessage());
          LOG.warn(&quot;Quitting election but indicating that fencing is &quot; +
              &quot;necessary&quot;);
          needFence = true;
        }&lt;br/&gt;
        delayJoiningUntilNanotime = System.nanoTime() +&lt;br/&gt;
            TimeUnit.MILLISECONDS.toNanos(millisToCede);&lt;br/&gt;
        elector.quitElection(needFence);&lt;br/&gt;
        serviceState = HAServiceState.INITIALIZING;&lt;br/&gt;
      }&lt;br/&gt;
    }&lt;br/&gt;
    recheckElectability();&lt;br/&gt;
  }&lt;br/&gt;
  &lt;br/&gt;
  /**&lt;br/&gt;
   * Coordinate a graceful failover to this node.&lt;br/&gt;
   * @throws ServiceFailedException if the node fails to become active&lt;br/&gt;
   * @throws IOException some other error occurs&lt;br/&gt;
   */&lt;br/&gt;
  void gracefulFailoverToYou() throws ServiceFailedException, IOException {&lt;br/&gt;
    try {&lt;br/&gt;
      UserGroupInformation.getLoginUser().doAs(new PrivilegedExceptionAction&amp;lt;Void&amp;gt;() {&lt;br/&gt;
        @Override&lt;br/&gt;
        public Void run() throws Exception {
          doGracefulFailover();
          return null;
        }&lt;br/&gt;
        &lt;br/&gt;
      });&lt;br/&gt;
    } catch (InterruptedException e) {      throw new IOException(e);    }
&lt;p&gt;  }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Coordinate a graceful failover. This proceeds in several phases:&lt;/li&gt;
	&lt;li&gt;1) Pre-flight checks: ensure that the local node is healthy, and&lt;/li&gt;
	&lt;li&gt;thus a candidate for failover.&lt;/li&gt;
	&lt;li&gt;2) Determine the current active node. If it is the local node, no&lt;/li&gt;
	&lt;li&gt;need to failover - return success.&lt;/li&gt;
	&lt;li&gt;3) Ask that node to yield from the election for a number of seconds.&lt;/li&gt;
	&lt;li&gt;4) Allow the normal election path to run in other threads. Wait until&lt;/li&gt;
	&lt;li&gt;we either become unhealthy or we see an election attempt recorded by&lt;/li&gt;
	&lt;li&gt;the normal code path.&lt;/li&gt;
	&lt;li&gt;5) Allow the old active to rejoin the election, so a future&lt;/li&gt;
	&lt;li&gt;failback is possible.&lt;br/&gt;
   */&lt;br/&gt;
  private void doGracefulFailover()&lt;br/&gt;
      throws ServiceFailedException, IOException, InterruptedException {&lt;br/&gt;
    int timeout = FailoverController.getGracefulFenceTimeout(conf) * 2;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    // Phase 1: pre-flight checks&lt;br/&gt;
    checkEligibleForFailover();&lt;/p&gt;

&lt;p&gt;    // Phase 2: determine old/current active node. Check that we&apos;re not&lt;br/&gt;
    // ourselves active, etc.&lt;br/&gt;
    HAServiceTarget oldActive = getCurrentActive();&lt;br/&gt;
    if (oldActive == null) &lt;/p&gt;
{
      // No node is currently active. So, if we aren&apos;t already
      // active ourselves by means of a normal election, then there&apos;s
      // probably something preventing us from becoming active.
      throw new ServiceFailedException(
          &quot;No other node is currently active.&quot;);
    }

&lt;p&gt;    if (oldActive.getAddress().equals(localTarget.getAddress())) &lt;/p&gt;
{
      LOG.info(&quot;Local node &quot; + localTarget + &quot; is already active. &quot; +
          &quot;No need to failover. Returning success.&quot;);
      return;
    }

&lt;p&gt;    // Phase 3: ask the old active to yield from the election.&lt;br/&gt;
    LOG.info(&quot;Asking &quot; + oldActive + &quot; to cede its active state for &quot; +&lt;br/&gt;
        timeout + &quot;ms&quot;);&lt;br/&gt;
    ZKFCProtocol oldZkfc = oldActive.getZKFCProxy(conf, timeout);&lt;br/&gt;
    oldZkfc.cedeActive(timeout);&lt;/p&gt;

&lt;p&gt;    // Phase 4: wait for the normal election to make the local node&lt;br/&gt;
    // active.&lt;br/&gt;
    ActiveAttemptRecord attempt = waitForActiveAttempt(timeout + 60000);&lt;/p&gt;

&lt;p&gt;    if (attempt == null) {&lt;br/&gt;
      // We didn&apos;t even make an attempt to become active.&lt;br/&gt;
      synchronized(this) {&lt;br/&gt;
        if (lastHealthState != State.SERVICE_HEALTHY) &lt;/p&gt;
{
          throw new ServiceFailedException(&quot;Unable to become active. &quot; +
            &quot;Service became unhealthy while trying to failover.&quot;);          
        }
&lt;p&gt;      }&lt;/p&gt;

&lt;p&gt;      throw new ServiceFailedException(&quot;Unable to become active. &quot; +&lt;br/&gt;
          &quot;Local node did not get an opportunity to do so from ZooKeeper, &quot; +&lt;br/&gt;
          &quot;or the local node took too long to transition to active.&quot;);&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    // Phase 5. At this point, we made some attempt to become active. So we&lt;br/&gt;
    // can tell the old active to rejoin if it wants. This allows a quick&lt;br/&gt;
    // fail-back if we immediately crash.&lt;br/&gt;
    oldZkfc.cedeActive(-1);&lt;/p&gt;

&lt;p&gt;    if (attempt.succeeded) &lt;/p&gt;
{
      LOG.info(&quot;Successfully became active. &quot; + attempt.status);
    }
&lt;p&gt; else &lt;/p&gt;
{
      // Propagate failure
      String msg = &quot;Failed to become active. &quot; + attempt.status;
      throw new ServiceFailedException(msg);
    }
&lt;p&gt;  }&lt;/p&gt;

&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Ensure that the local node is in a healthy state, and thus&lt;/li&gt;
	&lt;li&gt;eligible for graceful failover.&lt;/li&gt;
	&lt;li&gt;@throws ServiceFailedException if the node is unhealthy&lt;br/&gt;
   */&lt;br/&gt;
  private synchronized void checkEligibleForFailover()&lt;br/&gt;
      throws ServiceFailedException 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    // Check health    if (this.getLastHealthState() != State.SERVICE_HEALTHY) {
      throw new ServiceFailedException(
          localTarget + &quot; is not currently healthy. &quot; +
          &quot;Cannot be failover target&quot;);
    }  }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@return an 
{@link HAServiceTarget}
&lt;p&gt; for the current active node&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;in the cluster, or null if no node is active.&lt;/li&gt;
	&lt;li&gt;@throws IOException if a ZK-related issue occurs&lt;/li&gt;
	&lt;li&gt;@throws InterruptedException if thread is interrupted&lt;br/&gt;
   */&lt;br/&gt;
  private HAServiceTarget getCurrentActive()&lt;br/&gt;
      throws IOException, InterruptedException {&lt;br/&gt;
    synchronized (elector) {&lt;br/&gt;
      synchronized (this) {&lt;br/&gt;
        byte[] activeData;&lt;br/&gt;
        try 
{
          activeData = elector.getActiveData();
        }
&lt;p&gt; catch (ActiveNotFoundException e) &lt;/p&gt;
{
          return null;
        }
&lt;p&gt; catch (KeeperException ke) &lt;/p&gt;
{
          throw new IOException(
              &quot;Unexpected ZooKeeper issue fetching active node info&quot;, ke);
        }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;        HAServiceTarget oldActive = dataToTarget(activeData);&lt;br/&gt;
        return oldActive;&lt;br/&gt;
      }&lt;br/&gt;
    }&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Check the current state of the service, and join the election&lt;/li&gt;
	&lt;li&gt;if it should be in the election.&lt;br/&gt;
   */&lt;br/&gt;
  private void recheckElectability() {&lt;br/&gt;
    // Maintain lock ordering of elector -&amp;gt; ZKFC&lt;br/&gt;
    synchronized (elector) {&lt;br/&gt;
      synchronized (this) {&lt;br/&gt;
        boolean healthy = lastHealthState == State.SERVICE_HEALTHY;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;        long remainingDelay = delayJoiningUntilNanotime - System.nanoTime(); &lt;br/&gt;
        if (remainingDelay &amp;gt; 0) {&lt;br/&gt;
          if (healthy) &lt;/p&gt;
{
            LOG.info(&quot;Would have joined master election, but this node is &quot; +
                &quot;prohibited from doing so for &quot; +
                TimeUnit.NANOSECONDS.toMillis(remainingDelay) + &quot; more ms&quot;);
          }
&lt;p&gt;          scheduleRecheck(remainingDelay);&lt;br/&gt;
          return;&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;        switch (lastHealthState) {&lt;br/&gt;
        case SERVICE_HEALTHY:&lt;br/&gt;
          elector.joinElection(targetToData(localTarget));&lt;br/&gt;
          if (quitElectionOnBadState) &lt;/p&gt;
{
            quitElectionOnBadState = false;
          }
&lt;p&gt;          break;&lt;/p&gt;

&lt;p&gt;        case INITIALIZING:&lt;br/&gt;
          LOG.info(&quot;Ensuring that &quot; + localTarget + &quot; does not &quot; +&lt;br/&gt;
              &quot;participate in active master election&quot;);&lt;br/&gt;
          elector.quitElection(false);&lt;br/&gt;
          serviceState = HAServiceState.INITIALIZING;&lt;br/&gt;
          break;&lt;/p&gt;

&lt;p&gt;        case SERVICE_UNHEALTHY:&lt;br/&gt;
        case SERVICE_NOT_RESPONDING:&lt;br/&gt;
          LOG.info(&quot;Quitting master election for &quot; + localTarget +&lt;br/&gt;
              &quot; and marking that fencing is necessary&quot;);&lt;br/&gt;
          elector.quitElection(true);&lt;br/&gt;
          serviceState = HAServiceState.INITIALIZING;&lt;br/&gt;
          break;&lt;/p&gt;

&lt;p&gt;        case HEALTH_MONITOR_FAILED:&lt;br/&gt;
          fatalError(&quot;Health monitor failed!&quot;);&lt;br/&gt;
          break;&lt;/p&gt;

&lt;p&gt;        default:&lt;br/&gt;
          throw new IllegalArgumentException(&quot;Unhandled state:&quot; + lastHealthState);&lt;br/&gt;
        }&lt;br/&gt;
      }&lt;br/&gt;
    }&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Schedule a call to 
{@link #recheckElectability()}
&lt;p&gt; in the future.&lt;br/&gt;
   */&lt;br/&gt;
  private void scheduleRecheck(long whenNanos) {&lt;br/&gt;
    delayExecutor.schedule(&lt;br/&gt;
        new Runnable() {&lt;br/&gt;
          @Override&lt;br/&gt;
          public void run() &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {            try {
              recheckElectability();
            } catch (Throwable t) {
              fatalError(&quot;Failed to recheck electability: &quot; +
                  StringUtils.stringifyException(t));
            }          }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;        },&lt;br/&gt;
        whenNanos, TimeUnit.NANOSECONDS);&lt;br/&gt;
  }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  int serviceStateMismatchCount = 0;&lt;br/&gt;
  boolean quitElectionOnBadState = false;&lt;/p&gt;

&lt;p&gt;  void verifyChangedServiceState(HAServiceState changedState) {&lt;br/&gt;
    synchronized (elector) {&lt;br/&gt;
      synchronized (this) {&lt;br/&gt;
        if (serviceState == HAServiceState.INITIALIZING) {&lt;br/&gt;
          if (quitElectionOnBadState) &lt;/p&gt;
{
            LOG.debug(&quot;rechecking for electability from bad state&quot;);
            recheckElectability();
          }
&lt;p&gt;          return;&lt;br/&gt;
        }&lt;br/&gt;
        if (changedState == serviceState) &lt;/p&gt;
{
          serviceStateMismatchCount = 0;
          return;
        }
&lt;p&gt;        if (serviceStateMismatchCount == 0) &lt;/p&gt;
{
          // recheck one more time. As this might be due to parallel transition.
          serviceStateMismatchCount++;
          return;
        }
&lt;p&gt;        // quit the election as the expected state and reported state&lt;br/&gt;
        // mismatches.&lt;br/&gt;
        LOG.error(&quot;Local service &quot; + localTarget&lt;br/&gt;
            + &quot; has changed the serviceState to &quot; + changedState&lt;br/&gt;
            + &quot;. Expected was &quot; + serviceState&lt;br/&gt;
            + &quot;. Quitting election marking fencing necessary.&quot;);&lt;br/&gt;
        delayJoiningUntilNanotime = System.nanoTime()&lt;br/&gt;
            + TimeUnit.MILLISECONDS.toNanos(1000);&lt;br/&gt;
        elector.quitElection(true);&lt;br/&gt;
        quitElectionOnBadState = true;&lt;br/&gt;
        serviceStateMismatchCount = 0;&lt;br/&gt;
        serviceState = HAServiceState.INITIALIZING;&lt;br/&gt;
      }&lt;br/&gt;
    }&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@return the last health state passed to the FC&lt;/li&gt;
	&lt;li&gt;by the HealthMonitor.&lt;br/&gt;
   */&lt;br/&gt;
  @VisibleForTesting&lt;br/&gt;
  synchronized State getLastHealthState() 
{
    return lastHealthState;
  }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  private synchronized void setLastHealthState(HealthMonitor.State newState) &lt;/p&gt;
{
    LOG.info(&quot;Local service &quot; + localTarget +
        &quot; entered state: &quot; + newState);
    lastHealthState = newState;
  }

&lt;p&gt;  @VisibleForTesting&lt;br/&gt;
  ActiveStandbyElector getElectorForTests() &lt;/p&gt;
{
    return elector;
  }

&lt;p&gt;  @VisibleForTesting&lt;br/&gt;
  ZKFCRpcServer getRpcServerForTests() &lt;/p&gt;
{
    return rpcServer;
  }

&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Callbacks from elector&lt;br/&gt;
   */&lt;br/&gt;
  class ElectorCallbacks implements ActiveStandbyElectorCallback {&lt;br/&gt;
    @Override&lt;br/&gt;
    public void becomeActive() throws ServiceFailedException 
{
      ZKFailoverController.this.becomeActive();
    }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    @Override&lt;br/&gt;
    public void becomeStandby() &lt;/p&gt;
{
      ZKFailoverController.this.becomeStandby();
    }

&lt;p&gt;    @Override&lt;br/&gt;
    public void enterNeutralMode() {&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    @Override&lt;br/&gt;
    public void notifyFatalError(String errorMessage) &lt;/p&gt;
{
      fatalError(errorMessage);
    }

&lt;p&gt;    @Override&lt;br/&gt;
    public void fenceOldActive(byte[] data) &lt;/p&gt;
{
      ZKFailoverController.this.fenceOldActive(data);
    }

&lt;p&gt;    @Override&lt;br/&gt;
    public String toString() {&lt;br/&gt;
      synchronized (ZKFailoverController.this) &lt;/p&gt;
{
        return &quot;Elector callbacks for &quot; + localTarget;
      }
&lt;p&gt;    }&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Callbacks from HealthMonitor&lt;br/&gt;
   */&lt;br/&gt;
  class HealthCallbacks implements HealthMonitor.Callback 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    @Override    public void enteredState(HealthMonitor.State newState) {
      setLastHealthState(newState);
      recheckElectability();
    }  }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Callbacks for HAServiceStatus&lt;br/&gt;
   */&lt;br/&gt;
  class ServiceStateCallBacks implements HealthMonitor.ServiceStateCallback 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    @Override    public void reportServiceStatus(HAServiceStatus status) {
      verifyChangedServiceState(status.getState());
    }  }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  private static class ActiveAttemptRecord {&lt;br/&gt;
    private final boolean succeeded;&lt;br/&gt;
    private final String status;&lt;br/&gt;
    private final long nanoTime;&lt;/p&gt;

&lt;p&gt;    public ActiveAttemptRecord(boolean succeeded, String status) &lt;/p&gt;
{
      this.succeeded = succeeded;
      this.status = status;
      this.nanoTime = System.nanoTime();
    }
&lt;p&gt;  }&lt;/p&gt;

&lt;p&gt;}&lt;/p&gt;</comment>
                            <comment id="14583083" author="vinayrpet" created="Fri, 12 Jun 2015 07:19:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;Answer 2.when start only one ZKFC and NN &#65292;the NN can be staying in ACTIVE for long time.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, fine.&lt;/p&gt;

&lt;p&gt;Its because, patch from this issue, is not merged properly to your code.&lt;br/&gt;
In your source code, &lt;tt&gt;becomeActive()&lt;/tt&gt; doesn&apos;t have line &lt;tt&gt;serviceState = HAServiceState.ACTIVE;&lt;/tt&gt;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void becomeActive() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ServiceFailedException {
 LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Trying to make &quot;&lt;/span&gt; + localTarget + &lt;span class=&quot;code-quote&quot;&gt;&quot; active...&quot;&lt;/span&gt;);
 &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
 {
  HAServiceProtocolHelper.transitionToActive(localTarget.getProxy( conf, FailoverController.getRpcTimeoutToNewActive(conf)), createReqInfo());
  &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg = &lt;span class=&quot;code-quote&quot;&gt;&quot;Successfully transitioned &quot;&lt;/span&gt; + localTarget + &lt;span class=&quot;code-quote&quot;&gt;&quot; to active state&quot;&lt;/span&gt;;
  LOG.info(msg);
  recordActiveAttempt(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ActiveAttemptRecord(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, msg));
 } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable t) {
   &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg = &lt;span class=&quot;code-quote&quot;&gt;&quot;Couldn&apos;t make &quot;&lt;/span&gt; + localTarget + &lt;span class=&quot;code-quote&quot;&gt;&quot; active&quot;&lt;/span&gt;;
   LOG.fatal(msg, t);
   recordActiveAttempt(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ActiveAttemptRecord(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, msg + &lt;span class=&quot;code-quote&quot;&gt;&quot;\n&quot;&lt;/span&gt; +
     StringUtils.stringifyException(t)));
   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (t &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ServiceFailedException) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; (ServiceFailedException)t; }
   &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ServiceFailedException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Couldn&apos;t transition to active&quot;&lt;/span&gt;, t);
   }
/*
TODO:
we need to make sure that &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we get fenced and then quickly restarted,
none of these calls will retry across the restart boundary
perhaps the solution is that, whenever the nn starts, it gets a unique
ID, and when we start becoming active, we record it, and then any &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;
calls use the same ID
*/
 }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;So if the previous state of NameNode is not STANDBY, then it will stay for long time. But if its trasitioned from STANDBY, it will continously switch.&lt;/p&gt;

&lt;p&gt;Add &lt;tt&gt;serviceState = HAServiceState.ACTIVE;&lt;/tt&gt; in &lt;tt&gt;becomeActive()&lt;/tt&gt;  after &lt;tt&gt;LOG.info(msg);&lt;/tt&gt;, everything will be fine.&lt;/p&gt;</comment>
                            <comment id="14583120" author="lvchuanwen" created="Fri, 12 Jun 2015 08:04:01 +0000"  >&lt;p&gt;thank u very very much . i am so careless.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12640785" name="HADOOP-10251.patch" size="8991" author="vinayakumarb" created="Fri, 18 Apr 2014 07:44:51 +0000"/>
                            <attachment id="12624583" name="HADOOP-10251.patch" size="9091" author="vinayakumarb" created="Thu, 23 Jan 2014 06:12:50 +0000"/>
                            <attachment id="12624579" name="HADOOP-10251.patch" size="8985" author="vinayakumarb" created="Thu, 23 Jan 2014 05:25:10 +0000"/>
                            <attachment id="12624575" name="HADOOP-10251.patch" size="7176" author="vinayakumarb" created="Thu, 23 Jan 2014 05:12:56 +0000"/>
                            <attachment id="12624335" name="HADOOP-10251.patch" size="6741" author="vinayakumarb" created="Wed, 22 Jan 2014 12:16:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369206</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rmw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369511</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>