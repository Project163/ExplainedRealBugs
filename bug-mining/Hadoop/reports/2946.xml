<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:58:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-18826] abfs getFileStatus(/) fails with &quot;Value for one of the query parameters specified in the request URI is invalid.&quot;, 400</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-18826</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;I am using hadoop-azure-3.3.0.jar and have written code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; ROOT_DIR = &lt;span class=&quot;code-quote&quot;&gt;&quot;abfs:&lt;span class=&quot;code-comment&quot;&gt;//ssh-test-fs@sshadlsgen2.dfs.core.windows.net&quot;&lt;/span&gt;,
&lt;/span&gt;Configuration config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Configuration();&#160; &#160; &#160; &#160; config.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;fs.defaultFS&quot;&lt;/span&gt;,ROOT_DIR);&#160; &#160; &#160; &#160; config.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;fs.adl.oauth2.access.token.provider.type&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;ClientCredential&quot;&lt;/span&gt;);&#160; &#160; &#160; &#160; config.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;fs.adl.oauth2.client.id&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;);&#160; &#160; &#160; &#160; config.set(&quot;&lt;/span&gt;fs.adl.oauth2.credential&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;);&#160; &#160; &#160; &#160; config.set(&quot;&lt;/span&gt;fs.adl.oauth2.refresh.url&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;);&#160; &#160; &#160; &#160; config.set(&quot;&lt;/span&gt;fs.azure.account.key.sshadlsgen2.dfs.core.windows.net&lt;span class=&quot;code-quote&quot;&gt;&quot;,ACCESS_TOKEN);&#160; &#160; &#160; &#160; config.set(&quot;&lt;/span&gt;fs.azure.skipUserGroupMetadataDuringInitialization&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;);
	FileSystem fs = FileSystem.get(config);
	&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println( &lt;span class=&quot;code-quote&quot;&gt;&quot;\nfs:&lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt;+fs.toString()+&lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt;&quot;&lt;/span&gt;);
	FileStatus status = fs.getFileStatus(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(ROOT_DIR)); &lt;span class=&quot;code-comment&quot;&gt;// !!! Exception in 3.3.1-*
&lt;/span&gt;	&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println( &lt;span class=&quot;code-quote&quot;&gt;&quot;\nstatus:&lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt;+status.toString()+&lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt;&quot;&lt;/span&gt;);
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It did work properly till 3.3.1.&#160;&lt;/p&gt;

&lt;p&gt;But in 3.3.1 it fails with exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: Operation failed: &lt;span class=&quot;code-quote&quot;&gt;&quot;Value &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; one of the query parameters specified in the request URI is invalid.&quot;&lt;/span&gt;, 400, HEAD, https:&lt;span class=&quot;code-comment&quot;&gt;//sshadlsgen2.dfs.core.windows.net/ssh-test-fs?upn=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;action=getAccessControl&amp;amp;timeout=90  at org.apache.hadoop.fs.azurebfs.services.AbfsRestOperation.completeExecute(AbfsRestOperation.java:218) at org.apache.hadoop.fs.azurebfs.services.AbfsRestOperation.lambda$execute$0(AbfsRestOperation.java:181) at org.apache.hadoop.fs.statistics.impl.IOStatisticsBinding.measureDurationOfInvocation(IOStatisticsBinding.java:494) at org.apache.hadoop.fs.statistics.impl.IOStatisticsBinding.trackDurationOfInvocation(IOStatisticsBinding.java:465) at org.apache.hadoop.fs.azurebfs.services.AbfsRestOperation.execute(AbfsRestOperation.java:179) at org.apache.hadoop.fs.azurebfs.services.AbfsClient.getAclStatus(AbfsClient.java:942) at org.apache.hadoop.fs.azurebfs.services.AbfsClient.getAclStatus(AbfsClient.java:924) at org.apache.hadoop.fs.azurebfs.AzureBlobFileSystemStore.getFileStatus(AzureBlobFileSystemStore.java:846) at org.apache.hadoop.fs.azurebfs.AzureBlobFileSystem.getFileStatus(AzureBlobFileSystem.java:507) &lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I performed some research and found:&lt;/p&gt;

&lt;p&gt;In hadoop-azure-3.3.0.jar we see:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.hadoop.fs.azurebfs.AzureBlobFileSystemStore{
	...
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; FileStatus getFileStatus(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path path) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
	...
Line 604:		op = client.getAclStatus(AbfsHttpConstants.FORWARD_SLASH + AbfsHttpConstants.ROOT_PATH);
	...
	}
	...
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and this code produces REST request:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
https:&lt;span class=&quot;code-comment&quot;&gt;//sshadlsgen2.dfs.core.windows.net/ssh-test-fs//?upn=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;action=getAccessControl&amp;amp;timeout=90
&lt;/span&gt;&#160; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There is finalizes slash in path part &quot;...ssh-test-fs&lt;b&gt;&lt;font color=&quot;#de350b&quot;&gt;//&lt;/font&gt;&lt;/b&gt;?upn=false...&quot; This request does work properly.&lt;/p&gt;

&lt;p&gt;But since hadoop-azure-3.3.1.jar till latest hadoop-azure-3.3.6.jar we see:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.hadoop.fs.azurebfs.AzureBlobFileSystemStore {
	...
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; FileStatus getFileStatus(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path path) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
		...
				perfInfo.registerCallee(&lt;span class=&quot;code-quote&quot;&gt;&quot;getAclStatus&quot;&lt;/span&gt;);
Line 846:       op = client.getAclStatus(getRelativePath(path));
		...
	}
	...
}
Line 1492:
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getRelativePath(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path path) {
	...
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; path.toUri().getPath();
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and this code prduces REST request:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
https:&lt;span class=&quot;code-comment&quot;&gt;//sshadlsgen2.dfs.core.windows.net/ssh-test-fs?upn=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;action=getAccessControl&amp;amp;timeout=90 &lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There is not finalizes slash in path part &quot;...ssh-test-fs?upn=false...&quot; It happens because the new code &quot;path.toUri().getPath();&quot; produces empty string.&lt;/p&gt;

&lt;p&gt;This request fails with message:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: Operation failed: &lt;span class=&quot;code-quote&quot;&gt;&quot;Value &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; one of the query parameters specified in the request URI is invalid.&quot;&lt;/span&gt;, 400, HEAD, https:&lt;span class=&quot;code-comment&quot;&gt;//sshadlsgen2.dfs.core.windows.net/ssh-test-fs?upn=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;action=getAccessControl&amp;amp;timeout=90
&lt;/span&gt;	at org.apache.hadoop.fs.azurebfs.services.AbfsRestOperation.completeExecute(AbfsRestOperation.java:218)
	at org.apache.hadoop.fs.azurebfs.services.AbfsRestOperation.lambda$execute$0(AbfsRestOperation.java:181)
	at org.apache.hadoop.fs.statistics.impl.IOStatisticsBinding.measureDurationOfInvocation(IOStatisticsBinding.java:494)
	at org.apache.hadoop.fs.statistics.impl.IOStatisticsBinding.trackDurationOfInvocation(IOStatisticsBinding.java:465)
	at org.apache.hadoop.fs.azurebfs.services.AbfsRestOperation.execute(AbfsRestOperation.java:179)
	at org.apache.hadoop.fs.azurebfs.services.AbfsClient.getAclStatus(AbfsClient.java:942)
	at org.apache.hadoop.fs.azurebfs.services.AbfsClient.getAclStatus(AbfsClient.java:924)
	at org.apache.hadoop.fs.azurebfs.AzureBlobFileSystemStore.getFileStatus(AzureBlobFileSystemStore.java:846)
	at org.apache.hadoop.fs.azurebfs.AzureBlobFileSystem.getFileStatus(AzureBlobFileSystem.java:507) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Such us it is for all hadoop-azure-3.3.&lt;b&gt;.jar versions which does use log4j 2.&lt;/b&gt; not 1.2.17 we can&apos;t update using version&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I attach a sample of Maven project to try: test_hadoop-azure-3_3_1-FileSystem_getFileStatus - Copy.zip&lt;/p&gt;</description>
                <environment></environment>
        <key id="13544857">HADOOP-18826</key>
            <summary>abfs getFileStatus(/) fails with &quot;Value for one of the query parameters specified in the request URI is invalid.&quot;, 400</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anujmodi">Anuj Modi</assignee>
                                    <reporter username="sergey.shabalov">Sergey Shabalov</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 25 Jul 2023 20:35:06 +0000</created>
                <updated>Thu, 14 Nov 2024 06:29:15 +0000</updated>
                            <resolved>Tue, 8 Aug 2023 18:07:22 +0000</resolved>
                                    <version>3.3.1</version>
                    <version>3.3.2</version>
                    <version>3.3.5</version>
                    <version>3.3.3</version>
                    <version>3.3.4</version>
                    <version>3.3.6</version>
                                    <fixVersion>3.4.0</fixVersion>
                    <fixVersion>3.3.9</fixVersion>
                                    <component>fs/azure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17747509" author="stevel@apache.org" created="Wed, 26 Jul 2023 13:23:17 +0000"  >&lt;p&gt;based on your analysis, &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-16612&quot; title=&quot;Track Azure Blob File System client-perceived latency&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-16612&quot;&gt;&lt;del&gt;HADOOP-16612&lt;/del&gt;&lt;/a&gt; is the cause&lt;/p&gt;</comment>
                            <comment id="17747512" author="stevel@apache.org" created="Wed, 26 Jul 2023 13:25:34 +0000"  >&lt;p&gt;but looking into getRelativePath() is a likely change &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-16916&quot; title=&quot;ABFS: Delegation SAS generator for integration with Ranger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-16916&quot;&gt;&lt;del&gt;HADOOP-16916&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;now: why doesn&apos;t anyone else see this?&lt;/p&gt;</comment>
                            <comment id="17749146" author="JIRAUSER299439" created="Mon, 31 Jul 2023 10:59:11 +0000"  >&lt;p&gt;PR for fix: &lt;a href=&quot;https://github.com/apache/hadoop/pull/5909&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Hadoop 18826: [ABFS] Fix for Empty Relative Path Issue Leading to GetFileStatus(&quot;/&quot;) failure. by anujmodi2021 &#183; Pull Request #5909 &#183; apache/hadoop (github.com)&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17752449" author="stevel@apache.org" created="Wed, 9 Aug 2023 15:36:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sergey.shabalov&quot; class=&quot;user-hover&quot; rel=&quot;sergey.shabalov&quot;&gt;sergey.shabalov&lt;/a&gt;: this bug has been fixed and the next hadoop 3.3.x release should include it.&lt;/p&gt;

&lt;p&gt;if you need it yourself before then, you are going to have to do your own build of a suitable branch with the patch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13259174">HADOOP-16612</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13290965">HADOOP-16916</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13061621" name="test_hadoop-azure-3_3_1-FileSystem_getFileStatus - Copy.zip" size="20538" author="sergey.shabalov" created="Tue, 25 Jul 2023 20:34:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 13 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1jdeg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12346894">3.4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>