<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:47:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-11321] copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions.</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-11321</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;In Hadoop 2, it is impossible to use &lt;tt&gt;copyToLocal&lt;/tt&gt; to copy a file from HDFS to a destination on an SMB share.  This is because in Hadoop 2, the &lt;tt&gt;copyToLocal&lt;/tt&gt; maps to 2 underlying &lt;tt&gt;RawLocalFileSystem&lt;/tt&gt; operations: &lt;tt&gt;create&lt;/tt&gt; and &lt;tt&gt;setPermission&lt;/tt&gt;.  On an SMB share, the user may be authorized for the &lt;tt&gt;create&lt;/tt&gt; but denied for the &lt;tt&gt;setPermission&lt;/tt&gt;.  Windows denies the &lt;tt&gt;WRITE_DAC&lt;/tt&gt; right required by &lt;tt&gt;setPermission&lt;/tt&gt; unless the user has Full Control permissions.  Granting Full Control isn&apos;t feasible for most deployments, because it&apos;s insecure.  This is a regression from Hadoop 1, where &lt;tt&gt;copyToLocal&lt;/tt&gt; only did a &lt;tt&gt;create&lt;/tt&gt; and didn&apos;t do a separate &lt;tt&gt;setPermission&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12756580">HADOOP-11321</key>
            <summary>copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cnauroth">Chris Nauroth</assignee>
                                    <reporter username="cnauroth">Chris Nauroth</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Nov 2014 00:10:14 +0000</created>
                <updated>Fri, 10 Apr 2015 20:04:33 +0000</updated>
                            <resolved>Tue, 16 Dec 2014 23:45:23 +0000</resolved>
                                    <version>2.6.0</version>
                                    <fixVersion>2.7.0</fixVersion>
                                    <component>fs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="14218764" author="cnauroth" created="Thu, 20 Nov 2014 00:14:29 +0000"  >&lt;p&gt;The access denied error occurs in libwinutils.c, in &lt;tt&gt;ChangeFileModeByMask&lt;/tt&gt;, when it calls the Windows API &lt;tt&gt;SetFileSecurity&lt;/tt&gt; with a security descriptor containing the new discretionary access control list.  The SMB share denies the &lt;tt&gt;WRITE_DAC&lt;/tt&gt; right.  More details on those APIs are here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/windows/desktop/aa379577(v=vs.85).aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://msdn.microsoft.com/en-us/library/windows/desktop/aa379577(v=vs.85).aspx&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/windows/desktop/aa374892(v=vs.85).aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://msdn.microsoft.com/en-us/library/windows/desktop/aa374892(v=vs.85).aspx&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14218774" author="cnauroth" created="Thu, 20 Nov 2014 00:22:33 +0000"  >&lt;p&gt;I&apos;m attaching a patch.  The idea is to stop treating it as an error condition if an implicit &lt;tt&gt;setPermission&lt;/tt&gt; fails due to access denied on a local file system.  By &quot;implicit&quot;, I mean that the &lt;tt&gt;setPermission&lt;/tt&gt; was not called explicitly by an external caller, but implicitly as part of the caller&apos;s main operation, like a &lt;tt&gt;create&lt;/tt&gt;.  I&apos;m not aware of any other local file systems where a user could be authorized to create a file, but then unauthorized to &lt;tt&gt;chmod&lt;/tt&gt; that same file.  The difference in behavior would have to be a known limitation when operating on SMB shares without Full Control permissions.&lt;/p&gt;

&lt;p&gt;Fixing this was a bit messy.  If anyone has another idea, I&apos;d like to hear it.  I&apos;d especially appreciate if I could get a review from one of the Windows experts, such as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chuanliu&quot; class=&quot;user-hover&quot; rel=&quot;chuanliu&quot;&gt;chuanliu&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ivanmi&quot; class=&quot;user-hover&quot; rel=&quot;ivanmi&quot;&gt;ivanmi&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rusanu&quot; class=&quot;user-hover&quot; rel=&quot;rusanu&quot;&gt;rusanu&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shanyu&quot; class=&quot;user-hover&quot; rel=&quot;shanyu&quot;&gt;shanyu&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14218842" author="hadoopqa" created="Thu, 20 Nov 2014 01:22:39 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12682536/HADOOP-11321.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12682536/HADOOP-11321.1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 72c141b.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5106//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5106//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5106//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5106//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14219118" author="rusanu" created="Thu, 20 Nov 2014 08:06:10 +0000"  >&lt;p&gt;LGTM&lt;/p&gt;</comment>
                            <comment id="14223824" author="cmccabe" created="Tue, 25 Nov 2014 00:21:34 +0000"  >&lt;p&gt;I don&apos;t like the patch as currently written.  It seems wrong to be asked to create a file with a certain permission, but then create it with a different permission and declare success.&lt;/p&gt;

&lt;p&gt;Isn&apos;t there an API on Windows to set the permissions of the file we&apos;re creating?  Usually you can set this at file creation time (which is really how we should be doing it anyway for efficiency reasons.)  I haven&apos;t searched through all those shiny new JDK7 file APIs, surely it&apos;s there?&lt;/p&gt;

&lt;p&gt;If we absolutely, positively can&apos;t get this right, then we can have a config option to ignore the permission argument to local file creates... ugh.&lt;/p&gt;</comment>
                            <comment id="14225238" author="cnauroth" created="Tue, 25 Nov 2014 21:30:59 +0000"  >&lt;p&gt;I&apos;m attaching a v2 patch.  This refactors &lt;tt&gt;setPermissionIfAllowed&lt;/tt&gt; into &lt;tt&gt;FileSystem&lt;/tt&gt;.  Subclasses can call this as needed.  I think this is preferable over my earlier version with the method in &lt;tt&gt;FileUtil&lt;/tt&gt;, which is annotated &lt;tt&gt;Public&lt;/tt&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;-1 tests included. The patch doesn&apos;t appear to include any new or modified tests.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think we&apos;ll be able to add a reliable unit test that works across all dev environments.  The only way I know to create this condition is to set up an SMB share and run as a user that doesn&apos;t have Full Control access.  Not all environments will have the necessary rights to create an SMB share.  I have tested this manually, with an SMB share mounted by both a Linux host and a Windows host.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmccabe&quot; class=&quot;user-hover&quot; rel=&quot;cmccabe&quot;&gt;cmccabe&lt;/a&gt;, thank you for reviewing.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It seems wrong to be asked to create a file with a certain permission, but then create it with a different permission and declare success.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;While I agree that it can be strange, it&apos;s interesting to note that there is existing precedent for handling it this way.  This is the same behavior I see in both Linux and Cygwin operating on an SMB share.  See below for a sample Cygwin session, where F: is mounted to an SMB share.  I suppose this was a pragmatic choice for dealing with odd cases where a user may have rights to create a file but not control its permissions.  This could include an SMB share denying &lt;tt&gt;WRITE_DAC&lt;/tt&gt; or a file system using NFSv4 ACLs with a deny ACE on &lt;tt&gt;WRITE_ACL&lt;/tt&gt;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cnauroth@WIN-NCDLEQLC13J /cygdrive/c/hdc
$ mkdir -m 755 /cygdrive/f/dir2

cnauroth@WIN-NCDLEQLC13J /cygdrive/c/hdc
$ stat -c%a /cygdrive/f/dir2
700
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;&lt;p&gt;Isn&apos;t there an API on Windows to set the permissions of the file we&apos;re creating?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Unfortunately, this is not a matter of using a different syscall.  The OS is denying the &lt;tt&gt;WRITE_DAC&lt;/tt&gt; right, so access will be denied on attempts to set the discretionary access control list.&lt;/p&gt;

&lt;p&gt;Also, I might be misinterpreting, but this sounded like a suggestion to look for a possible solution in native Windows APIs.  Just to clarify, this isn&apos;t a Windows-only bug.  It&apos;s possible for a Linux host to mount an SMB share too.  In that case, even if there was a native Windows API that could circumvent the &lt;tt&gt;WRITE_DAC&lt;/tt&gt; denial, the solution wouldn&apos;t work for a Linux client.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I haven&apos;t searched through all those shiny new JDK7 file APIs, surely it&apos;s there?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I believe you&apos;re thinking of &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#createDirectory(java.nio.file.Path,%20java.nio.file.attribute.FileAttribute...)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;Files#createDirectory&lt;/tt&gt;&lt;/a&gt; and &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#createFile(java.nio.file.Path,%20java.nio.file.attribute.FileAttribute...)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;Files#createFile&lt;/tt&gt;&lt;/a&gt;, with the caller passing &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/nio/file/attribute/PosixFilePermissions.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;PosixFilePermissions&lt;/tt&gt;&lt;/a&gt; as a file attribute.  It turns out that doing this will fail fast on Windows with an unchecked exception stating that the file system doesn&apos;t implement POSIX permissions.  The only reason the Hadoop code is able to do something like this is that we&apos;ve written native code to translate POSIX permissions to a roughly equivalent discretionary access control list.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If we absolutely, positively can&apos;t get this right, then we can have a config option to ignore the permission argument to local file creates... ugh.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is pretty standard Hadoop code review feedback.  As a result, Hadoop now has 762 configuration properties.  That&apos;s from a &lt;tt&gt;grep -c&lt;/tt&gt; of core-default.xml, hdfs-default.xml, yarn-default.xml and mapred-default.xml, so the count doesn&apos;t include undocumented properties.  I&apos;m reluctant to keep pushing this higher.  Would you consider the possibility that this is just a pragmatic choice for dealing with an edge case, based on the existing precedent shown elsewhere?  Also, I&apos;ve taken care that this patch only triggers this behavior for an &lt;tt&gt;EACCES&lt;/tt&gt;, not general I/O errors or other problems.&lt;/p&gt;

&lt;p&gt;If you insist, then let me know, and I&apos;ll add a new configuration property.&lt;/p&gt;</comment>
                            <comment id="14225320" author="hadoopqa" created="Tue, 25 Nov 2014 22:32:47 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12683664/HADOOP-11321.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12683664/HADOOP-11321.2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 78f7cdb.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5120//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5120//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5120//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5120//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14226818" author="cmccabe" created="Wed, 26 Nov 2014 21:15:40 +0000"  >&lt;p&gt;I guess my concern is that if the user requests a restrictive permission on the newly created file, and the system denies it, sets a more permissive one instead, and returns no error... that would be considered a security hole.  I could imagine malicious users playing games with moving newly created files around rapidly so that some user got an EACESS, and silently failed to set the permission the file they created.  After all, it&apos;s possible for a user to have write permission on a directory, without having read permission on any of the files inside of it.  And this gives the bad guy the ability to move around files as he likes.&lt;/p&gt;

&lt;p&gt;To be honest, I really don&apos;t like the way we do this right now, even independently of your patch.  Creating the file and setting the permissions on the file should not be two separate steps.  The way we do it now opens us up to race conditions and possibly worse.  And of course, it&apos;s less efficient to do two syscalls rather than one.&lt;/p&gt;

&lt;p&gt;There is a &lt;tt&gt;FileInputStream&lt;/tt&gt; constructor that takes a &lt;tt&gt;FileDescriptor&lt;/tt&gt;.  This might allow us to do the &quot;open&quot; and &quot;set permissions&quot; steps as a single atomic step.  I&apos;m not familiar with the APIs on Windows, but certainly on Linux, the &lt;tt&gt;creat&lt;/tt&gt; syscall takes an argument that can set the permissions of what it is creating.  Is there a native API on Windows that creates a file with certain permissions?  Even if &lt;tt&gt;Files#createFile&lt;/tt&gt; doesn&apos;t work on Windows, we must have some JNI function we can write that does?  This would fix the race condition and eliminate the problem you&apos;re describing here, at one go.  Sure, we might have to use different methods of getting the &lt;tt&gt;FileDsecriptor&lt;/tt&gt; on Linux and Windows, but that seems OK.  &lt;/p&gt;

&lt;p&gt;cygwin is an interesting precedent, but have you confirmed that it is doing the same thing as we are (creating the file and setting permissions in two separate steps?)  I would be surprised if it was.  It&apos;s ok to create the file or directory with more restrictive permissions than what was requested, but silently opening up the permissions is not ok, I think.&lt;/p&gt;</comment>
                            <comment id="14227070" author="cnauroth" created="Thu, 27 Nov 2014 00:55:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is there a native API on Windows that creates a file with certain permissions?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think this would be &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/windows/desktop/aa363858%28v=vs.85%29.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;CreateFile&lt;/tt&gt;&lt;/a&gt; with the fourth argument containing a security descriptor with a DACL and &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/windows/desktop/aa363855%28v=vs.85%29.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;CreateDirectory&lt;/tt&gt;&lt;/a&gt; with the same in the second argument.  I had thought this would still get blocked for lack of the &lt;tt&gt;WRITE_DAC&lt;/tt&gt; right, but after playing around with this more, it seems like &lt;tt&gt;WRITE_DAC&lt;/tt&gt; is only enforced on modification of an existing object, not on creation of a new file or directory.  Maybe I had an incorrect assumption.&lt;/p&gt;

&lt;p&gt;I&apos;m attaching a demo patch with some scratch code that shows how this works for directory creation.  We&apos;d need to plug something like this into JNI calls.  On Linux, we&apos;d need to do the equivalent for &lt;tt&gt;creat&lt;/tt&gt; and &lt;tt&gt;mkdir&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I agree with the other benefits of this approach you mentioned, Colin.  I&apos;m going to experiment with this more and see if it&apos;s feasible.  I&apos;ll report back later.&lt;/p&gt;</comment>
                            <comment id="14230289" author="cmccabe" created="Mon, 1 Dec 2014 19:28:52 +0000"  >&lt;p&gt;Awesome.  Thanks for working on this, Chris.&lt;/p&gt;</comment>
                            <comment id="14230778" author="cnauroth" created="Tue, 2 Dec 2014 00:48:50 +0000"  >&lt;p&gt;Unfortunately, I&apos;ve discovered a snag in the pure native code approach: the process umask.  The Hadoop file system APIs have established a contract that permissions on newly created objects are governed not by the process umask, but rather by the &lt;tt&gt;fs.permissions.umask-mode&lt;/tt&gt; configuration property.  On the local file system, this is implemented by separate syscalls for &lt;tt&gt;creat&lt;/tt&gt;/&lt;tt&gt;mkdir&lt;/tt&gt; followed by &lt;tt&gt;chmod&lt;/tt&gt;.  This guarantees that if the caller asks for 644, then it gets 644, even if the process umask is 077.&lt;/p&gt;

&lt;p&gt;Actually, it&apos;s more confusing than that, because we&apos;re not consistent about it.  It looks like file creations always apply &lt;tt&gt;fs.permissions.umask-mode&lt;/tt&gt;.  For directories, &lt;tt&gt;FileContext&lt;/tt&gt; applies it, but &lt;tt&gt;FileSystem&lt;/tt&gt; doesn&apos;t.  This means, for example, that &quot;hadoop fs -mkdir&quot; on the local file system is in fact governed by the process umask.&lt;/p&gt;

&lt;p&gt;Another interesting thing I found after further experimentation is that the problem does not repro for an SMB share mounted on Linux.  A &lt;tt&gt;chmod&lt;/tt&gt; call &quot;succeeds&quot; without error, but simply does not change the permissions.  The error handling seems to be specific to the OS client.  This may in fact turn out to be a Windows-only bug, contrary to my prior statement.&lt;/p&gt;

&lt;p&gt;I&apos;m not aware of any Unix file/directory creation syscalls that let you bypass the umask.  That would mean achieving atomic create-and-set-permissions would require a native &lt;tt&gt;umask(0)&lt;/tt&gt; call.  I&apos;m very reluctant to do that, because we can&apos;t predict how this might compromise existing applications, especially for applications that use a mix of Hadoop and their own file creation calls.  I suppose another possibility is to fork another process to do its own &lt;tt&gt;umask(0)&lt;/tt&gt;, but then we&apos;d have a lot of process creation overhead.&lt;/p&gt;

&lt;p&gt;Considering all of that, I&apos;m currently pursuing a Windows-only native code implementation, with Linux continuing to run the existing code path.  I believe this can work, because Windows does not have a process umask or anything equivalent that would interfere with the intention of &lt;tt&gt;fs.permissions.umask-mode&lt;/tt&gt;.  Unfortunately, creations on Linux would still be subject to the race condition between &lt;tt&gt;creat&lt;/tt&gt;/&lt;tt&gt;mkdir&lt;/tt&gt; and &lt;tt&gt;chmod&lt;/tt&gt; that we have in today&apos;s code, but at least the situation wouldn&apos;t get any worse.&lt;/p&gt;</comment>
                            <comment id="14232111" author="cmccabe" created="Tue, 2 Dec 2014 20:54:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;Actually, it&apos;s more confusing than that, because we&apos;re not consistent about it. It looks like file creations always apply fs.permissions.umask-mode. For directories, FileContext applies it, but FileSystem doesn&apos;t. This means, for example, that &quot;hadoop fs -mkdir&quot; on the local file system is in fact governed by the process umask.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This seems like a bug in &lt;tt&gt;FileSystem&lt;/tt&gt;-- can you open a follow-on JIRA?  It may be that we can only make the fix in 3.0, but we should still fix it.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Another interesting thing I found after further experimentation is that the problem does not repro for an SMB share mounted on Linux. A chmod call &quot;succeeds&quot; without error, but simply does not change the permissions. The error handling seems to be specific to the OS client. This may in fact turn out to be a Windows-only bug, contrary to my prior statement.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This still seems like incorrect behavior to me.  If someone asks us for a restrictive set of permissions and we create the file with a more relaxed set, that seems insecure.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m not aware of any Unix file/directory creation syscalls that let you bypass the umask. That would mean achieving atomic create-and-set-permissions would require a native umask(0) call. I&apos;m very reluctant to do that, because we can&apos;t predict how this might compromise existing applications, especially for applications that use a mix of Hadoop and their own file creation calls. I suppose another possibility is to fork another process to do its own umask(0), but then we&apos;d have a lot of process creation overhead.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think maybe the right thing to do is to issue a &lt;tt&gt;LOG.info&lt;/tt&gt; if the process umask doesn&apos;t match the configured value of &lt;tt&gt;fs.permissions.umask-mode&lt;/tt&gt;.  Most users are probably running with a umask that matches &lt;tt&gt;fs.permissions.umask-mode&lt;/tt&gt; anyway.  If they aren&apos;t, the only problem is that the LocalFilesystem will create files with more restrictive permissions than intended.  This isn&apos;t a security hole, just a hassle, since things are just more locked down than intended.  And it should be easy to fix if the user reads the logs and realizes his umask is wrong.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Considering all of that, I&apos;m currently pursuing a Windows-only native code implementation, with Linux continuing to run the existing code path. I believe this can work, because Windows does not have a process umask or anything equivalent that would interfere with the intention of fs.permissions.umask-mode. Unfortunately, creations on Linux would still be subject to the race condition between creat/mkdir and chmod that we have in today&apos;s code, but at least the situation wouldn&apos;t get any worse.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If you want to just do the Windows part here, I am +1 on that.  But I think we should also do this for Linux.  We should eliminate this race condition on all platforms.  So if you choose to just do Windows here, I&apos;ll open a follow-on JIRA for Linux.&lt;/p&gt;

&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnauroth&quot; class=&quot;user-hover&quot; rel=&quot;cnauroth&quot;&gt;cnauroth&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="14232176" author="cnauroth" created="Tue, 2 Dec 2014 21:36:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;This seems like a bug in FileSystem-- can you open a follow-on JIRA?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11347&quot; title=&quot;RawLocalFileSystem#mkdir and create should honor umask&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11347&quot;&gt;&lt;del&gt;HADOOP-11347&lt;/del&gt;&lt;/a&gt;.  I agree that it needs to be targeted to 3.0, because applications might depend on the current behavior.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This still seems like incorrect behavior to me. If someone asks us for a restrictive set of permissions and we create the file with a more relaxed set, that seems insecure.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I just had an a-ha moment reading the man page for CIFS mounts:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://linux.die.net/man/8/mount.cifs&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://linux.die.net/man/8/mount.cifs&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;File And Directory Ownership And Permissions&lt;/p&gt;

&lt;p&gt;The core CIFS protocol does not provide unix ownership information or mode for files and directories. Because of this, files and directories will generally appear to be owned by whatever values the uid= or gid= options are set, and will have permissions set to the default file_mode and dir_mode for the mount. Attempting to change these values via chmod/chown will return success but have no effect.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This explains the behaviors I&apos;ve seen in Cygwin and SMB shares mounted on Linux clients.  While this can be seen as a security hole, it&apos;s a known issue in the CIFS protocol, and we&apos;re not going to be able to do anything to change that.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think maybe the right thing to do is to issue a LOG.info if the process umask doesn&apos;t match the configured value of fs.permissions.umask-mode. Most users are probably running with a umask that matches fs.permissions.umask-mode anyway. If they aren&apos;t, the only problem is that the LocalFilesystem will create files with more restrictive permissions than intended. This isn&apos;t a security hole, just a hassle, since things are just more locked down than intended. And it should be easy to fix if the user reads the logs and realizes his umask is wrong.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I suppose we can do this, but there is a risk that it would be backwards-incompatible.  I think this is something else that can&apos;t be done on the 2.x line and would have to wait for 3.0.  We can&apos;t anticipate if there are applications running with a 027 process umask and relying on the alternative contract of &lt;tt&gt;FileSystem&lt;/tt&gt; to open up read access for other on new files.  After deploying the change in those environments, others would no longer be able to access new files.  As you said, this one is not a security problem, but it is a functionality problem.  Users would have to respond by either adding explicit &lt;tt&gt;chmod&lt;/tt&gt; calls or relaxing their process umask (and possibly compromising security concerns in other parts of their code).&lt;/p&gt;

&lt;p&gt;Regarding the info logging, we might just have to skip it, or at least suppress it when used from the fs shell.  No one wants log output when running the shell commands.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If you want to just do the Windows part here, I am +1 on that. But I think we should also do this for Linux. We should eliminate this race condition on all platforms. So if you choose to just do Windows here, I&apos;ll open a follow-on JIRA for Linux.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks, Colin.  My focus is here is just getting functionality working on 2.x for both Linux and Windows.  This is going to restore functionality that had been working in 1.x.  My current assessment is that the patch will impact Windows code only.  I&apos;m not focused on the atomicity problem in the current code.  Please feel free to file a follow-up, but again, I believe it must target 3.0.&lt;/p&gt;</comment>
                            <comment id="14233309" author="cnauroth" created="Wed, 3 Dec 2014 18:38:11 +0000"  >&lt;p&gt;While reviewing the existing code, I discovered another bug in the 2-step file creation followed by setting permission.  If creation succeeds, but setting permission fails with an exception, then we leak a file descriptor.  I don&apos;t plan to fix it here, so I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11349&quot; title=&quot;RawLocalFileSystem leaks file descriptor while creating a file if creat succeeds but chmod fails.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11349&quot;&gt;&lt;del&gt;HADOOP-11349&lt;/del&gt;&lt;/a&gt; for follow-up.  Depending on where we go with the atomic create-with-permissions discussion, it might supersede &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11349&quot; title=&quot;RawLocalFileSystem leaks file descriptor while creating a file if creat succeeds but chmod fails.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11349&quot;&gt;&lt;del&gt;HADOOP-11349&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14233329" author="cmccabe" created="Wed, 3 Dec 2014 18:50:06 +0000"  >&lt;p&gt;Those are good points.&lt;/p&gt;

&lt;p&gt;It sounds like for Windows, we can go with the solution you&apos;re looking at now.  For Linux (and in general anything implementing POSIX.1-2001), perhaps we can just create the file with the requested permission, and then use &lt;tt&gt;fchmod&lt;/tt&gt; on the file descriptor to &quot;open it up&quot; by setting that same permission.  Then we get the best of all worlds... there is no point at which the permissions are more open then we desire, and we ignore umask (except on filesystems like samba where fchmod silently fails, but we can&apos;t solve that anyway... and it never worked in the past.)  The solution is in the samba case is just to open up your umask and then the create will succeed with the desired permission.&lt;/p&gt;</comment>
                            <comment id="14233351" author="cnauroth" created="Wed, 3 Dec 2014 19:03:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;For Linux (and in general anything implementing POSIX.1-2001), perhaps we can just create the file with the requested permission, and then use &lt;tt&gt;fchmod&lt;/tt&gt; on the file descriptor to &quot;open it up&quot; by setting that same permission.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That sounds great.  I think we&apos;ve got it now!  It&apos;s a shame we couldn&apos;t cut down to 1 syscall, but it seems like this is what it takes to maintain the current contract.  Thanks, Colin.&lt;/p&gt;</comment>
                            <comment id="14238819" author="cmccabe" created="Tue, 9 Dec 2014 01:35:30 +0000"  >&lt;p&gt;Awesome.  Let me know if you want help on the fchmod thing... we could split this JIRA into one for Windows and one for Linux.  Or maybe it makes sense to keep it all here, and just do it for both platforms in this patch?&lt;/p&gt;

&lt;p&gt;I reviewed &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11349&quot; title=&quot;RawLocalFileSystem leaks file descriptor while creating a file if creat succeeds but chmod fails.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11349&quot;&gt;&lt;del&gt;HADOOP-11349&lt;/del&gt;&lt;/a&gt;, which is a small fix for just the FD leak (good find)&lt;/p&gt;</comment>
                            <comment id="14240248" author="cnauroth" created="Tue, 9 Dec 2014 23:07:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;The solution is in the samba case is just to open up your umask and then the create will succeed with the desired permission.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Technically, we&apos;re not going to need any Hadoop code changes or changes to umask to support a Linux client with a Samba mount.  This works (or at least it doesn&apos;t fail the client), because CIFS mounts are implemented to silently ignore chmod failures, as described in my earlier comment.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Let me know if you want help on the fchmod thing... we could split this JIRA into one for Windows and one for Linux. Or maybe it makes sense to keep it all here, and just do it for both platforms in this patch?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for volunteering, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmccabe&quot; class=&quot;user-hover&quot; rel=&quot;cmccabe&quot;&gt;cmccabe&lt;/a&gt;.  I&apos;m about to post a patch shortly.  Based on what I have so far, I suspect the Linux &lt;tt&gt;fchmod&lt;/tt&gt; support will be a fairly small incremental thing.  Let me know your thoughts after you see the patch, and then we can make a call on whether or not to roll it all into one patch here or split it out separately.&lt;/p&gt;</comment>
                            <comment id="14240286" author="cnauroth" created="Tue, 9 Dec 2014 23:31:13 +0000"  >&lt;p&gt;Patch v3 implements a native code solution for creating local file system directories and files with an initial security descriptor equivalent to the mode passed by the caller.  I have tested this locally.  It fixes the original reported problem for a Windows client accessing an SMB share.  For a Linux client accessing an SMB share, there is no change in behavior in the Hadoop code, and it still works fine via the error handling in Linux CIFS mounts (silently ignoring the chmod failure).&lt;/p&gt;

&lt;p&gt;Here is a description of the changes.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;RawLocalFileSystem&lt;/tt&gt;: On Windows, make a JNI call to open a file descriptor for write instead of using &lt;tt&gt;java.io.FileOutputStream&lt;/tt&gt;.  There are 2 new methods that can be overridden in subclasses: &lt;tt&gt;mkOneDirWithMode&lt;/tt&gt; and &lt;tt&gt;createOutputStreamWithMode&lt;/tt&gt;.  These are intended to support &lt;tt&gt;ElevatedRawLocalFileSystem&lt;/tt&gt;, discussed in more detail below.  We cannot remove the older protected methods &lt;tt&gt;mkOneDir&lt;/tt&gt; and &lt;tt&gt;createOutputStream&lt;/tt&gt;, because the class is annotated &lt;tt&gt;Public&lt;/tt&gt; and &lt;tt&gt;Stable&lt;/tt&gt;.  These are now implemented as simple forwarding methods.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;ChecksumFileSystem&lt;/tt&gt;: This needed to change some of the file creation calls it uses on the wrapped file system to pass down the mode.  There is one awkward point here that required an &lt;tt&gt;instanceof&lt;/tt&gt; check, but I think it&apos;s preferable over adding more abstract methods to &lt;tt&gt;FileSystem&lt;/tt&gt; just to cover one special case.  Several calls are rerouted to equivalent overloaded methods that can accept mode as an argument.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;NativeIO&lt;/tt&gt;: Added Windows-specific JNI wrappers for a native implementation of directory and file creation.  For file creation, I needed to be careful to match the semantics that were implemented by &lt;tt&gt;java.io.FileOutputStream&lt;/tt&gt;.  This involved reading a bit of the JDK code, and I&apos;ve described the details in comments.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;NativeIO.c&lt;/tt&gt;: Added JNI implementations for the 2 new functions.  These are pretty boring and just pass through to the real action in...&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;libwinutils.c&lt;/tt&gt;: This contains the implementation of calling the relevant Windows APIs.  I&apos;ve reused our implementation of translating a mode to a discretionary access control list (&lt;tt&gt;GetWindowsDACLs&lt;/tt&gt;), so this will be consistent with, for example, &lt;tt&gt;winutils.exe chmod&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;WindowsSecureContainerExecutor&lt;/tt&gt;: This needed some adjustment to be able to handle the changes required in &lt;tt&gt;RawLocalFileSystem&lt;/tt&gt;.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rusanu&quot; class=&quot;user-hover&quot; rel=&quot;rusanu&quot;&gt;rusanu&lt;/a&gt;, this implementation still does creation and setting permissions in separate syscalls.  I suppose we could consolidate to a single syscall if we update the IDL for the RPC protocol to accept a mode argument, but I didn&apos;t want to tackle that in this patch.  I also don&apos;t know the compatibility constraints around versioning this RPC protocol.  This change was focused on a bug fix related to SMB shares.  I don&apos;t believe this is a major limitation for &lt;tt&gt;ElevatedRawLocalFileSystem&lt;/tt&gt;.  If NodeManager is running backed by an SMB share for the localization directory, then there are probably lots of other problems anyway.  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  If you think it&apos;s important to come back to this, please file a separate jira for that.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14240303" author="hadoopqa" created="Tue, 9 Dec 2014 23:40:41 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12686133/HADOOP-11321.003.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12686133/HADOOP-11321.003.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 03867eb.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5219//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5219//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14240435" author="cnauroth" created="Wed, 10 Dec 2014 00:53:56 +0000"  >&lt;p&gt;Patch v004 is a rebase after the &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11349&quot; title=&quot;RawLocalFileSystem leaks file descriptor while creating a file if creat succeeds but chmod fails.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11349&quot;&gt;&lt;del&gt;HADOOP-11349&lt;/del&gt;&lt;/a&gt; changes went in to &lt;tt&gt;RawLocalFileSystem&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14240626" author="hadoopqa" created="Wed, 10 Dec 2014 04:31:51 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12686166/HADOOP-11321.004.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12686166/HADOOP-11321.004.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 2ed90a5.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;      &lt;font color=&quot;red&quot;&gt;-1 javac&lt;/font&gt;.  The applied patch generated 1216 javac compiler warnings (more than the trunk&apos;s current 156 warnings).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 49 warning messages.&lt;br/&gt;
        See &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5221//artifact/patchprocess/diffJavadocWarnings.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5221//artifact/patchprocess/diffJavadocWarnings.txt&lt;/a&gt; for details.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 40 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-hdfs-project/hadoop-hdfs:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.hdfs.server.namenode.ha.TestRetryCacheWithHA&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5221//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5221//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5221//artifact/patchprocess/newPatchFindbugsWarningshadoop-hdfs.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5221//artifact/patchprocess/newPatchFindbugsWarningshadoop-hdfs.html&lt;/a&gt;&lt;br/&gt;
Javac warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5221//artifact/patchprocess/diffJavacWarnings.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5221//artifact/patchprocess/diffJavacWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5221//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5221//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14240864" author="rusanu" created="Wed, 10 Dec 2014 09:51:55 +0000"  >&lt;p&gt;The WSCE has no versioning in the IDL. As the calls are always local, it is expected that the binaries deployed are self-consistent.&lt;/p&gt;</comment>
                            <comment id="14240866" author="rusanu" created="Wed, 10 Dec 2014 09:55:02 +0000"  >&lt;p&gt;The WSCE file operations should only apply to container launch/localization. Even if all the NM operations all succeed on a SMB share, when the impersonated container launched by WSCE will fail to launch on a SMB share because it implies Kerberos delegation and the S4U token used by the WSCE impersonation model does not support delegation.&lt;/p&gt;</comment>
                            <comment id="14241544" author="cnauroth" created="Wed, 10 Dec 2014 19:06:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rusanu&quot; class=&quot;user-hover&quot; rel=&quot;rusanu&quot;&gt;rusanu&lt;/a&gt;, thank you for the clarifications.&lt;/p&gt;

&lt;p&gt;Findbugs is a known, unrelated issue right now.  I could not repro the javac and javadoc warnings locally, so it seems like something was strange about that Jenkins run.  Let&apos;s continue with code review, and I&apos;ll try another Jenkins run at a later time.&lt;/p&gt;</comment>
                            <comment id="14244938" author="cnauroth" created="Fri, 12 Dec 2014 22:56:05 +0000"  >&lt;p&gt;I&apos;m uploading patch v005 to fix a bug in my error handling for &lt;tt&gt;INVALID_HANDLE_VALUE&lt;/tt&gt;.  This is the diff since v004:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/hadoop-common-project/hadoop-common/src/main/winutils/libwinutils.c b/hadoop-common-project/hadoop-comm
index b006f17..c63ea3f 100644
--- a/hadoop-common-project/hadoop-common/src/main/winutils/libwinutils.c
+++ b/hadoop-common-project/hadoop-common/src/main/winutils/libwinutils.c
@@ -1696,10 +1696,13 @@ DWORD CreateFileWithMode(__in LPCWSTR lpPath, __in DWORD dwDesiredAccess,
 
   hFile = CreateFileW(lpLongPath, dwDesiredAccess, dwShareMode, &amp;amp;sa,
     dwCreationDisposition, dwFlagsAndAttributes, NULL);
-  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hFile != INVALID_HANDLE_VALUE) {
-    *pHFile = hFile;
+  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hFile == INVALID_HANDLE_VALUE) {
+    dwRtnCode = GetLastError();
+    &lt;span class=&quot;code-keyword&quot;&gt;goto&lt;/span&gt; done;
   }
 
+  *pHFile = hFile;
+
 done:
   LocalFree(lpLongPath);
   LocalFree(pDACL);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14244957" author="cmccabe" created="Fri, 12 Dec 2014 23:13:58 +0000"  >&lt;p&gt;Great.  Let me take a look.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (permission != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+    &lt;span class=&quot;code-comment&quot;&gt;// A local file system implementation may choose to create the file and set
&lt;/span&gt;+    &lt;span class=&quot;code-comment&quot;&gt;// permissions immediately in a single syscall.  If so, then skip setting
&lt;/span&gt;+    &lt;span class=&quot;code-comment&quot;&gt;// permissions here.
&lt;/span&gt;+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (permission != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !(fs &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; RawLocalFileSystem &amp;amp;&amp;amp;
+        Path.WINDOWS &amp;amp;&amp;amp; NativeIO.isAvailable())) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Do we need this part?  Earlier in this function, we invoke the &lt;tt&gt;FileSystem#create&lt;/tt&gt; method that takes an &lt;tt&gt;FsPermission&lt;/tt&gt;, right?  Then the FileSystem handles it atomically (hopefully) or non-atomically (ew).  Surely we&apos;re not going to try to work around &lt;tt&gt;FileSystem&lt;/tt&gt; instances that don&apos;t honor the permission passed to &lt;tt&gt;create&lt;/tt&gt;?  (And surely we don&apos;t have any of those... do we?)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Create a directory with permissions set to the specified mode.  By setting
     * permissions at creation time, we avoid issues related to the user lacking
     * WRITE_DAC rights on subsequent chmod calls.  One example where &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; can
     * occur is writing to an SMB share where the user does not have Full Control
     * rights, and therefore WRITE_DAC is denied.  This method mimics the
     * contract of {@link java.io.File#mkdir()}.  All exceptions are caught and
     * reported by returning {@code &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;} to the caller.
     *
     * @param path directory to create
     * @param mode permissions of &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; directory
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; directory creation succeeded
     */
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; createDirectoryWithMode(File path, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; mode) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think we should just pass the exception through here.  We don&apos;t want to keep people guessing if there is an I/O error.  Just like the new JDK7 File functions throw an IOException on error, we should throw an IOE if the IO can&apos;t be done.  Then the caller can catch it and ignore it if appropriate.  I realize we need the (bad) &quot;return false&quot; semantics in FileSystem, but by putting this here, we encourage people to use it for other stuff.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;#ifdef UNIX
  THROW(env, &lt;span class=&quot;code-quote&quot;&gt;&quot;java/io/IOException&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;The function Windows.createDirectoryWithMode0() is not supported on Unix&quot;&lt;/span&gt;);
#endif

#ifdef WINDOWS
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Would it make more sense to have an &lt;tt&gt;#else&lt;/tt&gt; after the &lt;tt&gt;#ifdef WINDOWS&lt;/tt&gt; clause?  &lt;span class=&quot;error&quot;&gt;&amp;#91;edit: and change the message to say &amp;quot;is not supported on this platform&amp;quot; rather than &amp;quot;not supported on Unix&amp;quot;&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;in &lt;tt&gt;libwinutils.c&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  *ppSD = pSD;

done:
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dwRtnCode != ERROR_SUCCESS) {
    LocalFree(pSD);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I guess this is a nitpick, but perhaps we should only set &lt;tt&gt;ppSD&lt;/tt&gt; when the return code is success?  Of course it won&apos;t matter for callers that check the return code, as they should.&lt;/p&gt;</comment>
                            <comment id="14245008" author="hadoopqa" created="Sat, 13 Dec 2014 00:01:13 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12686966/HADOOP-11321.005.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12686966/HADOOP-11321.005.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 7784b10.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 23 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.ha.TestZKFailoverControllerStress&lt;br/&gt;
                  org.apache.hadoop.yarn.server.nodemanager.TestLocalDirsHandlerService&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5259//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5259//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5259//artifact/patchprocess/newPatchFindbugsWarningshadoop-yarn-server-nodemanager.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5259//artifact/patchprocess/newPatchFindbugsWarningshadoop-yarn-server-nodemanager.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5259//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5259//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5259//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5259//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14245233" author="cnauroth" created="Sat, 13 Dec 2014 07:24:53 +0000"  >&lt;p&gt;Thanks for the code review, Colin.  I&apos;m uploading patch v006 with the following changes.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;ChecksumFileSystem&lt;/tt&gt;: Removed the special case for calling &lt;tt&gt;setPermission&lt;/tt&gt;.  I agree that this shouldn&apos;t be necessary anymore.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;NativeIO#createDirectoryWithMode&lt;/tt&gt;: Changed to propagate the exception.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;RawLocalFileSystem#mkOneDirWithMode&lt;/tt&gt;: Changed to catch the exception and return &lt;tt&gt;false&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;NativeIO.c&lt;/tt&gt;: Changed to use &lt;tt&gt;#else&lt;/tt&gt; instead of &lt;tt&gt;#ifdef UNIX&lt;/tt&gt; and updated error messages.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;libwinutils.c&lt;/tt&gt;: I discovered a bug in our logic for deciding to convert to long path format.  Normally, the length restriction is defined by &lt;tt&gt;MAX_PATH&lt;/tt&gt;, which we already check.  However, for directories, there is an additional requirement that it must be possible to append a child file name in 8.3 format (12 characters).  This is documented about 1/3 of the page down here:&lt;br/&gt;
&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/windows/desktop/aa365247%28v=vs.85%29.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://msdn.microsoft.com/en-us/library/windows/desktop/aa365247%28v=vs.85%29.aspx&lt;/a&gt; .  The patch handles this the same way that the JDK code handles it, by checking for &lt;tt&gt;MAX_PATH - 12&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;TestLocalDirsHandlerService&lt;/tt&gt;: I discovered an odd behavior in &lt;tt&gt;FileContext#mkdir&lt;/tt&gt;.  You can pass in an &lt;tt&gt;FsPermission&lt;/tt&gt;.  If creation of the directory fails because it already exists, then we still call &lt;tt&gt;setPermission&lt;/tt&gt; and potentially change the mode.  This happens due to the code in the current trunk version of &lt;tt&gt;RawLocalFileSystem#primitiveMkdir&lt;/tt&gt;.  This seems like a bug.  POSIX &lt;tt&gt;mkdir&lt;/tt&gt; and &lt;tt&gt;FileSystem&lt;/tt&gt; don&apos;t behave this way.  By removing &lt;tt&gt;RawLocalFileSystem#primitiveMkdir&lt;/tt&gt; in my patch, that behavior is going away.  I found that &lt;tt&gt;TestLocalDirsHandlerService&lt;/tt&gt; was depending on this old behavior, but it&apos;s probably just a coincidence that the test suite keeps reusing the same directories across multiple tests.  I changed the test suite to clean up in between tests.  If anyone thinks this behavior of &lt;tt&gt;FileContext&lt;/tt&gt; is intentional, please let me know.&lt;/li&gt;
&lt;/ul&gt;


&lt;blockquote&gt;&lt;p&gt;I guess this is a nitpick, but perhaps we should only set ppSD when the return code is success?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;At this point in the code, it&apos;s guaranteed that the return code is success.  The earlier code paths check the individual API calls for errors, and if found, jump to the &lt;tt&gt;done&lt;/tt&gt; label, going past the assignment to &lt;tt&gt;ppSD&lt;/tt&gt;.  (I do agree with the principle that functions should only write to an out parameter if it succeeds.)&lt;/p&gt;</comment>
                            <comment id="14245253" author="hadoopqa" created="Sat, 13 Dec 2014 08:34:40 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12687025/HADOOP-11321.006.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12687025/HADOOP-11321.006.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 9458cd5.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 23 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.crypto.random.TestOsSecureRandom&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5260//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5260//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5260//artifact/patchprocess/newPatchFindbugsWarningshadoop-yarn-server-nodemanager.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5260//artifact/patchprocess/newPatchFindbugsWarningshadoop-yarn-server-nodemanager.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5260//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5260//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5260//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5260//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14245570" author="cnauroth" created="Sat, 13 Dec 2014 21:48:23 +0000"  >&lt;p&gt;The Findbugs warnings and test failures are unrelated to this patch.&lt;/p&gt;</comment>
                            <comment id="14245881" author="arpitagarwal" created="Sun, 14 Dec 2014 09:57:26 +0000"  >&lt;p&gt;Hi Chris,&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;+&lt;span class=&quot;code-comment&quot;&gt;//  Checks &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the path is longer than (MAX_PATH - 12) in which &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; it needs to
&lt;/span&gt;+&lt;span class=&quot;code-comment&quot;&gt;//  be prepended with \\?\ &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Windows OS to understand it.  The -12 is to
&lt;/span&gt;+&lt;span class=&quot;code-comment&quot;&gt;//  account &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; an additional constraint &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; directories that it must be possible
&lt;/span&gt;+&lt;span class=&quot;code-comment&quot;&gt;//  to append an 8.3 file name.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Good catch. If the directory does not end in a trailing backslash then should it be -13 instead?&lt;/p&gt;

&lt;p&gt;+1 otherwise.&lt;/p&gt;

&lt;p&gt;FWIW I agree the prior behavior of &lt;tt&gt;FileContext#mkdir&lt;/tt&gt; looks buggy. There is a small chance of creating a security issue if someone was depending on the buggy behavior. Perhaps it could be emulated by issuing a setPermissions if the createFile fails.&lt;/p&gt;</comment>
                            <comment id="14246810" author="cnauroth" created="Mon, 15 Dec 2014 16:31:17 +0000"  >&lt;p&gt;Thanks for reviewing, Arpit.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Good catch. If the directory does not end in a trailing backslash then should it be -13 instead?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;By the time execution reaches here, we have passed the path through &lt;tt&gt;java.io.File#getAbsolutePath&lt;/tt&gt;.  This appears to have the behavior of removing the trailing slash if present.  Even if that weren&apos;t the case, the JDK code has no special handling for a trailing slash, so I think we&apos;re all clear.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://hg.openjdk.java.net/jdk7/modules/jdk/file/a37326fa7f95/src/windows/native/java/io/io_util_md.c#l146&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hg.openjdk.java.net/jdk7/modules/jdk/file/a37326fa7f95/src/windows/native/java/io/io_util_md.c#l146&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14248856" author="cnauroth" created="Tue, 16 Dec 2014 20:26:42 +0000"  >&lt;p&gt;I&apos;m attaching patch v007.  This has one small change from v006, shown in the incremental diff below.  Instead of basing ownership on the TokenUser of the current process, the new patch uses TokenOwner.  According to documentation, this is the correct way to identify the default owner SID for newly created objects.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://msdn.microsoft.com/en-us/library/windows/desktop/aa379626%28v=vs.85%29.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://msdn.microsoft.com/en-us/library/windows/desktop/aa379626%28v=vs.85%29.aspx&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;More details are here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://technet.microsoft.com/en-us/library/cc961992.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://technet.microsoft.com/en-us/library/cc961992.aspx&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;With this change, we correctly handle the special case that for files created by a member of the Administrators group, the ownership is set to the Administrators group instead of to the individual user SID.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/hadoop-common-project/hadoop-common/src/main/winutils/libwinutils.c b/hadoop-common-project/hadoop-c
index c1dd914..040d563 100644
--- a/hadoop-common-project/hadoop-common/src/main/winutils/libwinutils.c
+++ b/hadoop-common-project/hadoop-common/src/main/winutils/libwinutils.c
@@ -1515,7 +1515,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; DWORD GetWindowsDACLsForCreate(__in INT mode, __out PACL *ppDACL) {
   DWORD dwRtnCode = ERROR_SUCCESS;
   HANDLE hToken = NULL;
   DWORD dwSize = 0;
-  PTOKEN_USER pTokenUser = NULL;
+  PTOKEN_OWNER pTokenOwner = NULL;
   PTOKEN_PRIMARY_GROUP pTokenPrimaryGroup = NULL;
   PSID pOwnerSid = NULL, pGroupSid = NULL;
   PACL pDACL = NULL;
@@ -1525,11 +1525,11 @@ &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; DWORD GetWindowsDACLsForCreate(__in INT mode, __out PACL *ppDACL) {
     &lt;span class=&quot;code-keyword&quot;&gt;goto&lt;/span&gt; done;
   }
 
-  dwRtnCode = GetTokenInformationByClass(hToken, TokenUser, &amp;amp;pTokenUser);
+  dwRtnCode = GetTokenInformationByClass(hToken, TokenOwner, &amp;amp;pTokenOwner);
   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dwRtnCode != ERROR_SUCCESS) {
     &lt;span class=&quot;code-keyword&quot;&gt;goto&lt;/span&gt; done;
   }
-  pOwnerSid = pTokenUser-&amp;gt;User.Sid;
+  pOwnerSid = pTokenOwner-&amp;gt;Owner;
 
   dwRtnCode = GetTokenInformationByClass(hToken, TokenPrimaryGroup,
       &amp;amp;pTokenPrimaryGroup);
@@ -1549,7 +1549,7 @@ done:
   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hToken) {
     CloseHandle(hToken);
   }
-  LocalFree(pTokenUser);
+  LocalFree(pTokenOwner);
   LocalFree(pTokenPrimaryGroup);
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; dwRtnCode;
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14248951" author="cmccabe" created="Tue, 16 Dec 2014 21:17:16 +0000"  >&lt;p&gt;+1 from me as well.  Thanks, Chris.&lt;/p&gt;</comment>
                            <comment id="14248992" author="cnauroth" created="Tue, 16 Dec 2014 21:34:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arpitagarwal&quot; class=&quot;user-hover&quot; rel=&quot;arpitagarwal&quot;&gt;arpitagarwal&lt;/a&gt; correctly pointed out an issue in the handling of the max length rule for &lt;tt&gt;CreateDirectory&lt;/tt&gt;.  If it must be possible to append an 8.3 file name, then we also need room for an additional path separator, in case the original path didn&apos;t provide it.  In fact, in our case, we expect not to have a trailing path separator, because it gets removed by &lt;tt&gt;java.io.File#getAbsolutePath&lt;/tt&gt;.  Here is patch v008, changing to &lt;tt&gt;MAX_PATH - 13&lt;/tt&gt; instead of &lt;tt&gt;MAX_PATH - 12&lt;/tt&gt;.  Thanks for the good eye, Arpit.&lt;/p&gt;</comment>
                            <comment id="14248995" author="hadoopqa" created="Tue, 16 Dec 2014 21:35:55 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12687562/HADOOP-11321.007.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12687562/HADOOP-11321.007.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision a97a1e7.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 23 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.crypto.random.TestOsSecureRandom&lt;br/&gt;
                  org.apache.hadoop.ha.TestZKFailoverController&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5281//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5281//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5281//artifact/patchprocess/newPatchFindbugsWarningshadoop-yarn-server-nodemanager.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5281//artifact/patchprocess/newPatchFindbugsWarningshadoop-yarn-server-nodemanager.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5281//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5281//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5281//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5281//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14249013" author="arpitagarwal" created="Tue, 16 Dec 2014 21:43:53 +0000"  >&lt;p&gt;Thanks for fixing that Chris!&lt;/p&gt;

&lt;p&gt;+1 for the v008 patch, pending Jenkins.&lt;/p&gt;</comment>
                            <comment id="14249102" author="hadoopqa" created="Tue, 16 Dec 2014 22:44:39 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12687592/HADOOP-11321.008.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12687592/HADOOP-11321.008.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 565d72f.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 23 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.crypto.random.TestOsSecureRandom&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5282//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5282//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5282//artifact/patchprocess/newPatchFindbugsWarningshadoop-yarn-server-nodemanager.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5282//artifact/patchprocess/newPatchFindbugsWarningshadoop-yarn-server-nodemanager.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5282//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5282//artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/5282//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/5282//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14249169" author="hudson" created="Tue, 16 Dec 2014 23:42:36 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-trunk-Commit #6732 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/6732/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/6732/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11321&quot; title=&quot;copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11321&quot;&gt;&lt;del&gt;HADOOP-11321&lt;/del&gt;&lt;/a&gt;. copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions. Contributed by Chris Nauroth. (cnauroth: rev e996a1bfd4f3ada6cbd9633fe68fda1e0c910bdf)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/libwinutils.c&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/nativeio/NativeIO.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/RawLocalFileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/include/winutils.h&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/test/java/org/apache/hadoop/yarn/server/nodemanager/TestLocalDirsHandlerService.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/WindowsSecureContainerExecutor.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/native/src/org/apache/hadoop/io/nativeio/NativeIO.c&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/ChecksumFileSystem.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14249171" author="cnauroth" created="Tue, 16 Dec 2014 23:45:23 +0000"  >&lt;p&gt;The test failure and Findbugs warnings are unrelated.  I committed this to trunk and branch-2.  Thanks very much to the code reviewers: Colin, Remus and Arpit.&lt;/p&gt;

&lt;p&gt;I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11415&quot; title=&quot;Local file system on Linux may create files and directories initially with wider permissions than intended.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11415&quot;&gt;HADOOP-11415&lt;/a&gt; to track use of &lt;tt&gt;fchmod&lt;/tt&gt; for providing a similar solution on Linux.&lt;/p&gt;</comment>
                            <comment id="14249741" author="hudson" created="Wed, 17 Dec 2014 11:33:19 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Yarn-trunk-Java8 #44 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/44/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk-Java8/44/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11321&quot; title=&quot;copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11321&quot;&gt;&lt;del&gt;HADOOP-11321&lt;/del&gt;&lt;/a&gt;. copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions. Contributed by Chris Nauroth. (cnauroth: rev e996a1bfd4f3ada6cbd9633fe68fda1e0c910bdf)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/include/winutils.h&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/RawLocalFileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/libwinutils.c&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/ChecksumFileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/test/java/org/apache/hadoop/yarn/server/nodemanager/TestLocalDirsHandlerService.java&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/WindowsSecureContainerExecutor.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/native/src/org/apache/hadoop/io/nativeio/NativeIO.c&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/nativeio/NativeIO.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14249747" author="hudson" created="Wed, 17 Dec 2014 11:36:49 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Yarn-trunk #778 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/778/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/778/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11321&quot; title=&quot;copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11321&quot;&gt;&lt;del&gt;HADOOP-11321&lt;/del&gt;&lt;/a&gt;. copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions. Contributed by Chris Nauroth. (cnauroth: rev e996a1bfd4f3ada6cbd9633fe68fda1e0c910bdf)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/nativeio/NativeIO.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/native/src/org/apache/hadoop/io/nativeio/NativeIO.c&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/include/winutils.h&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/RawLocalFileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/WindowsSecureContainerExecutor.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/libwinutils.c&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/ChecksumFileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/test/java/org/apache/hadoop/yarn/server/nodemanager/TestLocalDirsHandlerService.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14249901" author="hudson" created="Wed, 17 Dec 2014 14:30:05 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-trunk #1976 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1976/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1976/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11321&quot; title=&quot;copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11321&quot;&gt;&lt;del&gt;HADOOP-11321&lt;/del&gt;&lt;/a&gt;. copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions. Contributed by Chris Nauroth. (cnauroth: rev e996a1bfd4f3ada6cbd9633fe68fda1e0c910bdf)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/RawLocalFileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/ChecksumFileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/include/winutils.h&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/WindowsSecureContainerExecutor.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/native/src/org/apache/hadoop/io/nativeio/NativeIO.c&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/nativeio/NativeIO.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/test/java/org/apache/hadoop/yarn/server/nodemanager/TestLocalDirsHandlerService.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/libwinutils.c&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14249911" author="hudson" created="Wed, 17 Dec 2014 14:36:01 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #41 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/41/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/41/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11321&quot; title=&quot;copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11321&quot;&gt;&lt;del&gt;HADOOP-11321&lt;/del&gt;&lt;/a&gt;. copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions. Contributed by Chris Nauroth. (cnauroth: rev e996a1bfd4f3ada6cbd9633fe68fda1e0c910bdf)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/native/src/org/apache/hadoop/io/nativeio/NativeIO.c&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/RawLocalFileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/test/java/org/apache/hadoop/yarn/server/nodemanager/TestLocalDirsHandlerService.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/libwinutils.c&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/nativeio/NativeIO.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/ChecksumFileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/WindowsSecureContainerExecutor.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/include/winutils.h&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14249954" author="hudson" created="Wed, 17 Dec 2014 15:08:33 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk-Java8 #45 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/45/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/45/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11321&quot; title=&quot;copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11321&quot;&gt;&lt;del&gt;HADOOP-11321&lt;/del&gt;&lt;/a&gt;. copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions. Contributed by Chris Nauroth. (cnauroth: rev e996a1bfd4f3ada6cbd9633fe68fda1e0c910bdf)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/native/src/org/apache/hadoop/io/nativeio/NativeIO.c&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/RawLocalFileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/include/winutils.h&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/nativeio/NativeIO.java&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/test/java/org/apache/hadoop/yarn/server/nodemanager/TestLocalDirsHandlerService.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/libwinutils.c&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/ChecksumFileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/WindowsSecureContainerExecutor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14250009" author="hudson" created="Wed, 17 Dec 2014 15:41:08 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Mapreduce-trunk #1995 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1995/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1995/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11321&quot; title=&quot;copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11321&quot;&gt;&lt;del&gt;HADOOP-11321&lt;/del&gt;&lt;/a&gt;. copyToLocal cannot save a file to an SMB share unless the user has Full Control permissions. Contributed by Chris Nauroth. (cnauroth: rev e996a1bfd4f3ada6cbd9633fe68fda1e0c910bdf)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/main/java/org/apache/hadoop/yarn/server/nodemanager/WindowsSecureContainerExecutor.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/libwinutils.c&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/RawLocalFileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-yarn-project/hadoop-yarn/hadoop-yarn-server/hadoop-yarn-server-nodemanager/src/test/java/org/apache/hadoop/yarn/server/nodemanager/TestLocalDirsHandlerService.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/ChecksumFileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/winutils/include/winutils.h&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/native/src/org/apache/hadoop/io/nativeio/NativeIO.c&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/nativeio/NativeIO.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12759248">HADOOP-11349</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12762142">HADOOP-11415</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12758990">HADOOP-11347</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12686133" name="HADOOP-11321.003.patch" size="29314" author="cnauroth" created="Tue, 9 Dec 2014 23:31:13 +0000"/>
                            <attachment id="12686166" name="HADOOP-11321.004.patch" size="29963" author="cnauroth" created="Wed, 10 Dec 2014 00:53:56 +0000"/>
                            <attachment id="12686966" name="HADOOP-11321.005.patch" size="30012" author="cnauroth" created="Fri, 12 Dec 2014 22:56:05 +0000"/>
                            <attachment id="12687025" name="HADOOP-11321.006.patch" size="31984" author="cnauroth" created="Sat, 13 Dec 2014 07:24:53 +0000"/>
                            <attachment id="12687562" name="HADOOP-11321.007.patch" size="31987" author="cnauroth" created="Tue, 16 Dec 2014 20:26:42 +0000"/>
                            <attachment id="12687592" name="HADOOP-11321.008.patch" size="32028" author="cnauroth" created="Tue, 16 Dec 2014 21:34:30 +0000"/>
                            <attachment id="12682536" name="HADOOP-11321.1.patch" size="5945" author="cnauroth" created="Thu, 20 Nov 2014 00:22:33 +0000"/>
                            <attachment id="12683664" name="HADOOP-11321.2.patch" size="5708" author="cnauroth" created="Tue, 25 Nov 2014 21:30:59 +0000"/>
                            <attachment id="12683962" name="winutils.tmp.patch" size="3779" author="cnauroth" created="Thu, 27 Nov 2014 00:55:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22l4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327583">2.7.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>