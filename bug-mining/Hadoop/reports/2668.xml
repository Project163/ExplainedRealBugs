<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:56:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-17229] Test failure as failed request body counted in byte received metric - ITestAbfsNetworkStatistics#testAbfsHttpResponseStatistics</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-17229</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;Bytes received counter increments for every request response received.&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hadoop/blob/d23cc9d85d887f01d72180bdf1af87dfdee15c5a/hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsRestOperation.java#L251&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/d23cc9d85d887f01d72180bdf1af87dfdee15c5a/hadoop-tools/hadoop-azure/src/main/java/org/apache/hadoop/fs/azurebfs/services/AbfsRestOperation.java#L251&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This increments even for failed requests.&#160;&lt;/p&gt;

&lt;p&gt;Observed during testing done for &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17215&quot; title=&quot;ABFS: Support for conditional overwrite&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17215&quot;&gt;&lt;del&gt;HADOOP-17215&lt;/del&gt;&lt;/a&gt;. A request failed with 409 Conflict contains response body as below:&lt;/p&gt;

&lt;p&gt;{&quot;error&quot;:{&quot;code&quot;:&quot;PathAlreadyExists&quot;,&quot;message&quot;:&quot;The specified path already exists.\nRequestId:c3b2c55c-b01f-0061-7b31-7b6ee3000000\nTime:2020-08-25T22:44:07.2356054Z&quot;}}&lt;/p&gt;

&lt;p&gt;The error body of 168 size is incremented in bytes_received counter.&#160;&lt;/p&gt;

&lt;p&gt;This also breaks the testcase testAbfsHttpResponseStatistics.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ERROR] Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 22.746 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.hadoop.fs.azurebfs.ITestAbfsNetworkStatistics[ERROR] Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 22.746 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.hadoop.fs.azurebfs.ITestAbfsNetworkStatistics[ERROR] testAbfsHttpResponseStatistics(org.apache.hadoop.fs.azurebfs.ITestAbfsNetworkStatistics)&#160; Time elapsed: 13.183 s&#160; &amp;lt;&amp;lt;&amp;lt; FAILURE!java.lang.AssertionError: Mismatch in bytes_received expected:&amp;lt;143&amp;gt; but was:&amp;lt;311&amp;gt; at org.junit.Assert.fail(Assert.java:88) at org.junit.Assert.failNotEquals(Assert.java:834) at org.junit.Assert.assertEquals(Assert.java:645) at org.apache.hadoop.fs.azurebfs.AbstractAbfsIntegrationTest.assertAbfsStatistics(AbstractAbfsIntegrationTest.java:445) at org.apache.hadoop.fs.azurebfs.ITestAbfsNetworkStatistics.testAbfsHttpResponseStatistics(ITestAbfsNetworkStatistics.java:291)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mehakmeetSingh&quot; class=&quot;user-hover&quot; rel=&quot;mehakmeetSingh&quot;&gt;mehakmeetSingh&lt;/a&gt;&#160;- is the bytes_received counter increment for failed requests an expected behaviour ?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13324565">HADOOP-17229</key>
            <summary>Test failure as failed request body counted in byte received metric - ITestAbfsNetworkStatistics#testAbfsHttpResponseStatistics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mehakmeetSingh">Mehakmeet Singh</assignee>
                                    <reporter username="snvijaya">Sneha Vijayarajan</reporter>
                        <labels>
                            <label>abfsactive</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 25 Aug 2020 22:11:44 +0000</created>
                <updated>Tue, 8 Sep 2020 13:14:31 +0000</updated>
                            <resolved>Tue, 8 Sep 2020 09:15:10 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.3.1</fixVersion>
                                    <component>fs/azure</component>
                    <component>test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="9600">2h 40m</timespent>
                                <comments>
                            <comment id="17184974" author="mehakmeetsingh" created="Wed, 26 Aug 2020 06:56:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=snvijaya&quot; class=&quot;user-hover&quot; rel=&quot;snvijaya&quot;&gt;snvijaya&lt;/a&gt;, by looking at the code, it seems like I understood that when a response is processed, it would set the bytesRead in AbfsHttpOperation(Which I use as the value to increment) to the total bytes that are read else if the response is failed it would be 0 since we haven&apos;t read any data and by that, I thought the counter increment would be 0 in case the response process failed.&#160;&lt;br/&gt;
 It is a bug since it doesn&apos;t account for the failed response incrementing the counter with some value. Thanks for pointing it out.&lt;/p&gt;

&lt;p&gt;Also, Can you help me to understand how I can mock a response failure, I would like to add this as a test for the counters too.&lt;/p&gt;</comment>
                            <comment id="17185666" author="snvijaya" created="Thu, 27 Aug 2020 07:16:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mehakmeetSingh&quot; class=&quot;user-hover&quot; rel=&quot;mehakmeetSingh&quot;&gt;mehakmeetSingh&lt;/a&gt;&#160;- the scenario mentioned in the description can reproduce this.&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Create 0 byte file&lt;/li&gt;
	&lt;li&gt;Create with overwrite = false on same path. This request will fail.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The second step will end up adding bytes received from the error response body.&lt;/p&gt;</comment>
                            <comment id="17192179" author="stevel@apache.org" created="Tue, 8 Sep 2020 12:27:20 +0000"  >&lt;p&gt;merged to trunk and 3.3&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0i380:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>