<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:46:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-11174] Delegation token for KMS should only be got once if it already exists</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-11174</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;When submit MapReduce job in security mode, we need to collect delegation tokens (i.e. delegation token for NameNode, KMS).&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;addDelegationTokens&lt;/tt&gt; is invoked several times, currently dt for NN is got only once if exists.  But  dt for KMS is got every time, we should fix this.&lt;/p&gt;

&lt;p&gt;Running in real cluster:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;14/10/08 02:30:52 INFO security.TokenCache: Got dt for hdfs://hnode1.sh.intel.com:9000; Kind: HDFS_DELEGATION_TOKEN, Service: 10.239.47.8:9000, Ident: (HDFS_DELEGATION_TOKEN token 13 for user)&lt;br/&gt;
14/10/08 02:30:52 WARN token.Token: Cannot find class for token kind kms-dt&lt;br/&gt;
14/10/08 02:30:52 INFO security.TokenCache: Got dt for hdfs://hnode1.sh.intel.com:9000; Kind: kms-dt, Service: 10.239.47.8:16000, Ident: 00 04 75 73 65 72 04 79 61 72 6e 00 8a 01 48 eb e0 d2 76 8a 01 49 0f ed 56 76 06 02&lt;br/&gt;
14/10/08 02:30:53 WARN token.Token: Cannot find class for token kind kms-dt&lt;br/&gt;
14/10/08 02:30:53 INFO security.TokenCache: Got dt for hdfs://hnode1.sh.intel.com:9000; Kind: kms-dt, Service: 10.239.47.8:16000, Ident: 00 04 75 73 65 72 04 79 61 72 6e 00 8a 01 48 eb e0 d3 85 8a 01 49 0f ed 57 85 07 02&lt;br/&gt;
14/10/08 02:30:53 WARN token.Token: Cannot find class for token kind kms-dt&lt;br/&gt;
14/10/08 02:30:53 INFO security.TokenCache: Got dt for hdfs://hnode1.sh.intel.com:9000; Kind: kms-dt, Service: 10.239.47.8:16000, Ident: 00 04 75 73 65 72 04 79 61 72 6e 00 8a 01 48 eb e0 d3 8e 8a 01 49 0f ed 57 8e 08 02&lt;br/&gt;
14/10/08 02:30:53 WARN token.Token: Cannot find class for token kind kms-dt&lt;br/&gt;
14/10/08 02:30:53 INFO security.TokenCache: Got dt for hdfs://hnode1.sh.intel.com:9000; Kind: kms-dt, Service: 10.239.47.8:16000, Ident: 00 04 75 73 65 72 04 79 61 72 6e 00 8a 01 48 eb e0 d4 ef 8a 01 49 0f ed 58 ef 09 02&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12746601">HADOOP-11174</key>
            <summary>Delegation token for KMS should only be got once if it already exists</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hitliuyi">Yi Liu</assignee>
                                    <reporter username="hitliuyi">Yi Liu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Oct 2014 03:50:01 +0000</created>
                <updated>Mon, 1 Dec 2014 03:08:11 +0000</updated>
                            <resolved>Thu, 9 Oct 2014 20:22:37 +0000</resolved>
                                    <version>2.6.0</version>
                                    <fixVersion>2.6.0</fixVersion>
                                    <component>kms</component>
                    <component>security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14163211" author="hitliuyi" created="Wed, 8 Oct 2014 08:01:30 +0000"  >&lt;p&gt;Update the patch, and verify that dt for KMS is got once if it already exists in real cluster environment.&lt;/p&gt;</comment>
                            <comment id="14163216" author="hitliuyi" created="Wed, 8 Oct 2014 08:05:50 +0000"  >&lt;p&gt;Move the issue from HDFS to Hadoop Common.&lt;/p&gt;</comment>
                            <comment id="14163349" author="hadoopqa" created="Wed, 8 Oct 2014 11:23:14 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12673556/HDFS-7205.001.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12673556/HDFS-7205.001.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1efd9c9.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  There were no new javadoc warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests in hadoop-common-project/hadoop-common hadoop-hdfs-project/hadoop-hdfs:&lt;/p&gt;

&lt;p&gt;                  org.apache.hadoop.hdfs.server.namenode.ha.TestDNFencingWithReplication&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/4875//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/4875//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/4875//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/4875//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14165673" author="andrew.wang" created="Thu, 9 Oct 2014 20:19:44 +0000"  >&lt;p&gt;This looks good, thanks for working on this Yi. +1 I&apos;ll commit shortly.&lt;/p&gt;</comment>
                            <comment id="14165682" author="andrew.wang" created="Thu, 9 Oct 2014 20:22:37 +0000"  >&lt;p&gt;Thanks again Yi, committed down through branch-2.6.&lt;/p&gt;</comment>
                            <comment id="14165694" author="hudson" created="Thu, 9 Oct 2014 20:33:32 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-trunk-Commit #6226 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/6226/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/6226/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11174&quot; title=&quot;Delegation token for KMS should only be got once if it already exists&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11174&quot;&gt;&lt;del&gt;HADOOP-11174&lt;/del&gt;&lt;/a&gt;. Delegation token for KMS should only be got once if it already exists. (Yi Liu via wang) (wang: rev 8d941144952a77a714cd4368cba21b01904926e9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/crypto/key/kms/KMSClientProvider.java&lt;/li&gt;
	&lt;li&gt;hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZones.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZonesWithKMS.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14166095" author="hitliuyi" created="Fri, 10 Oct 2014 00:55:11 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andrew.wang&quot; class=&quot;user-hover&quot; rel=&quot;andrew.wang&quot;&gt;andrew.wang&lt;/a&gt; for the review.&lt;/p&gt;</comment>
                            <comment id="14166676" author="hudson" created="Fri, 10 Oct 2014 11:44:00 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Yarn-trunk #707 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/707/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/707/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11174&quot; title=&quot;Delegation token for KMS should only be got once if it already exists&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11174&quot;&gt;&lt;del&gt;HADOOP-11174&lt;/del&gt;&lt;/a&gt;. Delegation token for KMS should only be got once if it already exists. (Yi Liu via wang) (wang: rev 8d941144952a77a714cd4368cba21b01904926e9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/crypto/key/kms/KMSClientProvider.java&lt;/li&gt;
	&lt;li&gt;hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZonesWithKMS.java&lt;/li&gt;
	&lt;li&gt;hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZones.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14166868" author="hudson" created="Fri, 10 Oct 2014 13:56:58 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-trunk #1897 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1897/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1897/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11174&quot; title=&quot;Delegation token for KMS should only be got once if it already exists&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11174&quot;&gt;&lt;del&gt;HADOOP-11174&lt;/del&gt;&lt;/a&gt;. Delegation token for KMS should only be got once if it already exists. (Yi Liu via wang) (wang: rev 8d941144952a77a714cd4368cba21b01904926e9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZones.java&lt;/li&gt;
	&lt;li&gt;hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZonesWithKMS.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/crypto/key/kms/KMSClientProvider.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14166957" author="hudson" created="Fri, 10 Oct 2014 15:11:49 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk #1922 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1922/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1922/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11174&quot; title=&quot;Delegation token for KMS should only be got once if it already exists&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11174&quot;&gt;&lt;del&gt;HADOOP-11174&lt;/del&gt;&lt;/a&gt;. Delegation token for KMS should only be got once if it already exists. (Yi Liu via wang) (wang: rev 8d941144952a77a714cd4368cba21b01904926e9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZonesWithKMS.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/crypto/key/kms/KMSClientProvider.java&lt;/li&gt;
	&lt;li&gt;hadoop-hdfs-project/hadoop-hdfs/src/test/java/org/apache/hadoop/hdfs/TestEncryptionZones.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12673556" name="HDFS-7205.001.patch" size="6295" author="hitliuyi" created="Wed, 8 Oct 2014 08:01:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20wyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12327583">2.7.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>