<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:56:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-17689] Avoid Potential NPE in org.apache.hadoop.fs</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-17689</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hadoop/blob/f40e3eb0590f85bb42d2471992bf5d524628fdd6/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/f40e3eb0590f85bb42d2471992bf5d524628fdd6/&lt;/a&gt;&lt;br/&gt;
 Hello,&lt;br/&gt;
Our code analyses found the following potential NPE:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Path getParent() {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path = uri.getPath();
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; lastSlash = path.lastIndexOf(&lt;span class=&quot;code-quote&quot;&gt;&apos;/&apos;&lt;/span&gt;);
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; start = startPositionWithoutWindowsDrive(path);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((path.length() == start) ||               &lt;span class=&quot;code-comment&quot;&gt;// empty path
&lt;/span&gt;        (lastSlash == start &amp;amp;&amp;amp; path.length() == start+1)) { &lt;span class=&quot;code-comment&quot;&gt;// at root
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; FSDataOutputStream createInternal (Path f,
      EnumSet&amp;lt;CreateFlag&amp;gt; flag, FsPermission absolutePermission, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; bufferSize,
      &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt; replication, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; blockSize, Progressable progress,
      ChecksumOpt checksumOpt, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; createParent) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    checkPath(f);
    
    &lt;span class=&quot;code-comment&quot;&gt;// Default impl assumes that permissions &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not matter
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// calling the regular create is good enough.
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// FSs that implement permissions should override &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!createParent) { // parent must exist.
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// since &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.create makes parent dirs automatically
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// we must &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; exception &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; parent does not exist.
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileStatus stat = getFileStatus(f.getParent()); &lt;span class=&quot;code-comment&quot;&gt;// NPE!
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stat == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileNotFoundException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Missing parent:&quot;&lt;/span&gt; + f);
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Full Trace:&lt;/p&gt;

&lt;p&gt;1. Return null to caller&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hadoop/blob/f40e3eb0590f85bb42d2471992bf5d524628fdd6/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/Path.java#L432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/f40e3eb0590f85bb42d2471992bf5d524628fdd6/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/Path.java#L432&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2. The return value of function getParent is used as the 1st parameter in function getFileStatus (the return value of function getParent can be null)&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hadoop/blob/f40e3eb0590f85bb42d2471992bf5d524628fdd6/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/DelegateToFileSystem.java#L93&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/f40e3eb0590f85bb42d2471992bf5d524628fdd6/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/DelegateToFileSystem.java#L93&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;3. f is used as the 1st parameter in function checkPath (f can be null)&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hadoop/blob/f40e3eb0590f85bb42d2471992bf5d524628fdd6/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/DelegateToFileSystem.java#L127&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/f40e3eb0590f85bb42d2471992bf5d524628fdd6/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/DelegateToFileSystem.java#L127&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;4. path is passed as the this pointer to function toUri (path can be null)&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hadoop/blob/f40e3eb0590f85bb42d2471992bf5d524628fdd6/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/AbstractFileSystem.java#L369&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/f40e3eb0590f85bb42d2471992bf5d524628fdd6/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/AbstractFileSystem.java#L369&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Commit: f40e3eb0590f85bb42d2471992bf5d524628fdd6&lt;/p&gt;</description>
                <environment></environment>
        <key id="13377549">HADOOP-17689</key>
            <summary>Avoid Potential NPE in org.apache.hadoop.fs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vjasani">Viraj Jasani</assignee>
                                    <reporter username="ErrReporter">Error Reporter</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 10 May 2021 03:48:33 +0000</created>
                <updated>Sat, 27 Jan 2024 06:01:51 +0000</updated>
                            <resolved>Wed, 12 May 2021 15:06:51 +0000</resolved>
                                    <version>3.4.0</version>
                                    <fixVersion>3.4.0</fixVersion>
                                    <component>fs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17341665" author="vjasani" created="Mon, 10 May 2021 05:01:18 +0000"  >&lt;p&gt;This is similar to&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17689&quot; title=&quot;Avoid Potential NPE in org.apache.hadoop.fs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17689&quot;&gt;&lt;del&gt;HADOOP-17689&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17343194" author="vjasani" created="Wed, 12 May 2021 11:53:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tasanuma&quot; class=&quot;user-hover&quot; rel=&quot;tasanuma&quot;&gt;tasanuma&lt;/a&gt;&#160;This is also relevant and small fix. Would you like to take a look &lt;a href=&quot;https://github.com/apache/hadoop/pull/3008&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/3008&lt;/a&gt;&#160;?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="17343301" author="vjasani" created="Wed, 12 May 2021 15:08:23 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tasanuma&quot; class=&quot;user-hover&quot; rel=&quot;tasanuma&quot;&gt;tasanuma&lt;/a&gt;&#160;for your quick review. I was wondering if we can deprecate old method i.e&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
 * Returns the parent of a path or &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; at root. Better alternative is
 * {@link #getOptionalParentPath()} to handle nullable value &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; root path.
 *
 * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the parent of a path or &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; at root
 */
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Path getParent() {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getParentUtil();
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If you agree to deprecate this method, I can provide an addendum PR?&lt;/p&gt;</comment>
                            <comment id="17345674" author="quanli" created="Sun, 16 May 2021 10:44:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tasanuma&quot; class=&quot;user-hover&quot; rel=&quot;tasanuma&quot;&gt;tasanuma&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vjasani&quot; class=&quot;user-hover&quot; rel=&quot;vjasani&quot;&gt;vjasani&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;can you share a unit test to reproduce this? This in general doesn&apos;t seems can happen, right in that it will just be a waste of cpu cycle. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aajisaka&quot; class=&quot;user-hover&quot; rel=&quot;aajisaka&quot;&gt;aajisaka&lt;/a&gt; saw your name in the file from git, can you help on how to reproduce this and &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17689&quot; title=&quot;Avoid Potential NPE in org.apache.hadoop.fs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17689&quot;&gt;&lt;del&gt;HADOOP-17689&lt;/del&gt;&lt;/a&gt;. Are unit test not mandatory required also for npe&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17346257" author="tasanuma0829" created="Mon, 17 May 2021 16:36:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vjasani&quot; class=&quot;user-hover&quot; rel=&quot;vjasani&quot;&gt;vjasani&lt;/a&gt;&#160;Sorry I overlooked your last comment.&#160;Since the old API is a little more efficient in terms of CPU and memory cost, it may be good as it is.&lt;/p&gt;</comment>
                            <comment id="17346262" author="tasanuma0829" created="Mon, 17 May 2021 16:47:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=quanli&quot; class=&quot;user-hover&quot; rel=&quot;quanli&quot;&gt;quanli&lt;/a&gt; I&apos;m not sure whether it actually happens or not, but there is a&#160;possibility of NPE there. The following test reproduces it.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-comment&quot;&gt;// In TestDelegateToFsCheckPath
&lt;/span&gt;  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testNotThrowsNPE() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; URISyntaxException,
      IOException {
    URI uri = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URI(&lt;span class=&quot;code-quote&quot;&gt;&quot;dummy:&lt;span class=&quot;code-comment&quot;&gt;//dummy-host&quot;&lt;/span&gt;);
&lt;/span&gt;    AbstractFileSystem afs = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DummyDelegateToFileSystem(uri,
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UnOverrideDefaultPortFileSystem());
    assertThrows(FileNotFoundException.class, () -&amp;gt;
        afs.createInternal(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, 1, (&lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt;) 1, 1, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,
            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;));
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unit test is nice to have, but it&apos;s a small fix, so I don&apos;t think it&apos;s required.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 26 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0qvn4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12346894">3.4.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>