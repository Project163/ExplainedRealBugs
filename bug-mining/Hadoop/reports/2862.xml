<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:57:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-18074] Partial/Incomplete groups list can be returned in LDAP groups lookup</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-18074</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;The &#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; doGetGroups(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; user, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; goUpHierarchy) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;method in&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hadoop/blob/b27732c69b114f24358992a5a4d170bc94e2ceaf/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/LdapGroupsMapping.java#L476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/b27732c69b114f24358992a5a4d170bc94e2ceaf/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/security/LdapGroupsMapping.java#L476&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looks like having an issue if in the middle of the loop a &lt;b&gt;NamingException&lt;/b&gt; is caught:&lt;/p&gt;

&lt;p&gt;The groups variable is not reset in the catch clause and therefore the fallback lookup cannot be executed (when goUpHierarchy==0 at least):&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (groups.isEmpty() || goUpHierarchy &amp;gt; 0) {        
    groups = lookupGroup(result, c, goUpHierarchy);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Consequence is that only a partial list of groups is returned, which is not correct.&lt;/p&gt;

&lt;p&gt;Following options could be used as solution:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Reset the group to an empty list in the catch clause, to trigger the fallback query.&lt;/li&gt;
	&lt;li&gt;Add an option flag to enable ignoring groups with Naming Exception (since they are not groups most probably)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Independently, would any issue also occur (and therefore full list cannot be returned) in the first lookup as well as in the fallback query, the method should/could(with option flag) throw an Exception, because in some scenario accuracy is important.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13421662">HADOOP-18074</key>
            <summary>Partial/Incomplete groups list can be returned in LDAP groups lookup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lmccay">Larry McCay</assignee>
                                    <reporter username="planoe">Philippe Lanoe</reporter>
                        <labels>
                            <label>Reviewed</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 10 Jan 2022 10:30:50 +0000</created>
                <updated>Sun, 17 Jul 2022 16:07:45 +0000</updated>
                            <resolved>Thu, 14 Jul 2022 12:54:52 +0000</resolved>
                                                    <fixVersion>3.4.0</fixVersion>
                    <fixVersion>3.3.4</fixVersion>
                                    <component>security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="14400">4h</timespent>
                                <comments>
                            <comment id="17472156" author="lmccay" created="Mon, 10 Jan 2022 16:49:48 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=planoe&quot; class=&quot;user-hover&quot; rel=&quot;planoe&quot;&gt;planoe&lt;/a&gt; - do you plan to submit a PR for this change?&lt;br/&gt;
I do think we likely need to preserve existing behavior for anyone depending on it - so making it configuration driven makes sense.&lt;/p&gt;</comment>
                            <comment id="17556554" author="lmccay" created="Mon, 20 Jun 2022 21:32:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt; - I&apos;d like to get this into 3.3.4 - if at all possible.&lt;br/&gt;
Any thoughts?&lt;/p&gt;</comment>
                            <comment id="17556791" author="stevel@apache.org" created="Tue, 21 Jun 2022 10:14:23 +0000"  >&lt;ol&gt;
	&lt;li&gt;is it critical for: data preservation, integration with other apps?&lt;/li&gt;
	&lt;li&gt;security risk&lt;/li&gt;
	&lt;li&gt;is the patch considered stable?&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;i want to get the release kicked off this week as i am away next; already deadline is at risk because of that javax.ws shading thing that i believe hive needs. &lt;/p&gt;</comment>
                            <comment id="17557064" author="lmccay" created="Tue, 21 Jun 2022 18:58:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt; - I do believe there is a security issue here actually.&lt;br/&gt;
It would not be a regression and requires certain conditions to be surfaced.&lt;/p&gt;

&lt;p&gt;We can discuss on the security list if you like.&lt;/p&gt;
</comment>
                            <comment id="17557073" author="stevel@apache.org" created="Tue, 21 Jun 2022 19:20:51 +0000"  >&lt;p&gt;ok, target the release. &lt;/p&gt;</comment>
                            <comment id="17557139" author="lmccay" created="Tue, 21 Jun 2022 21:36:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt; - I&apos;ve set Target Version to 3.3.4 - we can obviously revisit that if need be.&lt;/p&gt;</comment>
                            <comment id="17558441" author="stevel@apache.org" created="Fri, 24 Jun 2022 11:17:38 +0000"  >&lt;p&gt;ok. where does that method get called btw? client side, or server side only?&lt;/p&gt;</comment>
                            <comment id="17558790" author="lmccay" created="Sat, 25 Jun 2022 15:16:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt; - being that this is a common utility for group lookup it can be called from anywhere that groups are required for a given user.&lt;br/&gt;
Generally, this is a need by servers that are authorizing access to some resource that they may serve.&lt;br/&gt;
This does not mean that there aren&apos;t client applications that intend to enumerate the groups for a given user though.&lt;/p&gt;

&lt;p&gt;I suspect that this is an obvious statement so if it doesn&apos;t answer your question please let me know. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17558804" author="lmccay" created="Sat, 25 Jun 2022 17:22:44 +0000"  >&lt;p&gt;There appears to be a couple problems in this code actually.&lt;br/&gt;
I am thinking that we just surgically address the original intent which was for a NamingException while processing the memberOf list to result in a secondary query rather than a partial list.&lt;/p&gt;

&lt;p&gt;I&apos;ll try and add test coverage for the fallback which is currently missing even though there is clear intent in the code based on comments.&lt;/p&gt;

&lt;p&gt;There are other possible issues here that will require further investigation:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;it seems that retries will attempt and process the memberOf list each time which will never be different&lt;/li&gt;
	&lt;li&gt;perhaps there are filtering opportunities based on object type or the like before the attempting to acquiring the RDN for a DN that would be able to distinguish between actual group names and invalid DNs&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="17558811" author="lmccay" created="Sat, 25 Jun 2022 18:10:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hadoop/pull/4503&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/4503&lt;/a&gt; created.&lt;/p&gt;</comment>
                            <comment id="17565107" author="lmccay" created="Mon, 11 Jul 2022 17:20:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt; - I have addressed your review comments and committed this to trunk.&lt;br/&gt;
I then realized that we should have gotten the Reviewed flag set on this JIRA first.&lt;br/&gt;
I&apos;d like to cherry-pick this to branch-3.3 as you indicated a +1 for trunk/branch-3.3 but not sure whether I should revert this and await the Reviewed flag or proceed with that cherry-pick. Thoughts?&lt;/p&gt;</comment>
                            <comment id="17565121" author="ayushtkn" created="Mon, 11 Jul 2022 17:46:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;I then realized that we should have gotten the Reviewed flag set on this JIRA first.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lmccay&quot; class=&quot;user-hover&quot; rel=&quot;lmccay&quot;&gt;lmccay&lt;/a&gt; You mean to say the &lt;b&gt;Hadoop Flags: Reviewed&lt;/b&gt; label in the Jira?&lt;br/&gt;
Then you are a committer, Once you commit it post getting binding +1 to trunk and cherry-pick to relevant branches, set that Flag. Has something changed with the Flag, or are you talking about something different&lt;/p&gt;</comment>
                            <comment id="17565128" author="lmccay" created="Mon, 11 Jul 2022 18:07:00 +0000"  >&lt;p&gt;Oh, okay, I can do it then. The contribution page seemed to indicate it&lt;br/&gt;
should be done by the reviewer.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;

</comment>
                            <comment id="17565131" author="stevel@apache.org" created="Mon, 11 Jul 2022 18:08:17 +0000"  >&lt;p&gt;you got a +1 in the PR from me, all you needed. have you CP&apos;d to branch-3? you can do that without any need for review/approval again. sometimes i do it locally, sometimes i go via github again just for yetus test runs&lt;/p&gt;</comment>
                            <comment id="17565139" author="lmccay" created="Mon, 11 Jul 2022 18:27:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt; - I haven&apos;t done the CP yet, wanted to make sure I understood the process here.&lt;br/&gt;
I plan to do it via github with a new PR with a &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-1807&quot; title=&quot;DfsTask lacks unit tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-1807&quot;&gt;&lt;del&gt;HADOOP-1807&lt;/del&gt;&lt;/a&gt;-branch-3.3 branch name - in order to get the full set of precommits green.&lt;/p&gt;</comment>
                            <comment id="17567681" author="stevel@apache.org" created="Sun, 17 Jul 2022 16:07:45 +0000"  >&lt;p&gt;ok, all is good. merged to 3.3. and 3.3.4; kicking off the 3.3.4 buiild now&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="13451378">HADOOP-18305</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 17 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0yewo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12351867">3.3.4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>