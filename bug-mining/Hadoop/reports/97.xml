<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:32:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-6609] Deadlock in DFSClient#getBlockLocations even with the security disabled</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-6609</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;Here is the stack trace:&lt;br/&gt;
&quot;IPC Client (47) connection to XX&quot; daemon&lt;br/&gt;
prio=10 tid=0x00002aaae0369c00 nid=0x655b waiting for monitor entry &lt;span class=&quot;error&quot;&gt;&amp;#91;0x000000004181f000..0x000000004181fb80&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: BLOCKED (on object monitor)&lt;br/&gt;
at org.apache.hadoop.io.UTF8.readChars(UTF8.java:210)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x00002aaab3eaee50&amp;gt; (a org.apache.hadoop.io.DataOutputBuffer)&lt;br/&gt;
at org.apache.hadoop.io.UTF8.readString(UTF8.java:203)&lt;br/&gt;
at org.apache.hadoop.io.ObjectWritable.readObject(ObjectWritable.java:179)&lt;br/&gt;
at org.apache.hadoop.io.ObjectWritable.readFields(ObjectWritable.java:66)&lt;br/&gt;
at org.apache.hadoop.ipc.Client$Connection.receiveResponse(Client.java:638)&lt;br/&gt;
at org.apache.hadoop.ipc.Client$Connection.run(Client.java:573)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;IPC Client (47) connection to /0.0.0.0:50030 from job_201002262308_0007&quot;&lt;br/&gt;
daemon prio=10 tid=0x00002aaae0272800 nid=0x6556 waiting for monitor entry &lt;span class=&quot;error&quot;&gt;&amp;#91;0x000000004131a000..0x000000004131ad00&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: BLOCKED (on object monitor)&lt;br/&gt;
at org.apache.hadoop.io.UTF8.readChars(UTF8.java:210) &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x00002aaab3eaee50&amp;gt; (a org.apache.hadoop.io.DataOutputBuffer)&lt;br/&gt;
at org.apache.hadoop.io.UTF8.readString(UTF8.java:203)&lt;br/&gt;
at org.apache.hadoop.io.ObjectWritable.readObject(ObjectWritable.java:179)&lt;br/&gt;
at org.apache.hadoop.io.ObjectWritable.readFields(ObjectWritable.java:66)&lt;br/&gt;
at org.apache.hadoop.ipc.Client$Connection.receiveResponse(Client.java:638)&lt;br/&gt;
at org.apache.hadoop.ipc.Client$Connection.run(Client.java:573)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;main&quot; prio=10 tid=0x0000000046c17800 nid=0x6544 in Object.wait() &lt;span class=&quot;error&quot;&gt;&amp;#91;0x0000000040207000..0x0000000040209ec0&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: WAITING (on object monitor)&lt;br/&gt;
at java.lang.Object.wait(Native Method) &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting on &amp;lt;0x00002aaacee6bc38&amp;gt; (a org.apache.hadoop.ipc.Client$Call)&lt;br/&gt;
at java.lang.Object.wait(Object.java:485)&lt;br/&gt;
at org.apache.hadoop.ipc.Client.call(Client.java:854) - locked &amp;lt;0x00002aaacee6bc38&amp;gt; (a org.apache.hadoop.ipc.Client$Call)&lt;br/&gt;
at org.apache.hadoop.ipc.RPC$Invoker.invoke(RPC.java:223)&lt;br/&gt;
at $Proxy2.getBlockLocations(Unknown Source)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:82)&lt;br/&gt;
at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:59)&lt;br/&gt;
at $Proxy2.getBlockLocations(Unknown Source)&lt;br/&gt;
at org.apache.hadoop.hdfs.DFSClient.callGetBlockLocations(DFSClient.java:333)&lt;br/&gt;
at org.apache.hadoop.hdfs.DFSClient.access$2(DFSClient.java:330)&lt;br/&gt;
at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.getBlockAt(DFSClient.java:1606) &lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x00002aaacecb8258&amp;gt; (a org.apache.hadoop.hdfs.DFSClient$DFSInputStream)&lt;br/&gt;
at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.blockSeekTo(DFSClient.java:1704)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x00002aaacecb8258&amp;gt; (a org.apache.hadoop.hdfs.DFSClient$DFSInputStream)&lt;br/&gt;
at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.read(DFSClient.java:1856)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x00002aaacecb8258&amp;gt; (a org.apache.hadoop.hdfs.DFSClient$DFSInputStream)&lt;br/&gt;
at java.io.DataInputStream.readFully(DataInputStream.java:178)&lt;br/&gt;
at org.apache.hadoop.io.DataOutputBuffer$Buffer.write(DataOutputBuffer.java:63)&lt;br/&gt;
at org.apache.hadoop.io.DataOutputBuffer.write(DataOutputBuffer.java:101)&lt;br/&gt;
at org.apache.hadoop.io.UTF8.readChars(UTF8.java:211)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x00002aaab3eaee50&amp;gt; (a org.apache.hadoop.io.DataOutputBuffer)&lt;br/&gt;
at org.apache.hadoop.io.UTF8.readString(UTF8.java:203)&lt;br/&gt;
at org.apache.hadoop.mapred.FileSplit.readFields(FileSplit.java:90)&lt;br/&gt;
at org.apache.hadoop.io.serializer.WritableSerialization$WritableDeserializer.deserialize(WritableSerialization.java:67)&lt;br/&gt;
at org.apache.hadoop.io.serializer.WritableSerialization$WritableDeserializer.deserialize(WritableSerialization.java:1)&lt;br/&gt;
at org.apache.hadoop.mapred.MapTask.getSplitDetails(MapTask.java:341)&lt;br/&gt;
at org.apache.hadoop.mapred.MapTask.runOldMapper(MapTask.java:357)&lt;br/&gt;
at org.apache.hadoop.mapred.MapTask.run(MapTask.java:317)&lt;br/&gt;
at org.apache.hadoop.mapred.Child$4.run(Child.java:211)&lt;br/&gt;
at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
at javax.security.auth.Subject.doAs(Subject.java:396)&lt;br/&gt;
at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:700)&lt;br/&gt;
at org.apache.hadoop.mapred.Child.main(Child.java:205)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12457927">HADOOP-6609</key>
            <summary>Deadlock in DFSClient#getBlockLocations even with the security disabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="omalley">Owen O&apos;Malley</assignee>
                                    <reporter username="hairong">Hairong Kuang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Mar 2010 00:16:28 +0000</created>
                <updated>Tue, 24 Aug 2010 20:42:19 +0000</updated>
                            <resolved>Thu, 4 Mar 2010 07:21:44 +0000</resolved>
                                                    <fixVersion>0.21.0</fixVersion>
                                    <component>io</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12840399" author="hairong" created="Wed, 3 Mar 2010 00:25:43 +0000"  >&lt;p&gt;The main thread holds the lock to UTF8#OBUF, which is a static field, and waits for the reply. The RPC client needs to acquire the lock to UTF8#OBUF in order to receive the response from the NameNode server. Therefore, deadlock occurs.&lt;/p&gt;

&lt;p&gt;My first question is why use UTF8, which is a deprecated class in Hadoop? If Text is used instead, we won&apos;t get into this deadlock.&lt;/p&gt;</comment>
                            <comment id="12840749" author="cos" created="Wed, 3 Mar 2010 17:38:57 +0000"  >&lt;p&gt;This problem happens on vanilla cluster with the security off, However, the executed code belongs to the secured Hadoop. Thus, I&apos;m changing the title of the JIRA.&lt;/p&gt;</comment>
                            <comment id="12840767" author="owen.omalley" created="Wed, 3 Mar 2010 18:04:12 +0000"  >&lt;p&gt;I propose that we make the OBUF in UTF8 a thread local variable to remove the locking on it.&lt;/p&gt;</comment>
                            <comment id="12840843" author="owen.omalley" created="Wed, 3 Mar 2010 19:59:42 +0000"  >&lt;p&gt;This file changes the locking structure by replacing the static OBUF field in UTF8 with a thread local.&lt;/p&gt;</comment>
                            <comment id="12840915" author="owen.omalley" created="Wed, 3 Mar 2010 22:16:30 +0000"  >&lt;p&gt;This patch is without the prefix.&lt;/p&gt;</comment>
                            <comment id="12840916" author="hadoopqa" created="Wed, 3 Mar 2010 22:17:24 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12437775/c-6609.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12437775/c-6609.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 918624.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/404/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/404/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12840976" author="devaraj" created="Thu, 4 Mar 2010 00:41:50 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12840980" author="owen.omalley" created="Thu, 4 Mar 2010 00:50:25 +0000"  >&lt;p&gt;This is the patch for trunk.&lt;/p&gt;</comment>
                            <comment id="12841031" author="cos" created="Thu, 4 Mar 2010 03:02:14 +0000"  >&lt;p&gt;I have ran the job which used to timeout because of the deadlock a few times and it is running Ok now. All the data is being written properly and correctly.&lt;/p&gt;

&lt;p&gt;Thanks for the fix, Owen.&lt;/p&gt;

&lt;p&gt;+1 on the patch.&lt;/p&gt;</comment>
                            <comment id="12841032" author="cos" created="Thu, 4 Mar 2010 03:02:48 +0000"  >&lt;p&gt;And BTW: I have ran the full test suite to verify the patch - just one specific cluster test.&lt;/p&gt;</comment>
                            <comment id="12841043" author="hadoopqa" created="Thu, 4 Mar 2010 03:31:45 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12437820/c-6609.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12437820/c-6609.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 918624.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/407/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/407/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/407/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/407/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/407/artifact/trunk/build/test/checkstyle-errors.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/407/artifact/trunk/build/test/checkstyle-errors.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/407/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/407/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12841103" author="owen.omalley" created="Thu, 4 Mar 2010 07:21:44 +0000"  >&lt;p&gt;Changing synchronization is impossible to write a unit test for. &lt;b&gt;smile&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;I just committed this.&lt;/p&gt;</comment>
                            <comment id="12841108" author="hudson" created="Thu, 4 Mar 2010 07:30:52 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk-Commit #195 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Common-trunk-Commit/195/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Common-trunk-Commit/195/&lt;/a&gt;)&lt;br/&gt;
    . Fixed deadlock in RPC by replacing shared static &lt;br/&gt;
DataOutputBuffer in the UTF8 class with a thread local variable. (omalley)&lt;/p&gt;</comment>
                            <comment id="12841230" author="hudson" created="Thu, 4 Mar 2010 13:11:54 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk #266 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Common-trunk/266/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Common-trunk/266/&lt;/a&gt;)&lt;br/&gt;
    . Fixed deadlock in RPC by replacing shared static &lt;br/&gt;
DataOutputBuffer in the UTF8 class with a thread local variable. (omalley)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12437820" name="c-6609.patch" size="3405" author="omalley" created="Thu, 4 Mar 2010 00:50:25 +0000"/>
                            <attachment id="12437803" name="c-6609.patch" size="3565" author="omalley" created="Wed, 3 Mar 2010 22:16:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37120</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02r5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14001</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>