<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:45:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-10759] Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-10759</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;In hadoop-common-project/hadoop-common/src/main/bin/hadoop-config.sh, there is a hard code for Java parameter: &apos;JAVA_HEAP_MAX=-Xmx1000m&apos;. It should be removed.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux64&lt;/p&gt;</environment>
        <key id="12724032">HADOOP-10759</key>
            <summary>Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sam liu">sam liu</assignee>
                                    <reporter username="sam liu">sam liu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Jun 2014 01:26:15 +0000</created>
                <updated>Sat, 12 Sep 2015 19:22:44 +0000</updated>
                            <resolved>Thu, 7 Aug 2014 15:04:51 +0000</resolved>
                                    <version>2.4.0</version>
                                                    <component>bin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14045467" author="hadoopqa" created="Fri, 27 Jun 2014 02:53:01 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12652744/HADOOP-10759.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12652744/HADOOP-10759.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/4183//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/4183//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14047373" author="hadoopqa" created="Mon, 30 Jun 2014 04:53:21 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12653100/HADOOP-10759.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12653100/HADOOP-10759.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/4189//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/4189//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14084960" author="hudson" created="Mon, 4 Aug 2014 17:45:34 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-trunk-Commit #6009 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/6009/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/6009/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10759&quot; title=&quot;Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10759&quot;&gt;&lt;del&gt;HADOOP-10759&lt;/del&gt;&lt;/a&gt;. Remove hardcoded JAVA_HEAP_MAX. (Eric Yang) (eyang: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615700&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/bin/hadoop-config.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14084964" author="eyang" created="Mon, 4 Aug 2014 17:46:49 +0000"  >&lt;p&gt;+1 I just committed this.&lt;/p&gt;</comment>
                            <comment id="14084975" author="hudson" created="Mon, 4 Aug 2014 17:54:46 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-trunk-Commit #6010 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/6010/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/6010/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10759&quot; title=&quot;Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10759&quot;&gt;&lt;del&gt;HADOOP-10759&lt;/del&gt;&lt;/a&gt;. Remove hardcoded JAVA_HEAP_MAX. (Sam Liu via Eric Yang) (eyang: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615707&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615707&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14086090" author="hudson" created="Tue, 5 Aug 2014 10:43:08 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Yarn-trunk #634 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/634/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/634/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10759&quot; title=&quot;Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10759&quot;&gt;&lt;del&gt;HADOOP-10759&lt;/del&gt;&lt;/a&gt;. Remove hardcoded JAVA_HEAP_MAX. (Sam Liu via Eric Yang) (eyang: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615707&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615707&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10759&quot; title=&quot;Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10759&quot;&gt;&lt;del&gt;HADOOP-10759&lt;/del&gt;&lt;/a&gt;. Remove hardcoded JAVA_HEAP_MAX. (Eric Yang) (eyang: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615700&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/bin/hadoop-config.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14086195" author="hudson" created="Tue, 5 Aug 2014 12:32:49 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-trunk #1828 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1828/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1828/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10759&quot; title=&quot;Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10759&quot;&gt;&lt;del&gt;HADOOP-10759&lt;/del&gt;&lt;/a&gt;. Remove hardcoded JAVA_HEAP_MAX. (Sam Liu via Eric Yang) (eyang: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615707&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615707&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10759&quot; title=&quot;Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10759&quot;&gt;&lt;del&gt;HADOOP-10759&lt;/del&gt;&lt;/a&gt;. Remove hardcoded JAVA_HEAP_MAX. (Eric Yang) (eyang: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615700&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/bin/hadoop-config.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14086252" author="hudson" created="Tue, 5 Aug 2014 13:23:35 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk #1853 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1853/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1853/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10759&quot; title=&quot;Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10759&quot;&gt;&lt;del&gt;HADOOP-10759&lt;/del&gt;&lt;/a&gt;. Remove hardcoded JAVA_HEAP_MAX. (Sam Liu via Eric Yang) (eyang: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615707&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615707&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10759&quot; title=&quot;Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10759&quot;&gt;&lt;del&gt;HADOOP-10759&lt;/del&gt;&lt;/a&gt;. Remove hardcoded JAVA_HEAP_MAX. (Eric Yang) (eyang: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1615700&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/bin/hadoop-config.sh&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14086901" author="kkambatl" created="Tue, 5 Aug 2014 22:26:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eyang&quot; class=&quot;user-hover&quot; rel=&quot;eyang&quot;&gt;eyang&lt;/a&gt; - thanks for reviewing and committing this patch. However, we should avoid committing anything short of &quot;Critical&quot; past branch-x. &lt;/p&gt;

&lt;p&gt;Given we are in the middle of RCs for 2.5, I am reverting this from branch-2.5.0 and branch-2.5. &lt;/p&gt;</comment>
                            <comment id="14086934" author="kkambatl" created="Tue, 5 Aug 2014 22:50:39 +0000"  >&lt;p&gt;Updated CHANGES.txt to move it 2.6.0 and also add it at the end of the section instead of the beginning, so we can preserve chronological order. &lt;/p&gt;</comment>
                            <comment id="14086941" author="aw" created="Tue, 5 Aug 2014 22:57:06 +0000"  >&lt;p&gt;BTW, people are aware this removes the default 1000m setting if HADOOP_HEAPSIZE or *_OPT isn&apos;t set in *-env.sh, right?&lt;/p&gt;</comment>
                            <comment id="14086951" author="kkambatl" created="Tue, 5 Aug 2014 23:09:07 +0000"  >&lt;p&gt;Thanks Allen. I was planning to follow up on this after taking care of 2.5.0 branching.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eyang&quot; class=&quot;user-hover&quot; rel=&quot;eyang&quot;&gt;eyang&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sam+liu&quot; class=&quot;user-hover&quot; rel=&quot;sam liu&quot;&gt;sam liu&lt;/a&gt; - is there a particular reason for doing this? &lt;/p&gt;</comment>
                            <comment id="14086959" author="arpitgupta" created="Tue, 5 Aug 2014 23:14:21 +0000"  >&lt;p&gt;Take a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1670&quot; title=&quot;zookeeper should set a default value for SERVER_JVMFLAGS and CLIENT_JVMFLAGS so that memory usage is controlled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1670&quot;&gt;&lt;del&gt;ZOOKEEPER-1670&lt;/del&gt;&lt;/a&gt;. We noticed that if no default heap was provided java can end up taking upto 1/4th of machine mem.&lt;/p&gt;</comment>
                            <comment id="14087006" author="hudson" created="Wed, 6 Aug 2014 00:11:13 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-trunk-Commit #6019 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/6019/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/6019/&lt;/a&gt;)&lt;br/&gt;
Edit CHANGES.txt files to move &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10759&quot; title=&quot;Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10759&quot;&gt;&lt;del&gt;HADOOP-10759&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-6717&quot; title=&quot;Jira HDFS-5804 breaks default nfs-gateway behavior for unsecured config&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-6717&quot;&gt;&lt;del&gt;HDFS-6717&lt;/del&gt;&lt;/a&gt; from 2.5.0 to 2.6.0 (kasha: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1616036&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1616036&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14087330" author="eyang" created="Wed, 6 Aug 2014 06:41:37 +0000"  >&lt;p&gt;The information in &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1670&quot; title=&quot;zookeeper should set a default value for SERVER_JVMFLAGS and CLIENT_JVMFLAGS so that memory usage is controlled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1670&quot;&gt;&lt;del&gt;ZOOKEEPER-1670&lt;/del&gt;&lt;/a&gt; is not entirely accurate.  Java does a good job on calculate initial heap size, and it will use 1/4th of machine memory up to 1GB.  See:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.oracle.com/technetwork/java/javase/gc-tuning-6-140523.html#par_gc.ergonomics.default_size&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.oracle.com/technetwork/java/javase/gc-tuning-6-140523.html#par_gc.ergonomics.default_size&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Therefore, without this being specified, it may use up to 1GB for heap on machine that has greater than 4GB physical memory.  However, for smaller machine such as a virtual machine, it would be nicer if it can scale dynamically.  Another benefit of removing this hard coded value is to make sure that the Hadoop command line is not capped to 1GB for trivial operation such as GetConf, or dfs client operation to reduce memory starvation in executing too many cli operations in parallel to map reduce tasks. We have notice that while the machine may already hand out most memory to map reduce tasks, and some amount of cli command happens in parallel, may trigger excessively allocating memory and causes JVMs to aggressively running garbage collection and increases chances of dead lock in highly fragmented memory pages.  It is somewhat a serious bug that I think it is worth while to be included in 2.x releases.&lt;/p&gt;</comment>
                            <comment id="14087534" author="hudson" created="Wed, 6 Aug 2014 10:59:31 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Yarn-trunk #635 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/635/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/635/&lt;/a&gt;)&lt;br/&gt;
Edit CHANGES.txt files to move &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10759&quot; title=&quot;Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10759&quot;&gt;&lt;del&gt;HADOOP-10759&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-6717&quot; title=&quot;Jira HDFS-5804 breaks default nfs-gateway behavior for unsecured config&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-6717&quot;&gt;&lt;del&gt;HDFS-6717&lt;/del&gt;&lt;/a&gt; from 2.5.0 to 2.6.0 (kasha: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1616036&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1616036&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14087626" author="hudson" created="Wed, 6 Aug 2014 13:02:22 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-trunk #1829 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1829/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1829/&lt;/a&gt;)&lt;br/&gt;
Edit CHANGES.txt files to move &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10759&quot; title=&quot;Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10759&quot;&gt;&lt;del&gt;HADOOP-10759&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-6717&quot; title=&quot;Jira HDFS-5804 breaks default nfs-gateway behavior for unsecured config&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-6717&quot;&gt;&lt;del&gt;HDFS-6717&lt;/del&gt;&lt;/a&gt; from 2.5.0 to 2.6.0 (kasha: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1616036&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1616036&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14087650" author="hudson" created="Wed, 6 Aug 2014 13:25:10 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk #1855 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1855/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1855/&lt;/a&gt;)&lt;br/&gt;
Edit CHANGES.txt files to move &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10759&quot; title=&quot;Remove hardcoded JAVA_HEAP_MAX in hadoop-config.sh&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10759&quot;&gt;&lt;del&gt;HADOOP-10759&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-6717&quot; title=&quot;Jira HDFS-5804 breaks default nfs-gateway behavior for unsecured config&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-6717&quot;&gt;&lt;del&gt;HDFS-6717&lt;/del&gt;&lt;/a&gt; from 2.5.0 to 2.6.0 (kasha: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1616036&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1616036&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-hdfs-project/hadoop-hdfs/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14087798" author="aw" created="Wed, 6 Aug 2014 15:41:34 +0000"  >&lt;p&gt;I&apos;m -1 this going into branch-2.  This is an incompatible change that will break users reliant on the existing behavior.&lt;/p&gt;
</comment>
                            <comment id="14087813" author="aw" created="Wed, 6 Aug 2014 15:52:29 +0000"  >&lt;p&gt;Also, before I forget to mention it, while I can appreciate this feature:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;However, for smaller machine such as a virtual machine, it would be nicer if it can scale dynamically.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The rest of isn&apos;t true.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;it may use up to 1GB for heap on machine that has greater than 4GB physical memory. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;directly contradicts&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Another benefit of removing this hard coded value is to make sure that the Hadoop command line is not capped to 1GB for trivial operation &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If the algorithm as reported in the Oracle documentation is true, removing the default JAVA_HEAP_MAX will &lt;b&gt;still&lt;/b&gt; limit the dynamic value to 1GB max.... thus accomplishing nothing. Additionally, HADOOP_CLIENT_OPTS and HADOOP_HEAPSIZE can both be used to override the 1GB max from the command line.&lt;/p&gt;

&lt;p&gt;One other thing:  JAVA_HEAP_MAX is set in a few more places in the current shell code base (e.g., bin/yarn).  Just removing it from hadoop-config.sh is incomplete.&lt;/p&gt;</comment>
                            <comment id="14088817" author="eyang" created="Thu, 7 Aug 2014 04:26:34 +0000"  >&lt;p&gt;How is removing a hard coded mistake a feature?  This is a defect.  There is no need to run with 1GB heap for trivial command line 90% of the time.  There is no contradiction in my statement, it is quote out of context.  The 1GB max will automatically get applied, if no JAVA_HEAP_MAX is defined.  However, it should not cap cli to 1GB in case if an administrator wants to run cli operation that may require more memory, he can do:&lt;/p&gt;

&lt;p&gt;export JAVA_HEAP_MAX=4096m&lt;/p&gt;

&lt;p&gt;Then run the cli.  distcp and other utilities can directly benefit from this.&lt;/p&gt;

&lt;p&gt;YARN hard code is not described in any part of this JIRA, I did not look at YARN cli that may have the need to remove capped JAVA_HEAP_MAX.  If that is required, it can be filed as another JIRA.&lt;/p&gt;</comment>
                            <comment id="14088843" author="aw" created="Thu, 7 Aug 2014 05:21:24 +0000"  >&lt;p&gt;Defaults are &lt;b&gt;always&lt;/b&gt; hard-coded.  That&apos;s what makes them defaults...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;export JAVA_HEAP_MAX=4096m then run the CLI&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Except this is incorrect usage.  Users should be doing either:&lt;/p&gt;

&lt;p&gt;HADOOP_CLIENT_OPTS=-Xmx (which, granted, results in multiple Xmx settings...) or using the preferred HADOOP_HEAPSIZE=xxx setting.&lt;/p&gt;

&lt;p&gt;You&apos;ll note that the lines below the removed one overrides JAVA_HEAP_MAX by the setting of HADOOP_HEAPSIZE...&lt;/p&gt;

&lt;p&gt;For all intents and purposes, JAVA_HEAP_MAX isn&apos;t really meant to be set by users in Hadoop 2.x and previous releases.  It&apos;s an &lt;b&gt;internal&lt;/b&gt; environment variable.  The big tip off is that it doesn&apos;t begin with HADOOP_ .&lt;/p&gt;</comment>
                            <comment id="14088851" author="aw" created="Thu, 7 Aug 2014 05:28:00 +0000"  >&lt;p&gt;BTW, just so folks don&apos;t have look it up, this is what hadoop-env.sh says:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# The maximum amount of heap to use, in MB. Default is 1000.
#export HADOOP_HEAPSIZE=
#export HADOOP_NAMENODE_INIT_HEAPSIZE=&quot;&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Removing the JAVA_HEAP_MAX &lt;b&gt;breaks&lt;/b&gt; that default.  There is also &lt;b&gt;no&lt;/b&gt; mention of  JAVA_HEAP_MAX in anything user facing in the source. HADOOP_HEAPSIZE, of course, is defined right up there.&lt;/p&gt;</comment>
                            <comment id="14088919" author="eyang" created="Thu, 7 Aug 2014 06:50:51 +0000"  >&lt;p&gt;Allen, you are correct in picking on my latest statement.  I meant to say that HEAP can override it with HADOOP_HEAPSIZE in either hadoop-env.sh or from environment when hadoop-env.sh does not explicitly define it in running environment.  However, the hard code value is unnecessary since JDK already cap to 1GB by default, if user&apos;s machine has more than 4GB.  For smaller machines, it is better that we don&apos;t use the hard coded cap but let Java decide the right value for it.&lt;/p&gt;</comment>
                            <comment id="14089191" author="aw" created="Thu, 7 Aug 2014 13:00:19 +0000"  >&lt;p&gt;As I said before, I agree that it&apos;s a better behavior. But it&apos;s still a feature, not a bug fix, and it&apos;s still incompatible with the existing expectations of the system.  It breaks the principal of least surprise.... so I&apos;m still -1 for branch-2.&lt;/p&gt;

&lt;p&gt;For trunk, this patch is very much incomplete if we want to change how this works:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;All hard-coded values to JAVA_HEAP_MAX need to be found and removed (hadoop-config.sh, yarn, yarn-env.sh)&lt;/li&gt;
	&lt;li&gt;The content in hadoop-env.sh needs to get rewritten&lt;/li&gt;
	&lt;li&gt;The content in yarn-env.sh needs to get rewritten (and a good chunk removed) ... oh yarn, you make our lives so hard by doing the wrong thing 90% of the time... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  On the plus side, it perfectly demonstrates my point about the confusion with having two vars that do the same thing....&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So even with this change, JAVA_HEAP_MAX really shouldn&apos;t be exposed to users.  It&apos;s a terrible variable name (there is no JAVA_HEAP_MIN which sets Xms, for example).  It also doesn&apos;t begin with HADOOP_ which means it could conflict with other software.&lt;/p&gt;

&lt;p&gt;HADOOP_HEAPSIZE has really awful semantics (forced into m&apos;s) and one really should be able to specify your own unit.  But my concern is that it might be &quot;too late&quot; to fix it unless we&apos;re very willing to break the universe.  That would probably be a common-dev@ level decision.  (My own vote would be yes, let&apos;s break users on this one, because everyone I&apos;ve ever talked to hates the semantics here too.)&lt;/p&gt;</comment>
                            <comment id="14089314" author="aw" created="Thu, 7 Aug 2014 15:03:45 +0000"  >&lt;p&gt;After a bit more thinking about this idea, I have a proposal to make that I think will accomplish the ultimate goal of this JIRA while also giving the users much more control than they have now (a win-win):&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;We introduce HADOOP_HEAPSIZE_MAX and HADOOP_HEAPSIZE_MIN, both default to empty.  They will set the Xmx and Xms values, respectively.  Both require units to be provided, such that e.g. HADOOP_HEAPSIZE_MAX=&quot;10g&quot; is valid.&lt;/li&gt;
	&lt;li&gt;We deprecate HADOOP_HEAPSIZE and JAVA_HEAP_MAX and completely remove them from the hadoop-env.sh, etc. documentation.  The code should honor them if set (thereby providing backwards compatibility), but the HADOOP_HEAPSIZE_xyz vars take precedence in case of a conflict.&lt;/li&gt;
	&lt;li&gt;I&apos;m willing to do this work as either part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-9902&quot; title=&quot;Shell script rewrite&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-9902&quot;&gt;&lt;del&gt;HADOOP-9902&lt;/del&gt;&lt;/a&gt; (which rewrites all of this code anyway) or as part of the series of follow-on patches to that change, depending upon the review for 9902.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="14089316" author="eyang" created="Thu, 7 Aug 2014 15:04:51 +0000"  >&lt;p&gt;Allen, this JIRA is filed for Hadoop Common, YARN problems can be addressed in YARN JIRA.  The hard coded value was introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-5212&quot; title=&quot;cygwin path translation not happening correctly after Hadoop-4868&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-5212&quot;&gt;&lt;del&gt;HADOOP-5212&lt;/del&gt;&lt;/a&gt;.  Before 0.21, the behavior of JVM heap size control is exactly same as this patch.  It does not look like a new feature if we are just rollback to existing Hadoop behavior in 2009.  We don&apos;t need to spread fear on this patch is going to the universe because it doesn&apos;t.  This has been tested in stress test, and our clusters have been running this patch for almost a year before it was contributed to the community.&lt;/p&gt;</comment>
                            <comment id="14102761" author="chris.douglas" created="Tue, 19 Aug 2014 20:15:00 +0000"  >&lt;p&gt;A veto is valid, even if the code is recently committed. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eyang&quot; class=&quot;user-hover&quot; rel=&quot;eyang&quot;&gt;eyang&lt;/a&gt;, could you please revert the change in branch-2 while this is discussed?&lt;/p&gt;</comment>
                            <comment id="14102767" author="arpitgupta" created="Tue, 19 Aug 2014 20:19:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eyang&quot; class=&quot;user-hover&quot; rel=&quot;eyang&quot;&gt;eyang&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;At least with JDK1.6 we saw zookeeper taking p around 4GB of heap on a 16GB machine thus we filed &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1670&quot; title=&quot;zookeeper should set a default value for SERVER_JVMFLAGS and CLIENT_JVMFLAGS so that memory usage is controlled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1670&quot;&gt;&lt;del&gt;ZOOKEEPER-1670&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14106581" author="chris.douglas" created="Fri, 22 Aug 2014 07:18:27 +0000"  >&lt;p&gt;I reverted this from branch-2&lt;/p&gt;</comment>
                            <comment id="14129494" author="aw" created="Thu, 11 Sep 2014 01:42:49 +0000"  >&lt;p&gt;Removed the fix version since this was reverted.&lt;/p&gt;

&lt;p&gt;Additionally, the trunk, post-9902 version of this is part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10950&quot; title=&quot;rework  heap management  vars&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10950&quot;&gt;&lt;del&gt;HADOOP-10950&lt;/del&gt;&lt;/a&gt; .  It likely needs to get rebased though.&lt;/p&gt;</comment>
                            <comment id="14742201" author="aw" created="Sat, 12 Sep 2015 19:22:44 +0000"  >&lt;p&gt;---^^ this was reverted, so this wasn&apos;t fixed in branch-2.  It was replaced by similar code in another JIRA for trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12653100" name="HADOOP-10759.patch" size="544" author="sam liu" created="Mon, 30 Jun 2014 04:50:42 +0000"/>
                            <attachment id="12652744" name="HADOOP-10759.patch" size="373" author="sam liu" created="Fri, 27 Jun 2014 02:41:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>402217</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 10 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1x8b3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>402281</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>