<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:56:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-17130] Configuration.getValByRegex() shouldn&apos;t update the results while fetching.</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-17130</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;We have seen this stacktrace while using ABFS file system. After analysing the stack trace we can see that getValByRegex() is reading the properties and substituting the value in the same call. This may cause the&#160;ConcurrentModificationException.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.util.concurrent.ExecutionException: java.util.ConcurrentModificationException at java.util.concurrent.FutureTask.report(FutureTask.java:122) at java.util.concurrent.FutureTask.get(FutureTask.java:192) at org.apache.hadoop.hive.ql.io.orc.OrcInputFormat.generateSplitsInfo(OrcInputFormat.java:1877) ... 18 more Caused by: java.util.ConcurrentModificationException at java.util.Hashtable$Enumerator.next(Hashtable.java:1387) at org.apache.hadoop.conf.Configuration.getValByRegex(Configuration.java:3855) at org.apache.hadoop.fs.azurebfs.AbfsConfiguration.validateStorageAccountKeys(AbfsConfiguration.java:689) at org.apache.hadoop.fs.azurebfs.AbfsConfiguration.&amp;lt;init&amp;gt;(AbfsConfiguration.java:237) at org.apache.hadoop.fs.azurebfs.AzureBlobFileSystemStore.&amp;lt;init&amp;gt;(AzureBlobFileSystemStore.java:154) at org.apache.hadoop.fs.azurebfs.AzureBlobFileSystem.initialize(AzureBlobFileSystem.java:113) at org.apache.hadoop.fs.FileSystem.createFileSystem(FileSystem.java:3396) at org.apache.hadoop.fs.FileSystem.access$200(FileSystem.java:158) at org.apache.hadoop.fs.FileSystem$Cache.getInternal(FileSystem.java:3456) at org.apache.hadoop.fs.FileSystem$Cache.get(FileSystem.java:3424) at org.apache.hadoop.fs.FileSystem.get(FileSystem.java:518) at org.apache.hadoop.fs.Path.getFileSystem(Path.java:361)
&#160;


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13316920">HADOOP-17130</key>
            <summary>Configuration.getValByRegex() shouldn&apos;t update the results while fetching.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mukund-thakur">Mukund Thakur</assignee>
                                    <reporter username="mukund-thakur">Mukund Thakur</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jul 2020 12:39:36 +0000</created>
                <updated>Thu, 10 Jun 2021 07:57:03 +0000</updated>
                            <resolved>Fri, 17 Jul 2020 09:42:01 +0000</resolved>
                                    <version>3.1.3</version>
                                    <fixVersion>3.2.2</fixVersion>
                    <fixVersion>3.3.1</fixVersion>
                                    <component>common</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17158145" author="mukund-thakur" created="Wed, 15 Jul 2020 13:14:51 +0000"  >&lt;p&gt;Initially we thought the&#160;ConcurrentModificationException might be because of handling deprecations but I couldn&apos;t reproduce this using unit testing.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
Matcher m;

&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(Map.Entry&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; item: getProps().entrySet()) {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (item.getKey() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; &amp;amp;&amp;amp; 
      item.getValue() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) {
    m = p.matcher((&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)item.getKey());
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(m.find()) { &lt;span class=&quot;code-comment&quot;&gt;// match
&lt;/span&gt;      result.put((&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) item.getKey(),
          substituteVars(getProps().getProperty((&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) item.getKey())));
    }
  }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But we still believe that this code subtituteVars() may be updating the props concurrently and it would be a better if we do this substitution later after fetching the list of matching properties.&#160;&lt;/p&gt;

&lt;p&gt;CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17158531" author="stevel@apache.org" created="Wed, 15 Jul 2020 16:55:42 +0000"  >&lt;p&gt;I believe it is in &lt;tt&gt;updatePropertiesWIthDeprecatedKeys()&lt;/tt&gt; because that does update the map&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void updatePropertiesWIthDeprecatedKeys(
      DeprecationContext deprecations, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] newNames) {
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; newName : newNames) {
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; deprecatedKey = deprecations.getReverseDeprecatedKeyMap().get(newName);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (deprecatedKey != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !getProps().containsKey(newName)) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; deprecatedValue = getProps().getProperty(deprecatedKey);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (deprecatedValue != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          getProps().setProperty(newName, deprecatedValue);  &lt;span class=&quot;code-comment&quot;&gt;/* HERE */&lt;/span&gt;
        }
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17159366" author="hudson" created="Thu, 16 Jul 2020 17:24:50 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #18444 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/18444/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/18444/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17130&quot; title=&quot;Configuration.getValByRegex() shouldn&amp;#39;t update the results while fetching.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17130&quot;&gt;&lt;del&gt;HADOOP-17130&lt;/del&gt;&lt;/a&gt;. Configuration.getValByRegex() shouldn&apos;t be updating the (github: rev b21cb91c7f766b4d2920b893f756a0431f925a18)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/conf/Configuration.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17159814" author="stevel@apache.org" created="Fri, 17 Jul 2020 09:42:01 +0000"  >&lt;p&gt;patch backported to all the active 3.x branches&lt;/p&gt;</comment>
                            <comment id="17183259" author="stevel@apache.org" created="Mon, 24 Aug 2020 13:06:02 +0000"  >&lt;p&gt;oops, didn&apos;t push up my 3.2 patch. fixed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0gs7c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12346074">3.1.4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>