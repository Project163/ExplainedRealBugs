<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:55:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-16885] Encryption zone file copy failure leaks temp file ._COPYING_ and wrapped stream</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-16885</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;Copy file into encryption on  trunk with &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-16490&quot; title=&quot;Avoid/handle cached 404s during S3A file creation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-16490&quot;&gt;&lt;del&gt;HADOOP-16490&lt;/del&gt;&lt;/a&gt; caused a leaking temp file &lt;em&gt;COPYING&lt;/em&gt; left and potential wrapped stream unclosed. This ticked is opened to track the fix for it. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13287554">HADOOP-16885</key>
            <summary>Encryption zone file copy failure leaks temp file ._COPYING_ and wrapped stream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xyao">Xiaoyu Yao</assignee>
                                    <reporter username="xyao">Xiaoyu Yao</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Feb 2020 17:27:33 +0000</created>
                <updated>Fri, 13 Mar 2020 19:27:15 +0000</updated>
                            <resolved>Fri, 13 Mar 2020 19:27:15 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17044689" author="xyao" created="Tue, 25 Feb 2020 17:35:32 +0000"  >&lt;p&gt;Repro steps (Thanks Oliv&#233;r D&#243;zsa)&lt;br/&gt;
kinit as hdfs&lt;br/&gt;
Try to copy to encrypted zone directory&lt;br/&gt;
hdfs dfs -cp /tmp/kms_text_file.txt /kms_test/encrypted_dirs/test_dir/kms_text_file.txt&lt;br/&gt;
Observe that user hdfs doesn&apos;t have permission to do decrypt EEK. (as expected)&lt;br/&gt;
On HDP 3.1.5.0-152, the following can be seen:&lt;br/&gt;
     Failed to close file: /kms_test/encrypted_dirs/test_dir/kms_text_file.txt.&lt;em&gt;COPYING&lt;/em&gt; with inode: 18159&lt;br/&gt;
     org.apache.hadoop.ipc.RemoteException(java.io.FileNotFoundException): File does not exist: /kms_test/encrypted_dirs/test_dir/kms_text_file.txt.&lt;em&gt;COPYING&lt;/em&gt; (inode 18159) Holder DFSClient_NONMAPREDUCE_1857410465_1 does not have any open files.&lt;br/&gt;
Execute&lt;/p&gt;

&lt;p&gt;hdfs dfs -ls /kms_test/encrypted_dirs/test_dir/&lt;br/&gt;
and observe there&apos;s &lt;b&gt;no&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;kms_text_file.txt.&lt;em&gt;COPYING&lt;/em&gt;&lt;br/&gt;
file present.&lt;/p&gt;

&lt;p&gt;On HDP 7.1.0.1000-7, no error message can be seen.&lt;br/&gt;
Execute&lt;br/&gt;
hdfs dfs -ls /kms_test/encrypted_dirs/test_dir/&lt;br/&gt;
and observe there&apos;s a&lt;/p&gt;

&lt;p&gt;kms_text_file.txt.&lt;em&gt;COPYING&lt;/em&gt;&lt;br/&gt;
file present.&lt;/p&gt;

&lt;p&gt;kinit as user1 (kinit -k -t /home/hrt_qa/hadoopqa/keytabs/user1.headless.keytab user1)&lt;br/&gt;
Try to copy file to encrypted directory again&lt;br/&gt;
hdfs dfs -cp /tmp/kms_text_file.txt /kms_test/encrypted_dirs/test_dir/kms_text_file.txt&lt;br/&gt;
The following happens:&lt;br/&gt;
On HDP 3.1.5.0-152 it succeeds, no error message is shown.&lt;br/&gt;
On HDP 7.1.0.1000-7 the operation fails with&lt;br/&gt;
cp: Permission denied: user=user1, access=WRITE, inode=&quot;/kms_test/encrypted_dirs/test_dir/kms_text_file.txt.&lt;em&gt;COPYING&lt;/em&gt;&quot;:hdfs:hdfs:&lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-&lt;br/&gt;
Expected behavior&lt;br/&gt;
Step 5. should succeed. No file with&lt;/p&gt;

&lt;p&gt;&lt;em&gt;COPYING&lt;/em&gt;&lt;br/&gt;
suffix should be created when user with no permission tries to copy to a restricted directory.&lt;/p&gt;</comment>
                            <comment id="17044736" author="xyao" created="Tue, 25 Feb 2020 18:49:20 +0000"  >&lt;p&gt;Similar issue exist with WebHdfsHandler#onCreate and RpcProgramNfs3#create, will open separate HDFS JIRAs for the fix. &lt;/p&gt;</comment>
                            <comment id="17044805" author="xyao" created="Tue, 25 Feb 2020 20:17:56 +0000"  >&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=weichiu&quot; class=&quot;user-hover&quot; rel=&quot;weichiu&quot;&gt;weichiu&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17044853" author="jojochuang" created="Tue, 25 Feb 2020 21:02:39 +0000"  >&lt;p&gt;I suspect &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-16062&quot; title=&quot;Improper error handling in WAL Reader/Writer creation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-16062&quot;&gt;&lt;del&gt;HBASE-16062&lt;/del&gt;&lt;/a&gt; is related. IIRC HBase spent a lot of effort dealing with exceptions with opening files.&lt;/p&gt;</comment>
                            <comment id="17049208" author="stevel@apache.org" created="Mon, 2 Mar 2020 13:31:32 +0000"  >&lt;p&gt;fixed -thanks!&lt;/p&gt;</comment>
                            <comment id="17049218" author="hudson" created="Mon, 2 Mar 2020 13:45:29 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #18016 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/18016/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/18016/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-16885&quot; title=&quot;Encryption zone file copy failure leaks temp file ._COPYING_ and wrapped stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-16885&quot;&gt;&lt;del&gt;HADOOP-16885&lt;/del&gt;&lt;/a&gt;. Encryption zone file copy failure leaks a temp file (github: rev 0dd8956f2e4bd7cd2315ef23703e4b2da1a0d073)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/shell/CommandWithDestination.java&lt;/li&gt;
	&lt;li&gt;(edit) hadoop-hdfs-project/hadoop-hdfs-client/src/main/java/org/apache/hadoop/hdfs/DistributedFileSystem.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17050424" author="hudson" created="Tue, 3 Mar 2020 17:42:46 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #18023 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/18023/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/18023/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-16885&quot; title=&quot;Encryption zone file copy failure leaks temp file ._COPYING_ and wrapped stream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-16885&quot;&gt;&lt;del&gt;HADOOP-16885&lt;/del&gt;&lt;/a&gt;. Fix hadoop-commons TestCopy failure (github: rev d0a7c790c62dbb63b4ce6d5cbe77a33376fa67b0)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/shell/TestCopy.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17053519" author="ayushtkn" created="Fri, 6 Mar 2020 15:31:52 +0000"  >&lt;p&gt;FYI&lt;br/&gt;
This seems to have broken, TestEncryptionZones and TestEncryptionZonesWithKMS&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/PreCommit-HDFS-Build/28894/testReport/org.apache.hadoop.hdfs/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HDFS-Build/28894/testReport/org.apache.hadoop.hdfs/&lt;/a&gt;&lt;br/&gt;
Tracking it as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-15212&quot; title=&quot;TestEncryptionZones.testVersionAndSuiteNegotiation fails in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-15212&quot;&gt;&lt;del&gt;HDFS-15212&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17059023" author="jojochuang" created="Fri, 13 Mar 2020 19:27:07 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ayushtkn&quot; class=&quot;user-hover&quot; rel=&quot;ayushtkn&quot;&gt;ayushtkn&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-15212&quot; title=&quot;TestEncryptionZones.testVersionAndSuiteNegotiation fails in trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-15212&quot;&gt;&lt;del&gt;HDFS-15212&lt;/del&gt;&lt;/a&gt; is resolved. So resolve this one as no more work is needed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13290106">HDFS-15212</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13248907">HADOOP-16490</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13260605">HDFS-14892</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13287582">HDFS-15192</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bvjc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>