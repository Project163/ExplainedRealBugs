<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:57:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-18313] AliyunOSS: AliyunOSSBlockOutputStream should not mark the temporary file for deletion</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-18313</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;AliyunOSSBlockOutputStream buffers data in local directory before uploading to OSS. It uses LocalDirAllocator.createTmpFileForWrite which will create a temp file on this directory and invoke&#160;DeleteOnExitHook.add to add the path to a set and will be deleted on VM exit through a shutdown hook. However, the size of set will be growing if the VM does not exit.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13468395">HADOOP-18313</key>
            <summary>AliyunOSS: AliyunOSSBlockOutputStream should not mark the temporary file for deletion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="wujinhu">wujinhu</assignee>
                                    <reporter username="wujinhu">wujinhu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 25 Jun 2022 10:09:01 +0000</created>
                <updated>Thu, 4 Aug 2022 04:04:18 +0000</updated>
                            <resolved>Thu, 4 Aug 2022 04:04:18 +0000</resolved>
                                    <version>2.10.2</version>
                    <version>3.2.4</version>
                    <version>3.3.3</version>
                                                    <component>fs/oss</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17558756" author="stevel@apache.org" created="Sat, 25 Jun 2022 11:33:08 +0000"  >&lt;p&gt;I agree. better to declare the temp dir under the {env.LOCAL} directory points to the YARN dir which is cleaned up when a container is terminated. the good thing there is no matter how the process dies, the files are deleted&lt;/p&gt;</comment>
                            <comment id="17559032" author="wujinhu" created="Mon, 27 Jun 2022 07:09:15 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt;&#160; It&apos;s a good suggestion for our OSS users. Flink users depend on hadoop-aliyun module to write to OSS. Their workers run OOM because workers do not exit. This fix can resolve the issue.&lt;/p&gt;</comment>
                            <comment id="17562107" author="walter.k.su" created="Mon, 4 Jul 2022 09:50:21 +0000"  >&lt;p&gt;It&apos;s used in AliyunOSSFileSystem which is a FileSystem extension. It&apos;s not always runs inside YARN container. I think write temp file under hadoop.tmp.dir is reasonable. S3AFileSystem also writes under hadoop.tmp.dir.&lt;br/&gt;
AliyunOSSBlockOutputStream removes the temp file when close() is called, I think we can remove the shutdown hook.&lt;br/&gt;
+1 LGTM.&lt;/p&gt;</comment>
                            <comment id="17562991" author="walter.k.su" created="Wed, 6 Jul 2022 06:46:39 +0000"  >&lt;p&gt;Thank &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wujinhu&quot; class=&quot;user-hover&quot; rel=&quot;wujinhu&quot;&gt;wujinhu&lt;/a&gt; for contribution and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt; for review.&lt;br/&gt;
Since no further comment, I have merged to trunk and cherry-picked to branch-3.3, branch-3.2, branch-2.10&lt;/p&gt;</comment>
                            <comment id="17563142" author="stevel@apache.org" created="Wed, 6 Jul 2022 10:41:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;It&apos;s not always runs inside YARN container.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree. but in the $(env. } references you can include a fallback. e.g. &lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$(env. LOCAL:$(hadoop.tmp.dir))/oss

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;we do this in our deployments, though we had to fix the fallback to work even when the config was restricted, so oozie wouldn&apos;t fail&lt;/p&gt;</comment>
                            <comment id="17563144" author="stevel@apache.org" created="Wed, 6 Jul 2022 10:42:55 +0000"  >&lt;p&gt;since &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17386&quot; title=&quot;fs.s3a.buffer.dir to be under Yarn container path on yarn applications&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17386&quot;&gt;&lt;del&gt;HADOOP-17386&lt;/del&gt;&lt;/a&gt; we use the local dir in s3a, when in yarn&lt;/p&gt;</comment>
                            <comment id="17570866" author="walter.k.su" created="Mon, 25 Jul 2022 12:24:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;stevel@apache.org&lt;/a&gt; I didn&apos;t see &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17386&quot; title=&quot;fs.s3a.buffer.dir to be under Yarn container path on yarn applications&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17386&quot;&gt;&lt;del&gt;HADOOP-17386&lt;/del&gt;&lt;/a&gt;. It&apos;s great and is a good example for AliyunOSSFileSystem to make similar change. &lt;/p&gt;

&lt;p&gt;OSS doesn&apos;t have default config item in core-default.xml, and should we add one to utilize the fallback logic? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wujinhu&quot; class=&quot;user-hover&quot; rel=&quot;wujinhu&quot;&gt;wujinhu&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17571058" author="stevel@apache.org" created="Mon, 25 Jul 2022 19:03:01 +0000"  >&lt;p&gt;yes, add it&lt;/p&gt;</comment>
                            <comment id="17575013" author="wujinhu" created="Thu, 4 Aug 2022 04:04:03 +0000"  >&lt;p&gt;yes, I will open another issue to add it and close this one, thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13341393">HADOOP-17386</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13370666">HADOOP-17631</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 14 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z16csw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>