<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:36:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-7888] TestFailoverProxy fails intermittently on trunk</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-7888</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;TestFailoverProxy can fail intermittently with the failures occurring in testConcurrentMethodFailures().  The test has a race condition where the two threads may be sequentially invoking the unreliable interface rather than concurrently.  Currently the proxy provider&apos;s getProxy() method contains the thread synchronization to enforce a concurrent invocation, but examining the source to RetryInvocationHandler.invoke() shows that the call to getProxy() during failover is too late to enforce a truly concurrent invocation.&lt;/p&gt;

&lt;p&gt;For this particular test, one thread could race ahead and block on the CountDownLatch in getProxy() before the other thread even enters RetryInvocationHandler.invoke().  If that happens the second thread will cache the newly updated value for proxyProviderFailoverCount, since the failover has mostly been processed by the original thread.  Therefore the second thread ends up assuming no other thread is present, performs a failover, and the test fails because two failovers occurred instead of one.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12534130">HADOOP-7888</key>
            <summary>TestFailoverProxy fails intermittently on trunk</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jlowe">Jason Darrell Lowe</assignee>
                                    <reporter username="jlowe">Jason Darrell Lowe</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Dec 2011 01:54:04 +0000</created>
                <updated>Wed, 23 May 2012 20:15:59 +0000</updated>
                            <resolved>Thu, 8 Dec 2011 01:21:55 +0000</resolved>
                                    <version>0.24.0</version>
                                    <fixVersion>2.0.0-alpha</fixVersion>
                                    <component>test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13164074" author="jlowe" created="Wed, 7 Dec 2011 02:20:28 +0000"  >&lt;p&gt;This patch addresses the race condition by moving the thread synchronization out of FlipFlopProxyProvider and into the method interface being invoked.  All threads will block in the method invocation &lt;b&gt;before&lt;/b&gt; throwing the exception that triggers the failover.  Therefore the failovers will be concurrent wrt. RetryInvocationHandler.invoke() because both threads will always be in invokeMethod() at the same time.&lt;/p&gt;

&lt;p&gt;Speaking of RetryInvocationHandler.invoke(), I also moved the proxyProvider.getProxy() call to occur only when the failover is performed per the previous comment.  It appears this was only moved out of that condition to avoid deadlock when the test thread synchronization was in FlipFlopProxyProvider.getProxy().&lt;/p&gt;</comment>
                            <comment id="13164086" author="hadoopqa" created="Wed, 7 Dec 2011 02:43:10 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12506379/hadoop-7888.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12506379/hadoop-7888.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated 9 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/441//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/441//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/441//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/441//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13164088" author="jlowe" created="Wed, 7 Dec 2011 02:46:37 +0000"  >&lt;p&gt;I believe the -1 javadoc is unrelated to this patch.&lt;/p&gt;</comment>
                            <comment id="13164735" author="atm" created="Wed, 7 Dec 2011 21:42:05 +0000"  >&lt;p&gt;Thanks a lot for tracking down this issue and providing a patch, Jason.&lt;/p&gt;

&lt;p&gt;A question for you about testing - given that this test would only fail intermittently before, have you tried running this test in a loop with and without the patch applied to &lt;b&gt;ensure&lt;/b&gt; that the patch addresses the issue? I believe it should fix it, but just want to make sure. Also, can you comment on the frequency with which you&apos;d observe this spurious test failure without the patch?&lt;/p&gt;

&lt;p&gt;The patch looks good to me. I&apos;ll commit it once Jason comments on the above question.&lt;/p&gt;</comment>
                            <comment id="13164829" author="jlowe" created="Wed, 7 Dec 2011 23:21:13 +0000"  >&lt;p&gt;Before I submitted the patch I stepped through the code with the debugger to make sure I was seeing the two threads synchronizing within the invokeMethod(), so I have high confidence it should address the issue.  RE: failure rate, I was seeing it very intermittently when running the test directly via Eclipse, but then on my machine I can see the issue nearly 100% (e.g.: 34 out of 35 tries) with this build command:&lt;/p&gt;

&lt;p&gt;mvn test -Dtest=TestFailoverProxy&lt;/p&gt;

&lt;p&gt;With the patch I&apos;ve never seen it fail from within Eclipse nor from the build command even when placed in a test loop.&lt;/p&gt;</comment>
                            <comment id="13164901" author="atm" created="Thu, 8 Dec 2011 01:18:39 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Thanks a lot for this info, Jason. I&apos;ll commit the patch momentarily.&lt;/p&gt;</comment>
                            <comment id="13164905" author="atm" created="Thu, 8 Dec 2011 01:21:55 +0000"  >&lt;p&gt;I&apos;ve just committed this to trunk. Thanks a lot, Jason!&lt;/p&gt;</comment>
                            <comment id="13164916" author="hudson" created="Thu, 8 Dec 2011 01:33:46 +0000"  >&lt;p&gt;Integrated in Hadoop-Hdfs-trunk-Commit #1452 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/1452/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Commit/1452/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7888&quot; title=&quot;TestFailoverProxy fails intermittently on trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7888&quot;&gt;&lt;del&gt;HADOOP-7888&lt;/del&gt;&lt;/a&gt;. TestFailoverProxy fails intermittently on trunk. Contributed by Jason Lowe.&lt;/p&gt;

&lt;p&gt;atm : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211728&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/retry/RetryInvocationHandler.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/io/retry/TestFailoverProxy.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13164917" author="hudson" created="Thu, 8 Dec 2011 01:34:47 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk-Commit #1378 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Common-trunk-Commit/1378/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Common-trunk-Commit/1378/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7888&quot; title=&quot;TestFailoverProxy fails intermittently on trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7888&quot;&gt;&lt;del&gt;HADOOP-7888&lt;/del&gt;&lt;/a&gt;. TestFailoverProxy fails intermittently on trunk. Contributed by Jason Lowe.&lt;/p&gt;

&lt;p&gt;atm : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211728&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/retry/RetryInvocationHandler.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/io/retry/TestFailoverProxy.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13164931" author="hudson" created="Thu, 8 Dec 2011 02:08:35 +0000"  >&lt;p&gt;Integrated in Hadoop-Mapreduce-trunk-Commit #1402 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/1402/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Commit/1402/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7888&quot; title=&quot;TestFailoverProxy fails intermittently on trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7888&quot;&gt;&lt;del&gt;HADOOP-7888&lt;/del&gt;&lt;/a&gt;. TestFailoverProxy fails intermittently on trunk. Contributed by Jason Lowe.&lt;/p&gt;

&lt;p&gt;atm : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211728&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/retry/RetryInvocationHandler.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/io/retry/TestFailoverProxy.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13165252" author="hudson" created="Thu, 8 Dec 2011 15:33:00 +0000"  >&lt;p&gt;Integrated in Hadoop-Mapreduce-trunk #921 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/921/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/921/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7888&quot; title=&quot;TestFailoverProxy fails intermittently on trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7888&quot;&gt;&lt;del&gt;HADOOP-7888&lt;/del&gt;&lt;/a&gt;. TestFailoverProxy fails intermittently on trunk. Contributed by Jason Lowe.&lt;/p&gt;

&lt;p&gt;atm : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211728&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/retry/RetryInvocationHandler.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/io/retry/TestFailoverProxy.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13165265" author="hudson" created="Thu, 8 Dec 2011 15:42:56 +0000"  >&lt;p&gt;Integrated in Hadoop-Hdfs-trunk #888 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/888/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/888/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7888&quot; title=&quot;TestFailoverProxy fails intermittently on trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7888&quot;&gt;&lt;del&gt;HADOOP-7888&lt;/del&gt;&lt;/a&gt;. TestFailoverProxy fails intermittently on trunk. Contributed by Jason Lowe.&lt;/p&gt;

&lt;p&gt;atm : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1211728&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/io/retry/RetryInvocationHandler.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/io/retry/TestFailoverProxy.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12506379" name="hadoop-7888.patch" size="5094" author="jlowe" created="Wed, 7 Dec 2011 02:20:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>219852</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i07wbz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>44005</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12320059">0.23.3</customfieldvalue>
    <customfieldvalue id="12317652">0.24.0</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>