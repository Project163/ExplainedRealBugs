<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:44:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-10058] TestMetricsSystemImpl#testInitFirstVerifyStopInvokedImmediately fails on trunk</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-10058</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;Here is the output when I executed &quot;mvn test -Dtest=TestMetricsSystemImpl&quot;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Failed tests: 
  TestMetricsSystemImpl.testInitFirstVerifyStopInvokedImmediately:114 
Wanted at most 2 times but was 3

Tests run: 6, Failures: 1, Errors: 0, Skipped: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I found the test doesn&apos;t always fail. The test sometimes success.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OS 10.8, Java7u40&lt;/p&gt;</environment>
        <key id="12674417">HADOOP-10058</key>
            <summary>TestMetricsSystemImpl#testInitFirstVerifyStopInvokedImmediately fails on trunk</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="airbots">Chen He</assignee>
                                    <reporter username="aajisaka">Akira Ajisaka</reporter>
                        <labels>
                            <label>java7</label>
                    </labels>
                <created>Thu, 17 Oct 2013 22:13:40 +0000</created>
                <updated>Thu, 12 May 2016 18:26:04 +0000</updated>
                            <resolved>Thu, 5 Dec 2013 17:49:01 +0000</resolved>
                                    <version>2.2.0</version>
                    <version>3.0.0-alpha1</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13798523" author="ajisakaa" created="Thu, 17 Oct 2013 22:16:01 +0000"  >&lt;p&gt;Attaching the logs.&lt;/p&gt;</comment>
                            <comment id="13798548" author="ajisakaa" created="Thu, 17 Oct 2013 22:39:38 +0000"  >&lt;p&gt;Attaching the logs when the test doesn&apos;t fail.&lt;/p&gt;</comment>
                            <comment id="13798614" author="ajisakaa" created="Thu, 17 Oct 2013 23:42:20 +0000"  >&lt;p&gt;The test fails at&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-comment&quot;&gt;//When we call stop, at most two sources will be consumed by each sink thread.
&lt;/span&gt;    verify(sink1, atMost(2)).putMetrics(r1.capture());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;IMO, TestSink.putMetrics() is called at most three times because there are three sources to be consumed. The three sources are s0rec, s1rec, and MetricsSystem.&lt;br/&gt;
I change the test code and attach a patch soon.&lt;/p&gt;</comment>
                            <comment id="13798672" author="ajisakaa" created="Fri, 18 Oct 2013 00:42:10 +0000"  >&lt;p&gt;Here is the part of the output of succeeded test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2013-10-17 15:34:03,799 WARN  util.MBeans (MBeans.java:register(65)) - Failed to register MBean &lt;span class=&quot;code-quote&quot;&gt;&quot;Hadoop:service=Test,name=MetricsSystem,sub=Control&quot;&lt;/span&gt;: Instance already exists.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above line is not found in the output of failed test.&lt;br/&gt;
I think failing to register MBean is not good case.&lt;/p&gt;

&lt;p&gt;Therefore, &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-9559&quot; title=&quot;When metrics system is restarted MBean names get incorrectly flagged as dupes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-9559&quot;&gt;&lt;del&gt;HADOOP-9559&lt;/del&gt;&lt;/a&gt; should be resolved before creating a patch for this issue.&lt;/p&gt;</comment>
                            <comment id="13798761" author="ajisakaa" created="Fri, 18 Oct 2013 03:53:19 +0000"  >&lt;p&gt;I tried a patch attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-9959&quot; title=&quot;Shell completion is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-9959&quot;&gt;&lt;del&gt;HADOOP-9959&lt;/del&gt;&lt;/a&gt; and found that the issue is nothing to do with the above WARN message.&lt;br/&gt;
Removing the link.&lt;/p&gt;</comment>
                            <comment id="13839627" author="airbots" created="Thu, 5 Dec 2013 01:00:25 +0000"  >&lt;p&gt;This error is caused by Java 1.7 framework. In Java 1.6, test code are running in sequence. However, in 1.7, it is random order. Some test methods have dependencies. I have fixed this problem. Patch is attached.&lt;/p&gt;</comment>
                            <comment id="13839669" author="hadoopqa" created="Thu, 5 Dec 2013 01:43:22 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12617095/HADOOP-10058.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12617095/HADOOP-10058.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 1 new or modified test files.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 eclipse:eclipse&lt;/font&gt;.  The patch built with eclipse:eclipse.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in hadoop-common-project/hadoop-common.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 contrib tests&lt;/font&gt;.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3334//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3334//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/3334//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/3334//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13840329" author="hudson" created="Thu, 5 Dec 2013 17:46:43 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-trunk-Commit #4838 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/4838/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/4838/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10058&quot; title=&quot;TestMetricsSystemImpl#testInitFirstVerifyStopInvokedImmediately fails on trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10058&quot;&gt;&lt;del&gt;HADOOP-10058&lt;/del&gt;&lt;/a&gt;. TestMetricsSystemImpl#testInitFirstVerifyStopInvokedImmediately fails on trunk (Chen He via jeagles) (jeagles: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548215&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548215&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/impl/TestMetricsSystemImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13840332" author="jeagles" created="Thu, 5 Dec 2013 17:49:50 +0000"  >&lt;p&gt;+1. Thanks, Chen.&lt;/p&gt;</comment>
                            <comment id="13841181" author="hudson" created="Fri, 6 Dec 2013 11:00:40 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Yarn-trunk #413 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Yarn-trunk/413/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Yarn-trunk/413/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10058&quot; title=&quot;TestMetricsSystemImpl#testInitFirstVerifyStopInvokedImmediately fails on trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10058&quot;&gt;&lt;del&gt;HADOOP-10058&lt;/del&gt;&lt;/a&gt;. TestMetricsSystemImpl#testInitFirstVerifyStopInvokedImmediately fails on trunk (Chen He via jeagles) (jeagles: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548215&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548215&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/impl/TestMetricsSystemImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13841248" author="hudson" created="Fri, 6 Dec 2013 13:27:38 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Mapreduce-trunk #1630 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1630/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/1630/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10058&quot; title=&quot;TestMetricsSystemImpl#testInitFirstVerifyStopInvokedImmediately fails on trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10058&quot;&gt;&lt;del&gt;HADOOP-10058&lt;/del&gt;&lt;/a&gt;. TestMetricsSystemImpl#testInitFirstVerifyStopInvokedImmediately fails on trunk (Chen He via jeagles) (jeagles: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548215&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548215&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/impl/TestMetricsSystemImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13841265" author="hudson" created="Fri, 6 Dec 2013 13:41:44 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Hdfs-trunk #1604 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1604/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/1604/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10058&quot; title=&quot;TestMetricsSystemImpl#testInitFirstVerifyStopInvokedImmediately fails on trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10058&quot;&gt;&lt;del&gt;HADOOP-10058&lt;/del&gt;&lt;/a&gt;. TestMetricsSystemImpl#testInitFirstVerifyStopInvokedImmediately fails on trunk (Chen He via jeagles) (jeagles: &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548215&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1548215&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/metrics2/impl/TestMetricsSystemImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12669797">HADOOP-9990</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12674843">HADOOP-10061</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12674863">HADOOP-10062</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12617095" name="HADOOP-10058.patch" size="806" author="airbots" created="Thu, 5 Dec 2013 01:01:51 +0000"/>
                            <attachment id="12609037" name="org.apache.hadoop.metrics2.impl.TestMetricsSystemImpl-output.txt" size="5580" author="aajisaka" created="Thu, 17 Oct 2013 22:16:01 +0000"/>
                            <attachment id="12609046" name="org.apache.hadoop.metrics2.impl.TestMetricsSystemImpl-output_SUCCESS.txt" size="5755" author="aajisaka" created="Thu, 17 Oct 2013 22:39:38 +0000"/>
                            <attachment id="12609038" name="org.apache.hadoop.metrics2.impl.TestMetricsSystemImpl.txt" size="724" author="aajisaka" created="Thu, 17 Oct 2013 22:16:01 +0000"/>
                            <attachment id="12609047" name="org.apache.hadoop.metrics2.impl.TestMetricsSystemImpl_SUCCESS.txt" size="357" author="aajisaka" created="Thu, 17 Oct 2013 22:39:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354039</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 50 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1p1dz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354331</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>