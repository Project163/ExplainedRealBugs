<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:34:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-7172] SecureIO should not check owner on non-secure clusters that have no native support</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-7172</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;The SecureIOUtils.openForRead function currently uses a racy stat/open combo if security is disabled and the native libraries are not available. This ends up shelling out to &quot;ls -ld&quot; which is very very slow. We&apos;ve seen this cause significant performance regressions on clusters that match this profile.&lt;/p&gt;

&lt;p&gt;Since the racy permissions check doesn&apos;t buy us any security anyway, we should just fall back to a normal &quot;open&quot; without any stat() at all, if we can&apos;t use the native support to do it efficiently.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12500731">HADOOP-7172</key>
            <summary>SecureIO should not check owner on non-secure clusters that have no native support</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tlipcon">Todd Lipcon</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Mar 2011 06:56:00 +0000</created>
                <updated>Thu, 2 May 2013 02:29:36 +0000</updated>
                            <resolved>Fri, 22 Apr 2011 16:20:55 +0000</resolved>
                                    <version>0.22.0</version>
                                    <fixVersion>0.22.0</fixVersion>
                    <fixVersion>0.23.0</fixVersion>
                                    <component>io</component>
                    <component>security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13003838" author="tlipcon" created="Tue, 8 Mar 2011 06:57:58 +0000"  >&lt;p&gt;Marking this as depending on &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7115&quot; title=&quot;Add a cache for getpwuid_r and getpwgid_r calls&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7115&quot;&gt;&lt;del&gt;HADOOP-7115&lt;/del&gt;&lt;/a&gt;, since it will conflict with that patch. We may as well do that first and then do this.&lt;/p&gt;</comment>
                            <comment id="13003845" author="tlipcon" created="Tue, 8 Mar 2011 07:34:19 +0000"  >&lt;p&gt;Here&apos;s a patch, but it will end up conflicting once 7115 is committed.&lt;/p&gt;</comment>
                            <comment id="13004050" author="eli" created="Tue, 8 Mar 2011 16:46:36 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Change looks good. Please update the javadoc (&quot;@throws IOException if an IO Error occurred, or the user does not match&quot;) to qualify this for the new behavior.&lt;/p&gt;</comment>
                            <comment id="13004119" author="tlipcon" created="Tue, 8 Mar 2011 18:29:18 +0000"  >&lt;p&gt;After sleeping on this, I had second thoughts about the original way I did the patch. It doesn&apos;t seem good to me that, on an insecure cluster, we have different semantics based on whether the native libraries are available. So, I&apos;ve changed the condition such that the check is always skipped when security is disabled, regardless of presence of the native libs.&lt;/p&gt;

&lt;p&gt;Updated the JavaDoc to indicate that the security check is only done when security is enabled.&lt;/p&gt;</comment>
                            <comment id="13004135" author="tlipcon" created="Tue, 8 Mar 2011 18:50:40 +0000"  >&lt;p&gt;Sorry, forgot to tweak unit tests for the change. This patch should pass both with security on and off&lt;/p&gt;</comment>
                            <comment id="13008833" author="hadoopqa" created="Sat, 19 Mar 2011 21:42:29 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12473024/hadoop-7172.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12473024/hadoop-7172.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1082788.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;    +1 system test framework.  The patch passed system test framework compile.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-HADOOP-Build/312//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-HADOOP-Build/312//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-HADOOP-Build/312//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-HADOOP-Build/312//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-HADOOP-Build/312//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-HADOOP-Build/312//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13021493" author="hadoopqa" created="Tue, 19 Apr 2011 08:52:54 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12473024/hadoop-7172.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12473024/hadoop-7172.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1094750.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;    +1 system test framework.  The patch passed system test framework compile.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-HADOOP-Build/361//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-HADOOP-Build/361//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-HADOOP-Build/361//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-HADOOP-Build/361//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://hudson.apache.org/hudson/job/PreCommit-HADOOP-Build/361//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/PreCommit-HADOOP-Build/361//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13023073" author="tlipcon" created="Fri, 22 Apr 2011 01:43:55 +0000"  >&lt;p&gt;Eli, would you mind taking a look at this updated patch?&lt;/p&gt;</comment>
                            <comment id="13023109" author="eli" created="Fri, 22 Apr 2011 04:38:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;It doesn&apos;t seem good to me that, on an insecure cluster, we have different semantics based on whether the native libraries are available. So, I&apos;ve changed the condition such that the check is always skipped when security is disabled, regardless of presence of the native libs.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nice, I agree. Doesn&apos;t it make sense for createForWrite to get the same treatment?&lt;/p&gt;

&lt;p&gt;I found my brain wanting to rewrite the code as follows, feel free to ignore if you think this is less clear.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;if (shouldBeSecure) {
  return forceSecureOpenForRead(f, expectedOwner, expectedGroup);
}
return new FileInputStream(f);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13023130" author="tlipcon" created="Fri, 22 Apr 2011 06:13:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;Doesn&apos;t it make sense for createForWrite to get the same treatment&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, the reason for this JIRA is that checking permissions is super-expensive, since it shells out to &lt;tt&gt;ls -ld&lt;/tt&gt;. But, for &lt;tt&gt;createForWrite&lt;/tt&gt;, we only have to check &lt;tt&gt;f.exists()&lt;/tt&gt; which is only a syscall, and not too expensive.&lt;/p&gt;

&lt;p&gt;So, I think we may as well keep the behavior we have for createForWrite.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;I found my brain wanting to rewrite the code as follows, feel free to ignore if you think this is less clear.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hm, I could go either way. Since we already have test-patch results, I&apos;d like to just keep it as is if that&apos;s alright.&lt;/p&gt;
</comment>
                            <comment id="13023262" author="eli" created="Fri, 22 Apr 2011 16:19:31 +0000"  >&lt;p&gt;Makes sense.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13023265" author="eli" created="Fri, 22 Apr 2011 16:20:55 +0000"  >&lt;p&gt;I&apos;ve committed this to trunk and 22. Thanks Todd!&lt;/p&gt;</comment>
                            <comment id="13023268" author="hudson" created="Fri, 22 Apr 2011 16:33:22 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk-Commit #562 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Hadoop-Common-trunk-Commit/562/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Hadoop-Common-trunk-Commit/562/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7172&quot; title=&quot;SecureIO should not check owner on non-secure clusters that have no native support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7172&quot;&gt;&lt;del&gt;HADOOP-7172&lt;/del&gt;&lt;/a&gt;. SecureIO should not check owner on non-secure clusters that have no native support. Contributed by Todd Lipcon&lt;/p&gt;</comment>
                            <comment id="13023422" author="hudson" created="Fri, 22 Apr 2011 21:49:19 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-22-branch #41 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Hadoop-Common-22-branch/41/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Hadoop-Common-22-branch/41/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7172&quot; title=&quot;SecureIO should not check owner on non-secure clusters that have no native support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7172&quot;&gt;&lt;del&gt;HADOOP-7172&lt;/del&gt;&lt;/a&gt;. svn merge -c 1095958 from trunk&lt;/p&gt;</comment>
                            <comment id="13023545" author="hudson" created="Sat, 23 Apr 2011 11:12:31 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk #667 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Hadoop-Common-trunk/667/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Hadoop-Common-trunk/667/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7172&quot; title=&quot;SecureIO should not check owner on non-secure clusters that have no native support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7172&quot;&gt;&lt;del&gt;HADOOP-7172&lt;/del&gt;&lt;/a&gt;. SecureIO should not check owner on non-secure clusters that have no native support. Contributed by Todd Lipcon&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12496196">HADOOP-7115</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12473024" name="hadoop-7172.txt" size="3035" author="tlipcon" created="Tue, 8 Mar 2011 18:50:40 +0000"/>
                            <attachment id="12473021" name="hadoop-7172.txt" size="2613" author="tlipcon" created="Tue, 8 Mar 2011 18:29:18 +0000"/>
                            <attachment id="12472920" name="hadoop-7172.txt" size="1818" author="tlipcon" created="Tue, 8 Mar 2011 07:34:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36931</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 31 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02phb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13729</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>