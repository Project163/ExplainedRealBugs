<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:32:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-6640] FileSystem.get() does RPC retries within a static synchronized block</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-6640</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;If using FileSystem.get() in a multithreaded environment, and one get() locks because the NN URI is too slow or not responding and retries are in progress, all other get() (for the diffferent users, NN) are blocked.&lt;/p&gt;

&lt;p&gt;the synchronized block in in the static instance of Cache inner class.&lt;/p&gt;</description>
                <environment>&lt;p&gt;all&lt;/p&gt;</environment>
        <key id="12459452">HADOOP-6640</key>
            <summary>FileSystem.get() does RPC retries within a static synchronized block</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hairong">Hairong Kuang</assignee>
                                    <reporter username="tucu00">Alejandro Abdelnur</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Mar 2010 23:06:36 +0000</created>
                <updated>Mon, 17 Oct 2016 22:27:03 +0000</updated>
                            <resolved>Thu, 1 Apr 2010 21:36:14 +0000</resolved>
                                                    <fixVersion>0.21.0</fixVersion>
                                    <component>fs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="12847478" author="szetszwo" created="Fri, 19 Mar 2010 18:01:24 +0000"  >&lt;p&gt;When FileSystem cache is enabled, FileSystem.get(..) will call FileSystem.Cache.get(..), which is a synchronized method. If the lookup fails, a new instance will be initialized. Depends on the FileSystem subclass implementation, the initialization may take a long time. In such case, the FileSystem.Cache lock will be hold and all calls to FileSystem.get(..) by other threads will be blocked for a long time.&lt;/p&gt;

&lt;p&gt;In particular, the DistributedFileSystem initialization may take a long time since there are retries. It is even worst if the socket timeout is set to a large value.&lt;/p&gt;

&lt;p&gt;There are two possible fixes for the problem:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;(by Sanjay) Change FileSystem.Cache.get(..) so that if the lookup fails, it first releases the lock, initializes a FileSystem instance, acquires the lock again, and then add the instance to the cache.  One problem is that if a user application keeps calling FileSystem.get(..) for the same FileSystem in a short period of time, it will result in initializing many instances.&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Change DistributedFileSystem so that it does a lazy connection: it defers connecting to the server until there is an rpc.  A drawback is that this only fixes DistributedFileSystem but not other FileSystem subclasses.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12851077" author="hairong" created="Mon, 29 Mar 2010 20:29:20 +0000"  >&lt;p&gt;&amp;gt; Change DistributedFileSystem so that it does a lazy connection: it defers connecting to the server until there is an rpc. &lt;br/&gt;
The RPC is issued by the RPC client to verify the version # when creating a RPC proxy. I am not sure if it is a good idea to delay this until there is an application issued RPC. This would require a change to RPC implementation.&lt;/p&gt;</comment>
                            <comment id="12851083" author="szetszwo" created="Mon, 29 Mar 2010 20:46:07 +0000"  >&lt;p&gt;&amp;gt; The RPC is issued by the RPC client to verify the version # when creating a RPC proxy. I am not sure if it is a good idea to delay this until there is an application issued RPC. This would require a change to RPC implementation.&lt;/p&gt;

&lt;p&gt;How about delay the RPC proxy initialization?  i.e. when creating a DistributedFileSystem, it does not create the RPC proxy to Namenode (or even not creating a DFSClient.)&lt;/p&gt;</comment>
                            <comment id="12851085" author="hairong" created="Mon, 29 Mar 2010 20:52:22 +0000"  >&lt;p&gt;Then this means every future RPC call of DFSClient requires a check if a DFSClient has been initialized or not.&lt;/p&gt;</comment>
                            <comment id="12851101" author="szetszwo" created="Mon, 29 Mar 2010 21:18:57 +0000"  >&lt;p&gt;Yes, it needs to check a boolean like the one in DFSClient.checkOpen().&lt;/p&gt;</comment>
                            <comment id="12851116" author="hairong" created="Mon, 29 Mar 2010 21:39:54 +0000"  >&lt;p&gt;This solution will add cost to each rpc call although the cost is insignificant. Base on the discussion so far, will you consider solution 1 (Sanjay&apos;s proposal)? From my point of view, solution 1 is quite straightforward and the concern you have seems very unlikely to happen.&lt;/p&gt;</comment>
                            <comment id="12851120" author="szetszwo" created="Mon, 29 Mar 2010 21:42:05 +0000"  >&lt;p&gt;I have no problem if you want to implement solution 1.  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12852042" author="hairong" created="Wed, 31 Mar 2010 18:47:59 +0000"  >&lt;p&gt;Here is a patch that uses solution 1, together with a unit test. The unit test hangs in the trunk but passes with the fix.&lt;/p&gt;</comment>
                            <comment id="12852112" author="szetszwo" created="Wed, 31 Mar 2010 21:17:19 +0000"  >&lt;p&gt;+1 patch looks good.&lt;/p&gt;</comment>
                            <comment id="12852119" author="szetszwo" created="Wed, 31 Mar 2010 21:27:51 +0000"  >&lt;p&gt;FYI, solution 2 also fix problems like &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-2835&quot; title=&quot;&amp;quot;hadoop fs -help ...&amp;quot; should not require a NameNode to show help messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-2835&quot;&gt;&lt;del&gt;HADOOP-2835&lt;/del&gt;&lt;/a&gt;: &quot;hadoop fs -help ...&quot; should not require a NameNode to show help messages.&lt;/p&gt;</comment>
                            <comment id="12852160" author="hairong" created="Wed, 31 Mar 2010 23:09:43 +0000"  >&lt;p&gt;From my point of view, what&apos;s fundamentally wrong is that version check is performed when a rpc proxy is created. Instead, it should be performed either when a connection to a rpc server is created or whenever a rpc is received at the server side. So neither solution 1 and solution 2 solves the fundamental problem and it does not matter which solution we use. If you insist on using solution 2, I am not against it.&lt;/p&gt;</comment>
                            <comment id="12852167" author="szetszwo" created="Wed, 31 Mar 2010 23:21:28 +0000"  >&lt;p&gt;&amp;gt; ... If you insist on using solution 2, I am not against it.&lt;/p&gt;

&lt;p&gt;For this issue, I am not insist on solution 2 but I do think that solution 2 has its value.  We should implement it when we have bandwidth.&lt;/p&gt;</comment>
                            <comment id="12852301" author="hadoopqa" created="Thu, 1 Apr 2010 09:25:36 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12440376/getFS.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12440376/getFS.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 927979.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 contrib tests.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/438/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/438/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/438/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/438/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle results: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/438/artifact/trunk/build/test/checkstyle-errors.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/438/artifact/trunk/build/test/checkstyle-errors.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/438/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Patch-h4.grid.sp2.yahoo.net/438/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12852549" author="hudson" created="Thu, 1 Apr 2010 21:11:18 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk-Commit #213 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Common-trunk-Commit/213/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Common-trunk-Commit/213/&lt;/a&gt;)&lt;br/&gt;
    . FileSystem.get() does RPC retries within a static synchronized block. Contributed by Hairong Kuang.&lt;/p&gt;</comment>
                            <comment id="12852560" author="hairong" created="Thu, 1 Apr 2010 21:36:14 +0000"  >&lt;p&gt;I&apos;ve just committed this!&lt;/p&gt;</comment>
                            <comment id="12852789" author="hudson" created="Fri, 2 Apr 2010 11:17:48 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk #294 (See &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Hadoop-Common-trunk/294/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Hadoop-Common-trunk/294/&lt;/a&gt;)&lt;br/&gt;
    . FileSystem.get() does RPC retries within a static synchronized block. Contributed by Hairong Kuang.&lt;/p&gt;</comment>
                            <comment id="12864444" author="hairong" created="Wed, 5 May 2010 18:51:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-6691&quot; title=&quot;TestFileSystemCaching sometimes hang&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-6691&quot;&gt;&lt;del&gt;HADOOP-6691&lt;/del&gt;&lt;/a&gt; fixed a bug in the test unit test in the committed patch.&lt;/p&gt;</comment>
                            <comment id="12864468" author="hairong" created="Wed, 5 May 2010 19:44:21 +0000"  >&lt;p&gt;This patch is for Yahoo&apos;s 0.20s branch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12459450">HADOOP-6639</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12461566">HADOOP-6691</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12388725">HADOOP-2835</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13013013">HADOOP-13726</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12440376" name="getFS.patch" size="4320" author="hairong" created="Wed, 31 Mar 2010 18:47:59 +0000"/>
                            <attachment id="12443759" name="getFS_yahoo20s.patch" size="4295" author="hairong" created="Wed, 5 May 2010 19:44:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37043</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 29 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02qjb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13900</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>