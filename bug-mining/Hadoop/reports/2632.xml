<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:56:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-17052] NetUtils.connect() throws unchecked exception (UnresolvedAddressException) causing clients to abort</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-17052</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;Hadoop components are increasingly being deployed on VMs and containers. One aspect of this environment is that DNS is dynamic. Hostname records get modified (or deleted/recreated) as a container in Kubernetes (or even VM) is being created/recreated. In such dynamic environments, the initial DNS resolution request might return resolution failure briefly as DNS client doesn&apos;t always get the latest records. This has been observed in Kubernetes in particular. In such cases&#160;NetUtils.connect() appears to throw&#160;java.nio.channels.UnresolvedAddressException.&#160; In much of Hadoop code (like DFSInputStream and DFSOutputStream), the code is designed to retry IOException. However, since&#160;UnresolvedAddressException is not child of IOException, no retry happens and the code aborts immediately. It is much better if&#160;NetUtils.connect() throws&#160;java.net.UnknownHostException as that is derived from IOException and the code will treat this as a retry-able error.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13307345">HADOOP-17052</key>
            <summary>NetUtils.connect() throws unchecked exception (UnresolvedAddressException) causing clients to abort</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dhegde">Dhiraj Hegde</assignee>
                                    <reporter username="dhegde">Dhiraj Hegde</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 May 2020 06:21:07 +0000</created>
                <updated>Mon, 1 Jun 2020 18:19:32 +0000</updated>
                            <resolved>Mon, 1 Jun 2020 18:19:00 +0000</resolved>
                                    <version>2.10.0</version>
                    <version>2.9.2</version>
                    <version>3.2.1</version>
                    <version>3.1.3</version>
                                    <fixVersion>2.9.3</fixVersion>
                    <fixVersion>3.1.4</fixVersion>
                    <fixVersion>3.2.2</fixVersion>
                    <fixVersion>2.10.1</fixVersion>
                    <fixVersion>3.3.1</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                    <component>net</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17116957" author="hemanthboyina" created="Tue, 26 May 2020 18:27:48 +0000"  >&lt;p&gt;Thanks for reporting &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dhegde&quot; class=&quot;user-hover&quot; rel=&quot;dhegde&quot;&gt;dhegde&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;do you have any stack trace of the exception ?&lt;/p&gt;

&lt;p&gt;An Example : In DataStreamer#createSocketForPipeline we call NetUtils.connect()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; InetSocketAddress isa = NetUtils.createSocketAddr(dnAddr);
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Socket sock = client.socketFactory.createSocket();
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; timeout = client.getDatanodeReadTimeout(length);
NetUtils.connect(sock, isa, client.getRandomLocalInterfaceAddr(),
    conf.getSocketTimeout()); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;we resolve the DN address and calls the NetUtils.connect() , is there any chance of getting reported scenario in this part of code ?&lt;/p&gt;</comment>
                            <comment id="17117006" author="dhegde" created="Tue, 26 May 2020 19:47:54 +0000"  >&lt;p&gt;The code change could be made a level above in places like newConnectedPeer(). My original thought was that &#160;java.net.UnknownHostException might be a better one for NetUtils.connect() to throw and one being thrown right now wasn&apos;t really an intentional decision in connect(). Let me know what you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hemanthboyina&quot; class=&quot;user-hover&quot; rel=&quot;hemanthboyina&quot;&gt;hemanthboyina&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17117246" author="dhegde" created="Wed, 27 May 2020 02:25:38 +0000"  >&lt;p&gt;Some additional stack trace which came from a different callstack:&#160;&#160;&lt;span class=&quot;error&quot;&gt;&amp;#91;^stack_trace2&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17117602" author="hemanthboyina" created="Wed, 27 May 2020 10:02:00 +0000"  >&lt;p&gt;thanks for providing more details&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dhegde&quot; class=&quot;user-hover&quot; rel=&quot;dhegde&quot;&gt;dhegde&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The code change could be made a level above in places like newConnectedPeer()&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;i don&apos;t think this will cover the scenario of Write call&lt;/p&gt;

&lt;p&gt;IMO it will be better to handle in Netutils.connect() by catching the exception and checking if that is an instanceof , and throw the required exception to retry&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aajisaka&quot; class=&quot;user-hover&quot; rel=&quot;aajisaka&quot;&gt;aajisaka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=liuml07&quot; class=&quot;user-hover&quot; rel=&quot;liuml07&quot;&gt;liuml07&lt;/a&gt;&#160;thoughts ?&lt;/p&gt;</comment>
                            <comment id="17119305" author="hemanthboyina" created="Fri, 29 May 2020 06:33:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;In such dynamic environments, the initial DNS resolution request might return resolution failure briefly as DNS client doesn&apos;t always get the latest records.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;the fix might solve the problem&lt;/p&gt;

&lt;p&gt;but in a normal scenario when we expect or get&#160;UnresolvedAddressException , it is not required to retry&#160; , because even with retry we doesn&apos;t solve the unresolved address problem&#160;&lt;/p&gt;</comment>
                            <comment id="17119393" author="liuml07" created="Fri, 29 May 2020 08:29:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dhegde&quot; class=&quot;user-hover&quot; rel=&quot;dhegde&quot;&gt;dhegde&lt;/a&gt; Thanks for reporting and providing a patch.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The two stack trace you posted are both for read. If you have a write pipeline stack (e.g. DataStreamer as mentioned by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hemanthboyina&quot; class=&quot;user-hover&quot; rel=&quot;hemanthboyina&quot;&gt;hemanthboyina&lt;/a&gt;), that will be useful here for reference.&lt;/li&gt;
	&lt;li&gt;The idea you two have figured looks good to me. I have approved the PR. If there is no more objections, I&apos;ll commit it in 3 days. I think it is fine and actually better to retry on one peer in case of generic host unresolvable problem, be it unchecked UnresolvedAddressException or checked UnknownHostException (IOE).&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dhegde&quot; class=&quot;user-hover&quot; rel=&quot;dhegde&quot;&gt;dhegde&lt;/a&gt; It is highly recommended to make the JIRA title and PR subject the same. You can edit either places since they both look good to me.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17119913" author="dhegde" created="Fri, 29 May 2020 20:17:25 +0000"  >&lt;p&gt;Sorry for the confusion on the retry issue, I did not mean DNS needs to be retried, what I meant was all the node retry logic in hdfs client is failing in this situation. Let me clarify the problem here:&lt;/p&gt;

&lt;p&gt;NetUtils.connect() throws this unchecked exception&#160;java.nio.channels.UnresolvedAddressException. This causes the error to bubble up all the way out of the hdfs client. This means that while normally hdfs client code would catch IOException and respond to it by trying a different node, but in this case that process is aborted. By making this unchecked exception to be&#160;&#160;java.net.UnknownHostException we make sure that the hdfs code will catch the exception and work as designed.&#160; When request to one node fails it will catch the exception and try another.&lt;/p&gt;</comment>
                            <comment id="17120053" author="dhegde" created="Sat, 30 May 2020 01:25:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=liuml07&quot; class=&quot;user-hover&quot; rel=&quot;liuml07&quot;&gt;liuml07&lt;/a&gt;&#160;Added the correct stack traces as attachments to this Jira and also modified the PR and Jira so that the titles match.&lt;/p&gt;</comment>
                            <comment id="17120054" author="liuml07" created="Sat, 30 May 2020 01:28:59 +0000"  >&lt;p&gt;Looks great! &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dhegde&quot; class=&quot;user-hover&quot; rel=&quot;dhegde&quot;&gt;dhegde&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="17120411" author="hemanthboyina" created="Sun, 31 May 2020 05:34:02 +0000"  >&lt;p&gt;thanks for the work &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dhegde&quot; class=&quot;user-hover&quot; rel=&quot;dhegde&quot;&gt;dhegde&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;+1 (non-binding)&lt;/p&gt;</comment>
                            <comment id="17121215" author="hudson" created="Mon, 1 Jun 2020 18:06:21 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Hadoop-trunk-Commit #18312 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/18312/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/18312/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-17052&quot; title=&quot;NetUtils.connect() throws unchecked exception (UnresolvedAddressException) causing clients to abort&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-17052&quot;&gt;&lt;del&gt;HADOOP-17052&lt;/del&gt;&lt;/a&gt;. NetUtils.connect() throws unchecked exception (github: rev 9fe4c37c25b256d31202854066eb7e15c6335b9f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/net/NetUtils.java&lt;/li&gt;
	&lt;li&gt;(edit) hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/net/TestNetUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17121226" author="liuml07" created="Mon, 1 Jun 2020 18:19:00 +0000"  >&lt;p&gt;Committed to all fixed versions branches. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dhegde&quot; class=&quot;user-hover&quot; rel=&quot;dhegde&quot;&gt;dhegde&lt;/a&gt; for the reporting and providing a fix; thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hemanthboyina&quot; class=&quot;user-hover&quot; rel=&quot;hemanthboyina&quot;&gt;hemanthboyina&lt;/a&gt; for review.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13004392" name="read_failure.log" size="969" author="dhegde" created="Sat, 30 May 2020 01:15:57 +0000"/>
                            <attachment id="13004390" name="write_failure1.log" size="11354" author="dhegde" created="Sat, 30 May 2020 01:15:33 +0000"/>
                            <attachment id="13004391" name="write_failure2.log" size="2575" author="dhegde" created="Sat, 30 May 2020 01:15:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 24 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0f5gg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12343764">3.3.0</customfieldvalue>
    <customfieldvalue id="12344389">2.9.3</customfieldvalue>
    <customfieldvalue id="12346074">3.1.4</customfieldvalue>
    <customfieldvalue id="12346149">3.2.2</customfieldvalue>
    <customfieldvalue id="12346373">2.10.1</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>