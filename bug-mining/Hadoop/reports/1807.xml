<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:49:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-12107] long running apps may have a huge number of StatisticsData instances under FileSystem</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-12107</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;We observed with some of our apps (non-mapreduce apps that use filesystems) that they end up accumulating a huge memory footprint coming from &lt;tt&gt;FileSystem$Statistics$StatisticsData&lt;/tt&gt; (in the &lt;tt&gt;allData&lt;/tt&gt; list of &lt;tt&gt;Statistics&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;Although the thread reference from &lt;tt&gt;StatisticsData&lt;/tt&gt; is a weak reference, and thus can get cleared once a thread goes away, the actual &lt;tt&gt;StatisticsData&lt;/tt&gt; instances in the list won&apos;t get cleared until any of these following methods is called on &lt;tt&gt;Statistics&lt;/tt&gt;:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;tt&gt;getBytesRead()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;getBytesWritten()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;getReadOps()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;getLargeReadOps()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;getWriteOps()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;toString()&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It is quite possible to have an application that interacts with a filesystem but does not call any of these methods on the &lt;tt&gt;Statistics&lt;/tt&gt;. If such an application runs for a long time and has a large amount of thread churn, the memory footprint will grow significantly.&lt;/p&gt;

&lt;p&gt;The current workaround is either to limit the thread churn or to invoke these operations occasionally to pare down the memory. However, this is still a deficiency with &lt;tt&gt;FileSystem$Statistics&lt;/tt&gt; itself in that the memory is controlled only as a side effect of those operations.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12839261">HADOOP-12107</key>
            <summary>long running apps may have a huge number of StatisticsData instances under FileSystem</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sjlee0">Sangjin Lee</assignee>
                                    <reporter username="sjlee0">Sangjin Lee</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Jun 2015 22:32:37 +0000</created>
                <updated>Tue, 30 Aug 2016 01:26:14 +0000</updated>
                            <resolved>Mon, 29 Jun 2015 22:09:04 +0000</resolved>
                                    <version>2.7.0</version>
                                    <fixVersion>2.8.0</fixVersion>
                    <fixVersion>2.7.3</fixVersion>
                    <fixVersion>2.6.4</fixVersion>
                    <fixVersion>3.0.0-alpha1</fixVersion>
                                    <component>fs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>16</watches>
                                                                                                                <comments>
                            <comment id="14594054" author="sjlee0" created="Fri, 19 Jun 2015 22:41:50 +0000"  >&lt;p&gt;The key method in clearing this memory is in &lt;tt&gt;Statistics.visitAll()&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; &amp;lt;T&amp;gt; T visitAll(StatisticsAggregator&amp;lt;T&amp;gt; visitor) {
      visitor.accept(rootData);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (allData != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Iterator&amp;lt;StatisticsData&amp;gt; iter = allData.iterator();
            iter.hasNext(); ) {
          StatisticsData data = iter.next();
          visitor.accept(data);
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (data.owner.get() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            /*
             * If the thread that created &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; thread-local data no
             * longer exists, remove the StatisticsData from our list
             * and fold the values into rootData.
             */
            rootData.add(data);
            iter.remove();
          }
        }
      }
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; visitor.aggregate();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As part of running the visitor, it checks to see if the underlying thread is gone, and if so, adds the data for that thread to &lt;tt&gt;rootData&lt;/tt&gt; and removes the instance from the list.&lt;/p&gt;

&lt;p&gt;This pattern almost literally cries out for using a &lt;tt&gt;PhantomReference&lt;/tt&gt;. That way, we can perform this operation as soon as the garbage collector clears up the threads. I&apos;ll draw up a patch based on that idea soon.&lt;/p&gt;</comment>
                            <comment id="14594084" author="sjlee0" created="Fri, 19 Jun 2015 23:14:38 +0000"  >&lt;p&gt;Proposed patch to solicit feedback on the fix.&lt;/p&gt;</comment>
                            <comment id="14594570" author="hadoopqa" created="Sat, 20 Jun 2015 12:29:09 +0000"  >&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;blue&quot;&gt;0&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; pre-patch &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  16m 26s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Pre-patch trunk compilation is healthy. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; @author &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch does not contain any @author tags. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; tests included &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch doesn&apos;t appear to include any new or modified tests.  Please justify why no new tests are needed for this patch. Also please list what manual steps were performed to verify this patch. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javac &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   7m 29s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; There were no new javac warning messages. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javadoc &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   9m 39s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; There were no new javadoc warning messages. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; release audit &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 22s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The applied patch does not increase the total number of release audit warnings. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; checkstyle &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  4s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The applied patch generated  1 new checkstyle issues (total was 142, now 140). &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; whitespace &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch has no lines that end in whitespace. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; install &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 34s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; mvn install still works. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; eclipse:eclipse &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 34s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch built with eclipse:eclipse. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; findbugs &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 56s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch appears to introduce 1 new Findbugs (version 3.0.0) warnings. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; common tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  21m 55s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Tests passed in hadoop-common. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  61m  3s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Reason &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Tests &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; FindBugs &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; module:hadoop-common &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12740755/HADOOP-12107.001.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12740755/HADOOP-12107.001.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javadoc javac unit findbugs checkstyle &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; trunk / 20c03c9 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; checkstyle &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/6997/artifact/patchprocess/diffcheckstylehadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/6997/artifact/patchprocess/diffcheckstylehadoop-common.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Findbugs warnings &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/6997/artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/6997/artifact/patchprocess/newPatchFindbugsWarningshadoop-common.html&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; hadoop-common test log &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/6997/artifact/patchprocess/testrun_hadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/6997/artifact/patchprocess/testrun_hadoop-common.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/6997/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/6997/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.7.0_55 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux asf909.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/6997/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/6997/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;</comment>
                            <comment id="14596117" author="mingma" created="Mon, 22 Jun 2015 15:59:10 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjlee0&quot; class=&quot;user-hover&quot; rel=&quot;sjlee0&quot;&gt;sjlee0&lt;/a&gt;, great find. It overall looks good to me.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Is there a good way to write any unit test for this?&lt;/li&gt;
	&lt;li&gt;This will create one additional thread per FileSystem object. It is fine for most scenarios where one FileSystem object is shared among different threads in the same JVM. If the application creates many FileSystem objects in same JVM, this will create lots of additional threads. But it doesn&apos;t seem like something worthwhile optimizing for. Just bring it up in case.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14596543" author="cmccabe" created="Mon, 22 Jun 2015 19:58:27 +0000"  >&lt;p&gt;Thanks for looking at this, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjlee0&quot; class=&quot;user-hover&quot; rel=&quot;sjlee0&quot;&gt;sjlee0&lt;/a&gt;.  It looks like a good idea to fix this.&lt;/p&gt;

&lt;p&gt;As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mingma&quot; class=&quot;user-hover&quot; rel=&quot;mingma&quot;&gt;mingma&lt;/a&gt; commented, I think we need to have a single thread per JVM to do this, rather than one thread per FileSystem object.  We have a number of Hadoop applications which create lots of FileSystem objects, and creating a thread per FS object would just be too many threads.  We could end up with a thread leak which was worse than the memory leak described here.  (I agree that well-written applications should strive to avoid creating too many FileSystem objects, but that&apos;s a separate issue...)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; &amp;lt;T&amp;gt; T visitAll(StatisticsAggregator&amp;lt;T&amp;gt; visitor) {
      visitor.accept(rootData);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (allData != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The null check isn&apos;t needed any more since you changed allData to be initialized in the constructor.&lt;/p&gt;

&lt;p&gt;thanks&lt;/p&gt;</comment>
                            <comment id="14596806" author="sjlee0" created="Mon, 22 Jun 2015 22:58:28 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mingma&quot; class=&quot;user-hover&quot; rel=&quot;mingma&quot;&gt;mingma&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmccabe&quot; class=&quot;user-hover&quot; rel=&quot;cmccabe&quot;&gt;cmccabe&lt;/a&gt; for your comments!&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is there a good way to write any unit test for this?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I was relying on existing unit tests on &lt;tt&gt;FileSystem.Statistics&lt;/tt&gt; (there are several). I&apos;m still hoping that is good enough for this, but let me know if you want me to look into creating more unit tests around this.&lt;/p&gt;

&lt;p&gt;Regarding the number of threads for the cleaner, yes, it definitely occurred to me that this might create an issue in terms of potentially a large number of additional threads. The only reason I shied away from a global cleaner thread initially is I wasn&apos;t entirely sure whether it would be completely safe and perform well in terms of locking (note that the cleaner needs to acquire a lock for each &lt;tt&gt;Statistics&lt;/tt&gt; instance). Let me explore that still.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The null check isn&apos;t needed any more since you changed allData to be initialized in the constructor.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks for pointing that out. I remembered it at one point, but forgot to include that change in the patch.&lt;/p&gt;

&lt;p&gt;One other point of discussion: I&apos;m removing the &lt;tt&gt;StatisticsData&lt;/tt&gt; constructor that takes a Thread as the argument (along with the &lt;tt&gt;owner&lt;/tt&gt; member variable) as it no longer needs the thread inside &lt;tt&gt;StatisticsData&lt;/tt&gt;. But since &lt;tt&gt;StatisticsData&lt;/tt&gt; is technically a public class, it could be considered an API incompatible change. Thoughts on this? No one outside &lt;tt&gt;FileSystem&lt;/tt&gt; is using the constructor or the member variable, and I cannot think of why anyone would. But if we need to absolutely maintain the API compatibility, I cannot remove them. Let me know what you think.&lt;/p&gt;</comment>
                            <comment id="14596951" author="jira.shegalov" created="Tue, 23 Jun 2015 00:57:31 +0000"  >&lt;p&gt;Between a single thread and a thread per FileSystem object, we can compromise on having a configurable single thread pool for the class FileSystem. &lt;/p&gt;

&lt;p&gt;Let us maintain fool-proof compatibility to make sure that we can safely backport the patch, and just deprecate the old constructor.&lt;/p&gt;

&lt;p&gt;I don&apos;t see a test covering the scenario in this JIRA. It would be good to add a test to &lt;tt&gt;fs.FCStatisticsBaseTest&lt;/tt&gt;&lt;/p&gt;
</comment>
                            <comment id="14597002" author="sjlee0" created="Tue, 23 Jun 2015 02:01:56 +0000"  >&lt;p&gt;v.2 patch posted.&lt;/p&gt;

&lt;p&gt;Changes:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;restored the weak reference in StatisticsData and deprecated it instead&lt;/li&gt;
	&lt;li&gt;changed the cleaner thread (and the reference queue) to be static (global)&lt;/li&gt;
	&lt;li&gt;fixed a bug in cleanUp() where a wrong type was being removed&lt;/li&gt;
	&lt;li&gt;changed the reference list from a LinkedList to a HashSet for faster removal&lt;/li&gt;
	&lt;li&gt;wrote a new unit test for testing this&lt;/li&gt;
	&lt;li&gt;removed unnecessary null check in visitAll()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This should address most of the review comments.&lt;/p&gt;

&lt;p&gt;As for the cleaner thread, I was able to convince myself that a single global cleaner thread should be adequate. I do not see thread safety issues, and it just needs to keep up with the rate of (threads being discarded) * (filesystem instances). Even if it could fall behind at times, it should be able to catch up barring the most pathological situation. Let me know if you guys are OK with that reasoning. Thanks!&lt;/p&gt;</comment>
                            <comment id="14597058" author="hadoopqa" created="Tue, 23 Jun 2015 03:11:08 +0000"  >&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;blue&quot;&gt;0&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; pre-patch &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  16m 18s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Pre-patch trunk compilation is healthy. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; @author &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch does not contain any @author tags. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; tests included &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch appears to include 1 new or modified test files. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javac &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   7m 28s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; There were no new javac warning messages. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javadoc &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   9m 32s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; There were no new javadoc warning messages. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; release audit &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 22s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The applied patch does not increase the total number of release audit warnings. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; checkstyle &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  5s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The applied patch generated  3 new checkstyle issues (total was 142, now 143). &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; whitespace &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch has no lines that end in whitespace. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; install &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 36s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; mvn install still works. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; eclipse:eclipse &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 33s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch built with eclipse:eclipse. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; findbugs &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 50s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch does not introduce any new Findbugs (version 3.0.0) warnings. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; common tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  21m 56s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Tests passed in hadoop-common. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  60m 43s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12741198/HADOOP-12107.002.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12741198/HADOOP-12107.002.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javadoc javac unit findbugs checkstyle &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; trunk / 99271b7 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; checkstyle &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7019/artifact/patchprocess/diffcheckstylehadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7019/artifact/patchprocess/diffcheckstylehadoop-common.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; hadoop-common test log &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7019/artifact/patchprocess/testrun_hadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7019/artifact/patchprocess/testrun_hadoop-common.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7019/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7019/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.7.0_55 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux asf906.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7019/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7019/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;</comment>
                            <comment id="14597091" author="sjlee0" created="Tue, 23 Jun 2015 03:21:13 +0000"  >&lt;p&gt;v.3 patch posted.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;addressed the checkstyle issue&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14597146" author="hadoopqa" created="Tue, 23 Jun 2015 04:31:07 +0000"  >&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;blue&quot;&gt;0&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; pre-patch &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  16m 19s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Pre-patch trunk compilation is healthy. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; @author &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch does not contain any @author tags. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; tests included &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch appears to include 1 new or modified test files. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javac &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   7m 28s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; There were no new javac warning messages. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javadoc &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   9m 35s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; There were no new javadoc warning messages. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; release audit &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 22s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The applied patch does not increase the total number of release audit warnings. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; checkstyle &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  5s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The applied patch generated  1 new checkstyle issues (total was 142, now 141). &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; whitespace &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  1s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch has no lines that end in whitespace. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; install &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 35s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; mvn install still works. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; eclipse:eclipse &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 33s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch built with eclipse:eclipse. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; findbugs &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 50s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch does not introduce any new Findbugs (version 3.0.0) warnings. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; common tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  21m 48s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Tests passed in hadoop-common. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  60m 40s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12741209/HADOOP-12107.003.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12741209/HADOOP-12107.003.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javadoc javac unit findbugs checkstyle &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; trunk / 99271b7 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; checkstyle &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7020/artifact/patchprocess/diffcheckstylehadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7020/artifact/patchprocess/diffcheckstylehadoop-common.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; hadoop-common test log &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7020/artifact/patchprocess/testrun_hadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7020/artifact/patchprocess/testrun_hadoop-common.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7020/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7020/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.7.0_55 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux asf906.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7020/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7020/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;</comment>
                            <comment id="14597153" author="sjlee0" created="Tue, 23 Jun 2015 04:41:03 +0000"  >&lt;p&gt;The checkstyle warning:&lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;./hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/FileSystem.java:1: File length is 3,415 lines (max allowed is 2,000).&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nothing I can do about that. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Your review is greatly appreciated. Thanks!&lt;/p&gt;</comment>
                            <comment id="14597297" author="walter.k.su" created="Tue, 23 Jun 2015 07:46:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;This will create one additional thread per FileSystem object.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;003 patch is good. I just don&apos;t understand why 001 patch creates one additional thread per FileSystem &lt;b&gt;object&lt;/b&gt;?&lt;br/&gt;
I look at &lt;tt&gt;FileSystem#getStaticstics(..)&lt;/tt&gt;. I think it creates one Staticstics object per FileSystem &lt;b&gt;class&lt;/b&gt;, so 001 patch creates one additional thread per FileSystem &lt;b&gt;class&lt;/b&gt;? I&apos;ll be grateful if somebody can guide me through this.&lt;/p&gt;</comment>
                            <comment id="14597851" author="sjlee0" created="Tue, 23 Jun 2015 15:50:39 +0000"  >&lt;p&gt;Thanks for pointing that out &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=walter.k.su&quot; class=&quot;user-hover&quot; rel=&quot;walter.k.su&quot;&gt;walter.k.su&lt;/a&gt;. I think you&apos;re right in that normally one &lt;tt&gt;Statistics&lt;/tt&gt; instance is created per &lt;tt&gt;FileSystem&lt;/tt&gt; class. That said, it is possible to create &lt;tt&gt;Statistics&lt;/tt&gt; instances in other manners simply via invoking the public constructor.&lt;/p&gt;</comment>
                            <comment id="14598388" author="mingma" created="Tue, 23 Jun 2015 21:21:40 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjlee0&quot; class=&quot;user-hover&quot; rel=&quot;sjlee0&quot;&gt;sjlee0&lt;/a&gt;. Latest patch LGTM. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmccabe&quot; class=&quot;user-hover&quot; rel=&quot;cmccabe&quot;&gt;cmccabe&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jira.shegalov&quot; class=&quot;user-hover&quot; rel=&quot;jira.shegalov&quot;&gt;jira.shegalov&lt;/a&gt; any additional comments?&lt;/p&gt;</comment>
                            <comment id="14598397" author="jira.shegalov" created="Tue, 23 Jun 2015 21:27:38 +0000"  >&lt;p&gt;Thanks for v3 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjlee0&quot; class=&quot;user-hover&quot; rel=&quot;sjlee0&quot;&gt;sjlee0&lt;/a&gt;! &lt;/p&gt;

&lt;p&gt;&lt;b&gt;FileSystem.java:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;tt&gt;getThreadStatistics&lt;/tt&gt;:&lt;/b&gt;&lt;br/&gt;
Minimize the code executed under the monitor. Pull reference creation out of &lt;tt&gt;synchronized&lt;/tt&gt; similar to what it was before. Note that currentThread is a native call.&lt;/p&gt;


&lt;p&gt;&lt;b&gt;&lt;tt&gt;Cleaner#run&lt;/tt&gt;&lt;/b&gt;&lt;br/&gt;
Catch and log InterruptedException in the while loop, such that thread does not die on a spurious wakeup. It&apos;s safe since it&apos;s a daemon thread.&lt;/p&gt;

&lt;p&gt;Nits:&lt;br/&gt;
can we be more specific in the naming, to the tune of: STATS_DATA_CLEANER, STATS_DATA_REFQUEUE, StatsDataCleaner. &lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;tt&gt;testStatisticsThreadLocalDataCleanUp&lt;/tt&gt;&lt;/b&gt;&lt;br/&gt;
Since the test uses waits, pass some reasonable timeout to &lt;tt&gt;@Test&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;make &apos;int size&apos; and &apos;int maxSeconds&apos; final. &lt;/p&gt;</comment>
                            <comment id="14598475" author="sjlee0" created="Tue, 23 Jun 2015 22:15:00 +0000"  >&lt;p&gt;patch v.4 posted&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jira.shegalov&quot; class=&quot;user-hover&quot; rel=&quot;jira.shegalov&quot;&gt;jira.shegalov&lt;/a&gt;, those are good suggestions.&lt;/p&gt;

&lt;p&gt;Changes:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;made the cleaner thread uninterruptible&lt;/li&gt;
	&lt;li&gt;reduced the locking scope in getThreadStatistics()&lt;/li&gt;
	&lt;li&gt;renamed variables and a class to be more specific to stats data&lt;/li&gt;
	&lt;li&gt;added a timeout to the test method&lt;/li&gt;
	&lt;li&gt;made size and maxSeconds final&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14598570" author="hadoopqa" created="Tue, 23 Jun 2015 23:36:50 +0000"  >&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;blue&quot;&gt;0&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; pre-patch &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  16m 18s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Pre-patch trunk compilation is healthy. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; @author &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch does not contain any @author tags. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; tests included &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch appears to include 1 new or modified test files. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javac &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   7m 29s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; There were no new javac warning messages. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javadoc &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   9m 38s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; There were no new javadoc warning messages. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; release audit &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 23s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The applied patch does not increase the total number of release audit warnings. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; checkstyle &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  4s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The applied patch generated  1 new checkstyle issues (total was 142, now 141). &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; whitespace &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch has no lines that end in whitespace. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; install &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 35s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; mvn install still works. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; eclipse:eclipse &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 35s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch built with eclipse:eclipse. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; findbugs &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 51s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch does not introduce any new Findbugs (version 3.0.0) warnings. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; common tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  21m 41s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Tests passed in hadoop-common. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  60m 38s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12741393/HADOOP-12107.004.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12741393/HADOOP-12107.004.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javadoc javac unit findbugs checkstyle &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; trunk / 122cad6 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; checkstyle &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7027/artifact/patchprocess/diffcheckstylehadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7027/artifact/patchprocess/diffcheckstylehadoop-common.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; hadoop-common test log &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7027/artifact/patchprocess/testrun_hadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7027/artifact/patchprocess/testrun_hadoop-common.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7027/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7027/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.7.0_55 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux asf906.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7027/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7027/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;</comment>
                            <comment id="14598617" author="jira.shegalov" created="Wed, 24 Jun 2015 00:05:24 +0000"  >&lt;p&gt;+1, 004 LGTM&lt;/p&gt;</comment>
                            <comment id="14599861" author="cmccabe" created="Wed, 24 Jun 2015 18:09:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;003 patch is good. I just don&apos;t understand why 001 patch creates one additional thread per FileSystem object? I look at FileSystem#getStaticstics(..). I think it creates one Staticstics object per FileSystem class, so 001 patch creates one additional thread per FileSystem class? I&apos;ll be grateful if somebody can guide me through this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;D&apos;oh.  You&apos;re absolutely right... there is only one thread per FileSystem class.  Forget what I said earlier.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;One other point of discussion: I&apos;m removing the StatisticsData constructor that takes a Thread as the argument (along with the owner member variable) as it no longer needs the thread inside StatisticsData. But since StatisticsData is technically a public class, it could be considered an API incompatible change. Thoughts on this? No one outside FileSystem is using the constructor or the member variable, and I cannot think of why anyone would. But if we need to absolutely maintain the API compatibility, I cannot remove them. Let me know what you think.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;StatisticsData is a public class, but its constructor is not public.  So there is no possible API breakage here.  (As a side note, even if StatisticsData were public, it doesn&apos;t have an interface annotation specifying that it is safe to use outside of Hadoop, so we&apos;re doubly safe here.)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2921              /**
2922	       * This constructor is deprecated and is no longer used. One should remove
2923	       * any use of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; constructor.
2924	       */
2925	      @Deprecated
2926	      StatisticsData(WeakReference&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;&amp;gt; owner) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Like I explained above, we don&apos;t need this.  Let&apos;s get rid of it.&lt;/p&gt;

&lt;p&gt;StatisticsDataReference: let&apos;s put an &lt;tt&gt;&amp;#64;Override&lt;/tt&gt; annotation on the functions which implement &lt;tt&gt;PhantomReference&lt;/tt&gt; APIs.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;142	    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; maxSeconds = 10;
143	    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; maxSeconds; i++) {
144	      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000L);
145	      allDataSize = stats.getAllThreadLocalDataSize();
146	      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (allDataSize == 0) {
147	        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;cleaned up after &quot;&lt;/span&gt; + (i+1) + &lt;span class=&quot;code-quote&quot;&gt;&quot; seconds&quot;&lt;/span&gt;);
148	        &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
149	      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
150	        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;not cleaned up after &quot;&lt;/span&gt; + (i+1) + &lt;span class=&quot;code-quote&quot;&gt;&quot; seconds; waiting...&quot;&lt;/span&gt;);
151	      }
152	    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let&apos;s use &lt;tt&gt;GenericTestUtils#waitFor&lt;/tt&gt; here.&lt;/p&gt;

&lt;p&gt;+1 once those are addressed.  Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjlee0&quot; class=&quot;user-hover&quot; rel=&quot;sjlee0&quot;&gt;sjlee0&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14600193" author="sjlee0" created="Wed, 24 Jun 2015 21:36:19 +0000"  >&lt;p&gt;patch v.5 posted&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;removed the weak reference&lt;/li&gt;
	&lt;li&gt;added @Override to StatisticsDataReferenceCleaner.run()&lt;/li&gt;
	&lt;li&gt;used GenericTestingUtils.waitFor() for the unit test&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Good catch about the weak reference not being public. Somehow I thought it was public.&lt;/p&gt;

&lt;p&gt;Actually &lt;tt&gt;StatisticsDataReference&lt;/tt&gt; does not override any methods from PhantomReference (does not need to). I still marked &lt;tt&gt;StatisticsDataReferenceCleaner.run()&lt;/tt&gt; with &lt;tt&gt;@Override&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I also adapted the unit test to use &lt;tt&gt;GenericTestingUtils&lt;/tt&gt;. Thanks!&lt;/p&gt;</comment>
                            <comment id="14600361" author="hadoopqa" created="Wed, 24 Jun 2015 23:24:31 +0000"  >&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;b&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;&lt;/b&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Vote &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Runtime &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Comment &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;blue&quot;&gt;0&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; pre-patch &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  16m 19s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Pre-patch trunk compilation is healthy. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; @author &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch does not contain any @author tags. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; tests included &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch appears to include 1 new or modified test files. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javac &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   7m 30s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; There were no new javac warning messages. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javadoc &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   9m 37s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; There were no new javadoc warning messages. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; release audit &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 22s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The applied patch does not increase the total number of release audit warnings. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; checkstyle &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m  6s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The applied patch generated  1 new checkstyle issues (total was 142, now 140). &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; whitespace &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m  0s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch has no lines that end in whitespace. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; install &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 37s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; mvn install still works. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; eclipse:eclipse &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   0m 32s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch built with eclipse:eclipse. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;green&quot;&gt;+1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; findbugs &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   1m 50s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; The patch does not introduce any new Findbugs (version 3.0.0) warnings. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;font color=&quot;red&quot;&gt;-1&lt;/font&gt; &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; common tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  21m 33s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Tests failed in hadoop-common. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  60m 29s &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Reason &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Tests &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Failed unit tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; hadoop.security.ssl.TestReloadingX509TrustManager &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Subsystem &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Report/Notes &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Patch URL &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12741705/HADOOP-12107.005.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12741705/HADOOP-12107.005.patch&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Optional Tests &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; javadoc javac unit findbugs checkstyle &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; git revision &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; trunk / afe9ea3 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; checkstyle &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7033/artifact/patchprocess/diffcheckstylehadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7033/artifact/patchprocess/diffcheckstylehadoop-common.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; hadoop-common test log &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7033/artifact/patchprocess/testrun_hadoop-common.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7033/artifact/patchprocess/testrun_hadoop-common.txt&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Test Results &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7033/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7033/testReport/&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Java &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1.7.0_55 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; uname &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Linux asf906.gq1.ygridcore.net 3.13.0-36-lowlatency #63-Ubuntu SMP PREEMPT Wed Sep 3 21:56:12 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Console output &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HADOOP-Build/7033/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-HADOOP-Build/7033/console&lt;/a&gt; &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;This message was automatically generated.&lt;/p&gt;</comment>
                            <comment id="14600376" author="sjlee0" created="Wed, 24 Jun 2015 23:35:39 +0000"  >&lt;p&gt;I believe the test failure is unrelated. Also, the said test passes fine locally.&lt;/p&gt;</comment>
                            <comment id="14602230" author="jira.shegalov" created="Fri, 26 Jun 2015 01:21:54 +0000"  >&lt;p&gt;bq StatisticsData is a public class, but its constructor is not public. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmccabe&quot; class=&quot;user-hover&quot; rel=&quot;cmccabe&quot;&gt;cmccabe&lt;/a&gt;, good point on the one hand but on the other hand this constructor is package-scope, and technically usable if an creates a class with the same package name, regardless how unlikely or illegal (in terms of specified audience) it is. How about we defensively keep that constructor for branch-2 at least?&lt;/p&gt;</comment>
                            <comment id="14603211" author="sjlee0" created="Fri, 26 Jun 2015 17:08:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmccabe&quot; class=&quot;user-hover&quot; rel=&quot;cmccabe&quot;&gt;cmccabe&lt;/a&gt;, your thoughts on this?&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;StatisticsData&lt;/tt&gt; was made public in 2.5 (&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10688&quot; title=&quot;Expose thread-level FileSystem StatisticsData&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10688&quot;&gt;&lt;del&gt;HADOOP-10688&lt;/del&gt;&lt;/a&gt;), and I doubt there would be an actual case of using the constructor. IMO, removing the constructor (and the member) seems pretty safe, in theory and practice. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sandyr&quot; class=&quot;user-hover&quot; rel=&quot;sandyr&quot;&gt;sandyr&lt;/a&gt;, what do you think?&lt;/p&gt;</comment>
                            <comment id="14603216" author="sjlee0" created="Fri, 26 Jun 2015 17:10:32 +0000"  >&lt;p&gt;FWIW, when I look at the spark code (which may have been the main reason for changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-10688&quot; title=&quot;Expose thread-level FileSystem StatisticsData&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-10688&quot;&gt;&lt;del&gt;HADOOP-10688&lt;/del&gt;&lt;/a&gt;), it doesn&apos;t look like it&apos;s using the constructor or the owner member variable: &lt;a href=&quot;https://github.com/apache/spark/blob/3c0156899dc1ec1f7dfe6d7c8af47fa6dc7d00bf/core/src/main/scala/org/apache/spark/deploy/SparkHadoopUtil.scala&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/blob/3c0156899dc1ec1f7dfe6d7c8af47fa6dc7d00bf/core/src/main/scala/org/apache/spark/deploy/SparkHadoopUtil.scala&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14603218" author="sandyr" created="Fri, 26 Jun 2015 17:13:07 +0000"  >&lt;p&gt;I don&apos;t know of anyone using the StatisticsData constructor.  I originally made the class public for Spark&apos;s needs and it shouldn&apos;t ever need that constructor.&lt;/p&gt;

&lt;p&gt;This is neither an endorsement nor a -1 against removing the constructor.&lt;/p&gt;</comment>
                            <comment id="14603433" author="cmccabe" created="Fri, 26 Jun 2015 19:03:45 +0000"  >&lt;p&gt;OK, at the risk of being pedantic, here is my rundown.  While the &lt;tt&gt;StatisticsData&lt;/tt&gt; class itself is public, the &lt;tt&gt;StatisticsData&lt;/tt&gt; constructor is not.  It is &quot;package-private&quot; (the access class which things get in Java if there is no public, private, or protected keyword on them.)  This means that a &lt;tt&gt;StatisticsData&lt;/tt&gt; object can only be created by code in the &lt;tt&gt;org.apache.hadoop.fs&lt;/tt&gt; package.  You can try this for yourself-- write a program external to hadoop that tries to create a &lt;tt&gt;StatisticsData&lt;/tt&gt; object via this constructor.  It will not compile.  This constructor is safe to remove, so let&apos;s do that.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Colin Patrick McCabe, good point on the one hand but on the other hand this constructor is package-scope, and technically usable if an creates a class with the same package name, regardless how unlikely or illegal (in terms of specified audience) it is. How about we defensively keep that constructor for branch-2 at least?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No.  Users simply can&apos;t add code to the &lt;tt&gt;org.apache.hadoop.fs&lt;/tt&gt; package.  If they do, things are not going to work-- there are going to be naming conflicts, class resolution issues, etc. etc.  There is no possible way we can support users doing this and no reason to support it.  If we tried, we would have to essentially freeze the API of every single class in Hadoop-- we would have to re-have this discussion each time we changed some package-private variable or function.  Private and package-private stuff is private-- it&apos;s even enforced by the compiler, you can&apos;t get much more private than that.&lt;/p&gt;</comment>
                            <comment id="14603982" author="jira.shegalov" created="Sat, 27 Jun 2015 05:16:28 +0000"  >&lt;p&gt;I agree with the sentiment what API isolation contract should be. &lt;/p&gt;

&lt;p&gt;However, at the expense of being too defensive, the only test I apply here: is there hypothetically a scenario where an API user can be broken? My answer is yes if you have some &lt;tt&gt;org.apache.hadoop.fs.Foo&lt;/tt&gt; calling the constructor even though the user absolutely should not do it.  Regarding freezing the API, given that the question was only about branch-2, it does not sound negative to me. &lt;/p&gt;</comment>
                            <comment id="14606271" author="cmccabe" created="Mon, 29 Jun 2015 19:55:10 +0000"  >&lt;p&gt;Guys, we clearly define the API contract for the project.  See &lt;a href=&quot;http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/Compatibility.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/Compatibility.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You have to remember that:&lt;br/&gt;
1. The function that you are talking about changing (the constructor) is not public from Java&apos;s point of view.  It is package-private.&lt;br/&gt;
2. The function that you are talking about changing is not public from Hadoop&apos;s point of view (there is no &amp;#64;Public or &amp;#64;LimitedPrivate annotation on it)&lt;/p&gt;

&lt;p&gt;There is simply no reason to treat this as public.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;However, at the expense of being too defensive, the only test I apply here: is there hypothetically a scenario where an API user can be broken? My answer is yes if you have some org.apache.hadoop.fs.Foo calling the constructor even though the user absolutely should not do it. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You could make the same argument to stop development on almost any patch.  Almost every patch changes things which are private or package-private inside Hadoop.  It&apos;s simply unreasonable to try to support users who are putting their code inside the org.apache.hadoop.fs namespace (or any other internal project namespace)&lt;/p&gt;</comment>
                            <comment id="14606431" author="jira.shegalov" created="Mon, 29 Jun 2015 21:22:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;You could make the same argument to stop development on almost any patch.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I disagree with such a strong statement. It&apos;s not the case in my experience.  Thanks for pointing out the compatibility document. It gives us a formal basis to go on, and not delay &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjlee0&quot; class=&quot;user-hover&quot; rel=&quot;sjlee0&quot;&gt;sjlee0&lt;/a&gt;&apos;s important fix. Maybe one day we&apos;ll have a compatibility test suite based on that doc.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It&apos;s simply unreasonable to try to support users who are putting their code inside the org.apache.hadoop.fs &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We develop new Hadoop features and often they do not make it upstream immediately. It happens that we have classes in their intended packages but we can deal with this. We are not affected by this particular change, either.&lt;/p&gt;

&lt;p&gt;+1 for both trunk and branch 2. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mingma&quot; class=&quot;user-hover&quot; rel=&quot;mingma&quot;&gt;mingma&lt;/a&gt;, do you want to exercise your committer rights &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ?&lt;/p&gt;





</comment>
                            <comment id="14606495" author="hudson" created="Mon, 29 Jun 2015 22:01:52 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-trunk-Commit #8089 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/8089/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/8089/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12107&quot; title=&quot;long running apps may have a huge number of StatisticsData instances under FileSystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12107&quot;&gt;&lt;del&gt;HADOOP-12107&lt;/del&gt;&lt;/a&gt;. long running apps may have a huge number of StatisticsData instances under FileSystem (Sangjin Lee via Ming Ma) (mingma: rev 8e1bdc17d9134e01115ae7c929503d8ac0325207)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/FileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/FCStatisticsBaseTest.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14606509" author="mingma" created="Mon, 29 Jun 2015 22:06:56 +0000"  >&lt;p&gt;I have committed this to trunk and branch-2. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjlee0&quot; class=&quot;user-hover&quot; rel=&quot;sjlee0&quot;&gt;sjlee0&lt;/a&gt; for the contribution and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jira.shegalov&quot; class=&quot;user-hover&quot; rel=&quot;jira.shegalov&quot;&gt;jira.shegalov&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmccabe&quot; class=&quot;user-hover&quot; rel=&quot;cmccabe&quot;&gt;cmccabe&lt;/a&gt; for the code review!&lt;/p&gt;</comment>
                            <comment id="14606514" author="mingma" created="Mon, 29 Jun 2015 22:08:44 +0000"  >&lt;p&gt;Also thanks for &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=walter.k.su&quot; class=&quot;user-hover&quot; rel=&quot;walter.k.su&quot;&gt;walter.k.su&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sandyr&quot; class=&quot;user-hover&quot; rel=&quot;sandyr&quot;&gt;sandyr&lt;/a&gt; for the review and suggestion.&lt;/p&gt;</comment>
                            <comment id="14606552" author="sjlee0" created="Mon, 29 Jun 2015 22:29:45 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mingma&quot; class=&quot;user-hover&quot; rel=&quot;mingma&quot;&gt;mingma&lt;/a&gt; for the commit! Many thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jira.shegalov&quot; class=&quot;user-hover&quot; rel=&quot;jira.shegalov&quot;&gt;jira.shegalov&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmccabe&quot; class=&quot;user-hover&quot; rel=&quot;cmccabe&quot;&gt;cmccabe&lt;/a&gt; for the invaluable review.&lt;/p&gt;</comment>
                            <comment id="14608460" author="hudson" created="Tue, 30 Jun 2015 15:19:28 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Mapreduce-trunk-Java8 #242 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/242/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk-Java8/242/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12107&quot; title=&quot;long running apps may have a huge number of StatisticsData instances under FileSystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12107&quot;&gt;&lt;del&gt;HADOOP-12107&lt;/del&gt;&lt;/a&gt;. long running apps may have a huge number of StatisticsData instances under FileSystem (Sangjin Lee via Ming Ma) (mingma: rev 8e1bdc17d9134e01115ae7c929503d8ac0325207)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/FileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/FCStatisticsBaseTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14608516" author="hudson" created="Tue, 30 Jun 2015 15:37:30 +0000"  >&lt;p&gt;SUCCESS: Integrated in Hadoop-Mapreduce-trunk #2190 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2190/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Mapreduce-trunk/2190/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12107&quot; title=&quot;long running apps may have a huge number of StatisticsData instances under FileSystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12107&quot;&gt;&lt;del&gt;HADOOP-12107&lt;/del&gt;&lt;/a&gt;. long running apps may have a huge number of StatisticsData instances under FileSystem (Sangjin Lee via Ming Ma) (mingma: rev 8e1bdc17d9134e01115ae7c929503d8ac0325207)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/FCStatisticsBaseTest.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/FileSystem.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14609256" author="cmccabe" created="Tue, 30 Jun 2015 23:36:42 +0000"  >&lt;p&gt;Thanks, guys.&lt;/p&gt;</comment>
                            <comment id="14610306" author="hudson" created="Wed, 1 Jul 2015 14:20:26 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-trunk #2172 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk/2172/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk/2172/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12107&quot; title=&quot;long running apps may have a huge number of StatisticsData instances under FileSystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12107&quot;&gt;&lt;del&gt;HADOOP-12107&lt;/del&gt;&lt;/a&gt;. long running apps may have a huge number of StatisticsData instances under FileSystem (Sangjin Lee via Ming Ma) (mingma: rev 8e1bdc17d9134e01115ae7c929503d8ac0325207)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/FCStatisticsBaseTest.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/FileSystem.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14610348" author="hudson" created="Wed, 1 Jul 2015 14:26:51 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-Hdfs-trunk-Java8 #233 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/233/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-Hdfs-trunk-Java8/233/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12107&quot; title=&quot;long running apps may have a huge number of StatisticsData instances under FileSystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12107&quot;&gt;&lt;del&gt;HADOOP-12107&lt;/del&gt;&lt;/a&gt;. long running apps may have a huge number of StatisticsData instances under FileSystem (Sangjin Lee via Ming Ma) (mingma: rev 8e1bdc17d9134e01115ae7c929503d8ac0325207)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/test/java/org/apache/hadoop/fs/FCStatisticsBaseTest.java&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/FileSystem.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15089972" author="jlowe" created="Fri, 8 Jan 2016 21:28:27 +0000"  >&lt;p&gt;I recently ran across this on a NodeManager running 2.6 that had been up for a while.  Any objections to this being picked back to 2.6 and 2.7?&lt;/p&gt;</comment>
                            <comment id="15090150" author="sjlee0" created="Fri, 8 Jan 2016 23:10:25 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15096632" author="jlowe" created="Wed, 13 Jan 2016 17:31:02 +0000"  >&lt;p&gt;I tried pulling this into branch-2.7.  It comes in cleanly except for CHANGES.txt, but the unit test failed.  Subsequent runs showed it was flaky, sometimes passing and sometimes not.  Looking around I noticed a number of precommit builds have been complaining about this test.  I can reproduce the flaky test on trunk, so I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12706&quot; title=&quot;TestLocalFsFCStatistics#testStatisticsThreadLocalDataCleanUp times out occasionally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12706&quot;&gt;&lt;del&gt;HADOOP-12706&lt;/del&gt;&lt;/a&gt;.  I&apos;d really like this fix backported, but I&apos;d also rather not add another flaky test to 2.7 and 2.6.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sjlee0&quot; class=&quot;user-hover&quot; rel=&quot;sjlee0&quot;&gt;sjlee0&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mingma&quot; class=&quot;user-hover&quot; rel=&quot;mingma&quot;&gt;mingma&lt;/a&gt; could you take a look into the unit test?&lt;/p&gt;</comment>
                            <comment id="15099153" author="jlowe" created="Thu, 14 Jan 2016 23:54:07 +0000"  >&lt;p&gt;I committed this to branch-2.7 and branch-2.6.&lt;/p&gt;</comment>
                            <comment id="15099221" author="hudson" created="Fri, 15 Jan 2016 00:58:15 +0000"  >&lt;p&gt;FAILURE: Integrated in Hadoop-trunk-Commit #9116 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/9116/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/9116/&lt;/a&gt;)&lt;br/&gt;
Update CHANGES.txt for commit of &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12107&quot; title=&quot;long running apps may have a huge number of StatisticsData instances under FileSystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12107&quot;&gt;&lt;del&gt;HADOOP-12107&lt;/del&gt;&lt;/a&gt; to branch-2.7 and (jlowe: rev 651c23e8ef8aeafd999249ce57b31e689bd2ece6)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hadoop-common-project/hadoop-common/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15209500" author="jlowe" created="Thu, 24 Mar 2016 00:39:16 +0000"  >&lt;p&gt;This appears to be triggering OOM errors in Tez during task transitions in container reuse for some scenarios, see &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-12958&quot; title=&quot;PhantomReference for filesystem statistics can trigger OOM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-12958&quot;&gt;&lt;del&gt;HADOOP-12958&lt;/del&gt;&lt;/a&gt; for details.  We had at least one job that would fail with an OOM every time during container reuse, and it passes once this change was reverted.&lt;/p&gt;</comment>
                            <comment id="15437879" author="vinodkv" created="Thu, 25 Aug 2016 22:47:48 +0000"  >&lt;p&gt;Closing the JIRA as part of 2.7.3 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12940723">HADOOP-12829</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12990701">MAPREDUCE-6735</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12929879">HADOOP-12706</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12953039">HADOOP-12958</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12740755" name="HADOOP-12107.001.patch" size="7080" author="sjlee0" created="Fri, 19 Jun 2015 23:14:38 +0000"/>
                            <attachment id="12741198" name="HADOOP-12107.002.patch" size="11306" author="sjlee0" created="Tue, 23 Jun 2015 02:01:56 +0000"/>
                            <attachment id="12741209" name="HADOOP-12107.003.patch" size="11310" author="sjlee0" created="Tue, 23 Jun 2015 03:21:13 +0000"/>
                            <attachment id="12741393" name="HADOOP-12107.004.patch" size="11751" author="sjlee0" created="Tue, 23 Jun 2015 22:15:00 +0000"/>
                            <attachment id="12741705" name="HADOOP-12107.005.patch" size="11466" author="sjlee0" created="Wed, 24 Jun 2015 21:36:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gae7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12329058">2.8.0</customfieldvalue>
    <customfieldvalue id="12334234">2.6.4</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>