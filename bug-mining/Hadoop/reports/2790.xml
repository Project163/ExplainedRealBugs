<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:57:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-17891] lz4-java and snappy-java should be excluded from relocation in shaded Hadoop libraries</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-17891</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;lz4-java is a provided dependency. So in the shaded Hadoop libraries, e.g. hadoop-client-api, if we don&apos;t exclude lz4 dependency, the downstream will still see the exception even they include lz4 dependency.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[info]   Cause: java.lang.ClassNotFoundException: org.apache.hadoop.shaded.net.jpountz.lz4.LZ4Factory
[info]   at java.net.URLClassLoader.findClass(URLClassLoader.java:382)
[info]   at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:418)
[info]   at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:352)
[info]   at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:351)
[info]   at org.apache.hadoop.io.compress.lz4.Lz4Compressor.&amp;lt;init&amp;gt;(Lz4Compressor.java:66)
[info]   at org.apache.hadoop.io.compress.Lz4Codec.createCompressor(Lz4Codec.java:119)
[info]   at org.apache.hadoop.io.compress.CodecPool.getCompressor(CodecPool.java:152)
[info]   at org.apache.hadoop.io.compress.CodecPool.getCompressor(CodecPool.java:168)
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Currently snappy-java is included and relocated in Hadoop shaded client libraries. But as it includes native methods, it should not be relocated too due to JNI method resolution. The downstream will see the exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[info]   Cause: java.lang.UnsatisfiedLinkError: org.apache.hadoop.shaded.org.xerial.snappy.SnappyNative.rawCompress(Ljava/nio/ByteBuffer;IILjava/nio/ByteBuffer;I)I
[info]   at org.apache.hadoop.shaded.org.xerial.snappy.SnappyNative.rawCompress(Native Method)                                                                                                 
[info]   at org.apache.hadoop.shaded.org.xerial.snappy.Snappy.compress(Snappy.java:151)                                                                                                        
[info]   at org.apache.hadoop.io.compress.snappy.SnappyCompressor.compressDirectBuf(SnappyCompressor.java:282)
[info]   at org.apache.hadoop.io.compress.snappy.SnappyCompressor.compress(SnappyCompressor.java:210)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13399415">HADOOP-17891</key>
            <summary>lz4-java and snappy-java should be excluded from relocation in shaded Hadoop libraries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viirya">L. C. Hsieh</assignee>
                                    <reporter username="viirya">L. C. Hsieh</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 4 Sep 2021 21:33:09 +0000</created>
                <updated>Sun, 11 Feb 2024 23:04:09 +0000</updated>
                            <resolved>Tue, 14 Sep 2021 18:17:52 +0000</resolved>
                                    <version>3.3.1</version>
                                    <fixVersion>3.4.0</fixVersion>
                    <fixVersion>3.3.2</fixVersion>
                                    <component>build</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="63600">17h 40m</timespent>
                                <comments>
                            <comment id="17415242" author="ebadger" created="Tue, 14 Sep 2021 23:26:41 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.1:testCompile (default-testCompile) on project hadoop-client-integration-tests: Compilation failure: Compilation failure:
[ERROR] /home/ebadger/apachehadoop/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseHadoopCodecs.java:[34,28] cannot find symbol
[ERROR]   symbol:   class RandomDatum
[ERROR]   location: package org.apache.hadoop.io
[ERROR] /home/ebadger/apachehadoop/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseHadoopCodecs.java:[100,16] package RandomDatum does not exist
[ERROR] /home/ebadger/apachehadoop/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseHadoopCodecs.java:[100,54] package RandomDatum does not exist
[ERROR] /home/ebadger/apachehadoop/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseHadoopCodecs.java:[103,7] cannot find symbol
[ERROR]   symbol:   class RandomDatum
[ERROR]   location: class org.apache.hadoop.example.ITUseHadoopCodecs
[ERROR] /home/ebadger/apachehadoop/hadoop-client-modules/hadoop-client-integration-tests/src/test/java/org/apache/hadoop/example/ITUseHadoopCodecs.java:[104,7] cannot find symbol
[ERROR]   symbol:   class RandomDatum
[ERROR]   location: class org.apache.hadoop.example.ITUseHadoopCodecs
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;, this PR broke compilation for me on trunk. Reverting the patch locally has allowed me to compile&lt;/p&gt;</comment>
                            <comment id="17415245" author="csun" created="Tue, 14 Sep 2021 23:33:59 +0000"  >&lt;p&gt;Hmm interesting, I checked the yetus result and it&apos;s a +1 there.&lt;/p&gt;</comment>
                            <comment id="17415246" author="ebadger" created="Tue, 14 Sep 2021 23:35:23 +0000"  >&lt;p&gt;Yea, I&apos;m not sure what happened. Might be a dependency issue since I did a clean build and cleared out a bunch of things before compiling.&lt;/p&gt;</comment>
                            <comment id="17415252" author="csun" created="Tue, 14 Sep 2021 23:42:12 +0000"  >&lt;p&gt;Could you share your build command? I just did &lt;tt&gt;mvn clean install -DskipTests&lt;/tt&gt; and it worked for me.&lt;/p&gt;</comment>
                            <comment id="17415261" author="viirya" created="Wed, 15 Sep 2021 00:11:33 +0000"  >&lt;p&gt;Yea, I also verified it locally. It also passed CI before.&lt;/p&gt;</comment>
                            <comment id="17415665" author="ebadger" created="Wed, 15 Sep 2021 17:53:01 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;mvn clean install -Pdist,native -Dtar -Danimal.sniffer.skip -DskipTests -DskipShade -Dmaven.javadoc.skip
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This command fails for me on trunk&lt;/p&gt;</comment>
                            <comment id="17415713" author="viirya" created="Wed, 15 Sep 2021 19:37:18 +0000"  >&lt;p&gt;Trying to reproduce it locally.&lt;/p&gt;</comment>
                            <comment id="17415717" author="ebadger" created="Wed, 15 Sep 2021 19:45:21 +0000"  >&lt;p&gt;Looks like the issue manifests when adding the &lt;tt&gt;-DskipShade&lt;/tt&gt; flag&lt;/p&gt;</comment>
                            <comment id="17415739" author="ayushtkn" created="Wed, 15 Sep 2021 20:24:22 +0000"  >&lt;p&gt;The build is failing for me as well. I tried to fix it, Attached  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13033611/13033611_HADOOP-17891-Addendum-01.patch&quot; title=&quot;HADOOP-17891-Addendum-01.patch attached to HADOOP-17891&quot;&gt;HADOOP-17891-Addendum-01.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; Which fixes it for me. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ebadger&quot; class=&quot;user-hover&quot; rel=&quot;ebadger&quot;&gt;ebadger&lt;/a&gt; Give a try, If it solves for you as well&lt;/p&gt;</comment>
                            <comment id="17415752" author="csun" created="Wed, 15 Sep 2021 20:52:27 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ebadger&quot; class=&quot;user-hover&quot; rel=&quot;ebadger&quot;&gt;ebadger&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ayushtkn&quot; class=&quot;user-hover&quot; rel=&quot;ayushtkn&quot;&gt;ayushtkn&lt;/a&gt;! sorry for introducing the bug. We had a test in the PR but it mis-used &lt;tt&gt;noshade&lt;/tt&gt; for &lt;tt&gt;skipShade&lt;/tt&gt; and didn&apos;t catch it. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=viirya&quot; class=&quot;user-hover&quot; rel=&quot;viirya&quot;&gt;viirya&lt;/a&gt;: do you mind open another PR to address the issue. You can follow the format of this: &lt;a href=&quot;https://github.com/apache/hadoop/pull/3276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/pull/3276&lt;/a&gt;. Thanks.&lt;/p&gt;</comment>
                            <comment id="17418361" author="ivan.sadikov" created="Wed, 22 Sep 2021 00:15:18 +0000"  >&lt;p&gt;I am also seeing this issue&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.NoClassDefFoundError: org/apache/hadoop/shaded/net/jpountz/lz4/LZ4Factory
	at org.apache.hadoop.io.compress.lz4.Lz4Compressor.&amp;lt;init&amp;gt;(Lz4Compressor.java:66)
	at org.apache.hadoop.io.compress.Lz4Codec.createCompressor(Lz4Codec.java:119)
	at org.apache.hadoop.io.compress.CodecPool.getCompressor(CodecPool.java:152)
	at org.apache.hadoop.io.compress.CodecPool.getCompressor(CodecPool.java:168)
	at org.apache.parquet.hadoop.CodecFactory$HeapBytesCompressor.&amp;lt;init&amp;gt;(CodecFactory.java:146) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;when using hadoop-client-runtime 3.3.1 although the jar does not seem to contain any of such shaded classes:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
jar tf hadoop-client-runtime-3.3.1.jar| grep jpountz &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;returns empty result.&lt;/p&gt;

&lt;p&gt;Is there a timeline on when the fix will be available in maven? Thanks.&lt;/p&gt;</comment>
                            <comment id="17418362" author="csun" created="Wed, 22 Sep 2021 00:26:29 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ivan.sadikov&quot; class=&quot;user-hover&quot; rel=&quot;ivan.sadikov&quot;&gt;ivan.sadikov&lt;/a&gt;, it should be fixed in the upcoming Hadoop 3.3.2 release. I plan to work on it soon. Feel free to subscribe to common-dev@hadoop.apache.org for update on this.&lt;/p&gt;</comment>
                            <comment id="17418363" author="csun" created="Wed, 22 Sep 2021 00:28:44 +0000"  >&lt;p&gt;Also check &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-36669&quot; title=&quot;Fail to load Lz4 codec&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-36669&quot;&gt;&lt;del&gt;SPARK-36669&lt;/del&gt;&lt;/a&gt; for a workaround on this (linked to this JIRA).&lt;/p&gt;</comment>
                            <comment id="17418364" author="ivan.sadikov" created="Wed, 22 Sep 2021 00:35:30 +0000"  >&lt;p&gt;Oh, nice! Thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13401591">HADOOP-17916</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13399698">SPARK-36681</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13399417">SPARK-36669</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13316391">HADOOP-17125</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13330019">HADOOP-17292</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13033611" name="HADOOP-17891-Addendum-01.patch" size="933" author="ayushtkn" created="Wed, 15 Sep 2021 20:23:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0umds:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="12346894">3.4.0</customfieldvalue>
    <customfieldvalue id="12350181">3.3.2</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>