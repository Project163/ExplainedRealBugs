<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:55:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-16461] Regression: FileSystem cache lock parses XML within the lock</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-16461</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hadoop/blob/2546e6ece240924af2188bb39b3954a4896e4a4f/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/FileSystem.java#L3388&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/2546e6ece240924af2188bb39b3954a4896e4a4f/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/FileSystem.java#L3388&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      fs = createFileSystem(uri, conf);
      &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;) { &lt;span class=&quot;code-comment&quot;&gt;// refetch the lock again
&lt;/span&gt;        FileSystem oldfs = map.get(key);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (oldfs != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) { &lt;span class=&quot;code-comment&quot;&gt;// a file system is created &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; lock is releasing
&lt;/span&gt;          fs.close(); &lt;span class=&quot;code-comment&quot;&gt;// close the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; file system
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; oldfs;  &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the old file system
&lt;/span&gt;        }

        &lt;span class=&quot;code-comment&quot;&gt;// now insert the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; file system into the map
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (map.isEmpty()
                &amp;amp;&amp;amp; !ShutdownHookManager.get().isShutdownInProgress()) {
          ShutdownHookManager.get().addShutdownHook(clientFinalizer, SHUTDOWN_HOOK_PRIORITY);
        }
        fs.key = key;
        map.put(key, fs);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (conf.getBoolean(
            FS_AUTOMATIC_CLOSE_KEY, FS_AUTOMATIC_CLOSE_DEFAULT)) {
          toAutoClose.add(key);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; fs;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The lock now has a ShutdownHook creation, which ends up doing &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/hadoop/blob/2546e6ece240924af2188bb39b3954a4896e4a4f/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/ShutdownHookManager.java#L205&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/hadoop/blob/2546e6ece240924af2188bb39b3954a4896e4a4f/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/ShutdownHookManager.java#L205&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    HookEntry(&lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt; hook, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; priority) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(hook, priority,
          getShutdownTimeout(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Configuration()),
          TIME_UNIT_DEFAULT);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which ends up doing a &quot;new Configuration()&quot; within the locked section.&lt;/p&gt;

&lt;p&gt;This indirectly hurts the cache hit scenarios as well, since if the lock on this is held, then the other section cannot be entered either.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/tez/blob/master/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/sort/impl/TezSpillRecord.java#L65&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tez/blob/master/tez-runtime-library/src/main/java/org/apache/tez/runtime/library/common/sort/impl/TezSpillRecord.java#L65&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
I/O Setup 0 State: BLOCKED CPU usage on sample: 6ms
org.apache.hadoop.fs.FileSystem$Cache.getInternal(URI, Configuration, FileSystem$Cache$Key) FileSystem.java:3345
org.apache.hadoop.fs.FileSystem$Cache.get(URI, Configuration) FileSystem.java:3320
org.apache.hadoop.fs.FileSystem.get(URI, Configuration) FileSystem.java:479
org.apache.hadoop.fs.FileSystem.getLocal(Configuration) FileSystem.java:435
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;slowing down the RawLocalFileSystem when there are other threads creating HDFS FileSystem objects at the same time.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13246917">HADOOP-16461</key>
            <summary>Regression: FileSystem cache lock parses XML within the lock</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gopalv">Gopal Vijayaraghavan</assignee>
                                    <reporter username="gopalv">Gopal Vijayaraghavan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Jul 2019 21:53:03 +0000</created>
                <updated>Tue, 1 Oct 2019 00:06:38 +0000</updated>
                            <resolved>Fri, 26 Jul 2019 10:35:00 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                    <fixVersion>3.1.4</fixVersion>
                    <fixVersion>3.2.2</fixVersion>
                                    <component>fs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="16892245" author="stevel@apache.org" created="Wed, 24 Jul 2019 22:27:42 +0000"  >&lt;p&gt;gopal, can you give us files &amp;amp; lines rather than just code snippets. thanks&lt;/p&gt;</comment>
                            <comment id="16892278" author="gopalv" created="Wed, 24 Jul 2019 23:44:55 +0000"  >&lt;p&gt;Linked the lines up and opened a PR.&lt;/p&gt;</comment>
                            <comment id="16893714" author="hudson" created="Fri, 26 Jul 2019 10:33:42 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build Hadoop-trunk-Commit #16992 (See &lt;a href=&quot;https://builds.apache.org/job/Hadoop-trunk-Commit/16992/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Hadoop-trunk-Commit/16992/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-16461&quot; title=&quot;Regression: FileSystem cache lock parses XML within the lock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-16461&quot;&gt;&lt;del&gt;HADOOP-16461&lt;/del&gt;&lt;/a&gt;. Regression: FileSystem cache lock parses XML within the (stevel: rev aebac6d2d2e612e400a7d73be67dafb47e239211)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/fs/FileSystem.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16893716" author="stevel@apache.org" created="Fri, 26 Jul 2019 10:35:00 +0000"  >&lt;p&gt;+1, committed&lt;/p&gt;

&lt;p&gt;if this affects earlier branches, let  me know &amp;amp; Ill cherry pick&lt;/p&gt;</comment>
                            <comment id="16941416" author="jojochuang" created="Tue, 1 Oct 2019 00:01:27 +0000"  >&lt;p&gt;Commit applies to branch-3.2 and branch-3.1.&lt;br/&gt;
I&apos;ll cherry pick the commit into these two branches.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13179254">HADOOP-15679</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z04zxk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>