<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:34:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HADOOP-7322] Adding a util method in FileUtil for JDK File.listFiles</title>
                <link>https://issues.apache.org/jira/browse/HADOOP-7322</link>
                <project id="12310240" key="HADOOP">Hadoop Common</project>
                    <description>&lt;p&gt;While testing Disk Fail Inplace, we encountered lots of NPE from Dir.listFiles API. This API can return null when Dir is not directory or disk is bad. I am proposing to have a File Util which can be used consistently across to deal with disk issues. This util api will do the following:&lt;/p&gt;

&lt;p&gt;1. When error happens it will throw IOException&lt;br/&gt;
2. Else it will return empty list or list of files.&lt;/p&gt;

&lt;p&gt;Signature:&lt;br/&gt;
File[] FileUtil.listFiles(File dir) throws IOException {}&lt;/p&gt;

&lt;p&gt;This way we no need to write wrapper code every where. Also, API is consistent with the signature.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12508108">HADOOP-7322</key>
            <summary>Adding a util method in FileUtil for JDK File.listFiles</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bharathm">Bharath Mundlapudi</assignee>
                                    <reporter username="bharathm">Bharath Mundlapudi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 May 2011 21:56:13 +0000</created>
                <updated>Thu, 2 May 2013 02:29:41 +0000</updated>
                            <resolved>Wed, 25 May 2011 21:55:58 +0000</resolved>
                                                    <fixVersion>0.23.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13038878" author="mattf" created="Tue, 24 May 2011 23:12:45 +0000"  >&lt;p&gt;Hi Bharath,&lt;br/&gt;
1. suggest javadoc comment for FileUtil.listFiles() to read:&lt;br/&gt;
+   * A wrapper for &lt;/p&gt;
{@link File#listFiles()}
&lt;p&gt;. This java.io API returns null &lt;br/&gt;
+   * when dir is not directory or for any I/O error. Instead of having to&lt;br/&gt;
+   * null check everywhere File#listFiles() is used, we will add this utility &lt;br/&gt;
+   * api to get around this problem, for the majority of cases where we prefer&lt;br/&gt;
+   * an IOException to be thrown.&lt;/p&gt;

&lt;p&gt;2. Not sure about the change to RunJar.main().  Isn&apos;t jar extraction usually pretty forgiving?  It is currently written to skip any directory it can&apos;t read.  Can you please give an argument for why that&apos;s wrong?&lt;/p&gt;

&lt;p&gt;3. In the last line of testlistFiles(), to assure that the referenced directory can&apos;t possibly exist, why not use the same name as the directory you just deleted in the previous line?  Maybe after asserting:&lt;br/&gt;
Assert.assertTrue(&quot;Failed to delete test dir&quot;, !newDir.exists());&lt;/p&gt;</comment>
                            <comment id="13038895" author="bharathm" created="Wed, 25 May 2011 00:31:02 +0000"  >&lt;p&gt;Thanks for the comments, Matt. &lt;/p&gt;

&lt;p&gt;Regarding 2: Yes, we can be forgiving on this case. I added this because of eliminating null check. &lt;/p&gt;

&lt;p&gt;Attaching a patch which addresses all these comments. &lt;/p&gt;</comment>
                            <comment id="13038908" author="mattf" created="Wed, 25 May 2011 01:22:45 +0000"  >&lt;p&gt;Thanks, Bharath.  Unfortunately I have one more item.  Looking more at testlistFiles(), there are many calls that could cause an IOException, but only the last one should be an allowed IOException.  Therefore, I think we have to remove the &quot;expected=IOException.class&quot; from the @Test annotation, and instead use the idiom:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
  files = FileUtil.listFiles(newDir);
  fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;IOException expected on listFiles() &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; non-existent dir &quot;&lt;/span&gt; + newDir.getString());
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
  &lt;span class=&quot;code-comment&quot;&gt;//expected
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13038999" author="bharathm" created="Wed, 25 May 2011 07:34:08 +0000"  >&lt;p&gt;Not a problem. I have updated the testcase.&lt;/p&gt;</comment>
                            <comment id="13039009" author="hadoopqa" created="Wed, 25 May 2011 07:57:53 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12480373/HADOOP-7322-3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12480373/HADOOP-7322-3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision 1127215.&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    +1 system test framework.  The patch passed system test framework compile.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-HADOOP-Build/523//testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-HADOOP-Build/523//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-HADOOP-Build/523//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-HADOOP-Build/523//artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/hudson/job/PreCommit-HADOOP-Build/523//console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/PreCommit-HADOOP-Build/523//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13039362" author="mattf" created="Wed, 25 May 2011 21:55:58 +0000"  >&lt;p&gt;+1.  Committed to trunk.  Thanks, Bharath!&lt;/p&gt;</comment>
                            <comment id="13039376" author="hudson" created="Wed, 25 May 2011 22:14:35 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk-Commit #622 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Hadoop-Common-trunk-Commit/622/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Hadoop-Common-trunk-Commit/622/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7322&quot; title=&quot;Adding a util method in FileUtil for JDK File.listFiles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7322&quot;&gt;&lt;del&gt;HADOOP-7322&lt;/del&gt;&lt;/a&gt;. Adding a util method in FileUtil for directory listing, avoid NPEs on File.listFiles(). Contributed by Bharath Mundlapudi.&lt;/p&gt;

&lt;p&gt;mattf : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1127697&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1127697&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/src/java/org/apache/hadoop/fs/RawLocalFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/src/java/org/apache/hadoop/fs/FileUtil.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/src/test/core/org/apache/hadoop/fs/TestFileUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13039683" author="hudson" created="Thu, 26 May 2011 12:38:22 +0000"  >&lt;p&gt;Integrated in Hadoop-Common-trunk #700 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/Hadoop-Common-trunk/700/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/hudson/job/Hadoop-Common-trunk/700/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7322&quot; title=&quot;Adding a util method in FileUtil for JDK File.listFiles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7322&quot;&gt;&lt;del&gt;HADOOP-7322&lt;/del&gt;&lt;/a&gt;. Adding a util method in FileUtil for directory listing, avoid NPEs on File.listFiles(). Contributed by Bharath Mundlapudi.&lt;/p&gt;

&lt;p&gt;mattf : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1127697&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1127697&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hadoop/common/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/src/java/org/apache/hadoop/fs/RawLocalFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/src/java/org/apache/hadoop/fs/FileUtil.java&lt;/li&gt;
	&lt;li&gt;/hadoop/common/trunk/src/test/core/org/apache/hadoop/fs/TestFileUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12507073">HDFS-1934</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12497098">HDFS-2137</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12509031">HDFS-2023</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12480313" name="HADOOP-7322-1.patch" size="4234" author="bharathm" created="Tue, 24 May 2011 20:39:24 +0000"/>
                            <attachment id="12480342" name="HADOOP-7322-2.patch" size="3559" author="bharathm" created="Wed, 25 May 2011 00:31:02 +0000"/>
                            <attachment id="12480373" name="HADOOP-7322-3.patch" size="3725" author="bharathm" created="Wed, 25 May 2011 07:34:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72122</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i09jxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>53663</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Use of this new utility method avoids null result from File.listFiles(), and consequent NPEs.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>