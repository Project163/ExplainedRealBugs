{"url":"https://api.github.com/repos/SeaQL/sea-orm/issues/2409","repository_url":"https://api.github.com/repos/SeaQL/sea-orm","labels_url":"https://api.github.com/repos/SeaQL/sea-orm/issues/2409/labels{/name}","comments_url":"https://api.github.com/repos/SeaQL/sea-orm/issues/2409/comments","events_url":"https://api.github.com/repos/SeaQL/sea-orm/issues/2409/events","html_url":"https://github.com/SeaQL/sea-orm/issues/2409","id":2640170078,"node_id":"I_kwDOFBsj186dXcxe","number":2409,"title":"Generate entities: RcOrArc<ColumnDef> passed for ColumnType::Array","user":{"login":"pranc1ngpegasus","id":23367170,"node_id":"MDQ6VXNlcjIzMzY3MTcw","avatar_url":"https://avatars.githubusercontent.com/u/23367170?v=4","gravatar_id":"","url":"https://api.github.com/users/pranc1ngpegasus","html_url":"https://github.com/pranc1ngpegasus","followers_url":"https://api.github.com/users/pranc1ngpegasus/followers","following_url":"https://api.github.com/users/pranc1ngpegasus/following{/other_user}","gists_url":"https://api.github.com/users/pranc1ngpegasus/gists{/gist_id}","starred_url":"https://api.github.com/users/pranc1ngpegasus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pranc1ngpegasus/subscriptions","organizations_url":"https://api.github.com/users/pranc1ngpegasus/orgs","repos_url":"https://api.github.com/users/pranc1ngpegasus/repos","events_url":"https://api.github.com/users/pranc1ngpegasus/events{/privacy}","received_events_url":"https://api.github.com/users/pranc1ngpegasus/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2024-11-07T07:45:22Z","updated_at":"2025-03-30T13:39:45Z","closed_at":"2025-03-30T13:39:45Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n\r\nWelcome! Thank you for reporting bugs!\r\n\r\nFirst of all, please star our repo. Your support is vital to the continued maintenance of SeaORM.\r\n\r\nWant to ask a question? You can reach us via:\r\n\r\n- Discord: https://discord.com/invite/uCPdDXzbdv\r\n- GitHub Discussions: https://github.com/SeaQL/sea-orm/discussions/new\r\n\r\nPlease make sure that you are not asking for a missing feature; a bug is incorrect behavior -\r\neither in the feature specification or implementation. Feature requests should be first raised in discussions.\r\n\r\nPlease also make sure your description is clear and precise - maintainers don't have access to your\r\ncode and can't see what you have seen. Please avoid vague descriptions like \"they are different\"\r\nor \"the program crashes\" - in either case, provide exact information.\r\n\r\nIf you are certain there is a bug, please provide a reproducible example, which helps the investigator\r\nto pin-point the bug and the implementor to verify that a solution is satisfactory. Bug reports without \r\nreproducible example may be closed immediately or dangle forever.\r\n\r\nFinally, please search for existing issues and discussions before submission. Feel free to revive old\r\nthreads if you have new information to add, but please don't ask for ETA or \"+1\".\r\n\r\n-->\r\n\r\n## Description\r\n\r\nI ran `sea-orm-cli generate entity` and generated Rust code does not compile:\r\n```shell\r\nerror[E0308]: mismatched types\r\n   --> entities/src/gen/foo.rs:<line>:<col>\r\n    |\r\n69  |             Self::FooBar => ColumnType::Array(RcOrArc::new(BarBaz::db_type())).def(),\r\n    |                                              ------------ ^^^^^^^^^^^^^^^^^^^^^ expected `ColumnType`, found `ColumnDef`\r\n    |                                              |\r\n    |                                              arguments to this function are incorrect\r\n    |\r\n```\r\n\r\n<!-- Briefly describe the bug -->\r\n\r\n## Steps to Reproduce\r\n\r\n1. Have a enum of any type\r\n2. Have a table with column of type `enum[]`\r\n3. Generate entities from the table\r\n4. Try to compile the generated Rust code\r\n\r\n### Expected Behavior\r\n\r\nCompiles\r\n\r\n<!-- What is expected to happen? -->\r\n\r\n### Actual Behavior\r\n\r\nNot compiles\r\n\r\n<!-- What actually happened? -->\r\n\r\n### Reproduces How Often\r\n\r\nConsistent\r\n\r\n<!-- Is it always reproducible? -->\r\n\r\n### Workarounds\r\n\r\nEdit generated code like this:\r\n\r\n```diff\r\n-use sea_orm::entity::prelude::*;\r\n+use sea_orm::{entity::prelude::*, sea_query::ValueType};\r\n\r\n #[derive(Copy, Clone, Default, Debug, DeriveEntity)]\r\n@@ -66,7 +66,7 @@ impl ColumnTrait for Column {\r\n-            Self::FooBar => ColumnType::Array(RcOrArc::new(BarBaz::db_type())).def(),\r\n+            Self::FooBar => ColumnType::Array(RcOrArc::new(BarBaz::column_type())).def(),\r\n\r\n```\r\n\r\nOf course it will be overwritten when we re-generate Rust code :(\r\n\r\n<!-- What experiments have you done to understand / workaround the bug? -->\r\n\r\n## Reproducible Example\r\n\r\nmigration file:\r\n\r\n```rust\r\n#[derive(Iden)]\r\npub enum BarBaz {\r\n  #[iden = \"bar_baz\"]\r\n  Enum,\r\n  #[iden = \"variant_1\"]\r\n  Variant1,\r\n}\r\n\r\nmanager\r\n    .create_type(\r\n        extension::postgres::Type::create()\r\n            .as_enum(BarBaz::Enum)\r\n            .values([\r\n                BarBaz::Variant1,\r\n            ])\r\n            .to_owned(),\r\n    )\r\n    .await?;\r\n\r\nmanager\r\n    .create_table(\r\n        Table::create()\r\n            .table(Foo::Table)\r\n            .if_not_exists()\r\n            .col(\r\n                ColumnDef::new(Foo::FooBar)\r\n                    .custom(Alias::new(\"bar_baz[]\"))\r\n                    .not_null(),\r\n            )\r\n            .to_owned(),\r\n    )\r\n    .await?;\r\n```\r\n\r\n<!-- Please add a minimal reproducible example under https://github.com/SeaQL/sea-orm/tree/master/issues, and open a PR subsequently. -->\r\n\r\n## Versions\r\n\r\n```\r\n$ cargo tree | grep sea-orm\r\n│   ├── sea-orm v1.1.1\r\n│   │   ├── sea-orm-macros v1.1.1 (proc-macro)\r\n│   ├── sea-orm v1.1.1 (*)\r\n│   ├── sea-orm v1.1.1 (*)\r\n│   │   └── sea-orm-migration v1.1.1\r\n│   │       ├── sea-orm v1.1.1 (*)\r\n│   │       ├── sea-orm-cli v1.1.1\r\n│   │   ├── sea-orm v1.1.1 (*)\r\n├── sea-orm v1.1.1 (*)\r\n```\r\n\r\n<!-- You can get this information from the output of `cargo tree | grep sea-` from the console. Also, please include the database and OS that you are running. -->\r\n","closed_by":{"login":"tyt2y3","id":1782664,"node_id":"MDQ6VXNlcjE3ODI2NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1782664?v=4","gravatar_id":"","url":"https://api.github.com/users/tyt2y3","html_url":"https://github.com/tyt2y3","followers_url":"https://api.github.com/users/tyt2y3/followers","following_url":"https://api.github.com/users/tyt2y3/following{/other_user}","gists_url":"https://api.github.com/users/tyt2y3/gists{/gist_id}","starred_url":"https://api.github.com/users/tyt2y3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tyt2y3/subscriptions","organizations_url":"https://api.github.com/users/tyt2y3/orgs","repos_url":"https://api.github.com/users/tyt2y3/repos","events_url":"https://api.github.com/users/tyt2y3/events{/privacy}","received_events_url":"https://api.github.com/users/tyt2y3/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/SeaQL/sea-orm/issues/2409/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/SeaQL/sea-orm/issues/2409/timeline","performed_via_github_app":null,"state_reason":"completed"}