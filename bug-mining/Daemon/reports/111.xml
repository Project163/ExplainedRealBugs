<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:46:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DAEMON-412] Tomcat started as windows service does not support Java Native Memory Tracking feature probably because of improper JVM initialization by Procrun</title>
                <link>https://issues.apache.org/jira/browse/DAEMON-412</link>
                <project id="12310468" key="DAEMON">Commons Daemon</project>
                    <description>&lt;p&gt;In the case the user specifies some from the the NativeMemoryTracking parameters (see &lt;br/&gt;
&lt;a href=&quot;https://docs.oracle.com/en/java/javase/11/vm/native-memory-tracking.html#GUID-0DB3B8D1-8D7D-447F-B6FF-15620103EE47&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/en/java/javase/11/vm/native-memory-tracking.html#GUID-0DB3B8D1-8D7D-447F-B6FF-15620103EE47&#160;&lt;/a&gt;&lt;br/&gt;
) like &lt;/p&gt;

&lt;p&gt;-XX:NativeMemoryTracking=summary&lt;/p&gt;

&lt;p&gt;in Windows service registry, restarts the service, so the option can be seen in the log file by the startup options (for example in Tomcat logs like catalina.log), then the Native memory tracking is still disabled and does not work. If you try with&lt;/p&gt;

&lt;p&gt;jcmd &amp;lt;pid&amp;gt; VM.native_memory summary&lt;/p&gt;

&lt;p&gt;to get the information about the native JVM memory in the tomcats JVM, the jcmd call fails with the message&lt;/p&gt;

&lt;p&gt;&amp;lt;pid&amp;gt;:&lt;br/&gt;
Native memory tracking is not enabled&lt;/p&gt;

&lt;p&gt;and in the Tomcat&apos;s log file can be found following error message:&lt;/p&gt;

&lt;p&gt;Java HotSpot(TM) 64-Bit Server VM warning: Native Memory Tracking did not setup properly, using wrong launcher? &lt;/p&gt;

&lt;p&gt;The problem seems to be in the JVM launcher Procrun, which dies not initialize the JVM properly - as far as I have understood from this blog: &lt;br/&gt;
&lt;a href=&quot;https://blogs.oracle.com/poonam/using-nmt-with-custom-jvm-launcher&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://blogs.oracle.com/poonam/using-nmt-with-custom-jvm-launcher &lt;/a&gt;&lt;br/&gt;
The Procrun.exe has to define some environment variable before the start of JVM, etc. to get the native memory tracking to work.&lt;/p&gt;

&lt;p&gt;Known workaround is the start of Tomcat from the command line, but this is no option in the productive environment, where you have to let the service run for longer time to collect the proper result and maybe also as some different user because of security concerns, then such option is simply out of possible scenarios. So the Tomcat service JVM cannot be in such circumstances tracked by NMT at all, what is the problem in the mission-critical applications.&lt;/p&gt;

&lt;p&gt;The Procrun should be modified in the way it enables the NMT in the windows service by the startup, by setting the environment variable &lt;br/&gt;
NMT_LEVEL_&amp;lt;pid&amp;gt; to the value &quot;detail&quot; or &quot;summary&quot; (or &quot;off&quot; if unspecified) in the dependency on the specified or unspecified option of &lt;br/&gt;
-XX:NativeMemoryTracking&lt;br/&gt;
like done normally by java.exe&lt;br/&gt;
Remark: Also change of the startup mode from &quot;jvm&quot; to &quot;exe&quot; or &quot;java&quot; does not help,. then the windows service does not start at all.&lt;/p&gt;

&lt;p&gt;See also the Tomcat bug &lt;br/&gt;
&lt;a href=&quot;https://bz.apache.org/bugzilla/show_bug.cgi?id=63922&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bz.apache.org/bugzilla/show_bug.cgi?id=63922&lt;/a&gt;&lt;br/&gt;
which has been qualified as invalid because the problem seems to be in is in PROCRUN.&lt;/p&gt;

&lt;p&gt;See also the bug &lt;a href=&quot;https://issues.apache.org/jira/browse/TOMEE-2738&quot; title=&quot;TomEE windows service does not support Java Native Memory Tracking feature&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TOMEE-2738&quot;&gt;TOMEE-2738&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This will probably affect every java app handled by the Procrun Daemon, if installed and started as Windows service, not only Tomcat.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows generally (tested on Windows Server 2012 R2 but the problem occurs probably, like the user in the internet write, on every Windows version)&lt;/p&gt;</environment>
        <key id="13268058">DAEMON-412</key>
            <summary>Tomcat started as windows service does not support Java Native Memory Tracking feature probably because of improper JVM initialization by Procrun</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="goodwin">Artur Linhart</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Nov 2019 15:31:10 +0000</created>
                <updated>Mon, 3 May 2021 16:09:36 +0000</updated>
                            <resolved>Mon, 24 Aug 2020 21:07:49 +0000</resolved>
                                                    <fixVersion>1.2.3</fixVersion>
                                    <component>Procrun</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16980799" author="markt" created="Sat, 23 Nov 2019 16:07:29 +0000"  >&lt;p&gt;You can use native memory tracking with procrun if you use the Java start mode rather than jvm. exe mode should also work as well.&lt;/p&gt;

&lt;p&gt;procrun in jvm mode and jsvc will need some changes to get this to work.&lt;/p&gt;</comment>
                            <comment id="16980858" author="goodwin" created="Sat, 23 Nov 2019 19:40:34 +0000"  >&lt;p&gt;Thank you for pointer - but I have tried the exe mode and was unable to start the service at all... I had same problem also with java mode - we do not use JDK in production (only JRE), this is possibly the problem why are both exe and java mode unavailable to us...&lt;/p&gt;</comment>
                            <comment id="17183513" author="markt" created="Mon, 24 Aug 2020 18:07:12 +0000"  >&lt;p&gt;Just to (re-)confirm (tested with latest Apache Tomcat) that NMT does work when starting in java mode. If an application doesn&apos;t start in Java mode that is a separate, unrelated issue.&lt;/p&gt;

&lt;p&gt;It is jvm mode where changes are required. I am working on this now.&lt;/p&gt;</comment>
                            <comment id="17183599" author="markt" created="Mon, 24 Aug 2020 21:07:49 +0000"  >&lt;p&gt;This has been implemented (and tested) for Procrun and jsvc.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13376144">DAEMON-433</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08khc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>