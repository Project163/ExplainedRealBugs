<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:45:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DAEMON-190] Service startup fails at boot time on Windows</title>
                <link>https://issues.apache.org/jira/browse/DAEMON-190</link>
                <project id="12310468" key="DAEMON">Commons Daemon</project>
                    <description>&lt;p&gt;Tomcat 6.0.x (a dev build) with Commons-Daemon 2.0.4 was installed and configured to autostart. The problem is that the service fails to start. After the system starts up the service is in stopped state.&lt;/p&gt;

&lt;p&gt;I do not use the PidFile setting (it is blank).&lt;/p&gt;

&lt;p&gt;If I start the service manually, it starts successfully.&lt;/p&gt;

&lt;p&gt;I configured prunsrv logging level to be Debug, and here is what is observed during boot time:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1493) Commons Daemon procrun log initialized&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Commons Daemon procrun (1.0.4.0 32-bit) started&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Running &apos;Tomcat6&apos; Service...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1241) Inside ServiceMain...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Starting service...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:191 ) loading jvm &apos;C:\Program Files\Java\jre6\bin\client\jvm.dll&apos;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:27&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; -Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 6.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:27&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; -Dcatalina.base=C:\Program Files\Apache Software Foundation\Tomcat 6.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:27&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; -Djava.endorsed.dirs=C:\Program Files\Apache Software Foundation\Tomcat 6.0\endorsed&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:28&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; -Djava.io.tmpdir=C:\Program Files\Apache Software Foundation\Tomcat 6.0\temp&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:28&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt; -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:28&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt; -Djava.util.logging.config.file=C:\Program Files\Apache Software Foundation\Tomcat 6.0\conf\logging.properties&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:28&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;6&amp;#93;&lt;/span&gt; -Djava.class.path=C:\Program Files\Apache Software Foundation\Tomcat 6.0\bin\bootstrap.jar&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:28&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1054) Java started org/apache/catalina/startup/Bootstrap&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:29&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Service started in 3781 ms.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:30&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1364) Waiting for worker to finish...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:30&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1369) Worker finished.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:31&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1392) Waiting for all threads to exit&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:31&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1396) JVM destroyed.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:45&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:827 ) argv&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = start&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:45&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:874 ) Java Worker thread started org/apache/catalina/startup/Bootstrap:main&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:45&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Run service finished.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:14:46&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Commons Daemon procrun finished&lt;/p&gt;

&lt;p&gt;There is nothing in Tomcat logs, nor in stderr/stdout logs, besides &quot;Commons Daemon procrun stderr initialized&quot; or ..stdout... messages.  The odd thing is that &quot;Worker finished.&quot; message above.&lt;/p&gt;

&lt;p&gt;Here is another failed startup at boot time:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:18&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1493) Commons Daemon procrun log initialized&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:19&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Commons Daemon procrun (1.0.4.0 32-bit) started&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:19&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Running &apos;Tomcat6&apos; Service...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:19&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1241) Inside ServiceMain...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:19&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Starting service...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:20&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:191 ) loading jvm &apos;C:\Program Files\Java\jre6\bin\client\jvm.dll&apos;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:21&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; -Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 6.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:21&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; -Dcatalina.base=C:\Program Files\Apache Software Foundation\Tomcat 6.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:21&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; -Djava.endorsed.dirs=C:\Program Files\Apache Software Foundation\Tomcat 6.0\endorsed&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:22&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; -Djava.io.tmpdir=C:\Program Files\Apache Software Foundation\Tomcat 6.0\temp&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:22&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt; -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:22&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt; -Djava.util.logging.config.file=C:\Program Files\Apache Software Foundation\Tomcat 6.0\conf\logging.properties&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:23&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;6&amp;#93;&lt;/span&gt; -Djava.class.path=C:\Program Files\Apache Software Foundation\Tomcat 6.0\bin\bootstrap.jar&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:22&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1054) Java started org/apache/catalina/startup/Bootstrap&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:24&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Service started in 3375 ms.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:24&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1364) Waiting for worker to finish...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:24&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1369) Worker finished.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1392) Waiting for all threads to exit&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:24&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:827 ) argv&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = start&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:02:26&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:889 ) Java Worker thread finished org/apache/catalina/startup/Bootstrap:main with status=3&lt;/p&gt;


&lt;p&gt;For reference, here is successful startup when I start the service manually from prunmgr&apos;s menu:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1493) Commons Daemon procrun log initialized&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Commons Daemon procrun (1.0.4.0 32-bit) started&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Running &apos;Tomcat6&apos; Service...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1241) Inside ServiceMain...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Starting service...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:191 ) loading jvm &apos;C:\Program Files\Java\jre6\bin\client\jvm.dll&apos;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; -Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 6.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; -Dcatalina.base=C:\Program Files\Apache Software Foundation\Tomcat 6.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; -Djava.endorsed.dirs=C:\Program Files\Apache Software Foundation\Tomcat 6.0\endorsed&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; -Djava.io.tmpdir=C:\Program Files\Apache Software Foundation\Tomcat 6.0\temp&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt; -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt; -Djava.util.logging.config.file=C:\Program Files\Apache Software Foundation\Tomcat 6.0\conf\logging.properties&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;6&amp;#93;&lt;/span&gt; -Djava.class.path=C:\Program Files\Apache Software Foundation\Tomcat 6.0\bin\bootstrap.jar&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:827 ) argv&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = start&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:25&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:874 ) Java Worker thread started org/apache/catalina/startup/Bootstrap:main&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:26&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1054) Java started org/apache/catalina/startup/Bootstrap&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:26&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Service started in 1062 ms.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-20 15:44:26&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1364) Waiting for worker to finish...&lt;/p&gt;

&lt;p&gt;I originally observed this issue on a WinXP SP3 32-bit system. I am able to reproduce it on another system running the same OS, and on Windows 7 running 64-bit version of procrun.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP SP3 32-bit, Oracle JRE 6u22, Trying to run Tomcat 6.0.x (dev build).&lt;/p&gt;</environment>
        <key id="12493672">DAEMON-190</key>
            <summary>Service startup fails at boot time on Windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mturk@apache.org">Mladen Turk</assignee>
                                    <reporter username="kkolinko">Konstantin Kolinko</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Dec 2010 13:07:18 +0000</created>
                <updated>Mon, 10 Jan 2011 20:49:14 +0000</updated>
                            <resolved>Tue, 4 Jan 2011 17:31:47 +0000</resolved>
                                    <version>1.0.4</version>
                                    <fixVersion>1.0.5</fixVersion>
                                    <component>Procrun</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12973216" author="mturk@apache.org" created="Mon, 20 Dec 2010 14:47:19 +0000"  >&lt;p&gt;Quick hack would be to add &apos;--DependsOn Tcpip#Afd&apos;&lt;br/&gt;
to the end of //IS//Tomcat6 both in service.bat and nsis script.&lt;/p&gt;

&lt;p&gt;However since those are system services procrun should be started after those.&lt;br/&gt;
The --DependsOn should be auto adjusted to include those two system services.&lt;br/&gt;
(Same thing like with Apache Httpd)&lt;/p&gt;

&lt;p&gt;I&apos;ll fix that and release 1.0.5 pretty soon&lt;/p&gt;

</comment>
                            <comment id="12973219" author="sebb@apache.org" created="Mon, 20 Dec 2010 15:03:08 +0000"  >&lt;p&gt;Just curious - why is no error being reported?&lt;/p&gt;

&lt;p&gt;Is that a bug in Tomcat or Daemon, or is it not possible to capture the error?&lt;/p&gt;</comment>
                            <comment id="12973223" author="mturk@apache.org" created="Mon, 20 Dec 2010 15:18:16 +0000"  >&lt;p&gt;It&apos;s not reported because JVM refuses to operate since Winsock is not up and running.&lt;br/&gt;
Daemon fails to attach to areated JVM which is reported as error(3) and shuts down.&lt;/p&gt;
</comment>
                            <comment id="12973224" author="sebb@apache.org" created="Mon, 20 Dec 2010 15:21:18 +0000"  >&lt;p&gt;If Daemon always includes Tcpip and Afd as dependencies, won&apos;t that restrict where it can be used?&lt;/p&gt;

&lt;p&gt;There might be other uses for Daemon that don&apos;t depend on Afd and Tcpip.&lt;/p&gt;</comment>
                            <comment id="12973228" author="mturk@apache.org" created="Mon, 20 Dec 2010 15:38:43 +0000"  >&lt;p&gt;Since JVM requires Winsock to operate, there could be no uses of Daemon not requiring that.&lt;br/&gt;
BTW, those services are always on. Dependencies only determine the order in which they are&lt;br/&gt;
started. Meaning: start Daemon after those services.&lt;/p&gt;</comment>
                            <comment id="12973290" author="sebb@apache.org" created="Mon, 20 Dec 2010 18:39:36 +0000"  >&lt;p&gt;I see.&lt;/p&gt;

&lt;p&gt;Since the JVM cannot start without AFP and TCPIP, there is no harm in adding the dependencies &lt;b&gt;when a JVM is being used&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;However, Daemon can also be used without Java, so unconditionally adding the dependencies potentially restricts when Daemon can be used.&lt;/p&gt;

&lt;p&gt;Agreed it&apos;s not all that likely to want to run Daemon if AFP and TCPIP are not (yet) running, but there could perhaps be a use case for such a service.&lt;/p&gt;</comment>
                            <comment id="12973308" author="mturk@apache.org" created="Mon, 20 Dec 2010 19:14:17 +0000"  >&lt;p&gt;AFP and TCPIP are not services. They are windows kernel drivers (aka linux kernel modules)&lt;br/&gt;
The only use case would be to use the daemon for running kernel mode drivers which is&lt;br/&gt;
hardly the sane use case.&lt;/p&gt;
</comment>
                            <comment id="12973326" author="sebb@apache.org" created="Mon, 20 Dec 2010 19:33:52 +0000"  >&lt;p&gt;Surely there could be a user service that needs to run even if AFP and TCPIP are not (yet) loaded?&lt;/p&gt;

&lt;p&gt;I don&apos;t see the point of limiting Daemon unnecessarily.&lt;/p&gt;</comment>
                            <comment id="12973366" author="mturk@apache.org" created="Mon, 20 Dec 2010 21:14:28 +0000"  >&lt;p&gt;Please explain how is that a limitation from technical perspective.&lt;/p&gt;</comment>
                            <comment id="12973369" author="sebb@apache.org" created="Mon, 20 Dec 2010 21:28:43 +0000"  >&lt;p&gt;It&apos;s possible for Windows to boot without loading AFP and TCPIP, either because they failed, or because they have been excluded from startup.&lt;/p&gt;

&lt;p&gt;In those cases, the Daemon service would not run, even though it could do so.&lt;/p&gt;</comment>
                            <comment id="12973486" author="mturk@apache.org" created="Tue, 21 Dec 2010 06:13:25 +0000"  >&lt;p&gt;They can be excluded only if booting in &quot;Safe Mode without Networking&quot; support.&lt;br/&gt;
Having operational Daemon (or any other production) service would be oxymoron in such environment.&lt;br/&gt;
Not to mention that user services cannot be started in safe mode.&lt;/p&gt;</comment>
                            <comment id="12973975" author="kkolinko" created="Tue, 21 Dec 2010 23:30:47 +0000"  >&lt;p&gt;I cannot confirm that this fixes this issue.&lt;br/&gt;
On a WinXP SP3 machine I used registry editor to set up those dependencies on Afd and Tcpip services, by creating the DependOnService registry value, as mentioned in &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; using Apache HTTPD service configuration as an example (it depends on the same two services).&lt;/p&gt;

&lt;p&gt;Looking at the service properties in the Control Panel I am able to verify that those two services are now listed as dependencies for Tomcat 6.&lt;br/&gt;
Regardless of that, the problem still persists. Tomcat fails to start at boot time.&lt;/p&gt;

&lt;p&gt;BTW, &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the Control Panel displays the service as running,&lt;/li&gt;
	&lt;li&gt;prunmgr can a) display the service as running or b) do not display it as running (a): green tray icon and &quot;Stop&quot; button is enabled in the configuration dialog, b): red icon, no buttons are enabled in the dialog;  In both cases &quot;Stop service&quot; is enabled in the menu on the tray icon).&lt;br/&gt;
There are no traces of Tomcat starting in the tomcat logs and &quot;netstat -a&quot; does not show Tomcat as listening on any ports.&lt;br/&gt;
The commons-daemon log messages are the same as earlier.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://msdn.microsoft.com/en-us/library/ms682450%28VS.85%29.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://msdn.microsoft.com/en-us/library/ms682450%28VS.85%29.aspx&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;commons-daemon log:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:48&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1493) Commons Daemon procrun log initialized&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:48&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Commons Daemon procrun (1.0.4.0 32-bit) started&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:49&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Running &apos;Tomcat6&apos; Service...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:49&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1241) Inside ServiceMain...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:49&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Starting service...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:49&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:191 ) loading jvm &apos;C:\Program Files\Java\jre6\bin\client\jvm.dll&apos;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:50&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; -Dcatalina.home=C:\Program Files\Apache Software Foundation\Tomcat 6.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:50&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; -Dcatalina.base=C:\Program Files\Apache Software Foundation\Tomcat 6.0&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:50&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; -Djava.endorsed.dirs=C:\Program Files\Apache Software Foundation\Tomcat 6.0\endorsed&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:51&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; -Djava.io.tmpdir=C:\Program Files\Apache Software Foundation\Tomcat 6.0\temp&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:52&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt; -Djava.util.logging.manager=org.apache.juli.ClassLoaderLogManager&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:52&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt; -Djava.util.logging.config.file=C:\Program Files\Apache Software Foundation\Tomcat 6.0\conf\logging.properties&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:52&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:643 ) Jvm Option&lt;span class=&quot;error&quot;&gt;&amp;#91;6&amp;#93;&lt;/span&gt; -Djava.class.path=C:\Program Files\Apache Software Foundation\Tomcat 6.0\bin\bootstrap.jar&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:51&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1054) Java started org/apache/catalina/startup/Bootstrap&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:54&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Service started in 4326 ms.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:56&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1364) Waiting for worker to finish...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:56&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1369) Worker finished.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:57&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1392) Waiting for all threads to exit&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:56&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:827 ) argv&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = start&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-12-22 00:38:57&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:889 ) Java Worker thread finished org/apache/catalina/startup/Bootstrap:main with status=3&lt;/p&gt;

&lt;p&gt;Note, that, as I mentioned above, the last line can be&lt;br/&gt;
 ( javajni.c:889 ) Java Worker thread finished org/apache/catalina/startup/Bootstrap:main with status=3&lt;br/&gt;
or can be&lt;br/&gt;
 ( javajni.c:874 ) Java Worker thread started org/apache/catalina/startup/Bootstrap:main&lt;br/&gt;
Regardless of that, there is &quot;Worker finished.&quot; line and the startup is unsuccessful. If JVM start fails, can there be any message about that?&lt;/p&gt;

&lt;p&gt;I tried to revert to the previous versions of commons-daemon, and the result are the following:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;1.0.3: fails in the same way as 1.0.4&lt;/li&gt;
	&lt;li&gt;1.0.2: starts successfully.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;1.0.2 starts successfully even if I remove that DependOnService setting from the registry.&lt;/p&gt;</comment>
                            <comment id="12974060" author="mturk@apache.org" created="Wed, 22 Dec 2010 05:51:51 +0000"  >&lt;p&gt;OK. So we have two separate issues here.&lt;br/&gt;
For testing I have used 6.0.26 and without dependencies Tomcat doesn&apos;t start at boot time and&lt;br/&gt;
Control panel shows the services as not running.&lt;br/&gt;
With patch it works. (JVM is 1.6.0_18-b07)&lt;/p&gt;

&lt;p&gt;However you said that on your box control panel shows the service as running which&lt;br/&gt;
is something different from what I have saw.&lt;/p&gt;

&lt;p&gt;Let me try with your enviroment; 6.0.x trunk and 1.6.22&lt;/p&gt;</comment>
                            <comment id="12974087" author="mturk@apache.org" created="Wed, 22 Dec 2010 06:58:17 +0000"  >&lt;p&gt;OK. I was able to reproduce the problem.&lt;/p&gt;

&lt;p&gt;apache-tomcat-6.0.0.-dev (build from trunk)&lt;br/&gt;
jdk-1.6.23&lt;/p&gt;

&lt;p&gt;1. Cleanup everything&lt;br/&gt;
    Uninstall any previous service&lt;br/&gt;
    Make sure all registry settings are removed (particularly)&lt;br/&gt;
    HKLM\Software\Apache Software Foundation\Procrun 2.0\Tomcat6&lt;br/&gt;
2. service install&lt;br/&gt;
3. Add Full Control to apache-tomcat-6.0.-0-dev folder to LOCAL SERVICE account&lt;br/&gt;
4. Change start mode to auto&lt;/p&gt;

&lt;p&gt;After reboot Tomcat6 service is shown as running but the catalina-&amp;lt;DATETIME&amp;gt;.log is empty&lt;br/&gt;
Service doesn&apos;t work.&lt;/p&gt;

&lt;p&gt;5. Open Windows Firewall and add  apache-tomcat-6.0.-0-dev\bin\tomcat6.exe as Exception&lt;br/&gt;
After reboot everything works fine&lt;/p&gt;

&lt;p&gt;Can you check your firewall settings?&lt;/p&gt;

&lt;p&gt;Also, since it works for me with 1.0.5-dev (dependencies added) and it doesn&apos;t with 1.0.4&lt;br/&gt;
I&apos;m considering this issue resolved. Please bring any further discussion either to&lt;br/&gt;
dev@commons or users@commons&lt;/p&gt;
</comment>
                            <comment id="12975436" author="jpleed3" created="Tue, 28 Dec 2010 06:36:54 +0000"  >&lt;p&gt;I have a similar problem with an application I wrote: the service stalls on reboot, but works fine if I manually start/restart the service. I&apos;ve been trying to deal with this problem for a few weeks and I&apos;m glad to see I&apos;m not the only one.&lt;/p&gt;

&lt;p&gt;Mladen - Please clarify your last comment for me. Does it work for you using 1.0.5-dev without the firewall exception, or with it? &lt;/p&gt;</comment>
                            <comment id="12976579" author="kkolinko" created="Mon, 3 Jan 2011 00:03:39 +0000"  >&lt;p&gt;Firewall is not related: if I turn it off the issue is still reproducible.&lt;/p&gt;

&lt;p&gt;It looks like I found the cause:&lt;br/&gt;
it is caused by the initial value of  &lt;tt&gt;dwWorkerStatus&lt;/tt&gt; in APXJAVAVM structure and a race condition between &lt;tt&gt;serviceMain()&lt;/tt&gt; thread and &lt;tt&gt;__apxJavaWorkerThread()&lt;/tt&gt; thread.&lt;/p&gt;

&lt;p&gt;Note, that the initial value of the &lt;tt&gt;dwWorkerStatus&lt;/tt&gt; field is zero, and then &lt;tt&gt;__apxJavaWorkerThread()&lt;/tt&gt; method sets it to 1 when JVM initialization is successful:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;  lpJava-&amp;gt;dwWorkerStatus = 1;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;At the same time, &lt;tt&gt;serviceMain()&lt;/tt&gt; method in prunsrv.c continues to run, prints &quot;Waiting for worker to finish...&quot; message and calls&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;  rv = apxHandleWait(gWorker, INFINITE, FALSE);&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The apxHandleWait call results in calling &lt;tt&gt;apxJavaWait()&lt;/tt&gt; in javajni.c, and apxJavaWait() does this check:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;    if (!lpJava-&amp;gt;dwWorkerStatus &amp;amp;&amp;amp; lpJava-&amp;gt;hWorkerThread)&lt;br/&gt;
        return WAIT_OBJECT_0;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If &lt;tt&gt;dwWorkerStatus&lt;/tt&gt; has not been set to &quot;1&quot; yet and has its initial value of zero, the above check will succeed and the wait method will return immediately. The &lt;tt&gt;serviceMain()&lt;/tt&gt; prints &quot;Worker finished.&quot; and starts shutting down. That is the issue.&lt;/p&gt;</comment>
                            <comment id="12976580" author="kkolinko" created="Mon, 3 Jan 2011 00:12:06 +0000"  >&lt;p&gt;Patch for javajni.c. (not tested!)&lt;/p&gt;</comment>
                            <comment id="12976620" author="mturk@apache.org" created="Mon, 3 Jan 2011 05:57:42 +0000"  >&lt;p&gt;Test binary with &lt;a href=&quot;https://issues.apache.org/jira/browse/DAEMON-190&quot; title=&quot;Service startup fails at boot time on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DAEMON-190&quot;&gt;&lt;del&gt;DAEMON-190&lt;/del&gt;&lt;/a&gt; fix&lt;/p&gt;</comment>
                            <comment id="12976622" author="mturk@apache.org" created="Mon, 3 Jan 2011 06:00:04 +0000"  >&lt;p&gt;Attached is the fixed binary with the patch that goes in your direction.&lt;br/&gt;
However it uses an event object to fully sync the state of the JVM worker thread and waits until it fully initializes&lt;/p&gt;

&lt;p&gt;Please test with the provided binary. Tell me if you need 64-bit version&lt;/p&gt;</comment>
                            <comment id="12976789" author="jpleed3" created="Mon, 3 Jan 2011 15:58:13 +0000"  >&lt;p&gt;No luck so far. After an uninstall and install, I&apos;m getting the following on service start:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 10:51:59&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  Commons Daemon procrun (1.0.5.0 32-bit) started&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 10:51:59&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  Running &apos;RadDataCollector&apos; Service...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 10:51:59&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  Starting service...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 10:51:59&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt; The specified module could not be found.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 10:51:59&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt; Failed creating java &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 10:51:59&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt; The specified module could not be found.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 10:51:59&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt; ServiceStart returned 1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 10:51:59&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt; The specified module could not be found.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 10:51:59&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  Run service finished.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 10:51:59&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  Commons Daemon procrun finished&lt;/p&gt;</comment>
                            <comment id="12976801" author="mturk@apache.org" created="Mon, 3 Jan 2011 16:25:33 +0000"  >&lt;p&gt;John, please use the users list since your case is not related to this one.&lt;br/&gt;
JIRA is not support forum.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="12976815" author="jpleed3" created="Mon, 3 Jan 2011 16:49:49 +0000"  >&lt;p&gt;Pardon me? I&apos;m not asking for support; I&apos;m reporting a regression!&lt;/p&gt;

&lt;p&gt;I first commented in this JIRA because the issue with my application seems to be the same as Konstantin is having with Tomcat: using 1.0.4, the service does not start correctly after reboot. If you know that to not be the case, then why not make a note of the reason for other people to see?&lt;/p&gt;

&lt;p&gt;I tried the patched version of prunsrv you attached this morning, and it did not start at all - I didn&apos;t even get a chance to test it after a reboot.&lt;/p&gt;

&lt;p&gt;I&apos;ve learned how to use the daemon just fine and I don&apos;t require assistance or a support forum, just a version that works correctly. Would you like me to help you test your fixes, or not?&lt;/p&gt;</comment>
                            <comment id="12976842" author="kkolinko" created="Mon, 3 Jan 2011 17:40:55 +0000"  >&lt;p&gt;&amp;gt; Attached is the fixed binary with the patch that goes in your direction.&lt;/p&gt;

&lt;p&gt;When I replaced old binaries with the new one, the service started successfully.&lt;br/&gt;
(The service configuration already had dependencies on AFP and TCPIP, added manually)&lt;/p&gt;

&lt;p&gt;I.e., it fixed the issue for me.&lt;/p&gt;

&lt;p&gt;==============================================================&lt;br/&gt;
Then I used &lt;tt&gt;service.bat&lt;/tt&gt; from Tomcat 6.0-dev to &quot;remove&quot; and then &quot;install&quot; service.&lt;/p&gt;

&lt;p&gt;After that the service failed to start at boot time, displaying the same series of errors as in the last comment by John Leed: &quot;The specified module could not be found. &quot; (in Russian &amp;#8211; those messages are provided by OS).&lt;/p&gt;


&lt;p&gt;I opened the configuration dialog (tomcat6w, aka prunmgr) and on the &quot;Java&quot; tab of the dialog removed the check from the &lt;b&gt;&quot;Use default&quot;&lt;/b&gt; checkbox.&lt;/p&gt;

&lt;p&gt;(I already had correct path to the jvm.dll specified in the &quot;Java Virtual Machine&quot; field there).&lt;/p&gt;

&lt;p&gt;After that change, the service started successfully after reboot.&lt;/p&gt;

&lt;p&gt;==============================================================&lt;br/&gt;
If I set &lt;span class=&quot;error&quot;&gt;&amp;#91;x&amp;#93;&lt;/span&gt; &quot;Use default&quot; and set log level to Debug,  I see the following in the log:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:28&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1494) Commons Daemon procrun log initialized&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:29&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Commons Daemon procrun (1.0.5.0 32-bit) started&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:29&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Running &apos;Tomcat6&apos; Service...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:29&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( prunsrv.c:1246) Inside ServiceMain...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:30&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Starting service...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:30&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:195 ) Invalid RuntimeLib &apos;C:\Program Files\Java\jre6\bin\client\jvm.dll&apos;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:30&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:197 ) Using Jre JavaHome &apos;C:\Program Files\Java\jre6&apos;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:30&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:206 ) loading jvm &apos;C:\Program Files\Java\jre6\bin\server\jvm.dll&apos;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:30&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:249 ) Setting DLL search path to &apos;C:\Program Files\Java\jre6\bin\server&apos;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:30&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;debug&amp;#93;&lt;/span&gt; ( javajni.c:249 ) Setting DLL search path to &apos;C:\Program Files\Java\jre6\bin&apos;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:31&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt; ( javajni.c:262 ) &#1053;&#1077; &#1085;&#1072;&#1081;&#1076;&#1077;&#1085; &#1091;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1099;&#1081; &#1084;&#1086;&#1076;&#1091;&#1083;&#1100;.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:31&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt; ( prunsrv.c:1037) Failed creating java &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:31&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt; ( prunsrv.c:1037) &#1053;&#1077; &#1085;&#1072;&#1081;&#1076;&#1077;&#1085; &#1091;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1099;&#1081; &#1084;&#1086;&#1076;&#1091;&#1083;&#1100;.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:33&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt; ( prunsrv.c:1377) ServiceStart returned 1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:34&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt; ( prunsrv.c:1377) &#1053;&#1077; &#1085;&#1072;&#1081;&#1076;&#1077;&#1085; &#1091;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1099;&#1081; &#1084;&#1086;&#1076;&#1091;&#1083;&#1100;.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:43&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Run service finished.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2011-01-03 20:18:44&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;info&amp;#93;&lt;/span&gt;  (          :0   ) Commons Daemon procrun finished&lt;/p&gt;

&lt;p&gt;where &quot;&#1053;&#1077; &#1085;&#1072;&#1081;&#1076;&#1077;&#1085; &#1091;&#1082;&#1072;&#1079;&#1072;&#1085;&#1085;&#1099;&#1081; &#1084;&#1086;&#1076;&#1091;&#1083;&#1100;.&quot; (in Russian) means &quot;The specified module could not be found.&quot;.&lt;/p&gt;

&lt;p&gt;The correct path to jvm.dll on my system is &quot;C:\Program Files\Java\jre6\bin\client\jvm.dll&quot;&lt;/p&gt;

&lt;p&gt;I think the following change is needed in javajni.c:&lt;br/&gt;
in apxJavaStart() - line #190 and in __apxLoadJvmDll() - line 208&lt;br/&gt;
s / if (GetFileAttributesW(szJvmDllPath)  / if (GetFileAttributesW(dllJvmPath) /&lt;/p&gt;


&lt;p&gt;It is somehow strange that &quot;Use default&quot; flag on the Java page is on by default, even though I provided JAVA_HOME when calling service.bat.  Is the &quot;Java Virtual Machine&quot; setting ignored at all when &quot;Use default&quot; is on?&lt;/p&gt;

&lt;p&gt;If prunsvc defaults will stay as they are now, I think that &lt;tt&gt;service.bat&lt;/tt&gt; has to be adjusted to clear that flag.&lt;/p&gt;</comment>
                            <comment id="12976845" author="kkolinko" created="Mon, 3 Jan 2011 17:51:44 +0000"  >&lt;p&gt;Patch for javajni.c to address issue with JVM.dll path validity check (not tested).&lt;/p&gt;</comment>
                            <comment id="12976848" author="jpleed3" created="Mon, 3 Jan 2011 18:01:50 +0000"  >&lt;p&gt;I tried unchecking the Use Default checkbox in prunmgr as Konstantin did; my application also works again, though I haven&apos;t tested it after reboot yet.&lt;/p&gt;</comment>
                            <comment id="12977121" author="mturk@apache.org" created="Tue, 4 Jan 2011 05:14:20 +0000"  >&lt;p&gt;Binary with Konstantin&apos;s patch applied.&lt;/p&gt;</comment>
                            <comment id="12977122" author="mturk@apache.org" created="Tue, 4 Jan 2011 05:15:37 +0000"  >&lt;p&gt;Applied the patch with some minor tweak for checking the msvcrt71.dll&lt;/p&gt;</comment>
                            <comment id="12977350" author="kkolinko" created="Tue, 4 Jan 2011 17:18:05 +0000"  >&lt;p&gt;Confirming that JVM detection issue is fixed.&lt;br/&gt;
The service installs and starts after reboot successfully.&lt;/p&gt;

&lt;p&gt;Regarding what I wrote about jvm path,&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt; (I already had correct path to the jvm.dll specified in the &quot;Java Virtual Machine&quot; field there). &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&amp;#8211; please, ignore that. Looking into what &lt;tt&gt;service.bat&lt;/tt&gt; does, it actually ignored my value of JAVA_HOME when I was installing the service, and installed the service with JVM path equal to &quot;auto&quot;.  So, indeed, the service was configured with &quot;Use default&quot;.&lt;/p&gt;</comment>
                            <comment id="12977365" author="kkolinko" created="Tue, 4 Jan 2011 17:31:47 +0000"  >&lt;p&gt;Marking the issue as Resolved.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12467298" name="2011-01-03_Daemon-190.patch" size="449" author="kkolinko" created="Mon, 3 Jan 2011 00:12:06 +0000"/>
                            <attachment id="12467333" name="2011-01-03_javaini_GetFileAttributesW.patch" size="939" author="kkolinko" created="Mon, 3 Jan 2011 17:51:44 +0000"/>
                            <attachment id="12467398" name="prunsrv-x86.zip" size="31631" author="mturk@apache.org" created="Tue, 4 Jan 2011 05:14:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37615</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 46 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tk0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170553</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>