<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:44:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DAEMON-16] [daemon] When changing UID in jsvc on fedora core 4, warning occurs: find_vma failed</title>
                <link>https://issues.apache.org/jira/browse/DAEMON-16</link>
                <project id="12310468" key="DAEMON">Commons Daemon</project>
                    <description>&lt;p&gt;Greetings List.&lt;/p&gt;

&lt;p&gt;I have searched a lot for information about this Warning I am getting when I&lt;br/&gt;
start up tomcat by using jsvc on my Fedora Core 4 platform, but I have not been&lt;br/&gt;
able to find anything that helped me solve my problem. So now I am reporting it&lt;br/&gt;
here.&lt;/p&gt;

&lt;p&gt;I am using the Tomcat5.sh script supplied in the native folder.&lt;/p&gt;

&lt;p&gt;I have tried 2 different scenarios:&lt;/p&gt;

&lt;p&gt;1. running jsvc with &quot;-user tomcat&quot;&lt;br/&gt;
2. ommitting the -user option entirely (running it as root)&lt;/p&gt;

&lt;p&gt;In scenario 1 I get the warning:&lt;br/&gt;
&quot;Java HotSpot(TM) Server VM warning: Can&apos;t detect initial thread stack location&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;find_vma failed&quot;   (same message if I use the Client VM).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I do not get this warning in scenario 2.&lt;/p&gt;

&lt;p&gt;If I use the script &quot;catalina.sh&quot; as the user tomcat I can start up the&lt;br/&gt;
webserver fine without warnings (though not on port 80 naturally).&lt;/p&gt;

&lt;p&gt;System is Fedora Cora 4&lt;br/&gt;
Tomcat is the the apache-tomcat-5.5.15.tar.gz&lt;br/&gt;
JDK/JRE is Suns jdk 1.5.0_06 for linux (rpm distribution)&lt;br/&gt;
(note I dont have any other java distributions installed, so fedora RPM name&lt;br/&gt;
clashes is not an issue)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: Linux&lt;br/&gt;
Platform: PC&lt;/p&gt;</environment>
        <key id="12342906">DAEMON-16</key>
            <summary>[daemon] When changing UID in jsvc on fedora core 4, warning occurs: find_vma failed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mturk@apache.org">Mladen Turk</assignee>
                                    <reporter username="brian@thorsbro.dk">Brian Peter Thorsbro</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Feb 2006 02:33:39 +0000</created>
                <updated>Fri, 26 Feb 2010 17:05:22 +0000</updated>
                            <resolved>Thu, 11 Feb 2010 18:47:56 +0000</resolved>
                                                    <fixVersion>1.0.2</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12411418" author="jfclere@gmail.com" created="Wed, 26 Apr 2006 03:56:39 +0000"  >&lt;p&gt;Could check that /proc is mounted?&lt;/p&gt;</comment>
                            <comment id="12411419" author="brian@thorsbro.dk" created="Wed, 26 Apr 2006 15:19:00 +0000"  >&lt;p&gt;The /proc system is mounted. It works when running as root, the error occurs&lt;br/&gt;
when you ask jsvc to change user to i.e. tomcat. So the problem is connected to&lt;br/&gt;
permissions in some way.&lt;/p&gt;

&lt;p&gt;I can run the jsvc fine though, if I just choose to ignore that warning...&lt;/p&gt;</comment>
                            <comment id="12675272" author="adamtaft" created="Fri, 20 Feb 2009 07:47:26 +0000"  >&lt;p&gt;I&apos;ve got a ditto on this bug report.  I&apos;m using newest JDK 6 and Tomcat 6.  I can run jsvc as root, no problem.  Specifying a different user via the -user switch fails with the same error.  Tomcat won&apos;t start.&lt;/p&gt;</comment>
                            <comment id="12743719" author="mads1980" created="Sat, 15 Aug 2009 14:35:20 +0000"  >&lt;p&gt;Apparently this has something to do with permissions and being able to read /proc/self/maps&lt;/p&gt;

&lt;p&gt;This URL has an explanation and patch that is supposed to fix the issue by enabling CAP_DAC_READ_SEARCH capability&lt;br/&gt;
&lt;a href=&quot;http://crashingdaily.wordpress.com/2007/02/06/jrockit-liftoff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://crashingdaily.wordpress.com/2007/02/06/jrockit-liftoff/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Though the poster is not sure about the security implications.&lt;/p&gt;

&lt;p&gt;This is the proposed patch:&lt;/p&gt;

&lt;p&gt;&#8212; jsvc-unix.c.dist 2007-02-05 22:34:01.000000000 -0500&lt;br/&gt;
+++ jsvc-unix.c 2007-02-05 23:41:18.000000000 -0500&lt;br/&gt;
@@ -115,12 +115,15 @@&lt;br/&gt;
#define CAPSMAX (1 &amp;lt;&amp;lt; CAP_NET_BIND_SERVICE)+ \&lt;br/&gt;
(1 &amp;lt;&amp;lt; CAP_DAC_READ_SEARCH)+ \&lt;br/&gt;
(1 &amp;lt;&amp;lt; CAP_DAC_OVERRIDE)&lt;br/&gt;
-/* That a more reasonable configuration */&lt;br/&gt;
+/* That a more reasonable configuration.&lt;br/&gt;
+ CAP_DAC_READ_SEARCH permits reading /proc/self */&lt;br/&gt;
#define CAPS (1 &amp;lt;&amp;lt; CAP_NET_BIND_SERVICE)+ \&lt;br/&gt;
+ (1 &amp;lt;&amp;lt; CAP_DAC_READ_SEARCH)+ \&lt;br/&gt;
(1 &amp;lt;&amp;lt; CAP_SETUID)+ \&lt;br/&gt;
(1 &amp;lt;&amp;lt; CAP_SETGID)&lt;br/&gt;
/* probably the only one Java could use */&lt;br/&gt;
-#define CAPSMIN (1 &amp;lt;&amp;lt; CAP_NET_BIND_SERVICE)&lt;br/&gt;
&lt;ins&gt;#define CAPSMIN (1 &amp;lt;&amp;lt; CAP_NET_BIND_SERVICE)&lt;/ins&gt; \&lt;br/&gt;
+ (1 &amp;lt;&amp;lt; CAP_DAC_READ_SEARCH)&lt;br/&gt;
static int set_caps(int caps)&lt;br/&gt;
{&lt;br/&gt;
struct __user_cap_header_struct caphead;&lt;/p&gt;</comment>
                            <comment id="12832585" author="mturk@apache.org" created="Thu, 11 Feb 2010 17:29:02 +0000"  >&lt;p&gt;There is workaround for that issue as explained with the case&lt;/p&gt;</comment>
                            <comment id="12832598" author="mads1980" created="Thu, 11 Feb 2010 17:44:46 +0000"  >&lt;p&gt;What&apos;s the reasoning behind resolving this issue as &quot;Won&apos;t Fix&quot; ? We are experiencing the same warning on RHEL 4 when using jsvc + user parameter. The JVM works even with this warning, but it sure points to some kind of problem. Either the actual problem should be fixed, or if it isn&apos;t really a problem, then at least the find_vma message should not be logged.&lt;/p&gt;</comment>
                            <comment id="12832618" author="mturk@apache.org" created="Thu, 11 Feb 2010 18:37:03 +0000"  >&lt;p&gt;Hmm, seems the patch is attached to the case, but in form of a comment.&lt;br/&gt;
I&apos;ll reopen the case and try to reconstruct the patch to a proper format&lt;/p&gt;</comment>
                            <comment id="12832622" author="mturk@apache.org" created="Thu, 11 Feb 2010 18:47:56 +0000"  >&lt;p&gt;Fixed with the 1.0.2&lt;br/&gt;
Added CAP_DAC_READ_SEARCH to allow reading /proc/self.&lt;br/&gt;
This might however open some other security issues, so need a review.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12410283">DAEMON-120</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38633</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37788</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tjuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>170526</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>