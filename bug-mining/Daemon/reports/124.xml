<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:46:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DAEMON-450] Invoked &quot;bin\tomcat9 //US/Tomcat9&quot;, logs directory will be inserted unwanted two ACLs</title>
                <link>https://issues.apache.org/jira/browse/DAEMON-450</link>
                <project id="12310468" key="DAEMON">Commons Daemon</project>
                    <description>&lt;p&gt;Invoked &quot;bin\tomcat9 //US/Tomcat9&quot;, logs directory will be inserted unwanted two ACLs.&lt;/p&gt;

&lt;p&gt;Repro at Tomcat9 directory on Admin Command Prompt (not Admin PowerShell).&lt;/p&gt;

&lt;p&gt;&amp;gt; ren logs logs1&lt;/p&gt;

&lt;p&gt;&amp;gt; md logs&lt;/p&gt;

&lt;p&gt;&amp;gt; icacls logs&lt;/p&gt;

&lt;p&gt;logs NT AUTHORITY\Authenticated Users:(I)(OI)(CI)(M)&lt;br/&gt;
     NT AUTHORITY\SYSTEM:(I)(OI)(CI)(F)&lt;br/&gt;
     BUILTIN\Administrators:(I)(OI)(CI)(F)&lt;br/&gt;
     BUILTIN\Users:(I)(OI)(CI)(M)&lt;/p&gt;

&lt;p&gt;&amp;gt; bin\tomcat9.exe //US/Tomcat9&lt;/p&gt;

&lt;p&gt;&amp;gt; icacls logs&lt;/p&gt;

&lt;p&gt;logs NT AUTHORITY\LOCAL SERVICE:(RX,W)&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(OI)(CI)(IO)(GR,GW,GE)&lt;br/&gt;
     NT AUTHORITY\Authenticated Users:(I)(OI)(CI)(M)&lt;br/&gt;
     NT AUTHORITY\SYSTEM:(I)(OI)(CI)(F)&lt;br/&gt;
     BUILTIN\Administrators:(I)(OI)(CI)(F)&lt;br/&gt;
     BUILTIN\Users:(I)(OI)(CI)(M)&lt;/p&gt;

&lt;p&gt;&amp;gt; bin\tomcat9.exe //US/Tomcat9&lt;/p&gt;

&lt;p&gt;&amp;gt; icacls logs&lt;/p&gt;

&lt;p&gt;logs NT AUTHORITY\LOCAL SERVICE:(RX,W)&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(OI)(CI)(IO)(GR,GW,GE)&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(RX,W)&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(OI)(CI)(IO)(GR,GW,GE)&lt;br/&gt;
     NT AUTHORITY\Authenticated Users:(I)(OI)(CI)(M)&lt;br/&gt;
     NT AUTHORITY\SYSTEM:(I)(OI)(CI)(F)&lt;br/&gt;
     BUILTIN\Administrators:(I)(OI)(CI)(F)&lt;br/&gt;
     BUILTIN\Users:(I)(OI)(CI)(M)&lt;/p&gt;

&lt;p&gt;&amp;gt; for /l %i in (1,0,1) do bin\tomcat9.exe //US/Tomcat9&lt;/p&gt;

&lt;p&gt;  : (...after 1000-2000 times...)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2022-11-18 17:46:20&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;warn&amp;#93;&lt;/span&gt;  [ 2456] Failed to grant service user &apos;NT AUTHORITY\LocalService&apos; write permissions to log path &apos;&amp;lt;full/path/to/tomcat9&amp;gt;\logs&apos; due to error &apos;1340: The inherited access control list (ACL) or access control entry (ACE) could not be built.&apos;&lt;br/&gt;
  :&lt;/p&gt;

&lt;p&gt;&amp;gt; icacls logs&lt;br/&gt;
logs NT AUTHORITY\LOCAL SERVICE:(RX,W)&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(OI)(CI)(IO)(GR,GW,GE)&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(RX,W)&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(OI)(CI)(IO)(GR,GW,GE)&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(RX,W)&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(OI)(CI)(IO)(GR,GW,GE)&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(RX,W)&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(OI)(CI)(IO)(GR,GW,GE)&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(RX,W)&lt;br/&gt;
  :&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(RX,W)&lt;br/&gt;
     NT AUTHORITY\LOCAL SERVICE:(OI)(CI)(IO)(GR,GW,GE)&lt;br/&gt;
     NT AUTHORITY\Authenticated Users:(I)(OI)(CI)(M)&lt;br/&gt;
     NT AUTHORITY\SYSTEM:(I)(OI)(CI)(F)&lt;br/&gt;
     BUILTIN\Administrators:(I)(OI)(CI)(F)&lt;br/&gt;
     BUILTIN\Users:(I)(OI)(CI)(M)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7 SP1 x64&lt;/p&gt;

&lt;p&gt;Apache Tomcat 9.0.69 x86 (zip-dist)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</environment>
        <key id="13503601">DAEMON-450</key>
            <summary>Invoked &quot;bin\tomcat9 //US/Tomcat9&quot;, logs directory will be inserted unwanted two ACLs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="norimy">Norimasa Yamamoto</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Nov 2022 13:52:00 +0000</created>
                <updated>Thu, 24 Nov 2022 22:53:31 +0000</updated>
                            <resolved>Tue, 22 Nov 2022 19:10:10 +0000</resolved>
                                    <version>1.3.2</version>
                                    <fixVersion>1.3.3</fixVersion>
                                    <component>prunsrv</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17637016" author="JIRAUSER298397" created="Tue, 22 Nov 2022 06:31:21 +0000"  >&lt;p&gt;Easy fix for above. (only changing GRANT_ACCESS to SET_ACCESS in src\native\windows\src\security.c)&lt;/p&gt;

&lt;p&gt;However, still have two leaks at GetNamedSecurityInfoW&apos;s pSD and SetEntriesInAcl&apos;s pNewDACL.&lt;br/&gt;
They will need to free by LocalFree. see C++ sample.&lt;br/&gt;
&lt;a href=&quot;https://learn.microsoft.com/en-us/windows/win32/secauthz/modifying-the-acls-of-an-object-in-c--&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://learn.microsoft.com/en-us/windows/win32/secauthz/modifying-the-acls-of-an-object-in-c--&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
--- security.c &#160; &#160;Sun Sep 18 13:49:42 2022
+++ security.c &#160; &#160;Tue Nov 22 14:15:13 2022
@@ -81,5 +81,5 @@
&#160; &#160; &#160;ZeroMemory(&amp;amp;ea, sizeof(EXPLICIT_ACCESS));
&#160; &#160; &#160;ea.grfAccessPermissions = GENERIC_EXECUTE + GENERIC_READ + GENERIC_WRITE;
- &#160; &#160;ea.grfAccessMode = GRANT_ACCESS;
+ &#160; &#160;ea.grfAccessMode = SET_ACCESS;
&#160; &#160; &#160;ea.grfInheritance = CONTAINER_INHERIT_ACE + OBJECT_INHERIT_ACE;
&#160; &#160; &#160;ea.Trustee.TrusteeForm = TRUSTEE_IS_NAME;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17637393" author="markt" created="Tue, 22 Nov 2022 18:01:18 +0000"  >&lt;p&gt;The original report was for Windows 7 which is no longer supported.&lt;/p&gt;

&lt;p&gt;This behaviour is not observed with a fully patched Windows 8.1 or fully patched Windows 10. I can repeat this with Windows Server 2012.&lt;/p&gt;

&lt;p&gt;I&apos;ll take a look at the proposed patch.&lt;/p&gt;</comment>
                            <comment id="17637426" author="markt" created="Tue, 22 Nov 2022 19:10:10 +0000"  >&lt;p&gt;Thanks for the proposed patch and the information on the leaks.&lt;/p&gt;</comment>
                            <comment id="17638429" author="JIRAUSER298397" created="Thu, 24 Nov 2022 22:53:31 +0000"  >&lt;p&gt;I red the diff.&lt;/p&gt;

&lt;p&gt;It will be missing the NULL iinitialization for doing &#8221;cleanup&#8221; block.&lt;/p&gt;

&lt;p&gt;Sorry if you were already fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1cbuw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>