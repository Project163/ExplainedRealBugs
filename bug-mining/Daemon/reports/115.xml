<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:46:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DAEMON-426] CAP_DAC_READ_SEARCH not allowed in containers by default</title>
                <link>https://issues.apache.org/jira/browse/DAEMON-426</link>
                <project id="12310468" key="DAEMON">Commons Daemon</project>
                    <description>&lt;p&gt;jsvc tries to get &lt;tt&gt;CAP_DAC_READ_SEARCH&lt;/tt&gt; capabilities.&#160; The code says&#160;&lt;a href=&quot;https://github.com/apache/commons-daemon/commit/2090bd1586f30f4a72ab192df6b7e7f9f5548922#diff-71c2181bdc541da57b93eb9c43851baa9457ca97e6cf1e9f8ee1c280d273ca5a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Fix DAEMON-16 by adding CAP_DAC_READ_SEARCH to allow reading /proc/self&lt;/a&gt; but does anyone still need this? It fails on docker containers in kubernetes unless admins allow that capability to be requested.&lt;/p&gt;

&lt;p&gt;I tried compiling it without this flag and it seems to run everything just fine - but to not break anyone who might really need this CAP, perhaps some command line switch could be added to adjust what capabilities are requested generally, or at the very least specifically whether to not alter that&#160;CAP_DAC_READ_SEARCH cap.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Redhat 7; jsvc 1.2.3&lt;/p&gt;</environment>
        <key id="13343478">DAEMON-426</key>
            <summary>CAP_DAC_READ_SEARCH not allowed in containers by default</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="scr-oath">Sheridan Rawlins</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Dec 2020 07:07:22 +0000</created>
                <updated>Thu, 14 Jan 2021 09:22:56 +0000</updated>
                            <resolved>Thu, 14 Jan 2021 09:22:56 +0000</resolved>
                                    <version>1.2.2</version>
                                    <fixVersion>1.2.4</fixVersion>
                                    <component>Jsvc</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17242765" author="garydgregory" created="Wed, 2 Dec 2020 22:06:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=markt&quot; class=&quot;user-hover&quot; rel=&quot;markt&quot;&gt;markt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Is this something that warrants a command line option or can it removed?&lt;/p&gt;</comment>
                            <comment id="17243002" author="markt" created="Thu, 3 Dec 2020 08:30:45 +0000"  >&lt;p&gt;A quick look at the source suggests that that capability is required. It may be we can move the logic around to not request the capability when it is not required. The full command line used by the OP to call jsvc in the docker container would be helpful.&lt;/p&gt;

&lt;p&gt;As an aside, it also looks like there is some code for compatibility with very old Linux kernels that we could remove now.&lt;/p&gt;</comment>
                            <comment id="17245997" author="markt" created="Tue, 8 Dec 2020 17:03:44 +0000"  >&lt;p&gt;After some digging I think I figured out what is going on.&lt;/p&gt;

&lt;p&gt;The -procname option is implemented using execve and that needs the path to the binary.&lt;/p&gt;

&lt;p&gt;The path to the binary is obtained from /proc/self/exe falling back to argv&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; if that fails.&lt;/p&gt;

&lt;p&gt;CAP_DAC_READ_SEARCH is required in order to read&#160;/proc/self/exe&lt;/p&gt;

&lt;p&gt;jsvc fails if any requested capability isn&apos;t available.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So jsvc fails on docker because&#160;CAP_DAC_READ_SEARCH isn&apos;t available.&lt;/p&gt;

&lt;p&gt;Commenting out&#160;CAP_DAC_READ_SEARCH causes the read of&#160;/proc/self/exe to fail so jsvc falls back to argv&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; which works.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;ve re-worked the capability code to try and request&#160;CAP_DAC_READ_SEARCH but to fall back to trying without that capability if the initial request fails.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If you could test the current code that would be very helpful.&lt;/p&gt;</comment>
                            <comment id="17264709" author="markt" created="Thu, 14 Jan 2021 09:22:56 +0000"  >&lt;p&gt;No response from original reporter. Assuming the proposed fix is sufficient.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 43 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0l2u0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>