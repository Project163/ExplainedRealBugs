<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:03:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JOHNZON-151] Serializing nulls within a list, within a type or map produces unexpected results</title>
                <link>https://issues.apache.org/jira/browse/JOHNZON-151</link>
                <project id="12315523" key="JOHNZON">Johnzon</project>
                    <description>&lt;p&gt;When a Collection (such as a List) contains a null entry and is serialized through a parent map or defined type, the serialization produces unexpected results.&lt;/p&gt;

&lt;p&gt;With 1.1.0 through 1.1.4, the nulls are silently ignored.&lt;br/&gt;
With 1.1.5, a NullPointerException occurs instead.&lt;br/&gt;
I did &lt;b&gt;not&lt;/b&gt; check 1.0.0&lt;/p&gt;

&lt;p&gt;Local analysis indicates that in 1.1.5, code block&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;MappingGeneratorImpl.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void writeValue(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; type, ...
...
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (objectConverterToUse == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    objectConverterToUse = config.findObjectConverterWriter(o.getClass());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is the culprit by trying to invoke getClass() on a null object.&lt;/p&gt;

&lt;p&gt;Nulls are ignored in 1.1.4 and prior due to code blocks&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;MappingGeneratorImpl.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void writeItem(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Collection&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; ignoredProperties, JsonPointerTracker jsonPointer) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!writePrimitives(o)) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Collection.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;isInstance(o)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;MappingGeneratorImpl.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; writePrimitives(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value) {
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; handled = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;// fake a write
&lt;/span&gt;    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That is, the writeItem invokes writePrimitives and writePrimitives says it handled the null, when it in fact did nothing.&lt;/p&gt;

&lt;p&gt;Currently serializing null within a list only produces correct results when the list is the root object of serialization.&lt;br/&gt;
Test cases attached; run mvn test to see include tests against 1.1.5&lt;/p&gt;

&lt;p&gt;I&apos;ve had to include our own altered copy of MappingGeneratorImpl to the classpath (at a higher priority) to workaround the issue indicated here in our project.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13127644">JOHNZON-151</key>
            <summary>Serializing nulls within a list, within a type or map produces unexpected results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="struberg">Mark Struberg</assignee>
                                    <reporter username="steven.walters">Steven Walters</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Dec 2017 08:33:15 +0000</created>
                <updated>Mon, 26 Feb 2018 12:45:17 +0000</updated>
                            <resolved>Mon, 26 Feb 2018 12:45:17 +0000</resolved>
                                    <version>1.1.0</version>
                    <version>1.1.1</version>
                    <version>1.1.2</version>
                    <version>1.1.3</version>
                    <version>1.1.4</version>
                    <version>1.1.5</version>
                                    <fixVersion>1.1.7</fixVersion>
                                    <component>Mapper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16306136" author="romain.manni-bucau" created="Fri, 29 Dec 2017 09:15:26 +0000"  >&lt;p&gt;Hi Steven,&lt;/p&gt;

&lt;p&gt;very good catch! Do you want to submit a PR to fix it?&lt;/p&gt;

&lt;p&gt;Quick tip: we have a flag to serialize or not nulls in the config this should respect I think.&lt;/p&gt;</comment>
                            <comment id="16306349" author="steven.walters" created="Fri, 29 Dec 2017 15:44:20 +0000"  >&lt;p&gt;I could open a PR with a possible path to resolution, but should probably have the general direction settled first.&lt;/p&gt;

&lt;p&gt;for the NPE issue starting in 1.1.5, this seems easy enough with adding a null check, so from&lt;br/&gt;
&lt;tt&gt;if (objectConverterToUse == null)&lt;/tt&gt; to &lt;tt&gt;if (objectConverterToUse == null &amp;amp;&amp;amp; o != null)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;For the null inclusion/skipping. this seems like it could be in writePrimitives such as &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!config.isSkipNull()) {
        generator.writeNull();
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so the config would drive the inclusion of nulls as appropriate.&lt;/p&gt;

&lt;p&gt;if this sounds adequate, I can open a PR later.&lt;/p&gt;</comment>
                            <comment id="16306595" author="steven.walters" created="Fri, 29 Dec 2017 23:08:13 +0000"  >&lt;p&gt;Actually the null handling approach will be inconsistent if this route is taken.&lt;br/&gt;
currently doWriteIterable &lt;b&gt;ALWAYS&lt;/b&gt; writes nulls, irregardless of the configuration to skip.&lt;br/&gt;
I&apos;m actually in favor of this approach, as skipping nulls in a list is a rather large modification of the list, which is quite different than skipping null keyed-values.&lt;br/&gt;
you should re-evaluate your desire to utilize the configuration option here.&lt;/p&gt;</comment>
                            <comment id="16306694" author="romain.manni-bucau" created="Sat, 30 Dec 2017 09:01:48 +0000"  >&lt;p&gt;Makes perfect sense&lt;/p&gt;</comment>
                            <comment id="16306778" author="steven.walters" created="Sat, 30 Dec 2017 14:04:06 +0000"  >&lt;p&gt;opened PR at &lt;a href=&quot;https://github.com/apache/johnzon/pull/16&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/johnzon/pull/16&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16376804" author="struberg" created="Mon, 26 Feb 2018 12:45:17 +0000"  >&lt;p&gt;Seems this already got released with 1.1.6 even.&lt;/p&gt;

&lt;p&gt;Verified for 1.1.7 at lest.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;txs for the report and fix!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12903993" name="johnzon-mapper-nulls-in-collection.zip" size="2739" author="steven.walters" created="Fri, 29 Dec 2017 08:23:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3od3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>