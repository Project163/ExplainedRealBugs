<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:03:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JOHNZON-177] Deserialization of numbers can produce overflows and underflows</title>
                <link>https://issues.apache.org/jira/browse/JOHNZON-177</link>
                <project id="12315523" key="JOHNZON">Johnzon</project>
                    <description>&lt;p&gt;Given the following json:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
&#160;&#160;&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;: 2147483648
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and the following dto:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;IntContainer {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; value;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setValue(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; value) { &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.value = value; }
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; getValue() { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value; }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When I try to parse the json in the dto, the value overflows and is deserialized as negative value (or vice versa, if too large a negative number is used).&lt;/p&gt;

&lt;p&gt;Failing test case:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void shouldNotAcceptOutOfBoundsValue() {
  &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; json = &lt;span class=&quot;code-quote&quot;&gt;&quot;{ \&quot;&lt;/span&gt;value\&lt;span class=&quot;code-quote&quot;&gt;&quot;: 2147483648 }&quot;&lt;/span&gt;;
  Jsonb jsonb = JsonbProvider.provider().create().build();

  IntContainer intContainer = jsonb.fromJson(json, IntContainer.class);
  LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;deserialized value: {}&quot;&lt;/span&gt;, intContainer.getValue());
  Assert.fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;should &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; instead of wrapping the value in negative area&quot;&lt;/span&gt;);
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Log output is:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SerializationTest deserialized value: -2147483648&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The expected behavior would probably be an Exception if the number exceeds the bounds of the type of the field that the value should be deserialized into (byte, short, int, or long).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As additional info, because we researched this when confronted with this problem initially (with type int): Applying ijson-strict (rfc7493) doesn&apos;t help in this situation since there are values that are allowed by the ijson rfc and still over-/underflow a 32-bit integer (and it would further require us to transmit long values as string).&lt;/p&gt;

&lt;p&gt;Boundaries:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;2147483647 max value of signed 32bit integer&lt;/li&gt;
	&lt;li&gt;9007199254740991 &amp;gt; ijson maxvalue: &quot;senders cannot expect receivers to parse numbers larger than...&quot;&lt;/li&gt;
	&lt;li&gt;9223372036854775807 64b integer&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13170290">JOHNZON-177</key>
            <summary>Deserialization of numbers can produce overflows and underflows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="struberg">Mark Struberg</assignee>
                                    <reporter username="mbruckner">Markus Bruckner</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Jul 2018 15:05:38 +0000</created>
                <updated>Thu, 1 Aug 2019 13:17:18 +0000</updated>
                                            <version>1.1.8</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16533899" author="romain.manni-bucau" created="Thu, 5 Jul 2018 16:56:04 +0000"  >&lt;p&gt;Hello&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I read it as the impl does the requested thing.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Isnt the issue you dont use a BigInteger or BigDecimal? Or do you mean it is a parsing issue.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Romain&lt;/p&gt;</comment>
                            <comment id="16534289" author="struberg" created="Thu, 5 Jul 2018 23:41:39 +0000"  >&lt;p&gt;It looks like a real issue. Having a POJO with only an int but sending a bigger number then MAX_INT leading to just truncating the number will give you wrong results.&lt;/p&gt;

&lt;p&gt;We should imo blow up with an IllegalArgumentException or something similar.&lt;/p&gt;</comment>
                            <comment id="16534429" author="romain.manni-bucau" created="Fri, 6 Jul 2018 05:00:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=struberg&quot; class=&quot;user-hover&quot; rel=&quot;struberg&quot;&gt;struberg&lt;/a&gt; only if ijson compatible since it must be our default today, otherwise +1&lt;/p&gt;</comment>
                            <comment id="16543686" author="struberg" created="Fri, 13 Jul 2018 20:49:17 +0000"  >&lt;p&gt;hmmm right now ijson doesn&apos;t do that much in Johnzon...&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
config.getProperty(JsonbConfig.STRICT_IJSON).map(&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.class::&lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;).ifPresent(ijson -&amp;gt; {
    &lt;span class=&quot;code-comment&quot;&gt;// no-op: https://tools.ietf.org/html/rfc7493 the only MUST of the spec should be fine by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
&lt;/span&gt;});
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16543767" author="romain.manni-bucau" created="Fri, 13 Jul 2018 21:44:14 +0000"  >&lt;p&gt;Yep and it is compatible &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16545062" author="struberg" created="Mon, 16 Jul 2018 10:54:08 +0000"  >&lt;p&gt;Got an answer from Dmitry!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/eclipse-ee4j/jsonb-api/issues/82#issuecomment-405209574&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse-ee4j/jsonb-api/issues/82#issuecomment-405209574&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;According to the spec we really should blow up with a JsonbException&lt;/p&gt;</comment>
                            <comment id="16551042" author="struberg" created="Fri, 20 Jul 2018 17:44:13 +0000"  >&lt;p&gt;Seems this introduced a subtle problem.&lt;/p&gt;

&lt;p&gt;Consider the following byte[] representation:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[1,5,8,255]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is perfectly valid in JSON and would also be perfectly fine as byte[] bitmask.&lt;br/&gt;
But 255 is 0xFF or 0b1111_1111 in binary. The Most Significant Bit is in Java always interpreted as sign bit. Because Java - unlike C - doesn&apos;t know any unsigned types.&lt;/p&gt;

&lt;p&gt;So according to the current rules this array will blow up with an OverflowException.&lt;/p&gt;

&lt;p&gt;Note that the same array is fundamentally the same like&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[1,5,8,-1]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which would be perfectly valid in our current rules. But most JSON libs use the former form.&lt;/p&gt;</comment>
                            <comment id="16731599" author="jwcarman" created="Tue, 1 Jan 2019 13:59:39 +0000"  >&lt;p&gt;This is most definitely a bug.&#160; The specification says (section 3.3.2):&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Deserialization of a JSON value into java.lang.Byte, Short, Integer, Long, Float or Double instance (or their corresponding primitive types) MUST follow the conversion process defined in the javadoc specification for the corresponding parse$Type method, such as java.lang.Byte.parseByte() for Byte.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If you attempt to call Byte.parseByte(&quot;255&quot;), you get a NumberFormatException.  &lt;/p&gt;</comment>
                            <comment id="16736357" author="struberg" created="Mon, 7 Jan 2019 21:13:23 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jwcarman&quot; class=&quot;user-hover&quot; rel=&quot;jwcarman&quot;&gt;jwcarman&lt;/a&gt;!&lt;br/&gt;
It was clarified with the EG that the current spec does simply not fully embrace the JSON specification.&lt;br/&gt;
See the link to the EG discussion I posted above. Still needs to get clarified how it should behave exactly in the future.&lt;/p&gt;</comment>
                            <comment id="16736365" author="anders.rundgren.net@gmail.com" created="Mon, 7 Jan 2019 21:18:00 +0000"  >
&lt;p&gt;Indeed:&lt;br/&gt;
&lt;a href=&quot;https://github.com/eclipse-ee4j/jsonb-api/issues/112&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/eclipse-ee4j/jsonb-api/issues/112&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Anders&lt;/p&gt;
</comment>
                            <comment id="16898081" author="struberg" created="Thu, 1 Aug 2019 13:17:18 +0000"  >&lt;p&gt;Removing fix version as this requires a spec change to be properly resolved. &lt;br/&gt;
Our handling is at least improved for now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 15 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vkvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>