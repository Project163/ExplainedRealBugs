{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/7379","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7379/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7379/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7379/events","html_url":"https://github.com/tauri-apps/tauri/issues/7379","id":1793856237,"node_id":"I_kwDOC7lts85q7BLt","number":7379,"title":"[bug] fs `readDir` fails for `BaseDirectory.Home` root with \"Access is denied. (os error 5)\", even as Admin","user":{"login":"Wombosvideo","id":4274488,"node_id":"MDQ6VXNlcjQyNzQ0ODg=","avatar_url":"https://avatars.githubusercontent.com/u/4274488?v=4","gravatar_id":"","url":"https://api.github.com/users/Wombosvideo","html_url":"https://github.com/Wombosvideo","followers_url":"https://api.github.com/users/Wombosvideo/followers","following_url":"https://api.github.com/users/Wombosvideo/following{/other_user}","gists_url":"https://api.github.com/users/Wombosvideo/gists{/gist_id}","starred_url":"https://api.github.com/users/Wombosvideo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Wombosvideo/subscriptions","organizations_url":"https://api.github.com/users/Wombosvideo/orgs","repos_url":"https://api.github.com/users/Wombosvideo/repos","events_url":"https://api.github.com/users/Wombosvideo/events{/privacy}","received_events_url":"https://api.github.com/users/Wombosvideo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""},{"id":4288483270,"node_id":"LA_kwDOC7lts87_nQ_G","url":"https://api.github.com/repos/tauri-apps/tauri/labels/status:%20needs%20triage","name":"status: needs triage","color":"059372","default":false,"description":"This issue needs to triage, applied to new issues"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2023-07-07T16:54:30Z","updated_at":"2023-10-20T12:56:53Z","closed_at":"2023-10-20T12:56:53Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\n**What doesn't work:**\r\nUsing `readDir('', { dir: BaseDirectory.Home, recursive: true })` on Windows throws  \r\n`path: <homeDirPath>: Access is denied. (os error 5)`.\r\n\r\n**What this means:**\r\nThis suggests that the user does not have access to `<homeDirPath>` which can not be the case, since using `recursive: false` succeeds.\r\n\r\n**Possible cause:**  \r\nThe error is thrown because the user doesn't have access to some subdirectory of `<homeDirPath>` and trying to read that directory failed.\r\n\r\n**Why this needs fixing:**  \r\n- The error doesn't tell which directory failed; it always uses the `<homeDirPath>`. This makes debugging impossible.\r\n- There is no way to obtain the entries that _didn't_ fail. This makes a `readDir` invocation useless.\n\n### Reproduction\n\n```js\r\nimport { readDir, BaseDirectory } from '@tauri-apps/api/fs';\r\n\r\nasync function test() {\r\n  // Empty string as dir parameter\r\n  await readDir('', { dir: BaseDirectory.Home, recursive: true }); // Throws \"path: <homeDirPath>: Access is denied. (os error 5)\"\r\n  // Dot as dir parameter\r\n  await readDir('.', { dir: BaseDirectory.Home, recursive: true }); // Throws \"path: <homeDirPath>.: Access is denied. (os error 5)\"\r\n}\r\n\r\nawait test();\r\n```\n\n### Expected behavior\n\n- Only throw an error if the root directory of `readDir(rootDir, { recursive: true })` can not be read\r\n- When throwing an error, use the path of the directory that _actually_ failed instead of the root directory\r\n- Include the problematic subdirectory in the result but set `subdirectory.children = [];` (`'empty'`)\r\n- Exclude the problematic subdirectory from the result (`'exclude'`)\r\n- For backward compatibility, add `errors?: 'throw' | 'empty' | 'exclude'` to type `FsDirOptions` (defaulting to `'throw'`)\n\n### Platform and versions\n\n```text\n[✔] Environment\r\n    - OS: Windows 10.0.22621 X64\r\n    ✔ WebView2: 114.0.1823.67\r\n    ✔ MSVC:\r\n        - Visual Studio Build Tools 2022\r\n        - Visual Studio Community 2022\r\n    ✔ rustc: 1.70.0 (90c541806 2023-05-31)\r\n    ✔ Cargo: 1.70.0 (ec8a8a0ca 2023-04-25)\r\n    ✔ rustup: 1.26.0 (5af9b9484 2023-04-05)\r\n    ✔ Rust toolchain: stable-x86_64-pc-windows-msvc (default)\r\n    - node: 20.4.0\r\n    - npm: 9.7.2\r\n\r\n[-] Packages\r\n    - tauri [RUST]: 1.4.1\r\n    - tauri-build [RUST]: 1.4.0\r\n    - wry [RUST]: 0.24.3\r\n    - tao [RUST]: 0.16.2\r\n    - @tauri-apps/api [NPM]: 1.4.0\r\n    - @tauri-apps/cli [NPM]: 1.4.0\r\n\r\n[-] App\r\n    - build-type: bundle\r\n    - CSP: unset\r\n    - distDir: ../build\r\n    - devPath: http://localhost:5173/\r\n    - framework: Svelte\r\n    - bundler: Vite\n```\n\n\n### Stack trace\n\n```text\nUncaught (in promise) path: <homeDirPath>: Access is denied. (os error 5)\n```\n\n\n### Additional context\n\n_No response_","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/7379/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7379/timeline","performed_via_github_app":null,"state_reason":"completed"}