{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/10336","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/10336/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/10336/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/10336/events","html_url":"https://github.com/tauri-apps/tauri/issues/10336","id":2421013913,"node_id":"I_kwDOC7lts86QTb2Z","number":10336,"title":"[bug] - v2 tauri::command unable to deserialize Vec<u8> from Uint8Array","user":{"login":"jasonterando","id":6109917,"node_id":"MDQ6VXNlcjYxMDk5MTc=","avatar_url":"https://avatars.githubusercontent.com/u/6109917?v=4","gravatar_id":"","url":"https://api.github.com/users/jasonterando","html_url":"https://github.com/jasonterando","followers_url":"https://api.github.com/users/jasonterando/followers","following_url":"https://api.github.com/users/jasonterando/following{/other_user}","gists_url":"https://api.github.com/users/jasonterando/gists{/gist_id}","starred_url":"https://api.github.com/users/jasonterando/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasonterando/subscriptions","organizations_url":"https://api.github.com/users/jasonterando/orgs","repos_url":"https://api.github.com/users/jasonterando/repos","events_url":"https://api.github.com/users/jasonterando/events{/privacy}","received_events_url":"https://api.github.com/users/jasonterando/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""},{"id":3175211457,"node_id":"MDU6TGFiZWwzMTc1MjExNDU3","url":"https://api.github.com/repos/tauri-apps/tauri/labels/scope:%20api.js","name":"scope: api.js","color":"D4C5F9","default":false,"description":"The @tauri-apps/api npm package"},{"id":3410829358,"node_id":"LA_kwDOC7lts87LTSAu","url":"https://api.github.com/repos/tauri-apps/tauri/labels/status:%20backlog","name":"status: backlog","color":"059372","default":false,"description":"Issue is ready and we can work on it"}],"state":"closed","locked":false,"assignee":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":5,"created_at":"2024-07-20T18:47:16Z","updated_at":"2024-08-27T15:49:19Z","closed_at":"2024-08-27T15:49:19Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nWhen creating a command that accepts a structure containing a Vec\\<u8\\>, sourced from a TypeScript interface with a UInt8Array property, the error \" invalid type: map, expected a sequence\" is generated.  Replacing the TypeScript Uint8Array property with a number[] property works.  From what I understand, I should be able to use UInt8Array, not sure if I am missing a feature or something.  I tried to enable tracing but couldn't get that to work either, but that is for another day...\r\n\r\n### Reproduction\r\n\r\nComplete example:  [on GitHub](https://github.com/jasonterando/tauri-uint8array-cmd)\r\n\r\nExcerpts:\r\n\r\n**TypeScript**\r\n```ts\r\nimport { invoke } from \"@tauri-apps/api/core\";\r\n\r\nconst runTest = async (useNumberArray: boolean, resultEl: HTMLElement) => {\r\n  let value = useNumberArray ? {\r\n    name: 'TestWithNumberArray',\r\n    data: [1, 2, 3, 4, 5]\r\n  } : {\r\n    name: 'TestWithUIntArray',\r\n    data: Uint8Array.from([1, 2, 3, 4, 5])\r\n  }\r\n\r\n  try {\r\n    resultEl.textContent = 'Success: ' + await invoke(\"convert\", { value })\r\n  } catch (e) {\r\n    resultEl.textContent = `${e}`\r\n  }\r\n}\r\n\r\nwindow.addEventListener(\"DOMContentLoaded\", () => {\r\n  let resultEl = document.querySelector(\"#result\") as HTMLElement;\r\n  var btn1 = document.getElementById(\"perform-test-1\");\r\n  if (btn1 != null) btn1.onclick = (async () => await runTest(true, resultEl));\r\n  var btn1 = document.getElementById(\"perform-test-2\");\r\n  if (btn1 != null) btn1.onclick = (async () => await runTest(false, resultEl));\r\n});\r\n```\r\n\r\nTauri Rust Main\r\n```rs\r\n// Prevents additional console window on Windows in release, DO NOT REMOVE!!\r\n#![cfg_attr(not(debug_assertions), windows_subsystem = \"windows\")]\r\n\r\nuse tracing::Level;\r\n\r\nfn main() {\r\n    tracing_subscriber::fmt()\r\n        .with_max_level(Level::TRACE)\r\n        .with_file(true)\r\n        .with_line_number(true)\r\n        .init();\r\n\r\n    tauri::Builder::default()\r\n        .plugin(tauri_plugin_shell::init())\r\n        .invoke_handler(tauri::generate_handler![convert])\r\n        .run(tauri::generate_context!())\r\n        .expect(\"error while running tauri application\");\r\n}\r\n\r\n#[derive(serde::Deserialize)]\r\npub struct Test {\r\n    name: String,\r\n    data: Vec<u8>\r\n}\r\n\r\n#[tauri::command]\r\nfn convert(value: Test) -> String {\r\n    format!(\"{} is {} byte(s) long\", &value.name, value.data.len())\r\n}\r\n```\r\n\r\n### Expected behavior\r\n\r\nI would expect to be able to pass JS/TS objects with Uint8Array properties and have those map to Rust Vec<u8> properties.\r\n\r\n### Full `tauri info` output\r\n\r\n```text\r\n[✘] Environment\r\n    - OS: Linux Mint 21.3 X64\r\n    ✔ webkit2gtk-4.1: 2.44.2\r\n    ✘ rsvg2: not installed\r\n      Visit https://tauri.app/v1/guides/getting-started/prerequisites to learn more about tauri prerequisites\r\n    ✔ rustc: 1.79.0 (129f3b996 2024-06-10)\r\n    ✔ cargo: 1.79.0 (ffa9cf99a 2024-06-03)\r\n    ✔ rustup: 1.27.1 (54dd3d00f 2024-04-24)\r\n    ✔ Rust toolchain: 1.79.0-x86_64-unknown-linux-gnu (default)\r\n    - node: 20.15.1\r\n    - yarn: 1.22.22\r\n    - npm: 10.8.2\r\n\r\n[-] Packages\r\n    - tauri [RUST]: 2.0.0-beta.24\r\n    - tauri-build [RUST]: 2.0.0-beta.19\r\n    - wry [RUST]: 0.41.0\r\n    - tao [RUST]: 0.28.1\r\n    - @tauri-apps/api [NPM]: 2.0.0-beta.15\r\n    - @tauri-apps/cli [NPM]: 2.0.0-beta.22\r\n\r\n[-] App\r\n    - build-type: bundle\r\n    - CSP: unset\r\n    - frontendDist: ../out\r\n    - devUrl: http://localhost:3000/\r\n    - framework: React (Next.js)\r\n    - bundler: Webpack\r\n```\r\n\r\n### Stack trace\r\n\r\n```text\r\nN/A\r\n```\r\n\r\n\r\n### Additional context\r\n\r\nhttps://github.com/tauri-apps/tauri/issues/9787 implies that I should be able to use Uint8Array","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/10336/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/10336/timeline","performed_via_github_app":null,"state_reason":"completed"}