{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/6652","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/6652/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/6652/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/6652/events","html_url":"https://github.com/tauri-apps/tauri/issues/6652","id":1658096740,"node_id":"I_kwDOC7lts85i1Ixk","number":6652,"title":"[bug] No notification sound on Windows","user":{"login":"Lej77","id":31554212,"node_id":"MDQ6VXNlcjMxNTU0MjEy","avatar_url":"https://avatars.githubusercontent.com/u/31554212?v=4","gravatar_id":"","url":"https://api.github.com/users/Lej77","html_url":"https://github.com/Lej77","followers_url":"https://api.github.com/users/Lej77/followers","following_url":"https://api.github.com/users/Lej77/following{/other_user}","gists_url":"https://api.github.com/users/Lej77/gists{/gist_id}","starred_url":"https://api.github.com/users/Lej77/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lej77/subscriptions","organizations_url":"https://api.github.com/users/Lej77/orgs","repos_url":"https://api.github.com/users/Lej77/repos","events_url":"https://api.github.com/users/Lej77/events{/privacy}","received_events_url":"https://api.github.com/users/Lej77/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""},{"id":4288483270,"node_id":"LA_kwDOC7lts87_nQ_G","url":"https://api.github.com/repos/tauri-apps/tauri/labels/status:%20needs%20triage","name":"status: needs triage","color":"059372","default":false,"description":"This issue needs to triage, applied to new issues"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-04-06T22:00:52Z","updated_at":"2023-05-24T20:20:15Z","closed_at":"2023-05-24T20:20:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nNotifications on Windows don't make any sound when shown. This is not the default and most other apps do make a sound when showing a notification.\r\n\r\n### Reproduction\r\n\r\n1. Show a [notification](https://docs.rs/tauri/1.2.4/tauri/api/notification/struct.Notification.html) on windows:\r\n```rust\r\nuse tauri::api::notification::Notification;\r\n\r\nNotification::new(&app.config().tauri.bundle.identifier)\r\n    .title(\"New message\")\r\n    .body(\"You've got a new message.\")\r\n    .notify(app)\r\n    .expect(\"failed to show notification\");\r\n```\r\n\r\n### Expected behavior\r\n\r\nA notification is shown and a sound is played.\r\n\r\n### Platform and versions\r\n\r\n```text\r\nEnvironment\r\n  › OS: Windows 10.0.19044 X64\r\n  › Webview2: 111.0.1661.62\r\n  › MSVC: \r\n      - Visual Studio Community 2022\r\n  › Node.js: 19.7.0\r\n  › npm: 9.5.0\r\n  › pnpm: Not installed!\r\n  › yarn: Not installed!\r\n  › rustup: 1.25.2\r\n  › rustc: 1.68.2\r\n  › cargo: 1.68.2\r\n  › Rust toolchain: stable-x86_64-pc-windows-msvc \r\n\r\nPackages\r\nWARNING: no lock files found, defaulting to npm\r\n  › @tauri-apps/cli [NPM]: 1.2.3\r\n  › @tauri-apps/api [NPM]: Not installed!\r\n  › tauri [RUST]: 1.2.4,\r\n  › tauri-build [RUST]: 1.2.1,\r\n  › tao [RUST]: 0.15.8,\r\n  › wry [RUST]: 0.23.4,\r\n\r\nApp\r\n  › build-type: bundle\r\n  › CSP: unset\r\n  › distDir: ../dist\r\n  › devPath: http://localhost:1420/\r\npackage.json not found\r\n\r\nApp directory structure\r\n  ├─ .git\r\n  ├─ .vscode\r\n  ├─ dist\r\n  ├─ public\r\n  ├─ src\r\n  └─ src-tauri\r\n```\r\n\r\n\r\n### Stack trace\r\n\r\n_No response_\r\n\r\n### Additional context\r\n\r\ntauri-apps/plugins-workspace#2144 might be relevant to this issue.\r\n\r\nTauri uses the `notify-rust` crate to handle notifications ([source](https://github.com/tauri-apps/tauri/discussions/6017#discussioncomment-4631129)). Its [`notify_rust::Notification::sound_name`](https://docs.rs/notify-rust/latest/x86_64-pc-windows-msvc/notify_rust/struct.Notification.html#method.sound_name) method allows specifying the sound name. The sound name is [later in its windows implementation](https://github.com/hoodie/notify-rust/blob/09abb2a41f97df4973a195ce971709d27f3de443/src/windows.rs#L8-L11) parsed using [`winrt_notification::Sound::from_str`](https://allenbenz.github.io/winrt-notification/0_5_0/winrt_notification/enum.Sound.html#method.from_str) which is derive using\r\n[`strum::EnumString`](https://docs.rs/strum/0.24.1/strum/derive.EnumString.html). The derive macro's documentation says \"Each variant of the enum will match on it’s own name\". Which means we need to pass the string \"Default\" to get the default sound. Finally this enum is converted to the real audio tag in [`winrt_notification::Toast::sound`](https://allenbenz.github.io/winrt-notification/0_5_0/src/winrt_notification/lib.rs.html#243-253).\r\n\r\nNote that setting the sound to `None` results in `<audio silent=\\\"true\\\" />` being appended to the \"toast\" xml in the `winrt-notification` crate while specifying the `Default` sound [appends an empty string](https://allenbenz.github.io/winrt-notification/0_5_0/src/winrt_notification/lib.rs.html#246).\r\n\r\nAnyway, this all means that the issue can be solved by adding the following code:\r\n\r\n```rust\r\n#[cfg(windows)]\r\n{\r\n    notification.sound_name(\"Default\");\r\n}\r\n```\r\n\r\nIn the [`tauri::api::notification::Notification::show`](https://docs.rs/tauri/1.2.4/src/tauri/api/notification.rs.html#98-137) method.","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/6652/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/6652/timeline","performed_via_github_app":null,"state_reason":"completed"}