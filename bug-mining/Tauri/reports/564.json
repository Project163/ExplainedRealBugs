{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/11263","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/11263/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/11263/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/11263/events","html_url":"https://github.com/tauri-apps/tauri/issues/11263","id":2571702613,"node_id":"I_kwDOC7lts86ZSRFV","number":11263,"title":"[bug] the asset protocol should respect HEAD method and not return body","user":{"login":"chrox","id":751535,"node_id":"MDQ6VXNlcjc1MTUzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/751535?v=4","gravatar_id":"","url":"https://api.github.com/users/chrox","html_url":"https://github.com/chrox","followers_url":"https://api.github.com/users/chrox/followers","following_url":"https://api.github.com/users/chrox/following{/other_user}","gists_url":"https://api.github.com/users/chrox/gists{/gist_id}","starred_url":"https://api.github.com/users/chrox/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrox/subscriptions","organizations_url":"https://api.github.com/users/chrox/orgs","repos_url":"https://api.github.com/users/chrox/repos","events_url":"https://api.github.com/users/chrox/events{/privacy}","received_events_url":"https://api.github.com/users/chrox/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""},{"id":4288483270,"node_id":"LA_kwDOC7lts87_nQ_G","url":"https://api.github.com/repos/tauri-apps/tauri/labels/status:%20needs%20triage","name":"status: needs triage","color":"059372","default":false,"description":"This issue needs to triage, applied to new issues"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-10-07T23:16:50Z","updated_at":"2024-10-08T01:07:43Z","closed_at":"2024-10-08T01:07:43Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nIn the HTTP standard, a HEAD request is similar to a GET request but [does not return a message body in the response](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/HEAD). \r\n> The server sends back a [200 OK](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/200) response comprised only of headers. The response is effectively metadata that describes the resource instead of the resource itself.\r\n\r\nIn the current implementation of the asset protocol, the response body includes the entire file content regardless of whether a HEAD method is used, which can result in unnecessary memory consumption in certain cases.\r\n```\r\nlet buf = if let Some(b) = read_bytes {\r\n      b\r\n    } else {\r\n      crate::async_runtime::safe_block_on(async move {\r\n        let mut local_buf = Vec::with_capacity(len as usize);\r\n        file.read_to_end(&mut local_buf).await?;\r\n        Ok::<Vec<u8>, anyhow::Error>(local_buf)\r\n      })?\r\n    };\r\n    resp = resp.header(CONTENT_LENGTH, len);\r\n    resp.body(buf.into())\r\n```\r\n\r\nThe screenshot shows the entire file content is downloaded which is not intended for the HEAD request.\r\n![screenshot-20241008-005340](https://github.com/user-attachments/assets/993d539c-5f63-4f8e-8a86-0955b673a798)\r\n\n\n### Reproduction\n\n_No response_\n\n### Expected behavior\n\nIt should not return the file content in the response body with HEAD request.\r\n![screenshot-20241008-005547](https://github.com/user-attachments/assets/4714484e-1fb5-416c-8e8d-27d05f3d3049)\r\n\n\n### Full `tauri info` output\n\n```text\n[âœ”] Environment\r\n    - OS: Mac OS 14.3.1 arm64 (X64)\r\n    âœ” Xcode Command Line Tools: installed\r\n    âœ” rustc: 1.81.0 (eeb90cda1 2024-09-04)\r\n    âœ” cargo: 1.81.0 (2dbb1af80 2024-08-20)\r\n    âœ” rustup: 1.27.1 (54dd3d00f 2024-04-24)\r\n    âœ” Rust toolchain: stable-aarch64-apple-darwin (default)\r\n    - node: 22.5.1\r\n    - pnpm: 9.12.0\r\n    - yarn: 1.22.22\r\n    - npm: 10.8.2\r\n\r\n[-] Packages\r\n    - tauri ðŸ¦€: 2.0.2\r\n    - tauri-build ðŸ¦€: 2.0.1\r\n    - wry ðŸ¦€: 0.44.1\r\n    - tao ðŸ¦€: 0.30.3\r\n    - @tauri-apps/api îœ˜: 2.0.2\r\n    - @tauri-apps/cli îœ˜: 2.0.2\r\n\r\n[-] Plugins\r\n    - tauri-plugin-log ðŸ¦€: 2.0.1\r\n    - @tauri-apps/plugin-log îœ˜: 2.0.0\r\n    - tauri-plugin-http ðŸ¦€: 2.0.1\r\n    - @tauri-apps/plugin-http îœ˜: 2.0.0\r\n    - tauri-plugin-dialog ðŸ¦€: 2.0.1\r\n    - @tauri-apps/plugin-dialog îœ˜: 2.0.0\r\n    - tauri-plugin-os ðŸ¦€: 2.0.1\r\n    - @tauri-apps/plugin-os îœ˜: 2.0.0\r\n    - tauri-plugin-fs ðŸ¦€: 2.0.1\r\n    - @tauri-apps/plugin-fs îœ˜: 2.0.0\r\n\r\n[-] App\r\n    - build-type: bundle\r\n    - CSP: default-src 'self' ipc: http://ipc.localhost; img-src 'self' data: asset: http://asset.localhost\r\n    - frontendDist: ../out\r\n    - devUrl: http://localhost:3000/\r\n    - framework: React (Next.js)\r\n    - bundler: Webpack\n```\n\n\n### Stack trace\n\n_No response_\n\n### Additional context\n\n_No response_","closed_by":{"login":"amrbashir","id":48618675,"node_id":"MDQ6VXNlcjQ4NjE4Njc1","avatar_url":"https://avatars.githubusercontent.com/u/48618675?v=4","gravatar_id":"","url":"https://api.github.com/users/amrbashir","html_url":"https://github.com/amrbashir","followers_url":"https://api.github.com/users/amrbashir/followers","following_url":"https://api.github.com/users/amrbashir/following{/other_user}","gists_url":"https://api.github.com/users/amrbashir/gists{/gist_id}","starred_url":"https://api.github.com/users/amrbashir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amrbashir/subscriptions","organizations_url":"https://api.github.com/users/amrbashir/orgs","repos_url":"https://api.github.com/users/amrbashir/repos","events_url":"https://api.github.com/users/amrbashir/events{/privacy}","received_events_url":"https://api.github.com/users/amrbashir/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/11263/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/11263/timeline","performed_via_github_app":null,"state_reason":"completed"}