{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/7184","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7184/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7184/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7184/events","html_url":"https://github.com/tauri-apps/tauri/issues/7184","id":1752792108,"node_id":"I_kwDOC7lts85oeXws","number":7184,"title":"[bug] Updater fails when using an NSIS installer requiring administrator access","user":{"login":"Raphiiko","id":111654848,"node_id":"U_kgDOBqe3wA","avatar_url":"https://avatars.githubusercontent.com/u/111654848?v=4","gravatar_id":"","url":"https://api.github.com/users/Raphiiko","html_url":"https://github.com/Raphiiko","followers_url":"https://api.github.com/users/Raphiiko/followers","following_url":"https://api.github.com/users/Raphiiko/following{/other_user}","gists_url":"https://api.github.com/users/Raphiiko/gists{/gist_id}","starred_url":"https://api.github.com/users/Raphiiko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Raphiiko/subscriptions","organizations_url":"https://api.github.com/users/Raphiiko/orgs","repos_url":"https://api.github.com/users/Raphiiko/repos","events_url":"https://api.github.com/users/Raphiiko/events{/privacy}","received_events_url":"https://api.github.com/users/Raphiiko/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""},{"id":3310697304,"node_id":"MDU6TGFiZWwzMzEwNjk3MzA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/platform:%20Windows","name":"platform: Windows","color":"fef2c0","default":false,"description":""},{"id":4288483270,"node_id":"LA_kwDOC7lts87_nQ_G","url":"https://api.github.com/repos/tauri-apps/tauri/labels/status:%20needs%20triage","name":"status: needs triage","color":"059372","default":false,"description":"This issue needs to triage, applied to new issues"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2023-06-12T13:39:10Z","updated_at":"2023-07-04T14:34:42Z","closed_at":"2023-07-04T11:38:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nWhen I try to have my Tauri application update itself to a new version, it fails when the new version is bundled with an NSIS installer that has installMode `both`. \r\n\r\nWhat happens is that the update is started, it waits a bit (I'm imagining it's downloading the installer), and eventually quits the old version without launching the new one. No installer for the update shows. When the application is started again, it's still the old version and no update was installed.\r\n\r\nWhen I run the old version of my application with `tauri dev` and I attempt to update from there, I get an error:\r\n\r\n```\r\nthread 'tokio-runtime-worker' panicked at 'installer failed to start: Os { code: 740, kind: Uncategorized, message: \"The requested operation requires elevation.\" }', C:\\Users\\Raph.cargo\\git\\checkouts\\tauri-9dcc2f9152472c1a\\076e1a8\\core\\tauri\\src\\updater\\core.rs:722:10\r\n```\r\n\r\nThe issue gets resolved when I run my application as administrator, before trying to update.\r\n\r\n### Reproduction\r\n\r\n1. Set up a Tauri app and update your tauri.conf.json:\r\n  a. Enable the updater functionality\r\n  b. Set the version to 1.0.0\r\n  c. Set the install mode for the NSIS installer to `both` or `perMachine` (Both require elevation)\r\n2. Build a first version \r\n3. Build a second version with a higher version number (1.1.0)\r\n4. Make the second version available as an update\r\n5. Run the first version and attempt to update to the second version.\r\n\r\nNotice how step 5 fails unless you run the first version as administrator.\r\n\r\n### Expected behavior\r\n\r\nWhen an outdated version of the application is run without elevation, I would expect the user to be given a UAC prompt when the NSIS installer for the update is run, should it require elevation. \r\n\r\n### Platform and versions\r\n\r\n(This is on the latest versions of the `dev` branch)\r\n\r\n```text\r\n[✔] Environment\r\n    - OS: Windows 10.0.22621 X64\r\n    ✔ WebView2: 114.0.1823.43\r\n    ✔ MSVC: \r\n        - Visual Studio Build Tools 2019\r\n        - Visual Studio Build Tools 2022\r\n        - Visual Studio Community 2022\r\n    ✔ rustc: 1.67.0 (fc594f156 2023-01-24)\r\n    ✔ Cargo: 1.67.0 (8ecd4f20a 2023-01-10)\r\n    ✔ rustup: 1.25.1 (bb60b1e89 2022-07-12)\r\n    ✔ Rust toolchain: stable-x86_64-pc-windows-msvc (environment override by RUSTUP_TOOLCHAIN)\r\n    - node: 18.13.0\r\n    - yarn: 1.22.19\r\n    - npm: 8.19.3\r\n\r\n[-] Packages\r\n    - tauri [RUST]: 1.3.0\r\n    - tauri-build [RUST]: 1.3.0\r\n    - wry [RUST]: 0.24.1\r\n    - tao [RUST]: git+https://github.com/tauri-apps/tao?branch=v0.16#ed6aab6b1226e56683798732ad01bf3f4658097e (0.16.0)\r\n    - @tauri-apps/api [NPM]: not installed!\r\n    - @tauri-apps/cli [NPM]: 1.3.1\r\n\r\n[-] App\r\n    - build-type: bundle\r\n    - CSP: unset\r\n    - distDir: ../dist/oyasumivr\r\n    - devPath: http://localhost:4200/\r\n    - framework: Angular\r\n    - bundler: Webpack\r\n```\r\n### Stack trace\r\n\r\n```text\r\nthread 'tokio-runtime-worker' panicked at 'installer failed to start: Os { code: 740, kind: Uncategorized, message: \"The requested operation requires elevation.\" }', C:\\Users\\Raph.cargo\\git\\checkouts\\tauri-9dcc2f9152472c1a\\076e1a8\\core\\tauri\\src\\updater\\core.rs:722:10\r\n```\r\n\r\n### Additional context\r\n\r\n_No response_","closed_by":{"login":"amrbashir","id":48618675,"node_id":"MDQ6VXNlcjQ4NjE4Njc1","avatar_url":"https://avatars.githubusercontent.com/u/48618675?v=4","gravatar_id":"","url":"https://api.github.com/users/amrbashir","html_url":"https://github.com/amrbashir","followers_url":"https://api.github.com/users/amrbashir/followers","following_url":"https://api.github.com/users/amrbashir/following{/other_user}","gists_url":"https://api.github.com/users/amrbashir/gists{/gist_id}","starred_url":"https://api.github.com/users/amrbashir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amrbashir/subscriptions","organizations_url":"https://api.github.com/users/amrbashir/orgs","repos_url":"https://api.github.com/users/amrbashir/repos","events_url":"https://api.github.com/users/amrbashir/events{/privacy}","received_events_url":"https://api.github.com/users/amrbashir/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/7184/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7184/timeline","performed_via_github_app":null,"state_reason":"completed"}