{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/3110","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3110/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3110/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3110/events","html_url":"https://github.com/tauri-apps/tauri/issues/3110","id":1088567449,"node_id":"I_kwDOC7lts85A4jiZ","number":3110,"title":"[bug] Creating a new window through a menu event handler results in app freeze","user":{"login":"mihirsamdarshi","id":5462077,"node_id":"MDQ6VXNlcjU0NjIwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/5462077?v=4","gravatar_id":"","url":"https://api.github.com/users/mihirsamdarshi","html_url":"https://github.com/mihirsamdarshi","followers_url":"https://api.github.com/users/mihirsamdarshi/followers","following_url":"https://api.github.com/users/mihirsamdarshi/following{/other_user}","gists_url":"https://api.github.com/users/mihirsamdarshi/gists{/gist_id}","starred_url":"https://api.github.com/users/mihirsamdarshi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mihirsamdarshi/subscriptions","organizations_url":"https://api.github.com/users/mihirsamdarshi/orgs","repos_url":"https://api.github.com/users/mihirsamdarshi/repos","events_url":"https://api.github.com/users/mihirsamdarshi/events{/privacy}","received_events_url":"https://api.github.com/users/mihirsamdarshi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-12-25T08:19:22Z","updated_at":"2021-12-29T01:51:35Z","closed_at":"2021-12-29T01:51:35Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nI have an event handler attached to `on_menu_event` that is supposed to create a new window by pulling the window attached to the event (`let window = event.window.clone()`) and then calls `window.create_window(...)`. \r\n\r\nHowever, this freezes on macOS, resulting in the spinning wheel of death.\r\n\r\n### Reproduction\r\n\r\nIn order to reproduce this issue, I created a new project with `yarn create tauri-app`, and choose a vanilla JS application. \r\n\r\nI changed my Tauri dep in `Cargo.toml` to be `{ git = \"https://github.com/tauri-apps/tauri\", features = [\"api-all\"] }`, and ran `cargo update`\r\n\r\nI then added the following code to my `main.rs`:\r\n```rust\r\n#![cfg_attr(\r\n  all(not(debug_assertions), target_os = \"windows\"),\r\n  windows_subsystem = \"windows\"\r\n)]\r\n\r\nuse tauri::{Menu, WindowMenuEvent, Wry, Submenu, CustomMenuItem, WindowUrl, WindowBuilder};\r\nuse url::Url;\r\n\r\n\r\n/// Creates the main menu of the application\r\npub fn create() -> Menu {\r\n    let test_menu = Menu::new()\r\n        .add_item(CustomMenuItem::new(\"new_window\", \"Create new window\"));\r\n\r\n    Menu::new()\r\n        .add_submenu(Submenu::new(\"Test\", test_menu))\r\n\r\n}\r\n\r\n/// Handles the various events that come from the application's menu\r\npub fn handler(event: WindowMenuEvent<Wry>) {\r\n    match event.menu_item_id() {\r\n        \"new_window\" => {\r\n            let mut window = event.window().clone();\r\n            let external_url = Url::parse(\"https://www.google.com\").unwrap();\r\n            window\r\n                .create_window(\r\n                    \"acknowledgements\".to_string(),\r\n                    WindowUrl::External(external_url),\r\n                    move |window_builder, webview_attributes| {\r\n                        (\r\n                            window_builder.resizable(false).center().visible(true),\r\n                            webview_attributes,\r\n                        )\r\n                    },\r\n                )\r\n                .unwrap();\r\n        }\r\n        _ => {}\r\n    }\r\n}\r\n\r\n\r\nfn main() {\r\n  tauri::Builder::default()\r\n      .menu(create())\r\n      .on_menu_event(handler)\r\n    .run(tauri::generate_context!())\r\n    .expect(\"error while running tauri application\");\r\n}\r\n```\r\n\r\n### Expected behavior\r\n\r\nA new window should open\r\n\r\n### Platform and versions\r\n\r\n```shell\r\nOperating System - Mac OS, version 12.1.0 X64\r\n\r\nNode.js environment\r\n  Node.js - 14.17.5\r\n  @tauri-apps/cli - 1.0.0-beta.10\r\n  @tauri-apps/api - 1.0.0-beta.8\r\n\r\nGlobal packages\r\n  npm - 8.0.0\r\n  yarn - 1.22.17\r\n\r\nRust environment\r\n  rustc - 1.57.0\r\n  cargo - 1.57.0\r\n\r\nApp directory structure\r\n/dist\r\n/node_modules\r\n/src-tauri\r\n\r\nApp\r\n  tauri.rs - 1.0.0-beta.8\r\n  build-type - bundle\r\n  CSP - default-src blob: data: filesystem: ws: wss: http: https: tauri: 'unsafe-eval' 'unsafe-inline' 'self' img-src: 'self'\r\n  distDir - ../dist\r\n  devPath - ../dist\r\n```\r\n\r\n\r\n### Stack trace\r\nSpindump/Sampled process:\r\n\r\n```shell\r\nMain thread call graph:\r\n    2313 Thread_6171478   DispatchQueue_1: com.apple.main-thread  (serial)\r\n    + 2313 start  (in dyld) + 462  [0x1164db4fe]\r\n    +   2313 main  (in new-tauri-app) + 22  [0x10544cbf6]\r\n    +     2313 std::rt::lang_start::h118e13e5ef4df79d  (in new-tauri-app) + 46  [0x10528885e]  rt.rs:145\r\n    +       2313 std::rt::lang_start_internal::h59ad95b3bebc83b2  (in new-tauri-app) + 31  [0x105b0b88f]\r\n    +         2313 std::rt::lang_start::_$u7b$$u7b$closure$u7d$$u7d$::hba408c8aa5a21c36  (in new-tauri-app) + 20  [0x105288884]  rt.rs:146\r\n    +           2313 std::sys_common::backtrace::__rust_begin_short_backtrace::h1bd899283b32bb22  (in new-tauri-app) + 17  [0x1053af5d1]  backtrace.rs:123\r\n    +             2313 core::ops::function::FnOnce::call_once::h91ec077f3e48ff75  (in new-tauri-app) + 14  [0x1051969ee]  function.rs:227\r\n    +               2313 new_tauri_app::main::h275fa4c6c08d0b3d  (in new-tauri-app) + 4282  [0x10544cb3a]  main.rs:45\r\n    +                 2313 tauri::app::Builder$LT$R$GT$::run::h1af9169918993299  (in new-tauri-app) + 206  [0x10526686e]  app.rs:1098\r\n    +                   2313 tauri::app::App$LT$R$GT$::run::h1b19cc6258effd53  (in new-tauri-app) + 332  [0x10526652c]  app.rs:480\r\n    +                     2313 _$LT$tauri_runtime_wry..Wry$u20$as$u20$tauri_runtime..Runtime$GT$::run::hcfc9e4d14499f782  (in new-tauri-app) + 729  [0x105286689]  lib.rs:1866\r\n    +                       2313 tao::event_loop::EventLoop$LT$T$GT$::run::h6020cc257c124fd3  (in new-tauri-app) + 108  [0x1052644bc]  event_loop.rs:152\r\n    +                         2313 tao::platform_impl::platform::event_loop::EventLoop$LT$T$GT$::run::h38565947eb256f56  (in new-tauri-app) + 61  [0x10526536d]  event_loop.rs:147\r\n    +                           2313 tao::platform_impl::platform::event_loop::EventLoop$LT$T$GT$::run_return::h1836615d480cd2e7  (in new-tauri-app) + 1327  [0x1052650bf]  event_loop.rs:180\r\n    +                             2313 objc::message::platform::send_unverified::h705b28df8b27a529  (in new-tauri-app) + 92  [0x10583b62c]\r\n    +                               2313 _$LT$$LP$$RP$$u20$as$u20$objc..message..MessageArguments$GT$::invoke::hbac3386416a16e2f  (in new-tauri-app) + 70  [0x10583b0e6]\r\n    +                                 2313 -[NSApplication run]  (in AppKit) + 586  [0x7ff82134f5a9]\r\n    +                                   2313 -[NSApplication(NSEvent) _nextEventMatchingEventMask:untilDate:inMode:dequeue:]  (in AppKit) + 1411  [0x7ff82135d1b8]\r\n    +                                     2313 _DPSNextEvent  (in AppKit) + 886  [0x7ff82135eb4c]\r\n    +                                       2313 _BlockUntilNextEventMatchingListInModeWithFilter  (in HIToolbox) + 70  [0x7ff827561fe5]\r\n    +                                         2313 ReceiveNextEventCommon  (in HIToolbox) + 587  [0x7ff827562247]\r\n    +                                           2313 RunCurrentEventLoopInMode  (in HIToolbox) + 292  [0x7ff8275624f1]\r\n    +                                             2313 CFRunLoopRunSpecific  (in CoreFoundation) + 563  [0x7ff81e92f5dd]\r\n    +                                               2313 __CFRunLoopRun  (in CoreFoundation) + 1156  [0x7ff81e930122]\r\n    +                                                 2313 __CFRunLoopDoObservers  (in CoreFoundation) + 543  [0x7ff81e930b54]\r\n    +                                                   2313 __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__  (in CoreFoundation) + 23  [0x7ff81e930cb7]\r\n    +                                                     2313 tao::platform_impl::platform::observer::control_flow_end_handler::h9c5abaeaf1c7a44d  (in new-tauri-app) + 48  [0x1057cb360]\r\n    +                                                       2313 tao::platform_impl::platform::observer::control_flow_handler::hf4b1969ebb8be054  (in new-tauri-app) + 249  [0x1057cb1a9]\r\n    +                                                         2313 tao::platform_impl::platform::event_loop::stop_app_on_panic::h3aa67c77341bc49e  (in new-tauri-app) + 78  [0x10581345e]\r\n    +                                                           2313 std::panic::catch_unwind::h8edbd3edd1d82694  (in new-tauri-app) + 21  [0x1057eff35]\r\n    +                                                             2313 std::panicking::try::h57503dc5ef63dae1  (in new-tauri-app) + 94  [0x1058177ee]\r\n    +                                                               2313 __rust_try  (in new-tauri-app) + 29  [0x1058251bd]\r\n    +                                                                 2313 std::panicking::try::do_call::h75ee17fc935d3cda  (in new-tauri-app) + 54  [0x105817966]\r\n    +                                                                   2313 tao::platform_impl::platform::observer::control_flow_handler::_$u7b$$u7b$closure$u7d$$u7d$::h06557f3c70c46066  (in new-tauri-app) + 40  [0x1057cb208]\r\n    +                                                                     2313 tao::platform_impl::platform::observer::control_flow_end_handler::_$u7b$$u7b$closure$u7d$$u7d$::he8ba43ca355a1dcd  (in new-tauri-app) + 92  [0x1057cb3cc]\r\n    +                                                                       2313 tao::platform_impl::platform::app_state::AppState::cleared::h1998e99a5d589602  (in new-tauri-app) + 982  [0x1057e0f76]\r\n    +                                                                         2313 tao::platform_impl::platform::app_state::Handler::handle_nonuser_event::h0451528e2bad49c9  (in new-tauri-app) + 680  [0x1057df118]\r\n    +                                                                           2313 _$LT$tao..platform_impl..platform..app_state..EventLoopHandler$LT$T$GT$$u20$as$u20$tao..platform_impl..platform..app_state..EventHandler$GT$::handle_nonuser_event::h413d327bcca7bda1  (in new-tauri-app) + 80  [0x10543df30]  app_state.rs:102\r\n    +                                                                             2313 tao::platform_impl::platform::app_state::EventLoopHandler$LT$T$GT$::with_callback::h9c164b2f474565af  (in new-tauri-app) + 636  [0x10543e6bc]  app_state.rs:81\r\n    +                                                                               2313 _$LT$tao..platform_impl..platform..app_state..EventLoopHandler$LT$T$GT$$u20$as$u20$tao..platform_impl..platform..app_state..EventHandler$GT$::handle_nonuser_event::_$u7b$$u7b$closure$u7d$$u7d$::h0629cfa21eb77342  (in new-tauri-app) + 374  [0x10543e0b6]  app_state.rs:103\r\n    +                                                                                 2313 _$LT$tauri_runtime_wry..Wry$u20$as$u20$tauri_runtime..Runtime$GT$::run::_$u7b$$u7b$closure$u7d$$u7d$::haec9b1ff4bb87b62  (in new-tauri-app) + 401  [0x105286981]  lib.rs:1867\r\n    +                                                                                   2313 tauri_runtime_wry::handle_event_loop::hfd72fd8fd7e632bf  (in new-tauri-app) + 2280  [0x1056ee188]\r\n    +                                                                                     2313 _$LT$alloc..boxed..Box$LT$F$C$A$GT$$u20$as$u20$core..ops..function..Fn$LT$Args$GT$$GT$::call::hcadac97b28736cbd  (in new-tauri-app) + 33  [0x10576af41]\r\n    +                                                                                       2313 tauri::window::Window$LT$R$GT$::on_menu_event::_$u7b$$u7b$closure$u7d$$u7d$::hb9f8a1b36c784d17  (in new-tauri-app) + 287  [0x105252c1f]  window.rs:344\r\n    +                                                                                         2313 tauri::manager::WindowManager$LT$R$GT$::attach_window::_$u7b$$u7b$closure$u7d$$u7d$::h7de45a91d749b886  (in new-tauri-app) + 496  [0x10532d4e0]  manager.rs:717\r\n    +                                                                                           2313 _$LT$alloc..boxed..Box$LT$F$C$A$GT$$u20$as$u20$core..ops..function..Fn$LT$Args$GT$$GT$::call::hec299f0faa6a8d4b  (in new-tauri-app) + 118  [0x10543c9c6]  boxed.rs:1705\r\n    +                                                                                             2313 core::ops::function::Fn::call::h1aa850eda33a46f3  (in new-tauri-app) + 58  [0x105192eea]  function.rs:70\r\n    +                                                                                               2313 new_tauri_app::handler::h662433b3c0c8ef8f  (in new-tauri-app) + 404  [0x10544b9f4]  main.rs:26\r\n    +                                                                                                 2313 tauri::window::Window$LT$R$GT$::create_window::h6a9fb0f74648dbd3  (in new-tauri-app) + 599  [0x105252917]  window.rs:201\r\n    +                                                                                                   2313 tauri::sealed::ManagerBase::create_new_window::h7523e8c531f0555d  (in new-tauri-app) + 1039  [0x10525134f]  lib.rs:383\r\n    +                                                                                                     2313 _$LT$tauri_runtime_wry..WryDispatcher$u20$as$u20$tauri_runtime..Dispatch$GT$::create_window::h19e4df1a63357a12  (in new-tauri-app) + 707  [0x1056e63d3]\r\n    +                                                                                                       2313 tauri_runtime_wry::send_user_message::hfa6318960340bfc1  (in new-tauri-app) + 730  [0x1056df93a]\r\n    +                                                                                                         2313 tauri_runtime_wry::handle_user_message::h0019cb984a6b0b68  (in new-tauri-app) + 816  [0x1056e9530]\r\n    +                                                                                                           2313 _$LT$alloc..boxed..Box$LT$F$C$A$GT$$u20$as$u20$core..ops..function..FnOnce$LT$Args$GT$$GT$::call_once::h5ab36d4260b7d47a  (in new-tauri-app) + 56  [0x10576b058]\r\n    +                                                                                                             2313 core::ops::function::FnOnce::call_once$u7b$$u7b$vtable.shim$u7d$$u7d$::h3f94ba7279f13c3e  (in new-tauri-app) + 40  [0x1056ca978]\r\n    +                                                                                                               2313 _$LT$tauri_runtime_wry..WryDispatcher$u20$as$u20$tauri_runtime..Dispatch$GT$::create_window::_$u7b$$u7b$closure$u7d$$u7d$::hf58f7e3f6187b6de  (in new-tauri-app) + 139  [0x1056e672b]\r\n    +                                                                                                                 2313 tauri_runtime_wry::create_webview::h655641e97840737a  (in new-tauri-app) + 1539  [0x1056f1143]\r\n    +                                                                                                                   2313 std::sync::mutex::Mutex$LT$T$GT$::lock::he0a6e560b5cf14e2  (in new-tauri-app) + 36  [0x1056dcd44]\r\n    +                                                                                                                     2313 std::sys_common::mutex::MovableMutex::raw_lock::he918ec6ad8ecd0b8  (in new-tauri-app) + 20  [0x1056bd374]\r\n    +                                                                                                                       2313 std::sys::unix::mutex::Mutex::lock::he06a9db342524a0a  (in new-tauri-app) + 29  [0x1056bd39d]\r\n    +                                                                                                                         2313 _pthread_mutex_firstfit_lock_slow  (in libsystem_pthread.dylib) + 204  [0x7ff81e865d58]\r\n    +                                                                                                                           2313 _pthread_mutex_firstfit_lock_wait  (in libsystem_pthread.dylib) + 76  [0x7ff81e867e8f]\r\n    +                                                                                                                             2313 __psynch_mutexwait  (in libsystem_kernel.dylib) + 10  [0x7ff81e82fcf2]\r\n```\r\n\r\n\r\n### Additional context\r\n\r\n_No response_","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/3110/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3110/timeline","performed_via_github_app":null,"state_reason":"completed"}