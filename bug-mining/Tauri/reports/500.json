{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/9668","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/9668/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/9668/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/9668/events","html_url":"https://github.com/tauri-apps/tauri/issues/9668","id":2280137623,"node_id":"I_kwDOC7lts86H6COX","number":9668,"title":"[feat][v2] nsis: provide customization for default installer.nsi","user":{"login":"pronebird","id":704044,"node_id":"MDQ6VXNlcjcwNDA0NA==","avatar_url":"https://avatars.githubusercontent.com/u/704044?v=4","gravatar_id":"","url":"https://api.github.com/users/pronebird","html_url":"https://github.com/pronebird","followers_url":"https://api.github.com/users/pronebird/followers","following_url":"https://api.github.com/users/pronebird/following{/other_user}","gists_url":"https://api.github.com/users/pronebird/gists{/gist_id}","starred_url":"https://api.github.com/users/pronebird/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pronebird/subscriptions","organizations_url":"https://api.github.com/users/pronebird/orgs","repos_url":"https://api.github.com/users/pronebird/repos","events_url":"https://api.github.com/users/pronebird/events{/privacy}","received_events_url":"https://api.github.com/users/pronebird/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3307089819,"node_id":"MDU6TGFiZWwzMzA3MDg5ODE5","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20feature%20request","name":"type: feature request","color":"446DBA","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-05-06T06:29:05Z","updated_at":"2024-05-25T13:23:10Z","closed_at":"2024-05-25T13:23:10Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the problem\r\n\r\nHi,\r\n\r\nCurrently I need to bundle a few workspace binaries with my app and execute a few custom commands during installation, at the following stages:\r\n\r\n- Preinstall: before installing the app I run `nsExec::ExecToLog` to stop/unregister the existing windows service.  Typically on Windows, a binary with a running process cannot be replaced. Killing the process before replacing the binary is necessary.\r\n- Postcopy: running a script to register or update windows service configuration once all files are copied, so I can execute a helper executable copied into the install dir. Then starting the service.\r\n- Preuninstall: stop and delete windows service. This is again, necessary in order to delete the binary that typically executes as a windows service in background.\r\n\r\nThis is impossible without copying a rather complex 800 LOC `installer.nsi` template from tauri and modifying it. However this crates a situation where I have to keep my custom installer script up to date and synchronize changes to the default template (i.e perhaps improvements and bug fixes). Since the file is large enough, this creates a lot of hurdle.\r\n\r\n### Describe the solution you'd like\r\n\r\nI think it would be reasonable to have extend NSIS configuration and alternatively provide NSIS scripts injected into the `installer.nsi` template. As I described above I think having three different phases is ok, i.e:\r\n\r\n- Preinstall - called after `CheckIfAppIsRunning`\r\n- Post-copy - called after copying all files.\r\n- Preuninstall - called after `CheckIfAppIsRunning`\r\n\r\nI think a reasonable way to handle this would be to provide the installer with a single `installer-hooks.nsh` (optional) that can be injected into `installer.nsi`. The hooks script could expose three functions (or macro?) that will be called at different stages of installer lifecycle.\r\n\r\n### Alternatives considered\r\n\r\n_No response_\r\n\r\n### Additional context\r\n\r\n_No response_","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/9668/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/9668/timeline","performed_via_github_app":null,"state_reason":"completed"}