{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/7315","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7315/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7315/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7315/events","html_url":"https://github.com/tauri-apps/tauri/issues/7315","id":1779989516,"node_id":"I_kwDOC7lts85qGHwM","number":7315,"title":"[bug] nsis uninstall delete menushort error when use perMachine mode","user":{"login":"thetbw","id":31307256,"node_id":"MDQ6VXNlcjMxMzA3MjU2","avatar_url":"https://avatars.githubusercontent.com/u/31307256?v=4","gravatar_id":"","url":"https://api.github.com/users/thetbw","html_url":"https://github.com/thetbw","followers_url":"https://api.github.com/users/thetbw/followers","following_url":"https://api.github.com/users/thetbw/following{/other_user}","gists_url":"https://api.github.com/users/thetbw/gists{/gist_id}","starred_url":"https://api.github.com/users/thetbw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thetbw/subscriptions","organizations_url":"https://api.github.com/users/thetbw/orgs","repos_url":"https://api.github.com/users/thetbw/repos","events_url":"https://api.github.com/users/thetbw/events{/privacy}","received_events_url":"https://api.github.com/users/thetbw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""},{"id":4288483270,"node_id":"LA_kwDOC7lts87_nQ_G","url":"https://api.github.com/repos/tauri-apps/tauri/labels/status:%20needs%20triage","name":"status: needs triage","color":"059372","default":false,"description":"This issue needs to triage, applied to new issues"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2023-06-29T01:54:53Z","updated_at":"2023-08-30T12:51:07Z","closed_at":"2023-08-30T12:51:06Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nThe nsis uninstaller, when uninstalling, deleted the wrong shortcut, causing the file to not exist and causing an error.\r\nWhen you update your app, the installer received exit code 2, indicating that it cannot be uninstalled\n\n### Reproduction\n\nUse nsis, the mode is perMachine, after installation and then uninstall, you will find that the shortcut is still there\n\n### Expected behavior\n\nShortcuts should be removed after uninstall\n\n### Platform and versions\n\n```text\n[✔] Environment\r\n    - OS: Windows 10.0.22621 X64\r\n    ✔ WebView2: 114.0.1823.58\r\n    ✔ MSVC:\r\n        - Visual Studio 15 ���ɹ��� 2017\r\n        - Visual Studio ���ɹ��� 2019\r\n    ✔ rustc: 1.70.0 (90c541806 2023-05-31)\r\n    ✔ Cargo: 1.70.0 (ec8a8a0ca 2023-04-25)\r\n    ✔ rustup: 1.26.0 (5af9b9484 2023-04-05)\r\n    ✔ Rust toolchain: stable-x86_64-pc-windows-msvc (default)\r\n    - node: 14.18.0\n```\n\n\n### Stack trace\n\n_No response_\n\n### Additional context\n\nI found some reasons for this bug\r\nsee this doc https://nsis.sourceforge.io/Shortcuts_removal_fails_on_Windows_Vista\r\nand\r\nin file https://github.com/tauri-apps/tauri/blob/dev/tooling/bundler/src/bundle/windows/templates/installer.nsi\r\nline 350\r\n```nsi\r\n!if \"${INSTALLMODE}\" == \"currentUser\"\r\n    SetShellVarContext current\r\n!else if \"${INSTALLMODE}\" == \"perMachine\"\r\n    SetShellVarContext all\r\n!endif\r\n```\r\nbut on line 632,the uninstall Section ,no this logic\r\n\r\nI fixed this in my own code, but I don't know how to make it better, so here your go\r\n","closed_by":{"login":"amrbashir","id":48618675,"node_id":"MDQ6VXNlcjQ4NjE4Njc1","avatar_url":"https://avatars.githubusercontent.com/u/48618675?v=4","gravatar_id":"","url":"https://api.github.com/users/amrbashir","html_url":"https://github.com/amrbashir","followers_url":"https://api.github.com/users/amrbashir/followers","following_url":"https://api.github.com/users/amrbashir/following{/other_user}","gists_url":"https://api.github.com/users/amrbashir/gists{/gist_id}","starred_url":"https://api.github.com/users/amrbashir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amrbashir/subscriptions","organizations_url":"https://api.github.com/users/amrbashir/orgs","repos_url":"https://api.github.com/users/amrbashir/repos","events_url":"https://api.github.com/users/amrbashir/events{/privacy}","received_events_url":"https://api.github.com/users/amrbashir/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/7315/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7315/timeline","performed_via_github_app":null,"state_reason":"completed"}