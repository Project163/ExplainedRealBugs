{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/3355","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3355/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3355/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3355/events","html_url":"https://github.com/tauri-apps/tauri/issues/3355","id":1126571208,"node_id":"I_kwDOC7lts85DJhzI","number":3355,"title":"[bug] Sidecar binary fails to be located if target is `universal-apple-darwin`","user":{"login":"betamos","id":135960,"node_id":"MDQ6VXNlcjEzNTk2MA==","avatar_url":"https://avatars.githubusercontent.com/u/135960?v=4","gravatar_id":"","url":"https://api.github.com/users/betamos","html_url":"https://github.com/betamos","followers_url":"https://api.github.com/users/betamos/followers","following_url":"https://api.github.com/users/betamos/following{/other_user}","gists_url":"https://api.github.com/users/betamos/gists{/gist_id}","starred_url":"https://api.github.com/users/betamos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/betamos/subscriptions","organizations_url":"https://api.github.com/users/betamos/orgs","repos_url":"https://api.github.com/users/betamos/repos","events_url":"https://api.github.com/users/betamos/events{/privacy}","received_events_url":"https://api.github.com/users/betamos/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-02-07T22:29:05Z","updated_at":"2022-02-08T01:16:11Z","closed_at":"2022-02-08T01:16:11Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nThe recently added `--target universal-apple-darwin` pseudo-target produces a binary which contains the target triple _in its file name_. This build info isn't accessible for an application at runtime, resulting in a failure to locate the binary at runtime.\n\n### Reproduction\n\n1. Try running or building the sidecar example with `--target universal-apple-darwin`.\n\n### Expected behavior\n\n#### 1. Omit target triple from bundled binary file names\r\n\r\nSimply remove the target triple while copying the binary. This means that the user-facing contract remains consistent, so users would simply create a universal binary prior to build and name it `my-sidecar-universal-apple-darwin`. At dev/build time, it would be renamed to `my-sidecar`.\r\n\r\n#### 2. Include the target triple with the main executable\r\n\r\nWe could keep naming the same, and instead include the target triple as a constant - instead of inferring it at runtime.\r\n\r\n#### My thoughts\r\n\r\nI am in favor of 1, because it's consistent with the main executable and simplifies runtime logic.\r\n\r\nHowever, note that there is one restriction: using the universal target requires the user to create a universal binary also for sidecar, prior to the build. It is **not** possible to mix and match, and it would be hard to do so in the future without exposing more complicated knobs/flags etc to the user. I think this is ok, simple, and expected.\r\n\r\nHowever, we need to instruct users on how to build universal sidecar binaries themselves, which is very simple on MacOS (and in the future, it's likely `lipo` or equivalent will be available across platforms).\n\n### Platform and versions\n\n```shell\nMacOS\n```\n\n\n### Stack trace\n\n_No response_\n\n### Additional context\n\n### Caveat: possibly breaking change\r\n\r\nThe proposed change would affect both the CLI and the runtime, so users would have to upgrade both in lockstep. This could constitute a breaking change if users upgrade these separately. Please let me know if we need considerations for that case.\r\n\r\n### PR coming\r\n\r\nI already fixed this in my fork and will send out a PR with the changes.","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/3355/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3355/timeline","performed_via_github_app":null,"state_reason":"completed"}