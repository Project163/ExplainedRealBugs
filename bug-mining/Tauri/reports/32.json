{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/2327","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/2327/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/2327/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/2327/events","html_url":"https://github.com/tauri-apps/tauri/issues/2327","id":956989794,"node_id":"MDU6SXNzdWU5NTY5ODk3OTQ=","number":2327,"title":"Strange CORS behavior.","user":{"login":"iohzrd","id":3422336,"node_id":"MDQ6VXNlcjM0MjIzMzY=","avatar_url":"https://avatars.githubusercontent.com/u/3422336?v=4","gravatar_id":"","url":"https://api.github.com/users/iohzrd","html_url":"https://github.com/iohzrd","followers_url":"https://api.github.com/users/iohzrd/followers","following_url":"https://api.github.com/users/iohzrd/following{/other_user}","gists_url":"https://api.github.com/users/iohzrd/gists{/gist_id}","starred_url":"https://api.github.com/users/iohzrd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iohzrd/subscriptions","organizations_url":"https://api.github.com/users/iohzrd/orgs","repos_url":"https://api.github.com/users/iohzrd/repos","events_url":"https://api.github.com/users/iohzrd/events{/privacy}","received_events_url":"https://api.github.com/users/iohzrd/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":24,"created_at":"2021-07-30T18:56:21Z","updated_at":"2021-10-24T19:25:23Z","closed_at":"2021-10-22T18:55:03Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm using [ipfs-http-client](https://www.npmjs.com/package/ipfs-http-client) in a simple test app to connect to the go-ipfs daemon.\r\nmy CORS configuration for go-ipfs is such that it allows me to connect from my test app running in a browser but not tauri.\r\n\r\nThe dev console in tauri reports:\r\n```\r\nOrigin tauri://localhost is not allowed by Access-Control-Allow-Origin.\r\n```\r\n\r\nI've tried adding \"tauri://localhost\", \"tauri://*\" and even  * to my CORS config but it doesn't help.\r\n\r\nA thing of note is that my tauri.conf.json is set to serve directly from the public directory for dev and dist.\r\nWhen I load the page from a dev server on localhost in various browsers, everything works as expected.\r\nWhen I load file://index.html in various browsers, i get\r\n```\r\nOrigin null is not allowed by Access-Control-Allow-Origin.\r\n```\r\nbut then if I add \"null\" to the CORS configuration, everything works as expected.\r\nI've tried adding various values to my CORS config, but nothing I've tried allows the connection in tauri.\r\n\r\nAnother thing of note is:\r\nI compiled go-ipfs with some added logging and it appears the CORS values don't reflect what tauri is reporting.\r\n\r\nhere are the logs from connecting with a browser:\r\n```\r\nDEBUG\tcmds/http\thttp/handler.go:90\tincoming API request: /id\r\nWARN\tcmds/http\thttp/handler.go:130\tOrigin: http://localhost:5000\r\nWARN\tcmds/http\thttp/handler.go:132\tUser-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.164 Safari/537.36\r\nWARN\tcmds/http\thttp/handler.go:134\treferer: \r\n```\r\n\r\nand here are the logs when trying to connect from tauri:\r\n```\r\nDEBUG\tcmds/http\thttp/handler.go:90\tincoming API request: /id\r\nWARN\tcmds/http\thttp/handler.go:128\tAPI blocked request to /id. (possible CSRF)\r\nWARN\tcmds/http\thttp/handler.go:130\tOrigin: \r\nWARN\tcmds/http\thttp/handler.go:132\tUser-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0 Safari/605.1.15\r\nWARN\tcmds/http\thttp/handler.go:134\treferer: \r\n```\r\n\r\nNote that; The origin reported in tauri is \"tauri://localhost\" but in the go-ipfs log it's blank.\r\n\r\nThe expected behavior is that, with the correct CORS configuration, ipfs-http-client should successfully connect to go-ipfs.\r\n\r\n\r\n\r\n```\r\n$ npm run tauri info\r\nOperating System - Manjaro, version 21.1.0 X64\r\n\r\nNode.js environment\r\n  Node.js - 16.5.0\r\n  @tauri-apps/cli - 1.0.0-beta.6\r\n  @tauri-apps/api - 1.0.0-beta.5\r\n\r\nGlobal packages\r\n  npm - 7.20.2\r\n  yarn - Not installed\r\n\r\nRust environment\r\n  rustc - 1.53.0\r\n  cargo - 1.53.0\r\n\r\nApp directory structure\r\n/src\r\n/node_modules\r\n/src-tauri\r\n/scripts\r\n/public\r\n\r\nApp\r\n  tauri.rs - 1.0.0-beta.5\r\n  build-type - bundle\r\n  CSP - default-src blob: data: filesystem: ws: wss: http: https: tauri: 'unsafe-eval' 'unsafe-inline' 'self' img-src: 'self'\r\n  distDir - ../public\r\n  devPath - ../public\r\n  framework - Svelte\r\n  bundler - Rollup\r\n\r\n```\r\nA final note is that; I've tried setting CSP to \"\", but it doesn't help.\r\n","closed_by":{"login":"iohzrd","id":3422336,"node_id":"MDQ6VXNlcjM0MjIzMzY=","avatar_url":"https://avatars.githubusercontent.com/u/3422336?v=4","gravatar_id":"","url":"https://api.github.com/users/iohzrd","html_url":"https://github.com/iohzrd","followers_url":"https://api.github.com/users/iohzrd/followers","following_url":"https://api.github.com/users/iohzrd/following{/other_user}","gists_url":"https://api.github.com/users/iohzrd/gists{/gist_id}","starred_url":"https://api.github.com/users/iohzrd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iohzrd/subscriptions","organizations_url":"https://api.github.com/users/iohzrd/orgs","repos_url":"https://api.github.com/users/iohzrd/repos","events_url":"https://api.github.com/users/iohzrd/events{/privacy}","received_events_url":"https://api.github.com/users/iohzrd/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/2327/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/2327/timeline","performed_via_github_app":null,"state_reason":"completed"}