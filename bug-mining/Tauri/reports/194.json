{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/4390","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/4390/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/4390/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/4390/events","html_url":"https://github.com/tauri-apps/tauri/issues/4390","id":1275813924,"node_id":"I_kwDOC7lts85MC2Ak","number":4390,"title":"[bug] Crash on Windows when turning off window decorations from synchronous command.","user":{"login":"Themayu","id":16105710,"node_id":"MDQ6VXNlcjE2MTA1NzEw","avatar_url":"https://avatars.githubusercontent.com/u/16105710?v=4","gravatar_id":"","url":"https://api.github.com/users/Themayu","html_url":"https://github.com/Themayu","followers_url":"https://api.github.com/users/Themayu/followers","following_url":"https://api.github.com/users/Themayu/following{/other_user}","gists_url":"https://api.github.com/users/Themayu/gists{/gist_id}","starred_url":"https://api.github.com/users/Themayu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Themayu/subscriptions","organizations_url":"https://api.github.com/users/Themayu/orgs","repos_url":"https://api.github.com/users/Themayu/repos","events_url":"https://api.github.com/users/Themayu/events{/privacy}","received_events_url":"https://api.github.com/users/Themayu/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2022-06-18T15:14:24Z","updated_at":"2022-06-19T16:00:21Z","closed_at":"2022-06-19T16:00:21Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nWhen calling `tauri::Window::set_decorations(&self, false)` from a synchronous command on Windows, as in the reproduction code provided below, the application hangs right after turning off decorations before exiting with code 0xCFFFFFFF. Executing the provided reproduction code in an asynchronous command finishes it successfully, with no crash.\r\n\r\n### Reproduction\r\n\r\nThe crash can be reproduced with the following command:\r\n\r\n```rust\r\n#[tauri::command]\r\npub fn settings_toggle_decorations(window: Window) -> Result<(), ()> {\r\n    window.set_decorations(false);\r\n\r\n    Ok(())\r\n}\r\n```\r\n\r\nExecuting this command will immediately cause the application to hang before exiting to Windows with no panic message.\r\n\r\n(EDIT: apparently `blocking_kind` doesn't exist for `&Result<(), Infallible>`, so the return type has been changed to `Result<(), ()>`)\r\n\r\n### Expected behavior\r\n\r\nThe window's decorations are removed and the application continues normally, without crashing.\r\n\r\n### Platform and versions\r\n\r\n```shell\r\ncargo tauri info\r\n\r\nEnvironment\r\n  › OS: Windows 10.0.19043 X64\r\n  › Webview2: 102.0.1245.41\r\n  › MSVC: \r\n      - Visual Studio Enterprise 2019\r\n  › Node.js: 15.3.0\r\n  › npm: 6.14.2\r\n  › pnpm: Not installed!\r\n  › yarn: Not installed!\r\n  › rustup: 1.24.3\r\n  › rustc: 1.63.0-nightly\r\n  › cargo: 1.63.0-nightly\r\n  › Rust toolchain: nightly-x86_64-pc-windows-msvc \r\n\r\nPackages\r\n  › @tauri-apps/cli [NPM]: 1.0.0\r\n  › @tauri-apps/api [NPM]: 1.0.1\r\n  › tauri [RUST]: 1.0.0 (no lockfile),\r\n  › tauri-build [RUST]: no manifest (no lockfile),\r\n  › tao [RUST]: no manifest (no lockfile),\r\n  › wry [RUST]: no manifest (no lockfile),\r\n\r\nApp\r\n  › build-type: build\r\n  › CSP: default-src blob: data: filesystem: ws: wss: http: https: tauri: 'unsafe-eval' 'unsafe-inline' 'self' img-src: 'self'\r\n  › distDir: ../dist\r\n  › devPath: http://localhost:10001/\r\n  › bundler: Rollup\r\n\r\nApp directory structure\r\n  ├─ .cargo\r\n  ├─ .git\r\n  ├─ .vscode\r\n  ├─ dist\r\n  ├─ node_modules\r\n  ├─ src\r\n  ├─ src-common\r\n  ├─ src-macros\r\n  ├─ src-signals\r\n  ├─ src-tauri\r\n  └─ target\r\n```\r\n\r\n\r\n### Stack trace\r\n\r\n```shell\r\nNot applicable; application exits with no stack trace. Exit code is 0xCFFFFFFF.\r\n```\r\n\r\n\r\n### Additional context\r\n\r\nThis used to work fine in a beta version of tauri; though I can't remember which beta version this was. Possible regression?","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/4390/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/4390/timeline","performed_via_github_app":null,"state_reason":"completed"}