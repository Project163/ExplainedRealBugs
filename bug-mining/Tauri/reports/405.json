{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/7662","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7662/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7662/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7662/events","html_url":"https://github.com/tauri-apps/tauri/issues/7662","id":1859415831,"node_id":"I_kwDOC7lts85u1G8X","number":7662,"title":"[bug] refactor of IPC using URI schemes is breaking some usecase","user":{"login":"nikoPLP","id":57370730,"node_id":"MDQ6VXNlcjU3MzcwNzMw","avatar_url":"https://avatars.githubusercontent.com/u/57370730?v=4","gravatar_id":"","url":"https://api.github.com/users/nikoPLP","html_url":"https://github.com/nikoPLP","followers_url":"https://api.github.com/users/nikoPLP/followers","following_url":"https://api.github.com/users/nikoPLP/following{/other_user}","gists_url":"https://api.github.com/users/nikoPLP/gists{/gist_id}","starred_url":"https://api.github.com/users/nikoPLP/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nikoPLP/subscriptions","organizations_url":"https://api.github.com/users/nikoPLP/orgs","repos_url":"https://api.github.com/users/nikoPLP/repos","events_url":"https://api.github.com/users/nikoPLP/events{/privacy}","received_events_url":"https://api.github.com/users/nikoPLP/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""},{"id":4288483270,"node_id":"LA_kwDOC7lts87_nQ_G","url":"https://api.github.com/repos/tauri-apps/tauri/labels/status:%20needs%20triage","name":"status: needs triage","color":"059372","default":false,"description":"This issue needs to triage, applied to new issues"}],"state":"closed","locked":false,"assignee":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":11,"created_at":"2023-08-21T13:48:22Z","updated_at":"2024-10-06T22:11:45Z","closed_at":"2023-09-05T15:41:12Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nNice to see an improvement on performances with the new IPC mechanism of #7170 .\r\n\r\nIt is obviously better to have data exchanged between the frontend and tauri, as body of POST requests instead of JSON in URLparam of a GET request. \r\n\r\nBut we shall note that this improvement is limited on platforms that are not android nor linux.\r\n\r\nFor me, it breaks a special use-case that I am having. I am loading a remote page (https) in a popup window from the tauri app, using the window API. In the popup window (not main) the javascript that is loaded contains the `@tauri-apps/api` and `@tauri-apps/plugin-window` modules, and makes use of the `Window.getByLabel(\"main\").emit()` API call to send a message to the main window.\r\n\r\nUntil the breaking changes of `2.0.0-alpha.11`, this was working fine, except on android, because of the way messages are passed on that platform. \r\n\r\nSince the new IPC mechanism that uses `ipc://` fetch, I get a security exception on the client side of the popup window.\r\n\r\nNo matter how much CSP header I injected on that page (via the HTTP server serving it), the error remains the same, as the page has an origin with `https://` and `ipc://` is considered insecure no matter what the CSP is saying.\r\n\r\nSo my `https` page cannot send messages back to the main tauri window anymore.\r\n\r\nI guess this is a rare usecase, but I do make use of `ipc_scope().configure_remote_access()` API in the configuration of the tauri app, and I suppose that this API was meant specifically for this kind of use case, when a webpage making use of the client API is not served by tauri but by a remote server.\r\n\r\nSo it seems that the new IPC mechanism is breaking any possible usage of `ipc_scope().configure_remote_access()`.\r\n\r\nI first decided to freeze the tauri version i am using to `2.0.0-alpha.10` and to cherrypick some bug fixes that appeared in the latest version, and that I needed. \r\n\r\nBut then I thought this would not be future proof, so I decided to introduce a feature in tauri (in a fork of it, obviously) that would deactivate the new IPC mechanism and fall back to the old way using postMessage.\r\n\r\nThis crate feature that i named `no-ipc-custom-protocol` is quite minimalistic and seems to work on every platform i tested (all of them, except iOS that i don't have a dev env for, yet)\r\n\r\nWould you consider introducing this feature in the next alpha release ? \r\n\r\nAlso I would really like if @lucasfernog, the author of the refactor, could find another way to circumvent this limitation and allow `ipc://` to be fetched on any `https://` page, but I am not aware of any solution for that. Another way might be to dynamically fall back to the older IPC mechanism when the calling webpage is from a remote origin, and let the new mechanism work on webpages that are served by tauri. That would allow the `ipc_scope().configure_remote_access()` to make sense again in the new IPC mechanism context.\r\n\r\nThe `no-ipc-custom-protocol` feature that I implemented can be found here :\r\nhttps://git.nextgraph.org/NextGraph/tauri/commit/ec9b62b3379f5353c6d8b9484e12ec82ef4fa34f\r\n\r\nLet me know if you want a merge request.\r\n\r\nAnd thanks for your amazing work!\r\n\r\n\n\n### Reproduction\n\nunfortunately I dont have enough time left for this issue to create a minimalist project that would reproduce this issue. Also, it would be a bit hard to setup as you need an external https server...\r\nBut if you have some work on a branch that you want me to test, I will do it happily.\r\n\n\n### Expected behavior\n\nSee description of bug\n\n### Platform and versions\n\n```text\n[✔] Environment\r\n    - OS: Mac OS 10.15.6 X64\r\n    ✔ Xcode Command Line Tools: installed\r\n    ✔ rustc: 1.69.0 (84c898d65 2023-04-16)\r\n    ✔ Cargo: 1.69.0 (6e9a83356 2023-04-12)\r\n    ✔ rustup: 1.26.0 (5af9b9484 2023-04-05)\r\n    ✔ Rust toolchain: stable-x86_64-apple-darwin (environment override by RUSTUP_TOOLCHAIN)\r\n    - node: 16.13.1\r\n    - pnpm: 7.15.0\r\n    - yarn: 1.22.18\r\n    - npm: 8.1.2\r\n\r\n[-] Packages\r\n    - tauri [RUST]: (2.0.0-alpha.11)\r\n    - tauri-build [RUST]: no manifest (2.0.0-alpha.6, 2.0.0-alpha.7)\r\n    - wry [RUST]: 0.31.1\r\n    - tao [RUST]: 0.22.2\r\n    - @tauri-apps/api [NPM]: 2.0.0-alpha.6\r\n    - @tauri-apps/cli [NPM]: 2.0.0-alpha.10\r\n\r\n[-] App\r\n    - build-type: bundle\r\n    - CSP: unset\r\n    - distDir: ../dist\r\n    - devPath: http://localhost:1420/\r\n    - framework: Svelte\r\n    - bundler: Vite\n```\n\n\n### Stack trace\n\n_No response_\n\n### Additional context\n\n_No response_","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/7662/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/7662/timeline","performed_via_github_app":null,"state_reason":"completed"}