{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/2838","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/2838/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/2838/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/2838/events","html_url":"https://github.com/tauri-apps/tauri/issues/2838","id":1044139470,"node_id":"I_kwDOC7lts84-PE3O","number":2838,"title":"Dragging selected text panics when Tauri is run from `#[tokio::main]`","user":{"login":"DanielHZhang","id":30360288,"node_id":"MDQ6VXNlcjMwMzYwMjg4","avatar_url":"https://avatars.githubusercontent.com/u/30360288?v=4","gravatar_id":"","url":"https://api.github.com/users/DanielHZhang","html_url":"https://github.com/DanielHZhang","followers_url":"https://api.github.com/users/DanielHZhang/followers","following_url":"https://api.github.com/users/DanielHZhang/following{/other_user}","gists_url":"https://api.github.com/users/DanielHZhang/gists{/gist_id}","starred_url":"https://api.github.com/users/DanielHZhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DanielHZhang/subscriptions","organizations_url":"https://api.github.com/users/DanielHZhang/orgs","repos_url":"https://api.github.com/users/DanielHZhang/repos","events_url":"https://api.github.com/users/DanielHZhang/events{/privacy}","received_events_url":"https://api.github.com/users/DanielHZhang/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-11-03T21:40:37Z","updated_at":"2022-02-05T19:29:11Z","closed_at":"2021-12-09T02:41:36Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- BEFORE YOU FILE A NEW ISSUE-->\r\n<!--\r\n\r\n0. Please search open issues before duplicating a new one.\r\n1. Make sure you are using the latest version of everything including:\r\n  - rustc\r\n  - ALL relevant Tauri Libs\r\n2. You must attach the results of cargo tauri info or yarn tauri info to your issue.\r\n3. Make sure it is an issue with Tauri, and not something to do with your side of the stack.\r\n4. Consider starting a discussion. Speaking of which, have you looked there? Maybe your question has been answered.\r\n5. Remember to follow our community guidelines and be friendly.\r\n6. Is this an issue or a feature request? If the latter, please use the other template.\r\n\r\n-->\r\n\r\n### **Describe the bug**\r\nSelecting text within the Tauri window and dragging the selection in any direction immediately results in a crash when Tauri is initialized from `#[tokio::main]`. This crash does not occur when running in a non-async `fn main`.\r\n\r\n### **To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. `yarn create tauri-app`\r\n2. Add `tokio = { version = \"1.13.0\", features = [\"full\"] }` to dependencies in `Cargo.toml`\r\n3. In `src-tauri/src/main.rs`, replace main function with: \r\n```rust\r\n#[tokio::main]\r\nasync fn main() {\r\n  tauri::Builder::default()\r\n    .run(tauri::generate_context!())\r\n    .expect(\"error while running tauri application\");\r\n}\r\n```\r\n4. Start Tauri, select text and try dragging\r\n\r\n### **Expected behavior**\r\nDrag and drop functions normally; the window does not crash.\r\n\r\n### **Platform and Versions (required):**\r\n<!-- Use `yarn tauri info` or `cargo tauri info` command to get this information, and paste it here: -->\r\n```\r\nOperating System - Windows, version 10.0.19043 X64\r\nWebview2 - 95.0.1020.40\r\n\r\nNode.js environment\r\n  Node.js - 16.13.0\r\n  @tauri-apps/cli - 1.0.0-beta.10\r\n  @tauri-apps/api - 1.0.0-beta.8\r\n\r\nGlobal packages\r\n  npm - 8.1.2\r\n  yarn - 1.22.15\r\n\r\nRust environment\r\n  rustc - 1.56.1\r\n  cargo - 1.56.0\r\n\r\nApp directory structure\r\n/dist\r\n/node_modules\r\n/src\r\n/src-tauri\r\n\r\nApp\r\n  tauri.rs - 1.0.0-beta.8\r\n  build-type - bundle\r\n  CSP - default-src blob: data: filesystem: ws: wss: http: https: tauri: 'unsafe-eval' 'unsafe-inline' 'self' img-src: 'self'\r\n  distDir - ../dist\r\n  devPath - http://localhost:8181\r\n```\r\n\r\nTested on both Windows and Manjaro Linux; results in a crash regardless of OS.\r\n\r\n### **Additional context**\r\n`#[tokio::main]` is added so that some asynchronous tasks can be performed in the main function prior to initializing Tauri (e.g. reading/writing to config files, which stores results in Tauri state). \r\n\r\n### **Stack Trace**\r\n```\r\nRunning `target\\debug\\app.exe`\r\nthread 'main' panicked at 'Cannot start a runtime from within a runtimk the current thread while the thread is being used to drive asynchronous tasks.', C:\\Users\\Daniel\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\tokio-1.13.0\\src\\runtime\\enter.rs:39:9\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\nfatal runtime error: Rust panics must be rethrown\r\nerror: process didn't exit successfully: `target\\debug\\app.exe` (exit \r\ncode: 0xc0000409, STATUS_STACK_BUFFER_OVERRUN)\r\n```\r\n","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/2838/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/2838/timeline","performed_via_github_app":null,"state_reason":"completed"}