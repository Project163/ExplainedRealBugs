{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/3902","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3902/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3902/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3902/events","html_url":"https://github.com/tauri-apps/tauri/issues/3902","id":1206064026,"node_id":"I_kwDOC7lts85H4xOa","number":3902,"title":"[bug] Panic while firing menu event when window is minimized on macOS.","user":{"login":"sprout2000","id":52094761,"node_id":"MDQ6VXNlcjUyMDk0NzYx","avatar_url":"https://avatars.githubusercontent.com/u/52094761?v=4","gravatar_id":"","url":"https://api.github.com/users/sprout2000","html_url":"https://github.com/sprout2000","followers_url":"https://api.github.com/users/sprout2000/followers","following_url":"https://api.github.com/users/sprout2000/following{/other_user}","gists_url":"https://api.github.com/users/sprout2000/gists{/gist_id}","starred_url":"https://api.github.com/users/sprout2000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sprout2000/subscriptions","organizations_url":"https://api.github.com/users/sprout2000/orgs","repos_url":"https://api.github.com/users/sprout2000/repos","events_url":"https://api.github.com/users/sprout2000/events{/privacy}","received_events_url":"https://api.github.com/users/sprout2000/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""},{"id":3310698683,"node_id":"MDU6TGFiZWwzMzEwNjk4Njgz","url":"https://api.github.com/repos/tauri-apps/tauri/labels/platform:%20macOS","name":"platform: macOS","color":"fef2c0","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-04-16T09:16:20Z","updated_at":"2022-04-20T14:31:03Z","closed_at":"2022-04-20T14:31:03Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nSelecting a menu (e.g. `Open...`) when a window is minimized in macOS causes the application to panic.\r\n\n\n### Reproduction\n\n1. Use the template with the default selected.\r\n\r\n```sh\r\nnpx create-tauri-app\r\n```\r\n\r\n2. `src-tauri/src/main.rs`:\r\n\r\n```rust\r\nuse tauri::api::dialog;\r\nuse tauri::{CustomMenuItem, Menu, Submenu};\r\n\r\nfn main() {\r\n    let menu = Menu::new().add_submenu(Submenu::new(\r\n        \"File\",\r\n        Menu::new().add_item(CustomMenuItem::new(\"open\", \"Open...\")),\r\n    ));\r\n    tauri::Builder::default()\r\n        .menu(menu)\r\n        .on_menu_event(|event| {\r\n            if event.menu_item_id() == \"open\" {\r\n                dialog::FileDialogBuilder::new().pick_file(|f| {\r\n                    if let Some(fpath) = f {\r\n                        println!(\"{:?}\", fpath);\r\n                    }\r\n                })\r\n            }\r\n        })\r\n        .run(tauri::generate_context!())\r\n        .expect(\"error while running tauri application\");\r\n}\r\n```\r\n\r\n3. Launch that app and minimize its window.\r\n\r\n4. Select `Open...` from the Window menu.\r\n\r\n```sh\r\nnpx tauri dev\r\n\r\nthread 'main' panicked at 'called `Option::unwrap()` on a `None` value', $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tauri-runtime-wry-0.3.5/src/lib.rs:130:40\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n```\r\n\n\n### Expected behavior\n\nDo not fire CustomMenuItem events when the window is minimized.\r\nOr implement `window.isMinimized()` so that the developer can detect the state of window minimization.\r\n\n\n### Platform and versions\n\n```shell\n_Notwithstanding the following indication, `@tauri-apps/cli@1.0.0-rc.8` and `@tauri-apps/api@1.0.0-rc.3` are actually installed._\r\n\r\nEnvironment\r\n  › OS: Mac OS 12.3.1 X64\r\n  › Node.js: 16.14.2\r\n  › npm: 8.7.0\r\n  › pnpm: Not installed!\r\n  › yarn: Not installed!\r\n  › rustup: 1.24.3\r\n  › rustc: 1.60.0\r\n  › cargo: 1.60.0\r\n  › Rust toolchain: stable-aarch64-apple-darwin \r\n\r\nPackages\r\n  › @tauri-apps/cli [NPM]: 1.0.0-rc.7(outdated, latest: 1.0.0-rc.8)\r\n  › @tauri-apps/api [NPM]: 1.0.0-rc.3(outdated, latest: 1.0.0-rc.3)\r\n  › tauri [RUST]: 1.0.0-rc.6,\r\n  › tauri-build [RUST]: 1.0.0-rc.5,\r\n  › tao [RUST]: 0.7.0,\r\n  › wry [RUST]: 0.14.0,\r\n\r\nApp\r\n  › build-type: bundle\r\n  › CSP: unset\r\n  › distDir: ../dist\r\n  › devPath: ../dist\r\n\r\nApp directory structure\r\n  ├─ dist\r\n  ├─ node_modules\r\n  └─ src-tauri\n```\n\n\n### Stack trace\n\n```shell\n$ RUST_BACKTRACE=1 npx tauri dev  \r\n\r\n    Finished dev [unoptimized + debuginfo] target(s) in 0.08s\r\n     Running `target/debug/app`\r\nthread 'main' panicked at 'called `Option::unwrap()` on a `None` value', $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tauri-runtime-wry-0.3.5/src/lib.rs:130:40\r\nstack backtrace:\r\n   0: rust_begin_unwind\r\n             at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/panicking.rs:584:5\r\n   1: core::panicking::panic_fmt\r\n             at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/panicking.rs:143:14\r\n   2: core::panicking::panic\r\n             at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/panicking.rs:48:5\r\n   3: core::option::Option<T>::unwrap\r\n             at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/option.rs:752:21\r\n   4: tauri_runtime_wry::WebviewIdStore::get\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tauri-runtime-wry-0.3.5/src/lib.rs:130:10\r\n   5: tauri_runtime_wry::handle_event_loop\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tauri-runtime-wry-0.3.5/src/lib.rs:2410:33\r\n   6: <tauri_runtime_wry::Wry<T> as tauri_runtime::Runtime<T>>::run::{{closure}}\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tauri-runtime-wry-0.3.5/src/lib.rs:1953:13\r\n   7: <tao::platform_impl::platform::app_state::EventLoopHandler<T> as tao::platform_impl::platform::app_state::EventHandler>::handle_nonuser_event::{{closure}}\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tao-0.7.0/src/platform_impl/macos/app_state.rs:104:9\r\n   8: tao::platform_impl::platform::app_state::EventLoopHandler<T>::with_callback\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tao-0.7.0/src/platform_impl/macos/app_state.rs:78:7\r\n   9: <tao::platform_impl::platform::app_state::EventLoopHandler<T> as tao::platform_impl::platform::app_state::EventHandler>::handle_nonuser_event\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tao-0.7.0/src/platform_impl/macos/app_state.rs:99:5\r\n  10: tao::platform_impl::platform::app_state::Handler::handle_nonuser_event\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tao-0.7.0/src/platform_impl/macos/app_state.rs:208:11\r\n  11: tao::platform_impl::platform::app_state::AppState::cleared\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tao-0.7.0/src/platform_impl/macos/app_state.rs:380:9\r\n  12: tao::platform_impl::platform::observer::control_flow_end_handler::{{closure}}\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tao-0.7.0/src/platform_impl/macos/observer.rs:186:11\r\n  13: tao::platform_impl::platform::observer::control_flow_handler::{{closure}}\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tao-0.7.0/src/platform_impl/macos/observer.rs:147:5\r\n  14: std::panicking::try::do_call\r\n             at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/panicking.rs:492:40\r\n  15: ___rust_try\r\n  16: std::panicking::try\r\n             at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/panicking.rs:456:19\r\n  17: std::panic::catch_unwind\r\n             at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/std/src/panic.rs:137:14\r\n  18: tao::platform_impl::platform::event_loop::stop_app_on_panic\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tao-0.7.0/src/platform_impl/macos/event_loop.rs:224:9\r\n  19: tao::platform_impl::platform::observer::control_flow_handler\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tao-0.7.0/src/platform_impl/macos/observer.rs:145:3\r\n  20: tao::platform_impl::platform::observer::control_flow_end_handler\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tao-0.7.0/src/platform_impl/macos/observer.rs:181:5\r\n  21: <unknown>\r\n  22: <unknown>\r\n  23: <unknown>\r\n  24: <unknown>\r\n  25: <unknown>\r\n  26: <unknown>\r\n  27: <unknown>\r\n  28: <unknown>\r\n  29: <unknown>\r\n  30: <unknown>\r\n  31: <() as objc::message::MessageArguments>::invoke\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/objc-0.2.7/src/message/mod.rs:128:17\r\n  32: objc::message::platform::send_unverified::{{closure}}\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/objc-0.2.7/src/message/apple/mod.rs:27:9\r\n  33: objc_exception::try::{{closure}}\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/objc_exception-0.1.2/src/lib.rs:68:31\r\n  34: objc_exception::try_no_ret::try_objc_execute_closure\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/objc_exception-0.1.2/src/lib.rs:34:9\r\n  35: RustObjCExceptionTryCatch\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/objc_exception-0.1.2/extern/exception.m:10:9\r\n  36: objc_exception::try_no_ret\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/objc_exception-0.1.2/src/lib.rs:44:19\r\n  37: objc_exception::try\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/objc_exception-0.1.2/src/lib.rs:67:9\r\n  38: objc::exception::try\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/objc-0.2.7/src/exception.rs:8:5\r\n  39: objc::message::platform::send_unverified\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/objc-0.2.7/src/message/apple/mod.rs:26:5\r\n  40: objc::message::send_message\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/objc-0.2.7/src/message/mod.rs:178:5\r\n  41: tao::platform_impl::platform::event_loop::EventLoop<T>::run_return\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tao-0.7.0/src/platform_impl/macos/event_loop.rs:181:16\r\n  42: tao::platform_impl::platform::event_loop::EventLoop<T>::run\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tao-0.7.0/src/platform_impl/macos/event_loop.rs:148:21\r\n  43: tao::event_loop::EventLoop<T>::run\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tao-0.7.0/src/event_loop.rs:177:5\r\n  44: <tauri_runtime_wry::Wry<T> as tauri_runtime::Runtime<T>>::run\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tauri-runtime-wry-0.3.5/src/lib.rs:1952:9\r\n  45: tauri::app::App<R>::run\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tauri-1.0.0-rc.6/src/app.rs:614:5\r\n  46: tauri::app::Builder<R>::run\r\n             at $HOME/.cargo/registry/src/github.com-1ecc6299db9ec823/tauri-1.0.0-rc.6/src/app.rs:1482:5\r\n  47: app::main\r\n             at ./src/main.rs:14:5\r\n  48: core::ops::function::FnOnce::call_once\r\n             at /rustc/7737e0b5c4103216d6fd8cf941b7ab9bdbaace7c/library/core/src/ops/function.rs:227:5\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\n```\n\n\n### Additional context\n\n_No response_","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/3902/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3902/timeline","performed_via_github_app":null,"state_reason":"completed"}