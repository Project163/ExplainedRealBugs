{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/2614","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/2614/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/2614/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/2614/events","html_url":"https://github.com/tauri-apps/tauri/issues/2614","id":1000501297,"node_id":"I_kwDOC7lts847onAx","number":2614,"title":"cli.rs misidentifies target out directory for Cargo workspaces","user":{"login":"kofigumbs","id":3235964,"node_id":"MDQ6VXNlcjMyMzU5NjQ=","avatar_url":"https://avatars.githubusercontent.com/u/3235964?v=4","gravatar_id":"","url":"https://api.github.com/users/kofigumbs","html_url":"https://github.com/kofigumbs","followers_url":"https://api.github.com/users/kofigumbs/followers","following_url":"https://api.github.com/users/kofigumbs/following{/other_user}","gists_url":"https://api.github.com/users/kofigumbs/gists{/gist_id}","starred_url":"https://api.github.com/users/kofigumbs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kofigumbs/subscriptions","organizations_url":"https://api.github.com/users/kofigumbs/orgs","repos_url":"https://api.github.com/users/kofigumbs/repos","events_url":"https://api.github.com/users/kofigumbs/events{/privacy}","received_events_url":"https://api.github.com/users/kofigumbs/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-09-20T01:54:37Z","updated_at":"2021-09-24T02:37:28Z","closed_at":"2021-09-24T02:37:28Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- BEFORE YOU FILE A NEW ISSUE-->\r\n<!--\r\n\r\n0. Please search open issues before duplicating a new one.\r\n1. Make sure you are using the latest version of everything including: \r\n  - rustc \r\n  - ALL relevant Tauri Libs\r\n2. You must attach the results of cargo tauri info or yarn tauri info to your issue.\r\n3. Make sure it is an issue with Tauri, and not something to do with your side of the stack.\r\n4. Consider starting a discussion. Speaking of which, have you looked there? Maybe your question has been answered.\r\n5. Remember to follow our community guidelines and be friendly.\r\n6. Is this an issue or a feature request? If the latter, please use the other template.\r\n\r\n-->\r\n\r\n### **Describe the bug**\r\n\r\n`tauri build` fails to detect that my `src-tauri` directory was part of a Cargo workspace. I realized the reason that function didn't work for me is because I use a glob to identify my workspace members, and Tauri CLI checks for exact matches. Directory structure that reproduces issue:\r\n```\r\n~/Documents/src-tauri-workspace/a-workspace (master)\r\n$ tree -L 2\r\n.\r\n├── Cargo.lock\r\n├── Cargo.toml\r\n├── src\r\n│   └── main.rs\r\n├── src-tauri\r\n│   ├── Cargo.toml\r\n│   ├── icons\r\n│   ├── rustfmt.toml\r\n│   ├── src\r\n│   └── tauri.conf.json\r\n└── target\r\n    ├── CACHEDIR.TAG\r\n    ├── debug\r\n    └── release\r\n\r\n~/Documents/src-tauri-workspace/a-workspace (master)\r\n$ cat Cargo.toml\r\n[package]\r\nname = \"a-workspace\"\r\nversion = \"0.1.0\"\r\nedition = \"2018\"\r\n\r\n[workspace]\r\nmembers = [\"src-tauri\"]\r\n\r\n[dependencies]\r\n```\r\n\r\n### **To Reproduce**\r\n1. Clone https://github.com/kofigumbs/src-tauri-workspace\r\n2. `cd a-workspace`\r\n3. `cargo tauri build`\r\n```\r\n~/Documents/src-tauri-workspace/a-workspace (master)\r\n$ cargo tauri build\r\n   Compiling app v0.1.0 (/Users/kofi/Documents/src-tauri-workspace/a-workspace/src-tauri)\r\n    Finished release [optimized] target(s) in 1m 20s\r\nError: failed to rename `/Users/kofi/Documents/src-tauri-workspace/a-workspace/src-tauri/target/release/a\r\npp` to `/Users/kofi/Documents/src-tauri-workspace/a-workspace/src-tauri/target/release/a-workspace`\r\n\r\nCaused by:\r\n    No such file or directory (os error 2)\r\n```\r\n\r\n### **Expected behavior**\r\nTauri's target directory detection should always match that of `cargo metadata`:\r\n```\r\n~/Documents/src-tauri-workspace (master)\r\n$ bash -c 'cd a-workspace && cargo metadata --format-version=1 | jq .target_directory'\r\n\"/Users/kofi/Documents/src-tauri-workspace/a-workspace/target\"\r\n\r\n~/Documents/src-tauri-workspace (master)\r\n$ bash -c 'cd a-workspace/src-tauri && cargo metadata --format-version=1 | jq .target_directory'\r\n\"/Users/kofi/Documents/src-tauri-workspace/a-workspace/target\"\r\n```\r\n\r\n### **Screenshots**\r\nN/A\r\n\r\n### **Platform and Versions (required):**\r\n<!-- Use `yarn tauri info` or `cargo tauri info` command to get this information, and paste it here: -->\r\n```\r\n$ cargo tauri info\r\n\r\nOperating System - Mac OS, version 11.5.2 X64\r\n\r\nNode.js environment\r\n  Node.js - 16.9.1\r\n  @tauri-apps/cli - 1.0.0-beta.10\r\n\r\nGlobal packages\r\n  npm - 7.21.1\r\n  yarn - Not installed\r\n\r\nRust environment\r\n  rustc - 1.56.0-nightly\r\n  cargo - 1.55.0-nightly\r\n```\r\n\r\n### **Additional context**\r\n\r\nI was pretty curious, since there seems to be workspace-specific code in [interface/rust.rs#get_target_dir](https://github.com/tauri-apps/tauri/blob/b0a8c38a736544cdd70fd10155e5ad3a25c81535/tooling/cli.rs/src/interface/rust.rs#L280-L326). I'm able to workaround this issue by explicitly setting `CARGO_TARGET_DIR`. My 2 cents is that Tauri should call `cargo metadata` directly, which would ensure that it uses the same resolution mechanism as Cargo itself. I think that approach would also resolve #2515, since you could also use the error message that Cargo uses for the same problem. My reproduction repo has a few more example project layouts and their `cargo metadata` output: https://github.com/kofigumbs/src-tauri-workspace.\r\n\r\n### **Stack Trace**\r\nN/A","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/2614/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/2614/timeline","performed_via_github_app":null,"state_reason":"completed"}