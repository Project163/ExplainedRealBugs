{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/9948","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/9948/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/9948/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/9948/events","html_url":"https://github.com/tauri-apps/tauri/issues/9948","id":2330802256,"node_id":"I_kwDOC7lts86K7ThQ","number":9948,"title":"[bug] Rust deserialization of raw ipc fails","user":{"login":"vdang-crabnebula","id":124160233,"node_id":"U_kgDOB2aI6Q","avatar_url":"https://avatars.githubusercontent.com/u/124160233?v=4","gravatar_id":"","url":"https://api.github.com/users/vdang-crabnebula","html_url":"https://github.com/vdang-crabnebula","followers_url":"https://api.github.com/users/vdang-crabnebula/followers","following_url":"https://api.github.com/users/vdang-crabnebula/following{/other_user}","gists_url":"https://api.github.com/users/vdang-crabnebula/gists{/gist_id}","starred_url":"https://api.github.com/users/vdang-crabnebula/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vdang-crabnebula/subscriptions","organizations_url":"https://api.github.com/users/vdang-crabnebula/orgs","repos_url":"https://api.github.com/users/vdang-crabnebula/repos","events_url":"https://api.github.com/users/vdang-crabnebula/events{/privacy}","received_events_url":"https://api.github.com/users/vdang-crabnebula/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""},{"id":3307096872,"node_id":"MDU6TGFiZWwzMzA3MDk2ODcy","url":"https://api.github.com/repos/tauri-apps/tauri/labels/priority:%201%20high","name":"priority: 1 high","color":"E844A1","default":false,"description":""},{"id":4288483270,"node_id":"LA_kwDOC7lts87_nQ_G","url":"https://api.github.com/repos/tauri-apps/tauri/labels/status:%20needs%20triage","name":"status: needs triage","color":"059372","default":false,"description":"This issue needs to triage, applied to new issues"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-06-03T10:41:55Z","updated_at":"2024-06-27T09:55:51Z","closed_at":"2024-06-27T09:55:51Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\n`tauri::ipc::InvokeBody::deserialize` fails on raw ipc response. \r\nWhen receiving raw data  the function fails with: `Error(\"expected ident\", line: 1, column: 2)`.\r\n\r\nThe function uses  `InvokeBody::Raw(v) => serde_json::from_slice(&v)` to get Rust type from raw bytes. \r\n From `serde_json` [documentation](https://docs.rs/serde_json/latest/serde_json/de/fn.from_slice.html) `serde_json::from_slice()` is used to deserialize raw bytes of **JSON text**. \r\n\r\nHence the deserialization error is that `serde_json::from_slice()` expects a json string starting with a double quote which is not what we give it.\r\n\n\n### Reproduction\n\nThis happens when trying to parse input from the plugin `fs:read_file`. \r\nRecent  [PR#1251](https://github.com/tauri-apps/plugins-workspace/pull/1251) make use of raw IPC streaming for read/write file.  \r\n\r\nHence getting response from `fs:read_file` now returns an `InvokeBody::Raw` which is not properly deserialize with `InvokeBody::deserialize(self)`.\n\n### Expected behavior\n\n`tauri::ipc::InvokeBody::deserialize` should not panic on raw data. \r\n\r\nI have no clear idea on how to produce a robust function that can produce generic types from raw bytes.\n\n### Full `tauri info` output\n\n```text\n[✔] Environment\r\n    - OS: Fedora 39.0.0 X64\r\n    ✔ webkit2gtk-4.1: 2.44.1\r\n    ✔ rsvg2: 2.57.1\r\n    ✔ rustc: 1.78.0 (9b00956e5 2024-04-29)\r\n    ✔ cargo: 1.78.0 (54d8815d0 2024-03-26)\r\n    ✔ rustup: 1.27.1 (54dd3d00f 2024-04-24)\r\n    ✔ Rust toolchain: stable-x86_64-unknown-linux-gnu (environment override by RUSTUP_TOOLCHAIN)\r\n    - node: 20.12.2\r\n    - pnpm: 8.15.7\r\n    - yarn: 1.22.21\r\n    - npm: 10.2.0\r\n\r\n[-] Packages\r\n    - tauri [RUST]: 2.0.0-beta.22 (no manifest)\r\n    - tauri-build [RUST]: 2.0.0-beta.17 (no manifest)\r\n    - wry [RUST]: 0.40.0 (no manifest)\r\n    - tao [RUST]: 0.28.0 (no manifest)\r\n    - tauri-cli [RUST]: 2.0.0-beta.17\r\n    - @tauri-apps/api : not installed!\r\n    - @tauri-apps/cli [NPM]: 2.0.0-beta.17\r\n\r\n[-] App\r\n    - build-type: bundle\r\n    - CSP: unset\r\n    - bundler: Rollup\n```\n\n\n### Stack trace\n\n_No response_\n\n### Additional context\n\n_No response_","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/9948/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/9948/timeline","performed_via_github_app":null,"state_reason":"completed"}