{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/3317","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3317/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3317/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3317/events","html_url":"https://github.com/tauri-apps/tauri/issues/3317","id":1121190183,"node_id":"I_kwDOC7lts85C1AEn","number":3317,"title":"[feat] Build universal binaries for MacOS","user":{"login":"betamos","id":135960,"node_id":"MDQ6VXNlcjEzNTk2MA==","avatar_url":"https://avatars.githubusercontent.com/u/135960?v=4","gravatar_id":"","url":"https://api.github.com/users/betamos","html_url":"https://github.com/betamos","followers_url":"https://api.github.com/users/betamos/followers","following_url":"https://api.github.com/users/betamos/following{/other_user}","gists_url":"https://api.github.com/users/betamos/gists{/gist_id}","starred_url":"https://api.github.com/users/betamos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/betamos/subscriptions","organizations_url":"https://api.github.com/users/betamos/orgs","repos_url":"https://api.github.com/users/betamos/repos","events_url":"https://api.github.com/users/betamos/events{/privacy}","received_events_url":"https://api.github.com/users/betamos/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3307089819,"node_id":"MDU6TGFiZWwzMzA3MDg5ODE5","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20feature%20request","name":"type: feature request","color":"446DBA","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2022-02-01T20:57:09Z","updated_at":"2023-04-22T00:41:25Z","closed_at":"2022-02-04T21:56:59Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the problem\n\nBy default, binaries are built for a single CPU architecture, either x86_64 or aarch64. MacOS supports [Universal Binaries](https://developer.apple.com/documentation/apple-silicon/building-a-universal-macos-binary). that allow a single binary (and hence package & dmg) which contains both. This is recommended by Apple because it simplifies application distribution.\n\n### Describe the solution you'd like\n\nI'd like to be able to build a universal dmg that can be distributed to any MacOS user, directly from `tauri build`.\r\n\r\nI suggest adding a pseudo-target `universal-darwin-macos` for this purpose, which invokes the [`lipo`](https://ss64.com/osx/lipo.html) command to combine two arch-specific binaries into a universal one. I've tried it out and it works for me.\r\n\r\nGiven such a feature, we also need a way to deal with external binaries:\r\n\r\n- Either Tauri requires a universal binary be present at build-time\r\n- Or we find the arch-specific binaries and combine them at bundle-time (see below).\n\n### Alternatives considered\n\n#### Use an external build script\r\n\r\nA custom build script would work, but it would require quite a bit of redundant and custom tooling. This is because the `lipo` invocation needs to happen _between_ `cargo build` and dmg packaging.\r\n\r\n#### Use cargo [blocked]\r\n\r\nCargo [does not support](https://github.com/rust-lang/cargo/issues/8875) universal binaries at this time.\r\n\r\n#### Use cargo-lipo\r\n\r\n[`cargo-lipo`](https://github.com/TimNN/cargo-lipo) is a tool that uses `lipo` under the hood. Not investigated.\r\n\r\n#### Use a Rust-lib instead of lipo\r\n\r\n`lipo` is included in MacOS (perhaps with XCode?) but it may be harder to access it from Windows or Linux for cross-platform building. If that's hard to get lipo working, it may be worth looking into using a rust lib that does the same thing, to avoid external dependencies.\n\n### Additional context\n\nIt's an open question what exactly universal binaries mean for build systems. Should it be part of the arch triple (`universal-darwin-macos`) or should it be considered separate platform-specific config? I haven't seen best practices on this yet, feedback welcome.","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/3317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3317/timeline","performed_via_github_app":null,"state_reason":"completed"}