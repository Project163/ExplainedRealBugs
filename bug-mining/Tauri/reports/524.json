{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/10327","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/10327/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/10327/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/10327/events","html_url":"https://github.com/tauri-apps/tauri/issues/10327","id":2419258873,"node_id":"I_kwDOC7lts86QMvX5","number":10327,"title":"[bug] Tauri IPC not responding (eg. promise is not being fulfilled/not resolving) only when returning complex values","user":{"login":"SpikeHD","id":25207995,"node_id":"MDQ6VXNlcjI1MjA3OTk1","avatar_url":"https://avatars.githubusercontent.com/u/25207995?v=4","gravatar_id":"","url":"https://api.github.com/users/SpikeHD","html_url":"https://github.com/SpikeHD","followers_url":"https://api.github.com/users/SpikeHD/followers","following_url":"https://api.github.com/users/SpikeHD/following{/other_user}","gists_url":"https://api.github.com/users/SpikeHD/gists{/gist_id}","starred_url":"https://api.github.com/users/SpikeHD/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SpikeHD/subscriptions","organizations_url":"https://api.github.com/users/SpikeHD/orgs","repos_url":"https://api.github.com/users/SpikeHD/repos","events_url":"https://api.github.com/users/SpikeHD/events{/privacy}","received_events_url":"https://api.github.com/users/SpikeHD/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""},{"id":3307096872,"node_id":"MDU6TGFiZWwzMzA3MDk2ODcy","url":"https://api.github.com/repos/tauri-apps/tauri/labels/priority:%201%20high","name":"priority: 1 high","color":"E844A1","default":false,"description":""},{"id":4288483270,"node_id":"LA_kwDOC7lts87_nQ_G","url":"https://api.github.com/repos/tauri-apps/tauri/labels/status:%20needs%20triage","name":"status: needs triage","color":"059372","default":false,"description":"This issue needs to triage, applied to new issues"}],"state":"closed","locked":false,"assignee":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2024-07-19T15:57:14Z","updated_at":"2024-08-13T15:49:53Z","closed_at":"2024-08-13T10:38:50Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\r\n\r\nIn my project, there is a mix of simple Tauri commands (those that return bools or strings or numbers or whatever) and some that return serialize-able `struct`s or other \"complex\" data. In all cases that I've tested, commands that return simple values work fine, run fine, and the Promises fulfill just fine.\r\n\r\nWhen returning complex objects (for example, a `HashMap`, or some custom struct), the Promise will indefinitely hang. This also includes the results from Tauri plugins, such as the HTTP plugin. I cannot for the life of me figure out why. Here is an example of some tests:\r\n![image](https://github.com/user-attachments/assets/bf44231b-3e4a-44f9-95ef-c61e3cc7dddf)\r\n\r\nCuriously, the CrabNebula Devtools shows the results of these commands just fine, so they aren't hanging at some point during their execution, which leads me to believe something is hanging in the serialization or IPC sending process? Some CN Devtools outputs:\r\n\r\n<div width=\"100%\">\r\n  <img width=\"40%\" src=\"https://github.com/user-attachments/assets/6618a030-cb7f-4680-8a86-f7b60638ecca\"/>\r\n  <img width=\"40%\" src=\"https://github.com/user-attachments/assets/6b80d996-9d22-4ed8-bff3-3876df07bd40\"/>\r\n</div>\r\n\r\nSome other information:\r\n\r\n* My project falls back to the old IPC method automatically, and this is wanted/desired\r\n* My project points to an external site, not one running locally\r\n* Capabilities, enabled plugins, features, etc. can be found [here](https://github.com/SpikeHD/Dorion/tree/next/src-tauri)\r\n* Let me know if you need anything else! :)\r\n\r\n### Reproduction\r\n\r\n1. Create a Tauri v2 application, and point it to an external site. In my case, https://discord.com/app. In case it's relevant, I [create the window builder manually](https://github.com/SpikeHD/Dorion/blob/fc91ddca20af5c1c5a51d4fdfd3fa20de8126f01/src-tauri/src/main.rs#L215). Ensure it is a site that forces Tauri to fall back to the old method of IPC.\r\n2. Write two commands, one that returns a simple value and one that returns a struct, HashMap, or some other form of complex value\r\n```rust\r\n[#tauri::command]\r\npub fn test_one() -> bool {\r\n  true\r\n}\r\n\r\n[#tauri::command]\r\npub fn test_two() -> MyStruct {\r\n  MyStruct {\r\n    value: 5\r\n  }\r\n}\r\n```\r\n3. Call both of those commands in the frontend via Javascript. One should resolve just fine, the other's promise should hang forever.\r\n\r\n### Expected behavior\r\n\r\nThe promises do not hang forever.\r\n\r\n### Full `tauri info` output\r\n\r\n```text\r\n[✔] Environment\r\n    - OS: Mac OS 14.1.0 X64\r\n    ✔ Xcode Command Line Tools: installed\r\n    ✔ rustc: 1.77.2 (25ef9e3d8 2024-04-09)\r\n    ✔ cargo: 1.77.2 (e52e36006 2024-03-26)\r\n    ✔ rustup: 1.27.0 (bbb9276d2 2024-03-08)\r\n    ✔ Rust toolchain: stable-aarch64-apple-darwin (default)\r\n    - node: 22.2.0\r\n    - pnpm: 8.6.7\r\n    - yarn: 3.6.0\r\n    - npm: 10.7.0\r\n    - bun: 1.1.12\r\n\r\n[-] Packages\r\n    - tauri [RUST]: 2.0.0-beta.24\r\n    - tauri-build [RUST]: 2.0.0-beta.19\r\n    - wry [RUST]: 0.41.0\r\n    - tao [RUST]: 0.28.1\r\n    - @tauri-apps/api [NPM]: 1.5.3 (outdated, latest: 1.6.0)\r\n    - @tauri-apps/cli [NPM]: 2.0.0-beta.21\r\n\r\n[-] App\r\n    - build-type: bundle\r\n    - CSP: unset\r\n    - frontendDist: https://discord.com/app\r\n    - devUrl: https://discord.com/app\r\n    - bundler: Vite\r\n```\r\n\r\n\r\n### Stack trace\r\n\r\n```text\r\nN/A\r\n```\r\n\r\n\r\n### Additional context\r\n\r\nI have tested this on MacOS, Windows, and Linux, and all have an identical problem. In v1 this used to work fine.","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/10327/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/10327/timeline","performed_via_github_app":null,"state_reason":"completed"}