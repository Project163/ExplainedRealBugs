{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/4704","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/4704/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/4704/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/4704/events","html_url":"https://github.com/tauri-apps/tauri/issues/4704","id":1307223570,"node_id":"I_kwDOC7lts85N6qYS","number":4704,"title":"[bug] MACOSX_DEPLOYMENT_TARGET env var not exposed to dependencies","user":{"login":"betamos","id":135960,"node_id":"MDQ6VXNlcjEzNTk2MA==","avatar_url":"https://avatars.githubusercontent.com/u/135960?v=4","gravatar_id":"","url":"https://api.github.com/users/betamos","html_url":"https://github.com/betamos","followers_url":"https://api.github.com/users/betamos/followers","following_url":"https://api.github.com/users/betamos/following{/other_user}","gists_url":"https://api.github.com/users/betamos/gists{/gist_id}","starred_url":"https://api.github.com/users/betamos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/betamos/subscriptions","organizations_url":"https://api.github.com/users/betamos/orgs","repos_url":"https://api.github.com/users/betamos/repos","events_url":"https://api.github.com/users/betamos/events{/privacy}","received_events_url":"https://api.github.com/users/betamos/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""},{"id":4288483270,"node_id":"LA_kwDOC7lts87_nQ_G","url":"https://api.github.com/repos/tauri-apps/tauri/labels/status:%20needs%20triage","name":"status: needs triage","color":"059372","default":false,"description":"This issue needs to triage, applied to new issues"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-07-17T22:17:48Z","updated_at":"2022-08-02T22:54:34Z","closed_at":"2022-08-02T22:54:34Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nWhen dependencies are building custom ObjC or Swift code that target MacOS, they need to know the minimum version (from `macOS.minimumSystemVersion` in tauri.conf.json). Currently, [we set the `MACOSX_DEPLOYMENT_TARGET` env var for rustc](https://github.com/tauri-apps/tauri/blob/bc370e326810446e15b1f50fb962b980114ba16b/core/tauri-build/src/lib.rs#L288), but not \"generally\", so the build.rs script in deps cannot currently see what version is used by the tauri app being built, and that means `cc` and other tools can't be configured to use the appropriate target either.\r\n\r\nSee https://github.com/h4llow3En/mac-notification-sys/pull/46\r\n\r\nUnless there's another standardized way of propagating this metadata, I suggest setting the env var globally throughout the build, potentially with a default version such as to make the build more hermetic.\n\n### Reproduction\n\nYou can reproduce this by:\r\n\r\n- set `\"minimumSystemVersion\": \"10.13.6\"` (or any other version) in tauri conf\r\n- add a build.rs file to a dep and print the env var `MACOSX_DEPLOYMENT_TARGET` - it's not set\n\n### Expected behavior\n\nExpecting a way for dependencies to be aware of the desired build macos deployment target.\n\n### Platform and versions\n\n```shell\ntauri-cli 1.0.4/dev\n```\n\n\n### Stack trace\n\n```shell\nno stack trace\n```\n\n\n### Additional context\n\nPerhaps some users are already setting the env var in CI systems etc, and changing it could potentially break some niche builds. For this reason, it may be wise to let the env var take precedence over the tauri.conf.json value.","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/4704/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/4704/timeline","performed_via_github_app":null,"state_reason":"completed"}