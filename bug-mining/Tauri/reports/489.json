{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/8964","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/8964/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/8964/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/8964/events","html_url":"https://github.com/tauri-apps/tauri/issues/8964","id":2151594665,"node_id":"I_kwDOC7lts86APrqp","number":8964,"title":"[bug] Panic in tauri-runtime-wry 0.14.4 during init on wayland in flatpak","user":{"login":"qu1ck","id":3622532,"node_id":"MDQ6VXNlcjM2MjI1MzI=","avatar_url":"https://avatars.githubusercontent.com/u/3622532?v=4","gravatar_id":"","url":"https://api.github.com/users/qu1ck","html_url":"https://github.com/qu1ck","followers_url":"https://api.github.com/users/qu1ck/followers","following_url":"https://api.github.com/users/qu1ck/following{/other_user}","gists_url":"https://api.github.com/users/qu1ck/gists{/gist_id}","starred_url":"https://api.github.com/users/qu1ck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/qu1ck/subscriptions","organizations_url":"https://api.github.com/users/qu1ck/orgs","repos_url":"https://api.github.com/users/qu1ck/repos","events_url":"https://api.github.com/users/qu1ck/events{/privacy}","received_events_url":"https://api.github.com/users/qu1ck/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""},{"id":4288483270,"node_id":"LA_kwDOC7lts87_nQ_G","url":"https://api.github.com/repos/tauri-apps/tauri/labels/status:%20needs%20triage","name":"status: needs triage","color":"059372","default":false,"description":"This issue needs to triage, applied to new issues"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-02-23T18:29:15Z","updated_at":"2024-02-27T17:36:13Z","closed_at":"2024-02-27T17:36:13Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nThis bug is continuation of #8515 it has different root cause but tauri code is still culpable in the crash.\r\n\r\nAfter tauri v1.6 release I updated to it and now my app crashes on the same line but not on all wayland systems. Specifically it crashes on wayland composers that don't implement wlr_data_control_manager v1 protocol that the wl-clipboard-rs crate used by arboard relies on. When that protocol is not available it tries to fallback to x11 but in flatpak environment it is not available if the app already uses wayland so the clipboard fails to init, thus the app crashes with:\r\n```\r\nthread 'main' panicked at /run/build/TrguiNG/cargo/vendor/tauri-runtime-wry-0.14.4/src/lib.rs:2022:55:\r\ncalled `Result::unwrap()` on an `Err` value: Unknown { .. } - \"Unknown error while interacting with the clipboard: $DISPLAY variable not set and no value was provided explicitly\"\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n```\n\n### Reproduction\n\nTry to run a tauri app bundled into a flatpak on a wayland composer without clipboard protocol support like Gnome.\r\nI was able to repro this on default install of Fedora 39 workstation distro with my app: https://flathub.org/apps/org.openscopeproject.TrguiNG\n\n### Expected behavior\n\nApp does not crash. If it can not use clipboard then those features should be unavailable but the app should still work.\r\nI as a developer am prepared to add checks in my app code to handle this case if needed but currently tauri does not provide the api to do that, it just panics on init.\n\n### Full `tauri info` output\n\n```text\n[✘] Environment\r\n    - OS: Fedora 39.0.0 X64\r\n    ✔ webkit2gtk-4.0: 2.42.5\r\n    ✘ rsvg2: not installed\r\n      Visit https://tauri.app/v1/guides/getting-started/prerequisites to learn more about tauri prerequisites\r\n    ✔ rustc: 1.76.0 (07dca489a 2024-02-04) (Fedora 1.76.0-1.fc39)\r\n    ✔ cargo: 1.76.0\r\n    ⚠ rustup: not installed!\r\n      If you have rust installed some other way, we recommend uninstalling it\r\n      then use rustup instead. Visit https://rustup.rs/\r\n    ⚠ Rust toolchain: couldn't be detected!\r\n      Maybe you don't have rustup installed? if so, Visit https://rustup.rs/\r\n    - node: 20.10.0\r\n    - npm: 10.2.3\r\n\r\n[-] Packages\r\n    - tauri [RUST]: 1.6.0\r\n    - tauri-build [RUST]: 1.5.1\r\n    - wry [RUST]: 0.24.7\r\n    - tao [RUST]: 0.16.7\r\n    - @tauri-apps/api [NPM]: 1.5.3\r\n    - @tauri-apps/cli [NPM]: 1.5.10\r\n\r\n[-] App\r\n    - build-type: bundle\r\n    - CSP: unset\r\n    - distDir: ../dist\r\n    - devPath: http://localhost:8080/\r\n    - framework: React\r\n    - bundler: Webpack\n```\n\n\n### Stack trace\n\n_No response_\n\n### Additional context\n\n_No response_","closed_by":{"login":"amrbashir","id":48618675,"node_id":"MDQ6VXNlcjQ4NjE4Njc1","avatar_url":"https://avatars.githubusercontent.com/u/48618675?v=4","gravatar_id":"","url":"https://api.github.com/users/amrbashir","html_url":"https://github.com/amrbashir","followers_url":"https://api.github.com/users/amrbashir/followers","following_url":"https://api.github.com/users/amrbashir/following{/other_user}","gists_url":"https://api.github.com/users/amrbashir/gists{/gist_id}","starred_url":"https://api.github.com/users/amrbashir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amrbashir/subscriptions","organizations_url":"https://api.github.com/users/amrbashir/orgs","repos_url":"https://api.github.com/users/amrbashir/repos","events_url":"https://api.github.com/users/amrbashir/events{/privacy}","received_events_url":"https://api.github.com/users/amrbashir/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/8964/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/8964/timeline","performed_via_github_app":null,"state_reason":"completed"}