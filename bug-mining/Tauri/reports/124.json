{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/3571","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3571/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3571/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3571/events","html_url":"https://github.com/tauri-apps/tauri/issues/3571","id":1154041406,"node_id":"I_kwDOC7lts85EyUY-","number":3571,"title":"[bug] Inflated build time due to heavy dependencies","user":{"login":"JamesYeoman","id":21042602,"node_id":"MDQ6VXNlcjIxMDQyNjAy","avatar_url":"https://avatars.githubusercontent.com/u/21042602?v=4","gravatar_id":"","url":"https://api.github.com/users/JamesYeoman","html_url":"https://github.com/JamesYeoman","followers_url":"https://api.github.com/users/JamesYeoman/followers","following_url":"https://api.github.com/users/JamesYeoman/following{/other_user}","gists_url":"https://api.github.com/users/JamesYeoman/gists{/gist_id}","starred_url":"https://api.github.com/users/JamesYeoman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JamesYeoman/subscriptions","organizations_url":"https://api.github.com/users/JamesYeoman/orgs","repos_url":"https://api.github.com/users/JamesYeoman/repos","events_url":"https://api.github.com/users/JamesYeoman/events{/privacy}","received_events_url":"https://api.github.com/users/JamesYeoman/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":18,"created_at":"2022-02-28T12:36:20Z","updated_at":"2022-03-27T23:52:45Z","closed_at":"2022-03-27T23:52:45Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nAt times, I've gotten build times as large as 10 minutes. I've even gotten a 20 minute build time, but I've lost the cargo output to my bash terminal buffer.\r\n\r\nTo investigate, I set up some profile settings [in my project](https://github.com/JamesYeoman/dsrbmm/blob/f48e0c1104ac3f82af8e046f425533152157da15/packages/tauri/Cargo.toml#L22) to disable LTO and disable optimisation (in order to get the best case scenario), and then did a clean build using `cargo clean && cargo +nightly build --timings`.\r\n\r\n![image](https://user-images.githubusercontent.com/21042602/155981994-865bfa13-cac2-44c8-956d-e84099dc02f7.png)\r\n\r\n\r\nThe report shows that the three biggest hinderances are `zstd-sys`, `blake3`, and `bzip2-sys`.\r\n\r\nUsing `cargo tree -i`, I found the following\r\n\r\n```\r\n$ cargo tree -i zstd-sys\r\nzstd-sys v1.6.3+zstd.1.5.2\r\n└── zstd-safe v4.1.4+zstd.1.5.2\r\n    └── zstd v0.10.0+zstd.1.5.2\r\n        ├── tauri-codegen v1.0.0-rc.2\r\n        │   └── tauri-macros v1.0.0-rc.2 (proc-macro)\r\n        │       └── tauri v1.0.0-rc.3\r\n        │           └── dsrbmm v0.1.0\r\n        ├── tauri-utils v1.0.0-rc.2\r\n        │   ├── tauri-build v1.0.0-rc.3\r\n        │   │   [build-dependencies]\r\n        │   │   └── dsrbmm v0.1.0\r\n        │   ├── tauri-codegen v1.0.0-rc.2 (*)\r\n        │   └── tauri-macros v1.0.0-rc.2 (proc-macro) (*)\r\n        └── tauri-utils v1.0.0-rc.2\r\n            ├── tauri v1.0.0-rc.3 (*)\r\n            ├── tauri-runtime v0.3.2\r\n            │   ├── tauri v1.0.0-rc.3 (*)\r\n            │   └── tauri-runtime-wry v0.3.2\r\n            │       └── tauri v1.0.0-rc.3 (*)\r\n            └── tauri-runtime-wry v0.3.2 (*)\r\n\r\n$ cargo tree -i blake3\r\nblake3 v1.3.1\r\n└── tauri-codegen v1.0.0-rc.2\r\n    └── tauri-macros v1.0.0-rc.2 (proc-macro)\r\n        └── tauri v1.0.0-rc.3\r\n            └── dsrbmm v0.1.0\r\n\r\n$ cargo tree -i bzip2-sys\r\nbzip2-sys v0.1.11+1.0.8\r\n└── bzip2 v0.4.3\r\n    └── zip v0.5.13\r\n        └── tauri v1.0.0-rc.3\r\n            └── dsrbmm v0.1.0\r\n```\r\n\r\nAs you can see, they all impact the compile time of Tauri, and this is the best-case scenario (no overhead of optimising or LTO to increase the compile time).\r\n\r\nI know there's nothing Tauri can do about the compile time of the libraries, but are there any lightweight alternatives that could replace these behemoths?\r\n\r\nI do only have an Intel Core i7 7500U, so use that to put the performance in perspective. Only 4 cores, a maximum concurrency of 7, and 321 total compilation units. Even so, the fact that zstd-sys took half of the total build time is insane and is something that is worth at least looking further into. With those 3 hogging 3 CPU cores, I only had 1 thread remaining for everything else. And quad core isn't exactly a niche setup\n\n### Reproduction\n\n_No response_\n\n### Expected behavior\n\n_No response_\n\n### Platform and versions\n\n```shell\nOperating System - Windows, version 10.0.19043 X64\r\nWebview2 - 98.0.1108.56\r\nVisual Studio Build Tools:\r\n   - Visual Studio Build Tools 2019\r\nWARNING: no lock files found, defaulting to npm\r\n\r\nNode.js environment\r\n  Node.js - 16.10.0\r\n  @tauri-apps/cli - 1.0.0-rc.5\r\n  @tauri-apps/api - Not installed\r\n\r\nGlobal packages\r\n  npm - 8.4.1\r\n  pnpm - 6.29.1\r\n  yarn - 3.1.1\r\n\r\nRust environment\r\n  rustup - 1.24.3\r\n  rustc - 1.59.0\r\n  cargo - 1.59.0\r\n  toolchain - stable-x86_64-pc-windows-msvc\r\n\r\nApp directory structure\r\n/icons\r\n/src\r\n/target\r\n/WixTools\r\n\r\nApp\r\n  tauri - 1.0.0-rc.3\r\n  tauri-build - 1.0.0-rc.3\r\n  tao - 0.6.2\r\n  wry - 0.13.3\r\n  build-type - bundle\r\n  CSP - default-src blob: data: filesystem: ws: wss: http: https: tauri: 'unsafe-eval' 'unsafe-inline' 'self' img-src: 'self'\r\n  distDir - ../frontend/build/dist\r\n  devPath - http://localhost:3000/\r\n  framework - React\n```\n\n\n### Stack trace\n\n_No response_\n\n### Additional context\n\n_No response_","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/3571/reactions","total_count":5,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3571/timeline","performed_via_github_app":null,"state_reason":"completed"}