{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/3172","repository_url":"https://api.github.com/repos/tauri-apps/tauri","labels_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3172/labels{/name}","comments_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3172/comments","events_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3172/events","html_url":"https://github.com/tauri-apps/tauri/issues/3172","id":1094504061,"node_id":"I_kwDOC7lts85BPM59","number":3172,"title":"[bug] Can't run Tauri on a different thread","user":{"login":"marc2332","id":38158676,"node_id":"MDQ6VXNlcjM4MTU4Njc2","avatar_url":"https://avatars.githubusercontent.com/u/38158676?v=4","gravatar_id":"","url":"https://api.github.com/users/marc2332","html_url":"https://github.com/marc2332","followers_url":"https://api.github.com/users/marc2332/followers","following_url":"https://api.github.com/users/marc2332/following{/other_user}","gists_url":"https://api.github.com/users/marc2332/gists{/gist_id}","starred_url":"https://api.github.com/users/marc2332/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marc2332/subscriptions","organizations_url":"https://api.github.com/users/marc2332/orgs","repos_url":"https://api.github.com/users/marc2332/repos","events_url":"https://api.github.com/users/marc2332/events{/privacy}","received_events_url":"https://api.github.com/users/marc2332/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1449401604,"node_id":"MDU6TGFiZWwxNDQ5NDAxNjA0","url":"https://api.github.com/repos/tauri-apps/tauri/labels/type:%20bug","name":"type: bug","color":"B60205","default":false,"description":""},{"id":3307100839,"node_id":"MDU6TGFiZWwzMzA3MTAwODM5","url":"https://api.github.com/repos/tauri-apps/tauri/labels/status:%20upstream","name":"status: upstream","color":"059372","default":false,"description":"This issue is blocked by upstream dependencies and we need to wait or contribute upstream fixes"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2022-01-05T16:00:32Z","updated_at":"2023-01-04T23:48:51Z","closed_at":"2022-02-07T14:31:08Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nI can't run Tauri on a different thread, neither there is any flag/feature to do it.\n\n### Reproduction\n\n1. Run this https://github.com/tauri-apps/tauri/blob/next/examples/helloworld/src-tauri/src/main.rs\r\n2. But instead of running it in the main thread, run it like something like:\r\n\r\n```rust\r\nfn main() {\r\n    std::thread::spawn(|| {\r\n        tauri::Builder::default()\r\n        .run(tauri::generate_context!(\r\n          \"../../examples/helloworld/src-tauri/tauri.conf.json\"\r\n        ))\r\n        .expect(\"error while running tauri application\");\r\n    });\r\n    \r\n    std::thread::park();\r\n}\r\n```\n\n### Expected behavior\n\nBe able to run it in a different thread, rather than the main one.\n\n### Platform and versions\n\n```shell\nOperating System - Windows, version 10.0.19043 X64\r\nWebview2 - 96.0.1054.62\r\n\r\nNode.js environment\r\n  Node.js - 17.1.0\r\n  @tauri-apps/cli - 1.0.0-beta.10\r\n\r\nGlobal packages\r\n  npm - 7.5.4\r\n  yarn - 1.22.17\r\n\r\nRust environment\r\n  rustc - 1.59.0-nightly\r\n  cargo - 1.58.0-nightly\n```\n\n\n### Stack trace\n\n```shell\nthread '<unnamed>' panicked at 'Initializing the event loop outside of the main thread is a significant cross-platform compatibility hazard. If you really, absolutely need to create an EventLoop on a different thread, please use the `EventLoopExtWindows::new_any_thread` function.', C:\\Users\\mespi\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\tao-0.5.2\\src\\platform_impl\\windows\\event_loop.rs:152:5\r\nstack backtrace:\r\n   0: std::panicking::begin_panic<str>\r\n             at /rustc/6db0a0e9a4a2f55b1a85954e114ada0b45c32e45\\library\\std\\src\\panicking.rs:525\r\n   1: tao::platform_impl::platform::event_loop::EventLoop<enum$<tauri_runtime_wry::Message> >::new<enum$<tauri_runtime_wry::Message> >\r\n             at C:\\Users\\mespi\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\tao-0.5.2\\src\\platform_impl\\windows\\event_loop.rs:152\r\n   2: tao::event_loop::EventLoop<enum$<tauri_runtime_wry::Message> >::with_user_event<enum$<tauri_runtime_wry::Message> >\r\n             at C:\\Users\\mespi\\.cargo\\registry\\src\\github.com-1ecc6299db9ec823\\tao-0.5.2\\src\\event_loop.rs:131\r\n   3: tauri_runtime_wry::impl$36::new\r\n             at .\\tauri\\core\\tauri-runtime-wry\\src\\lib.rs:1554\r\n   4: tauri::app::Builder<tauri_runtime_wry::Wry>::build<tauri_runtime_wry::Wry,tauri_utils::assets::EmbeddedAssets>\r\n             at .\\tauri\\core\\tauri\\src\\app.rs:895\r\n   5: tauri::app::Builder<tauri_runtime_wry::Wry>::run<tauri_runtime_wry::Wry,tauri_utils::assets::EmbeddedAssets>\r\n             at .\\tauri\\core\\tauri\\src\\app.rs:1040\r\n   6: degui::impl$0::run::closure$1\r\n             at .\\src\\lib.rs:74\n```\n\n\n### Additional context\n\nI am working on my own tauri bindings for Deno, and bacause I don't want to block Deno's main thread, I need to run it in another thread.\r\n\r\nJust to test if running it in another thread would give any issue, I manually edited https://github.com/tauri-apps/tao/blob/f8866a084afe18983c91c67401d8759697578a9c/src/event_loop.rs#L132\r\n\r\n\r\n\r\nTo:\r\n\r\n```rust\r\npub fn with_user_event() -> EventLoop<T> {\r\n    EventLoop {\r\n      event_loop: platform_impl::EventLoop::new_any_thread(), // <- edited \"new()\" to \"new_any_thread()\"\r\n      _marker: ::std::marker::PhantomData,\r\n    }\r\n}\r\n```\r\n\r\nSo, instead of calling `EventLoop::new()` which will trigger the panic, it lets me run tauri on a  different thread.  I thought that maybe there could be some kind of flag / feature, so `with_user_event()` doesn't call `EventLoop::new()` but instead, it calls `EventLoop::new_any_thread()` .\r\n\r\nI can open this issue in `tao`'s repository if you prefer.","closed_by":{"login":"lucasfernog","id":20051258,"node_id":"MDQ6VXNlcjIwMDUxMjU4","avatar_url":"https://avatars.githubusercontent.com/u/20051258?v=4","gravatar_id":"","url":"https://api.github.com/users/lucasfernog","html_url":"https://github.com/lucasfernog","followers_url":"https://api.github.com/users/lucasfernog/followers","following_url":"https://api.github.com/users/lucasfernog/following{/other_user}","gists_url":"https://api.github.com/users/lucasfernog/gists{/gist_id}","starred_url":"https://api.github.com/users/lucasfernog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lucasfernog/subscriptions","organizations_url":"https://api.github.com/users/lucasfernog/orgs","repos_url":"https://api.github.com/users/lucasfernog/repos","events_url":"https://api.github.com/users/lucasfernog/events{/privacy}","received_events_url":"https://api.github.com/users/lucasfernog/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/tauri-apps/tauri/issues/3172/reactions","total_count":7,"+1":7,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/tauri-apps/tauri/issues/3172/timeline","performed_via_github_app":null,"state_reason":"completed"}