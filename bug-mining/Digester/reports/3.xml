<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:52:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DIGESTER-120] digesting xml content with NodeCreateRule swallows spaces.</title>
                <link>https://issues.apache.org/jira/browse/DIGESTER-120</link>
                <project id="12310471" key="DIGESTER">Commons Digester</project>
                    <description>&lt;p&gt;i need to process an xml file that contains entities: ie:&lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;top&amp;gt;&lt;br/&gt;
&amp;lt;body&amp;gt;&amp;#65; &amp;#65;&amp;lt;/body&amp;gt;&lt;br/&gt;
&amp;lt;/top&amp;gt;&lt;/p&gt;

&lt;p&gt;i&apos;m using digester as follows:&lt;/p&gt;

&lt;p&gt;Digester digester = new Digester ();&lt;br/&gt;
digester.addRule (&quot;top&quot;, new ObjectCreateRule (MyContent.class));&lt;br/&gt;
digester.addRule (&quot;top/body&quot;, new NodeCreateRule ());&lt;br/&gt;
digester.addSetNext (&quot;top/body&quot;, &quot;setBody&quot;);&lt;/p&gt;

&lt;p&gt;then&lt;br/&gt;
...&lt;br/&gt;
digester.parse (file);&lt;/p&gt;

&lt;p&gt;MyContent class transforms the node into text as follows:&lt;/p&gt;

&lt;p&gt;public class MyContent&lt;br/&gt;
{&lt;br/&gt;
 public void setBody (Element node)&lt;/p&gt;
 {
  String content = serializeNode (node);
  System.out.println (content);
 }
&lt;p&gt; ...&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;the content displayed is in this case: &amp;lt;body&amp;gt;AA&amp;lt;/body&amp;gt;&lt;/p&gt;

&lt;p&gt;if the body was encoded in the xml file as: &amp;lt;top&amp;gt;&amp;lt;body&amp;gt;A A&amp;lt;/body&amp;gt;&amp;lt;/top&amp;gt;, the content would then be correctly displayed as: &lt;br/&gt;
&amp;lt;body&amp;gt;A A&amp;lt;/body&amp;gt;&lt;/p&gt;

&lt;p&gt;looking at the NodeCreateRule.NodeBuilder.characters () implementation, the following code generates the problem: &lt;br/&gt;
String str = new String(ch, start, length);&lt;br/&gt;
if (str.trim().length() &amp;gt; 0) { &lt;br/&gt;
 top.appendChild(doc.createTextNode(str));&lt;/p&gt;

&lt;p&gt;when entities are being used; the characters () method is called for &apos;A&apos;, &apos; &apos; and &apos;A&apos; in the first case. in the second case, it is called once with &apos;A A&apos;.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;jdk 1.4.2_08, digester 1.8&lt;/p&gt;</environment>
        <key id="12390840">DIGESTER-120</key>
            <summary>digesting xml content with NodeCreateRule swallows spaces.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="thebluemountain">Nguyen Thanh Son Daniel</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Mar 2008 12:09:09 +0000</created>
                <updated>Mon, 5 Jan 2009 16:10:47 +0000</updated>
                            <resolved>Sat, 15 Mar 2008 15:23:08 +0000</resolved>
                                    <version>1.8</version>
                                    <fixVersion>1.8.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12579019" author="skitching" created="Sat, 15 Mar 2008 09:03:58 +0000"  >&lt;p&gt;Thanks very much for the bugreport, and your great analysis of the problem.&lt;/p&gt;

&lt;p&gt;I think you are right that the NodeBuilder.characters method is being too eager to strip whitespace.&lt;/p&gt;

&lt;p&gt;However I am unable to actually trigger the bug using a unit test case. The existing unit test code for digester has something very similar to your example, but with all xml in one line. I therefore added linefeeds as you suggested, but the unit test still passes.&lt;/p&gt;

&lt;p&gt;The unit tests I&apos;m talking about can be found here:&lt;br/&gt;
  &lt;a href=&quot;http://svn.apache.org/repos/asf/commons/proper/digester/trunk/src/test/org/apache/commons/digester/NodeCreateRuleTestCase.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/repos/asf/commons/proper/digester/trunk/src/test/org/apache/commons/digester/NodeCreateRuleTestCase.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you could manage to create a unit test for Digester that reproduces the problem that would be really helpful. I&apos;m not sure it is going to be easy though; I think the cause of the problem is that the SAX api says that characters(..) can be invoked by the xml parser as many times as the parser wants. Digester is currently assuming (as you point out) that it is invoked only once with the complete code block. But adding linefeeds to the input doesn&apos;t appear to force the xml parser i&apos;m using to call characters() with partial strings. &lt;/p&gt;

&lt;p&gt;In short, I think that this bug is very much dependent on which xml parser implementation is used, and what its internal parsing buffer size happens to be set to etc. That will make it difficult to get a unit test to reproduce this bug.&lt;/p&gt;

&lt;p&gt;Which xml parser are you using?&lt;/p&gt;

&lt;p&gt;I&apos;ve created a patch anyway, which looks ok to me and passes the existing digester test cases. Could you try applying this patch and seeing if it fixes your problem?&lt;/p&gt;</comment>
                            <comment id="12579020" author="skitching" created="Sat, 15 Mar 2008 09:06:51 +0000"  >&lt;p&gt;Patch to fix over-eager discarding of whitespace&lt;/p&gt;</comment>
                            <comment id="12579043" author="thebluemountain" created="Sat, 15 Mar 2008 14:04:07 +0000"  >&lt;p&gt;Simon,&lt;/p&gt;

&lt;p&gt;1- The parser being used is identified by the following maven artifact:&lt;/p&gt;

&lt;p&gt;groupId: xerces&lt;br/&gt;
artifactId: xercesImpl&lt;br/&gt;
version: 2.6.2&lt;/p&gt;

&lt;p&gt;also, stepping in the code reveals that it is the parser being used.&lt;/p&gt;

&lt;p&gt;2- i am not aware of the location where i should be getting the patch. can you let me know how i should proceed to access your patch ?&lt;/p&gt;</comment>
                            <comment id="12579044" author="thebluemountain" created="Sat, 15 Mar 2008 14:08:04 +0000"  >&lt;p&gt;oops.&lt;/p&gt;

&lt;p&gt;Simon,&lt;/p&gt;

&lt;p&gt;I forgot:&lt;br/&gt;
I was not so clear about it, but to reproduce the problem, you must use entities in your xml. the file following should help reproduce the problem:&lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;top&amp;gt;&lt;br/&gt;
&amp;lt;body&amp;gt;&amp;#65; &amp;#65;&amp;lt;/body&amp;gt;&lt;br/&gt;
&amp;lt;/top&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12579045" author="thebluemountain" created="Sat, 15 Mar 2008 14:09:04 +0000"  >&lt;p&gt;this time, the (real) file&lt;/p&gt;</comment>
                            <comment id="12579049" author="skitching" created="Sat, 15 Mar 2008 14:49:48 +0000"  >&lt;p&gt;Ok, using entities I was able to duplicate this pretty quickly. That also makes sense; the parser has the entity already cached as a string, so of course makes a separate call to the characters method for it.&lt;/p&gt;

&lt;p&gt;I have committed a patch to the trunk, and deployed a new 1.8.1-SNAPSHOT version to the apache maven snapshot repository. Could you please try it out and confirm it fixes the problem for you?&lt;/p&gt;

&lt;p&gt;Thanks, Simon&lt;/p&gt;</comment>
                            <comment id="12579054" author="thebluemountain" created="Sat, 15 Mar 2008 15:18:56 +0000"  >&lt;p&gt;Simon,&lt;/p&gt;

&lt;p&gt;yes, the problem is fixed now.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;</comment>
                            <comment id="12579055" author="skitching" created="Sat, 15 Mar 2008 15:23:08 +0000"  >&lt;p&gt;Fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12377968" name="digester-patch.txt" size="3799" author="skitching" created="Sat, 15 Mar 2008 09:06:51 +0000"/>
                            <attachment id="12377970" name="simple.xml" size="77" author="thebluemountain" created="Sat, 15 Mar 2008 14:09:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>51037</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0d4of:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74534</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>