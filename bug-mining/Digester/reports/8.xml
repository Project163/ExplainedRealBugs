<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:52:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DIGESTER-18] [digester] ExtendedBaseRules test fails</title>
                <link>https://issues.apache.org/jira/browse/DIGESTER-18</link>
                <project id="12310471" key="DIGESTER">Commons Digester</project>
                    <description>&lt;p&gt;When using the JDK1.2, &quot;ant test.matching.extended&quot; reports a failure in method&lt;br/&gt;
&quot;testAncesterMatch&quot;.&lt;/p&gt;

&lt;p&gt;I have added logging to the ExtendedBaseRules class, and the problem appears not&lt;br/&gt;
be with jdk1.2, but rather with the order objects are returned from the HashMap&lt;br/&gt;
rule cache. It seems that iterating over the entryset of elements in the cache&lt;br/&gt;
returns the elements in different order in the two JVMs, and somehow this seems&lt;br/&gt;
to break ExtendedBaseRules. It shouldn&apos;t, of course.&lt;/p&gt;

&lt;p&gt;I&apos;ll continue to look into it, but would appreciate some help from those who are&lt;br/&gt;
familiar with this class, as the matching rules are &lt;b&gt;very&lt;/b&gt; complex.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: All&lt;/p&gt;</environment>
        <key id="12341413">DIGESTER-18</key>
            <summary>[digester] ExtendedBaseRules test fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="simon@ecnetwork.co.nz">Simon Kitching</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Apr 2004 13:05:13 +0000</created>
                <updated>Fri, 9 Mar 2007 20:39:09 +0000</updated>
                            <resolved>Fri, 9 Mar 2007 20:39:09 +0000</resolved>
                                    <version>1.5</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12406498" author="simon@ecnetwork.co.nz" created="Tue, 20 Apr 2004 14:35:23 +0000"  >&lt;p&gt;Ok, I think I&apos;ve got it pinned down. &lt;/p&gt;

&lt;p&gt;The test itself was a very good one. It asked:&lt;br/&gt;
 given the pattern &quot;a/b/c/d&quot;&lt;br/&gt;
 is the preferred match:&lt;br/&gt;
   */b/c/d&lt;br/&gt;
or &lt;b&gt;/b/c/&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;The specs for the ExtendedBaseRules class say that:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;quote&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;b&gt;/a/b/&lt;/b&gt;&quot; matches any elements whose parentage path contains an element &apos;a&apos;&lt;br/&gt;
followed by an element &apos;b&apos;. The longest matching still applies but the length&lt;br/&gt;
excludes the &apos;*&apos; at the end.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;/quote&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The code currently tries to handle this by subtracting 1 from *new candidate&lt;br/&gt;
keys* when the length if (parentMatched || ancestorMatched). However:&lt;br/&gt;
(a) it should subtract 2&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; for patterns that both begin and end with wildcards, and&lt;br/&gt;
(b) it doesn&apos;t apply any corrections to the &quot;previously longest key&quot; it is&lt;br/&gt;
comparing against.&lt;/p&gt;

&lt;p&gt;And when 2 patterns of the same &quot;length&quot; exist in the cache, and they both&lt;br/&gt;
match, only the first matching pattern is kept. So the current code passes the&lt;br/&gt;
test only if the cache returns the &quot;correct&quot; match first. Which it appears to do&lt;br/&gt;
with jvm 1.4 but not 1.2!&lt;/p&gt;

&lt;p&gt;I will attach a patch soon. I would appreciate review of this, as it has the&lt;br/&gt;
potential to break a lot of stuff if it is wrong.&lt;/p&gt;</comment>
                            <comment id="12406499" author="simon@ecnetwork.co.nz" created="Tue, 20 Apr 2004 14:36:14 +0000"  >&lt;p&gt;Created an attachment (id=11287)&lt;br/&gt;
patch for bug&lt;/p&gt;</comment>
                            <comment id="12406500" author="rdonkin@apache.org" created="Wed, 28 Apr 2004 04:26:36 +0000"  >&lt;p&gt;hi&lt;/p&gt;

&lt;p&gt;sorry that i&apos;ve been a bit busy with other stuff recently but i&apos;ll try to find some time tomorrow to take a &lt;br/&gt;
look at this.&lt;/p&gt;</comment>
                            <comment id="12406501" author="rdonkin@apache.org" created="Thu, 29 Apr 2004 05:16:45 +0000"  >&lt;p&gt;i&apos;ve taken a look at this but i really need to finish off configuring my (recently re-installed) linux box so &lt;br/&gt;
i can run the test againts jdk1.2 and see the behaviour for myself.&lt;/p&gt;

&lt;p&gt;i wonder whether it&apos;s actually an ordering problem rather than simply a code problem (but i need to get &lt;br/&gt;
a version running on the older jdk first). &lt;/p&gt;

&lt;p&gt;i&apos;ve taken a look at trying to write some unit tests that fail in my usual JRE but i haven&apos;t hit on one yet. &lt;br/&gt;
the patch looks ok(ish) but i&apos;d be much happier if i had a clear unit test that demonstrated the bug &lt;br/&gt;
(which should be replicatable if it&apos;s fixed by the patch) before applying it. &lt;/p&gt;

&lt;p&gt;i&apos;ll continue looking for a unit test tomorrow unless you beat me to it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12406502" author="simon@ecnetwork.co.nz" created="Thu, 29 Apr 2004 05:50:43 +0000"  >&lt;p&gt;It&apos;s going to be a tricky one to duplicate with a unit test (which is why I&lt;br/&gt;
didn&apos;t create one &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. &lt;/p&gt;

&lt;p&gt;I can definitely say that exactly the same code passes with jdk1.4 and fails&lt;br/&gt;
with jdk1.2 (returns different sets of matches). I can&apos;t see any other&lt;br/&gt;
reasonable cause except the order rules are returned by map.entrySet(). &lt;/p&gt;

&lt;p&gt;I&apos;m not sure what you mean by &quot;actually an ordering problem rather than simply a&lt;br/&gt;
code problem&quot;. I think it&apos;s both: a bug in the code causes two rules which&lt;br/&gt;
should have different &quot;priorities&quot; to actually have the same &quot;priority&quot;. And in&lt;br/&gt;
the case of a tie, the first rule found wins. So if the correct rule is&lt;br/&gt;
encountered first, the test works and if the wrong rule is encountered first,&lt;br/&gt;
the test fails. And which is encountered first depends upon the internal&lt;br/&gt;
implementation of the HashMap class (or the String hashcode method), which is&lt;br/&gt;
jdk-specific.&lt;/p&gt;

&lt;p&gt;A unit test for this would presumably involve subclassing the ExtendedBaseRules&lt;br/&gt;
class and using a custom map class, such as one of the OrderedMap classes from&lt;br/&gt;
collections. By then adding the rules to the digester in different orders, the&lt;br/&gt;
order they are returned from the map.entrySet could be controlled. That all&lt;br/&gt;
sounds like a lot of work, unfortunately!&lt;/p&gt;

&lt;p&gt;I might have a go at this over the weekend if the rain continues....unless you&lt;br/&gt;
beat me to it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12406503" author="rdonkin@apache.org" created="Fri, 30 Apr 2004 03:43:21 +0000"  >&lt;p&gt;i&apos;ve taken a look and i now agree with you about the fix and the basic cause: it&apos;s a simple bug which can &lt;br/&gt;
be fixed just by assigning the key length to a variable. i&apos;d be happy to see your patch committed.&lt;/p&gt;

&lt;p&gt;i also agree with you that the peculiar ordering of the entries in a post-1.2 map appears to mask this &lt;br/&gt;
problem. i&apos;m no longer sure that it&apos;ll be easy to create a simple unit test for it.&lt;/p&gt;

&lt;p&gt;the method could be improved by preforming each startsWith and endsWith just once and assigning to &lt;br/&gt;
a boolean variable. this should make things a little more readible as well as improve performance a &lt;br/&gt;
little.  &lt;/p&gt;</comment>
                            <comment id="12406504" author="simon@ecnetwork.co.nz" created="Fri, 7 May 2004 09:23:00 +0000"  >&lt;p&gt;Patch committed. Also used booleans to hold startsWith and endsWith results, as&lt;br/&gt;
suggested.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12332882" name="ASF.LICENSE.NOT.GRANTED--ebr-patch.txt" size="2185" author="simon@ecnetwork.co.nz" created="Tue, 20 Apr 2004 14:36:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>28486</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>51081</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            21 years, 30 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0d51j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74593</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>