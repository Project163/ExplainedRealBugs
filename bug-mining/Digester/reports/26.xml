<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:52:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DIGESTER-163] ConcurrentModificationException creating a new Digester via loaderInstance.newDigester()</title>
                <link>https://issues.apache.org/jira/browse/DIGESTER-163</link>
                <project id="12310471" key="DIGESTER">Commons Digester</project>
                    <description>&lt;p&gt;I am gettig a ConcurrentModificationException when trying to create new Digester instance from a configured loader:&lt;br/&gt;
Trace is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.util.ConcurrentModificationException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at java.util.LinkedList$ListItr.checkForComodification(LinkedList.java:761) ~[na:1.6.0_27]
	at java.util.LinkedList$ListItr.next(LinkedList.java:696) ~[na:1.6.0_27]
	at org.apache.commons.digester3.binder.FromBinderRuleSet.addRuleInstances(FromBinderRuleSet.java:130) ~[commons-digester3-3.2.jar:3.2]
	at org.apache.commons.digester3.binder.DigesterLoader.addRules(DigesterLoader.java:581) ~[commons-digester3-3.2.jar:3.2]
	at org.apache.commons.digester3.binder.DigesterLoader.newDigester(DigesterLoader.java:568) ~[commons-digester3-3.2.jar:3.2]
	at org.apache.commons.digester3.binder.DigesterLoader.newDigester(DigesterLoader.java:516) ~[commons-digester3-3.2.jar:3.2]
	at org.apache.commons.digester3.binder.DigesterLoader.newDigester(DigesterLoader.java:475) ~[commons-digester3-3.2.jar:3.2]
	at org.apache.commons.digester3.binder.DigesterLoader.newDigester(DigesterLoader.java:462) ~[commons-digester3-3.2.jar:3.2]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The binder documentation (employee servlet) and the mailing list did confirm to me, that the loader should be safe to be shared, so this should not happen.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux, JDK 6&lt;/p&gt;</environment>
        <key id="12546363">DIGESTER-163</key>
            <summary>ConcurrentModificationException creating a new Digester via loaderInstance.newDigester()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="simone.tripodi">Simone Tripodi</assignee>
                                    <reporter username="tkrah">Torsten Krah</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Mar 2012 08:00:28 +0000</created>
                <updated>Mon, 19 Mar 2012 09:17:18 +0000</updated>
                            <resolved>Mon, 19 Mar 2012 09:17:17 +0000</resolved>
                                    <version>3.2</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13229076" author="simone.tripodi" created="Wed, 14 Mar 2012 08:41:02 +0000"  >&lt;p&gt;Can you kindly attach a testcase that reproduces the issue? Many thanks in advance!&lt;/p&gt;</comment>
                            <comment id="13229190" author="tkrah" created="Wed, 14 Mar 2012 13:45:34 +0000"  >&lt;p&gt;&lt;a href=&quot;http://fachschaft.imn.htwk-leipzig.de/~tkrah/digester-163.tar.bz2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fachschaft.imn.htwk-leipzig.de/~tkrah/digester-163.tar.bz2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Maven project which does produce some other sax errors too - CME is not yet seen in this test, still searching for ways to provoke - but the other exceptions should not be their either.&lt;br/&gt;
Run mvn test multiple times to see them sometimes.&lt;/p&gt;</comment>
                            <comment id="13230070" author="simone.tripodi" created="Thu, 15 Mar 2012 11:04:13 +0000"  >&lt;p&gt;I imported a simplified version of your testcase in the Digester codebase, see &lt;a href=&quot;https://svn.apache.org/viewvc?view=revision&amp;amp;revision=1300873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1300873&lt;/a&gt;; unfortunately I am not able to reproduce the issue &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;IIUC - apologize if I am wrong - the problem could be in your wrappers that allows concurrency in the loader creation - using the &lt;tt&gt;ConcurrentHashMap&lt;/tt&gt; you keep the data structure thread-safe but it doesn&apos;t shield from races and concurrent accesses to the Loader creation...&lt;/p&gt;

&lt;p&gt;Can you please check it? TIA!!!&lt;/p&gt;</comment>
                            <comment id="13230100" author="tkrah" created="Thu, 15 Mar 2012 12:16:34 +0000"  >&lt;p&gt;Hm - is it forbidden to create two loaders at different threads? I know that more than one loader may be created, but my calling thread does only got the one who first entered the map.&lt;br/&gt;
Digester.newLoader(...) should be thread-safe at all, i don&apos;t know if some other libs i may be using are doing this too - so is there something special with loader creation?&lt;/p&gt;</comment>
                            <comment id="13230167" author="tkrah" created="Thu, 15 Mar 2012 13:51:55 +0000"  >&lt;p&gt;Attached modified failing test case for completeness here, although you&apos;ve got it already via mail.&lt;/p&gt;</comment>
                            <comment id="13230186" author="simone.tripodi" created="Thu, 15 Mar 2012 14:12:45 +0000"  >&lt;p&gt;two loaders created by different threads &lt;b&gt;have to&lt;/b&gt; be allowed, of course, that is why we are investigating about the problem. I am testing your modifications right now, I hope to let you know good news ASAP &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="13230197" author="simone.tripodi" created="Thu, 15 Mar 2012 14:33:22 +0000"  >&lt;p&gt;Just to keep you updated my tests: I am getting &lt;tt&gt;NPE}}s because {{test.xml&lt;/tt&gt; looks like&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;root&amp;gt;
  &amp;lt;container&amp;gt;
    &amp;lt;header&amp;gt;
      &amp;lt;authors&amp;gt;
        &amp;lt;author&amp;gt;Author 1&amp;lt;/author&amp;gt;
      &amp;lt;/authors&amp;gt;
    &amp;lt;/header&amp;gt;
  &amp;lt;/container&amp;gt;
&amp;lt;/root&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;while rules are configured like (despite the class renaming)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;digester-rules&amp;gt;
  &amp;lt;object-create-rule classname=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.commons.digester3.binder.Entity&quot;&lt;/span&gt; pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;/&amp;gt;
  &amp;lt;!-- author --&amp;gt;
  &amp;lt;call-method-rule methodname=&lt;span class=&quot;code-quote&quot;&gt;&quot;setAuthor&quot;&lt;/span&gt; paramcount=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; pattern=&lt;span class=&quot;code-quote&quot;&gt;&quot;container/header/authors/author&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;/digester-rules&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so we have two options:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;rules pattern are wrong;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;sample is wrong.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I am removing the &lt;tt&gt;&amp;lt;root&amp;gt;&lt;/tt&gt; element and see what happens. let you know soon!&lt;/p&gt;</comment>
                            <comment id="13230201" author="simone.tripodi" created="Thu, 15 Mar 2012 14:36:06 +0000"  >&lt;p&gt;Indeed, restructuring the XML to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;container&amp;gt;
  &amp;lt;header&amp;gt;
    &amp;lt;authors&amp;gt;
      &amp;lt;author&amp;gt;Author 1&amp;lt;/author&amp;gt;
    &amp;lt;/authors&amp;gt;
  &amp;lt;/header&amp;gt;
&amp;lt;/container&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am going to commit the test - may I can kindly ask you to checkout the &lt;a href=&quot;https://svn.apache.org/repos/asf/commons/proper/digester/trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk&lt;/a&gt; and modify the test there? &lt;/p&gt;

&lt;p&gt;Many thanks in advance!&lt;/p&gt;</comment>
                            <comment id="13230204" author="tkrah" created="Thu, 15 Mar 2012 14:40:17 +0000"  >&lt;p&gt;Yeah that was a test for failing parsing, it must be without &amp;lt;root&amp;gt;; however this won&apos;t effect the tet case, does still fail in the same way.&lt;br/&gt;
Hm what to modify yet - i am a little bit confused where we are at the moment &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; - yes the test.xml was wrong, but it does not affect the case, right?&lt;/p&gt;</comment>
                            <comment id="13230226" author="simone.tripodi" created="Thu, 15 Mar 2012 15:07:54 +0000"  >&lt;p&gt;Unfortunately, once test is modified, test still pass &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Tests run: 209, Failures: 0, Errors: 0, Skipped: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;this is my environment:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ mvn --version
Apache Maven 3.0.4 (r1232337; 2012-01-17 09:44:56+0100)
Maven home: /Applications/apache-maven-3.0.4
Java version: 1.6.0_29, vendor: Apple Inc.
Java home: /&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/Library/Java/JavaVirtualMachines/1.6.0.jdk/Contents/Home
Default locale: en_US, platform encoding: MacRoman
OS name: &lt;span class=&quot;code-quote&quot;&gt;&quot;mac os x&quot;&lt;/span&gt;, version: &lt;span class=&quot;code-quote&quot;&gt;&quot;10.7.3&quot;&lt;/span&gt;, arch: &lt;span class=&quot;code-quote&quot;&gt;&quot;x86_64&quot;&lt;/span&gt;, family: &lt;span class=&quot;code-quote&quot;&gt;&quot;mac&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;if you just run:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;https:&lt;span class=&quot;code-comment&quot;&gt;//svn.apache.org/repos/asf/commons/proper/digester/trunk commons-digester &amp;amp;&amp;amp; cd commons-digester &amp;amp;&amp;amp; svn test&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;you should see the test report...&lt;br/&gt;
Can you please let me know? TIA!&lt;/p&gt;</comment>
                            <comment id="13230437" author="tkrah" created="Thu, 15 Mar 2012 19:15:01 +0000"  >&lt;p&gt;Patch to testCase&lt;/p&gt;

&lt;p&gt;1. Added test to confirm parsing single threaded.&lt;br/&gt;
2. Modified second one to show parse fail only.&lt;/p&gt;</comment>
                            <comment id="13230441" author="tkrah" created="Thu, 15 Mar 2012 19:17:43 +0000"  >&lt;p&gt;Output from cmd-line running mvn test - test failed.&lt;/p&gt;</comment>
                            <comment id="13230447" author="tkrah" created="Thu, 15 Mar 2012 19:26:42 +0000"  >&lt;p&gt;Patch 2, prevent NPE on failure output on poll == null.&lt;/p&gt;</comment>
                            <comment id="13230473" author="simone.tripodi" created="Thu, 15 Mar 2012 19:50:42 +0000"  >&lt;p&gt;I&apos;m reviewing it right now; if you intend to continue participating - I hope so! - please, in future patches, don&apos;t reformat the original code when providing functional modifications. I suggest you reading the &lt;a href=&quot;http://commons.apache.org/patches.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Contributing Patches&lt;/a&gt; guideline. Dankesh&#246;n &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13230479" author="simone.tripodi" created="Thu, 15 Mar 2012 19:56:21 +0000"  >&lt;p&gt;wow, this is really wired, after applied the patch I still get a success:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Tests run: 210, Failures: 0, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1:15.049s
[INFO] Finished at: Thu Mar 15 20:55:02 CET 2012
[INFO] Final Memory: 17M/2039M
[INFO] ------------------------------------------------------------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Investigating...&lt;/p&gt;</comment>
                            <comment id="13230484" author="simone.tripodi" created="Thu, 15 Mar 2012 20:01:36 +0000"  >&lt;p&gt;Ahhhhhh I finally got it... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Fix going to be committed in a short while!&lt;/p&gt;</comment>
                            <comment id="13230491" author="tkrah" created="Thu, 15 Mar 2012 20:03:59 +0000"  >&lt;p&gt;Oh sorry for reformatting :-| - my fault, sorry - will take care next time and yes i am still interested in getting this one fixed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Yeah, i can run it too many times with success. Depends really on the ability to run multiple threads at once to get the threads in the critical path like mentioned where it would fail - may need many times (20+ or 50+) to force some failure here.&lt;/p&gt;</comment>
                            <comment id="13230498" author="simone.tripodi" created="Thu, 15 Mar 2012 20:11:54 +0000"  >&lt;p&gt;I just committed a potential fix for that issue - can I kindly ask you to update your local copy and double check, please?&lt;br/&gt;
TIA!!! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13230521" author="tkrah" created="Thu, 15 Mar 2012 20:31:59 +0000"  >&lt;p&gt;2 stack traces from test with potential fix - still there for me.&lt;/p&gt;</comment>
                            <comment id="13230527" author="tkrah" created="Thu, 15 Mar 2012 20:40:12 +0000"  >&lt;p&gt;mvn test from command line run.&lt;/p&gt;</comment>
                            <comment id="13230546" author="simone.tripodi" created="Thu, 15 Mar 2012 21:06:27 +0000"  >&lt;p&gt;OH I finally can see where the issue happens - the problem is in &lt;tt&gt;org.apache.commons.digester3.xmlrules.FromXmlRulesModule&lt;/tt&gt; where there is an attempt to read the same &lt;tt&gt;InputSource&lt;/tt&gt; multiple times ;(&lt;/p&gt;

&lt;p&gt;I need to find an alternative &lt;tt&gt;InputSource&lt;/tt&gt; loading method... otherwise I am forced to discourage the &lt;tt&gt;FromXmlRulesModule&lt;/tt&gt; use in a multiple-thread context...&lt;/p&gt;</comment>
                            <comment id="13230569" author="tkrah" created="Thu, 15 Mar 2012 21:26:19 +0000"  >&lt;p&gt;What about initializing the rules at construction time of the loader? Wouldn&apos;t it fix the race condition? Or using a ReentrantReadWriteLock to guard the init phase in question?&lt;/p&gt;</comment>
                            <comment id="13230593" author="simone.tripodi" created="Thu, 15 Mar 2012 21:48:06 +0000"  >&lt;p&gt;I just committed &lt;a href=&quot;http://svn.apache.org/viewvc?rev=1301217&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1301217&lt;/a&gt;, can you check if it works in your environment please?&lt;br/&gt;
I adopted the strategy of loading the rules stream as soon as the loaders methods are invoked... less performant but safer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Please let me know, thanks in advance!&lt;/p&gt;</comment>
                            <comment id="13231018" author="tkrah" created="Fri, 16 Mar 2012 10:05:34 +0000"  >&lt;p&gt;No success yet - thats the output now (sometimes it does work, but not everytime).&lt;/p&gt;</comment>
                            <comment id="13231067" author="simone.tripodi" created="Fri, 16 Mar 2012 11:15:11 +0000"  >&lt;p&gt;HA poor me, I see - the already bound check should be now per-thread, not global, otherwise threads cannot load the same resource concurrently :S&lt;br/&gt;
I&apos;ll provide you a new fix attempt ASAP - Thanks for reporting!&lt;/p&gt;</comment>
                            <comment id="13231164" author="simone.tripodi" created="Fri, 16 Mar 2012 13:30:27 +0000"  >&lt;p&gt;I committed r1301493, I hope this will fix that issue once for all!&lt;/p&gt;</comment>
                            <comment id="13231293" author="tkrah" created="Fri, 16 Mar 2012 15:30:30 +0000"  >&lt;p&gt;Sorry - seems to be still there.&lt;br/&gt;
Output from 3 of ca. 20 runs attached.&lt;br/&gt;
NullPointerException and ConcurrentModificationExceptions seen.&lt;/p&gt;

</comment>
                            <comment id="13231351" author="simone.tripodi" created="Fri, 16 Mar 2012 16:33:35 +0000"  >&lt;p&gt;bad, bad, bad news... ;( investigating again... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13231548" author="tn" created="Fri, 16 Mar 2012 19:34:00 +0000"  >&lt;p&gt;I have no idea about the digester, but I looked at this issue out of curiosity (and I like to debug concurrency problems &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;The problems is in the DigesterLoader#addRules method:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;createRuleSet clears the underlying rule binder&lt;/li&gt;
	&lt;li&gt;addRuleInstance iterates over the same rule binder&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If you make this method synchronized, you will not get an exception anymore.&lt;/p&gt;

&lt;p&gt;What I do not know, if the createRuleSet is implemented correctly. I would expect that the initialization of the rules binder happens when the DigesterLoader is created, not when a new digester is requested, but this is may be due to lazy loading?&lt;/p&gt;</comment>
                            <comment id="13231658" author="simone.tripodi" created="Fri, 16 Mar 2012 21:46:08 +0000"  >&lt;p&gt;you are a good observator Thomas &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;when I coded &lt;tt&gt;createRuleSet&lt;/tt&gt; the first time, I thought about lazy loading AND to the fact that users can set different &lt;tt&gt;ClassLoader}}s - since classes resolution by name can produce different results, I opted for checking it when requesting new {{Digester&lt;/tt&gt; instances.&lt;/p&gt;

&lt;p&gt;I would like to avoid to add a &lt;tt&gt;synchronized&lt;/tt&gt; block, even if producing &lt;tt&gt;Digester&lt;/tt&gt; instances is quietly fast that would be a bottleneck, thread-safe behavior with concurrent accesses would be preferred.&lt;/p&gt;

&lt;p&gt;Do you have any other suggestion?&lt;br/&gt;
TIA!!!&lt;/p&gt;</comment>
                            <comment id="13231722" author="simone.tripodi" created="Fri, 16 Mar 2012 23:03:00 +0000"  >&lt;p&gt;Thanks to Thomas&apos; observations, I opted to drop the lazy loading support - please see r1301815&lt;/p&gt;

&lt;p&gt;Can you do yet another test cycle, when having spare time, please? TIA!&lt;/p&gt;</comment>
                            <comment id="13232501" author="tkrah" created="Mon, 19 Mar 2012 08:18:41 +0000"  >&lt;p&gt;Looks promising until now - tested it a few times yet and seems to be fixed, since initialization is done at construction time now of the loader. I&apos;ll reopen it if needed. Thx for getting this fixed.&lt;/p&gt;</comment>
                            <comment id="13232521" author="simone.tripodi" created="Mon, 19 Mar 2012 09:17:18 +0000"  >&lt;p&gt;Thanks Torsten for the feedbacks and thanks Thomas for having a look at it!&lt;/p&gt;

&lt;p&gt;I mark the issue as resolved and Torsten has to feel free to reopen it if needed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12518518" name="163-2.patch" size="7260" author="tkrah" created="Thu, 15 Mar 2012 19:26:42 +0000"/>
                            <attachment id="12518513" name="163.patch" size="7227" author="tkrah" created="Thu, 15 Mar 2012 19:15:01 +0000"/>
                            <attachment id="12518461" name="Digester163TestCase.java" size="3562" author="tkrah" created="Thu, 15 Mar 2012 13:51:55 +0000"/>
                            <attachment id="12518534" name="cli-mvn-test-withfix.txt" size="6117" author="tkrah" created="Thu, 15 Mar 2012 20:40:11 +0000"/>
                            <attachment id="12518533" name="stack-afterfix.txt" size="23881" author="tkrah" created="Thu, 15 Mar 2012 20:31:59 +0000"/>
                            <attachment id="12518516" name="stack-mvn.txt" size="12845" author="tkrah" created="Thu, 15 Mar 2012 19:17:43 +0000"/>
                            <attachment id="12518646" name="stack-next.txt" size="14246" author="tkrah" created="Fri, 16 Mar 2012 10:05:33 +0000"/>
                            <attachment id="12518682" name="stack-next2.txt" size="14013" author="tkrah" created="Fri, 16 Mar 2012 15:30:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231521</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0d4iv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74509</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>