<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:11:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SUREFIRE-938] out of memory when logging more messages than heap size</title>
                <link>https://issues.apache.org/jira/browse/SUREFIRE-938</link>
                <project id="12317927" key="SUREFIRE">Maven Surefire (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;Observed OOM when logging more messages than heap size:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;ThreadedStreamConsumer&quot; java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
        at java.util.Arrays.copyOfRange(Arrays.java:3209)&lt;br/&gt;
        at java.lang.String.&amp;lt;init&amp;gt;(String.java:215)&lt;br/&gt;
        at java.lang.StringBuilder.toString(StringBuilder.java:430)&lt;br/&gt;
        at org.apache.maven.plugin.surefire.report.TestSetRunListener.getAsString(TestSetRunListener.java:225)&lt;br/&gt;
        at org.apache.maven.plugin.surefire.report.TestSetRunListener.wrap(TestSetRunListener.java:230)&lt;br/&gt;
        at org.apache.maven.plugin.surefire.report.TestSetRunListener.testSucceeded(TestSetRunListener.java:161)&lt;br/&gt;
        at org.apache.maven.plugin.surefire.booterclient.output.ForkClient.consumeLine(ForkClient.java:100)&lt;br/&gt;
        at org.apache.maven.plugin.surefire.booterclient.output.ThreadedStreamConsumer$Pumper.run(ThreadedStreamConsumer.java:67)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12810347">SUREFIRE-938</key>
            <summary>out of memory when logging more messages than heap size</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="krosenvold">Kristian Rosenvold</assignee>
                                    <reporter username="argaul">Andrew Gaul</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Dec 2012 01:42:23 +0000</created>
                <updated>Fri, 4 Jul 2025 07:19:52 +0000</updated>
                            <resolved>Thu, 2 May 2013 14:35:47 +0000</resolved>
                                    <version>2.12.4</version>
                                    <fixVersion>2.15</fixVersion>
                                    <component>Maven Surefire Plugin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14455622" author="krosenvold" created="Tue, 18 Dec 2012 08:36:10 +0000"  >&lt;p&gt;This problem has several facets to it; one is that we actually keep stdout/stderr from the process in memory on the plugin side. So technically increasing maven memory through MAVEN_OPTS should get you some way along the line (i.e. export MAVEN_OPTS=-Xmx1024m)&lt;/p&gt;

&lt;p&gt;The reason &quot;must&quot; keep the output in memory is because we use Xpp3Dom to write the XML reports, which basically keeps it all in memory. So for this issue to be &quot;truly&quot; fixed we&apos;d need to stream the content directly to disk for the xml reports. A second solution could be to simply not buffer in-memory if we don&apos;t write xml, which would remove the need for the buffered content.&lt;/p&gt;

&lt;p&gt;But on the other hand, the stack-trace in question shows that we actually keep the entire output in memory twice, so we can most certainly improve on this situation by only storing it once &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="14455692" author="argaul" created="Tue, 18 Dec 2012 15:27:08 +0000"  >&lt;p&gt;Kristian, I opened a pull request which avoids one of the copies:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/maven-surefire/pull/16&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/pull/16&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I do not know enough about Surefire to tackle using a file-backed structure at this point.&lt;/p&gt;</comment>
                            <comment id="14455716" author="krosenvold" created="Tue, 18 Dec 2012 22:11:17 +0000"  >&lt;p&gt;I&apos;m afraid the pull request doesn&apos;t entirely do it, since most of the memory related issues come from the bytBuffer.toString, which is where the nasty memory usage lies.&lt;/p&gt;

&lt;p&gt;The real problem is making the StatelessXmlReporter use a streaming xml api so it can immediately stream the stdout to file and keep stderr in a tempfile.&lt;/p&gt;

&lt;p&gt;It should be possible to make a simple unit test for the xml reporter while converting it to sax (it is tested extremely well through the IT&apos;s).&lt;/p&gt;

&lt;p&gt;If you want to have a shot at doing that, I can handle all the other changes that would need to be done (if you want to make it use Sax and works with a unit test I can fix the rest).&lt;/p&gt;

&lt;p&gt;The pull request has no real effect, please close it.&lt;/p&gt;

&lt;p&gt;btw; 2.13 is about 36 hours from now if you want it in there &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14455484" author="krosenvold" created="Wed, 19 Dec 2012 02:06:59 +0000"  >&lt;p&gt;We could use something like &lt;a href=&quot;http://commons.apache.org/io/api-release/org/apache/commons/io/output/DeferredFileOutputStream.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/io/api-release/org/apache/commons/io/output/DeferredFileOutputStream.html&lt;/a&gt; or FileBackedOutputStream for storing stderr&lt;/p&gt;</comment>
                            <comment id="14455648" author="krosenvold" created="Wed, 19 Dec 2012 02:12:37 +0000"  >&lt;p&gt;There already is a unit test for the statelessxmlreporter, so it should mostly be an issue of improving that and changing the impl&lt;/p&gt;</comment>
                            <comment id="14455970" author="krosenvold" created="Thu, 2 May 2013 10:35:25 +0000"  >&lt;p&gt;For the record, I have rewritten the stateless xml reporter to use sax, there&apos;s still a bit of work to be done before we loose all the memory bindings.&lt;/p&gt;</comment>
                            <comment id="14455856" author="krosenvold" created="Thu, 2 May 2013 14:35:47 +0000"  >&lt;p&gt;Fixed with a cute integration test in 33e110fc46aa43d10b38a93b3db74c09be6bc6d5&lt;/p&gt;</comment>
                            <comment id="14455932" author="krosenvold" created="Thu, 2 May 2013 14:37:30 +0000"  >&lt;p&gt;Btw, you may want to give 2.15-SNAPSHOT a spin to verify this works as intended, it&apos;ll update in an hour or so&lt;/p&gt;</comment>
                            <comment id="14455820" author="gaul" created="Tue, 14 May 2013 19:08:05 +0000"  >&lt;p&gt;Verified fixed for my use case.  Thanks Kristian!&lt;/p&gt;</comment>
                            <comment id="14456042" author="slavarosin" created="Thu, 5 Sep 2013 04:12:03 +0000"  >&lt;p&gt;New feature introduced the problem.&lt;/p&gt;</comment>
                            <comment id="17994338" author="olamy" created="Fri, 4 Jul 2025 07:19:52 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-surefire/issues/1609&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-surefire#1609&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310260">
                    <name>Related</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12810458">SUREFIRE-1031</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2beyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>