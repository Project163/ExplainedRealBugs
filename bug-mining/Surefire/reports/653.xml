<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:16:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SUREFIRE-1679] Caching of provider classpath with module-specific changes may break test bootstrapping in subsequent modules</title>
                <link>https://issues.apache.org/jira/browse/SUREFIRE-1679</link>
                <project id="12317927" key="SUREFIRE">Maven Surefire (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;I believe I&apos;ve identified a bug in the caching that&apos;s performed by &lt;tt&gt;AbstractSurefireMojo&lt;/tt&gt;. The problem that I am seeing is a failure to bootstrap Surefire:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[ERROR] org.apache.maven.surefire.booter.SurefireBooterForkException: There was an error in the forked process
[ERROR] java.lang.NoClassDefFoundError: org/junit/platform/launcher/core/LauncherFactory
[ERROR] at org.apache.maven.plugin.surefire.booterclient.ForkStarter.fork(ForkStarter.java:657)
[ERROR] at org.apache.maven.plugin.surefire.booterclient.ForkStarter.run(ForkStarter.java:283)
[ERROR] at org.apache.maven.plugin.surefire.booterclient.ForkStarter.run(ForkStarter.java:246)
[ERROR] at org.apache.maven.plugin.surefire.AbstractSurefireMojo.executeProvider(AbstractSurefireMojo.java:1161)
[ERROR] at org.apache.maven.plugin.surefire.AbstractSurefireMojo.executeAfterPreconditionsChecked(AbstractSurefireMojo.java:1002)
[ERROR] at org.apache.maven.plugin.surefire.AbstractSurefireMojo.execute(AbstractSurefireMojo.java:848)
[ERROR] at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:137)
[ERROR] at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:208)
[ERROR] at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:154)
[ERROR] at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:146)
[ERROR] at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:117)
[ERROR] at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:81)
[ERROR] at org.apache.maven.lifecycle.internal.builder.singlethreaded.SingleThreadedBuilder.build(SingleThreadedBuilder.java:56)
[ERROR] at org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:128)
[ERROR] at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:305)
[ERROR] at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:192)
[ERROR] at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:105)
[ERROR] at org.apache.maven.cli.MavenCli.execute(MavenCli.java:954)
[ERROR] at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:288)
[ERROR] at org.apache.maven.cli.MavenCli.main(MavenCli.java:192)
[ERROR] at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
[ERROR] at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
[ERROR] at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
[ERROR] at java.lang.reflect.Method.invoke(Method.java:498)
[ERROR] at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:289)
[ERROR] at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:229)
[ERROR] at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:415)
[ERROR] at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:356)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This is in a module that uses Surefire and JUnit Jupiter 5.5:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;dependencies&amp;gt;
	&amp;lt;dependency&amp;gt;
		&amp;lt;groupId&amp;gt;org.junit.jupiter&amp;lt;/groupId&amp;gt;
		&amp;lt;artifactId&amp;gt;junit-jupiter&amp;lt;/artifactId&amp;gt;
		&amp;lt;version&amp;gt;5.5.0&amp;lt;/version&amp;gt;
		&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
	&amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;
&amp;lt;build&amp;gt;
	&amp;lt;plugins&amp;gt;
		&amp;lt;plugin&amp;gt;
			&amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;
			&amp;lt;artifactId&amp;gt;maven-surefire-plugin&amp;lt;/artifactId&amp;gt;
			&amp;lt;version&amp;gt;2.22.2&amp;lt;/version&amp;gt;
		&amp;lt;/plugin&amp;gt;
	&amp;lt;/plugins&amp;gt;
&amp;lt;/build&amp;gt;
&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Earlier in the reactor, another project is built which depends on &lt;tt&gt;junit-platform-launcher&lt;/tt&gt;:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;dependencies&amp;gt;
	&amp;lt;dependency&amp;gt;
		&amp;lt;groupId&amp;gt;org.junit.platform&amp;lt;/groupId&amp;gt;
		&amp;lt;artifactId&amp;gt;junit-platform-launcher&amp;lt;/artifactId&amp;gt;
		&amp;lt;version&amp;gt;1.5.0&amp;lt;/version&amp;gt;
	&amp;lt;/dependency&amp;gt;
	&amp;lt;dependency&amp;gt;
		&amp;lt;groupId&amp;gt;org.junit.jupiter&amp;lt;/groupId&amp;gt;
		&amp;lt;artifactId&amp;gt;junit-jupiter&amp;lt;/artifactId&amp;gt;
		&amp;lt;version&amp;gt;5.5.0&amp;lt;/version&amp;gt;
		&amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
	&amp;lt;/dependency&amp;gt;
&amp;lt;/dependencies&amp;gt;
&amp;lt;build&amp;gt;
	&amp;lt;plugins&amp;gt;
		&amp;lt;plugin&amp;gt;
			&amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;
			&amp;lt;artifactId&amp;gt;maven-surefire-plugin&amp;lt;/artifactId&amp;gt;
			&amp;lt;version&amp;gt;2.22.2&amp;lt;/version&amp;gt;
		&amp;lt;/plugin&amp;gt;
	&amp;lt;/plugins&amp;gt;
&amp;lt;/build&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For the problem to occur, both projects have to be built in the same reactor. Building of the module which depends on &lt;tt&gt;junit-platform-launcher&lt;/tt&gt; is causing some pollution that results in the other module failing to build.&lt;/p&gt;

&lt;p&gt;I believe I&apos;ve tracked down the cause of this pollution to some caching that&apos;s performed by &lt;a href=&quot;https://github.com/apache/maven-surefire/blob/d96b95c4bda73c4a93506db38b9ca76b4d7b5743/maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/AbstractSurefireMojo.java#L1750-L1756&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;AbstractSurefireMojo&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testClasspathWrapper.avoidArtifactDuplicates( providerArtifacts );


Classpath providerClasspath = ClasspathCache.getCachedClassPath( providerName );
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( providerClasspath == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; )
{
    providerClasspath = ClasspathCache.setCachedClasspath( providerName, providerArtifacts );
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first line above removes the launcher artifact from &lt;tt&gt;providerArtifacts&lt;/tt&gt;. These module-specific adjustments to the provider artifacts are then used to create the cached &lt;tt&gt;providerClasspath&lt;/tt&gt;. When a subsequent module retrieves this cached classpath and uses it, the build fails as the launcher is missing.&lt;/p&gt;

&lt;p&gt;I have attached a zip which contains a minimal build that should reproduce the problem. You should see it fail when you run the &lt;tt&gt;verify&lt;/tt&gt; goal.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13244922">SUREFIRE-1679</key>
            <summary>Caching of provider classpath with module-specific changes may break test bootstrapping in subsequent modules</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tibordigana">Tibor Digana</assignee>
                                    <reporter username="awilkinson">Andy Wilkinson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Jul 2019 10:13:35 +0000</created>
                <updated>Fri, 4 Jul 2025 07:33:59 +0000</updated>
                            <resolved>Wed, 14 Aug 2019 19:10:48 +0000</resolved>
                                    <version>2.22.2</version>
                    <version>3.0.0-M3</version>
                                    <fixVersion>2.22.3</fixVersion>
                    <fixVersion>3.0.0-M4</fixVersion>
                                    <component>Maven Surefire Plugin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16885086" author="tibor17" created="Mon, 15 Jul 2019 11:00:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=awilkinson&quot; class=&quot;user-hover&quot; rel=&quot;awilkinson&quot;&gt;awilkinson&lt;/a&gt;&lt;br/&gt;
yes, you&apos;r right, this is really an old practice &lt;tt&gt;ClasspathCache.setCachedClasspath()&lt;/tt&gt;.&lt;br/&gt;
Can you open a Pull Request on GitHUb with the fix?&lt;br/&gt;
Search for usage of &lt;tt&gt;ClasspathCache&lt;/tt&gt;. Ideally we should use instance object instead of static context. WDYT?&lt;/p&gt;</comment>
                            <comment id="16886239" author="awilkinson" created="Tue, 16 Jul 2019 15:56:48 +0000"  >&lt;p&gt;Thanks, Tibor. I&apos;d be happy to try and contribute a pull request that fixes the problem. I notice that you&apos;ve set 3.0.0-M4 as the fix version. To be able to justify spending time on it, I&apos;d really like a fix in 2.22.x. Would that be possible?&lt;/p&gt;</comment>
                            <comment id="16886392" author="tibor17" created="Tue, 16 Jul 2019 19:07:29 +0000"  >&lt;p&gt;We need to have it in both release versions. So it means two PRs.&lt;br/&gt;
Simply continue in master which is &lt;tt&gt;3.0.0-M4&lt;/tt&gt; and then we will open a new branch &lt;tt&gt;release/2.22.3&lt;/tt&gt; derived from previous &lt;tt&gt;release/2.22.2&lt;/tt&gt;.&lt;br/&gt;
oki, do you agree?&lt;/p&gt;</comment>
                            <comment id="16886748" author="awilkinson" created="Wed, 17 Jul 2019 07:39:52 +0000"  >&lt;p&gt;Sounds good to me. Thanks.&lt;/p&gt;</comment>
                            <comment id="16886805" author="awilkinson" created="Wed, 17 Jul 2019 09:05:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibordigana&quot; class=&quot;user-hover&quot; rel=&quot;tibordigana&quot;&gt;tibordigana&lt;/a&gt;, how would you like the changes to &lt;tt&gt;ClasspathCache&lt;/tt&gt; to be handled? As things stand its &lt;tt&gt;CLASSPATHS&lt;/tt&gt; map and all of its methods are &lt;tt&gt;static&lt;/tt&gt; and they need to be instance-scoped instead. It&apos;s only used by &lt;tt&gt;AbstractSurefireMojo&lt;/tt&gt; as far as I can tell, but it is a public class. What&apos;s the preferred way of handling breaking API changes, both in a 3.0 milestone and in a 2.22.x maintenance release?&lt;/p&gt;

&lt;p&gt;FWIW, my instinct is to deprecate &lt;tt&gt;ClasspathCache&lt;/tt&gt;, leave it otherwise unchanged, and create a private inner-class in &lt;tt&gt;AbstractSurefireMojo&lt;/tt&gt; that serves the required purpose without being part of the public API.&lt;/p&gt;</comment>
                            <comment id="16888852" author="tibor17" created="Fri, 19 Jul 2019 13:10:04 +0000"  >&lt;p&gt;Whatabout to deprecate it in both versions.&lt;br/&gt;
I want to release this fix in &lt;tt&gt;3.0.0-M4&lt;/tt&gt; but our roadmap on the front page says that we will remove deprecated code in &lt;tt&gt;3.0.0-M6&lt;/tt&gt;.&lt;br/&gt;
So I want to folow the roadmap as much as possible.&lt;/p&gt;

&lt;p&gt;Agree?&lt;/p&gt;</comment>
                            <comment id="16888876" author="tibor17" created="Fri, 19 Jul 2019 13:47:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=awilkinson&quot; class=&quot;user-hover&quot; rel=&quot;awilkinson&quot;&gt;awilkinson&lt;/a&gt;&lt;br/&gt;
yes, pls deprecate &lt;tt&gt;ClasspathCache&lt;/tt&gt;.&lt;br/&gt;
Hidden inner-class would be great to have.&lt;/p&gt;</comment>
                            <comment id="16907550" author="tibor17" created="Wed, 14 Aug 2019 19:10:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=f7d43102173568f4272325ad71e334279b91db17&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=f7d43102173568f4272325ad71e334279b91db17&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17048686" author="christoph.dreis" created="Sun, 1 Mar 2020 21:45:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibordigana&quot; class=&quot;user-hover&quot; rel=&quot;tibordigana&quot;&gt;tibordigana&lt;/a&gt;&#160;Are there any plans to release 2.22.3?&lt;/p&gt;</comment>
                            <comment id="17048710" author="tibor17" created="Sun, 1 Mar 2020 23:29:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christoph.dreis&quot; class=&quot;user-hover&quot; rel=&quot;christoph.dreis&quot;&gt;christoph.dreis&lt;/a&gt;&lt;br/&gt;
I initiated the same question in the community but there was no colleague who could do it and help me to save my time and our time.&lt;br/&gt;
IMO you as a user, you should send an email to the community and require this release!&lt;br/&gt;
Please subsctibe to the Maven User List, &lt;a href=&quot;https://maven.apache.org/mailing-lists.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://maven.apache.org/mailing-lists.html&lt;/a&gt;, and send the email.&lt;/p&gt;</comment>
                            <comment id="17995077" author="olamy" created="Fri, 4 Jul 2025 07:33:59 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-surefire/issues/2092&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-surefire#2092&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12974710" name="surefire-pollution-problem.zip" size="4944" author="awilkinson" created="Mon, 15 Jul 2019 10:11:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z04o3c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>