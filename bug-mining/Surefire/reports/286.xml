<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:10:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SUREFIRE-825] NPE in JUnit4TestChecker if org.junit.runner.RunWith class can&apos;t be loaded by testClassloader</title>
                <link>https://issues.apache.org/jira/browse/SUREFIRE-825</link>
                <project id="12317927" key="SUREFIRE">Maven Surefire (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;This is a follow up on tycho-surefire bug &lt;a href=&quot;https://bugs.eclipse.org/bugs/show_bug.cgi?id=369266&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.eclipse.org/bugs/show_bug.cgi?id=369266&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If the class org.junit.runner.RunWith can&apos;t be loaded by the test classloader, we get an NPE&lt;/p&gt;

&lt;p&gt;org.apache.maven.surefire.util.SurefireReflectionException: java.lang.reflect.InvocationTargetException; nested exception is java.lang.reflect.InvocationTargetException: null&lt;br/&gt;
java.lang.reflect.InvocationTargetException&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:164)&lt;br/&gt;
	at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:110)&lt;br/&gt;
	at org.apache.maven.surefire.booter.SurefireStarter.invokeProvider(SurefireStarter.java:175)&lt;br/&gt;
	at org.apache.maven.surefire.booter.SurefireStarter.runSuitesInProcess(SurefireStarter.java:123)&lt;br/&gt;
	at org.eclipse.tycho.surefire.osgibooter.OsgiSurefireBooter.run(OsgiSurefireBooter.java:84)&lt;br/&gt;
	at org.eclipse.tycho.surefire.osgibooter.HeadlessTestApplication.run(HeadlessTestApplication.java:21)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.eclipse.equinox.internal.app.EclipseAppContainer.callMethodWithException(EclipseAppContainer.java:587)&lt;br/&gt;
	at org.eclipse.equinox.internal.app.EclipseAppHandle.run(EclipseAppHandle.java:198)&lt;br/&gt;
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.runApplication(EclipseAppLauncher.java:110)&lt;br/&gt;
	at org.eclipse.core.runtime.internal.adaptor.EclipseAppLauncher.start(EclipseAppLauncher.java:79)&lt;br/&gt;
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:344)&lt;br/&gt;
	at org.eclipse.core.runtime.adaptor.EclipseStarter.run(EclipseStarter.java:179)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.eclipse.equinox.launcher.Main.invokeFramework(Main.java:622)&lt;br/&gt;
	at org.eclipse.equinox.launcher.Main.basicRun(Main.java:577)&lt;br/&gt;
	at org.eclipse.equinox.launcher.Main.run(Main.java:1410)&lt;br/&gt;
	at org.eclipse.equinox.launcher.Main.main(Main.java:1386)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at java.lang.Class.getAnnotation(Class.java:3027)&lt;br/&gt;
	at org.apache.maven.surefire.common.junit4.JUnit4TestChecker.isValidJUnit4Test(JUnit4TestChecker.java:63)&lt;br/&gt;
	at org.apache.maven.surefire.common.junit4.JUnit4TestChecker.accept(JUnit4TestChecker.java:52)&lt;br/&gt;
	at org.apache.maven.surefire.util.DefaultDirectoryScanner.locateTestClasses(DefaultDirectoryScanner.java:80)&lt;br/&gt;
	at org.apache.maven.surefire.junit4.JUnit4Provider.scanClassPath(JUnit4Provider.java:174)&lt;br/&gt;
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:83)&lt;br/&gt;
	... 28 more&lt;/p&gt;


&lt;p&gt;This can happen in an OSGi classloader environment where classloading/visibility is controlled down to the package level.&lt;br/&gt;
A test OSGi bundle may well only import package org.junit (containing the Test annotation, via  MANIFEST header &quot;Import-Package: org.junit&quot;), but not package org.junit.runner.&lt;br/&gt;
Thus org.junit.runner.RunWith can&apos;t be loaded by the test classloader and the runWith member in JUnit4TestChecker is null.&lt;/p&gt;

&lt;p&gt;Attached patch gracefully handles the null case simply by adding a null check.&lt;br/&gt;
IMHO we can safely ignore the case where the RunWith class can&apos;t be loaded because if it can&apos;t be loaded, the test was not able to reference it at design time either, so it can&apos;t be annotated with @RunWith.&lt;/p&gt;

&lt;p&gt;Providing a standalone test case for this is hard as it only happens in an OSGi classloader environment...&lt;br/&gt;
The sample project attached to the original tycho-surefire issue above demonstrates the problem. (&apos;mvn clean integration-test&apos; to reproduce)&lt;/p&gt;</description>
                <environment>tycho-surefire OSGi adapter</environment>
        <key id="12809643">SUREFIRE-825</key>
            <summary>NPE in JUnit4TestChecker if org.junit.runner.RunWith class can&apos;t be loaded by testClassloader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="krosenvold">Kristian Rosenvold</assignee>
                                    <reporter username="jan.sievers">Jan Sievers</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Jan 2012 03:44:22 +0000</created>
                <updated>Fri, 4 Jul 2025 07:17:53 +0000</updated>
                            <resolved>Fri, 17 Feb 2012 10:47:19 +0000</resolved>
                                    <version>2.10</version>
                                    <fixVersion>2.12.1</fixVersion>
                                    <component>Junit 4.x support</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14455176" author="jan.sievers" created="Mon, 30 Jan 2012 03:47:03 +0000"  >&lt;p&gt;git patch&lt;/p&gt;</comment>
                            <comment id="14455385" author="jan.sievers" created="Wed, 1 Feb 2012 07:39:29 +0000"  >&lt;p&gt;If you think this issue is valid, I am willing to spend time on writing a unit test which mocks the package-filtering OSGi classloader to reproduce the issue standalone.&lt;/p&gt;</comment>
                            <comment id="14455243" author="krosenvold" created="Tue, 14 Feb 2012 06:13:03 +0000"  >&lt;p&gt;A test would be &lt;b&gt;really&lt;/b&gt; nice, since we don&apos;t commit patches without tests. And I don&apos;t know how to write this test &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14455216" author="jan.sievers" created="Tue, 14 Feb 2012 10:27:45 +0000"  >&lt;p&gt;I will add a test to the patch&lt;/p&gt;</comment>
                            <comment id="14455369" author="jan.sievers" created="Fri, 17 Feb 2012 10:29:19 +0000"  >&lt;p&gt;git patch v2 (now with unit test which reproduce the bug in non-OSGi environment)&lt;/p&gt;
</comment>
                            <comment id="14455287" author="krosenvold" created="Fri, 17 Feb 2012 10:47:19 +0000"  >&lt;p&gt;Thanks for an interesting patch, nicely solved testcase!&lt;/p&gt;

&lt;p&gt;Applied in r1245650&lt;/p&gt;</comment>
                            <comment id="17994231" author="olamy" created="Fri, 4 Jul 2025 07:17:53 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-surefire/issues/1743&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-surefire#1743&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12719795" name="0001-SUREFIRE-825-Add-null-check-for-runWith-field.patch" size="6659" author="jan.sievers" created="Fri, 17 Feb 2012 10:29:19 +0000"/>
                            <attachment id="12719793" name="0001-SUREFIRE-825-Add-null-check-for-runWith-field.patch" size="1550" author="jan.sievers" created="Mon, 30 Jan 2012 03:47:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bglb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>