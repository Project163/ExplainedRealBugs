<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:14:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SUREFIRE-1374] std/in stream corrupted error</title>
                <link>https://issues.apache.org/jira/browse/SUREFIRE-1374</link>
                <project id="12317927" key="SUREFIRE">Maven Surefire (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;We bumbed surefire version to 2.20 (from 2.19.1) and our tests started generating this kind of errors:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;# Created on 2017-05-26T10:24:04.032
[SUREFIRE] std/in stream corrupted
java.io.IOException: Command BYE_ACK unexpectedly read &lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt; data with length 4.
	at org.apache.maven.surefire.booter.MasterProcessCommand.decode(MasterProcessCommand.java:130)
	at org.apache.maven.surefire.booter.CommandReader$CommandRunnable.run(CommandReader.java:386)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Related stacktrace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[ERROR] Error occurred in starting fork, check output in log
[ERROR] org.apache.maven.surefire.booter.SurefireBooterForkException: Error occurred in starting fork, check output in log
[ERROR] 	at org.apache.maven.plugin.surefire.booterclient.ForkStarter.fork(ForkStarter.java:634)
[ERROR] 	at org.apache.maven.plugin.surefire.booterclient.ForkStarter.fork(ForkStarter.java:533)
[ERROR] 	at org.apache.maven.plugin.surefire.booterclient.ForkStarter.run(ForkStarter.java:279)
[ERROR] 	at org.apache.maven.plugin.surefire.booterclient.ForkStarter.run(ForkStarter.java:243)
[ERROR] 	at org.apache.maven.plugin.surefire.AbstractSurefireMojo.executeProvider(AbstractSurefireMojo.java:1077)
[ERROR] 	at org.apache.maven.plugin.surefire.AbstractSurefireMojo.executeAfterPreconditionsChecked(AbstractSurefireMojo.java:907)
[ERROR] 	at org.apache.maven.plugin.surefire.AbstractSurefireMojo.execute(AbstractSurefireMojo.java:785)
[ERROR] 	at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:134)
[ERROR] 	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:208)
[ERROR] 	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:154)
[ERROR] 	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:146)
[ERROR] 	at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:117)
[ERROR] 	at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:81)
[ERROR] 	at org.apache.maven.lifecycle.internal.builder.singlethreaded.SingleThreadedBuilder.build(SingleThreadedBuilder.java:51)
[ERROR] 	at org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:128)
[ERROR] 	at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:309)
[ERROR] 	at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:194)
[ERROR] 	at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:107)
[ERROR] 	at org.apache.maven.cli.MavenCli.execute(MavenCli.java:993)
[ERROR] 	at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:345)
[ERROR] 	at org.apache.maven.cli.MavenCli.main(MavenCli.java:191)
[ERROR] 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
[ERROR] 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
[ERROR] 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
[ERROR] 	at java.lang.reflect.Method.invoke(Method.java:498)
[ERROR] 	at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:289)
[ERROR] 	at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:229)
[ERROR] 	at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:415)
[ERROR] 	at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:356)
[
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Everything worked fine with 2.19.1.&lt;/p&gt;

&lt;p&gt;Environment: macOS sierra, java version &quot;1.8.0_74&quot;, Apache Maven 3.5.0  &lt;/p&gt;</description>
                <environment></environment>
        <key id="13075118">SUREFIRE-1374</key>
            <summary>std/in stream corrupted error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10004">Not A Bug</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="matteor">matteo rulli</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 May 2017 08:48:37 +0000</created>
                <updated>Fri, 4 Jul 2025 07:28:22 +0000</updated>
                            <resolved>Sun, 8 Dec 2024 15:52:34 +0000</resolved>
                                    <version>2.20</version>
                                                    <component>Maven Surefire Plugin</component>
                        <due></due>
                            <votes>4</votes>
                                    <watches>15</watches>
                                                                                                                <comments>
                            <comment id="16027416" author="tibor17" created="Sat, 27 May 2017 12:35:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matteor&quot; class=&quot;user-hover&quot; rel=&quot;matteor&quot;&gt;matteor&lt;/a&gt;&lt;br/&gt;
These are errors for you as users. We are not sending wrong data to ourselves. That&apos;s the point of these dump files that you have to investigate what your code and JVM is doing with the stream.&lt;br/&gt;
I have committed unit tests encoding and decoding&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/maven-surefire/commit/1ca8374d2618fa2667bd4a82c9684a30fba619d9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/commit/1ca8374d2618fa2667bd4a82c9684a30fba619d9&lt;/a&gt;&lt;br/&gt;
The command BYE_ACK has ordinal 5 and NOOP has 4 in enum.&lt;br/&gt;
according to &lt;tt&gt;java.io.IOException: Command BYE_ACK unexpectedly read Void data with length 4.&lt;/tt&gt; I wrote these tests in the commit above and the commands do not interlace.&lt;br/&gt;
Download the source of surefire project and debug or print what commands are coming in and out, means classes &lt;tt&gt;TestProvidingInputStream&lt;/tt&gt;, &lt;tt&gt;TestLessInputStreamBuilder&lt;/tt&gt; and &lt;tt&gt;CommandReader&lt;/tt&gt;.&lt;br/&gt;
You can attach your project to Jira and I will try to reproduce the issue.&lt;/p&gt;</comment>
                            <comment id="16027452" author="matteor" created="Sat, 27 May 2017 15:07:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibor17&quot; class=&quot;user-hover&quot; rel=&quot;tibor17&quot;&gt;tibor17&lt;/a&gt;&lt;br/&gt;
Our code is doing nothing with std input/output stream. So I guess it is some library we are using... Yet, I&apos;m wondering why with previous surefire version everything worked just fine.&lt;/p&gt;

&lt;p&gt;Unfortunately I cannot attach the project since it is a proprietary project of our customer.&lt;/p&gt;

&lt;p&gt;Just to have a starting point for my investigations: could you describe me what commands BYE_ACK, NOOP and all that are? Who is supposed to generate them and why they should be corrupted? Version incompatibility of some kind? &lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="16027985" author="tibor17" created="Mon, 29 May 2017 01:19:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matteor&quot; class=&quot;user-hover&quot; rel=&quot;matteor&quot;&gt;matteor&lt;/a&gt;&lt;br/&gt;
Can you produce effective POM and send it to me? I want to know if the POM is mixing old version of surefire and surefire providers.&lt;br/&gt;
Against 2.19.1 there was not any significant changes.&lt;br/&gt;
Does it happen always?&lt;br/&gt;
Are you able to download our sources and put &lt;tt&gt;System.out.println(. . . )&lt;/tt&gt; in class &lt;tt&gt;MasterProcessCommand&lt;/tt&gt;, install it to local maven repo and use version &lt;tt&gt;2.21-SNAPSHOT&lt;/tt&gt; in you project? In that class you will see two methods &lt;tt&gt;readInt()&lt;/tt&gt; and &lt;tt&gt;is.readFully( buffer )&lt;/tt&gt;. Log their values to the console like a stream of bytes.&lt;br/&gt;
This would help. Additionally log this condition which should never happen &lt;tt&gt;if ( command == null )&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16027994" author="tibor17" created="Mon, 29 May 2017 01:44:19 +0000"  >&lt;p&gt;What jdk vendor it is?&lt;/p&gt;</comment>
                            <comment id="16028475" author="matteor" created="Mon, 29 May 2017 15:38:26 +0000"  >&lt;p&gt;Thank you Tibor for your help on this. The jvm is Java HotSpot(TM) 64-Bit Server VM (build 25.74-b02, mixed mode).&lt;/p&gt;

&lt;p&gt;I&apos;m going to follow your suggestions and I&apos;ll post here the results.&lt;/p&gt;</comment>
                            <comment id="16034168" author="tibor17" created="Fri, 2 Jun 2017 05:35:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elecharny&quot; class=&quot;user-hover&quot; rel=&quot;elecharny&quot;&gt;elecharny&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matteor&quot; class=&quot;user-hover&quot; rel=&quot;matteor&quot;&gt;matteor&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=fac376c5f7d1b5ca9b2ec220b39b35397d04326a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=fac376c5f7d1b5ca9b2ec220b39b35397d04326a&lt;/a&gt;&lt;br/&gt;
Can you guys check it out with this change?&lt;br/&gt;
The SNAPSHOT version will be available in cca 2 hours. You will need to add section &lt;tt&gt;pluginRepositories&lt;/tt&gt; with URL for snapshots &lt;tt&gt;&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/&lt;/a&gt;&lt;/tt&gt;.&lt;br/&gt;
Maybe you are facing &lt;tt&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1302&quot; title=&quot;Surefire does not wait long enough for the forked VM and assumes it to be dead&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-1302&quot;&gt;&lt;del&gt;SUREFIRE-1302&lt;/del&gt;&lt;/a&gt;&lt;/tt&gt; with different error message but that should be fixed separately.&lt;/p&gt;</comment>
                            <comment id="16034205" author="hudson" created="Fri, 2 Jun 2017 06:19:43 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build maven-surefire #1711 (See &lt;a href=&quot;https://builds.apache.org/job/maven-surefire/1711/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/maven-surefire/1711/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1374&quot; title=&quot;std/in stream corrupted error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-1374&quot;&gt;&lt;del&gt;SUREFIRE-1374&lt;/del&gt;&lt;/a&gt; std/in stream corrupted error (tibor17: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/?p=maven-surefire.git&amp;amp;a=commit&amp;amp;h=fac376c5f7d1b5ca9b2ec220b39b35397d04326a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/?p=maven-surefire.git&amp;amp;a=commit&amp;amp;h=fac376c5f7d1b5ca9b2ec220b39b35397d04326a&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) surefire-booter/src/main/java/org/apache/maven/surefire/booter/ForkedBooter.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16034370" author="elecharny" created="Fri, 2 Jun 2017 09:26:19 +0000"  >&lt;p&gt;Sadly, I implemented a workaround in our code, and cut the release yesterday. The problem being that the failure was only met when running &lt;tt&gt;mvn release:perform&lt;/tt&gt;, not when running the test in isolation with &lt;tt&gt;mvn test&lt;/tt&gt; or maven &lt;tt&gt;clean:install&lt;/tt&gt;, so I can&apos;t really test something without cutting a release - somehing I might do next week though -&lt;/p&gt;</comment>
                            <comment id="16035219" author="tibor17" created="Fri, 2 Jun 2017 18:42:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=elecharny&quot; class=&quot;user-hover&quot; rel=&quot;elecharny&quot;&gt;elecharny&lt;/a&gt;&lt;br/&gt;
If you use Git you can suppress &lt;tt&gt;git push&lt;/tt&gt; and deploy the artifacts on disk &lt;tt&gt;X:&lt;/tt&gt; if you have Windows.&lt;br/&gt;
&lt;tt&gt;mvn release:prepare -DcommitByProject=true -DpushChanges=false&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;mvn release:perform -DconnectionUrl=scm:git:&lt;a href=&quot;file:///X:/my-repo&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///X:/my-repo&lt;/a&gt;&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="16035226" author="elecharny" created="Fri, 2 Jun 2017 18:49:04 +0000"  >&lt;p&gt;SVN + Mac OSX &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Don&apos;t worry, I have to cut a 2.0.0 next week, so I will have plenty of occasion to test the fix. I&apos;ll keep you posted !&lt;br/&gt;
Thanks !&lt;/p&gt;</comment>
                            <comment id="16083435" author="elecharny" created="Wed, 12 Jul 2017 04:36:53 +0000"  >&lt;p&gt;Ok, I can confirm that the 21-SNAPSHOT is fixing the issue, which otherwise occurs 75% of the time when I run a mvn test.&lt;/p&gt;

&lt;p&gt;At this point, I&apos;d fancy a release &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Sorry for the delayed check, and thanks for the fix !&lt;/p&gt;</comment>
                            <comment id="16083443" author="tibor17" created="Wed, 12 Jul 2017 04:46:00 +0000"  >&lt;p&gt;Thx. I have a fix prepared in my working copy been developed in December&lt;br/&gt;
2016 but it is a big change so we would first proceed with small one&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1302&quot; title=&quot;Surefire does not wait long enough for the forked VM and assumes it to be dead&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-1302&quot;&gt;&lt;del&gt;SUREFIRE-1302&lt;/del&gt;&lt;/a&gt; making release 2.20.1 and then release with version 2.20.2&lt;br/&gt;
including the patch from December.&lt;/p&gt;

&lt;p&gt;On Wed, Jul 12, 2017 at 6:37 AM, Emmanuel Lecharny (JIRA) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="16153445" author="dan.berindei" created="Tue, 5 Sep 2017 10:37:35 +0000"  >&lt;p&gt;I&apos;m also seeing this in a test suite that uses JUnit 4 and &lt;tt&gt;@RunWith(PaxExam.class)&lt;/tt&gt;, and I&apos;m able to reproduce it 100% of the time with surefire 2.20. &lt;/p&gt;

&lt;p&gt;The stream of commands sent from the master to the fork looks fine, I tested it by setting a breakpoint at &lt;tt&gt;MasterProcessCommand.java:130&lt;/tt&gt; and looking at &lt;tt&gt;is&lt;/tt&gt;&apos;s buffer. The problem is that &lt;tt&gt;pax-exam-container-karaf&lt;/tt&gt;&apos;s &lt;tt&gt;InternalRunner.createShutdownHook&lt;/tt&gt; creates a thread that continuously reads from &lt;tt&gt;System.in&lt;/tt&gt; and pumps that into the Karaf process&apos;s stdin. I&apos;m not sure why &lt;tt&gt;pax-exam-container-karaf&lt;/tt&gt; thinks it needs to do that, but I think surefire should use &lt;tt&gt;System.setIn()&lt;/tt&gt; to avoid interference from the test.&lt;/p&gt;</comment>
                            <comment id="16204723" author="binkley" created="Sat, 14 Oct 2017 16:39:28 +0000"  >&lt;p&gt;It happens reliably for me using Spring Boot&apos;s ASCII color default banner.  My example project is &lt;a href=&quot;https://github.com/binkley/sproingk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/binkley/sproingk&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For example, first two dumps in the dumpstream file.  I copied these from a vim buffer so it would printably display the control characters.  The second example does not have control characters, though.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# Created on 2017-10-14T11:31:34.406
Corrupted stdin stream in forked JVM 1. Stream &lt;span class=&quot;code-quote&quot;&gt;&apos;^[[34m&apos;&lt;/span&gt;.
java.lang.IllegalArgumentException: Stream stdin corrupted. Expected comma after third character in command &lt;span class=&quot;code-quote&quot;&gt;&apos;^[[34m&apos;&lt;/span&gt;.
    at org.apache.maven.plugin.surefire.booterclient.output.ForkClient$OperationalData.&amp;lt;init&amp;gt;(ForkClient.java:469)
    at org.apache.maven.plugin.surefire.booterclient.output.ForkClient.processLine(ForkClient.java:191)
    at org.apache.maven.plugin.surefire.booterclient.output.ForkClient.consumeLine(ForkClient.java:158)
    at org.apache.maven.plugin.surefire.booterclient.output.ThreadedStreamConsumer$Pumper.run(ThreadedStreamConsumer.java:87)
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)


# Created on 2017-10-14T11:31:34.407
Corrupted stdin stream in forked JVM 1. Stream &lt;span class=&quot;code-quote&quot;&gt;&apos;                  ____                  _             _&apos;&lt;/span&gt;.
java.lang.IllegalArgumentException: Stream stdin corrupted. Expected comma after third character in command &lt;span class=&quot;code-quote&quot;&gt;&apos;                  ____                  _             _&apos;&lt;/span&gt;.
    at org.apache.maven.plugin.surefire.booterclient.output.ForkClient$OperationalData.&amp;lt;init&amp;gt;(ForkClient.java:469)
    at org.apache.maven.plugin.surefire.booterclient.output.ForkClient.processLine(ForkClient.java:191)
    at org.apache.maven.plugin.surefire.booterclient.output.ForkClient.consumeLine(ForkClient.java:158)
    at org.apache.maven.plugin.surefire.booterclient.output.ThreadedStreamConsumer$Pumper.run(ThreadedStreamConsumer.java:87)
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16204739" author="tibor17" created="Sat, 14 Oct 2017 17:17:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dan.berindei&quot; class=&quot;user-hover&quot; rel=&quot;dan.berindei&quot;&gt;dan.berindei&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=binkley&quot; class=&quot;user-hover&quot; rel=&quot;binkley&quot;&gt;binkley&lt;/a&gt;&lt;br/&gt;
Did you see FAQ on Surefire documentation page?&lt;br/&gt;
This requires cooperation with Surefire development because we only make others errors more visible.&lt;br/&gt;
This dump reported by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=binkley&quot; class=&quot;user-hover&quot; rel=&quot;binkley&quot;&gt;binkley&lt;/a&gt; is not an error in Surefire, I would say. We printed this error message in dump file because frameworks, here Spring, writes directly to native STDOUT as it seems. Some logger, I think Log4J and Arquillian fixed this issue already, is still used with old version.&lt;br/&gt;
The worse error is &lt;tt&gt;Command BYE_ACK unexpectedly read Void data with length 4&lt;/tt&gt; which I do not know how happened, since this is &lt;tt&gt;System.in&lt;/tt&gt; read by Surefire and this looks like one of the following three issues:&lt;br/&gt;
+ encoding on system, so that empty characters are added after BYE_ACK&lt;br/&gt;
+ JVM adds white characters when it is about to exit after System.exit. (can be avoided with workaround in Surefire)&lt;br/&gt;
+ some framework does&lt;/p&gt;</comment>
                            <comment id="16204757" author="dan.berindei" created="Sat, 14 Oct 2017 17:46:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibor17&quot; class=&quot;user-hover&quot; rel=&quot;tibor17&quot;&gt;tibor17&lt;/a&gt; the FAQ doesn&apos;t mention that tests are not allowed to read from &lt;tt&gt;System.in&lt;/tt&gt;, so it doesn&apos;t cover my scenario.&lt;/p&gt;

&lt;p&gt;Brian&apos;s case is just another reminder that &lt;tt&gt;System.setOut()&lt;/tt&gt; is only a workaround, and it breaks with something as simple as saving &lt;tt&gt;System.out&lt;/tt&gt; to a static field during class initialization. You may want to add &lt;a href=&quot;https://github.com/fusesource/jansi/blob/master/jansi/src/main/java/org/fusesource/jansi/AnsiConsole.java#L40&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;jansi&lt;/a&gt; and &lt;a href=&quot;http://hg.openjdk.java.net/jdk8/jdk8/jdk/file/687fd7c7986d/src/share/classes/java/io/Console.java#l569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;java.io.Console&lt;/a&gt; to the FAQ.&lt;/p&gt;</comment>
                            <comment id="16204771" author="tibor17" created="Sat, 14 Oct 2017 18:24:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=binkley&quot; class=&quot;user-hover&quot; rel=&quot;binkley&quot;&gt;binkley&lt;/a&gt;&lt;br/&gt;
Your problem is totally root cause different from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matteor&quot; class=&quot;user-hover&quot; rel=&quot;matteor&quot;&gt;matteor&lt;/a&gt;&apos;s. The one who can fix it is you and your dependencies e.g. Spring. See the colors [[34m in the dump file - find the dependency which does this and switch it off. Simply do not use Jansi, &lt;tt&gt;System.setOut()&lt;/tt&gt;, &lt;tt&gt;FileDescriptor.out&lt;/tt&gt;, nor &lt;tt&gt;Console&lt;/tt&gt;.&lt;br/&gt;
In some later version I want to use TCP sockets instead of native standard pipes, but there are more important features to do in prior.&lt;/p&gt;</comment>
                            <comment id="16204780" author="tibor17" created="Sat, 14 Oct 2017 18:49:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=binkley&quot; class=&quot;user-hover&quot; rel=&quot;binkley&quot;&gt;binkley&lt;/a&gt;&lt;br/&gt;
I found your problem was reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1359&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SUREFIRE-1359&lt;/a&gt;&lt;br/&gt;
In both issues your tests do not fail due to this. Please contact vendors of your dependencies and try to configure a logger. We start &lt;tt&gt;ForkedBooter#main()&lt;/tt&gt; then we call &lt;tt&gt;System.setOut()&lt;/tt&gt; and then we run JUnit core. If SpringBoot or some other dependencies scans classpath and reads and caches &lt;tt&gt;System.out&lt;/tt&gt; before we override it with our wrapper then you will see the log in console. If you use version &lt;tt&gt;2.20.1&lt;/tt&gt; this log appears just once on Maven console, at least I hope. The dump will print it always. So it should not be much annoying but the annoying is the frameworks which should be better configured or better cache &lt;tt&gt;System.out&lt;/tt&gt; on first call of logger and not on the application startup.&lt;/p&gt;</comment>
                            <comment id="16204830" author="tibor17" created="Sat, 14 Oct 2017 21:23:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=binkley&quot; class=&quot;user-hover&quot; rel=&quot;binkley&quot;&gt;binkley&lt;/a&gt;&lt;br/&gt;
Pls read my previous comments as well. See &lt;a href=&quot;https://github.com/xwiki/xwiki-platform/commit/5258a22301977a7d1ee7276cdd81af7641f4f5ac&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this discussion&lt;/a&gt;. It can be freely JUnit5 issue. We have to also investigate the order of instantiation of JUnit5 in Surefire Provider and call of &lt;tt&gt;setOut&lt;/tt&gt; method.&lt;/p&gt;</comment>
                            <comment id="16204849" author="tibor17" created="Sat, 14 Oct 2017 23:07:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matteor&quot; class=&quot;user-hover&quot; rel=&quot;matteor&quot;&gt;matteor&lt;/a&gt;&lt;br/&gt;
Does it happen always?&lt;br/&gt;
I think this error &lt;tt&gt;Command BYE_ACK unexpectedly read Void data with length 4.&lt;/tt&gt; is specific in native JVM.&lt;br/&gt;
We send event &lt;tt&gt;BYE&lt;/tt&gt; to Maven process. It confirms by sending &lt;tt&gt;BYE_ACK&lt;/tt&gt;, which means code 0x05, to the fork and &lt;tt&gt;ForkStarter&lt;/tt&gt; closed the pipe STDIN, see &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. The fork will detect &lt;tt&gt;CTRL+D&lt;/tt&gt; in the pipe, see &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;, which means 0x04 ASCII code aka &lt;tt&gt;End of transmission&lt;/tt&gt;, see &lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;. Then the buffer of shared memory in the pipe is flushed to the forked JVM with a lot of zeros at the end.&lt;br/&gt;
Let&apos;s put all this together, the fork will receive this stream&lt;br/&gt;
&lt;tt&gt;0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, etc.&lt;/tt&gt;.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: &lt;a href=&quot;https://unix.stackexchange.com/questions/16333/how-to-signal-the-end-of-stdin-input&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://unix.stackexchange.com/questions/16333/how-to-signal-the-end-of-stdin-input&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;: &lt;a href=&quot;https://en.wikipedia.org/wiki/End-of-Transmission_character&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://en.wikipedia.org/wiki/End-of-Transmission_character&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;: &lt;a href=&quot;http://donsnotes.com/tech/charsets/ascii.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://donsnotes.com/tech/charsets/ascii.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16205089" author="tibor17" created="Sun, 15 Oct 2017 10:41:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matteor&quot; class=&quot;user-hover&quot; rel=&quot;matteor&quot;&gt;matteor&lt;/a&gt;&lt;br/&gt;
Can you attach your POM and Maven debug logs (mvn -X install) in Jira?&lt;br/&gt;
Do you use these configuration parameters &lt;tt&gt;forkedProcessTimeoutInSeconds&lt;/tt&gt; and &lt;tt&gt;forkedProcessExitTimeoutInSeconds&lt;/tt&gt;?&lt;br/&gt;
Are your tests consuming a lot memory and is the GC period long?&lt;br/&gt;
I want to investigate initiator which caused that JVM started &lt;tt&gt;System.exit&lt;/tt&gt; between events &lt;tt&gt;BYE&lt;/tt&gt; and &lt;tt&gt;BYE_ACK&lt;/tt&gt;.&lt;br/&gt;
It could be anything like &lt;tt&gt;System.exit&lt;/tt&gt;, any ShutdownHooks, timeout.&lt;/p&gt;

&lt;p&gt;I am asking this because it is obvious that something sent &lt;tt&gt;CTRL+C&lt;/tt&gt;.&lt;br/&gt;
It could be shutdown hook or CI machine which is more probable to happen.&lt;/p&gt;

&lt;p&gt;Does it happen always?&lt;/p&gt;</comment>
                            <comment id="16205090" author="tibor17" created="Sun, 15 Oct 2017 10:47:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dan.berindei&quot; class=&quot;user-hover&quot; rel=&quot;dan.berindei&quot;&gt;dan.berindei&lt;/a&gt;&lt;br/&gt;
It seems you have different problem.&lt;br/&gt;
Can you tell me how could Karaf expect it working in Surefire environment.&lt;br/&gt;
Even if we wrapped STDIN, as you said via &lt;tt&gt;System.setIn()&lt;/tt&gt;, this still would not solve your problem because Karaf would receive unexpected stream. Our stream from Surefire plugin.&lt;br/&gt;
I think this is conceptual problem with either Karaf or the test. If it is the test then you should maybe talk with Christial from Karaf about this issue and somehow come over reading STDIN or mock it on your side in tests with data that the Karaf or PAX would expect.&lt;/p&gt;</comment>
                            <comment id="17994784" author="olamy" created="Fri, 4 Jul 2025 07:28:22 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-surefire/issues/2320&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-surefire#2320&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13019544">SUREFIRE-1302</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fifr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>