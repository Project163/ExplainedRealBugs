<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:05:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SUREFIRE-104] unable to establish my own http protocol handler for unit tests</title>
                <link>https://issues.apache.org/jira/browse/SUREFIRE-104</link>
                <project id="12317927" key="SUREFIRE">Maven Surefire (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;In order to establish my own http protocol handler, I set the system property java.protocol.handler.pkgs and ensure that the tests require a fork.  The test runs fine under maven 1.0.2, but fails under maven 2.0.4.  I have tried both surefire 2.1.3 and 2.2, and both with the childDelegation option.&lt;/p&gt;

&lt;p&gt;The test sees the system property properly set, but the test&apos;s protocol handler is not actually used.&lt;/p&gt;

&lt;p&gt;The attached zip file demonstrates this problem (run &quot;maven test&quot; and &quot;mvn test&quot;).&lt;/p&gt;</description>
                <environment>jse 5.0 (osx)</environment>
        <key id="12809935">SUREFIRE-104</key>
            <summary>unable to establish my own http protocol handler for unit tests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="afyfe">Andy Fyfe</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 May 2006 18:01:45 +0000</created>
                <updated>Fri, 4 Jul 2025 05:48:45 +0000</updated>
                            <resolved>Mon, 26 Nov 2007 04:57:39 +0000</resolved>
                                    <version>2.0 (2.2 plugin)</version>
                                                        <due></due>
                            <votes>8</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14453470" author="carlos" created="Fri, 2 Jun 2006 17:32:45 +0000"  >&lt;p&gt;What is the error you get with m2 for attached test?&lt;/p&gt;</comment>
                            <comment id="14453473" author="afyfe" created="Mon, 12 Jun 2006 17:05:38 +0000"  >&lt;p&gt;Part of the output of &quot;mvn test&quot; follows:&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
-------------------------------------------------------&lt;br/&gt;
 T E S T S&lt;br/&gt;
-------------------------------------------------------&lt;br/&gt;
Running test.HandlerTest&lt;br/&gt;
Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 1.329 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;/p&gt;

&lt;p&gt;Results :&lt;br/&gt;
Tests run: 1, Failures: 1, Errors: 0, Skipped: 0&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;$ cat target/surefire-reports/test.HandlerTest.txt&lt;br/&gt;
-------------------------------------------------------------------------------&lt;br/&gt;
Test set: test.HandlerTest&lt;br/&gt;
-------------------------------------------------------------------------------&lt;br/&gt;
Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 1.31 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
testHandelr(test.HandlerTest)  Time elapsed: 1.166 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
junit.framework.ComparisonFailure: expected:&amp;lt;hello world&amp;gt; but was:&amp;lt;&amp;lt;!DOCTYPE h&amp;gt;&lt;br/&gt;
        at junit.framework.Assert.assertEquals(Assert.java:81)&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;The first line of the default index page returned by apache on my mac when visiting &lt;a href=&quot;http://localhost&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost&lt;/a&gt; happens to be&lt;br/&gt;
    &amp;lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;&lt;/p&gt;

&lt;p&gt;If I change the test code to use a different url, say&lt;br/&gt;
    URL url = new URL(&quot;http://localhost:12345&quot;);&lt;br/&gt;
the test will still fail under maven 2, but the error is (obviously) different:&lt;/p&gt;

&lt;p&gt;$ cat target/surefire-reports/test.HandlerTest.txt&lt;br/&gt;
-------------------------------------------------------------------------------&lt;br/&gt;
Test set: test.HandlerTest&lt;br/&gt;
-------------------------------------------------------------------------------&lt;br/&gt;
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.184 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
testHandelr(test.HandlerTest)  Time elapsed: 0.078 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
java.net.ConnectException: Connection refused&lt;br/&gt;
        at java.net.PlainSocketImpl.socketConnect(Native Method)&lt;/p&gt;

&lt;p&gt;In either case, the test succeeds with maven 1.0.2.&lt;/p&gt;</comment>
                            <comment id="14453441" author="afyfe" created="Mon, 12 Jun 2006 17:19:22 +0000"  >&lt;p&gt;I&apos;ve tried this now also on solaris and linux.&lt;/p&gt;

&lt;p&gt;In the case of our solaris machine, an attempt to access &lt;a href=&quot;http://localhost&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost&lt;/a&gt; is denied, and the test fails with the following error:&lt;/p&gt;

&lt;p&gt;$ cat target/surefire-reports/test.HandlerTest.txt&lt;br/&gt;
-------------------------------------------------------------------------------&lt;br/&gt;
Test set: test.HandlerTest&lt;br/&gt;
-------------------------------------------------------------------------------&lt;br/&gt;
Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.707 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
testHandelr(test.HandlerTest)  Time elapsed: 0.277 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
junit.framework.AssertionFailedError: expected:&amp;lt;200&amp;gt; but was:&amp;lt;403&amp;gt;&lt;/p&gt;

&lt;p&gt;In the case of our linux machine, it&apos;s a 502 error instead of a 403 from the web server, so the test report is essentially the same.&lt;/p&gt;</comment>
                            <comment id="14453455" author="ko5tik" created="Sat, 17 Jun 2006 14:46:10 +0000"  >&lt;p&gt;I also get similar problem with custom protocol handler. &lt;br/&gt;
( and it works under 1.0.2 ) &lt;/p&gt;

&lt;p&gt;from mvn -X I see:&lt;br/&gt;
-------------&lt;del&gt;%&amp;lt;&lt;/del&gt;--------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; Setting system property &lt;span class=&quot;error&quot;&gt;&amp;#91;java.protocol.handler.pkgs&amp;#93;&lt;/span&gt;=&lt;span class=&quot;error&quot;&gt;&amp;#91;org.generama.mock.protocol&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; Setting system property &lt;span class=&quot;error&quot;&gt;&amp;#91;generama.home&amp;#93;&lt;/span&gt;=&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/ko5tik/xdoclet_2/generama&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; Setting system property &lt;span class=&quot;error&quot;&gt;&amp;#91;localRepository&amp;#93;&lt;/span&gt;=&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/ko5tik/.m2/repository&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; Setting system property &lt;span class=&quot;error&quot;&gt;&amp;#91;basedir&amp;#93;&lt;/span&gt;=&lt;span class=&quot;error&quot;&gt;&amp;#91;/home/ko5tik/xdoclet_2/generama&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Surefire report directory: /home/ko5tik/xdoclet_2/generama/target/surefire-reports&lt;br/&gt;
Forking command line: java -classpath /home/ko5tik/.m2/repository/org/apache/maven/surefire/surefire-api/2.0/surefire-api-2.0.jar:/home/ko5tik/.m2/repository/org/codehaus/plexus/plexus-utils/1.1/plexus-utils-1.1.jar:/home/ko5tik/.m2/repository/org/apache/maven/surefire/surefire-booter/2.0/surefire-booter-2.0.jar org.apache.maven.surefire.booter.SurefireBooter /tmp/surefire6470tmp /tmp/surefire6471tmp&lt;/p&gt;

&lt;p&gt;-------------------------------------------------------&lt;br/&gt;
 T E S T S&lt;br/&gt;
-------------------------------------------------------&lt;br/&gt;
Running org.generama.mock.protocol.memory.HandlerTestCase&lt;br/&gt;
protocol packages: org.generama.mock.protocol&lt;br/&gt;
from action: org.generama.mock.protocol&lt;br/&gt;
class in question:class org.generama.mock.protocol.memory.Handler&lt;br/&gt;
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.088 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;/p&gt;

&lt;p&gt;............................%&amp;lt;------------------------------&lt;/p&gt;

&lt;p&gt;So apparently system propeties are passed to my testcase&lt;br/&gt;
where I do some debug output: &lt;br/&gt;
................................%&amp;lt;------------------&lt;br/&gt;
      String protocolPackages = System.getProperty(&quot;java.protocol.handler.pkgs&quot;);&lt;/p&gt;

&lt;p&gt;		String fromaction = ((String)(AccessController.doPrivileged&lt;br/&gt;
		(new GetPropertyAction(&quot;java.protocol.handler.pkgs&quot;,&lt;br/&gt;
				       &quot;&quot;))));&lt;/p&gt;

&lt;p&gt;        System.err.println(&quot;protocol packages: &quot; + protocolPackages);&lt;br/&gt;
        System.err.println(&quot;from action: &quot; + fromaction);&lt;/p&gt;


&lt;p&gt;        try &lt;/p&gt;
{
			System.err.println(&quot;class in question:&quot; + Thread.currentThread().getContextClassLoader().loadClass(protocolPackages + &quot;.memory.Handler&quot;));
		}
&lt;p&gt; catch (ClassNotFoundException e) &lt;/p&gt;
{
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
&lt;p&gt;................%&amp;lt;-----------------------&lt;/p&gt;

&lt;p&gt;So, apparetnly my settings are seen in testcase. &lt;/p&gt;

&lt;p&gt;But then I get:&lt;br/&gt;
....................%&amp;lt;--------------------------&lt;br/&gt;
testMemoryURL(org.generama.mock.protocol.memory.HandlerTestCase)  Time elapsed: 0.026 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
java.net.MalformedURLException: unknown protocol: memory&lt;br/&gt;
        at java.net.URL.&amp;lt;init&amp;gt;(URL.java:365)&lt;br/&gt;
        at java.net.URL.&amp;lt;init&amp;gt;(URL.java:253)&lt;br/&gt;
        at java.net.URL.&amp;lt;init&amp;gt;(URL.java:276)&lt;br/&gt;
        at org.generama.mock.protocol.memory.HandlerTestCase.testMemoryURL(HandlerTestCase.java:21)&lt;br/&gt;
....................%&amp;lt;--------------------------&lt;/p&gt;
</comment>
                            <comment id="14453483" author="ko5tik" created="Mon, 19 Jun 2006 07:34:08 +0000"  >&lt;p&gt;I found cause of this problem - it&apos;s a mix between java.net.URL&lt;br/&gt;
and classloading in surefire. &lt;/p&gt;

&lt;p&gt;My findings:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;URL actually receives system property&lt;/li&gt;
	&lt;li&gt;URL is loaded by root classloader ( because it is used by SurefireBooter )&lt;/li&gt;
	&lt;li&gt;internally java.net.URL does Class.forName() -&amp;gt; this fails, because your classes are&lt;br/&gt;
   in IsolatedClassloader -&amp;gt; clasloaded which loaded URL does not know about it&lt;/li&gt;
	&lt;li&gt;as a fallback URL does : ClassLoader.getSystemClassLoader().loadClass() -&amp;gt; which also fails for the same&lt;br/&gt;
reason. &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So, there is no chance to get it to work without patching surefirebooter.&lt;/p&gt;

&lt;p&gt;Quick workaroung ( ugly hack, but it works ) :&lt;br/&gt;
..........................%&amp;lt;---------------&lt;br/&gt;
    	URL.setURLStreamHandlerFactory( new URLStreamHandlerFactory() {&lt;/p&gt;

&lt;p&gt;			public URLStreamHandler createURLStreamHandler(String protocol) {&lt;br/&gt;
				if(&quot;memory&quot;.equals(protocol))&lt;/p&gt;
{
					return new Handler();
				}
&lt;p&gt;				return null;&lt;br/&gt;
			}});&lt;br/&gt;
..........................%&amp;lt;---------------&lt;/p&gt;

&lt;p&gt;before you try to create URL, in every testcase... ( since it may be forked... ) &lt;/p&gt;
</comment>
                            <comment id="14453580" author="markusw" created="Fri, 8 Dec 2006 03:20:14 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;when forking enabled, the system properties are not set on the command line, but programmatically. &lt;br/&gt;
Could this be the problem?&lt;br/&gt;
 I have a similar problem and I can load my custom Handler class programmatically, but it is not properly registered and thus not activated.&lt;br/&gt;
Is there a good reason why the system properties are set via System.setProperty() and not on the command line with -D...=...?&lt;/p&gt;</comment>
                            <comment id="14453653" author="apill" created="Thu, 22 Feb 2007 11:06:58 +0000"  >&lt;p&gt;I&apos;m experiencing the same error trying to start up the embedded jboss container within surefire.&lt;/p&gt;

&lt;p&gt;I get&lt;/p&gt;

&lt;p&gt;java.net.MalformedURLException: unknown protocol: vfsfile&lt;br/&gt;
at java.net.URL.&amp;lt;init&amp;gt;(URL.java:365)&lt;br/&gt;
at java.net.URL.&amp;lt;init&amp;gt;(URL.java:253)&lt;br/&gt;
at java.net.URL.&amp;lt;init&amp;gt;(URL.java:276)&lt;br/&gt;
.....&lt;/p&gt;
</comment>
                            <comment id="14454135" author="dfabulich" created="Mon, 26 Nov 2007 04:57:39 +0000"  >&lt;p&gt;This test passes just fine with the 2.4 trunk if you set useSystemClassLoader=true.  It&apos;s annoying that this isn&apos;t the default, (making it the default would screw up a lot of other stuff), I hope that will change in some future version, but at least you don&apos;t have to hack Surefire to do it.&lt;/p&gt;</comment>
                            <comment id="17993514" author="olamy" created="Fri, 4 Jul 2025 05:48:45 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-surefire/issues/1112&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-surefire#1112&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12720061" name="protocol.zip" size="4249" author="afyfe" created="Mon, 29 May 2006 18:01:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bcon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>