<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:14:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SUREFIRE-1264] Some tests can be lost when running in parallel with parameterized tests</title>
                <link>https://issues.apache.org/jira/browse/SUREFIRE-1264</link>
                <project id="12317927" key="SUREFIRE">Maven Surefire (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;It appears some tests can be lost when using the parallel mode with parameterized tests. Here is a &lt;a href=&quot;https://github.com/jderrien/surefire-junit-tests/tree/simple-1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;small project&lt;/a&gt; I&apos;ve used to try to reproduce the issue we have seen.&lt;/p&gt;

&lt;p&gt;This is not something that happens on every run, but it&apos;s quite frequent.&lt;/p&gt;

&lt;p&gt;With this loop, the problem should appear in less than 2 minutes, maybe on the first run when (un)lucky:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;time &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; mvn clean test &amp;gt; last.log ; tail -25 last.log ; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; [ &lt;span class=&quot;code-quote&quot;&gt;&quot;$(grep -c &lt;span class=&quot;code-quote&quot;&gt;&apos;Tests run: 12&apos;&lt;/span&gt; last.log)&quot;&lt;/span&gt; == &lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; ]; then &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;; fi ; done
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Normal run:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running [p2]
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p2] - p2 - sleeptime = 1 =&amp;gt; start
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p2] - p2 - sleeptime = 1 =&amp;gt; stop
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p1] - p1 - sleeptime = 2 =&amp;gt; start
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p1] - p1 - sleeptime = 2 =&amp;gt; stop
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p0] - p0 - sleeptime = 5 =&amp;gt; start
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p0] - p0 - sleeptime = 5 =&amp;gt; stop
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 5.006 sec - in [p2]
Running [p2]
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.011 sec - in [p2]

Results :

Tests run: 12, Failures: 0, Errors: 0, Skipped: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When tests have been lost (here one test lost according to the output):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running [p2]
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p0] - p0 - sleeptime = 5 =&amp;gt; start
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p2] - p2 - sleeptime = 1 =&amp;gt; start
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p1] - p1 - sleeptime = 2 =&amp;gt; start
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 sec - in [p2]
Running [p2]
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 sec - in [p2]

Results :

Tests run: 11, Failures: 0, Errors: 0, Skipped: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note: there are 3 test classes and 18 tests on the &lt;a href=&quot;https://github.com/jderrien/surefire-junit-tests/tree/master&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;master branch&lt;/a&gt; and it&apos;s even more frequent/easy to reproduce.&lt;/p&gt;</description>
                <environment>Maven 3.3.9&lt;br/&gt;
Java 1.8.0_45 (Oracle)&lt;br/&gt;
System: OS X&lt;br/&gt;
&lt;br/&gt;
Reproduced on Linux too, with both OpenJDK 7 and Java 7 from Oracle.</environment>
        <key id="12992931">SUREFIRE-1264</key>
            <summary>Some tests can be lost when running in parallel with parameterized tests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tibordigana">Tibor Digana</assignee>
                                    <reporter username="jderrien">Jean-Luc Derrien</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Jul 2016 13:40:51 +0000</created>
                <updated>Fri, 4 Jul 2025 07:25:59 +0000</updated>
                            <resolved>Wed, 30 Aug 2017 15:03:53 +0000</resolved>
                                    <version>2.19.1</version>
                                    <fixVersion>2.20.1</fixVersion>
                                    <component>Junit 4.7+ (parallel) support</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>10</watches>
                                                    <progress percentage="85">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="85" backgroundColor="#51a825"/>
                                                    <row percentage="15" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="85">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="85" backgroundColor="#51a825"/>
                                                    <row percentage="15" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="86400">24h</timeestimate>
                            <timespent seconds="518400">144h</timespent>
                                <comments>
                            <comment id="15420276" author="tibor17" created="Sun, 14 Aug 2016 09:24:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jderrien&quot; class=&quot;user-hover&quot; rel=&quot;jderrien&quot;&gt;jderrien&lt;/a&gt;&lt;br/&gt;
I don&apos;t use MAC so it is quite difficult to reproduce it for me. Can you try to create individual files for every cls-method-parameter on the file system to see if it is real or just displaying issue?&lt;/p&gt;</comment>
                            <comment id="15420277" author="tibor17" created="Sun, 14 Aug 2016 09:28:12 +0000"  >&lt;p&gt;It might be an issue that &lt;tt&gt;parameterList()&lt;/tt&gt; uses &lt;tt&gt;ArrayList&lt;/tt&gt; which is not threadsafe. Try to use &lt;tt&gt;ConcurrentLinkedQueue&lt;/tt&gt; instead.&lt;/p&gt;</comment>
                            <comment id="15422967" author="jderrien" created="Tue, 16 Aug 2016 16:15:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibor17&quot; class=&quot;user-hover&quot; rel=&quot;tibor17&quot;&gt;tibor17&lt;/a&gt;, I&apos;ve modified my branch &lt;a href=&quot;https://github.com/jderrien/surefire-junit-tests/tree/simple-1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;simple-1&lt;/a&gt; accordingly.&lt;/p&gt;

&lt;p&gt;I still reproduce the problem with &lt;tt&gt;ConcurrentLinkedQueue&lt;/tt&gt;. It seems to be a reporting error since all the 12 files are created even when the output reports 11 tests:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running [p2]
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p1] - p1 - sleeptime = 2 =&amp;gt; start
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p0] - p0 - sleeptime = 5 =&amp;gt; start
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p2] - p2 - sleeptime = 1 =&amp;gt; start
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.007 sec - in [p2]
Running [p2]
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.012 sec - in [p2]

Results :

Tests run: 11, Failures: 0, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 7.315 s
[INFO] Finished at: 2016-08-16T18:06:26+02:00
[INFO] Final Memory: 16M/168M
[INFO] ------------------------------------------------------------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ls target/*.log
target/com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p0].log
target/com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p1].log
target/com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p2].log
target/com.appnexus.viewability.core.surefireJunitTests.ATest.methodA2[p0].log
target/com.appnexus.viewability.core.surefireJunitTests.ATest.methodA2[p1].log
target/com.appnexus.viewability.core.surefireJunitTests.ATest.methodA2[p2].log
target/com.appnexus.viewability.core.surefireJunitTests.BTest.methodB1[p0].log
target/com.appnexus.viewability.core.surefireJunitTests.BTest.methodB1[p1].log
target/com.appnexus.viewability.core.surefireJunitTests.BTest.methodB1[p2].log
target/com.appnexus.viewability.core.surefireJunitTests.BTest.methodB2[p0].log
target/com.appnexus.viewability.core.surefireJunitTests.BTest.methodB2[p1].log
target/com.appnexus.viewability.core.surefireJunitTests.BTest.methodB2[p2].log
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Note: I also reproduce the problem on Linux with different version of Java and Maven:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ mvn --version
Warning: JAVA_HOME environment variable is not set.
Apache Maven 2.2.1 (r801777; 2009-08-06 21:16:01+0200)
Java version: 1.7.0_95
Java home: /usr/lib/jvm/java-7-openjdk-amd64/jre
Default locale: en_GB, platform encoding: UTF-8
OS name: &quot;linux&quot; version: &quot;3.14.32-xxxx-std-ipv6-64&quot; arch: &quot;amd64&quot; Family: &quot;unix&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case, the output is slightly different (10 tests only, and the output shows the &lt;tt&gt;=&amp;gt; stop&lt;/tt&gt; logs correctly when the problem occurs, which is not the case with my other setup):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running [p2]
Tests run: 4, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.004 sec - in [p2]
Running [p2]
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p1] - p1 - sleeptime = 2 =&amp;gt; start
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p1] - p1 - sleeptime = 2 =&amp;gt; stop
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p0] - p0 - sleeptime = 5 =&amp;gt; start
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p0] - p0 - sleeptime = 5 =&amp;gt; stop
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p2] - p2 - sleeptime = 1 =&amp;gt; start
com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1[p2] - p2 - sleeptime = 1 =&amp;gt; stop
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 5.002 sec - in [p2]

Results :

Tests run: 10, Failures: 0, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 7 seconds
[INFO] Finished at: Tue Aug 16 17:32:18 CEST 2016
[INFO] Final Memory: 30M/478M
[INFO] ------------------------------------------------------------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15520650" author="tibor17" created="Sun, 25 Sep 2016 11:16:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jderrien&quot; class=&quot;user-hover&quot; rel=&quot;jderrien&quot;&gt;jderrien&lt;/a&gt;&lt;br/&gt;
Please try to help us to fix it and open a pull request in GitHub with your patch.&lt;br/&gt;
Thx.&lt;/p&gt;</comment>
                            <comment id="15523278" author="jderrien" created="Mon, 26 Sep 2016 14:48:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibor17&quot; class=&quot;user-hover&quot; rel=&quot;tibor17&quot;&gt;tibor17&lt;/a&gt;, sorry I won&apos;t be able to provide a patch. I don&apos;t understand the underlying code and don&apos;t have the required skills to fix the issue.&lt;/p&gt;</comment>
                            <comment id="15640150" author="rsmith86" created="Sat, 5 Nov 2016 17:24:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibor17&quot; class=&quot;user-hover&quot; rel=&quot;tibor17&quot;&gt;tibor17&lt;/a&gt; I am facing the same issue in a project. We also use Parameterized tests and run them in parallel (suitesAndClasses) with a fork. I also created a simple project to replicate this issue:&lt;br/&gt;
&lt;a href=&quot;https://github.com/riksmith/SUREFIRE-1264-demo&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/riksmith/SUREFIRE-1264-demo&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The actual project has a much more complex setup (including a custom junit runner code), but I hope a fix for this sample project will also fix our actual project.&lt;/p&gt;

&lt;p&gt;Perhaps good to know:&lt;br/&gt;
If you run the sample project with parallel: classes the issue does not occur. &lt;br/&gt;
If you run the sample project with forkCount=0 the issue does not occur.&lt;/p&gt;

&lt;p&gt;I think it is some kind of threading issue. I tried looking into the code but I find it quite difficult to understand and I can&apos;t get it to debug properly.&lt;/p&gt;

&lt;p&gt;It is quite an important issue for us because this means that builds are sometimes succeeding while actually there are tests failing!&lt;/p&gt;</comment>
                            <comment id="15997474" author="tibor17" created="Thu, 4 May 2017 21:36:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=5593bf560aa8d8ed900fb146176a39ad5b0e42af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=5593bf560aa8d8ed900fb146176a39ad5b0e42af&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15997556" author="hudson" created="Thu, 4 May 2017 22:51:09 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build maven-surefire #1701 (See &lt;a href=&quot;https://builds.apache.org/job/maven-surefire/1701/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/maven-surefire/1701/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1264&quot; title=&quot;Some tests can be lost when running in parallel with parameterized tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-1264&quot;&gt;&lt;del&gt;SUREFIRE-1264&lt;/del&gt;&lt;/a&gt; Some tests can be lost when running in parallel with (tibor17: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/?p=maven-surefire.git&amp;amp;a=commit&amp;amp;h=5593bf560aa8d8ed900fb146176a39ad5b0e42af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/?p=maven-surefire.git&amp;amp;a=commit&amp;amp;h=5593bf560aa8d8ed900fb146176a39ad5b0e42af&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-1082-parallel-junit-parameterized/src/test/java/jiras/surefire1082/Jira1264Test.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-integration-tests/src/test/java/org/apache/maven/surefire/its/jiras/Surefire1082ParallelJUnitParameterizedIT.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/surefire-junit47/src/main/java/org/apache/maven/surefire/junitcore/JUnitCoreRunListener.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-api/src/main/java/org/apache/maven/surefire/util/internal/TestClassMethodNameUtils.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-integration-tests/src/test/resources/surefire-1082-parallel-junit-parameterized/src/test/java/jiras/surefire1082/Jira1082Test.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-integration-tests/src/test/java/org/apache/maven/surefire/its/fixture/TestFile.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15997565" author="tibor17" created="Thu, 4 May 2017 23:04:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsmith86&quot; class=&quot;user-hover&quot; rel=&quot;rsmith86&quot;&gt;rsmith86&lt;/a&gt;&lt;br/&gt;
Try to use Surefire plugin version &lt;tt&gt;2.21-SNAPSHOT&lt;/tt&gt; and plugin repository URL:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://repository.apache.org/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://repository.apache.org/snapshots/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16004097" author="rsmith86" created="Wed, 10 May 2017 05:32:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibor17&quot; class=&quot;user-hover&quot; rel=&quot;tibor17&quot;&gt;tibor17&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;With our test suite i find it difficult to tell whether it is now completely accurate, but the results are looking very good. So far I have not found an unexpected difference in the test runs from  the few last days.&lt;/p&gt;

&lt;p&gt;Thanks a lot for your effort!&lt;/p&gt;</comment>
                            <comment id="16061108" author="tlemeur" created="Fri, 23 Jun 2017 15:19:41 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibor17&quot; class=&quot;user-hover&quot; rel=&quot;tibor17&quot;&gt;tibor17&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thank a lot for your fix. I did some extensive testing on the 2.21-SNAPSHOT version, and this indeed improves a lot. For example, I was not able to reproduce the error using &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jderrien&quot; class=&quot;user-hover&quot; rel=&quot;jderrien&quot;&gt;jderrien&lt;/a&gt; branch.&lt;/p&gt;

&lt;p&gt;However if a test fails (Assert.fail), later tests can still be lost.&lt;/p&gt;

&lt;p&gt;I made a branch here to show the problem:&lt;br/&gt;
&lt;a href=&quot;https://github.com/tanguylemeur/surefire-junit-tests/tree/failure-2.21-snapshot-SUREFIRE-1264&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tanguylemeur/surefire-junit-tests/tree/failure-2.21-snapshot-SUREFIRE-1264&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If it would be ok, then this command should never end:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;time &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; mvn clean  test &amp;gt; last.log ; tail -25 last.log ; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; [ &lt;span class=&quot;code-quote&quot;&gt;&quot;$(grep -c &lt;span class=&quot;code-quote&quot;&gt;&apos;Tests run: 18&apos;&lt;/span&gt; last.log)&quot;&lt;/span&gt; == &lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; ]; then &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;; fi ; done&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Actually if you look at the trace, it seems that the test count varies 100% of the time if it starts with the class &quot;ATest&quot;. As far I understand, after a test fails, all tests from this class are not executed anymore.&lt;/p&gt;

&lt;p&gt;Let me know if you need more information, or if you want me to open a separate bug?&lt;/p&gt;

&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                            <comment id="16061860" author="tibor17" created="Sat, 24 Jun 2017 08:30:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tlemeur&quot; class=&quot;user-hover&quot; rel=&quot;tlemeur&quot;&gt;tlemeur&lt;/a&gt;&lt;br/&gt;
First I have to finish another pending issue and then I will dig into this. I will inform you.&lt;/p&gt;</comment>
                            <comment id="16064283" author="tibor17" created="Tue, 27 Jun 2017 05:19:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tlemeur&quot; class=&quot;user-hover&quot; rel=&quot;tlemeur&quot;&gt;tlemeur&lt;/a&gt;&lt;br/&gt;
I changed your POM. I do not see problem. What&apos;s wrong?&lt;br/&gt;
Do not use plugin in dependencies.&lt;br/&gt;
Use &lt;tt&gt;surefire-junit47&lt;/tt&gt; provider in dependencies embedded within plugin and not in project/dependencies; see the documentation &lt;a href=&quot;http://maven.apache.org/surefire/maven-surefire-plugin/examples/providers.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;provider for plugin&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running com.appnexus.viewability.core.surefireJunitTests.CTest
Start: CTest.methodC1[p0]
End:   CTest.methodC1[p0]
Start: CTest.methodC2[p0]
End:   CTest.methodC2[p0]
Start: CTest.methodC1[p1]
End:   CTest.methodC1[p1]
Start: CTest.methodC2[p1]
End:   CTest.methodC2[p1]
Start: CTest.methodC1[p2]
End:   CTest.methodC1[p2]
Start: CTest.methodC2[p2]
End:   CTest.methodC2[p2]
[INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.301 s - in com.appnexus.viewability.core.surefireJunitTests.CTest
[INFO] Running com.appnexus.viewability.core.surefireJunitTests.ATest
Start: ATest.methodA2[p0]
End:   ATest.methodA2[p0]
Start: ATest.methodA1[p0]
End:   ATest.methodA1[p0]
Start: ATest.methodA1[p1]
End:   ATest.methodA1[p1]
Start: ATest.methodA2[p1]
End:   ATest.methodA2[p1]
Start: ATest.methodA2[p2]
End:   ATest.methodA2[p2]
Start: ATest.methodA1[p2]
End:   ATest.methodA1[p2]
[ERROR] Tests run: 6, Failures: 3, Errors: 0, Skipped: 0, Time elapsed: 1.205 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in com.appnexus.viewability.core.surefireJunitTests.ATest
[ERROR] methodA1[p0](com.appnexus.viewability.core.surefireJunitTests.ATest)  Time elapsed: 0.105 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: Failing test: ATest.methodA1[p0]
        at com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1(ATest.java:14)

[ERROR] methodA1[p1](com.appnexus.viewability.core.surefireJunitTests.ATest)  Time elapsed: 0.1 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: Failing test: ATest.methodA1[p1]
        at com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1(ATest.java:14)

[ERROR] methodA1[p2](com.appnexus.viewability.core.surefireJunitTests.ATest)  Time elapsed: 0.1 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: Failing test: ATest.methodA1[p2]
        at com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1(ATest.java:14)

[INFO] Running com.appnexus.viewability.core.surefireJunitTests.BTest
Start: BTest.methodB1[p0]
End:   BTest.methodB1[p0]
Start: BTest.methodB2[p0]
End:   BTest.methodB2[p0]
Start: BTest.methodB1[p1]
End:   BTest.methodB1[p1]
Start: BTest.methodB2[p1]
End:   BTest.methodB2[p1]
Start: BTest.methodB1[p2]
End:   BTest.methodB1[p2]
Start: BTest.methodB2[p2]
End:   BTest.methodB2[p2]
[INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.206 s - in com.appnexus.viewability.core.surefireJunitTests.BTest
[INFO]
[INFO] Results:
[INFO]
[ERROR] Failures:
[ERROR]   ATest.methodA1:14 Failing test: ATest.methodA1[p0]
[ERROR]   ATest.methodA1:14 Failing test: ATest.methodA1[p1]
[ERROR]   ATest.methodA1:14 Failing test: ATest.methodA1[p2]
[INFO]
[ERROR] Tests run: 18, Failures: 3, Errors: 0, Skipped: 0
[INFO]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16064858" author="tlemeur" created="Tue, 27 Jun 2017 13:50:21 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibor17&quot; class=&quot;user-hover&quot; rel=&quot;tibor17&quot;&gt;tibor17&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Hmmm, that&apos;s surprising that you don&apos;t reproduce, whilst it&apos;s a bit random, I reproduce it more than 75% of the time (so waiting a few execution only show the problem rapidly) - &amp;lt;parallel&amp;gt;all&amp;lt;/parallel&amp;gt; helps a lot here to make it happen more frequently.&lt;/p&gt;

&lt;p&gt;I fixed the POM in the branch as you suggested. I still reproduce.&lt;/p&gt;

&lt;p&gt;Here is a trace of a failing case:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[INFO] Scanning &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; projects...
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] Building main 1.0.0
[INFO] ------------------------------------------------------------------------
[INFO]
[INFO] --- maven-clean-plugin:2.5:clean (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-clean) @ main ---
[INFO] Deleting /Users/tlemeur/git/surefire-junit-tests/target
[INFO]
[INFO] --- maven-resources-plugin:2.6:resources (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-resources) @ main ---
[WARNING] Using platform encoding (US-ASCII actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory /Users/tlemeur/git/surefire-junit-tests/src/main/resources
[INFO]
[INFO] --- maven-compiler-plugin:2.5.1:compile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-compile) @ main ---
[WARNING] File encoding has not been set, using platform encoding US-ASCII, i.e. build is platform dependent!
[INFO] Compiling 1 source file to /Users/tlemeur/git/surefire-junit-tests/target/classes
[INFO]
[INFO] --- maven-resources-plugin:2.6:testResources (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-testResources) @ main ---
[WARNING] Using platform encoding (US-ASCII actually) to copy filtered resources, i.e. build is platform dependent!
[INFO] skip non existing resourceDirectory /Users/tlemeur/git/surefire-junit-tests/src/test/resources
[INFO]
[INFO] --- maven-compiler-plugin:2.5.1:testCompile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-testCompile) @ main ---
[WARNING] File encoding has not been set, using platform encoding US-ASCII, i.e. build is platform dependent!
[INFO] Compiling 4 source files to /Users/tlemeur/git/surefire-junit-tests/target/test-classes
[INFO]
[INFO] --- maven-surefire-plugin:2.21-SNAPSHOT:test (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-test) @ main ---
[WARNING] Missing POM &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; org.apache.maven.surefire:surefire-booter:jar:2.21-SNAPSHOT
[INFO]
[INFO] -------------------------------------------------------
[INFO]  T E S T S
[INFO] -------------------------------------------------------
[INFO] Running com.appnexus.viewability.core.surefireJunitTests.ATest
Start: ATest.methodA1[p0]
End:   ATest.methodA1[p0]
Start: ATest.methodA1[p1]
End:   ATest.methodA1[p1]
Start: ATest.methodA2[p0]
Start: ATest.methodA2[p1]
[ERROR] Tests run: 4, Failures: 2, Errors: 0, Skipped: 0, Time elapsed: 0.112 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in com.appnexus.viewability.core.surefireJunitTests.ATest
[ERROR] methodA1[p0](com.appnexus.viewability.core.surefireJunitTests.ATest)  Time elapsed: 0.112 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: Failing test: ATest.methodA1[p0]
	at com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1(ATest.java:14)

[ERROR] methodA1[p1](com.appnexus.viewability.core.surefireJunitTests.ATest)  Time elapsed: 0.112 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: Failing test: ATest.methodA1[p1]
	at com.appnexus.viewability.core.surefireJunitTests.ATest.methodA1(ATest.java:14)

[INFO] Running com.appnexus.viewability.core.surefireJunitTests.CTest
Start: CTest.methodC1[p0]
End:   CTest.methodC1[p0]
Start: CTest.methodC2[p0]
End:   CTest.methodC2[p0]
Start: CTest.methodC1[p1]
End:   CTest.methodC1[p1]
Start: CTest.methodC2[p1]
End:   CTest.methodC2[p1]
Start: CTest.methodC1[p2]
End:   CTest.methodC1[p2]
Start: CTest.methodC2[p2]
End:   CTest.methodC2[p2]
[INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.524 s - in com.appnexus.viewability.core.surefireJunitTests.CTest
[INFO] Running com.appnexus.viewability.core.surefireJunitTests.BTest
Start: BTest.methodB2[p0]
End:   BTest.methodB2[p0]
Start: BTest.methodB1[p1]
End:   BTest.methodB1[p1]
Start: BTest.methodB1[p0]
End:   BTest.methodB1[p0]
Start: BTest.methodB2[p1]
End:   BTest.methodB2[p1]
Start: BTest.methodB1[p2]
End:   BTest.methodB1[p2]
Start: BTest.methodB2[p2]
End:   BTest.methodB2[p2]
[INFO] Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 2.312 s - in com.appnexus.viewability.core.surefireJunitTests.BTest
[INFO]
[INFO] Results:
[INFO]
[ERROR] Failures:
[ERROR]   ATest.methodA1:14 Failing test: ATest.methodA1[p0]
[ERROR]   ATest.methodA1:14 Failing test: ATest.methodA1[p1]
[INFO]
[ERROR] Tests run: 16, Failures: 2, Errors: 0, Skipped: 0
[INFO]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 4.683 s
[INFO] Finished at: 2017-06-27T15:33:49+02:00
[INFO] Final Memory: 17M/169M
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.21-SNAPSHOT:test (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-test) on project main: There are test failures.
[ERROR]
[ERROR] Please refer to /Users/tlemeur/git/surefire-junit-tests/target/surefire-reports &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the individual test results.
[ERROR] Please refer to dump files (&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; any exist) [date]-jvmRun[N].dump, [date].dumpstream and [date]-jvmRun[N].dumpstream.
[ERROR] -&amp;gt; [Help 1]
[ERROR]
[ERROR] To see the full stack trace of the errors, re-run Maven with the -e &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt;.
[ERROR] Re-run Maven using the -X &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; to enable full debug logging.
[ERROR]
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http:&lt;span class=&quot;code-comment&quot;&gt;//cwiki.apache.org/confluence/display/MAVEN/MojoFailureException&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, the tests started with &quot;ATest&quot; in the trace, in this case, it&apos;s wrong. In your case it did CTest, ATest then BTest (when this order happen for me, it works fine too). The differences between our execution looks to be here.&lt;/p&gt;

&lt;p&gt;For the needs of this demo, I&apos;m not sure how to have the test to run in a given order... I tried &amp;lt;runOrder&amp;gt; but it seems not to impact the actual order.&lt;/p&gt;

&lt;p&gt;I would be happy to spend some time helping you on this, I&apos;m just not really sure how to help. Ideally I&apos;d like to make it 100% of the time reproductible.&lt;/p&gt;</comment>
                            <comment id="16065465" author="tibor17" created="Tue, 27 Jun 2017 21:09:10 +0000"  >&lt;p&gt;My pom.xml&lt;/p&gt;</comment>
                            <comment id="16065477" author="tibor17" created="Tue, 27 Jun 2017 21:14:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tlemeur&quot; class=&quot;user-hover&quot; rel=&quot;tlemeur&quot;&gt;tlemeur&lt;/a&gt;&lt;br/&gt;
I have attached my &lt;tt&gt;pom.xml&lt;/tt&gt;. See the difference.&lt;br/&gt;
Run the command &lt;tt&gt;mvn -o test&lt;/tt&gt; twice. See &lt;tt&gt;runOrder&lt;/tt&gt; in my pom.xml. The first run does not provide &lt;tt&gt;power balanced&lt;/tt&gt; order of tests but the second run and every next one does. So the first run was (CTest, ATest, BTest) but second and the third was (CTest, BTest, ATest). Notice I used Maven 3.5.0 and JDK 8 u132.&lt;/p&gt;</comment>
                            <comment id="16066568" author="tlemeur" created="Wed, 28 Jun 2017 14:22:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibor17&quot; class=&quot;user-hover&quot; rel=&quot;tibor17&quot;&gt;tibor17&lt;/a&gt;:&lt;br/&gt;
Thank you. I updated the git repo accordingly.&lt;/p&gt;

&lt;p&gt;1) I added a class and now I think it&apos;s even harder to have the branch to not show the problem. (99%+ of the time)&lt;br/&gt;
2) I&apos;m using the same versions as you. I reproduce on Mac &amp;amp; Linux (I haven&apos;t tried on Windows).&lt;br/&gt;
3) I tried also &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsmith86&quot; class=&quot;user-hover&quot; rel=&quot;rsmith86&quot;&gt;rsmith86&lt;/a&gt; code, and it shown the problem too sometimes (roughly 5% of the time).&lt;br/&gt;
4) That&apos;s not the problem here, but the run order seems not really reproducible. But maybe it&apos;s only due to the logging order?&lt;br/&gt;
As an example&lt;br/&gt;
using &quot;alphabetical&quot;, I sometimes see CBAD, CABD, CDAB... &amp;lt; I don&apos;t know why it always start with C&lt;br/&gt;
&quot;reversealphabetical&quot;: DCBA, CDBA, &amp;lt; It looks to work as I expect.&lt;br/&gt;
5) This order thing is not the problem, I reproduce it independentely of the order setting. It looked to be dependant only sometimes due to a previous version that had different test durations.&lt;/p&gt;</comment>
                            <comment id="16066618" author="tlemeur" created="Wed, 28 Jun 2017 14:49:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibor17&quot; class=&quot;user-hover&quot; rel=&quot;tibor17&quot;&gt;tibor17&lt;/a&gt;: that&apos;s interesting:&lt;/p&gt;

&lt;p&gt;It looks like my branch work fine with surefire 2.20 (public version) but it does not with 2.21-SNAPSHOT.&lt;br/&gt;
There was a problem before too for sure, but my branch is not showing it.&lt;/p&gt;</comment>
                            <comment id="16071557" author="tibor17" created="Sun, 2 Jul 2017 08:47:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tlemeur&quot; class=&quot;user-hover&quot; rel=&quot;tlemeur&quot;&gt;tlemeur&lt;/a&gt;&lt;br/&gt;
What you changed in the branch? Because now I can reproduce the issue.&lt;br/&gt;
Can you checkout the old commit 5593bf560aa8d8ed900fb146176a39ad5b0e42af of Surefire and test your branch with that?&lt;br/&gt;
If this works then we have to go to HEAD commit by commit and find which one is wrong.&lt;br/&gt;
We should test Rik Smith&apos;s code on every commit of Surefire as well.&lt;br/&gt;
Use offline mode &lt;tt&gt;mvn -o test&lt;/tt&gt; and don&apos;t let your local repository to be overridden by Maven Central.&lt;/p&gt;</comment>
                            <comment id="16071559" author="tibor17" created="Sun, 2 Jul 2017 08:50:06 +0000"  >&lt;p&gt;Install Surefire with command &lt;tt&gt;mvn clean install -DskipTests&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16071564" author="tibor17" created="Sun, 2 Jul 2017 09:13:11 +0000"  >&lt;p&gt;Your old test sources which work with Surefire fix 1264 - commit 5593bf560aa8d8ed900fb146176a39ad5b0e42af&lt;/p&gt;</comment>
                            <comment id="16071566" author="tibor17" created="Sun, 2 Jul 2017 09:17:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tlemeur&quot; class=&quot;user-hover&quot; rel=&quot;tlemeur&quot;&gt;tlemeur&lt;/a&gt;&lt;br/&gt;
Pls see my latest upload of the ZIP and comment in Jira. Your old test code works stable with the fix 5593bf560aa8d8ed900fb146176a39ad5b0e42af.&lt;br/&gt;
It does not work with HEAD of your code. I see you made some changes. Can you explain why these changes make random behavior? Locally I used &lt;tt&gt;ConcurrentLinkedQueue&lt;/tt&gt; instead of &lt;tt&gt;ArrayList&lt;/tt&gt; in your code because of multithreading but this did not make stable test result.&lt;/p&gt;</comment>
                            <comment id="16072218" author="tlemeur" created="Mon, 3 Jul 2017 10:13:14 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibor17&quot; class=&quot;user-hover&quot; rel=&quot;tibor17&quot;&gt;tibor17&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I just did a few changes to highlight the issue, I tried to make the issue more reproducible.&lt;br/&gt;
As I understand the issue lies in the Assert.fail. If a test &quot;fail&quot; then no additional test from this class are started (maybe except if they are already in queue).&lt;br/&gt;
To make it more obvious, I just made all tests to Assert.fail.&lt;br/&gt;
I also added a class (DTest) for the same reason. So both threads (out of 2) can trigger the issue. (Each thread slot will generally handle 2 classes).&lt;br/&gt;
Note also that &amp;lt;parallel&amp;gt;all&amp;lt;/parallel&amp;gt; is key here to reproduce more easily the issue (it also happens with the other configs).&lt;br/&gt;
This statements are just guesses, and are not based on actual facts as I was not really able to understand the underlying code. This is just based on a ton of tries (well of course with some automation &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;

&lt;p&gt;As you suggest, I&apos;ll try the different versions to see the output with each commit.&lt;/p&gt;</comment>
                            <comment id="16072573" author="tlemeur" created="Mon, 3 Jul 2017 14:56:29 +0000"  >&lt;p&gt;I confirm that the &quot;bug&quot; with Assert.fail tests has been introduced in 5593bf560aa8d8ed900fb146176a39ad5b0e42af&lt;br/&gt;
Before, the number of test&lt;/p&gt;

&lt;p&gt;That being said, before, there was already a bug. So to sum up:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Before 5593bf560aa8d8ed900fb146176a39ad5b0e42af:
	&lt;ul&gt;
		&lt;li&gt;passing tests lead to omitted tests as described in the current ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1264&quot; title=&quot;Some tests can be lost when running in parallel with parameterized tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-1264&quot;&gt;&lt;del&gt;SUREFIRE-1264&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
		&lt;li&gt;Assert.fail don&apos;t cause this problem&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;After 5593bf560aa8d8ed900fb146176a39ad5b0e42af:
	&lt;ul&gt;
		&lt;li&gt;Assert.fail tests lead to omitted tests.&lt;/li&gt;
		&lt;li&gt;passing tests work fine and are well counted.&lt;/li&gt;
		&lt;li&gt;Assume.assert have the same problem as Assert.fail tests.@Ignore test work fine.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16125631" author="tibor17" created="Mon, 14 Aug 2017 12:54:32 +0000"  >&lt;p&gt;Additional bug should be fixed.&lt;br/&gt;
That means a situation when parameterized methods fail. See attachments.&lt;/p&gt;</comment>
                            <comment id="16137273" author="tibor17" created="Tue, 22 Aug 2017 19:41:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Prifiz&quot; class=&quot;user-hover&quot; rel=&quot;Prifiz&quot;&gt;Prifiz&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=valyok&quot; class=&quot;user-hover&quot; rel=&quot;valyok&quot;&gt;valyok&lt;/a&gt;&lt;br/&gt;
Did you have time to have a look at this issue?&lt;br/&gt;
If you remember we spoke about it in the chat of &lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1302&quot; title=&quot;Surefire does not wait long enough for the forked VM and assumes it to be dead&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-1302&quot;&gt;&lt;del&gt;SUREFIRE-1302&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16137983" author="prifiz" created="Wed, 23 Aug 2017 06:56:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibor17&quot; class=&quot;user-hover&quot; rel=&quot;tibor17&quot;&gt;tibor17&lt;/a&gt;, unfortunately, I had no time for this during past few days &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16139612" author="tibor17" created="Thu, 24 Aug 2017 06:24:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Prifiz&quot; class=&quot;user-hover&quot; rel=&quot;Prifiz&quot;&gt;Prifiz&lt;/a&gt;&lt;br/&gt;
Definitely the root cause is in &lt;tt&gt;JUnitCoreRunListener&lt;/tt&gt; . After I removed &lt;tt&gt;isParameterizedRunner( testDesc ) ? testDesc.getClassName() :&lt;/tt&gt; your test summary became stable.&lt;br/&gt;
There is an issue &lt;tt&gt;TestClassMethodNameUtils&lt;/tt&gt; with howeve but this is not a root cause. We should fix the statement &lt;tt&gt;return m.matches() ? m.group( 1 ) : null&lt;/tt&gt; to &lt;tt&gt;return m.matches() ? m.group( 1 ) : displayName&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16142679" author="tibor17" created="Sat, 26 Aug 2017 08:14:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Prifiz&quot; class=&quot;user-hover&quot; rel=&quot;Prifiz&quot;&gt;Prifiz&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=valyok&quot; class=&quot;user-hover&quot; rel=&quot;valyok&quot;&gt;valyok&lt;/a&gt;&lt;br/&gt;
I am currently working on &lt;tt&gt;JUnitCoreRunListener&lt;/tt&gt;, the method &lt;tt&gt;fillTestCountMap&lt;/tt&gt;. It fills out a Map with test classes and TestSet but it is not so well written. It should be developed from new beginning and &lt;tt&gt;TestSet#createReportEntry()&lt;/tt&gt; should be changed due to the existence of local variable &lt;tt&gt;isJunit3&lt;/tt&gt; and then I hope this issue will be fixed.&lt;/p&gt;</comment>
                            <comment id="16144246" author="tibor17" created="Mon, 28 Aug 2017 19:44:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Prifiz&quot; class=&quot;user-hover&quot; rel=&quot;Prifiz&quot;&gt;Prifiz&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=valyok&quot; class=&quot;user-hover&quot; rel=&quot;valyok&quot;&gt;valyok&lt;/a&gt;&lt;br/&gt;
I have pushed a branch &lt;tt&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1264&quot; title=&quot;Some tests can be lost when running in parallel with parameterized tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-1264&quot;&gt;&lt;del&gt;SUREFIRE-1264&lt;/del&gt;&lt;/a&gt;_2&lt;/tt&gt; with a fix.&lt;br/&gt;
Can you please build the project on your side and use the version &lt;tt&gt;2.21-SNAPSHOT&lt;/tt&gt; in your project and give me a feedback with your test result.&lt;br/&gt;
Please build Surefire project like this:&lt;br/&gt;
&lt;tt&gt;mvn install -DskipTests&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="16144406" author="tibor17" created="Mon, 28 Aug 2017 21:50:13 +0000"  >&lt;p&gt;Flaky tests fail in the build which must be fixed.&lt;/p&gt;</comment>
                            <comment id="16145982" author="tibor17" created="Tue, 29 Aug 2017 19:44:07 +0000"  >&lt;p&gt;CI passed all tests successfully:&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/maven-surefire-pipeline/job/SUREFIRE-1264_2/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/maven-surefire-pipeline/job/SUREFIRE-1264_2/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16146830" author="prifiz" created="Wed, 30 Aug 2017 07:48:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibor17&quot; class=&quot;user-hover&quot; rel=&quot;tibor17&quot;&gt;tibor17&lt;/a&gt;, sorry can&apos;t help with this issue right now. There&apos;re lots of another unexpected activities.&lt;/p&gt;</comment>
                            <comment id="16147390" author="tibor17" created="Wed, 30 Aug 2017 15:03:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Prifiz&quot; class=&quot;user-hover&quot; rel=&quot;Prifiz&quot;&gt;Prifiz&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=valyok&quot; class=&quot;user-hover&quot; rel=&quot;valyok&quot;&gt;valyok&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jderrien&quot; class=&quot;user-hover&quot; rel=&quot;jderrien&quot;&gt;jderrien&lt;/a&gt;&lt;br/&gt;
I fixed this issue. If you do not want to wait for the official release (cca 2 weeks) feel free to build and install it from master branch and use SNAPSHOT version.&lt;br/&gt;
&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=c8724dd2f992625c355e4817a6b7995d3e88fdb4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=c8724dd2f992625c355e4817a6b7995d3e88fdb4&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16160555" author="hudson" created="Mon, 11 Sep 2017 02:11:24 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build maven-surefire #1757 (See &lt;a href=&quot;https://builds.apache.org/job/maven-surefire/1757/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/maven-surefire/1757/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1264&quot; title=&quot;Some tests can be lost when running in parallel with parameterized tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-1264&quot;&gt;&lt;del&gt;SUREFIRE-1264&lt;/del&gt;&lt;/a&gt; Some tests can be lost when running in parallel with (tibor17: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/?p=maven-surefire.git&amp;amp;a=commit&amp;amp;h=c8724dd2f992625c355e4817a6b7995d3e88fdb4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/?p=maven-surefire.git&amp;amp;a=commit&amp;amp;h=c8724dd2f992625c355e4817a6b7995d3e88fdb4&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/java/org/apache/maven/surefire/its/jiras/Surefire1264IT.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/common-junit4/src/main/java/org/apache/maven/surefire/junit4/MockReporter.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/surefire-junit47/src/main/java/org/apache/maven/surefire/junitcore/JUnitCoreRunListener.java&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-1264/src/test/java/com/appnexus/viewability/core/surefireJunitTests/ATest.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/surefire-junit47/src/main/java/org/apache/maven/surefire/junitcore/TestSet.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/surefire-junit47/src/main/java/org/apache/maven/surefire/junitcore/ConcurrentRunListener.java&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-1264/pom.xml&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-1264/src/test/java/com/appnexus/viewability/core/surefireJunitTests/CTest.java&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-1264/src/test/java/com/appnexus/viewability/core/surefireJunitTests/DTest.java&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-1264/src/test/java/com/appnexus/viewability/core/surefireJunitTests/BaseTest.java&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-1264/src/test/java/com/appnexus/viewability/core/surefireJunitTests/BTest.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/surefire-junit47/src/test/java/org/apache/maven/surefire/junitcore/JUnitCoreRunListenerTest.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-api/src/main/java/org/apache/maven/surefire/util/internal/TestClassMethodNameUtils.java&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-621-testCounting-junit3-in-parallel/src/it/java/mho/JUnit4AdapterSuiteTest.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-integration-tests/src/test/java/org/apache/maven/surefire/its/jiras/Surefire621TestCountingJunit3InParallelIT.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/surefire-junit47/src/test/java/org/apache/maven/surefire/junitcore/TestMethodTest.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/common-junit4/src/main/java/org/apache/maven/surefire/common/junit4/JUnit4RunListener.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-integration-tests/src/test/resources/surefire-621-testCounting-junit3-in-parallel/pom.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16171544" author="christian.beikov" created="Tue, 19 Sep 2017 11:28:32 +0000"  >&lt;p&gt;I am trying to build Apache Calcite on Travis CI with a parallel configuration and am consistently running into a hang. I tried various versions of the Surefire plugin(1.18, 1.18.1, 1.19.1, 1.20.1) and all seem to have the same problem. I did a thread dump after a timeout, but I am not sure what the problem is. It seems to be related to this issue. For testing purposes I disabled every test but the seemingly problematic parameterized test and in fact, it hangs consistently: &lt;a href=&quot;https://travis-ci.org/beikov/calcite/builds/277258873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/beikov/calcite/builds/277258873&lt;/a&gt;&lt;br/&gt;
Without the parallel configuration or when running with a single CPU, the problem doesn&apos;t seem to happen.&lt;/p&gt;

&lt;p&gt;You can run this on a custom VM too. I configured a VirtualBox VM with 2 CPUs and 4GB RAM and ran the following commands to execute this locally&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;docker run --name travis-debug -dit travisci/ci-garnet:packer-1503972846 /sbin/init
docker exec -it travis-debug bash -l
su - travis
git clone --branch=travis-test https:&lt;span class=&quot;code-comment&quot;&gt;//github.com/beikov/calcite.git
&lt;/span&gt;cd calcite
mvn -Dsurefire.useFile=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; -Dcheckstyle.skip=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The exact configuration is&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;threadCount&amp;gt;1&amp;lt;/threadCount&amp;gt;
&amp;lt;perCoreThreadCount&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/perCoreThreadCount&amp;gt;
&amp;lt;parallel&amp;gt;both&amp;lt;/parallel&amp;gt;
&amp;lt;forkMode&amp;gt;once&amp;lt;/forkMode&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here the stack traces..&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;pool-1-thread-2&quot;&lt;/span&gt; #13 daemon prio=5 os_prio=0 tid=0x00007f0694ff1000 nid=0xc97 waiting on condition [0x00007f067c934000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x0000000080082c78&amp;gt; (a java.util.concurrent.Semaphore$FairSync)
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:997)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1304)
	at java.util.concurrent.Semaphore.acquire(Semaphore.java:312)
	at org.apache.maven.surefire.junitcore.pc.ThreadResourcesBalancer.acquirePermit(ThreadResourcesBalancer.java:76)
	at org.apache.maven.surefire.junitcore.pc.Scheduler.schedule(Scheduler.java:363)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.junit.runners.Suite.runChild(Suite.java:128)
	at org.junit.runners.Suite.runChild(Suite.java:27)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.apache.maven.surefire.junitcore.pc.Scheduler$1.run(Scheduler.java:410)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;span class=&quot;code-quote&quot;&gt;&quot;pool-1-thread-1&quot;&lt;/span&gt; #12 daemon prio=5 os_prio=0 tid=0x00007f0694fef800 nid=0xc96 waiting on condition [0x00007f067ca36000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x0000000080702e60&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039)
	at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442)
	at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)

&lt;span class=&quot;code-quote&quot;&gt;&quot;process reaper&quot;&lt;/span&gt; #10 daemon prio=10 os_prio=0 tid=0x00007f06946c9800 nid=0xc94 waiting on condition [0x00007f067ce6f000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x000000008064cb98&amp;gt; (a java.util.concurrent.SynchronousQueue$TransferStack)
	at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
	at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
	at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
	at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
	at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;span class=&quot;code-quote&quot;&gt;&quot;ping-30s&quot;&lt;/span&gt; #9 daemon prio=5 os_prio=0 tid=0x00007f0694348000 nid=0xc92 waiting on condition [0x00007f067d055000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x00000000805de2e8&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
	at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
	at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1093)
	at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:809)
	at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;span class=&quot;code-quote&quot;&gt;&quot;surefire-forkedjvm-command-thread&quot;&lt;/span&gt; #8 daemon prio=5 os_prio=0 tid=0x00007f0694338800 nid=0xc91 runnable [0x00007f067d35f000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
	at java.io.FileInputStream.readBytes(Native Method)
	at java.io.FileInputStream.read(FileInputStream.java:255)
	at java.io.BufferedInputStream.fill(BufferedInputStream.java:246)
	at java.io.BufferedInputStream.read(BufferedInputStream.java:265)
	- locked &amp;lt;0x000000008064ee88&amp;gt; (a java.io.BufferedInputStream)
	at java.io.DataInputStream.readInt(DataInputStream.java:387)
	at org.apache.maven.surefire.booter.MasterProcessCommand.decode(MasterProcessCommand.java:115)
	at org.apache.maven.surefire.booter.CommandReader$CommandRunnable.run(CommandReader.java:391)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;span class=&quot;code-quote&quot;&gt;&quot;Service &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;&quot;&lt;/span&gt; #7 daemon prio=9 os_prio=0 tid=0x00007f0694146800 nid=0xc8f runnable [0x0000000000000000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
&lt;span class=&quot;code-quote&quot;&gt;&quot;C1 CompilerThread1&quot;&lt;/span&gt; #6 daemon prio=9 os_prio=0 tid=0x00007f0694144000 nid=0xc8e waiting on condition [0x0000000000000000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
&lt;span class=&quot;code-quote&quot;&gt;&quot;C2 CompilerThread0&quot;&lt;/span&gt; #5 daemon prio=9 os_prio=0 tid=0x00007f0694141000 nid=0xc8d waiting on condition [0x0000000000000000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
&lt;span class=&quot;code-quote&quot;&gt;&quot;Signal Dispatcher&quot;&lt;/span&gt; #4 daemon prio=9 os_prio=0 tid=0x00007f069413f800 nid=0xc8c runnable [0x0000000000000000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
&lt;span class=&quot;code-quote&quot;&gt;&quot;Finalizer&quot;&lt;/span&gt; #3 daemon prio=8 os_prio=0 tid=0x00007f0694107000 nid=0xc8b in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x00007f067e57a000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (on object monitor)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)
	- locked &amp;lt;0x000000008064f980&amp;gt; (a java.lang.ref.ReferenceQueue$Lock)
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)
	at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)
&lt;span class=&quot;code-quote&quot;&gt;&quot;Reference Handler&quot;&lt;/span&gt; #2 daemon prio=10 os_prio=0 tid=0x00007f0694102800 nid=0xc8a in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x00007f067e67b000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (on object monitor)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:502)
	at java.lang.ref.Reference.tryHandlePending(Reference.java:191)
	- locked &amp;lt;0x000000008064fbb0&amp;gt; (a java.lang.ref.Reference$Lock)
	at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)
&lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; #1 prio=5 os_prio=0 tid=0x00007f069400a000 nid=0xc85 waiting on condition [0x00007f069ab0b000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x0000000080082c78&amp;gt; (a java.util.concurrent.Semaphore$FairSync)
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:997)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1304)
	at java.util.concurrent.Semaphore.acquire(Semaphore.java:312)
	at org.apache.maven.surefire.junitcore.pc.ThreadResourcesBalancer.acquirePermit(ThreadResourcesBalancer.java:76)
	at org.apache.maven.surefire.junitcore.pc.Scheduler.schedule(Scheduler.java:363)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.junit.runners.Suite.runChild(Suite.java:128)
	at org.junit.runners.Suite.runChild(Suite.java:27)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.apache.maven.surefire.junitcore.pc.Scheduler$1.run(Scheduler.java:410)
	at org.apache.maven.surefire.junitcore.pc.InvokerStrategy.schedule(InvokerStrategy.java:54)
	at org.apache.maven.surefire.junitcore.pc.Scheduler.schedule(Scheduler.java:367)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.junit.runners.Suite.runChild(Suite.java:128)
	at org.junit.runners.Suite.runChild(Suite.java:27)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.apache.maven.surefire.junitcore.pc.Scheduler$1.run(Scheduler.java:410)
	at org.apache.maven.surefire.junitcore.pc.InvokerStrategy.schedule(InvokerStrategy.java:54)
	at org.apache.maven.surefire.junitcore.pc.Scheduler.schedule(Scheduler.java:367)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junitcore.pc.ParallelComputerBuilder$PC$1.run(ParallelComputerBuilder.java:593)
	at org.apache.maven.surefire.junitcore.JUnitCore.run(JUnitCore.java:55)
	at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.createRequestAndRun(JUnitCoreWrapper.java:137)
	at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.executeEager(JUnitCoreWrapper.java:107)
	at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.execute(JUnitCoreWrapper.java:83)
	at org.apache.maven.surefire.junitcore.JUnitCoreWrapper.execute(JUnitCoreWrapper.java:75)
	at org.apache.maven.surefire.junitcore.JUnitCoreProvider.invoke(JUnitCoreProvider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:373)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:334)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:119)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:407)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16172109" author="tibor17" created="Tue, 19 Sep 2017 18:10:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cbeikov&quot; class=&quot;user-hover&quot; rel=&quot;cbeikov&quot;&gt;cbeikov&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christian.beikov&quot; class=&quot;user-hover&quot; rel=&quot;christian.beikov&quot;&gt;christian.beikov&lt;/a&gt;&lt;br/&gt;
I do not have this problem on Windows but my tests failed:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&amp;gt; java.lang.AssertionError: Correlation variable $cor0 should be defined&lt;br/&gt;
&amp;gt;       at org.apache.calcite.adapter.enumerable.EnumerableRelImplementor.getCorrelVariableGetter(EnumerableRelImplementor.java:480)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;and this is build summary:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite ........................................... SUCCESS [  6.433 s]&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Linq4j .................................... SUCCESS [ 13.526 s]&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Core ...................................... FAILURE &lt;span class=&quot;error&quot;&gt;&amp;#91;01:31 min&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Cassandra ................................. SKIPPED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Druid ..................................... SKIPPED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Elasticsearch ............................. SKIPPED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Examples .................................. SKIPPED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Example CSV ............................... SKIPPED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Example Function .......................... SKIPPED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite File ...................................... SKIPPED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite MongoDB ................................... SKIPPED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Pig ....................................... SKIPPED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Piglet .................................... SKIPPED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Plus ...................................... SKIPPED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Spark ..................................... SKIPPED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Splunk .................................... SKIPPED&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Calcite Ubenchmark ................................ SKIPPED&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I have a suspicion in commit &lt;tt&gt;67c06d5876dcabc037de9b5f4cc226beeedcb379&lt;/tt&gt; because this touched &lt;tt&gt;ParallelComputerBuilder&lt;/tt&gt; and you run parallel tests.&lt;br/&gt;
Can you please make an experiment?&lt;br/&gt;
I think now only you can do it.&lt;br/&gt;
Please clone project &lt;tt&gt;&lt;a href=&quot;https://github.com/apache/maven-surefire/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/&lt;/a&gt;&lt;/tt&gt; from master and revert only changes in class &lt;tt&gt;ParallelComputerBuilder.java&lt;/tt&gt;. This means the line 432 is &lt;tt&gt;runs.add( runner );&lt;/tt&gt; and you should call it in IF like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( children != 0 )
    {
        runs.add( runner );
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Save this change and install Surefire project without running tests: &lt;tt&gt;mvn -DskipTests install&lt;/tt&gt;.&lt;br/&gt;
Now edit POMs in your project and use another version of Surefire &lt;tt&gt;2.21.0-SNAPSHOT&lt;/tt&gt;.&lt;br/&gt;
Run you project with &lt;tt&gt;no-snapshot-updates&lt;/tt&gt; like this &lt;tt&gt;mvn -nsu -Dsurefire.useFile=false -Dcheckstyle.skip=true test&lt;/tt&gt;.&lt;br/&gt;
If the same problem was reproducible before without having Docker, you can easily run it on your local machine without Docker. Maybe this would be easier. What happens with the test after this?&lt;/p&gt;</comment>
                            <comment id="16172855" author="christian.beikov" created="Wed, 20 Sep 2017 07:35:13 +0000"  >&lt;p&gt;Still hanging: &lt;a href=&quot;https://travis-ci.org/beikov/calcite/builds/277637640&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/beikov/calcite/builds/277637640&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I haven&apos;t had the problem on Windows either, just in the Docker container so far, but I assume this might be a general problem on linux, though I can&apos;t say for sure.&lt;/p&gt;</comment>
                            <comment id="16172871" author="tibor17" created="Wed, 20 Sep 2017 07:51:00 +0000"  >&lt;p&gt;Did you try out Surefire 2.18 and 2.18.1?&lt;br/&gt;
What is the result?&lt;br/&gt;
Can you try again please?&lt;br/&gt;
I am facing a difference in code between 2.18 and 2.19.&lt;/p&gt;

&lt;p&gt;On Wed, Sep 20, 2017 at 9:36 AM, Christian Beikov (JIRA) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="16172879" author="christian.beikov" created="Wed, 20 Sep 2017 08:02:43 +0000"  >&lt;p&gt;I did, but here it&apos;s again.&lt;/p&gt;

&lt;p&gt;2.18: &lt;a href=&quot;https://travis-ci.org/beikov/calcite/builds/277648098&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/beikov/calcite/builds/277648098&lt;/a&gt;&lt;br/&gt;
2.18.1: &lt;a href=&quot;https://travis-ci.org/beikov/calcite/builds/277650952&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/beikov/calcite/builds/277650952&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16173764" author="tibor17" created="Wed, 20 Sep 2017 20:17:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cbeikov&quot; class=&quot;user-hover&quot; rel=&quot;cbeikov&quot;&gt;cbeikov&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christian.beikov&quot; class=&quot;user-hover&quot; rel=&quot;christian.beikov&quot;&gt;christian.beikov&lt;/a&gt;&lt;br/&gt;
Was Surefire timed out by Travis in the project &lt;tt&gt;calcite-core&lt;/tt&gt;?&lt;br/&gt;
I think the native stream STDOUT was corrupted by printing JVM and GC messages, see &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - how did you print it?.&lt;br/&gt;
Please remove all switches like &lt;tt&gt;-Xlint&lt;/tt&gt;, &lt;tt&gt;-XX&lt;/tt&gt;, &lt;tt&gt;-verbose:&lt;/tt&gt;, etc. if you are printing some jvm logs by jvm to the console.&lt;br/&gt;
Give it a try and let me know then.&lt;br/&gt;
Do you use &lt;tt&gt;FileDescriptor.out&lt;/tt&gt; from Java NIO or some native library printing to std/out and std/err, or &lt;tt&gt;System.exit()&lt;/tt&gt; or &lt;tt&gt;Runtime.halt()&lt;/tt&gt; or ShutdownHook ?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: Java HotSpot(TM) 64-Bit Server VM warning: ignoring option MaxPermSize=256m; support was removed in 8.0&lt;br/&gt;
Picked up _JAVA_OPTIONS: -Xmx2048m -Xms512m&lt;/p&gt;</comment>
                            <comment id="16173768" author="tibor17" created="Wed, 20 Sep 2017 20:18:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cbeikov&quot; class=&quot;user-hover&quot; rel=&quot;cbeikov&quot;&gt;cbeikov&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christian.beikov&quot; class=&quot;user-hover&quot; rel=&quot;christian.beikov&quot;&gt;christian.beikov&lt;/a&gt;&lt;br/&gt;
Do you use SecurityManager?&lt;/p&gt;</comment>
                            <comment id="16174433" author="christian.beikov" created="Thu, 21 Sep 2017 08:26:22 +0000"  >&lt;p&gt;No security manager or any special flags AFAICT. The message is printed because of a perm size option that is replaced with metaspace in Java 8. I got rid of all output you mentioned but it still hangs: &lt;a href=&quot;https://travis-ci.org/beikov/calcite/builds/278083407&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/beikov/calcite/builds/278083407&lt;/a&gt;&lt;br/&gt;
Travis CI kills builds that don&apos;t print anything within 10 minutes, but this testcase should run through, so it indeed still hangs.&lt;br/&gt;
No uses of the mentioned APIs as far as I can see in the code.&lt;/p&gt;

&lt;p&gt;I don&apos;t understand why this would only be a problem on Linux. Maybe it&apos;s a concurrency issue?&lt;/p&gt;</comment>
                            <comment id="16175227" author="tibor17" created="Thu, 21 Sep 2017 18:15:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cbeikov&quot; class=&quot;user-hover&quot; rel=&quot;cbeikov&quot;&gt;cbeikov&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christian.beikov&quot; class=&quot;user-hover&quot; rel=&quot;christian.beikov&quot;&gt;christian.beikov&lt;/a&gt;&lt;br/&gt;
Why the project &lt;tt&gt;calcite-linq4j&lt;/tt&gt; did not hang and &lt;tt&gt;calcite-core&lt;/tt&gt; did?&lt;br/&gt;
Can you make several experiments and exclude some influences, like e.g. parallelism in Surefire, and then tests so use empty suite &lt;tt&gt;CalciteSuite&lt;/tt&gt;, then write Test class with one but empty test method and use only that one in &lt;tt&gt;CalciteSuite&lt;/tt&gt;, and then always divide the range of tests in &lt;tt&gt;CalciteSuite&lt;/tt&gt; by two and logarithmically iterate to few tests which are related to our issue.&lt;/p&gt;</comment>
                            <comment id="16175279" author="tibor17" created="Thu, 21 Sep 2017 18:53:18 +0000"  >&lt;p&gt;We have experiences on FreeBSD when forked JVM hanged but did not start any test because there was no free space on the disk. Could it be here on Docker?&lt;br/&gt;
Would you run the build on your PC with Linux but without Docker?&lt;/p&gt;</comment>
                            <comment id="16176101" author="christian.beikov" created="Fri, 22 Sep 2017 08:17:41 +0000"  >&lt;p&gt;The problem definitely is the fact that I am executing a Parameterized test with parallelism enabled in surefire. I disabled all other tests of the suite already, so there shouldn&apos;t be any other side effects. The calcite-linq4j has only normal tests, no parameterized tests. It&apos;s not a disk space problem, the build runs through without parallelism as you can see here: &lt;a href=&quot;https://travis-ci.org/beikov/calcite/builds/278513374&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/beikov/calcite/builds/278513374&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The problem appears only in this combination AFAICT: Docker with 2 CPUs, Parameterized test and surefire with parallelism enabled&lt;br/&gt;
Here is even a minimal test case(&lt;a href=&quot;https://github.com/beikov/surefire-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/beikov/surefire-test&lt;/a&gt;) that shows the problem: &lt;a href=&quot;https://travis-ci.org/beikov/surefire-test/builds/278521316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/beikov/surefire-test/builds/278521316&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I suspect this might be a general Linux problem as the build works fine on Windows. Hope this helps you to find the issue.&lt;/p&gt;</comment>
                            <comment id="16176688" author="tibor17" created="Fri, 22 Sep 2017 16:40:00 +0000"  >&lt;p&gt;I do not have docker but I will check it our on Fedora and Ubuntu.&lt;br/&gt;
Did you have the same problem on ordinal Linux not running under Docker?&lt;br/&gt;
Does it have to do something with MMU in CPU due to Linux Virtualization of&lt;br/&gt;
Kernel?&lt;/p&gt;

&lt;p&gt;On Fri, Sep 22, 2017 at 10:18 AM, Christian Beikov (JIRA) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="16176810" author="tibor17" created="Fri, 22 Sep 2017 17:53:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cbeikov&quot; class=&quot;user-hover&quot; rel=&quot;cbeikov&quot;&gt;cbeikov&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christian.beikov&quot; class=&quot;user-hover&quot; rel=&quot;christian.beikov&quot;&gt;christian.beikov&lt;/a&gt;&lt;br/&gt;
I will have time on Sunday evening but meanwhile I found articles related to Docker, MMU and minimum installation.&lt;br/&gt;
Has this build ever run on Ubuntu or another non-virtualized Linux without Docker?&lt;br/&gt;
&lt;a href=&quot;https://www.sitepoint.com/docker-containers-software-delivery/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.sitepoint.com/docker-containers-software-delivery/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://blog.codeship.com/docker-for-windows-linux-and-mac/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://blog.codeship.com/docker-for-windows-linux-and-mac/&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="16180512" author="christian.beikov" created="Tue, 26 Sep 2017 09:07:03 +0000"  >&lt;p&gt;I haven&apos;t tried on a non-virtualized Linux machine myself yet and I don&apos;t know if the problems might be because of virtualization, but I just tried to run on Travis CI with sudo enabled i.e. on a directly virtualized Linux without Docker and it is stuck again: &lt;a href=&quot;https://travis-ci.org/beikov/surefire-test/builds/279870000&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/beikov/surefire-test/builds/279870000&lt;/a&gt;&lt;br/&gt;
I don&apos;t have a non-virtualized Linux handy, but I am not sure why that would matter. Have you been able to test on Fedora or Ubuntu yet?&lt;/p&gt;</comment>
                            <comment id="16180639" author="tibor17" created="Tue, 26 Sep 2017 11:46:00 +0000"  >&lt;p&gt;I did not have time yet. Please check it out on real Linux first.&lt;/p&gt;

&lt;p&gt;On Tue, Sep 26, 2017 at 11:08 AM, Christian Beikov (JIRA) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="16180668" author="christian.beikov" created="Tue, 26 Sep 2017 12:18:38 +0000"  >&lt;p&gt;I just tried on a VMware virtualized RHEL and had the same problem. Starting to think this might be a general problem on Linux.&lt;br/&gt;
I don&apos;t have access to a Linux installed on bare-metal, but who would run a build on a bare-metal installed OS anyway? Isn&apos;t everything virtualized?&lt;br/&gt;
The surefire-test project perfectly reproduces the issue, so you should be able to dig into the real problem when you have time.&lt;/p&gt;</comment>
                            <comment id="16192759" author="tibor17" created="Thu, 5 Oct 2017 11:31:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cbeikov&quot; class=&quot;user-hover&quot; rel=&quot;cbeikov&quot;&gt;cbeikov&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christian.beikov&quot; class=&quot;user-hover&quot; rel=&quot;christian.beikov&quot;&gt;christian.beikov&lt;/a&gt;&lt;br/&gt;
Maybe we have talked about it but I would ask again. &lt;br/&gt;
Do you have a Thread Dump when Surefire 2.18 hanged in project &lt;tt&gt;calcite-core&lt;/tt&gt;? &lt;br/&gt;
Can you attach it?&lt;br/&gt;
Please use version 2.18 and not 2.18.1.&lt;br/&gt;
The old version definitely did not have new threading mechanism when Maven sent tests to run to Surefire process via native process pipes.&lt;br/&gt;
It looks to me like the test class name was swallowed somewhere.&lt;br/&gt;
Are you open for building some Surefire branch by yourselves and perform some experiments on your side?&lt;br/&gt;
Perhaps it would be nice dumping this cross-process communication when debugging Maven build like this &lt;tt&gt;mvn -X test&lt;/tt&gt; or &lt;tt&gt;mvn --debug test&lt;/tt&gt;.&lt;br/&gt;
Thx.&lt;/p&gt;</comment>
                            <comment id="16193052" author="tibor17" created="Thu, 5 Oct 2017 15:33:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cbeikov&quot; class=&quot;user-hover&quot; rel=&quot;cbeikov&quot;&gt;cbeikov&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christian.beikov&quot; class=&quot;user-hover&quot; rel=&quot;christian.beikov&quot;&gt;christian.beikov&lt;/a&gt;&lt;br/&gt;
I guess you are using this configuration:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;lt;threadCount&amp;gt;1&amp;lt;/threadCount&amp;gt;&lt;br/&gt;
&amp;lt;perCoreThreadCount&amp;gt;true&amp;lt;/perCoreThreadCount&amp;gt;&lt;br/&gt;
&amp;lt;parallel&amp;gt;both&amp;lt;/parallel&amp;gt;&lt;br/&gt;
&amp;lt;forkMode&amp;gt;once&amp;lt;/forkMode&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Try to change it to this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;lt;threadCountClasses&amp;gt;2&amp;lt;/threadCountClasses&amp;gt;&lt;br/&gt;
&amp;lt;threadCountMethods&amp;gt;4&amp;lt;/threadCountMethods&amp;gt;&lt;br/&gt;
&amp;lt;perCoreThreadCount&amp;gt;false&amp;lt;/perCoreThreadCount&amp;gt;&lt;br/&gt;
&amp;lt;parallel&amp;gt;classesAndMethods&amp;lt;/parallel&amp;gt;&lt;br/&gt;
&amp;lt;forkMode&amp;gt;once&amp;lt;/forkMode&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I changed 4 parameters. Two classes run in parallel and 4 methods.&lt;br/&gt;
Let me know when Travis CI has finished.&lt;br/&gt;
I need to know if I should investigate parallel computer issue.&lt;br/&gt;
Thx.&lt;/p&gt;</comment>
                            <comment id="16193407" author="tibor17" created="Thu, 5 Oct 2017 18:38:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cbeikov&quot; class=&quot;user-hover&quot; rel=&quot;cbeikov&quot;&gt;cbeikov&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christian.beikov&quot; class=&quot;user-hover&quot; rel=&quot;christian.beikov&quot;&gt;christian.beikov&lt;/a&gt;&lt;br/&gt;
I am able to reproduce this issue on real box, Ubuntu 17.&lt;br/&gt;
I have investigated this issue a little bit.&lt;br/&gt;
It really looks like Surefire issue, but I cannot confirm unless isolated test reproduces the issue with minimum dependencies. The fact is that there is JUnit suite &lt;tt&gt;CalciteSuite.java&lt;/tt&gt; has &lt;tt&gt;QuidemTest.java&lt;/tt&gt; which is &lt;tt&gt;@Parameterized&lt;/tt&gt; JUnit test and the filter is specified &lt;tt&gt;&amp;lt;include&amp;gt;org/apache/calcite/test/CalciteSuite.java&amp;lt;/include&amp;gt;&lt;/tt&gt;.&lt;br/&gt;
It really does not matter how many Threads you allocate.&lt;br/&gt;
Would you isolate it in a separate project in your account on GitHub? I want to know if the single threaded Jdbc is the issue or dependencies. Let&apos;s avoid them.&lt;/p&gt;</comment>
                            <comment id="16193415" author="christian.beikov" created="Thu, 5 Oct 2017 18:44:42 +0000"  >&lt;p&gt;Here is a minimal test: &lt;a href=&quot;https://github.com/beikov/surefire-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/beikov/surefire-test&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16193503" author="tibor17" created="Thu, 5 Oct 2017 19:27:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christian.beikov&quot; class=&quot;user-hover&quot; rel=&quot;christian.beikov&quot;&gt;christian.beikov&lt;/a&gt;&lt;br/&gt;
I have reproduced the issue with minimum test on real box.&lt;br/&gt;
Can you please report a Jira issue related to platform Linux/Ubuntu with external link pointing to github?&lt;br/&gt;
Current issue is about different root cause.&lt;/p&gt;</comment>
                            <comment id="16193571" author="christian.beikov" created="Thu, 5 Oct 2017 20:15:53 +0000"  >&lt;p&gt;Here it is: &lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1430&quot; title=&quot;Parallel parameterized JUnit test hangs on Linux&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-1430&quot;&gt;SUREFIRE-1430&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16325240" author="hudson" created="Sat, 13 Jan 2018 17:46:00 +0000"  >&lt;p&gt;ABORTED: Integrated in Jenkins build maven-surefire-dev #103 (See &lt;a href=&quot;https://builds.apache.org/job/maven-surefire-dev/103/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/maven-surefire-dev/103/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1264&quot; title=&quot;Some tests can be lost when running in parallel with parameterized tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-1264&quot;&gt;&lt;del&gt;SUREFIRE-1264&lt;/del&gt;&lt;/a&gt; Some tests can be lost when running in parallel with (tibor17: &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/?p=maven-surefire.git&amp;amp;a=commit&amp;amp;h=c8724dd2f992625c355e4817a6b7995d3e88fdb4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/?p=maven-surefire.git&amp;amp;a=commit&amp;amp;h=c8724dd2f992625c355e4817a6b7995d3e88fdb4&lt;/a&gt;)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-1264/src/test/java/com/appnexus/viewability/core/surefireJunitTests/ATest.java&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-1264/src/test/java/com/appnexus/viewability/core/surefireJunitTests/BaseTest.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/surefire-junit47/src/main/java/org/apache/maven/surefire/junitcore/TestSet.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-integration-tests/src/test/resources/surefire-621-testCounting-junit3-in-parallel/pom.xml&lt;/li&gt;
	&lt;li&gt;(edit) surefire-api/src/main/java/org/apache/maven/surefire/util/internal/TestClassMethodNameUtils.java&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-1264/src/test/java/com/appnexus/viewability/core/surefireJunitTests/CTest.java&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-621-testCounting-junit3-in-parallel/src/it/java/mho/JUnit4AdapterSuiteTest.java&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-1264/src/test/java/com/appnexus/viewability/core/surefireJunitTests/BTest.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/surefire-junit47/src/test/java/org/apache/maven/surefire/junitcore/TestMethodTest.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/common-junit4/src/main/java/org/apache/maven/surefire/junit4/MockReporter.java&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-1264/src/test/java/com/appnexus/viewability/core/surefireJunitTests/DTest.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/common-junit4/src/main/java/org/apache/maven/surefire/common/junit4/JUnit4RunListener.java&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/resources/surefire-1264/pom.xml&lt;/li&gt;
	&lt;li&gt;(add) surefire-integration-tests/src/test/java/org/apache/maven/surefire/its/jiras/Surefire1264IT.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/surefire-junit47/src/main/java/org/apache/maven/surefire/junitcore/ConcurrentRunListener.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/surefire-junit47/src/main/java/org/apache/maven/surefire/junitcore/JUnitCoreRunListener.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-providers/surefire-junit47/src/test/java/org/apache/maven/surefire/junitcore/JUnitCoreRunListenerTest.java&lt;/li&gt;
	&lt;li&gt;(edit) surefire-integration-tests/src/test/java/org/apache/maven/surefire/its/jiras/Surefire621TestCountingJunit3InParallelIT.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17994659" author="olamy" created="Fri, 4 Jul 2025 07:25:59 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-surefire/issues/2421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-surefire#2421&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12992925">SUREFIRE-1263</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12983746">SUREFIRE-1259</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12875402" name="failure-2.21-snapshot-SUREFIRE-1264.zip" size="61924" author="tibordigana" created="Sun, 2 Jul 2017 09:12:22 +0000"/>
                            <attachment id="12874747" name="pom.xml" size="1388" author="tibordigana" created="Tue, 27 Jun 2017 21:08:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31kl3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>