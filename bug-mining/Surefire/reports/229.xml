<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:09:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SUREFIRE-704] maven surefire Error while executing forked tests.; nested exception is java.lang.IllegalStateException: testSetStarting called twice</title>
                <link>https://issues.apache.org/jira/browse/SUREFIRE-704</link>
                <project id="12317927" key="SUREFIRE">Maven Surefire (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;We want to upgrade from our current 2.5 version of the maven-surefire-plugin to something newer but cannot get past the error below. We&apos;ve tried versions 2.6, 2.7 up to and including 2.7.3-SNAPSHOT but they all fail.&lt;/p&gt;

&lt;p&gt;When setting forkmode to &quot;once&quot; and redirectTestOutputToFile to &quot;true&quot;, we get the following error on multiple tests:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.7.3-SNAPSHOT:test (default-test) on project api: Error while executing forked tests.; nested exception is java.lang.IllegalStateException: testSetStarting called twice -&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Help 1&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Please see the attachment for full &quot;mvn -e test&quot; output.&lt;/p&gt;

&lt;p&gt;If we set the redirectTestOutputToFile to false, it works but we need this option set to true.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</description>
                <environment>Windows/Linux/SunOS</environment>
        <key id="12809676">SUREFIRE-704</key>
            <summary>maven surefire Error while executing forked tests.; nested exception is java.lang.IllegalStateException: testSetStarting called twice</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="krosenvold">Kristian Rosenvold</assignee>
                                    <reporter username="daigles4">S Daigle</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Feb 2011 18:25:19 +0000</created>
                <updated>Fri, 4 Jul 2025 07:15:32 +0000</updated>
                            <resolved>Tue, 17 May 2011 12:51:04 +0000</resolved>
                                    <version>2.7.2</version>
                                    <fixVersion>2.9</fixVersion>
                                    <component>Junit 4.x support</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14454883" author="krosenvold" created="Sun, 27 Feb 2011 09:42:28 +0000"  >&lt;p&gt;Are you sure you got this exact message with 2.7.2 ? It was fixed for 2.7.2, but we have a &lt;b&gt;similar&lt;/b&gt; issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-690&quot; title=&quot;testSetCompleted called before testSetStarting when using m3 parallel builds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-690&quot;&gt;&lt;del&gt;SUREFIRE-690&lt;/del&gt;&lt;/a&gt;) that has a slightly different error message that will be fixed for 2.7.3. The only known workaround at the moment is to insert a minor Thread.sleep() in an @after method for tests that write a lot to console. And 690 is targeted for 2.7.3 (will be 2.8)&lt;/p&gt;</comment>
                            <comment id="14454807" author="krosenvold" created="Mon, 28 Feb 2011 06:13:53 +0000"  >&lt;p&gt;I have isolated the cause of this issue and it happens because the last line being printed to System.out/err does not contain a linefeed.&lt;/p&gt;

&lt;p&gt;So as a temporary fix until 2.8 is released, you can add a linefeed after the last test before finishing each test class:&lt;/p&gt;

&lt;p&gt;    @AfterClass&lt;br/&gt;
    public static void tempFix()&lt;/p&gt;
{
       System.out.println();
        System.err.println();
    }</comment>
                            <comment id="14454734" author="daigles4" created="Mon, 28 Feb 2011 06:43:20 +0000"  >&lt;p&gt;Hi Kristian,&lt;/p&gt;

&lt;p&gt;The error looks identical between 2.7.2 and the latest 2.7.3-SNAPSHOT versions. I attached a surefire-272.txt so you can see the stack. We do print a lot of output to stdout/stderr for many tests and if I make redirectTestOutputToFile false, the tests pass. We can also set our forkmode from once to always to get around this issue however a small test run that takes approx. 20 seconds to complete will take almost 2 minutes. We have over 16,000 tests so this is not an option for us.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Shell&lt;/p&gt;</comment>
                            <comment id="14454882" author="daigles4" created="Tue, 1 Mar 2011 09:38:48 +0000"  >&lt;p&gt;We were able to add the temporary workaround to some of our files to get by these issues. Thanks for your help Kristian. Since 2.7.3 has not been officially released, do you know when 2.8 might be available?&lt;/p&gt;</comment>
                            <comment id="14454867" author="voiceinsideyou" created="Wed, 2 Mar 2011 00:28:15 +0000"  >&lt;p&gt;It&apos;s possible that this is spurious (and it certainly seems bizarre) but we started getting failures with one of our tests after we added a relatively simple @Setup to the test. Even more strangely, re-ordering the @Tests in the file so that the two tests (of 4) that were logging an exception stacktrace via log4j weren&apos;t last in the file seemed to fix it as well. (The other two tests don&apos;t log anything at all) The mind boggles.&lt;/p&gt;

&lt;p&gt;We have the same Maven setup as S Daigle.&lt;/p&gt;</comment>
                            <comment id="14454944" author="krosenvold" created="Thu, 3 Mar 2011 15:26:39 +0000"  >&lt;p&gt;Unfortunately this issue will not be fixed before earliest 2.8.1, because the kind of code change required has not been possible until &lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-700&quot; title=&quot;Surefire is not isolated from itself&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-700&quot;&gt;&lt;del&gt;SUREFIRE-700&lt;/del&gt;&lt;/a&gt; has been released.&lt;/p&gt;

&lt;p&gt;Please note, Chad Wilson,  that adding the following to your plugin defintion will probably remove the randomness you are experiencing (and it&apos;s a good thing to do this immediately even with 2.7.2 if you&apos;re using fork timeout):&lt;/p&gt;

&lt;p&gt;Plexus utils 2.0.7 will be appearing in maven central in a few hours. Adding this to surefire should solve this issue;&lt;br/&gt;
&amp;lt;plugin&amp;gt;&lt;br/&gt;
&amp;lt;artifactId&amp;gt;maven-surefire-plugin&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
....&lt;br/&gt;
&amp;lt;dependencies&amp;gt;&lt;br/&gt;
&amp;lt;dependency&amp;gt;&lt;br/&gt;
&amp;lt;groupId&amp;gt;org.codehaus.plexus&amp;lt;/groupId&amp;gt;&lt;br/&gt;
&amp;lt;artifactId&amp;gt;plexus-utils&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
&amp;lt;version&amp;gt;2.0.7&amp;lt;/version&amp;gt;&lt;br/&gt;
&amp;lt;/dependency&amp;gt;&lt;br/&gt;
&amp;lt;/dependencies&amp;gt;&lt;br/&gt;
&amp;lt;/plugin&amp;gt;&lt;/p&gt;

&lt;p&gt;This &lt;b&gt;will&lt;/b&gt; be fixed for 2.8&lt;/p&gt;</comment>
                            <comment id="14455000" author="voiceinsideyou" created="Fri, 15 Apr 2011 02:56:03 +0000"  >&lt;p&gt;Apologies Kristian, I missed your reply earlier. However we&apos;ve now using the updated plexus-utils and things seem to be better - thanks!&lt;/p&gt;</comment>
                            <comment id="14454874" author="voiceinsideyou" created="Sun, 17 Apr 2011 21:39:43 +0000"  >&lt;p&gt;Alas, I spoke too soon. Getting random failures again today with surefire and failsafe 2.7.2 despite plexus-utils:2.0.7 on both plugins. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14455004" author="krosenvold" created="Sun, 8 May 2011 15:42:17 +0000"  >&lt;p&gt;As of &lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-732&quot; title=&quot;Clean up/simplify reporting logic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-732&quot;&gt;&lt;del&gt;SUREFIRE-732&lt;/del&gt;&lt;/a&gt; with the followup in r1100808 this whole logic was simplified to the extent that this problem cannot happen any more. Revised 2.8.2-SNAPSHOT uploaded to r.a.o.&lt;/p&gt;</comment>
                            <comment id="14454983" author="daigles4" created="Mon, 16 May 2011 07:41:55 +0000"  >&lt;p&gt;Hi Kristian,&lt;/p&gt;

&lt;p&gt;Using the 2.8.2-SNAPSHOT version of the surefire plugin is much better but we still see these errors when tests post a large amount of stdout/stderr to the output files. Please see the attached log for more information. &lt;/p&gt;

&lt;p&gt;Thanks again&lt;/p&gt;</comment>
                            <comment id="14454956" author="daigles4" created="Mon, 16 May 2011 07:43:34 +0000"  >&lt;p&gt;We&apos;re still seeing these issues occasionally using 2.8.2-SNAPSHOT. They&apos;re much less frequent but they&apos;re still happening. I attached the surefire-failure.log file so you can see the stack trace.&lt;/p&gt;</comment>
                            <comment id="14454901" author="krosenvold" created="Mon, 16 May 2011 08:10:02 +0000"  >&lt;p&gt;You &lt;b&gt;must&lt;/b&gt; be using an old version of 2.8.2-SNAPSHOT, since this message is physically removed from the code in the most recent versions. Run with mvn -U to make sure you get the latest deployed 2.8.2-SNAPSHOT and/or make sure your local repository manager actually checks for updates. I just redeployed to r.a.o  in case something went haywire last time I did so.&lt;/p&gt;

&lt;p&gt;I&apos;m closing this again, since the message in your log file is not possible to get from the latest version of surefire. I&apos;ll be releasing 2.9 as soon as I finish my own testing, which should be in a day or two.&lt;/p&gt;

&lt;p&gt;And as usual, feel free to reopen &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14455006" author="daigles4" created="Mon, 16 May 2011 09:37:16 +0000"  >&lt;p&gt;Thanks Kristian. Somehow our Nexus server toggled our Apache Snapshots to blocking so we were not pulling in the latest SNAPSHOT versions. I corrected this so we&apos;ll see how it goes. Thanks again for your help.&lt;/p&gt;</comment>
                            <comment id="14455035" author="daigles4" created="Tue, 17 May 2011 10:28:39 +0000"  >&lt;p&gt;Hi Kristian. Now that we&apos;re using the latest 2.8.2-SNAPSHOT version of the plugin, were seeing the following errors in some of our tests. For example, this happened with a System.err.println(&quot;foo&quot;);&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
                at org.apache.maven.surefire.report.ConsoleOutputCapture$ForwardingPrintStream.println(ConsoleOutputCapture.java:84)&lt;br/&gt;
                at com.attivio.special.client.AttivioDocumentClientTest.getBatchingDocumentClient(AttivioDocumentClientTest.java:65)&lt;br/&gt;
                at com.attivio.special.client.AttivioDocumentClientTest.batchingDocumentTest(AttivioDocumentClientTest.java:78)&lt;br/&gt;
                at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;/p&gt;

&lt;p&gt;Do you know what this is? I attach the stack.txt and test-out.txt logfiles so you have more information.&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="14455024" author="daigles4" created="Tue, 17 May 2011 11:00:02 +0000"  >&lt;p&gt;Hi Kristian. I reopened because I didn&apos;t know if you would get my last update.&lt;/p&gt;</comment>
                            <comment id="14454937" author="krosenvold" created="Tue, 17 May 2011 12:06:45 +0000"  >&lt;p&gt;I need the relevant parts of your pom.xml (surefire config). And yes, I see everything that goes on here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14454973" author="daigles4" created="Tue, 17 May 2011 12:42:36 +0000"  >&lt;p&gt;Thanks again Kristian. I attached our surefire plugin config for you.&lt;/p&gt;</comment>
                            <comment id="14454982" author="krosenvold" created="Tue, 17 May 2011 12:51:04 +0000"  >&lt;p&gt;Extended IT and fixed piggybacked bug report in r1104433, updated snapshot published. It is generally easier to keep track of what is opened/closed at any given time if you create new issues for different problems, even if the version is not yet released.&lt;/p&gt;</comment>
                            <comment id="14454921" author="daigles4" created="Tue, 17 May 2011 14:24:17 +0000"  >&lt;p&gt;Thanks so much Kristian for the quick turnaround on this. I tested your changes and no more errors. I&apos;ll remember to open new issues in the future. Thanks again for all your help with this plugin.&lt;/p&gt;</comment>
                            <comment id="14454889" author="voiceinsideyou" created="Thu, 19 May 2011 09:25:21 +0000"  >&lt;p&gt;Hi Kristian - did the fix to this involve a fix that would have restored sys out and sys err messages being included in the XML reports? We&apos;ve noticed that in 2.8 and 2.8.1 the std-out and std-err sections were not being included in the XML test reports for failures - which stopped TeamCity from being able to include them in test failure reports. The behaviour from 2.7.2 seems to be restored in 2.8.2-SNAPSHOT though.&lt;/p&gt;

&lt;p&gt;Additionally, is it perhaps related to &lt;a href=&quot;http://jira.codehaus.org/browse/SUREFIRE-725&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.codehaus.org/browse/SUREFIRE-725&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="14454957" author="voiceinsideyou" created="Thu, 19 May 2011 09:28:13 +0000"  >&lt;p&gt;(Possibly not, re: 2nd question - as mvn -q test still seems to log to std out)&lt;/p&gt;</comment>
                            <comment id="14455036" author="krosenvold" created="Thu, 19 May 2011 13:07:35 +0000"  >&lt;p&gt;No it&apos;s actually all related to &lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-732&quot; title=&quot;Clean up/simplify reporting logic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-732&quot;&gt;&lt;del&gt;SUREFIRE-732&lt;/del&gt;&lt;/a&gt;. All of the reporting logic within surefire has just been way too complex. I did some analysis trying to understand &quot;what is the correct functionality&quot; &lt;b&gt;every single&lt;/b&gt; version from 2.4.1 until today has had minor undocumented &quot;adjustments&quot;/bugs to the reporting logic that was not documented in release notes. And in the same manner I probably blew console output in xml logs for failing tests for 2.8.x (I will make a testcase for that now that I&apos;m aware of it).&lt;/p&gt;

&lt;p&gt;Hopefully 2.9+ (formerly 2.8.2) will stabilize this. In current trunk the reporting logic is much simpler than earlier, and most of the code now reads quite well. I&apos;m just trying to make sure nothing is broken (read: testing extensively) before releasing 2.9. &lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-725&quot; title=&quot;Test result output ist sent to System.out instead of using logger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-725&quot;&gt;&lt;del&gt;SUREFIRE-725&lt;/del&gt;&lt;/a&gt; may end up waiting until 2.9.1.&lt;/p&gt;</comment>
                            <comment id="14454958" author="krosenvold" created="Thu, 19 May 2011 15:19:09 +0000"  >&lt;p&gt;Added integration test of the console output/stderr into xml files in r1125083&lt;/p&gt;</comment>
                            <comment id="14455037" author="voiceinsideyou" created="Thu, 19 May 2011 20:51:22 +0000"  >&lt;p&gt;Excellent - thanks Kristian. I&apos;ll add a dummy ticket for 2.8/2.8.1 fixed in 2.8.2 for this specific issue in case anyone else comes across it. I spent many hours scratching my head as to why our TeamCity build had stopped reporting these!&lt;/p&gt;</comment>
                            <comment id="17994105" author="olamy" created="Fri, 4 Jul 2025 07:15:32 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-surefire/issues/1856&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-surefire#1856&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12719715" name="sf-pom-config.txt" size="3151" author="daigles4" created="Tue, 17 May 2011 12:42:36 +0000"/>
                            <attachment id="12719926" name="stack.txt" size="3389" author="daigles4" created="Tue, 17 May 2011 10:28:39 +0000"/>
                            <attachment id="12719925" name="surefire-272.txt" size="4299" author="daigles4" created="Mon, 28 Feb 2011 06:44:31 +0000"/>
                            <attachment id="12719716" name="surefire-failure.log" size="6295" author="daigles4" created="Mon, 16 May 2011 07:41:55 +0000"/>
                            <attachment id="12719784" name="surefire.txt" size="4520" author="daigles4" created="Tue, 22 Feb 2011 18:25:19 +0000"/>
                            <attachment id="12720196" name="test-out.txt" size="20126" author="daigles4" created="Tue, 17 May 2011 10:28:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bb2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>