<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:18:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SUREFIRE-2276] JUnit5&apos;s TestTemplate failures treated as flakes with retries</title>
                <link>https://issues.apache.org/jira/browse/SUREFIRE-2276</link>
                <project id="12317927" key="SUREFIRE">Maven Surefire (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;G&apos;day from Atlassian,&lt;/p&gt;

&lt;p&gt;&lt;b&gt;TLDR:&lt;/b&gt; When &lt;tt&gt;surefire.rerunFailingTestsCount&lt;/tt&gt; is set to 1 or higher, then test template test failures are classified as flakes rather than failures.&lt;/p&gt;

&lt;p&gt;Failing test case demonstrating the problem at &lt;a href=&quot;https://github.com/apache/maven-surefire/compare/master...atlassian-forks:maven-surefire:master&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/compare/master...atlassian-forks:maven-surefire:master&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;JUnit5 has a feature called Test Templates (&lt;a href=&quot;https://junit.org/junit5/docs/current/user-guide/#writing-tests-test-templates&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;docs&lt;/a&gt;) which is very similar to the well known parametrised tests. The main difference is that in a test template, we can not only provide parameters for tests, but the entire context, including lifecycle methods (&lt;tt&gt;@Before...&lt;/tt&gt;, &lt;tt&gt;@After...&lt;/tt&gt; etc.).&lt;/p&gt;

&lt;p&gt;When one of the test method runs fails, Surefire correctly summarises the failure and exits with a failure. E.g. if we provided the test template method with two contexts, of which one reliably fails and one succeeds, then Surefire would, just like JUnit, show that it had run two tests, of which one failed.&lt;/p&gt;

&lt;p&gt;There is a problem with &lt;tt&gt;surefire.rerunFailingTestsCount&lt;/tt&gt; though. The setting correctly causes Surefire to invoke retries on the right tests, but the final summary of failures is wrong. With one working and one consistently failing test context, the failing one would be re-run, but the final summary would say that we had only ONE test and that it was flaky. This causes Surefire to exit with a success code, even though tests did fail.&lt;/p&gt;

&lt;p&gt;Interestingly, the problem does NOT surface when a parametrised test fails consistently, even though parametrised tests use test templates internally. There seems to be very specific logic for handling parametrised tests, which does not cover test templates around here: &lt;a href=&quot;https://github.com/apache/maven-surefire/blob/d7f4dbb7cc99a08a911066afbab3e01273dbbdc0/surefire-providers/surefire-junit-platform/src/main/java/org/apache/maven/surefire/junitplatform/RunListenerAdapter.java#L325&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/blob/d7f4dbb7cc99a08a911066afbab3e01273dbbdc0/surefire-providers/surefire-junit-platform/src/main/java/org/apache/maven/surefire/junitplatform/RunListenerAdapter.java#L325.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The test case in &lt;a href=&quot;https://github.com/apache/maven-surefire/compare/master...atlassian-forks:maven-surefire:master&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/compare/master...atlassian-forks:maven-surefire:master&lt;/a&gt; shows how adding the retries changes the test overall outcome and the summary stats.&lt;br/&gt;
Expected: 2 run, 1 failure. Overall: fail&lt;br/&gt;
Actual: 1 run, 1 flake. Overall: success&lt;/p&gt;

&lt;p&gt;I also added a test class for parametrised tests, where one param makes the test consistently fail. The test class is commented out in the IT, but might help with debugging.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We are currently investigating further and trying to get a patch ready.&lt;/p&gt;

&lt;p&gt;EDIT: We have a patch ready for merging at &lt;a href=&quot;https://github.com/apache/maven-surefire/pull/788&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/pull/788&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13594122">SUREFIRE-2276</key>
            <summary>JUnit5&apos;s TestTemplate failures treated as flakes with retries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="michael-o">Michael Osipov</assignee>
                                    <reporter username="huuugo">Hugo G</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Oct 2024 04:35:19 +0000</created>
                <updated>Fri, 4 Jul 2025 07:45:15 +0000</updated>
                            <resolved>Wed, 30 Oct 2024 11:22:05 +0000</resolved>
                                    <version>3.5.0</version>
                                    <fixVersion>3.5.2</fixVersion>
                                    <component>JUnit 5.x support</component>
                    <component>Maven Surefire Report Plugin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17886580" author="JIRAUSER307204" created="Thu, 3 Oct 2024 07:01:55 +0000"  >&lt;p&gt;We&apos;ve added a fix for this on the same fork at &lt;a href=&quot;https://github.com/apache/maven-surefire/compare/master...atlassian-forks:maven-surefire:master&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/compare/master...atlassian-forks:maven-surefire:master&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17886588" author="slawekjaranowski" created="Thu, 3 Oct 2024 07:35:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=huuugo&quot; class=&quot;user-hover&quot; rel=&quot;huuugo&quot;&gt;huuugo&lt;/a&gt; - thanks - pleas create PR with your patch&lt;/p&gt;</comment>
                            <comment id="17886593" author="JIRAUSER307204" created="Thu, 3 Oct 2024 07:51:09 +0000"  >&lt;p&gt;PR up at &lt;a href=&quot;https://github.com/apache/maven-surefire/pull/788&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/pull/788&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17889054" author="JIRAUSER307204" created="Mon, 14 Oct 2024 00:44:57 +0000"  >&lt;p&gt;PR green and waiting for merge&lt;/p&gt;</comment>
                            <comment id="17894167" author="michael-o" created="Wed, 30 Oct 2024 11:22:05 +0000"  >&lt;p&gt;Fixed with &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=maven-surefire.git&amp;amp;a=commit&amp;amp;h=e1f94a0281f0db1f9169e06b7ad149a27afd3c46&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;e1f94a0281f0db1f9169e06b7ad149a27afd3c46&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17995658" author="olamy" created="Fri, 4 Jul 2025 07:45:15 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-surefire/issues/2668&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-surefire#2668&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1rri8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>