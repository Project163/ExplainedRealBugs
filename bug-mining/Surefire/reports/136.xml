<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:07:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SUREFIRE-502] Specified classesDirectory is added to the end of the classpath</title>
                <link>https://issues.apache.org/jira/browse/SUREFIRE-502</link>
                <project id="12317927" key="SUREFIRE">Maven Surefire (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;When you specify a classesDirectory in the configuration element of the Surefire plugin definition the classesDirectory is appended to the end of the classpath rather than replacing the build output directory. This means included dependencies take precedence over your source code.&lt;/p&gt;

&lt;p&gt;The problem appears to be the following code:&lt;/p&gt;

&lt;p&gt;if ( !project.getBuild().getOutputDirectory().equals( classesDirectory.getAbsolutePath() ) )&lt;/p&gt;
        {
            classpathElements.remove( project.getBuild().getOutputDirectory() );
            classpathElements.add( classesDirectory.getAbsolutePath() );
        }

&lt;p&gt;The classes directory should replace the build output directory, e.g.&lt;/p&gt;

&lt;p&gt;if ( !project.getBuild().getOutputDirectory().equals( classesDirectory.getAbsolutePath() ) )&lt;br/&gt;
        {&lt;br/&gt;
            final int replacementIndex = classpathElements.indexOf(project.getBuild().getOutputDirectory());&lt;br/&gt;
            if (replacementIndex &amp;gt;= 0)&lt;/p&gt;
                    {
                   classpathElements.remove( project.getBuild().getOutputDirectory() );
                   classpathElements.add( replacementIndex, classesDirectory.getAbsolutePath() );
                   }
&lt;p&gt;            else&lt;/p&gt;
                   {
                   classpathElements.add( classesDirectory.getAbsolutePath() );
                   }
&lt;p&gt;        }&lt;/p&gt;
</description>
                <environment>Windows Vista SP1, Java 1.5.0_13, Maven 2.0.9</environment>
        <key id="12809664">SUREFIRE-502</key>
            <summary>Specified classesDirectory is added to the end of the classpath</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pgier">Paul Gier</assignee>
                                    <reporter username="jshiell">James Shiell</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Jun 2008 09:25:55 +0000</created>
                <updated>Fri, 4 Jul 2025 07:10:33 +0000</updated>
                            <resolved>Thu, 20 Aug 2009 14:18:01 +0000</resolved>
                                    <version>2.4.3</version>
                                    <fixVersion>2.5</fixVersion>
                                    <component>classloading</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14454364" author="jshiell" created="Wed, 18 Jun 2008 09:50:03 +0000"  >&lt;p&gt;Patch with suggested fix.&lt;/p&gt;</comment>
                            <comment id="14454274" author="mdahm" created="Fri, 1 Aug 2008 02:38:58 +0000"  >&lt;p&gt;the original code looks like this:&lt;/p&gt;

&lt;p&gt;getLog().debug(&quot;Test Classpath :&quot;);&lt;/p&gt;

&lt;p&gt;    // Check if we need to add configured classes/test classes directories here.&lt;br/&gt;
    // If they are configured, we should remove the default to avoid conflicts.&lt;/p&gt;

&lt;p&gt;        // Check if we need to add configured classes/test classes directories here.&lt;br/&gt;
        // If they are configured, we should remove the default to avoid conflicts.&lt;br/&gt;
        if ( !project.getBuild().getOutputDirectory().equals( classesDirectory.getAbsolutePath() ) )&lt;/p&gt;
        {
            getLog().debug( &quot;Warning: changing classpath! &quot; + project.getBuild().getOutputDirectory() + &quot; != &quot; + classesDirectory.getAbsolutePath() );
           
            classpathElements.remove( project.getBuild().getOutputDirectory() );
            classpathElements.add( classesDirectory.getAbsolutePath() );
        }
&lt;p&gt;        if ( !project.getBuild().getTestOutputDirectory().equals( testClassesDirectory.getAbsolutePath() ) )&lt;/p&gt;
        {
        getLog().debug( &quot;Warning: changing classpath! &quot; + project.getBuild().getTestOutputDirectory() + &quot; != &quot; + testClassesDirectory.getAbsolutePath() );
            classpathElements.remove( project.getBuild().getTestOutputDirectory() );
            classpathElements.add( testClassesDirectory.getAbsolutePath() );
        }

&lt;p&gt;However there are two problems here:&lt;br/&gt;
1.) In a Windows environment (which I&apos;m forced to use ... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; the may be paths with mixed separators like C:\foo\bar/target/classes.&lt;br/&gt;
This cause the above equals() to return false, also the paths may not be different actually.&lt;br/&gt;
2.) The order of the classes and the test-classes folder may be swapped if both if() apply&lt;/p&gt;

&lt;p&gt;I&apos;d suggest the following code which uses Files to compare the paths and ensures that the test class path entry always comes first:&lt;/p&gt;

&lt;p&gt;getLog().debug(&quot;Test Classpath :&quot;);&lt;/p&gt;

&lt;p&gt;    // Check if we need to add configured classes/test classes directories here.&lt;br/&gt;
    // If they are configured, we should remove the default to avoid conflicts.&lt;/p&gt;

&lt;p&gt;    // Ensure that test classes always come first&lt;br/&gt;
    final File outputDirectory = new File(project.getBuild().getOutputDirectory());&lt;br/&gt;
    classpathElements.remove(project.getBuild().getOutputDirectory());&lt;br/&gt;
    final File testOutputDirectory = new File(project.getBuild().getTestOutputDirectory());&lt;br/&gt;
    classpathElements.remove(project.getBuild().getTestOutputDirectory());&lt;/p&gt;

&lt;p&gt;    if (outputDirectory.equals(classesDirectory)) &lt;/p&gt;
{
      // Add again at start of the list
      classpathElements.add(0, outputDirectory.getAbsolutePath());
    }
&lt;p&gt; else &lt;/p&gt;
{
      getLog().debug(
          &quot;Warning: changing classpath! &quot; + outputDirectory.getAbsolutePath() + &quot; != &quot; + classesDirectory.getAbsolutePath());

      classpathElements.add(0, classesDirectory.getAbsolutePath());
    }

&lt;p&gt;    if (testOutputDirectory.equals(testClassesDirectory)) &lt;/p&gt;
{
      // Add again at the very start of the list
      classpathElements.add(0, testOutputDirectory.getAbsolutePath());
    }
&lt;p&gt; else &lt;/p&gt;
{
      getLog().debug(
          &quot;Warning: changing classpath! &quot; + testOutputDirectory.getAbsolutePath() + &quot; != &quot;
              + testClassesDirectory.getAbsolutePath());
      classpathElements.add(0, testClassesDirectory.getAbsolutePath());
    }

&lt;p&gt;Cheers&lt;br/&gt;
    Markus&lt;/p&gt;</comment>
                            <comment id="14454308" author="mdahm" created="Fri, 1 Aug 2008 02:40:07 +0000"  >&lt;p&gt;Well, here comes the code in a more readable fashion...&lt;/p&gt;</comment>
                            <comment id="14454443" author="pgier" created="Thu, 20 Aug 2009 14:18:01 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;revision=806311&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r806311&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17993844" author="olamy" created="Fri, 4 Jul 2025 07:10:33 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-surefire/issues/1194&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-surefire#1194&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12810168">SUREFIRE-504</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12809633">SUREFIRE-517</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310260">
                    <name>Related</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12810220">SUREFIRE-619</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12720247" name="SUREFIRE-502.patch" size="1184" author="jshiell" created="Wed, 18 Jun 2008 09:50:02 +0000"/>
                            <attachment id="12719912" name="SurefirePlugin.java" size="37162" author="mdahm" created="Fri, 1 Aug 2008 02:40:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bdn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>