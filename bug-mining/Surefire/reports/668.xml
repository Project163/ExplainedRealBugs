<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:16:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SUREFIRE-1748] JUnit 5 Assertions.fail() breaks reporting</title>
                <link>https://issues.apache.org/jira/browse/SUREFIRE-1748</link>
                <project id="12317927" key="SUREFIRE">Maven Surefire (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;Associated versions on my end at time of testing:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;JUnit Jupiter 5.3.2&lt;/li&gt;
	&lt;li&gt;JDK 1.8u172&lt;/li&gt;
	&lt;li&gt;Maven 3.6.3&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Demonstration available at&#160;&lt;a href=&quot;https://github.com/ajohnstonTE/surefire-jira-examples/tree/master/junit-assertions-fail&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ajohnstonTE/surefire-jira-examples/tree/master/junit-assertions-fail&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If the following JUnit 5 code is run through Surefire, then the reporting breaks for that class, resulting in no reported errors/failures from that class (though any failures will still be reported overall in the counts):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JUnit5Test {
  @Test
  void failWithNoParameters() {
    Assertions.fail();
  } 
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Resulting output:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.016 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in JUnit5Test
[ERROR] JUnit5Test.failWithNoParameters  Time elapsed: 0.008 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
[ERROR] Failures:
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.0.0-M4:test (default-test) on project junit-assertions-fail: Execution default-test of goal org.apache.maven.plugins:maven-surefire-plugin:3.0.0-M4:test failed.: NullPointerException -&amp;gt; [Help 1]
[ERROR]
[ERROR] To see the full stack trace...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And with the -e flag, trimmed to the relevant part:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.016 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in JUnit5Test
[ERROR] JUnit5Test.failWithNoParameters  Time elapsed: 0.007 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
[ERROR] Failures:
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.0.0-M4:test (default-test) on project junit-assertions-fail: Execution default-test of goal org.apache.maven.plugins:maven-surefire-plugin:3.0.0-M4:test failed.: NullPointerException -&amp;gt; [Help 1]
org.apache.maven.lifecycle.LifecycleExecutionException: Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.0.0-M4:test (default-test) on project junit-assertions-fail: Execution default-test of goal org.apache.maven.plugins:maven-surefire-plugin:3.0.0-M4:test failed.
Caused by: org.apache.maven.plugin.PluginExecutionException: Execution default-test of goal org.apache.maven.plugins:maven-surefire-plugin:3.0.0-M4:test failed.
Caused by: java.lang.NullPointerException
    at org.apache.maven.plugin.surefire.report.DefaultReporterFactory.printTestFailures (DefaultReporterFactory.java:398)
    at org.apache.maven.plugin.surefire.report.DefaultReporterFactory.runCompleted (DefaultReporterFactory.java:198)
    at org.apache.maven.plugin.surefire.report.DefaultReporterFactory.close (DefaultReporterFactory.java:171)
    at org.apache.maven.plugin.surefire.booterclient.ForkStarter.run (ForkStarter.java:254)
    at org.apache.maven.plugin.surefire.AbstractSurefireMojo.executeProvider (AbstractSurefireMojo.java:1217)
    at org.apache.maven.plugin.surefire.AbstractSurefireMojo.executeAfterPreconditionsChecked (AbstractSurefireMojo.java:1063)
    at org.apache.maven.plugin.surefire.AbstractSurefireMojo.execute (AbstractSurefireMojo.java:889)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13282957">SUREFIRE-1748</key>
            <summary>JUnit 5 Assertions.fail() breaks reporting</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tibordigana">Tibor Digana</assignee>
                                    <reporter username="ajohnston">Albert Johnston</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Feb 2020 11:02:21 +0000</created>
                <updated>Fri, 4 Jul 2025 07:35:19 +0000</updated>
                            <resolved>Wed, 5 Feb 2020 22:26:25 +0000</resolved>
                                    <version>3.0.0-M4</version>
                                    <fixVersion>3.0.0-M5</fixVersion>
                                    <component>JUnit 5.x support</component>
                    <component>Maven Surefire Plugin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="17029000" author="tibor17" created="Mon, 3 Feb 2020 14:47:58 +0000"  >&lt;p&gt;Have you used the SNAPSHOT version as well?&lt;/p&gt;</comment>
                            <comment id="17029212" author="ajohnston" created="Mon, 3 Feb 2020 19:22:11 +0000"  >&lt;p&gt;I hadn&apos;t tested against it recently, though I did try that when I first discovered it. Anyways, I updated the repo to target the snapshot. Issue still exists.&lt;/p&gt;</comment>
                            <comment id="17029259" author="tibor17" created="Mon, 3 Feb 2020 20:51:43 +0000"  >&lt;p&gt;You have experiences with our code. Can you analyse or debug &lt;tt&gt;DefaultReporterFactory&lt;/tt&gt;?&lt;br/&gt;
Is it the same line 398 in origin/master?&lt;/p&gt;</comment>
                            <comment id="17029311" author="ajohnston" created="Mon, 3 Feb 2020 21:35:42 +0000"  >&lt;p&gt;Yes, it&apos;s the same line.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/maven-surefire/blob/master/maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/report/DefaultReporterFactory.java#L398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/blob/master/maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/report/DefaultReporterFactory.java#L398&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The line is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
failure( &lt;span class=&quot;code-quote&quot;&gt;&quot;  &quot;&lt;/span&gt; + testMethodStats.get( 0 ).getStackTraceWriter().smartTrimmedStackTrace() );
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;ve already looked into this a couple times, once for a few minutes to see if it was a simple fix, and a second time for an hour or so to really dig around for the issue. I can say with certainty that the returned null value is the&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getStackTraceWriter()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;causing the NPE when&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
smartTrimmedStackTrace()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is called. Although I&apos;m not at all familiar with this part of the project, I&apos;m inclined to believe that the issue isn&apos;t here. Especially considering the fact that this issue doesn&apos;t happen with JUnit4&apos;s Assert.fail(), even if you explicitly pass in null. I think it&apos;s likely that there&apos;s a check somewhere else that&apos;s treating JUnit 5&apos;s assert differently, but it&apos;s really just conjecture. I even tried manually changing a few of those places to return a non-null value, but nothing helped. I was focusing on this in particular at one point, but again, didn&apos;t help:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/maven-surefire/blob/master/surefire-providers/common-java5/src/main/java/org/apache/maven/surefire/report/SmartStackTraceParser.java#L133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/blob/master/surefire-providers/common-java5/src/main/java/org/apache/maven/surefire/report/SmartStackTraceParser.java#L133&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;ll give it another shot tonight, it&apos;s been a few days, maybe coming at it fresh will help. Also, if you have any thoughts, I&apos;m open to ideas.&lt;/p&gt;</comment>
                            <comment id="17029336" author="tibor17" created="Mon, 3 Feb 2020 22:21:47 +0000"  >&lt;p&gt;I am sure we are not sending the stack trace to the RunAdapter via SimpleReportEntry while the failure happens.&lt;/p&gt;</comment>
                            <comment id="17029342" author="ajohnston" created="Mon, 3 Feb 2020 22:26:40 +0000"  >&lt;p&gt;I&apos;m sure I checked that at one point, specifically comparing the difference between a SimpleReportEntry created from AssertionError (JUnit4) and AssertionFailedError (JUnit 5), and both had the stack trace, but I&apos;ll double check.&lt;/p&gt;</comment>
                            <comment id="17029745" author="ajohnston" created="Tue, 4 Feb 2020 10:50:03 +0000"  >&lt;p&gt;Third time&apos;s the charm, I know what the issue is. It&apos;s pretty late, so I&apos;ll keep this &lt;em&gt;relatively&lt;/em&gt; short (meaning no PR and such, this is a long-ish explanation) and come back to it tomorrow. The issue appears to be that when the AssertionError message is the empty string (not null), then it messes up the encoding/decoding process (specifically ForkedChannelEncoder/ForkedChannelDecoder). This actually goes for both JUnit 5 and JUnit 4, the difference being that JUnit 5 coerces a null message into an empty string, whereas JUnit 4 does not. So to trigger the issue in JUnit 4, you have to explicitly pass in an empty string, it cannot simply be null.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Anyways, when you pass in a null message, the message is translated into &quot;-&quot; during the encoding process. Totally fine. However, when you pass in an empty string message, it stays as an empty string when encoded. This causes the surrounding encoding for the message to look like &quot;::&quot;. That seems correct, however this leads to the important part. As a result of some part of this process (I&apos;m thinking it&apos;s the way it&apos;s tokenized when decoded), the smart stack trace is decoded into the message, the stack trace is decoded into the smart stack trace, and the stack trace is left as null. In other words, the message is &quot;skipped&quot;, causing everything to be read into the property that comes before it, leaving the stack trace with nothing to fill it. Which, in turn, leads to the null stack trace writer I mentioned in an earlier comment.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Assuming the issue is something with the decoder&apos;s tokenization of the encoded failure, it&apos;s potentially a relatively easy fix. I already attempted to fix it by simply having the empty string be encoded as &quot;-&quot; as if it was null, but that breaks other tests, and I suppose is technically incorrect (it isn&apos;t actually null, after all).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Relevant code:&#160;&lt;/p&gt;

&lt;p&gt;-&#160;&lt;a href=&quot;https://github.com/apache/maven-surefire/blob/master/maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/booterclient/output/ForkedChannelDecoder.java#L261-L275&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/blob/master/maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/booterclient/output/ForkedChannelDecoder.java#L261-L275&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;-&#160;&lt;a href=&quot;https://github.com/apache/maven-surefire/blob/master/surefire-api/src/main/java/org/apache/maven/surefire/booter/ForkedChannelEncoder.java#L292-L309&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/blob/master/surefire-api/src/main/java/org/apache/maven/surefire/booter/ForkedChannelEncoder.java#L292-L309&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17030544" author="ajohnston" created="Wed, 5 Feb 2020 10:34:54 +0000"  >&lt;p&gt;PR opened:&#160;&lt;a href=&quot;https://github.com/apache/maven-surefire/pull/269&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/pull/269&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17031086" author="tibor17" created="Wed, 5 Feb 2020 22:26:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=a341e1327dea792917d5a8678323ad8eee003e63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=a341e1327dea792917d5a8678323ad8eee003e63&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17995147" author="olamy" created="Fri, 4 Jul 2025 07:35:19 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-surefire/issues/3110&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-surefire#3110&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0b3oo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>