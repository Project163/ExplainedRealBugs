<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:17:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SUREFIRE-1909] Support JUnit 5 reflection access by changing add-exports to add-opens</title>
                <link>https://issues.apache.org/jira/browse/SUREFIRE-1909</link>
                <project id="12317927" key="SUREFIRE">Maven Surefire (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;Testing JUnit 5 classes of a JPMS-enabled project with Surefire may fail if a test class (or, for example, an abstract test base class) is not declared &quot;public&quot;. I&apos;m seeing the following error:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.reflect.InaccessibleObjectException: Unable to make &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void some.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;.SomeClass.setupClass() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; java.io.IOException accessible: module some.module does not &lt;span class=&quot;code-quote&quot;&gt;&quot;opens some.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;&quot;&lt;/span&gt; to unnamed module @754ba872&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This could be fixed by adding the recommended &quot;&lt;tt&gt;opens some.package&lt;/tt&gt;&quot; to the project&apos;s module-info.java, however that is undesirable since it changes the project&apos;s behavior beyond just unit testing. Adding a secondary &quot;test-only&quot; module-info.java is also counterproductive since not all IDEs support this, and these two files would have to be kept in sync, which is non-trivial.&lt;/p&gt;

&lt;p&gt;An easy fix would be to change the &quot;&lt;tt&gt;-&lt;del&gt;add-exports&lt;/del&gt;&lt;/tt&gt;&quot; VM parameter that surefire adds automatically to &quot;&lt;tt&gt;-&lt;/tt&gt;&lt;tt&gt;add-opens&lt;/tt&gt;&quot; in&#160;&lt;tt&gt;maven-surefire-common/src/main/java/org/apache/maven/plugin/surefire/booterclient/ModularClasspathForkConfiguration.java&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;This bug is particularly bad because PMD now specifically complains about junit5 classes marked as public instead of package-private; see&#160;&lt;a href=&quot;https://pmd.github.io/2021/05/29/PMD-6.35.0/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://pmd.github.io/2021/05/29/PMD-6.35.0/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13374269">SUREFIRE-1909</key>
            <summary>Support JUnit 5 reflection access by changing add-exports to add-opens</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tibordigana">Tibor Digana</assignee>
                                    <reporter username="ck@newsclub.de">Christian Kohlsch&#252;tter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Apr 2021 02:42:37 +0000</created>
                <updated>Fri, 4 Jul 2025 07:38:27 +0000</updated>
                            <resolved>Thu, 17 Feb 2022 05:58:02 +0000</resolved>
                                    <version>3.0.0-M5</version>
                                    <fixVersion>2.22.3</fixVersion>
                    <fixVersion>3.0.0-M6</fixVersion>
                                    <component>JUnit 5.x support</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17327229" author="tibor17" created="Thu, 22 Apr 2021 09:54:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ck%40newsclub.de&quot; class=&quot;user-hover&quot; rel=&quot;ck@newsclub.de&quot;&gt;ck@newsclub.de&lt;/a&gt;&lt;br/&gt;
Pls show us how the CLI would look like if you want to help us. Check it out with debug logs &lt;tt&gt;mvn -X test&lt;/tt&gt; and you will see JMPS options we use in the @file of the CLI.&lt;/p&gt;</comment>
                            <comment id="17366928" author="ck@newsclub.de" created="Tue, 22 Jun 2021 01:45:15 +0000"  >&lt;p&gt;Hi Tibor, I&apos;ve attached a project that exposes the bug. Just run with &quot;mvn test&quot;.&lt;/p&gt;

&lt;p&gt;As I said above, changing &quot;add-exports&quot; to &quot;add-opens&quot; in that class fixes it.&lt;/p&gt;

&lt;p&gt;Here&apos;s the relevant output from &quot;mvn -X test&quot;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[DEBUG] Determined Maven &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; ID 15092
[DEBUG] Fork Channel [1] connection string &lt;span class=&quot;code-quote&quot;&gt;&apos;pipe:&lt;span class=&quot;code-comment&quot;&gt;//1&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the implementation &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.maven.plugin.surefire.extensions.LegacyForkChannel
&lt;/span&gt;[DEBUG] boot classpath: .m2/repository/org/apache/maven/surefire/surefire-booter/3.0.0-M5/surefire-booter-3.0.0-M5.jar .m2/repository/org/apache/maven/surefire/surefire-api/3.0.0-M5/surefire-api-3.0.0-M5.jar .m2/repository/org/apache/maven/surefire/surefire-logger-api/3.0.0-M5/surefire-logger-api-3.0.0-M5.jar .m2/repository/org/apache/maven/surefire/surefire-shared-utils/3.0.0-M4/surefire-shared-utils-3.0.0-M4.jar .m2/repository/org/apache/maven/surefire/surefire-extensions-spi/3.0.0-M5/surefire-extensions-spi-3.0.0-M5.jar workspace/surefire-jpms-bug/target/test-classes .m2/repository/org/junit/jupiter/junit-jupiter/5.7.1/junit-jupiter-5.7.1.jar .m2/repository/org/junit/jupiter/junit-jupiter-api/5.7.1/junit-jupiter-api-5.7.1.jar .m2/repository/org/apiguardian/apiguardian-api/1.1.0/apiguardian-api-1.1.0.jar .m2/repository/org/opentest4j/opentest4j/1.2.0/opentest4j-1.2.0.jar .m2/repository/org/junit/platform/junit-platform-commons/1.7.1/junit-platform-commons-1.7.1.jar .m2/repository/org/junit/jupiter/junit-jupiter-params/5.7.1/junit-jupiter-params-5.7.1.jar .m2/repository/org/junit/jupiter/junit-jupiter-engine/5.7.1/junit-jupiter-engine-5.7.1.jar .m2/repository/org/junit/platform/junit-platform-engine/1.7.1/junit-platform-engine-1.7.1.jar .m2/repository/org/apache/maven/surefire/surefire-junit-platform/3.0.0-M5/surefire-junit-platform-3.0.0-M5.jar .m2/repository/org/apache/maven/surefire/common-java5/3.0.0-M5/common-java5-3.0.0-M5.jar .m2/repository/org/junit/platform/junit-platform-launcher/1.7.1/junit-platform-launcher-1.7.1.jar
[DEBUG] boot(compact) classpath: surefire-booter-3.0.0-M5.jar surefire-api-3.0.0-M5.jar surefire-logger-api-3.0.0-M5.jar surefire-shared-utils-3.0.0-M4.jar surefire-extensions-spi-3.0.0-M5.jar test-classes junit-jupiter-5.7.1.jar junit-jupiter-api-5.7.1.jar apiguardian-api-1.1.0.jar opentest4j-1.2.0.jar junit-platform-commons-1.7.1.jar junit-jupiter-params-5.7.1.jar junit-jupiter-engine-5.7.1.jar junit-platform-engine-1.7.1.jar surefire-junit-platform-3.0.0-M5.jar common-java5-3.0.0-M5.jar junit-platform-launcher-1.7.1.jar
[DEBUG] Path to args file: workspace/surefire-jpms-bug/target/surefire/surefireargs12553641456609995297
[DEBUG] args file content:
--module-path
&lt;span class=&quot;code-quote&quot;&gt;&quot;workspace/surefire-jpms-bug/target/classes&quot;&lt;/span&gt;
--&lt;span class=&quot;code-keyword&quot;&gt;class-&lt;/span&gt;path
&lt;span class=&quot;code-quote&quot;&gt;&quot;.m2/repository/org/apache/maven/surefire/surefire-booter/3.0.0-M5/surefire-booter-3.0.0-M5.jar:.m2/repository/org/apache/maven/surefire/surefire-api/3.0.0-M5/surefire-api-3.0.0-M5.jar:.m2/repository/org/apache/maven/surefire/surefire-logger-api/3.0.0-M5/surefire-logger-api-3.0.0-M5.jar:.m2/repository/org/apache/maven/surefire/surefire-shared-utils/3.0.0-M4/surefire-shared-utils-3.0.0-M4.jar:.m2/repository/org/apache/maven/surefire/surefire-extensions-spi/3.0.0-M5/surefire-extensions-spi-3.0.0-M5.jar:workspace/surefire-jpms-bug/target/test-classes:.m2/repository/org/junit/jupiter/junit-jupiter/5.7.1/junit-jupiter-5.7.1.jar:.m2/repository/org/junit/jupiter/junit-jupiter-api/5.7.1/junit-jupiter-api-5.7.1.jar:.m2/repository/org/apiguardian/apiguardian-api/1.1.0/apiguardian-api-1.1.0.jar:.m2/repository/org/opentest4j/opentest4j/1.2.0/opentest4j-1.2.0.jar:.m2/repository/org/junit/platform/junit-platform-commons/1.7.1/junit-platform-commons-1.7.1.jar:.m2/repository/org/junit/jupiter/junit-jupiter-params/5.7.1/junit-jupiter-params-5.7.1.jar:.m2/repository/org/junit/jupiter/junit-jupiter-engine/5.7.1/junit-jupiter-engine-5.7.1.jar:.m2/repository/org/junit/platform/junit-platform-engine/1.7.1/junit-platform-engine-1.7.1.jar:.m2/repository/org/apache/maven/surefire/surefire-junit-platform/3.0.0-M5/surefire-junit-platform-3.0.0-M5.jar:.m2/repository/org/apache/maven/surefire/common-java5/3.0.0-M5/common-java5-3.0.0-M5.jar:.m2/repository/org/junit/platform/junit-platform-launcher/1.7.1/junit-platform-launcher-1.7.1.jar&quot;&lt;/span&gt;
--patch-module
surefire.jpms.bug=&lt;span class=&quot;code-quote&quot;&gt;&quot;workspace/surefire-jpms-bug/target/test-classes&quot;&lt;/span&gt;
--add-exports
surefire.jpms.bug/surefire.test=ALL-UNNAMED
--add-modules
surefire.jpms.bug
--add-reads
surefire.jpms.bug=ALL-UNNAMED
org.apache.maven.surefire.booter.ForkedBooter
[DEBUG] Forking command line: /bin/sh -c cd workspace/surefire-jpms-bug &amp;amp;&amp;amp; /Library/Java/JavaVirtualMachines/adoptopenjdk-11.jdk/Contents/Home/bin/java @workspace/surefire-jpms-bug/target/surefire/surefireargs12553641456609995297 workspace/surefire-jpms-bug/target/surefire 2021-06-21T18-41-15_153-jvmRun1 surefire8660924379138157795tmp surefire_015925150141917337177tmp
[DEBUG] Fork Channel [1] connected to the client.
[INFO] Running surefire.test.JupiterTest
[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.058 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in surefire.test.JupiterTest
[ERROR] surefire.test.JupiterTest.test Time elapsed: 0.013 s &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.reflect.InaccessibleObjectException: Unable to make surefire.test.JupiterTest() accessible: module surefire.jpms.bug does not &lt;span class=&quot;code-quote&quot;&gt;&quot;opens surefire.test&quot;&lt;/span&gt; to unnamed module @17a7f733
[DEBUG] Closing the fork 1 after saying GoodBye.
[INFO] 
[INFO] Results:
[INFO] 
[ERROR] Errors: 
[ERROR] JupiterTest.test &#187; InaccessibleObject Unable to make surefire.test.JupiterTest...
[INFO] 
[ERROR] Tests run: 1, Failures: 0, Errors: 1, Skipped: 0
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 5.070 s
[INFO] Finished at: 2021-06-21T18:41:17-07:00
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.0.0-M5:test (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-test) on project surefire-jpms-bug: There are test failures.
[ERROR] 
[ERROR] Please refer to workspace/surefire-jpms-bug/target/surefire-reports &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the individual test results.
[ERROR] Please refer to dump files (&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; any exist) [date].dump, [date]-jvmRun[N].dump and [date].dumpstream.
[ERROR] -&amp;gt; [Help 1]
org.apache.maven.lifecycle.LifecycleExecutionException: Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.0.0-M5:test (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-test) on project surefire-jpms-bug: There are test failures.
Please refer to workspace/surefire-jpms-bug/target/surefire-reports &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the individual test results.
Please refer to dump files (&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; any exist) [date].dump, [date]-jvmRun[N].dump and [date].dumpstream.
 at org.apache.maven.lifecycle.internal.MojoExecutor.execute (MojoExecutor.java:215)
 at org.apache.maven.lifecycle.internal.MojoExecutor.execute (MojoExecutor.java:156)
 at org.apache.maven.lifecycle.internal.MojoExecutor.execute (MojoExecutor.java:148)
 at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject (LifecycleModuleBuilder.java:117)
 at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject (LifecycleModuleBuilder.java:81)
 at org.apache.maven.lifecycle.internal.builder.singlethreaded.SingleThreadedBuilder.build (SingleThreadedBuilder.java:56)
 at org.apache.maven.lifecycle.internal.LifecycleStarter.execute (LifecycleStarter.java:128)
 at org.apache.maven.DefaultMaven.doExecute (DefaultMaven.java:305)
 at org.apache.maven.DefaultMaven.doExecute (DefaultMaven.java:192)
 at org.apache.maven.DefaultMaven.execute (DefaultMaven.java:105)
 at org.apache.maven.cli.MavenCli.execute (MavenCli.java:957)
 at org.apache.maven.cli.MavenCli.doMain (MavenCli.java:289)
 at org.apache.maven.cli.MavenCli.main (MavenCli.java:193)
 at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0 (Native Method)
 at jdk.internal.reflect.NativeMethodAccessorImpl.invoke (NativeMethodAccessorImpl.java:62)
 at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke (DelegatingMethodAccessorImpl.java:43)
 at java.lang.reflect.Method.invoke (Method.java:566)
 at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced (Launcher.java:282)
 at org.codehaus.plexus.classworlds.launcher.Launcher.launch (Launcher.java:225)
 at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode (Launcher.java:406)
 at org.codehaus.plexus.classworlds.launcher.Launcher.main (Launcher.java:347)
Caused by: org.apache.maven.plugin.MojoFailureException: There are test failures.
Please refer to workspace/surefire-jpms-bug/target/surefire-reports &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the individual test results.
Please refer to dump files (&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; any exist) [date].dump, [date]-jvmRun[N].dump and [date].dumpstream.
 at org.apache.maven.plugin.surefire.SurefireHelper.throwException (SurefireHelper.java:271)
 at org.apache.maven.plugin.surefire.SurefireHelper.reportExecution (SurefireHelper.java:159)
 at org.apache.maven.plugin.surefire.SurefirePlugin.handleSummary (SurefirePlugin.java:453)
 at org.apache.maven.plugin.surefire.AbstractSurefireMojo.executeAfterPreconditionsChecked (AbstractSurefireMojo.java:1175)
 at org.apache.maven.plugin.surefire.AbstractSurefireMojo.execute (AbstractSurefireMojo.java:932)
 at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo (DefaultBuildPluginManager.java:137)
 at org.apache.maven.lifecycle.internal.MojoExecutor.execute (MojoExecutor.java:210)
 at org.apache.maven.lifecycle.internal.MojoExecutor.execute (MojoExecutor.java:156)
 at org.apache.maven.lifecycle.internal.MojoExecutor.execute (MojoExecutor.java:148)
 at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject (LifecycleModuleBuilder.java:117)
 at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject (LifecycleModuleBuilder.java:81)
 at org.apache.maven.lifecycle.internal.builder.singlethreaded.SingleThreadedBuilder.build (SingleThreadedBuilder.java:56)
 at org.apache.maven.lifecycle.internal.LifecycleStarter.execute (LifecycleStarter.java:128)
 at org.apache.maven.DefaultMaven.doExecute (DefaultMaven.java:305)
 at org.apache.maven.DefaultMaven.doExecute (DefaultMaven.java:192)
 at org.apache.maven.DefaultMaven.execute (DefaultMaven.java:105)
 at org.apache.maven.cli.MavenCli.execute (MavenCli.java:957)
 at org.apache.maven.cli.MavenCli.doMain (MavenCli.java:289)
 at org.apache.maven.cli.MavenCli.main (MavenCli.java:193)
 at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0 (Native Method)
 at jdk.internal.reflect.NativeMethodAccessorImpl.invoke (NativeMethodAccessorImpl.java:62)
 at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke (DelegatingMethodAccessorImpl.java:43)
 at java.lang.reflect.Method.invoke (Method.java:566)
 at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced (Launcher.java:282)
 at org.codehaus.plexus.classworlds.launcher.Launcher.launch (Launcher.java:225)
 at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode (Launcher.java:406)
 at org.codehaus.plexus.classworlds.launcher.Launcher.main (Launcher.java:347)
[ERROR] 
[ERROR] 
[ERROR] For more information about the errors and possible solutions, please read the following articles:
[ERROR] [Help 1] http:&lt;span class=&quot;code-comment&quot;&gt;//cwiki.apache.org/confluence/display/MAVEN/MojoFailureException&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17385840" author="ck@newsclub.de" created="Fri, 23 Jul 2021 01:33:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tibordigana&quot; class=&quot;user-hover&quot; rel=&quot;tibordigana&quot;&gt;tibordigana&lt;/a&gt;&#160;ping&lt;/p&gt;</comment>
                            <comment id="17385980" author="tibor17" created="Fri, 23 Jul 2021 06:27:55 +0000"  >&lt;p&gt;I would like to see your &quot;add-opens&quot; with the remaining part, but the most important is the question why you used module-info.java in src/main/java and you did not write a new module-info.java in src/test/java. Pls read our documentation which describes everything you need &lt;a href=&quot;https://maven.apache.org/surefire/maven-surefire-plugin/examples/jpms.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://maven.apache.org/surefire/maven-surefire-plugin/examples/jpms.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17390254" author="ck@newsclub.de" created="Fri, 30 Jul 2021 03:01:53 +0000"  >&lt;p&gt;As far as I understand, Jigsaw mandates that there can only be &lt;em&gt;one&lt;/em&gt; module-info.java per package (which makes sense). Unsurprisingly, IDEs like Eclipse concur and refuse adding a secondary file there.&lt;/p&gt;

&lt;p&gt;I understand the document you refer to suggests that tests are to be moved to their own test package; this may be non-desirable for a variety of reasons. And, as far as it seems, surefire is totally fine keeping the tests in the same package (that&apos;s because&#160;--&lt;tt&gt;add-exports&lt;/tt&gt; is added), as is Junit 5 in Eclipse. Just the combination of Junit 5 with Surefire doesn&apos;t work.&lt;/p&gt;

&lt;p&gt;Can you reproduce using the attached project?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17390481" author="tibor17" created="Fri, 30 Jul 2021 10:28:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ck%40newsclub.de&quot; class=&quot;user-hover&quot; rel=&quot;ck@newsclub.de&quot;&gt;ck@newsclub.de&lt;/a&gt;&lt;br/&gt;
There are two modules.&lt;br/&gt;
It is not true that you have one module. Form the JPMS perspective there are two, namely, &lt;tt&gt;src/main/java&lt;/tt&gt; and &lt;tt&gt;src/test/java&lt;/tt&gt;.&lt;br/&gt;
So if you need to maintain tests as a jpms module, you should have module info in tests as well. If you do not then the test dependencies would appear in the classpath. If you want to have them in module path, you have to write module-info.java in src/test/java. We cannot have one module descriptor because these two modules are isolated, they must be two and they are different, cannot be mixed in one module descriptor. For instance the compiler is using module descriptor in src/main/java. I guess the compiler would do similar with module descriptor in src/test/java.&lt;/p&gt;

&lt;p&gt;I can imaging that we would add a new configuration parameter where you would be able to specify file path pointing to your custom module descriptor where you can merge both in one. I think you do not have comfort either with this.&lt;/p&gt;

&lt;p&gt;We cannot read your brain and we do not know when and what user wants to use &quot;add-export&quot; and when not. Therefore you are managing the modulepaths.&lt;/p&gt;

&lt;p&gt;If you have a help and a solution for us, I am all the hear.&lt;/p&gt;

&lt;p&gt;Maybe we would need to have &lt;tt&gt;--module-path&lt;/tt&gt; &quot;workspace/surefire-jpms-bug/target/classes&quot; + &quot;workspace/surefire-jpms-bug/target/test-classes&quot;.&lt;/p&gt;

&lt;p&gt;Let me know your solution.&lt;/p&gt;</comment>
                            <comment id="17390844" author="ck@newsclub.de" created="Sat, 31 Jul 2021 02:53:23 +0000"  >&lt;p&gt;Ah, maybe that&apos;s the misunderstanding: I&apos;m fine with my tests being on the classpath / in the unnamed module. I understand in some scenarios, you may want to modularize your tests, too (then you&apos;d have to move them to a separate test package, though). This is not what I want. I want the test classes in the same package as the code under test (like it was practice before JPMS, and which is still supported in Eclipse when only the code under src/main/java has a module-info.java).&lt;/p&gt;

&lt;p&gt;This works out of the box, as long as I keep all methods public. And this enabled by the existing &lt;tt&gt;--add-exports&lt;/tt&gt; statemen in&#160;ModularClasspathForkConfiguration.java.&lt;/p&gt;

&lt;p&gt;My proposed solution would be to change that &lt;tt&gt;-&lt;del&gt;add-exports&lt;/tt&gt;&#160;to &lt;tt&gt;&lt;/del&gt;-add-opens&lt;/tt&gt;. &quot;add-opens&quot; is like add-exports plus access to package-level protected types and methods, which seems to be a good default when no module-info.java was specified for the test code under src/test/java.&lt;/p&gt;

&lt;p&gt;Again, it solves the problem at least for me, and I don&apos;t see any downsides. What am I missing?&lt;/p&gt;</comment>
                            <comment id="17391030" author="tibor17" created="Sat, 31 Jul 2021 18:08:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ck%40newsclub.de&quot; class=&quot;user-hover&quot; rel=&quot;ck@newsclub.de&quot;&gt;ck@newsclub.de&lt;/a&gt;&lt;br/&gt;
I am not against to give it a try with &quot;add-opens&quot;.&lt;br/&gt;
If you would open a pullrequest on Surefire project at GitHub, we will clearly see if all the unit and integration tests pass on GH CI.&lt;/p&gt;</comment>
                            <comment id="17488891" author="JIRAUSER283616" created="Tue, 8 Feb 2022 14:33:11 +0000"  >&lt;p&gt;Hi there,&lt;/p&gt;

&lt;p&gt;I&apos;m currently having the same issue as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ck%40newsclub.de&quot; class=&quot;user-hover&quot; rel=&quot;ck@newsclub.de&quot;&gt;ck@newsclub.de&lt;/a&gt; trying to modularise my existing application.&lt;/p&gt;

&lt;p&gt;Currently all proposed solutions are not good enough to my requirements :&#160;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://maven.apache.org/surefire/maven-surefire-plugin/examples/jpms.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&quot;official surefire solution&quot;&lt;/a&gt; to have unit tests in a dedicated JPMS module requiring the &lt;tt&gt;my.module.main&lt;/tt&gt; module
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;I can&apos;t test &quot;&lt;tt&gt;package private&quot;&lt;/tt&gt; methods or classes. &lt;ins&gt;I don&apos;t want to change my code visibility to be able to test it&lt;/ins&gt;.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;A variation of this solution could be to set package private classes/methods as public and to move them to a package &quot;&lt;tt&gt;exported ... to my.module.test&lt;/tt&gt;&quot; :
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;Still &lt;ins&gt;this is really painful with a big codebase&lt;/ins&gt; and introduce a link to maintain between main and test modules.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;To update all Junit test methods visibility to &quot;public&quot; :&#160;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;As stated by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ck%40newsclub.de&quot; class=&quot;user-hover&quot; rel=&quot;ck@newsclub.de&quot;&gt;ck@newsclub.de&lt;/a&gt; &lt;ins&gt;this is considered as violation by PMD&lt;/ins&gt; and some other static analysis tools. I tend to agree with them and would like to follow JUnit 5 standard (plus it&apos;s an easy trap, I felt into !)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;



&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;To use version 3.0.0-M2 of the plugin and set &lt;a href=&quot;https://maven.apache.org/surefire/maven-surefire-plugin/test-mojo.html#useModulePath&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;useModulePath&lt;/a&gt; to &lt;tt&gt;false&lt;/tt&gt;, then JPMS module-info.java will be ignored and I&apos;ll fall back to the &quot;pre-JPMS&quot; world.
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;I can&apos;t use a milestone version in my company. But it could be a good workaround to backport it in the next 2.x version.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So I really feel the need to have that handled by the Surefire plugin, have you started a PR somewhere &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ck%40newsclub.de&quot; class=&quot;user-hover&quot; rel=&quot;ck@newsclub.de&quot;&gt;ck@newsclub.de&lt;/a&gt; ?&lt;/p&gt;

&lt;p&gt;Is there any current work on this topic since July 2021 ?&lt;/p&gt;</comment>
                            <comment id="17488918" author="tibor17" created="Tue, 8 Feb 2022 14:54:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ck%40newsclub.de&quot; class=&quot;user-hover&quot; rel=&quot;ck@newsclub.de&quot;&gt;ck@newsclub.de&lt;/a&gt;&#160;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nilsR&quot; class=&quot;user-hover&quot; rel=&quot;nilsR&quot;&gt;nilsR&lt;/a&gt;&#160;&lt;br/&gt;
Feel free to provide a PR on Github.&lt;br/&gt;
We already have some integration tests, so we should see the result of the tests on GH.&lt;br/&gt;
The change is relatively easy, you can see the target for your change in the class &lt;tt&gt;ModularClasspathForkConfiguration&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17488922" author="tibor17" created="Tue, 8 Feb 2022 15:01:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rfscholte&quot; class=&quot;user-hover&quot; rel=&quot;rfscholte&quot;&gt;rfscholte&lt;/a&gt;&lt;br/&gt;
Can you please make an advice or confirm the change from &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;--add-exports
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;--add-opens
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; as it is mentioned in the &lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1909?focusedCommentId=17366928&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17366928&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;comment&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17488935" author="rfscholte" created="Tue, 8 Feb 2022 15:14:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sor&quot; class=&quot;user-hover&quot; rel=&quot;sor&quot;&gt;sor&lt;/a&gt; is the test+jpms expert&lt;/p&gt;</comment>
                            <comment id="17488956" author="tibor17" created="Tue, 8 Feb 2022 15:39:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nilsR&quot; class=&quot;user-hover&quot; rel=&quot;nilsR&quot;&gt;nilsR&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;If you are talking about package visibility, you are probably talking about your files module-info.java.&lt;br/&gt;
But what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ck%40newsclub.de&quot; class=&quot;user-hover&quot; rel=&quot;ck@newsclub.de&quot;&gt;ck@newsclub.de&lt;/a&gt; was talking about was different thing. He was talking about this args file content and it is no PMD harmful if we add opens of your packages to Surefire packages instead of add-exports:&lt;/p&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[DEBUG] args file content:
--module-path
&quot;workspace/surefire-jpms-bug/target/classes&quot;
--class-path
&quot;.m2/repository/org/apache/maven/surefire/surefire-booter/3.0.0-M5/surefire-booter-3.0.0-M5.jar:.m2/repository/org/apache/maven/surefire/surefire-api/3.0.0-M5/surefire-api-3.0.0-M5.jar:.m2/repository/org/apache/maven/surefire/surefire-logger-api/3.0.0-M5/surefire-logger-api-3.0.0-M5.jar:.m2/repository/org/apache/maven/surefire/surefire-shared-utils/3.0.0-M4/surefire-shared-utils-3.0.0-M4.jar:.m2/repository/org/apache/maven/surefire/surefire-extensions-spi/3.0.0-M5/surefire-extensions-spi-3.0.0-M5.jar:workspace/surefire-jpms-bug/target/test-classes:.m2/repository/org/junit/jupiter/junit-jupiter/5.7.1/junit-jupiter-5.7.1.jar:.m2/repository/org/junit/jupiter/junit-jupiter-api/5.7.1/junit-jupiter-api-5.7.1.jar:.m2/repository/org/apiguardian/apiguardian-api/1.1.0/apiguardian-api-1.1.0.jar:.m2/repository/org/opentest4j/opentest4j/1.2.0/opentest4j-1.2.0.jar:.m2/repository/org/junit/platform/junit-platform-commons/1.7.1/junit-platform-commons-1.7.1.jar:.m2/repository/org/junit/jupiter/junit-jupiter-params/5.7.1/junit-jupiter-params-5.7.1.jar:.m2/repository/org/junit/jupiter/junit-jupiter-engine/5.7.1/junit-jupiter-engine-5.7.1.jar:.m2/repository/org/junit/platform/junit-platform-engine/1.7.1/junit-platform-engine-1.7.1.jar:.m2/repository/org/apache/maven/surefire/surefire-junit-platform/3.0.0-M5/surefire-junit-platform-3.0.0-M5.jar:.m2/repository/org/apache/maven/surefire/common-java5/3.0.0-M5/common-java5-3.0.0-M5.jar:.m2/repository/org/junit/platform/junit-platform-launcher/1.7.1/junit-platform-launcher-1.7.1.jar&quot;
--patch-module
surefire.jpms.bug=&quot;workspace/surefire-jpms-bug/target/test-classes&quot;
--add-exports
surefire.jpms.bug/surefire.test=ALL-UNNAMED
--add-modules
surefire.jpms.bug
--add-reads
surefire.jpms.bug=ALL-UNNAMED
org.apache.maven.surefire.booter.ForkedBooter
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is used as follows &lt;tt&gt;java @args&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17488968" author="sor" created="Tue, 8 Feb 2022 15:53:33 +0000"  >&lt;p&gt;Users, project authors, testers and dev folks ... should be in control what happens at &lt;span class=&quot;error&quot;&gt;&amp;#91;test-&amp;#93;&lt;/span&gt;compile and &lt;span class=&quot;error&quot;&gt;&amp;#91;test-&amp;#93;&lt;/span&gt;runtime.&lt;/p&gt;

&lt;p&gt;So, as I see it, changing from `-&lt;del&gt;add-exports` to `&lt;/del&gt;&lt;del&gt;add-opens` might help in this case; but also break other use-cases where `&lt;/del&gt;-add-exports` was the desired flag. Perhaps, make it configurable?&lt;/p&gt;

&lt;p&gt;(Note: I wrote about an article on how to tackle this &quot;command-line tools vs build tools vs IDE issues&quot; here: &lt;a href=&quot;https://sormuras.github.io/blog/2018-09-11-testing-in-the-modular-world&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://sormuras.github.io/blog/2018-09-11-testing-in-the-modular-world&lt;/a&gt; &#8211; it also includes an alternative test plugin that keeps you in control.)&lt;/p&gt;</comment>
                            <comment id="17489041" author="JIRAUSER283616" created="Tue, 8 Feb 2022 18:03:57 +0000"  >&lt;p&gt;I&apos;ve created a PR for a drop in replacement of &lt;tt&gt;&lt;del&gt;{&lt;/del&gt;}add-exports{-&lt;/tt&gt;} in favor of &lt;tt&gt;-add-opens&lt;/tt&gt; just to be sure nothing breaks on the CI.&lt;/p&gt;

&lt;p&gt;I will try to add this as an optional configuration later on.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;(By the way, I confirm that I do not need to have public JUnit5 test methods with this version of Surefire)&lt;/p&gt;</comment>
                            <comment id="17493666" author="tibor17" created="Thu, 17 Feb 2022 05:58:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=6b4ccdd19f904cdef710a126e2b9af4b1c7b60df&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=6b4ccdd19f904cdef710a126e2b9af4b1c7b60df&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17494200" author="tibor17" created="Thu, 17 Feb 2022 20:02:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=deee5171afe7da953ad4af8e93050b2c7963dc1f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=maven-surefire.git;a=commit;h=deee5171afe7da953ad4af8e93050b2c7963dc1f&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17853399" author="githubbot" created="Sat, 8 Jun 2024 16:39:41 +0000"  >&lt;p&gt;michael-o closed pull request #461: &lt;a href=&quot;https://issues.apache.org/jira/browse/SUREFIRE-1909&quot; title=&quot;Support JUnit 5 reflection access by changing add-exports to add-opens&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SUREFIRE-1909&quot;&gt;&lt;del&gt;SUREFIRE-1909&lt;/del&gt;&lt;/a&gt; Replace --add-exports with --add-opens&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-surefire/pull/461&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/pull/461&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17853400" author="githubbot" created="Sat, 8 Jun 2024 16:39:42 +0000"  >&lt;p&gt;michael-o commented on PR #461:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/maven-surefire/pull/461#issuecomment-2156098250&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/maven-surefire/pull/461#issuecomment-2156098250&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   Code has been merged and issue fixed.&lt;/p&gt;

</comment>
                            <comment id="17995309" author="olamy" created="Fri, 4 Jul 2025 07:38:27 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-surefire/issues/2946&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-surefire#2946&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13027143" name="surefire-jpms-bug.tar.gz" size="1036" author="ck@newsclub.de" created="Tue, 22 Jun 2021 01:40:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0qbfs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>