<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:09:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SUREFIRE-813] Randomly wrong tests count and empty summary files with JUnitProvider47 when forking the tests.</title>
                <link>https://issues.apache.org/jira/browse/SUREFIRE-813</link>
                <project id="12317927" key="SUREFIRE">Maven Surefire (Moved to GitHub Issues)</project>
                    <description>&lt;p&gt;When running the test suite, with forkMode set and junit provider 47, we can have some test results missing. The test class is executed, but:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the summary file is empty (exists, but as a zero length file)&lt;/li&gt;
	&lt;li&gt;the global test count is not increased.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It&apos;s random, and does not occurs all the time. The occurrence seems increased when the machine is loaded, but it&apos;s more an impression. In our case, with ~250 test classes, it occurs on average once per run (so it&apos;s a real problem). It seems to occur more if we activate &apos;perthread&apos; parallelization.&lt;/p&gt;

&lt;p&gt;I added some log lines, and it seems that ForkClient does not receive all the test events when the problem occurs. It receives:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ForkingRunListener.BOOTERCODE_TESTSET_STARTING&lt;/li&gt;
	&lt;li&gt;ForkingRunListener.BOOTERCODE_TEST_STARTING&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;But not the final: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ForkingRunListener.BOOTERCODE_TEST_SUCCEEDED&lt;/li&gt;
	&lt;li&gt;ForkingRunListener.BOOTERCODE_TESTSET_COMPLETED&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The original issue is on Linux, java 1.6, with a lot of tests running. I wrote a test case, hopefully reproducing the real issue with surefire 2.10 and 2.11. It&apos;s still random, but fails 50% of the time on my machine (laptop 2 cores, Windows 7, 64 bits, jdk1.6.0_24).&lt;/p&gt;

&lt;p&gt;In this example, we create a thread writing 1000 lines of &apos;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot; in stdout in the tear down method.&lt;/p&gt;

&lt;p&gt;That&apos;s an example of success with surefire 2.11. You see that exactly two lines of &apos;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&apos; has been written to the console. On some other successes it can be zero lines or more.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Concurrency config is parallel=&apos;classes&apos;, perCoreThreadCount=true, threadCount=2, useUnlimitedThreads=false
Running Test6
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.002 sec
658:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
659:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2.724s
[INFO] Finished at: Tue Dec 27 11:46:03 CET 2011
[INFO] Final Memory: 10M/109M
[INFO] ------------------------------------------------------------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Error case, with surefire 2.11. In this one there is no &apos;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&apos; in the output, but you can have errors with multiple such lines.&lt;br/&gt;
You see that the number of tests run is zero.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Concurrency config is parallel=&apos;classes&apos;, perCoreThreadCount=true, threadCount=2, useUnlimitedThreads=false
Running Test6

Results :

Tests run: 0, Failures: 0, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2.820s
[INFO] Finished at: Tue Dec 27 11:48:02 CET 2011
[INFO] Final Memory: 10M/109M
[INFO] ------------------------------------------------------------------------
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:2.11:test (default-test) on project surefireparametizedbug: No tests were executed!  (Set -DfailIfNoTests=false to ignore this error.) -&amp;gt; [Help 1]
[ERROR] 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;With junit4 instead of junit47 it seems it never fails, but you can still have some AAA lines in the final output:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running Test6
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.07 sec
18:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
19:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
20:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
21:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
22:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2.667s
[INFO] Finished at: Tue Dec 27 11:54:16 CET 2011
[INFO] Final Memory: 10M/114M
[INFO] ------------------------------------------------------------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;It can fail as well (but less often it seems) if redirectTestOutputToFile is set to false.&lt;br/&gt;
It fails as well with forkMode=once (on surefire 2.11 at least).&lt;br/&gt;
parallel is set to &quot;classes&quot;; but if fails as well if it&apos;s not set (still on surefire 2.11 at least).&lt;/p&gt;


&lt;p&gt;Note that I write 1000 lines in the test case, it can fail with much less as well. It&apos;s just a simplification of the initially complex issue.&lt;/p&gt;</description>
                <environment>test case checked on windows 7 64 bits; issues on Linux.&lt;br/&gt;
jdk1.6.0_24</environment>
        <key id="12810330">SUREFIRE-813</key>
            <summary>Randomly wrong tests count and empty summary files with JUnitProvider47 when forking the tests.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="krosenvold">Kristian Rosenvold</assignee>
                                    <reporter username="nkeywal">Nicolas Liochon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Dec 2011 05:28:28 +0000</created>
                <updated>Fri, 4 Jul 2025 07:17:36 +0000</updated>
                            <resolved>Fri, 30 Dec 2011 04:26:04 +0000</resolved>
                                    <version>2.10</version>
                    <version>2.11</version>
                                    <fixVersion>2.12</fixVersion>
                                    <component>Junit 4.7+ (parallel) support</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="14455153" author="krosenvold" created="Tue, 27 Dec 2011 05:56:19 +0000"  >&lt;p&gt;Your testcase seems to demonstrate that output from the java process  that happens &lt;b&gt;after&lt;/b&gt; termination of the test itself seems to create trouble, and I can reproduce that; with or without any threading involved. Would that seem to be consistent with what you&apos;re experiencing ?&lt;/p&gt;</comment>
                            <comment id="14455190" author="nkeywal" created="Tue, 27 Dec 2011 06:02:21 +0000"  >&lt;p&gt;Yes, it&apos;s consistent:we have many lines (~100) logged during the tests tear down, and it&apos;s not always in a separate thread.&lt;/p&gt;</comment>
                            <comment id="14455103" author="krosenvold" created="Tue, 27 Dec 2011 06:47:51 +0000"  >&lt;p&gt;The root cause of this is a ConcurrentModificationException in LogicalStream line 81. While avoding the exception itself is simple, we again have somewhat of a halting problem, since there is no way to determined when any forked threads are finished. At this moment the only &quot;solution&quot; I can come up with is to detach further output from the test-cases in question and just mix it in with the single global stream.&lt;/p&gt;

&lt;p&gt;Additionally, we could iterate all the streams on termination and maybe append &quot;left over&quot; output. This stuff isn&apos;t too easy to get right, so any suggestions are welcome &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="14455208" author="nkeywal" created="Tue, 27 Dec 2011 07:42:17 +0000"  >&lt;p&gt;What you mean for LogicalStream line 81 is that it&apos;s possible to add a synchronized to the method to avoid concurrent modifications?&lt;/p&gt;

&lt;p&gt;In our case, we have:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;daemon threads that will execute tasks every seconds or so&lt;/li&gt;
	&lt;li&gt;shutdown hooks&lt;/li&gt;
	&lt;li&gt;finalizers looking for unclosed resources and logging alerts if it&apos;s the case.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So deciding that the output is finished is not easy &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
But as we fork with forkMode = always (and soon with perthread), it could be attributed to the right test class. &lt;/p&gt;


</comment>
                            <comment id="14455154" author="krosenvold" created="Tue, 27 Dec 2011 08:12:50 +0000"  >&lt;p&gt;simple synchronization would be a stopgap that would relieve the critical part of the problem, but a good solution would have to cover what to to with output receiced &quot;after&quot; the LogicalStream has been reported (in other words, after &quot;writeDetails&quot; has been invoked)&lt;/p&gt;</comment>
                            <comment id="14455192" author="krosenvold" created="Tue, 27 Dec 2011 08:14:09 +0000"  >&lt;p&gt;Btw; this is mostly a problem with the concurrent reporter, it should be a lot better with non-concurrent reporter and forkMode=perthread&lt;/p&gt;</comment>
                            <comment id="14455104" author="nkeywal" created="Tue, 27 Dec 2011 08:34:29 +0000"  >&lt;p&gt;Yep, with the synchronized all the events are received by ForkClient. However there is something fishy afterward I need to look at.&lt;/p&gt;

&lt;p&gt;There is a non concurrent reporter? By default with categories/JUnit47 all the reporters are concurrent?&lt;/p&gt;</comment>
                            <comment id="14455209" author="nkeywal" created="Tue, 27 Dec 2011 12:16:52 +0000"  >&lt;p&gt;After more tests, I confirm it works well with the synchronized method. I&apos;ve done as well an unrelated modification to close the fork client when there is an exception. The change is there: &lt;a href=&quot;https://github.com/nkeywal/maven-surefire/commit/be9c95b4acdf2ebddb1ee5e0564d411c6eae6f3a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/nkeywal/maven-surefire/commit/be9c95b4acdf2ebddb1ee5e0564d411c6eae6f3a&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14455156" author="krosenvold" created="Fri, 30 Dec 2011 04:26:05 +0000"  >&lt;p&gt;Fixed with unit test in r1225784, thanks for the test class !&lt;/p&gt;</comment>
                            <comment id="17994216" author="olamy" created="Fri, 4 Jul 2025 07:17:36 +0000"  >&lt;p&gt;This project has moved from Jira to GitHub Issues. This issue was migrated to &lt;a href=&quot;https://github.com/apache/maven-surefire/issues/1752&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;apache/maven-surefire#1752&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12720261" name="Test6.java" size="725" author="nkeywal" created="Tue, 27 Dec 2011 05:28:30 +0000"/>
                            <attachment id="12720201" name="pom.xml" size="1774" author="nkeywal" created="Tue, 27 Dec 2011 05:28:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2bbbj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12312220" key="com.atlassian.jira.plugin.system.customfieldtypes:radiobuttons">
                        <customfieldname>Testcase included</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="11060"><![CDATA[Yes]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>