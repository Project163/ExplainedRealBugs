diff --git a/pom.xml b/pom.xml
index 1465f17e4..bb5ae5f52 100644
--- a/pom.xml
+++ b/pom.xml
@@ -241,7 +241,7 @@
       <dependency>
         <groupId>org.apache.maven.shared</groupId>
         <artifactId>maven-shared-utils</artifactId>
-        <version>0.3</version>
+        <version>0.3-SNAPSHOT</version>
       </dependency>
       <dependency>
         <groupId>org.apache.maven.shared</groupId>
diff --git a/surefire-providers/common-java5/src/main/java/org/apache/maven/surefire/report/SmartStackTraceParser.java b/surefire-providers/common-java5/src/main/java/org/apache/maven/surefire/report/SmartStackTraceParser.java
index 4923eb955..13bc6c935 100644
--- a/surefire-providers/common-java5/src/main/java/org/apache/maven/surefire/report/SmartStackTraceParser.java
+++ b/surefire-providers/common-java5/src/main/java/org/apache/maven/surefire/report/SmartStackTraceParser.java
@@ -85,6 +85,11 @@ public String getString()
         List<StackTraceElement> stackTraceElements = focusOnClass( stackTrace, testClass );
         Collections.reverse( stackTraceElements );
         StackTraceElement stackTraceElement;
+        if (stackTrace.length == 0)
+        {
+            result.append( simpleName );
+            result.append("XX");
+        }
         for ( int i = 0; i < stackTraceElements.size(); i++ )
         {
             stackTraceElement = stackTraceElements.get( i );
@@ -175,7 +180,7 @@ private String getTruncatedMessage( int i )
 
     private boolean rootIsInclass()
     {
-        return stackTrace[0].getClassName().equals( testClassName );
+        return  stackTrace.length > 0 && stackTrace[0].getClassName().equals( testClassName );
     }
 
     static List<StackTraceElement> focusOnClass( StackTraceElement[] stackTrace, Class clazz )
@@ -183,7 +188,7 @@ static List<StackTraceElement> focusOnClass( StackTraceElement[] stackTrace, Cla
         List<StackTraceElement> result = new ArrayList<StackTraceElement>();
         for ( StackTraceElement element : stackTrace )
         {
-            if ( isInSupers( clazz, element.getClassName() ) )
+            if ( element != null && isInSupers( clazz, element.getClassName() ) )
             {
                 result.add( element );
             }
diff --git a/surefire-providers/common-java5/src/test/java/org/apache/maven/surefire/report/SmartStackTraceParserTest.java b/surefire-providers/common-java5/src/test/java/org/apache/maven/surefire/report/SmartStackTraceParserTest.java
index c97e5b828..8880ed01a 100644
--- a/surefire-providers/common-java5/src/test/java/org/apache/maven/surefire/report/SmartStackTraceParserTest.java
+++ b/surefire-providers/common-java5/src/test/java/org/apache/maven/surefire/report/SmartStackTraceParserTest.java
@@ -19,6 +19,7 @@
  * under the License.
  */
 
+import java.lang.reflect.Field;
 import java.util.List;
 
 import junit.framework.Assert;
@@ -228,4 +229,25 @@ public void testNonClassNameStacktrace()
             new SmartStackTraceParser( "Not a class name", new Throwable( "my message" ) );
         assertEquals( "my message", smartStackTraceParser.getString() );
     }
+
+    public void testNullElementInStackTrace()
+            throws Exception
+    {
+        ATestClass aTestClass = new ATestClass();
+        try
+        {
+            aTestClass.failInAssert();
+        }
+        catch ( AssertionError e )
+        {
+            SmartStackTraceParser smartStackTraceParser = new SmartStackTraceParser( ATestClass.class, e );
+            Field stackTrace = SmartStackTraceParser.class.getDeclaredField("stackTrace");
+            stackTrace.setAccessible(true);
+            stackTrace.set(smartStackTraceParser, new StackTraceElement[0]);
+            String res = smartStackTraceParser.getString();
+            assertEquals( "ATestClass X is not Z", res );
+        }
+
+    }
+
 }
