{"url":"https://api.github.com/repos/activeadmin/activeadmin/issues/4074","repository_url":"https://api.github.com/repos/activeadmin/activeadmin","labels_url":"https://api.github.com/repos/activeadmin/activeadmin/issues/4074/labels{/name}","comments_url":"https://api.github.com/repos/activeadmin/activeadmin/issues/4074/comments","events_url":"https://api.github.com/repos/activeadmin/activeadmin/issues/4074/events","html_url":"https://github.com/activeadmin/activeadmin/issues/4074","id":101044162,"node_id":"MDU6SXNzdWUxMDEwNDQxNjI=","number":4074,"title":"The default Collection Applies ordering should be preserved","user":{"login":"wspurgin","id":3472781,"node_id":"MDQ6VXNlcjM0NzI3ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3472781?v=4","gravatar_id":"","url":"https://api.github.com/users/wspurgin","html_url":"https://github.com/wspurgin","followers_url":"https://api.github.com/users/wspurgin/followers","following_url":"https://api.github.com/users/wspurgin/following{/other_user}","gists_url":"https://api.github.com/users/wspurgin/gists{/gist_id}","starred_url":"https://api.github.com/users/wspurgin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wspurgin/subscriptions","organizations_url":"https://api.github.com/users/wspurgin/orgs","repos_url":"https://api.github.com/users/wspurgin/repos","events_url":"https://api.github.com/users/wspurgin/events{/privacy}","received_events_url":"https://api.github.com/users/wspurgin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"timoschilling","id":165599,"node_id":"MDQ6VXNlcjE2NTU5OQ==","avatar_url":"https://avatars.githubusercontent.com/u/165599?v=4","gravatar_id":"","url":"https://api.github.com/users/timoschilling","html_url":"https://github.com/timoschilling","followers_url":"https://api.github.com/users/timoschilling/followers","following_url":"https://api.github.com/users/timoschilling/following{/other_user}","gists_url":"https://api.github.com/users/timoschilling/gists{/gist_id}","starred_url":"https://api.github.com/users/timoschilling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timoschilling/subscriptions","organizations_url":"https://api.github.com/users/timoschilling/orgs","repos_url":"https://api.github.com/users/timoschilling/repos","events_url":"https://api.github.com/users/timoschilling/events{/privacy}","received_events_url":"https://api.github.com/users/timoschilling/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"timoschilling","id":165599,"node_id":"MDQ6VXNlcjE2NTU5OQ==","avatar_url":"https://avatars.githubusercontent.com/u/165599?v=4","gravatar_id":"","url":"https://api.github.com/users/timoschilling","html_url":"https://github.com/timoschilling","followers_url":"https://api.github.com/users/timoschilling/followers","following_url":"https://api.github.com/users/timoschilling/following{/other_user}","gists_url":"https://api.github.com/users/timoschilling/gists{/gist_id}","starred_url":"https://api.github.com/users/timoschilling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timoschilling/subscriptions","organizations_url":"https://api.github.com/users/timoschilling/orgs","repos_url":"https://api.github.com/users/timoschilling/repos","events_url":"https://api.github.com/users/timoschilling/events{/privacy}","received_events_url":"https://api.github.com/users/timoschilling/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":2,"created_at":"2015-08-14T16:10:12Z","updated_at":"2015-08-17T23:26:01Z","closed_at":"2015-08-17T23:25:56Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Here's an error in batch_actions from 1.0.0.pre1: \n\n```\nundefined method `ransack' for #<#<Class:0x00000007f0d7d0>:0x007fab3ed05ca0>\n```\n\nThis bug occurs because of the order in which the [COLLECTION_APPLIES in are set within the 1.0.0.pre1 block](https://github.com/activeadmin/activeadmin/blob/v1.0.0.pre1/lib/active_admin/batch_actions/controller.rb#L28-L34)\n\nI can see that as of 49eea30 the ordering was fixed, but the root cause is all from how the options and defaults are merged [inside of data_access](https://github.com/activeadmin/activeadmin/blob/v1.0.0.pre1/lib/active_admin/resource_controller/data_access.rb#L277-L281). \n\nUsing the `options.fetch(:only, COLLECTION_APPLIES)` won't preserve the default order (which is the correct order) like thus:\n\n``` ruby\ndefaults = [ :foo, :bar, :baz ]\n# => [:foo, :bar, :baz]\nonly = {only: [:baz, :bar]} # note the change in ordering\nArray(only.fetch(:only, defaults))  \n# => [:baz, :bar] and now the ordering is wrong :(\n```\n\nWhich isn't a big deal if the order doesn't matter, but the order _does_ matter in this case.\n\nIt isn't as pretty, but performing a select and a reject is more suited to preserve the order of the defaults:\n\n``` ruby\ndefaults = [ :foo, :bar, :baz, :ray, :day ]\n# => [:foo, :bar, :baz, :ray, :day]\noptions = { only: [:day, :bar, :foo, :ray], except: [:ray, :foo] }\n\nonly = Array(options.fetch(:only, defaults))\n# => [:day, :bar, :foo, :ray] again there's a change in the order\n\nexcept = Array(options.fetch(:except, []))\n# => [:ray, :foo] likewise here too\n\nappliers = defaults\n               .select { |applier| only.include? applier }\n               .reject { |applier| except.include? applier }\n# => [:bar, :day] Note that now the original order is preserved with the options applied\n```\n\nThat's my two-cents on how to do that a little better. It'll be especially helpful if/when you decide to expose some of that configuration ability with how the collections are retrieved to ActiveAdmin users such as myself. That way they won't get headaches wondering why their unbeknownst out-of-order options are making filtering/scoping/includes fail.\n","closed_by":{"login":"timoschilling","id":165599,"node_id":"MDQ6VXNlcjE2NTU5OQ==","avatar_url":"https://avatars.githubusercontent.com/u/165599?v=4","gravatar_id":"","url":"https://api.github.com/users/timoschilling","html_url":"https://github.com/timoschilling","followers_url":"https://api.github.com/users/timoschilling/followers","following_url":"https://api.github.com/users/timoschilling/following{/other_user}","gists_url":"https://api.github.com/users/timoschilling/gists{/gist_id}","starred_url":"https://api.github.com/users/timoschilling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/timoschilling/subscriptions","organizations_url":"https://api.github.com/users/timoschilling/orgs","repos_url":"https://api.github.com/users/timoschilling/repos","events_url":"https://api.github.com/users/timoschilling/events{/privacy}","received_events_url":"https://api.github.com/users/timoschilling/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/activeadmin/activeadmin/issues/4074/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/activeadmin/activeadmin/issues/4074/timeline","performed_via_github_app":null,"state_reason":"completed"}