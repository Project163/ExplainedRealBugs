{"url":"https://api.github.com/repos/activeadmin/activeadmin/issues/8108","repository_url":"https://api.github.com/repos/activeadmin/activeadmin","labels_url":"https://api.github.com/repos/activeadmin/activeadmin/issues/8108/labels{/name}","comments_url":"https://api.github.com/repos/activeadmin/activeadmin/issues/8108/comments","events_url":"https://api.github.com/repos/activeadmin/activeadmin/issues/8108/events","html_url":"https://github.com/activeadmin/activeadmin/issues/8108","id":1943536190,"node_id":"I_kwDOAAlWUc5z2AI-","number":8108,"title":"ransack never receives an auth object","user":{"login":"Fire-Dragon-DoL","id":1329559,"node_id":"MDQ6VXNlcjEzMjk1NTk=","avatar_url":"https://avatars.githubusercontent.com/u/1329559?v=4","gravatar_id":"","url":"https://api.github.com/users/Fire-Dragon-DoL","html_url":"https://github.com/Fire-Dragon-DoL","followers_url":"https://api.github.com/users/Fire-Dragon-DoL/followers","following_url":"https://api.github.com/users/Fire-Dragon-DoL/following{/other_user}","gists_url":"https://api.github.com/users/Fire-Dragon-DoL/gists{/gist_id}","starred_url":"https://api.github.com/users/Fire-Dragon-DoL/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Fire-Dragon-DoL/subscriptions","organizations_url":"https://api.github.com/users/Fire-Dragon-DoL/orgs","repos_url":"https://api.github.com/users/Fire-Dragon-DoL/repos","events_url":"https://api.github.com/users/Fire-Dragon-DoL/events{/privacy}","received_events_url":"https://api.github.com/users/Fire-Dragon-DoL/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-10-14T20:16:48Z","updated_at":"2023-12-01T20:45:16Z","closed_at":"2023-12-01T13:32:11Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Did you find a bug?\r\n\r\n`ransack` method never receives an \"auth object\" to be used in model methods.\r\nIf some filters are shown/hidden using `if:` based on authorization, this raises an exception now because `ransackable_attributes` might not be authorizing certain attributes to be searched for certain users.\r\n\r\n### Expected behavior\r\n\r\nhttps://github.com/activeadmin/activeadmin/blob/ecf730d8d51088690ea4fa5b6177d2e588b0b261/lib/active_admin/resource_controller/data_access.rb#L218\r\n\r\nThis line should pass a second argument that represents the auhorizing user. In case of devise, I expect this to be either a user, or a \"cancancan\" ability (I'm not sure which is the most correct), or something else if a custom auth plugin is used.\r\nMaybe it could pass `auth_object: active_admin_authorization`, which is effectively what's used for authorization in activeadmin.\r\n\r\n### Actual behavior\r\n\r\nWhat actually happens?\r\nThe auth_object in `def self.ransackable_attributes(auth_object = nil)` is always nil\r\n\r\n### How to reproduce\r\n\r\nI will omit this since the source code is very explicit on the topic\r\n\r\n### Ideas\r\n\r\nThinking about this, it opens an incredible opportunity where the auth object could be a wrapper around the authorization adapter **and the controller** (or the active admin config). In this way, it could be possible to provide a default implementation of ransackable attributes that's based on the action filters (I'm not sure if the same is possible for associations)\r\n","closed_by":{"login":"mgrunberg","id":1459326,"node_id":"MDQ6VXNlcjE0NTkzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/1459326?v=4","gravatar_id":"","url":"https://api.github.com/users/mgrunberg","html_url":"https://github.com/mgrunberg","followers_url":"https://api.github.com/users/mgrunberg/followers","following_url":"https://api.github.com/users/mgrunberg/following{/other_user}","gists_url":"https://api.github.com/users/mgrunberg/gists{/gist_id}","starred_url":"https://api.github.com/users/mgrunberg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mgrunberg/subscriptions","organizations_url":"https://api.github.com/users/mgrunberg/orgs","repos_url":"https://api.github.com/users/mgrunberg/repos","events_url":"https://api.github.com/users/mgrunberg/events{/privacy}","received_events_url":"https://api.github.com/users/mgrunberg/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/activeadmin/activeadmin/issues/8108/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/activeadmin/activeadmin/issues/8108/timeline","performed_via_github_app":null,"state_reason":"completed"}