{"url":"https://api.github.com/repos/hyperium/hyper/issues/2687","repository_url":"https://api.github.com/repos/hyperium/hyper","labels_url":"https://api.github.com/repos/hyperium/hyper/issues/2687/labels{/name}","comments_url":"https://api.github.com/repos/hyperium/hyper/issues/2687/comments","events_url":"https://api.github.com/repos/hyperium/hyper/issues/2687/events","html_url":"https://github.com/hyperium/hyper/issues/2687","id":1046567573,"node_id":"I_kwDOAWaYQc4-YVqV","number":2687,"title":"`body::to_bytes` doctest fails with default feature set","user":{"login":"whentze","id":6296348,"node_id":"MDQ6VXNlcjYyOTYzNDg=","avatar_url":"https://avatars.githubusercontent.com/u/6296348?v=4","gravatar_id":"","url":"https://api.github.com/users/whentze","html_url":"https://github.com/whentze","followers_url":"https://api.github.com/users/whentze/followers","following_url":"https://api.github.com/users/whentze/following{/other_user}","gists_url":"https://api.github.com/users/whentze/gists{/gist_id}","starred_url":"https://api.github.com/users/whentze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/whentze/subscriptions","organizations_url":"https://api.github.com/users/whentze/orgs","repos_url":"https://api.github.com/users/whentze/repos","events_url":"https://api.github.com/users/whentze/events{/privacy}","received_events_url":"https://api.github.com/users/whentze/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":125710197,"node_id":"MDU6TGFiZWwxMjU3MTAxOTc=","url":"https://api.github.com/repos/hyperium/hyper/labels/C-bug","name":"C-bug","color":"d93f0b","default":false,"description":"Category: bug. Something is wrong. This is bad!"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-11-06T18:20:08Z","updated_at":"2021-11-08T18:47:08Z","closed_at":"2021-11-08T18:47:08Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Version**\r\n\r\nCurrent git master aka [8062714](https://github.com/hyperium/hyper/commit/80627141ede3cdaf37b833ee91d08be0af0f5c84)\r\n\r\n**Platform**\r\n\r\nLinux 5.14.0-4-amd64 #1 SMP Debian 5.14.16-1 (2021-11-03) x86_64 GNU/Linux\r\n\r\n**Description**\r\n\r\nI cloned the repo in order to hack on the code, and I started out by making sure I could run the tests.\r\nThat is, I did:\r\n```sh\r\ngit clone https://github.com/hyperium/hyper\r\ncd hyper\r\ncargo test\r\n```\r\n\r\nHowever, one of the doctests fails to compile:\r\n\r\n```\r\n   Doc-tests hyper\r\n\r\nrunning 6 tests\r\ntest src/ext.rs - ext::HeaderCaseMap (line 14) ... ignored\r\ntest src/ext.rs - ext::HeaderCaseMap (line 22) ... ignored\r\ntest src/body/to_bytes.rs - body::to_bytes::to_bytes (line 19) ... FAILED\r\ntest src/service/make.rs - service::make::make_service_fn (line 106) ... ok\r\ntest src/service/util.rs - service::util::service_fn (line 13) ... ok\r\ntest src/body/body.rs - body::body::Body::empty (line 123) ... ok\r\n\r\nfailures:\r\n\r\n---- src/body/to_bytes.rs - body::to_bytes::to_bytes (line 19) stdout ----\r\nerror[E0433]: failed to resolve: could not find `Client` in `hyper`\r\n  --> src/body/to_bytes.rs:28:21\r\n   |\r\n12 | let client = hyper::Client::new();\r\n   |                     ^^^^^^ could not find `Client` in `hyper`\r\n\r\nerror: aborting due to previous error\r\n\r\nFor more information about this error, try `rustc --explain E0433`.\r\nCouldn't compile the test.\r\n\r\nfailures:\r\n    src/body/to_bytes.rs - body::to_bytes::to_bytes (line 19)\r\n\r\ntest result: FAILED. 3 passed; 1 failed; 2 ignored; 0 measured; 0 filtered out; finished in 0.27s\r\n```\r\n\r\nIt looks like the test depends on some feature(s) outside of the default set.\r\nI successfully fixed the issue locally by adding a `#[cfg(...)]` guard to the test, but I'm not sure if the real bug is in fact that the test depends on extra features.\r\n\r\nAlso, there seems to be a [CI job](https://github.com/hyperium/hyper/blob/master/.github/workflows/CI.yml#L145) that runs the test against many feature sets. For some reason it did not catch this. Maybe I'm looking at the wrong thing, or the job is buggy, or it's just really bad luck. In any case, might be worth investigating.","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hyperium/hyper/issues/2687/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hyperium/hyper/issues/2687/timeline","performed_via_github_app":null,"state_reason":"completed"}