[{"url":"https://api.github.com/repos/hyperium/hyper/issues/comments/272945303","html_url":"https://github.com/hyperium/hyper/issues/1003#issuecomment-272945303","issue_url":"https://api.github.com/repos/hyperium/hyper/issues/1003","id":272945303,"node_id":"MDEyOklzc3VlQ29tbWVudDI3Mjk0NTMwMw==","user":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-01-16T19:33:15Z","updated_at":"2017-01-16T19:33:15Z","body":"There is a health check before using (in Pool, the status is checked that it is still `Idle`, and not expired), and the hangup on the socket will trigger the status to be set to `disabled`. Unfortunately, the hangup may take some time to be received, and so it is possible for a client to try to start a new request on the socket before we know it has been closed.\r\n\r\nFor this test case, I've added a sleep to the core to wait for a few milliseconds, since the socket is local, the race was likely just scheduling between the server and client threads. The sleep should make it deterministic, allowing this test to check that disconnected sockets are tossed.\r\n\r\nSeparately, for the case when a client tries a socket before receiving HUP, hyper should do similar to what Go's http client does: check if the socket has been used before, and if it has, try to use a new socket. There is a field to track that on the `Pooled` type, but it will take a little more work to check it, and also make sure it's safe to retry the request (idempotent method, or body hasn't been written, etc).","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/hyperium/hyper/issues/comments/272945303/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":924801848,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDkyNDgwMTg0OA==","url":"https://api.github.com/repos/hyperium/hyper/issues/events/924801848","actor":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"24611ddebbbbefe672e8c9174e229d110c8021c4","commit_url":"https://api.github.com/repos/hyperium/hyper/commits/24611ddebbbbefe672e8c9174e229d110c8021c4","created_at":"2017-01-16T19:50:00Z","performed_via_github_app":null},{"id":924856485,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDkyNDg1NjQ4NQ==","url":"https://api.github.com/repos/hyperium/hyper/issues/events/924856485","actor":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2eb71465e48c1273ae870e4dec52f36bffd58d8d","commit_url":"https://api.github.com/repos/hyperium/hyper/commits/2eb71465e48c1273ae870e4dec52f36bffd58d8d","created_at":"2017-01-16T20:46:30Z","performed_via_github_app":null},{"id":924867785,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDkyNDg2Nzc4NQ==","url":"https://api.github.com/repos/hyperium/hyper/issues/events/924867785","actor":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"e4232dd0d8a39955b467fc8e77ba7738e5a0a9cd","commit_url":"https://api.github.com/repos/hyperium/hyper/commits/e4232dd0d8a39955b467fc8e77ba7738e5a0a9cd","created_at":"2017-01-16T20:58:16Z","performed_via_github_app":null},{"id":924891336,"node_id":"MDExOkNsb3NlZEV2ZW50OTI0ODkxMzM2","url":"https://api.github.com/repos/hyperium/hyper/issues/events/924891336","actor":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"e4232dd0d8a39955b467fc8e77ba7738e5a0a9cd","commit_url":"https://api.github.com/repos/hyperium/hyper/commits/e4232dd0d8a39955b467fc8e77ba7738e5a0a9cd","created_at":"2017-01-16T21:22:45Z","state_reason":null,"performed_via_github_app":null}]