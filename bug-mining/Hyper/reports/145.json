{"url":"https://api.github.com/repos/hyperium/hyper/issues/1429","repository_url":"https://api.github.com/repos/hyperium/hyper","labels_url":"https://api.github.com/repos/hyperium/hyper/issues/1429/labels{/name}","comments_url":"https://api.github.com/repos/hyperium/hyper/issues/1429/comments","events_url":"https://api.github.com/repos/hyperium/hyper/issues/1429/events","html_url":"https://github.com/hyperium/hyper/issues/1429","id":292121967,"node_id":"MDU6SXNzdWUyOTIxMjE5Njc=","number":1429,"title":"Panicking in Client call","user":{"login":"xrl","id":693059,"node_id":"MDQ6VXNlcjY5MzA1OQ==","avatar_url":"https://avatars.githubusercontent.com/u/693059?v=4","gravatar_id":"","url":"https://api.github.com/users/xrl","html_url":"https://github.com/xrl","followers_url":"https://api.github.com/users/xrl/followers","following_url":"https://api.github.com/users/xrl/following{/other_user}","gists_url":"https://api.github.com/users/xrl/gists{/gist_id}","starred_url":"https://api.github.com/users/xrl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xrl/subscriptions","organizations_url":"https://api.github.com/users/xrl/orgs","repos_url":"https://api.github.com/users/xrl/repos","events_url":"https://api.github.com/users/xrl/events{/privacy}","received_events_url":"https://api.github.com/users/xrl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":125710197,"node_id":"MDU6TGFiZWwxMjU3MTAxOTc=","url":"https://api.github.com/repos/hyperium/hyper/labels/C-bug","name":"C-bug","color":"d93f0b","default":false,"description":"Category: bug. Something is wrong. This is bad!"},{"id":128399841,"node_id":"MDU6TGFiZWwxMjgzOTk4NDE=","url":"https://api.github.com/repos/hyperium/hyper/labels/A-client","name":"A-client","color":"fbca04","default":false,"description":"Area: client."},{"id":694496799,"node_id":"MDU6TGFiZWw2OTQ0OTY3OTk=","url":"https://api.github.com/repos/hyperium/hyper/labels/E-medium","name":"E-medium","color":"c2e0c6","default":false,"description":"Effort: medium. Some knowledge of how hyper internal works would be useful."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2018-01-27T13:36:15Z","updated_at":"2018-01-31T21:15:45Z","closed_at":"2018-01-29T19:58:19Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am sending requests to AWS Kinesis. Because of the small size of requests I have to generate many concurrent requests. I am using the futures stream::BufferUnordered to put a cap on concurrent requests. Now I have an issue where after ~30 seconds the tokio core panics and goes away. I'm creating on the order of 1000 concurrent requests.\r\n\r\nHere is the backtrace:\r\n\r\n```\r\n# cargo build --release; RUST_BACKTRACE=full ./target/release/kinesis-hyper-bug\r\n    Finished release [optimized + debuginfo] target(s) in 0.0 secs\r\nthread '<unnamed>' panicked at 'called `Result::unwrap()` on an `Err` value: SendError(\"...\")', libcore/result.rs:916:5\r\nstack backtrace:\r\n   0:       0x5917cfe83b - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::h01c1934f65de6f6a\r\n                               at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1:       0x5917d04451 - std::sys_common::backtrace::print::h87cc6ba9b94fa155\r\n                               at libstd/sys_common/backtrace.rs:68\r\n                               at libstd/sys_common/backtrace.rs:57\r\n   2:       0x5917cfade0 - std::panicking::default_hook::{{closure}}::hd04a5cd906658fa2\r\n                               at libstd/panicking.rs:381\r\n   3:       0x5917cfa915 - std::panicking::default_hook::h13d81f39b4233c4b\r\n                               at libstd/panicking.rs:397\r\n   4:       0x5917cfb22b - std::panicking::rust_panic_with_hook::hafca86651ef244e6\r\n                               at libstd/panicking.rs:577\r\n   5:       0x5917cfb0ee - std::panicking::begin_panic::h5e76eba7233d4218\r\n                               at libstd/panicking.rs:538\r\n   6:       0x5917cfafea - std::panicking::begin_panic_fmt::hff38b5bd065c125a\r\n                               at libstd/panicking.rs:522\r\n   7:       0x5917cfaf82 - rust_begin_unwind\r\n                               at libstd/panicking.rs:498\r\n   8:       0x5917d53730 - core::panicking::panic_fmt::h2b19f39e7a539ec5\r\n                               at libcore/panicking.rs:71\r\n   9:       0x5917bd533d - core::result::unwrap_failed::h5671d77bb13dd94c\r\n                               at /checkout/src/libcore/macros.rs:23\r\n  10:       0x5917bbf38d - <futures::future::chain::Chain<A, B, C>>::poll::h3bb254ec3dfd880b\r\n                               at /checkout/src/libcore/result.rs:782\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/hyper-0.11.15/src/client/mod.rs:226\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/and_then.rs:34\r\n                               at /checkout/src/libcore/result.rs:468\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/and_then.rs:33\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/chain.rs:39\r\n  11:       0x5917babf1d - <futures::future::and_then::AndThen<A, B, F> as futures::future::Future>::poll::hdc170a02017dfce5\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/and_then.rs:32\r\n  12:       0x5917cc4f45 - <hyper::client::FutureResponse as futures::future::Future>::poll::h4ce4ebd5cd641777\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/mod.rs:113\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/hyper-0.11.15/src/client/mod.rs:147\r\n  13:       0x5917bb03b3 - <rusoto_core::request::ClientFuture as futures::future::Future>::poll::hadcebab3f0932233\r\n                               at /root/.cargo/git/checkouts/rusoto-async-35a81945dd339d5f/eeddeab/rusoto/core/src/request.rs:189\r\n  14:       0x5917bbf720 - <futures::future::chain::Chain<A, B, C>>::poll::h3bf5afb35f09f954\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/chain.rs:26\r\n  15:       0x5917bb7794 - <futures::future::lazy::Lazy<F, R> as futures::future::Future>::poll::h76822e873224c5c5\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/then.rs:32\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/lazy.rs:82\r\n  16:       0x5917cd18ac - futures::task_impl::std::set::h8bc2ee5269bbd68e\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/mod.rs:113\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/mod.rs:289\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/mod.rs:363\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/std/mod.rs:78\r\n  17:       0x5917cd054e - <futures::task_impl::Spawn<T>>::poll_future_notify::h0ff7795838505ee3\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/mod.rs:363\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/mod.rs:289\r\n  18:       0x5917cd43ac - tokio_core::reactor::Core::poll::hc54e92f60d70a7d1\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-core-0.1.12/src/reactor/mod.rs:359\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/scoped-tls-0.1.0/src/lib.rs:135\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-core-0.1.12/src/reactor/mod.rs:358\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-core-0.1.12/src/reactor/mod.rs:319\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-core-0.1.12/src/reactor/mod.rs:307\r\n  19:       0x5917cd3961 - tokio_core::reactor::Core::turn::h802af95fae6f34c8\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/tokio-core-0.1.12/src/reactor/mod.rs:254\r\n  20:       0x5917bf3968 - std::sys_common::backtrace::__rust_begin_short_backtrace::h319e1ff7df31b72b\r\n                               at /root/.cargo/git/checkouts/rusoto-async-35a81945dd339d5f/eeddeab/rusoto/core/src/reactor.rs:63\r\n                               at /checkout/src/libstd/sys_common/backtrace.rs:133\r\n  21:       0x5917d1683e - __rust_maybe_catch_panic\r\n                               at libpanic_unwind/lib.rs:102\r\n  22:       0x5917bb61d8 - <F as alloc::boxed::FnBox<A>>::call_box::h9776122b160b44e4\r\n                               at /checkout/src/libstd/panicking.rs:459\r\n                               at /checkout/src/libstd/panic.rs:365\r\n                               at /checkout/src/libstd/thread/mod.rs:405\r\n                               at /checkout/src/liballoc/boxed.rs:817\r\n  23:       0x5917d06e37 - std::sys_common::thread::start_thread::had16748b9c5dacc9\r\n                               at /checkout/src/liballoc/boxed.rs:827\r\n                               at libstd/sys_common/thread.rs:24\r\n  24:       0x5917d0a3a8 - std::sys::unix::thread::Thread::new::thread_start::h1458f52276ce60d4\r\n                               at libstd/sys/unix/thread.rs:90\r\n  25:     0x7f8056062063 - start_thread\r\n  26:     0x7f8055b8162c - clone\r\n  27:                0x0 - <unknown>\r\nthread '<unnamed>' panicked at 'failed to retrieve response from reactor: Canceled', libcore/result.rs:916:5\r\nstack backtrace:\r\n   0:       0x5917cfe83b - std::sys::unix::backtrace::tracing::imp::unwind_backtrace::h01c1934f65de6f6a\r\n                               at libstd/sys/unix/backtrace/tracing/gcc_s.rs:49\r\n   1:       0x5917d04451 - std::sys_common::backtrace::print::h87cc6ba9b94fa155\r\n                               at libstd/sys_common/backtrace.rs:68\r\n                               at libstd/sys_common/backtrace.rs:57\r\n   2:       0x5917cfade0 - std::panicking::default_hook::{{closure}}::hd04a5cd906658fa2\r\n                               at libstd/panicking.rs:381\r\n   3:       0x5917cfa915 - std::panicking::default_hook::h13d81f39b4233c4b\r\n                               at libstd/panicking.rs:397\r\n   4:       0x5917cfb22b - std::panicking::rust_panic_with_hook::hafca86651ef244e6\r\n                               at libstd/panicking.rs:577\r\n   5:       0x5917cfb0ee - std::panicking::begin_panic::h5e76eba7233d4218\r\n                               at libstd/panicking.rs:538\r\n   6:       0x5917cfafea - std::panicking::begin_panic_fmt::hff38b5bd065c125a\r\n                               at libstd/panicking.rs:522\r\n   7:       0x5917cfaf82 - rust_begin_unwind\r\n                               at libstd/panicking.rs:498\r\n   8:       0x5917d53730 - core::panicking::panic_fmt::h2b19f39e7a539ec5\r\n                               at libcore/panicking.rs:71\r\n   9:       0x5917bd4f6b - core::result::unwrap_failed::h070b919d720b3625\r\n                               at /checkout/src/libcore/macros.rs:23\r\n  10:       0x5917bf27b4 - <rusoto_core::reactor::RequestDispatcherFuture as futures::future::Future>::poll::he84fa4d26a52e903\r\n                               at /checkout/src/libcore/result.rs:809\r\n                               at /root/.cargo/git/checkouts/rusoto-async-35a81945dd339d5f/eeddeab/rusoto/core/src/reactor.rs:95\r\n  11:       0x5917b94370 - <rusoto_core::client_inner::SignAndDispatch<P, D, E> as futures::future::Future>::poll::h6a6fd39619677f61\r\n                               at /root/.cargo/git/checkouts/rusoto-async-35a81945dd339d5f/eeddeab/rusoto/core/src/client_inner.rs:88\r\n  12:       0x5917b7d5ec - <futures::future::chain::Chain<A, B, C>>::poll::hf500c48ed800ad80\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/chain.rs:26\r\n  13:       0x5917b8c60d - <futures::future::and_then::AndThen<A, B, F> as futures::future::Future>::poll::h01293d6dbd13f74e\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/and_then.rs:32\r\n  14:       0x5917b7d0f8 - <futures::future::chain::Chain<A, B, C>>::poll::hc7a513298383395f\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/mod.rs:113\r\n                               at /root/.cargo/git/checkouts/rusoto-async-35a81945dd339d5f/eeddeab/rusoto/core/src/future.rs:30\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/chain.rs:26\r\n  15:       0x5917b93536 - futures::task_impl::with_notify::h9a5a02c0a7eaac30\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/future/then.rs:32\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/stream/futures_unordered.rs:363\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/std/mod.rs:78\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/mod.rs:480\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/mod.rs:45\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/mod.rs:471\r\n  16:       0x5917b91b0f - <futures::stream::futures_unordered::FuturesUnordered<T> as futures::stream::Stream>::poll::h8dba88ca9c256e3b\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/stream/futures_unordered.rs:362\r\n  17:       0x5917b93d2f - <futures::stream::buffer_unordered::BufferUnordered<S> as futures::stream::Stream>::poll::h3b8f49dcb85d7dc6\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/stream/buffer_unordered.rs:96\r\n  18:       0x5917b92e9c - <futures::task_impl::Spawn<T>>::poll_stream_notify::h97f3d5e19952b5ac\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/mod.rs:301\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/mod.rs:363\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/std/mod.rs:78\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/mod.rs:363\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/mod.rs:301\r\n  19:       0x5917b96447 - <std::thread::local::LocalKey<T>>::with::hbfb095580dfabd73\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/std/mod.rs:302\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/std/mod.rs:506\r\n                               at /checkout/src/libstd/thread/local.rs:377\r\n                               at /checkout/src/libstd/thread/local.rs:288\r\n  20:       0x5917b7fa57 - std::sys_common::backtrace::__rust_begin_short_backtrace::h88bff9b603612577\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/std/mod.rs:506\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/task_impl/std/mod.rs:299\r\n                               at /root/.cargo/registry/src/github.com-1ecc6299db9ec823/futures-0.1.18/src/stream/wait.rs:51\r\n                               at src/main.rs:166\r\n                               at /checkout/src/libstd/sys_common/backtrace.rs:133\r\n  21:       0x5917b963a4 - std::panicking::try::do_call::h2a76888acf58fa3f\r\n                               at /checkout/src/libstd/thread/mod.rs:406\r\n                               at /checkout/src/libstd/panic.rs:300\r\n                               at /checkout/src/libstd/panicking.rs:480\r\n  22:       0x5917d1683e - __rust_maybe_catch_panic\r\n                               at libpanic_unwind/lib.rs:102\r\n  23:       0x5917b9747d - <F as alloc::boxed::FnBox<A>>::call_box::h81e80e87d1bf9702\r\n                               at /checkout/src/libstd/panicking.rs:459\r\n                               at /checkout/src/libstd/panic.rs:365\r\n                               at /checkout/src/libstd/thread/mod.rs:405\r\n                               at /checkout/src/liballoc/boxed.rs:817\r\n  24:       0x5917d06e37 - std::sys_common::thread::start_thread::had16748b9c5dacc9\r\n                               at /checkout/src/liballoc/boxed.rs:827\r\n                               at libstd/sys_common/thread.rs:24\r\n  25:       0x5917d0a3a8 - std::sys::unix::thread::Thread::new::thread_start::h1458f52276ce60d4\r\n                               at libstd/sys/unix/thread.rs:90\r\n  26:     0x7f8056062063 - start_thread\r\n  27:     0x7f8055b8162c - clone\r\n  28:                0x0 - <unknown>\r\n```\r\n\r\nYou can reproduce the error by cloning down https://github.com/tureus/kinesis-hyper . You will need AWS credentials and a single test stream already created. The code will take it from there and start issuing many concurrent requests.","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hyperium/hyper/issues/1429/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hyperium/hyper/issues/1429/timeline","performed_via_github_app":null,"state_reason":"completed"}