{"url":"https://api.github.com/repos/hyperium/hyper/issues/1128","repository_url":"https://api.github.com/repos/hyperium/hyper","labels_url":"https://api.github.com/repos/hyperium/hyper/issues/1128/labels{/name}","comments_url":"https://api.github.com/repos/hyperium/hyper/issues/1128/comments","events_url":"https://api.github.com/repos/hyperium/hyper/issues/1128/events","html_url":"https://github.com/hyperium/hyper/issues/1128","id":221051123,"node_id":"MDU6SXNzdWUyMjEwNTExMjM=","number":1128,"title":"A better Server Error experience","user":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":872551572,"node_id":"MDU6TGFiZWw4NzI1NTE1NzI=","url":"https://api.github.com/repos/hyperium/hyper/labels/A-error","name":"A-error","color":"fbca04","default":false,"description":"Area: error handling"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/hyperium/hyper/milestones/4","html_url":"https://github.com/hyperium/hyper/milestone/4","labels_url":"https://api.github.com/repos/hyperium/hyper/milestones/4/labels","id":2338703,"node_id":"MDk6TWlsZXN0b25lMjMzODcwMw==","number":4,"title":"0.12","description":"","creator":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":24,"state":"closed","created_at":"2017-02-21T19:39:36Z","updated_at":"2018-06-01T23:09:51Z","due_on":null,"closed_at":"2018-06-01T23:09:51Z"},"comments":0,"created_at":"2017-04-11T19:10:20Z","updated_at":"2019-05-07T19:06:03Z","closed_at":"2018-04-10T22:13:59Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"There are 4 error cases on the server side:\r\n\r\n- When receiving/parsing the headers of a new incoming Request\r\n- When receiving/parsing the body of an established Request\r\n- When a `Service`'s `Future` resolves to an `Err`, meaning that it just could not respond to the Request\r\n- When a user-supplied `Stream` has an error while generating more of the outgoing body\r\n\r\nThe current design requires that all 4 of these cases be covered by `hyper::Error`, but that type is not satisfactory for the semantics of each case. This design is currently required because of tokio-proto's `ServerProto` only allowing a single `Error` type. Relevant tokio issue: https://github.com/tokio-rs/tokio-proto/issues/157\r\n\r\nAnother quirk with the current type is that users must return a `hyper::Error` when they encounter an error during their `Service.call`. This causes them to wonder which variant of the current `hyper::Error` they should use, when the real anwer is: **none!** They should be returning (if it was a server error) a response with a `5XX` status code.\r\n\r\nThey are also asked to return a `hyper::Error` in the outgoing `Stream`, but that is also incorrect. No hyper error occurred! However, they cannot alter to sending a 500 response anymore, so the only valid thing to do is send an error type with the semantics of \"something blew up, we cannot respond more, just abort the socket\".\r\n\r\nSo, there are 2 error types that would better suit these 4 cases:\r\n\r\n- `Error`: The `hyper::Error` type that comes only from within hyper, and represents when there was an error trying to read and parse incoming HTTP data.\r\n- `Disconnect`: A type that comes only from the user, given to hyper, and represents that the connection should be terminated immediately. Other names could be `Fatal`, `Close`, `Abort`...\r\n\r\nThis separation would hopefully give more clarity as to what error a user should be returning, and that in the `Service::Future` type, they shouldn't returning an error at all, since the error name should be ominous enough to point at returning a response instead.\r\n\r\nThere is of course still desire for users to have streams that return error types of `std::io::Error`, such as streaming from a `File`, or even `hyper::Error`, when streaming from a proxied client request, so there should exist `From` implementations for those types.\r\n\r\n-----\r\n\r\nNew proposal: #1431 \r\n","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hyperium/hyper/issues/1128/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hyperium/hyper/issues/1128/timeline","performed_via_github_app":null,"state_reason":"completed"}