{"url":"https://api.github.com/repos/hyperium/hyper/issues/848","repository_url":"https://api.github.com/repos/hyperium/hyper","labels_url":"https://api.github.com/repos/hyperium/hyper/issues/848/labels{/name}","comments_url":"https://api.github.com/repos/hyperium/hyper/issues/848/comments","events_url":"https://api.github.com/repos/hyperium/hyper/issues/848/events","html_url":"https://github.com/hyperium/hyper/issues/848","id":163093187,"node_id":"MDU6SXNzdWUxNjMwOTMxODc=","number":848,"title":"Client panics with 'handler not in queue for key'","user":{"login":"arkpar","id":9008569,"node_id":"MDQ6VXNlcjkwMDg1Njk=","avatar_url":"https://avatars.githubusercontent.com/u/9008569?v=4","gravatar_id":"","url":"https://api.github.com/users/arkpar","html_url":"https://github.com/arkpar","followers_url":"https://api.github.com/users/arkpar/followers","following_url":"https://api.github.com/users/arkpar/following{/other_user}","gists_url":"https://api.github.com/users/arkpar/gists{/gist_id}","starred_url":"https://api.github.com/users/arkpar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arkpar/subscriptions","organizations_url":"https://api.github.com/users/arkpar/orgs","repos_url":"https://api.github.com/users/arkpar/repos","events_url":"https://api.github.com/users/arkpar/events{/privacy}","received_events_url":"https://api.github.com/users/arkpar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":125710197,"node_id":"MDU6TGFiZWwxMjU3MTAxOTc=","url":"https://api.github.com/repos/hyperium/hyper/labels/C-bug","name":"C-bug","color":"d93f0b","default":false,"description":"Category: bug. Something is wrong. This is bad!"},{"id":128399841,"node_id":"MDU6TGFiZWwxMjgzOTk4NDE=","url":"https://api.github.com/repos/hyperium/hyper/labels/A-client","name":"A-client","color":"fbca04","default":false,"description":"Area: client."}],"state":"closed","locked":false,"assignee":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/hyperium/hyper/milestones/3","html_url":"https://github.com/hyperium/hyper/milestone/3","labels_url":"https://api.github.com/repos/hyperium/hyper/milestones/3/labels","id":1660394,"node_id":"MDk6TWlsZXN0b25lMTY2MDM5NA==","number":3,"title":"0.11","description":"Async IO!","creator":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":28,"state":"closed","created_at":"2016-03-22T17:05:32Z","updated_at":"2017-06-21T16:51:22Z","due_on":null,"closed_at":"2017-06-21T16:51:22Z"},"comments":5,"created_at":"2016-06-30T06:50:07Z","updated_at":"2016-07-14T08:34:10Z","closed_at":"2016-07-14T00:19:45Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Using latest master. I have a `Client` that sends HTTP POST requests to the same URL from multiple threads and sometime this happens:\n\n```\n2016-06-29 19:39:49 TRACE:hyper::client: on_incoming MessageHead { version: Http11, subject: RawStatus(200, \"OK\"), headers: Headers { Date: Wed, 29 Jun 2016 17:39:49 GMT, Content-Type: text/html; charset=utf-8, Transfer-Encoding: chunked, Connection: keep-alive, Set-Cookie: __cfduid=d7fc357ba132c654f5d1ff011ddf8f45c1467221989; expires=Thu, 29-Jun-17 17:39:49 GMT; path=/; domain=.requestb.in; HttpOnly, Sponsored-By: https://www.runscope.com, Via: 1.1 vegur, Server: cloudflare-nginx, CF-RAY: 2bab28f85afc2696-FRA, } }\n2016-06-29 19:39:49 TRACE:hyper::client::response: Response::new\n2016-06-29 19:39:49 DEBUG:hyper::client::response: version=Http11, status=Ok\n2016-06-29 19:39:49 DEBUG:hyper::client::response: headers=Headers { Date: Wed, 29 Jun 2016 17:39:49 GMT, Content-Type: text/html; charset=utf-8, Transfer-Encoding: chunked, Connection: keep-alive, Set-Cookie: __cfduid=d7fc357ba132c654f5d1ff011ddf8f45c1467221989; expires=Thu, 29-Jun-17 17:39:49 GMT; path=/; domain=.requestb.in; HttpOnly, Sponsored-By: https://www.runscope.com, Via: 1.1 vegur, Server: cloudflare-nginx, CF-RAY: 2bab28f85afc2696-FRA, }\n2016-06-29 19:39:49 TRACE:hyper::http::conn: handler.on_incoming() -> Next::End\n2016-06-29 19:39:49 TRACE:hyper::http::conn: Conn.on_readable State::Http1 completed, new state = Closed\n2016-06-29 19:39:49 TRACE:hyper::http::conn: on_readable <- Closed\n2016-06-29 19:39:49 TRACE:hyper::http::conn: removing transport\n2016-06-29 19:39:49 DEBUG:hyper::http::conn: on_remove\n2016-06-29 19:39:49 TRACE:hyper::http::conn: Conn::ready events='Writable', blocked=None\n2016-06-29 19:39:49 TRACE:hyper::http::conn: on_writable -> Init\nthread 'hyper-client' panicked at 'handler not in queue for key', ../src/libcore/option.rs:700\nstack backtrace:\n   1:        0x10df189a8 - std::sys::backtrace::tracing::imp::write::h4c73fcd3363076f5\n   2:        0x10df1d695 - std::panicking::default_hook::_$u7b$$u7b$closure$u7d$$u7d$::h0422dbb3077e6747\n   3:        0x10df1d2ce - std::panicking::default_hook::haac48fa641db8fa2\n   4:        0x10df042a6 - std::sys_common::unwind::begin_unwind_inner::h39d40f52add53ef7\n   5:        0x10df0512e - std::sys_common::unwind::begin_unwind_fmt::h64c0ff793199cc1b\n   6:        0x10df17c77 - rust_begin_unwind\n   7:        0x10df44650 - core::panicking::panic_fmt::h73bf9d7e8e891a73\n   8:        0x10df4ba05 - core::option::expect_failed::h076bf2c39f982c10\n   9:        0x10d15bff7 - _<std..option..Option<T>>::expect::h4d371225682cdf33\n  10:        0x10d15bde8 - _<hyper..client..Context<K, H>>::pop_queue::h9f1ca6f87b02e137\n  11:        0x10d17f2c8 - _<hyper..client..Context<K, H> as hyper..http..conn..MessageHandlerFactory<K, T>>::create::h72fe55a18cf094e1\n  12:        0x10d1838d1 - _<hyper..http..conn..ConnInner<K, T, H>>::write::h27233c439f264973\n  13:        0x10d1833e7 - _<hyper..http..conn..ConnInner<K, T, H>>::on_writable::hf0fc8b494309b678\n  14:        0x10d16a117 - _<hyper..http..conn..Conn<K, T, H>>::ready::hcd9a5057a4a978bb\n  15:        0x10d168d34 - _<hyper..client..ClientFsm<C, H> as rotor..machine..Machine>::ready::h18d7b4b8c2b1d861\n  16:        0x10d156a2a - _<rotor..handler..Handler<M> as mio..handler..Handler>::ready::_$u7b$$u7b$closure$u7d$$u7d$::hd97c848ac2d5a15f\n  17:        0x10d154829 - rotor::handler::machine_loop::_$u7b$$u7b$closure$u7d$$u7d$::hc30baa823bb27586\n  18:        0x10d153bdf - _<slab..Slab<T, I>>::replace_with::h33450c53ecf92861\n  19:        0x10d153373 - rotor::handler::machine_loop::h9cb7d33db670d5d7\n  20:        0x10d153267 - _<rotor..handler..Handler<M> as mio..handler..Handler>::ready::h710fa45b2de72561\n  21:        0x10d15320f - _<mio..event_loop..EventLoop<H>>::io_event::h03b152c8f8e13717\n  22:        0x10d153138 - _<mio..event_loop..EventLoop<H>>::io_process::h181871cbb835ee55\n  23:        0x10d152720 - _<mio..event_loop..EventLoop<H>>::run_once::h3d9fc897d97966a0\n  24:        0x10d151f6b - _<mio..event_loop..EventLoop<H>>::run::hb65bd25c79b9dbbf\n  25:        0x10d151e87 - _<rotor..creator..LoopInstance<M>>::run::he20d485afc7f963f\n  26:        0x10d151da8 - _<rotor..creator..LoopCreator<M>>::run::h0cc8a75bbdd8303c\n  27:        0x10d151819 - _<hyper..Client<H>>::configured::_$u7b$$u7b$closure$u7d$$u7d$::h8f30494177b18b6d\n  28:        0x10d1511d3 - std::thread::Builder::spawn::_$u7b$$u7b$closure$u7d$$u7d$::_$u7b$$u7b$closure$u7d$$u7d$::h4b89e9fded2ad991\n  29:        0x10d151148 - std::sys_common::unwind::try::try_fn::h4a08d65f9221d375\n  30:        0x10df17c0b - __rust_try\n  31:        0x10df17b93 - std::sys_common::unwind::inner_try::h9eebd8dc83f388a6\n  32:        0x10d151085 - std::sys_common::unwind::try::h3a06944618b15d43\n  33:        0x10d150eb1 - std::thread::Builder::spawn::_$u7b$$u7b$closure$u7d$$u7d$::hcec021c16765064b\n  34:        0x10d151a57 - _<F as std..boxed..FnBox<A>>::call_box::h861041a9a27a885d\n  35:        0x10df1c828 - std::sys::thread::Thread::new::thread_start::h471ad90789353b5b\n  36:     0x7fff9549f99c - _pthread_body\n  37:     0x7fff9549f919 - _pthread_start\n```\n\nOS X 10.11.5\n","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hyperium/hyper/issues/848/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hyperium/hyper/issues/848/timeline","performed_via_github_app":null,"state_reason":"completed"}