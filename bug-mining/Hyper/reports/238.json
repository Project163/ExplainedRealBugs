{"url":"https://api.github.com/repos/hyperium/hyper/issues/2171","repository_url":"https://api.github.com/repos/hyperium/hyper","labels_url":"https://api.github.com/repos/hyperium/hyper/issues/2171/labels{/name}","comments_url":"https://api.github.com/repos/hyperium/hyper/issues/2171/comments","events_url":"https://api.github.com/repos/hyperium/hyper/issues/2171/events","html_url":"https://github.com/hyperium/hyper/issues/2171","id":591565133,"node_id":"MDU6SXNzdWU1OTE1NjUxMzM=","number":2171,"title":"Decoding response from gRPC REST proxy results in \"Invalid chunk end CR\" error","user":{"login":"thomaseizinger","id":5486389,"node_id":"MDQ6VXNlcjU0ODYzODk=","avatar_url":"https://avatars.githubusercontent.com/u/5486389?v=4","gravatar_id":"","url":"https://api.github.com/users/thomaseizinger","html_url":"https://github.com/thomaseizinger","followers_url":"https://api.github.com/users/thomaseizinger/followers","following_url":"https://api.github.com/users/thomaseizinger/following{/other_user}","gists_url":"https://api.github.com/users/thomaseizinger/gists{/gist_id}","starred_url":"https://api.github.com/users/thomaseizinger/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thomaseizinger/subscriptions","organizations_url":"https://api.github.com/users/thomaseizinger/orgs","repos_url":"https://api.github.com/users/thomaseizinger/repos","events_url":"https://api.github.com/users/thomaseizinger/events{/privacy}","received_events_url":"https://api.github.com/users/thomaseizinger/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2020-04-01T02:13:02Z","updated_at":"2020-12-16T11:29:31Z","closed_at":"2020-12-15T22:23:08Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am integrating with a go application that uses the gRPC REST proxy to provide an HTTP API.\r\nMy HTTP client is `reqwest` which uses `hyper:0.13.3` at this stage.\r\n\r\nThe go application sends the following response:\r\n\r\n```\r\nHTTP/1.1 500 Internal Server Error\r\nContent-Type: application/json\r\nTrailer: Grpc-Trailer-Content-Type\r\nDate: Wed, 01 Apr 2020 00:16:52 GMT\r\nTransfer-Encoding: chunked\r\n\r\n5e\r\n{\"error\":\"there are no existing invoices\",\"message\":\"there are no existing invoices\",\"code\":2}\r\n0\r\nGrpc-Trailer-Content-Type: application/grpc\r\n\r\n{\"error\":\"there are no existing invoices\",\"message\":\"there are no existing invoices\",\"code\":2}%\r\n```\r\n\r\nI've added a test to the hyper test suite that reproduces the issue: https://github.com/thomaseizinger/hyper/commit/a608b28dd9d93a0b0754653c859f262c14d9fd59\r\n\r\nI don't know whether this is a valid HTTP response. Reading through the HTTP spec, it seems like this grpc trailer stuff is violating the `Transfer-Encoding: chunked` spec because the chunked is advertised as 0 bytes which from what I understand means the response is over, yet there are more bytes following.\r\n\r\nInterestingly, `curl` is able to handle the response just fine but that could just be an artifact of curl being very robust to these kind of mistakes.\r\n\r\nEven if this is an invalid response, it would be nice if `hyper` could be robust here and just ignore everything that is coming after the `0` chunk size indicator.","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hyperium/hyper/issues/2171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hyperium/hyper/issues/2171/timeline","performed_via_github_app":null,"state_reason":"completed"}