{"url":"https://api.github.com/repos/hyperium/hyper/issues/1373","repository_url":"https://api.github.com/repos/hyperium/hyper","labels_url":"https://api.github.com/repos/hyperium/hyper/issues/1373/labels{/name}","comments_url":"https://api.github.com/repos/hyperium/hyper/issues/1373/comments","events_url":"https://api.github.com/repos/hyperium/hyper/issues/1373/events","html_url":"https://github.com/hyperium/hyper/issues/1373","id":273213454,"node_id":"MDU6SXNzdWUyNzMyMTM0NTQ=","number":1373,"title":"Client sends TransferEncoding: chunked for empty Body","user":{"login":"brandlk","id":1488636,"node_id":"MDQ6VXNlcjE0ODg2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/1488636?v=4","gravatar_id":"","url":"https://api.github.com/users/brandlk","html_url":"https://github.com/brandlk","followers_url":"https://api.github.com/users/brandlk/followers","following_url":"https://api.github.com/users/brandlk/following{/other_user}","gists_url":"https://api.github.com/users/brandlk/gists{/gist_id}","starred_url":"https://api.github.com/users/brandlk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brandlk/subscriptions","organizations_url":"https://api.github.com/users/brandlk/orgs","repos_url":"https://api.github.com/users/brandlk/repos","events_url":"https://api.github.com/users/brandlk/events{/privacy}","received_events_url":"https://api.github.com/users/brandlk/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":125710197,"node_id":"MDU6TGFiZWwxMjU3MTAxOTc=","url":"https://api.github.com/repos/hyperium/hyper/labels/C-bug","name":"C-bug","color":"d93f0b","default":false,"description":"Category: bug. Something is wrong. This is bad!"},{"id":128399841,"node_id":"MDU6TGFiZWwxMjgzOTk4NDE=","url":"https://api.github.com/repos/hyperium/hyper/labels/A-client","name":"A-client","color":"fbca04","default":false,"description":"Area: client."},{"id":154002675,"node_id":"MDU6TGFiZWwxNTQwMDI2NzU=","url":"https://api.github.com/repos/hyperium/hyper/labels/E-easy","name":"E-easy","color":"0e8a16","default":false,"description":"Effort: easy. A task that would be a great starting point for a new contributor."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2017-11-12T08:46:54Z","updated_at":"2018-06-19T16:23:22Z","closed_at":"2017-11-14T19:53:46Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"When receiving a HTTP request without a body, a `Request` with an empty `Body` is constructed instead of a `Request` with `None` as `Body`. Since GET requests neither have the ContentLength nor the TransferEncoding header set (this is the correct behavious as far as I understood), the hyper implementation automatically sets TransferEncoding: chunked in case I forward this request unchanged (as for example a proxy would do). This results in some servers responding with \"Bad request\" (for example \"example.org\"), which again seems to be the correct behaviour. Some servers are apparently more tolerant and reply nevertheless.\r\n\r\nThis means by literally doing nothing (e.g. just forwarding an incoming request), hyper turns a valid request into an invalid one, which seems strange.\r\nOf course I could inspect the body and send a request without a body in case it is empty or build a request without a body in case neither ContentLength nor TransferEnconding is set, but this feels a bit like a workaround. And additionally, a Request does not offer any method to remove a body from the request. The method `body()` which takes the body out of the request, just replaces the original one with an empty one and thus does not help in this case. This means I have to build a new request and copy the headers from the original one before passing it on.\r\n\r\nIs this behaviour intended? Or is there a chance to fix it? By skimming through the implementation I figured that `Body` is just a wrapper around the tokio-proto Body. This struct internally distinguishes between \"Empty\", \"Stream\" and \"Once\" but doesn't expose this functionality. If it would, (e.g, offering a \"is_empty()\" method), then it would be easy to change the hyper behaviour when encoding a request. But I'm not sure if it is desired to expose this, since conceptually there is no difference between an \"officially\" empty body and a stream without items. So maybe this is a stupid approach.","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hyperium/hyper/issues/1373/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hyperium/hyper/issues/1373/timeline","performed_via_github_app":null,"state_reason":"completed"}