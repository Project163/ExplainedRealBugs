{"url":"https://api.github.com/repos/hyperium/hyper/issues/2409","repository_url":"https://api.github.com/repos/hyperium/hyper","labels_url":"https://api.github.com/repos/hyperium/hyper/issues/2409/labels{/name}","comments_url":"https://api.github.com/repos/hyperium/hyper/issues/2409/comments","events_url":"https://api.github.com/repos/hyperium/hyper/issues/2409/events","html_url":"https://github.com/hyperium/hyper/issues/2409","id":794422460,"node_id":"MDU6SXNzdWU3OTQ0MjI0NjA=","number":2409,"title":"\"Transfer-Encoding\" correction code causes a panic","user":{"login":"inikulin","id":453071,"node_id":"MDQ6VXNlcjQ1MzA3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/453071?v=4","gravatar_id":"","url":"https://api.github.com/users/inikulin","html_url":"https://github.com/inikulin","followers_url":"https://api.github.com/users/inikulin/followers","following_url":"https://api.github.com/users/inikulin/following{/other_user}","gists_url":"https://api.github.com/users/inikulin/gists{/gist_id}","starred_url":"https://api.github.com/users/inikulin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/inikulin/subscriptions","organizations_url":"https://api.github.com/users/inikulin/orgs","repos_url":"https://api.github.com/users/inikulin/repos","events_url":"https://api.github.com/users/inikulin/events{/privacy}","received_events_url":"https://api.github.com/users/inikulin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":125710197,"node_id":"MDU6TGFiZWwxMjU3MTAxOTc=","url":"https://api.github.com/repos/hyperium/hyper/labels/C-bug","name":"C-bug","color":"d93f0b","default":false,"description":"Category: bug. Something is wrong. This is bad!"},{"id":128399841,"node_id":"MDU6TGFiZWwxMjgzOTk4NDE=","url":"https://api.github.com/repos/hyperium/hyper/labels/A-client","name":"A-client","color":"fbca04","default":false,"description":"Area: client."},{"id":154002675,"node_id":"MDU6TGFiZWwxNTQwMDI2NzU=","url":"https://api.github.com/repos/hyperium/hyper/labels/E-easy","name":"E-easy","color":"0e8a16","default":false,"description":"Effort: easy. A task that would be a great starting point for a new contributor."},{"id":956795692,"node_id":"MDU6TGFiZWw5NTY3OTU2OTI=","url":"https://api.github.com/repos/hyperium/hyper/labels/A-http1","name":"A-http1","color":"fbca04","default":false,"description":"Area: HTTP/1 specific."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-01-26T17:31:02Z","updated_at":"2021-01-26T18:36:59Z","closed_at":"2021-01-26T18:36:59Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Repro code:\r\n```rust\r\nuse hyper::server::Server;\r\nuse hyper::service::{make_service_fn, service_fn};\r\nuse hyper::{Body, Client, Request, Response};\r\nuse std::convert::Infallible;\r\n\r\n#[tokio::main]\r\nasync fn main() {\r\n     let make_service = make_service_fn(|_conn| async {\r\n        Ok::<_, Infallible>(service_fn(|_| async {\r\n            Ok::<_, Infallible>(Response::builder().body(Body::empty()).unwrap())\r\n        }))\r\n    });\r\n\r\n    let server = Server::bind(&\"127.0.0.1:0\".parse().unwrap()).serve(make_service);\r\n    let addr = server.local_addr();\r\n\r\n    tokio::spawn(async move {\r\n        server.await.unwrap();\r\n    });\r\n\r\n    let req = Request::builder()\r\n        .method(\"GET\")\r\n        .header(\"Transfer-Encoding\", \"foo\")\r\n        .uri(format!(\"http://{}\", addr))\r\n        .body(Body::from(\"foobar\"))\r\n        .unwrap();\r\n\r\n    assert!(Client::new().request(req).await.is_ok());\r\n}\r\n```\r\n\r\nThis panics with \"source slice length (3) does not match destination slice length (0)\". Apparently the reason is that only capacity is set for the target buffer here: https://github.com/hyperium/hyper/blob/f0ddb669328163001fd18a4a21109e95047848bf/src/headers.rs#L119, but the buffer itself is not filled, so slice copying fails.","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hyperium/hyper/issues/2409/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hyperium/hyper/issues/2409/timeline","performed_via_github_app":null,"state_reason":"completed"}