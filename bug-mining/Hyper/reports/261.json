{"url":"https://api.github.com/repos/hyperium/hyper/issues/2708","repository_url":"https://api.github.com/repos/hyperium/hyper","labels_url":"https://api.github.com/repos/hyperium/hyper/issues/2708/labels{/name}","comments_url":"https://api.github.com/repos/hyperium/hyper/issues/2708/comments","events_url":"https://api.github.com/repos/hyperium/hyper/issues/2708/events","html_url":"https://github.com/hyperium/hyper/issues/2708","id":1067153813,"node_id":"I_kwDOAWaYQc4_m3mV","number":2708,"title":"\"Expect: 100-continue\" header is using case-sensitive comparison","user":{"login":"JonathanMurray","id":3257474,"node_id":"MDQ6VXNlcjMyNTc0NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/3257474?v=4","gravatar_id":"","url":"https://api.github.com/users/JonathanMurray","html_url":"https://github.com/JonathanMurray","followers_url":"https://api.github.com/users/JonathanMurray/followers","following_url":"https://api.github.com/users/JonathanMurray/following{/other_user}","gists_url":"https://api.github.com/users/JonathanMurray/gists{/gist_id}","starred_url":"https://api.github.com/users/JonathanMurray/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JonathanMurray/subscriptions","organizations_url":"https://api.github.com/users/JonathanMurray/orgs","repos_url":"https://api.github.com/users/JonathanMurray/repos","events_url":"https://api.github.com/users/JonathanMurray/events{/privacy}","received_events_url":"https://api.github.com/users/JonathanMurray/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":125710197,"node_id":"MDU6TGFiZWwxMjU3MTAxOTc=","url":"https://api.github.com/repos/hyperium/hyper/labels/C-bug","name":"C-bug","color":"d93f0b","default":false,"description":"Category: bug. Something is wrong. This is bad!"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2021-11-30T12:03:07Z","updated_at":"2021-11-30T16:58:52Z","closed_at":"2021-11-30T16:58:52Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Version**\r\n0.14 (and master-branch 2021-11-30)\r\n\r\n**Platform**\r\nDarwin C02Y72T1JGH5 20.6.0 Darwin Kernel Version 20.6.0: Mon Aug 30 06:12:21 PDT 2021; root:xnu-7195.141.6~3/RELEASE_X86_64 x86_64\r\n\r\n**Description**\r\nI have a service built with Hyper that I'm now trying to communicate with from a client written in Java. I noticed when doing this that Java's standard HttpClient sends 100-continue expectations as `Expect: 100-Continue` (https://github.com/AdoptOpenJDK/openjdk-jdk11/blob/master/src/java.net.http/share/classes/jdk/internal/net/http/Exchange.java#L408), whereas Hyper compares the expectation header value against `100-continue` (case-sensitive) (https://github.com/hyperium/hyper/blob/5f938fffa64df23a2e4af81ed4e6d8bd760e2d05/src/proto/h1/role.rs#L274). This has the effect that the Java client never receives a `100 Continue` from the Rust service, which makes it seemingly unable to handle the response correctly. https://datatracker.ietf.org/doc/html/rfc2616#section-14.20 seems to state that the capitalisation of the `100-continue` token should not matter from the server's perspective:\r\n```\r\nComparison of expectation values is case-insensitive for unquoted\r\n   tokens (including the 100-continue token), and is case-sensitive for\r\n   quoted-string expectation-extensions.\r\n```\r\n\r\nTrying this:\r\n\r\nchanging the `expect_continue_sends_100` test to send the request expectation with an upper-case `C`. \r\n```\r\ndiff --git a/tests/server.rs b/tests/server.rs\r\nindex 13530a36..0b991337 100644\r\n--- a/tests/server.rs\r\n+++ b/tests/server.rs\r\n@@ -808,7 +808,7 @@ fn expect_continue_sends_100() {\r\n         b\"\\\r\n         POST /foo HTTP/1.1\\r\\n\\\r\n         Host: example.domain\\r\\n\\\r\n-        Expect: 100-continue\\r\\n\\\r\n+        Expect: 100-Continue\\r\\n\\\r\n         Content-Length: 5\\r\\n\\\r\n         Connection: Close\\r\\n\\\r\n         \\r\\n\\\r\n```\r\nand running `cargo test --features full expect_continue_sends_100`\r\n\r\nI expect to see this happen: \r\n\r\ntest passes\r\n\r\nInstead, this happens: \r\n\r\nThe test fails with:\r\n```\r\n---- expect_continue_sends_100 stdout ----\r\nthread 'expect_continue_sends_100' panicked at 'read 1: Os { code: 35, kind: WouldBlock, message: \"Resource temporarily unavailable\" }', tests/server.rs:821:30\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n```\r\n","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hyperium/hyper/issues/2708/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hyperium/hyper/issues/2708/timeline","performed_via_github_app":null,"state_reason":"completed"}