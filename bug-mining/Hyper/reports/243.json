{"url":"https://api.github.com/repos/hyperium/hyper/issues/2260","repository_url":"https://api.github.com/repos/hyperium/hyper","labels_url":"https://api.github.com/repos/hyperium/hyper/issues/2260/labels{/name}","comments_url":"https://api.github.com/repos/hyperium/hyper/issues/2260/comments","events_url":"https://api.github.com/repos/hyperium/hyper/issues/2260/events","html_url":"https://github.com/hyperium/hyper/issues/2260","id":672950055,"node_id":"MDU6SXNzdWU2NzI5NTAwNTU=","number":2260,"title":"Add sending trailers on Body channel","user":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":694496598,"node_id":"MDU6TGFiZWw2OTQ0OTY1OTg=","url":"https://api.github.com/repos/hyperium/hyper/labels/C-feature","name":"C-feature","color":"f9d0c4","default":false,"description":"Category: feature. This is adding a new feature."},{"id":694496799,"node_id":"MDU6TGFiZWw2OTQ0OTY3OTk=","url":"https://api.github.com/repos/hyperium/hyper/labels/E-medium","name":"E-medium","color":"c2e0c6","default":false,"description":"Effort: medium. Some knowledge of how hyper internal works would be useful."},{"id":872551013,"node_id":"MDU6TGFiZWw4NzI1NTEwMTM=","url":"https://api.github.com/repos/hyperium/hyper/labels/A-body","name":"A-body","color":"fbca04","default":false,"description":"Area: body streaming."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-08-04T17:16:31Z","updated_at":"2021-01-15T18:14:21Z","closed_at":"2021-01-15T18:14:21Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The `Body::channel()` variant is a common simple way to send data as a `Body`. It would be useful to also be able to send trailers on it.\r\n\r\n### Implementation\r\n\r\nThe code to change is on the `hyper::body::Sender`, and the relevant `Kind` variant. I could imagine two possible ways to implement this, and I'm not sure which is better yet.\r\n\r\n1. Change the internal mpsc channel to send `enum Msg { Data(Bytes), Trailers(HeaderMap) }`. However, the `Kind::Chan` variant would need to grow some cache slots, since `poll_data` could pop a `Msg::Trailers`, and then that would need to cached so that `poll_trailers` returns its.\r\n2. Add a `oneshot` channel to send the trailers. The downside here is the increased size of `Sender` and `Kind::Channel` (they both are carrying an extra pointer), and the extra allocation.\r\n\r\nI think the 2nd option is probably going to be better, but measurements are king. We should compare the changes to the `benches/end_to_end` results to see if the added feature makes much of a difference. If it does, we could consider making an internal \"skinnier channel\" that is used by the h1 dispatcher.","closed_by":{"login":"seanmonstar","id":51479,"node_id":"MDQ6VXNlcjUxNDc5","avatar_url":"https://avatars.githubusercontent.com/u/51479?v=4","gravatar_id":"","url":"https://api.github.com/users/seanmonstar","html_url":"https://github.com/seanmonstar","followers_url":"https://api.github.com/users/seanmonstar/followers","following_url":"https://api.github.com/users/seanmonstar/following{/other_user}","gists_url":"https://api.github.com/users/seanmonstar/gists{/gist_id}","starred_url":"https://api.github.com/users/seanmonstar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seanmonstar/subscriptions","organizations_url":"https://api.github.com/users/seanmonstar/orgs","repos_url":"https://api.github.com/users/seanmonstar/repos","events_url":"https://api.github.com/users/seanmonstar/events{/privacy}","received_events_url":"https://api.github.com/users/seanmonstar/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/hyperium/hyper/issues/2260/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/hyperium/hyper/issues/2260/timeline","performed_via_github_app":null,"state_reason":"completed"}