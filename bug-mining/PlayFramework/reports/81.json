{"url":"https://api.github.com/repos/playframework/playframework/issues/5883","repository_url":"https://api.github.com/repos/playframework/playframework","labels_url":"https://api.github.com/repos/playframework/playframework/issues/5883/labels{/name}","comments_url":"https://api.github.com/repos/playframework/playframework/issues/5883/comments","events_url":"https://api.github.com/repos/playframework/playframework/issues/5883/events","html_url":"https://github.com/playframework/playframework/issues/5883","id":140865007,"node_id":"MDU6SXNzdWUxNDA4NjUwMDc=","number":5883,"title":"FileIO.fromFile triggers exception java.util.NoSuchElementException: http-handler-body-subscriber","user":{"login":"gmethvin","id":171663,"node_id":"MDQ6VXNlcjE3MTY2Mw==","avatar_url":"https://avatars.githubusercontent.com/u/171663?v=4","gravatar_id":"","url":"https://api.github.com/users/gmethvin","html_url":"https://github.com/gmethvin","followers_url":"https://api.github.com/users/gmethvin/followers","following_url":"https://api.github.com/users/gmethvin/following{/other_user}","gists_url":"https://api.github.com/users/gmethvin/gists{/gist_id}","starred_url":"https://api.github.com/users/gmethvin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmethvin/subscriptions","organizations_url":"https://api.github.com/users/gmethvin/orgs","repos_url":"https://api.github.com/users/gmethvin/repos","events_url":"https://api.github.com/users/gmethvin/events{/privacy}","received_events_url":"https://api.github.com/users/gmethvin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2016-03-15T03:57:57Z","updated_at":"2016-04-06T21:34:05Z","closed_at":"2016-04-06T21:34:05Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Play Version (2.5.x / etc)\n\n2.5.x\n### API (Scala / Java / Neither / Both)\n\nBoth\n### JDK\n\n```\njava version \"1.8.0_65\"\nJava(TM) SE Runtime Environment (build 1.8.0_65-b17)\nJava HotSpot(TM) 64-Bit Server VM (build 25.65-b01, mixed mode)\n```\n### Expected Behavior\n\nThe following code should work without exception.\n### Actual Behavior\n\nException is thrown.\n### Reproducible Test Case\n\n(code from #5866)\n\n``` scala\n@Singleton\nclass HomeController @Inject()(db: DBApi, ws: WSClient)(implicit materializer: Materializer) extends Controller {\n\n  // Throws: java.util.NoSuchElementException: http-handler-body-subscriber\n  def streaming1 = Action {\n    try {\n      val fileName = \"/Volumes/Share/Book/AkkaScala2.3.14.pdf\"\n      val file = new File(fileName)\n      val fileContent: Source[ByteString, Future[IOResult]] = FileIO.fromFile(file)\n      val contentType = play.api.libs.MimeTypes.forFileName(fileName).orElse(Some(play.api.http.ContentTypes.BINARY))\n      Result(\n        header = ResponseHeader(200, Map(CONTENT_LENGTH -> file.length.toString)),\n        body = HttpEntity.Streamed(fileContent, Some(file.length()), contentType)\n      )\n    } catch {\n      case t: Throwable =>\n        InternalServerError(\"Error in server: \" + t.getMessage())\n    }\n  }\n\n  // works\n  def streaming2 = Action {\n    val file = new File(\"/Volumes/Share/Book/AkkaScala2.3.14.pdf\")\n    val in: FileInputStream = new FileInputStream(file)\n    val dataContent: Enumerator[Array[Byte]] = Enumerator.fromStream(in, 1024*1024)\n    val source: Source[Array[Byte], NotUsed] = Source.fromPublisher(Streams.enumeratorToPublisher(dataContent))\n    Ok.chunked(source).as(\"application/pdf\")\n  }\n}\n```\n","closed_by":{"login":"gmethvin","id":171663,"node_id":"MDQ6VXNlcjE3MTY2Mw==","avatar_url":"https://avatars.githubusercontent.com/u/171663?v=4","gravatar_id":"","url":"https://api.github.com/users/gmethvin","html_url":"https://github.com/gmethvin","followers_url":"https://api.github.com/users/gmethvin/followers","following_url":"https://api.github.com/users/gmethvin/following{/other_user}","gists_url":"https://api.github.com/users/gmethvin/gists{/gist_id}","starred_url":"https://api.github.com/users/gmethvin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmethvin/subscriptions","organizations_url":"https://api.github.com/users/gmethvin/orgs","repos_url":"https://api.github.com/users/gmethvin/repos","events_url":"https://api.github.com/users/gmethvin/events{/privacy}","received_events_url":"https://api.github.com/users/gmethvin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/playframework/playframework/issues/5883/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/playframework/playframework/issues/5883/timeline","performed_via_github_app":null,"state_reason":"completed"}