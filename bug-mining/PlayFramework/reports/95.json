{"url":"https://api.github.com/repos/playframework/playframework/issues/6629","repository_url":"https://api.github.com/repos/playframework/playframework","labels_url":"https://api.github.com/repos/playframework/playframework/issues/6629/labels{/name}","comments_url":"https://api.github.com/repos/playframework/playframework/issues/6629/comments","events_url":"https://api.github.com/repos/playframework/playframework/issues/6629/events","html_url":"https://github.com/playframework/playframework/issues/6629","id":181680864,"node_id":"MDU6SXNzdWUxODE2ODA4NjQ=","number":6629,"title":"Parse error in forwarding header when running behind a ipv6 haproxy","user":{"login":"swoopster-sb","id":9947609,"node_id":"MDQ6VXNlcjk5NDc2MDk=","avatar_url":"https://avatars.githubusercontent.com/u/9947609?v=4","gravatar_id":"","url":"https://api.github.com/users/swoopster-sb","html_url":"https://github.com/swoopster-sb","followers_url":"https://api.github.com/users/swoopster-sb/followers","following_url":"https://api.github.com/users/swoopster-sb/following{/other_user}","gists_url":"https://api.github.com/users/swoopster-sb/gists{/gist_id}","starred_url":"https://api.github.com/users/swoopster-sb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/swoopster-sb/subscriptions","organizations_url":"https://api.github.com/users/swoopster-sb/orgs","repos_url":"https://api.github.com/users/swoopster-sb/repos","events_url":"https://api.github.com/users/swoopster-sb/events{/privacy}","received_events_url":"https://api.github.com/users/swoopster-sb/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2016-10-07T14:18:47Z","updated_at":"2016-11-05T02:45:55Z","closed_at":"2016-11-05T02:45:55Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Getting `play.core.server.common.ForwardedHeaderHandler - Error with info in forwarding header ForwardedEntry(Some(::ffff:123.123.123.123),Some(https)), using ConnectionInfo(/10.100.0.5,false) instead: Parse error: Left(failure: ':' expected but '.' found).` when running play framework on ipv4 behind a ipv4+ipv6 haproxy.\n### System\n\nPlay Version: 2.5.8 scala\n\nLinux vm 4.4.0-38-generic #57-Ubuntu SMP Tue Sep 6 15:42:33 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux\n\nOracle java version \"1.8.0_101\"\nJava(TM) SE Runtime Environment (build 1.8.0_101-b13)\nJava HotSpot(TM) 64-Bit Server VM (build 25.101-b13, mixed mode)\n\nHA-Proxy version 1.6.3 2015/12/25\n### HA-Proxy setup (running on 10.100.0.5)\n\n```\ndefaults\n    log global\n    mode    http\n    option  httplog\n    option  dontlognull\n    option forwardfor\n    option http-server-close\n\nfrontend www-http\n   bind :::80 v4v6\n   reqadd X-Forwarded-Proto:\\ http\n   default_backend play\n\nfrontend www-https\n   bind :::443 v4v6 ssl crt /etc/haproxy/ssl/\n   reqadd X-Forwarded-Proto:\\ https\n   default_backend play\n\nbackend play\n   redirect scheme https if !{ ssl_fc }\n   balance roundrobin\n   server play 10.103.1.4:9000 check\n```\n### Play setup\n\napplication.conf contains:\n`play.http.forwarded.trustedProxies=[ \"10.100.0.5/24\" ]`\n### How to reproduce\n\naccessing haproxy at 10.100.0.5 from 123.123.123.123 produces a request to play, which gives:\n\n`[debug] - access - request header: ArrayBuffer((Host,xxxxxxxxx), (User-Agent,Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.116 Safari/537.36), (Accept,image/webp,image/*,*/*;q=0.8), (Accept-Encoding,gzip, deflate, sdch, br), (Accept-Language,de-DE,de;q=0.8,en-US;q=0.6,en;q=0.4), (Cookie,G_ENABLED_IDPS=google), (X-Forwarded-Proto,https), (X-Forwarded-For,::ffff:123.123.123.123), (Connection,close))`\n### Expected Behavior\n\nPlay Framework should parse the Forwarded Header correctly to 123.123.123.123\n### Actual Behavior\n\nPlay fails to parse the X-Forwared-For header:\n`[debug] - play.core.server.common.ForwardedHeaderHandler - Error with info in forwarding header ForwardedEntry(Some(::ffff:123.123.123.123),Some(https)), using ConnectionInfo(/10.100.0.5,false) instead: Parse error: Left(failure:`:' expected but `.' found).`\n\nHow to fix this?\n","closed_by":{"login":"gmethvin","id":171663,"node_id":"MDQ6VXNlcjE3MTY2Mw==","avatar_url":"https://avatars.githubusercontent.com/u/171663?v=4","gravatar_id":"","url":"https://api.github.com/users/gmethvin","html_url":"https://github.com/gmethvin","followers_url":"https://api.github.com/users/gmethvin/followers","following_url":"https://api.github.com/users/gmethvin/following{/other_user}","gists_url":"https://api.github.com/users/gmethvin/gists{/gist_id}","starred_url":"https://api.github.com/users/gmethvin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gmethvin/subscriptions","organizations_url":"https://api.github.com/users/gmethvin/orgs","repos_url":"https://api.github.com/users/gmethvin/repos","events_url":"https://api.github.com/users/gmethvin/events{/privacy}","received_events_url":"https://api.github.com/users/gmethvin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/playframework/playframework/issues/6629/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/playframework/playframework/issues/6629/timeline","performed_via_github_app":null,"state_reason":"completed"}