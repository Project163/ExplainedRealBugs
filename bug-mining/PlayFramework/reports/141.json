{"url":"https://api.github.com/repos/playframework/playframework/issues/8332","repository_url":"https://api.github.com/repos/playframework/playframework","labels_url":"https://api.github.com/repos/playframework/playframework/issues/8332/labels{/name}","comments_url":"https://api.github.com/repos/playframework/playframework/issues/8332/comments","events_url":"https://api.github.com/repos/playframework/playframework/issues/8332/events","html_url":"https://github.com/playframework/playframework/issues/8332","id":310954928,"node_id":"MDU6SXNzdWUzMTA5NTQ5Mjg=","number":8332,"title":"Q: Should DiscardedMaxAge be set back to zero?","user":{"login":"ppopoff","id":1836091,"node_id":"MDQ6VXNlcjE4MzYwOTE=","avatar_url":"https://avatars.githubusercontent.com/u/1836091?v=4","gravatar_id":"","url":"https://api.github.com/users/ppopoff","html_url":"https://github.com/ppopoff","followers_url":"https://api.github.com/users/ppopoff/followers","following_url":"https://api.github.com/users/ppopoff/following{/other_user}","gists_url":"https://api.github.com/users/ppopoff/gists{/gist_id}","starred_url":"https://api.github.com/users/ppopoff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ppopoff/subscriptions","organizations_url":"https://api.github.com/users/ppopoff/orgs","repos_url":"https://api.github.com/users/ppopoff/repos","events_url":"https://api.github.com/users/ppopoff/events{/privacy}","received_events_url":"https://api.github.com/users/ppopoff/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":33226934,"node_id":"MDU6TGFiZWwzMzIyNjkzNA==","url":"https://api.github.com/repos/playframework/playframework/labels/type:improvement","name":"type:improvement","color":"0052cc","default":false,"description":null},{"id":60939452,"node_id":"MDU6TGFiZWw2MDkzOTQ1Mg==","url":"https://api.github.com/repos/playframework/playframework/labels/help%20wanted","name":"help wanted","color":"7057ff","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-04-03T18:51:40Z","updated_at":"2018-04-05T21:58:03Z","closed_at":"2018-04-05T21:58:03Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi guys. I've been roaming through the codebase and found a place that I think is just plain wrong:\r\n\r\n[Cookie.scala:102][1]\r\n\r\n    /**\r\n      * The cookie's max age, in seconds, when we expire the cookie.\r\n      * This is also used to determine Expires. It's set to one day\r\n      * ago to work for clients that only support Expires and have\r\n      * a clock that is slightly behind.\r\n      */\r\n      val DiscardedMaxAge: Int = -1.day.toSeconds.toInt\r\n    }\r\n\r\n[1]: https://github.com/playframework/playframework/blob/0f18b8debd5d4c12948db735567491b199eb1bb2/framework/src/play/src/main/scala/play/api/mvc/Cookie.scala#L102\r\n\r\nI believe you don't need to use a negative `Max-Age` value to discard the cookie. Zero should be enough. In fact, it's the most portable way available.\r\n\r\n[RFC 6265 (the actual standard)][2]\r\n\r\n    4.1.2.2.  The Max-Age Attribute\r\n\r\n    The Max-Age attribute indicates the maximum lifetime of the cookie,\r\n    represented as the number of seconds until the cookie expires.  The\r\n    user agent is not required to retain the cookie for the specified\r\n    duration.  In fact, user agents often evict cookies due to memory\r\n    pressure or privacy concerns.\r\n\r\n       NOTE: Some existing user agents do not support the Max-Age\r\n       attribute.  User agents that do not support the Max-Age attribute\r\n       ignore the attribute.\r\n\r\n    If a cookie has both the Max-Age and the Expires attribute, the Max-\r\n    Age attribute has precedence and controls the expiration date of the\r\n    cookie.  If a cookie has neither the Max-Age nor the Expires\r\n    attribute, the user agent will retain the cookie until \"the current\r\n    session is over\" (as defined by the user agent).\r\n\r\n    If delta-seconds is less than or equal to zero (0), let expiry-time\r\n    be the earliest representable date and time.  Otherwise, let the\r\n    expiry-time be the current date and time plus delta-seconds seconds\r\n\r\n[RFC 2965 (obsolete)][3]\r\n\r\n    Max-Age=value\r\n      OPTIONAL.  The value of the Max-Age attribute is delta-seconds,\r\n      the lifetime of the cookie in seconds, a decimal non-negative\r\n      integer.  To handle cached cookies correctly, a client SHOULD\r\n      calculate the age of the cookie according to the age calculation\r\n      rules in the HTTP/1.1 specification [RFC2616].  When the age is\r\n      greater than delta-seconds seconds, the client SHOULD discard the\r\n      cookie.  A value of zero means the cookie SHOULD be discarded\r\n      immediately.\r\n\r\n[RFC 2109 (prehistoric)][4]\r\n\r\n    Max-Age=delta-seconds\r\n      Optional.  The Max-Age attribute defines the lifetime of the\r\n      cookie, in seconds.  The delta-seconds value is a decimal non-\r\n      negative integer.  After delta-seconds seconds elapse, the client\r\n      should discard the cookie.  A value of zero means the cookie\r\n      should be discarded immediately.\r\n\r\n[2]: https://tools.ietf.org/html/rfc6265#section-4.1\r\n[3]: https://tools.ietf.org/html/rfc2965\r\n[4]: https://tools.ietf.org/html/rfc2109\r\n\r\nThe latest standard declares the precedence of Max-Age over Expires, which makes the latter unnecessary. Meanwhile, the framework provides it to support older clients. Unfortunately, negative max-ages are violating the older RFCs, which are the ones older clients are likely to support. Which spoils the whole idea.\r\n\r\nMoreover, the hardcoded one-day offset seems very dangerous: cookie cancellation must not depend on the client's local time settings.\r\n\r\nI found out that it's the #6890, where this workaround-ish behavior was introduced instead of a proper fix in [ServerCookieEncoder.java:85][5].\r\n\r\n[5]: https://github.com/playframework/playframework/blob/0f18b8debd5d4c12948db735567491b199eb1bb2/framework/src/play/src/main/java/play/core/cookie/encoding/ServerCookieEncoder.java#L85\r\n","closed_by":{"login":"richdougherty","id":14750,"node_id":"MDQ6VXNlcjE0NzUw","avatar_url":"https://avatars.githubusercontent.com/u/14750?v=4","gravatar_id":"","url":"https://api.github.com/users/richdougherty","html_url":"https://github.com/richdougherty","followers_url":"https://api.github.com/users/richdougherty/followers","following_url":"https://api.github.com/users/richdougherty/following{/other_user}","gists_url":"https://api.github.com/users/richdougherty/gists{/gist_id}","starred_url":"https://api.github.com/users/richdougherty/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richdougherty/subscriptions","organizations_url":"https://api.github.com/users/richdougherty/orgs","repos_url":"https://api.github.com/users/richdougherty/repos","events_url":"https://api.github.com/users/richdougherty/events{/privacy}","received_events_url":"https://api.github.com/users/richdougherty/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/playframework/playframework/issues/8332/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/playframework/playframework/issues/8332/timeline","performed_via_github_app":null,"state_reason":"completed"}