{"url":"https://api.github.com/repos/playframework/playframework/issues/9418","repository_url":"https://api.github.com/repos/playframework/playframework","labels_url":"https://api.github.com/repos/playframework/playframework/issues/9418/labels{/name}","comments_url":"https://api.github.com/repos/playframework/playframework/issues/9418/comments","events_url":"https://api.github.com/repos/playframework/playframework/issues/9418/events","html_url":"https://github.com/playframework/playframework/issues/9418","id":459473679,"node_id":"MDU6SXNzdWU0NTk0NzM2Nzk=","number":9418,"title":"Unable to Ctrl-C out of 'run' with sbt 1.3.0-RC2","user":{"login":"eed3si9n","id":184683,"node_id":"MDQ6VXNlcjE4NDY4Mw==","avatar_url":"https://avatars.githubusercontent.com/u/184683?v=4","gravatar_id":"","url":"https://api.github.com/users/eed3si9n","html_url":"https://github.com/eed3si9n","followers_url":"https://api.github.com/users/eed3si9n/followers","following_url":"https://api.github.com/users/eed3si9n/following{/other_user}","gists_url":"https://api.github.com/users/eed3si9n/gists{/gist_id}","starred_url":"https://api.github.com/users/eed3si9n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eed3si9n/subscriptions","organizations_url":"https://api.github.com/users/eed3si9n/orgs","repos_url":"https://api.github.com/users/eed3si9n/repos","events_url":"https://api.github.com/users/eed3si9n/events{/privacy}","received_events_url":"https://api.github.com/users/eed3si9n/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2019-06-22T13:20:31Z","updated_at":"2019-07-15T05:58:22Z","closed_at":"2019-07-15T05:58:22Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This was originally reported by @dwijnand as https://github.com/sbt/sbt/issues/4822\r\n\r\n## steps\r\n\r\n* Take https://github.com/playframework/play-samples/tree/f6519a15096fd7eb49f4f19ae444faade936b479/play-scala-compile-di-example\r\n* Update to sbt 1.3.0-RC2\r\n* Also update Play to 2.7.3\r\n* Start `sbt`\r\n* Execute `run`\r\n* Visit http://localhost:9000/\r\n* Hit `Ctrl-C`\r\n\r\nor alternatively set `Global / cancelable := true`\r\n\r\n## problem\r\n\r\n```\r\n[play-scala-compile-di-example] $ run\r\n\r\n--- (Running the application, auto-reloading is enabled) ---\r\n\r\n[info] p.c.s.AkkaHttpServer - Listening for HTTP on /0:0:0:0:0:0:0:0:9000\r\n\r\n(Server started, use Enter to stop and go back to the console...)\r\n\r\n[info] play.api.Play - Application started (Dev) (no global state)\r\n\r\n[warn] Canceling execution...\r\n\r\n[warn] Canceling execution...\r\n```\r\n\r\n## expectation\r\n\r\n(sbt 1.2.8 behaviour)\r\n\r\n```\r\n[play-scala-compile-di-example] $ run\r\n[info] Updating ...\r\n[info] Done updating.\r\n\r\n--- (Running the application, auto-reloading is enabled) ---\r\n\r\n[info] p.c.s.AkkaHttpServer - Listening for HTTP on /0:0:0:0:0:0:0:0:9000\r\n\r\n(Server started, use Enter to stop and go back to the console...)\r\n\r\n[info] play.api.Play - Application started (Dev) (no global state)\r\n[info] p.c.s.AkkaHttpServer - Stopping server...\r\n```\r\n\r\n## notes by Eugene\r\n\r\nhttps://github.com/sbt/sbt/blob/v1.3.0-RC2/main/src/main/scala/sbt/EvaluateTask.scala#L458-L464\r\n\r\n```scala\r\n    object runningEngine extends RunningTaskEngine {\r\n      def cancelAndShutdown(): Unit = {\r\n        println(\"\")\r\n        log.warn(\"Canceling execution...\")\r\n        shutdown()\r\n      }\r\n    }\r\n```\r\n\r\nBecause we see \"Canceling execution...\", likely `cancelAndShutdown()` was reached.\r\nhttps://github.com/sbt/sbt/blob/v1.3.0-RC2/main/src/main/scala/sbt/EvaluateTask.scala#L427-L436\r\n\r\n`shutdown` tries to kill the thread?\r\n\r\n```scala\r\n    def shutdown(): Unit = {\r\n      // First ensure that all threads are stopped for task execution.\r\n      shutdownThreads()\r\n      config.progressReporter.stop()\r\n\r\n      // Now we run the gc cleanup to force finalizers to clear out file handles (yay GC!)\r\n      if (config.forceGarbageCollection) {\r\n        GCUtil.forceGcWithInterval(config.minForcegcInterval, log)\r\n      }\r\n    }\r\n```\r\n\r\nPlay's Ctrl-C handling is here? https://github.com/playframework/playframework/blob/8b0d5afb8c353dd8cd8d9e8057136e1858ad0173/dev-mode/sbt-plugin/src/main/scala/play/sbt/PlayInteractionMode.scala#L62-L78\r\n\r\nMaybe `consoleReader.readCharacter()` doesn't allow the thread to be killed? Here are some changes that we've made in sbt to make shell prompt interruptible:\r\n\r\n- https://github.com/sbt/util/pull/48\r\n- https://github.com/sbt/sbt/pull/4585/commits/447ab5011c01b04af063130ac91338b960bcd4b5\r\n\r\n\r\n\r\n\r\n","closed_by":{"login":"mergify[bot]","id":37929162,"node_id":"MDM6Qm90Mzc5MjkxNjI=","avatar_url":"https://avatars.githubusercontent.com/in/10562?v=4","gravatar_id":"","url":"https://api.github.com/users/mergify%5Bbot%5D","html_url":"https://github.com/apps/mergify","followers_url":"https://api.github.com/users/mergify%5Bbot%5D/followers","following_url":"https://api.github.com/users/mergify%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/mergify%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/mergify%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mergify%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/mergify%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/mergify%5Bbot%5D/repos","events_url":"https://api.github.com/users/mergify%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/mergify%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/playframework/playframework/issues/9418/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/playframework/playframework/issues/9418/timeline","performed_via_github_app":null,"state_reason":"completed"}