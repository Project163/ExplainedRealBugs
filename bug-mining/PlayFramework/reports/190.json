{"url":"https://api.github.com/repos/playframework/playframework/issues/13013","repository_url":"https://api.github.com/repos/playframework/playframework","labels_url":"https://api.github.com/repos/playframework/playframework/issues/13013/labels{/name}","comments_url":"https://api.github.com/repos/playframework/playframework/issues/13013/comments","events_url":"https://api.github.com/repos/playframework/playframework/issues/13013/events","html_url":"https://github.com/playframework/playframework/issues/13013","id":2738358083,"node_id":"I_kwDOACO2xc6jOAdD","number":13013,"title":"Error at shutdown if tmpdir is not writeable even though it is not used","user":{"login":"gaeljw","id":18280708,"node_id":"MDQ6VXNlcjE4MjgwNzA4","avatar_url":"https://avatars.githubusercontent.com/u/18280708?v=4","gravatar_id":"","url":"https://api.github.com/users/gaeljw","html_url":"https://github.com/gaeljw","followers_url":"https://api.github.com/users/gaeljw/followers","following_url":"https://api.github.com/users/gaeljw/following{/other_user}","gists_url":"https://api.github.com/users/gaeljw/gists{/gist_id}","starred_url":"https://api.github.com/users/gaeljw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaeljw/subscriptions","organizations_url":"https://api.github.com/users/gaeljw/orgs","repos_url":"https://api.github.com/users/gaeljw/repos","events_url":"https://api.github.com/users/gaeljw/events{/privacy}","received_events_url":"https://api.github.com/users/gaeljw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-12-13T13:06:15Z","updated_at":"2025-02-16T10:08:09Z","closed_at":"2025-02-16T10:08:08Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"_Version: Play 3.0.6_\n\nDuring shutdown, the application can throw and log an error because the temporary directory used by Play is not writeable even though this directory was never used in the first place.\n\nThis is likely to happen in containerized environments with read-only filesystem as a default setup.\n\n---\n\n**Stack trace:**\n```\njava.nio.file.FileSystemException: /tmp/playtemp8313349136202869755: Read-only file system\n\tat java.base/sun.nio.fs.UnixException.translateToIOException(Unknown Source)\n\tat java.base/sun.nio.fs.UnixException.rethrowAsIOException(Unknown Source)\n\tat java.base/sun.nio.fs.UnixException.rethrowAsIOException(Unknown Source)\n\tat java.base/sun.nio.fs.UnixFileSystemProvider.createDirectory(Unknown Source)\n\tat java.base/java.nio.file.Files.createDirectory(Unknown Source)\n\tat java.base/java.nio.file.TempFileHelper.create(Unknown Source)\n\tat java.base/java.nio.file.TempFileHelper.createTempDirectory(Unknown Source)\n\tat java.base/java.nio.file.Files.createTempDirectory(Unknown Source)\n\tat play.api.libs.Files$DefaultTemporaryFileCreator.playTempFolder$lzycompute(Files.scala:263)\n\tat play.api.libs.Files$DefaultTemporaryFileCreator.play$api$libs$Files$DefaultTemporaryFileCreator$$playTempFolder(Files.scala:260)\n\tat play.api.libs.Files$DefaultTemporaryFileCreator.$anonfun$new$1(Files.scala:320)\n\tat scala.util.Try$.apply(Try.scala:217)\n\tat play.api.inject.DefaultApplicationLifecycle.$anonfun$stop$2(ApplicationLifecycle.scala:128)\n\tat scala.concurrent.impl.Promise$Transformation.run(Promise.scala:470)\n\tat play.api.libs.streams.Execution$trampoline$.execute(Execution.scala:65)\n\tat scala.concurrent.impl.Promise$Transformation.submitWithValue(Promise.scala:429)\n\tat scala.concurrent.impl.Promise$DefaultPromise.submitWithValue(Promise.scala:338)\n\tat scala.concurrent.impl.Promise$DefaultPromise.dispatchOrAddCallbacks(Promise.scala:312)\n\tat scala.concurrent.impl.Promise$DefaultPromise.flatMap(Promise.scala:176)\n\tat play.api.inject.DefaultApplicationLifecycle.clearHooks$1(ApplicationLifecycle.scala:127)\n\tat play.api.inject.DefaultApplicationLifecycle.stop(ApplicationLifecycle.scala:139)\n\tat play.api.libs.concurrent.CoordinatedShutdownProvider.$anonfun$get$2(Pekko.scala:305)\n\tat org.apache.pekko.actor.CoordinatedShutdown$tasks$TaskDefinition$$anon$2.liftedTree1$1(CoordinatedShutdown.scala:438)\n\tat org.apache.pekko.actor.CoordinatedShutdown$tasks$TaskDefinition$$anon$2.run(CoordinatedShutdown.scala:437)\n\tat org.apache.pekko.actor.CoordinatedShutdown$tasks$StrictPhaseDefinition.$anonfun$run$3(CoordinatedShutdown.scala:496)\n\tat scala.collection.StrictOptimizedIterableOps.map(StrictOptimizedIterableOps.scala:100)\n\tat scala.collection.StrictOptimizedIterableOps.map$(StrictOptimizedIterableOps.scala:87)\n\tat scala.collection.immutable.Set$Set1.map(Set.scala:165)\n\tat org.apache.pekko.actor.CoordinatedShutdown$tasks$StrictPhaseDefinition.run(CoordinatedShutdown.scala:496)\n\tat org.apache.pekko.actor.CoordinatedShutdown.loop$1(CoordinatedShutdown.scala:745)\n\tat org.apache.pekko.actor.CoordinatedShutdown.$anonfun$run$7(CoordinatedShutdown.scala:773)\n\tat scala.concurrent.impl.Promise$Transformation.run(Promise.scala:470)\n\tat org.apache.pekko.dispatch.BatchingExecutor$AbstractBatch.processBatch(BatchingExecutor.scala:73)\n\tat org.apache.pekko.dispatch.BatchingExecutor$BlockableBatch.$anonfun$run$1(BatchingExecutor.scala:110)\n\tat scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.scala:18)\n\tat scala.concurrent.BlockContext$.withBlockContext(BlockContext.scala:94)\n\tat org.apache.pekko.dispatch.BatchingExecutor$BlockableBatch.run(BatchingExecutor.scala:110)\n\tat org.apache.pekko.dispatch.TaskInvocation.run(AbstractDispatcher.scala:59)\n\tat org.apache.pekko.dispatch.ForkJoinExecutorConfigurator$PekkoForkJoinTask.exec(ForkJoinExecutorConfigurator.scala:57)\n\tat java.base/java.util.concurrent.ForkJoinTask.doExec(Unknown Source)\n\tat java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(Unknown Source)\n\tat java.base/java.util.concurrent.ForkJoinPool.scan(Unknown Source)\n\tat java.base/java.util.concurrent.ForkJoinPool.runWorker(Unknown Source)\n\tat java.base/java.util.concurrent.ForkJoinWorkerThread.run(Unknown Source)\n```\n\n---\n\nThis happens because a stop hook is registered to clean the temporary directory but the directory is created only at first access. If the app doesn't need temporary files, the directory is never created and the stop hook thus tries to create it only to delete it afterwards.\n\n**Related sources:**\n\nhttps://github.com/playframework/playframework/blob/28447a52805ba5c082c8fd6e6a3dd9ba583b933d/core/play/src/main/scala/play/api/libs/Files.scala#L318-L320\n\nhttps://github.com/playframework/playframework/blob/28447a52805ba5c082c8fd6e6a3dd9ba583b933d/core/play/src/main/scala/play/api/libs/Files.scala#L260-L266\n\n---\n\nWhile the error is definitely not an issue, it can raise false alerts for systems watching ERROR logs.\n\n**I would suggest to have a way to know if the directory was never created and thus do not try to clean anything. WDYT?**","closed_by":{"login":"mergify[bot]","id":37929162,"node_id":"MDM6Qm90Mzc5MjkxNjI=","avatar_url":"https://avatars.githubusercontent.com/in/10562?v=4","gravatar_id":"","url":"https://api.github.com/users/mergify%5Bbot%5D","html_url":"https://github.com/apps/mergify","followers_url":"https://api.github.com/users/mergify%5Bbot%5D/followers","following_url":"https://api.github.com/users/mergify%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/mergify%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/mergify%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mergify%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/mergify%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/mergify%5Bbot%5D/repos","events_url":"https://api.github.com/users/mergify%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/mergify%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/playframework/playframework/issues/13013/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/playframework/playframework/issues/13013/timeline","performed_via_github_app":null,"state_reason":"completed"}