<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:57:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1911] Log deletion on stopping replicas should be async</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1911</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;If a StopReplicaRequest sets delete=true then we do a file.delete on the file message sets. I was under the impression that this is fast but it does not seem to be the case.&lt;/p&gt;

&lt;p&gt;On a partition reassignment in our cluster the local time for stop replica took nearly 30 seconds.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Completed request:Name: StopReplicaRequest; Version: 0; CorrelationId: 467; ClientId: ;    DeletePartitions: true; ControllerId: 1212; ControllerEpoch: 53 from client/...:45964;totalTime:29191,requestQueueTime:1,localTime:29190,remoteTime:0,responseQueueTime:0,sendTime:0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This ties up one API thread for the duration of the request.&lt;/p&gt;

&lt;p&gt;Specifically in our case, the queue times for other requests also went up and producers to the partition that was just deleted on the old leader took a while to refresh their metadata (see &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1303&quot; title=&quot;metadata request in the new producer can be delayed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1303&quot;&gt;&lt;del&gt;KAFKA-1303&lt;/del&gt;&lt;/a&gt;) and eventually ran out of retries on some messages leading to data loss.&lt;/p&gt;

&lt;p&gt;I think the log deletion in this case should be fully asynchronous although we need to handle the case when a broker may respond immediately to the stop-replica-request but then go down after deleting only some of the log segments.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12771581">KAFKA-1911</key>
            <summary>Log deletion on stopping replicas should be async</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgharat">Mayuresh Gharat</assignee>
                                    <reporter username="jjkoshy">Joel Jacob Koshy</reporter>
                        <labels>
                            <label>newbie++</label>
                            <label>newbiee</label>
                    </labels>
                <created>Sun, 1 Feb 2015 06:46:25 +0000</created>
                <updated>Mon, 26 Dec 2016 22:38:02 +0000</updated>
                            <resolved>Wed, 30 Nov 2016 19:04:28 +0000</resolved>
                                                                    <component>log</component>
                    <component>replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14541498" author="avianey" created="Wed, 13 May 2015 07:11:13 +0000"  >&lt;p&gt;it should handle the case of a producer producing log to this replica...&lt;/p&gt;</comment>
                            <comment id="14903046" author="jjkoshy" created="Tue, 22 Sep 2015 17:33:24 +0000"  >&lt;p&gt;The original motivation in this ticket was to avoid a high latency request from tying up request handlers. However, while thinking through some nuances of delete topic, I think delete topic would also benefit from this. Since stop-replica-requests can take a while to finish delete topic can also take a while (apart from failure cases such as a replica being down).&lt;/p&gt;

&lt;p&gt;I think the easiest way to fix this would be to just rename the partition directory from &amp;lt;topic&amp;gt;&amp;lt;partId&amp;gt; to something like &amp;lt;topic&amp;gt;&amp;lt;partId&amp;gt;deleted&amp;lt;seqNo&amp;gt; and asynchronously delete that. The &amp;lt;seqNo&amp;gt; is probably needed if a user were to delete and recreate multiple times in rapid fire for whatever reason.&lt;/p&gt;</comment>
                            <comment id="15003232" author="mgharat" created="Thu, 12 Nov 2015 23:52:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=geoffra&quot; class=&quot;user-hover&quot; rel=&quot;geoffra&quot;&gt;geoffra&lt;/a&gt; are you actively working on this. If not I would like to take it up as I have recently started testing DeleteTopic usecases.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Mayuresh&lt;/p&gt;</comment>
                            <comment id="15003281" author="granders" created="Fri, 13 Nov 2015 00:25:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgharat&quot; class=&quot;user-hover&quot; rel=&quot;mgharat&quot;&gt;mgharat&lt;/a&gt; Feel free to grab this, I&apos;m not actually working on this.&lt;/p&gt;</comment>
                            <comment id="15045855" author="githubbot" created="Mon, 7 Dec 2015 22:09:55 +0000"  >&lt;p&gt;GitHub user MayureshGharat opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/636&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/636&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1911&quot; title=&quot;Log deletion on stopping replicas should be async&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1911&quot;&gt;&lt;del&gt;KAFKA-1911&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Made delete topic on brokers async&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/MayureshGharat/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/MayureshGharat/kafka&lt;/a&gt; kafka-1911&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/636.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/636.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #636&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 86a432c21eb2b206ffe120a4a4172a087fb109d4&lt;br/&gt;
Author: Mayuresh Gharat &amp;lt;mgharat@mgharat-ld1.linkedin.biz&amp;gt;&lt;br/&gt;
Date:   2015-12-07T22:01:22Z&lt;/p&gt;

&lt;p&gt;    Made Delete topic on the brokers Async&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15392877" author="sutambe" created="Mon, 25 Jul 2016 23:54:43 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgharat&quot; class=&quot;user-hover&quot; rel=&quot;mgharat&quot;&gt;mgharat&lt;/a&gt;, I would like to take your patch over. I&apos;ve rebased your patch on top of the latest trunk and fixed a couple of test failures. I&apos;ll send a pull-request soon.&lt;/p&gt;</comment>
                            <comment id="15392910" author="githubbot" created="Tue, 26 Jul 2016 00:23:07 +0000"  >&lt;p&gt;GitHub user sutambe opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1664&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1664&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1911&quot; title=&quot;Log deletion on stopping replicas should be async&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1911&quot;&gt;&lt;del&gt;KAFKA-1911&lt;/del&gt;&lt;/a&gt;: Async delete topic&lt;/p&gt;

&lt;p&gt;    The last patch submitted by @MayureshGharat (back in Dec 15) has been rebased to the latest trunk. I took care of a couple of test failures (MetricsTest) along the way. @jjkoshy , @granders , @avianey , you may be interested in this PR.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/sutambe/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/sutambe/kafka&lt;/a&gt; async-delete-topic&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1664.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1664.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1664&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit dbc54e6bcd5001c478028f7032f9ff0a59f53f89&lt;br/&gt;
Author: Mayuresh Gharat &amp;lt;mgharat@mgharat-ld1.linkedin.biz&amp;gt;&lt;br/&gt;
Date:   2015-12-07T22:01:22Z&lt;/p&gt;

&lt;p&gt;    Made Delete topic on the brokers Async&lt;/p&gt;

&lt;p&gt;    Signed-off-by: Sumant Tambe &amp;lt;sutambe@linkedin.com&amp;gt;&lt;/p&gt;

&lt;p&gt;commit 5bfb31b070502ae06a65ec9cb5fcd4c8d6693278&lt;br/&gt;
Author: Mayuresh Gharat &amp;lt;mgharat@mgharat-ld1.linkedin.biz&amp;gt;&lt;br/&gt;
Date:   2015-12-17T23:13:07Z&lt;/p&gt;

&lt;p&gt;    Change the file pointers for log and index to point to the renamed directory&lt;/p&gt;

&lt;p&gt;    Signed-off-by: Sumant Tambe &amp;lt;sutambe@linkedin.com&amp;gt;&lt;/p&gt;

&lt;p&gt;commit 692f8768f0903a60274f317f6a238b5a2c621c1f&lt;br/&gt;
Author: Mayuresh Gharat &amp;lt;mgharat@mgharat-ld1.linkedin.biz&amp;gt;&lt;br/&gt;
Date:   2015-12-21T23:54:15Z&lt;/p&gt;

&lt;p&gt;    Added a check to not recoverLogs for directories marked for delete. This is to speedup startup process. Also added check that Log directories ending with .delete be added to a separate set of logs that the are to be deleted asynchronously.&lt;/p&gt;

&lt;p&gt;    Signed-off-by: Sumant Tambe &amp;lt;sutambe@linkedin.com&amp;gt;&lt;/p&gt;

&lt;p&gt;commit b6920ffaef5d086a691eba1ac4a66d429d1c5fcf&lt;br/&gt;
Author: Mayuresh Gharat &amp;lt;mgharat@mgharat-ld1.linkedin.biz&amp;gt;&lt;br/&gt;
Date:   2015-12-22T00:00:50Z&lt;/p&gt;

&lt;p&gt;    Removed a bug from earlier commit&lt;/p&gt;

&lt;p&gt;    Signed-off-by: Sumant Tambe &amp;lt;sutambe@linkedin.com&amp;gt;&lt;/p&gt;

&lt;p&gt;commit 161cb8c669298744d60eec75ca5072d3b0f0045f&lt;br/&gt;
Author: Mayuresh Gharat &amp;lt;mgharat@mgharat-ld1.linkedin.biz&amp;gt;&lt;br/&gt;
Date:   2015-12-22T00:03:44Z&lt;/p&gt;

&lt;p&gt;    Removed the extra &apos;;&apos;&lt;/p&gt;

&lt;p&gt;    Signed-off-by: Sumant Tambe &amp;lt;sutambe@linkedin.com&amp;gt;&lt;/p&gt;

&lt;p&gt;commit 161c14c5486cbe1fc0411fe6fc5745c78e36bedc&lt;br/&gt;
Author: MayureshGharat &amp;lt;gharatmayuresh15@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-03-10T21:25:38Z&lt;/p&gt;

&lt;p&gt;    Addressed Joel&apos;s comments on the patch&lt;/p&gt;

&lt;p&gt;    Signed-off-by: Sumant Tambe &amp;lt;sutambe@linkedin.com&amp;gt;&lt;/p&gt;

&lt;p&gt;commit 859dbb7a1d3f2b7b9ddc5d8b9edc128b1903f28c&lt;br/&gt;
Author: MayureshGharat &amp;lt;gharatmayuresh15@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-04-01T20:26:11Z&lt;/p&gt;

&lt;p&gt;    Addressed the NPE issue with race condition and also issues related to loading segments on a crash&lt;/p&gt;

&lt;p&gt;    Signed-off-by: Sumant Tambe &amp;lt;sutambe@linkedin.com&amp;gt;&lt;/p&gt;

&lt;p&gt;commit b93328cd446d9e0c753a966217b8b58fc6150ec6&lt;br/&gt;
Author: Sumant Tambe &amp;lt;sutambe@linkedin.com&amp;gt;&lt;br/&gt;
Date:   2016-07-26T00:11:25Z&lt;/p&gt;

&lt;p&gt;    Async log deletion rebase and successful testing&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15709379" author="githubbot" created="Wed, 30 Nov 2016 18:41:37 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1664&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1664&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15779108" author="githubbot" created="Mon, 26 Dec 2016 22:38:02 +0000"  >&lt;p&gt;Github user pono closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/636&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/636&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 47 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i251tz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>