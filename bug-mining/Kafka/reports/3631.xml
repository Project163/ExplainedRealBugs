<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:37:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-15695] Local log start offset is not updated on the follower after rebuilding remote log auxiliary state</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-15695</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In 3.6, the local log start offset is not updated when reconstructing the auxiliary state of the remote log on a follower.&lt;/p&gt;

&lt;p&gt;The impact of this bug is significant because, if this follower becomes the leader before the local log start offset has had a chance to be updated, reads from any offset between &lt;span class=&quot;error&quot;&gt;&amp;#91;wrong log start offset; actual log start offset&amp;#93;&lt;/span&gt; will be routed on the local storage, which does not contain the corresponding data. Consumer reads will in this case never be satisfied.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Reproduction case 1:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Create cluster with 2 brokers, broker 0 and broker 1.&lt;/li&gt;
	&lt;li&gt;Create a topic topicA with RF=1, 1 partition (topicA-0) on broker 0, and 1 batch per segment.&lt;/li&gt;
	&lt;li&gt;Produce 3 records to topicA, such that segment 1 and segment 2 with the first two records are copied to remote and deleted from local storage.&lt;/li&gt;
	&lt;li&gt;Reassign replica to add broker 1 to the replica set for topicA-0, and elect broker 1 as the leader.&lt;/li&gt;
	&lt;li&gt;Try to consume from the beginning of topicA-0.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Reproduction case 2:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Create a cluster with 2 brokers, broker 0 and broker 1.&lt;/li&gt;
	&lt;li&gt;Create a topic topicA with RF=2, 1 partition (topicA-0) and 2 batches per segment, with broker 0 as the leader.&lt;/li&gt;
	&lt;li&gt;Stop broker 1, and produce 3 records to topicA, such that segment 1 with the first two records are copied to remote and deleted from local storage.&lt;/li&gt;
	&lt;li&gt;Start broker 1, let it catch up with broker 0.&lt;/li&gt;
	&lt;li&gt;Stop broker 0 such that broker 1 is elected as the leader, and try to consume from the beginning of topicA-0.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Consumer read will not be satisfied in these cases because the local log start offset is not updated on broker 1 when it builds the auxiliary state of the remote log segments.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13555707">KAFKA-15695</key>
            <summary>Local log start offset is not updated on the follower after rebuilding remote log auxiliary state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nikramakrishnan">Nikhil Ramakrishnan</assignee>
                                    <reporter username="nikramakrishnan">Nikhil Ramakrishnan</reporter>
                        <labels>
                            <label>KIP-405</label>
                            <label>tiered-storage</label>
                    </labels>
                <created>Thu, 26 Oct 2023 16:21:38 +0000</created>
                <updated>Mon, 26 Feb 2024 20:23:28 +0000</updated>
                            <resolved>Tue, 12 Dec 2023 16:14:20 +0000</resolved>
                                    <version>3.6.0</version>
                                    <fixVersion>3.7.0</fixVersion>
                                    <component>replication</component>
                    <component>Tiered-Storage</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17780166" author="ckamal" created="Fri, 27 Oct 2023 04:34:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nikramakrishnan&quot; class=&quot;user-hover&quot; rel=&quot;nikramakrishnan&quot;&gt;nikramakrishnan&lt;/a&gt;&lt;br/&gt;
I remember fixing this issue in &lt;a href=&quot;https://github.com/apache/kafka/pull/14328&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#14328&lt;/a&gt; and covered it via integration test. Can you come up with a test to reproduce this issue? Thanks!&lt;/p&gt;</comment>
                            <comment id="17780216" author="JIRAUSER301894" created="Fri, 27 Oct 2023 07:41:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ckamal&quot; class=&quot;user-hover&quot; rel=&quot;ckamal&quot;&gt;ckamal&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I added an integration test (for case 1) to &lt;a href=&quot;https://github.com/apache/kafka/pull/14649&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#14649&lt;/a&gt;&#160;with the fix. The integration test does not pass without the change. Please review! Thanks!&lt;/p&gt;</comment>
                            <comment id="17820852" author="hcai@pinterest.com" created="Mon, 26 Feb 2024 20:23:28 +0000"  >&lt;p&gt;Can this fix be back ported into 3.6.X branch?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310460">
                    <name>Child-Issue</name>
                                                                <inwardlinks description="is a child of">
                                        <issuelink>
            <issuekey id="13549279">KAFKA-15420</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1l7xs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>