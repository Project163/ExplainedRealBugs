<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:35:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-495] Handle topic names with &quot;/&quot; on Kafka server</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-495</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;If a producer publishes data to topic &quot;foo/foo&quot;, the Kafka server ends up creating an invalid directory structure on the server. This corrupts the zookeeper data structure for the topic - /brokers/topics/foo/foo. This leads to rebalancing failures on the consumer as well as errors on the zookeeper based producer. &lt;/p&gt;

&lt;p&gt;We need to harden the invalid topic handling on the Kafka server side to avoid this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12605833">KAFKA-495</key>
            <summary>Handle topic names with &quot;/&quot; on Kafka server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="swapnilghike">Swapnil Ghike</assignee>
                                    <reporter username="nehanarkhede">Neha Narkhede</reporter>
                        <labels>
                            <label>bugs</label>
                    </labels>
                <created>Sat, 1 Sep 2012 01:25:39 +0000</created>
                <updated>Mon, 1 Oct 2012 15:51:54 +0000</updated>
                            <resolved>Wed, 12 Sep 2012 02:16:21 +0000</resolved>
                                    <version>0.7</version>
                    <version>0.8.0</version>
                                    <fixVersion>0.7.2</fixVersion>
                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13448147" author="swapnilghike" created="Tue, 4 Sep 2012 22:55:14 +0000"  >&lt;p&gt;Created two server config properties - &lt;/p&gt;

&lt;p&gt;1. Black list of characters that are not allowed in the topic names. Currently it excludes alphanumeric characters, _, -, (, ), &lt;span class=&quot;error&quot;&gt;&amp;#91;, &amp;#93;&lt;/span&gt;, &lt;/p&gt;
{ and }
&lt;p&gt;. Whitespaces are blacklisted.&lt;/p&gt;

&lt;p&gt;2. Maximum length of a topic name.&lt;/p&gt;</comment>
                            <comment id="13448150" author="swapnilghike" created="Tue, 4 Sep 2012 22:57:47 +0000"  >&lt;p&gt;Some relevant discussion is at &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-196&quot; title=&quot;Topic creation fails on large values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-196&quot;&gt;&lt;del&gt;KAFKA-196&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13448152" author="jkreps" created="Tue, 4 Sep 2012 22:58:37 +0000"  >&lt;p&gt;It would be good to first work out the regular expression for valid topic names. It might also be nice to have a helper class TopicName that we use when the string being passed is meant as a topic name which applies this regex so we can be sure we are always checking validity.&lt;/p&gt;</comment>
                            <comment id="13448166" author="jkreps" created="Tue, 4 Sep 2012 23:14:41 +0000"  >&lt;p&gt;A couple suggestions:&lt;br/&gt;
1. This is a fairly conservative character list. Is there a rationale for being more conservative?&lt;br/&gt;
2. I don&apos;t think this list should be configurable, we should be able to put in our documentation what is legal and have that always be true and not worry about what happens if someone changes the definition of legal characters.&lt;br/&gt;
3. One corner case we need to consider is the interaction between regular expressions and topic names.&lt;br/&gt;
4. This patch does ~30 passes over the topic name, it would probably be faster to use a pre-compiled regular expression&lt;/p&gt;</comment>
                            <comment id="13448374" author="swapnilghike" created="Wed, 5 Sep 2012 01:16:53 +0000"  >&lt;p&gt;So I am planning to insert the following regex check.&lt;/p&gt;

&lt;p&gt;Unix constaints - &lt;br/&gt;
1. Ban / and \0 (both not allowed in unix, / is used as a path name component separator and \0 terminates file names in unix.)&lt;/p&gt;

&lt;p&gt;Zookeeper constaints:- &lt;br/&gt;
1. The null character (\u0000) cannot be part of a path name. (This causes problems with the C binding.)&lt;br/&gt;
2. The following characters can&apos;t be used because they don&apos;t display well, or render in confusing ways: \u0001 - \u0019 and \u007F - \u009F.&lt;br/&gt;
3. The following characters are not allowed: \ud800 -uF8FFF, \uFFF0-uFFFF, \uXFFFE - \uXFFFF (where X is a digit 1 - E), \uF0000 - \uFFFFF.&lt;br/&gt;
4. . and .. Are not allowed as filenames. Zookeeper supports only absolute filepaths.&lt;br/&gt;
5. The token &quot;zookeeper&quot; is reserved.&lt;/p&gt;

&lt;p&gt;In addition, I suggest the following two - &lt;br/&gt;
1. Ban leading and trailing whitespaces (because they confuse GUI users) - also takes care forbidding filenames composed of only whitespaces.&lt;br/&gt;
2. Ban leading . And .. Because unix hides those files.&lt;/p&gt;

&lt;p&gt;There are other cases where unfortunate errors may happen in ways not related to kafka or zookeeper, and programmers would need to take care about them.&lt;/p&gt;</comment>
                            <comment id="13448858" author="jkreps" created="Wed, 5 Sep 2012 16:19:51 +0000"  >&lt;p&gt;That sounds reasonable. I would actually argue for allowing anything unix+zk will allow. I agree that leading or trailing whitespace can be confusing and dots are odd, but I think forbidding or allowing that should be done at a higher level than kafka, we should allow anything we can tolerate. LiKafka wrapper can support a more conservative set of restrictions and naming conventions based on what we think names should look like.&lt;/p&gt;</comment>
                            <comment id="13448867" author="junrao" created="Wed, 5 Sep 2012 16:31:46 +0000"  >&lt;p&gt;Does it make sense to make the regex configurable that defaults to what Swapnil suggests?&lt;/p&gt;</comment>
                            <comment id="13448869" author="jkreps" created="Wed, 5 Sep 2012 16:35:00 +0000"  >&lt;p&gt;I don&apos;t think it does. It is like a filesystem--we should be able to document what works and what doesn&apos;t. I don&apos;t see a lot of value to users to making it configurable, and even if you try to configure &apos;/&apos; to work it won&apos;t. I think it would be better to say in our documentation &quot;the following unicode characters are valid in a topic name&quot; and just have that be definitive...&lt;/p&gt;</comment>
                            <comment id="13449119" author="jjkoshy" created="Wed, 5 Sep 2012 20:50:13 +0000"  >&lt;p&gt;I agree with not having a configurable topic name spec. I think that would be applicable if we decide to have an extremely restrictive spec by default (e.g., only alpha-numeric) in which case many users would want to override that. However the spec that Swapnil has sounds reasonably broad.&lt;/p&gt;</comment>
                            <comment id="13449278" author="swapnilghike" created="Wed, 5 Sep 2012 23:55:28 +0000"  >&lt;p&gt;1. Actually the zookeeper code does not implement all the checks that I mentioned earlier. So I have implemented:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;unix constraints (don&apos;t allow / and \0 chars, and don&apos;t allow . and .. filenames)&lt;/li&gt;
	&lt;li&gt;zookeeper constraints (dont allow chars in range \u0001-\u001F, \u007F-\u009F, \uD800-\uF8FF, \uFFF0-\uFFFF adnd \0)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;2. The list of illegal chars is not configurable.&lt;/p&gt;

&lt;p&gt;3. Regex used to check for illegal chars, . and .. filenames. It will be good if someone could take a look at the regular expression.&lt;/p&gt;

&lt;p&gt;4. Topic name length is configurable.&lt;/p&gt;

&lt;p&gt;5. Created a class TopicNameValidator in Utils. &lt;/p&gt;</comment>
                            <comment id="13449297" author="junrao" created="Thu, 6 Sep 2012 00:17:09 +0000"  >&lt;p&gt;Thanks for patch v2. Looks good overall. A couple of minor comments:&lt;/p&gt;

&lt;p&gt;20. LogManagerTest: Instead of duplicating code, could we create a list of invalid topics and run through logManager.getOrCreate?&lt;/p&gt;

&lt;p&gt;21. TopicNameValidator: Could we name the scala file TopicNameValidator.scala? Also, the message in InvalidTopicException should probably be something like &quot;topic is not allowed&quot;.&lt;/p&gt;</comment>
                            <comment id="13449310" author="swapnilghike" created="Thu, 6 Sep 2012 00:35:08 +0000"  >&lt;p&gt;Thanks, made the changes. &lt;/p&gt;</comment>
                            <comment id="13449860" author="swapnilghike" created="Thu, 6 Sep 2012 17:53:29 +0000"  >&lt;p&gt;Changed the property string in KafkaConfig for maxTopicNameLength.&lt;/p&gt;</comment>
                            <comment id="13449993" author="jkreps" created="Thu, 6 Sep 2012 19:56:06 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13450315" author="junrao" created="Fri, 7 Sep 2012 03:50:00 +0000"  >&lt;p&gt;Thanks for the patch. Committed to trunk. Could you port it to 0.8 too?&lt;/p&gt;</comment>
                            <comment id="13451203" author="swapnilghike" created="Sat, 8 Sep 2012 01:12:02 +0000"  >&lt;p&gt;Attached the 0.8 patch. It was taken with git --no-prefix, hope it works.&lt;/p&gt;</comment>
                            <comment id="13452074" author="junrao" created="Mon, 10 Sep 2012 15:29:14 +0000"  >&lt;p&gt;Thanks for the patch for 0.8. Overall, it looks good. Some minor comments.&lt;/p&gt;

&lt;p&gt;80. LogManager:&lt;br/&gt;
80.1. We don&apos;t need to verify the topic name in getLog() since logs are not created there. Verifying it in createLog is enough.&lt;br/&gt;
80.2. Get rid of unused imports.&lt;/p&gt;

&lt;p&gt;81. TopicNameValidator: get rid of &quot;/**/&quot;&lt;/p&gt;</comment>
                            <comment id="13452670" author="swapnilghike" created="Tue, 11 Sep 2012 02:52:42 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;After discussing with Jun, inserted topic validation in createTopic() instead of LogManager in 0.8.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Created a singleton Topic in Utils/Topic.scala, topicNameValidators in KafkaConfig and CreateTopicCommand default to the maxNameLen in this singleton. The value at both these locations can be overridden.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The check in LogManager.createLog is not necessary anymore because the topic would be validated by then, removed this check.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added a new unit test in test/utils for topic validation.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Tested this change with bin/kafka-create-topic.sh for fun.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Opened KAKFA-505 to deal with the TopicMetaDataResponse errorcode.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13453157" author="junrao" created="Tue, 11 Sep 2012 16:31:06 +0000"  >&lt;p&gt;Thanks for 0.8 patch v2. Some additional comments:&lt;/p&gt;

&lt;p&gt;1. KafkaApis: Instead of adding maxTopicNameLength in the constructor, we can get that value from replicaManager.config.&lt;/p&gt;

&lt;p&gt;2. CreateTopicCommand.createTopic(): Could we put topicNameValidator as the last parameter that defaults to an instance of topicNameValidator with the default max length. This way, most existing unit tests don&apos;t have to create a separate topicNameValidator.&lt;/p&gt;

&lt;p&gt;3. TopicTest: Is there a particular reason that the following loop is not from 1 to 5 instead?&lt;br/&gt;
for (i &amp;lt;- 3 to 8)&lt;/p&gt;</comment>
                            <comment id="13453458" author="swapnilghike" created="Tue, 11 Sep 2012 21:53:04 +0000"  >&lt;p&gt;1. Done.&lt;/p&gt;

&lt;p&gt;2. Thanks, should have thought of that. :\&lt;/p&gt;

&lt;p&gt;3. Oh, that was because topicName.length == pow(2, i). The default max length is 255, and this loop would have created a name of length 256. Changed it to 1 to 6 since the former does not seem to be obvious in first glance.&lt;/p&gt;

&lt;p&gt;4. Slight changes in two unit tests because of ReplicaManager EasyMock.&lt;/p&gt;</comment>
                            <comment id="13453645" author="junrao" created="Wed, 12 Sep 2012 02:16:21 +0000"  >&lt;p&gt;Thanks for patch v3 for 0.8. Committed to 0.8.&lt;/p&gt;</comment>
                            <comment id="13463259" author="swapnilghike" created="Tue, 25 Sep 2012 21:53:54 +0000"  >&lt;p&gt;Reopening this issue because of additional constraints imposed due to jmx mbean Object naming spec and our own highwatermark handling. &lt;/p&gt;

&lt;p&gt;JMX Mbean naming spec is tedious to implement. The full rules are at &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/javax/management/ObjectName.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/7/docs/api/javax/management/ObjectName.html&lt;/a&gt;. The easy way to make sure that we don&apos;t break any rule is to ban the characters colon (&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, asterisk &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, question mark &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, comma (,), equals (=), quote (&quot;), backslash (&amp;#41;, newline (&apos;\n&apos;). There does not seem to be any restrictions on single quote (&apos;), period (.) and the rest.&lt;/p&gt;

&lt;p&gt;For Highwatermark handling, we need to ban whitespaces [ \t\r\n\f].&lt;/p&gt;</comment>
                            <comment id="13463303" author="swapnilghike" created="Tue, 25 Sep 2012 22:43:44 +0000"  >&lt;p&gt;After a bit of discussion, decided to ALLOW only ASCII alphanumeric characters and underscore and dash. &lt;/p&gt;</comment>
                            <comment id="13463390" author="swapnilghike" created="Wed, 26 Sep 2012 00:12:47 +0000"  >&lt;p&gt;Uploading kafka-v0.8-v4.patch. &lt;/p&gt;

&lt;p&gt;This patch allows only ASCII alphanumeric chars, underscore and dash in the topic names. Also since we are arguing that the hard constraints set by us are not going to be challenged in likely usages, I have also hardcoded topic name length to have a max value of 255 since it&apos;s very difficult to exceed this length as well. &lt;/p&gt;</comment>
                            <comment id="13464349" author="junrao" created="Thu, 27 Sep 2012 01:34:56 +0000"  >&lt;p&gt;Thanks for the 0.8 v4 patch. +1 Committed to 0.8.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12544581" name="kafka-495-v0.8-v2.patch" size="33782" author="swapnilghike" created="Tue, 11 Sep 2012 02:52:42 +0000"/>
                            <attachment id="12544721" name="kafka-495-v0.8-v3.patch" size="12996" author="swapnilghike" created="Tue, 11 Sep 2012 21:53:04 +0000"/>
                            <attachment id="12544338" name="kafka-495-v0.8.patch" size="6752" author="swapnilghike" created="Sat, 8 Sep 2012 01:12:02 +0000"/>
                            <attachment id="12543764" name="kafka-495-v1.patch" size="3653" author="swapnilghike" created="Tue, 4 Sep 2012 22:55:14 +0000"/>
                            <attachment id="12543939" name="kafka-495-v2.patch" size="6160" author="swapnilghike" created="Wed, 5 Sep 2012 23:55:28 +0000"/>
                            <attachment id="12543949" name="kafka-495-v3.patch" size="5749" author="swapnilghike" created="Thu, 6 Sep 2012 00:35:08 +0000"/>
                            <attachment id="12544081" name="kafka-495-v4.patch" size="5766" author="swapnilghike" created="Thu, 6 Sep 2012 17:53:29 +0000"/>
                            <attachment id="12546619" name="kafka-v0.8-v4.patch" size="9183" author="swapnilghike" created="Wed, 26 Sep 2012 00:12:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>299147</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i15zvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243114</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>