<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:35:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-509] server should shut down on encountering invalid highwatermark file</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-509</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;1. Somehow I managed to produce the following .highwatermark file (most probably while playing with kafka-create-topic.sh) - &lt;br/&gt;
0&lt;br/&gt;
7&lt;br/&gt;
abra.kabra 0 0&lt;br/&gt;
0 0 0&lt;br/&gt;
abrakabra 0 0&lt;br/&gt;
\0 0 0&lt;br/&gt;
king. 0 0&lt;br/&gt;
abra..kabra 0 0&lt;br/&gt;
... 0 0&lt;/p&gt;

&lt;p&gt;Perhaps the first two lines are not valid. But I am not able to reproduce this issue today. &lt;/p&gt;

&lt;p&gt;2. Since the topic names can contain a whitespace, perhaps the delimiter should change from a space char to / which is not allowed anymore in topic names.&lt;/p&gt;

&lt;p&gt;3. With this .highwatermark file, the kafka server produces following - &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-09-12 14:54:49,456&amp;#93;&lt;/span&gt; INFO Replica Manager on Broker 0: Becoming Leader for topic &lt;span class=&quot;error&quot;&gt;&amp;#91;abra.kabra&amp;#93;&lt;/span&gt; partition &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; (kafka.server.ReplicaManager)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-09-12 14:54:49,456&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;ReplicaFetcherManager on broker 0, &amp;#93;&lt;/span&gt;, removing fetcher on topic abra.kabra, partition 0 (kafka.server.ReplicaFetcherManager)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-09-12 14:54:49,457&amp;#93;&lt;/span&gt; ERROR Replica Manager on Broker 0: Error processing leaderAndISR request LeaderAndIsrRequest(1,,true,1000,Map((...,0) -&amp;gt; &lt;/p&gt;
{ &quot;ISR&quot;: &quot;0&quot;,&quot;leader&quot;: &quot;0&quot;,&quot;leaderEpoch&quot;: &quot;0&quot; }
&lt;p&gt;, (\0,0) -&amp;gt; &lt;/p&gt;
{ &quot;ISR&quot;: &quot;0&quot;,&quot;leader&quot;: &quot;0&quot;,&quot;leaderEpoch&quot;: &quot;0&quot; }
&lt;p&gt;, (abrakabra,0) -&amp;gt; &lt;/p&gt;
{ &quot;ISR&quot;: &quot;0&quot;,&quot;leader&quot;: &quot;0&quot;,&quot;leaderEpoch&quot;: &quot;0&quot; }
&lt;p&gt;, (0,0) -&amp;gt; &lt;/p&gt;
{ &quot;ISR&quot;: &quot;0&quot;,&quot;leader&quot;: &quot;0&quot;,&quot;leaderEpoch&quot;: &quot;0&quot; }
&lt;p&gt;, (abra..kabra,0) -&amp;gt; &lt;/p&gt;
{ &quot;ISR&quot;: &quot;0&quot;,&quot;leader&quot;: &quot;0&quot;,&quot;leaderEpoch&quot;: &quot;0&quot; }
&lt;p&gt;, (king.,0) -&amp;gt; &lt;/p&gt;
{ &quot;ISR&quot;: &quot;0&quot;,&quot;leader&quot;: &quot;0&quot;,&quot;leaderEpoch&quot;: &quot;0&quot; }
&lt;p&gt;, (abra.kabra,0) -&amp;gt; &lt;/p&gt;
{ &quot;ISR&quot;: &quot;0&quot;,&quot;leader&quot;: &quot;0&quot;,&quot;leaderEpoch&quot;: &quot;0&quot; }
&lt;p&gt;)) (kafka.server.ReplicaManager)&lt;br/&gt;
java.lang.StringIndexOutOfBoundsException: String index out of range: -1&lt;br/&gt;
	at java.lang.String.substring(String.java:1937)&lt;br/&gt;
	at kafka.server.HighwaterMarkCheckpoint$$anonfun$1.apply(HighwaterMarkCheckpoint.scala:103)&lt;br/&gt;
	at kafka.server.HighwaterMarkCheckpoint$$anonfun$1.apply(HighwaterMarkCheckpoint.scala:96)&lt;br/&gt;
	at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:206)&lt;br/&gt;
	at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:206)&lt;br/&gt;
	at scala.collection.immutable.Range$ByOne$class.foreach(Range.scala:282)&lt;br/&gt;
	at scala.collection.immutable.Range$$anon$2.foreach(Range.scala:265)&lt;br/&gt;
	at scala.collection.TraversableLike$class.map(TraversableLike.scala:206)&lt;br/&gt;
	at scala.collection.immutable.Range.map(Range.scala:39)&lt;br/&gt;
	at kafka.server.HighwaterMarkCheckpoint.read(HighwaterMarkCheckpoint.scala:96)&lt;br/&gt;
        ... (more junk) ..&lt;/p&gt;

&lt;p&gt;And then it goes in a while(1) loop to print the following - &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-09-12 14:54:50,458&amp;#93;&lt;/span&gt; ERROR Replica Manager on Broker 0: Highwatermark for topic abra.kabra partition 0 doesn&apos;t exist during checkpointing (kafka.server.ReplicaManager)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-09-12 14:54:50,459&amp;#93;&lt;/span&gt; ERROR Replica Manager on Broker 0: Highwatermark for topic ... partition 0 doesn&apos;t exist during checkpointing (kafka.server.ReplicaManager)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-09-12 14:54:50,459&amp;#93;&lt;/span&gt; ERROR Replica Manager on Broker 0: Highwatermark for topic \0 partition 0 doesn&apos;t exist during checkpointing (kafka.server.ReplicaManager)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-09-12 14:54:50,459&amp;#93;&lt;/span&gt; ERROR Replica Manager on Broker 0: Highwatermark for topic 0 partition 0 doesn&apos;t exist during checkpointing (kafka.server.ReplicaManager)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-09-12 14:54:50,459&amp;#93;&lt;/span&gt; ERROR Replica Manager on Broker 0: Highwatermark for topic king. partition 0 doesn&apos;t exist during checkpointing (kafka.server.ReplicaManager)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-09-12 14:54:50,460&amp;#93;&lt;/span&gt; ERROR Replica Manager on Broker 0: Highwatermark for topic abra..kabra partition 0 doesn&apos;t exist during checkpointing (kafka.server.ReplicaManager)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-09-12 14:54:50,460&amp;#93;&lt;/span&gt; ERROR Replica Manager on Broker 0: Highwatermark for topic abrakabra partition 0 doesn&apos;t exist during checkpointing (kafka.server.ReplicaManager)&lt;/p&gt;

&lt;p&gt;The server should shut down on encountering the error.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607366">KAFKA-509</key>
            <summary>server should shut down on encountering invalid highwatermark file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yeyangever">Yang Ye</assignee>
                                    <reporter username="swapnilghike">Swapnil Ghike</reporter>
                        <labels>
                            <label>bugs</label>
                    </labels>
                <created>Wed, 12 Sep 2012 23:58:15 +0000</created>
                <updated>Tue, 2 Oct 2012 15:48:40 +0000</updated>
                            <resolved>Tue, 2 Oct 2012 15:48:35 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13461905" author="junrao" created="Mon, 24 Sep 2012 16:50:18 +0000"  >&lt;p&gt;The first 2 lines are valid and they indicate version # of # of partitions. The \0 could just be a wrong topic. In any case, we should deal with potential special characters (e.g., space) in the topic name. One way to do this is to use &apos;/&apos; as the delimiter since it&apos;s disallowed in topic name. Also, if we hit any exception while reading high watermark, we should log the problematic content.&lt;/p&gt;

&lt;p&gt;Finally, I recommend that we take care of the following comments left from kafka-405.&lt;br/&gt;
40. HighwaterMarkCheckpoint: &lt;br/&gt;
40.1 If tempHwFile already exists, we can just overwrite it since we know hwFile is always safe. &lt;br/&gt;
40.2 There is no need to delete hwFile first and then rename tempHwFile to it. Rename should do the deletion. Currently, if we fail at the bad time, we could end up without a hwFile.&lt;/p&gt;</comment>
                            <comment id="13461964" author="swapnilghike" created="Mon, 24 Sep 2012 18:13:38 +0000"  >&lt;p&gt;The string &quot;\0&quot; is a valid topic name, I was just messing around with the topic names for testing.&lt;/p&gt;</comment>
                            <comment id="13465854" author="yeyangever" created="Fri, 28 Sep 2012 19:49:28 +0000"  >&lt;p&gt;1 If tempHwFile already exists, we can just overwrite it since we know hwFile is always safe.&lt;/p&gt;

&lt;p&gt;solved&lt;/p&gt;

&lt;p&gt;2 There is no need to delete hwFile first and then rename tempHwFile to it. Rename should do the deletion. Currently, if we fail at the bad time, we could end up without a hwFile. &lt;/p&gt;

&lt;p&gt;solved&lt;/p&gt;


&lt;p&gt;3. delimiter not changed as topic names are now more constrained&lt;/p&gt;</comment>
                            <comment id="13466911" author="junrao" created="Mon, 1 Oct 2012 16:26:23 +0000"  >&lt;p&gt;Thanks for patch v1. One comment:&lt;/p&gt;

&lt;p&gt;1. If the tmp file exists, we should delete it first (to make sure the content is fully overwritten). Also, before we use FileWriter, we probably should call file.createNewFile().&lt;/p&gt;</comment>
                            <comment id="13467203" author="junrao" created="Mon, 1 Oct 2012 21:16:13 +0000"  >&lt;p&gt;Also, related to HW, currently LogMananger doesn&apos;t recognize the high watermark file and log &quot;Skipping unexplainable file&quot; during startup. It would be good if we can address this problem in this jira too.&lt;/p&gt;</comment>
                            <comment id="13467366" author="yeyangever" created="Tue, 2 Oct 2012 00:41:34 +0000"  >&lt;p&gt;For the 1st comment about FileWriter, I&apos;ve checked it, it will create new file if it does not existed. Also if it exists, it will truncate the whole file and start from beginning. I&apos;ve created a test project to do that&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.homeandlearn.co.uk/java/write_to_textfile.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.homeandlearn.co.uk/java/write_to_textfile.html&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;2. That warning is now avoided in LogManager&lt;/p&gt;</comment>
                            <comment id="13467804" author="junrao" created="Tue, 2 Oct 2012 15:48:35 +0000"  >&lt;p&gt;Thanks for patch v2. Removed unused import in LogManager and added a comment. Committed to 0.8.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12547034" name="kafka_509_v1.diff" size="1296" author="yeyangever" created="Fri, 28 Sep 2012 19:49:28 +0000"/>
                            <attachment id="12547318" name="kafka_509_v2.diff" size="2333" author="yeyangever" created="Tue, 2 Oct 2012 00:41:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>291939</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rhq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>158516</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>