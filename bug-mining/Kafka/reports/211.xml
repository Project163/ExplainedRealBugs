<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:37:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-769] On startup, a brokers highwatermark for every topic partition gets reset to zero</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-769</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;There is a race condition between the highwatermark thread and the handleLeaderAndIsrRequest call of the request handler thread. When a broker starts, the highwatermark thread tries to persist all the checkpoints of the partitions in ReplicaManager. This partition map in ReplicaManager is initially empty. When the leaderAndIsrRequest runs, it updates each partition and if the highwatermark thread runs during this interval, it is essentially going to overwrite the highwatermark file to an inconsistent state. The read of the highwatermark reads from the file each time and hence would return the inconsistent state.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12633528">KAFKA-769</key>
            <summary>On startup, a brokers highwatermark for every topic partition gets reset to zero</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sriramsub">Sriram</assignee>
                                    <reporter username="sriramsub">Sriram</reporter>
                        <labels>
                            <label>p1</label>
                    </labels>
                <created>Fri, 22 Feb 2013 01:32:11 +0000</created>
                <updated>Fri, 22 Feb 2013 23:26:34 +0000</updated>
                            <resolved>Fri, 22 Feb 2013 23:26:31 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13583808" author="nehanarkhede" created="Fri, 22 Feb 2013 01:49:09 +0000"  >&lt;p&gt;I will take a look at this.&lt;/p&gt;</comment>
                            <comment id="13583811" author="sriramsub" created="Fri, 22 Feb 2013 01:54:24 +0000"  >&lt;p&gt;I have a fix for this. Do you still want to take a look?&lt;/p&gt;</comment>
                            <comment id="13583813" author="nehanarkhede" created="Fri, 22 Feb 2013 01:56:16 +0000"  >&lt;p&gt;Sure, go ahead and attach a patch, if you already have it ready &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13583883" author="sriramsub" created="Fri, 22 Feb 2013 03:50:13 +0000"  >&lt;p&gt;Assigning this back based on the email thread&lt;/p&gt;</comment>
                            <comment id="13584521" author="nehanarkhede" created="Fri, 22 Feb 2013 18:35:36 +0000"  >&lt;p&gt;An easy way of resolving this would be to start the highwatermark thread only after the first leader and isr request is completed on a newly restarted broker. This is easy to keep track of since the initial leader and isr request has a special init flag turned on. This will ensure that there is no inconsistent state checkpointed to disk since we will wait until the replica manager has finished initializing the highwatermark for all its replicas from disk. Also, this logic will become trickier when we add the features to change the number of replicas online or change the number of partitions online, but we don&apos;t have to worry about that right now.&lt;/p&gt;</comment>
                            <comment id="13584618" author="sriramsub" created="Fri, 22 Feb 2013 20:07:08 +0000"  >&lt;p&gt;The patch ensures that highwatermark thread is initialized only after the first leaderIsrRequest batch.&lt;/p&gt;</comment>
                            <comment id="13584619" author="sriramsub" created="Fri, 22 Feb 2013 20:07:22 +0000"  >&lt;p&gt;.../main/scala/kafka/server/ReplicaManager.scala   |    9 +++++++--&lt;br/&gt;
 1 files changed, 7 insertions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/add.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, 2 deletions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/forbidden.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13584813" author="nehanarkhede" created="Fri, 22 Feb 2013 23:24:02 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13584816" author="nehanarkhede" created="Fri, 22 Feb 2013 23:26:31 +0000"  >&lt;p&gt;Checked in patch&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12570525" name="KAFKA-769-v1.patch" size="2170" author="sriramsub" created="Fri, 22 Feb 2013 20:07:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314023</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1i6uf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314368</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>