<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:19:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-8586] Source task producers silently fail to send records</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-8586</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The Connect framework marks source records as successfully sent when they are dispatched to the producer, instead of when they are actually sent to Kafka. &lt;a href=&quot;https://github.com/apache/kafka/blob/3e9d1c1411c5268de382f9dfcc95bdf66d0063a0/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java#L324-L331&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;This is assumed to be good enough&lt;/a&gt;&#160;since the Connect framework sets up its producer to use infinite retries on retriable errors, but in the case of an authorization or authentication failure with a secured Kafka broker, the errors aren&apos;t retriable and cause the producer to invoke its send callback with an exception and then give up on sending the message. This is a problem since the callback currently used by the WorkerSourceTask class when it invokes Producer.send(...) logs the exception and does nothing else. This leads to data loss since the source offsets for those failed records are committed, and the status of the task is never affected so users may not even know that something is wrong unless they check the worker log files or notice that data isn&apos;t flowing into Kafka. Until and unless someone does notice that something&apos;s wrong, the task will continue processing records and committing offsets, even though nothing is making it into Kafka.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13240991">KAFKA-8586</key>
            <summary>Source task producers silently fail to send records</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ChrisEgerton">Chris Egerton</assignee>
                                    <reporter username="ChrisEgerton">Chris Egerton</reporter>
                        <labels>
                    </labels>
                <created>Sat, 22 Jun 2019 00:18:43 +0000</created>
                <updated>Fri, 29 Jan 2021 15:34:58 +0000</updated>
                            <resolved>Sun, 25 Aug 2019 22:09:58 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>1.0.3</fixVersion>
                    <fixVersion>1.1.2</fixVersion>
                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.2</fixVersion>
                    <fixVersion>2.3.1</fixVersion>
                    <fixVersion>2.4.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16870869" author="ewencp" created="Mon, 24 Jun 2019 07:10:01 +0000"  >&lt;p&gt;`recordSent` call could probably be moved into the `else` block that validates there wasn&apos;t an exception. This goes way back to Connect v1 &#8211; the first AuthenticationException that arguably violates the semantics of Retriable vs non-Retriable exceptions appeared after that code was written, but same release iirc.&lt;/p&gt;

&lt;p&gt;However, let&apos;s not overestimate the impact here, but also account for changes in 2.3.0. Until 2.3.0, Connect was basically using a single producer config for all connectors (via `producer.` overrides). For this issue in particular, it &lt;b&gt;could&lt;/b&gt; be using different principals for offset commits and task producers (since iirc only the task producers take the overrides), or the topics could have different ACLs. It&apos;s likely the most common case is not differentiating, and thus lack of any reports of this. (I&apos;d have to review what e2e coverage we have &#8211; we have tests to generally discover loss like this, but in the context specifically of different principals or ACLs, I wouldn&apos;t be terribly surprised if we didn&apos;t have coverage today).&lt;/p&gt;

&lt;p&gt;Now, thinking about impact moving forward, 2.3.0 will have&#160;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-458%3A+Connector+Client+Config+Override+Policy&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/KAFKA/KIP-458%3A+Connector+Client+Config+Override+Policy&lt;/a&gt;. This is more interesting because combined with&#160;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-297%3A+Externalizing+Secrets+for+Connect+Configurations&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/KAFKA/KIP-297%3A+Externalizing+Secrets+for+Connect+Configurations&lt;/a&gt;, Connect is in a much more reasonable position for users to truly go multi-tenant, have their own secrets, use a bunch of different principals, and make much more extensive use of ACLs. I&apos;m not sure it makes it &lt;b&gt;that&lt;/b&gt; much more likely to hit this issue (folks that weren&apos;t satisfied with state of security for multi-tenant use would have used multiple clusters but still potentially used different principals between internal and source task output topics), but it might make the pattern more common.&lt;/p&gt;

&lt;p&gt;We should also talk about fallout and workarounds. There are 2 major failure modes that I can see. The first is probably the most common: when you are trying to configure a connector for the first time, trying to iterate to a good config, and hit auth failures. In this case, the follow up would be to clear out all offset data since nothing useful would have been produced anyway. The second case is if somebody mucks with ACLs after a connector is successfully configured. In this case, you&apos;d need an offset &lt;b&gt;reset&lt;/b&gt;, rather than deletion. I suspect case 1 is far more common and a bigger issue than case 2, and while source offset tooling isn&apos;t good/existent, at least it is de facto and in the future default standardized&#160;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-174+-+Deprecate+and+remove+internal+converter+configs+in+WorkerConfig&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/KAFKA/KIP-174+-+Deprecate+and+remove+internal+converter+configs+in+WorkerConfig&lt;/a&gt;&#160;in a way that makes it possible to work through this problem (at least for case 1).&lt;/p&gt;

&lt;p&gt;In terms of solutions, we can move `recordSent` such that the offset commit, but we&apos;d also still need to do something like aggressively propagate the exception to turn it into a task failure if we want to respect those failure modes. Users would then just have to iterate on restarting all the tasks.&lt;/p&gt;

&lt;p&gt;Interestingly, we do config validation, but I don&apos;t think it validates any ability to connect or do anything against the brokers. It would be interesting to pre-flight check some of this, but don&apos;t think its a full solution because, e.g., a source connector might just start producing to a new topic it doesn&apos;t have permissions to. Additionally, permissions might change on the fly, so even a pre-flight against known topics might not fully cover us.&lt;/p&gt;</comment>
                            <comment id="16871481" author="githubbot" created="Mon, 24 Jun 2019 16:16:59 +0000"  >&lt;p&gt;C0urante commented on pull request #6993: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8586&quot; title=&quot;Source task producers silently fail to send records&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8586&quot;&gt;&lt;del&gt;KAFKA-8586&lt;/del&gt;&lt;/a&gt;: Fail source tasks when producers fail to send records&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6993&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6993&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;span class=&quot;error&quot;&gt;&amp;#91;Jira&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8586&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-8586&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;   Previously, if the producer for a source task failed to send a record with a non-retriable error, the record would be silently skipped over. The source task would be allowed to commit offsets for the skipped record, and its status would remain at `RUNNING`.&lt;/p&gt;

&lt;p&gt;   The changes here cause source tasks to transition to the `FAILED` state if their producers fail to send a record with a non-retriable error, and they also change the logic for offset commits to wait for confirmation that records have made it to Kafka before their offsets can be committed.&lt;/p&gt;

&lt;p&gt;   Tested by running Connect unit tests locally.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16915348" author="githubbot" created="Sun, 25 Aug 2019 20:54:05 +0000"  >&lt;p&gt;rhauch commented on pull request #6993: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8586&quot; title=&quot;Source task producers silently fail to send records&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8586&quot;&gt;&lt;del&gt;KAFKA-8586&lt;/del&gt;&lt;/a&gt;: Fail source tasks when producers fail to send records&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6993&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6993&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13157696">KAFKA-6876</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z03zyw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rhauch</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>