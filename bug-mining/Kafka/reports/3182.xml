<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:29:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-13689] AbstractConfig log print information is incorrect</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-13689</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;h1&gt;&lt;a name=&quot;1.Example&quot;&gt;&lt;/a&gt;1.Example&lt;/h1&gt;

&lt;p&gt;KafkaClient version is 3.1.0, KafkaProducer init properties:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Properties props = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties();
props.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
props.put(ProducerConfig.TRANSACTION_TIMEOUT_CONFIG, 60003);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Partial log of KafkaProducer initialization:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; ssl.truststore.location = C:\Personal File\documents\KafkaSSL\client.truststore.jks
&#160; &#160; ssl.truststore.password = [hidden]
&#160; &#160; ssl.truststore.type = JKS
&#160; &#160; transaction.timeout.ms = 60003
&#160; &#160; transactional.id = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&#160; &#160; value.serializer = &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.kafka.common.serialization.StringSerializer[main] INFO org.apache.kafka.common.security.authenticator.AbstractLogin - Successfully logged in.
[main] WARN org.apache.kafka.clients.producer.ProducerConfig - The configuration &lt;span class=&quot;code-quote&quot;&gt;&apos;transaction.timeout.ms&apos;&lt;/span&gt; was supplied but isn&apos;t a known config.
[main] INFO org.apache.kafka.common.utils.AppInfoParser - Kafka version: 3.1.0
[main] INFO org.apache.kafka.common.utils.AppInfoParser - Kafka commitId: 37edeed0777bacb3
[main] INFO org.apache.kafka.common.utils.AppInfoParser - Kafka startTimeMs: 1645602332999 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;From the above log, you can see that KafkaProducer has applied the user&apos;s configuration, &lt;b&gt;transaction.timeout.ms=60003&lt;/b&gt;, the default value of this configuration is 60000.&lt;/p&gt;

&lt;p&gt;But we can see another line of log:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; WARN org.apache.kafka.clients.producer.ProducerConfig - The configuration &lt;b&gt;&apos;transaction.timeout.ms&apos;&lt;/b&gt; was supplied but isn&apos;t a &lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;known&lt;/font&gt;&lt;/b&gt; config.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;2.RootCause%EF%BC%9A&quot;&gt;&lt;/a&gt;2.RootCause&#65306;&lt;/h1&gt;

&lt;p&gt;1) ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG is set to &lt;b&gt;false&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;So the configurations related to the KafkaProducer transaction will not be requested.&lt;br/&gt;
See the source code: KafkaProducer#configureTransactionState(...) .&lt;/p&gt;

&lt;p&gt;2) AbstractConfig#logUnused() -&amp;gt; AbstractConfig#unused()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; unused() {
    Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; keys = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&amp;gt;(originals.keySet());
    keys.removeAll(used);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; keys;
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If a configuration has not been requested, the configuration will not be put into the used variable. SourceCode see as below:&lt;br/&gt;
AbstractConfig#get(String key)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; get(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!values.containsKey(key))
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConfigException(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unknown configuration &lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;&quot;&lt;/span&gt;, key));
    used.add(key);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; values.get(key);
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;h1&gt;&lt;a name=&quot;%C2%A0&quot;&gt;&lt;/a&gt;&#160;&lt;/h1&gt;
&lt;h1&gt;&lt;a name=&quot;Solution%EF%BC%9A&quot;&gt;&lt;/a&gt;Solution&#65306;&lt;/h1&gt;

&lt;p&gt;1. AbstractConfig#logUnused() method&lt;br/&gt;
Modify the log printing information of this method&#65292;and the unused configuration log print level can be changed to &lt;b&gt;INFO&lt;/b&gt;, what do you think?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
 * Log infos &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; any unused configurations
 */
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void logUnused() { &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key : unused())
        log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;The configuration &lt;span class=&quot;code-quote&quot;&gt;&apos;{}&apos;&lt;/span&gt; was supplied but isn&apos;t a used config.&quot;&lt;/span&gt;, key);
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;2. AbstractConfig provides two new methods: logUnknown() and unknown()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
 * Log warnings &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; any unknown configurations
 */
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void logUnknown() {
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key : unknown())
        log.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;The configuration &lt;span class=&quot;code-quote&quot;&gt;&apos;{}&apos;&lt;/span&gt; was supplied but isn&apos;t a known config.&quot;&lt;/span&gt;, key);
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; unknown() {
    Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; keys = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&amp;gt;(originals.keySet());
    keys.removeAll(values.keySet());
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; keys;
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13430149">KAFKA-13689</key>
            <summary>AbstractConfig log print information is incorrect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="RivenSun">RivenSun</assignee>
                                    <reporter username="RivenSun">RivenSun</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Feb 2022 08:23:47 +0000</created>
                <updated>Thu, 24 Mar 2022 16:32:23 +0000</updated>
                            <resolved>Sat, 5 Mar 2022 08:08:51 +0000</resolved>
                                    <version>3.0.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>config</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17496563" author="rivensun" created="Wed, 23 Feb 2022 08:26:18 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=showuon&quot; class=&quot;user-hover&quot; rel=&quot;showuon&quot;&gt;showuon&lt;/a&gt;&#160; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&#160;&lt;br/&gt;
Could you give any suggestions?&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="17496587" author="showuon" created="Wed, 23 Feb 2022 08:56:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=RivenSun&quot; class=&quot;user-hover&quot; rel=&quot;RivenSun&quot;&gt;RivenSun&lt;/a&gt; , thanks for the report. Maybe we just modify the log message to something like this:&lt;/p&gt;

&lt;p&gt;`log.warn(&quot;The configuration &apos;{}&apos; was supplied but is not used. It could because it is not a known config, or some components is not enabled.&quot;, key);`&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="17496594" author="rivensun" created="Wed, 23 Feb 2022 09:07:46 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=showuon&quot; class=&quot;user-hover&quot; rel=&quot;showuon&quot;&gt;showuon&lt;/a&gt; Thanks for your reply.&lt;/p&gt;

&lt;p&gt;I recommend printing the logs separately, because `unused` and `unknown` are two concepts, and their severity is different. Printing them separately can make the information provided by the log clearer and more specific.&lt;/p&gt;

&lt;p&gt;Put them together and print, users sometimes need to go to the official documentation to confirm whether this configuration is really an unknown or deprecated configuration.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="17496735" author="showuon" created="Wed, 23 Feb 2022 12:52:04 +0000"  >&lt;p&gt;OK, sounds good to me. See if there are other opinions. Thanks.&lt;/p&gt;</comment>
                            <comment id="17496981" author="guozhang" created="Wed, 23 Feb 2022 18:33:16 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=RivenSun&quot; class=&quot;user-hover&quot; rel=&quot;RivenSun&quot;&gt;RivenSun&lt;/a&gt; for reporting this. I think logging separately for unused (since the corresponding feature is not enabled) and unknown with the former only in INFO is fine.&lt;/p&gt;</comment>
                            <comment id="17497090" author="rivensun" created="Thu, 24 Feb 2022 00:41:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=showuon&quot; class=&quot;user-hover&quot; rel=&quot;showuon&quot;&gt;showuon&lt;/a&gt; &#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&#160;&lt;br/&gt;
Thanks for your advices.&lt;br/&gt;
I will create a PR to fix this issue.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="17508083" author="rivensun" created="Thu, 17 Mar 2022 09:31:59 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=showuon&quot; class=&quot;user-hover&quot; rel=&quot;showuon&quot;&gt;showuon&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&#160;&lt;br/&gt;
After rethinking the discussion in PR-11800, luke, I think it might be simpler as you said at the beginning to make the log output a bit more informative, and we don&apos;t need a KIP for that.&lt;/p&gt;

&lt;p&gt;AbstractConfig#logUnused()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void logUnused() {
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key : unused())
        log.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;The configuration &lt;span class=&quot;code-quote&quot;&gt;&apos;{}&apos;&lt;/span&gt; was supplied but is not used. It could because it is not a known config,&quot;&lt;/span&gt; +
                &lt;span class=&quot;code-quote&quot;&gt;&quot; or some components are not enabled.&quot;&lt;/span&gt;, key);
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;WDYT?&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="17509357" author="guozhang" created="Sun, 20 Mar 2022 00:16:23 +0000"  >&lt;p&gt;Hi, I think we can first revisit the meaningfulness of the &quot;logUnused&quot; function itself: in &quot;AbstractConfig&quot; we only record &quot;used&quot; configs from those parsed definitions, and the `unused` set is the diff of the &quot;originals&quot; (note, not the &quot;values&quot;) and the &quot;used&quot;. This means:&lt;/p&gt;

&lt;p&gt;1) Any pluggable component&apos;s configs, since they are not defined in the corresponding Producer/Consumer/etcConfig, they would always be in the &quot;unused&quot; set. The pluggable components thsmeslves would not try to use the &quot;get&quot; call to retrieve them anyways, but would usually us `originals().get()`. I.e. they are really just &quot;unknown&quot;.&lt;br/&gt;
2) Any configs that are not called via &quot;get&quot; or &quot;ignore&quot; would be in this &quot;unused&quot; set. I.e. they are &quot;unused&quot;.&lt;/p&gt;

&lt;p&gt;The intention of &quot;logUnused&quot; function itself, is to warn people just about the second case (as this JIRA is trying to resolve), since assuming that the code is bug-free, this should NOT happen &amp;#8212; thinking about this, when certain component is not enabled, we should call `config.ignore(...)` on the corresponding configs, like `TRANSACTION_TIMEOUT_CONFIG` in this case. With that, we should not have &quot;unused&quot; configs at all. On the other hand, have a log line for each &quot;unknown&quot; config may be a bit too verbose, e.g. in Streams we have a bunch of pluggable component resulting in quite a lot of log lines for each of their custom config. I think this is not the original intention of the &quot;logUnused&quot; function to actually warn about the &quot;unknown&quot; configs at all, and it&apos;s less valuable to do so as well.&lt;/p&gt;

&lt;p&gt;There&apos;s an additional scenario though, for deprecated configs: when we deprecate a config, the source code may not request them anymore but if the user does not change their code, they may still set values for those deprecated configs which would then end up in the `unused` set. So we should also call `config.ignore()` on those deprecated configs if they are no longer used inside the source code (note that to achieve backward compatibility, some deprecated configs may still be retrieved inside the code, in that case we would not need to call `ignore()`).&lt;/p&gt;

&lt;p&gt;So if you agree with me that &quot;logUnused&quot; should really be a WARN for the second case above since this should never happen, I&apos;d suggest we:&lt;/p&gt;

&lt;p&gt;1) use &quot;config.ignore&quot; in cases when certain component are disabled and hence their corresponding configs would not be requested, or when the config is deprecated and no longer requested.&lt;br/&gt;
2) change the log line to &quot;was supplied but isn&apos;t used&quot; (don&apos;t we feel it&apos;s weird to log &quot;it&apos;s not known&quot; in a function called &quot;logUnused&quot;? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;).&lt;/p&gt;</comment>
                            <comment id="17509365" author="rivensun" created="Sun, 20 Mar 2022 03:39:39 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&#160;&lt;br/&gt;
Thank you very much for your reply, that&apos;s great, I totally agree with you, `logUnused` should really do what you said.&lt;/p&gt;


&lt;p&gt;For your case 1) : Any pluggable component&apos;s configs, since they are not defined in the corresponding Producer/Consumer/etcConfig, they would always be in the &quot;unused&quot; set.&lt;/p&gt;

&lt;p&gt;I think Kafka generally uses the AbstractConfig.values() or AbstractConfig.valuesXXX() methods to return a RecordingMap object to the user-defined plugin module. Users can use RecordingMap.get() to retrieve these unKnown configs one by one.&lt;br/&gt;
So for these unKnown configs, they will never appear in the logUnused() output because they are not in the `originals` set. But unKnown configs may be stored in `used` set, right?&lt;/p&gt;</comment>
                            <comment id="17509372" author="guozhang" created="Sun, 20 Mar 2022 04:17:13 +0000"  >&lt;p&gt;&amp;gt; So for these unKnown configs, they will never appear in the logUnused() output because they are not in the `originals` set. But unKnown configs may be stored in `used` set, right?&lt;/p&gt;

&lt;p&gt;The `values` map is constructed as `this.values = definition.parse(this.originals);` so it should just be a subset of `originals` that are defined by the config itself. Those custom, hence unknown configs would not be in the `values` but would be in `originals`, and pluggable components would use `originals().get()` to retrieve those custom config values.&lt;/p&gt;

&lt;p&gt;Since `unused` is calculated as the diff between `originals` and `used` (and `used` would only be a subset of `values` if we exclude those ignored ones), so they could appear in the logUnused.&lt;/p&gt;</comment>
                            <comment id="17509378" author="rivensun" created="Sun, 20 Mar 2022 06:07:13 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&#160;&lt;br/&gt;
1. You are correct, `originals` is the set of configKeys passed in by the user, and will not contain configKeys other than those passed in by the user. As you said, those custom unknown configurations will all be in `originals`.&lt;br/&gt;
2. `this.values = definition.parse(this.originals);`&lt;br/&gt;
`values` is not a subset of `originals`, `values` will not contain any unknownConfigKeys, it is a collection of all `knownConfig` configurations.&lt;br/&gt;
This line of code is just to override the default value of these configuration items with the value of knownConfig passed in by the user.&lt;br/&gt;
3. How user-defined plug-in modules obtain their own custom configurations, refer to the source code `ChannelBuilders#channelBuilderConfigs`&lt;br/&gt;
This does indeed return the union of both sets config.values() and config.originals() to the user, who can call RecordingMap.get() to retrieve their own custom configuration.&lt;br/&gt;
4. `used` will also contain unknownConfigKeys after users retrieve their own custom&#160; configuration, so `used` will not necessarily be a subset of `values`.&lt;/p&gt;

&lt;p&gt;But as you said, since `unused` is calculated as the diff between `originals` and `used`, `logUnused` will still possibly output unknownConfigKeys.&lt;/p&gt;</comment>
                            <comment id="17509382" author="rivensun" created="Sun, 20 Mar 2022 06:26:11 +0000"  >&lt;p&gt;So after we ignore these configurations: knownConfig but the plugin is not enabled and deprecatedConfig, logUnused may still output all unknownConfig passed in by users but not retrieved by themselves.&lt;/p&gt;

&lt;p&gt;So what we need to improve at the moment are:&lt;br/&gt;
1. Find all knownConfig but plugins not enabled and deprecatedConfig, `config.ignore` them.&lt;br/&gt;
2. Modify the logUnused method to the following form&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
 * Log warnings &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; any unused configurations
 */
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void logUnused() {
    Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; unusedkeys = unused();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!unusedkeys.isEmpty()) {
        log.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;These configurations &lt;span class=&quot;code-quote&quot;&gt;&apos;{}&apos;&lt;/span&gt; were supplied but are not used.&quot;&lt;/span&gt;, unusedkeys);
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; WDYT?&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="17510209" author="guozhang" created="Tue, 22 Mar 2022 04:10:25 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=RivenSun&quot; class=&quot;user-hover&quot; rel=&quot;RivenSun&quot;&gt;RivenSun&lt;/a&gt; I agree with you except some pondering about this statement:&lt;/p&gt;

&lt;p&gt;4. `used` will also contain unknownConfigKeys after users retrieve their own custom  configuration, so `used` will not necessarily be a subset of `values`.&lt;/p&gt;

&lt;p&gt;Since `used` will only be updated with either `get` or `ignore`, so assume we do not call `ignore` at the moment, `get` calls could only be used to retrieve those known configs, and unknown configs can only be retrieved from the original map itself. So `used` should not contain any unknown configs at all.&lt;/p&gt;

&lt;p&gt;With that said, I think we are still in agreement on the two improvement points you mentioned in the last message since the `unused()` returned should still just have those not-used configs, just that I think those unknown ones would not be included.&lt;/p&gt;</comment>
                            <comment id="17510244" author="rivensun" created="Tue, 22 Mar 2022 06:11:05 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&#160;&lt;br/&gt;
1. We all agree that users can get all their custom configurations in their own plugin modules by passing the `configs` variable through the `ChannelBuilders#channelBuilderConfigs` method.&lt;br/&gt;
In fact, the initialization methods of all KafKaClient (such as KafkaConsumer) that contain AbstractConfig parameters &lt;b&gt;are not public&lt;/b&gt;, so users cannot directly access the corresponding type of AbstractConfig, and thus will not directly call the methods in AbstractConfig.&lt;br/&gt;
2. The `configs` variable mentioned above is actually of type AbstractConfig.RecordingMap. If users call configs.get(key) to retrieve their own configuration, the RecordingMap.get() method will eventually call the &lt;b&gt;AbstractConfig.ignore(key)&lt;/b&gt; method, so `used` will contain user-defined unknown configuration.&lt;/p&gt;</comment>
                            <comment id="17510767" author="guozhang" created="Tue, 22 Mar 2022 17:13:32 +0000"  >&lt;p&gt;Okay I think we are really on the same page here, just are using different terminologies &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Where I&apos;m from is the Streams usage, e.g. let&apos;s say we create a StreamsConfig object from:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
StreamsConfig config = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamsConfig(map);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we call&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
config.get(PREDEFINED_CONFIG_NAME)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then the param must be a defined config name, otherwise it will throw;&lt;/p&gt;

&lt;p&gt;If we call&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
config.originals().get(ANY_CONFIG_NAME)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then it tries to get from the underlying maps directly, and any config names including the custom unknown configs can be retrieved. So that&apos;s how custom configs are retrieved (like you said, some modules use `(config.originals() UNION config.values()) .get(ANY_CONFIG_NAME).` as well).&lt;/p&gt;

&lt;p&gt;Now, I realize since `logUnused` is triggered at the construction of the consumer/producer clients, whereas those embedded module&apos;s custom configs are possibly not yet retrieved as they will only be constructed and initialized at a later time, in which case `used` set would not yet contain any of those unknown configs yet. As a result:&lt;/p&gt;

&lt;p&gt;1) all defined, used configs should be included in `used` since they are retrieved via the first call above. This is the case we want to guarantee and WARN if not since it may indicates a bug.&lt;br/&gt;
2) all defined, but disabled configs are included in `used` since they are called via `config.ignore()`. This is what we want to fix in this JIRA.&lt;br/&gt;
3) all unknown configs may or may not be included in `used` and that&apos;s out of the AbstractConfig object&apos;s control.&lt;/p&gt;

&lt;p&gt;So by doing the above two, we can fix this JIRA ticket which is case 2), but the `logUnused` could still contain case 1) or case 3) whereas we really only want to WARN on case 1) above. The latter issue is a bit out of the scope of this JIRA, hence I said just doing the above two is sufficient for this issue.&lt;/p&gt;

&lt;p&gt;----------------------------&lt;/p&gt;

&lt;p&gt;If we want to resolve the second as well in this JIRA, I&apos;m thinking we can do sth. aligned with your proposal in the description as &quot;AbstractConfig provides two new methods: logUnknown() and unknown()&quot; but to avoid creating a KIP for adding public APIs, we can just do them inside the existing `logUnused`, as something like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; unused() {
        Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; keys = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&amp;gt;(values.keySet());   &lt;span class=&quot;code-comment&quot;&gt;// here we take the diff between values and used.
&lt;/span&gt;        keys.removeAll(used);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; keys;
    }

    &lt;span class=&quot;code-comment&quot;&gt;// keep it &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; unknown() {
        Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; keys = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&amp;gt;(originals.keySet());   &lt;span class=&quot;code-comment&quot;&gt;// here we take the diff between originals and values.
&lt;/span&gt;        keys.removeAll(values);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; keys;
    }

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void logUnused() {
    Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; unusedkeys = unused(); 
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key : unused())
        log.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;The configuration &lt;span class=&quot;code-quote&quot;&gt;&apos;{}&apos;&lt;/span&gt; was supplied but isn&apos;t a used.&quot;&lt;/span&gt;, key); &lt;span class=&quot;code-comment&quot;&gt;// here we still log one line per config as a WARN
&lt;/span&gt;
    Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; unusedkeys = unknown(); 
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!unknown.isEmpty()) {
        log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;These configurations &lt;span class=&quot;code-quote&quot;&gt;&apos;{}&apos;&lt;/span&gt; were not known.&quot;&lt;/span&gt;, unusedkeys);  &lt;span class=&quot;code-comment&quot;&gt;// here we log one line &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; all configs as INFO.
&lt;/span&gt;    }
} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17511136" author="rivensun" created="Wed, 23 Mar 2022 09:04:13 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&#160; I thought about it carefully, maybe we are thinking too complicated, or we have been looking at the logUnused() method from the perspective of Kafka.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;The logUnused() method is user-oriented&lt;/b&gt;, in order to tell the user all the configurations he passed in, &lt;b&gt;whether these configurations are known or unknown&lt;/b&gt;, which configurations are used and which are unused.&lt;br/&gt;
In short, the logUnused method should compare the difference between `originals` and `used`.&lt;/p&gt;

&lt;p&gt;So my few points are:&lt;/p&gt;

&lt;p&gt;1. Keep the existing logic of the unused() method, just modify the log output information of logUnused(). As you mentioned, printing &quot;isn&apos;t a known config&quot; in the logUnused() method is both incorrect and weird.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
 * Log warnings &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; any unused configurations
 */
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void logUnused() {
    Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; unusedkeys = unused();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!unusedkeys.isEmpty()) {
        log.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;These configurations &lt;span class=&quot;code-quote&quot;&gt;&apos;{}&apos;&lt;/span&gt; were supplied but are not used.&quot;&lt;/span&gt;, unusedkeys);
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2. For unenable knownConfig, Kafka do not need to actively `ignore` it.&#160;&lt;br/&gt;
As in the example in this JIRA, in the logUnused() method, the `enable.idempotence` configuration is not printed, because it really has been retrieved by Kafka.&lt;br/&gt;
But the `transaction.timeout.ms` configuration is printed. Because the user has passed in this configuration, but Kafka has not retrieved this configuration when calling the logUnused() method, it should be printed out.&lt;/p&gt;

&lt;p&gt;3. For unKnownConfig , if the user has not retrieved these configurations in their own custom plugin module by the time the logUnused() method is called, then logUnused() will print these unretrieved custom configurations.&lt;br/&gt;
By the way, configurations that kafka has removed and deprecated configurations (with recommended configurations configured at the same time) can be viewed similar to unknownConfig. Maybe users will use these two types of configuration in their custom plugins.&lt;/p&gt;

&lt;p&gt;WDYT&#65311;&lt;br/&gt;
Thanks.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17511522" author="guozhang" created="Wed, 23 Mar 2022 23:20:03 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=RivenSun&quot; class=&quot;user-hover&quot; rel=&quot;RivenSun&quot;&gt;RivenSun&lt;/a&gt; I think I agree with you on the general note, my concern is that since we do not control when `logUnused` is called, at the time when not all provided values are retrieved, then we would log `config ... is not used.` which would then be a bit misleading since they are likely going to be used later indeed. But after a second thought, the semantics is fine we we just say `config  ... is not yet used.` at the time when `logUnused` is called, so it&apos;s really the responsibility of the caller regarding when they want to call this function to check which configs are not yet used.&lt;/p&gt;

&lt;p&gt;So I think we can just like you said log it as (just adding `yet` at the end of the sentence).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void logUnused() {
    Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; unusedkeys = unused();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!unusedkeys.isEmpty()) {
        log.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;These configurations &lt;span class=&quot;code-quote&quot;&gt;&apos;{}&apos;&lt;/span&gt; were supplied but are not used yet.&quot;&lt;/span&gt;, unusedkeys);
    }
} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since we always call `logUnused` at the end of the constructor of producer/consumer/admin, then it&apos;s very likely that those unknown configs are not retrieved yet and hence would be logged. For that, I&apos;d say we update our web docs indicating this effect exactly to clear any possible confusions.&lt;/p&gt;</comment>
                            <comment id="17511533" author="rivensun" created="Thu, 24 Mar 2022 00:58:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; Thank you for your reply.&lt;br/&gt;
I will create a PR(11940) to optimize the log output of logUnused().&lt;br/&gt;
Please help to review PR when available.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 33 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0zv00:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>