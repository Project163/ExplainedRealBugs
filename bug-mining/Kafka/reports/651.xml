<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:42:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2115] Error updating metrics in RequestChannel</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2115</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Reported by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkreps&quot; class=&quot;user-hover&quot; rel=&quot;jkreps&quot;&gt;jkreps&lt;/a&gt; on the mailing list:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    kafka.common.KafkaException: Wrong request type 12
    
    at kafka.api.RequestKeys$.nameForKey(RequestKeys.scala:55)
    
    at
    kafka.network.RequestChannel$Request.updateRequestMetrics(RequestChannel.scala:85)
    
    at kafka.network.Processor.write(SocketServer.scala:514)
    
    at kafka.network.Processor.run(SocketServer.scala:379)
    
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744)
    
    [2015-04-12 12:54:52,077] INFO [Kafka Coordinator 0]: Registered consumer
my-group-24 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; group my-group (kafka.coordinator.ConsumerCoordinator)
    
    [2015-04-12 12:54:52,080] INFO [Kafka Coordinator 0]: Handled join-group
    from consumer  to group my-group (kafka.coordinator.ConsumerCoordinator)

    [2015-04-12 12:54:52,081] ERROR Closing socket &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /10.0.0.220 because of
    error (kafka.network.Processor)
    
    kafka.common.KafkaException: Wrong request type 11
    
    at kafka.api.RequestKeys$.nameForKey(RequestKeys.scala:55)
    
    at
    kafka.network.RequestChannel$Request.updateRequestMetrics(RequestChannel.scala:85)
    
    at kafka.network.Processor.write(SocketServer.scala:514)
    
    at kafka.network.Processor.run(SocketServer.scala:379)
    
     at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This a result of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2044&quot; title=&quot;Support requests and responses from o.a.k.common in KafkaApis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2044&quot;&gt;&lt;del&gt;KAFKA-2044&lt;/del&gt;&lt;/a&gt; - we moved few Requests out&lt;br/&gt;
of RequestKeys to the newer ApiKeys, but didn&apos;t update the metrics&lt;br/&gt;
code.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12820427">KAFKA-2115</key>
            <summary>Error updating metrics in RequestChannel</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gwenshap">Gwen Shapira</assignee>
                                    <reporter username="gwenshap">Gwen Shapira</reporter>
                        <labels>
                    </labels>
                <created>Sun, 12 Apr 2015 21:42:48 +0000</created>
                <updated>Mon, 13 Apr 2015 14:22:37 +0000</updated>
                            <resolved>Mon, 13 Apr 2015 14:22:37 +0000</resolved>
                                                    <fixVersion>0.9.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14491875" author="gwenshap" created="Mon, 13 Apr 2015 03:39:13 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33118/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33118/diff/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="14491878" author="gwenshap" created="Mon, 13 Apr 2015 03:42:51 +0000"  >&lt;p&gt;I created a small test that uses the new consumer API, so I can reproduce the error and validate my patch.&lt;/p&gt;

&lt;p&gt;One thing I noticed while running my test is that while my consumer is running, it looks like a new consumer is joining the consumer group every 10 seconds:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[2015-04-12 20:34:44,743] INFO [Kafka Coordinator 0]: Registered consumer test-23 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; group test (kafka.coordinator.ConsumerCoordinator)
[2015-04-12 20:34:44,746] INFO [Kafka Coordinator 0]: Handled join-group from consumer to group test (kafka.coordinator.ConsumerCoordinator)
[2015-04-12 20:34:54,649] INFO [Kafka Coordinator 0]: Handled heartbeat of consumer from group test (kafka.coordinator.ConsumerCoordinator)
[2015-04-12 20:34:54,652] INFO [Kafka Coordinator 0]: Registered consumer test-24 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; group test (kafka.coordinator.ConsumerCoordinator)
[2015-04-12 20:34:54,655] INFO [Kafka Coordinator 0]: Handled join-group from consumer to group test (kafka.coordinator.ConsumerCoordinator)
[2015-04-12 20:35:04,719] INFO [Kafka Coordinator 0]: Handled heartbeat of consumer from group test (kafka.coordinator.ConsumerCoordinator)
[2015-04-12 20:35:04,722] INFO [Kafka Coordinator 0]: Registered consumer test-25 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; group test (kafka.coordinator.ConsumerCoordinator)
[2015-04-12 20:35:04,725] INFO [Kafka Coordinator 0]: Handled join-group from consumer to group test (kafka.coordinator.ConsumerCoordinator)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I don&apos;t know whether this is expected behavior, bug in Kafka or bug in my consumer code... perhaps someone more familiar with the new consumer can jump in?&lt;/p&gt;

&lt;p&gt;Here&apos;s my test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;NewConsumerDemo {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        Properties props = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties();
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;bootstrap.servers&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;localhost:9092&quot;&lt;/span&gt;);
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;group.id&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;);
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;enable.auto.commit&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;);
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;auto.commit.interval.ms&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1000&quot;&lt;/span&gt;);
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;session.timeout.ms&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;30000&quot;&lt;/span&gt;);
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;key.deserializer&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;&lt;/span&gt;);
        props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;value.deserializer&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;&lt;/span&gt;);
        KafkaConsumer&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; consumer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KafkaConsumer&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;(props);
        consumer.subscribe(&lt;span class=&quot;code-quote&quot;&gt;&quot;t1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;topic2&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
                ConsumerRecords&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; records = consumer.poll(100);
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (ConsumerRecord&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; record : records)
                    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;offset = %d, key = %s, value = %s&quot;&lt;/span&gt;, record.offset(), record.key(), record.value());
            }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14491901" author="gwenshap" created="Mon, 13 Apr 2015 04:28:16 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/33118/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33118/diff/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="14492106" author="onurkaraman" created="Mon, 13 Apr 2015 09:10:24 +0000"  >&lt;p&gt;Trunk&apos;s coordinator is pretty much unimplemented. Without going into too many details, you&apos;re seeing this behavior because the coordinator never sends back the consumer id it generated for the consumer during the join group. So the consumer will just keep using the UNKNOWN_CONSUMER_ID (empty string). This will fail the heartbeat, making the consumer try to rejoin, again with UNKNOWN_CONSUMER_ID, causing the whole process to repeat. You can see in your logs the incrementing ids the coordinator made for the consumer, but the heartbeat logs show an empty consumer id. The 10 second gaps happens because heartbeats are sent at an interval of session.timeout.ms / 3.&lt;/p&gt;

&lt;p&gt;My coordinator patch should address this: &lt;a href=&quot;https://reviews.apache.org/r/33088&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/33088&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14492446" author="junrao" created="Mon, 13 Apr 2015 14:22:37 +0000"  >&lt;p&gt;Thanks for the latest patch. +1 and committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12724860" name="KAFKA-2115.patch" size="4627" author="gwenshap" created="Mon, 13 Apr 2015 03:39:11 +0000"/>
                            <attachment id="12724867" name="KAFKA-2115_2015-04-12_21:28:12.patch" size="7257" author="gwenshap" created="Mon, 13 Apr 2015 04:28:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2d5un:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>