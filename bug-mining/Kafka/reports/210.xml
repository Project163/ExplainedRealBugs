<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:37:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-767] Message Size check should be done after assigning the offsets</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-767</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Replica fetcher thread fails with messageSizeTooLarge exception. One theory is that this check is happening before decompress - assign offsets - compress phase. Hence the final compressed size can be different from that obtained from the produce request. This causes replica fetcher thread to be permanently down and prevents the broker from being in sync.&lt;/p&gt;

&lt;p&gt;2013/02/20 02:19:25.447 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;ReplicaFetcherThread&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;ReplicaFetcherThread-0-274&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; []  &lt;span class=&quot;error&quot;&gt;&amp;#91;ReplicaFetcherThread-0-274&amp;#93;&lt;/span&gt;, Error due to&lt;br/&gt;
kafka.common.MessageSizeTooLargeException: Message size is 1000028 bytes which exceeds the maximum configured message size of 1000000.&lt;br/&gt;
        at kafka.log.Log$$anonfun$analyzeAndValidateMessageSet$1.apply(Log.scala:353)&lt;br/&gt;
        at kafka.log.Log$$anonfun$analyzeAndValidateMessageSet$1.apply(Log.scala:339)&lt;br/&gt;
        at scala.collection.Iterator$class.foreach(Iterator.scala:631)&lt;br/&gt;
        at kafka.utils.IteratorTemplate.foreach(IteratorTemplate.scala:32)&lt;br/&gt;
        at kafka.log.Log.analyzeAndValidateMessageSet(Log.scala:339)&lt;br/&gt;
        at kafka.log.Log.append(Log.scala:262)&lt;br/&gt;
        at kafka.server.ReplicaFetcherThread.processPartitionData(ReplicaFetcherThread.scala:52)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread$$anonfun$processFetchRequest$4.apply(AbstractFetcherThread.scala:130)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread$$anonfun$processFetchRequest$4.apply(AbstractFetcherThread.scala:113)&lt;br/&gt;
        at scala.collection.immutable.HashMap$HashMap1.foreach(HashMap.scala:125)&lt;br/&gt;
        at scala.collection.immutable.HashMap$HashTrieMap.foreach(HashMap.scala:344)&lt;br/&gt;
        at scala.collection.immutable.HashMap$HashTrieMap.foreach(HashMap.scala:344)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.processFetchRequest(AbstractFetcherThread.scala:113)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.doWork(AbstractFetcherThread.scala:89)&lt;br/&gt;
        at kafka.utils.ShutdownableThread.run(ShutdownableThread.scala:51)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12633276">KAFKA-767</key>
            <summary>Message Size check should be done after assigning the offsets</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sriramsub">Sriram</assignee>
                                    <reporter username="sriramsub">Sriram</reporter>
                        <labels>
                            <label>p1</label>
                    </labels>
                <created>Wed, 20 Feb 2013 21:15:28 +0000</created>
                <updated>Fri, 22 Feb 2013 23:03:30 +0000</updated>
                            <resolved>Fri, 22 Feb 2013 23:03:28 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>log</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13584065" author="sriramsub" created="Fri, 22 Feb 2013 07:44:16 +0000"  >&lt;p&gt;Changes&lt;/p&gt;

&lt;p&gt;core/src/main/scala/kafka/log/Log.scala |   18 +++++++++++-------&lt;br/&gt;
 1 file changed, 11 insertions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/add.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, 7 deletions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/forbidden.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13584349" author="junrao" created="Fri, 22 Feb 2013 15:28:32 +0000"  >&lt;p&gt;Thanks for the patch. It looks good. Should we put the size verifying logic in a separate private method?&lt;/p&gt;

&lt;p&gt;Also, the patch doesn&apos;t apply to 0.8. Could you rebase?&lt;/p&gt;</comment>
                            <comment id="13584352" author="nehanarkhede" created="Fri, 22 Feb 2013 15:33:23 +0000"  >&lt;p&gt;Thanks for the patch, it  looks good. Just one comment, can you break long log4j line ?&lt;/p&gt;</comment>
                            <comment id="13584534" author="sriramsub" created="Fri, 22 Feb 2013 18:45:35 +0000"  >&lt;p&gt;Neha - fixed&lt;br/&gt;
Jun - I dont see a strong reason to make it a method. It neither seems reusable nor large enough to wrap it in a method.&lt;/p&gt;</comment>
                            <comment id="13584794" author="nehanarkhede" created="Fri, 22 Feb 2013 23:03:28 +0000"  >&lt;p&gt;committed v2&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12570440" name="KAFKA-767-v1.patch" size="2615" author="sriramsub" created="Fri, 22 Feb 2013 07:43:28 +0000"/>
                            <attachment id="12570509" name="KAFKA-767-v2.patch" size="3917" author="sriramsub" created="Fri, 22 Feb 2013 18:45:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313772</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1i5an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314117</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>