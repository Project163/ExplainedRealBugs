<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:02:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5456] Producer fails with NPE if compressed V0 or V1 record is larger than batch size</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5456</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;If a record exceed the producer&apos;s configure batch size on &lt;tt&gt;send()&lt;/tt&gt;, producer fails with a NPE&lt;/p&gt;

&lt;p&gt;From mailing list:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;java.lang.NullPointerException&lt;/p&gt;

&lt;p&gt;at org.apache.kafka.common.utils.Utils.notNull(Utils.java:243)&lt;br/&gt;
at&lt;br/&gt;
org.apache.kafka.clients.producer.internals.RecordAccumulator.append(RecordAccumulator.java:219)&lt;br/&gt;
at&lt;br/&gt;
org.apache.kafka.clients.producer.KafkaProducer.doSend(KafkaProducer.java:650)&lt;br/&gt;
at&lt;br/&gt;
org.apache.kafka.clients.producer.KafkaProducer.send(KafkaProducer.java:604)&lt;br/&gt;
at&lt;br/&gt;
org.apache.kafka.streams.processor.internals.RecordCollectorImpl.send(RecordCollectorImpl.java:97)&lt;br/&gt;
at&lt;br/&gt;
org.apache.kafka.streams.state.internals.StoreChangeLogger.logChange(StoreChangeLogger.java:59)&lt;br/&gt;
at&lt;br/&gt;
...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The NPE is not very helpful and we should have a proper exception type and meaningful exception message that points the user to the config they need to change to fix the problem. We also need to add a test for this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13080262">KAFKA-5456</key>
            <summary>Producer fails with NPE if compressed V0 or V1 record is larger than batch size</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hachikuji">Jason Gustafson</assignee>
                                    <reporter username="mjsax">Matthias J. Sax</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Jun 2017 23:46:28 +0000</created>
                <updated>Fri, 16 Jun 2017 19:41:46 +0000</updated>
                            <resolved>Fri, 16 Jun 2017 19:40:03 +0000</resolved>
                                    <version>0.11.0.0</version>
                                    <fixVersion>0.11.0.0</fixVersion>
                                    <component>producer </component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16051219" author="apurva" created="Fri, 16 Jun 2017 00:06:50 +0000"  >&lt;p&gt;Additionally `MemoryRecordsBuilder.hasRoomFor` doesn&apos;t take into account the headers when computing whether a batch has room. This could result in a BufferFull or similar exception when headers are actually used. &lt;/p&gt;</comment>
                            <comment id="16051437" author="hachikuji" created="Fri, 16 Jun 2017 06:07:30 +0000"  >&lt;p&gt;I think the issue here is a slight change in the &lt;tt&gt;hasRoomFor&lt;/tt&gt; calculation that affects the older message formats. Previously we used the computed size of the record in &lt;tt&gt;hasRoomFor&lt;/tt&gt; to tell whether it was safe to append. This was justifiably changed to use the remaining bytes in the buffer instead, but now the check no longer works when a compressed message exceeds the batch size because the computed size does not take into account the batch overhead.&lt;/p&gt;</comment>
                            <comment id="16051448" author="githubbot" created="Fri, 16 Jun 2017 06:23:49 +0000"  >&lt;p&gt;GitHub user hachikuji opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3356&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3356&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5456&quot; title=&quot;Producer fails with NPE if compressed V0 or V1 record is larger than batch size&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5456&quot;&gt;&lt;del&gt;KAFKA-5456&lt;/del&gt;&lt;/a&gt;: Ensure producer handles old format large compressed messages&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hachikuji/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hachikuji/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5456&quot; title=&quot;Producer fails with NPE if compressed V0 or V1 record is larger than batch size&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5456&quot;&gt;&lt;del&gt;KAFKA-5456&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3356.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3356.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3356&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a0805d21a0fdef0dab527464f39c3b0e07a59310&lt;br/&gt;
Author: Jason Gustafson &amp;lt;jason@confluent.io&amp;gt;&lt;br/&gt;
Date:   2017-06-16T06:19:48Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5456&quot; title=&quot;Producer fails with NPE if compressed V0 or V1 record is larger than batch size&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5456&quot;&gt;&lt;del&gt;KAFKA-5456&lt;/del&gt;&lt;/a&gt;: Ensure producer handles old format large compressed messages&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16051865" author="flyaruu" created="Fri, 16 Jun 2017 13:03:40 +0000"  >&lt;p&gt;Yes, this patch seems to fix the issue. Thanks!&lt;/p&gt;</comment>
                            <comment id="16052047" author="ijuma" created="Fri, 16 Jun 2017 15:41:55 +0000"  >&lt;p&gt;The JIRA states that this affects 0.10.2.1 as well, but is that true? Looking at the code, it seems like it doesn&apos;t have the same issue.&lt;/p&gt;</comment>
                            <comment id="16052062" author="flyaruu" created="Fri, 16 Jun 2017 15:52:56 +0000"  >&lt;p&gt;The issue I saw with a 0.11 streams instance using a 0.10.2.1 broker.&lt;/p&gt;

&lt;p&gt;I upgraded the streams instance and this happened pretty much immediately, after some investigation I updated my development broker as well, then it didn&apos;t happen any more. I&apos;ve tried the patch and then I can also use a 0.10.2.1 broker.&lt;/p&gt;</comment>
                            <comment id="16052064" author="ijuma" created="Fri, 16 Jun 2017 15:55:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=flyaruu&quot; class=&quot;user-hover&quot; rel=&quot;flyaruu&quot;&gt;flyaruu&lt;/a&gt;, thanks. That makes sense because this affects the client library &lt;em&gt;and&lt;/em&gt; the old message format. So, 0.11.0.0 client and 0.10.2.1 broker would do it. But the broker doesn&apos;t have a bug, it just causes the old message format to be used.&lt;/p&gt;</comment>
                            <comment id="16052319" author="ijuma" created="Fri, 16 Jun 2017 19:40:03 +0000"  >&lt;p&gt;Issue resolved by pull request 3356&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/3356&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3356&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16052320" author="githubbot" created="Fri, 16 Jun 2017 19:40:46 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3356&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3356&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 22 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gcjb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>