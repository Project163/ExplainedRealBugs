<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:24:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-8011] Flaky Test RegexSourceIntegrationTest#testRegexMatchesTopicsAWhenCreated</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-8011</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The&#160;RegexSourceIntegrationTest#testRegexMatchesTopicsAWhenCreated&lt;/p&gt;

&lt;p&gt;and&#160;RegexSourceIntegrationTest#testRegexMatchesTopicsAWhenDeleted&#160; tests use an ArrayList to assert the topics assigned to the Streams application.&#160;&lt;/p&gt;

&lt;p&gt;The ConsumerRebalanceListener used in the test operates on this list as does the&#160;TestUtils.waitForCondition() to verify the expected topic assignments.&lt;/p&gt;

&lt;p&gt;Using the same list in both places can cause a ConcurrentModficationException if&#160;the rebalance listener&#160;modifies&#160;the assignment at the same time&#160;TestUtils.waitForCondition()&#160;is using the list to verify the expected topics.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13218376">KAFKA-8011</key>
            <summary>Flaky Test RegexSourceIntegrationTest#testRegexMatchesTopicsAWhenCreated</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mjsax">Matthias J. Sax</assignee>
                                    <reporter username="bbejeck">Bill Bejeck</reporter>
                        <labels>
                            <label>flaky-test</label>
                            <label>newbie</label>
                    </labels>
                <created>Wed, 27 Feb 2019 15:32:38 +0000</created>
                <updated>Fri, 5 Jun 2020 21:42:37 +0000</updated>
                            <resolved>Fri, 5 Jun 2020 21:42:37 +0000</resolved>
                                                    <fixVersion>1.0.3</fixVersion>
                    <fixVersion>1.1.2</fixVersion>
                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                    <fixVersion>2.6.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16779448" author="mjsax" created="Wed, 27 Feb 2019 15:47:43 +0000"  >&lt;p&gt;Did this fail on `trunk` ? Please provide link to the build and also copy the stack trace into the ticket (the build is deleted eventually).&lt;/p&gt;</comment>
                            <comment id="16779472" author="bbejeck" created="Wed, 27 Feb 2019 16:17:24 +0000"  >&lt;p&gt;Here&apos;s the link to the build&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/kafka-pr-jdk11-scala2.12/2730/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/kafka-pr-jdk11-scala2.12/2730/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.util.ConcurrentModificationException
	at java.base/java.util.ArrayList.checkForComodification(ArrayList.java:604)
	at java.base/java.util.ArrayList.equals(ArrayList.java:563)
	at org.apache.kafka.streams.integration.RegexSourceIntegrationTest.lambda$testRegexMatchesTopicsAWhenDeleted$3(RegexSourceIntegrationTest.java:213)
	at org.apache.kafka.test.TestUtils.waitForCondition(TestUtils.java:355)
	at org.apache.kafka.test.TestUtils.waitForCondition(TestUtils.java:325)
	at org.apache.kafka.streams.integration.RegexSourceIntegrationTest.testRegexMatchesTopicsAWhenDeleted(RegexSourceIntegrationTest.java:213)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:305)
	at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:365)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:330)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:78)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:328)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:65)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:292)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:54)
	at org.junit.rules.RunRules.evaluate(RunRules.java:20)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:305)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:412)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.runTestClass(JUnitTestClassExecutor.java:110)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.execute(JUnitTestClassExecutor.java:58)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.execute(JUnitTestClassExecutor.java:38)
	at org.gradle.api.internal.tasks.testing.junit.AbstractJUnitTestClassProcessor.processTestClass(AbstractJUnitTestClassProcessor.java:62)
	at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:51)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.internal.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:32)
	at org.gradle.internal.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:93)
	at com.sun.proxy.$Proxy2.processTestClass(Unknown Source)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker.processTestClass(TestWorker.java:118)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)
	at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:175)
	at org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:157)
	at org.gradle.internal.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:404)
	at org.gradle.internal.concurrent.ExecutorPolicy$CatchAndRecordFailures.onExecute(ExecutorPolicy.java:63)
	at org.gradle.internal.concurrent.ManagedExecutorImpl$1.run(ManagedExecutorImpl.java:46)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at org.gradle.internal.concurrent.ThreadFactoryImpl$ManagedThreadRunnable.run(ThreadFactoryImpl.java:55)
	at java.base/java.lang.Thread.run(Thread.java:834)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16779605" author="githubbot" created="Wed, 27 Feb 2019 18:20:30 +0000"  >&lt;p&gt;bbejeck commented on pull request #6338: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8011&quot; title=&quot;Flaky Test RegexSourceIntegrationTest#testRegexMatchesTopicsAWhenCreated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8011&quot;&gt;&lt;del&gt;KAFKA-8011&lt;/del&gt;&lt;/a&gt;: Fix for race condition causing ConcurrentModificationException&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6338&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   In the `RegexSourceIntegrationTest#testRegexMatchesTopicsAWhenCreated()` and `RegexSourceIntegrationTest#testRegexMatchesTopicsAWhenDeleted()` a race condition exists where the `ConsumerRebalanceListener` in the test modifies the list of subscribed topics when the condition for the test success is comparing the same array instance against expected values.&lt;/p&gt;

&lt;p&gt;   This PR should fix this race condition by using a `CopyOnWriteArrayList` which guarantees safe traversal of the list even when a concurrent modification is happening.  &lt;/p&gt;

&lt;p&gt;   Using the `CopyOnWriteArrayList` should not impact performance negatively as the number of traversals, a result of using `ArrayList.equals()`, far outnumber (`TestUtils.waitForCondition()` checks for a successful result every`100ms`) the possible modifications as there will be at most one topic name added/removed during the test.&lt;/p&gt;

&lt;p&gt;   For testing, I updated the `RegexSourceIntegrationTest`integration test and ran the suite of streams tests.&lt;/p&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16781105" author="githubbot" created="Thu, 28 Feb 2019 23:54:28 +0000"  >&lt;p&gt;bbejeck commented on pull request #6338: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8011&quot; title=&quot;Flaky Test RegexSourceIntegrationTest#testRegexMatchesTopicsAWhenCreated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8011&quot;&gt;&lt;del&gt;KAFKA-8011&lt;/del&gt;&lt;/a&gt;: Fix for race condition causing ConcurrentModificationException&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6338&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6338&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16781387" author="mjsax" created="Fri, 1 Mar 2019 07:35:27 +0000"  >&lt;p&gt;It seems the cherry-pick broke older branches. The following happened in 1.0 and 1.1&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/blue/organizations/jenkins/kafka-1.0-jdk7/detail/kafka-1.0-jdk7/263/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/blue/organizations/jenkins/kafka-1.0-jdk7/detail/kafka-1.0-jdk7/263/tests&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/blue/organizations/jenkins/kafka-1.1-jdk7/detail/kafka-1.1-jdk7/249/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/blue/organizations/jenkins/kafka-1.1-jdk7/detail/kafka-1.1-jdk7/249/tests&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;STDOUT:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Exception in thread &quot;regex-source-integration-test-f12281d4-a87a-4612-b2d0-34200123c1b7-StreamThread-128&quot; org.apache.kafka.streams.errors.TopologyException: Invalid topology: Topic foo is already matched for another regex pattern foo.* and hence cannot be matched to this regex pattern f.* any more.&lt;br/&gt;
at org.apache.kafka.streams.processor.internals.InternalTopologyBuilder$SourceNodeFactory.getTopics(InternalTopologyBuilder.java:310)&lt;br/&gt;
at org.apache.kafka.streams.processor.internals.InternalTopologyBuilder.setRegexMatchedTopicsToSourceNodes(InternalTopologyBuilder.java:1087)&lt;br/&gt;
at org.apache.kafka.streams.processor.internals.InternalTopologyBuilder.updateSubscriptions(InternalTopologyBuilder.java:1263)&lt;br/&gt;
at org.apache.kafka.streams.processor.internals.StreamPartitionAssignor.updateSubscribedTopics(StreamPartitionAssignor.java:292)&lt;br/&gt;
at org.apache.kafka.streams.processor.internals.StreamPartitionAssignor.subscription(StreamPartitionAssignor.java:281)&lt;br/&gt;
at org.apache.kafka.clients.consumer.internals.ConsumerCoordinator.metadata(ConsumerCoordinator.java:152)&lt;br/&gt;
at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.sendJoinGroupRequest(AbstractCoordinator.java:443)&lt;br/&gt;
at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.initiateJoinGroup(AbstractCoordinator.java:402)&lt;br/&gt;
at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.joinGroupIfNeeded(AbstractCoordinator.java:363)&lt;br/&gt;
at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.ensureActiveGroup(AbstractCoordinator.java:316)&lt;br/&gt;
at org.apache.kafka.clients.consumer.internals.ConsumerCoordinator.poll(ConsumerCoordinator.java:295)&lt;br/&gt;
at org.apache.kafka.clients.consumer.KafkaConsumer.pollOnce(KafkaConsumer.java:1146)&lt;br/&gt;
at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:1111)&lt;br/&gt;
at org.apache.kafka.streams.processor.internals.StreamThread.pollRequests(StreamThread.java:848)&lt;br/&gt;
at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:805)&lt;br/&gt;
at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:771)&lt;br/&gt;
at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:741)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;br/&gt;
Can you check &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bbejeck&quot; class=&quot;user-hover&quot; rel=&quot;bbejeck&quot;&gt;bbejeck&lt;/a&gt;? Did you run the tests locally on&#160;both branches before pushing the cherry-pick?&lt;/p&gt;</comment>
                            <comment id="16781755" author="bbejeck" created="Fri, 1 Mar 2019 15:05:56 +0000"  >&lt;p&gt;I&apos;ve been able to verify that both 1.0 and 1.1 tests pass locally.&#160; If there is a failure in a subsequent build should I revert the cherry-pick?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;EDIT: Additionally the error message in the 1.1 failure&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;regex-source-integration-test-e94954f0-2bda-4967-89ee-3de8a64522ea-StreamThread-6&quot; org.apache.kafka.streams.errors.TopologyException: Invalid topology: Topic foo is already matched for another regex pattern foo.* and hence cannot be matched to this regex pattern f.* any more.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;includes a topic name that is not even in the test.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The commit only changed the type of the List used in two tests; I made no logic changes were at&#160;all.&lt;/p&gt;</comment>
                            <comment id="16781880" author="mjsax" created="Fri, 1 Mar 2019 17:06:58 +0000"  >&lt;p&gt;Your commit might be unrelated. It&apos;s older branches that don&apos;t run regularly and longer. I&apos;ll just create a new ticket for it. Thanks!&lt;/p&gt;</comment>
                            <comment id="16781883" author="mjsax" created="Fri, 1 Mar 2019 17:09:09 +0000"  >&lt;p&gt;Done: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8026&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-8026&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17118097" author="mjsax" created="Wed, 27 May 2020 21:11:37 +0000"  >&lt;p&gt;Failed again:&#160;&lt;a href=&quot;https://builds.apache.org/job/kafka-pr-jdk8-scala2.12/2533/testReport/junit/org.apache.kafka.streams.integration/RegexSourceIntegrationTest/testRegexMatchesTopicsAWhenCreated/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/kafka-pr-jdk8-scala2.12/2533/testReport/junit/org.apache.kafka.streams.integration/RegexSourceIntegrationTest/testRegexMatchesTopicsAWhenCreated/&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;java.lang.RuntimeException: java.util.concurrent.ExecutionException: org.apache.kafka.common.errors.TopicExistsException: Topic &apos;TEST-TOPIC-1&apos; already exists. at org.apache.kafka.streams.integration.utils.KafkaEmbedded.createTopic(KafkaEmbedded.java:187) at org.apache.kafka.streams.integration.utils.EmbeddedKafkaCluster.createTopic(EmbeddedKafkaCluster.java:218) at org.apache.kafka.streams.integration.utils.EmbeddedKafkaCluster.createTopic(EmbeddedKafkaCluster.java:192) at org.apache.kafka.streams.integration.RegexSourceIntegrationTest.testRegexMatchesTopicsAWhenCreated(RegexSourceIntegrationTest.java:154)&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="17118098" author="mjsax" created="Wed, 27 May 2020 21:12:11 +0000"  >&lt;p&gt;Different test method:&#160;&lt;a href=&quot;https://builds.apache.org/job/kafka-pr-jdk8-scala2.12/2533/testReport/junit/org.apache.kafka.streams.integration/RegexSourceIntegrationTest/testRegexRecordsAreProcessedAfterReassignment/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/kafka-pr-jdk8-scala2.12/2533/testReport/junit/org.apache.kafka.streams.integration/RegexSourceIntegrationTest/testRegexRecordsAreProcessedAfterReassignment/&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;java.lang.AssertionError: Condition not met within timeout 60000. Did not receive all &lt;span class=&quot;error&quot;&gt;&amp;#91;KeyValue(1, 1), KeyValue(2, 2)&amp;#93;&lt;/span&gt; records from topic outputTopic_1 at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:26) at org.apache.kafka.test.TestUtils.lambda$waitForCondition$5(TestUtils.java:381) at org.apache.kafka.test.TestUtils.retryOnExceptionWithTimeout(TestUtils.java:429) at org.apache.kafka.test.TestUtils.retryOnExceptionWithTimeout(TestUtils.java:397) at org.apache.kafka.test.TestUtils.waitForCondition(TestUtils.java:378) at org.apache.kafka.test.TestUtils.waitForCondition(TestUtils.java:368) at org.apache.kafka.streams.integration.utils.IntegrationTestUtils.waitUntilFinalKeyValueRecordsReceived(IntegrationTestUtils.java:704) at org.apache.kafka.streams.integration.utils.IntegrationTestUtils.waitUntilFinalKeyValueRecordsReceived(IntegrationTestUtils.java:658) at org.apache.kafka.streams.integration.utils.IntegrationTestUtils.waitUntilFinalKeyValueRecordsReceived(IntegrationTestUtils.java:619) at org.apache.kafka.streams.integration.RegexSourceIntegrationTest.testRegexRecordsAreProcessedAfterReassignment(RegexSourceIntegrationTest.java:214)&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="17118222" author="ableegoldman" created="Thu, 28 May 2020 01:56:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt;&#160;should we create a separate ticket for that test? AFAICT the test this ticket is for is only failing because that test is failing and the cleanup isn&apos;t done properly. But the test you pointed out seems to be a real bug:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2020-05-27 17:56:00,413] ERROR Exception caught during Deserialization, taskId: 0_0, topic: TEST-TOPIC-1, partition: 0, offset: 0 (org.apache.kafka.streams.errors.LogAndFailExceptionHandler:39)
java.lang.NullPointerException
	at org.apache.kafka.streams.processor.internals.SourceNode.deserializeKey(SourceNode.java:58)
	at org.apache.kafka.streams.processor.internals.RecordDeserializer.deserialize(RecordDeserializer.java:65)
	at org.apache.kafka.streams.processor.internals.RecordQueue.updateHead(RecordQueue.java:176)
	at org.apache.kafka.streams.processor.internals.RecordQueue.addRawRecords(RecordQueue.java:112)
	at org.apache.kafka.streams.processor.internals.PartitionGroup.addRawRecords(PartitionGroup.java:185)
	at org.apache.kafka.streams.processor.internals.StreamTask.addRecords(StreamTask.java:844)
	at org.apache.kafka.streams.processor.internals.StreamThread.addRecordsToTasks(StreamThread.java:836)
	at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:646)
	at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:550)
	at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:509)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17118245" author="ableegoldman" created="Thu, 28 May 2020 02:41:59 +0000"  >&lt;p&gt;Attaching the output from local testing:&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13004191/13004191_org.apache.kafka.streams.integration.RegexSourceIntegrationTest.html&quot; title=&quot;org.apache.kafka.streams.integration.RegexSourceIntegrationTest.html attached to KAFKA-8011&quot;&gt;org.apache.kafka.streams.integration.RegexSourceIntegrationTest.html&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17118262" author="mjsax" created="Thu, 28 May 2020 03:33:07 +0000"  >&lt;p&gt;We can also create a new ticket. I don&apos;t care.&lt;/p&gt;</comment>
                            <comment id="17127103" author="mjsax" created="Fri, 5 Jun 2020 21:42:37 +0000"  >&lt;p&gt;The currently failing test exposes a real bug (tracked via:&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-10102&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-10102&lt;/a&gt;) &#8211; hence, closing this ticket as the test itself is not flaky.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13004191" name="org.apache.kafka.streams.integration.RegexSourceIntegrationTest.html" size="515189" author="ableegoldman" created="Thu, 28 May 2020 02:41:36 +0000"/>
                            <attachment id="12960791" name="streams_1_0_test_results.png" size="303976" author="bbejeck" created="Fri, 1 Mar 2019 15:01:58 +0000"/>
                            <attachment id="12960792" name="streams_1_1_tests.png" size="322086" author="bbejeck" created="Fri, 1 Mar 2019 15:01:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 23 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0057k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>