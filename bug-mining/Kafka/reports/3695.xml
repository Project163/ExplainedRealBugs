<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:37:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-16226] Java client: Performance regression in Trogdor benchmark with high partition counts</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-16226</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;h1&gt;&lt;a name=&quot;Background&quot;&gt;&lt;/a&gt;Background&lt;/h1&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-15415&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-15415&lt;/a&gt; implemented optimisation in java-client to skip backoff period if client knows of a newer leader, for produce-batch being retried.&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;Whatchanged&quot;&gt;&lt;/a&gt;What changed&lt;/h1&gt;

&lt;p&gt;The implementation introduced a regression noticed on a trogdor-benchmark running with high partition counts(36000!).&lt;br/&gt;
With regression, following metrics changed on the produce side.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;record-queue-time-avg: increased from 20ms to 30ms.&lt;/li&gt;
	&lt;li&gt;request-latency-avg: increased from 50ms to 100ms.&lt;/li&gt;
&lt;/ol&gt;


&lt;h1&gt;&lt;a name=&quot;Whyithappened&quot;&gt;&lt;/a&gt;Why it happened&lt;/h1&gt;

&lt;p&gt;As can be seen from the original &lt;a href=&quot;https://github.com/apache/kafka/pull/14384&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; RecordAccmulator.partitionReady() &amp;amp; drainBatchesForOneNode() started using synchronised method Metadata.currentLeader(). This has led to increased synchronization between KafkaProducer&apos;s application-thread that call send(), and background-thread that actively send producer-batches to leaders.&lt;/p&gt;

&lt;p&gt;Lock profiles clearly show increased synchronisation in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-15415&quot; title=&quot;In Java-client, backoff should be skipped for retried producer-batch to a new leader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-15415&quot;&gt;&lt;del&gt;KAFKA-15415&lt;/del&gt;&lt;/a&gt; PR(highlighted in &lt;font color=&quot;#de350b&quot;&gt;Red&lt;/font&gt;) Vs baseline ( see below ). Note the synchronisation is much worse for paritionReady() in this benchmark as its called for each partition, and it has 36k partitions!&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;LockProfile%3AKafka15415&quot;&gt;&lt;/a&gt;Lock Profile: Kafka-15415&lt;/h3&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13066524/13066524_kafka_15415_lock_profile.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;LockProfile%3ABaseline&quot;&gt;&lt;/a&gt;Lock Profile: Baseline&lt;/h3&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13066525/13066525_baseline_lock_profile.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h1&gt;&lt;a name=&quot;Fix&quot;&gt;&lt;/a&gt;Fix&lt;/h1&gt;

&lt;p&gt;Synchronization has to be reduced between 2 threads in order to address this. &lt;a href=&quot;https://github.com/apache/kafka/pull/15323&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/15323&lt;/a&gt; is a fix for it, as it avoids using Metadata.currentLeader() instead rely on Cluster.leaderFor().&lt;/p&gt;

&lt;p&gt;With the fix, lock-profile &amp;amp; metrics are similar to baseline.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13567611">KAFKA-16226</key>
            <summary>Java client: Performance regression in Trogdor benchmark with high partition counts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mayanksnarula">Mayank Shekhar Narula</assignee>
                                    <reporter username="mayanksnarula">Mayank Shekhar Narula</reporter>
                        <labels>
                            <label>kip-951</label>
                    </labels>
                <created>Tue, 6 Feb 2024 15:07:53 +0000</created>
                <updated>Thu, 14 Mar 2024 15:12:34 +0000</updated>
                            <resolved>Thu, 14 Mar 2024 14:09:45 +0000</resolved>
                                    <version>3.6.1</version>
                    <version>3.7.0</version>
                                    <fixVersion>3.6.2</fixVersion>
                    <fixVersion>3.7.1</fixVersion>
                    <fixVersion>3.8.0</fixVersion>
                                    <component>clients</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                    <issuelinks>
                            <issuelinktype id="12310460">
                    <name>Child-Issue</name>
                                                                <inwardlinks description="is a child of">
                                        <issuelink>
            <issuekey id="13558852">KAFKA-15868</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="13548964">KAFKA-15415</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13568480">KAFKA-16259</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13066525" name="baseline_lock_profile.png" size="341548" author="mayanksnarula" created="Tue, 6 Feb 2024 15:48:36 +0000"/>
                            <attachment id="13066524" name="kafka_15415_lock_profile.png" size="351421" author="mayanksnarula" created="Tue, 6 Feb 2024 15:48:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 40 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1n91c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>wcarlson</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>