<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:31:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-14089] Flaky ExactlyOnceSourceIntegrationTest.testSeparateOffsetsTopic</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-14089</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;It looks like the sequence got broken around &quot;65535, 65537, 65536, 65539, 65538, 65541, 65540, 65543&quot;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13472447">KAFKA-14089</key>
            <summary>Flaky ExactlyOnceSourceIntegrationTest.testSeparateOffsetsTopic</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ChrisEgerton">Chris Egerton</assignee>
                                    <reporter username="mimaison">Mickael Maison</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Jul 2022 10:22:29 +0000</created>
                <updated>Mon, 17 Jun 2024 16:47:16 +0000</updated>
                            <resolved>Mon, 17 Jun 2024 16:47:04 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17568972" author="mimaison" created="Wed, 20 Jul 2022 10:22:50 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ChrisEgerton&quot; class=&quot;user-hover&quot; rel=&quot;ChrisEgerton&quot;&gt;ChrisEgerton&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17569204" author="chrisegerton" created="Wed, 20 Jul 2022 23:28:11 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mimaison&quot; class=&quot;user-hover&quot; rel=&quot;mimaison&quot;&gt;mimaison&lt;/a&gt;. We don&apos;t assert on order of records, just that the expected seqnos were present in any order, so the wonkiness around 65535 isn&apos;t actually an issue (and it&apos;s even present in the stringified representation of both the expected &lt;em&gt;and&lt;/em&gt; the actual seqno sets).&lt;/p&gt;

&lt;p&gt;After doing some Bash scrubbing on the file attached to the ticket, it looks like seqnos start to be missing (i.e., they&apos;re in the expected set but not the actual) between 114463 and 114754. Not every seqno in that range is missing, but there&apos;s 105 missing in total. After that, starting at 114755, there&apos;s 105 extra (i.e., in the actual set but not the expected) seqnos.&lt;/p&gt;

&lt;p&gt;Given that the issues crop up at the very end of the seqno set, it seems like this could be caused by non-graceful shutdown of the worker after exactly-once support is disabled, or even possibly the recently-discovered &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-14079&quot; title=&quot;Source task will not commit offsets and develops memory leak if &amp;quot;error.tolerance&amp;quot; is set to &amp;quot;all&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-14079&quot;&gt;&lt;del&gt;KAFKA-14079&lt;/del&gt;&lt;/a&gt;. &lt;del&gt;It&apos;s a little worrisome, though, since the results here indicate possible data loss.&lt;/del&gt; Actually, on second thought, this is probably not data loss, since we&apos;re reading the records that have been produced to Kafka, but not necessarily the records whose offsets have been committed.&lt;/p&gt;

&lt;p&gt;If this was on Jenkins, do you have a link to the CI run that caused it? Or if it was encountered elsewhere, do you have any logs available? I&apos;ll try to kick off some local runs but I&apos;m in the middle of stress-testing my laptop with the latest KIP-618 system tests and may not be able to reproduce locally.&lt;/p&gt;

&lt;p&gt;I suspect a fix for this would involve reading the last-committed offset for each task, then only checking seqnos for that task up to the seqno in that offset. But I&apos;d like to have a better idea of what exactly is causing the failure before pulling the trigger on that, especially if it&apos;s unclean task/worker shutdown and we can find a way to fix that instead of adjusting our tests to handle sloppy shutdowns.&lt;/p&gt;</comment>
                            <comment id="17569309" author="mimaison" created="Thu, 21 Jul 2022 08:29:56 +0000"  >&lt;p&gt;I&apos;ve hit this issue locally and I can reproduce it fairly consistently. See attached logs&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13047069/13047069_org.apache.kafka.connect.integration.ExactlyOnceSourceIntegrationTest.testSeparateOffsetsTopic.test.stdout&quot; title=&quot;org.apache.kafka.connect.integration.ExactlyOnceSourceIntegrationTest.testSeparateOffsetsTopic.test.stdout attached to KAFKA-14089&quot;&gt;org.apache.kafka.connect.integration.ExactlyOnceSourceIntegrationTest.testSeparateOffsetsTopic.test.stdout&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="17569715" author="chrisegerton" created="Thu, 21 Jul 2022 22:58:29 +0000"  >&lt;p&gt;Thanks Mickael. I put together a draft fix &lt;a href=&quot;https://github.com/apache/kafka/pull/12429&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, although I still haven&apos;t been able to replicate the failure locally. If you have time, would you mind giving it a try and see if it has positive effects in your environment? I can also kick off several Jenkins builds by re-triggering CI runs, although that will be more time-consuming as it will run the build for the whole project instead of just Connect.&lt;/p&gt;</comment>
                            <comment id="17791121" author="apoorvmittal10" created="Wed, 29 Nov 2023 14:37:13 +0000"  >&lt;p&gt;Failure occurred on PR build: &lt;a href=&quot;https://ci-builds.apache.org/blue/organizations/jenkins/Kafka%2Fkafka-pr/detail/PR-14699/24/tests/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/blue/organizations/jenkins/Kafka%2Fkafka-pr/detail/PR-14699/24/tests/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.kafka.connect.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.errors.ConnectRestException: Could not execute PUT request. Error response: {&lt;span class=&quot;code-quote&quot;&gt;&quot;error_code&quot;&lt;/span&gt;:500,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Request timed out&quot;&lt;/span&gt;}Stacktraceorg.apache.kafka.connect.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.errors.ConnectRestException: Could not execute PUT request. Error response: {&lt;span class=&quot;code-quote&quot;&gt;&quot;error_code&quot;&lt;/span&gt;:500,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Request timed out&quot;&lt;/span&gt;}	at org.apache.kafka.connect.util.clusters.EmbeddedConnect.putConnectorConfig(EmbeddedConnect.java:272)	at org.apache.kafka.connect.util.clusters.EmbeddedConnect.configureConnector(EmbeddedConnect.java:196)	at org.apache.kafka.connect.util.clusters.EmbeddedConnectCluster.configureConnector(EmbeddedConnectCluster.java:48)	at org.apache.kafka.connect.integration.ExactlyOnceSourceIntegrationTest.testSeparateOffsetsTopic(ExactlyOnceSourceIntegrationTest.java:776)	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)	at java.lang.reflect.Method.invoke(Method.java:498)	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)	at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17830728" author="jolshan" created="Mon, 25 Mar 2024 23:01:15 +0000"  >&lt;p&gt;I&apos;ve seen this again as well. &lt;a href=&quot;https://ge.apache.org/scans/tests?search.names=Git%20branch&amp;amp;search.relativeStartTime=P28D&amp;amp;search.rootProjectNames=kafka&amp;amp;search.timeZoneId=America%2FLos_Angeles&amp;amp;search.values=trunk&amp;amp;tests.container=org.apache.kafka.connect.integration.ExactlyOnceSourceIntegrationTest&amp;amp;tests.test=testSeparateOffsetsTopic&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ge.apache.org/scans/tests?search.names=Git%20branch&amp;amp;search.relativeStartTime=P28D&amp;amp;search.rootProjectNames=kafka&amp;amp;search.timeZoneId=America%2FLos_Angeles&amp;amp;search.values=trunk&amp;amp;tests.container=org.apache.kafka.connect.integration.ExactlyOnceSourceIntegrationTest&amp;amp;tests.test=testSeparateOffsetsTopic&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17855668" author="chrisegerton" created="Mon, 17 Jun 2024 16:46:46 +0000"  >&lt;p&gt;Should be fixed by &lt;a href=&quot;https://github.com/apache/kafka/pull/16306.&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/16306&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13047017" name="failure.txt" size="1618692" author="mimaison" created="Wed, 20 Jul 2022 10:19:41 +0000"/>
                            <attachment id="13047069" name="org.apache.kafka.connect.integration.ExactlyOnceSourceIntegrationTest.testSeparateOffsetsTopic.test.stdout" size="2643399" author="mimaison" created="Thu, 21 Jul 2022 08:28:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z170eg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>