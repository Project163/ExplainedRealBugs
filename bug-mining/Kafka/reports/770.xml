<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:44:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2517] Performance Regression post SSL implementation</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2517</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;It would appear that we incurred a performance regression on submission of the SSL work affecting the performance of the new Kafka Consumer. &lt;/p&gt;

&lt;p&gt;Running with 1KB messages. Macbook 2.3 GHz Intel Core i7, 8GB, APPLE SSD SM256E. Single server instance. All local. &lt;/p&gt;

&lt;p&gt;kafka-consumer-perf-test.sh ... --messages 3000000  --new-consumer&lt;/p&gt;

&lt;p&gt;Pre-SSL changes (commit 503bd36647695e8cc91893ffb80346dd03eb0bc5)&lt;br/&gt;
Steady state throughputs = 234.8 MB/s&lt;br/&gt;
(2861.5913, 234.8261, 3000596, 246233.0543)&lt;/p&gt;

&lt;p&gt;Post-SSL changes (commit 13c432f7952de27e9bf8cb4adb33a91ae3a4b738) &lt;br/&gt;
Steady state throughput =  178.1 MB/s  &lt;br/&gt;
(2861.5913, 178.1480, 3000596, 186801.7182)&lt;/p&gt;

&lt;p&gt;Implication is a 25% reduction in consumer throughput for these test conditions. &lt;/p&gt;

&lt;p&gt;This appears to be caused by the use of PlaintextTransportLayer rather than SocketChannel in FileMessageSet.writeTo() meaning a zero copy transfer is not invoked.&lt;/p&gt;

&lt;p&gt;Switching to the use of a SocketChannel directly in FileMessageSet.writeTo()  yields the following result:&lt;br/&gt;
Steady state throughput =  281.8 MB/s&lt;br/&gt;
(2861.5913, 281.8191, 3000596, 295508.7650)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12861815">KAFKA-2517</key>
            <summary>Performance Regression post SSL implementation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ijuma">Ismael Juma</assignee>
                                    <reporter username="benstopford">Ben Stopford</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Sep 2015 11:46:17 +0000</created>
                <updated>Fri, 2 Oct 2015 21:46:30 +0000</updated>
                            <resolved>Fri, 2 Oct 2015 21:46:23 +0000</resolved>
                                                    <fixVersion>0.9.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14730715" author="ijuma" created="Fri, 4 Sep 2015 12:26:41 +0000"  >&lt;p&gt;Performance improves over the baseline then?&lt;/p&gt;</comment>
                            <comment id="14730720" author="benstopford" created="Fri, 4 Sep 2015 12:33:48 +0000"  >&lt;p&gt;That would be the implication but I am suspicious of that result in isolation. The key point for this jira is that there is a problem which we need to fix, and there is a potential solution. &lt;/p&gt;</comment>
                            <comment id="14730726" author="ijuma" created="Fri, 4 Sep 2015 12:37:59 +0000"  >&lt;p&gt;Yes, sure.&lt;/p&gt;</comment>
                            <comment id="14735670" author="sriharsha" created="Tue, 8 Sep 2015 21:40:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benstopford&quot; class=&quot;user-hover&quot; rel=&quot;benstopford&quot;&gt;benstopford&lt;/a&gt; it looks like transport layer needs to implement SelChImpl methods and delegate those to socketChannel for the zero-copy to work. Are you working on these changes?&lt;/p&gt;</comment>
                            <comment id="14735711" author="ijuma" created="Tue, 8 Sep 2015 22:01:50 +0000"  >&lt;p&gt;Implementing `SelChImpl` is undesirable as it&apos;s an internal implementation class in the JDK. A better alternative, in my opinion, is to pass the underlying `SocketChannel` to `transferTo`; Ben verified that this fixes the problem before filing this ticket. I suggest we add a transfer-like method to `TransportLayer`. In the `PlaintextTransportLayer` implementation, it should use the underlying `socketChannel` instead of itself.&lt;/p&gt;</comment>
                            <comment id="14735738" author="benstopford" created="Tue, 8 Sep 2015 22:26:05 +0000"  >&lt;p&gt;Yes - what Ismael said. I&apos;ll take a look at getting a PR out for this now. &lt;/p&gt;</comment>
                            <comment id="14744699" author="benstopford" created="Tue, 15 Sep 2015 02:19:01 +0000"  >&lt;p&gt;Retesting I&apos;ve not been able to reproduce this result to statistical significance. I will retest on linux but I suspect this is not a bug. &lt;/p&gt;</comment>
                            <comment id="14791033" author="ijuma" created="Wed, 16 Sep 2015 19:58:48 +0000"  >&lt;p&gt;Even if we can&apos;t measure the difference under simple benchmarks like the ones we have, it&apos;s important that we restore the zero-copy behaviour as it reduces GC pressure and CPU usage (which should help in production workloads).&lt;/p&gt;

&lt;p&gt;It would be better if we could show these benefits in our benchmarks, of course.&lt;/p&gt;</comment>
                            <comment id="14940991" author="ijuma" created="Fri, 2 Oct 2015 10:16:08 +0000"  >&lt;p&gt;Talked to Ben about this and he said it was OK for me to pick this up as he&apos;s busy at the moment.&lt;/p&gt;</comment>
                            <comment id="14940993" author="githubbot" created="Fri, 2 Oct 2015 10:21:16 +0000"  >&lt;p&gt;GitHub user ijuma opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/273&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2517&quot; title=&quot;Performance Regression post SSL implementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2517&quot;&gt;&lt;del&gt;KAFKA-2517&lt;/del&gt;&lt;/a&gt;; Performance Regression post SSL implementation (zero copy)&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ijuma/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ijuma/kafka&lt;/a&gt; kafka-2517-ssl-zero-copy-regression&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/273.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/273.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #273&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit fb88692a9e4f62677b91069db017c12ba5b42edd&lt;br/&gt;
Author: Ismael Juma &amp;lt;ismael@juma.me.uk&amp;gt;&lt;br/&gt;
Date:   2015-10-02T10:10:12Z&lt;/p&gt;

&lt;p&gt;    Introduce `TransportLayer.transferFrom` and use it from `FileMessageSet`&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14940996" author="ijuma" created="Fri, 2 Oct 2015 10:22:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt;, can you please review?&lt;/p&gt;</comment>
                            <comment id="14941819" author="junrao" created="Fri, 2 Oct 2015 21:46:23 +0000"  >&lt;p&gt;Issue resolved by pull request 273&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/273&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14941820" author="githubbot" created="Fri, 2 Oct 2015 21:46:30 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/273&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/273&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12855822">KAFKA-2431</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 7 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jsdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>junrao</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>