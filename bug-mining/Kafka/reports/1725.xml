<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:04:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2903] FileRecords.read doesn&apos;t handle size &gt; sizeInBytes when start is not zero</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2903</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;now the code is :&lt;br/&gt;
def read(position: Int, size: Int): FileMessageSet = &lt;/p&gt;
{
   ..... 
    new FileMessageSet(file,
                       channel,
                       start = this.start + position,
                       end = math.min(this.start + position + size, sizeInBytes()))
  }

&lt;p&gt;if this.start is not 0, the end is only the FileMessageSet&apos;s size, not the actually position of end position.&lt;br/&gt;
the end parameter should be:&lt;br/&gt;
 end = math.min(this.start + position + size, this.start+sizeInBytes())&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Update&lt;/b&gt; Problem still remains in FileRecords.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12916701">KAFKA-2903</key>
            <summary>FileRecords.read doesn&apos;t handle size &gt; sizeInBytes when start is not zero</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jkreps">Jay Kreps</assignee>
                                    <reporter username="pengwei">Pengwei</reporter>
                        <labels>
                    </labels>
                <created>Sat, 28 Nov 2015 01:27:50 +0000</created>
                <updated>Mon, 30 Oct 2017 18:09:27 +0000</updated>
                            <resolved>Mon, 30 Oct 2017 18:08:00 +0000</resolved>
                                    <version>0.10.2.0</version>
                    <version>0.11.0.0</version>
                    <version>1.0.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>log</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15046379" author="junrao" created="Tue, 8 Dec 2015 05:18:39 +0000"  >&lt;p&gt;Yes, the current logic is a bit confusing, but is correct. We create a FileMessageSet in two cases. The first case is when we create a LogSegment. In this case, FileMessageSet.start is always 0. The second case is when we want to generate a response to the fetch request. In this case, we are getting a slice from the FileMessageSet created in case one, which always has FileMessageSet.start as 0. That&apos;s why the code works. We never had a case that we need to create a slice from a FileMessageSet created in case (2). To make the code easier to understand, perhaps we can just get rid of this.start all together when calculating end. It would also be good to add a comment above FileMessageSet to make this clear. Do you want to submit a patch?&lt;/p&gt;</comment>
                            <comment id="15046561" author="pengwei" created="Tue, 8 Dec 2015 08:16:07 +0000"  >&lt;p&gt;Yes we can also add comment on it. &lt;br/&gt;
But if in the future version, someone need to use this read API will get error when using a slice  FileMessageSet.  so modify this code is better?&lt;br/&gt;
Because it is only one line of code, and add comment will use much word on it&lt;/p&gt;</comment>
                            <comment id="15048946" author="junrao" created="Wed, 9 Dec 2015 16:40:12 +0000"  >&lt;p&gt;Yes, I think that will be fine too.&lt;/p&gt;</comment>
                            <comment id="16224767" author="githubbot" created="Mon, 30 Oct 2017 11:45:28 +0000"  >&lt;p&gt;GitHub user ijuma opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4158&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2903&quot; title=&quot;FileRecords.read doesn&amp;#39;t handle size &amp;gt; sizeInBytes when start is not zero&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2903&quot;&gt;&lt;del&gt;KAFKA-2903&lt;/del&gt;&lt;/a&gt;: FileRecords.read doesn&apos;t handle size &amp;gt; sizeInBytes when start is not zero&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ijuma/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ijuma/kafka&lt;/a&gt; kafka-2903-file-records-read-slice-size-greater&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4158.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4158.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4158&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b251038e2c569fda88376b85918a5003927b8152&lt;br/&gt;
Author: Ismael Juma &amp;lt;ismael@juma.me.uk&amp;gt;&lt;br/&gt;
Date:   2017-10-30T11:45:00Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2903&quot; title=&quot;FileRecords.read doesn&amp;#39;t handle size &amp;gt; sizeInBytes when start is not zero&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2903&quot;&gt;&lt;del&gt;KAFKA-2903&lt;/del&gt;&lt;/a&gt;: FileRecords.read doesn&apos;t handle size &amp;gt; sizeInBytes when start is not zero&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16225456" author="hachikuji" created="Mon, 30 Oct 2017 18:08:00 +0000"  >&lt;p&gt;Issue resolved by pull request 4158&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/4158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4158&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16225460" author="githubbot" created="Mon, 30 Oct 2017 18:09:27 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4158&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 3 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2p0sv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>