<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:04:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6164] ClientQuotaManager threads prevent shutdown when encountering an error loading logs</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6164</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;While diagnosing &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6163&quot; title=&quot;Broker should fail fast on startup if an error occurs while loading logs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6163&quot;&gt;KAFKA-6163&lt;/a&gt;, we noticed that when the broker initiates a shutdown sequence in response to an error loading the logs, the process never exits. The JVM appears to be waiting indefinitely for several non-deamon threads to terminate.&lt;/p&gt;

&lt;p&gt;The threads in question are &lt;tt&gt;ThrottledRequestReaper-Request&lt;/tt&gt;, &lt;tt&gt;ThrottledRequestReaper-Produce&lt;/tt&gt;, and &lt;tt&gt;ThrottledRequestReaper-Fetch&lt;/tt&gt;, so it appears we don&apos;t properly shutdown &lt;tt&gt;ClientQuotaManager&lt;/tt&gt; in this situation.&lt;/p&gt;

&lt;p&gt;QuotaManager shutdown is currently handled by KafkaApis, however KafkaApis will never be instantiated in the first place if we encounter an error loading the logs, so quotamangers are left dangling in that case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13115775">KAFKA-6164</key>
            <summary>ClientQuotaManager threads prevent shutdown when encountering an error loading logs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rsivaram">Rajini Sivaram</assignee>
                                    <reporter username="xvrl">Xavier L&#233;aut&#233;</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Nov 2017 22:56:42 +0000</created>
                <updated>Wed, 15 Nov 2017 13:01:51 +0000</updated>
                            <resolved>Thu, 9 Nov 2017 19:23:21 +0000</resolved>
                                    <version>0.11.0.0</version>
                    <version>1.0.0</version>
                                    <fixVersion>1.0.1</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16236900" author="yuzhihong@gmail.com" created="Fri, 3 Nov 2017 00:56:00 +0000"  >&lt;p&gt;ThrottledRequestReaper extends ShutdownableThread where&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ShutdownableThread(val name: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, val isInterruptible: &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt; = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
        &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;(name) with Logging {
  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.setDaemon(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;should being daemon or not be passed to ShutdownableThread as a parameter ?&lt;/p&gt;</comment>
                            <comment id="16237977" author="xvrl" created="Fri, 3 Nov 2017 16:55:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ted_yu&quot; class=&quot;user-hover&quot; rel=&quot;ted_yu&quot;&gt;ted_yu&lt;/a&gt; that&apos;s certainly an option assuming we don&apos;t care about orderly shutdown of the quota manager. It would probably be nicer though to properly manage the quota manager lifecycle.&lt;/p&gt;</comment>
                            <comment id="16240282" author="githubbot" created="Mon, 6 Nov 2017 13:27:23 +0000"  >&lt;p&gt;GitHub user rajinisivaram opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4181&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4181&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6164&quot; title=&quot;ClientQuotaManager threads prevent shutdown when encountering an error loading logs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6164&quot;&gt;&lt;del&gt;KAFKA-6164&lt;/del&gt;&lt;/a&gt;: Shutdown quota managers if other components fail to start&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rajinisivaram/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rajinisivaram/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6164&quot; title=&quot;ClientQuotaManager threads prevent shutdown when encountering an error loading logs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6164&quot;&gt;&lt;del&gt;KAFKA-6164&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4181.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4181.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4181&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 9c11aa563fe320c60aa3d75b34d5d368bf0bad0b&lt;br/&gt;
Author: Rajini Sivaram &amp;lt;rajinisivaram@googlemail.com&amp;gt;&lt;br/&gt;
Date:   2017-11-06T10:49:21Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6164&quot; title=&quot;ClientQuotaManager threads prevent shutdown when encountering an error loading logs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6164&quot;&gt;&lt;del&gt;KAFKA-6164&lt;/del&gt;&lt;/a&gt;: Shutdown quota managers if other components fail to start&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16245806" author="githubbot" created="Thu, 9 Nov 2017 15:19:33 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4181&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4181&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16245931" author="githubbot" created="Thu, 9 Nov 2017 16:14:33 +0000"  >&lt;p&gt;GitHub user rajinisivaram opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4199&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4199&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6164&quot; title=&quot;ClientQuotaManager threads prevent shutdown when encountering an error loading logs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6164&quot;&gt;&lt;del&gt;KAFKA-6164&lt;/del&gt;&lt;/a&gt;; Shutdown quota managers if other components fail to start&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rajinisivaram/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rajinisivaram/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6164&quot; title=&quot;ClientQuotaManager threads prevent shutdown when encountering an error loading logs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6164&quot;&gt;&lt;del&gt;KAFKA-6164&lt;/del&gt;&lt;/a&gt;-1.0&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4199.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4199.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4199&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3a1c238165a0ec95bbfa6397dce5bd9776615c66&lt;br/&gt;
Author: Rajini Sivaram &amp;lt;rajinisivaram@googlemail.com&amp;gt;&lt;br/&gt;
Date:   2017-11-09T15:17:52Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6164&quot; title=&quot;ClientQuotaManager threads prevent shutdown when encountering an error loading logs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6164&quot;&gt;&lt;del&gt;KAFKA-6164&lt;/del&gt;&lt;/a&gt;; Shutdown quota managers if other components fail to start&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16246337" author="rsivaram" created="Thu, 9 Nov 2017 19:23:21 +0000"  >&lt;p&gt;Issue resolved by pull request 4199&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/4199&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4199&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16253414" author="githubbot" created="Wed, 15 Nov 2017 13:01:51 +0000"  >&lt;p&gt;Github user rajinisivaram closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4199&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4199&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mc5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>