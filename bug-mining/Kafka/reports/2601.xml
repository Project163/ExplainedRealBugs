<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:23:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9854] Re-authenticating causes mismatched parse of response</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9854</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;the schema of LIST_OFFSETS consists of&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;throttle_time_ms:INT32 and&lt;/li&gt;
	&lt;li&gt;responses:ARRAY&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;br/&gt;
 If throttle_time_ms is zero and size of responses is small enough, its binary is compatible to schema of SASL_HANDSHAKE composed of&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;error_code:INT16 and&lt;/li&gt;
	&lt;li&gt;mechanisms:ARRAY(STRING)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;br/&gt;
 Hence, there is no Schema error when SASL_HANDSHAKE tries to parse response of LIST_OFFSETS but the check of correction id throws IllegalStateException due to mismatched error. The IllegalStateException is NOT caught and the mismatched response is not sent back to Selector so the cascading error happens that all following responses are parsed by incorrect Schema.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13297895">KAFKA-9854</key>
            <summary>Re-authenticating causes mismatched parse of response</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chia7712">Chia-Ping Tsai</assignee>
                                    <reporter username="chia7712">Chia-Ping Tsai</reporter>
                        <labels>
                    </labels>
                <created>Sun, 12 Apr 2020 16:51:19 +0000</created>
                <updated>Fri, 8 Jan 2021 11:02:06 +0000</updated>
                            <resolved>Thu, 16 Apr 2020 12:32:31 +0000</resolved>
                                                    <fixVersion>2.5.1</fixVersion>
                    <fixVersion>2.6.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17081852" author="githubbot" created="Sun, 12 Apr 2020 16:53:04 +0000"  >&lt;p&gt;chia7712 commented on pull request #8471: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9854&quot; title=&quot;Re-authenticating causes mismatched parse of response&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9854&quot;&gt;&lt;del&gt;KAFKA-9854&lt;/del&gt;&lt;/a&gt; Re-authenticating causes mismatched parse of response&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8471&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8471&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   the schema of LIST_OFFSETS consists of &lt;/p&gt;

&lt;p&gt;   1. throttle_time_ms:INT32 and &lt;br/&gt;
   1. responses:ARRAY&lt;/p&gt;

&lt;p&gt;   If both are zero, it&#8217;s binary is compatible to schema of SASL_HANDSHAKE which is composed of &lt;/p&gt;

&lt;p&gt;   1. error_code:INT16 and &lt;br/&gt;
   1. mechanisms:ARRAY(STRING)&lt;/p&gt;

&lt;p&gt;   Hence, there is no Schema error when SASL_HANDSHAKE tries to parse resoponse of LIST_OFFSETS but the check of correction id still throw IllegalStateException due to mismatched parse. The IllegalStateException is NOT caught and it is not sent back to Selector so the cascading error happens that all following responses are parsed by incorrect Schema.&lt;/p&gt;

&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9854&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-9854&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17084822" author="githubbot" created="Thu, 16 Apr 2020 12:26:35 +0000"  >&lt;p&gt;rajinisivaram commented on pull request #8471: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9854&quot; title=&quot;Re-authenticating causes mismatched parse of response&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9854&quot;&gt;&lt;del&gt;KAFKA-9854&lt;/del&gt;&lt;/a&gt; Re-authenticating causes mismatched parse of response&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8471&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8471&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17261184" author="alexx_i" created="Fri, 8 Jan 2021 09:57:40 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chia7712&quot; class=&quot;user-hover&quot; rel=&quot;chia7712&quot;&gt;chia7712&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Does your PR fix issues like the one bellow?&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2021-01-07 10:46:33.751 DEBUG 1 --- [98-202f60784965] i.s.k.oauth.common.OAuthAuthenticator&#160; &#160; : loginWithClientSecret() - tokenEndpointUrl: https:&lt;span class=&quot;code-comment&quot;&gt;//sso-copo.apps.uat-ocp.bt.wan/auth/realms/copo/protocol/openid-connect/token, clientId: client-check-adaptor, clientSecret: c9b5**ecdd, scope: null2021-01-07 10:46:33.751 DEBUG 1 --- [98-202f60784965] i.s.k.oauth.common.OAuthAuthenticator&#160; &#160; : loginWithClientSecret() - tokenEndpointUrl: https://sso-copo/auth/realms/copo/protocol/openid-connect/token, clientId: client-check-adaptor, clientSecret: c9b5**ecdd, scope: null2021-01-07 10:46:33.788 DEBUG 1 --- [98-202f60784965] jdk.event.security&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;:&#160; TLSHandshake: sso-copo:443, TLSv1.2, TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256, -10307310322021-01-07 10:49:13.920&#160; WARN 1 --- [ntainer#0-1-C-1] o.apache.kafka.common.network.Selector&#160; &#160;: [Consumer clientId=consumer-client-check-adaptor-v2-&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;-8, groupId=client-check-adaptor-v2-&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;] Unexpected error from copo-kafka-0.copo-kafka-brokers.copo.svc/10.211.2.162; closing connection java.lang.IllegalStateException: Correlation id &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; response (213994) does not match request (0), request header: RequestHeader(apiKey=SASL_HANDSHAKE, apiVersion=1, clientId=, correlationId=0) at org.apache.kafka.clients.NetworkClient.correlate(NetworkClient.java:943) at org.apache.kafka.clients.NetworkClient.parseStructMaybeUpdateThrottleTimeMetrics(NetworkClient.java:726) at org.apache.kafka.clients.NetworkClient.parseResponse(NetworkClient.java:712) at org.apache.kafka.common.security.authenticator.SaslClientAuthenticator.receiveKafkaResponse(SaslClientAuthenticator.java:523) at org.apache.kafka.common.security.authenticator.SaslClientAuthenticator.authenticate(SaslClientAuthenticator.java:249) at org.apache.kafka.common.network.KafkaChannel.prepare(KafkaChannel.java:177) at org.apache.kafka.common.network.Selector.pollSelectionKeys(Selector.java:547) at org.apache.kafka.common.network.Selector.poll(Selector.java:485) at org.apache.kafka.clients.NetworkClient.poll(NetworkClient.java:549) at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.poll(ConsumerNetworkClient.java:262) at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.poll(ConsumerNetworkClient.java:233) at org.apache.kafka.clients.consumer.KafkaConsumer.pollForFetches(KafkaConsumer.java:1308) at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:1248) at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:1216) at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doPoll(KafkaMessageListenerContainer.java:1107) at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.pollAndInvoke(KafkaMessageListenerContainer.java:1063) at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.run(KafkaMessageListenerContainer.java:988) at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834) 2021-01-07 10:49:13.923 ERROR 1 --- [ntainer#0-1-C-1] essageListenerContainer$ListenerConsumer : Consumer exception java.lang.IllegalStateException: This error handler cannot process &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.kafka.common.protocol.types.SchemaException&apos;&lt;/span&gt;s; no record information is available at org.springframework.kafka.listener.SeekUtils.seekOrRecover(SeekUtils.java:151) at org.springframework.kafka.listener.SeekToCurrentErrorHandler.handle(SeekToCurrentErrorHandler.java:103) at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.handleConsumerException(KafkaMessageListenerContainer.java:1263) at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.run(KafkaMessageListenerContainer.java:1020) at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264) at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)Caused by: org.apache.kafka.common.protocol.types.SchemaException: Error reading field &lt;span class=&quot;code-quote&quot;&gt;&apos;responses&apos;&lt;/span&gt;: Error reading array of size 1431586882, only 5 bytes available at org.apache.kafka.common.protocol.types.Schema.read(Schema.java:110) at org.apache.kafka.common.protocol.ApiKeys.parseResponse(ApiKeys.java:313) at org.apache.kafka.clients.NetworkClient.parseStructMaybeUpdateThrottleTimeMetrics(NetworkClient.java:725) at org.apache.kafka.clients.NetworkClient.handleCompletedReceives(NetworkClient.java:839) at org.apache.kafka.clients.NetworkClient.poll(NetworkClient.java:558) at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.poll(ConsumerNetworkClient.java:262) at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.poll(ConsumerNetworkClient.java:233) at org.apache.kafka.clients.consumer.KafkaConsumer.pollForFetches(KafkaConsumer.java:1308) at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:1248) at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:1216) at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doPoll(KafkaMessageListenerContainer.java:1107) at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.pollAndInvoke(KafkaMessageListenerContainer.java:1063) at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.run(KafkaMessageListenerContainer.java:988) ... 3 common frames omitted&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Alex&lt;/p&gt;</comment>
                            <comment id="17261200" author="chia7712" created="Fri, 8 Jan 2021 10:22:13 +0000"  >&lt;p&gt;hi Alex&lt;/p&gt;

&lt;p&gt;Do you have sample code to reproduce that error?&lt;/p&gt;

&lt;p&gt;(I am off from my laptop. Will take a look at log later)&lt;/p&gt;</comment>
                            <comment id="17261205" author="alexx_i" created="Fri, 8 Jan 2021 10:29:40 +0000"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;I was not able to reproduce this. We have an OpenShift cluster with 3 instance Kafka installed using Strimzi Operator and OAUTHBEARER / SASL_PLAINTEXT security. This issue happens randomly for each consumer once every few hours / days. &lt;/p&gt;

&lt;p&gt;What is strange is that if I have 2 instance of the same application that consumes, the consumer group appears STABLE after this error, but the consumer no longer reads certain partitions.&lt;/p&gt;

&lt;p&gt;Any ideas on how to reproduce this or how to investigate further?&#160;&lt;/p&gt;

&lt;p&gt;Best regards,&lt;br/&gt;
Alex&lt;/p&gt;</comment>
                            <comment id="17261215" author="chia7712" created="Fri, 8 Jan 2021 10:44:22 +0000"  >&lt;p&gt;Could you share the Kafka version to me? client-side and server-side.&lt;/p&gt;</comment>
                            <comment id="17261219" author="alexx_i" created="Fri, 8 Jan 2021 10:51:23 +0000"  >&lt;p&gt;The latest Strimzi Operator creates brokers using the 2.6.0 version of Kafka.&lt;br/&gt;
For the clients we have Spring Boot applications that have Spring Kafka 2.5.4 that include kafka-clients 2.5.0.&lt;/p&gt;

&lt;p&gt;I am doing now tests with an overriden version using Spring Kafka 2.6 and kafka-clients 2.5.1 which should have your fix.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Alex&lt;/p&gt;</comment>
                            <comment id="17261225" author="chia7712" created="Fri, 8 Jan 2021 11:02:06 +0000"  >&lt;p&gt;Oh, I assumed your cluster had included this fix. Thanks for your sharing. I hope this fix can save your life &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
please feel free to open an new jira to report bug if this fix does not work for your case.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0djsw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rsivaram</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>