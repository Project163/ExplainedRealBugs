<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:36:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-557] Replica fetch thread doesn&apos;t need to recompute message id</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-557</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;With kafka-506, the leader broker computes the logical id for each message produced. This could involve decompressing and recompressing messages, which are expensive. When data is replicated from the leader to the follower, we could avoid recomputing the logical message id since it&apos;s the same.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12611020">KAFKA-557</key>
            <summary>Replica fetch thread doesn&apos;t need to recompute message id</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jkreps">Jay Kreps</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                            <label>bugs</label>
                    </labels>
                <created>Tue, 9 Oct 2012 16:34:17 +0000</created>
                <updated>Tue, 16 Oct 2012 04:28:30 +0000</updated>
                            <resolved>Mon, 15 Oct 2012 17:12:05 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="13473664" author="jkreps" created="Wed, 10 Oct 2012 23:16:00 +0000"  >&lt;p&gt;Attached is a patch that makes offset assignment by the log optional. This is a bit hacky since it adds more casewise logic into Log depending on who is assigning offsets.&lt;/p&gt;

&lt;p&gt;But with this patch now&lt;br/&gt;
1. It is not possible for the follower to assign different offsets than the leader&lt;br/&gt;
2. The follower log should be byte-for-byte identical to the leader&lt;/p&gt;

&lt;p&gt;A best effort is made to validate the offsets in the case that we are not assigning them, but this does not extend to actually decompressing the message set.&lt;/p&gt;</comment>
                            <comment id="13473716" author="jkreps" created="Wed, 10 Oct 2012 23:58:20 +0000"  >&lt;p&gt;I verified that this fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-562&quot; title=&quot;Non-failure System Test Log Segment File Checksums mismatched&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-562&quot;&gt;&lt;del&gt;KAFKA-562&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13473728" author="nehanarkhede" created="Thu, 11 Oct 2012 00:16:47 +0000"  >&lt;p&gt;1. Log&lt;/p&gt;

&lt;p&gt;1.1 Typos in description of analyzeAndValidateMessageSet&lt;br/&gt;
1.2  Wrap long lines in this file&lt;br/&gt;
1.3 In the append API, the offsets are first read into an offsets variable and then returned from outside the try catch block. Any reason why the flush and offsets are not inside the try block ? Also, to avoid Scala bugs, it might be better to turn the outer if-else into a case match since case match always evalues to a value. If it doesn&apos;t, the code doesn&apos;t compile&lt;/p&gt;

&lt;p&gt;2. LogTest&lt;/p&gt;

&lt;p&gt;2.1 Remove unused import&lt;br/&gt;
2.2 It looks like the expected value in the following assertEquals is log.logEndOffset ? If yes, it should be the first argument&lt;br/&gt;
      assertEquals(last + 1, log.logEndOffset)&lt;br/&gt;
2.3 In the following assertTrue, should we be using sizeInBytes instead ?&lt;br/&gt;
      assertTrue(log.read(5, 64*1024).size &amp;gt; 0)&lt;br/&gt;
2.4 Does it make sense to check that the offsets of the message set read from the log ?&lt;/p&gt;</comment>
                            <comment id="13473790" author="jkreps" created="Thu, 11 Oct 2012 02:32:43 +0000"  >&lt;p&gt;1.1 Fixed&lt;br/&gt;
1.2 The long lines are due to use of String.format() which requires a single string to format. Breaking the lines is going to be uglier as they need to move to +.&lt;br/&gt;
1.3 The intention is to move the flush out of the synchronized block. I don&apos;t know who put that in there, but that is not good, since that is likely the slowest thing we are doing and has no need for synchronization. You raise a good point which is that the flush might throw an IOException, so it should be in the try catch. I reversed the order of the try/catch to fix this issue. With respect to using match instead of if/else, I disagree with that. if/else reads as english. I see us using match statements for simple if/else switches on boolean variables and I think it is pretty nasty.&lt;/p&gt;

&lt;p&gt;2.1 I don&apos;t have IDEA so I can&apos;t do that.&lt;br/&gt;
2.2 No, how I have it is right. I am asserting that the logEndOffset is properly updated. I will add a test description to make that more clear.&lt;br/&gt;
2.3 Basically I am checking that we read something. Cleaned this up to make it more readable.&lt;br/&gt;
2.4 Unfortunately there isn&apos;t a simple test that is easy to implement. One unfortunate thing is that we implemented the shallow/deep iterator logic in ByteBufferMessageSet not in MessageSet so at this layer I ONLY have access to the wrapper message in the compressed case. There isn&apos;t a very meaning thing to say about the offset as a result. Instead the test I am doing is just that I can read something at offset 5 (which would not be true if the offsets had been reassigned by the log).&lt;/p&gt;</comment>
                            <comment id="13473822" author="nehanarkhede" created="Thu, 11 Oct 2012 04:13:58 +0000"  >&lt;p&gt;1.2 Understand, but that&apos;s what we&apos;ve been following throughout the code. If you want to propose a different line wrapping convention, let&apos;s discuss that to keep things consistent.&lt;br/&gt;
1.3 Agree that all if/else with simple boolean statements shouldn&apos;t be replaced by case-match. I was specifically referring to if-else statements that are meant to evaluate to a certain value. In such scenarios, case-match guarantees evaluation to a value unlike if-else, so it is safer. However, that is just my preference, you can keep it if you disagree.&lt;/p&gt;

&lt;p&gt;Latest patch looks good otherwise. &lt;/p&gt;</comment>
                            <comment id="13474345" author="jkreps" created="Thu, 11 Oct 2012 17:31:14 +0000"  >&lt;p&gt;Oh man, you are a tough reviewer:&lt;br/&gt;
1.2 The coding guide says &quot;There is not a maximum line length (certainly not 80 characters, we don&apos;t work on punch cards any more), but be reasonable.&quot;  I guess I just think that given the code fits on a 2008 laptop screen that is reasonable &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
1.3 Yeah, I agree it is a matter of different taste.&lt;/p&gt;</comment>
                            <comment id="13474346" author="nehanarkhede" created="Thu, 11 Oct 2012 17:31:24 +0000"  >&lt;p&gt;+1 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12548689" name="KAFKA-557.patch" size="10826" author="jkreps" created="Thu, 11 Oct 2012 02:34:36 +0000"/>
                            <attachment id="12548661" name="KAFKA-557.patch" size="10826" author="jkreps" created="Wed, 10 Oct 2012 23:16:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>246193</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i07i1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>41692</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>