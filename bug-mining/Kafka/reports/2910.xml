<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:26:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-12323] Record timestamps not populated in event</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-12323</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Upgraded a kafka streams application from 2.6.0 to 2.7.0. Noticed that the events being produced had a &quot;CreatedAt&quot; timestamp = 0, causing downstream failures as we depend on those timestamps. Reverting back to 2.6.0/2.6.1 fixed this issue. This was the only change to the Kafka Streams application.&lt;/p&gt;

&lt;p&gt;Consuming the event stream produced by 2.6.0 results in events that, when consumed using the `kafka-avro-console-consumer` and `--property print.timestamp=true` result in events prepended with the event times, such as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CreateTime:1613072202271 &amp;lt;key&amp;gt; &amp;lt;value&amp;gt;
CreateTime:1613072203412 &amp;lt;key&amp;gt; &amp;lt;value&amp;gt;
CreateTime:1613072205431 &amp;lt;key&amp;gt; &amp;lt;value&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;etc.&lt;/p&gt;

&lt;p&gt;However, when those events are produced by the Kafka Streams app using 2.7.0, we get:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CreateTime:0 &amp;lt;key&amp;gt; &amp;lt;value&amp;gt;
CreateTime:0 &amp;lt;key&amp;gt; &amp;lt;value&amp;gt;
CreateTime:0 &amp;lt;key&amp;gt; &amp;lt;value&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I don&apos;t know if these is a default value somewhere that changed, but this is actually a blocker for our use-cases as we now need to circumnavigate this limitation (or roll back to 2.6.1, though there are other issues we must deal with then). I am not sure which unit tests in the code base to look at to validate this, but I wanted to log this bug now in case someone else has already seen this or an open one exists (I didn&apos;t see one though).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13358225">KAFKA-12323</key>
            <summary>Record timestamps not populated in event</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guozhang">Guozhang Wang</assignee>
                                    <reporter username="abellemare">Adam Bellemare</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Feb 2021 19:59:33 +0000</created>
                <updated>Mon, 12 Apr 2021 23:04:07 +0000</updated>
                            <resolved>Wed, 24 Feb 2021 04:42:48 +0000</resolved>
                                    <version>2.7.0</version>
                                    <fixVersion>2.7.1</fixVersion>
                    <fixVersion>2.8.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17283378" author="ableegoldman" created="Thu, 11 Feb 2021 21:06:05 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abellemare&quot; class=&quot;user-hover&quot; rel=&quot;abellemare&quot;&gt;abellemare&lt;/a&gt;, thanks for reporting. I&apos;m not personally aware of any changes that might have caused this but maybe it will ring a bell for someone else. But I did want to ask:&lt;/p&gt;

&lt;p&gt;1) can you include a minimal example to reproduce?&lt;br/&gt;
2) can you try reading the events produced by 2.7.0 Streams using a 2.6.1&#160;kafka-avro-console-consumer, so we can rule out a regression there?&lt;/p&gt;</comment>
                            <comment id="17283409" author="abellemare" created="Thu, 11 Feb 2021 22:04:39 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;I am trying to reproduce it all on Kafka 2.7.0 using the basic producer and consumer, writing from the console without any keys. At the moment I cannot reproduce it. &lt;/p&gt;

&lt;p&gt;My environment has different versions for the broker, the consumer, and the producer, so I&apos;m going to have to take a closer look at that. Additionally, the producer is using Kafka Streams (2.6.1 and 2.7.0), whereas the consumer is just Confluent 5.5.0 console clients (both Avro client and non-Avro client result in the missing value). I will add more information when I can either successfully reproduce it, or give up trying.&lt;/p&gt;</comment>
                            <comment id="17283909" author="abellemare" created="Fri, 12 Feb 2021 18:49:52 +0000"  >&lt;p&gt;Alright, I think I found source of the 0 timestamp assignment:&lt;/p&gt;

&lt;p&gt;This is returning a 0 timestamp for a punctuation-created event. &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/blob/2.7/streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorContextImpl.java#L169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/2.7/streams/src/main/java/org/apache/kafka/streams/processor/internals/ProcessorContextImpl.java#L169&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It calls through to AbstractProcessorContextImpl, which executes this and returns 0L for every punctuated event.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/blob/2.7/streams/src/main/java/org/apache/kafka/streams/processor/internals/AbstractProcessorContext.java#L176&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/2.7/streams/src/main/java/org/apache/kafka/streams/processor/internals/AbstractProcessorContext.java#L176&lt;/a&gt;&lt;br/&gt;
I have observed that this will always assign 0L for the timestamp, because &lt;b&gt;recordContext&lt;/b&gt; is always null for this processor.&lt;/p&gt;



&lt;p&gt;I noticed that I am adding the processor through a now-deprecated &lt;b&gt;addProcessor&lt;/b&gt; API call. I suspect that the deprecation change is responsible for the bug:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
topology
  &lt;span class=&quot;code-comment&quot;&gt;//This addProcessor call is deprecated.
&lt;/span&gt; .addProcessor(progressProcessorName,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;punctuationProcessor(...),
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;sinkEventsName)
 .addSink(&lt;span class=&quot;code-quote&quot;&gt;&quot;progressSink&quot;&lt;/span&gt;,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;topicName&quot;&lt;/span&gt;,
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; serdeFactory.serde(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).serializer(),
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; serdeFactory.progressEventSerde().serializer(),
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; progressProcessorName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have attached the code (&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13020411/13020411_PunctuateTimestampZeroTest.java&quot; title=&quot;PunctuateTimestampZeroTest.java attached to KAFKA-12323&quot;&gt;PunctuateTimestampZeroTest.java&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; that illustrates the error. You can run it as an integration test in Kafka (you will have to disable warnings-as-errors (Werror) from build.gradle, as it will fail because I am using a deprecated function).&lt;/p&gt;

&lt;p&gt;I don&apos;t think this is a blocker because I suspect I can work around it with the non-deprecated function. It is, however, quite major, as a person can upgrade their code and have this happen without noticing. It&apos;s particularly insidious as it may cause downstream tasks that rely on the timestamp to silently fail (as is what happened to me). &lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#cc7832&quot;&gt;&#160;&lt;/font&gt;&lt;/p&gt;</comment>
                            <comment id="17284969" author="mjsax" created="Mon, 15 Feb 2021 22:41:58 +0000"  >&lt;p&gt;To me, setting zero as default timestamp is highly questionable... We should either throw an exception to force people to set a timestamp, or maybe use `stream-time` as default? \cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vvcephei&quot; class=&quot;user-hover&quot; rel=&quot;vvcephei&quot;&gt;vvcephei&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17286016" author="guozhang" created="Wed, 17 Feb 2021 17:35:38 +0000"  >&lt;p&gt;I checked the source code between 2.6 and trunk, and I think there&apos;s indeed a regression: for old API, the behavior is not actually &quot;For timestamp, the dummy value is `0L`.&quot; Instead, it would just keep the processor context passed in through the punctuator, and that would carry the timestamp of either stream time or system time depending on the punctuation type. What&apos;s worse, is that even if using the new API this regression seems still persist.&lt;/p&gt;

&lt;p&gt;I think we should fix `StreamTask.punctuate` that when calling `updateProcessorContext`, we should create a recordContext with the timestamp passed into it instead of passing null.&lt;/p&gt;</comment>
                            <comment id="17286052" author="mjsax" created="Wed, 17 Feb 2021 18:20:08 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;. SGTM. &#8211; Are we sure that we want to use current wall-clock time as default timestamp for output records of wall-clock time punctuations? I am ok with it, just wanted to double check. Using current stream-time as default timestamp for output records for both punctuation types seems like a sound alternative approach.&lt;/p&gt;

&lt;p&gt;As it is a regression, I am tagging this a blocker for 2.8.0 and 2.7.1 release. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abellemare&quot; class=&quot;user-hover&quot; rel=&quot;abellemare&quot;&gt;abellemare&lt;/a&gt;&#160;are you interested picking it up?&lt;/p&gt;</comment>
                            <comment id="17287100" author="abellemare" created="Fri, 19 Feb 2021 14:46:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt;Sure, I can pick it up - though I won&apos;t likely be able to start work on it until the beginning of next week (eg: Feb 22-23).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13370697">KAFKA-12643</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13020411" name="PunctuateTimestampZeroTest.java" size="6705" author="abellemare" created="Fri, 12 Feb 2021 17:50:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nlyg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>