<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:02:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5477] TransactionalProducer sleeps unnecessarily long during back to back transactions</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5477</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I am running some perf tests for EOS and there is a severe perf impact with our default configs. &lt;/p&gt;

&lt;p&gt;Here is the issue.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;When we do a commit transaction, the producer sends an `EndTxn` request to the coordinator. The coordinator writes the `PrepareCommit` message to the transaction log and then returns the response the client. It writes the transaction markers and the final &apos;CompleteCommit&apos; message asynchronously.&lt;/li&gt;
	&lt;li&gt;In the mean time, if the client starts another transaction, it will send an `AddPartitions` request on the next `Sender.run` loop. If the markers haven&apos;t been written yet, then the coordinator will return a retriable `CONCURRENT_TRANSACTIONS` error to the client.&lt;/li&gt;
	&lt;li&gt;The current behavior in the producer is to sleep for `retryBackoffMs` before retrying the request. The current default for this is 100ms. So the producer will sleep for 100ms before sending the `AddPartitions` again. This puts a floor on the latency for back to back transactions.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The impact: Back to back transactions (the typical usecase for streams) would have a latency floor of 100ms.&lt;/p&gt;

&lt;p&gt;Ideally, we don&apos;t want to sleep the full 100ms  in this particular case, because the retry is &apos;expected&apos;.&lt;/p&gt;

&lt;p&gt;The options are: &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;do nothing, let streams override the retry.backoff.ms in their producer to 10 when EOS is enabled (since they have a HOTFIX patch out anyway).&lt;/li&gt;
	&lt;li&gt;Introduce a special &apos;transactionRetryBackoffMs&apos; non-configurable variable and hard code that to a low value which applies to all transactional requests.&lt;/li&gt;
	&lt;li&gt;do nothing and fix it properly in 0.11.0.1&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Option 2 as stated is a 1 line fix. If we want to lower the retry just for this particular error, it would be a slightly bigger change (10-15 lines).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13080969">KAFKA-5477</key>
            <summary>TransactionalProducer sleeps unnecessarily long during back to back transactions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="apurva">Apurva Mehta</assignee>
                                    <reporter username="apurva">Apurva Mehta</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Jun 2017 00:14:14 +0000</created>
                <updated>Wed, 21 Jun 2017 18:02:00 +0000</updated>
                            <resolved>Wed, 21 Jun 2017 18:01:00 +0000</resolved>
                                    <version>0.11.0.0</version>
                                    <fixVersion>0.11.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16054989" author="githubbot" created="Tue, 20 Jun 2017 00:38:15 +0000"  >&lt;p&gt;GitHub user apurvam opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3377&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5477&quot; title=&quot;TransactionalProducer sleeps unnecessarily long during back to back transactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5477&quot;&gt;&lt;del&gt;KAFKA-5477&lt;/del&gt;&lt;/a&gt;: Lower retryBackoff for AddPartitionsRequest&lt;/p&gt;

&lt;p&gt;    This patch lowers the retry backoff when receiving a CONCURRENT_TRANSACTIONS error from an AddPartitions request. The default of 100ms would mean that back to back transactions would be 100ms long at minimum, making things to slow.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/apurvam/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apurvam/kafka&lt;/a&gt; HOTFIX-lower-retry-for-add-partitions&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3377.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3377.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3377&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0d676688e7ed9a8d63189eb704143e62752707cc&lt;br/&gt;
Author: Apurva Mehta &amp;lt;apurva@confluent.io&amp;gt;&lt;br/&gt;
Date:   2017-06-20T00:36:28Z&lt;/p&gt;

&lt;p&gt;    Lower retryBackoff when receiving a CONCURRENT_TRANSACTIONS error from an AddPartitions request&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16057934" author="hachikuji" created="Wed, 21 Jun 2017 18:01:00 +0000"  >&lt;p&gt;Issue resolved by pull request 3377&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/3377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3377&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16057936" author="githubbot" created="Wed, 21 Jun 2017 18:02:00 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3377&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3377&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 21 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ggvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>