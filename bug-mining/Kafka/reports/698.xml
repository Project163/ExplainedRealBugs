<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:43:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2012] Broker should automatically handle corrupt index files</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2012</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We had a bunch of unclean system shutdowns (power failure), which caused corruption on our disks holding log segments in many cases. While the broker is handling the log segment corruption properly (truncation), it is having problems with corruption in the index files. Additionally, this only seems to be happening on some startups (while we are upgrading).&lt;/p&gt;

&lt;p&gt;The broker should just do what I do when I hit a corrupt index file - remove it and rebuild it.&lt;/p&gt;

&lt;p&gt;2015/03/09 17:58:53.873 FATAL &lt;span class=&quot;error&quot;&gt;&amp;#91;KafkaServerStartable&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-server&amp;#93;&lt;/span&gt; [] Fatal error during KafkaServerStartable startup. Prepare to shutdown&lt;br/&gt;
java.lang.IllegalArgumentException: requirement failed: Corrupt index found, index file (/export/content/kafka/i001_caches/__consumer_offsets-39/00000000000000000000.index) has non-zero size but the last offset is -2121629628 and the base offset is 0&lt;br/&gt;
	at scala.Predef$.require(Predef.scala:233)&lt;br/&gt;
	at kafka.log.OffsetIndex.sanityCheck(OffsetIndex.scala:352)&lt;br/&gt;
	at kafka.log.Log$$anonfun$loadSegments$5.apply(Log.scala:185)&lt;br/&gt;
	at kafka.log.Log$$anonfun$loadSegments$5.apply(Log.scala:184)&lt;br/&gt;
	at scala.collection.Iterator$class.foreach(Iterator.scala:727)&lt;br/&gt;
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1157)&lt;br/&gt;
	at scala.collection.IterableLike$class.foreach(IterableLike.scala:72)&lt;br/&gt;
	at scala.collection.AbstractIterable.foreach(Iterable.scala:54)&lt;br/&gt;
	at kafka.log.Log.loadSegments(Log.scala:184)&lt;br/&gt;
	at kafka.log.Log.&amp;lt;init&amp;gt;(Log.scala:82)&lt;br/&gt;
	at kafka.log.LogManager$$anonfun$loadLogs$2$$anonfun$3$$anonfun$apply$7$$anonfun$apply$1.apply$mcV$sp(LogManager.scala:141)&lt;br/&gt;
	at kafka.utils.Utils$$anon$1.run(Utils.scala:54)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12780590">KAFKA-2012</key>
            <summary>Broker should automatically handle corrupt index files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="omkreddy">Manikumar</assignee>
                                    <reporter username="toddpalino">Todd Palino</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Mar 2015 19:48:50 +0000</created>
                <updated>Fri, 7 Oct 2016 16:58:49 +0000</updated>
                            <resolved>Fri, 19 Jun 2015 16:34:56 +0000</resolved>
                                    <version>0.8.1.1</version>
                                    <fixVersion>0.9.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14587777" author="omkreddy" created="Tue, 16 Jun 2015 09:57:59 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/35503/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/35503/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14593418" author="omkreddy" created="Fri, 19 Jun 2015 13:28:25 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/35503/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/35503/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14593496" author="junrao" created="Fri, 19 Jun 2015 15:09:43 +0000"  >&lt;p&gt;The latest patch looks good to me. Could you rebase since we just committed &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1646&quot; title=&quot;Improve consumer read performance for Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1646&quot;&gt;&lt;del&gt;KAFKA-1646&lt;/del&gt;&lt;/a&gt;? Thanks,&lt;/p&gt;</comment>
                            <comment id="14593535" author="omkreddy" created="Fri, 19 Jun 2015 15:42:44 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/35503/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/35503/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14593601" author="junrao" created="Fri, 19 Jun 2015 16:34:56 +0000"  >&lt;p&gt;Thanks for the latest patch. +1 and committed to trunk.&lt;/p&gt;</comment>
                            <comment id="14593812" author="mgharat" created="Fri, 19 Jun 2015 19:10:35 +0000"  >&lt;p&gt;Discussed this with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjkoshy&quot; class=&quot;user-hover&quot; rel=&quot;jjkoshy&quot;&gt;jjkoshy&lt;/a&gt;. This patch seems like a workaround and does not actually tell us why the file got corrupted in first place. We can probably have a config that can turn this code path ON or OFF, so that we can actually investigate when this happens. &lt;br/&gt;
Let me know, I can open another ticket or use this : &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1554&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-1554&lt;/a&gt; to add that config.&lt;/p&gt;

&lt;p&gt;This was discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1554&quot; title=&quot;Corrupt index found on clean startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1554&quot;&gt;&lt;del&gt;KAFKA-1554&lt;/del&gt;&lt;/a&gt; :&lt;/p&gt;

&lt;p&gt;Joel Koshy added a comment - 14/Mar/15 01:10&lt;br/&gt;
That would be a work-around, but ideally we should figure out why it happened in the first place.&lt;/p&gt;

&lt;p&gt; Jun Rao added a comment - 09/Apr/15 02:06&lt;br/&gt;
Yes, I am not sure if auto fixing the index is better. People then may not realize if there is an issue. It would be better to figure out what&apos;s causing this.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Mayuresh&lt;/p&gt;</comment>
                            <comment id="14593953" author="junrao" created="Fri, 19 Jun 2015 21:00:56 +0000"  >&lt;p&gt;I am not sure if it&apos;s better to add another config. Perhaps, we can just save the corrupted file as Gwen suggested in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1554&quot; title=&quot;Corrupt index found on clean startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1554&quot;&gt;&lt;del&gt;KAFKA-1554&lt;/del&gt;&lt;/a&gt; for trouble shooting.&lt;/p&gt;</comment>
                            <comment id="14594420" author="omkreddy" created="Sat, 20 Jun 2015 05:56:13 +0000"  >&lt;p&gt;I am not sure if we can find out the reason after file corruption. i,e  What we can infer from a corrupted file? &lt;br/&gt;
instead we should  add some defensive code/logs before and after index reads/writes. looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1554&quot; title=&quot;Corrupt index found on clean startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1554&quot;&gt;&lt;del&gt;KAFKA-1554&lt;/del&gt;&lt;/a&gt; got some steps to reproduce the issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12728622">KAFKA-1554</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12728622">KAFKA-1554</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12739834" name="KAFKA-2012.patch" size="3559" author="omkreddy" created="Tue, 16 Jun 2015 09:57:51 +0000"/>
                            <attachment id="12740646" name="KAFKA-2012_2015-06-19_18:55:11.patch" size="3894" author="omkreddy" created="Fri, 19 Jun 2015 13:28:17 +0000"/>
                            <attachment id="12740666" name="KAFKA-2012_2015-06-19_21:09:22.patch" size="4079" author="omkreddy" created="Fri, 19 Jun 2015 15:42:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 22 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26j9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>