<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:33:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-15243] User creation mismatch</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-15243</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We found the Kafka users were not created properly, so let&apos;s suppose we create the user &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;mailto:myuser@myuser.com&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;myuser@myuser.com&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/mail_small.gif&quot; height=&quot;12&quot; width=&quot;13&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;COMMAND:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/etc/new_kafka/bin/kafka-configs.sh &#160;--bootstrap-server localhost:9092 --alter --add-config &lt;span class=&quot;code-quote&quot;&gt;&apos;SCRAM-SHA-256=[iterations=4096,password=blabla],SCRAM-SHA-256=[password=blabla]&apos;&lt;/span&gt; --entity-type users --entity-name myuser@myuser.com&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;RESPONSE:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Completed updating config &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; user myuser@myuser.com&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When listing the users I see the user was created as an encoded string&lt;/p&gt;

&lt;p&gt;COMMAND&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
kafka-configs.sh --bootstrap-server localhost:9092 --describe --entity-type users|grep myuser &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;RESPONSE&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SCRAM credential configs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; user-principal &lt;span class=&quot;code-quote&quot;&gt;&apos;myuser%40myuser.com&apos;&lt;/span&gt; are SCRAM-SHA-256=iterations=8192, SCRAM-SHA-512=iterations=4096 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So basically the user is being &quot;sanitized&quot; and giving a false OK to the user requester. The user requested does not exist as it should, it creates the encoded one instead.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I dug deep in the code until I found this is happening in the ZkAdminManager.scala in this line&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
adminZkClient.changeConfigs(ConfigType.User, Sanitizer.sanitize(user), configsByPotentiallyValidUser(user)) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So removing the Sanitizer fix the problem, but I have a couple of doubts&lt;/p&gt;

&lt;p&gt;I checked we Sanitize because of some JMX metrics, but in this case I don&apos;t know if this is really needed, supossing this is needed I think we should forbid to create users with characters that will be encoded.&lt;/p&gt;

&lt;p&gt;Even worse after creating an user in general we create ACLs and they are created properly without encoding the characters, this creates a mismatch between the user and the ACLs.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So I can work on fixing this, but I think we need to decide :&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A) We forbid to create users with characters that will be encoded, so we fail in the user creation step.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;B) We allow the user creation with special characters and remove the Sanitizer.sanitize(user) from the 2 places where it shows up in the file ZkAdminManager.scala&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;And of course if we go for B we need to create the tests.&lt;/p&gt;

&lt;p&gt;Please let me know what you think and i can work on it&lt;/p&gt;</description>
                <environment></environment>
        <key id="13544677">KAFKA-15243</key>
            <summary>User creation mismatch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sergio_troiano@hotmail.com">Sergio Troiano</assignee>
                                    <reporter username="sergio_troiano@hotmail.com">Sergio Troiano</reporter>
                        <labels>
                            <label>kafka-source</label>
                    </labels>
                <created>Mon, 24 Jul 2023 16:33:57 +0000</created>
                <updated>Fri, 18 Aug 2023 01:50:26 +0000</updated>
                            <resolved>Wed, 26 Jul 2023 13:49:32 +0000</resolved>
                                    <version>3.3.2</version>
                                    <fixVersion>3.4.2</fixVersion>
                    <fixVersion>3.5.2</fixVersion>
                    <fixVersion>3.6.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17746544" author="JIRAUSER298332" created="Mon, 24 Jul 2023 17:10:32 +0000"  >&lt;p&gt;Does this happen with KRaft?&lt;/p&gt;</comment>
                            <comment id="17746546" author="JIRAUSER285632" created="Mon, 24 Jul 2023 17:18:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pprovenzano&quot; class=&quot;user-hover&quot; rel=&quot;pprovenzano&quot;&gt;pprovenzano&lt;/a&gt; we don&apos;t use KRaft yet, so this is happening right before this the new user is registered in ZK. (ZKclient)&lt;/p&gt;

&lt;p&gt;So I know ZK will be fully deprecated in Version 4 but I still consider this can be easily fixed&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17746624" author="JIRAUSER298332" created="Mon, 24 Jul 2023 19:54:04 +0000"  >&lt;p&gt;I just want to make sure that it works the same in both Zk and KRaft after the fix. &lt;/p&gt;</comment>
                            <comment id="17746794" author="omkreddy" created="Tue, 25 Jul 2023 06:24:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sergio_troiano%40hotmail.com&quot; class=&quot;user-hover&quot; rel=&quot;sergio_troiano@hotmail.com&quot;&gt;sergio_troiano@hotmail.com&lt;/a&gt;&#160; We sanitize the names because some characters are not allowed in Zookeeper paths. We sanitize the names using `Sanitizer.sanitize(user)` before storing in ZK and use `Sanitizer.desanitize` after reading from ZK.&lt;br/&gt;
In this case, it looks like a bug when calling describe all user scram configs (`--entity-type users`). We are returning sanitized names in the response&#160; here &lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/server/ZkAdminManager.scala#L851&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/server/ZkAdminManager.scala#L851&lt;/a&gt; . We should rerun desanitized names&lt;/p&gt;</comment>
                            <comment id="17746843" author="JIRAUSER285632" created="Tue, 25 Jul 2023 08:28:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omkreddy&quot; class=&quot;user-hover&quot; rel=&quot;omkreddy&quot;&gt;omkreddy&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks for the quick reply,One more comment, long time ago when we were running old Kafka version I saw the users were able to create the users with &quot;@&quot; and they re still present in ZK, it seems at some point we added the Sanitizer and this broke compatibility. but this is just a detail.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For us the current bug is a problem as we have an API to allow the clients to manage their users, the problem is we rely on listing them to check if they exist, so for example if you create user@user and then you want to change the password we first check if it exists and then we have the problem.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I will send the PR. Should I create a KIP for this? or can I send the PR here as it is a quick change ? cheers&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17746952" author="omkreddy" created="Tue, 25 Jul 2023 12:03:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sergio_troiano%40hotmail.com&quot; class=&quot;user-hover&quot; rel=&quot;sergio_troiano@hotmail.com&quot;&gt;sergio_troiano@hotmail.com&lt;/a&gt; This doesn&apos;t require KIP. This is broker side bug. we can just return desanitized names&lt;/p&gt;</comment>
                            <comment id="17746994" author="JIRAUSER285632" created="Tue, 25 Jul 2023 13:16:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omkreddy&quot; class=&quot;user-hover&quot; rel=&quot;omkreddy&quot;&gt;omkreddy&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;OK, I will open a PR, is that ok?&lt;/p&gt;</comment>
                            <comment id="17747010" author="omkreddy" created="Tue, 25 Jul 2023 13:48:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sergio_troiano%40hotmail.com&quot; class=&quot;user-hover&quot; rel=&quot;sergio_troiano@hotmail.com&quot;&gt;sergio_troiano@hotmail.com&lt;/a&gt; Yes, Please open a PR.&#160;&lt;/p&gt;</comment>
                            <comment id="17747081" author="JIRAUSER285632" created="Tue, 25 Jul 2023 17:21:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omkreddy&quot; class=&quot;user-hover&quot; rel=&quot;omkreddy&quot;&gt;omkreddy&lt;/a&gt; , thanks, PR open&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/14094&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/14094&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1jcag:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>