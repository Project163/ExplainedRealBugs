<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:26:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-7987] a broker&apos;s ZK session may die on transient auth failure</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-7987</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;After a transient network issue, we saw the following log in a broker.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[23:37:02,102] ERROR SASL authentication with Zookeeper Quorum member failed: javax.security.sasl.SaslException: An error: (java.security.PrivilegedActionException: javax.security.sasl.SaslException: GSS initiate failed [Caused by GSSException: No valid credentials provided (Mechanism level: Server not found in Kerberos database (7))]) occurred when evaluating Zookeeper Quorum Member&apos;s received SASL token. Zookeeper Client will go to AUTH_FAILED state. (org.apache.zookeeper.ClientCnxn)
[23:37:02,102] ERROR [ZooKeeperClient] Auth failed. (kafka.zookeeper.ZooKeeperClient)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The network issue prevented the broker from communicating to ZK. The broker&apos;s ZK session&#160;then&#160;expired, but the broker&#160;didn&apos;t know that yet since it couldn&apos;t establish a connection to ZK. When the network was back, the broker tried to establish a connection to ZK, but failed due to auth failure (likely due to a transient KDC issue). The current logic just ignores the auth failure without trying to create a new ZK session. Then the broker will be permanently in a state that it&apos;s alive, but not registered in ZK.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13217523">KAFKA-7987</key>
            <summary>a broker&apos;s ZK session may die on transient auth failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Feb 2019 20:15:44 +0000</created>
                <updated>Wed, 4 Nov 2020 19:59:02 +0000</updated>
                            <resolved>Wed, 4 Nov 2020 19:59:02 +0000</resolved>
                                                    <fixVersion>2.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16775565" author="junrao" created="Fri, 22 Feb 2019 20:18:43 +0000"  >&lt;p&gt;One potential way to fix this is to handle auth failure in&#160;ZooKeeperClient in the same way as session expiration by constantly retrying establishing the connection until success.&lt;/p&gt;</comment>
                            <comment id="16967790" author="gcampbell" created="Tue, 5 Nov 2019 19:10:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; We&apos;re starting to see these errors more frequently (guess our network is getting less reliable), so I&apos;m looking at a fix for this. Does scheduling a reinitialize() in the ZookeeperClient after notifying handlers seem like a reasonable solution? I don&apos;t see a way to get more details from the ZK client to try to tell if the auth failure was caused by a retriable error or not.&lt;/p&gt;</comment>
                            <comment id="16967806" author="junrao" created="Tue, 5 Nov 2019 19:25:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gcampbell&quot; class=&quot;user-hover&quot; rel=&quot;gcampbell&quot;&gt;gcampbell&lt;/a&gt;, we could try calling scheduleSessionExpiryHandler() in&#160;ZooKeeperClientWatcher.process() when authentication fails. We have to think a bit more whether we still need&#160;StateChangeHandler.onAuthFailure() or not.&lt;/p&gt;</comment>
                            <comment id="16983015" author="githubbot" created="Tue, 26 Nov 2019 23:31:33 +0000"  >&lt;p&gt;parafiend commented on pull request #7751: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7987&quot; title=&quot;a broker&amp;#39;s ZK session may die on transient auth failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7987&quot;&gt;&lt;del&gt;KAFKA-7987&lt;/del&gt;&lt;/a&gt;: Reinitialize ZookeeperClient after auth failures&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7751&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7751&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Schedule a client reinitialization after encountering a Zookeeper auth&lt;br/&gt;
   failure. This allows for reconnections when transient network errors are&lt;br/&gt;
   encountered during connection establishment.&lt;/p&gt;

&lt;p&gt;   The Zookeeper client doesn&apos;t expose details of the auth failure so we&lt;br/&gt;
   can&apos;t determine whether an error is retriable or not, so all auth&lt;br/&gt;
   failures are retried.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   Tested in a local docker environment by using iptables to block communication with ZK and Kerberos nodes. With this change, after auth failure due to Kerberos timeout, client continued retrying until communication was reopened and connection successfully re-established.&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17221328" author="rsivaram" created="Tue, 27 Oct 2020 11:29:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; This is still an open issue for all versions of Kafka, right? I am looking into an authorizer issue where authorizer notifications were not processed for a long time. Heap dump shows that the authorizer&apos;s ZookeeperClient is in AUTH_FAILED state. ZK is Kerberos-enabled and there are a couple of authentication failures in the logs due to clock-skew errors, which look like the reason why the authorizer&apos;s ZooKeeperClient got into this state. For the authorizer, we do need to schedule retries in this case. But the issue doesn&apos;t seem to have affected other operations of the broker in this case, presumably because we retry connections for the other ZooKeeperClient when there are requests. We should still apply the retry fix to the common ZooKeeperClient, right? Since the affected broker didn&apos;t pick up ACL updates made on other brokers, it is a critical security issue. But I wanted to check if we have applied any fixes in this area in newer versions of Kafka. Thanks.&lt;/p&gt;</comment>
                            <comment id="17221624" author="junrao" created="Tue, 27 Oct 2020 18:03:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;, yes, I think this issue still exists on all versions of Kafka. The PR for this jira hasn&apos;t been merged yet. The authorizer uses a separate instance of ZooKeeperClient from the broker. So, they could fail authorization independently.&lt;/p&gt;</comment>
                            <comment id="17221756" author="rsivaram" created="Tue, 27 Oct 2020 21:06:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt;Thank you! I will follow up on the PR.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13238269">KAFKA-8508</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi1abk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>junrao</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>