<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:40:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1355] Reduce/optimize update metadata requests sent during leader election</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1355</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;This is part of the investigation into slow shutdowns in 0.8.1. While&lt;br/&gt;
logging contributes to bulk of the regression, this one also adds&lt;br/&gt;
quite a bit of overhead:&lt;/p&gt;

&lt;p&gt;In addLeaderAndIsrRequest (called for every partition that is led by the&lt;br/&gt;
broker being shut down) we also add an UpdateMetadataRequest - each call to&lt;br/&gt;
addUpdateMetadataRequests does two traversals over &lt;em&gt;all&lt;/em&gt; (global)&lt;br/&gt;
partitions. I think it should be straightforward to optimize this a bit.&lt;/p&gt;

&lt;p&gt;Marking as critical, since it is not as big an overhead as the logging.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12705833">KAFKA-1355</key>
            <summary>Reduce/optimize update metadata requests sent during leader election</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jjkoshy">Joel Jacob Koshy</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Apr 2014 01:25:43 +0000</created>
                <updated>Tue, 27 May 2014 18:42:06 +0000</updated>
                            <resolved>Fri, 18 Apr 2014 21:04:46 +0000</resolved>
                                    <version>0.8.1</version>
                                    <fixVersion>0.8.1.1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13956002" author="jjkoshy" created="Tue, 1 Apr 2014 01:45:30 +0000"  >&lt;p&gt;BTW, here are the configs and steps I used for this, &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1342&quot; title=&quot;Slow controlled shutdowns can result in stale shutdown requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1342&quot;&gt;&lt;del&gt;KAFKA-1342&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1350&quot; title=&quot;Fix excessive state change logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1350&quot;&gt;&lt;del&gt;KAFKA-1350&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;Four brokers, 100 topics, eight partitions each.&lt;/p&gt;

&lt;p&gt;Log4j and server configs by broker:&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/anonymous/9906088&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/anonymous/9906088&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/anonymous/9906092&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/anonymous/9906092&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/anonymous/9906096&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/anonymous/9906096&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/anonymous/9906102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/anonymous/9906102&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/anonymous/9906144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/anonymous/9906144&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/anonymous/9906148&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/anonymous/9906148&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/anonymous/9906153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/anonymous/9906153&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/anonymous/9906157&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/anonymous/9906157&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Producer performance: &lt;a href=&quot;https://gist.github.com/anonymous/9906163&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/anonymous/9906163&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(At the end, just grep in the controller&apos;s request log and extract local time)&lt;br/&gt;
grep ControlledShutdownRequest logs/kafka-request*&lt;/p&gt;</comment>
                            <comment id="13960237" author="jjkoshy" created="Fri, 4 Apr 2014 18:23:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/20038&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/20038&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13960408" author="jjkoshy" created="Fri, 4 Apr 2014 20:48:45 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/20038/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/20038/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13960410" author="jjkoshy" created="Fri, 4 Apr 2014 20:51:43 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/20038/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/20038/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13964478" author="jjkoshy" created="Wed, 9 Apr 2014 18:01:09 +0000"  >&lt;p&gt;Committed to trunk (including the comment fix in Jun&apos;s follow-up review).&lt;/p&gt;

&lt;p&gt;Need patch for 0.8.1&lt;/p&gt;</comment>
                            <comment id="13965850" author="jjkoshy" created="Thu, 10 Apr 2014 21:02:49 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/20232/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/20232/&lt;/a&gt;&lt;br/&gt;
 against branch origin/0.8.1&lt;/p&gt;</comment>
                            <comment id="13967628" author="nehanarkhede" created="Sat, 12 Apr 2014 20:10:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjkoshy&quot; class=&quot;user-hover&quot; rel=&quot;jjkoshy&quot;&gt;jjkoshy&lt;/a&gt; Should we also check in this patch to 0.8.1. I&apos;m not sure if we waiting on something?&lt;/p&gt;</comment>
                            <comment id="13967666" author="jjkoshy" created="Sat, 12 Apr 2014 22:18:11 +0000"  >&lt;p&gt;Tim&apos;s patch in 1363 conflicts with this. So we can get 1363 in first, and I will rebase this one.&lt;/p&gt;</comment>
                            <comment id="13967687" author="nehanarkhede" created="Sat, 12 Apr 2014 23:46:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1363&quot; title=&quot;testTopicConfigChangesDuringDeleteTopic hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1363&quot;&gt;&lt;del&gt;KAFKA-1363&lt;/del&gt;&lt;/a&gt; is in 0.8.1 as well as trunk now. &lt;/p&gt;</comment>
                            <comment id="13968570" author="jjkoshy" created="Mon, 14 Apr 2014 17:47:51 +0000"  >&lt;p&gt;Sorry - I meant &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1356&quot; title=&quot;Topic metadata requests takes too long to process&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1356&quot;&gt;&lt;del&gt;KAFKA-1356&lt;/del&gt;&lt;/a&gt;, not 1363 - will check that in first after reviewing and rebase this.&lt;/p&gt;</comment>
                            <comment id="13968574" author="jjkoshy" created="Mon, 14 Apr 2014 17:48:55 +0000"  >&lt;p&gt;That has been marked as closed, but &lt;a href=&quot;https://reviews.apache.org/r/20252/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/20252/&lt;/a&gt; has not been checked into 0.8.1&lt;/p&gt;</comment>
                            <comment id="13973460" author="jjkoshy" created="Thu, 17 Apr 2014 21:49:08 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/20232/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/20232/&lt;/a&gt;&lt;br/&gt;
 against branch origin/0.8.1&lt;/p&gt;</comment>
                            <comment id="13974474" author="jjkoshy" created="Fri, 18 Apr 2014 21:04:46 +0000"  >&lt;p&gt;Thanks for the review. Committed to 0.8.1 as well.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12707583">KAFKA-1380</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12639653" name="KAFKA-1355.patch" size="16428" author="jjkoshy" created="Thu, 10 Apr 2014 21:02:49 +0000"/>
                            <attachment id="12638761" name="KAFKA-1355_2014-04-04_13:48:34.patch" size="15947" author="jjkoshy" created="Fri, 4 Apr 2014 20:48:44 +0000"/>
                            <attachment id="12638762" name="KAFKA-1355_2014-04-04_13:51:22.patch" size="15956" author="jjkoshy" created="Fri, 4 Apr 2014 20:51:43 +0000"/>
                            <attachment id="12640714" name="KAFKA-1355_2014-04-17_14:48:57.patch" size="16227" author="jjkoshy" created="Thu, 17 Apr 2014 21:49:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384157</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 31 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1u6kn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384425</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>