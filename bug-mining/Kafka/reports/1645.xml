<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:03:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5797] StoreChangelogReader should be resilient to broker-side metadata not available</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5797</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In &lt;tt&gt;StoreChangelogReader#validatePartitionExists&lt;/tt&gt;, if the metadata for the required partition is not available, or a timeout exception is thrown, today the function would directly throw the exception all the way up to user&apos;s exception handlers.&lt;/p&gt;

&lt;p&gt;Since we have now extracted the restoration out of the consumer callback, a better way to handle this, is to only validate the partition during restoring, and if it does not exist we can just proceed and retry in the next loop&lt;/p&gt;</description>
                <environment></environment>
        <key id="13097797">KAFKA-5797</key>
            <summary>StoreChangelogReader should be resilient to broker-side metadata not available</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guozhang">Guozhang Wang</assignee>
                                    <reporter username="guozhang">Guozhang Wang</reporter>
                        <labels>
                    </labels>
                <created>Sun, 27 Aug 2017 00:35:42 +0000</created>
                <updated>Mon, 11 Sep 2017 22:21:11 +0000</updated>
                            <resolved>Wed, 30 Aug 2017 15:43:34 +0000</resolved>
                                                    <fixVersion>0.11.0.1</fixVersion>
                    <fixVersion>1.0.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16143183" author="githubbot" created="Sun, 27 Aug 2017 18:16:03 +0000"  >&lt;p&gt;GitHub user guozhangwang opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3748&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3748&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5797&quot; title=&quot;StoreChangelogReader should be resilient to broker-side metadata not available&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5797&quot;&gt;&lt;del&gt;KAFKA-5797&lt;/del&gt;&lt;/a&gt;: Delay checking of partition existence in StoreChangelogReader&lt;/p&gt;

&lt;p&gt;    1. Remove timeout-based validatePartitionExists from StoreChangelogReader; instead only try to refresh metadata once after all tasks have been created and their topology initialized (hence all stores have been registered).&lt;br/&gt;
    2. Add the logic to refresh partition metadata at the end of initialization if some restorers needing initialization cannot find their changelogs, hoping that in the next run loop these stores can find their changelogs.&lt;/p&gt;

&lt;p&gt;    As a result, we would not ever call `consumer#partitionsFor` any more, but only `consumer#listTopics`; so the only blocking calls left are `listTopics` and `endOffsets, and we always capture timeout exceptions around these two calls, and delay to retry in the next run loop after refreshing the metadata. By doing this we can also reduce the number of request round trips between consumer and brokers.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/guozhangwang/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/guozhangwang/kafka&lt;/a&gt; K5797-handle-metadata-available&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3748.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3748.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3748&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a1cbd208007a0a5e73ff917987a457662554c04c&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-27T03:47:01Z&lt;/p&gt;

&lt;p&gt;    handlg timeout exception&lt;/p&gt;

&lt;p&gt;commit 2348799f54722c67f9837133a939e3f982b543d9&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-27T05:25:21Z&lt;/p&gt;

&lt;p&gt;    fix unit tests&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16147477" author="guozhang" created="Wed, 30 Aug 2017 15:43:34 +0000"  >&lt;p&gt;Issue resolved by pull request 3748&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/3748&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3748&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16147481" author="githubbot" created="Wed, 30 Aug 2017 15:45:08 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3748&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3748&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16156562" author="githubbot" created="Thu, 7 Sep 2017 06:37:01 +0000"  >&lt;p&gt;GitHub user guozhangwang opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3806&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3806&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5797&quot; title=&quot;StoreChangelogReader should be resilient to broker-side metadata not available&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5797&quot;&gt;&lt;del&gt;KAFKA-5797&lt;/del&gt;&lt;/a&gt;: Handle metadata not available in store registration&lt;/p&gt;

&lt;p&gt;    This is the backport of #3748 for trunk&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/guozhangwang/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/guozhangwang/kafka&lt;/a&gt; K5797-handle-metadata-available-0110&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3806.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3806.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3806&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d7454306533c3be5edd52415c17f4f088cff6741&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-30T15:43:22Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5797&quot; title=&quot;StoreChangelogReader should be resilient to broker-side metadata not available&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5797&quot;&gt;&lt;del&gt;KAFKA-5797&lt;/del&gt;&lt;/a&gt;: Delay checking of partition existence in StoreChangelogReader&lt;/p&gt;

&lt;p&gt;    1. Remove timeout-based validatePartitionExists from StoreChangelogReader; instead only try to refresh metadata once after all tasks have been created and their topology initialized (hence all stores have been registered).&lt;br/&gt;
    2. Add the logic to refresh partition metadata at the end of initialization if some restorers needing initialization cannot find their changelogs, hoping that in the next run loop these stores can find their changelogs.&lt;/p&gt;

&lt;p&gt;    As a result, after `initialize` is called we may not be able to start initializing all the `needsInitializing` ones.&lt;/p&gt;

&lt;p&gt;    As an optimization, we would not call `consumer#partitionsFor` any more, but only `consumer#listTopics` fetching all the topic metadata; so the only blocking calls left are `listTopics` and `endOffsets`, and we always capture timeout exceptions around these two calls, and delay to retry in the next run loop after refreshing the metadata. By doing this we can also reduce the number of request round trips between consumer and brokers.&lt;/p&gt;

&lt;p&gt;    Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;/p&gt;

&lt;p&gt;    Reviewers: Damian Guy &amp;lt;damian.guy@gmail.com&amp;gt;, Matthias J. Sax &amp;lt;matthias@confluent.io&amp;gt;&lt;/p&gt;

&lt;p&gt;    Closes #3748 from guozhangwang/K5797-handle-metadata-available&lt;/p&gt;

&lt;p&gt;commit 871d3e233f97a0bf6f9e3ae487f00a128276fe42&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-09-06T07:03:16Z&lt;/p&gt;

&lt;p&gt;    minor fixes&lt;/p&gt;

&lt;p&gt;commit 914880c55452d41161de8388553cc69ed9b6c5e0&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-09-07T05:34:10Z&lt;/p&gt;

&lt;p&gt;    Merge branch &apos;0.11.0&apos; of &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf/kafka&lt;/a&gt; into K5797-handle-metadata-available-0110&lt;/p&gt;

&lt;p&gt;commit 25541c4c8e629401caea23749c2745937cf5a439&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-09-07T05:50:45Z&lt;/p&gt;

&lt;p&gt;    fix some unit tests&lt;/p&gt;

&lt;p&gt;commit 360ba8cb30ea62134c0d5301c1f39ea494a51bcd&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-09-07T06:33:54Z&lt;/p&gt;

&lt;p&gt;    fix unit tests&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16158945" author="githubbot" created="Fri, 8 Sep 2017 17:10:53 +0000"  >&lt;p&gt;Github user guozhangwang closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3806&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3806&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 10 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3jbmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>