<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:41:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-17730] ReplicaFetcherThreadBenchmark is broken</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-17730</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Output running this benchmark:&lt;/p&gt;



&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;./jmh.sh ReplicaFetcherThreadBenchmark
running gradlew :jmh-benchmarks:clean :jmh-benchmarks:shadowJar

&amp;gt; Configure project :
Starting build with version 4.0.0-SNAPSHOT (commit id 15594bbb) using Gradle 8.10, Java 17 and Scala 2.13.15
Build properties: ignoreFailures=false, maxParallelForks=12, maxScalacThreads=8, maxTestRetries=0

Deprecated Gradle features were used in this build, making it incompatible with Gradle 9.0.

You can use &apos;--warning-mode all&apos; to show the individual deprecation warnings and determine if they come from your own scripts or plugins.

For more on this, please refer to https://docs.gradle.org/8.10/userguide/command_line_interface.html#sec:command_line_warnings in the Gradle documentation.

BUILD SUCCESSFUL in 31s
96 actionable tasks: 22 executed, 74 up-to-date
gradle build done
running JMH with args: ReplicaFetcherThreadBenchmark
# JMH version: 1.37
# VM version: JDK 17.0.9, OpenJDK 64-Bit Server VM, 17.0.9+9
# VM invoker: /Users/mickael/.sdkman/candidates/java/17.0.9-tem/bin/java
# VM options: &amp;lt;none&amp;gt;
# Blackhole mode: compiler (auto-detected, use -Djmh.blackhole.autoDetect=false to disable)
# Warmup: 5 iterations, 10 s each
# Measurement: 15 iterations, 10 s each
# Timeout: 10 min per iteration
# Threads: 1 thread, will synchronize iterations
# Benchmark mode: Average time, time/op
# Benchmark: org.apache.kafka.jmh.fetcher.ReplicaFetcherThreadBenchmark.testFetcher
# Parameters: (partitionCount = 100)

# Run progress: 0.00% complete, ETA 00:13:20
# Fork: 1 of 1
# Warmup Iteration   1: [2024-10-08 17:32:04,626] WARN The new &apos;consumer&apos; rebalance protocol is only supported in KRaft cluster with the new group coordinator. (kafka.server.KafkaConfig:70)
&amp;lt;failure&amp;gt;

org.apache.kafka.common.errors.NotLeaderOrFollowerException: Error while fetching partition state for topic-30


&amp;lt;JMH had finished, but forked VM did not exit, are there stray running threads? Waiting 24 seconds more...&amp;gt;

Non-finished threads:

Thread[ExpirationReaper--1-ElectLeader,5,main]
  at java.base@17.0.9/jdk.internal.misc.Unsafe.park(Native Method)
  at java.base@17.0.9/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:252)
  at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:1672)
  at java.base@17.0.9/java.util.concurrent.DelayQueue.poll(DelayQueue.java:265)
  at app//org.apache.kafka.server.util.timer.SystemTimer.advanceClock(SystemTimer.java:90)
  at app//kafka.server.DelayedOperationPurgatory.advanceClock(DelayedOperation.scala:418)
  at app//kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper.doWork(DelayedOperation.scala:444)
  at app//org.apache.kafka.server.util.ShutdownableThread.run(ShutdownableThread.java:136)

Thread[ExpirationReaper--1-RemoteFetch,5,main]
  at java.base@17.0.9/jdk.internal.misc.Unsafe.park(Native Method)
  at java.base@17.0.9/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:252)
  at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:1672)
  at java.base@17.0.9/java.util.concurrent.DelayQueue.poll(DelayQueue.java:265)
  at app//org.apache.kafka.server.util.timer.SystemTimer.advanceClock(SystemTimer.java:90)
  at app//kafka.server.DelayedOperationPurgatory.advanceClock(DelayedOperation.scala:418)
  at app//kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper.doWork(DelayedOperation.scala:444)
  at app//org.apache.kafka.server.util.ShutdownableThread.run(ShutdownableThread.java:136)

Thread[ExpirationReaper--1-Fetch,5,main]
  at java.base@17.0.9/jdk.internal.misc.Unsafe.park(Native Method)
  at java.base@17.0.9/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:252)
  at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:1672)
  at java.base@17.0.9/java.util.concurrent.DelayQueue.poll(DelayQueue.java:265)
  at app//org.apache.kafka.server.util.timer.SystemTimer.advanceClock(SystemTimer.java:90)
  at app//kafka.server.DelayedOperationPurgatory.advanceClock(DelayedOperation.scala:418)
  at app//kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper.doWork(DelayedOperation.scala:444)
  at app//org.apache.kafka.server.util.ShutdownableThread.run(ShutdownableThread.java:136)

Thread[ExpirationReaper--1-DeleteRecords,5,main]
  at java.base@17.0.9/jdk.internal.misc.Unsafe.park(Native Method)
  at java.base@17.0.9/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:252)
  at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:1672)
  at java.base@17.0.9/java.util.concurrent.DelayQueue.poll(DelayQueue.java:265)
  at app//org.apache.kafka.server.util.timer.SystemTimer.advanceClock(SystemTimer.java:90)
  at app//kafka.server.DelayedOperationPurgatory.advanceClock(DelayedOperation.scala:418)
  at app//kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper.doWork(DelayedOperation.scala:444)
  at app//org.apache.kafka.server.util.ShutdownableThread.run(ShutdownableThread.java:136)

Thread[ExpirationReaper--1-RemoteListOffsets,5,main]
  at java.base@17.0.9/jdk.internal.misc.Unsafe.park(Native Method)
  at java.base@17.0.9/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:252)
  at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:1672)
  at java.base@17.0.9/java.util.concurrent.DelayQueue.poll(DelayQueue.java:265)
  at app//org.apache.kafka.server.util.timer.SystemTimer.advanceClock(SystemTimer.java:90)
  at app//kafka.server.DelayedOperationPurgatory.advanceClock(DelayedOperation.scala:418)
  at app//kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper.doWork(DelayedOperation.scala:444)
  at app//org.apache.kafka.server.util.ShutdownableThread.run(ShutdownableThread.java:136)

Thread[DestroyJavaVM,5,main]

Thread[ExpirationReaper--1-Produce,5,main]
  at java.base@17.0.9/jdk.internal.misc.Unsafe.park(Native Method)
  at java.base@17.0.9/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:252)
  at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:1672)
  at java.base@17.0.9/java.util.concurrent.DelayQueue.poll(DelayQueue.java:265)
  at app//org.apache.kafka.server.util.timer.SystemTimer.advanceClock(SystemTimer.java:90)
  at app//kafka.server.DelayedOperationPurgatory.advanceClock(DelayedOperation.scala:418)
  at app//kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper.doWork(DelayedOperation.scala:444)
  at app//org.apache.kafka.server.util.ShutdownableThread.run(ShutdownableThread.java:136)


JMH benchmarks done
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13594674">KAFKA-17730</key>
            <summary>ReplicaFetcherThreadBenchmark is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yangpoan">PoAn Yang</assignee>
                                    <reporter username="mimaison">Mickael Maison</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Oct 2024 15:34:07 +0000</created>
                <updated>Thu, 9 Jan 2025 15:50:51 +0000</updated>
                            <resolved>Thu, 9 Jan 2025 15:50:51 +0000</resolved>
                                                    <fixVersion>4.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17887774" author="JIRAUSER300605" created="Wed, 9 Oct 2024 05:55:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chia7712&quot; class=&quot;user-hover&quot; rel=&quot;chia7712&quot;&gt;chia7712&lt;/a&gt; Hello, can I take this issue? Or are you already working on this?&lt;/p&gt;</comment>
                            <comment id="17887776" author="chia7712" created="Wed, 9 Oct 2024 06:02:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=javakillah&quot; class=&quot;user-hover&quot; rel=&quot;javakillah&quot;&gt;javakillah&lt;/a&gt; sure, thanks for taking over it.&lt;/p&gt;</comment>
                            <comment id="17894950" author="JIRAUSER300605" created="Sat, 2 Nov 2024 05:35:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chia7712&quot; class=&quot;user-hover&quot; rel=&quot;chia7712&quot;&gt;chia7712&lt;/a&gt; Opened the PR with the current fix is to catch and ignore NotLeaderOrFollowerException &lt;a href=&quot;https://github.com/apache/kafka/pull/17443&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/17443&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Could you please tell me if ignoring the exception is correct or if we need to look into the cause of the exception?&lt;/p&gt;</comment>
                            <comment id="17911570" author="chia7712" created="Thu, 9 Jan 2025 15:50:51 +0000"  >&lt;p&gt;trunk: &lt;a href=&quot;https://github.com/apache/kafka/commit/7275dc129e25c08abc77187ba2a9b144a60c9d92&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/commit/7275dc129e25c08abc77187ba2a9b144a60c9d92&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;4.0: &lt;a href=&quot;https://github.com/chia7712/kafka/commit/95ba356dd759ae6d771e59b701cb255e3dd06ba2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/chia7712/kafka/commit/95ba356dd759ae6d771e59b701cb255e3dd06ba2&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13594673">KAFKA-17729</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310460">
                    <name>Child-Issue</name>
                                                                <inwardlinks description="is a child of">
                                        <issuelink>
            <issuekey id="13594718">KAFKA-17736</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ruww:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>