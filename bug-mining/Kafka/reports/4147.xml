<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:42:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-16407] ForeignKey INNER join ignores FK change when its previous value is null</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-16407</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We have two topics :&#160;&lt;em&gt;left-topic&lt;span class=&quot;error&quot;&gt;&amp;#91;String, LeftRecord&amp;#93;&lt;/span&gt;&lt;/em&gt;&#160;and&#160;&lt;em&gt;right-topic&lt;span class=&quot;error&quot;&gt;&amp;#91;String, String&amp;#93;&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;where&#160;&lt;em&gt;LeftRecord&lt;/em&gt;&#160;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
&#160;&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;LeftRecord(foreignKey: String, name: String)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;we do a simple &lt;b&gt;INNER&lt;/b&gt; foreign key join on left-topic&apos;s foreignKey field. The resulting join value is the value in right-topic.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Scenario: Primary key pk1 gets mapped to a new FK after having a null FK&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
rightTopic.pipeInput(&lt;span class=&quot;code-quote&quot;&gt;&quot;fk&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;)

leftTopic.pipeInput(&lt;span class=&quot;code-quote&quot;&gt;&quot;pk1&quot;&lt;/span&gt;, LeftRecord(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;pk1&quot;&lt;/span&gt;))
leftTopic.pipeInput(&lt;span class=&quot;code-quote&quot;&gt;&quot;pk1&quot;&lt;/span&gt;, LeftRecord(&lt;span class=&quot;code-quote&quot;&gt;&quot;fk&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;pk1&quot;&lt;/span&gt;)) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;ins&gt;Expected result&lt;/ins&gt;&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
KeyValue(pk1, 1)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&lt;ins&gt;Actual result&lt;/ins&gt;&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
# No output !

# Logs:

20:14:29,723 WARN &#160;org.apache.kafka.streams.kstream.internals.foreignkeyjoin.ForeignJoinSubscriptionSendProcessorSupplier &#160;- Skipping record due to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; foreign key. value=[LeftRecord(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,pk1)] topic=[left-topic] partition=[0] offset=[0]

20:14:29,728 WARN &#160;org.apache.kafka.streams.kstream.internals.foreignkeyjoin.ForeignJoinSubscriptionSendProcessorSupplier &#160;- Skipping record due to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; foreign key. value=[LeftRecord(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,pk1)] topic=[left-topic] partition=[0] offset=[1]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;After looking into the code, I believe this is the line behind the issue : &lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/streams/src/main/java/org/apache/kafka/streams/kstream/internals/foreignkeyjoin/SubscriptionSendProcessorSupplier.java#L147&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/streams/src/main/java/org/apache/kafka/streams/kstream/internals/foreignkeyjoin/SubscriptionSendProcessorSupplier.java#L147&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13573012">KAFKA-16407</key>
            <summary>ForeignKey INNER join ignores FK change when its previous value is null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ayoubomari">Ayoub Omari</assignee>
                                    <reporter username="ayoubomari">Ayoub Omari</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Mar 2024 19:27:45 +0000</created>
                <updated>Sun, 6 Apr 2025 04:31:56 +0000</updated>
                            <resolved>Sun, 6 Apr 2025 04:31:56 +0000</resolved>
                                    <version>2.8.2</version>
                    <version>3.0.2</version>
                    <version>3.1.2</version>
                    <version>3.2.3</version>
                    <version>3.3.2</version>
                    <version>3.4.1</version>
                    <version>3.5.2</version>
                    <version>3.6.1</version>
                    <version>3.7.0</version>
                                    <fixVersion>3.9.1</fixVersion>
                    <fixVersion>4.0.1</fixVersion>
                    <fixVersion>4.1.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17831468" author="mjsax" created="Wed, 27 Mar 2024 17:10:48 +0000"  >&lt;p&gt;Did &lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-962%3A+Relax+non-null+key+requirement+in+Kafka+Streams&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/KAFKA/KIP-962%3A+Relax+non-null+key+requirement+in+Kafka+Streams&lt;/a&gt; not fix this?&lt;/p&gt;</comment>
                            <comment id="17831501" author="JIRAUSER302607" created="Wed, 27 Mar 2024 18:53:42 +0000"  >&lt;p&gt;Actually this behavior is not concerned by this KIP, it&apos;s a condition that existed since 2.8 which wrongly assumes if old foreign key is null then we should skip the current record. From what I saw, the implementation of the KIP didn&apos;t change that code.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13570786">KAFKA-16343</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13067623" name="InnerFKJoinTest.scala" size="1770" author="ayoubomari" created="Fri, 22 Mar 2024 19:29:11 +0000"/>
                            <attachment id="13067624" name="JsonSerde.scala" size="1145" author="ayoubomari" created="Fri, 22 Mar 2024 19:29:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1o5w8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>