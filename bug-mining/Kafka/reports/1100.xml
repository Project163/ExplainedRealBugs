<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:54:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3561] Auto create through topic for KStream aggregation and join</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3561</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;For KStream.join / aggregateByKey operations that requires the streams to be partitioned on the record key, today users should repartition themselves through the &quot;through&quot; call:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;stream1 = builder.stream(&lt;span class=&quot;code-quote&quot;&gt;&quot;topic1&quot;&lt;/span&gt;);
stream2 = builder.stream(&lt;span class=&quot;code-quote&quot;&gt;&quot;topic2&quot;&lt;/span&gt;);

stream3 = stream1.map(&lt;span class=&quot;code-comment&quot;&gt;/* set the right key &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; join*/&lt;/span&gt;).through(&lt;span class=&quot;code-quote&quot;&gt;&quot;topic3&quot;&lt;/span&gt;);
stream4 = stream2.map(&lt;span class=&quot;code-comment&quot;&gt;/* set the right key &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; join*/&lt;/span&gt;).through(&lt;span class=&quot;code-quote&quot;&gt;&quot;topic4&quot;&lt;/span&gt;);

stream3.join(stream4, ..)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This pattern can actually be done by the Streams DSL itself instead of requiring users to specify themselves, i.e. users can just set the right key like (see &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3430&quot; title=&quot;Allow users to set key in KTable.toStream() and KStream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3430&quot;&gt;&lt;del&gt;KAFKA-3430&lt;/del&gt;&lt;/a&gt;) and then call join, which will be translated by adding the &quot;internal topic for repartition&quot;.&lt;/p&gt;

&lt;p&gt;Another thing is that today if user do not call &quot;through&quot; after setting a new key, the aggregation result would not be correct as the aggregation is based on key B while the source partitions is partitioned by key A and hence each task will only get a partial aggregation for all keys. But this is not validated in the DSL today. We should do both the auto-translation and validation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12958904">KAFKA-3561</key>
            <summary>Auto create through topic for KStream aggregation and join</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="damianguy">Damian Guy</assignee>
                                    <reporter username="guozhang">Guozhang Wang</reporter>
                        <labels>
                            <label>api</label>
                    </labels>
                <created>Thu, 14 Apr 2016 17:29:06 +0000</created>
                <updated>Thu, 8 Nov 2018 22:23:50 +0000</updated>
                            <resolved>Thu, 16 Jun 2016 18:56:53 +0000</resolved>
                                                    <fixVersion>0.10.1.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15303877" author="damianguy" created="Fri, 27 May 2016 10:16:02 +0000"  >&lt;p&gt;Guozhang - i&apos;d like to do this if it is ok with you. I&apos;m going to need a bit of guidance though.&lt;br/&gt;
It looks to me that I&apos;d need to change the signature of map to something like:&lt;/p&gt;

 &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;K1, V1&amp;gt; KStream&amp;lt;K1, V1&amp;gt; map(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; KeyValueMapper&amp;lt;K, V, KeyValue&amp;lt;K1, V1&amp;gt;&amp;gt; mapper,
                                 &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Serde&amp;lt;K1&amp;gt; keySerde,
                                 &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Serde&amp;lt;V1&amp;gt; valueSerde,
                                 &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; topic);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and then it could be implemented like so:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &amp;lt;K1, V1&amp;gt; KStream&amp;lt;K1, V1&amp;gt; map(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; KeyValueMapper&amp;lt;K, V, KeyValue&amp;lt;K1, V1&amp;gt;&amp;gt; mapper,
                                        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Serde&amp;lt;K1&amp;gt; keySerde,
                                        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Serde&amp;lt;V1&amp;gt; valueSerde,
                                        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; topic) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = topology.newName(MAP_NAME);
        topology.addProcessor(name, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KStreamMap&amp;lt;&amp;gt;(mapper), &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.name);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KStreamImpl&amp;lt;K1, V1&amp;gt;(topology, name, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).through(keySerde, valueSerde, topic);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What other methods does this apply to. What am I missing? (I&apos;m sure there is a lot of context i&apos;m missing)&lt;br/&gt;
Thanks,&lt;br/&gt;
Damian&lt;/p&gt;</comment>
                            <comment id="15304347" author="guozhang" created="Fri, 27 May 2016 17:06:55 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=damianguy&quot; class=&quot;user-hover&quot; rel=&quot;damianguy&quot;&gt;damianguy&lt;/a&gt; a couple thoughts:&lt;/p&gt;

&lt;p&gt;1. Topics referenced in &lt;tt&gt;through&lt;/tt&gt; call are treated as &quot;external topics&quot; that owned by users themselves, like topics from &lt;tt&gt;builder.stream/table&lt;/tt&gt; and &lt;tt&gt;to&lt;/tt&gt; operators. One goal of this ticket about &quot;auto creating repartition topics&quot; is to make it as an internal topic just as what we did for &lt;tt&gt;KTable.aggregation&lt;/tt&gt;. So we should not simply just add a &quot;through&quot; operator in between, and requiring users to provide the topic name.&lt;/p&gt;

&lt;p&gt;2. One related JIRA ticket is &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3576:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-3576:&lt;/a&gt; we originally want to differentiate KStream and KTable as much as possible for their semantic difference at the API layer, but there are suggestions that we may actually consider unifying them just for consistent user experience. Would like to hear your opinions on that, and if we are really going to do &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3576&quot; title=&quot;Unify KStream and KTable API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3576&quot;&gt;&lt;del&gt;KAFKA-3576&lt;/del&gt;&lt;/a&gt; as well, we&apos;d better do it together with this ticket.&lt;/p&gt;</comment>
                            <comment id="15310298" author="githubbot" created="Wed, 1 Jun 2016 13:25:29 +0000"  >&lt;p&gt;GitHub user dguy opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1453&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1453&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3561&quot; title=&quot;Auto create through topic for KStream aggregation and join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3561&quot;&gt;&lt;del&gt;KAFKA-3561&lt;/del&gt;&lt;/a&gt;: Auto create through topic for KStream aggregation and join &lt;span class=&quot;error&quot;&gt;&amp;#91;WIP&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;    @guozhangwang can you please take a look at this? It is not close to being done but i&apos;d like some feedback to ensure i&apos;m heading down the right path and understand what this JIRA is asking. The main things to look at are the `KStreamImpl.map(...)` method I added and the change made to `TopologyBuilder.copartitionGroups`&lt;/p&gt;

&lt;p&gt;    There is also a test, `KStreamRepartitionMappedKeyTest`, that passes with these changes.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dguy/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dguy/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3561&quot; title=&quot;Auto create through topic for KStream aggregation and join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3561&quot;&gt;&lt;del&gt;KAFKA-3561&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1453.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1453.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1453&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 053c809b5aa322327988909d53027d4682df6825&lt;br/&gt;
Author: Damian Guy &amp;lt;damian.guy@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-06-01T13:03:23Z&lt;/p&gt;

&lt;p&gt;    repartition through internal topic on KStream.map()&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15315545" author="githubbot" created="Sat, 4 Jun 2016 15:22:23 +0000"  >&lt;p&gt;Github user dguy closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1453&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1453&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15315908" author="githubbot" created="Sun, 5 Jun 2016 14:59:13 +0000"  >&lt;p&gt;GitHub user dguy opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1472&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1472&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3561&quot; title=&quot;Auto create through topic for KStream aggregation and join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3561&quot;&gt;&lt;del&gt;KAFKA-3561&lt;/del&gt;&lt;/a&gt;: Auto create through topic for KStream aggregation and join &lt;span class=&quot;error&quot;&gt;&amp;#91;WIP&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;    @guozhangwang @enothereska @mjsax @miguno&lt;/p&gt;

&lt;p&gt;    If you get a chance can you please take a look at this. I&apos;ve done the repartitioning in the join, but it results in 2 internal topics for each join. This seems like overkill as sometimes we wouldn&apos;t need to repartition at all, others just 1 topic, and then sometimes both, but I&apos;m not sure how we can know that. &lt;/p&gt;

&lt;p&gt;    I&apos;d also need to implement something similar for leftJoin, but again, i&apos;d like to see if i&apos;m heading down the right path or if anyone has any other bright ideas.&lt;/p&gt;

&lt;p&gt;    For reference - &lt;a href=&quot;https://github.com/apache/kafka/pull/1453&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1453&lt;/a&gt; - the previous PR&lt;/p&gt;

&lt;p&gt;    Thanks for taking the time and looking forward to getting some welcome advice &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dguy/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dguy/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3561&quot; title=&quot;Auto create through topic for KStream aggregation and join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3561&quot;&gt;&lt;del&gt;KAFKA-3561&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1472.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1472.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1472&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 053c809b5aa322327988909d53027d4682df6825&lt;br/&gt;
Author: Damian Guy &amp;lt;damian.guy@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-06-01T13:03:23Z&lt;/p&gt;

&lt;p&gt;    repartition through internal topic on KStream.map()&lt;/p&gt;

&lt;p&gt;commit ba1b50285f9eae028e531183500de90a2ae877c7&lt;br/&gt;
Author: Damian Guy &amp;lt;damian@continuum.local&amp;gt;&lt;br/&gt;
Date:   2016-06-04T15:17:51Z&lt;/p&gt;

&lt;p&gt;    Merge remote-tracking branch &apos;upstream/trunk&apos; into &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3561&quot; title=&quot;Auto create through topic for KStream aggregation and join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3561&quot;&gt;&lt;del&gt;KAFKA-3561&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;commit a8c14f38914410bc3c7ff1e96c040bf1a1992cef&lt;br/&gt;
Author: Damian Guy &amp;lt;damian@continuum.local&amp;gt;&lt;br/&gt;
Date:   2016-06-05T14:41:12Z&lt;/p&gt;

&lt;p&gt;    repartition on join&lt;/p&gt;

&lt;p&gt;commit 1220c61464676881273e47d7e02ea8d502cd8fd4&lt;br/&gt;
Author: Damian Guy &amp;lt;damian.guy@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-06-05T14:51:17Z&lt;/p&gt;

&lt;p&gt;    repartition on join&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15334444" author="guozhang" created="Thu, 16 Jun 2016 18:56:53 +0000"  >&lt;p&gt;Issue resolved by pull request 1472&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1472&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1472&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15334446" author="githubbot" created="Thu, 16 Jun 2016 18:57:03 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1472&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1472&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="13144562">KAFKA-6641</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12959752">KAFKA-3576</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 22 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2w4tb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>