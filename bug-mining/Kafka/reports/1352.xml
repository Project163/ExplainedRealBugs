<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:59:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4677] Avoid unnecessary task movement across threads during rebalance</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4677</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;StreamPartitionAssigner tries to follow a sticky assignment policy to avoid expensive task migration. Currently, it does this in a best-effort approach.&lt;br/&gt;
We could observe a case, for which tasks did migrate for no good reason, thus we assume that the current implementation could be improved to be more sticky.&lt;br/&gt;
The concrete scenario is as follows:&lt;br/&gt;
assume we have topology with 3 tasks, A, B, C&lt;br/&gt;
assume we have 3 threads, each executing one task: 1-A, 2-B, 3-C&lt;br/&gt;
for some reason, thread 1 goes down and a rebalance gets triggered&lt;br/&gt;
thread 2 and 3 get their partitions revoked&lt;br/&gt;
sometimes (not sure what the exact condition for this is), the new assignment flips the assignment for task B and C (task A is newly assigned to either thread 2 or 3)&lt;br/&gt;
&amp;gt; possible new assignment 2(A,C) and 3-B&lt;br/&gt;
There is no obvious reason (like load-balancing) why the task assignment for B and C does change to the other thread resulting in unnecessary task migration.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13036549">KAFKA-4677</key>
            <summary>Avoid unnecessary task movement across threads during rebalance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="damianguy">Damian Guy</assignee>
                                    <reporter username="damianguy">Damian Guy</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Jan 2017 13:01:38 +0000</created>
                <updated>Wed, 1 Mar 2017 21:00:49 +0000</updated>
                            <resolved>Wed, 1 Feb 2017 04:17:07 +0000</resolved>
                                    <version>0.10.2.0</version>
                                    <fixVersion>0.11.0.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15832090" author="githubbot" created="Fri, 20 Jan 2017 16:51:08 +0000"  >&lt;p&gt;GitHub user dguy opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2411&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2411&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;WIP&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4677&quot; title=&quot;Avoid unnecessary task movement across threads during rebalance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4677&quot;&gt;&lt;del&gt;KAFKA-4677&lt;/del&gt;&lt;/a&gt;: Avoid unnecessary task movement across threads of the same process during rebalance&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dguy/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dguy/kafka&lt;/a&gt; kstreams-446&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2411.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2411.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2411&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a899864e484e859e44a71ebe8c9890dedfc403cc&lt;br/&gt;
Author: Damian Guy &amp;lt;damian.guy@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-01-20T15:19:28Z&lt;/p&gt;

&lt;p&gt;    Avoid unnecessary task movement across threads of the same process during rebalances&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15834239" author="githubbot" created="Mon, 23 Jan 2017 10:36:06 +0000"  >&lt;p&gt;Github user dguy closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2411&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2411&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15836317" author="githubbot" created="Tue, 24 Jan 2017 17:04:08 +0000"  >&lt;p&gt;GitHub user dguy opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2429&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2429&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4677&quot; title=&quot;Avoid unnecessary task movement across threads during rebalance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4677&quot;&gt;&lt;del&gt;KAFKA-4677&lt;/del&gt;&lt;/a&gt;: Avoid unnecessary task movement across threads during rebalance&lt;/p&gt;

&lt;p&gt;    Makes task assignment more sticky by preferring to assign tasks to clients that had previously had the task as active task. If there are no clients with the task previously active, then search for a standby. Finally falling back to the least loaded client.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dguy/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dguy/kafka&lt;/a&gt; kafka-4677&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2429.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2429.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2429&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a7bb5f5feccb337aea92262abce4648c09b39943&lt;br/&gt;
Author: Damian Guy &amp;lt;damian.guy@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-01-24T17:00:53Z&lt;/p&gt;

&lt;p&gt;    sticky task assignor&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15847996" author="guozhang" created="Wed, 1 Feb 2017 04:17:07 +0000"  >&lt;p&gt;Issue resolved by pull request 2429&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/2429&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2429&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15847997" author="githubbot" created="Wed, 1 Feb 2017 04:17:38 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2429&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2429&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15888161" author="githubbot" created="Tue, 28 Feb 2017 15:01:39 +0000"  >&lt;p&gt;GitHub user dguy opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2609&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2609&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4677&quot; title=&quot;Avoid unnecessary task movement across threads during rebalance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4677&quot;&gt;&lt;del&gt;KAFKA-4677&lt;/del&gt;&lt;/a&gt;: &lt;span class=&quot;error&quot;&gt;&amp;#91;Follow Up&amp;#93;&lt;/span&gt; add optimization to StickyTaskAssignor for rolling rebounce&lt;/p&gt;

&lt;p&gt;    Detect when a rebalance has happened due to one or more existing nodes bouncing. Keep assignment of previous active tasks the same and only assign the tasks that were not active to the new clients.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dguy/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dguy/kafka&lt;/a&gt; kstreams-575&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2609.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2609.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2609&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="15890856" author="githubbot" created="Wed, 1 Mar 2017 19:22:39 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2609&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2609&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15890935" author="jeffwidman" created="Wed, 1 Mar 2017 20:06:33 +0000"  >&lt;p&gt;Is KIP-54 related since it also implements a sticky partition assigner, albeit within the Kafka consumer? &lt;/p&gt;

&lt;p&gt;I haven&apos;t worked directly with streams, but I thought they piggy-backed on top of KafKa consumer. If so, wouldn&apos;t it be better to just inherit the KIP-54 implementation?&lt;/p&gt;

&lt;p&gt;Again, I don&apos;t really understand internals, so not sure.&lt;/p&gt;</comment>
                            <comment id="15891031" author="mjsax" created="Wed, 1 Mar 2017 21:00:49 +0000"  >&lt;p&gt;Streams used it&apos;s own partition assigner implementation and does not use the Consumer&apos;s default partition assigner, because streams has additional requirements/restrictions with regard to group management. Thus, any change from KIP-54 will not affect Streams as it does not use it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38znz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>