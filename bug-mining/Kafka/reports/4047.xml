<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:41:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-17455] `TaskCorruptedException` After Client Quota Throttling</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-17455</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When running a Kafka Streams EOS app that goes slightly above a configured user quota, we can reliably reproduce `TaskCorruptedException`s after throttling. This is the case even with an application that goes only 5-10% above the configured quota.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The root cause is a `TimeoutException` encountered in the `TaskExecutor.commitOffsetsOrTransaction`.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Stacktrace provided below:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;19:45:28 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;KAFKA&amp;#93;&lt;/span&gt; TaskExecutor - stream-thread &lt;span class=&quot;error&quot;&gt;&amp;#91;basic-tls-0-core-StreamThread-2&amp;#93;&lt;/span&gt; Committing task(s) 1_2 failed. org.apache.kafka.common.errors.TimeoutException: Timeout expired after 60000ms while awaiting AddOffsetsToTxn 19:45:28 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;KAFKA&amp;#93;&lt;/span&gt; StreamThread - stream-thread &lt;span class=&quot;error&quot;&gt;&amp;#91;basic-tls-0-core-StreamThread-2&amp;#93;&lt;/span&gt; Detected the states of tasks &lt;span class=&quot;error&quot;&gt;&amp;#91;1_2&amp;#93;&lt;/span&gt; are corrupted. Will close the task as dirty and re-create and bootstrap from scratch. org.apache.kafka.streams.errors.TaskCorruptedException: Tasks &lt;span class=&quot;error&quot;&gt;&amp;#91;1_2&amp;#93;&lt;/span&gt; are corrupted and hence need to be re-initialized at org.apache.kafka.streams.processor.internals.TaskExecutor.commitOffsetsOrTransaction(TaskExecutor.java:249) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;server.jar:?&amp;#93;&lt;/span&gt; at org.apache.kafka.streams.processor.internals.TaskExecutor.commitTasksAndMaybeUpdateCommittableOffsets(TaskExecutor.java:154) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;server.jar:?&amp;#93;&lt;/span&gt; at org.apache.kafka.streams.processor.internals.TaskManager.commitTasksAndMaybeUpdateCommittableOffsets(TaskManager.java:1915) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;server.jar:?&amp;#93;&lt;/span&gt; at org.apache.kafka.streams.processor.internals.TaskManager.commit(TaskManager.java:1882) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;server.jar:?&amp;#93;&lt;/span&gt; at org.apache.kafka.streams.processor.internals.StreamThread.maybeCommit(StreamThread.java:1384) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;server.jar:?&amp;#93;&lt;/span&gt; at org.apache.kafka.streams.processor.internals.StreamThread.runOnceWithoutProcessingThreads(StreamThread.java:1033) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;server.jar:?&amp;#93;&lt;/span&gt; at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:711) &lt;span class=&quot;error&quot;&gt;&amp;#91;server.jar:?&amp;#93;&lt;/span&gt; at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:670) &lt;span class=&quot;error&quot;&gt;&amp;#91;server.jar:?&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;</description>
                <environment></environment>
        <key id="13590611">KAFKA-17455</key>
            <summary>`TaskCorruptedException` After Client Quota Throttling</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coltmcnealy-lh">Colt McNealy</assignee>
                                    <reporter username="coltmcnealy-lh">Colt McNealy</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Aug 2024 21:04:37 +0000</created>
                <updated>Thu, 9 Jan 2025 19:12:36 +0000</updated>
                            <resolved>Thu, 9 Jan 2025 19:12:36 +0000</resolved>
                                    <version>3.8.0</version>
                                    <fixVersion>3.8.2</fixVersion>
                    <fixVersion>3.9.1</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>clients</component>
                    <component>producer </component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17878249" author="JIRAUSER301663" created="Fri, 30 Aug 2024 21:11:09 +0000"  >&lt;p&gt;This is probably a problem in the Producer rather than with Streams itself.&lt;/p&gt;


&lt;p&gt;I am confused at what causes this. The Kafka Quota documentation states:&lt;/p&gt;

&lt;p&gt;&amp;gt; Byte-rate and thread utilization are measured over multiple small windows (e.g. 30 windows of 1 second each) in order to detect and correct quota violations quickly. Typically, having large measurement windows (for e.g. 10 windows of 30 seconds each) leads to large bursts of traffic followed by long delays which is not great in terms of user experience.&lt;/p&gt;

&lt;p&gt;Our application was configured with `commit.interval.ms` of 100ms, and a producer timeout of 60 seconds (you can see that from the stacktrace).&lt;/p&gt;

&lt;p&gt;Once the broker started throttling, the Streams Commit seemed to hang.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am confused as to &lt;em&gt;why&lt;/em&gt; this would happen, given that:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Our app only exceeded quota by 5-10%&lt;/li&gt;
	&lt;li&gt;Quota enforcement is supposedly gradual according to the quota enforcement docs&lt;/li&gt;
	&lt;li&gt;We configured Streams to commit every 100ms, which implies that the producer send buffer also flushes every 100ms, so the quota should be experienced gradually.&lt;/li&gt;
	&lt;li&gt;The producer request timeout was 60 seconds. Given the `TimeoutException` it means that a 60-second timeout was exhausted. This is not likely due to normal throttling given how we were just barely over the quota.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This leads me to think there&apos;s a bug in the retries or throttling mechanism on the producer methods for committing transactions.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eduwerc&quot; class=&quot;user-hover&quot; rel=&quot;eduwerc&quot;&gt;eduwerc&lt;/a&gt;&#160; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17880522" author="dajac" created="Tue, 10 Sep 2024 07:28:16 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coltmcnealy-lh&quot; class=&quot;user-hover&quot; rel=&quot;coltmcnealy-lh&quot;&gt;coltmcnealy-lh&lt;/a&gt;. Thanks for bringing this up. Could you elaborate a bit more on the quota that you use? For instance, are you talking about bandwidth quotas or request quotas? Have you tried to run the application with debug level logs? It may be interesting to see the lifecycle of that request.&lt;/p&gt;</comment>
                            <comment id="17880733" author="JIRAUSER301663" created="Tue, 10 Sep 2024 17:15:50 +0000"  >&lt;p&gt;Thanks, David. It was a Producer Byte Rate quota. Let me rebuild and run with debug logs; I&apos;ll post it here tonight.&lt;/p&gt;</comment>
                            <comment id="17880854" author="JIRAUSER301663" created="Wed, 11 Sep 2024 05:07:57 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dajac&quot; class=&quot;user-hover&quot; rel=&quot;dajac&quot;&gt;dajac&lt;/a&gt; &#8212; here are the logs. I noticed that the app started stalling at 5:04:23, and exactly one minute later (5:05:23) we got this log:&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;05:05:23 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;KAFKA&amp;#93;&lt;/span&gt; TaskExecutor - stream-thread &lt;span class=&quot;error&quot;&gt;&amp;#91;basic-tls-0-core-StreamThread-2&amp;#93;&lt;/span&gt; Committing task(s) 1_3, 1_9 failed.&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Debug logs ended up being about 42 MB and I was unable to upload them to JIRA, so I sent them to you over slack.&lt;/p&gt;</comment>
                            <comment id="17890484" author="dajac" created="Thu, 17 Oct 2024 15:04:43 +0000"  >&lt;p&gt;We were able to root cause the issue based on logs share by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coltmcnealy-lh&quot; class=&quot;user-hover&quot; rel=&quot;coltmcnealy-lh&quot;&gt;coltmcnealy-lh&lt;/a&gt; privately. Posting my analysis here for the record.&lt;/p&gt;

&lt;p&gt;In the logs, I see the following two entries:&lt;/p&gt;

&lt;p&gt;1.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
17:21:09 [30mTRACE[m [KAFKA] TransactionManager - [Producer clientId=my-cluster-1-core-StreamThread-1-producer, transactionalId=my-cluster-core-00000001-0000-0000-0000-000000000000-1] Request AddOffsetsToTxnRequestData(transactionalId=&lt;span class=&quot;code-quote&quot;&gt;&apos;my-cluster-core-00000001-0000-0000-0000-000000000000-1&apos;&lt;/span&gt;, producerId=2, producerEpoch=32, groupId=&lt;span class=&quot;code-quote&quot;&gt;&apos;my-cluster-core&apos;&lt;/span&gt;) dequeued &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; sending&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
17:22:09 [36mDEBUG[m [KAFKA] Sender - [Producer clientId=my-cluster-1-core-StreamThread-1-producer, transactionalId=my-cluster-core-00000001-0000-0000-0000-000000000000-1] Sending transactional request AddOffsetsToTxnRequestData(transactionalId=&lt;span class=&quot;code-quote&quot;&gt;&apos;my-cluster-core-00000001-0000-0000-0000-000000000000-1&apos;&lt;/span&gt;, producerId=2, producerEpoch=32, groupId=&lt;span class=&quot;code-quote&quot;&gt;&apos;my-cluster-core&apos;&lt;/span&gt;) to node localhost:9092 (id: 1 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) with correlation ID 360&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is the code between those two log lines:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        TransactionManager.TxnRequestHandler nextRequestHandler = transactionManager.nextRequest(accumulator.hasIncomplete());
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nextRequestHandler == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
&#160; &#160; &#160; &#160; AbstractRequest.Builder&amp;lt;?&amp;gt; requestBuilder = nextRequestHandler.requestBuilder();
&#160; &#160; &#160; &#160; Node targetNode = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &#160; FindCoordinatorRequest.CoordinatorType coordinatorType = nextRequestHandler.coordinatorType();
&#160; &#160; &#160; &#160; &#160; &#160; targetNode = coordinatorType != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ?
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; transactionManager.coordinator(coordinatorType) :
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; client.leastLoadedNode(time.milliseconds()).node();
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (targetNode != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!awaitNodeReady(targetNode, coordinatorType)) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; log.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Target node {} not ready within request timeout, will retry when node is ready.&quot;&lt;/span&gt;, targetNode);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; maybeFindCoordinatorAndRetry(nextRequestHandler);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (coordinatorType != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; log.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Coordinator not known &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {}, will retry {} after finding coordinator.&quot;&lt;/span&gt;, coordinatorType, requestBuilder.apiKey());
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; maybeFindCoordinatorAndRetry(nextRequestHandler);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
&#160; &#160; &#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; log.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;No nodes available to send requests, will poll and retry when until a node is ready.&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; transactionManager.retry(nextRequestHandler);
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; client.poll(retryBackoffMs, time.milliseconds());
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nextRequestHandler.isRetry())
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; time.sleep(nextRequestHandler.retryBackoffMs());
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; currentTimeMs = time.milliseconds();
&#160; &#160; &#160; &#160; &#160; &#160; ClientRequest clientRequest = client.newClientRequest(targetNode.idString(), requestBuilder, currentTimeMs,
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, requestTimeoutMs, nextRequestHandler);
&#160; &#160; &#160; &#160; &#160; &#160; log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Sending transactional request {} to node {} with correlation ID {}&quot;&lt;/span&gt;, requestBuilder, targetNode, clientRequest.correlationId());
&#160; &#160; &#160; &#160; &#160; &#160; client.send(clientRequest, currentTimeMs);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first log line is printed in transactionManager.nextRequest.&lt;/p&gt;

&lt;p&gt;Hence I wonder if the sender waits in awaitNodeReady. That one calls NetworkClientUtils.awaitReady which looks like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (timeoutMs &amp;lt; 0) {
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Timeout needs to be greater than 0&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; startTime = time.milliseconds();
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isReady(client, node, startTime) || &#160;client.ready(node, startTime))
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; attemptStartTime = time.milliseconds();
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!client.isReady(node, attemptStartTime) &amp;amp;&amp;amp; attemptStartTime - startTime &amp;lt; timeoutMs) {
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (client.connectionFailed(node)) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Connection to &quot;&lt;/span&gt; + node + &lt;span class=&quot;code-quote&quot;&gt;&quot; failed.&quot;&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; pollTimeout = timeoutMs - (attemptStartTime - startTime); &lt;span class=&quot;code-comment&quot;&gt;// initialize in &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; order to avoid overflow
&lt;/span&gt;&#160; &#160; &#160; &#160; &#160; &#160; client.poll(pollTimeout, attemptStartTime);
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (client.authenticationException(node) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; client.authenticationException(node);
&#160; &#160; &#160; &#160; &#160; &#160; attemptStartTime = time.milliseconds();
&#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; client.isReady(node, attemptStartTime);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Basically, if the node is not ready, we call client.poll with the pollTimeout which is basically the timeoutMs received by the method in the beginning. Guess what? The timeout is 60000 and we have 60s between the two log lines. If it ends up there and there are no response received while it is, it waits until the timeout.&lt;/p&gt;

&lt;p&gt;Why would the node not be ready? I saw the following log line as bit before:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
17:21:09 [30mTRACE[m [KAFKA] NetworkClient - [Producer clientId=my-cluster-1-core-StreamThread-1-producer, transactionalId=my-cluster-core-00000001-0000-0000-0000-000000000000-1] Connection to node 1 is throttled &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 13 ms until timestamp 1729038069730&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It means that the connection was throttled. In client.ready, we check the throttle time and consider the node not ready if the throttle time has not passed yet.&lt;/p&gt;

&lt;p&gt;So my suspicion is that the node was not ready due to the throttle time so it ended up waiting in poll for the request timeout.&lt;/p&gt;</comment>
                            <comment id="17890492" author="JIRAUSER301663" created="Thu, 17 Oct 2024 15:35:30 +0000"  >&lt;p&gt;I have a patch that appears to fix this problem. We will soak it; if it works then I&apos;ll open a PR and request help with unit tests.&lt;/p&gt;</comment>
                            <comment id="17892293" author="mjsax" created="Wed, 23 Oct 2024 20:34:20 +0000"  >&lt;p&gt;Should we update this ticket &quot;component&quot; field to `producer` ?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 2 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1r5w0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>