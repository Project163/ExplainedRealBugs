<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:28:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-12925] prefixScan missing from intermediate interfaces</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-12925</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-614%3A+Add+Prefix+Scan+support+for+State+Stores&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;KIP-614&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-10648&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;KAFKA-10648&lt;/a&gt; introduced support for &lt;tt&gt;prefixScan&lt;/tt&gt; to StateStores.&lt;/p&gt;

&lt;p&gt;It seems that many of the intermediate &lt;tt&gt;StateStore&lt;/tt&gt; interfaces are missing a definition for &lt;tt&gt;prefixScan&lt;/tt&gt;, and as such is not accessible in all cases.&lt;/p&gt;

&lt;p&gt;For example, when accessing the state stores through a the processor context, the &lt;tt&gt;KeyValueStoreReadWriteDecorator&lt;/tt&gt; and associated interfaces do not define &lt;tt&gt;prefixScan&lt;/tt&gt; and it falls back to the default implementation in &lt;tt&gt;KeyValueStore&lt;/tt&gt;, which throws &lt;tt&gt;UnsupportedOperationException&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13383060">KAFKA-12925</key>
            <summary>prefixScan missing from intermediate interfaces</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sagarrao">Sagar Rao</assignee>
                                    <reporter username="mviamari">Michael Viamari</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Jun 2021 23:27:07 +0000</created>
                <updated>Thu, 15 Jul 2021 02:17:44 +0000</updated>
                            <resolved>Thu, 15 Jul 2021 02:17:34 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>2.8.1</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17360467" author="mjsax" created="Wed, 9 Jun 2021 23:44:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sagarrao&quot; class=&quot;user-hover&quot; rel=&quot;sagarrao&quot;&gt;sagarrao&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cadonna&quot; class=&quot;user-hover&quot; rel=&quot;cadonna&quot;&gt;cadonna&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; &#8211; I had a quick look into this, and it seems `prefixScan` is fundamentally &quot;broken&quot; and unusable?&lt;/p&gt;

&lt;p&gt;We have a lot of internal &quot;wrapper&quot; classes that implement the base interface and none of them implements the new method to forward the corresponding calls... Seems having a default implementation hid this issue on the original PR...&lt;/p&gt;</comment>
                            <comment id="17360472" author="ableegoldman" created="Thu, 10 Jun 2021 00:50:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sagarrao&quot; class=&quot;user-hover&quot; rel=&quot;sagarrao&quot;&gt;sagarrao&lt;/a&gt;&#160;do you think you&apos;ll be able to get in a fix for this in the next few weeks? It would be good to have this working in full capacity by 3.0&lt;/p&gt;

&lt;p&gt;(I wouldn&apos;t consider it a blocker for 3.0, but we have enough time before code freeze that this should not be an issue, provided someone can pick it up)&lt;/p&gt;</comment>
                            <comment id="17360497" author="sagarrao" created="Thu, 10 Jun 2021 02:20:49 +0000"  >&lt;p&gt;Sure &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt; I have assigned it to myself. Will take it up.&lt;/p&gt;

&lt;p&gt;TBH I did struggle to figure out where all should this method be implemented and having a default implementation masked the misses. What I will do is, find all places where a method like range() has been implemented and try to add it there if I can. Would that work?&lt;/p&gt;</comment>
                            <comment id="17360548" author="mjsax" created="Thu, 10 Jun 2021 04:45:18 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sagarrao&quot; class=&quot;user-hover&quot; rel=&quot;sagarrao&quot;&gt;sagarrao&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;Maybe the easiest way is to remove the default implementation and see where it fails to compile. After all issues are fixed and it compiles again you can add back the default implementation. Me might also want to add more tests?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mviamari&quot; class=&quot;user-hover&quot; rel=&quot;mviamari&quot;&gt;mviamari&lt;/a&gt;&#160;Could you share the code that triggered the issue as a starting point for writing tests?&lt;/p&gt;</comment>
                            <comment id="17361062" author="mviamari" created="Thu, 10 Jun 2021 16:17:19 +0000"  >&lt;p&gt;I can flesh out a larger example if needed, but the basic usage for me was getting a reference to the state store using &lt;tt&gt;context.getStateStore()&lt;/tt&gt; inside &lt;tt&gt;Transformer#init&lt;/tt&gt;, and then when attempting to use &lt;tt&gt;TimestampedKeyValueStore#prefixScan&lt;/tt&gt;, the exception was thrown.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TransformerPrefixScan&amp;lt;K, V, KS, VS&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Transformer&amp;lt;K, V, KeyValue&amp;lt;K, V&amp;gt;&amp;gt; {

        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; ProcessorContext context;
        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; TimestampedKeyValueStore&amp;lt;KS, VS&amp;gt; lookupStore;

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; TransformerPrefixScan() {}

        @Override
        @SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;)
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void init(ProcessorContext context) {
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.context = context;
            lookupStore = context.getStateStore(lookupStoreName);
        }

        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; KeyValue&amp;lt;K, V&amp;gt; transform(K key, V value) {

            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; keyPrefix = extractPrefix(key);
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (KeyValueIterator&amp;lt;KS, ValueAndTimestamp&amp;lt;VS&amp;gt;&amp;gt; lookupIterator = lookupStore.prefixScan(keyPrefix, Serdes.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;())) {
                &lt;span class=&quot;code-comment&quot;&gt;//....handle results....
&lt;/span&gt;            }

            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        }

        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void close() {

        }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17362587" author="sagarrao" created="Sun, 13 Jun 2021 18:48:36 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mviamari&quot; class=&quot;user-hover&quot; rel=&quot;mviamari&quot;&gt;mviamari&lt;/a&gt;&#160;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt;: I have created a PR with the implementations for the remaining classes. Now, only 2 test classes are missing namely&#160;GenericInMemoryKeyValueStore and&#160;GenericInMemoryTimestampedKeyValueStore. For them, it will be difficult to add the implementation. Plz review.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0rtk8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>