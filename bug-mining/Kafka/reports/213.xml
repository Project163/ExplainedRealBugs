<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:37:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-604] Add missing metrics in 0.8</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-604</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;It would be good if we add the following metrics:&lt;/p&gt;

&lt;p&gt;Producer: droppedMessageRate per topic&lt;/p&gt;

&lt;p&gt;ReplicaManager: partition count on the broker&lt;/p&gt;

&lt;p&gt;FileMessageSet: logFlushTimer per log (i.e., partition). Also, logFlushTime should probably be moved to LogSegment since the flush now includes index flush time.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12615350">KAFKA-604</key>
            <summary>Add missing metrics in 0.8</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="swapnilghike">Swapnil Ghike</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                            <label>p2</label>
                    </labels>
                <created>Thu, 8 Nov 2012 16:59:35 +0000</created>
                <updated>Tue, 26 Feb 2013 20:46:01 +0000</updated>
                            <resolved>Mon, 25 Feb 2013 17:33:57 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="13493636" author="yeyangever" created="Fri, 9 Nov 2012 00:27:23 +0000"  >
&lt;p&gt;1. Creating a KafkaTimer.time static function which takes a functor and (variable length) timers as input to support multiple timer.&lt;/p&gt;

&lt;p&gt;2. add per-partition log flush timer.&lt;/p&gt;

&lt;p&gt;3. make the log flush the time of flushing both the index and  data log&lt;/p&gt;</comment>
                            <comment id="13493656" author="jjkoshy" created="Fri, 9 Nov 2012 01:14:05 +0000"  >&lt;p&gt;Looks good overall. Some initial comments:&lt;/p&gt;

&lt;p&gt;KafkaTimer:&lt;br/&gt;
I see why you needed to add the Seq-based time method: to update a specific and&lt;br/&gt;
a global timer at one shot. However, we should still keep the previous (class)&lt;br/&gt;
method because: the new method is slightly clunky to use  (in having to wrap&lt;br/&gt;
everything around the function call parentheses). The main goal of that method&lt;br/&gt;
was convenience - or the user could directly deal with the timer and its&lt;br/&gt;
context. So can you restore that code and just use the new object method where&lt;br/&gt;
you need it?&lt;/p&gt;

&lt;p&gt;With the above, the following can be reverted:&lt;br/&gt;
SimpleConsumer&lt;br/&gt;
KafkaController&lt;br/&gt;
ReplicaStateMachine&lt;br/&gt;
SyncProducer&lt;br/&gt;
KafkaTimerTest (although we should additionally exercise your new object&lt;br/&gt;
method).&lt;/p&gt;

&lt;p&gt;Log.scala:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Can you break line 488?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13493674" author="jjkoshy" created="Fri, 9 Nov 2012 02:02:06 +0000"  >&lt;p&gt;Couple other options that we discussed offline for KafkaTimer:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add the new multi-timer code to the object level&lt;/li&gt;
	&lt;li&gt;Since the most common (only?) use-case is updating a specific and a global timer, have an additional Option&lt;span class=&quot;error&quot;&gt;&amp;#91;Timer&amp;#93;&lt;/span&gt; for the global timer in the constructor that defaults to None&lt;/li&gt;
	&lt;li&gt;Currying. e.g.,&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  def timeWith&lt;span class=&quot;error&quot;&gt;&amp;#91;A&amp;#93;&lt;/span&gt;(timers: Timer*)(f: =&amp;gt; A) = {&lt;br/&gt;
    val ctxSeq = timers.map(_.time())&lt;br/&gt;
    try &lt;/p&gt;
{
      f
    }
&lt;p&gt;    finally &lt;/p&gt;
{
      ctxSeq.foreach(_.stop())
    }
&lt;p&gt;  }&lt;/p&gt;

&lt;p&gt;  and usage would be KafkaTimer.timeWith(specificTimer, globalTimer) &lt;/p&gt;
{ // block of code to time }

&lt;p&gt;Clearly I&apos;m obsessive compulsive &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; but I think it would be good to avoid breaking the clean user-side syntax that the existing API allows.&lt;/p&gt;</comment>
                            <comment id="13506018" author="yeyangever" created="Wed, 28 Nov 2012 22:51:39 +0000"  >&lt;p&gt;rebased patch&lt;/p&gt;</comment>
                            <comment id="13528095" author="junrao" created="Mon, 10 Dec 2012 17:44:00 +0000"  >&lt;p&gt;The patch no longer applies. We should probably also add the following metrics in the Producer:&lt;br/&gt;
1. Serialization time: time to encoder each event.&lt;br/&gt;
2. Handle time: time to handle one or a batch of events, which includes serialization time, request sending time, and retry time.&lt;/p&gt;</comment>
                            <comment id="13528116" author="yeyangever" created="Mon, 10 Dec 2012 18:13:20 +0000"  >&lt;p&gt;Sure, I&apos;ll do that soon&lt;/p&gt;

&lt;p&gt;Best,&lt;br/&gt;
-----------------------&lt;br/&gt;
Victor Yang Ye&lt;br/&gt;
+1(650)283-6547&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.linkedin.com/pub/victor-yang-ye/13/ba3/4b8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.linkedin.com/pub/victor-yang-ye/13/ba3/4b8&lt;/a&gt;&amp;lt;&lt;a href=&quot;http://www.linkedin.com/profile/view?id=47740172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.linkedin.com/profile/view?id=47740172&lt;/a&gt;&amp;gt;&lt;br/&gt;
&lt;a href=&quot;http://www.facebook.com/yeyangever&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.facebook.com/yeyangever&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Founder   Uyan.cc&lt;br/&gt;
Software Engineer in Distributed Data System Group, LinkedIn Corporation&lt;br/&gt;
Dept. of Computer Science, Graduate School of Art and Scient, Columbia&lt;br/&gt;
University&lt;br/&gt;
Special Pilot Computer Science Class, Tsinghua University&lt;/p&gt;

&lt;p&gt;yeyangever@gmail.com&lt;br/&gt;
yye@linkedin.com&lt;br/&gt;
yy2314@columbia.edu&lt;/p&gt;



</comment>
                            <comment id="13529584" author="yeyangever" created="Wed, 12 Dec 2012 02:57:25 +0000"  >

&lt;p&gt;1. rebased&lt;/p&gt;

&lt;p&gt;2. add new timer metrics&lt;/p&gt;


&lt;p&gt;unit tests passed and the new timer mBeans are verified. &lt;/p&gt;

&lt;p&gt;This patch had better be checked in earlier as it touches quite a few files whose future changes may need furhur rebase&lt;/p&gt;
</comment>
                            <comment id="13529626" author="swapnilghike" created="Wed, 12 Dec 2012 05:22:19 +0000"  >&lt;p&gt;Wow, this is going to be fun. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Unfortunately patch v3 here has a lot of conflicts with patch v5 at &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-646&quot; title=&quot;Provide aggregate stats at the high level Producer and ZookeeperConsumerConnector level&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-646&quot;&gt;&lt;del&gt;KAFKA-646&lt;/del&gt;&lt;/a&gt; where I have done a wholesale reorganization of metrics. The conflicts are mostly in the use of KafkaTimer.&lt;/p&gt;

&lt;p&gt;I agree that having a KafkaTimer object might be more efficient at runtime, but the tradeoff is that it changes the syntax of time measurement with some instances where we will need to pass in (&lt;/p&gt;
{a bunch of statements spread out over multiple lines in a block}
&lt;p&gt;, timer).&lt;/p&gt;

&lt;p&gt;Victor, can you take a look at patch v5 at the other jira and see which style of time measurement you prefer?&lt;/p&gt;

&lt;p&gt;Perhaps Joel can also comment on the syntax changes. &lt;/p&gt;</comment>
                            <comment id="13530165" author="jjkoshy" created="Wed, 12 Dec 2012 18:06:51 +0000"  >&lt;p&gt;The rebased patch does not really comment on/address the concern in the original review - i.e., it breaks a relatively clean&lt;br/&gt;
and convenient syntax in the common case (of updating a single timer) to support updates to multiple timers. It&apos;s obviously&lt;br/&gt;
not a particularly major issue, but a rung higher than say, a debate over whitespace/coding style. My only point is that we&lt;br/&gt;
should try and avoid making a change that goes from a nice syntax to a rather inconvenient syntax. For that reason, I&apos;m&lt;br/&gt;
more in favor of the change to KafkaTimer in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-646&quot; title=&quot;Provide aggregate stats at the high level Producer and ZookeeperConsumerConnector level&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-646&quot;&gt;&lt;del&gt;KAFKA-646&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;That said, how about the following: both these patches need multiple timer updates to update an aggregate timer as well&lt;br/&gt;
as a specific timer - i.e., up to this point we don&apos;t really have a use case for updating more than two timers simultaneously.&lt;br/&gt;
So we can accomplish this case with the following:&lt;/p&gt;

&lt;p&gt;aggregatekafkatimer.time {&lt;br/&gt;
  specifickafkatimer.time &lt;/p&gt;
{
    &amp;lt;code block&amp;gt;
  }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;and avoid any change to KafkaTimer. Does that seem reasonable to you guys?&lt;/p&gt;</comment>
                            <comment id="13530200" author="swapnilghike" created="Wed, 12 Dec 2012 18:45:56 +0000"  >&lt;p&gt;Yes I like this idea, can follow this in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-646&quot; title=&quot;Provide aggregate stats at the high level Producer and ZookeeperConsumerConnector level&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-646&quot;&gt;&lt;del&gt;KAFKA-646&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13530223" author="yeyangever" created="Wed, 12 Dec 2012 19:15:19 +0000"  >&lt;p&gt;Joel, thanks for the idea, it&apos;s good and I will do a new patch&lt;/p&gt;

&lt;p&gt;Sent from my iPhone&lt;/p&gt;

</comment>
                            <comment id="13580890" author="junrao" created="Mon, 18 Feb 2013 23:15:21 +0000"  >&lt;p&gt;This patch no longer applies. Thinking a bit. We probably just need to get the following stats in jmx. The per topic level flush time is probably overkill.&lt;/p&gt;

&lt;p&gt;Producer: droppedMessageRate per topic &lt;/p&gt;

&lt;p&gt;ReplicaManager: partition count on the broker &lt;/p&gt;</comment>
                            <comment id="13580946" author="junrao" created="Tue, 19 Feb 2013 01:28:16 +0000"  >&lt;p&gt;Also, in ProducerSendThread, we should get rid of the thread id part from the jmx bean name.&lt;br/&gt;
  newGauge(clientId + &quot;&lt;del&gt;ProducerQueueSize&lt;/del&gt;&quot; + getId,&lt;br/&gt;
          new Gauge&lt;span class=&quot;error&quot;&gt;&amp;#91;Int&amp;#93;&lt;/span&gt; &lt;/p&gt;
{
            def getValue = queue.size
          }
&lt;p&gt;)&lt;/p&gt;</comment>
                            <comment id="13581160" author="swapnilghike" created="Tue, 19 Feb 2013 09:45:04 +0000"  >&lt;p&gt;I can do this after finishing &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-755&quot; title=&quot;standardizing json values stored in ZK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-755&quot;&gt;&lt;del&gt;KAFKA-755&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13584951" author="swapnilghike" created="Sat, 23 Feb 2013 02:04:41 +0000"  >&lt;p&gt;Added droppedMessageRate per topic in Producer, partition count on the broker in ReplicaManager. &lt;/p&gt;

&lt;p&gt;Moved droppedMessageRate to per-topic stats, the droppedMessageRate for all topics together is now provided by allTopicsStats in ProducerTopicStats.&lt;/p&gt;

&lt;p&gt;Removed the thread id from ProducerQueueSize guage.&lt;/p&gt;</comment>
                            <comment id="13584965" author="swapnilghike" created="Sat, 23 Feb 2013 02:38:06 +0000"  >&lt;p&gt;Thanks Jun for observing that &quot;All.Topics&quot; does not uniquely identify all topics&apos; stats from stats for a topic called All.Topics.&lt;/p&gt;

&lt;p&gt;Made a change so that the stats for all topics will look like &quot;AllTopicsMessagesPerSec&quot;, and those for a topic called AllTopics will look like &quot;AllTopics-MessagesPerSec&quot;. Same change for All.Brokers too.&lt;/p&gt;</comment>
                            <comment id="13586029" author="junrao" created="Mon, 25 Feb 2013 17:33:57 +0000"  >&lt;p&gt;Thanks for the latest patch. Committed to 0.8.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12570594" name="kafka-604-new-v2.patch" size="16921" author="swapnilghike" created="Sat, 23 Feb 2013 02:38:06 +0000"/>
                            <attachment id="12570588" name="kafka-604-new.patch" size="6101" author="swapnilghike" created="Sat, 23 Feb 2013 02:04:41 +0000"/>
                            <attachment id="12552740" name="kafka_604_v1.patch" size="12275" author="yeyangever" created="Fri, 9 Nov 2012 00:27:23 +0000"/>
                            <attachment id="12555263" name="kafka_604_v2.patch" size="12162" author="yeyangever" created="Wed, 28 Nov 2012 22:51:39 +0000"/>
                            <attachment id="12560497" name="kafka_604_v3.diff" size="17674" author="yeyangever" created="Wed, 12 Dec 2012 02:57:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255985</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0gp1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95489</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>