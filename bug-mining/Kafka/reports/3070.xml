<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:28:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-12305] Flatten SMT fails on arrays</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-12305</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The &lt;tt&gt;Flatten&lt;/tt&gt; SMT fails for array types. A sophisticated approach that tries to flatten arrays might be desirable in some cases, and may have been punted during the early design phase of the transform, but in the interim, it&apos;s probably not worth it to make array data and the SMT mutually exclusive.&lt;/p&gt;

&lt;p&gt;A naive approach that preserves arrays as-are and doesn&apos;t attempt to flatten them seems fair for now, but one alternative could be to traverse array elements and, if any are maps or structs, flatten those as well.&lt;/p&gt;

&lt;p&gt;Adding behavior to fully flatten arrays by essentially transforming them into maps whose elements are the elements of the array and whose keys are the indices of each element is likely out of scope for a bug fix and, although useful, might have to wait for a KIP.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13357207">KAFKA-12305</key>
            <summary>Flatten SMT fails on arrays</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ChrisEgerton">Chris Egerton</assignee>
                                    <reporter username="ChrisEgerton">Chris Egerton</reporter>
                        <labels>
                    </labels>
                <created>Sat, 6 Feb 2021 02:53:13 +0000</created>
                <updated>Thu, 23 Jun 2022 23:12:20 +0000</updated>
                            <resolved>Thu, 23 Jun 2022 23:12:20 +0000</resolved>
                                    <version>2.0.1</version>
                    <version>2.1.1</version>
                    <version>2.2.2</version>
                    <version>2.3.1</version>
                    <version>2.4.1</version>
                    <version>2.5.1</version>
                    <version>2.6.1</version>
                    <version>2.7.0</version>
                    <version>2.8.0</version>
                                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17281246" author="rhauch" created="Mon, 8 Feb 2021 17:34:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ChrisEgerton&quot; class=&quot;user-hover&quot; rel=&quot;ChrisEgerton&quot;&gt;ChrisEgerton&lt;/a&gt; wrote:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;A naive approach that preserves arrays as-are and doesn&apos;t attempt to flatten them seems fair for now, but one alternative could be to traverse array elements and, if any are maps or structs, flatten those as well.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1 for this behavior. Here&apos;s my thought process:&lt;/p&gt;

&lt;p&gt;The `Flatten` transform documentation (&lt;a href=&quot;https://github.com/apache/kafka/blob/8bd5ceb3d297bd6cd06ccec52978315898719e6d/connect/transforms/src/main/java/org/apache/kafka/connect/transforms/Flatten.java#L43-L45&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;source&lt;/a&gt;) says:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Flatten a nested data structure, generating names for each field by concatenating the field names at each level with a configurable delimiter character. Applies to a Struct when a schema is present, or a Map in the case of schemaless data.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;IMO, this explains the intention: flatten nested `Struct` instances if using a schema(e.g., flatten the Struct fields of a record&apos;s key/value Struct) or nested `Map` instances if using a schemaless key/value. &lt;/p&gt;

&lt;p&gt;Nowhere does it mention that arrays are flattened into a separate field for each element in the array.&lt;/p&gt;

&lt;p&gt;For example, consider this record key or value (with a top-level schema that has 4 fields, one of which is a struct with 3 fields):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;f1&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;field 1 value&quot;&lt;/span&gt;,           &lt;span class=&quot;code-comment&quot;&gt;// field with string schema
&lt;/span&gt;  &lt;span class=&quot;code-quote&quot;&gt;&quot;f2&quot;&lt;/span&gt;: {                          &lt;span class=&quot;code-comment&quot;&gt;// field with struct schema containing 3 fields
&lt;/span&gt;    &lt;span class=&quot;code-quote&quot;&gt;&quot;nestedInt&quot;&lt;/span&gt;: 0,                &lt;span class=&quot;code-comment&quot;&gt;// field with int32 schema
&lt;/span&gt;    &lt;span class=&quot;code-quote&quot;&gt;&quot;nestedString&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;nested&quot;&lt;/span&gt;,      &lt;span class=&quot;code-comment&quot;&gt;// field with string schema
&lt;/span&gt;    &lt;span class=&quot;code-quote&quot;&gt;&quot;nestedArray&quot;&lt;/span&gt;: [ &lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;v2&quot;&lt;/span&gt; ]  &lt;span class=&quot;code-comment&quot;&gt;// field with array(string) schema
&lt;/span&gt;  },
  &lt;span class=&quot;code-quote&quot;&gt;&quot;f3&quot;&lt;/span&gt;: [ &lt;span class=&quot;code-quote&quot;&gt;&quot;e1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;e2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;e3&quot;&lt;/span&gt; ],      &lt;span class=&quot;code-comment&quot;&gt;// field with array(string) schema
&lt;/span&gt;  &lt;span class=&quot;code-quote&quot;&gt;&quot;f4&quot;&lt;/span&gt;: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&amp;gt;      &lt;span class=&quot;code-comment&quot;&gt;// field with optional float32 schema
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Using what you mention as the &quot;naive approach&quot;, Flatten applied to the record key/value described above should produce the following key or value (with a schema that has 5 fields):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-quote&quot;&gt;&quot;f1&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;field 1 value&quot;&lt;/span&gt;,            &lt;span class=&quot;code-comment&quot;&gt;// field with string schema
&lt;/span&gt;  &lt;span class=&quot;code-quote&quot;&gt;&quot;f2.nestedInt&quot;&lt;/span&gt;: 0,                &lt;span class=&quot;code-comment&quot;&gt;// field with int32 schema
&lt;/span&gt;  &lt;span class=&quot;code-quote&quot;&gt;&quot;f2.nestedString&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;nested&quot;&lt;/span&gt;,      &lt;span class=&quot;code-comment&quot;&gt;// field with string schema
&lt;/span&gt;  &lt;span class=&quot;code-quote&quot;&gt;&quot;f2.nestedArray&quot;&lt;/span&gt;: [ &lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;v2&quot;&lt;/span&gt; ]  &lt;span class=&quot;code-comment&quot;&gt;// field with array(string) schema
&lt;/span&gt;  &lt;span class=&quot;code-quote&quot;&gt;&quot;f3&quot;&lt;/span&gt;: [ &lt;span class=&quot;code-quote&quot;&gt;&quot;e1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;e2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;e3&quot;&lt;/span&gt; ],       &lt;span class=&quot;code-comment&quot;&gt;// field with array(string) schema
&lt;/span&gt;  &lt;span class=&quot;code-quote&quot;&gt;&quot;f4&quot;&lt;/span&gt;: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&amp;gt;                      &lt;span class=&quot;code-comment&quot;&gt;// field with optional float32 schema&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that the arrays are &lt;b&gt;&lt;em&gt;not&lt;/em&gt;&lt;/b&gt; expanded into separate fields for each element. This makes sense to me and aligns with the previously mentioned documentation for the Flatten SMT.&lt;/p&gt;</comment>
                            <comment id="17281258" author="chrisegerton" created="Mon, 8 Feb 2021 17:49:00 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhauch&quot; class=&quot;user-hover&quot; rel=&quot;rhauch&quot;&gt;rhauch&lt;/a&gt;. Do you have thoughts on whether elements inside arrays should themselves be flattened? For example, with this input:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;f1&quot;&lt;/span&gt;: [
    {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;f2&quot;&lt;/span&gt;: {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;f3&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;
      }
    }
  ]
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;should the output be this (option A):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;f1&quot;&lt;/span&gt;: [
    {&lt;span class=&quot;code-quote&quot;&gt;&quot;f2.f3&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;}
  ]
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;or this (option B):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;f1&quot;&lt;/span&gt;: [
    {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;f2&quot;&lt;/span&gt;: {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;f3&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;v1&quot;&lt;/span&gt;
      }
    }
  ]
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;m leaning toward option A since, as you noted, the SMT definition deals explicitly with structs and maps, and makes no distinction about whether they&apos;re in arrays or top-level.&lt;/p&gt;</comment>
                            <comment id="17281295" author="rhauch" created="Mon, 8 Feb 2021 18:47:31 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Do you have thoughts on whether elements inside arrays should themselves be flattened? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think it&apos;s arguable whether Flatten should flatten structs/maps &lt;b&gt;with&lt;/b&gt; arrays. My initial thought is that it should not because the documentation does not mention arrays, and because it&apos;s not clear to me how often that case will come up. &lt;/p&gt;

&lt;p&gt;I&apos;m definitely open to suggestions from others, though!&lt;/p&gt;</comment>
                            <comment id="17282492" author="chrisegerton" created="Wed, 10 Feb 2021 14:47:18 +0000"  >&lt;p&gt;I think the fact that the documentation doesn&apos;t call out arrays could go both ways, though&#8211;maps and structs are still maps and structs, regardless of whether they&apos;re top-level or contained in an array.&lt;/p&gt;

&lt;p&gt;However, the wording in the docs is that the SMT will &quot;Flatten &lt;b&gt;a&lt;/b&gt; nested data structure&quot; (emphasis mine). The singular &quot;a&quot; there implies only one such nested data structure. Considering that the SMT only accepts top-level map/struct values, I think that gives enough weight to the position that &lt;tt&gt;Flatten&lt;/tt&gt;&#160;should only concern itself with that top-level nested map/struct and, after encountering something it cannot flatten (i.e., an array or a primitive), stop descending further.&lt;/p&gt;

&lt;p&gt;In other words, I&apos;m also satisfied with the naive approach (option B outlined above).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If this causes anyone difficulty down the road, they have plenty of options, including forking the open-source &lt;tt&gt;Flatten&lt;/tt&gt; SMT,&#160;writing their own SMT from scratch, and publishing a KIP to alter the behavior of &lt;tt&gt;Flatten&lt;/tt&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nfog:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>