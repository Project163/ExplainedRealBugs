<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:37:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-16198] Reconciliation may lose partitions when topic metadata is delayed</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-16198</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The current reconciliation code in `AsyncKafkaConsumer`s `MembershipManager` may lose part of the server-provided assignment when metadata is delayed. The reason is incorrect handling of partially resolved topic names, as in this example:&lt;/p&gt;

&lt;p&gt;&#160;* We get assigned&#160;&lt;tt&gt;T1-1&lt;/tt&gt;&#160;and&#160;&lt;tt&gt;T2-1&lt;/tt&gt;&lt;br/&gt;
&#160;* We reconcile&#160;&lt;tt&gt;T1-1&lt;/tt&gt;,&#160;&lt;tt&gt;T2-1&lt;/tt&gt;&#160;remains in&#160;&lt;tt&gt;assignmentUnresolved&lt;/tt&gt;&#160;since the topic id&#160;&lt;tt&gt;T2&lt;/tt&gt; is not known yet&lt;br/&gt;
&#160;* We get new cluster metadata, which includes&#160;&lt;tt&gt;T2&lt;/tt&gt;, so&#160;&lt;tt&gt;T2-1&lt;/tt&gt;&#160;is moved to&#160;&lt;tt&gt;assignmentReadyToReconcile&lt;/tt&gt;&lt;br/&gt;
&#160;* We call&#160;&lt;tt&gt;reconcile&lt;/tt&gt;&#160;--&#160;&lt;tt&gt;T2-1&lt;/tt&gt;&#160;is now treated as the full assignment, so&#160;&lt;tt&gt;T1-1&lt;/tt&gt;&#160;is being revoked&lt;br/&gt;
&#160;* We end up with assignment&#160;&lt;tt&gt;T2-1, which is inconsistent with the broker-side target assignment.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Generally, this seems to be a problem around semantics of the internal collections `assignmentUnresolved` and `assignmentReadyToReconcile`. Absence of a topic in `assignmentReadyToReconcile` may mean either revocation of the topic partition(s), or unavailability of a topic name for the topic.&lt;/p&gt;

&lt;p&gt;Internal state with simpler and correct invariants could be achieved by using a single collection `currentTargetAssignment` which is based on topic IDs and always corresponds to the latest assignment received from the broker. During every attempted reconciliation, all topic IDs will be resolved from the local cache, which should not introduce a lot of overhead. `assignmentUnresolved` and `assignmentReadyToReconcile` are removed.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13566273">KAFKA-16198</key>
            <summary>Reconciliation may lose partitions when topic metadata is delayed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lucasbru">Lucas Brutschy</assignee>
                                    <reporter username="lucasbru">Lucas Brutschy</reporter>
                        <labels>
                            <label>client-transitions-issues</label>
                            <label>kip-848-client-support</label>
                    </labels>
                <created>Fri, 26 Jan 2024 09:48:46 +0000</created>
                <updated>Mon, 19 Feb 2024 10:05:14 +0000</updated>
                            <resolved>Thu, 1 Feb 2024 07:56:44 +0000</resolved>
                                                    <fixVersion>3.8.0</fixVersion>
                                    <component>clients</component>
                    <component>consumer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 41 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1n0s8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>