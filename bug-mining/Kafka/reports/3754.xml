<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:38:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-16556] SubscriptionState should not prematurely reset &apos;pending&apos; partitions</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-16556</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;There appears to be a race condition between invoking the&#160;&lt;tt&gt;ConsumerRebalanceListener&lt;/tt&gt;&#160;callbacks on reconciliation and&#160;&lt;tt&gt;initWithCommittedOffsetsIfNeeded&lt;/tt&gt;&#160;in the consumer.&lt;br/&gt;
&#160;&lt;br/&gt;
The membership manager adds the newly assigned partitions to the&#160;&lt;tt&gt;SubscriptionState&lt;/tt&gt;, but marks them as&#160;&lt;tt&gt;pendingOnAssignedCallback&lt;/tt&gt;. Then, after the&#160;&lt;tt&gt;ConsumerRebalanceListener.onPartitionsAssigned()&lt;/tt&gt;&#160;completes, the membership manager will invoke&#160;&lt;tt&gt;enablePartitionsAwaitingCallback&lt;/tt&gt;&#160;to set all of those partitions&apos; &apos;pending&apos; flag to false.&lt;br/&gt;
&#160;&lt;br/&gt;
During the main&#160;&lt;tt&gt;Consumer.poll()&lt;/tt&gt;&#160;loop,&#160;&lt;tt&gt;AsyncKafkaConsumer&lt;/tt&gt;&#160;may need to call&#160;&lt;tt&gt;initWithCommittedOffsetsIfNeeded()&lt;/tt&gt;&#160;if the positions aren&apos;t already cached. Inside&#160;&lt;tt&gt;initWithCommittedOffsetsIfNeeded&lt;/tt&gt;, the consumer calls the subscription&apos;s&#160;&lt;tt&gt;initializingPartitions&lt;/tt&gt;&#160;method to get a set of the partitions for which to fetch their committed offsets. However,&#160;&lt;tt&gt;SubscriptionState.initializingPartitions()&lt;/tt&gt;&#160;only returns partitions that have the&#160;&lt;tt&gt;pendingOnAssignedCallback&lt;/tt&gt;&#160;flag set to to false.&lt;br/&gt;
&#160;&lt;br/&gt;
The result is:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If the &lt;tt&gt;MembershipManagerImpl.assignPartitions()&lt;/tt&gt; future&#160; is completed on the background thread first, the &apos;pending&apos; flag is set to false. On the application thread, when &lt;tt&gt;SubscriptionState.initializingPartitions()&lt;/tt&gt;&#160;is called, it returns the partition, and we fetch its committed offsets&lt;/li&gt;
	&lt;li&gt;If instead the application thread calls&#160;&lt;tt&gt;SubscriptionState.initializingPartitions()&lt;/tt&gt;&#160;first, the partitions&apos;s &apos;pending&apos; flag is still set to false, and so the partition is omitted from the returned set. The&#160;&lt;tt&gt;updateFetchPositions()&lt;/tt&gt;&#160;method then continues on and re-initializes the partition&apos;s fetch offset to 0.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13575914">KAFKA-16556</key>
            <summary>SubscriptionState should not prematurely reset &apos;pending&apos; partitions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kirktrue">Kirk True</assignee>
                                    <reporter username="kirktrue">Kirk True</reporter>
                        <labels>
                            <label>kip-848-client-support</label>
                    </labels>
                <created>Mon, 15 Apr 2024 18:41:29 +0000</created>
                <updated>Tue, 16 Apr 2024 17:08:11 +0000</updated>
                            <resolved>Tue, 16 Apr 2024 17:08:11 +0000</resolved>
                                    <version>3.7.0</version>
                                    <fixVersion>3.8.0</fixVersion>
                                    <component>clients</component>
                    <component>consumer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 30 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ondk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>lucasbru</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>