<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:03:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5733] System tests get exception RocksDBException: db has more levels than options.num_levels</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5733</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;New system tests as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5725&quot; title=&quot;Additional failure testing for streams with bouncing brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5725&quot;&gt;&lt;del&gt;KAFKA-5725&lt;/del&gt;&lt;/a&gt; with PR &lt;a href=&quot;https://github.com/apache/kafka/pull/3656&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3656&lt;/a&gt; consistently fail like this:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2017-08-14 10:37:57,216&amp;#93;&lt;/span&gt; ERROR User provided listener org.apache.kafka.streams.processor.internals.StreamThread$RebalanceListener for group SmokeTest failed on partition assignment (org.apache.kafka.clients.consumer.internals.ConsumerCoordinator)&lt;br/&gt;
org.apache.kafka.streams.errors.ProcessorStateException: Error opening store cntStoreName at location /mnt/streams/SmokeTest/2_0/rocksdb/cntStoreName&lt;br/&gt;
	at org.apache.kafka.streams.state.internals.RocksDBStore.openDB(RocksDBStore.java:206)&lt;br/&gt;
	at org.apache.kafka.streams.state.internals.RocksDBStore.openDB(RocksDBStore.java:176)&lt;br/&gt;
	at org.apache.kafka.streams.state.internals.RocksDBStore.toggleDbForBulkLoading(RocksDBStore.java:259)&lt;br/&gt;
	at org.apache.kafka.streams.state.internals.RocksDBStore.access$200(RocksDBStore.java:74)&lt;br/&gt;
	at org.apache.kafka.streams.state.internals.RocksDBStore$RocksDBBatchingRestoreCallback.onRestoreStart(RocksDBStore.java:551)&lt;br/&gt;
	at org.apache.kafka.streams.processor.internals.CompositeRestoreListener.onRestoreStart(CompositeRestoreListener.java:54)&lt;br/&gt;
	at org.apache.kafka.streams.processor.internals.StateRestorer.restoreStarted(StateRestorer.java:61)&lt;br/&gt;
	at org.apache.kafka.streams.processor.internals.StoreChangelogReader.restore(StoreChangelogReader.java:126)&lt;br/&gt;
	at org.apache.kafka.streams.processor.internals.TaskManager.createTasks(TaskManager.java:94)&lt;br/&gt;
	at org.apache.kafka.streams.processor.internals.StreamThread$RebalanceListener.onPartitionsAssigned(StreamThread.java:177)&lt;br/&gt;
	at org.apache.kafka.clients.consumer.internals.ConsumerCoordinator.onJoinComplete(ConsumerCoordinator.java:265)&lt;br/&gt;
	at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.joinGroupIfNeeded(AbstractCoordinator.java:368)&lt;br/&gt;
	at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.ensureActiveGroup(AbstractCoordinator.java:317)&lt;br/&gt;
	at org.apache.kafka.clients.consumer.internals.ConsumerCoordinator.poll(ConsumerCoordinator.java:297)&lt;br/&gt;
	at org.apache.kafka.clients.consumer.KafkaConsumer.pollOnce(KafkaConsumer.java:1078)&lt;br/&gt;
	at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:1043)&lt;br/&gt;
	at org.apache.kafka.streams.processor.internals.StreamThread.pollRequests(StreamThread.java:736)&lt;br/&gt;
	at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:707)&lt;br/&gt;
	at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:677)&lt;br/&gt;
Caused by: org.rocksdb.RocksDBException: db has more levels than options.num_levels&lt;br/&gt;
	at org.rocksdb.RocksDB.open(Native Method)&lt;br/&gt;
	at org.rocksdb.RocksDB.open(RocksDB.java:231)&lt;br/&gt;
	at org.apache.kafka.streams.state.internals.RocksDBStore.openDB(RocksDBStore.java:199)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13094464">KAFKA-5733</key>
            <summary>System tests get exception RocksDBException: db has more levels than options.num_levels</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bbejeck">Bill Bejeck</assignee>
                                    <reporter username="enothereska">Eno Thereska</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Aug 2017 13:17:50 +0000</created>
                <updated>Thu, 24 Aug 2017 03:02:30 +0000</updated>
                            <resolved>Thu, 17 Aug 2017 21:02:35 +0000</resolved>
                                    <version>0.11.0.1</version>
                                    <fixVersion>1.0.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16125708" author="bbejeck" created="Mon, 14 Aug 2017 13:59:29 +0000"  >&lt;p&gt;I&apos;ve been able to reproduce this in a unit-test.  &lt;/p&gt;

&lt;p&gt;Here is the issue.  We have an existing RocksDB store (default num levels setting of 7). When the broker goes down and reconnects a re-balance is triggered and causes a state restoration.  When we go to restore the state store, we close RocksDB,  we turn on &lt;tt&gt;options.prepareForBulkload&lt;/tt&gt; which sets the num_levels to 2 for optimized bulk loads, then re-opens the database. &lt;/p&gt;

&lt;p&gt;Then we get the error because the pre-existing data is already there with num_levels of 7, thus throwing the exception.  &lt;/p&gt;</comment>
                            <comment id="16125778" author="githubbot" created="Mon, 14 Aug 2017 14:47:33 +0000"  >&lt;p&gt;GitHub user bbejeck opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3664&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3664&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5733&quot; title=&quot;System tests get exception RocksDBException: db has more levels than options.num_levels&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5733&quot;&gt;&lt;del&gt;KAFKA-5733&lt;/del&gt;&lt;/a&gt;: ensure clean RocksDB directory before setting prepareForB&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;ulkload settings&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/bbejeck/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bbejeck/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5733&quot; title=&quot;System tests get exception RocksDBException: db has more levels than options.num_levels&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5733&quot;&gt;&lt;del&gt;KAFKA-5733&lt;/del&gt;&lt;/a&gt;_rocks_db_throws_more_than_num_levels_on_restore&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3664.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3664.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3664&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2cfc54c8e77b840acc0d176cea8eabda4d1c4b03&lt;br/&gt;
Author: Bill Bejeck &amp;lt;bill@confluent.io&amp;gt;&lt;br/&gt;
Date:   2017-08-14T14:46:08Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5733&quot; title=&quot;System tests get exception RocksDBException: db has more levels than options.num_levels&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5733&quot;&gt;&lt;del&gt;KAFKA-5733&lt;/del&gt;&lt;/a&gt;: ensure clean RocksDB directory before setting prepareForBulkload settings&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16129642" author="githubbot" created="Wed, 16 Aug 2017 23:56:01 +0000"  >&lt;p&gt;GitHub user guozhangwang opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3681&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5733&quot; title=&quot;System tests get exception RocksDBException: db has more levels than options.num_levels&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5733&quot;&gt;&lt;del&gt;KAFKA-5733&lt;/del&gt;&lt;/a&gt;: RocksDB bulk load with lower number of levels.&lt;/p&gt;

&lt;p&gt;    This is to complete Bill&apos;s PR on &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5733&quot; title=&quot;System tests get exception RocksDBException: db has more levels than options.num_levels&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5733&quot;&gt;&lt;del&gt;KAFKA-5733&lt;/del&gt;&lt;/a&gt;, incorporating the suggestion in &lt;a href=&quot;https://github.com/facebook/rocksdb/issues/2734&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/facebook/rocksdb/issues/2734&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;    Some minor changes: move `open = true` in `openDB`.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/guozhangwang/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/guozhangwang/kafka&lt;/a&gt; K5733-rocksdb-bulk-load&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3681.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3681.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3681&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2cfc54c8e77b840acc0d176cea8eabda4d1c4b03&lt;br/&gt;
Author: Bill Bejeck &amp;lt;bill@confluent.io&amp;gt;&lt;br/&gt;
Date:   2017-08-14T14:46:08Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5733&quot; title=&quot;System tests get exception RocksDBException: db has more levels than options.num_levels&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5733&quot;&gt;&lt;del&gt;KAFKA-5733&lt;/del&gt;&lt;/a&gt;: ensure clean RocksDB directory before setting prepareForBulkload settings&lt;/p&gt;

&lt;p&gt;commit f468147455c9f8eaf640f2821b7849b7b370968d&lt;br/&gt;
Author: Bill Bejeck &amp;lt;bill@confluent.io&amp;gt;&lt;br/&gt;
Date:   2017-08-14T16:57:29Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5733&quot; title=&quot;System tests get exception RocksDBException: db has more levels than options.num_levels&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5733&quot;&gt;&lt;del&gt;KAFKA-5733&lt;/del&gt;&lt;/a&gt;: address comments&lt;/p&gt;

&lt;p&gt;commit 149634b405cd5d73ec0e27c9a55b16f9971abf1f&lt;br/&gt;
Author: Bill Bejeck &amp;lt;bill@confluent.io&amp;gt;&lt;br/&gt;
Date:   2017-08-14T18:20:05Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5733&quot; title=&quot;System tests get exception RocksDBException: db has more levels than options.num_levels&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5733&quot;&gt;&lt;del&gt;KAFKA-5733&lt;/del&gt;&lt;/a&gt;: address additional comments, enforce not opening&lt;br/&gt;
    and closing if not a clean RocksDB dir on restore&lt;/p&gt;

&lt;p&gt;commit b4cd505b5c5cb9e57df4728414b5194a65d14b1c&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-16T22:17:17Z&lt;/p&gt;

&lt;p&gt;    Merge branch &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5733&quot; title=&quot;System tests get exception RocksDBException: db has more levels than options.num_levels&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5733&quot;&gt;&lt;del&gt;KAFKA-5733&lt;/del&gt;&lt;/a&gt;_rocks_db_throws_more_than_num_levels_on_restore&apos; of &lt;a href=&quot;https://github.com/bbejeck/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bbejeck/kafka&lt;/a&gt; into K5733-rocksdb-bulk-load&lt;/p&gt;

&lt;p&gt;commit d0ada11eb8e97fbd5efdfb4c66160a81970575e4&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-16T22:45:16Z&lt;/p&gt;

&lt;p&gt;    use compactRange to still enable bulk loading&lt;/p&gt;

&lt;p&gt;commit 08da1f16c8aeb587dd8b1ac7b5192f1ab3395cd7&lt;br/&gt;
Author: Guozhang Wang &amp;lt;wangguoz@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-16T23:53:02Z&lt;/p&gt;

&lt;p&gt;    minor fixes&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16130122" author="damianguy" created="Thu, 17 Aug 2017 09:00:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enothereska&quot; class=&quot;user-hover&quot; rel=&quot;enothereska&quot;&gt;enothereska&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; this is only on trunk - right? i.e., it is due to the bulkload that is not on the 0.11 branch? If true can we move it it 1.0.0?&lt;/p&gt;</comment>
                            <comment id="16130778" author="guozhang" created="Thu, 17 Aug 2017 16:37:14 +0000"  >&lt;p&gt;Yup, moved to 1.0.0&lt;/p&gt;</comment>
                            <comment id="16131292" author="guozhang" created="Thu, 17 Aug 2017 21:02:35 +0000"  >&lt;p&gt;Issue resolved by pull request 3681&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/3681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3681&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16131298" author="githubbot" created="Thu, 17 Aug 2017 21:04:30 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3681&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16131305" author="enothereska" created="Thu, 17 Aug 2017 21:06:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; thanks, do we still need &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bbejeck&quot; class=&quot;user-hover&quot; rel=&quot;bbejeck&quot;&gt;bbejeck&lt;/a&gt;&apos;s PR? &lt;/p&gt;</comment>
                            <comment id="16131353" author="guozhang" created="Thu, 17 Aug 2017 21:52:02 +0000"  >&lt;p&gt;3681 contains Bill&apos;s PR, so &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5725&quot; title=&quot;Additional failure testing for streams with bouncing brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5725&quot;&gt;&lt;del&gt;KAFKA-5725&lt;/del&gt;&lt;/a&gt; should be unblocked now.&lt;/p&gt;</comment>
                            <comment id="16139493" author="githubbot" created="Thu, 24 Aug 2017 03:02:30 +0000"  >&lt;p&gt;Github user bbejeck closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3664&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3664&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ir8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>