<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:31:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-14303] Producer.send without record key and batch.size=0 goes into infinite loop</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-14303</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;3.3 has broken previous producer behavior.&lt;/p&gt;

&lt;p&gt;A call to &lt;tt&gt;producer.send(record)&lt;/tt&gt; with a record without a key and configured with &lt;tt&gt;batch.size=0&lt;/tt&gt; never returns.&lt;/p&gt;

&lt;p&gt;Reproducer:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ProducerIssueTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; IntegrationTestHarness {
  override &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; def brokerCount = 1
  @Test
  def testProduceWithBatchSizeZeroAndNoRecordKey(): Unit = {
    val topicName = &lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;
    createTopic(topicName)
    val overrides = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties
    overrides.put(ProducerConfig.BATCH_SIZE_CONFIG, 0)
    val producer = createProducer(keySerializer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringSerializer, valueSerializer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringSerializer, overrides)
    val record = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProducerRecord[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;](topicName, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;hello&quot;&lt;/span&gt;)
    val &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; = producer.send(record) &lt;span class=&quot;code-comment&quot;&gt;// goes into infinite loop here
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;.get(10, TimeUnit.SECONDS)
  }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org/documentation/#producerconfigs_batch.size&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Documentation for producer configuration&lt;/a&gt; states &lt;tt&gt;batch.size=0&lt;/tt&gt; as a valid value:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Valid Values: &lt;span class=&quot;error&quot;&gt;&amp;#91;0,...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;and recommends its use directly:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;A small batch size will make batching less common and may reduce throughput (a batch size of zero will disable batching entirely).&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="13486307">KAFKA-14303</key>
            <summary>Producer.send without record key and batch.size=0 goes into infinite loop</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="soarez">Igor Soarez</assignee>
                                    <reporter username="soarez">Igor Soarez</reporter>
                        <labels>
                            <label>Partitioner</label>
                            <label>bug</label>
                            <label>client</label>
                            <label>producer</label>
                            <label>regresion</label>
                    </labels>
                <created>Fri, 14 Oct 2022 10:24:55 +0000</created>
                <updated>Tue, 27 Dec 2022 01:32:59 +0000</updated>
                            <resolved>Mon, 28 Nov 2022 19:25:14 +0000</resolved>
                                    <version>3.3.0</version>
                    <version>3.3.1</version>
                                    <fixVersion>3.3.2</fixVersion>
                    <fixVersion>3.4.0</fixVersion>
                                    <component>clients</component>
                    <component>producer </component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17617666" author="soarez" created="Fri, 14 Oct 2022 11:54:21 +0000"  >&lt;p&gt;The issue can be more specifically replicated with a unit test on&#160;&lt;tt&gt;RecordAccumulator&lt;/tt&gt;, adding this test to &lt;tt&gt;RecordAccumulatorTest&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testBatchSizeZero() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; batchSize = 0;
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; totalSize = 1024 * 1024;
    RecordAccumulator accum = createTestRecordAccumulator(batchSize, totalSize, CompressionType.NONE, 10);
    accum.append(topic, RecordMetadata.UNKNOWN_PARTITION, 0, key, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[32], Record.EMPTY_HEADERS,
            &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, maxBlockTimeMs, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, time.milliseconds(), cluster);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17617696" author="showuon" created="Fri, 14 Oct 2022 12:31:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=soarez&quot; class=&quot;user-hover&quot; rel=&quot;soarez&quot;&gt;soarez&lt;/a&gt; , thanks for reporting the issue. Looks like you&apos;ve done some investigation, are you willing to submit a PR to fix it?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17617712" author="soarez" created="Fri, 14 Oct 2022 12:51:27 +0000"  >&lt;p&gt;&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=showuon&quot; class=&quot;user-hover&quot; rel=&quot;showuon&quot;&gt;showuon&lt;/a&gt;&#160;Yes, I&apos;m currently investigating and hoping to come up with a PR&lt;/p&gt;</comment>
                            <comment id="17640216" author="junrao" created="Mon, 28 Nov 2022 19:25:14 +0000"  >&lt;p&gt;Merged the PR to 3.3 and trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13515519">KAFKA-14553</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z19dc0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>