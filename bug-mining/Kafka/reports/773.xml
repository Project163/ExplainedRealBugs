<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:44:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2573] Mirror maker system test hangs and eventually fails</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2573</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Due to changes made in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2015&quot; title=&quot;Enable ConsoleConsumer to use new consumer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2015&quot;&gt;&lt;del&gt;KAFKA-2015&lt;/del&gt;&lt;/a&gt;, handling of &lt;tt&gt;--consumer.config&lt;/tt&gt; has changed, more details is specified on &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2467&quot; title=&quot;ConsoleConsumer regressions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2467&quot;&gt;&lt;del&gt;KAFKA-2467&lt;/del&gt;&lt;/a&gt;. This leads to the exception.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.NoSuchMethodError: java.util.concurrent.ConcurrentHashMap.keySet()Ljava/util/concurrent/ConcurrentHashMap$KeySetView;
	at kafka.utils.Pool.keys(Pool.scala:77)
	at kafka.consumer.FetchRequestAndResponseStatsRegistry$.removeConsumerFetchRequestAndResponseStats(FetchRequestAndResponseStats.scala:69)
	at kafka.metrics.KafkaMetricsGroup$.removeAllConsumerMetrics(KafkaMetricsGroup.scala:189)
	at kafka.consumer.ZookeeperConsumerConnector.shutdown(ZookeeperConsumerConnector.scala:200)
	at kafka.consumer.OldConsumer.stop(BaseConsumer.scala:75)
	at kafka.tools.ConsoleConsumer$.process(ConsoleConsumer.scala:98)
	at kafka.tools.ConsoleConsumer$.run(ConsoleConsumer.scala:57)
	at kafka.tools.ConsoleConsumer$.main(ConsoleConsumer.scala:41)
	at kafka.tools.ConsoleConsumer.main(ConsoleConsumer.scala)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12895684">KAFKA-2573</key>
            <summary>Mirror maker system test hangs and eventually fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="singhashish">Ashish Singh</assignee>
                                    <reporter username="singhashish">Ashish Singh</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Sep 2015 05:46:32 +0000</created>
                <updated>Tue, 6 Oct 2015 21:07:10 +0000</updated>
                            <resolved>Tue, 6 Oct 2015 21:07:10 +0000</resolved>
                                                    <fixVersion>0.9.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14904012" author="githubbot" created="Wed, 23 Sep 2015 05:58:58 +0000"  >&lt;p&gt;GitHub user SinghAsDev opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/234&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/234&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2573&quot; title=&quot;Mirror maker system test hangs and eventually fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2573&quot;&gt;&lt;del&gt;KAFKA-2573&lt;/del&gt;&lt;/a&gt;: Mirror maker system test hangs and eventually fails&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/SinghAsDev/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/SinghAsDev/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2573&quot; title=&quot;Mirror maker system test hangs and eventually fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2573&quot;&gt;&lt;del&gt;KAFKA-2573&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/234.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/234.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #234&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ab79b2857c21cfadb1ce9ce648fb13a51d576668&lt;br/&gt;
Author: Ashish Singh &amp;lt;asingh@cloudera.com&amp;gt;&lt;br/&gt;
Date:   2015-09-22T23:21:27Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2573&quot; title=&quot;Mirror maker system test hangs and eventually fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2573&quot;&gt;&lt;del&gt;KAFKA-2573&lt;/del&gt;&lt;/a&gt;: Mirror maker system test hangs and eventually fails&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14904190" author="ijuma" created="Wed, 23 Sep 2015 08:52:44 +0000"  >&lt;p&gt;The exception you pasted happens if you compile with Java 8 and run it with Java 7. Are you sure you pasted the right exception?&lt;/p&gt;</comment>
                            <comment id="14905020" author="singhashish" created="Wed, 23 Sep 2015 18:44:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; thanks for pointing it out. I was under impression that Kafka code is compiled on the vagrant hosts and never thought it could be the java version causing the issue. Yes, it was due to using java8 at compile time and java 7 at run time. I am not sure, but I think that is not something we should be worried about. Let me know your thoughts, and we can close the JIRA accordingly.&lt;/p&gt;</comment>
                            <comment id="14905028" author="ijuma" created="Wed, 23 Sep 2015 18:50:21 +0000"  >&lt;p&gt;How does your PR handle this problem? This is a user error, but if we can provide a better error message somewhat easily, then that&apos;s a good thing.&lt;/p&gt;</comment>
                            <comment id="14905194" author="singhashish" created="Wed, 23 Sep 2015 20:30:35 +0000"  >&lt;p&gt;In my PR I removed &lt;tt&gt;consumer.wait()&lt;/tt&gt; that gets blocked and eventually the test fails due to timeout while waiting for the consumer thread to finish. Instead, I am doing my asserts on a separate thread by getting consumed messages from consumer thread and then I stop the thread without waiting on it. This approach is used in console_consumer_test as well. Does that sound reasonable to you?&lt;/p&gt;</comment>
                            <comment id="14905211" author="granders" created="Wed, 23 Sep 2015 20:44:07 +0000"  >&lt;p&gt;See what you think of my comment on &lt;a href=&quot;https://github.com/apache/kafka/pull/234&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/234&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14905234" author="singhashish" created="Wed, 23 Sep 2015 20:54:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=granders&quot; class=&quot;user-hover&quot; rel=&quot;granders&quot;&gt;granders&lt;/a&gt; +1 on your suggested change, will incorporate that. By hang I meant it will be stuck before timing out and failing. What are your thoughts on the PR to address java incompatibility issue?&lt;/p&gt;</comment>
                            <comment id="14905284" author="granders" created="Wed, 23 Sep 2015 21:22:00 +0000"  >&lt;p&gt;After speaking a bit with Ashish, I think I understand the intent behind the changes better now:&lt;br/&gt;
it seems these changes are intended to get the test to pass despite the remote console consumer process hanging during shutdown (correct me if I misunderstood, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=singhashish&quot; class=&quot;user-hover&quot; rel=&quot;singhashish&quot;&gt;singhashish&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;My argument is that failure of the test in this case is exactly what we want - how else would we have known an issue with conflicting java versions had caused the process to blow up during shutdown?&lt;/p&gt;

&lt;p&gt;That said, it is a very reasonable error to compile locally with java 8 (I&apos;m 100% sure this will cause trouble for others as well), so we should at least document this in the system test README &lt;/p&gt;</comment>
                            <comment id="14905391" author="singhashish" created="Wed, 23 Sep 2015 22:14:25 +0000"  >&lt;p&gt;I think the test is failing due to a reason it is not intending to test, or is it. I am not saying that we should not be catching such issues, my question is that should we be failing mirror-maker test due to an issue with consumer shutdown? May be we should. I am fine either ways, but just something we should agree upon.&lt;/p&gt;

&lt;p&gt;If we choose to let the test fail, I can change the PR to just make it fail fast instead of waiting for 10 minutes.&lt;/p&gt;</comment>
                            <comment id="14906454" author="ijuma" created="Thu, 24 Sep 2015 14:56:33 +0000"  >&lt;p&gt;I think the test should fail fast indeed. The system tests are meant to test the system working together and if one part is failing (for whatever reason), we should know about it. This is one of the main benefits of system tests when compared to the JUnit tests we have (which isolate things more).&lt;/p&gt;</comment>
                            <comment id="14907021" author="singhashish" created="Thu, 24 Sep 2015 21:00:40 +0000"  >&lt;p&gt;OK, I have updated the PR to just make the test fail faster.&lt;/p&gt;</comment>
                            <comment id="14933327" author="ijuma" created="Mon, 28 Sep 2015 14:05:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2585&quot; title=&quot;ConsoleConsumer should not hang infinitely upon exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2585&quot;&gt;&lt;del&gt;KAFKA-2585&lt;/del&gt;&lt;/a&gt; is related, cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lindong&quot; class=&quot;user-hover&quot; rel=&quot;lindong&quot;&gt;lindong&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14933633" author="lindong" created="Mon, 28 Sep 2015 17:31:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; Thanks for referring me to this ticket. Yes, I think this is the same issue I described in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2585&quot; title=&quot;ConsoleConsumer should not hang infinitely upon exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2585&quot;&gt;&lt;del&gt;KAFKA-2585&lt;/del&gt;&lt;/a&gt;. The solution I used in &lt;a href=&quot;https://github.com/apache/kafka/pull/247&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/247&lt;/a&gt; is different from that used by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=singhashish&quot; class=&quot;user-hover&quot; rel=&quot;singhashish&quot;&gt;singhashish&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think it would be better to fix it on the ConsoleConsumer.scala for this particular error &amp;#8211; because ConsoleConsumer shouldn&apos;t hang forever upon exception.&lt;/p&gt;

&lt;p&gt;I can see value for having a hardtimeout for any remove process in Ducktape test. But from my test experience I think there is already hard timeout as of Ducktape ac67e3f312d94c23ba06673c555fe557f1c9f39b, no? If we were to add a hard timeout, would it be better to enforce it as a general mechanism than having specific timeout for specific test, as is done in &lt;a href=&quot;https://github.com/apache/kafka/pull/234?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/234?&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14944432" author="ewencp" created="Tue, 6 Oct 2015 02:55:49 +0000"  >&lt;p&gt;Agreed with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lindong&quot; class=&quot;user-hover&quot; rel=&quot;lindong&quot;&gt;lindong&lt;/a&gt; that the tools itself should also be fixed, but I think it would be fine to commit this in order to handle the immediate issue with the system tests and file a follow up JIRA about ConsoleConsumer.&lt;/p&gt;

&lt;p&gt;I think this is getting lost in the shuffle since it doesn&apos;t have a reviewer. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; I&apos;m going to assign you as reviewer for the moment so at least one committer is keeping track of it.&lt;/p&gt;</comment>
                            <comment id="14945805" author="githubbot" created="Tue, 6 Oct 2015 21:07:06 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/234&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/234&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14945806" author="guozhang" created="Tue, 6 Oct 2015 21:07:10 +0000"  >&lt;p&gt;Issue resolved by pull request 234&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/234&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/234&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2lfxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>guozhang</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>