<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:31:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-14156] Built-in partitioner may create suboptimal batches with large linger.ms</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-14156</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The new built-in &quot;sticky&quot; partitioner switches partitions based on the amount of bytes produced to a partition. &#160;It doesn&apos;t use batch creation as a switch trigger. &#160;The previous &quot;sticky&quot; DefaultPartitioner switched partition when a new batch was created and with small linger.ms (default is 0) could result in sending larger batches to slower brokers potentially overloading them. &#160;See &lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-794%3A+Strictly+Uniform+Sticky+Partitioner&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/KAFKA/KIP-794%3A+Strictly+Uniform+Sticky+Partitioner&lt;/a&gt; for more detail.&lt;/p&gt;

&lt;p&gt;However, the with large linger.ms, the new built-in partitioner may create suboptimal batches. &#160;Let&apos;s consider an example, suppose linger.ms=500, batch.size=16KB (default) and we produce 24KB / sec, i.e. every 500ms we produce 12KB worth of data. &#160;The new built-in partitioner would switch partition on every 16KB, so we could get into the following batching pattern:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;produce 12KB to one partition in 500ms, hit linger, send 12KB batch&lt;/li&gt;
	&lt;li&gt;produce 4KB more to the same partition, now we&apos;ve produced 16KB of data, switch partition&lt;/li&gt;
	&lt;li&gt;produce 12KB to the second partition in 500ms, hit linger, send 12KB batch&lt;/li&gt;
	&lt;li&gt;in the mean time the 4KB produced to the first partition would hit linger as well, sending 4KB batch&lt;/li&gt;
	&lt;li&gt;produce 4KB more to the second partition, now we&apos;ve produced 16KB of data to the second partition, switch to 3rd partition&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;so in this scenario the new built-in partitioner produces a mix of 12KB and 4KB batches, while the previous DefaultPartitioner would produce only 12KB batches &amp;#8211; it switches on new batch creation, so there is no &quot;mid-linger&quot; leftover batches.&lt;/p&gt;

&lt;p&gt;To avoid creation of batch fragmentation on partition switch, we can wait until the batch is ready before switching the partition, i.e. the condition to switch to a new partition would be &quot;produced batch.size bytes&quot; AND &quot;batch is not lingering&quot;. &#160;This may potentially introduce some non-uniformity into data distribution, but unlike the previous DefaultPartitioner, the non-uniformity would not be based on broker performance and won&apos;t re-introduce the bad pattern of sending more data to slower brokers.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13476095">KAFKA-14156</key>
            <summary>Built-in partitioner may create suboptimal batches with large linger.ms</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alivshits">Artem Livshits</assignee>
                                    <reporter username="alivshits">Artem Livshits</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Aug 2022 06:44:21 +0000</created>
                <updated>Thu, 15 Sep 2022 00:45:34 +0000</updated>
                            <resolved>Thu, 15 Sep 2022 00:45:34 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>producer </component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17605017" author="junrao" created="Thu, 15 Sep 2022 00:45:34 +0000"  >&lt;p&gt;Merged the PR to 3.3 and trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z17mu8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>