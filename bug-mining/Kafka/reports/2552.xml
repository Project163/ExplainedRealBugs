<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:22:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5604] All producer methods should raise `ProducerFencedException` after the first time.</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5604</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Currently, when a `ProducerFencedException` is raised from a transactional producer, the expectation is that the application should call `close` immediately. However, if the application calls other producer methods, they would get a `KafkaException`. This is a bit confusing, and results in tickets like : &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5603&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-5603&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;We should update the producer so that calls to any method other than `close` should raise a `ProducerFencedException` after the first time it is raised.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13087713">KAFKA-5604</key>
            <summary>All producer methods should raise `ProducerFencedException` after the first time.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guozhang">Guozhang Wang</assignee>
                                    <reporter username="apurva">Apurva Mehta</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Jul 2017 19:53:27 +0000</created>
                <updated>Wed, 18 Mar 2020 21:36:02 +0000</updated>
                            <resolved>Wed, 18 Mar 2020 21:36:02 +0000</resolved>
                                                    <fixVersion>2.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17053907" author="iamabug" created="Sat, 7 Mar 2020 06:29:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurva&quot; class=&quot;user-hover&quot; rel=&quot;apurva&quot;&gt;apurva&lt;/a&gt;&#160;I wonder if this ticket should be closed,&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9592#&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-9592#&lt;/a&gt;&#160;depends on this.&lt;/p&gt;</comment>
                            <comment id="17058327" author="iamabug" created="Fri, 13 Mar 2020 01:03:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt;&#160;I notice that&#160;beginTransaction(), sendOffsesToTransaction(), commitTransaction(), abortTransaction() call maybeFailWithError() before anything.&#160; myabeFailWithError() is defined as :&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void maybeFailWithError() {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hasError()) {
        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ProducerFencedException, &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not wrap it as a KafkaException 
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// but create a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; instance without the call trace since it was not thrown because of the current call 
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lastError &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ProducerFencedException) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProducerFencedException(&lt;span class=&quot;code-quote&quot;&gt;&quot;The producer has been rejected from the broker because &quot;&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&quot;it tried to use an old epoch with the transactionalId&quot;&lt;/span&gt;); 
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; { 
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KafkaException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot execute transactional method because we are in an error state&quot;&lt;/span&gt;, lastError); 
        } 
    } 
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/producer/internals/TransactionManager.java#L1084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/clients/producer/internals/TransactionManager.java#L1084&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If lastError indeed tracks last error, it seems it will throw ProducerFencedException for the second time as expected.&lt;/p&gt;</comment>
                            <comment id="17059481" author="guozhang" created="Sat, 14 Mar 2020 20:21:44 +0000"  >&lt;p&gt;Thank you for looking into this, and I think your assessment is correct. We can close this ticket and you should just go ahead with 9592.&lt;/p&gt;</comment>
                            <comment id="17061269" author="iamabug" created="Wed, 18 Mar 2020 00:09:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; I believe there is still a TODO marker in&#160;&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamsProducer.java#L197&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamsProducer.java#L197&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;do we need to remove the TODO marker and submit a patch for this ticket ?&lt;/p&gt;</comment>
                            <comment id="17061275" author="iamabug" created="Wed, 18 Mar 2020 00:19:01 +0000"  >&lt;p&gt;Also, under that TODO marker, it says &quot;this should actually never happen&quot;, I am confused by that because ProducerFencedException is always possible when two transactional instances exist at the same moment.&lt;/p&gt;</comment>
                            <comment id="17062006" author="guozhang" created="Wed, 18 Mar 2020 19:10:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=iamabug&quot; class=&quot;user-hover&quot; rel=&quot;iamabug&quot;&gt;iamabug&lt;/a&gt; There are some context missing from this comment: the abortTxn should only be called if there&apos;s still an in-flight txn during close, which means that the closing logic did not get triggered, which means that the task got some error state. However, in the past if a previous producer call (e.g. send, or sendOffsetsToTxn) get fenced with an exception, when calling abortTxn here we would not get the same fenced exception again but an IllegalStateException is thrown.&lt;/p&gt;

&lt;p&gt;I will file a quick PR to remove this on the Streams side to clear it up, so no worries here.&lt;/p&gt;</comment>
                            <comment id="17062008" author="githubbot" created="Wed, 18 Mar 2020 19:19:23 +0000"  >&lt;p&gt;guozhangwang commented on pull request #8313: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5604&quot; title=&quot;All producer methods should raise `ProducerFencedException` after the first time.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5604&quot;&gt;&lt;del&gt;KAFKA-5604&lt;/del&gt;&lt;/a&gt;: Remove the redundant TODO marker on the Streams side&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8313&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   The issue itself has been fixed a while ago on the producer side, so we can just remove this TODO marker now (we&apos;ve removed the isZombie flag already anyways).&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17062058" author="githubbot" created="Wed, 18 Mar 2020 21:22:58 +0000"  >&lt;p&gt;guozhangwang commented on pull request #8313: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5604&quot; title=&quot;All producer methods should raise `ProducerFencedException` after the first time.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5604&quot;&gt;&lt;del&gt;KAFKA-5604&lt;/del&gt;&lt;/a&gt;: Remove the redundant TODO marker on the Streams side&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8313&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17062064" author="guozhang" created="Wed, 18 Mar 2020 21:35:53 +0000"  >&lt;p&gt;Verified that I&apos;ve fixed the producer as in &lt;a href=&quot;https://github.com/apache/kafka/pull/6171&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6171&lt;/a&gt; (duh), will close this ticket as 2.3.0 now.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13087705">KAFKA-5603</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hmcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>