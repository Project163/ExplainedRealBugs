<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:06:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6287] Inconsistent protocol type for empty consumer groups</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6287</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When a consumer is created for a new group, the group metadata&apos;s protocol type is set to &apos;consumer&apos; and this is stored both in __consumer_offsets as well as in the coordinator&apos;s local cache.&lt;/p&gt;

&lt;p&gt;If the consumer leaves the group and the group becomes empty, ListGroups requests will continue to show the group as type &apos;consumer&apos;, and as such kafka-consumer-groups.sh will show it via --list.&lt;/p&gt;

&lt;p&gt;However, if the coordinator (broker) node is killed and a new coordinator is elected, when the GroupMetadataManager loads the group from __consumer_offsets into its cache, it will not set the protocolType if there are no active consumers. As a result, the group&apos;s protocolType will now become the empty string (UNKNOWN_PROTOCOL_TYPE), and kafka-consumer-groups.sh will no longer show the group.&lt;/p&gt;

&lt;p&gt;Ideally bouncing a broker should not result in the group&apos;s protocol changing. protocolType can be set in GroupMetadataManager.readGroupMessageValue() to always reflect what&apos;s present in the persistent metadata (__consumer_offsets) regardless if there are active members.&lt;/p&gt;


&lt;p&gt;In general, things can get confusing when distinguishing between &apos;consumer&apos; and non-consumer groups. For example, DescribeGroups and OffsetFetchRequest does not filter on protocol type, so it&apos;s possible for kafka-consumer-groups.sh to describe groups (--describe) without actually being able to list them. In the protocol guide, OffsetFetchRequest / OffsetCommitRequest have their parameters listed as &apos;ConsumerGroup&apos;, but in reality these can be used for groups of unknown type as well. For instance, a consumer group can be copied by finding a coordinator (GroupCoordinatorRequest / FindCoordinatorRequest) and sending an OffsetCommitRequest. The group will be auto-created with an empty protocol. Although this is arguably correct, the group will now exist but not be  a proper &apos;consumer&apos; group until later when there is a JoinGroupRequest. Again, this can be confusing as far as categorization / visibility of the group is concerned. A group can instead be copied more directly by creating a consumer and calling commitSync (as kafka-consumer-groups.sh), but this does involve extra connections / requests and so is a little slower when trying to keep a large number of groups in sync in real-time across clusters.&lt;/p&gt;

&lt;p&gt;If we want to make it easier to keep consumer groups consistent, options include allowing groups to be explicitly created with a protocol type instead of only lazily, or for groups created outside of JoinGroupRequest the coordinator can gain a broker config to set a default protocol type for groups. This would default to &apos;consumer&apos;. This sort of setting might be confusing for users though, since implicitly created groups is certainly not the norm.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13122012">KAFKA-6287</key>
            <summary>Inconsistent protocol type for empty consumer groups</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hachikuji">Jason Gustafson</assignee>
                                    <reporter username="rleslie">Ryan Leslie</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Nov 2017 19:39:47 +0000</created>
                <updated>Wed, 24 Jan 2018 04:25:38 +0000</updated>
                            <resolved>Wed, 24 Jan 2018 04:22:10 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.0.1</fixVersion>
                                    <component>consumer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16294279" author="hachikuji" created="Sun, 17 Dec 2017 19:22:24 +0000"  >&lt;p&gt;Thanks for reporting the issue. I agree there are some inconsistencies here that we should resolve (note this is basically the cause of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6336&quot; title=&quot;when using assign() with kafka consumer the KafkaConsumerGroup command doesnt show those consumers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6336&quot;&gt;&lt;del&gt;KAFKA-6336&lt;/del&gt;&lt;/a&gt;). I think the reason we cleared the protocol type when the group went empty is to make it available for use by other group types, but we missed clearing it in the cache. Assuming KIP-229 passes and we have an API for explicitly deleting groups, then perhaps we can just leave the protocol type fixed when the group is created. So if it starts out as a consumer group, it will stay that way until the group expires or is manually deleted. As for consumers using manual assignment, I think your suggestion is reasonable. Basically we can either 1) store empty group metadata with &quot;consumer&quot; protocol type, or 2) always assume the protocol type is &quot;consumer&quot; if there are committed offsets with no corresponding group metadata. Does that sound reasonable?&lt;/p&gt;</comment>
                            <comment id="16295281" author="rleslie" created="Mon, 18 Dec 2017 17:21:47 +0000"  >&lt;p&gt;Thanks for reviewing. I agree that the protocol type shouldn&apos;t be cleared. A group could become empty temporarily during an outage or user upgrade and it doesn&apos;t make sense to lose information about the group type in those cases. It&apos;s probably best to keep everything explicit, and as you noted the DeleteGroup API is a step in that direction. For the record, I currently simulate deleting groups by sending OffsetCommitRequest with a retention time of 0 and keeping offsets.retention.check.interval.ms small,&lt;br/&gt;
but would much prefer the explicit request!&lt;/p&gt;

&lt;p&gt;As far as having groups default to &quot;consumer&quot; I think ensuring it is set in the metadata makes sense (option 1). Again, this will keep everything explicit, and this way groups will always have an associated type. I think it&apos;s fine to hardcode the default as &quot;consumer&quot; for now, since there probably aren&apos;t enough other use cases of group management to warrant making it configurable. The setting could always be added in the future.&lt;/p&gt;</comment>
                            <comment id="16319310" author="githubbot" created="Tue, 9 Jan 2018 22:30:50 +0000"  >&lt;p&gt;hachikuji opened a new pull request #4407: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6287&quot; title=&quot;Inconsistent protocol type for empty consumer groups&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6287&quot;&gt;&lt;del&gt;KAFKA-6287&lt;/del&gt;&lt;/a&gt;: Consumer group command should list simple consumer groups&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4407&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4407&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   With this patch, simple consumer groups which use Kafka for offset storage will be viewable using the `--list` option. In addition, this patch fixes a bug in the offset loading logic which caused us to lose the protocol type of empty groups on coordinator failover. I also did some cleanup of the various consumer group command test cases.&lt;/p&gt;

&lt;p&gt;   For testing, I have added new integration tests which cover listing and describing simple consumer groups. I also added unit tests to cover loading empty groups with assertions on the protocol type.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="13128405">KAFKA-6421</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13123840">KAFKA-6336</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13129464">KAFKA-6434</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nejz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>