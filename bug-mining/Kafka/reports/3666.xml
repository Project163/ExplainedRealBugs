<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:37:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-16141] StreamsStandbyTask##test_standby_tasks_rebalanceArguments:{ &#8220;metadata_quorum&#8221;: &#8220;ISOLATED_KRAFT&#8221;, &#8220;use_new_coordinator&#8221;: false} fails consistently in 3.7</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-16141</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
kafkatest.tests.streams.streams_standby_replica_test.StreamsStandbyTask#test_standby_tasks_rebalanceArguments:{ &#8220;metadata_quorum&#8221;: &#8220;ISOLATED_KRAFT&#8221;, &#8220;use_new_coordinator&#8221;: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;}

TimeoutError(&lt;span class=&quot;code-quote&quot;&gt;&quot;Did expect to read &lt;span class=&quot;code-quote&quot;&gt;&apos;ACTIVE_TASKS:2 STANDBY_TASKS:[1-3]&apos;&lt;/span&gt; from ubuntu@worker26&quot;&lt;/span&gt;)
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-branch-builder/kafka/venv/lib/python3.7/site-packages/ducktape/tests/runner_client.py&quot;&lt;/span&gt;, line 184, in _do_run
    data = self.run_test()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-branch-builder/kafka/venv/lib/python3.7/site-packages/ducktape/tests/runner_client.py&quot;&lt;/span&gt;, line 262, in run_test
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.test_context.function(self.test)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-branch-builder/kafka/venv/lib/python3.7/site-packages/ducktape/mark/_mark.py&quot;&lt;/span&gt;, line 433, in wrapper
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; functools.partial(f, *args, **kwargs)(*w_args, **w_kwargs)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-branch-builder/kafka/tests/kafkatest/tests/streams/streams_standby_replica_test.py&quot;&lt;/span&gt;, line 79, in test_standby_tasks_rebalance
    self.wait_for_verification(processor_1, &lt;span class=&quot;code-quote&quot;&gt;&quot;ACTIVE_TASKS:2 STANDBY_TASKS:[1-3]&quot;&lt;/span&gt;, processor_1.STDOUT_FILE)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-branch-builder/kafka/tests/kafkatest/tests/streams/base_streams_test.py&quot;&lt;/span&gt;, line 96, in wait_for_verification
    err_msg=&lt;span class=&quot;code-quote&quot;&gt;&quot;Did expect to read &lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt; from %s&quot;&lt;/span&gt; % (message, processor.node.account))
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-branch-builder/kafka/venv/lib/python3.7/site-packages/ducktape/utils/util.py&quot;&lt;/span&gt;, line 58, in wait_until
    raise TimeoutError(err_msg() &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; callable(err_msg) &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; err_msg) from last_exception
ducktape.errors.TimeoutError: Did expect to read &lt;span class=&quot;code-quote&quot;&gt;&apos;ACTIVE_TASKS:2 STANDBY_TASKS:[1-3]&apos;&lt;/span&gt; from ubuntu@worker26
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13564768">KAFKA-16141</key>
            <summary>StreamsStandbyTask##test_standby_tasks_rebalanceArguments:{ &#8220;metadata_quorum&#8221;: &#8220;ISOLATED_KRAFT&#8221;, &#8220;use_new_coordinator&#8221;: false} fails consistently in 3.7</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mjsax">Matthias J. Sax</assignee>
                                    <reporter username="enether">Stanislav Kozlovski</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Jan 2024 17:51:10 +0000</created>
                <updated>Fri, 19 Jan 2024 17:25:28 +0000</updated>
                            <resolved>Fri, 19 Jan 2024 17:25:28 +0000</resolved>
                                    <version>3.7.0</version>
                                    <fixVersion>3.7.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17806928" author="enether" created="Mon, 15 Jan 2024 17:54:51 +0000"  >&lt;p&gt;as seen in &lt;a href=&quot;https://hackmd.io/@hOneAGCrSmKSpL8VF-1HWQ/HyRgRJmta#kafkatesttestsstreamsstreams_standby_replica_testStreamsStandbyTasktest_standby_tasks_rebalanceArguments-%E2%80%9Cmetadata_quorum%E2%80%9D-%E2%80%9CISOLATED_KRAFT%E2%80%9D-%E2%80%9Cuse_new_coordinator%E2%80%9D-true,&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hackmd.io/@hOneAGCrSmKSpL8VF-1HWQ/HyRgRJmta#kafkatesttestsstreamsstreams_standby_replica_testStreamsStandbyTasktest_standby_tasks_rebalanceArguments-%E2%80%9Cmetadata_quorum%E2%80%9D-%E2%80%9CISOLATED_KRAFT%E2%80%9D-%E2%80%9Cuse_new_coordinator%E2%80%9D-true,&lt;/a&gt; this seems to fail with both types of arguments&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17807411" author="mjsax" created="Tue, 16 Jan 2024 19:03:39 +0000"  >&lt;p&gt;Assigned to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=agavra&quot; class=&quot;user-hover&quot; rel=&quot;agavra&quot;&gt;agavra&lt;/a&gt; and marked as blocker. Might be a regression introduced via KIP-954.&lt;/p&gt;</comment>
                            <comment id="17807434" author="agavra" created="Tue, 16 Jan 2024 20:45:36 +0000"  >&lt;p&gt;I confirmed it&#8217;s most likely related to my change - changing it from:&lt;br/&gt;
        final KeyValueBytesStoreSupplier persistentStoreSupplier = Stores.persistentKeyValueStore(persistentMemoryStoreName);&lt;br/&gt;
to&lt;br/&gt;
        final KeyValueBytesStoreSupplier persistentStoreSupplier = Stores.persistentTimestampedKeyValueStore(persistentMemoryStoreName);&lt;br/&gt;
makes the test pass, so it&#8217;s almost certainly the same bug as in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-16046&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-16046&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="17807520" author="agavra" created="Wed, 17 Jan 2024 02:44:26 +0000"  >&lt;p&gt;OK, after doing some more digging I don&apos;t think it&apos;s related to my change. Instead I believe it was caused by &lt;a href=&quot;https://github.com/apache/kafka/pull/14570&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/14570&lt;/a&gt; - that PR changed&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
KeyValueToTimestampedKeyValueByteStoreAdapter &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; ...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
KeyValueToTimestampedKeyValueByteStoreAdapter &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; ..., TimestampedBytesStore &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This caused WrappedStateStore#isTimestamped to return true when previously it returned false. This, in turn, caused us to initialize the store with the RecordConverts.RAW_TO_TIMESTAMED_INSTANCE as the converter (see StateManagerUtil#converterForStore). After a restore, the converter will prepend the record timestamp when it shouldn&apos;t, because an additional timestamp is then prepended when it goes through the adapter.&lt;/p&gt;

&lt;p&gt;Related: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-15629&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-15629&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hanyuzheng&quot; class=&quot;user-hover&quot; rel=&quot;hanyuzheng&quot;&gt;hanyuzheng&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17807543" author="mjsax" created="Wed, 17 Jan 2024 04:28:51 +0000"  >&lt;p&gt;Thanks. I am wondering if the right fix would be, to change `KeyValueToTimestampedKeyValueByteStoreAdapter` to implement `WrappedStateStore` &#8211; in the end, it is a wrapper, but the restore code path does not recognize it as such, and thus cannot &quot;unwrap&quot; it&apos;s inner store to pick the right converter? &#8211; Comparing to `InMemoryTimestampedKeyValueStoreMarker` it also implement both `WrappedStore` and `TimestampedBytesStore`?&lt;/p&gt;

&lt;p&gt;We did consider it a bug-fix to add `TimestampedBytesStore` to `KeyValueToTimestampedKeyValueByteStoreAdapter` because in the end, it&apos;s does expect `&amp;lt;ts&amp;gt;&amp;lt;value&amp;gt;` value byte format an `put()` and also returns this format on `get()`.&lt;/p&gt;

&lt;p&gt;It&apos;s just that the restore code path is not interested in some upper layer, but only in the most inner wrapper store type?&lt;/p&gt;</comment>
                            <comment id="17807890" author="mjsax" created="Wed, 17 Jan 2024 21:00:06 +0000"  >&lt;p&gt;After discussion with Almog (and testing it) implementing `WrappedStateStore` won&apos;t do the trick. Given that this is a regression, it seems best (most pragmatic) to just revert the change on `KeyValueToTimestampedKeyValueByteStoreAdapter` and don&apos;t let it implement `TimestampedBytesStore` for now (even if this still seems to be the right thing to do &#8211; however, it might require some larger changes to make it work &#8211; will filed a follow up ticket for this: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-16158&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-16158&lt;/a&gt;).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1mrhs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>