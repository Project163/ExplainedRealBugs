<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:56:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4254] Questionable handling of unknown partitions in KafkaProducer</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4254</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Currently the producer will raise an &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; if the user attempts to write to a partition which has just been created. This is caused by the fact that the producer does not attempt to refetch topic metadata in this case, which means that its check for partition validity is based on stale metadata.&lt;/p&gt;

&lt;p&gt;If the topic for the partition did not already exist, it works fine because the producer will block until it has metadata for the topic, so this case is primarily hit when the number of partitions is dynamically increased. &lt;/p&gt;

&lt;p&gt;A couple options to fix this that come to mind:&lt;/p&gt;

&lt;p&gt;1. We could treat unknown partitions just as we do unknown topics. If the partition doesn&apos;t exist, we refetch metadata and try again (timing out when max.block.ms is reached).&lt;br/&gt;
2. We can at least throw a more specific exception so that users can handle the error. Raising &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; is not helpful in practice because it can also be caused by other error.s&lt;/p&gt;

&lt;p&gt;My inclination is to do the first one since the producer seems incorrect to tell the user that the partition is invalid.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13009763">KAFKA-4254</key>
            <summary>Questionable handling of unknown partitions in KafkaProducer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkonstantine">Konstantine Karantasis</assignee>
                                    <reporter username="hachikuji">Jason Gustafson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Oct 2016 03:39:36 +0000</created>
                <updated>Fri, 14 Oct 2016 16:54:09 +0000</updated>
                            <resolved>Fri, 14 Oct 2016 03:18:49 +0000</resolved>
                                                    <fixVersion>0.10.1.0</fixVersion>
                                    <component>producer </component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15547518" author="ijuma" created="Wed, 5 Oct 2016 03:52:11 +0000"  >&lt;p&gt;Do we really want to have more cases where we fail slow on the off chance that some very rare operation is taking place? Adding partitions to a topic is pretty rare, so I think the second option may be better.&lt;/p&gt;</comment>
                            <comment id="15549203" author="hachikuji" created="Wed, 5 Oct 2016 16:20:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; I&apos;m sympathetic to your concern, but it seems a little difficult to justify the current behavior of raising an exception based on stale metadata. As a user, I expect that I can produce to an existing partition even if it has just been created, so requiring me to catch exceptions until the producer&apos;s metadata refresh interval expires seems a bit clunky. Of course, the producer doesn&apos;t necessarily need to block the full &lt;tt&gt;max.block.ms&lt;/tt&gt; until the partition is created, maybe one metadata refresh prior to raising would be sufficient?&lt;/p&gt;</comment>
                            <comment id="15549298" author="ijuma" created="Wed, 5 Oct 2016 16:51:47 +0000"  >&lt;p&gt;Yeah, one refresh makes sense to me.&lt;/p&gt;</comment>
                            <comment id="15553228" author="jjkoshy" created="Thu, 6 Oct 2016 21:29:35 +0000"  >&lt;p&gt;It seems (2) would still help as there are use-cases which set &lt;tt&gt;max.block.ms&lt;/tt&gt; to zero. So we can refresh metadata but also return a more specific exception.&lt;/p&gt;</comment>
                            <comment id="15553410" author="hachikuji" created="Thu, 6 Oct 2016 22:29:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjkoshy&quot; class=&quot;user-hover&quot; rel=&quot;jjkoshy&quot;&gt;jjkoshy&lt;/a&gt; Yeah, good point.&lt;/p&gt;</comment>
                            <comment id="15557508" author="githubbot" created="Sat, 8 Oct 2016 08:01:57 +0000"  >&lt;p&gt;GitHub user kkonstantine opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1995&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4254&quot; title=&quot;Questionable handling of unknown partitions in KafkaProducer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4254&quot;&gt;&lt;del&gt;KAFKA-4254&lt;/del&gt;&lt;/a&gt;: Update producers metadata before failing on non-existent &#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;partition&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kkonstantine/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kkonstantine/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4254&quot; title=&quot;Questionable handling of unknown partitions in KafkaProducer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4254&quot;&gt;&lt;del&gt;KAFKA-4254&lt;/del&gt;&lt;/a&gt;-Update-producers-metadata-before-failing-on-non-existent-partition&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1995.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1995.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1995&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d6ea6b77b879ccd5b2d4980845b991052fd09b88&lt;br/&gt;
Author: Konstantine Karantasis &amp;lt;konstantine@confluent.io&amp;gt;&lt;br/&gt;
Date:   2016-10-08T08:00:00Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4254&quot; title=&quot;Questionable handling of unknown partitions in KafkaProducer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4254&quot;&gt;&lt;del&gt;KAFKA-4254&lt;/del&gt;&lt;/a&gt;: Update producers metadata before failing on non-existent partition&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15557526" author="kkonstantine" created="Sat, 8 Oct 2016 08:12:42 +0000"  >&lt;p&gt;A patch has been submitted, taking into account both the main considerations that were raised. &lt;br/&gt;
A single metadata request is issued if a partition higher than the upper bound of partition range is requested, and an UnknownTopicOrPartitionException is thrown instead of IllegalArgumentException when a requested partition is out of bounds. &lt;/p&gt;</comment>
                            <comment id="15574018" author="hachikuji" created="Fri, 14 Oct 2016 03:18:50 +0000"  >&lt;p&gt;Issue resolved by pull request 1995&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1995&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15574020" author="githubbot" created="Fri, 14 Oct 2016 03:19:03 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1995&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15575850" author="jeffwidman" created="Fri, 14 Oct 2016 16:54:09 +0000"  >&lt;p&gt;Does this affect 10.0 or just 10.1?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34gcf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>