<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:20:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-8523] InsertField transformation fails when encountering tombstone event</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-8523</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When applying the &lt;tt&gt;InsertField&lt;/tt&gt; transformation to a tombstone event, an exception is raised:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.kafka.connect.errors.DataException: Only Map objects supported in absence of schema &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; [field insertion], found: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.kafka.connect.transforms.util.Requirements.requireMap(Requirements.java:38)
	at org.apache.kafka.connect.transforms.InsertField.applySchemaless(InsertField.java:138)
	at org.apache.kafka.connect.transforms.InsertField.apply(InsertField.java:131)
	at org.apache.kafka.connect.transforms.InsertFieldTest.tombstone(InsertFieldTest.java:128)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;del&gt;AFAICS, the transform can still be made working in in this case by simply building up a new value map from scratch.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;Update as per the discussion in the comments: tombstones should be left as-is by this SMT, as any insertion would defeat their purpose of enabling log compaction.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13238710">KAFKA-8523</key>
            <summary>InsertField transformation fails when encountering tombstone event</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="gunnar.morling">Gunnar Morling</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Jun 2019 08:53:47 +0000</created>
                <updated>Wed, 25 Mar 2020 19:27:25 +0000</updated>
                            <resolved>Thu, 3 Oct 2019 19:24:53 +0000</resolved>
                                                    <fixVersion>1.0.3</fixVersion>
                    <fixVersion>1.1.2</fixVersion>
                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.2</fixVersion>
                    <fixVersion>2.3.1</fixVersion>
                    <fixVersion>2.4.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16860688" author="gunnar.morling" created="Tue, 11 Jun 2019 08:54:08 +0000"  >&lt;p&gt;I&apos;ll provide a PR shortly.&lt;/p&gt;</comment>
                            <comment id="16860793" author="githubbot" created="Tue, 11 Jun 2019 10:30:05 +0000"  >&lt;p&gt;gunnarmorling commented on pull request #6914: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8523&quot; title=&quot;InsertField transformation fails when encountering tombstone event&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8523&quot;&gt;&lt;del&gt;KAFKA-8523&lt;/del&gt;&lt;/a&gt; Enabling InsertField transform to be used with tombstone events&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6914&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6914&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8523&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-8523&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16860794" author="gunnar.morling" created="Tue, 11 Jun 2019 10:31:33 +0000"  >&lt;p&gt;Filed &lt;a href=&quot;https://github.com/apache/kafka/pull/6914&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6914&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16867753" author="rhauch" created="Wed, 19 Jun 2019 15:13:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gunnar.morling&quot; class=&quot;user-hover&quot; rel=&quot;gunnar.morling&quot;&gt;gunnar.morling&lt;/a&gt;, thanks for the report and the proposed fix. Did you consider whether &quot;InsertField&quot; for a tombstone event means the SMT should do nothing with the tombstone but pass it along?&lt;/p&gt;</comment>
                            <comment id="16868422" author="gunnar.morling" created="Thu, 20 Jun 2019 10:17:46 +0000"  >&lt;p&gt;Good question, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhauch&quot; class=&quot;user-hover&quot; rel=&quot;rhauch&quot;&gt;rhauch&lt;/a&gt;; I didn&apos;t consider it, but I could see both approaches making sense. Should we make this an option (insert into tombstones vs. pass them on unmodified) for that SMT?&lt;/p&gt;</comment>
                            <comment id="16870450" author="tsjagan" created="Sun, 23 Jun 2019 06:10:52 +0000"  >&lt;p&gt;I am seeing something similar from the ExtractField smt. I think heartbeat messages are not going through the standard ExtractField SMT&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;Caused by: org.apache.kafka.connect.errors.DataException: Only Map objects supported in absence of schema for &lt;span class=&quot;error&quot;&gt;&amp;#91;field extraction&amp;#93;&lt;/span&gt;, found: org.apache.kafka.connect.data.Struct debezium-68745ff465-lmslc debezium at org.apache.kafka.connect.transforms.util.Requirements.requireMap(Requirements.java:38) debezium-68745ff465-lmslc debezium at org.apache.kafka.connect.transforms.util.Requirements.requireMapOrNull(Requirements.java:47) debezium-68745ff465-lmslc debezium at org.apache.kafka.connect.transforms.ExtractField.apply(ExtractField.java:57) debezium-68745ff465-lmslc debezium at org.apache.kafka.connect.runtime.TransformationChain.lambda$apply$0(TransformationChain.java:50) debezium-68745ff465-lmslc debezium at org.apache.kafka.connect.runtime.errors.RetryWithToleranceOperator.execAndRetry(RetryWithToleranceOperator.java:128) debezium-68745ff465-lmslc debezium at org.apache.kafka.connect.runtime.errors.RetryWithToleranceOperator.execAndHandleError(RetryWithToleranceOperator.java:162)&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;</comment>
                            <comment id="16870484" author="gavingilmour" created="Sun, 23 Jun 2019 08:16:32 +0000"  >&lt;p&gt;+1 For this fix.&lt;/p&gt;

&lt;p&gt;I&apos;m being burned by it while trying out&#160;&lt;a href=&quot;https://github.com/confluentinc/demo-scene/blob/master/no-more-silos-oracle/docker-compose/scripts/create-ora-source-debezium-xstream.sh&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/confluentinc/demo-scene/blob/master/no-more-silos-oracle/docker-compose/scripts/create-ora-source-debezium-xstream.sh&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Is there any workaround to prevent the connector dying on deletes?&lt;/p&gt;</comment>
                            <comment id="16931374" author="frederic.tardif" created="Tue, 17 Sep 2019 12:21:06 +0000"  >&lt;p&gt;I believe an option should be exposed to configure the behaviour in order to either pass the null value unmodified or to apply the insert on an empty map.&#160;&lt;/p&gt;</comment>
                            <comment id="16931646" author="rhauch" created="Tue, 17 Sep 2019 16:41:44 +0000"  >&lt;p&gt;It seems strange to me that InsertField into a null (tombstone) record would create an empty map / struct. Rather, it seems like we need a configuration property that defines the behavior on null.&lt;/p&gt;

&lt;p&gt;However, that means we need a small KIP to define this property. I&apos;d suggest a property like `behavior.on.null` whose values are either `empty` or `skip`. If we consider records with null values as tombstones (meaning they represent deleted records), defaulting to `skip` makes the most sense to me.&lt;/p&gt;

&lt;p&gt;We do have a similar problem with `ExtractField` (see &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7052&quot; title=&quot;ExtractField SMT throws NPE - needs clearer error message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7052&quot;&gt;&lt;del&gt;KAFKA-7052&lt;/del&gt;&lt;/a&gt;), and it&apos;d be great if the KIP added that configuration item there as well.&lt;/p&gt;</comment>
                            <comment id="16931662" author="gunnar.morling" created="Tue, 17 Sep 2019 17:05:53 +0000"  >&lt;p&gt;Yes, I was arriving at pretty much the same conclusion; that said: is an option even needed: I&apos;ve come to think that a tombstone should remain just that, a tombstone, i.e. I don&apos;t see a good reason to inject any value into a tombstone really; after all, it has specific semantics &amp;#8211; enabling compaction &amp;#8211; which shouldn&apos;t be altered. So I would suggest I simply update my PR so that it passes on tombstones unmodified and that should be good enought. WDYT?&lt;/p&gt;

&lt;p&gt;Note, if we wanted to have an option, I think it would allow to pass on tombstones unmodified (as suggested above) OR to insert the new field, i.e. there wouldn&apos;t be an empty map really returned, but a map with a single entry for that new field (so what the current PR is doing). This could be done, but as argued it&apos;d change the message&apos;s nature of being a tombstone, so it&apos;s probably not desirable?&lt;/p&gt;</comment>
                            <comment id="16931761" author="rhauch" created="Tue, 17 Sep 2019 19:31:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gunnar.morling&quot; class=&quot;user-hover&quot; rel=&quot;gunnar.morling&quot;&gt;gunnar.morling&lt;/a&gt;, good point. I think a tombstone should be left unmodified by this SMT, which means no need for a KIP or a config change.&lt;/p&gt;

&lt;p&gt;I think dropping a tombstone or replacing a tombstone with a non-null value are separate SMTs.&lt;/p&gt;</comment>
                            <comment id="16931777" author="frederic.tardif" created="Tue, 17 Sep 2019 19:58:02 +0000"  >&lt;p&gt;just to clarify my comment above. The `behavior.on.null.values` already exists (at least on the elasticsearch connector), so it is important to keep the null values when we aim to interpret it as `delete` on an elasticsearch index entry. Applying a transform that InsertFields on null would completely defies the purpose in this scenario. I strongly believe the transform should skip null values or this transform behaviour should at least be configurable.&#160;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12980542/12980542_image-2019-09-17-15-53-44-038.png&quot; height=&quot;130&quot; width=&quot;693&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16932686" author="rhauch" created="Wed, 18 Sep 2019 17:16:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=frederic.tardif&quot; class=&quot;user-hover&quot; rel=&quot;frederic.tardif&quot;&gt;frederic.tardif&lt;/a&gt;, thanks for the comment.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gunnar.morling&quot; class=&quot;user-hover&quot; rel=&quot;gunnar.morling&quot;&gt;gunnar.morling&lt;/a&gt;&apos;s last comment was:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;So I would suggest I simply update my PR so that it passes on tombstones unmodified and that should be good enough.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;As mentioned above, I agree with this approach: &lt;b&gt;tombstones should be left as-is and not modified&lt;/b&gt;. Note that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gunnar.morling&quot; class=&quot;user-hover&quot; rel=&quot;gunnar.morling&quot;&gt;gunnar.morling&lt;/a&gt; hasn&apos;t yet updated the PR, but it will not be merged until that happens.&lt;/p&gt;

&lt;p&gt;Second, any new configuration on any SMT would be prefixed in the connector config with  `transforms.&amp;lt;name&amp;gt;.`, and thus it would not clash with any existing connector or SMT configuration. For example, &lt;b&gt;&lt;ins&gt;&lt;em&gt;if&lt;/em&gt;&lt;/ins&gt;&lt;/b&gt; we were to add a new SMT property named `behavior.on.null.values`, then it would be used in a connector configuration like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
transforms=MyInsertField
transforms.MyInsertField.class=org.apache.kafka.connect.transforms.InsertField
transforms.MyInsertField.behavior.on.&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.values=skip
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;However, as mentioned above, both Gunnar and I agreed above that we don&apos;t think a new configuration is necessary&lt;/b&gt;.&lt;/p&gt;</comment>
                            <comment id="16939730" author="gunnar.morling" created="Fri, 27 Sep 2019 20:07:11 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhauch&quot; class=&quot;user-hover&quot; rel=&quot;rhauch&quot;&gt;rhauch&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=frederic.tardif&quot; class=&quot;user-hover&quot; rel=&quot;frederic.tardif&quot;&gt;frederic.tardif&lt;/a&gt;, yes, we&apos;re all on the same page: tombstones shouldn&apos;t be modified at all by this SMT. I&apos;ve updated and force-pushed the PR accordingly. It&apos;s good to go from my PoV now.&lt;/p&gt;</comment>
                            <comment id="16943824" author="githubbot" created="Thu, 3 Oct 2019 18:51:07 +0000"  >&lt;p&gt;rhauch commented on pull request #6914: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8523&quot; title=&quot;InsertField transformation fails when encountering tombstone event&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8523&quot;&gt;&lt;del&gt;KAFKA-8523&lt;/del&gt;&lt;/a&gt; Enabling InsertField transform to be used with tombstone events&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6914&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6914&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                                                <inwardlinks description="is fixed by">
                                        <issuelink>
            <issuekey id="13291183">KAFKA-9707</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13165769">KAFKA-7052</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12980542" name="image-2019-09-17-15-53-44-038.png" size="214335" author="frederic.tardif" created="Tue, 17 Sep 2019 19:53:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z03ly8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rhauch</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>