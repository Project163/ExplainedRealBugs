<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:58:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4229] Controller can&apos;t start after several zk expired event</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4229</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We found the controller not started after several zk expired event in our test environment.  By analysing the log, I found the controller will handle the ephemeral node data delete event first and then the zk expired event , then the controller will gone.&lt;br/&gt;
I can reproducer it on my develop env:&lt;br/&gt;
1. set up a one broker and one zk env, specify a very large zk timeout (20s)&lt;br/&gt;
2. stop the broker and remove the zk&apos;s /broker/ids/0  directory&lt;br/&gt;
3. restart the broker and make  a breakpoint in the zk client&apos;s event thread to queue the delete event.&lt;br/&gt;
4. after the /controller node gone the breakpoint will hit.&lt;br/&gt;
5. expired the current session(suspend the send thread) and create a new session s2&lt;br/&gt;
6. resume the event thread, then the controller will handle LeaderChangeListener.handleDataDeleted  and become leader&lt;br/&gt;
7. then controller will handle SessionExpirationListener.handleNewSession, it resign the controller and elect,  but when elect it found the /controller node is exist and not become the leader.  But the /controller node is created by current session s2 will not remove. So the controller is gone&lt;/p&gt;</description>
                <environment></environment>
        <key id="13008465">KAFKA-4229</key>
            <summary>Controller can&apos;t start after several zk expired event</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pengwei">Pengwei</assignee>
                                    <reporter username="pengwei">Pengwei</reporter>
                        <labels>
                            <label>reliability</label>
                    </labels>
                <created>Thu, 29 Sep 2016 08:19:08 +0000</created>
                <updated>Tue, 24 Jan 2017 21:58:17 +0000</updated>
                            <resolved>Tue, 24 Jan 2017 21:58:17 +0000</resolved>
                                    <version>0.9.0.0</version>
                    <version>0.9.0.1</version>
                    <version>0.10.0.0</version>
                    <version>0.10.0.1</version>
                                    <fixVersion>0.10.2.0</fixVersion>
                                    <component>controller</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15532241" author="pengwei" created="Thu, 29 Sep 2016 09:04:20 +0000"  >&lt;p&gt;I already have a patch for this issue, maybe the issue can assign to me?&lt;/p&gt;</comment>
                            <comment id="15570973" author="guozhang" created="Thu, 13 Oct 2016 06:05:15 +0000"  >&lt;p&gt;I have assigned this JIRA to you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pengwei&quot; class=&quot;user-hover&quot; rel=&quot;pengwei&quot;&gt;pengwei&lt;/a&gt;. BTW which version of Kafka were you testing? I saw the affected versions from 0.9.0.0 to 0.10.0.1, so not sure which version it is testing.&lt;/p&gt;

&lt;p&gt;Also there are some known issues with the older versioned ZKClient such that events are not processed in exactly the firing order, and hence may cause various issues and cause some events be lost. ZkClient has been upgraded from older version to 0.10.0.x, I&apos;m wondering if it has solved the problem or not.&lt;/p&gt;</comment>
                            <comment id="15571265" author="pengwei" created="Thu, 13 Oct 2016 08:32:28 +0000"  >&lt;p&gt;We test it on 0.9.0.0, but I found the controller code are nearly the same between these versions.&lt;br/&gt;
In 0.9.0.0, zk version is 3.4.6&lt;/p&gt;</comment>
                            <comment id="15698987" author="githubbot" created="Sun, 27 Nov 2016 03:54:45 +0000"  >&lt;p&gt;GitHub user pengwei-li opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2175&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2175&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4229&quot; title=&quot;Controller can&amp;#39;t start after several zk expired event&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4229&quot;&gt;&lt;del&gt;KAFKA-4229&lt;/del&gt;&lt;/a&gt;:Controller can&apos;t start after several zk expired event&lt;/p&gt;


&lt;p&gt;    Author: pengwei &amp;lt;pengwei.li@huawei.com&amp;gt;&lt;/p&gt;

&lt;p&gt;    Reviewers: wangguoz.gmail.com&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/pengwei-li/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/pengwei-li/kafka&lt;/a&gt; trunk&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2175.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2175.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2175&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a920d4e9807add634cc44e4b7cf9e156edd515cf&lt;br/&gt;
Author: pengwei-li &amp;lt;pengwei.li@huawei.com&amp;gt;&lt;br/&gt;
Date:   2016-07-10T00:31:56Z&lt;/p&gt;

&lt;p&gt;     &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1429&quot; title=&quot;Yet another deadlock in controller shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1429&quot;&gt;&lt;del&gt;KAFKA-1429&lt;/del&gt;&lt;/a&gt;: Yet another deadlock in controller shutdown&lt;/p&gt;

&lt;p&gt;     Author: pengwei &amp;lt;pengwei.li@huawei.com&amp;gt;&lt;/p&gt;

&lt;p&gt;     Reviewers: NA&lt;/p&gt;

&lt;p&gt;commit 2a5a4322c8ac359587f05b459588cd2b5843a2ac&lt;br/&gt;
Author: pengwei-li &amp;lt;pengwei.li@huawei.com&amp;gt;&lt;br/&gt;
Date:   2016-11-20T11:31:21Z&lt;/p&gt;

&lt;p&gt;    Merge branch &apos;trunk&apos; of &lt;a href=&quot;https://github.com/apache/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka&lt;/a&gt; into trunk&lt;/p&gt;

&lt;p&gt;commit b827a8b4f249050ca40db9f14e8e10b01650a6b8&lt;br/&gt;
Author: pengwei-li &amp;lt;pengwei.li@huawei.com&amp;gt;&lt;br/&gt;
Date:   2016-11-20T12:18:49Z&lt;/p&gt;

&lt;p&gt;    Merge branch &apos;trunk&apos; of &lt;a href=&quot;https://github.com/apache/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka&lt;/a&gt; into trunk&lt;/p&gt;

&lt;p&gt;commit 43e186f223dee1e24177a87ee6888eaae91547d9&lt;br/&gt;
Author: pengwei-li &amp;lt;pengwei.li@huawei.com&amp;gt;&lt;br/&gt;
Date:   2016-11-27T01:54:00Z&lt;/p&gt;

&lt;p&gt;    Merge branch &apos;trunk&apos; of &lt;a href=&quot;https://github.com/apache/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka&lt;/a&gt; into trunk&lt;/p&gt;

&lt;p&gt;commit febe4f433452a2ad8849a329bc5c9f4d1507a317&lt;br/&gt;
Author: pengwei-li &amp;lt;pengwei.li@huawei.com&amp;gt;&lt;br/&gt;
Date:   2016-11-27T03:31:26Z&lt;/p&gt;

&lt;p&gt;    issue:&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4229&quot; title=&quot;Controller can&amp;#39;t start after several zk expired event&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4229&quot;&gt;&lt;del&gt;KAFKA-4229&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
    reason: controoler can&apos;t start afeter several zk expired event&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15698992" author="pengwei" created="Sun, 27 Nov 2016 03:57:01 +0000"  >&lt;p&gt;The PR is : &lt;a href=&quot;https://github.com/apache/kafka/pull/2175&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2175&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15698999" author="pengwei" created="Sun, 27 Nov 2016 04:02:27 +0000"  >&lt;p&gt;PR : &lt;a href=&quot;https://github.com/apache/kafka/pull/2175&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2175&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15836711" author="githubbot" created="Tue, 24 Jan 2017 21:57:16 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2175&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2175&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15836715" author="junrao" created="Tue, 24 Jan 2017 21:58:17 +0000"  >&lt;p&gt;Issue resolved by pull request 2175&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/2175&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2175&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i348cv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>guozhang</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>