<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:40:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1498] new producer performance and bug improvements</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1498</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We have seen the following issues with the new producer.&lt;/p&gt;

&lt;p&gt;1. The producer request can be significantly larger than the configured batch size.&lt;br/&gt;
2. The bottleneck in mirrormaker when there are keyed messages and compression is turned on.&lt;br/&gt;
3. The selector is woken up on every message in the new producer.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12722599">KAFKA-1498</key>
            <summary>new producer performance and bug improvements</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guozhang">Guozhang Wang</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Jun 2014 21:31:51 +0000</created>
                <updated>Tue, 2 Sep 2014 23:05:56 +0000</updated>
                            <resolved>Tue, 2 Sep 2014 23:05:56 +0000</resolved>
                                                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14037932" author="junrao" created="Thu, 19 Jun 2014 21:34:57 +0000"  >&lt;p&gt;Attach a draft patch of revision dcc88408c98a07cb9a816ab55cd81e55f1d2217d on Jun. 10.&lt;/p&gt;

&lt;p&gt;Included in the patch:&lt;br/&gt;
1. Address the issue that a batch in the producer request can be significantly larger than the configured batch size.&lt;br/&gt;
This is done by patching MemoryRecords.hasRoom() and MemoryRecords.isFull().&lt;br/&gt;
2. Address the bottleneck in mirrormaker when there are keyed messages and compression is turned on.&lt;br/&gt;
Use a data channel per producer thread.&lt;br/&gt;
3. Address the issue that the selector is woken up on every message in the new producer. This is the trickiest part. The fix is the following.&lt;br/&gt;
(a) In KafkaProducer.send(), only wake up the selector if the batch becomes full during append.&lt;br/&gt;
(b) In Metadata.fetch(), force the selector to wake up if metadata is not available.&lt;br/&gt;
(c) In sender, calculate the select time dynamically in each iteration of the selector.poll() call. The select time is the minimal of the remaining linger time of all partitions and the metadata request. The select time is bounded by linger time. This is to handle the case that the selector is doing a long poll, a new messages is produced and no new messages come afterwards. We need to make sure that the message can be processed within the linger time.&lt;/p&gt;

&lt;p&gt;This cover the following cases well.&lt;br/&gt;
3.1. If linger time is larger and there are lots of messages, the selector won&apos;t be woke up too frequently.&lt;br/&gt;
3.2. If linger time is small and there are lots of messages, the selector will be busy. However, this is expected.&lt;/p&gt;

&lt;p&gt;This doesn&apos;t deal with the following case well.&lt;br/&gt;
3.3 If linger time is small and there are very few messages, the selector will still wake up every linger time. Not sure what&apos;s the best way to deal with this. One thing that I was thinking is to have a min_linger threshold. The selector will use a select time at least of min_linger, say 5ms, if there is nothing to do. In KafkaProducer.send(), if linger is configured to be larger than min_linger, wake up the selector on every message. This way, the selector will only be busy if there are lots of messages.&lt;/p&gt;

&lt;p&gt;Not sure that I have thought through other potential timing issues.&lt;/p&gt;

&lt;p&gt;4. Added a few missing ingraphs.&lt;/p&gt;

&lt;p&gt;Other todos:&lt;br/&gt;
1. Metadata.needsUpdate should be renamed properly.&lt;br/&gt;
2. Methods with new parameters need new comments accordingly.&lt;br/&gt;
3. Metrics&lt;br/&gt;
3.1 In addition to record-size-max, add record-size-avg.&lt;br/&gt;
3.2 Rename incoming-bytes-rate and outgoing-bytes-rate to network-in-bytes-rate and network-out-bytes-rate&lt;/p&gt;</comment>
                            <comment id="14041040" author="guozhang" created="Mon, 23 Jun 2014 17:54:38 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/22874/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/22874/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14044187" author="guozhang" created="Wed, 25 Jun 2014 23:45:00 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/22874/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/22874/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14047897" author="guozhang" created="Mon, 30 Jun 2014 17:47:26 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/22874/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/22874/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14048271" author="guozhang" created="Mon, 30 Jun 2014 22:48:05 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/22874/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/22874/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14049140" author="guozhang" created="Tue, 1 Jul 2014 18:12:48 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/22874/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/22874/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14049357" author="guozhang" created="Tue, 1 Jul 2014 21:40:38 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/23215/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/23215/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12653474" name="KAFKA-1498.patch" size="924" author="guozhang" created="Tue, 1 Jul 2014 21:40:37 +0000"/>
                            <attachment id="12652011" name="KAFKA-1498.patch" size="35763" author="guozhang" created="Mon, 23 Jun 2014 17:54:37 +0000"/>
                            <attachment id="12652522" name="KAFKA-1498_2014-06-25_16:44:51.patch" size="36799" author="guozhang" created="Wed, 25 Jun 2014 23:45:00 +0000"/>
                            <attachment id="12653189" name="KAFKA-1498_2014-06-30_10:47:17.patch" size="42332" author="guozhang" created="Mon, 30 Jun 2014 17:47:26 +0000"/>
                            <attachment id="12653257" name="KAFKA-1498_2014-06-30_15:47:56.patch" size="42205" author="guozhang" created="Mon, 30 Jun 2014 22:48:05 +0000"/>
                            <attachment id="12653432" name="KAFKA-1498_2014-07-01_11:12:41.patch" size="41832" author="guozhang" created="Tue, 1 Jul 2014 18:12:48 +0000"/>
                            <attachment id="12651500" name="kafka-1498.patch" size="33824" author="junrao" created="Thu, 19 Jun 2014 21:34:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>400790</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 20 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wzon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>400880</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>