<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:25:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-10559] Don&apos;t shutdown the entire app upon TimeoutException during internal topic validation</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-10559</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;During some of the KIP-572 work, we made things pretty brittle by changing the StreamsPartitionAssignor to send the `INCOMPLETE_SOURCE_TOPIC_METADATA` error code and shut down the entire application if a TimeoutException is hit during the internal topic creation/validation.&lt;/p&gt;

&lt;p&gt;Internal topic validation occurs during every rebalance, and we have seen it time out on topic discovery in unstable environments. So shutting down the entire application seems like a step in the wrong direction, and antithetical to the goal of KIP-572 (improving the resiliency of Streams in the face of TimeoutExceptions)&lt;/p&gt;

&lt;p&gt;I&apos;m not totally sure what the previous behavior was, but it seems to me we have three options:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Rethrow the TimeoutException and allow it to kill the thread&lt;/li&gt;
	&lt;li&gt;Swallow the TimeoutException and retry the rebalance indefinitely&lt;/li&gt;
	&lt;li&gt;Some combination of the above: swallow the TimeoutException but don&apos;t retry indefinitely:
	&lt;ol&gt;
		&lt;li&gt;Start a timer and allow retrying rebalances for up the configured&#160;task.timeout.ms, the timeout config introduced in KIP-572&lt;/li&gt;
		&lt;li&gt;Retry for some constant number of rebalances&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I think if we go with option 3, then shutting down the entire application is relatively more palatable, as we have given the environment a chance to stabilize.&lt;/p&gt;

&lt;p&gt;But, killing the thread still seems preferable, given the two new features that are coming out soon: the ability to start up new threads, and the improved exception handler that allows the user to choose to shut down the entire application if that&apos;s really what they want. Once users have this level of control over the application, we should allow them to decide how they want to handle exceptional cases like this, rather than forcing an option on them (eg shutdown everything)&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Imo we should fix this before 2.7 comes out, even if it&apos;s just a partial fix (eg we do option 1 in 2.7, but plan to implement option 3 eventually)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13330237">KAFKA-10559</key>
            <summary>Don&apos;t shutdown the entire app upon TimeoutException during internal topic validation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sagarrao">Sagar Rao</assignee>
                                    <reporter username="ableegoldman">A. Sophie Blee-Goldman</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Sep 2020 18:43:50 +0000</created>
                <updated>Tue, 20 Oct 2020 17:33:46 +0000</updated>
                            <resolved>Thu, 15 Oct 2020 22:18:02 +0000</resolved>
                                    <version>2.7.0</version>
                                    <fixVersion>2.7.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17208194" author="sagarrao" created="Mon, 5 Oct 2020 17:08:33 +0000"  >&lt;p&gt;hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt;, I can pick this one if needed? Is there anything more that you would want to add apart ffrom the nicely worded description?&#160;&lt;/p&gt;</comment>
                            <comment id="17208257" author="ableegoldman" created="Mon, 5 Oct 2020 18:53:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sagarrao&quot; class=&quot;user-hover&quot; rel=&quot;sagarrao&quot;&gt;sagarrao&lt;/a&gt; Yeah, go ahead! This should be a pretty small PR so it would be great if we could knock it out in the next week or two. Just ping me when it&apos;s ready.&lt;/p&gt;

&lt;p&gt;For the PR itself, I think it sounds reasonable to just rethrow the TimeoutException to kill the thread. The &quot;add/recover stream thread&quot; functionality will probably slip 2.7, but it&apos;ll be implemented soon. So we don&apos;t really need to go out of our way to save a single thread from death in rare circumstances imo&lt;/p&gt;</comment>
                            <comment id="17209647" author="sagarrao" created="Wed, 7 Oct 2020 16:06:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt;, i looked at the code today.. I see that, INCOMPLETE_SOURCE_TOPIC_METADATA error code is being thrown in 2 places:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/confluentinc/kafka/blob/master/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamsPartitionAssignor.java#L379-L383&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/confluentinc/kafka/blob/master/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamsPartitionAssignor.java#L379-L383&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/confluentinc/kafka/blob/master/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamsPartitionAssignor.java#L345-L351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/confluentinc/kafka/blob/master/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamsPartitionAssignor.java#L345-L351&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Both these places, it is being thrown for both&#160;TaskAssignmentException and&#160;TimeoutException. As per your suggestion, for the case of&#160;TimeoutException, i just need to rethrow&#160;TimeoutException and that&apos;s all I need to do?&lt;/p&gt;</comment>
                            <comment id="17209929" author="ableegoldman" created="Wed, 7 Oct 2020 23:40:18 +0000"  >&lt;p&gt;Exactly, just rethrow the TimeoutException. Or actually we can just not catch it in those two blocks in the first place.&lt;/p&gt;</comment>
                            <comment id="17209972" author="sagarrao" created="Thu, 8 Oct 2020 03:18:05 +0000"  >&lt;p&gt;PR available here:&#160;&lt;a href=&quot;https://github.com/confluentinc/kafka/pull/422&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/confluentinc/kafka/pull/422&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17211158" author="bbejeck" created="Fri, 9 Oct 2020 16:43:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sagarrao&quot; class=&quot;user-hover&quot; rel=&quot;sagarrao&quot;&gt;sagarrao&lt;/a&gt;&#160;can you close the above PR and open it against &lt;a href=&quot;https://github.com/apache/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka&lt;/a&gt;&#160;?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Bill&lt;/p&gt;</comment>
                            <comment id="17211285" author="ableegoldman" created="Fri, 9 Oct 2020 18:43:42 +0000"  >&lt;p&gt;Ah thanks Bill, yeah please open it against the apache/kafka repo. And can you name it in the form &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-10559&quot; title=&quot;Don&amp;#39;t shutdown the entire app upon TimeoutException during internal topic validation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-10559&quot;&gt;&lt;del&gt;KAFKA-10559&lt;/del&gt;&lt;/a&gt;: description of PR&quot; so that it&apos;ll be automatically linked to this ticket?&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sagarrao&quot; class=&quot;user-hover&quot; rel=&quot;sagarrao&quot;&gt;sagarrao&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 5 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0j260:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>