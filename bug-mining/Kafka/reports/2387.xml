<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:20:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-8340] ServiceLoader fails when used from isolated plugin path directory</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-8340</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Under some circumstances, the &lt;tt&gt;ServiceLoader.load&lt;/tt&gt; mechanism will fail when used from an isolated plugin path directory and return an incomplete (often empty) &lt;tt&gt;ServiceLoader&lt;/tt&gt; instance.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;To replicate:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Include a &lt;tt&gt;META-INF/services/...&lt;/tt&gt; file in one of the JARS located in a plugin&apos;s directory with one or more implementations of that service listed inside.&#160;For the sake of example, let&apos;s say&#160;the name of this service is &lt;tt&gt;com.example.MyService&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Program that plugin to invoke &lt;tt&gt;ServiceLoader.load(com.example.MyService.class)&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Start the Connect framework, making sure this plugin is included on the plugin path and that it somehow invokes the &lt;tt&gt;ServiceLoader.load(...)&lt;/tt&gt; method&lt;/li&gt;
	&lt;li&gt;Observe that the services loaded by that invocation do not include the ones described in the &lt;tt&gt;META-INF/services/...&lt;/tt&gt; file contained in the JAR in the plugin&apos;s directory&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This is because the &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html#load(java.lang.Class)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ServiceLoader.load(Class)&lt;/a&gt;&#160;method uses the current thread&apos;s context classloader to locate resources and load services. The current thread&apos;s context classloader is, in most cases, an instance of &lt;tt&gt;DelegatingClassLoader&lt;/tt&gt;, which will (unless asked to locate resources corresponding to a provider-configuration file for a REST extension or config provider) simply delegate resource location to the parent and, unless asked to locate a class for a recognized plugin, also delegate class loading to the parent. Thus, none of the plugin&apos;s JARs are scanned for either provider-configuration files or for actual service classes.&lt;/p&gt;

&lt;p&gt;A viable workaround for some cases is to instead use the &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/util/ServiceLoader.html#load(java.lang.Class,%20java.lang.ClassLoader)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ServiceLoader.load(Class, ClassLoader)&lt;/a&gt;&#160;method,&#160;specifying the current class&apos;s classloader as the second argument. This causes the plugin&apos;s &lt;tt&gt;PluginClassLoader&lt;/tt&gt;, which will scan all JARs in the plugin&apos;s directory to be used to locate resources and classes.&lt;/p&gt;

&lt;p&gt;However, this may not be feasible in all cases, especially when working with external libraries that may be difficult or impossible to apply this workaround on.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13232333">KAFKA-8340</key>
            <summary>ServiceLoader fails when used from isolated plugin path directory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gharris1727">Greg Harris</assignee>
                                    <reporter username="ChrisEgerton">Chris Egerton</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 May 2019 21:26:32 +0000</created>
                <updated>Mon, 12 Feb 2024 22:29:12 +0000</updated>
                            <resolved>Thu, 17 Oct 2019 02:14:48 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>1.0.3</fixVersion>
                    <fixVersion>1.1.2</fixVersion>
                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.2</fixVersion>
                    <fixVersion>2.3.2</fixVersion>
                    <fixVersion>2.4.0</fixVersion>
                    <fixVersion>2.5.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16925879" author="githubbot" created="Mon, 9 Sep 2019 16:20:10 +0000"  >&lt;p&gt;gharris1727 commented on pull request #7315: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8340&quot; title=&quot;ServiceLoader fails when used from isolated plugin path directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8340&quot;&gt;&lt;del&gt;KAFKA-8340&lt;/del&gt;&lt;/a&gt;: Use PluginClassLoader while statically initializing plugins&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7315&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7315&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   During plugin class loading and instance creation,&lt;br/&gt;
   change the current thread&apos;s context ClassLoader&lt;br/&gt;
   to the PluginClassLoader. This prevents issues where&lt;br/&gt;
   static initialization loads the wrong resources, or&lt;br/&gt;
   fails to find resources that are inside the plugin.&lt;br/&gt;
   This change impacts the following classes:&lt;br/&gt;
   Plugins, DelegatingClassLoader and PluginClassLoader.&lt;/p&gt;

&lt;p&gt;   In order to verify the original bug and verify the fix,&lt;br/&gt;
   three test plugins with assertions are included in this commit:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;`AlwaysSucceed` shows that plugins can be loaded&lt;/li&gt;
	&lt;li&gt;`AlwaysThrowException` shows that exceptions are captured&lt;/li&gt;
	&lt;li&gt;`ExpectPluginClassLoader` asserts that the&lt;br/&gt;
   PluginClassLoader is active during static initialization.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   These plugins are stored in the resources directory.&lt;br/&gt;
   Each plugin has it&apos;s own source tree, and can have arbitrary code.&lt;br/&gt;
   The plugins are compiled into class files in-place.&lt;br/&gt;
   They are then packaged into a jar in a temporary file &lt;br/&gt;
   which is deleted after the process exits.&lt;br/&gt;
   This jar is then exposed for use in `plugin.path`, and tests&lt;br/&gt;
   can access to the plugin class names through constants.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16953313" author="githubbot" created="Thu, 17 Oct 2019 01:43:05 +0000"  >&lt;p&gt;rhauch commented on pull request #7315: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8340&quot; title=&quot;ServiceLoader fails when used from isolated plugin path directory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8340&quot;&gt;&lt;del&gt;KAFKA-8340&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8819&quot; title=&quot;Plugin path for converters not working as intended&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8819&quot;&gt;&lt;del&gt;KAFKA-8819&lt;/del&gt;&lt;/a&gt;: Use PluginClassLoader while statically initializing plugins&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7315&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7315&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16953327" author="rhauch" created="Thu, 17 Oct 2019 02:14:38 +0000"  >&lt;p&gt;Merged &lt;a href=&quot;https://github.com/apache/kafka/pull/7315&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7315&lt;/a&gt; to `trunk` and backported to `2.4`, `2.3`, `2.2`, `2.1`, and `2.0`. Could not merge farther back then that without quite a few changes, so I think having a separate PR is the better way to go so that we can review the changes.&lt;/p&gt;</comment>
                            <comment id="16957411" author="rhauch" created="Tue, 22 Oct 2019 23:15:41 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9057&quot; title=&quot;Backport KAFKA-8819 and KAFKA-8340 to 1.1 and 1.0 branches&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9057&quot;&gt;&lt;del&gt;KAFKA-9057&lt;/del&gt;&lt;/a&gt; for the additional PRs that were needed to backport this fix to the `1.1` and `1.0` branches.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13106840">KAFKA-6007</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13262746">KAFKA-9057</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13251710">KAFKA-8819</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13521543">KAFKA-14654</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13277959">KAFKA-9376</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13522596">KAFKA-14670</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z02ip4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rhauch</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>