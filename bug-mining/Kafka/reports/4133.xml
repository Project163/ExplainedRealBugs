<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:42:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-18979] kraft.version wrongly upgraded to 1 after upgrading to v4.0</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-18979</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Since &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-16538&quot; title=&quot;Support UpdateFeatures for kraft.version so we can go from static quorums to dynamic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-16538&quot;&gt;&lt;del&gt;KAFKA-16538&lt;/del&gt;&lt;/a&gt; is still not implemented, we don&apos;t support migration from static quorum to dynamic quorum so far.&lt;/p&gt;

&lt;p&gt;Based on the &lt;a href=&quot;https://kafka.apache.org/40/documentation/#static_versus_dynamic_kraft_quorums&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;doc&lt;/a&gt;, when using `controller.quorum.voters` in the config, it&apos;ll be &quot;static KRaft quorum&quot;, and the `kraft.version` will be 0. But after upgrading to v4.0, it&apos;s wrongly upgraded to 1. Under the `kraft.version` is set to 1, the dynamic controller addition/removal will fail, which is confusing to users.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;start a 3.9 controller node with `controller.quorum.voters`, instead of `controller.quorum.bootstrap.servers`&lt;/li&gt;
	&lt;li&gt;Verify the `kraft.version` Finalized version is 0&lt;/li&gt;
&lt;/ol&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/kafka-features.sh --bootstrap-controller localhost:9093 describe
Feature: kraft.version &#160; &#160;SupportedMinVersion: 0 &#160; &#160;SupportedMaxVersion: 1 &#160; &#160;FinalizedVersionLevel: 0 &#160; &#160;Epoch: 4
Feature: metadata.version &#160; &#160;SupportedMinVersion: 3.0-IV1 &#160; &#160;SupportedMaxVersion: 3.9-IV0 &#160; &#160;FinalizedVersionLevel: 3.9-IV0 &#160; &#160;Epoch: 4&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
	&lt;li&gt;Upgrade to v4.0 following this &lt;a href=&quot;https://kafka.apache.org/40/documentation/#upgrade_servers_4_0_0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;doc&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/kafka-features.sh --bootstrap-controller localhost:9093 upgrade --release-version 4.0

group.version was upgraded to 1.
kraft.version was upgraded to 1.
metadata.version was upgraded to 25.
transaction.version was upgraded to 2. &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
	&lt;li&gt;Verify the `kraft.version` Finalized version is 1 now&lt;/li&gt;
&lt;/ol&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./bin/kafka-features.sh --bootstrap-controller localhost:9093 describe &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;
Feature: eligible.leader.replicas.version &#160; &#160;SupportedMinVersion: 0 &#160; &#160;SupportedMaxVersion: 1 &#160; &#160;FinalizedVersionLevel: 0 &#160; &#160;Epoch: 245
Feature: group.version &#160; &#160;SupportedMinVersion: 0 &#160; &#160;SupportedMaxVersion: 1 &#160; &#160;FinalizedVersionLevel: 1 &#160; &#160;Epoch: 245
Feature: kraft.version &#160; &#160;SupportedMinVersion: 0 &#160; &#160;SupportedMaxVersion: 1 &#160; &#160;FinalizedVersionLevel: 1 &#160; &#160;Epoch: 245
Feature: metadata.version &#160; &#160;SupportedMinVersion: 3.3-IV3 &#160; &#160;SupportedMaxVersion: 4.0-IV3 &#160; &#160;FinalizedVersionLevel: 4.0-IV3 &#160; &#160;Epoch: 245
Feature: transaction.version &#160; &#160;SupportedMinVersion: 0 &#160; &#160;SupportedMaxVersion: 2 &#160; &#160;FinalizedVersionLevel: 2 &#160; &#160;Epoch: 245&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
	&lt;li&gt;Run dynamically controller addition/removal&lt;/li&gt;
&lt;/ol&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/kafka-metadata-quorum.sh --command-config config/kraft/controller4.properties --bootstrap-controller localhost:9093 add-controller&#160;
org.apache.kafka.common.errors.UnsupportedVersionException: Cluster doesn&apos;t support adding voter because the kraft.version feature is 0
java.util.concurrent.ExecutionException: org.apache.kafka.common.errors.UnsupportedVersionException: Cluster doesn&apos;t support adding voter because the kraft.version feature is 0
&#160; &#160; at java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:396)
&#160; &#160; at java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2073)
&#160; &#160; at org.apache.kafka.common.internals.KafkaFutureImpl.get(KafkaFutureImpl.java:155)
&#160; &#160; at org.apache.kafka.tools.MetadataQuorumCommand.handleAddController(MetadataQuorumCommand.java:432)
&#160; &#160; at org.apache.kafka.tools.MetadataQuorumCommand.execute(MetadataQuorumCommand.java:148)
&#160; &#160; at org.apache.kafka.tools.MetadataQuorumCommand.mainNoExit(MetadataQuorumCommand.java:81)
&#160; &#160; at org.apache.kafka.tools.MetadataQuorumCommand.main(MetadataQuorumCommand.java:76)
Caused by: org.apache.kafka.common.errors.UnsupportedVersionException: Cluster doesn&apos;t support adding voter because the kraft.version feature is 0 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13611712">KAFKA-18979</key>
            <summary>kraft.version wrongly upgraded to 1 after upgrading to v4.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jsancio">Jos&#233; Armando Garc&#237;a Sancio</assignee>
                                    <reporter username="showuon">Luke Chen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Mar 2025 12:20:33 +0000</created>
                <updated>Fri, 14 Mar 2025 04:17:32 +0000</updated>
                            <resolved>Thu, 13 Mar 2025 23:57:49 +0000</resolved>
                                    <version>4.0.0</version>
                                    <fixVersion>4.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="17935172" author="JIRAUSER300229" created="Thu, 13 Mar 2025 12:24:51 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=showuon&quot; class=&quot;user-hover&quot; rel=&quot;showuon&quot;&gt;showuon&lt;/a&gt;, may I take this issue, if you&apos;re not working on it? Thanks.&lt;/p&gt;</comment>
                            <comment id="17935174" author="showuon" created="Thu, 13 Mar 2025 12:27:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jsancio&quot; class=&quot;user-hover&quot; rel=&quot;jsancio&quot;&gt;jsancio&lt;/a&gt; , please take a look to see if it&apos;s a blocker for v4.0 or not. Thanks.&lt;/p&gt;</comment>
                            <comment id="17935182" author="fvaleri" created="Thu, 13 Mar 2025 13:02:15 +0000"  >&lt;p&gt;I can confirm the issue:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# controller initialized with Kafka 3.9
$ &lt;span class=&quot;code-quote&quot;&gt;&quot;$KAFKA_39&quot;&lt;/span&gt;/bin/kafka-features.sh --bootstrap-controller :8000 describe
Feature: kraft.version	SupportedMinVersion: 0	SupportedMaxVersion: 1	FinalizedVersionLevel: 0	Epoch: 4
Feature: metadata.version	SupportedMinVersion: 3.0-IV1	SupportedMaxVersion: 3.9-IV0	FinalizedVersionLevel: 3.9-IV0	Epoch: 4

# binaries switched to Kafka 4.0 rc3
&lt;span class=&quot;code-quote&quot;&gt;&quot;$KAFKA_40&quot;&lt;/span&gt;/bin/kafka-features.sh --bootstrap-controller :8000 describe
Feature: eligible.leader.replicas.version	SupportedMinVersion: 0	SupportedMaxVersion: 1	FinalizedVersionLevel: 0	Epoch: 32
Feature: group.version	SupportedMinVersion: 0	SupportedMaxVersion: 1	FinalizedVersionLevel: 0	Epoch: 32
Feature: kraft.version	SupportedMinVersion: 0	SupportedMaxVersion: 1	FinalizedVersionLevel: 0	Epoch: 32
Feature: metadata.version	SupportedMinVersion: 3.3-IV3	SupportedMaxVersion: 4.0-IV3	FinalizedVersionLevel: 3.9-IV0	Epoch: 32
Feature: transaction.version	SupportedMinVersion: 0	SupportedMaxVersion: 2	FinalizedVersionLevel: 0	Epoch: 32

# upgrade finalized
$ &lt;span class=&quot;code-quote&quot;&gt;&quot;$KAFKA_40&quot;&lt;/span&gt;/bin/kafka-features.sh --bootstrap-controller :8000 describe
Feature: eligible.leader.replicas.version	SupportedMinVersion: 0	SupportedMaxVersion: 1	FinalizedVersionLevel: 0	Epoch: 1550
Feature: group.version	SupportedMinVersion: 0	SupportedMaxVersion: 1	FinalizedVersionLevel: 1	Epoch: 1550
Feature: kraft.version	SupportedMinVersion: 0	SupportedMaxVersion: 1	FinalizedVersionLevel: 1	Epoch: 1550
Feature: metadata.version	SupportedMinVersion: 3.3-IV3	SupportedMaxVersion: 4.0-IV3	FinalizedVersionLevel: 4.0-IV3	Epoch: 1550
Feature: transaction.version	SupportedMinVersion: 0	SupportedMaxVersion: 2	FinalizedVersionLevel: 2	Epoch: 1550
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17935206" author="JIRAUSER300229" created="Thu, 13 Mar 2025 13:43:01 +0000"  >&lt;p&gt;The root cause maybe that: when we update features, we add &quot;kraft.version&quot; to FeatureLevelRecord, not KRaftVersionRecord, so KRaftControlRecordStateMachine cannot represent correct &quot;kraft.version&quot;. I will try to update this part.&lt;/p&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;offset: 291 CreateTime: 1741872471454 keySize: -1 valueSize: 20 sequence: -1 headerKeys: [] payload: {&quot;type&quot;:&quot;FEATURE_LEVEL_RECORD&quot;,&quot;version&quot;:0,&quot;data&quot;:{&quot;name&quot;:&quot;kraft.version&quot;,&quot;featureLevel&quot;:1}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17935250" author="jsancio" created="Thu, 13 Mar 2025 15:21:54 +0000"  >&lt;p&gt;I don&apos;t think we should make it a block for 4.0 for two reasons. The same issue should be present in 3.9 so it is not a regression. You can argue that this is a UI issue.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=showuon&quot; class=&quot;user-hover&quot; rel=&quot;showuon&quot;&gt;showuon&lt;/a&gt; , Do you still see this output after incorrectly upgrading the kraft.version and after including &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-18920&quot; title=&quot;The kcontrollers do not set kraft.version in ApiVersionsResponse&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-18920&quot;&gt;&lt;del&gt;KAFKA-18920&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./bin/kafka-features.sh --bootstrap-controller localhost:9093 describe &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;&#160;
Feature: kraft.version &#160; &#160;SupportedMinVersion: 0 &#160; &#160;SupportedMaxVersion: 1 &#160; &#160;FinalizedVersionLevel: 1 &#160; &#160;Epoch: 245
... &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I am going to take this Jira as my PR for &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-16538&quot; title=&quot;Support UpdateFeatures for kraft.version so we can go from static quorums to dynamic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-16538&quot;&gt;&lt;del&gt;KAFKA-16538&lt;/del&gt;&lt;/a&gt; will also include fixing the incorrectly written FeatureLevelRecord that were added to the log thanks to this issue.&#160;&lt;/p&gt;</comment>
                            <comment id="17935380" author="jsancio" created="Thu, 13 Mar 2025 23:56:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=showuon&quot; class=&quot;user-hover&quot; rel=&quot;showuon&quot;&gt;showuon&lt;/a&gt; I fixed the incorrect reporting by &lt;tt&gt;kafka-features describe&lt;/tt&gt;. The incorrect output in &lt;tt&gt;kafka-features upgrade&lt;/tt&gt; is a little more complicated to fix for 4.0.0:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/kafka-features.sh --bootstrap-controller localhost:9093 upgrade --release-version 4.0
...
kraft.version was upgraded to 1. &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;ll fix that as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-16538&quot; title=&quot;Support UpdateFeatures for kraft.version so we can go from static quorums to dynamic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-16538&quot;&gt;&lt;del&gt;KAFKA-16538&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13575564">KAFKA-16538</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13610616">KAFKA-18920</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ur6w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>