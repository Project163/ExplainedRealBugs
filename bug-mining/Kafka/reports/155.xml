<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:36:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-608] getTopicMetadata does not respect producer config settings</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-608</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;ProducerPool.scala contains the following code:&lt;br/&gt;
object ProducerPool{&lt;br/&gt;
  def createSyncProducer(configOpt: Option&lt;span class=&quot;error&quot;&gt;&amp;#91;ProducerConfig&amp;#93;&lt;/span&gt;, broker: Broker): SyncProducer = &lt;/p&gt;
{
    val props = new Properties()
    props.put(&quot;host&quot;, broker.host)
    props.put(&quot;port&quot;, broker.port.toString)
    if(configOpt.isDefined)
      props.putAll(configOpt.get.props.props)
    new SyncProducer(new SyncProducerConfig(props))
  }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;Note also, that ClientUtils.getTopicMetadata() does the following:&lt;br/&gt;
   ProducerPool.createSyncProducer(None, brokers&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;

&lt;p&gt;As a result there is no way to control the socket settings for the get metadata request.&lt;/p&gt;

&lt;p&gt;My recommendation is that we require the config to be specified in the &lt;/p&gt;

&lt;p&gt;Note that this creates a new sync producer without using ANY of the settings the user had given for the producer. In particular the socket timeout is defaulted to 500ms. &lt;/p&gt;

&lt;p&gt;This causes unit tests to fail a lot since a newly started test may easily timeout on a 500ms request.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12615925">KAFKA-608</key>
            <summary>getTopicMetadata does not respect producer config settings</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nehanarkhede">Neha Narkhede</assignee>
                                    <reporter username="jkreps">Jay Kreps</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Nov 2012 17:58:12 +0000</created>
                <updated>Wed, 5 Dec 2012 18:32:13 +0000</updated>
                            <resolved>Mon, 3 Dec 2012 23:26:06 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13506921" author="nehanarkhede" created="Thu, 29 Nov 2012 23:08:06 +0000"  >&lt;p&gt;Attaching a patch that makes the following changes -&lt;/p&gt;

&lt;p&gt;1. Fixes the metadata api calls to use the right producer config&lt;br/&gt;
2. Fixes the auto create topic issue to ignore the exception that complains that the topic was already created. This is fine since many brokers might be creating the topic at the same time. &lt;br/&gt;
3. Bumped up the ack timeout on the producer to 1500 as default&lt;/p&gt;</comment>
                            <comment id="13507494" author="junrao" created="Fri, 30 Nov 2012 17:49:47 +0000"  >&lt;p&gt;Thanks for the patch. Looks good overall. Some comments:&lt;/p&gt;

&lt;p&gt;1. TopicExistsException: The scala file is missing from the patch.&lt;/p&gt;

&lt;p&gt;2. DefaultEventHandler.send(): Do we want to prepend some text to the payload in the trace logging below?&lt;br/&gt;
        if (logger.isTraceEnabled) &lt;/p&gt;
{
          val successfullySentData = response.status.filter(_._2.error == ErrorMapping.NoError)
          successfullySentData.foreach(m =&amp;gt; messagesPerTopic(m._1).foreach(message =&amp;gt; trace(&quot;%s&quot;.format(Utils.readString(message.message.payload)))))
        }

&lt;p&gt;3. ProducerPool: Should we removed the commented out createSyncProducer()?&lt;/p&gt;

&lt;p&gt;4. ConsoleConsumer: Should numMessages be long instead of int?&lt;/p&gt;

&lt;p&gt;5. I was thinking of having a separate config for metadata request timeout. On second thought, this may not be necessary. The apps that really need a large metadata request timeout are migration tool and mirror maker since either of them could be mirroring a large number of topics. However, these apps can live with a large producer request timeout (which controls the timeout for both metadata and send requests). So, what this patch does is probably fine.&lt;/p&gt;</comment>
                            <comment id="13507504" author="nehanarkhede" created="Fri, 30 Nov 2012 18:00:20 +0000"  >&lt;p&gt;1. My bad, included in this patch&lt;br/&gt;
2. Absolutely, prepended &quot;Message: &quot;. Once this is checked in, we should update the system tests to use it. Will file another JIRA to cover that.&lt;br/&gt;
3,4. Makes sense, done.&lt;br/&gt;
5. Thought about it and am still investigating some bugs related to topic metadata request timeouts and large number of topics. Ultimately, in order to allow clients to scale the # of topics they produce to/consume from, we need to allow a much larger timeout to accomodate the get metadata request. This is true until we move to zookeeper 3.4.x that allows us to use the multi-get APIs, which will reduce the latency of fetching metadata from zookeeper from large number of zk paths. However, I&apos;m waiting for that investigation to complete and have &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-626&quot; title=&quot;Produce requests dropped due to socket timeouts on get metadata requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-626&quot;&gt;&lt;del&gt;KAFKA-626&lt;/del&gt;&lt;/a&gt; to cover that issue.&lt;/p&gt;</comment>
                            <comment id="13507546" author="swapnilghike" created="Fri, 30 Nov 2012 18:54:42 +0000"  >&lt;p&gt;Is including broker.list in properties necessary in ClientUtils.fetchTopicMetadata that is used by non-producer clients?&lt;/p&gt;</comment>
                            <comment id="13507552" author="nehanarkhede" created="Fri, 30 Nov 2012 19:00:55 +0000"  >&lt;p&gt;yes, you can&apos;t instantiate a ProducerConfig object without a broker.list, it is mandatory. Think about it this way, how will a producer send a request if it doesn&apos;t know who to talk to.&lt;/p&gt;</comment>
                            <comment id="13507821" author="junrao" created="Sat, 1 Dec 2012 01:31:42 +0000"  >&lt;p&gt;+1. For #2, may be we should prepend a bit more text like &quot;Successfully sent message:&quot; to make it more easily identifiable.&lt;/p&gt;</comment>
                            <comment id="13510264" author="jkreps" created="Wed, 5 Dec 2012 04:26:39 +0000"  >&lt;p&gt;Guys, previously we had a terrible api to fetch metadata. This is a public api, and it was checked in without being at all thought through. With this patch now we have two bad apis. How is this happening?&lt;/p&gt;</comment>
                            <comment id="13510663" author="junrao" created="Wed, 5 Dec 2012 18:32:13 +0000"  >&lt;p&gt;I guess that you are talking about ClientUtils. Currently, for java users, they only need to use the getMetadata api directly if they use SimpleConsumer (which is a public api). For that purpose, we added an api in SimpleConsumer to send TopicMetadataRequest. So, I am not sure if ClientUtils is really intended as a public api. We could make it a public api and get rid of the support of TopicMetadataRequest from SimpleConsumer, if people feel that&apos;s better.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="12616986">KAFKA-630</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12555429" name="kafka-608-v1.patch" size="23230" author="nehanarkhede" created="Thu, 29 Nov 2012 23:08:06 +0000"/>
                            <attachment id="12555538" name="kafka-608-v2.patch" size="33970" author="nehanarkhede" created="Fri, 30 Nov 2012 18:00:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>257505</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k2w7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>115286</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>