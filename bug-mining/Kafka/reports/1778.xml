<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:05:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6363] Use MockAdminClient for any unit tests that depend on AdminClient</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6363</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Today we have a few unit tests other than KafkaAdminClientTest that relies on MockKafkaAdminClientEnv.&lt;/p&gt;

&lt;p&gt;About this class and MockKafkaAdminClientEnv, my thoughts:&lt;/p&gt;

&lt;p&gt;1. MockKafkaAdminClientEnv is actually using a MockClient for the inner KafkaClient; it should be only used for the unit test of KafkaAdminClient itself.&lt;/p&gt;

&lt;p&gt;2. For any other unit tests on classes that depend on AdminClient, we should be using the MockAdminClient that mocks the whole AdminClient.&lt;/p&gt;

&lt;p&gt;So I suggest 1) in TopicAdminTest use MockAdminClient instead; 2) in KafkaAdminClientTest use MockClient and added a new static constructor that takes a KafkaClient; 3) remove the MockKafkaAdminClientEnv.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13125016">KAFKA-6363</key>
            <summary>Use MockAdminClient for any unit tests that depend on AdminClient</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="h314to">Filipe Agapito</assignee>
                                    <reporter username="guozhang">Guozhang Wang</reporter>
                        <labels>
                            <label>newbie</label>
                    </labels>
                <created>Thu, 14 Dec 2017 18:27:32 +0000</created>
                <updated>Tue, 9 Jan 2018 03:20:25 +0000</updated>
                            <resolved>Tue, 9 Jan 2018 03:20:25 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16291310" author="guozhang" created="Thu, 14 Dec 2017 18:28:44 +0000"  >&lt;p&gt;From the previous discussion:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cmccabe 3 days ago  Contributor
Reposting some of the stuff I said offline here:

It&apos;s great that we now have a MockAdminClient. This is something we discussed having before, but never got around to doing. As @guozhangwang said, MockKafkaAdminClientEnv is really just useful &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; testing KafkaAdminClient.

I don&lt;span class=&quot;code-quote&quot;&gt;&apos;t completely understand the proposal &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; removing MockKafkaAdminClientEnv -- it still seems useful &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KafkaAdminClientTest-- but I&apos;&lt;/span&gt;m probably missing something here. Is the idea to make it a &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;in KafkaAdminClientTest? That might be good.


guozhangwang a minute ago  Contributor
@cmccabe We could consider using a MockClient and added a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; constructor that takes a KafkaClient &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; KafkaAdminClientTest; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is basically what MockKafkaAdminClientEnv does.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16291888" author="cmccabe" created="Fri, 15 Dec 2017 01:28:33 +0000"  >&lt;p&gt;Thanks for working on refactoring this.&lt;/p&gt;

&lt;p&gt;I think maybe it&apos;s just the name that is confusing?  &lt;tt&gt;MockAdminClientEnv&lt;/tt&gt; suggests that it is an environment for &lt;tt&gt;MockAdminClient&lt;/tt&gt;, but of course it is not.  Perhaps we could just rename it to &lt;tt&gt;AdminClientUnitTestEnv&lt;/tt&gt;?  That would make it clear, I think.&lt;/p&gt;</comment>
                            <comment id="16292887" author="guozhang" created="Fri, 15 Dec 2017 17:38:09 +0000"  >&lt;p&gt;Currently &lt;tt&gt;MockKafkaAdminClientEnv&lt;/tt&gt; is used in these tests: &lt;tt&gt;KafkaAdminClientTest&lt;/tt&gt;, &lt;tt&gt;StreamsResetterTest&lt;/tt&gt;, &lt;tt&gt;TopicAdminTest&lt;/tt&gt; and &lt;tt&gt;MockClientSupplier&lt;/tt&gt;. The point is that besides &lt;tt&gt;KafkaAdminClientTest&lt;/tt&gt; all other unit tests would be better using &lt;tt&gt;MockAdminClient&lt;/tt&gt; directly. This JIRA is for that purpose primarily.&lt;/p&gt;

&lt;p&gt;As for the &lt;tt&gt;MockKafkaAdminClientEnv&lt;/tt&gt; class, I think it is either fine to rename and keep it, or just &quot;in-line&quot; its logic in &lt;tt&gt;KafkaAdminClient&lt;/tt&gt; to allow users to pass in a &lt;tt&gt;KafkaClient&lt;/tt&gt; which can be a &lt;tt&gt;MockClient&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16302899" author="h314to" created="Sun, 24 Dec 2017 17:08:48 +0000"  >&lt;p&gt;I&apos;d like to start contributing to Kafka. This seems like a nice and easy newbie bug, and therefore a good place to start. Can I work on this?&lt;/p&gt;</comment>
                            <comment id="16302930" author="mjsax" created="Sun, 24 Dec 2017 19:17:18 +0000"  >&lt;p&gt;Sure. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; can add you to the contributor list so you can assign JIRAs to yourself.&lt;/p&gt;</comment>
                            <comment id="16303641" author="bchen225242" created="Tue, 26 Dec 2017 08:34:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=h314to&quot; class=&quot;user-hover&quot; rel=&quot;h314to&quot;&gt;h314to&lt;/a&gt; Hello man, do you still want to work on this? If not, I could take this one over &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16303752" author="h314to" created="Tue, 26 Dec 2017 10:42:08 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bchen225242&quot; class=&quot;user-hover&quot; rel=&quot;bchen225242&quot;&gt;bchen225242&lt;/a&gt;. Sorry, I still want to work on this one. I just can&apos;t assign it to myself yet.&lt;/p&gt;</comment>
                            <comment id="16307433" author="githubbot" created="Mon, 1 Jan 2018 12:57:24 +0000"  >&lt;p&gt;h314to opened a new pull request #4371: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6363&quot; title=&quot;Use MockAdminClient for any unit tests that depend on AdminClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6363&quot;&gt;&lt;del&gt;KAFKA-6363&lt;/del&gt;&lt;/a&gt;: Use MockAdminClient for any unit tests that depend on Adm&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4371&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4371&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &#8230;inClient&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Implement MockAdminClient.deleteTopics&lt;/li&gt;
	&lt;li&gt;Use MockAdminClient instead of MockKafkaAdminClientEnv in StreamsResetterTest&lt;/li&gt;
	&lt;li&gt;Rename MockKafkaAdminClientEnv to AdminClientUnitTestEnv&lt;/li&gt;
	&lt;li&gt;Use MockAdminClient instead of MockKafkaAdminClientEnv in TopicAdminTest&lt;/li&gt;
	&lt;li&gt;Rename KafkaAdminClient to AdminClientUnitTestEnv in KafkaAdminClientTest.java&lt;/li&gt;
	&lt;li&gt;Migrate StreamThreadTest to MockAdminClient&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   *More detailed description of your change,&lt;br/&gt;
   if necessary. The PR title and PR message become&lt;br/&gt;
   the squashed commit message, so use a separate&lt;br/&gt;
   comment to ping reviewers.*&lt;/p&gt;

&lt;p&gt;   *Summary of testing strategy (including rationale)&lt;br/&gt;
   for the feature or bug fix. Unit and/or integration&lt;br/&gt;
   tests are expected for any behaviour change and&lt;br/&gt;
   system tests should be considered for larger changes.*&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16308352" author="guozhang" created="Tue, 2 Jan 2018 16:49:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=h314to&quot; class=&quot;user-hover&quot; rel=&quot;h314to&quot;&gt;h314to&lt;/a&gt; I have added you to the contributor list.&lt;/p&gt;</comment>
                            <comment id="16308399" author="h314to" created="Tue, 2 Jan 2018 17:27:37 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="16308424" author="h314to" created="Tue, 2 Jan 2018 17:47:10 +0000"  >&lt;p&gt;There&apos;s a small conflict with a recent commit. I&apos;ll fix and rebase it on trunk, re-test it, and push an updated version.&lt;/p&gt;</comment>
                            <comment id="16316912" author="githubbot" created="Mon, 8 Jan 2018 19:58:59 +0000"  >&lt;p&gt;guozhangwang closed pull request #4371: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6363&quot; title=&quot;Use MockAdminClient for any unit tests that depend on AdminClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6363&quot;&gt;&lt;del&gt;KAFKA-6363&lt;/del&gt;&lt;/a&gt;: Use MockAdminClient for any unit tests that depend on Adm&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4371&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4371&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/clients/src/test/java/org/apache/kafka/clients/admin/MockKafkaAdminClientEnv.java b/clients/src/test/java/org/apache/kafka/clients/admin/AdminClientUnitTestEnv.java&lt;br/&gt;
similarity index 91%&lt;br/&gt;
rename from clients/src/test/java/org/apache/kafka/clients/admin/MockKafkaAdminClientEnv.java&lt;br/&gt;
rename to clients/src/test/java/org/apache/kafka/clients/admin/AdminClientUnitTestEnv.java&lt;br/&gt;
index cca35ac22c9..10281fb6ffa 100644&lt;br/&gt;
&amp;#8212; a/clients/src/test/java/org/apache/kafka/clients/admin/MockKafkaAdminClientEnv.java&lt;br/&gt;
+++ b/clients/src/test/java/org/apache/kafka/clients/admin/AdminClientUnitTestEnv.java&lt;br/&gt;
@@ -35,21 +35,21 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&amp;lt;p&amp;gt;&lt;/li&gt;
	&lt;li&gt;When finished, be sure to 
{@link #close() close}
&lt;p&gt; the environment object.&lt;br/&gt;
  */&lt;br/&gt;
-public class MockKafkaAdminClientEnv implements AutoCloseable {&lt;br/&gt;
+public class AdminClientUnitTestEnv implements AutoCloseable {&lt;br/&gt;
     private final Time time;&lt;br/&gt;
     private final Cluster cluster;&lt;br/&gt;
     private final MockClient mockClient;&lt;br/&gt;
     private final KafkaAdminClient adminClient;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public MockKafkaAdminClientEnv(Cluster cluster, String...vals) {&lt;br/&gt;
+    public AdminClientUnitTestEnv(Cluster cluster, String...vals) 
{
         this(Time.SYSTEM, cluster, vals);
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public MockKafkaAdminClientEnv(Time time, Cluster cluster, String...vals) {&lt;br/&gt;
+    public AdminClientUnitTestEnv(Time time, Cluster cluster, String...vals) 
{
         this(time, cluster, newStrMap(vals));
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public MockKafkaAdminClientEnv(Time time, Cluster cluster, Map&amp;lt;String, Object&amp;gt; config) {&lt;br/&gt;
+    public AdminClientUnitTestEnv(Time time, Cluster cluster, Map&amp;lt;String, Object&amp;gt; config) {&lt;br/&gt;
         this.time = time;&lt;br/&gt;
         this.cluster = cluster;&lt;br/&gt;
         AdminClientConfig adminClientConfig = new AdminClientConfig(config);&lt;br/&gt;
diff --git a/clients/src/test/java/org/apache/kafka/clients/admin/KafkaAdminClientTest.java b/clients/src/test/java/org/apache/kafka/clients/admin/KafkaAdminClientTest.java&lt;br/&gt;
index c0fe73c36ed..84588a9f3be 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/clients/src/test/java/org/apache/kafka/clients/admin/KafkaAdminClientTest.java&lt;br/&gt;
+++ b/clients/src/test/java/org/apache/kafka/clients/admin/KafkaAdminClientTest.java&lt;br/&gt;
@@ -38,10 +38,10 @@&lt;br/&gt;
 import org.apache.kafka.common.errors.TimeoutException;&lt;br/&gt;
 import org.apache.kafka.common.errors.UnknownTopicOrPartitionException;&lt;br/&gt;
 import org.apache.kafka.common.protocol.Errors;&lt;br/&gt;
-import org.apache.kafka.common.requests.CreatePartitionsResponse;&lt;br/&gt;
 import org.apache.kafka.common.requests.ApiError;&lt;br/&gt;
 import org.apache.kafka.common.requests.CreateAclsResponse;&lt;br/&gt;
 import org.apache.kafka.common.requests.CreateAclsResponse.AclCreationResponse;&lt;br/&gt;
+import org.apache.kafka.common.requests.CreatePartitionsResponse;&lt;br/&gt;
 import org.apache.kafka.common.requests.CreateTopicsResponse;&lt;br/&gt;
 import org.apache.kafka.common.requests.DeleteAclsResponse;&lt;br/&gt;
 import org.apache.kafka.common.requests.DeleteAclsResponse.AclDeletionResult;&lt;br/&gt;
@@ -75,8 +75,8 @@&lt;br/&gt;
 import java.util.concurrent.Future;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; import static java.util.Arrays.asList;&lt;br/&gt;
-import static org.apache.kafka.common.requests.ResourceType.TOPIC;&lt;br/&gt;
 import static org.apache.kafka.common.requests.ResourceType.BROKER;&lt;br/&gt;
+import static org.apache.kafka.common.requests.ResourceType.TOPIC;&lt;br/&gt;
 import static org.junit.Assert.assertEquals;&lt;br/&gt;
 import static org.junit.Assert.assertNotNull;&lt;br/&gt;
 import static org.junit.Assert.assertTrue;&lt;br/&gt;
@@ -155,7 +155,7 @@ public void testGenerateClientId() &lt;/p&gt;
{
                 KafkaAdminClient.generateClientId(newConfMap(AdminClientConfig.CLIENT_ID_CONFIG, &quot;myCustomId&quot;)));
     }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static MockKafkaAdminClientEnv mockClientEnv(String... configVals) {&lt;br/&gt;
+    private static AdminClientUnitTestEnv mockClientEnv(String... configVals) {&lt;br/&gt;
         HashMap&amp;lt;Integer, Node&amp;gt; nodes = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
         nodes.put(0, new Node(0, &quot;localhost&quot;, 8121));&lt;br/&gt;
         nodes.put(1, new Node(1, &quot;localhost&quot;, 8122));&lt;br/&gt;
@@ -163,12 +163,12 @@ private static MockKafkaAdminClientEnv mockClientEnv(String... configVals) 
{
         Cluster cluster = new Cluster(&quot;mockClusterId&quot;, nodes.values(),
                 Collections.&amp;lt;PartitionInfo&amp;gt;emptySet(), Collections.&amp;lt;String&amp;gt;emptySet(),
                 Collections.&amp;lt;String&amp;gt;emptySet(), nodes.get(0));
-        return new MockKafkaAdminClientEnv(cluster, configVals);
+        return new AdminClientUnitTestEnv(cluster, configVals);
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Test&lt;br/&gt;
     public void testCloseAdminClient() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = mockClientEnv()) {&lt;br/&gt;
+        try (AdminClientUnitTestEnv env = mockClientEnv()) {&lt;br/&gt;
         }&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -190,7 +190,7 @@ private static void assertFutureError(Future&amp;lt;?&amp;gt; future, Class&amp;lt;? extends Throwabl&lt;br/&gt;
      */&lt;br/&gt;
     @Test&lt;br/&gt;
     public void testTimeoutWithoutMetadata() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = mockClientEnv(AdminClientConfig.REQUEST_TIMEOUT_MS_CONFIG, &quot;10&quot;)) {&lt;br/&gt;
+        try (AdminClientUnitTestEnv env = mockClientEnv(AdminClientConfig.REQUEST_TIMEOUT_MS_CONFIG, &quot;10&quot;)) {&lt;br/&gt;
             env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;br/&gt;
             env.kafkaClient().setNode(new Node(0, &quot;localhost&quot;, 8121));&lt;br/&gt;
             env.kafkaClient().prepareResponse(new CreateTopicsResponse(Collections.singletonMap(&quot;myTopic&quot;, new ApiError(Errors.NONE, &quot;&quot;))));&lt;br/&gt;
@@ -203,7 +203,7 @@ public void testTimeoutWithoutMetadata() throws Exception {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Test&lt;br/&gt;
     public void testCreateTopics() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = mockClientEnv()) {&lt;br/&gt;
+        try (AdminClientUnitTestEnv env = mockClientEnv()) {&lt;br/&gt;
             env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;br/&gt;
             env.kafkaClient().prepareMetadataUpdate(env.cluster(), Collections.&amp;lt;String&amp;gt;emptySet());&lt;br/&gt;
             env.kafkaClient().setNode(env.cluster().controller());&lt;br/&gt;
@@ -226,7 +226,7 @@ public void testCreateTopics() throws Exception {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Test&lt;br/&gt;
     public void testDescribeAcls() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = mockClientEnv()) {&lt;br/&gt;
+        try (AdminClientUnitTestEnv env = mockClientEnv()) {&lt;br/&gt;
             env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;br/&gt;
             env.kafkaClient().prepareMetadataUpdate(env.cluster(), Collections.&amp;lt;String&amp;gt;emptySet());&lt;br/&gt;
             env.kafkaClient().setNode(env.cluster().controller());&lt;br/&gt;
@@ -250,7 +250,7 @@ public void testDescribeAcls() throws Exception {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Test&lt;br/&gt;
     public void testCreateAcls() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = mockClientEnv()) {&lt;br/&gt;
+        try (AdminClientUnitTestEnv env = mockClientEnv()) {&lt;br/&gt;
             env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;br/&gt;
             env.kafkaClient().prepareMetadataUpdate(env.cluster(), Collections.&amp;lt;String&amp;gt;emptySet());&lt;br/&gt;
             env.kafkaClient().setNode(env.cluster().controller());&lt;br/&gt;
@@ -279,7 +279,7 @@ public void testCreateAcls() throws Exception {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Test&lt;br/&gt;
     public void testDeleteAcls() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = mockClientEnv()) {&lt;br/&gt;
+        try (AdminClientUnitTestEnv env = mockClientEnv()) {&lt;br/&gt;
             env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;br/&gt;
             env.kafkaClient().prepareMetadataUpdate(env.cluster(), Collections.&amp;lt;String&amp;gt;emptySet());&lt;br/&gt;
             env.kafkaClient().setNode(env.cluster().controller());&lt;br/&gt;
@@ -330,7 +330,7 @@ public void testHandleTimeout() throws Exception {&lt;br/&gt;
         Cluster cluster = new Cluster(&quot;mockClusterId&quot;, nodes.values(),&lt;br/&gt;
             Collections.&amp;lt;PartitionInfo&amp;gt;emptySet(), Collections.&amp;lt;String&amp;gt;emptySet(),&lt;br/&gt;
             Collections.&amp;lt;String&amp;gt;emptySet(), nodes.get(0));&lt;/li&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = new MockKafkaAdminClientEnv(time, cluster,&lt;br/&gt;
+        try (AdminClientUnitTestEnv env = new AdminClientUnitTestEnv(time, cluster,&lt;br/&gt;
             AdminClientConfig.RECONNECT_BACKOFF_MAX_MS_CONFIG, &quot;1&quot;,&lt;br/&gt;
                 AdminClientConfig.RECONNECT_BACKOFF_MS_CONFIG, &quot;1&quot;)) {&lt;br/&gt;
             env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;br/&gt;
@@ -374,7 +374,7 @@ public boolean conditionMet() {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Test&lt;br/&gt;
     public void testDescribeConfigs() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = mockClientEnv()) {&lt;br/&gt;
+        try (AdminClientUnitTestEnv env = mockClientEnv()) {&lt;br/&gt;
             env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;br/&gt;
             env.kafkaClient().prepareMetadataUpdate(env.cluster(), Collections.&amp;lt;String&amp;gt;emptySet());&lt;br/&gt;
             env.kafkaClient().setNode(env.cluster().controller());&lt;br/&gt;
@@ -390,7 +390,7 @@ public void testDescribeConfigs() throws Exception {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Test&lt;br/&gt;
     public void testCreatePartitions() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = mockClientEnv()) {&lt;br/&gt;
+        try (AdminClientUnitTestEnv env = mockClientEnv()) {&lt;br/&gt;
             env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;br/&gt;
             env.kafkaClient().prepareMetadataUpdate(env.cluster(), Collections.&amp;lt;String&amp;gt;emptySet());&lt;br/&gt;
             env.kafkaClient().setNode(env.cluster().controller());&lt;br/&gt;
@@ -443,7 +443,7 @@ public void testDeleteRecords() throws Exception {&lt;br/&gt;
         TopicPartition myTopicPartition3 = new TopicPartition(&quot;my_topic&quot;, 3);&lt;br/&gt;
         TopicPartition myTopicPartition4 = new TopicPartition(&quot;my_topic&quot;, 4);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = new MockKafkaAdminClientEnv(cluster)) {&lt;br/&gt;
+        try (AdminClientUnitTestEnv env = new AdminClientUnitTestEnv(cluster)) 
{
             env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());
             env.kafkaClient().prepareMetadataUpdate(env.cluster(), Collections.&amp;lt;String&amp;gt;emptySet());
             env.kafkaClient().setNode(env.cluster().nodes().get(0));
diff --git a/clients/src/test/java/org/apache/kafka/clients/admin/MockAdminClient.java b/clients/src/test/java/org/apache/kafka/clients/admin/MockAdminClient.java
index b6a5888b5d2..c950163dc13 100644
--- a/clients/src/test/java/org/apache/kafka/clients/admin/MockAdminClient.java
+++ b/clients/src/test/java/org/apache/kafka/clients/admin/MockAdminClient.java
@@ -232,8 +232,32 @@ public DescribeTopicsResult describeTopics(Collection&amp;lt;String&amp;gt; topicNames, Descri
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public DeleteTopicsResult deleteTopics(Collection&amp;lt;String&amp;gt; topics, DeleteTopicsOptions options) {&lt;/li&gt;
	&lt;li&gt;throw new UnsupportedOperationException(&quot;Not implemented yet&quot;);&lt;br/&gt;
+    public DeleteTopicsResult deleteTopics(Collection&amp;lt;String&amp;gt; topicsToDelete, DeleteTopicsOptions options) {&lt;br/&gt;
+        Map&amp;lt;String, KafkaFuture&amp;lt;Void&amp;gt;&amp;gt; deleteTopicsResult = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
+&lt;br/&gt;
+        if (timeoutNextRequests &amp;gt; 0) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+            for (final String topicName }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+&lt;br/&gt;
+        for (final String topicName : topicsToDelete) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+            KafkaFutureImpl&amp;lt;Void&amp;gt; future = new KafkaFutureImpl&amp;lt;&amp;gt;();++            if (allTopics.remove(topicName) == null) {
+                future.completeExceptionally(new UnknownTopicOrPartitionException(String.format(&quot;Topic %s does not exist.&quot;, topicName)));
+            } else {
+                future.complete(null);
+            }+            deleteTopicsResult.put(topicName, future);+        }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+&lt;br/&gt;
+        return new DeleteTopicsResult(deleteTopicsResult);&lt;br/&gt;
     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Override&lt;br/&gt;
@@ -243,7 +267,12 @@ public CreatePartitionsResult createPartitions(Map&amp;lt;String, NewPartitions&amp;gt; newPar&lt;/p&gt;

&lt;p&gt;     @Override&lt;br/&gt;
     public DeleteRecordsResult deleteRecords(Map&amp;lt;TopicPartition, RecordsToDelete&amp;gt; recordsToDelete, DeleteRecordsOptions options) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throw new UnsupportedOperationException(&quot;Not implemented yet&quot;);&lt;br/&gt;
+        Map&amp;lt;TopicPartition, KafkaFuture&amp;lt;DeletedRecords&amp;gt;&amp;gt; deletedRecordsResult = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
+        if (recordsToDelete.isEmpty()) 
{
+            return new DeleteRecordsResult(deletedRecordsResult);
+        }
&lt;p&gt; else &lt;/p&gt;
{
+            throw new UnsupportedOperationException(&quot;Not implemented yet&quot;);
+        }
&lt;p&gt;     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Override&lt;br/&gt;
diff --git a/connect/runtime/src/test/java/org/apache/kafka/connect/util/TopicAdminTest.java b/connect/runtime/src/test/java/org/apache/kafka/connect/util/TopicAdminTest.java&lt;br/&gt;
index 0a61d3e9042..c58d6741f58 100644&lt;br/&gt;
&amp;#8212; a/connect/runtime/src/test/java/org/apache/kafka/connect/util/TopicAdminTest.java&lt;br/&gt;
+++ b/connect/runtime/src/test/java/org/apache/kafka/connect/util/TopicAdminTest.java&lt;br/&gt;
@@ -17,11 +17,13 @@&lt;br/&gt;
 package org.apache.kafka.connect.util;&lt;/p&gt;

&lt;p&gt; import org.apache.kafka.clients.NodeApiVersions;&lt;br/&gt;
-import org.apache.kafka.clients.admin.MockKafkaAdminClientEnv;&lt;br/&gt;
+import org.apache.kafka.clients.admin.MockAdminClient;&lt;br/&gt;
+import org.apache.kafka.clients.admin.AdminClientUnitTestEnv;&lt;br/&gt;
 import org.apache.kafka.clients.admin.NewTopic;&lt;br/&gt;
 import org.apache.kafka.common.Cluster;&lt;br/&gt;
 import org.apache.kafka.common.Node;&lt;br/&gt;
 import org.apache.kafka.common.PartitionInfo;&lt;br/&gt;
+import org.apache.kafka.common.TopicPartitionInfo;&lt;br/&gt;
 import org.apache.kafka.common.protocol.Errors;&lt;br/&gt;
 import org.apache.kafka.common.requests.ApiError;&lt;br/&gt;
 import org.apache.kafka.common.requests.CreateTopicsResponse;&lt;br/&gt;
@@ -47,7 +49,7 @@&lt;br/&gt;
     public void returnNullWithApiVersionMismatch() {&lt;br/&gt;
         final NewTopic newTopic = TopicAdmin.defineTopic(&quot;myTopic&quot;).partitions(1).compacted().build();&lt;br/&gt;
         Cluster cluster = createCluster(1);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = new MockKafkaAdminClientEnv(cluster)) {&lt;br/&gt;
+        try (AdminClientUnitTestEnv env = new AdminClientUnitTestEnv(cluster)) {&lt;br/&gt;
             env.kafkaClient().setNode(cluster.controller());&lt;br/&gt;
             env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;br/&gt;
             env.kafkaClient().prepareMetadataUpdate(env.cluster(), Collections.&amp;lt;String&amp;gt;emptySet());&lt;br/&gt;
@@ -62,14 +64,11 @@ public void returnNullWithApiVersionMismatch() {&lt;br/&gt;
     public void shouldNotCreateTopicWhenItAlreadyExists() {&lt;br/&gt;
         NewTopic newTopic = TopicAdmin.defineTopic(&quot;myTopic&quot;).partitions(1).compacted().build();&lt;br/&gt;
         Cluster cluster = createCluster(1);&lt;/li&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = new MockKafkaAdminClientEnv(cluster)) {&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().setNode(cluster.controller());&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().prepareMetadataUpdate(env.cluster(), Collections.&amp;lt;String&amp;gt;emptySet());&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().prepareResponse(createTopicResponseWithAlreadyExists(newTopic));&lt;/li&gt;
	&lt;li&gt;TopicAdmin admin = new TopicAdmin(null, env.adminClient());&lt;/li&gt;
	&lt;li&gt;boolean created = admin.createTopic(newTopic);&lt;/li&gt;
	&lt;li&gt;assertFalse(created);&lt;br/&gt;
+        try (MockAdminClient mockAdminClient = new MockAdminClient(cluster.nodes(), cluster.nodeById(0))) 
{
+            TopicPartitionInfo topicPartitionInfo = new TopicPartitionInfo(0, cluster.nodeById(0), cluster.nodes(), Collections.&amp;lt;Node&amp;gt;emptyList());
+            mockAdminClient.addTopic(false, &quot;myTopic&quot;, Collections.singletonList(topicPartitionInfo), null);
+            TopicAdmin admin = new TopicAdmin(null, mockAdminClient);
+            assertFalse(admin.createTopic(newTopic));
         }
&lt;p&gt;     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -77,14 +76,9 @@ public void shouldNotCreateTopicWhenItAlreadyExists() {&lt;br/&gt;
     public void shouldCreateTopicWhenItDoesNotExist() {&lt;br/&gt;
         NewTopic newTopic = TopicAdmin.defineTopic(&quot;myTopic&quot;).partitions(1).compacted().build();&lt;br/&gt;
         Cluster cluster = createCluster(1);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = new MockKafkaAdminClientEnv(cluster)) {&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().setNode(cluster.controller());&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().prepareMetadataUpdate(env.cluster(), Collections.&amp;lt;String&amp;gt;emptySet());&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().prepareResponse(createTopicResponse(newTopic));&lt;/li&gt;
	&lt;li&gt;TopicAdmin admin = new TopicAdmin(null, env.adminClient());&lt;/li&gt;
	&lt;li&gt;boolean created = admin.createTopic(newTopic);&lt;/li&gt;
	&lt;li&gt;assertTrue(created);&lt;br/&gt;
+        try (MockAdminClient mockAdminClient = new MockAdminClient(cluster.nodes(), cluster.nodeById(0))) 
{
+            TopicAdmin admin = new TopicAdmin(null, mockAdminClient);
+            assertTrue(admin.createTopic(newTopic));
         }
&lt;p&gt;     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -93,12 +87,8 @@ public void shouldCreateOneTopicWhenProvidedMultipleDefinitionsWithSameTopicName&lt;br/&gt;
         NewTopic newTopic1 = TopicAdmin.defineTopic(&quot;myTopic&quot;).partitions(1).compacted().build();&lt;br/&gt;
         NewTopic newTopic2 = TopicAdmin.defineTopic(&quot;myTopic&quot;).partitions(1).compacted().build();&lt;br/&gt;
         Cluster cluster = createCluster(1);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = new MockKafkaAdminClientEnv(cluster)) {&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().setNode(cluster.controller());&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().prepareMetadataUpdate(env.cluster(), Collections.&amp;lt;String&amp;gt;emptySet());&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().prepareResponse(createTopicResponse(newTopic1));&lt;/li&gt;
	&lt;li&gt;TopicAdmin admin = new TopicAdmin(null, env.adminClient());&lt;br/&gt;
+        try (MockAdminClient mockAdminClient = new MockAdminClient(cluster.nodes(), cluster.nodeById(0))) {&lt;br/&gt;
+            TopicAdmin admin = new TopicAdmin(null, mockAdminClient);&lt;br/&gt;
             Set&amp;lt;String&amp;gt; newTopicNames = admin.createTopics(newTopic1, newTopic2);&lt;br/&gt;
             assertEquals(1, newTopicNames.size());&lt;br/&gt;
             assertEquals(newTopic2.name(), newTopicNames.iterator().next());&lt;br/&gt;
@@ -108,11 +98,8 @@ public void shouldCreateOneTopicWhenProvidedMultipleDefinitionsWithSameTopicName&lt;br/&gt;
     @Test&lt;br/&gt;
     public void shouldReturnFalseWhenSuppliedNullTopicDescription() {&lt;br/&gt;
         Cluster cluster = createCluster(1);&lt;/li&gt;
	&lt;li&gt;try (MockKafkaAdminClientEnv env = new MockKafkaAdminClientEnv(cluster)) {&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().setNode(cluster.controller());&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;/li&gt;
	&lt;li&gt;env.kafkaClient().prepareMetadataUpdate(env.cluster(), Collections.&amp;lt;String&amp;gt;emptySet());&lt;/li&gt;
	&lt;li&gt;TopicAdmin admin = new TopicAdmin(null, env.adminClient());&lt;br/&gt;
+        try (MockAdminClient mockAdminClient = new MockAdminClient(cluster.nodes(), cluster.nodeById(0))) 
{
+            TopicAdmin admin = new TopicAdmin(null, mockAdminClient);
             boolean created = admin.createTopic(null);
             assertFalse(created);
         }
&lt;p&gt;@@ -120,7 +107,7 @@ public void shouldReturnFalseWhenSuppliedNullTopicDescription() {&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     private Cluster createCluster(int numNodes) {&lt;br/&gt;
         HashMap&amp;lt;Integer, Node&amp;gt; nodes = new HashMap&amp;lt;&amp;gt;();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for (int i = 0; i != numNodes; ++i) {&lt;br/&gt;
+        for (int i = 0; i &amp;lt; numNodes; ++i) 
{
             nodes.put(i, new Node(i, &quot;localhost&quot;, 8121 + i));
         }&lt;br/&gt;
         Cluster cluster = new Cluster(&quot;mockClusterId&quot;, nodes.values(),&lt;br/&gt;
@@ -129,14 +116,6 @@ private Cluster createCluster(int numNodes) {
         return cluster;
     }&lt;br/&gt;
 &lt;br/&gt;
-    private CreateTopicsResponse createTopicResponse(NewTopic... topics) {
-        return createTopicResponse(new ApiError(Errors.NONE, &quot;&quot;), topics);
-    }&lt;br/&gt;
-&lt;br/&gt;
-    private CreateTopicsResponse createTopicResponseWithAlreadyExists(NewTopic... topics) {
-        return createTopicResponse(new ApiError(Errors.TOPIC_ALREADY_EXISTS, &quot;Topic already exists&quot;), topics);
-    }&lt;br/&gt;
-&lt;br/&gt;
     private CreateTopicsResponse createTopicResponseWithUnsupportedVersion(NewTopic... topics) {
         return createTopicResponse(new ApiError(Errors.UNSUPPORTED_VERSION, &quot;This version of the API is not supported&quot;), topics);
     }&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/processor/internals/StreamThreadTest.java b/streams/src/test/java/org/apache/kafka/streams/processor/internals/StreamThreadTest.java&lt;br/&gt;
index 42504655117..6b760c16d62 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/processor/internals/StreamThreadTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/processor/internals/StreamThreadTest.java&lt;br/&gt;
@@ -23,6 +23,7 @@&lt;br/&gt;
 import org.apache.kafka.clients.consumer.MockConsumer;&lt;br/&gt;
 import org.apache.kafka.clients.producer.MockProducer;&lt;br/&gt;
 import org.apache.kafka.clients.producer.Producer;&lt;br/&gt;
+import org.apache.kafka.common.Cluster;&lt;br/&gt;
 import org.apache.kafka.common.MetricName;&lt;br/&gt;
 import org.apache.kafka.common.Node;&lt;br/&gt;
 import org.apache.kafka.common.PartitionInfo;&lt;br/&gt;
@@ -186,11 +187,23 @@ public boolean conditionMet() {
         assertEquals(thread.state(), StreamThread.State.DEAD);
     }&lt;br/&gt;
 &lt;br/&gt;
+    private Cluster createCluster(int numNodes) {&lt;br/&gt;
+        HashMap&amp;lt;Integer, Node&amp;gt; nodes = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
+        for (int i = 0; i &amp;lt; numNodes; ++i) {
+            nodes.put(i, new Node(i, &quot;localhost&quot;, 8121 + i));
+        }&lt;br/&gt;
+        return new Cluster(&quot;mockClusterId&quot;, nodes.values(),&lt;br/&gt;
+            Collections.&amp;lt;PartitionInfo&amp;gt;emptySet(), Collections.&amp;lt;String&amp;gt;emptySet(),&lt;br/&gt;
+            Collections.&amp;lt;String&amp;gt;emptySet(), nodes.get(0));&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
     private StreamThread createStreamThread(final String clientId, final StreamsConfig config, final boolean eosEnabled) {&lt;br/&gt;
         if (eosEnabled) {
             clientSupplier.setApplicationIdForProducer(applicationId);
         }&lt;br/&gt;
 &lt;br/&gt;
+        clientSupplier.setClusterForAdminClient(createCluster(1));&lt;br/&gt;
+&lt;br/&gt;
         return StreamThread.create(internalTopologyBuilder,&lt;br/&gt;
                                    config,&lt;br/&gt;
                                    clientSupplier,&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/tools/StreamsResetterTest.java b/streams/src/test/java/org/apache/kafka/streams/tools/StreamsResetterTest.java&lt;br/&gt;
index c6b0f5f8252..dd32ad0786a 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/tools/StreamsResetterTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/tools/StreamsResetterTest.java&lt;br/&gt;
@@ -17,8 +17,7 @@&lt;br/&gt;
 package org.apache.kafka.streams.tools;&lt;br/&gt;
 &lt;br/&gt;
 import kafka.tools.StreamsResetter;&lt;br/&gt;
-import org.apache.kafka.clients.NodeApiVersions;&lt;br/&gt;
-import org.apache.kafka.clients.admin.MockKafkaAdminClientEnv;&lt;br/&gt;
+import org.apache.kafka.clients.admin.MockAdminClient;&lt;br/&gt;
 import org.apache.kafka.clients.consumer.ConsumerRecord;&lt;br/&gt;
 import org.apache.kafka.clients.consumer.ConsumerRecords;&lt;br/&gt;
 import org.apache.kafka.clients.consumer.MockConsumer;&lt;br/&gt;
@@ -27,8 +26,7 @@&lt;br/&gt;
 import org.apache.kafka.common.Node;&lt;br/&gt;
 import org.apache.kafka.common.PartitionInfo;&lt;br/&gt;
 import org.apache.kafka.common.TopicPartition;&lt;br/&gt;
-import org.apache.kafka.common.protocol.Errors;&lt;br/&gt;
-import org.apache.kafka.common.requests.DeleteTopicsResponse;&lt;br/&gt;
+import org.apache.kafka.common.TopicPartitionInfo;&lt;br/&gt;
 import org.junit.Before;&lt;br/&gt;
 import org.junit.Test;&lt;br/&gt;
 &lt;br/&gt;
@@ -40,6 +38,7 @@&lt;br/&gt;
 import java.util.HashSet;&lt;br/&gt;
 import java.util.Map;&lt;br/&gt;
 import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ExecutionException;&lt;br/&gt;
 &lt;br/&gt;
 import static org.junit.Assert.assertEquals;&lt;br/&gt;
 import static org.junit.Assert.fail;&lt;br/&gt;
@@ -235,20 +234,19 @@ public void shouldSeekToEndOffset() {&lt;br/&gt;
     }&lt;br/&gt;
 &lt;br/&gt;
     @Test&lt;br/&gt;
-    public void shouldDeleteTopic() {&lt;br/&gt;
+    public void shouldDeleteTopic() throws InterruptedException, ExecutionException {&lt;br/&gt;
         Cluster cluster = createCluster(1);&lt;br/&gt;
-        try (MockKafkaAdminClientEnv env = new MockKafkaAdminClientEnv(cluster)) {&lt;br/&gt;
-            env.kafkaClient().setNode(cluster.controller());&lt;br/&gt;
-            env.kafkaClient().setNodeApiVersions(NodeApiVersions.create());&lt;br/&gt;
-            env.kafkaClient().prepareMetadataUpdate(env.cluster(), Collections.&amp;lt;String&amp;gt;emptySet());&lt;br/&gt;
-            env.kafkaClient().prepareResponse(new DeleteTopicsResponse(Collections.singletonMap(TOPIC, Errors.NONE)));&lt;br/&gt;
-            streamsResetter.doDelete(Collections.singletonList(topicPartition.topic()), env.adminClient());&lt;br/&gt;
+        try (MockAdminClient adminClient = new MockAdminClient(cluster.nodes(), cluster.nodeById(0))) {
+            TopicPartitionInfo topicPartitionInfo = new TopicPartitionInfo(0, cluster.nodeById(0), cluster.nodes(), Collections.&amp;lt;Node&amp;gt;emptyList());
+            adminClient.addTopic(false, TOPIC, Collections.singletonList(topicPartitionInfo), null);
+            streamsResetter.doDelete(Collections.singletonList(TOPIC), adminClient);
+            assertEquals(Collections.emptySet(), adminClient.listTopics().names().get());
         }&lt;br/&gt;
     }&lt;br/&gt;
 &lt;br/&gt;
     private Cluster createCluster(int numNodes) {&lt;br/&gt;
         HashMap&amp;lt;Integer, Node&amp;gt; nodes = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
-        for (int i = 0; i != numNodes; ++i) {&lt;br/&gt;
+        for (int i = 0; i &amp;lt; numNodes; ++i) {             nodes.put(i, new Node(i, &quot;localhost&quot;, 8121 + i));         }
&lt;p&gt;         return new Cluster(&quot;mockClusterId&quot;, nodes.values(),&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/test/MockClientSupplier.java b/streams/src/test/java/org/apache/kafka/test/MockClientSupplier.java&lt;br/&gt;
index ae83c60275c..1ec28fab0a1 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/streams/src/test/java/org/apache/kafka/test/MockClientSupplier.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/test/MockClientSupplier.java&lt;br/&gt;
@@ -17,7 +17,7 @@&lt;br/&gt;
 package org.apache.kafka.test;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; import org.apache.kafka.clients.admin.AdminClient;&lt;br/&gt;
-import org.apache.kafka.clients.admin.MockKafkaAdminClientEnv;&lt;br/&gt;
+import org.apache.kafka.clients.admin.MockAdminClient;&lt;br/&gt;
 import org.apache.kafka.clients.consumer.Consumer;&lt;br/&gt;
 import org.apache.kafka.clients.consumer.MockConsumer;&lt;br/&gt;
 import org.apache.kafka.clients.consumer.OffsetResetStrategy;&lt;br/&gt;
@@ -26,7 +26,6 @@&lt;br/&gt;
 import org.apache.kafka.clients.producer.ProducerConfig;&lt;br/&gt;
 import org.apache.kafka.common.Cluster;&lt;br/&gt;
 import org.apache.kafka.common.serialization.ByteArraySerializer;&lt;br/&gt;
-import org.apache.kafka.common.utils.Time;&lt;br/&gt;
 import org.apache.kafka.streams.KafkaClientSupplier;&lt;/p&gt;

&lt;p&gt; import java.util.LinkedList;&lt;br/&gt;
@@ -59,8 +58,7 @@ public void setClusterForAdminClient(final Cluster cluster) {&lt;/p&gt;

&lt;p&gt;     @Override&lt;br/&gt;
     public AdminClient getAdminClient(final Map&amp;lt;String, Object&amp;gt; config) &lt;/p&gt;
{
-        MockKafkaAdminClientEnv clientEnv = new MockKafkaAdminClientEnv(Time.SYSTEM, cluster, config);
-        return clientEnv.adminClient();
+        return new MockAdminClient(cluster.nodes(), cluster.nodeById(0));
     }

&lt;p&gt;     @Override&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 45 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nwyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>