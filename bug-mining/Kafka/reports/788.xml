<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:45:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2459] Connection backoff/blackout period should start when a connection is disconnected, not when the connection attempt was initiated</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2459</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Currently the connection code for new clients marks the time when a connection was initiated (NodeConnectionState.lastConnectMs) and then uses this to compute blackout periods for nodes, during which connections will not be attempted and the node is not considered a candidate for leastLoadedNode.&lt;/p&gt;

&lt;p&gt;However, in cases where the connection attempt takes longer than the blackout/backoff period (default 10ms), this results in incorrect behavior. If a broker is not available and, for example, the broker does not explicitly reject the connection, instead waiting for a connection timeout (e.g. due to firewall settings), then the backoff period will have already elapsed and the node will immediately be considered ready for a new connection attempt and a node to be selected by leastLoadedNode for metadata updates. I think it should be easy to reproduce and verify this problem manually by using tc to introduce enough latency to make connection failures take &amp;gt; 10ms.&lt;/p&gt;

&lt;p&gt;The correct behavior would use the disconnection event to mark the end of the last connection attempt and then wait for the backoff period to elapse after that.&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/kafka-users/201508.mbox/%3CCAJY8EofpeU4%2BAJ%3Dw91HDUx2RabjkWoU00Z%3DcQ2wHcQSrbPT4HA%40mail.gmail.com%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mail-archives.apache.org/mod_mbox/kafka-users/201508.mbox/%3CCAJY8EofpeU4%2BAJ%3Dw91HDUx2RabjkWoU00Z%3DcQ2wHcQSrbPT4HA%40mail.gmail.com%3E&lt;/a&gt; for the original description of the problem.&lt;/p&gt;

&lt;p&gt;This is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1843&quot; title=&quot;Metadata fetch/refresh in new producer should handle all node connection states gracefully&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1843&quot;&gt;KAFKA-1843&lt;/a&gt; because leastLoadedNode currently will consistently choose the same node if this blackout period is not handled correctly, but is a much smaller issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12858100">KAFKA-2459</key>
            <summary>Connection backoff/blackout period should start when a connection is disconnected, not when the connection attempt was initiated</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="enothereska">Eno Thereska</assignee>
                                    <reporter username="ewencp">Ewen Cheslack-Postava</reporter>
                        <labels>
                    </labels>
                <created>Sat, 22 Aug 2015 22:55:15 +0000</created>
                <updated>Thu, 14 Mar 2024 12:03:14 +0000</updated>
                            <resolved>Wed, 21 Oct 2015 17:00:04 +0000</resolved>
                                    <version>0.8.2.1</version>
                                    <fixVersion>0.9.0.0</fixVersion>
                                    <component>clients</component>
                    <component>consumer</component>
                    <component>producer </component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14904194" author="serialx" created="Wed, 23 Sep 2015 08:54:20 +0000"  >&lt;p&gt;How&apos;s the status of this issue? We use Kafka in AWS EC2. When a Kafka instance is terminated, we experience this problem.&lt;/p&gt;

&lt;p&gt;I tried to fix this myself. But looking at the code, it seems to need many refactoring for this to work out. If no one is working on this issue, can anyone give me some guidance for me to proceed?&lt;/p&gt;</comment>
                            <comment id="14949651" author="githubbot" created="Fri, 9 Oct 2015 00:05:32 +0000"  >&lt;p&gt;GitHub user enothereska opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/290&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/290&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2459&quot; title=&quot;Connection backoff/blackout period should start when a connection is disconnected, not when the connection attempt was initiated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2459&quot;&gt;&lt;del&gt;KAFKA-2459&lt;/del&gt;&lt;/a&gt;: connection backoff, timeouts and retries&lt;/p&gt;

&lt;p&gt;    This fix applies to three JIRAs, since they are all connected.&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2459&quot; title=&quot;Connection backoff/blackout period should start when a connection is disconnected, not when the connection attempt was initiated&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2459&quot;&gt;&lt;del&gt;KAFKA-2459&lt;/del&gt;&lt;/a&gt;Connection backoff/blackout period should start when a connection is disconnected, not when the connection attempt was initiated&lt;br/&gt;
    Backoff when connection is disconnected&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2615&quot; title=&quot;Poll() method is broken wrt time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2615&quot;&gt;&lt;del&gt;KAFKA-2615&lt;/del&gt;&lt;/a&gt;Poll() method is broken wrt time&lt;br/&gt;
    Added Time through the NetworkClient API. Minimal change.&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1843&quot; title=&quot;Metadata fetch/refresh in new producer should handle all node connection states gracefully&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1843&quot;&gt;KAFKA-1843&lt;/a&gt;Metadata fetch/refresh in new producer should handle all node connection states gracefully&lt;br/&gt;
    I&#8217;ve partially addressed this for a specific failure case in the JIRA.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/enothereska/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/enothereska/kafka&lt;/a&gt; trunk&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/290.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/290.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #290&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 90c0085a76374fafe6fa62c18e3d24504852e687&lt;br/&gt;
Author: Eno Thereska &amp;lt;eno.thereska@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-07T00:06:49Z&lt;/p&gt;

&lt;p&gt;    Commits to fix timing issues in three JIRAs&lt;/p&gt;

&lt;p&gt;commit ee66491fb36d55527d156afda90c3addc3eb3175&lt;br/&gt;
Author: Eno Thereska &amp;lt;eno.thereska@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-07T00:07:21Z&lt;/p&gt;

&lt;p&gt;    Merge remote-tracking branch &apos;apache-kafka/trunk&apos; into trunk&lt;/p&gt;

&lt;p&gt;commit 17a373733e414456475217248cbc7b0bc98fda40&lt;br/&gt;
Author: Eno Thereska &amp;lt;eno.thereska@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-07T15:15:19Z&lt;/p&gt;

&lt;p&gt;    Merge remote-tracking branch &apos;apache-kafka/trunk&apos; into trunk&lt;/p&gt;

&lt;p&gt;commit eb5fbf458a5b455ae8b3c8b3ebf32524f5a3ab3e&lt;br/&gt;
Author: Eno Thereska &amp;lt;eno.thereska@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-07T16:20:45Z&lt;/p&gt;

&lt;p&gt;    Removed debug messages&lt;/p&gt;

&lt;p&gt;commit 041baae45012cf8f99afd2c8b5d9a8099a8a928b&lt;br/&gt;
Author: Eno Thereska &amp;lt;eno.thereska@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-07T17:35:12Z&lt;/p&gt;

&lt;p&gt;    Pick a node, but not one that is blacked out&lt;/p&gt;

&lt;p&gt;commit 69679d7e61d36f76d2ea1dd1fcc0a1192c9b50d6&lt;br/&gt;
Author: Eno Thereska &amp;lt;eno.thereska@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-08T17:18:02Z&lt;/p&gt;

&lt;p&gt;    Removed unneeded checks&lt;/p&gt;

&lt;p&gt;commit 3ce5e151396575f45d1f022720f454ac36653d0d&lt;br/&gt;
Author: Eno Thereska &amp;lt;eno.thereska@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-08T17:18:18Z&lt;/p&gt;

&lt;p&gt;    Merge remote-tracking branch &apos;apache-kafka/trunk&apos; into trunk&lt;/p&gt;

&lt;p&gt;commit 76e6a0d8ab3fe847b28edde2e0072e7fe06484ff&lt;br/&gt;
Author: Eno Thereska &amp;lt;eno.thereska@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-08T23:35:41Z&lt;/p&gt;

&lt;p&gt;    More efficient implementation of nodesEverSeen&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14967457" author="guozhang" created="Wed, 21 Oct 2015 17:00:04 +0000"  >&lt;p&gt;Issue resolved by pull request 290&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/290&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/290&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14967459" author="githubbot" created="Wed, 21 Oct 2015 17:00:18 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/290&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/290&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12765191">KAFKA-1843</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 4 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j94n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>guozhang</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>