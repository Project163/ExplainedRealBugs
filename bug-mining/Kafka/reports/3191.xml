<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:29:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-13672] Race condition in DynamicBrokerConfig</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-13672</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Stacktrace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.opentest4j.AssertionFailedError: expected: &amp;lt;2&amp;gt; but was: &amp;lt;1&amp;gt;
	at app&lt;span class=&quot;code-comment&quot;&gt;//org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:182)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:177)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:1141)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.$anonfun$waitForConfigOnServer$1(DynamicBrokerReconfigurationTest.scala:1500)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.waitForConfigOnServer(DynamicBrokerReconfigurationTest.scala:1500)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.$anonfun$waitForConfig$1(DynamicBrokerReconfigurationTest.scala:1495)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.$anonfun$waitForConfig$1$adapted(DynamicBrokerReconfigurationTest.scala:1495)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//scala.collection.IterableOnceOps.foreach(IterableOnce.scala:563)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//scala.collection.IterableOnceOps.foreach$(IterableOnce.scala:561)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//scala.collection.AbstractIterable.foreach(Iterable.scala:926)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.waitForConfig(DynamicBrokerReconfigurationTest.scala:1495)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.reconfigureServers(DynamicBrokerReconfigurationTest.scala:1440)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.resizeThreadPool$1(DynamicBrokerReconfigurationTest.scala:775)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.$anonfun$testThreadPoolResize$3(DynamicBrokerReconfigurationTest.scala:768)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//scala.collection.immutable.Range.foreach$mVc$sp(Range.scala:190)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.testThreadPoolResize(DynamicBrokerReconfigurationTest.scala:784)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Job: &lt;a href=&quot;https://ci-builds.apache.org/job/Kafka/job/kafka-pr/job/PR-11751/5/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Kafka/job/kafka-pr/job/PR-11751/5/testReport/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13428907">KAFKA-13672</key>
            <summary>Race condition in DynamicBrokerConfig</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lclarkenz">Liam Clarke-Hutchinson</assignee>
                                    <reporter username="cadonna">Bruno Cadonna</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Feb 2022 19:27:33 +0000</created>
                <updated>Thu, 24 Mar 2022 06:07:06 +0000</updated>
                            <resolved>Thu, 24 Mar 2022 04:07:20 +0000</resolved>
                                                    <fixVersion>3.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17494613" author="cadonna" created="Fri, 18 Feb 2022 13:42:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://ci-builds.apache.org/job/Kafka/job/kafka-pr/job/PR-11752/8/testReport/kafka.server/DynamicBrokerReconfigurationTest/Build___JDK_11_and_Scala_2_13___testThreadPoolResize__/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/job/Kafka/job/kafka-pr/job/PR-11752/8/testReport/kafka.server/DynamicBrokerReconfigurationTest/Build___JDK_11_and_Scala_2_13___testThreadPoolResize__/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.opentest4j.AssertionFailedError: expected: &amp;lt;2&amp;gt; but was: &amp;lt;1&amp;gt;
	at app&lt;span class=&quot;code-comment&quot;&gt;//org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//org.junit.jupiter.api.AssertionUtils.failNotEqual(AssertionUtils.java:62)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:182)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//org.junit.jupiter.api.AssertEquals.assertEquals(AssertEquals.java:177)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//org.junit.jupiter.api.Assertions.assertEquals(Assertions.java:1141)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.$anonfun$waitForConfigOnServer$1(DynamicBrokerReconfigurationTest.scala:1500)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.waitForConfigOnServer(DynamicBrokerReconfigurationTest.scala:1500)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.$anonfun$waitForConfig$1(DynamicBrokerReconfigurationTest.scala:1495)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.$anonfun$waitForConfig$1$adapted(DynamicBrokerReconfigurationTest.scala:1495)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//scala.collection.IterableOnceOps.foreach(IterableOnce.scala:563)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//scala.collection.IterableOnceOps.foreach$(IterableOnce.scala:561)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//scala.collection.AbstractIterable.foreach(Iterable.scala:926)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.waitForConfig(DynamicBrokerReconfigurationTest.scala:1495)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.reconfigureServers(DynamicBrokerReconfigurationTest.scala:1440)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.resizeThreadPool$1(DynamicBrokerReconfigurationTest.scala:775)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.$anonfun$testThreadPoolResize$3(DynamicBrokerReconfigurationTest.scala:768)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//scala.collection.immutable.Range.foreach$mVc$sp(Range.scala:190)
&lt;/span&gt;	at app&lt;span class=&quot;code-comment&quot;&gt;//kafka.server.DynamicBrokerReconfigurationTest.testThreadPoolResize(DynamicBrokerReconfigurationTest.scala:784)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17509374" author="JIRAUSER279886" created="Sun, 20 Mar 2022 04:52:21 +0000"  >&lt;p&gt;I&apos;ve renamed this issue (was &lt;em&gt;Flaky test &lt;tt&gt;kafka.server.DynamicBrokerReconfigurationTest.testThreadPoolResize()&lt;/tt&gt;&lt;/em&gt;) because the test was actually exposing a race condition in &lt;tt&gt;DynamicBrokerConfig&lt;/tt&gt; that occurred when the broker under test was running sufficiently slowly. Many thanks are due to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=showuon&quot; class=&quot;user-hover&quot; rel=&quot;showuon&quot;&gt;showuon&lt;/a&gt; for all of his guidance and insight, and for identifying the root cause.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;DynamicBrokerConfig&lt;/tt&gt; stores a mutable buffer of &lt;tt&gt;Reconfigurable&lt;/tt&gt;s which are protected by a read lock and a write lock. However, these locks can&apos;t prevent the issue this test was exposing in the CI environment, which is -&#160; if a &lt;tt&gt;Reconfigurable&lt;/tt&gt; is added by one thread while another thread is updating dynamic configs (which involves iterating over the buffer of &lt;tt&gt;Reconfigurable&lt;/tt&gt;s) then this causes a &lt;tt&gt;ConcurrentModificationException&lt;/tt&gt; for the thread that is iterating, thus preventing some dynamic configs from being updated.&lt;/p&gt;

&lt;p&gt;I&apos;ll be submitting a PR shortly to guard against this race condition.&lt;/p&gt;</comment>
                            <comment id="17509558" author="showuon" created="Mon, 21 Mar 2022 02:44:20 +0000"  >&lt;p&gt;Great to hear that! But I&apos;m wondering why this happened recently only, not before? Did we change anything cause that?&lt;br/&gt;
&#160;&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 34 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0zneo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>