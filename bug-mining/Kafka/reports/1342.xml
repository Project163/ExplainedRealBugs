<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:58:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4596] KIP-73 rebalance throttling breaks on plans for specific partitions</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4596</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The reassign-partitions.sh command fails if you both &lt;b&gt;throttle&lt;/b&gt; and give it a specific partition reassignment. For example, upon reassigning &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;__consumer_offsets&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; partition 19, you get the following error:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Save &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to use as the --reassignment-json-file option during rollback
Warning: You must run Verify periodically, until the reassignment completes, to ensure the throttle is removed. You can also alter the throttle by rerunning the Execute command passing a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; value.
The throttle limit was set to 1048576 B/s
Partitions reassignment failed due to key not found: [__consumer_offsets,30]
java.util.NoSuchElementException: key not found: [__consumer_offsets,30]
        at scala.collection.MapLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;(MapLike.scala:228)
        at scala.collection.AbstractMap.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;(Map.scala:59)
        at scala.collection.MapLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;apply(MapLike.scala:141)
        at scala.collection.AbstractMap.apply(Map.scala:59)
        at kafka.admin.ReassignPartitionsCommand$$anonfun$kafka$admin$ReassignPartitionsCommand$$preRebalanceReplicaForMovingPartitions$1.apply(ReassignPartitionsCommand.scala:37
2)
        at kafka.admin.ReassignPartitionsCommand$$anonfun$kafka$admin$ReassignPartitionsCommand$$preRebalanceReplicaForMovingPartitions$1.apply(ReassignPartitionsCommand.scala:37
1)
        at scala.collection.TraversableLike$$anonfun$filterImpl$1.apply(TraversableLike.scala:248)
        at scala.collection.mutable.HashMap$$anonfun$foreach$1.apply(HashMap.scala:99)
        at scala.collection.mutable.HashMap$$anonfun$foreach$1.apply(HashMap.scala:99)
        at scala.collection.mutable.HashTable$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreachEntry(HashTable.scala:230)
        at scala.collection.mutable.HashMap.foreachEntry(HashMap.scala:40)
        at scala.collection.mutable.HashMap.foreach(HashMap.scala:99)
        at scala.collection.TraversableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;filterImpl(TraversableLike.scala:247)
        at scala.collection.TraversableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;filter(TraversableLike.scala:259)
        at scala.collection.AbstractTraversable.filter(Traversable.scala:104)
        at kafka.admin.ReassignPartitionsCommand.kafka$admin$ReassignPartitionsCommand$$preRebalanceReplicaForMovingPartitions(ReassignPartitionsCommand.scala:371)
        at kafka.admin.ReassignPartitionsCommand$$anonfun$assignThrottledReplicas$2.apply(ReassignPartitionsCommand.scala:347)
        at kafka.admin.ReassignPartitionsCommand$$anonfun$assignThrottledReplicas$2.apply(ReassignPartitionsCommand.scala:343)
        at scala.collection.mutable.ResizableArray$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(ResizableArray.scala:59)
        at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:48)
        at kafka.admin.ReassignPartitionsCommand.assignThrottledReplicas(ReassignPartitionsCommand.scala:343)
        at kafka.admin.ReassignPartitionsCommand.maybeThrottle(ReassignPartitionsCommand.scala:317)
        at kafka.admin.ReassignPartitionsCommand.reassignPartitions(ReassignPartitionsCommand.scala:387)
        at kafka.admin.ReassignPartitionsCommand$.executeAssignment(ReassignPartitionsCommand.scala:165)
        at kafka.admin.ReassignPartitionsCommand$.executeAssignment(ReassignPartitionsCommand.scala:149)
        at kafka.admin.ReassignPartitionsCommand$.main(ReassignPartitionsCommand.scala:46)
        at kafka.admin.ReassignPartitionsCommand.main(ReassignPartitionsCommand.scala)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This effectively breaks the throttling feature unless you want to rebalance many many partitions at once.&lt;/p&gt;

&lt;p&gt;For reference the command that was run is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;kafka-reassign-partitions.sh --reassignment-json-file 9b137f13_7e91_4757_a7b9_554ff458e7df.3d4269d5-e829
-4e86-9d05-91e9e2fcb7e7.reassignment_plan.json --throttle 1048576&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the contents of the plan file is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{&lt;span class=&quot;code-quote&quot;&gt;&quot;version&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;partitions&quot;&lt;/span&gt;:[{&lt;span class=&quot;code-quote&quot;&gt;&quot;topic&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;__consumer_offsets&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;partition&quot;&lt;/span&gt;:19,&lt;span class=&quot;code-quote&quot;&gt;&quot;replicas&quot;&lt;/span&gt;:[2,1,0]}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This seems like a simple logic error to me, where we&apos;re trying to look up a partition that&apos;s not been proposed, when we should not be. It looks like the logic assumes that &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Map.apply&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; doesn&apos;t error if the lookup value isn&apos;t found, when in fact it does.&lt;/p&gt;

&lt;p&gt;I checked that this cluster does indeed have the __consumer_offsets topic populated.&lt;/p&gt;</description>
                <environment>Kafka 0.10.1.1</environment>
        <key id="13032252">KAFKA-4596</key>
            <summary>KIP-73 rebalance throttling breaks on plans for specific partitions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benstopford">Ben Stopford</assignee>
                                    <reporter username="tcrayford-heroku">Tom Crayford</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Jan 2017 13:37:22 +0000</created>
                <updated>Wed, 25 Jan 2017 12:40:44 +0000</updated>
                            <resolved>Wed, 25 Jan 2017 12:40:44 +0000</resolved>
                                                    <fixVersion>0.10.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15801394" author="ijuma" created="Thu, 5 Jan 2017 13:52:03 +0000"  >&lt;p&gt;Thanks for the report. It is true that the existing code assumes that all existing partitions will be in the proposed map. The workaround seems to be to include all the partitions in the JSON (even if many of them have the same replica assignment to do it incrementally). This should work although the Controller will log every time it processes the reassignment for a partition where there was no change.&lt;/p&gt;

&lt;p&gt;Would you like to submit a fix?&lt;/p&gt;</comment>
                            <comment id="15804738" author="ijuma" created="Fri, 6 Jan 2017 15:09:58 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benstopford&quot; class=&quot;user-hover&quot; rel=&quot;benstopford&quot;&gt;benstopford&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15823463" author="ewencp" created="Mon, 16 Jan 2017 04:47:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tcrayford-heroku&quot; class=&quot;user-hover&quot; rel=&quot;tcrayford-heroku&quot;&gt;tcrayford-heroku&lt;/a&gt; This doesn&apos;t look very complicated since it just requires filling in existing partitions. Can we get it assigned to someone if we want it targeted for 0.10.2.0? If we can&apos;t find an assignee, I&apos;m going to bump it out of 0.10.2.0.&lt;/p&gt;</comment>
                            <comment id="15823797" author="ijuma" created="Mon, 16 Jan 2017 11:16:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt;, I&apos;m tentatively assigning this to Ben as he knows this code well and the fix is trivial, but important. Ben is back on Wednesday and if he can&apos;t do it, we&apos;ll find an alternative.&lt;/p&gt;</comment>
                            <comment id="15837660" author="githubbot" created="Wed, 25 Jan 2017 12:39:52 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2399&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2399&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38ay7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>