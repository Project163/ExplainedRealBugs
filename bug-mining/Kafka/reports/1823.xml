<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:06:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5550] Struct.put() should include the field name if validation fails</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5550</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When calling struct.put() with an invalid value, the error message should include the field name.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testPutIncludesFieldName() {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fieldName = &lt;span class=&quot;code-quote&quot;&gt;&quot;fieldName&quot;&lt;/span&gt;;
    Schema testSchema = SchemaBuilder.struct()
        .field(fieldName, Schema.STRING_SCHEMA);
    Struct struct = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Struct(testSchema);
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        struct.put(fieldName, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (DataException ex) {
        assertEquals(
            &lt;span class=&quot;code-quote&quot;&gt;&quot;Invalid value: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; used &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; required field: \&quot;&lt;/span&gt;fieldName\&lt;span class=&quot;code-quote&quot;&gt;&quot;, schema type: STRING&quot;&lt;/span&gt;,
            ex.getMessage()
        );
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13083964">KAFKA-5550</key>
            <summary>Struct.put() should include the field name if validation fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jcustenborder">Jeremy Custenborder</assignee>
                                    <reporter username="jcustenborder">Jeremy Custenborder</reporter>
                        <labels>
                    </labels>
                <created>Sat, 1 Jul 2017 01:55:52 +0000</created>
                <updated>Mon, 12 Feb 2018 17:25:22 +0000</updated>
                            <resolved>Mon, 12 Feb 2018 17:25:22 +0000</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16078943" author="githubbot" created="Sat, 8 Jul 2017 04:12:10 +0000"  >&lt;p&gt;GitHub user jcustenborder opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3507&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3507&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5550&quot; title=&quot;Struct.put() should include the field name if validation fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5550&quot;&gt;&lt;del&gt;KAFKA-5550&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;    Changed call to use the overload of ConnectSchema.validate method with the field name passed in. Ensure that field in put call is not null.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jcustenborder/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jcustenborder/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5550&quot; title=&quot;Struct.put() should include the field name if validation fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5550&quot;&gt;&lt;del&gt;KAFKA-5550&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3507.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3507.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3507&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 91741942912426e33ad032cdddfeecbc66edd37c&lt;br/&gt;
Author: Jeremy Custenborder &amp;lt;jcustenborder@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-07-01T02:07:10Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5550&quot; title=&quot;Struct.put() should include the field name if validation fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5550&quot;&gt;&lt;del&gt;KAFKA-5550&lt;/del&gt;&lt;/a&gt; Changed call to use the overload of ConnectSchema.validateValue() method with the field name passed in. Ensure that field in put call is not null.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16361101" author="githubbot" created="Mon, 12 Feb 2018 17:16:28 +0000"  >&lt;p&gt;hachikuji closed pull request #3507: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5550&quot; title=&quot;Struct.put() should include the field name if validation fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5550&quot;&gt;&lt;del&gt;KAFKA-5550&lt;/del&gt;&lt;/a&gt; &lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/3507&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3507&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/connect/api/src/main/java/org/apache/kafka/connect/data/Struct.java b/connect/api/src/main/java/org/apache/kafka/connect/data/Struct.java&lt;br/&gt;
index 6e7b5d23bbd..5e4de21b632 100644&lt;br/&gt;
&amp;#8212; a/connect/api/src/main/java/org/apache/kafka/connect/data/Struct.java&lt;br/&gt;
+++ b/connect/api/src/main/java/org/apache/kafka/connect/data/Struct.java&lt;br/&gt;
@@ -211,7 +211,9 @@ public Struct put(String fieldName, Object value) {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@return the Struct, to allow chaining of 
{@link #put(String, Object)}
&lt;p&gt; calls&lt;br/&gt;
      */&lt;br/&gt;
     public Struct put(Field field, Object value) &lt;/p&gt;
{
-        ConnectSchema.validateValue(field.schema(), value);
+        if (null == field)
+            throw new DataException(&quot;field cannot be null.&quot;);
+        ConnectSchema.validateValue(field.name(), field.schema(), value);
         values[field.index()] = value;
         return this;
     }
&lt;p&gt;diff --git a/connect/api/src/test/java/org/apache/kafka/connect/data/StructTest.java b/connect/api/src/test/java/org/apache/kafka/connect/data/StructTest.java&lt;br/&gt;
index 42345b1986c..e91960576a1 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/connect/api/src/test/java/org/apache/kafka/connect/data/StructTest.java&lt;br/&gt;
+++ b/connect/api/src/test/java/org/apache/kafka/connect/data/StructTest.java&lt;br/&gt;
@@ -266,4 +266,28 @@ public void testValidateFieldWithInvalidValueType() 
{
         thrown.expectMessage(&quot;Invalid Java object for schema type INT8: class java.lang.Object for field: \&quot;field\&quot;&quot;);
         ConnectSchema.validateValue(fieldName, Schema.INT8_SCHEMA, new Object());
     }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testPutNullField() &lt;/p&gt;
{
+        final String fieldName = &quot;fieldName&quot;;
+        Schema testSchema = SchemaBuilder.struct()
+            .field(fieldName, Schema.STRING_SCHEMA);
+        Struct struct = new Struct(testSchema);
+
+        thrown.expect(DataException.class);
+        Field field = null;
+        struct.put(field, &quot;valid&quot;);
+    }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testInvalidPutIncludesFieldName() &lt;/p&gt;
{
+        final String fieldName = &quot;fieldName&quot;;
+        Schema testSchema = SchemaBuilder.struct()
+            .field(fieldName, Schema.STRING_SCHEMA);
+        Struct struct = new Struct(testSchema);
+
+        thrown.expect(DataException.class);
+        thrown.expectMessage(&quot;Invalid value: null used for required field: \&quot;fieldName\&quot;, schema type: STRING&quot;);
+        struct.put(fieldName, null);
+    }
&lt;p&gt; }&lt;/p&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 40 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gzbr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>