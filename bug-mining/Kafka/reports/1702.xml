<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:04:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5953] Connect classloader isolation may be broken for JDBC drivers</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5953</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Let&apos;s suppose there are two connectors deployed&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;using JDBC driver (Debezium MySQL connector)&lt;/li&gt;
	&lt;li&gt;using PostgreSQL JDBC driver (JDBC sink).&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Connector 1 is started first - it executes a statement&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Connection conn = DriverManager.getConnection(url, props);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As a result a &lt;tt&gt;DriverManager&lt;/tt&gt; calls &lt;tt&gt;ServiceLoader&lt;/tt&gt; and searches for all JDBC drivers. The postgres driver from connector 2) is found associated with classloader from connector 1).&lt;/p&gt;

&lt;p&gt;Connector 2 is started after that - it executes a statement&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;connection = DriverManager.getConnection(url, username, password);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;DriverManager finds the connector that was loaded in step before but becuase the classloader is different - now we use classloader 2) so it refuses to load the class and no JDBC driver is found.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13103854">KAFKA-5953</key>
            <summary>Connect classloader isolation may be broken for JDBC drivers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkonstantine">Konstantine Karantasis</assignee>
                                    <reporter username="jpechane">Jiri Pechanec</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Sep 2017 08:51:16 +0000</created>
                <updated>Fri, 6 Oct 2017 18:44:07 +0000</updated>
                            <resolved>Fri, 6 Oct 2017 18:42:25 +0000</resolved>
                                    <version>0.11.0.0</version>
                                    <fixVersion>1.0.0</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16174490" author="jpechane" created="Thu, 21 Sep 2017 09:18:53 +0000"  >&lt;p&gt;Maybe &lt;tt&gt;getResource&lt;/tt&gt; method on ClassLoader should be overridden too.&lt;/p&gt;</comment>
                            <comment id="16191824" author="rhauch" created="Wed, 4 Oct 2017 18:51:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpechane&quot; class=&quot;user-hover&quot; rel=&quot;jpechane&quot;&gt;jpechane&lt;/a&gt; wrote:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;As a result a DriverManager calls ServiceLoader and searches for all JDBC drivers. The postgres driver from connector 2) is found associated with classloader from connector 1).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The DriverManager will call ServiceLoader to search for all JDBC drivers the first time the DriverManager is loaded. If Connect loads connector 1 first, then the DriverManager would search the classpath that includes the plugin for connector 1, but I don&apos;t understand how/why it would find the driver for connector 2 since that plugin&apos;s classloader is not used at this point. It does make sense, however, that once connector 2 is loaded, it would not find the PostgreSQL driver because the DriverManager has already called ServiceLoader and will not search the new classloader.&lt;/p&gt;</comment>
                            <comment id="16192436" author="jpechane" created="Thu, 5 Oct 2017 04:00:20 +0000"  >&lt;p&gt;I think the problem is that Connect&apos;s classloader does not override &lt;tt&gt;getResource&lt;/tt&gt; method that is used by &lt;tt&gt;ServiceLoader&lt;/tt&gt;. Thus the class resolution is delegated to the different classloader as default classloading rules apply in this case instead of classloading rules defined by Connects classloader.&lt;/p&gt;</comment>
                            <comment id="16193156" author="rhauch" created="Thu, 5 Oct 2017 16:39:05 +0000"  >&lt;p&gt;No, that&apos;s not the source of the problem. It has more to do with the timing of the first code to cause DriverManager to be loaded and initialized, at which point it attempts to scan for all the Driver classes using the system classloader. But when JDBC driver JARs are located within a plugin, the DriverManager only finds their Driver implementation if that plugin happened to be the first plugin to access DriverManager and/or use JDBC. Debezium&apos;s MySQL connector doesn&apos;t have a problem because it directly loads the MySQL Driver class, which like all Driver implementations registers itself with the DriverManager. &lt;/p&gt;

&lt;p&gt;A possible workaround is to have all the JDBC drivers on the classpath so that no matter when DriverManager is loaded it will always find the JDBC drivers. Of course, this is not ideal, which is why &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkonstantine&quot; class=&quot;user-hover&quot; rel=&quot;kkonstantine&quot;&gt;kkonstantine&lt;/a&gt; is looking into a fix for this.&lt;/p&gt;</comment>
                            <comment id="16193739" author="githubbot" created="Thu, 5 Oct 2017 21:25:29 +0000"  >&lt;p&gt;GitHub user kkonstantine opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4030&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4030&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5953&quot; title=&quot;Connect classloader isolation may be broken for JDBC drivers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5953&quot;&gt;&lt;del&gt;KAFKA-5953&lt;/del&gt;&lt;/a&gt;: Register all jdbc drivers available in plugin and class paths&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kkonstantine/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kkonstantine/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5953&quot; title=&quot;Connect classloader isolation may be broken for JDBC drivers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5953&quot;&gt;&lt;del&gt;KAFKA-5953&lt;/del&gt;&lt;/a&gt;-Connect-classloader-isolation-may-be-broken-for-JDBC-drivers&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4030.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4030.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4030&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="16194195" author="jpechane" created="Fri, 6 Oct 2017 06:05:58 +0000"  >&lt;p&gt;Is this issue limited only to JDBC drivers or to anything that uses ServiceLoader?&lt;/p&gt;</comment>
                            <comment id="16194261" author="kkonstantine" created="Fri, 6 Oct 2017 07:45:54 +0000"  >&lt;p&gt;This issue is specific to any JDBC drivers that are loaded through DriverManager (e.g. when &lt;tt&gt;getConnection&lt;/tt&gt; is used). &lt;/p&gt;</comment>
                            <comment id="16195015" author="ewencp" created="Fri, 6 Oct 2017 18:42:25 +0000"  >&lt;p&gt;Issue resolved by pull request 4030&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/4030&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4030&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16195018" author="githubbot" created="Fri, 6 Oct 2017 18:44:07 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4030&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4030&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 6 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3kca7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>