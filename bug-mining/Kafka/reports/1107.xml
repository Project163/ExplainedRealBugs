<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:55:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3890] Kafka Streams: task assignment is not maintained on cluster restart or rolling restart</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3890</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Currently the task assignment in TaskAssignor is not deterministic.  During cluster restart or rolling restart, even though the participating worker nodes are the same, but the TaskAssignor is not able to maintain a deterministic mapping, so about 20% partitions will be reassigned which would cause state repopulation on cluster restart time.&lt;/p&gt;

&lt;p&gt;When the participating worker nodes are not changed, we really just want to keep the old task assignment.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12981574">KAFKA-3890</key>
            <summary>Kafka Streams: task assignment is not maintained on cluster restart or rolling restart</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hcai@pinterest.com">Henry Cai</assignee>
                                    <reporter username="hcai@pinterest.com">Henry Cai</reporter>
                        <labels>
                            <label>api</label>
                            <label>newbie</label>
                    </labels>
                <created>Wed, 22 Jun 2016 02:15:32 +0000</created>
                <updated>Wed, 29 Jun 2016 22:22:12 +0000</updated>
                            <resolved>Wed, 29 Jun 2016 22:22:12 +0000</resolved>
                                                    <fixVersion>0.10.0.1</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15343209" author="hcai@pinterest.com" created="Wed, 22 Jun 2016 02:24:46 +0000"  >&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/kafka/pull/1538&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1538&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15345361" author="githubbot" created="Wed, 22 Jun 2016 23:12:10 +0000"  >&lt;p&gt;Github user HenryCaiHaiying closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1538&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1538&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15345362" author="githubbot" created="Wed, 22 Jun 2016 23:12:17 +0000"  >&lt;p&gt;GitHub user HenryCaiHaiying reopened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1538&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1538&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3890&quot; title=&quot;Kafka Streams: task assignment is not maintained on cluster restart or rolling restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3890&quot;&gt;&lt;del&gt;KAFKA-3890&lt;/del&gt;&lt;/a&gt; Kafka Streams: task assignment is not maintained on cluster restart or rolling restart&lt;/p&gt;

&lt;p&gt;    Current task assignment in TaskAssignor is not deterministic.&lt;/p&gt;

&lt;p&gt;    During cluster restart or rolling restart, we have the same set of participating worker nodes.  But the current TaskAssignor is not able to maintain a deterministic mapping, so about 20% partitions will be reassigned which would cause state repopulation.&lt;br/&gt;
    When the topology of work nodes (# of worker nodes, the TaskIds they are carrying with) is not changed, we really just want to keep the old task assignment.&lt;/p&gt;

&lt;p&gt;    Add the code to check whether the node topology is changing or not:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;when the prevAssignedTasks from the old clientStates is the same as the new task list&lt;/li&gt;
	&lt;li&gt;when there is no new node joining (its prevAssignTasks would be either empty or conflict with some other nodes)&lt;/li&gt;
	&lt;li&gt;when there is no node dropping out (the total of prevAssignedTasks from other nodes would not be equal to the new task list)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    When the topology is not changing, we would just use the old mapping.&lt;/p&gt;

&lt;p&gt;    I also added the code to check whether the previous assignment is balanced (whether each node&apos;s task list is within &lt;span class=&quot;error&quot;&gt;&amp;#91;1/2 average -- 2 * average&amp;#93;&lt;/span&gt;), if it&apos;s not balanced, we will still start the a new task assignment.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/HenryCaiHaiying/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/HenryCaiHaiying/kafka&lt;/a&gt; upstream&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1538.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1538.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1538&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="15345365" author="githubbot" created="Wed, 22 Jun 2016 23:12:26 +0000"  >&lt;p&gt;Github user HenryCaiHaiying closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1538&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1538&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15345367" author="githubbot" created="Wed, 22 Jun 2016 23:14:27 +0000"  >&lt;p&gt;GitHub user HenryCaiHaiying opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1543&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3890&quot; title=&quot;Kafka Streams: task assignment is not maintained on cluster restart or rolling restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3890&quot;&gt;&lt;del&gt;KAFKA-3890&lt;/del&gt;&lt;/a&gt; Kafka Streams: task assignment is not maintained on cluster restart or rolling restart&lt;/p&gt;

&lt;p&gt;    Current task assignment in TaskAssignor is not deterministic.&lt;/p&gt;

&lt;p&gt;    During cluster restart or rolling restart, we have the same set of participating worker nodes.  But the current TaskAssignor is not able to maintain a deterministic mapping, so about 20% partitions will be reassigned which would cause state repopulation.&lt;br/&gt;
    When the topology of work nodes (# of worker nodes, the TaskIds they are carrying with) is not changed, we really just want to keep the old task assignment.&lt;/p&gt;

&lt;p&gt;    Add the code to check whether the node topology is changing or not:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;when the prevAssignedTasks from the old clientStates is the same as the new task list&lt;/li&gt;
	&lt;li&gt;when there is no new node joining (its prevAssignTasks would be either empty or conflict with some other nodes)&lt;/li&gt;
	&lt;li&gt;when there is no node dropping out (the total of prevAssignedTasks from other nodes would not be equal to the new task list)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    When the topology is not changing, we would just use the old mapping.&lt;/p&gt;

&lt;p&gt;    I also added the code to check whether the previous assignment is balanced (whether each node&apos;s task list is within &lt;span class=&quot;error&quot;&gt;&amp;#91;1/2 average -- 2 * average&amp;#93;&lt;/span&gt;), if it&apos;s not balanced, we will still start the a new task assignment.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/HenryCaiHaiying/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/HenryCaiHaiying/kafka&lt;/a&gt; upstream&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1543.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1543.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1543&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="15355908" author="githubbot" created="Wed, 29 Jun 2016 22:20:48 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1543&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15355912" author="guozhang" created="Wed, 29 Jun 2016 22:22:12 +0000"  >&lt;p&gt;Issue resolved by pull request 1543&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1543&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="12971600">KAFKA-3740</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zum7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>