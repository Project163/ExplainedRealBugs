<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:43:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1886] SimpleConsumer swallowing ClosedByInterruptException</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1886</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;This issue was originally reported by a Samza developer. I&apos;ve included an exchange of mine with Chris Riccomini. I&apos;m trying to reproduce the problem on my dev setup.&lt;/p&gt;

&lt;p&gt;From: criccomi&lt;br/&gt;
Hey all,&lt;br/&gt;
Samza&apos;s BrokerProxy &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; threads appear to be wedging randomly when we try to interrupt its fetcher thread. I noticed that SimpleConsumer.scala catches Throwable in its sendRequest method &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;. I&apos;m wondering: if blockingChannel.send/receive throws a ClosedByInterruptException&lt;br/&gt;
when the thread is interrupted, what happens? It looks like sendRequest will catch the exception (which I&lt;br/&gt;
think clears the thread&apos;s interrupted flag), and then retries the send. If the send succeeds on the retry, I think that the ClosedByInterruptException exception is effectively swallowed, and the BrokerProxy will continue&lt;br/&gt;
fetching messages as though its thread was never interrupted.&lt;br/&gt;
Am I misunderstanding how things work?&lt;br/&gt;
Cheers,&lt;br/&gt;
Chris&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/incubator-samza/blob/master/samza-kafka/src/main/scala/org/apache/samza/system/kafka/BrokerProxy.scala#L126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/incubator-samza/blob/master/samza-kafka/src/main/scala/org/apache/samza/system/kafka/BrokerProxy.scala#L126&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/kafka/blob/0.8.1/core/src/main/scala/kafka/consumer/SimpleConsumer.scala#L75&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/0.8.1/core/src/main/scala/kafka/consumer/SimpleConsumer.scala#L75&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12768796">KAFKA-1886</key>
            <summary>SimpleConsumer swallowing ClosedByInterruptException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aauradkar">Aditya Auradkar</assignee>
                                    <reporter username="auradkar">Aditya A Auradkar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Jan 2015 21:12:43 +0000</created>
                <updated>Mon, 4 May 2015 18:55:30 +0000</updated>
                            <resolved>Mon, 4 May 2015 18:55:30 +0000</resolved>
                                                                    <component>producer </component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14284961" author="auradkar" created="Wed, 21 Jan 2015 01:15:10 +0000"  >&lt;p&gt;Did a good bit of poking around. Basically, I wrote a test that runs a SimpleConsumer inside a thread and interrupts that thread from the main thread. This forces a ClosedByInterruptException that we catch in the SimpleConsumer:sendRequest method. Catching this exception does not reset the interrupt status of the Thread. The returned exception is a ClosedChannelException and the original exception is swallowed.&lt;/p&gt;

&lt;p&gt;I can&apos;t spot any bug in Kafka here. I can suggest a couple of improvements:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Don&apos;t retry inside SimpleConsumer if we catch a ClosedByInterruptException. Seems like extra work for nothing.&lt;/li&gt;
	&lt;li&gt;Inspect code to check if we are catching InterruptedException somewhere. Based on a cursory inspection, I couldn&apos;t find anything.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14284963" author="auradkar" created="Wed, 21 Jan 2015 01:16:58 +0000"  >&lt;p&gt;If interested, I hacked an existing test for this.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def testConsumerEmptyTopic() {
      val newTopic = &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;-topic&quot;&lt;/span&gt;
      TestUtils.createTopic(zkClient, newTopic, numPartitions = 1, replicationFactor = 1, servers = servers)
      val thread = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; {
        override def run {
          &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Starting the fetch&quot;&lt;/span&gt;)
          val start = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis()
          &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
          {
            val fetchResponse = consumer.fetch(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FetchRequestBuilder().minBytes(100000).maxWait(3000).addFetch(newTopic, 0, 0, 10000).build())
          }
          &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; {
          &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; e: Throwable =&amp;gt;{
            val  end = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis()
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Caught exception&quot;&lt;/span&gt; + e + &lt;span class=&quot;code-quote&quot;&gt;&quot;. Took &quot;&lt;/span&gt; + (end - start));
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Fetch interrupted &quot;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().isInterrupted)
          }
          }
        }
      }

     thread.start()
      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000)
      thread.interrupt()
      thread.join()
      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Ending test&quot;&lt;/span&gt;)
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14286287" author="auradkar" created="Wed, 21 Jan 2015 21:19:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; any thoughts?&lt;/p&gt;</comment>
                            <comment id="14286326" author="criccomini" created="Wed, 21 Jan 2015 21:39:41 +0000"  >&lt;p&gt;IMO, the SimpleConsumer should at least throw the proper exception.&lt;/p&gt;</comment>
                            <comment id="14288350" author="auradkar" created="Thu, 22 Jan 2015 22:33:55 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/30196/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/30196/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14301981" author="auradkar" created="Mon, 2 Feb 2015 21:42:33 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/30527/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/30527/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14302007" author="auradkar" created="Mon, 2 Feb 2015 21:57:29 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/30196/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/30196/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14513154" author="nehanarkhede" created="Sun, 26 Apr 2015 17:40:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aauradkar&quot; class=&quot;user-hover&quot; rel=&quot;aauradkar&quot;&gt;aauradkar&lt;/a&gt; Took a quick look at your patch again. Are you planning on fixing it so we can merge? Realize that the simple consumer changes are going to matter less as we make more progress on the new consumer.&lt;/p&gt;</comment>
                            <comment id="14517479" author="auradkar" created="Tue, 28 Apr 2015 17:27:46 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/30196/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/30196/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14517489" author="aauradkar" created="Tue, 28 Apr 2015 17:32:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nehanarkhede&quot; class=&quot;user-hover&quot; rel=&quot;nehanarkhede&quot;&gt;nehanarkhede&lt;/a&gt; I&apos;ve updated the patch. This is a pretty trivial but relatively useful bug fix and for that reason I think we should merge it. Thoughts?&lt;/p&gt;</comment>
                            <comment id="14527061" author="nehanarkhede" created="Mon, 4 May 2015 18:55:30 +0000"  >&lt;p&gt;Thanks, pushed to trunk&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12768086">SAMZA-513</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12696008" name="KAFKA-1886.patch" size="9687" author="auradkar" created="Mon, 2 Feb 2015 21:42:33 +0000"/>
                            <attachment id="12694023" name="KAFKA-1886.patch" size="7373" author="auradkar" created="Thu, 22 Jan 2015 22:33:55 +0000"/>
                            <attachment id="12696014" name="KAFKA-1886_2015-02-02_13:57:23.patch" size="3247" author="auradkar" created="Mon, 2 Feb 2015 21:57:29 +0000"/>
                            <attachment id="12728847" name="KAFKA-1886_2015-04-28_10:27:39.patch" size="1115" author="auradkar" created="Tue, 28 Apr 2015 17:27:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 29 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24kzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>nehanarkhede</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>