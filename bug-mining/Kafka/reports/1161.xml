<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:55:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3937] Kafka Clients Leak Native Memory For Longer Than Needed With Compressed Messages</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3937</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-3933&lt;/a&gt;, we discovered that brokers can crash when performing log recovery, as they leak native memory whilst decompressing compressed segments, and that native memory isn&apos;t cleaned up rapidly enough by garbage collection and finalizers. The work to fix that in the brokers is taking part in &lt;a href=&quot;https://github.com/apache/kafka/pull/1598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1598&lt;/a&gt;. As part of that PR, Ismael Juma asked me to fix similar issues in the client. Rather than have one large PR that fixes everything, I&apos;d rather break this work up into seperate things, so I&apos;m filing this JIRA to track the followup work. I should get to a PR on this at some point relatively soon, once the other PR has landed.&lt;/p&gt;</description>
                <environment>Linux, latest oracle java-8</environment>
        <key id="12987799">KAFKA-3937</key>
            <summary>Kafka Clients Leak Native Memory For Longer Than Needed With Compressed Messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="williamyu">William Yu</assignee>
                                    <reporter username="tcrayford-heroku">Tom Crayford</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Jul 2016 14:18:10 +0000</created>
                <updated>Wed, 12 Apr 2017 23:21:05 +0000</updated>
                            <resolved>Tue, 23 Aug 2016 22:50:34 +0000</resolved>
                                    <version>0.8.2.2</version>
                    <version>0.9.0.1</version>
                    <version>0.10.0.0</version>
                                    <fixVersion>0.10.1.0</fixVersion>
                                    <component>clients</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15418276" author="williamyu" created="Fri, 12 Aug 2016 02:41:38 +0000"  >&lt;p&gt;You&apos;re referring to the Kafka consumer when you say &apos;kafka client&apos; correct? I believe this is the bug ticket I was looking for to confirm the behavior that I&apos;m seeing from my consumer application. It looks to be leaking native memory while consuming from a topic as my java -Xmx setting is set for 10gb, but the resident memory is showing 23gb usage.&lt;/p&gt;</comment>
                            <comment id="15418678" author="ijuma" created="Fri, 12 Aug 2016 11:02:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=williamyu&quot; class=&quot;user-hover&quot; rel=&quot;williamyu&quot;&gt;williamyu&lt;/a&gt;, is your topic compressed?&lt;/p&gt;</comment>
                            <comment id="15418766" author="williamyu" created="Fri, 12 Aug 2016 12:42:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt;, yes the topic is compressed, our producer is setup with the following property: &quot;compression.type=gzip&quot;&lt;/p&gt;</comment>
                            <comment id="15418824" author="ijuma" created="Fri, 12 Aug 2016 13:25:52 +0000"  >&lt;p&gt;Seems like this one then. It&apos;s the first time we&apos;re hearing about someone experiencing it, so it would be good to fix the issue and then have you test it. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tcrayford-heroku&quot; class=&quot;user-hover&quot; rel=&quot;tcrayford-heroku&quot;&gt;tcrayford-heroku&lt;/a&gt;, do you think you&apos;ll have time to look into this soon?&lt;/p&gt;</comment>
                            <comment id="15418836" author="williamyu" created="Fri, 12 Aug 2016 13:34:44 +0000"  >&lt;p&gt;FYI: My brokers and client are both on kafka: 0.9.0.1.&lt;/p&gt;</comment>
                            <comment id="15422805" author="githubbot" created="Tue, 16 Aug 2016 14:35:35 +0000"  >&lt;p&gt;GitHub user wiyu opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1743&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1743&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3937&quot; title=&quot;Kafka Clients Leak Native Memory For Longer Than Needed With Compressed Messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3937&quot;&gt;&lt;del&gt;KAFKA-3937&lt;/del&gt;&lt;/a&gt;: Kafka Clients Leak Native Memory For Longer Than Needed With Compressed Messages&lt;/p&gt;

&lt;p&gt;    @ijuma - Creating this PR against 0.9.0 as this is what we&apos;re using in prod. I can modify this for trunk if the logic solution looks good. &lt;/p&gt;

&lt;p&gt;    I modified the record iterator to inherit from closable and implemented the method to call streams.close(). The stream will now be closed when we are done traversing the inner iterator. I had to move the `try {} catch{}` out of the `if` portion to deal with IOException coming from `innerDone()`.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/wiyu/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wiyu/kafka&lt;/a&gt; compressor_memory_leak_in_fetcher&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1743.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1743.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1743&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b56ec1563e34d40c338224970c6b8cd3802e4dcd&lt;br/&gt;
Author: William Yu &amp;lt;wyu@unified.com&amp;gt;&lt;br/&gt;
Date:   2016-08-16T14:09:28Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3937&quot; title=&quot;Kafka Clients Leak Native Memory For Longer Than Needed With Compressed Messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3937&quot;&gt;&lt;del&gt;KAFKA-3937&lt;/del&gt;&lt;/a&gt;: Kafka Clients Leak Native Memory For Longer Than Needed With Compressed Messages&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15422828" author="williamyu" created="Tue, 16 Aug 2016 14:43:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; Took a stab at making the fix. I made it against the 0.9.0 branch as that is what my clients and brokers are running as. I tested it in my environment and i saw native memory was not going above the java -Xmx setting as the streams were being closed when the RecordIterator completed.&lt;/p&gt;</comment>
                            <comment id="15425523" author="githubbot" created="Wed, 17 Aug 2016 22:36:25 +0000"  >&lt;p&gt;Github user wiyu closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1743&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1743&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15426851" author="githubbot" created="Thu, 18 Aug 2016 17:29:26 +0000"  >&lt;p&gt;GitHub user wiyu opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1760&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1760&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3937&quot; title=&quot;Kafka Clients Leak Native Memory For Longer Than Needed With Compressed Messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3937&quot;&gt;&lt;del&gt;KAFKA-3937&lt;/del&gt;&lt;/a&gt;: Kafka Clients Leak Native Memory For Longer Than Needed With Compressed Messages&lt;/p&gt;

&lt;p&gt;    @ijuma - Making the change against trunk based on your suggestions to have the stream closing handled in the private RecordIterator constructor which I understand is only to be used only if the block of message(s) are compressed. &lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/wiyu/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wiyu/kafka&lt;/a&gt; compressor_memory_leak_in_fetcher&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1760.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1760.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1760&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 56451a38399875ae9d1ccdb2f873de88eae6f940&lt;br/&gt;
Author: William Yu &amp;lt;wyu@unified.com&amp;gt;&lt;br/&gt;
Date:   2016-08-18T17:25:10Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3937&quot; title=&quot;Kafka Clients Leak Native Memory For Longer Than Needed With Compressed Messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3937&quot;&gt;&lt;del&gt;KAFKA-3937&lt;/del&gt;&lt;/a&gt;: Kafka Clients Leak Native Memory For Longer Than Needed With Compressed Messages&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15431505" author="williamyu" created="Mon, 22 Aug 2016 19:59:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; I&apos;ve created a new PR based on your comments. Let me know what you think. thanks&lt;/p&gt;</comment>
                            <comment id="15433791" author="githubbot" created="Tue, 23 Aug 2016 22:48:06 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1760&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1760&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15469051" author="williamyu" created="Wed, 7 Sep 2016 00:18:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; So, we don&apos;t plan on upgrading to kafka 0.10.x anytime in the near future as we still have to get all our services onto the kafka 0.9.x client from 0.8.2. Is Kafka 0.9.x still being patched and released? If it is can, then I can submit a patch for 9. Thanks. &lt;/p&gt;</comment>
                            <comment id="15469078" author="ijuma" created="Wed, 7 Sep 2016 00:30:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=williamyu&quot; class=&quot;user-hover&quot; rel=&quot;williamyu&quot;&gt;williamyu&lt;/a&gt;, we occasionally commit to the `0.9.0` branch, but there is no set plan for a 0.9.0.2 release. It doesn&apos;t mean it won&apos;t happen, but resources at the moment are mostly focused on 0.10.1.0.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13063597">FLINK-6301</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30pf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>ijuma</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>