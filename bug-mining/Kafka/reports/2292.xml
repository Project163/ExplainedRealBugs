<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:18:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4893] async topic deletion conflicts with max topic length</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4893</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;As per the &lt;a href=&quot;http://kafka.apache.org/documentation/#basic_ops_add_topic&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;documentation&lt;/a&gt;, topics can be only 249 characters long to line up with typical filesystem limitations:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Each sharded partition log is placed into its own folder under the Kafka log directory. The name of such folders consists of the topic name, appended by a dash (&amp;#45;) and the partition id. Since a typical folder name can not be over 255 characters long, there will be a limitation on the length of topic names. We assume the number of partitions will not ever be above 100,000. Therefore, topic names cannot be longer than 249 characters. This leaves just enough room in the folder name for a dash and a potentially 5 digit long partition id.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;tt&gt;kafka.common.Topic.maxNameLength&lt;/tt&gt; is set to 249 and is used during validation.&lt;/p&gt;

&lt;p&gt;This limit ends up not being quite right since topic deletion ends up renaming the directory to the form &lt;tt&gt;topic-partition.uniqueId-delete&lt;/tt&gt; as can be seen in &lt;tt&gt;LogManager.asyncDelete&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;val dirName = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringBuilder(removedLog.name)
                  .append(&lt;span class=&quot;code-quote&quot;&gt;&quot;.&quot;&lt;/span&gt;)
                  .append(java.util.UUID.randomUUID.toString.replaceAll(&lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt;,&quot;&quot;))
                  .append(Log.DeleteDirSuffix)
                  .toString()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So the unique id and &quot;-delete&quot; suffix end up hogging some of the characters. Deleting a long-named topic results in a log message such as the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;kafka.common.KafkaStorageException: Failed to rename log directory from /tmp/kafka-logs0/000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000-0 to /tmp/kafka-logs0/000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000-0.797bba3fb2464729840f87769243edbb-delete
  at kafka.log.LogManager.asyncDelete(LogManager.scala:439)
  at kafka.cluster.Partition$$anonfun$delete$1.apply$mcV$sp(Partition.scala:142)
  at kafka.cluster.Partition$$anonfun$delete$1.apply(Partition.scala:137)
  at kafka.cluster.Partition$$anonfun$delete$1.apply(Partition.scala:137)
  at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:213)
  at kafka.utils.CoreUtils$.inWriteLock(CoreUtils.scala:221)
  at kafka.cluster.Partition.delete(Partition.scala:137)
  at kafka.server.ReplicaManager.stopReplica(ReplicaManager.scala:230)
  at kafka.server.ReplicaManager$$anonfun$stopReplicas$2.apply(ReplicaManager.scala:260)
  at kafka.server.ReplicaManager$$anonfun$stopReplicas$2.apply(ReplicaManager.scala:259)
  at scala.collection.Iterator$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(Iterator.scala:727)
  at scala.collection.AbstractIterator.foreach(Iterator.scala:1157)
  at scala.collection.IterableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(IterableLike.scala:72)
  at scala.collection.AbstractIterable.foreach(Iterable.scala:54)
  at kafka.server.ReplicaManager.stopReplicas(ReplicaManager.scala:259)
  at kafka.server.KafkaApis.handleStopReplicaRequest(KafkaApis.scala:174)
  at kafka.server.KafkaApis.handle(KafkaApis.scala:86)
  at kafka.server.KafkaRequestHandler.run(KafkaRequestHandler.scala:64)
  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The topic after this point still exists but has Leader set to -1 and the controller recognizes the topic completion as incomplete (the topic znode is still in /admin/delete_topics).&lt;/p&gt;

&lt;p&gt;I don&apos;t believe linkedin has any topic name this long but I&apos;m making the ticket in case anyone runs into this problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13055824">KAFKA-4893</key>
            <summary>async topic deletion conflicts with max topic length</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cmccabe">Colin McCabe</assignee>
                                    <reporter username="onurkaraman">Onur Karaman</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Mar 2017 05:36:11 +0000</created>
                <updated>Wed, 20 Nov 2024 03:40:26 +0000</updated>
                            <resolved>Tue, 4 Jun 2019 22:07:50 +0000</resolved>
                                                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.2</fixVersion>
                    <fixVersion>2.3.0</fixVersion>
                                    <component>log</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>14</watches>
                                                                                                                <comments>
                            <comment id="15923636" author="onurkaraman" created="Tue, 14 Mar 2017 06:05:43 +0000"  >&lt;p&gt;Maybe the right move is to just add more layers to the log directory like so:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;kafkaLogDir/delete/topic-partition/uniqueId/
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and put all the data under that directory.&lt;/p&gt;

&lt;p&gt;I think typical filesystems have a directory limit of 4096 characters so we should be good to go. The one annoyance is that the old structure is already out in the wild, so you may need to recognize and handle both delete directory structures for some time.&lt;/p&gt;</comment>
                            <comment id="15927033" author="vahid" created="Wed, 15 Mar 2017 21:37:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=onurkaraman&quot; class=&quot;user-hover&quot; rel=&quot;onurkaraman&quot;&gt;onurkaraman&lt;/a&gt; What you suggested should work. Of course, an easier solution would be to decrease the max topic length (again) to 249 - 1 - 32 - 7 = 209.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    .append(&lt;span class=&quot;code-quote&quot;&gt;&quot;.&quot;&lt;/span&gt;) &lt;span class=&quot;code-comment&quot;&gt;// len = 1
&lt;/span&gt;    .append(java.util.UUID.randomUUID.toString.replaceAll(&lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt;,&quot;&quot;)) &lt;span class=&quot;code-comment&quot;&gt;// len = 32
&lt;/span&gt;    .append(Log.DeleteDirSuffix) &lt;span class=&quot;code-comment&quot;&gt;// len = 7&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15927038" author="ijuma" created="Wed, 15 Mar 2017 21:40:43 +0000"  >&lt;p&gt;Adding directories introduces more complexity due to fsync semantics. See &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3968&quot; title=&quot;fsync() is not called on parent directory when new FileMessageSet is flushed to disk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3968&quot;&gt;&lt;del&gt;KAFKA-3968&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15927155" author="onurkaraman" created="Wed, 15 Mar 2017 23:21:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; I had thought about the additional fsync on the directory as well after posting the earlier comment.&lt;/p&gt;

&lt;p&gt;Would the following structure help?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;kafkaLogDir
| -- cleaner-offset-checkpoint
| -- delete
|    | -- 8fc621a18fe746d1b8eb4a7fa55a04bc
|         | -- 00000000000000000000.index
|         | -- 00000000000000000000.log
|         | -- 00000000000000000000.timeindex
|         | -- t-0
| -- meta.properties
| -- recovery-point-offset-checkpoint
| -- replication-offset-checkpoint
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We&apos;d put all the partitions staged for async deletion under kafkaLogDir/delete. Each directory corresponding to a partition staged for async deletion would have a new empty file with filename topic-partition so you can figure out later on what partition the data belonged to.&lt;/p&gt;

&lt;p&gt;The kafkaLogDir/delete directory would just be a trash bin directory that always exists, and we&apos;d just delete all of the data inside the trash bin.&lt;/p&gt;</comment>
                            <comment id="15927298" author="onurkaraman" created="Thu, 16 Mar 2017 01:39:40 +0000"  >&lt;p&gt;Also &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vahid&quot; class=&quot;user-hover&quot; rel=&quot;vahid&quot;&gt;vahid&lt;/a&gt; while I agree reducing the limit is by far the easiest, it definitely feels like we&apos;re moving the goalpost. We should instead try to maintain our guarantees as long as it&apos;s not exceedingly difficult. In this scenario, it doesn&apos;t feel exceedingly difficult.&lt;/p&gt;</comment>
                            <comment id="15927303" author="vahid" created="Thu, 16 Mar 2017 01:47:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=onurkaraman&quot; class=&quot;user-hover&quot; rel=&quot;onurkaraman&quot;&gt;onurkaraman&lt;/a&gt; Sure, I agree that your suggestion is the long term fix for the issue. I just wanted to mention and document the alternative here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15976170" author="soumabrata" created="Thu, 20 Apr 2017 06:31:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vahid&quot; class=&quot;user-hover&quot; rel=&quot;vahid&quot;&gt;vahid&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=onurkaraman&quot; class=&quot;user-hover&quot; rel=&quot;onurkaraman&quot;&gt;onurkaraman&lt;/a&gt; I am currently assigned to the related JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4912&quot; title=&quot;Add check for topic name length&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4912&quot;&gt;&lt;del&gt;KAFKA-4912&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
Have you finalized the solution and started work on it?  &lt;/p&gt;</comment>
                            <comment id="15977130" author="vahid" created="Thu, 20 Apr 2017 17:43:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=soumabrata&quot; class=&quot;user-hover&quot; rel=&quot;soumabrata&quot;&gt;soumabrata&lt;/a&gt; Thanks for checking. The solution has not been finalized yet. Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; can weigh in on the &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=onurkaraman&quot; class=&quot;user-hover&quot; rel=&quot;onurkaraman&quot;&gt;onurkaraman&lt;/a&gt;&apos;s response regarding fsync.&lt;/p&gt;</comment>
                            <comment id="16133321" author="onurkaraman" created="Fri, 18 Aug 2017 17:29:38 +0000"  >&lt;p&gt;By the way, it seems that the 1.0.0 release is the perfect opportunity to make the change I proposed above.&lt;/p&gt;</comment>
                            <comment id="16133561" author="vahid" created="Fri, 18 Aug 2017 20:07:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=onurkaraman&quot; class=&quot;user-hover&quot; rel=&quot;onurkaraman&quot;&gt;onurkaraman&lt;/a&gt; Agreed. I&apos;d be happy to work on your suggested solution. I am wondering if a KIP is required. Also, it would be great if we can have some feedback from one of the committers. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16133567" author="ijuma" created="Fri, 18 Aug 2017 20:11:06 +0000"  >&lt;p&gt;We&apos;d probably want &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt;&apos;s opinion on reorganising the log directory structure.&lt;/p&gt;</comment>
                            <comment id="16260094" author="githubbot" created="Tue, 21 Nov 2017 00:39:46 +0000"  >&lt;p&gt;GitHub user vahidhashemian opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4241&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4893&quot; title=&quot;async topic deletion conflicts with max topic length&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4893&quot;&gt;&lt;del&gt;KAFKA-4893&lt;/del&gt;&lt;/a&gt;: Fix conflict between async topic deletion and max topic length&lt;/p&gt;

&lt;p&gt;    With async topic deletion the topic partition folder name is affixed with a &apos;.&apos;, a UUID, and &apos;-delete&apos;. If topic name length is close to its current limit (249) this could cause an issue because the folder name size goes over 255.&lt;br/&gt;
    This PR implements the &lt;span class=&quot;error&quot;&gt;&amp;#91;suggestion solution&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4893?focusedCommentId=15927155&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-4893?focusedCommentId=15927155&lt;/a&gt;) by @onurkaraman in the JIRA.&lt;br/&gt;
    This implementation is automatically backward compatible, and cleans up any folder marked for deletion using the old method (affixing the folder name).&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/vahidhashemian/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/vahidhashemian/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4893&quot; title=&quot;async topic deletion conflicts with max topic length&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4893&quot;&gt;&lt;del&gt;KAFKA-4893&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4241.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4241.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4241&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b6f7f2cad7f8484aa35f22988ab7e4685607966f&lt;br/&gt;
Author: Vahid Hashemian &amp;lt;vahidhashemian@us.ibm.com&amp;gt;&lt;br/&gt;
Date:   2017-11-21T00:28:44Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4893&quot; title=&quot;async topic deletion conflicts with max topic length&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4893&quot;&gt;&lt;del&gt;KAFKA-4893&lt;/del&gt;&lt;/a&gt;: Fix conflict between async topic deletion and max topic lenth&lt;/p&gt;

&lt;p&gt;    With async topic deletion the topic partition folder name is affixed with a &apos;.&apos;, a UUID, and &apos;-delete&apos;. If topic name length is close to its current limit (249) this could cause an issue because the folder name size goes over 255.&lt;br/&gt;
    This PR implements the &lt;span class=&quot;error&quot;&gt;&amp;#91;suggestion solution&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4893?focusedCommentId=15927155&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-4893?focusedCommentId=15927155&lt;/a&gt;) by @onurkaraman in the JIRA.&lt;br/&gt;
    This implementation is automatically backward compatible, and cleans up any folder marked for deletion using the old method (affixing the folder name).&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16405553" author="wushujames" created="Mon, 19 Mar 2018 22:33:23 +0000"  >&lt;p&gt;We just ran into this. Our mirroring setup automatically prepends &apos;mirror.` to any topic that it mirrors. We accidentally created a mirroring loop. So we created&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;foo
mirror.foo
mirror.mirror.foo
mirror.mirror.mirror.foo
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And eventually hit max topic length. And then when we tried to delete the longest one, we ran into this. We eventually had to manually delete it&#160;by:&lt;br/&gt;
 1) Taking down the brokers&lt;br/&gt;
 2) Deleting the topic from zookeeper&lt;br/&gt;
 3) Deleting the log dirs from disk&lt;/p&gt;</comment>
                            <comment id="16405558" author="wushujames" created="Mon, 19 Mar 2018 22:45:52 +0000"  >&lt;p&gt;We ran into another error which may be related to this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2018-03-17 03:11:39,655] ERROR There was an error in one of the threads during logs loading: java.lang.IllegalArgumentException: Duplicate log directories found: /redacted/kafka/disk-xvdg/log/mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.foofoofoofoofoofoofoofoofoofoofo-3, /redacted/kafka/disk-xvdh/log/mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.foofoofoofoofoofoofoofoofoofoofo-3! (kafka.log.LogManager)
[2018-03-17 03:11:39,664] FATAL [Kafka Server 1], Fatal error during KafkaServer startup. Prepare to shutdown (kafka.server.KafkaServer)
java.lang.IllegalArgumentException: Duplicate log directories found: /redacted/kafka/disk-xvdg/log/mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.foofoofoofoofoofoofoofoofoofoofo-3, /redacted/kafka/disk-xvdh/log/mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.mirror.foofoofoofoofoofoofoofoofoofoofo-3!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We ran into this error upon broker startup, 2 weeks after we recovered from the above scenario. Our theory (unconfirmed) is that:&lt;br/&gt;
1) The situation in this JIRA happened, leaving the topic in a partially deleted state.&lt;br/&gt;
2) The topic was recreated, and (somehow) made it past the partition-deleted state. The directory for the partition was created on a different log.dir.&lt;br/&gt;
3) Time passes.&lt;br/&gt;
4) Upon startup, kafka validates all log.dirs, and found the same partition exists in different log.dirs&lt;/p&gt;

&lt;p&gt;We didn&apos;t have time to verify this theory, but we thought we would leave it here in case someone else runs into it and has time to look into it.&lt;/p&gt;</comment>
                            <comment id="16508023" author="rsivaram" created="Mon, 11 Jun 2018 13:15:14 +0000"  >&lt;p&gt;Since there has been no activity on this for several weeks, moving this out to 2.1.0.&lt;/p&gt;</comment>
                            <comment id="16636524" author="lindong" created="Wed, 3 Oct 2018 06:52:09 +0000"  >&lt;p&gt;Since there has been no activity on this for several weeks, moving this out to 2.2.0&lt;/p&gt;</comment>
                            <comment id="16770580" author="mjsax" created="Sun, 17 Feb 2019 19:13:54 +0000"  >&lt;p&gt;Moving all major/minor/trivial tickets that are not merged yet out of 2.2 release.&lt;/p&gt;</comment>
                            <comment id="16854816" author="githubbot" created="Mon, 3 Jun 2019 16:51:44 +0000"  >&lt;p&gt;cmccabe commented on pull request #6869: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4893&quot; title=&quot;async topic deletion conflicts with max topic length&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4893&quot;&gt;&lt;del&gt;KAFKA-4893&lt;/del&gt;&lt;/a&gt;: limit MAX_NAME_LENGTH to 209 to fix async topic deletion&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6869&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6869&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16856127" author="githubbot" created="Tue, 4 Jun 2019 21:17:06 +0000"  >&lt;p&gt;gwenshap commented on pull request #6869: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4893&quot; title=&quot;async topic deletion conflicts with max topic length&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4893&quot;&gt;&lt;del&gt;KAFKA-4893&lt;/del&gt;&lt;/a&gt;: Fix deletion and moving of topics with long names&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6869&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6869&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13056724">KAFKA-4912</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13171709">KAFKA-7156</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3c82f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>