<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:27:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-12702] Unhandled exception caught in InterBrokerSendThread</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-12702</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In kraft mode, if listeners and advertised.listeners are not configured with host addresses, the host parameter value of Listener in BrokerRegistrationRequestData will be null. When the broker is started, a null pointer exception will be thrown, causing startup failure.&lt;/p&gt;

&lt;p&gt;A feasible solution is to replace the empty host of endPoint in advertisedListeners with InetAddress.getLocalHost.getCanonicalHostName in Broker Server when building networkListeners.&lt;/p&gt;

&lt;p&gt;The following is the debug log:&lt;/p&gt;

&lt;p&gt;before fixing:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2021-04-21 14:15:20,032&amp;#93;&lt;/span&gt; DEBUG (broker-2-to-controller-send-thread org.apache.kafka.clients.NetworkClient 522) &lt;span class=&quot;error&quot;&gt;&amp;#91;broker-2-to-controller&amp;#93;&lt;/span&gt; Sending BROKER_REGISTRATION request with header RequestHeader(apiKey=BROKER_REGIS&lt;br/&gt;
TRATION, apiVersion=0, clientId=2, correlationId=6) and timeout 30000 to node 2: BrokerRegistrationRequestData(brokerId=2, clusterId=&apos;nCqve6D1TEef3NpQniA0Mg&apos;, incarnationId=X8w4_1DFT2yUjOm6asPjIQ, listeners=[Listener(n&lt;br/&gt;
ame=&apos;PLAINTEXT&apos;, &lt;font color=&quot;#FF0000&quot;&gt;host=null,&lt;/font&gt; port=9092, securityProtocol=0)], features=[], rack=null)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2021-04-21 14:15:20,033&amp;#93;&lt;/span&gt; ERROR (broker-2-to-controller-send-thread kafka.server.BrokerToControllerRequestThread 76) &lt;span class=&quot;error&quot;&gt;&amp;#91;broker-2-to-controller-send-thread&amp;#93;&lt;/span&gt;: unhandled exception caught in InterBrokerSendThread&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
 at org.apache.kafka.common.message.BrokerRegistrationRequestData$Listener.addSize(BrokerRegistrationRequestData.java:515)&lt;br/&gt;
 at org.apache.kafka.common.message.BrokerRegistrationRequestData.addSize(BrokerRegistrationRequestData.java:216)&lt;br/&gt;
 at org.apache.kafka.common.protocol.SendBuilder.buildSend(SendBuilder.java:218)&lt;br/&gt;
 at org.apache.kafka.common.protocol.SendBuilder.buildRequestSend(SendBuilder.java:187)&lt;br/&gt;
 at org.apache.kafka.common.requests.AbstractRequest.toSend(AbstractRequest.java:101)&lt;br/&gt;
 at org.apache.kafka.clients.NetworkClient.doSend(NetworkClient.java:525)&lt;br/&gt;
 at org.apache.kafka.clients.NetworkClient.doSend(NetworkClient.java:501)&lt;br/&gt;
 at org.apache.kafka.clients.NetworkClient.send(NetworkClient.java:461)&lt;br/&gt;
 at kafka.common.InterBrokerSendThread.$anonfun$sendRequests$1(InterBrokerSendThread.scala:104)&lt;br/&gt;
 at kafka.common.InterBrokerSendThread.$anonfun$sendRequests$1$adapted(InterBrokerSendThread.scala:99)&lt;br/&gt;
 at kafka.common.InterBrokerSendThread$$Lambda$259/910445654.apply(Unknown Source)&lt;br/&gt;
 at scala.collection.IterableOnceOps.foreach(IterableOnce.scala:563)&lt;br/&gt;
 at scala.collection.IterableOnceOps.foreach$(IterableOnce.scala:561)&lt;br/&gt;
 at scala.collection.AbstractIterable.foreach(Iterable.scala:919)&lt;br/&gt;
 at kafka.common.InterBrokerSendThread.sendRequests(InterBrokerSendThread.scala:99)&lt;br/&gt;
 at kafka.common.InterBrokerSendThread.pollOnce(InterBrokerSendThread.scala:73)&lt;br/&gt;
 at kafka.server.BrokerToControllerRequestThread.doWork(BrokerToControllerChannelManager.scala:368)&lt;br/&gt;
 at kafka.utils.ShutdownableThread.run(ShutdownableThread.scala:96)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2021-04-21 14:15:20,034&amp;#93;&lt;/span&gt; INFO (broker-2-to-controller-send-thread kafka.server.BrokerToControllerRequestThread 66) &lt;span class=&quot;error&quot;&gt;&amp;#91;broker-2-to-controller-send-thread&amp;#93;&lt;/span&gt;: Stopped&lt;/p&gt;



&lt;p&gt;after fixing:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2021-04-21 15:05:01,095&amp;#93;&lt;/span&gt; DEBUG (BrokerToControllerChannelManager broker=2 name=heartbeat org.apache.kafka.clients.NetworkClient 512) &lt;span class=&quot;error&quot;&gt;&amp;#91;BrokerToControllerChannelManager broker=2 name=heartbeat&amp;#93;&lt;/span&gt; Sending BROKER_REGISTRATI&lt;br/&gt;
ON request with header RequestHeader(apiKey=BROKER_REGISTRATION, apiVersion=0, clientId=2, correlationId=0) and timeout 30000 to node 2: BrokerRegistrationRequestData(brokerId=2, clusterId=&apos;nCqve6D1TEef3NpQniA0Mg&apos;, inc&lt;br/&gt;
arnationId=xF29h_IRR1KzrERWwssQ2w, listeners=&lt;span class=&quot;error&quot;&gt;&amp;#91;Listener(name=&amp;#39;PLAINTEXT&amp;#39;, host=&amp;#39;hdpxxx.cn&amp;#39;, port=9092, securityProtocol=0)&amp;#93;&lt;/span&gt;, features=[], rack=null)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13374054">KAFKA-12702</key>
            <summary>Unhandled exception caught in InterBrokerSendThread</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="wenbing.shen">Wenbing Shen</assignee>
                                    <reporter username="wenbing.shen">Wenbing Shen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Apr 2021 08:05:17 +0000</created>
                <updated>Mon, 26 Apr 2021 06:59:12 +0000</updated>
                            <resolved>Sun, 25 Apr 2021 13:29:35 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>2.8.1</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17326387" author="wenbing.shen" created="Wed, 21 Apr 2021 09:12:34 +0000"  >&lt;p&gt;We need to fix this problem, because according to the comments in the configuration file (config/kraft/server.properties), if listeners and advertised.listeners are not configured with an address, the program will automatically obtain java.net.InetAddress.getCanonicalHostName(), but this will actually cause the service to fail to start. &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13024370/13024370_image-2021-04-21-17-12-28-471.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13024366" name="afterFixing.png" size="145653" author="wenbing.shen" created="Wed, 21 Apr 2021 08:03:27 +0000"/>
                            <attachment id="13024367" name="beforeFixing.png" size="331463" author="wenbing.shen" created="Wed, 21 Apr 2021 08:03:24 +0000"/>
                            <attachment id="13024370" name="image-2021-04-21-17-12-28-471.png" size="85762" author="wenbing.shen" created="Wed, 21 Apr 2021 09:12:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 29 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0qa48:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>