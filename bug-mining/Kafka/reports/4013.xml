<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:41:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-18060] new coordinator does not handle TxnOffsetCommitRequest with empty member id when using CONSUMER group</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-18060</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When reviewing &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-17961&quot; title=&quot;TransactionsBounceTest.testWithGroupId fails with CONSUMER group protocol&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-17961&quot;&gt;&lt;del&gt;KAFKA-17961&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-17964&quot; title=&quot;TransactionsTest.testSendOffsetsWithGroupId fails with CONSUMER group protocol&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-17964&quot;&gt;&lt;del&gt;KAFKA-17964&lt;/del&gt;&lt;/a&gt;, we notice two issues:&lt;/p&gt;

&lt;p&gt;1) new coordinator can&apos;t handle the TxnOffsetCommitRequest with empty member id, and TxnOffsetCommitRequest v0-v2 do definitely has an empty member ID&lt;br/&gt;
2) the deprecated sendOffsetsToTransaction does not use v0-v2 to send TxnOffsetCommitRequest with an empty member ID (&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/requests/TxnOffsetCommitRequest.java#L55&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/requests/TxnOffsetCommitRequest.java#L55&lt;/a&gt;). Unfortunately, it has been released for a while. Therefore, the new coordinator needs to handle TxnOffsetCommitRequest with an empty member ID for all versions.&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;TxnOffsetCommitRequest versions v0-v2 do not include a member ID, causing ConsumerGroup#validateOffsetCommit &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; to throw an UnknownMemberIdException. This prevents the old producer from calling sendOffsetsToTransaction.&lt;/p&gt;

&lt;p&gt;Note that TxnOffsetCommitRequest versions v0-v2 are included in KIP-896 &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, so it seems the new coordinator should support that operations&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/group-coordinator/src/main/java/org/apache/kafka/coordinator/group/modern/consumer/ConsumerGroup.java#L517&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/group-coordinator/src/main/java/org/apache/kafka/coordinator/group/modern/consumer/ConsumerGroup.java#L517&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-896%3A+Remove+old+client+protocol+API+versions+in+Kafka+4.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/KAFKA/KIP-896%3A+Remove+old+client+protocol+API+versions+in+Kafka+4.0&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13599527">KAFKA-18060</key>
            <summary>new coordinator does not handle TxnOffsetCommitRequest with empty member id when using CONSUMER group</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandboat">Kuan Po Tseng</assignee>
                                    <reporter username="chia7712">Chia-Ping Tsai</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Nov 2024 11:42:53 +0000</created>
                <updated>Thu, 12 Dec 2024 17:52:02 +0000</updated>
                            <resolved>Tue, 3 Dec 2024 18:55:23 +0000</resolved>
                                                    <fixVersion>4.0.0</fixVersion>
                                    <component>group-coordinator</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17900011" author="chia7712" created="Thu, 21 Nov 2024 11:43:21 +0000"  >&lt;p&gt;Maybe we can add following check to fix it.&lt;/p&gt;

&lt;p&gt;        // Supports the v0-v2 TxnOffsetCommitRequest&lt;br/&gt;
        if (apiVersion &amp;lt;3 &amp;amp;&amp;amp; isTransactional &amp;amp;&amp;amp; memberEpoch == JoinGroupRequest.UNKNOWN_GENERATION_ID &amp;amp;&amp;amp;&lt;br/&gt;
                memberId.equals(JoinGroupRequest.UNKNOWN_MEMBER_ID) &amp;amp;&amp;amp; groupInstanceId == null)&lt;br/&gt;
            return;&lt;/p&gt;</comment>
                            <comment id="17900013" author="chia7712" created="Thu, 21 Nov 2024 11:46:38 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dajac&quot; class=&quot;user-hover&quot; rel=&quot;dajac&quot;&gt;dajac&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17900014" author="dajac" created="Thu, 21 Nov 2024 12:01:19 +0000"  >&lt;p&gt;Good catch! I wonder how we did not see this before. The tests should fail consistently. Would you have details?&lt;/p&gt;

&lt;p&gt;It seems that we could handle this in OffsetMetadataManager.validateTransactionalOffsetCommit. What do you think?&lt;/p&gt;

&lt;p&gt;When you have a PR, ping me and I will review it.&lt;/p&gt;</comment>
                            <comment id="17900015" author="brandboat" created="Thu, 21 Nov 2024 12:04:57 +0000"  >&lt;p&gt;This was observed when we reviewing the issue &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-17964&quot; title=&quot;TransactionsTest.testSendOffsetsWithGroupId fails with CONSUMER group protocol&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-17964&quot;&gt;&lt;del&gt;KAFKA-17964&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-17961&quot; title=&quot;TransactionsBounceTest.testWithGroupId fails with CONSUMER group protocol&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-17961&quot;&gt;&lt;del&gt;KAFKA-17961&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
We noticed that after switching those 2 test case into CONSUMER group protocol, in ConsumerGroup#validateOffsetCommit&lt;/p&gt;

&lt;p&gt;the members is not empty and there already has one member, while the member id is empty.&lt;/p&gt;</comment>
                            <comment id="17900020" author="dajac" created="Thu, 21 Nov 2024 12:12:31 +0000"  >&lt;p&gt;Don&apos;t those integration tests use the last version of the TxnOffsetCommitRequest API? I assume so if they use the CONSUMER protocol.&lt;/p&gt;</comment>
                            <comment id="17900023" author="dajac" created="Thu, 21 Nov 2024 12:15:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chia7712&quot; class=&quot;user-hover&quot; rel=&quot;chia7712&quot;&gt;chia7712&lt;/a&gt; It would be great if we could also add an integration test similar to OffsetCommitRequestTest. I am actually surprised that we don&apos;t have it. I was sure that we had it.&lt;/p&gt;</comment>
                            <comment id="17900047" author="brandboat" created="Thu, 21 Nov 2024 13:55:57 +0000"  >&lt;p&gt;gentle ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chia7712&quot; class=&quot;user-hover&quot; rel=&quot;chia7712&quot;&gt;chia7712&lt;/a&gt; , I&apos;m willing to take over this if you are not working on this issue &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17900312" author="dajac" created="Fri, 22 Nov 2024 10:09:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandboat&quot; class=&quot;user-hover&quot; rel=&quot;brandboat&quot;&gt;brandboat&lt;/a&gt; Do you have an idea about when you will open a PR to address this one?&lt;/p&gt;</comment>
                            <comment id="17900314" author="chia7712" created="Fri, 22 Nov 2024 10:15:55 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Do you have an idea about when you will open a PR to address this one?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dajac&quot; class=&quot;user-hover&quot; rel=&quot;dajac&quot;&gt;dajac&lt;/a&gt; We will file a patch after our internal meeting (4 hours later)&lt;/p&gt;</comment>
                            <comment id="17900316" author="brandboat" created="Fri, 22 Nov 2024 10:17:21 +0000"  >&lt;p&gt;Sorry for the late, I&apos;m current working on it, and will file a PR soon.&lt;/p&gt;</comment>
                            <comment id="17900317" author="dajac" created="Fri, 22 Nov 2024 10:17:28 +0000"  >&lt;p&gt;Moreover, I think this bug applies to both the consumer and the classic protocols because that request is actually send out by the Producer so the protocol does not matter here. I am not sure why the title precise the new consumer only.&lt;/p&gt;</comment>
                            <comment id="17900318" author="dajac" created="Fri, 22 Nov 2024 10:18:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chia7712&quot; class=&quot;user-hover&quot; rel=&quot;chia7712&quot;&gt;chia7712&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brandboat&quot; class=&quot;user-hover&quot; rel=&quot;brandboat&quot;&gt;brandboat&lt;/a&gt; Thanks!&lt;/p&gt;</comment>
                            <comment id="17900329" author="chia7712" created="Fri, 22 Nov 2024 10:42:43 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I am not sure why the title precise the new consumer only.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;only the consumer group tries to get the member by empty member id. see &lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/group-coordinator/src/main/java/org/apache/kafka/coordinator/group/modern/consumer/ConsumerGroup.java#L517&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/group-coordinator/src/main/java/org/apache/kafka/coordinator/group/modern/consumer/ConsumerGroup.java#L517&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17900333" author="dajac" created="Fri, 22 Nov 2024 10:53:52 +0000"  >&lt;p&gt;ah, got it! thanks for the clarification.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13598142">KAFKA-17961</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13598164">KAFKA-17964</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            50 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1soq0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>