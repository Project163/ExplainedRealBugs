<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:42:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-18713] Kafka Streams Left-Join not always emitting the last value</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-18713</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;There seems to be an issue when performing a left-join, the latest value with of the join does not contain the value of right side.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; builder = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StreamsBuilder();

KTable&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Department&amp;gt; departments = builder
    .table(&lt;span class=&quot;code-quote&quot;&gt;&quot;departments&quot;&lt;/span&gt;,
        Materialized.&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Department&amp;gt;as(Stores.persistentKeyValueStore(&lt;span class=&quot;code-quote&quot;&gt;&quot;departments&quot;&lt;/span&gt;))
            .withKeySerde(Serdes.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;())
            .withValueSerde(CustomJsonSerde.json(Department.class)));

KTable&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Person&amp;gt; persons = builder
    .table(&lt;span class=&quot;code-quote&quot;&gt;&quot;persons&quot;&lt;/span&gt;,
        Materialized.&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Person&amp;gt;as(Stores.persistentKeyValueStore(&lt;span class=&quot;code-quote&quot;&gt;&quot;persons&quot;&lt;/span&gt;))
            .withKeySerde(Serdes.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;())
            .withValueSerde(CustomJsonSerde.json(Person.class)));

KTable&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Person&amp;gt; joined = persons
    .leftJoin(departments, Person::getDepartmentId, (person, department) -&amp;gt; person.toBuilder()
            .department(department)
            .build(),
        TableJoined.as(&lt;span class=&quot;code-quote&quot;&gt;&quot;my-joiner&quot;&lt;/span&gt;),
        Materialized.&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, Person&amp;gt;as(Stores.persistentKeyValueStore(&lt;span class=&quot;code-quote&quot;&gt;&quot;joined-results&quot;&lt;/span&gt;))
            .withKeySerde(Serdes.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;())
            .withValueSerde(CustomJsonSerde.json(Person.class)));

joined
    .toStream()
    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;joined-results&quot;&lt;/span&gt;, Produced.with(Serdes.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(), CustomJsonSerde.json(Person.class))); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;How to reproduce:&lt;/p&gt;

&lt;p&gt;Create two topics persons and departments, each with 10 partitions. Pre-populate the departments topic with 2 departments.&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
Observation: * When i initially produce a Person&#160;&lt;tt&gt;p-1&lt;/tt&gt;&#160;with a FK&#160;&lt;tt&gt;dep-1&lt;/tt&gt;, the join works .&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;output is an EnrichedResult with person&#160;&lt;tt&gt;p-1&lt;/tt&gt;&#160;and department&#160;&lt;tt&gt;dep-1&lt;/tt&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;When i change the FK to&#160;&lt;tt&gt;dep-2&lt;/tt&gt;, the join updates .
	&lt;ul&gt;
		&lt;li&gt;output is an EnrichedResult with person&#160;&lt;tt&gt;p-1 }}and department&#160;{{dep-2&lt;/tt&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;When i change the FK back to&#160;&lt;tt&gt;dep-1&lt;/tt&gt;, the join fails .
	&lt;ul&gt;
		&lt;li&gt;output is an EnrichedResult with person&#160;&lt;tt&gt;p-1&lt;/tt&gt;&#160;&lt;b&gt;but no department&lt;/b&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;However, if I reproduce the same event (&lt;tt&gt;p-1&lt;/tt&gt;&#160;with&#160;&lt;tt&gt;dep-1&lt;/tt&gt;), the join works again .
	&lt;ul&gt;
		&lt;li&gt;output is an EnrichedResult with person&#160;&lt;tt&gt;p-1&lt;/tt&gt;&#160;and department&#160;&lt;tt&gt;dep-1&lt;/tt&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Also, even when you are not setting back to a previous FK, there can still be an issue with the left join. Changing an FK means insert + delete operations, but sometimes the result of the delete is emitted after the result of the insert.&#160;&lt;/p&gt;

&lt;p&gt;How to reproduce:&lt;br/&gt;
Create a departments topic and pre-populate it with 5 departments (dep-1 to dep-5). Create a persons topic and create person&#160; p-1 with FK dep-1. Send an update to the persons topic by changing the FK to dep-2 and repeat this step until dep-5. Now you will see that the latest emitted value of the person does not contain a department.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13607101">KAFKA-18713</key>
            <summary>Kafka Streams Left-Join not always emitting the last value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nilmadhab">Nil Madhab</assignee>
                                    <reporter username="tuna911">tuna b</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Feb 2025 10:43:16 +0000</created>
                <updated>Sun, 15 Jun 2025 05:10:05 +0000</updated>
                            <resolved>Fri, 4 Apr 2025 00:23:49 +0000</resolved>
                                    <version>3.7.0</version>
                                    <fixVersion>3.9.1</fixVersion>
                    <fixVersion>4.0.1</fixVersion>
                    <fixVersion>4.1.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17925180" author="nilmadhab" created="Sat, 8 Feb 2025 08:29:59 +0000"  >&lt;p&gt;Can I pick this up or is it bit too challenging for a newbie wanting to contibute?&lt;/p&gt;</comment>
                            <comment id="17925342" author="nilmadhab" created="Sun, 9 Feb 2025 06:32:25 +0000"  >&lt;p&gt;If I don&apos;t create 10 partition, will the issue still occur? I tried to reproduce this issue, with just one partition, everything works fine.&lt;/p&gt;</comment>
                            <comment id="17925431" author="mjsax" created="Sun, 9 Feb 2025 21:54:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can I pick this up or is it bit too challenging for a newbie wanting to contibute?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You can always give it a try &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &#8211; It&apos;s hard to say how complicated a fix will be, but yes, it&apos;s should deep inside the FK-join implementation...&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;If I don&apos;t create 10 partition, will the issue still occur? I tried to reproduce this issue, with just one partition, everything works fine.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Given the bug report, that is expected. I don&apos;t think that it must be 10 partitions, but it must be more than one partition to reproduce the bug. Ideally, you would first write a new test case that reliably reproduces the issue (for example extending `KTableKTableForeignKeyJoinDistributedTest` &#8211; not sure if it&apos;s the best one to extend, but feel free to browse around in the code base).&lt;/p&gt;</comment>
                            <comment id="17925469" author="nilmadhab" created="Mon, 10 Feb 2025 04:10:25 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt; , with 3 partition, I was able to &lt;a href=&quot;https://github.com/nilmadhab/kafka-examples/tree/main/streamsleftjoin/src/main/java/com/java/streamsleftjoin/models&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;reproduce&lt;/a&gt; the bug.&#160;&lt;/p&gt;

&lt;p&gt;I wanted to first recreate the bug in a springboot app. Next steps&lt;/p&gt;

&lt;p&gt;1. I will try to reproduce the bug in a test&#160;&lt;br/&gt;
2. Make a fix&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13074595/13074595_Screenshot+2025-02-10+at+12.06.38.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17925690" author="mjsax" created="Mon, 10 Feb 2025 18:57:04 +0000"  >&lt;p&gt;Thanks. Sounds good. Let us know if you need any input from our side.&lt;/p&gt;</comment>
                            <comment id="17925758" author="JIRAUSER308574" created="Mon, 10 Feb 2025 22:09:27 +0000"  >&lt;p&gt;&quot;If I don&apos;t create 10 partition, will the issue still occur? I tried to reproduce this issue, with just one partition, everything works fine.&quot;&lt;/p&gt;

&lt;p&gt;The issue only happens with multiple partitions and you can reproduce it consistently. It doesn&apos;t have to be 10 partitions.&lt;/p&gt;

&lt;p&gt;Btw, i also saw that this issue is not only happening when setting the FK back to a previous value, but also when you assign new FK&apos;s. Its not happening immediately, but after changing the FK like 3 or 4 times. If you keep changing the FK, you will see in a random fashion that the join is failing sometimes.&lt;/p&gt;</comment>
                            <comment id="17925770" author="nilmadhab" created="Mon, 10 Feb 2025 23:25:17 +0000"  >&lt;p&gt;slack thread for &lt;a href=&quot;https://confluentcommunity.slack.com/archives/C48AHTCUQ/p1738335231832589&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;bug&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17926710" author="nilmadhab" created="Thu, 13 Feb 2025 08:26:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/18887&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/18887&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17927592" author="nilmadhab" created="Mon, 17 Feb 2025 03:20:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/18887/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/18887/files&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17934360" author="stevenschlansker" created="Tue, 11 Mar 2025 22:20:11 +0000"  >&lt;p&gt;We believe we&apos;ve isolated a production data loss bug (affects 3.9.0) to the issue described here.&lt;/p&gt;

&lt;p&gt;We tested &lt;a href=&quot;https://github.com/apache/kafka/pull/19005&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/19005&lt;/a&gt; and it seems to solve our data loss issue.&lt;/p&gt;

&lt;p&gt;+1 to seeing this in the next release&lt;/p&gt;</comment>
                            <comment id="17936391" author="foal" created="Tue, 18 Mar 2025 07:35:48 +0000"  >&lt;p&gt;We also waiting for new release with the fix. If it is possible fix it in 3.8 line too.&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="17936734" author="mjsax" created="Wed, 19 Mar 2025 08:06:07 +0000"  >&lt;p&gt;With 4.0.0 being release now, it is very unlikely that there will be a 3.8.2 release. If we get 3.8.2, I agree that it should contain this fix.&lt;/p&gt;</comment>
                            <comment id="17936944" author="foal" created="Wed, 19 Mar 2025 20:46:06 +0000"  >&lt;p&gt;Good news, but how is it safe to use 4.0.0 in production? Also we need to wait for Spring to adapt the new version. So, please, release the 3.8.2, to make the migration to 4.0.0 more smoothly.&#160;&lt;/p&gt;</comment>
                            <comment id="17939096" author="mjsax" created="Thu, 27 Mar 2025 23:55:58 +0000"  >&lt;p&gt;It&apos;s a community decision if we would release 3.8.2 &#8211; we will for sure try to get it into 3.9.1. &#8211; I you want to make a case for 3.8.2, please start a thread on the dev mailing list about it.&lt;/p&gt;

&lt;p&gt;Personally, I don&apos;t see how 3.8.2 would make the migration to 4.0.0 more smooth?&lt;/p&gt;</comment>
                            <comment id="17939766" author="foal" created="Mon, 31 Mar 2025 17:56:43 +0000"  >&lt;ol&gt;
	&lt;li&gt;4.0.0 is released, but this fix is not a part of 4.0.0, isn&apos;t?&lt;/li&gt;
	&lt;li&gt;What is planned release date for 3.9.1, if any?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17939825" author="mjsax" created="Mon, 31 Mar 2025 22:45:06 +0000"  >&lt;p&gt;Correct, this fix is not included in 4.0.0.&lt;/p&gt;

&lt;p&gt;The current plan is, to include it in 3.9.1 and 4.0.1 bug-fix releases. &#8211; Code freeze for 3.9.1 is set for April/9 (ie, next week).&lt;/p&gt;</comment>
                            <comment id="17944798" author="foal" created="Tue, 15 Apr 2025 17:12:14 +0000"  >&lt;p&gt;I see release 3.8.2 also exists. Is it possible to add this fix to the 3.8.2 too?&lt;/p&gt;</comment>
                            <comment id="17945205" author="mjsax" created="Thu, 17 Apr 2025 02:08:34 +0000"  >&lt;p&gt;It&apos;s very unlikely that 3.8.2 will actually be released; thus I did not cherry-pick the fix to the 3.8 branch.&#160;If 3.8.2 will be proposed, I am happy to cherry-pick the commit to include the fix in the release.&lt;/p&gt;</comment>
                            <comment id="17946407" author="foal" created="Tue, 22 Apr 2025 12:23:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt; Do you know the estimated date for 3.9.1 release?&#160;&lt;/p&gt;</comment>
                            <comment id="17946481" author="mjsax" created="Tue, 22 Apr 2025 17:05:08 +0000"  >&lt;p&gt;It&apos;s active WIP &#8211; but alway hard to know exactly. My best guess would be, that is should go out by end of April (no promise).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13578905">KAFKA-16700</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="13572727">KAFKA-16394</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13074595" name="Screenshot 2025-02-10 at 12.06.38.png" size="52847" author="nilmadhab" created="Mon, 10 Feb 2025 04:09:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            29 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1tz7c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>