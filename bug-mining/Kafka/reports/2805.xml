<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:25:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-10340] Source connectors should report error when trying to produce records to non-existent topics instead of hanging forever</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-10340</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Currently, a source connector will blindly attempt to write a record to a Kafka topic. When the topic does not exist, its creation is controlled by the &lt;tt&gt;auto.create.topics.enable&lt;/tt&gt; config on the brokers. When auto.create is disabled, the producer.send() call on the Connect worker will hang indefinitely (due to the &quot;infinite retries&quot; configuration for said producer). In setups where this config is usually disabled, the source connector simply appears to hang and not produce any output.&lt;/p&gt;

&lt;p&gt;It is desirable to either log an info or an error message (or inform the user somehow) that the connector is simply stuck waiting for the destination topic to be created. When the worker has permissions to inspect the broker settings, it can use the &lt;tt&gt;listTopics&lt;/tt&gt; and &lt;tt&gt;describeConfigs&lt;/tt&gt; API in AdminClient to check if the topic exists, the broker can &lt;tt&gt;auto.create.topics.enable&lt;/tt&gt; topics, and if these cases do not exist, either throw an error.&lt;/p&gt;

&lt;p&gt;With the recently merged &lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-158%3A+Kafka+Connect+should+allow+source+connectors+to+set+topic-specific+settings+for+new+topics&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;KIP-158&lt;/a&gt;, this becomes even more specific a corner case: when topic creation settings are enabled, the worker should handle the corner case where topic creation is disabled, &lt;tt&gt;auto.create.topics.enable&lt;/tt&gt; is set to false and topic does not exist.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13320728">KAFKA-10340</key>
            <summary>Source connectors should report error when trying to produce records to non-existent topics instead of hanging forever</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ChrisEgerton">Chris Egerton</assignee>
                                    <reporter username="wicknicks">Arjun Satish</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Aug 2020 18:38:49 +0000</created>
                <updated>Wed, 16 Mar 2022 01:38:06 +0000</updated>
                            <resolved>Thu, 18 Mar 2021 16:15:22 +0000</resolved>
                                    <version>2.5.1</version>
                    <version>2.6.1</version>
                    <version>2.7.0</version>
                    <version>2.8.0</version>
                                    <fixVersion>2.6.2</fixVersion>
                    <fixVersion>2.7.1</fixVersion>
                    <fixVersion>2.8.1</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17174105" author="showuon" created="Mon, 10 Aug 2020 06:28:09 +0000"  >&lt;p&gt;After investigation, if the &lt;tt&gt;auto.create.topics.enable&lt;/tt&gt; is disabled, the producer.send will get only &lt;tt&gt;TimeoutException&lt;/tt&gt; and no other valuable clue for users. So, I will improve the logging in this area.&lt;/p&gt;

&lt;p&gt;Proposed to add 2 logs:&lt;/p&gt;

&lt;p&gt;1. When the topic creation is disabled or topic is existed:&lt;/p&gt;

&lt;p&gt;log.debug(&lt;font color=&quot;#008000&quot;&gt;&quot;The topic creation setting is disabled or the topic name {} is already created. &quot; &lt;/font&gt;+&lt;br/&gt;
 &lt;font color=&quot;#008000&quot;&gt;&quot;If the topic doesn&apos;t exist, we&apos;ll rely on the auto.create.topics.enable setting in broker side &quot; &lt;/font&gt;+&lt;br/&gt;
 &lt;font color=&quot;#008000&quot;&gt;&quot;to see if the topic can be auto created or not&quot;&lt;/font&gt;, topic);&lt;/p&gt;

&lt;p&gt;2. Before the producer send the record:&lt;/p&gt;

&lt;p&gt;log.trace(&lt;font color=&quot;#008000&quot;&gt;&quot;{} is going to send record to {}&quot;&lt;/font&gt;, WorkerSourceTask.&lt;font color=&quot;#000080&quot;&gt;this&lt;/font&gt;, topic);&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So, for the request to let user know it&apos;s stuck waiting for the destination topic to be created is now basically cannot know from client side because the producer.send will block on waitOnMetadata method, which will keep trying until timeout. There are many possible reasons for this timeout. It&apos;s hard to tell.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;And the dynamically &lt;tt&gt;describeConfigs&lt;/tt&gt; to get the broker setting is also not easy because the broker name (we need broker name to describeConfig) is not kept in the config, and also there&apos;s no other places in Kafka to check the broker setting before doing something. I&apos;d prefer to keep it as is because this behavior(auto create topic or not while producer.send) applied for all kafka, not only for connectors.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17276498" author="chrisegerton" created="Mon, 1 Feb 2021 17:16:53 +0000"  >&lt;p&gt;The logging changes are certainly an improvement, but don&apos;t address the underlying issue: source tasks and their producers hang and remain active (i.e., are not closed) indefinitely, even after the task is scheduled for shutdown. If several task instances are scheduled for shutdown and then recreated (which may happen as a result of rebalance or connector reconfiguration), any of those instances in this bad state will keep sending metadata requests to the broker from their producers, and any resources allocated by the &lt;tt&gt;SourceTask&lt;/tt&gt; instances will not be freed.&lt;/p&gt;

&lt;p&gt;This creates a resource leak and the impact is substantial enough that I believe the ticket should be reopened until it has been addressed with a functional fix.&lt;/p&gt;</comment>
                            <comment id="17282498" author="xakassi" created="Wed, 10 Feb 2021 15:00:09 +0000"  >&lt;p&gt;Hi, guys!&lt;/p&gt;

&lt;p&gt;According to &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5295&quot; title=&quot;Allow Kafka Connect source connectors to specify topic-specific settings for new topics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5295&quot;&gt;&lt;del&gt;KAFKA-5295&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5295&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-5295&lt;/a&gt;)&#160;I supposed that now topics are always created by&#160;AdminClient if&#160; &quot;topic.creation.enable = true&quot;.&lt;/p&gt;

&lt;p&gt;But now I see that topics are created&#160;by&#160;AdminClient, only when&#160;&quot;topic.creation.enable = true&quot; and &quot;topic.creation&quot; parameters are used.&lt;br/&gt;
But I wonder why?&lt;br/&gt;
Why do not create topics always by&#160;AdminClient&#160;if&#160; &quot;topic.creation.enable = true&quot;?&lt;br/&gt;
&#160;&lt;br/&gt;
It will partially solve the current problem (described in this ticket) and only the case with&#160;&quot;topic.creation.enable = false&quot; is the problem.&lt;br/&gt;
&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
And also current approach can be a problem for us - we wanted to set &quot;auto.create.topics.enable = false&quot; on Kafka cluster by default. But we cannot do that, because our connectors can be created with&#160;&lt;br/&gt;
&quot;topic.creation&quot; parameters or without them, we cannot guarantee that. And in case connectors have not this property, we get errors.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Any comments and your opinion is appreciated!&#160;&lt;/p&gt;</comment>
                            <comment id="17282875" author="xakassi" created="Thu, 11 Feb 2021 06:44:22 +0000"  >&lt;p&gt;And also I cannot understand, why we even have the property&#160;&quot;topic.creation.enable&quot; and do not create all topics by&#160;AdminClient? Isn&apos;t it a better approach to create topics always explicitly using&#160;AdminClient than to rely on auto creation?&lt;/p&gt;

&lt;p&gt;And also I cannot see how can it has a bad impact on users. Why someone may want to set&#160;&quot;topic.creation.enable = false&quot;?&lt;/p&gt;

&lt;p&gt;According to&#160;KIP-158 we have an option to set&#160;replication.factor and&#160;partitions to -1&#160;to use the broker&apos;s default value. So why we cannot always create topics by&#160;AdminClient and use these broker&apos;s default values in case connector does not have any &quot;topic.creation&quot; properties?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As far as I understand this will completely solve the problem described in this ticket. And also people will be able to set &quot;auto.create.topics.enable = false&quot; on Kafka cluster without any impact.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Please, correct me if I am wrong.&lt;/p&gt;</comment>
                            <comment id="17292993" author="rhauch" created="Mon, 1 Mar 2021 16:16:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xakassi&quot; class=&quot;user-hover&quot; rel=&quot;xakassi&quot;&gt;xakassi&lt;/a&gt;&#160;wrote:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;And also I cannot understand, why we even have the property&#160;&quot;topic.creation.enable&quot; and do not create all topics by&#160;AdminClient? Isn&apos;t it a better approach to create topics always explicitly using&#160;AdminClient than to rely on auto creation?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;When we introduced KIP-158 to allow Connect to source connectors to specify the rules for creating topics, it was important that we maintained backward compatibility. Many people upgrade Kafka and Connect simply to get fixes, and do not want new features they don&apos;t know about nor wish to use enabled by default. This is an essential aspect of all KIPs and AK features, even when by default most users &lt;b&gt;probably&lt;/b&gt; would want to use the feature.  &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;According to KIP-158 we have an option to set replication.factor and partitions to -1 to use the broker&apos;s default value. So why we cannot always create topics by AdminClient and use these broker&apos;s default values in case connector does not have any &quot;topic.creation&quot; properties?&lt;/p&gt;

&lt;p&gt;As far as I understand this will completely solve the problem described in this ticket.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It actually would not solve the problem. If Connect were to have the behavior you suggest, then we&apos;d still run into the issue when the broker has autocreation of topics disabled &lt;b&gt;and&lt;/b&gt; the particular source connector did not specify the topic creation rules.&lt;/p&gt;

&lt;p&gt;The bottom line is that many things would be made easier &lt;b&gt;for some people&lt;/b&gt; if we could easily change defaults, but upgrading would become painfully difficult for those that don&apos;t wish to use those new features or behaviors. By maintaining backward compatibility, we dramatically reduce the overhead and risk of upgrades to get fixes, which is an important characteristic that the AK community cherishes.&lt;/p&gt;

&lt;p&gt;We will have the option in 3.0 to &lt;b&gt;change&lt;/b&gt; defaults and behaviors &amp;#8211; it is a major release that may not be entirely backward compatible. Obviously, we&apos;ll want to not break things unnecessarily, but changing the default `topic.creation.enable = true` will be one such change we are very much looking forward to making.&lt;/p&gt;</comment>
                            <comment id="17293185" author="rhauch" created="Mon, 1 Mar 2021 21:34:17 +0000"  >&lt;p&gt;Merged to `trunk` and backported to:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;`2.7` for inclusion in the upcoming 2.7.1&lt;/li&gt;
	&lt;li&gt;`2.6` for inclusion in the upcoming 2.6.2&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The `2.8` branch is currently blocked for the 2.8.0 release, so I&apos;ve created &lt;a href=&quot;https://github.com/apache/kafka/pull/10238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/10238&lt;/a&gt; for the 2.8 backport &amp;#8211; either if this is approved as a 2.8.0 blocker or after 2.8.0 has been released.&lt;/p&gt;

&lt;p&gt;Leaving this issue open until 2.8 is addressed.&lt;/p&gt;</comment>
                            <comment id="17294278" author="ableegoldman" created="Wed, 3 Mar 2021 04:54:19 +0000"  >&lt;p&gt;Temporarily removed 2.6.2 from the Fix Version so I can proceed with the 2.6.2 release, since it&apos;s already been cherrypicked to 2.6 This should be added back once the ticket is resolved&lt;/p&gt;</comment>
                            <comment id="17299037" author="mimaison" created="Wed, 10 Mar 2021 18:15:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vvcephei&quot; class=&quot;user-hover&quot; rel=&quot;vvcephei&quot;&gt;vvcephei&lt;/a&gt; Are we picking this change in 2.8? &lt;/p&gt;

&lt;p&gt;I wonder if this we should actually resolve this JIRA as the fix has been made to trunk, 2.6 and 2.7. If John decides to pull it in 2.8, then we can just add 2.8.0 to Fix Versions. That would enable us to run the 2.6.2 and 2.7.1 releases without having to tweak Fix Versions&lt;/p&gt;</comment>
                            <comment id="17304254" author="rhauch" created="Thu, 18 Mar 2021 16:14:52 +0000"  >&lt;blockquote&gt;

&lt;p&gt;I wonder if this we should actually resolve this JIRA as the fix has been made to trunk, 2.6 and 2.7. If John decides to pull it in 2.8, then we can just add 2.8.0 to Fix Versions. That would enable us to run the 2.6.2 and 2.7.1 releases without having to tweak Fix Versions.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;That sounds fine with me. I&apos;ll will add the 2.6.2 fix, mark this as resolved. We can then add the 2.8 version (either `2.8.0` or `2.8.1`) if/when &lt;a href=&quot;https://github.com/apache/kafka/pull/10238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/10238&lt;/a&gt;&#160;is merged to 2.8.&lt;/p&gt;</comment>
                            <comment id="17339862" author="rhauch" created="Wed, 5 May 2021 19:17:03 +0000"  >&lt;p&gt;I cherry-picked the original PR (&lt;a href=&quot;https://github.com/apache/kafka/pull/10016&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/10016&lt;/a&gt;) to the `2.8` branch (now that it&apos;s not frozen) and updated the fixed versions.&lt;/p&gt;

&lt;p&gt;This completes all of the planned work for this issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13385625">KAFKA-12990</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 27 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hfns:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rhauch</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>