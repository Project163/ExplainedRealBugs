<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:24:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-10166] Excessive TaskCorruptedException seen in testing</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-10166</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;As the title indicates, long-running test applications with injected network &quot;outages&quot; seem to hit TaskCorruptedException more than expected.&lt;/p&gt;

&lt;p&gt;Seen occasionally on the ALOS application (~20 times in two days in one case, for example), and very frequently with EOS (many times per day)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13311541">KAFKA-10166</key>
            <summary>Excessive TaskCorruptedException seen in testing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ableegoldman">A. Sophie Blee-Goldman</assignee>
                                    <reporter username="ableegoldman">A. Sophie Blee-Goldman</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Jun 2020 18:36:51 +0000</created>
                <updated>Tue, 9 Mar 2021 09:20:30 +0000</updated>
                            <resolved>Tue, 7 Jul 2020 00:19:28 +0000</resolved>
                                                    <fixVersion>2.6.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17144358" author="rhauch" created="Wed, 24 Jun 2020 20:28:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cadonna&quot; class=&quot;user-hover&quot; rel=&quot;cadonna&quot;&gt;cadonna&lt;/a&gt;: Do we want to continue treating this as a blocker for the 2.6.0 release? If so, what&apos;s the timeframe for fixing this?&lt;/p&gt;

&lt;p&gt;If this should not block the release, should we downgrade the priority and/or change the fix versions to 2.6.1 and/or 2.7.0?&lt;/p&gt;</comment>
                            <comment id="17144562" author="ableegoldman" created="Thu, 25 Jun 2020 00:41:04 +0000"  >&lt;p&gt;I think this should be a blocker, yes. It&apos;s a regression in 2.6 and causes Streams to unnecessarily rebuild state from the changelog which can mean a very long stall.&lt;/p&gt;

&lt;p&gt;One root cause just occurred to me while looking at some related code, which I&apos;ll open a PR for right away. I&apos;m not sure it&apos;s the&#160;&lt;em&gt;only&lt;/em&gt; root cause but I&apos;ll begin testing right away to see if it fixes the majority of the problem or not.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cadonna&quot; class=&quot;user-hover&quot; rel=&quot;cadonna&quot;&gt;cadonna&lt;/a&gt;&#160;do you want to split up this ticket? There are two kinds of TaskCorruptedException, both of which we see more than expected. It probably makes sense to look at these individually and in parallel.&#160;Can you look into the TaskCorruptedException thrown in StoreChangelogReader#restore? I&apos;ll investigate my theory for the exceptions thrown in ProcessorStateManager&lt;/p&gt;</comment>
                            <comment id="17144788" author="cadonna" created="Thu, 25 Jun 2020 09:25:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt; I agree that splitting is a good idea.&lt;/p&gt;</comment>
                            <comment id="17146243" author="cadonna" created="Fri, 26 Jun 2020 11:37:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhauch&quot; class=&quot;user-hover&quot; rel=&quot;rhauch&quot;&gt;rhauch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Good news regarding the &lt;tt&gt;TaskCorruptedException&lt;/tt&gt; thrown in &lt;tt&gt;StoreChangelogReader#restore()&lt;/tt&gt;. This seems to occur due to deleted segments on the brokers. When a segment is deleted the start offset is increased to the new start offset of the new first segment. After that Streams tries to restore from the deleted segment and the &lt;tt&gt;TaskCorruptedException&lt;/tt&gt; is thrown.&lt;/p&gt;

&lt;p&gt;In the broker logs I see&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2020-06-25T12:20:51+02:00]  ... INFO [Log partition=stream-soak-test-KSTREAM-AGGREGATE-STATE-STORE-0000000019-changelog-1, dir=/mnt/kafka/data] Incremented log start offset to 64642732 due to segment deletion (kafka.log.Log)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and in the Streams logs&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2020-06-25T13:12:47+02:00] ... org.apache.kafka.clients.consumer.OffsetOutOfRangeException: Fetch position FetchPosition{offset=64292139, offsetEpoch=Optional.empty, currentLeader=LeaderAndEpoch{leader=Optional[...:9092 (id: 1002 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)], epoch=0}} is out of range &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; partition stream-soak-test-KSTREAM-AGGREGATE-STATE-STORE-0000000019-changelog-1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Start offset after segment deletion is 64642732. &lt;br/&gt;
 Start offset Streams wants to read from is 64292139.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;OffsetOutOfRangeException&lt;/tt&gt; then triggers the &lt;tt&gt;TaskCorruptedException&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The segments are deleted because of the configured retention size. So everything works as intended.&lt;/p&gt;

&lt;p&gt;Hence, this blocker only depends on the &lt;tt&gt;TaskCorruptedException&lt;/tt&gt; thrown by the &lt;tt&gt;ProcessorStateManager&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17146501" author="ableegoldman" created="Fri, 26 Jun 2020 17:14:30 +0000"  >&lt;p&gt;Thanks for the detailed analysis Bruno. In that case we are just waiting on the one PR, which should be mergeable sometime today&lt;/p&gt;</comment>
                            <comment id="17148973" author="ableegoldman" created="Tue, 30 Jun 2020 22:06:58 +0000"  >&lt;p&gt;Found two edge cases we missed earlier so I&apos;m reopening this blocker; the fixes are minor so I&apos;ll have a PR ready shortly cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhauch&quot; class=&quot;user-hover&quot; rel=&quot;rhauch&quot;&gt;rhauch&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17152198" author="rhauch" created="Mon, 6 Jul 2020 17:32:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt; do you have an updated ETA?&lt;/p&gt;</comment>
                            <comment id="17152208" author="ableegoldman" created="Mon, 6 Jul 2020 17:43:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhauch&quot; class=&quot;user-hover&quot; rel=&quot;rhauch&quot;&gt;rhauch&lt;/a&gt;&#160;I think we can get it merged sometime today&lt;/p&gt;</comment>
                            <comment id="17152381" author="guozhang" created="Tue, 7 Jul 2020 00:19:21 +0000"  >&lt;p&gt;I&apos;ve merged in &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt;&apos;s PR, and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cadonna&quot; class=&quot;user-hover&quot; rel=&quot;cadonna&quot;&gt;cadonna&lt;/a&gt; has also confirmed the other corruption exception are actually legitimate, so I&apos;m going to close this ticket now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fv94:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>