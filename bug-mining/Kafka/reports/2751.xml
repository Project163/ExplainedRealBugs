<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:25:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-10268] dynamic config like &quot;--delete-config log.retention.ms&quot; doesn&apos;t work</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-10268</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;After I set &quot;log.retention.ms=301000&quot; to clean the data,i use the cmd&lt;/p&gt;

&lt;p&gt;&quot;bin/kafka-configs.sh --bootstrap-server 10.129.104.15:9092 --entity-type brokers --entity-default --alter --delete-config log.retention.ms&quot; to reset to default.&lt;/p&gt;

&lt;p&gt;Static broker configuration like log.retention.hours is 168h and no topic level configuration like&#160;retention.ms.&lt;/p&gt;

&lt;p&gt;it did not take effect actually although server.log print the broker configuration like that.&lt;/p&gt;

&lt;p&gt;log.retention.check.interval.ms = 300000&lt;br/&gt;
 log.retention.hours = 168&lt;br/&gt;
 log.retention.minutes = null&lt;br/&gt;
 &lt;font color=&quot;#ff0000&quot;&gt;log.retention.ms = null&lt;/font&gt;&lt;br/&gt;
 log.roll.hours = 168&lt;br/&gt;
 log.roll.jitter.hours = 0&lt;br/&gt;
 log.roll.jitter.ms = null&lt;br/&gt;
 log.roll.ms = null&lt;br/&gt;
 log.segment.bytes = 1073741824&lt;br/&gt;
 log.segment.delete.delay.ms = 60000&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Then we can see that retention time is still 301000ms from the server.log and segments have been deleted.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:30:00,958&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Log partition=test_retention-2, dir=/data/kafka_logs-test&amp;#93;&lt;/span&gt; Found deletable segments with base offsets &lt;span class=&quot;error&quot;&gt;&amp;#91;5005329,6040360&amp;#93;&lt;/span&gt; due to retention time 301000ms breach (kafka.log.Log)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:30:00,959&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Log partition=test_retention-2, dir=/data/kafka_logs-test&amp;#93;&lt;/span&gt; Scheduling log segment &lt;span class=&quot;error&quot;&gt;&amp;#91;baseOffset 5005329, size 1073741222&amp;#93;&lt;/span&gt; for deletion. (kafka.log.Log)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:30:00,959&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Log partition=test_retention-2, dir=/data/kafka_logs-test&amp;#93;&lt;/span&gt; Scheduling log segment &lt;span class=&quot;error&quot;&gt;&amp;#91;baseOffset 6040360, size 1073728116&amp;#93;&lt;/span&gt; for deletion. (kafka.log.Log)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:30:00,959&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Log partition=test_retention-2, dir=/data/kafka_logs-test&amp;#93;&lt;/span&gt; Incrementing log start offset to 7075648 (kafka.log.Log)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:30:00,960&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Log partition=test_retention-0, dir=/data/kafka_logs-test&amp;#93;&lt;/span&gt; Found deletable segments with base offsets &lt;span class=&quot;error&quot;&gt;&amp;#91;5005330,6040410&amp;#93;&lt;/span&gt; &lt;font color=&quot;#FF0000&quot;&gt;due to retention time 301000ms&lt;/font&gt; breach (kafka.log.Log)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:30:00,960&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Log partition=test_retention-0, dir=/data/kafka_logs-test&amp;#93;&lt;/span&gt; Scheduling log segment &lt;span class=&quot;error&quot;&gt;&amp;#91;baseOffset 5005330, size 1073732368&amp;#93;&lt;/span&gt; for deletion. (kafka.log.Log)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:30:00,961&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Log partition=test_retention-0, dir=/data/kafka_logs-test&amp;#93;&lt;/span&gt; Scheduling log segment &lt;span class=&quot;error&quot;&gt;&amp;#91;baseOffset 6040410, size 1073735366&amp;#93;&lt;/span&gt; for deletion. (kafka.log.Log)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:30:00,961&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Log partition=test_retention-0, dir=/data/kafka_logs-test&amp;#93;&lt;/span&gt; Incrementing log start offset to 7075685 (kafka.log.Log)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:31:00,959&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Log partition=test_retention-2, dir=/data/kafka_logs-test&amp;#93;&lt;/span&gt; Deleting segment 5005329 (kafka.log.Log)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:31:00,959&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Log partition=test_retention-2, dir=/data/kafka_logs-test&amp;#93;&lt;/span&gt; Deleting segment 6040360 (kafka.log.Log)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:31:00,961&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Log partition=test_retention-0, dir=/data/kafka_logs-test&amp;#93;&lt;/span&gt; Deleting segment 5005330 (kafka.log.Log)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:31:00,961&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Log partition=test_retention-0, dir=/data/kafka_logs-test&amp;#93;&lt;/span&gt; Deleting segment 6040410 (kafka.log.Log)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:31:01,144&amp;#93;&lt;/span&gt; INFO Deleted log /data/kafka_logs-test/test_retention-2/00000000000006040360.log.deleted. (kafka.log.LogSegment)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:31:01,144&amp;#93;&lt;/span&gt; INFO Deleted offset index /data/kafka_logs-test/test_retention-2/00000000000006040360.index.deleted. (kafka.log.LogSegment)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-13 14:31:01,144&amp;#93;&lt;/span&gt; INFO Deleted time index /data/kafka_logs-test/test_retention-2/00000000000006040360.timeindex.deleted. (kafka.log.LogSegment)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here are a few steps to reproduce it.&lt;/p&gt;

&lt;p&gt;1&#12289;set log.retention.ms=301000:&lt;/p&gt;

&lt;p&gt;bin/kafka-configs.sh --bootstrap-server 10.129.104.15:9092 --entity-type brokers --entity-default --alter --add-config log.retention.ms=301000&lt;/p&gt;

&lt;p&gt;2&#12289;produce messages to the topic:&lt;/p&gt;

&lt;p&gt;bin/kafka-producer-perf-test.sh --topic test_retention --num-records 10000000 --throughput -1 --producer-props bootstrap.servers=10.129.104.15:9092 --record-size 1024&lt;/p&gt;

&lt;p&gt;3&#12289;reset&#160;log.retention.ms to the default:&lt;/p&gt;

&lt;p&gt;bin/kafka-configs.sh --bootstrap-server 10.129.104.15:9092 --entity-type brokers --entity-default --alter --delete-config log.retention.ms&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I have attched server.log. You can see the log from row 238 to row 731.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13316424">KAFKA-10268</key>
            <summary>dynamic config like &quot;--delete-config log.retention.ms&quot; doesn&apos;t work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="huxi_2b">huxihx</assignee>
                                    <reporter username="zhifeng.peng">zhifeng.peng</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jul 2020 11:01:23 +0000</created>
                <updated>Wed, 29 Jul 2020 07:22:39 +0000</updated>
                            <resolved>Fri, 24 Jul 2020 01:37:50 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.6.0</fixVersion>
                    <fixVersion>2.7.0</fixVersion>
                                    <component>log</component>
                    <component>log cleaner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17166513" author="rhauch" created="Tue, 28 Jul 2020 15:56:49 +0000"  >&lt;p&gt;This was also cherry-picked to&#160;&lt;tt&gt;2.6&lt;/tt&gt;, but that branch has been frozen while we try to release AK 2.6.0. However, given that this is low-risk, I&apos;ll leave it on&#160;&lt;tt&gt;2.6&lt;/tt&gt;, and updated the &quot;Fix Versions&quot; field above to include `2.6.0`.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13007542" name="server.log.2020-07-13-14" size="106524" author="zhifeng.peng" created="Mon, 13 Jul 2020 11:00:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0gp5c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>