<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:31:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-14015] ConfigProvider with ttl fails to restart tasks</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-14015</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;According to the &lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-297%3A+Externalizing+Secrets+for+Connect+Configurations#KIP297:ExternalizingSecretsforConnectConfigurations-SecretRotation&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;KIP-297&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;&lt;ul&gt;
	&lt;li&gt;When the Herder receives the onChange() call, it will check a new connector configuration property config.reload.action which can be one of the following:
	&lt;ul&gt;
		&lt;li&gt;The value restart, which means to schedule a restart of the Connector and all its Tasks. This will be the default.&lt;/li&gt;
		&lt;li&gt;The value none, which means to do nothing.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;However, the &lt;a href=&quot;https://github.com/apache/kafka/blob/3.2.0/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/standalone/StandaloneHerder.java#L287-L294&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;restartConnector&lt;/a&gt; method only restarts the connector and does not restart any tasks.&#160; Suggest calling &lt;tt&gt;restartConnectorAndTasks&lt;/tt&gt; instead.&lt;/p&gt;

&lt;p&gt;The result is changed configurations provided by the ConfigProvider are not picked up and existing tasks continue to use outdated configuration.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13454616">KAFKA-14015</key>
            <summary>ConfigProvider with ttl fails to restart tasks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yash.mayya">Yash Mayya</assignee>
                                    <reporter username="rozza">Ross Lawley</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Jun 2022 17:07:13 +0000</created>
                <updated>Tue, 6 Sep 2022 13:06:09 +0000</updated>
                            <resolved>Tue, 6 Sep 2022 13:06:09 +0000</resolved>
                                                    <fixVersion>3.4.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17582519" author="sagarrao" created="Sun, 21 Aug 2022 09:39:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rozza&quot; class=&quot;user-hover&quot; rel=&quot;rozza&quot;&gt;rozza&lt;/a&gt; , Thanks for filing this issue. There seems to be a mismatch in what the KIP talks about and what&apos;s happening in the code indeed. I think the `restartConnectorAndTasks` was added well after the KIP was written. Just curious, have you noticed that tasks continue working with outdated configuration? In that case, does explicit restart of the task mitigate the issue?&lt;/p&gt;

&lt;p&gt;Also, one thing that I would like to point out is that we can&apos;t just replace `restartConnector` call with `restartConnectorAndTasks` to get this working. That&apos;s because the current `restartConnector` invocation doesn&apos;t restart immediately but instead waits for ttl (which could be lease duration for vault keys for example). In that case, we might need a new implementation of this. What do you think about this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ChrisE&quot; class=&quot;user-hover&quot; rel=&quot;chrise&quot;&gt;ChrisE&lt;/a&gt; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rayokota&quot; class=&quot;user-hover&quot; rel=&quot;rayokota&quot;&gt;rayokota&lt;/a&gt; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yash.mayya&quot; class=&quot;user-hover&quot; rel=&quot;yash.mayya&quot;&gt;yash.mayya&lt;/a&gt; ?&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17585384" author="yash.mayya" created="Fri, 26 Aug 2022 13:52:19 +0000"  >&lt;p&gt;Hm this looks like it maybe a bug in the StandaloneHerder. In the DistributedHerder, &lt;a href=&quot;https://github.com/apache/kafka/blob/38103ffaa962ef5092baffb884c84f8de3568501/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/distributed/DistributedHerder.java#L1023&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;restartConnector calls startConnector&lt;/a&gt; after stopping the connector which then gets the latest connector config (i.e. after substituting all variable configs with their values from the config transformer). It then asks the connector to supply it with a new set of task configs, and then if it detects that the task configs have changed, it will write the new task configs to the config topic or forward it to the leader if it isn&apos;t the leader (which then eventually results in the old set of tasks being stopped and the new tasks being started).&lt;/p&gt;</comment>
                            <comment id="17585390" author="yash.mayya" created="Fri, 26 Aug 2022 13:59:30 +0000"  >&lt;p&gt;In essence, this should work as expected when Connect is being run in distributed mode. In standalone mode, it looks like there is a similar flow &lt;a href=&quot;https://github.com/apache/kafka/blob/38103ffaa962ef5092baffb884c84f8de3568501/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/standalone/StandaloneHerder.java#L392-L407&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt; (i.e. get latest connector configs -&amp;gt; ask connector for task configs -&amp;gt; check if there&apos;s a change in the task configs -&amp;gt; if so, stop old set of tasks and start new set of tasks). However, that seems to only be called if i) configs are updated directly via PUT /config endpoint; ii) connector explicitly requests task reconfiguration via its context; iii) connector is resumed via the REST API. So we might need to make some changes to ensure that task reconfiguration is requested when &lt;a href=&quot;https://github.com/apache/kafka/blob/38103ffaa962ef5092baffb884c84f8de3568501/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/standalone/StandaloneHerder.java#L287&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;restartConnector&lt;/a&gt; is called in the StandaloneHerder (might be as simple as adding a call to &lt;a href=&quot;https://github.com/apache/kafka/blob/38103ffaa962ef5092baffb884c84f8de3568501/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/standalone/StandaloneHerder.java#L392-L407&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;updateConnectorTasks&lt;/a&gt; in startConnector)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z13zr4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>