<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:30:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-14020] Performance regression in Producer</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-14020</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/commit/f7db6031b84a136ad0e257df722b20faa7c37b8a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/commit/f7db6031b84a136ad0e257df722b20faa7c37b8a&lt;/a&gt; introduced a 10% performance regression in the KafkaProducer under a default config.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The context for this result is a benchmark that we run for Kafka Streams. The benchmark provisions 5 independent AWS clusters, including one broker node on an i3.large and one client node on an i3.large. During a benchmark run, we first run the Producer for 10 minutes to generate test data, and then we run Kafka Streams under a number of configurations to measure its performance.&lt;/p&gt;

&lt;p&gt;Our observation was a 10% regression in throughput under the simplest configuration, in which Streams simply consumes from a topic and does nothing else. That benchmark actually runs faster than the producer that generates the test data, so its thoughput is bounded by the data generator&apos;s throughput. After investigation, we realized that the regression was in the data generator, not the consumer or Streams.&lt;/p&gt;

&lt;p&gt;We have numerous benchmark runs leading up to the commit in question, and they all show a throughput in the neighborhood of 115,000 records per second. We also have 40 runs including and after that commit, and they all show a throughput in the neighborhood of 105,000 records per second. A test on &lt;a href=&quot;https://github.com/apache/kafka/pull/12342&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;trunk with the commit reverted &lt;/a&gt;&#160;shows a return to around 115,000 records per second.&lt;/p&gt;

&lt;p&gt;Config:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Properties properties = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties();
properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, broker);
properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here&apos;s the producer code in the data generator. Our tests were running with three produceThreads.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; t = 0; t &amp;lt; produceThreads; t++) {
    futures.add(executorService.submit(() -&amp;gt; {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; threadTotal = 0;
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; lastPrint = start;
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; printInterval = Duration.ofSeconds(10).toMillis();
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; now;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; org.apache.kafka.clients.producer.Producer&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; producer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KafkaProducer&amp;lt;&amp;gt;(producerConfig(broker))) {
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (limit &amp;gt; (now = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis()) - start) {
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 1000; i++) {
                    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key = keys.next();
                    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; data = dataGen.generate();

                    producer.send(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProducerRecord&amp;lt;&amp;gt;(topic, key, valueBuilder.apply(key, data)));

                    threadTotal++;
                }

                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((now - lastPrint) &amp;gt; printInterval) {
                    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; produced &quot;&lt;/span&gt; + numberFormat.format(threadTotal) + &lt;span class=&quot;code-quote&quot;&gt;&quot; to &quot;&lt;/span&gt; + topic + &lt;span class=&quot;code-quote&quot;&gt;&quot; in &quot;&lt;/span&gt; + Duration.ofMillis(now - start));
                    lastPrint = now;
                }
            }
        }
        total.addAndGet(threadTotal);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; finished (&quot;&lt;/span&gt; + numberFormat.format(threadTotal) + &lt;span class=&quot;code-quote&quot;&gt;&quot;) in &quot;&lt;/span&gt; + Duration.ofMillis(now - start));
    }));
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As you can see, this is a very basic usage.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13468347">KAFKA-14020</key>
            <summary>Performance regression in Producer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alivshits">Artem Livshits</assignee>
                                    <reporter username="vvcephei">John Roesler</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Jun 2022 19:59:53 +0000</created>
                <updated>Mon, 27 Jan 2025 03:35:41 +0000</updated>
                            <resolved>Wed, 20 Jul 2022 15:31:36 +0000</resolved>
                                    <version>3.3.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>producer </component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17558796" author="vvcephei" created="Sat, 25 Jun 2022 16:11:18 +0000"  >&lt;p&gt;&lt;font color=&quot;#1d1c1d&quot;&gt;FYI, just setting the partitioner back to the&#160;&lt;/font&gt;&lt;tt&gt;DefaultPartitioner&lt;/tt&gt;&lt;font color=&quot;#1d1c1d&quot;&gt;&#160;does not appear to help. The throughput of that test was 105k&#177;2k records per second.&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#1d1c1d&quot;&gt;Code under test:&#160;&lt;/font&gt;&lt;a href=&quot;https://github.com/apache/kafka/commit/6c67adb8beedafca0316d1c9ec4a3c219aaec219&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/commit/6c67adb8beedafca0316d1c9ec4a3c219aaec219&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17566017" author="vvcephei" created="Tue, 12 Jul 2022 21:09:53 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alivshits&quot; class=&quot;user-hover&quot; rel=&quot;alivshits&quot;&gt;alivshits&lt;/a&gt; , thanks for your work on &lt;a href=&quot;https://github.com/apache/kafka/pull/12365&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/12365&lt;/a&gt; .&lt;/p&gt;

&lt;p&gt;I&apos;ve just re-run the same benchmark above and confirmed that your PR fixes the perf regression. Thank you!&lt;/p&gt;

&lt;p&gt;As a reminder, this was the baseline for &quot;good&quot; performance:&lt;br/&gt;
Commit: &lt;a href=&quot;https://github.com/apache/kafka/commit/e3202b99999ef4c63aab2e5ab049978704282792&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;e3202b9&lt;/tt&gt;&lt;/a&gt; (the parent of the problematic commit)&lt;br/&gt;
TPut: &lt;b&gt;118k&#177;1k&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;And when I ran the same benchmark on &lt;a href=&quot;https://github.com/apache/kafka/commit/3a6500bb12b8c5716f7d99b6cec1c521f6f029c2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;3a6500b&lt;/tt&gt;&lt;/a&gt; , I got:&lt;br/&gt;
TPut: &lt;b&gt;117k&#177;1k&lt;/b&gt;&lt;/p&gt;</comment>
                            <comment id="17569085" author="junrao" created="Wed, 20 Jul 2022 15:31:36 +0000"  >&lt;p&gt;merged the PR to 3.3.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13347755">KAFKA-10888</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 16 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z16ci8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>