<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:06:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6277] Make loadClass thread-safe for class loaders of Connect plugins</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6277</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>
&lt;p&gt;In Connect&apos;s classloading isolation framework, &lt;tt&gt;PluginClassLoader&lt;/tt&gt; class encounters a race condition when several threads corresponding to tasks using a specific plugin (e.g. a Connector) try to load the same class at the same time on a single JVM. &lt;/p&gt;

&lt;p&gt;The race condition is related to calls to method &lt;tt&gt;defineClass&lt;/tt&gt; which, contract to &lt;tt&gt;findClass&lt;/tt&gt;, is not thread safe for classloaders that override &lt;tt&gt;loadClass&lt;/tt&gt;. More details here: &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://docs.oracle.com/javase/7/docs/technotes/guides/lang/cl-mt.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/technotes/guides/lang/cl-mt.html&lt;/a&gt;&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13121166">KAFKA-6277</key>
            <summary>Make loadClass thread-safe for class loaders of Connect plugins</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkonstantine">Konstantine Karantasis</assignee>
                                    <reporter username="kkonstantine">Konstantine Karantasis</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Nov 2017 03:19:05 +0000</created>
                <updated>Mon, 22 Jan 2018 03:42:20 +0000</updated>
                            <resolved>Mon, 22 Jan 2018 03:42:20 +0000</resolved>
                                    <version>0.11.0.2</version>
                    <version>1.0.0</version>
                                    <fixVersion>0.11.0.3</fixVersion>
                    <fixVersion>1.0.1</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16327763" author="githubbot" created="Tue, 16 Jan 2018 20:40:34 +0000"  >&lt;p&gt;kkonstantine opened a new pull request #4428: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6277&quot; title=&quot;Make loadClass thread-safe for class loaders of Connect plugins&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6277&quot;&gt;&lt;del&gt;KAFKA-6277&lt;/del&gt;&lt;/a&gt;: Ensure loadClass for plugin class loaders is thread-safe.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4428&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   `loadClass` needs to be synchronized to protect subsequent calls to `defineClass`. &lt;/p&gt;

&lt;p&gt;   Details in the javadoc of this PR as well as here too: &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/technotes/guides/lang/cl-mt.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/technotes/guides/lang/cl-mt.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   /cc @ewencp @rhauch &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16328247" author="githubbot" created="Wed, 17 Jan 2018 04:06:43 +0000"  >&lt;p&gt;ewencp closed pull request #4428: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6277&quot; title=&quot;Make loadClass thread-safe for class loaders of Connect plugins&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6277&quot;&gt;&lt;del&gt;KAFKA-6277&lt;/del&gt;&lt;/a&gt;: Ensure loadClass for plugin class loaders is thread-safe.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4428&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/PluginClassLoader.java b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/PluginClassLoader.java&lt;br/&gt;
index 780ebd09bfc..7ac3fe3e886 100644&lt;br/&gt;
&amp;#8212; a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/PluginClassLoader.java&lt;br/&gt;
+++ b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/PluginClassLoader.java&lt;br/&gt;
@@ -22,20 +22,50 @@&lt;br/&gt;
 import java.net.URL;&lt;br/&gt;
 import java.net.URLClassLoader;&lt;/p&gt;

&lt;p&gt;+/**&lt;br/&gt;
+ * A custom classloader dedicated to loading Connect plugin classes in classloading isolation.&lt;br/&gt;
+ * &amp;lt;p&amp;gt;&lt;br/&gt;
+ * Under the current scheme for classloading isolation in Connect, a plugin classloader loads the&lt;br/&gt;
+ * classes that finds in its urls. For classes that are either not found or are not supposed to be&lt;br/&gt;
+ * loaded in isolation, this plugin classloader delegates their loading to its parent. This makes&lt;br/&gt;
+ * this classloader a child-first classloader.&lt;br/&gt;
+ */&lt;br/&gt;
 public class PluginClassLoader extends URLClassLoader {&lt;br/&gt;
     private static final Logger log = LoggerFactory.getLogger(PluginClassLoader.class);&lt;br/&gt;
     private final URL pluginLocation;&lt;/p&gt;

&lt;p&gt;+    /**&lt;br/&gt;
+     * Constructor that accepts a specific classloader as parent.&lt;br/&gt;
+     *&lt;br/&gt;
+     * @param pluginLocation the top-level location of the plugin to be loaded in isolation by this&lt;br/&gt;
+     * classloader.&lt;br/&gt;
+     * @param urls the list of urls from which to load classes and resources for this plugin.&lt;br/&gt;
+     * @param parent the parent classloader to be used for delegation for classes that were&lt;br/&gt;
+     * not found or should not be loaded in isolation by this classloader.&lt;br/&gt;
+     */&lt;br/&gt;
     public PluginClassLoader(URL pluginLocation, URL[] urls, ClassLoader parent) &lt;/p&gt;
{
         super(urls, parent);
         this.pluginLocation = pluginLocation;
     }

&lt;p&gt;+    /**&lt;br/&gt;
+     * Constructor that defines the system classloader as parent of this plugin classloader.&lt;br/&gt;
+     *&lt;br/&gt;
+     * @param pluginLocation the top-level location of the plugin to be loaded in isolation by this&lt;br/&gt;
+     * classloader.&lt;br/&gt;
+     * @param urls the list of urls from which to load classes and resources for this plugin.&lt;br/&gt;
+     */&lt;br/&gt;
     public PluginClassLoader(URL pluginLocation, URL[] urls) &lt;/p&gt;
{
         super(urls);
         this.pluginLocation = pluginLocation;
     }

&lt;p&gt;+    /**&lt;br/&gt;
+     * Returns the top-level location of the classes and dependencies required by the plugin that&lt;br/&gt;
+     * is loaded by this classloader.&lt;br/&gt;
+     *&lt;br/&gt;
+     * @return the plugin location.&lt;br/&gt;
+     */&lt;br/&gt;
     public String location() &lt;/p&gt;
{
         return pluginLocation.toString();
     }
&lt;p&gt;@@ -45,8 +75,13 @@ public String toString() {&lt;br/&gt;
         return &quot;PluginClassLoader&lt;/p&gt;
{pluginLocation=&quot; + pluginLocation + &quot;}
&lt;p&gt;&quot;;&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;+    // This method needs to be thread-safe because it is supposed to be called by multiple&lt;br/&gt;
+    // Connect tasks. While findClass is thread-safe, defineClass called within loadClass of the&lt;br/&gt;
+    // base method is not. More on multithreaded classloaders in:&lt;br/&gt;
+    // &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/technotes/guides/lang/cl-mt.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/technotes/guides/lang/cl-mt.html&lt;/a&gt;&lt;br/&gt;
     @Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected Class&amp;lt;?&amp;gt; loadClass(String name, boolean resolve) throws ClassNotFoundException {&lt;br/&gt;
+    protected synchronized Class&amp;lt;?&amp;gt; loadClass(String name, boolean resolve)&lt;br/&gt;
+            throws ClassNotFoundException {&lt;br/&gt;
         Class&amp;lt;?&amp;gt; klass = findLoadedClass(name);&lt;br/&gt;
         if (klass == null) {&lt;br/&gt;
             try {&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16328248" author="githubbot" created="Wed, 17 Jan 2018 04:06:44 +0000"  >&lt;p&gt;kkonstantine opened a new pull request #4428: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6277&quot; title=&quot;Make loadClass thread-safe for class loaders of Connect plugins&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6277&quot;&gt;&lt;del&gt;KAFKA-6277&lt;/del&gt;&lt;/a&gt;: Ensure loadClass for plugin class loaders is thread-safe.&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4428&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   `loadClass` needs to be synchronized to protect subsequent calls to `defineClass`. &lt;/p&gt;

&lt;p&gt;   Details in the javadoc of this PR as well as here too: &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/technotes/guides/lang/cl-mt.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/technotes/guides/lang/cl-mt.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   /cc @ewencp @rhauch &lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16333836" author="ewencp" created="Mon, 22 Jan 2018 03:42:20 +0000"  >&lt;p&gt;Issue resolved by pull request 4428&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/4428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4428&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3n9cf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>