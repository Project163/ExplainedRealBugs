<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:53:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3394] Broker fails to parse Null Metadata in OffsetCommit requests</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3394</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;librdkafka sends a Null Metadata string (size -1) in its OffsetCommitRequests when there is no metadata, this unfortunately leads to an exception on the broker that expects a non-null string.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[2016-03-11 11:11:57,623] ERROR Closing socket for 10.191.0.33:9092-10.191.0.33:56503 because of error (kafka.network.Processor)
kafka.network.InvalidRequestException: Error getting request for apiKey: 8 and apiVersion: 1
    at kafka.network.RequestChannel$Request.liftedTree2$1(RequestChannel.scala:91)
    at kafka.network.RequestChannel$Request.&amp;lt;init&amp;gt;(RequestChannel.scala:88)
    at kafka.network.Processor$$anonfun$run$11.apply(SocketServer.scala:426)
    at kafka.network.Processor$$anonfun$run$11.apply(SocketServer.scala:421)
    at scala.collection.Iterator$class.foreach(Iterator.scala:727)
    at scala.collection.AbstractIterator.foreach(Iterator.scala:1157)
    at scala.collection.IterableLike$class.foreach(IterableLike.scala:72)
    at scala.collection.AbstractIterable.foreach(Iterable.scala:54)
    at kafka.network.Processor.run(SocketServer.scala:421)
    at java.lang.Thread.run(Thread.java:745)
Caused by: org.apache.kafka.common.protocol.types.SchemaException: Error reading field &apos;topics&apos;: Error reading field &apos;partitions&apos;: Error reading field &apos;metadata&apos;: java.lang.NegativeArraySizeException
    at org.apache.kafka.common.protocol.types.Schema.read(Schema.java:73)
    at org.apache.kafka.common.requests.OffsetCommitRequest.parse(OffsetCommitRequest.java:260)
    at org.apache.kafka.common.requests.AbstractRequest.getRequest(AbstractRequest.java:50)
    at kafka.network.RequestChannel$Request.liftedTree2$1(RequestChannel.scala:88)
    ... 9 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12950033">KAFKA-3394</key>
            <summary>Broker fails to parse Null Metadata in OffsetCommit requests</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hachikuji">Jason Gustafson</assignee>
                                    <reporter username="edenhill">Magnus Edenhill</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Mar 2016 19:51:57 +0000</created>
                <updated>Fri, 18 Mar 2016 20:38:00 +0000</updated>
                            <resolved>Fri, 18 Mar 2016 20:37:49 +0000</resolved>
                                    <version>0.10.0.0</version>
                                    <fixVersion>0.10.0.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15194032" author="ijuma" created="Mon, 14 Mar 2016 20:01:53 +0000"  >&lt;p&gt;This is a regression caused by changing `KafkaApis` to use the Java protocol classes. Marking as a blocker since it breaks existing clients.&lt;/p&gt;</comment>
                            <comment id="15194089" author="granthenke" created="Mon, 14 Mar 2016 20:42:15 +0000"  >&lt;p&gt;This could happen for basically any string in the protocol. The java protocol implementation assumes that string was not nullable, while the old Scala messages allowed all strings to be nullable. This came up in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3088&quot; title=&quot;0.9.0.0 broker crash on receipt of produce request with empty client ID&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3088&quot;&gt;&lt;del&gt;KAFKA-3088&lt;/del&gt;&lt;/a&gt; where we added NULLABLE_STRING and a default for the client id. &lt;/p&gt;

&lt;p&gt;If this is considered a regression, we should consider holistically how we want to handle the remaining strings that are not nullable. &lt;/p&gt;</comment>
                            <comment id="15194116" author="hachikuji" created="Mon, 14 Mar 2016 20:59:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=granthenke&quot; class=&quot;user-hover&quot; rel=&quot;granthenke&quot;&gt;granthenke&lt;/a&gt; I considered this when I first created NULLABLE_BYTES. Technically the Kafka protocol as documented has no such thing: all byte arrays and strings are nullable. I thought about changing BYTES to allow null values, but I was reluctant to suddenly have to deal with null values popping up where they hadn&apos;t been possible before. But maybe that&apos;s actually the safer way to ensure compatibility?&lt;/p&gt;</comment>
                            <comment id="15194134" author="granthenke" created="Mon, 14 Mar 2016 21:09:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; I agree that allowing nulls everywhere is pretty risky. I wasn&apos;t making a comment on which approach we should take. I was just commenting that we should evaluate/understand the problem holistically given that its a widespread issue.&lt;/p&gt;

&lt;p&gt;If a (third party) client runs into an issue with any string in the protocol are we going to make that string nullable? If the answer is yes, should we wait until they run into the issue and handle it on a case by cases basis?&lt;/p&gt;</comment>
                            <comment id="15194152" author="ijuma" created="Mon, 14 Mar 2016 21:18:19 +0000"  >&lt;p&gt;Given how the Scala request classes work, it seems to me that we have to make all Strings nullable in the Java request classes that are handling requests that were previously handled by Scala request classes. Is there any alternative that won&apos;t break clients? It is a bit too late to change this after we actually release a particular version.&lt;/p&gt;</comment>
                            <comment id="15194157" author="hachikuji" created="Mon, 14 Mar 2016 21:20:20 +0000"  >&lt;p&gt;Yeah, I guess what I was thinking is whether we should keep the current protocol definitions and change the implementation to make sure that we support what is documented (and deal with the consequence of having nulls all over the place). Or if we want to have non-nullable strings, maybe we should update the protocol documentation.&lt;/p&gt;

&lt;p&gt;As for how we&apos;re going to detect other such cases, I don&apos;t have any great ideas. I asked &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=edenhill&quot; class=&quot;user-hover&quot; rel=&quot;edenhill&quot;&gt;edenhill&lt;/a&gt; if there were other cases where he depends on null values and the only other case he thought of was message keys and values, which I&apos;m sure we already handle.&lt;/p&gt;</comment>
                            <comment id="15194269" author="githubbot" created="Mon, 14 Mar 2016 22:12:38 +0000"  >&lt;p&gt;GitHub user hachikuji opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1064&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1064&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3394&quot; title=&quot;Broker fails to parse Null Metadata in OffsetCommit requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3394&quot;&gt;&lt;del&gt;KAFKA-3394&lt;/del&gt;&lt;/a&gt;: allow null offset metadata in commit API&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hachikuji/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hachikuji/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3394&quot; title=&quot;Broker fails to parse Null Metadata in OffsetCommit requests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3394&quot;&gt;&lt;del&gt;KAFKA-3394&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1064.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1064.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1064&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="15202106" author="junrao" created="Fri, 18 Mar 2016 20:37:49 +0000"  >&lt;p&gt;Issue resolved by pull request 1064&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1064&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1064&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15202108" author="githubbot" created="Fri, 18 Mar 2016 20:38:00 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1064&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1064&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 35 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2umkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>junrao</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>