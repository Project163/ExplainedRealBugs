<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:43:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1374] LogCleaner (compaction) does not support compressed topics</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1374</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;This is a known issue, but opening a ticket to track.&lt;/p&gt;

&lt;p&gt;If you try to compact a topic that has compressed messages you will run into&lt;br/&gt;
various exceptions - typically because during iteration we advance the&lt;br/&gt;
position based on the decompressed size of the message. I have a bunch of&lt;br/&gt;
stack traces, but it should be straightforward to reproduce.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12707263">KAFKA-1374</key>
            <summary>LogCleaner (compaction) does not support compressed topics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="omkreddy">Manikumar</assignee>
                                    <reporter username="jjkoshy">Joel Jacob Koshy</reporter>
                        <labels>
                            <label>newbie++</label>
                    </labels>
                <created>Tue, 8 Apr 2014 21:25:56 +0000</created>
                <updated>Tue, 15 Dec 2015 00:26:37 +0000</updated>
                            <resolved>Wed, 20 May 2015 18:07:53 +0000</resolved>
                                                    <fixVersion>0.9.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14037669" author="jjkoshy" created="Thu, 19 Jun 2014 18:53:59 +0000"  >&lt;p&gt;I had started on this a while ago, but did not finish. Here&apos;s a WIP patch&lt;br/&gt;
that doesn&apos;t quite work yet:&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/jjkoshy/4657a44e52e3f88be1c1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/jjkoshy/4657a44e52e3f88be1c1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Another nuance with compression and compaction is what compression-codec do&lt;br/&gt;
we use when writing out the compacted data?&lt;/p&gt;

&lt;p&gt;We could adopt a broker-side compression config that can be overridden on a&lt;br/&gt;
per-topic basis. This would not only enable a consistent compression codec&lt;br/&gt;
for each topic, but it will also make the above decision more&lt;br/&gt;
straightforward - i.e., write out compacted messages in the configured&lt;br/&gt;
compression codec for that topic (or broker-default if the topic does not&lt;br/&gt;
have any override).&lt;/p&gt;

&lt;p&gt;Will file a separate jira for the above.&lt;/p&gt;
</comment>
                            <comment id="14078858" author="omkreddy" created="Wed, 30 Jul 2014 04:03:49 +0000"  >&lt;p&gt; I am trying to look in to the issue and WIP Patch.&lt;/p&gt;

&lt;p&gt;In WIP patch,  the following code is used to traverse segment offsets .&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; currOffset = segment.baseOffset
     &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (currOffset &amp;lt; segment.index.lastOffset) {
        currOffset = entry.nextOffset
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As per my observation,  segment.index.lastOffset is not giving the last offset of a given segment. &lt;br/&gt;
I have a segment with startingOffset=0 and lastOffset=7140. I am getting segment.index.lastOffset=7118.&lt;br/&gt;
This is creating some issue in the code.&lt;/p&gt;

&lt;p&gt;Any  idea on why segment.index.lastOffset is not returning proper lastOffset.?&lt;/p&gt;</comment>
                            <comment id="14084044" author="omkreddy" created="Sun, 3 Aug 2014 17:41:35 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/24214/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/24214/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14084047" author="omkreddy" created="Sun, 3 Aug 2014 17:42:37 +0000"  >&lt;p&gt;In this patch, LogCleaner decompress the compressed messages and writes back the retained messages in compressed form.&lt;/p&gt;

&lt;p&gt;I tested the following scenarios&lt;br/&gt;
1. Topic with non-compressed messages&lt;br/&gt;
2. Topic with compressed messages&lt;br/&gt;
3. Topic with both compressed and non-compressed messages.&lt;/p&gt;</comment>
                            <comment id="14087675" author="nehanarkhede" created="Wed, 6 Aug 2014 13:45:17 +0000"  >&lt;p&gt;Assigning to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjkoshy&quot; class=&quot;user-hover&quot; rel=&quot;jjkoshy&quot;&gt;jjkoshy&lt;/a&gt; for review&lt;/p&gt;</comment>
                            <comment id="14091717" author="omkreddy" created="Sat, 9 Aug 2014 10:38:20 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/24214/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/24214/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14091719" author="omkreddy" created="Sat, 9 Aug 2014 10:52:26 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/24214/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/24214/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14094307" author="omkreddy" created="Tue, 12 Aug 2014 16:56:31 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/24214/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/24214/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14133498" author="nehanarkhede" created="Mon, 15 Sep 2014 02:05:50 +0000"  >&lt;p&gt;Bump. This is marked for 0.8.2. Feel free to reassign for review.&lt;/p&gt;</comment>
                            <comment id="14144971" author="omkreddy" created="Tue, 23 Sep 2014 16:20:21 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/24214/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/24214/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14157960" author="omkreddy" created="Fri, 3 Oct 2014 13:22:26 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/24214/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/24214/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14157987" author="omkreddy" created="Fri, 3 Oct 2014 13:50:22 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/24214/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/24214/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14281480" author="omkreddy" created="Sat, 17 Jan 2015 18:52:01 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/24214/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/24214/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14316526" author="jkreps" created="Wed, 11 Feb 2015 16:58:08 +0000"  >&lt;p&gt;Hey guys, the test kafka.tools.TestLogCleaning is a very aggressive test that runs against a kafka cluster configured for log compaction. It produces a bunch of messages and compacts them continuously and then does an out of band comparison of the two. It would be good to ensure that stills works on really large cleaner runs with deletes with this patch.&lt;/p&gt;</comment>
                            <comment id="14316691" author="omkreddy" created="Wed, 11 Feb 2015 18:16:21 +0000"  >&lt;p&gt;yes, we are using TestLogCleaning  tool to test the changes. &lt;/p&gt;

&lt;p&gt;TestLogCleaning stress test output for compressed messages&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Producing 100000 messages...
Logging produce requests to /tmp/kafka-log-cleaner-produced-6014466306002699464.txt
Sleeping &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 120 seconds...
Consuming messages...
Logging consumed messages to /tmp/kafka-log-cleaner-consumed-177538909590644701.txt
100000 rows of data produced, 13165 rows of data consumed (86.8% reduction).
De-duplicating and validating output files...
Validated 9005 values, 0 mismatches.

Producing 1000000 messages...
Logging produce requests to /tmp/kafka-log-cleaner-produced-3298578695475992991.txt
Sleeping &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 120 seconds...
Consuming messages...
Logging consumed messages to /tmp/kafka-log-cleaner-consumed-7192293977610206930.txt
1000000 rows of data produced, 119926 rows of data consumed (88.0% reduction).
De-duplicating and validating output files...
Validated 89947 values, 0 mismatches.

Producing 10000000 messages...
Logging produce requests to /tmp/kafka-log-cleaner-produced-3336255463347572934.txt
Sleeping &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 120 seconds...
Consuming messages...
Logging consumed messages to /tmp/kafka-log-cleaner-consumed-9149188270705707725.txt
10000000 rows of data produced, 1645281 rows of data consumed (83.5% reduction).
De-duplicating and validating output files...
Validated 899853 values, 0 mismatches.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14316714" author="jjkoshy" created="Wed, 11 Feb 2015 18:26:33 +0000"  >&lt;p&gt;I can review this next week. However, as far as checking in is concerned I would strongly prefer to get &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1755&quot; title=&quot;Improve error handling in log cleaner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1755&quot;&gt;&lt;del&gt;KAFKA-1755&lt;/del&gt;&lt;/a&gt; done first (for which I have a patch almost ready). The reason for that is that this patch is a significant change to the log cleaner and I would rather get some defensive code in first since the log cleaner health is critical for offset management as well as for Samza use-cases.&lt;/p&gt;</comment>
                            <comment id="14316735" author="jkreps" created="Wed, 11 Feb 2015 18:39:10 +0000"  >&lt;p&gt;Great!&lt;/p&gt;</comment>
                            <comment id="14539856" author="jjkoshy" created="Tue, 12 May 2015 14:03:20 +0000"  >&lt;p&gt;Sorry I dropped this. I just reviewed the patch. I think it looks good, but needs a rebase. Let me know if you are swamped though and we can help with it.&lt;/p&gt;</comment>
                            <comment id="14548354" author="omkreddy" created="Mon, 18 May 2015 17:30:52 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/24214/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/24214/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14549998" author="jjkoshy" created="Tue, 19 May 2015 07:54:47 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/34397/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/34397/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14551535" author="jjkoshy" created="Wed, 20 May 2015 00:20:54 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/34397/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/34397/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14552712" author="guozhang" created="Wed, 20 May 2015 17:30:48 +0000"  >&lt;p&gt;Committed to trunk.&lt;/p&gt;

&lt;p&gt;I think we need some integration tests before feeling confident about this issue being resolved, so leave it open just for now.&lt;/p&gt;</comment>
                            <comment id="14552795" author="jjkoshy" created="Wed, 20 May 2015 18:07:53 +0000"  >&lt;p&gt;Please file a separate jira for that. Also, I&apos;m going to amend this commit with the right author information.&lt;/p&gt;</comment>
                            <comment id="14552840" author="jjkoshy" created="Wed, 20 May 2015 18:37:38 +0000"  >&lt;p&gt;I just wanted the commit to record Manikumar as author. Unfortunately our git repo does not seem to let me force push an amended commit so nm.&lt;/p&gt;</comment>
                            <comment id="15034056" author="granthenke" created="Tue, 1 Dec 2015 16:53:41 +0000"  >&lt;p&gt;With this being resolved, should we update this section of the docs? &lt;br/&gt;
&lt;a href=&quot;http://kafka.apache.org/documentation.html#design_compactionlimitations&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://kafka.apache.org/documentation.html#design_compactionlimitations&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15057052" author="omkreddy" created="Tue, 15 Dec 2015 00:26:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=granthenke&quot; class=&quot;user-hover&quot; rel=&quot;granthenke&quot;&gt;granthenke&lt;/a&gt; Yes, I will update the docs.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12732915">KAFKA-1581</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12736832">SAMZA-398</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12779926">SAMZA-586</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12722655">KAFKA-1499</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12774043">KAFKA-1944</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12735562">SAMZA-388</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12733742" name="KAFKA-1374.patch" size="20701" author="jjkoshy" created="Tue, 19 May 2015 07:54:47 +0000"/>
                            <attachment id="12659556" name="KAFKA-1374.patch" size="10652" author="omkreddy" created="Sun, 3 Aug 2014 17:41:08 +0000"/>
                            <attachment id="12660810" name="KAFKA-1374_2014-08-09_16:18:55.patch" size="12609" author="omkreddy" created="Sat, 9 Aug 2014 10:52:14 +0000"/>
                            <attachment id="12661240" name="KAFKA-1374_2014-08-12_22:23:06.patch" size="12832" author="omkreddy" created="Tue, 12 Aug 2014 16:56:22 +0000"/>
                            <attachment id="12670732" name="KAFKA-1374_2014-09-23_21:47:12.patch" size="17159" author="omkreddy" created="Tue, 23 Sep 2014 16:20:20 +0000"/>
                            <attachment id="12672767" name="KAFKA-1374_2014-10-03_18:49:16.patch" size="17448" author="omkreddy" created="Fri, 3 Oct 2014 13:22:26 +0000"/>
                            <attachment id="12672770" name="KAFKA-1374_2014-10-03_19:17:17.patch" size="16922" author="omkreddy" created="Fri, 3 Oct 2014 13:50:22 +0000"/>
                            <attachment id="12692926" name="KAFKA-1374_2015-01-18_00:19:21.patch" size="18466" author="omkreddy" created="Sat, 17 Jan 2015 18:52:00 +0000"/>
                            <attachment id="12733584" name="KAFKA-1374_2015-05-18_22:55:48.patch" size="20941" author="omkreddy" created="Mon, 18 May 2015 17:30:50 +0000"/>
                            <attachment id="12734003" name="KAFKA-1374_2015-05-19_17:20:44.patch" size="40449" author="jjkoshy" created="Wed, 20 May 2015 00:20:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385586</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 49 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ufcf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385852</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>guozhang</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>