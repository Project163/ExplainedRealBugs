<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:39:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-16541] Potential leader epoch checkpoint file corruption on OS crash</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-16541</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Pointed out by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; on &lt;a href=&quot;https://github.com/apache/kafka/pull/14242#discussion_r1556161125&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;GitHub&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/14242&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;A patch for KAFKA-15046&lt;/a&gt; got rid of fsync of leader-epoch ckeckpoint file in some path for performance reason.&lt;/p&gt;

&lt;p&gt;However, since now checkpoint file is flushed to the device asynchronously by OS, content would corrupt if OS suddenly crashes (e.g. by power failure, kernel panic) in the middle of flush.&lt;/p&gt;

&lt;p&gt;Corrupted checkpoint file could prevent Kafka broker to start-up&lt;/p&gt;</description>
                <environment></environment>
        <key id="13575579">KAFKA-16541</key>
            <summary>Potential leader epoch checkpoint file corruption on OS crash</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ocadaruma">Haruki Okada</assignee>
                                    <reporter username="ocadaruma">Haruki Okada</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Apr 2024 01:06:37 +0000</created>
                <updated>Tue, 16 Jul 2024 07:18:30 +0000</updated>
                            <resolved>Thu, 6 Jun 2024 06:11:44 +0000</resolved>
                                    <version>3.7.0</version>
                                    <fixVersion>3.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17836717" author="junrao" created="Fri, 12 Apr 2024 17:42:59 +0000"  >&lt;p&gt;Thanks for filing the jira, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ocadaruma&quot; class=&quot;user-hover&quot; rel=&quot;ocadaruma&quot;&gt;ocadaruma&lt;/a&gt; !&#160; Since this is a regression, it would be useful to have this fixed in 3.8.0 and 3.7.1.&lt;/p&gt;

&lt;p&gt;One way to fix it is to (1) change LeaderEpochFileCache.truncateFromEnd and LeaderEpochFileCache.truncateFromStart to only write to memory without writing to the checkpoint file, (2) change the implementation of &lt;a href=&quot;https://github.com/apache/kafka/blob/3.6.0/core/src/main/scala/kafka/log/UnifiedLog.scala#L681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;renamDir&lt;/a&gt; so that it doesn&apos;t reinitialize from the file and just change the Path of the backing CheckpointFile.&lt;/p&gt;</comment>
                            <comment id="17842783" author="junrao" created="Wed, 1 May 2024 21:19:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ocadaruma&quot; class=&quot;user-hover&quot; rel=&quot;ocadaruma&quot;&gt;ocadaruma&lt;/a&gt; : Will you be able to work on this soon? The 3.8.0 code freeze is getting close. Thanks.&lt;/p&gt;</comment>
                            <comment id="17842816" author="ocadaruma" created="Thu, 2 May 2024 01:15:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; Yes.&lt;br/&gt;
My concern now is only changing renameDir may not be enough, so I&apos;m trying to figure out if we can fix in another way without checking all call paths&lt;/p&gt;</comment>
                            <comment id="17847684" author="ocadaruma" created="Sun, 19 May 2024 14:28:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; Hi, i&apos;ve just submitted a patch. PTAL&lt;/p&gt;</comment>
                            <comment id="17852640" author="junrao" created="Thu, 6 Jun 2024 06:11:44 +0000"  >&lt;p&gt;Merged the PR to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1olb4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>