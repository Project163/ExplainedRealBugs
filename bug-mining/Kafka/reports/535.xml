<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:41:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1681] Newly elected KafkaController might not start deletion of pending topics</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1681</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;As part of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1663&quot; title=&quot;Controller unable to shutdown after a soft failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1663&quot;&gt;&lt;del&gt;KAFKA-1663&lt;/del&gt;&lt;/a&gt; deleteTopicStateChanged.set(true) is removed from start(). This will cause newly elected kafka controller not to process the existing delete topic requests.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12746415">KAFKA-1681</key>
            <summary>Newly elected KafkaController might not start deletion of pending topics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sriharsha">Harsha</assignee>
                                    <reporter username="sriharsha">Harsha</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Oct 2014 14:43:13 +0000</created>
                <updated>Thu, 9 Oct 2014 21:35:41 +0000</updated>
                            <resolved>Thu, 9 Oct 2014 21:35:40 +0000</resolved>
                                                    <fixVersion>0.8.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14163604" author="sriharsha" created="Wed, 8 Oct 2014 15:13:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nehanarkhede&quot; class=&quot;user-hover&quot; rel=&quot;nehanarkhede&quot;&gt;nehanarkhede&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt;&lt;br/&gt;
adding this code to TopicDeletionManager.start method should cover this issue right?&lt;br/&gt;
      if (topicsToBeDeleted.size &amp;gt; 0)&lt;br/&gt;
        resumeTopicDeletionThread()&lt;/p&gt;</comment>
                            <comment id="14164710" author="junrao" created="Thu, 9 Oct 2014 04:27:30 +0000"  >&lt;p&gt;Yes, or just set deleteTopicStateChanged to true instead of calling resumeTopicDeletionThread().&lt;/p&gt;</comment>
                            <comment id="14165251" author="nehanarkhede" created="Thu, 9 Oct 2014 15:20:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sriharsha&quot; class=&quot;user-hover&quot; rel=&quot;sriharsha&quot;&gt;sriharsha&lt;/a&gt;, adding that to the end of the start() API might unnecessarily start the thread, possibly have it wait and then signal it. I think it is easier to just set deleteTopicStateChanged to true before starting the thread. Also, I thought about the other possible race condition where the controller completes starting the delete topic manager and effectively the delete topic thread and a watch related to delete topic fires before the delete topic thread waits on the condition. The controller watch would then call resumeTopicDeletion which would signal a non waiting thread. That seemed like a problem at first, but it&apos;s not since when the thread invokes awaitTopicDeletion.., it would find the deleteTopicStateChanged to be true, so it will proceed to acting on topicsToBeDeleted.&lt;/p&gt;

&lt;p&gt;In short, the previous code was right &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14165296" author="sriharsha" created="Thu, 9 Oct 2014 15:58:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nehanarkhede&quot; class=&quot;user-hover&quot; rel=&quot;nehanarkhede&quot;&gt;nehanarkhede&lt;/a&gt; can you clarify bit on &quot;In short, the previous code was right &quot; . You mean code before &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1663&quot; title=&quot;Controller unable to shutdown after a soft failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1663&quot;&gt;&lt;del&gt;KAFKA-1663&lt;/del&gt;&lt;/a&gt;. &lt;br/&gt;
That code only waits till the thread starts running since the condition is&lt;br/&gt;
while(!deleteTopicsThread.isRunning.get() &amp;amp;&amp;amp; !deleteTopicStateChanged.compareAndSet(true, false)) {&lt;br/&gt;
once thread starts and if there is resumeTopicsThread() invoked thread never waits because &quot;!deleteTopicsThread.isRunning.get()&quot;. This causes a problem when deleteTopicsThread.shudown() is called . I believe the intention is to wait for notifications on delete topics and resume thread. With the above condition it won&apos;t wait and keeps running. &lt;/p&gt;</comment>
                            <comment id="14165356" author="junrao" created="Thu, 9 Oct 2014 16:49:25 +0000"  >&lt;p&gt;Sriharsha,&lt;/p&gt;

&lt;p&gt;I think what Neha meant is that in kafka-1663, the change of the condition in awaitTopicDeletionNotification() is correct. However, kafka-1663 also removed setting deleteTopicStateChanged to true in start() and is causing a new problem. We can just add the following code in start() before the deleteTopicsThread is started.&lt;br/&gt;
if (topicsToBeDeleted.size &amp;gt; 0)&lt;br/&gt;
  deleteTopicStateChanged.set(true)&lt;/p&gt;</comment>
                            <comment id="14165428" author="nehanarkhede" created="Thu, 9 Oct 2014 17:49:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sriharsha&quot; class=&quot;user-hover&quot; rel=&quot;sriharsha&quot;&gt;sriharsha&lt;/a&gt;, sorry for being unclear. I meant that the regression introduced by part of the &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1663&quot; title=&quot;Controller unable to shutdown after a soft failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1663&quot;&gt;&lt;del&gt;KAFKA-1663&lt;/del&gt;&lt;/a&gt; patch where you removed deleteTopicStateChanged.set(true) needs to be reverted. The other part of the patch where you changed the while loop condition is correct. So the patch for this JIRA is a one liner fix where we add that change(deleteTopicStateChanged.set(true)) back in. &lt;/p&gt;</comment>
                            <comment id="14165633" author="sriharsha" created="Thu, 9 Oct 2014 19:53:07 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/26516/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/26516/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14165793" author="junrao" created="Thu, 9 Oct 2014 21:35:41 +0000"  >&lt;p&gt;Thanks for the patch. +1. Committed to both trunk and 0.8.2.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12745270">KAFKA-1663</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12673979" name="KAFKA-1681.patch" size="1023" author="sriharsha" created="Thu, 9 Oct 2014 19:53:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20vvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>nehanarkhede</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>