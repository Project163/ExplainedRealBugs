<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:30:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-12635] Mirrormaker 2 offset sync is incorrect if the target partition is empty</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-12635</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;This bug occurs when using Mirrormaker with &quot;sync.group.offsets.enabled = true&quot;.&lt;/p&gt;

&lt;p&gt;If a source partition is empty, but the source consumer group&apos;s offset for that partition is non-zero, then Mirrormaker sets the target consumer group&apos;s offset for that partition to the literal, not translated, offset of the source consumer group. This state can be reached if the source consumer group consumed some records that were now deleted (like by a retention policy), or if Mirrormaker replication is set to start at &quot;latest&quot;. This bug causes the target consumer group&apos;s lag for that partition to be negative and breaks offset sync for that partition until lag is positive.&lt;/p&gt;

&lt;p&gt;The correct behavior when the source partition is empty would be to set the target offset to the translated offset, not literal offset, which in this case would always be 0.&#160;&lt;/p&gt;

&lt;p&gt;Original email thread on this issue:&#160;&lt;a href=&quot;https://lists.apache.org/thread.html/r7c54ee5f57227367b911d4abffa72781772d8dd3b72d75eb65ee19f7%40%3Cusers.kafka.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/r7c54ee5f57227367b911d4abffa72781772d8dd3b72d75eb65ee19f7%40%3Cusers.kafka.apache.org%3E&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13370477">KAFKA-12635</key>
            <summary>Mirrormaker 2 offset sync is incorrect if the target partition is empty</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mimaison">Mickael Maison</assignee>
                                    <reporter username="fyi">Frank Yi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Apr 2021 19:56:57 +0000</created>
                <updated>Mon, 23 Jan 2023 11:15:00 +0000</updated>
                            <resolved>Mon, 16 May 2022 15:45:11 +0000</resolved>
                                    <version>2.7.0</version>
                                    <fixVersion>3.3.0</fixVersion>
                                    <component>mirrormaker</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="17319147" author="akaltsikis" created="Mon, 12 Apr 2021 08:17:49 +0000"  >&lt;p&gt;We are facing the same issue as well.&lt;/p&gt;</comment>
                            <comment id="17321106" author="akaltsikis" created="Wed, 14 Apr 2021 15:53:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangguo1220&quot; class=&quot;user-hover&quot; rel=&quot;yangguo1220&quot;&gt;yangguo1220&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fyi&quot; class=&quot;user-hover&quot; rel=&quot;fyi&quot;&gt;fyi&lt;/a&gt; is there any workaround to avoid this bug till it&apos;s properly fixed? &lt;/p&gt;</comment>
                            <comment id="17321170" author="yangguo1220" created="Wed, 14 Apr 2021 17:20:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akaltsikis&quot; class=&quot;user-hover&quot; rel=&quot;akaltsikis&quot;&gt;akaltsikis&lt;/a&gt;&#160;probably try to manually create a consumer group with initial offset = 0. The console consumer command will do that&lt;/p&gt;</comment>
                            <comment id="17322092" author="dragotic" created="Thu, 15 Apr 2021 11:04:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangguo1220&quot; class=&quot;user-hover&quot; rel=&quot;yangguo1220&quot;&gt;yangguo1220&lt;/a&gt;&#160;thanks for the reply! We tried your suggestion but unfortunately it didn&apos;t work. We created the consumer group with the kafka-console-consumer.sh and offset = 0. However, when the MM2 started the CheckpointConnector the offsets were translated poorly and became negative again.&lt;/p&gt;</comment>
                            <comment id="17337894" author="yangguo1220" created="Sat, 1 May 2021 23:02:13 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dragotic&quot; class=&quot;user-hover&quot; rel=&quot;dragotic&quot;&gt;dragotic&lt;/a&gt;&#160;could you please elaborate on how you can re-produce the issue step-by-step?&#160;&lt;/p&gt;</comment>
                            <comment id="17337896" author="yangguo1220" created="Sat, 1 May 2021 23:16:39 +0000"  >&lt;p&gt;&amp;gt;&#160;This state can be reached if the source consumer group consumed some records that were now deleted (like by a retention policy), or if Mirrormaker replication is set to start at &quot;latest&quot;.&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fyi&quot; class=&quot;user-hover&quot; rel=&quot;fyi&quot;&gt;fyi&lt;/a&gt;&#160;I am reading your above statement several times, and could not figure out the reproduce scenario. Do you mind to share the scenario step-by-step from a good state to a bad state? Thanks&lt;/p&gt;</comment>
                            <comment id="17339143" author="fyi" created="Tue, 4 May 2021 16:51:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangguo1220&quot; class=&quot;user-hover&quot; rel=&quot;yangguo1220&quot;&gt;yangguo1220&lt;/a&gt;&#160;I was able to repro using the steps below on 2.8.0 brokers and MM2.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Create a topic with 1 partition on the source cluster, with `retention.ms` set to something short like 10 seconds.
	&lt;ol&gt;
		&lt;li&gt;`./kafka-topics.sh --bootstrap-server $SOURCE --create --topic myTopic --config &apos;retention.ms=10000&apos;`&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;Create a consumer that consumes from the topic
	&lt;ol&gt;
		&lt;li&gt;`./kafka-console-consumer.sh --bootstrap-server $SOURCE --group myConsumer --topic myTopic`&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;Send 100 messages to the topic. These should get consumed by the consumer. Offset for this consumer on source cluster should be 100.
	&lt;ol&gt;
		&lt;li&gt;`for i in $(seq 1 100); do echo $i; done | ./kafka-console-producer.sh --bootstrap-server $SOURCE --topic myTopic`&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;Wait until the retention policy deletes the records&lt;/li&gt;
	&lt;li&gt;Start MM2 with `source-&amp;gt;target.sync.group.offsets.enabled = true`&lt;/li&gt;
	&lt;li&gt;Observe on the target cluster that log-end-offset is 0, offset is 100, and lag is -100.
	&lt;ol&gt;
		&lt;li&gt;`./kafka-consumer-groups.sh --bootstrap-server $TARGET --describe --group myConsumer`&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17339590" author="dragotic" created="Wed, 5 May 2021 10:53:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangguo1220&quot; class=&quot;user-hover&quot; rel=&quot;yangguo1220&quot;&gt;yangguo1220&lt;/a&gt;&#160;basically the same steps as described by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fyi&quot; class=&quot;user-hover&quot; rel=&quot;fyi&quot;&gt;fyi&lt;/a&gt;&#160;but before Step 5. We create the consumer groups on the target cluster using the kafka-console-consumer.sh command with two extra flags:&#160; --max-messages 1 --timeout-ms 6000&lt;/p&gt;</comment>
                            <comment id="17340532" author="yangguo1220" created="Fri, 7 May 2021 03:02:47 +0000"  >&lt;p&gt;pull request:&#160;&lt;a href=&quot;https://github.com/apache/kafka/pull/10644&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/10644&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17340533" author="yangguo1220" created="Fri, 7 May 2021 03:04:31 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fyi&quot; class=&quot;user-hover&quot; rel=&quot;fyi&quot;&gt;fyi&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dragotic&quot; class=&quot;user-hover&quot; rel=&quot;dragotic&quot;&gt;dragotic&lt;/a&gt;&#160;I compiled the latest trunk Kafka version with the above pull request at &lt;a href=&quot;https://github.com/ning2008wisc/kafka-trunk-binary/blob/master/kafka_2.13-3.0.0-SNAPSHOT.tgz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ning2008wisc/kafka-trunk-binary/blob/master/kafka_2.13-3.0.0-SNAPSHOT.tgz&lt;/a&gt;&#160;It looks solve the bug from my local testing and would like to hear your initial feedback. If good, I will polish and have the pull request ready for review. Thanks for your patience&#160;&lt;/p&gt;</comment>
                            <comment id="17340889" author="dragotic" created="Fri, 7 May 2021 15:21:07 +0000"  >&lt;p&gt;Hello&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangguo1220&quot; class=&quot;user-hover&quot; rel=&quot;yangguo1220&quot;&gt;yangguo1220&lt;/a&gt;, thanks for the PR. We built our own image with scala 2.12 and using your PR code and ported it to Strimzi (this is how we run MM2), and following the same steps as before we still get negative lag as seen below.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#10140;  bin ./kafka-consumer-groups.sh --bootstrap-server source-cluster:9092 --describe --group consumer-group-1

GROUP           TOPIC               PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                                     HOST            CLIENT-ID
consumer-group-1            topic_1 1          1656            1656            0               consumer-group-1-7584866df4-bgbbq-consumer-group-1-58759d7c-80e4-4ccc-8c52-bd68a6847cc3 /host_1   consumer-group-1-7584866df4-bgbbq-consumer-group-1
consumer-group-1            topic_2 1          32005209        32005209        0               consumer-group-1-7584866df4-75r7h-consumer-group-1-dc965036-5739-4399-b488-728bde48a026 /host_2   consumer-group-1-7584866df4-75r7h-consumer-group-1
consumer-group-1            topic_3 1          445             445             0               consumer-group-1-7584866df4-6bzkd-consumer-group-1-3e68ed59-2316-4168-9186-039cfcad1476 /host_3  consumer-group-1-7584866df4-6bzkd-consumer-group-1
consumer-group-1            topic_4 0          198311          198311          0               consumer-group-1-7584866df4-75r7h-consumer-group-1-aba1a270-cd9d-45e7-96a9-ac2990755e05 /host_2   consumer-group-1-7584866df4-75r7h-consumer-group-1
consumer-group-1            topic_2 0          36517046        36517055        9               consumer-group-1-7584866df4-bgbbq-consumer-group-1-6416e058-c8d6-435b-a14f-583f742ba3a4 /host_1   consumer-group-1-7584866df4-bgbbq-consumer-group-1
consumer-group-1            topic_1 0          1595            1595            0               consumer-group-1-7584866df4-c4sq6-consumer-group-1-2ec422b2-cc8f-4b0c-adae-59c016cb0666 /host_4    consumer-group-1-7584866df4-c4sq6-consumer-group-1
consumer-group-1            topic_2 2          35280609        35280613        4               consumer-group-1-7584866df4-6bzkd-consumer-group-1-19d12ff4-b486-4ea9-9eb5-23a037f11f30 /host_3  consumer-group-1-7584866df4-6bzkd-consumer-group-1
consumer-group-1            topic_2 3          33808349        33808363        14              consumer-group-1-7584866df4-c4sq6-consumer-group-1-57315540-bf27-4d99-bb38-869cd836279f /host_4    consumer-group-1-7584866df4-c4sq6-consumer-group-1
consumer-group-1            topic_1 2          1652            1652            0               consumer-group-1-7584866df4-6bzkd-consumer-group-1-9349b872-b2a4-44ba-8422-fd8f757ea017 /host_3  consumer-group-1-7584866df4-6bzkd-consumer-group-1
consumer-group-1            topic_6 1          20311           20311           0               consumer-group-1-7584866df4-c4sq6-consumer-group-1-c56dd4c4-c19d-45ea-9638-d0400f5f59d8 /host_4    consumer-group-1-7584866df4-c4sq6-consumer-group-1
consumer-group-1            topic_1 3          1720            1720            0               consumer-group-1-7584866df4-75r7h-consumer-group-1-f5b6de01-f2e1-442a-89b7-5730902392f9 /host_2   consumer-group-1-7584866df4-75r7h-consumer-group-1
consumer-group-1            topic_6 0          20252           20252           0               consumer-group-1-7584866df4-6bzkd-consumer-group-1-bca10139-17ad-4062-9008-8d3bb7a5b183 /host_3  consumer-group-1-7584866df4-6bzkd-consumer-group-1
consumer-group-1            topic_5 0          3927            3927            0               consumer-group-1-7584866df4-c4sq6-consumer-group-1-cae382b5-cb6e-48e4-8409-5c2464c6303e /host_4    consumer-group-1-7584866df4-c4sq6-consumer-group-1
consumer-group-1            topic_3 2          409             409             0               consumer-group-1-7584866df4-bgbbq-consumer-group-1-2cd4551c-5cd1-4264-b397-e3fbf695fb4f /host_1   consumer-group-1-7584866df4-bgbbq-consumer-group-1
consumer-group-1            topic_5 3          3944            3944            0               consumer-group-1-7584866df4-6bzkd-consumer-group-1-6c4872e1-51dd-46d1-b8a2-68781a6bc95c /host_3  consumer-group-1-7584866df4-6bzkd-consumer-group-1
consumer-group-1            topic_6 2          20332           20332           0               consumer-group-1-7584866df4-bgbbq-consumer-group-1-5db7872e-82d2-4da5-b888-310eeac36177 /host_1   consumer-group-1-7584866df4-bgbbq-consumer-group-1
consumer-group-1            topic_4 3          198907          198907          0               consumer-group-1-7584866df4-6bzkd-consumer-group-1-723d3e61-9aae-459d-b8fb-b22012d9e3c7 /host_3  consumer-group-1-7584866df4-6bzkd-consumer-group-1
consumer-group-1            topic_3 3          394             394             0               consumer-group-1-7584866df4-c4sq6-consumer-group-1-556bf8d7-7565-43da-8001-892d0a5c2d92 /host_4    consumer-group-1-7584866df4-c4sq6-consumer-group-1
consumer-group-1            topic_5 1          3937            3937            0               consumer-group-1-7584866df4-75r7h-consumer-group-1-1c8155fc-9f43-4dee-b788-1c6c897131f1 /host_2   consumer-group-1-7584866df4-75r7h-consumer-group-1
consumer-group-1            topic_4 1          198068          198068          0               consumer-group-1-7584866df4-bgbbq-consumer-group-1-b1e30c1b-98af-4cdf-95ea-cbceb7eecffb /host_1   consumer-group-1-7584866df4-bgbbq-consumer-group-1
consumer-group-1            topic_5 2          3891            3891            0               consumer-group-1-7584866df4-bgbbq-consumer-group-1-4f042970-58a3-4255-ba7c-6ccef11c2d7c /host_1   consumer-group-1-7584866df4-bgbbq-consumer-group-1
consumer-group-1            topic_4 2          198661          198661          0               consumer-group-1-7584866df4-c4sq6-consumer-group-1-51b2805b-9ce2-43c5-9c50-29ec4e35b227 /host_4    consumer-group-1-7584866df4-c4sq6-consumer-group-1
consumer-group-1            topic_3 0          431             431             0               consumer-group-1-7584866df4-75r7h-consumer-group-1-f757eaef-4a0e-4b36-bb6d-38b7220f7c22 /host_2   consumer-group-1-7584866df4-75r7h-consumer-group-1
consumer-group-1            topic_6 3          20222           20222           0               consumer-group-1-7584866df4-75r7h-consumer-group-1-e6962bd4-15cf-4322-bc1f-c626d32f64dd /host_2   consumer-group-1-7584866df4-75r7h-consumer-group-1




&#10140;  bin ./kafka-consumer-groups.sh --bootstrap-server target-cluster:9092 --describe --group consumer-group-1

Consumer group &lt;span class=&quot;code-quote&quot;&gt;&apos;consumer-group-1&apos;&lt;/span&gt; has no active members.

GROUP           TOPIC               PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
consumer-group-1            topic_3 3          75              35              -40             -               -               -
consumer-group-1            topic_2 3          7135020         3202517         -3932503        -               -               -
consumer-group-1            topic_5 2          492             208             -284            -               -               -
consumer-group-1            topic_3 1          82              34              -48             -               -               -
consumer-group-1            topic_2 1          4831093         1472955         -3358138        -               -               -
consumer-group-1            topic_5 0          573             165             -408            -               -               -
consumer-group-1            topic_1 0          1378            1376            -2              -               -               -
consumer-group-1            topic_6 3          4614            1472            -3142           -               -               -
consumer-group-1            topic_1 2          1422            1413            -9              -               -               -
consumer-group-1            topic_4 2          25600           3143            -22457          -               -               -
consumer-group-1            topic_6 1          4847            1857            -2990           -               -               -
consumer-group-1            topic_4 0          25939           3156            -22783          -               -               -
consumer-group-1            topic_5 3          585             170             -415            -               -               -
consumer-group-1            topic_3 2          84              38              -46             -               -               -
consumer-group-1            topic_5 1          520             158             -362            -               -               -
consumer-group-1            topic_3 0          95              41              -54             -               -               -
consumer-group-1            topic_2 2          5508653         1645293         -3863360        -               -               -
consumer-group-1            topic_2 0          6250327         1432524         -4817803        -               -               -
consumer-group-1            topic_6 2          5015            1963            -3052           -               -               -
consumer-group-1            topic_1 1          1460            1453            -7              -               -               -
consumer-group-1            topic_1 3          1467            1467            0               -               -               -
consumer-group-1            topic_4 1          25901           3084            -22817          -               -               -
consumer-group-1            topic_4 3          25988           3227            -22761          -               -               -
consumer-group-1            topic_6 0          4958            1943            -3015           -               -               -
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also, the following errors are filling up our logs:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2021-05-07 15:13:11,506 ERROR Scheduler &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; MirrorCheckpointTask caught exception in scheduled task: refreshing end offset of each topic partition pair at target cluster (org.apache.kafka.connect.mirror.Scheduler) [Scheduler &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; MirrorCheckpointTask-refreshing end offset of each topic partition pair at target cluster]
org.apache.kafka.common.errors.InvalidGroupIdException: To use the group management or offset commit APIs, you must provide a valid group.id in the consumer configuration.

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We are ready to test any other code change on your PR.&lt;/p&gt;

&lt;p&gt;Thank you again.&lt;/p&gt;

&lt;p&gt;Edit: this topic was not empty, but the behavior was similar for empty topics as well&lt;/p&gt;</comment>
                            <comment id="17340917" author="yangguo1220" created="Fri, 7 May 2021 16:21:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dragotic&quot; class=&quot;user-hover&quot; rel=&quot;dragotic&quot;&gt;dragotic&lt;/a&gt;&#160;I see, I probably missed your comment &quot;but before Step 5.&#160;We create the consumer groups on the target cluster using the kafka-console-consumer.sh command with two extra flags:&#160; --max-messages 1 --timeout-ms 6000&quot;&lt;/p&gt;

&lt;p&gt;I am updating the PR and testing it again&lt;/p&gt;</comment>
                            <comment id="17341025" author="fyi" created="Fri, 7 May 2021 20:38:31 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangguo1220&quot; class=&quot;user-hover&quot; rel=&quot;yangguo1220&quot;&gt;yangguo1220&lt;/a&gt;, I will test it this weekend&lt;/p&gt;</comment>
                            <comment id="17341105" author="yangguo1220" created="Sat, 8 May 2021 02:54:54 +0000"  >&lt;p&gt;updated and tested the PR&lt;/p&gt;</comment>
                            <comment id="17342302" author="fyi" created="Tue, 11 May 2021 05:34:34 +0000"  >&lt;p&gt;fix works for me! Thanks&lt;/p&gt;</comment>
                            <comment id="17342308" author="yangguo1220" created="Tue, 11 May 2021 05:45:30 +0000"  >&lt;p&gt;great, thanks for the feedback. I will proceed to finalize the pull request.&#160;&lt;/p&gt;</comment>
                            <comment id="17342374" author="akaltsikis" created="Tue, 11 May 2021 07:32:31 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangguo1220&quot; class=&quot;user-hover&quot; rel=&quot;yangguo1220&quot;&gt;yangguo1220&lt;/a&gt;,&lt;br/&gt;
Thanks for your fix.&lt;br/&gt;
Yesterday we (with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dragotic&quot; class=&quot;user-hover&quot; rel=&quot;dragotic&quot;&gt;dragotic&lt;/a&gt;&#160;) have also tested your PR and fortunately right now we don&apos;t have any negative consumer lags in the target cluster&lt;br/&gt;
 :tada:&lt;br/&gt;
Thus we believe that the fix worked as it should.&lt;/p&gt;

&lt;p&gt;BTW can we help you backport this fix to 2.7.2 ( i just saw that 2.7.1 was released 22 hours ago &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;) &amp;amp; to 2.8.1 ?&lt;/p&gt;</comment>
                            <comment id="17343028" author="yangguo1220" created="Wed, 12 May 2021 06:22:10 +0000"  >&lt;p&gt;backport is a great point. I guess the review cycle will probably take 3-4 weeks at most, so I will let the committer/reviewer know the backport option and see what is available from their point of view.&lt;/p&gt;</comment>
                            <comment id="17363502" author="dragotic" created="Tue, 15 Jun 2021 09:24:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ryannedolan&quot; class=&quot;user-hover&quot; rel=&quot;ryannedolan&quot;&gt;ryannedolan&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mimaison&quot; class=&quot;user-hover&quot; rel=&quot;mimaison&quot;&gt;mimaison&lt;/a&gt; Hey there, sorry for pinging but do you believe you have time to take a look at the PR that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangguo1220&quot; class=&quot;user-hover&quot; rel=&quot;yangguo1220&quot;&gt;yangguo1220&lt;/a&gt; has opened?? &lt;/p&gt;

&lt;p&gt;thanks in advance! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17363515" author="mimaison" created="Tue, 15 Jun 2021 09:46:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dragotic&quot; class=&quot;user-hover&quot; rel=&quot;dragotic&quot;&gt;dragotic&lt;/a&gt; Sorry for the delay. I&apos;ve prioritised other tasks recently but I hope to take a look at it soon. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangguo1220&quot; class=&quot;user-hover&quot; rel=&quot;yangguo1220&quot;&gt;yangguo1220&lt;/a&gt; for raising a PR&lt;/p&gt;</comment>
                            <comment id="17363520" author="dragotic" created="Tue, 15 Jun 2021 09:54:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mimaison&quot; class=&quot;user-hover&quot; rel=&quot;mimaison&quot;&gt;mimaison&lt;/a&gt; No worries, I can totally understand it. Thanks for replying promptly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="17387184" author="dragotic" created="Mon, 26 Jul 2021 09:12:06 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mimaison&quot; class=&quot;user-hover&quot; rel=&quot;mimaison&quot;&gt;mimaison&lt;/a&gt;, any chance you took a look at this bug? Thank you &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17489631" author="mimaison" created="Wed, 9 Feb 2022 15:17:46 +0000"  >&lt;p&gt;Looking at this again (sorry for the delay).&lt;/p&gt;

&lt;p&gt;The offset on the target being negative should not have a functional impact on the consumer. The offset is &quot;out of range&quot; so the auto.offset.reset configuration will be used to find a new valid position. As there are no records in the target partition, whether the consumer resets to latest or earliest will have make no difference and it will set its position to 0.&lt;/p&gt;

&lt;p&gt;But I understand it may be annoying in terms of metrics. I guess in theory it could also lead to records being skipped if suddenly records are produced to the source cluster and we start a consumer with auto.offset.reset to latest on the target cluster before MirrorMaker is able to emit a new checkpoint/commit offsets.&lt;/p&gt;

&lt;p&gt;I think a better alternative than resetting the offset to 0 is to actually not commit any offsets in the target cluster until some records have been mirrored. &lt;/p&gt;
</comment>
                            <comment id="17490408" author="mimaison" created="Thu, 10 Feb 2022 17:58:51 +0000"  >&lt;p&gt;Thinking about this further, one thing I missed yesterday is that the offsets in the target cluster is updated only if the new computed value is larger, see &lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorCheckpointTask.java#L277-L284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/connect/mirror/src/main/java/org/apache/kafka/connect/mirror/MirrorCheckpointTask.java#L277-L284&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This is problematic because until the gap is closed, the checkpoint connector will not update the offsets in the target cluster.&lt;/p&gt;</comment>
                            <comment id="17627482" author="JIRAUSER297821" created="Wed, 2 Nov 2022 06:26:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fyi&quot; class=&quot;user-hover&quot; rel=&quot;fyi&quot;&gt;fyi&lt;/a&gt;&#160; / &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mimaison&quot; class=&quot;user-hover&quot; rel=&quot;mimaison&quot;&gt;mimaison&lt;/a&gt;&#160; I just used the Kafka 3.3.1 release to run mirror-maker(which should have this fix), to mirror from existing cluster to a new cluster and i can still see&#160; negative lags for various consumer group.  &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13051697/13051697_image-2022-11-02-11-53-33-329.png&quot; height=&quot;198&quot; width=&quot;1067&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17642058" author="mimaison" created="Thu, 1 Dec 2022 17:18:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chetan-pandey&quot; class=&quot;user-hover&quot; rel=&quot;chetan-pandey&quot;&gt;chetan-pandey&lt;/a&gt; Have these negative offsets persisted ? Are you sure new commits for these partitions have happened?&lt;/p&gt;</comment>
                            <comment id="17644633" author="JIRAUSER297821" created="Thu, 8 Dec 2022 07:15:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mimaison&quot; class=&quot;user-hover&quot; rel=&quot;mimaison&quot;&gt;mimaison&lt;/a&gt;&#160; No, these negative offsets change over the time as new messages come in the particular partitions.&#160; But this would be a problem for someone doing a new replication setup in an existing cluster. Can&apos;t these be set to 0 instead of negative in such scenarios ?&#160;&lt;/p&gt;</comment>
                            <comment id="17644810" author="mimaison" created="Thu, 8 Dec 2022 13:33:29 +0000"  >&lt;p&gt;The fix only ensured new offsets will be correct. If you have existing negative offsets, you either have to wait till a new offset is emitted or you can manually update them using the Admin client or the kafka-consumer-groups tool for example.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13411494">KAFKA-13452</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13051697" name="image-2022-11-02-11-53-33-329.png" size="278484" author="chetan-pandey" created="Wed, 2 Nov 2022 06:23:35 +0000"/>
                            <attachment id="13051699" name="image-2022-11-02-11-56-34-994.png" size="219055" author="chetan-pandey" created="Wed, 2 Nov 2022 06:26:36 +0000"/>
                            <attachment id="13051698" name="screenshot-1.png" size="219055" author="chetan-pandey" created="Wed, 2 Nov 2022 06:25:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0poq8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>yangguo1220</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>