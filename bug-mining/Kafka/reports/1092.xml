<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:54:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2948] Kafka producer does not cope well with topic deletions</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2948</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Kafka producer gets metadata for topics when send is invoked and thereafter it attempts to keep the metadata up-to-date without any explicit requests from the client. This works well in static environments, but when topics are added or deleted, list of topics in Metadata grows but never shrinks. Apart from being a memory leak, this results in constant requests for metadata for deleted topics.&lt;/p&gt;

&lt;p&gt;We are running into this issue with the Confluent REST server where topic deletion from tests are filling up logs with warnings about unknown topics. Auto-create is turned off in our Kafka cluster.&lt;/p&gt;

&lt;p&gt;I am happy to provide a fix, but am not sure what the right fix is. Does it make sense to remove topics from the metadata list when UNKNOWN_TOPIC_OR_PARTITION response is received if there are no outstanding sends? It doesn&apos;t look very straightforward to do this, so any alternative suggestions are welcome.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12918982">KAFKA-2948</key>
            <summary>Kafka producer does not cope well with topic deletions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rsivaram">Rajini Sivaram</assignee>
                                    <reporter username="rsivaram">Rajini Sivaram</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Dec 2015 14:13:27 +0000</created>
                <updated>Mon, 13 Mar 2017 18:42:23 +0000</updated>
                            <resolved>Mon, 6 Jun 2016 18:58:04 +0000</resolved>
                                    <version>0.9.0.0</version>
                                    <fixVersion>0.10.1.0</fixVersion>
                                    <component>producer </component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="15045372" author="becket_qin" created="Mon, 7 Dec 2015 18:07:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt; As you pointed out we never remove the topics set in producer metadata. I am not sure if removing the topic from the set when we see UNKNOWN_TOPIC_OR_PARTITION error code is the right way to fix this, because UNKNOWN_TOPIC_OR_PARTITION can also occur in other cases such as partition reassignment, the producer is supposed to retry in this case. &lt;/p&gt;

&lt;p&gt;Maybe a TTL is a better solution here. e.g. If the producer hasn&apos;t sent data to a particular topic since last metadata refresh, we can remove the topic from metadata topic set on next metadata refresh.&lt;/p&gt;</comment>
                            <comment id="15046724" author="rsivaram" created="Tue, 8 Dec 2015 10:49:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt; Thank you for your feedback. The fix that we are testing at the moment removes topics with `UNKNOWN_TOPIC_OR_PARTITION` error from the metadata set when the error is received in a response, but re-adds it when metadata is requested for the topic (eg. producer waiting for metadata to send a message). This ensures that the request is retried when required, but not when the topic is no longer in use. &lt;/p&gt;

&lt;p&gt;TTL sounds like a better option to remove not just deleted topics, but also any topic that is no longer being used. My only concern is that deleted topics would remain in the list for a longer period of time with a lot of warnings in the logs as metadata requests are retried. I could combine the current fix and TTL if required to avoid this, but I will try out TTL on its own first with the REST service and see how that goes. &lt;/p&gt;</comment>
                            <comment id="15047220" author="mgharat" created="Tue, 8 Dec 2015 18:38:18 +0000"  >&lt;p&gt;Adding TTL would mean another user exposed config. Can we not use the number of times we got &quot;UNKNOWN_TOPIC_OR_PARTITION&quot; and then get rid of the  topic.&lt;/p&gt;</comment>
                            <comment id="15047326" author="becket_qin" created="Tue, 8 Dec 2015 19:24:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgharat&quot; class=&quot;user-hover&quot; rel=&quot;mgharat&quot;&gt;mgharat&lt;/a&gt; I think TTL should not be a config but simply an internal mechanism. User should not care about this at all.&lt;/p&gt;</comment>
                            <comment id="15047349" author="rsivaram" created="Tue, 8 Dec 2015 19:40:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgharat&quot; class=&quot;user-hover&quot; rel=&quot;mgharat&quot;&gt;mgharat&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt; The code that I am testing at the moment uses the current config `metadata.max.age.ms`. If no messages are sent to a topic for this interval, then the topic is removed from the metadata set. Subsequent send will add it back to the set. I am also marking the topic for delete if a send fails because no metadata was available for a topic, to limit the number of retries for deleted topics. Will submit a PR later today for review.&lt;/p&gt;</comment>
                            <comment id="15047782" author="githubbot" created="Wed, 9 Dec 2015 00:35:32 +0000"  >&lt;p&gt;GitHub user rajinisivaram opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/645&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/645&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2948&quot; title=&quot;Kafka producer does not cope well with topic deletions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2948&quot;&gt;&lt;del&gt;KAFKA-2948&lt;/del&gt;&lt;/a&gt;: Remove unused topics from producer metadata set&lt;/p&gt;

&lt;p&gt;    If no messages are sent to a topic during the last refresh interval or if UNKNOWN_TOPIC_OR_PARTITION error is received, remove the topic from the metadata list. Topics are added to the list on the next attempt to send a message to the topic.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rajinisivaram/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rajinisivaram/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2948&quot; title=&quot;Kafka producer does not cope well with topic deletions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2948&quot;&gt;&lt;del&gt;KAFKA-2948&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/645.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/645.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #645&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f7e40e5ce515d700e8cc7ab02a0f16141fa14f67&lt;br/&gt;
Author: rsivaram &amp;lt;rsivaram@uk.ibm.com&amp;gt;&lt;br/&gt;
Date:   2015-12-09T00:16:18Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2948&quot; title=&quot;Kafka producer does not cope well with topic deletions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2948&quot;&gt;&lt;del&gt;KAFKA-2948&lt;/del&gt;&lt;/a&gt;: Remove unused topics from producer metadata set&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15048101" author="guozhang" created="Wed, 9 Dec 2015 05:59:48 +0000"  >&lt;p&gt;Assigning to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt; to review.&lt;/p&gt;</comment>
                            <comment id="15134705" author="ijuma" created="Fri, 5 Feb 2016 18:57:22 +0000"  >&lt;p&gt;Setting target as 0.9.1.0 as 0.9.0.1 will be released very soon and we want to be careful about last-minute regressions.&lt;/p&gt;</comment>
                            <comment id="15316988" author="githubbot" created="Mon, 6 Jun 2016 18:56:35 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/645&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/645&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13014333">SPARK-18057</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12952796">KAFKA-3450</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13018661">KAFKA-4385</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pevb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>ewencp</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>