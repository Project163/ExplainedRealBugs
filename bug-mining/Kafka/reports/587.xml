<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:42:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-742] Existing directories under the Kafka data directory without any data cause process to not start</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-742</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I incorrectly setup the configuration file to have the metrics go to /var/kafka/metrics while the logs were in /var/kafka. On startup I received the following error then the daemon exited:&lt;/p&gt;

&lt;p&gt;30   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  kafka.log.LogManager  - &lt;span class=&quot;error&quot;&gt;&amp;#91;Log Manager on Broker 0&amp;#93;&lt;/span&gt; Loading log &apos;metrics&apos;&lt;br/&gt;
32   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; FATAL kafka.server.KafkaServerStartable  - Fatal error during KafkaServerStable startup. Prepare to shutdown&lt;br/&gt;
java.lang.StringIndexOutOfBoundsException: String index out of range: -1&lt;br/&gt;
        at java.lang.String.substring(String.java:1937)&lt;br/&gt;
        at kafka.log.LogManager.kafka$log$LogManager$$parseTopicPartitionName(LogManager.scala:335)&lt;br/&gt;
        at kafka.log.LogManager$$anonfun$loadLogs$1$$anonfun$apply$3.apply(LogManager.scala:112)&lt;br/&gt;
        at kafka.log.LogManager$$anonfun$loadLogs$1$$anonfun$apply$3.apply(LogManager.scala:109)&lt;br/&gt;
        at scala.collection.IndexedSeqOptimized$class.foreach(IndexedSeqOptimized.scala:34)&lt;br/&gt;
        at scala.collection.mutable.ArrayOps.foreach(ArrayOps.scala:34)&lt;br/&gt;
        at kafka.log.LogManager$$anonfun$loadLogs$1.apply(LogManager.scala:109)&lt;br/&gt;
        at kafka.log.LogManager$$anonfun$loadLogs$1.apply(LogManager.scala:101)&lt;br/&gt;
        at scala.collection.IndexedSeqOptimized$class.foreach(IndexedSeqOptimized.scala:34)&lt;br/&gt;
        at scala.collection.mutable.WrappedArray.foreach(WrappedArray.scala:32)&lt;br/&gt;
        at kafka.log.LogManager.loadLogs(LogManager.scala:101)&lt;br/&gt;
        at kafka.log.LogManager.&amp;lt;init&amp;gt;(LogManager.scala:62)&lt;br/&gt;
        at kafka.server.KafkaServer.startup(KafkaServer.scala:59)&lt;br/&gt;
        at kafka.server.KafkaServerStartable.startup(KafkaServerStartable.scala:34)&lt;br/&gt;
        at kafka.Kafka$.main(Kafka.scala:46)&lt;br/&gt;
        at kafka.Kafka.main(Kafka.scala)&lt;br/&gt;
34   &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; INFO  kafka.server.KafkaServer  - &lt;span class=&quot;error&quot;&gt;&amp;#91;Kafka Server 0&amp;#93;&lt;/span&gt;, shutting down&lt;/p&gt;

&lt;p&gt;This was on a brand new cluster so no data or metrics logs existed yet.&lt;/p&gt;

&lt;p&gt;Moving the metrics to their own directory (not a child of the logs) allowed the daemon to start.&lt;/p&gt;

&lt;p&gt;Took a few minutes to figure out what was wrong.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12629756">KAFKA-742</key>
            <summary>Existing directories under the Kafka data directory without any data cause process to not start</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="singhashish">Ashish Singh</assignee>
                                    <reporter username="chriscurtin">Chris Curtin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Jan 2013 19:27:02 +0000</created>
                <updated>Fri, 20 May 2016 21:23:00 +0000</updated>
                            <resolved>Wed, 17 Dec 2014 04:34:41 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.9.0.0</fixVersion>
                                    <component>config</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="13565696" author="jkreps" created="Tue, 29 Jan 2013 19:34:54 +0000"  >&lt;p&gt;Getting an error is not really bad since we assume we have control of everything under the log directory (it is obviously hard for us to distinguish a log directory from a non-log directory and silently ignoring could be worse than an error). So I think there are two problems here:&lt;br/&gt;
1. Are we enabling metrics logging by default? Are we creating the metrics dir even if metrics logging is not enabled. This needs to be sanity checked...&lt;br/&gt;
2. If there are bogus directories under the log directory I think the right thing to do is to give a better error message (something like &quot;Found directory /x/y/z, &apos;z&apos; is not in the form topic-partition&quot;).&lt;/p&gt;

&lt;p&gt; If you agree with those fixes I will take this on.&lt;/p&gt;</comment>
                            <comment id="13565709" author="chriscurtin" created="Tue, 29 Jan 2013 19:43:44 +0000"  >&lt;p&gt;Thanks Jay, a better error is a good idea for this. &lt;/p&gt;</comment>
                            <comment id="14230737" author="singhashish" created="Tue, 2 Dec 2014 00:11:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkreps&quot; class=&quot;user-hover&quot; rel=&quot;jkreps&quot;&gt;jkreps&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chriscurtin&quot; class=&quot;user-hover&quot; rel=&quot;chriscurtin&quot;&gt;chriscurtin&lt;/a&gt;, I would like to take a stab at this. Assigning it to myself.&lt;/p&gt;</comment>
                            <comment id="14243017" author="singhashish" created="Thu, 11 Dec 2014 19:44:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkreps&quot; class=&quot;user-hover&quot; rel=&quot;jkreps&quot;&gt;jkreps&lt;/a&gt; Now that I actually started to work on this. I re-read your comment above and realized you mentioned that you intend to work on this. I missed the line when I assigned the JIRA to myself. My apologies for the same. Kindly feel free to take it on and assign it to yourself. However, if you are not planning to work on this, then let me know and then I can work on this. My apologies for the confusion.&lt;/p&gt;</comment>
                            <comment id="14243242" author="jkreps" created="Thu, 11 Dec 2014 22:10:44 +0000"  >&lt;p&gt;No, I said that but then never did any work. Definitely take it!&lt;/p&gt;</comment>
                            <comment id="14243517" author="singhashish" created="Fri, 12 Dec 2014 00:56:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkreps&quot; class=&quot;user-hover&quot; rel=&quot;jkreps&quot;&gt;jkreps&lt;/a&gt; ok, I am on it then &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14246074" author="singhashish" created="Sun, 14 Dec 2014 19:33:53 +0000"  >&lt;p&gt;Created RB: &lt;a href=&quot;https://reviews.apache.org/r/29030/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/29030/&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Are we enabling metrics logging by default? Are we creating the metrics dir even if metrics logging is not enabled. This needs to be sanity checked...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;metrics dir is created by a metrics reporter during its init, which is called by &lt;tt&gt;KafkaMetricsReporter&lt;/tt&gt; only if the reported is registered.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If there are bogus directories under the log directory I think the right thing to do is to give a better error message (something like &quot;Found directory /x/y/z, &apos;z&apos; is not in the form topic-partition&quot;)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;tt&gt;parseTopicPartitionName&lt;/tt&gt; only gets log directory name and not the path. I can make changes for it to receive directory path rather than just the name. However, I think just specifying that dir &quot;some_dir&quot; is not in the form topic-partition should be good enough. Let me know if you guys think otherwise. Other possible solution is I can catch the exception thrown by &lt;tt&gt;parseTopicPartitionName&lt;/tt&gt; in the caller, which has the path for dir, and throw exception with full path of the dir.&lt;/p&gt;</comment>
                            <comment id="14246883" author="gwenshap" created="Mon, 15 Dec 2014 17:40:40 +0000"  >&lt;p&gt;I think we need to print the full path to the directory we can&apos;t parse - I&apos;ve met at least two customers who installed Kafka through a distribution and had no idea where their Kafka log directory is.&lt;/p&gt;

&lt;p&gt;Also, I&apos;d add something to the error message along lines of &quot;If a directory does not contain Kafka topic data it should not exist in Kafka&apos;s log directory. Please move it elsewhere.&quot;&lt;/p&gt;
</comment>
                            <comment id="14248621" author="singhashish" created="Tue, 16 Dec 2014 18:29:28 +0000"  >&lt;p&gt;Makes sense. Updated patch.&lt;/p&gt;</comment>
                            <comment id="14249452" author="nehanarkhede" created="Wed, 17 Dec 2014 04:34:41 +0000"  >&lt;p&gt;Thanks for the patch, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=singhashish&quot; class=&quot;user-hover&quot; rel=&quot;singhashish&quot;&gt;singhashish&lt;/a&gt;. Pushed to trunk&lt;/p&gt;</comment>
                            <comment id="14261438" author="noslowerdna" created="Tue, 30 Dec 2014 20:08:12 +0000"  >&lt;p&gt;Just a side note, we&apos;ve seen this problem on Redhat Linux when the OS creates a special directory named &quot;lost+found&quot; in a mounted filesystem.&lt;/p&gt;</comment>
                            <comment id="15294250" author="dbtucker" created="Fri, 20 May 2016 21:23:00 +0000"  >&lt;p&gt;And the &quot;lost+found&quot; issue still exists in Kafka 0.9 even when a non-root user is given ownership of the mount point.   There is a workaround : create a single sub-directory and point to that.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12687528" name="KAFKA-742.1.patch" size="5316" author="singhashish" created="Tue, 16 Dec 2014 18:29:28 +0000"/>
                            <attachment id="12687132" name="KAFKA-742.patch" size="3683" author="singhashish" created="Sun, 14 Dec 2014 19:36:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310252</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 26 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hjkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310597</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>