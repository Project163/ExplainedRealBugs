<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:05:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6319] kafka-acls regression for comma characters (and maybe other characters as well)</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6319</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;As of version 1.0.0, kafka-acls.sh no longer recognizes my ACLs stored in zookeeper. I am using SSL and the default principle builder class. My principle name contains a comma. Ex:&lt;br/&gt;
&quot;CN=myhost.mycompany.com,OU=MyOU,O=MyCompany, Inc.,ST=MyST,C=US&quot;&lt;/p&gt;

&lt;p&gt;The default principle builder uses the getName() function in javax.security.auth.x500:&lt;br/&gt;
&lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/javax/security/auth/x500/X500Principal.html#getName&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/8/docs/api/javax/security/auth/x500/X500Principal.html#getName&lt;/a&gt;&lt;br/&gt;
The documentation states &quot;The only characters in attribute values that are escaped are those which section 2.4 of RFC 2253 states must be escaped&quot;. This makes sense as my kakfa-authorizor log shows the comma correctly escaped with a backslash:&lt;br/&gt;
INFO Principal = User:CN=myhost.mycompany.com,OU=MyOU,O=MyCompany\, Inc.,ST=MyST,C=US is Denied Operation = Describe from host = 1.2.3.4 on resource = Topic:mytopic (kafka.authorizer.logger)&lt;/p&gt;

&lt;p&gt;Here&apos;s what I get when I try to create the ACL in kafka 1.0:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt; # kafka-acls --authorizer-properties zookeeper.connect=localhost:2181 --add --allow-principal User:&lt;span class=&quot;code-quote&quot;&gt;&quot;CN=myhost.mycompany.com,OU=MyOU,O=MyCompany\, Inc.,ST=MyST,C=US&quot;&lt;/span&gt; --operation &lt;span class=&quot;code-quote&quot;&gt;&quot;Describe&quot;&lt;/span&gt; --allow-host &lt;span class=&quot;code-quote&quot;&gt;&quot;*&quot;&lt;/span&gt; --topic=&lt;span class=&quot;code-quote&quot;&gt;&quot;mytopic&quot;&lt;/span&gt;
Adding ACLs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; resource `Topic:mytopic`:
     User:CN=CN=myhost.mycompany.com,OU=MyOU,O=MyCompany\, Inc.,ST=MyST,C=US has Allow permission &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; operations: Describe from hosts: *

Current ACLs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; resource `Topic:mytopic`:
&amp;lt;Empty line here. I expect to see &lt;span class=&quot;code-quote&quot;&gt;&quot;User:CN=CN=myhost.mycompany.com,OU=MyOU,O=MyCompany\, Inc.,ST=MyST,C=US has Allow permission &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; operations: Describe from hosts: *&quot;&lt;/span&gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Examining Zookeeper, I can see the data. Though I notice that the json string for ACLs is not actually valid since the backslash is not escaped with a double backslash. This was true for 0.11.0.1 as well, but was never actually a problem.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt; #  zk-shell localhost:2181
Welcome to zk-shell (1.1.1)
(CLOSED) /&amp;gt;
(CONNECTED) /&amp;gt; get /kafka-acl/Topic/mytopic
{&lt;span class=&quot;code-quote&quot;&gt;&quot;version&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;acls&quot;&lt;/span&gt;:[{&lt;span class=&quot;code-quote&quot;&gt;&quot;principal&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;User:CN=myhost.mycompany.com,OU=MyOU,O=MyCompany\, Inc.,ST=MyST,C=US&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;permissionType&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Allow&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;operation&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Describe&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;host&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;*&quot;&lt;/span&gt;}]}

(CONNECTED) /&amp;gt; json_get /kafka-acl/Topic/mytopic acls
Path /kafka-acl/Topic/mytopic has bad JSON.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now Kafka does not recognize any ACLs that have an escaped comma in the principle name and all the clients are denied access. I tried searching for anything relevant that changed between 0.11.0.1 and 1.0.0 and I noticed &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1595&quot; title=&quot;Remove deprecated and slower scala JSON parser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1595&quot;&gt;&lt;del&gt;KAFKA-1595&lt;/del&gt;&lt;/a&gt;:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/commit/8b14e11743360a711b2bb670cf503acc0e604602#diff-db89a14f2c85068b1f0076d52e590d05&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/commit/8b14e11743360a711b2bb670cf503acc0e604602#diff-db89a14f2c85068b1f0076d52e590d05&lt;/a&gt;&lt;br/&gt;
Could the new json library be failing because the acl is not actually a valid json string? &lt;/p&gt;

&lt;p&gt;I can store a valid json string with an escaped backslash (ex: containing &quot;O=MyCompany&lt;br class=&quot;atl-forced-newline&quot; /&gt;, Inc.&quot;), and the comparison between the principle builder string, and what is read from zookeeper succeeds. However, successively apply ACLs seems to strip the backslashes and generally corrupts things:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt; #  kafka-acls --authorizer-properties zookeeper.connect=localhost:2181 --add --allow-principal User:&lt;span class=&quot;code-quote&quot;&gt;&quot;CN=CN=myhost.mycompany.com,OU=MyOU,O=MyCompany\\\, Inc.,ST=MyST,C=US&quot;&lt;/span&gt; --operation Describe --group=&lt;span class=&quot;code-quote&quot;&gt;&quot;*&quot;&lt;/span&gt; --allow-host &lt;span class=&quot;code-quote&quot;&gt;&quot;*&quot;&lt;/span&gt; --topic=&lt;span class=&quot;code-quote&quot;&gt;&quot;mytopic&quot;&lt;/span&gt;
Adding ACLs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; resource `Topic:mytopic`:
     User:CN=CN=myhost.mycompany.com,OU=MyOU,O=MyCompany\\, Inc.,ST=MyST,C=US has Allow permission &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; operations: Describe from hosts: *

Adding ACLs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; resource `Group:*`:
     User:CN=CN=myhost.mycompany.com,OU=MyOU,O=MyCompany\\, Inc.,ST=MyST,C=US has Allow permission &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; operations: Describe from hosts: *

Current ACLs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; resource `Topic:mytopic`:
     User:CN=CN=myhost.mycompany.com,OU=MyOU,O=MyCompany\, Inc.,ST=MyST,C=US has Allow permission &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; operations: Describe from hosts: *

Current ACLs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; resource `Group:*`:
     User:CN=CN=myhost.mycompany.com,OU=MyOU,O=MyCompany\, Inc.,ST=MyST,C=US has Allow permission &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; operations: Describe from hosts: *
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks as though the backslash used for escaping RFC 2253 strings is not being handled correctly. That&apos;s as far as I&apos;ve dug.&lt;/p&gt;</description>
                <environment>Debian 8. Java 8. SSL clients.</environment>
        <key id="13123306">KAFKA-6319</key>
            <summary>kafka-acls regression for comma characters (and maybe other characters as well)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rsivaram">Rajini Sivaram</assignee>
                                    <reporter username="jmcmillan">Jordan Mcmillan</reporter>
                        <labels>
                            <label>regression</label>
                    </labels>
                <created>Wed, 6 Dec 2017 21:46:13 +0000</created>
                <updated>Tue, 12 Dec 2017 10:36:43 +0000</updated>
                            <resolved>Tue, 12 Dec 2017 10:35:45 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.0.1</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>admin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16282489" author="githubbot" created="Thu, 7 Dec 2017 20:30:20 +0000"  >&lt;p&gt;GitHub user rajinisivaram opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4303&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4303&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6319&quot; title=&quot;kafka-acls regression for comma characters (and maybe other characters as well)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6319&quot;&gt;&lt;del&gt;KAFKA-6319&lt;/del&gt;&lt;/a&gt;: Quote strings stored in JSON configs&lt;/p&gt;

&lt;p&gt;    This is required for ACLs where SSL principals contain special characters (e.g. comma) that are escaped using backslash. The strings need to be quoted for JSON to ensure that the JSON stored in ZK is valid.&lt;br/&gt;
    Also converted `SslEndToEndAuthorizationTest` to use a principal with special characters to ensure that this path is tested.&lt;/p&gt;

&lt;p&gt;    *More detailed description of your change,&lt;br/&gt;
    if necessary. The PR title and PR message become&lt;br/&gt;
    the squashed commit message, so use a separate&lt;br/&gt;
    comment to ping reviewers.*&lt;/p&gt;

&lt;p&gt;    *Summary of testing strategy (including rationale)&lt;br/&gt;
    for the feature or bug fix. Unit and/or integration&lt;br/&gt;
    tests are expected for any behaviour change and&lt;br/&gt;
    system tests should be considered for larger changes.*&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rajinisivaram/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rajinisivaram/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6319&quot; title=&quot;kafka-acls regression for comma characters (and maybe other characters as well)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6319&quot;&gt;&lt;del&gt;KAFKA-6319&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4303.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4303.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4303&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 9518f465a76b3431a36777d83d57bf1430eaa302&lt;br/&gt;
Author: Rajini Sivaram &amp;lt;rajinisivaram@googlemail.com&amp;gt;&lt;br/&gt;
Date:   2017-12-07T20:00:03Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6319&quot; title=&quot;kafka-acls regression for comma characters (and maybe other characters as well)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6319&quot;&gt;&lt;del&gt;KAFKA-6319&lt;/del&gt;&lt;/a&gt;: Quote strings in JSON to enable ACLs for principals with special chars&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16287409" author="githubbot" created="Tue, 12 Dec 2017 10:28:24 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4303&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4303&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16287419" author="ijuma" created="Tue, 12 Dec 2017 10:36:26 +0000"  >&lt;p&gt;Thanks for reporting this. It would be great if you could test the 1.0 branch to ensure it all works now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 49 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nmfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>