<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:41:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1549] dead brokers coming in the TopicMetadataResponse</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1549</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;JunRao confirming my observation that brokers are only added to the metadataCache, never removed: &quot;The way that we update liveBrokers in MetadataCache.updateCache() doesn&apos;t seem right. We only add newly received live brokers to the list. However, there could be existing brokers in that list that are now dead. Those dead brokers shouldn&apos;t be returned to the clients. We should probably just take the new live broker list and cache it.&quot;&lt;/p&gt;</description>
                <environment>trunk</environment>
        <key id="12728242">KAFKA-1549</key>
            <summary>dead brokers coming in the TopicMetadataResponse</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nmarasoi">nicu marasoiu</assignee>
                                    <reporter username="nmarasoi">nicu marasoiu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Jul 2014 17:14:54 +0000</created>
                <updated>Sun, 27 Jul 2014 17:00:53 +0000</updated>
                            <resolved>Sun, 27 Jul 2014 17:00:53 +0000</resolved>
                                    <version>0.8.2.0</version>
                                    <fixVersion>0.8.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14066548" author="nmarasoi" created="Fri, 18 Jul 2014 17:15:57 +0000"  >&lt;p&gt;test if i receive mails on this jira task&lt;/p&gt;</comment>
                            <comment id="14066784" author="nmarasoi" created="Fri, 18 Jul 2014 19:44:18 +0000"  >&lt;p&gt;essentially i will replace the map of brokers every update. this will allow for the structure to be immutable likely. however the code does not depend on it and toMap is called on the read side as well, to convert to immutable if needed in the read locked window&lt;/p&gt;</comment>
                            <comment id="14067494" author="nmarasoi" created="Sat, 19 Jul 2014 11:39:43 +0000"  >&lt;p&gt;i created a fix and a tiny refactoring in metadataCache to reuse the read locking snippet and make it available outside to allow atomical and lighter lock use across method calls&lt;/p&gt;</comment>
                            <comment id="14068165" author="junrao" created="Mon, 21 Jul 2014 03:43:30 +0000"  >&lt;p&gt;Thanks for the patch. A couple of comments.&lt;/p&gt;

&lt;p&gt;1. inReadLock seems like a generally useful util. We probably can add the following to the Utils file where inLock lives, and change all existing usage of readWriteLock to use those utils.&lt;br/&gt;
  def inReadLock&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;(lock: ReadWriteLock)(fun: =&amp;gt; T): T = {&lt;br/&gt;
  def inWriteLock&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;(lock: ReadWriteLock)(fun: =&amp;gt; T): T = {&lt;/p&gt;

&lt;p&gt;2. Not sure what the purpose of the change in KafkaApis is. Is that to avoid the overhead of an extra readLock? It&apos;s better to limit the usage of the lock inside the MetadataCache.&lt;/p&gt;</comment>
                            <comment id="14068442" author="nmarasoi" created="Mon, 21 Jul 2014 12:07:15 +0000"  >&lt;p&gt;Implemented point 1 and reverted for point 2, attached patch.&lt;br/&gt;
I used implicit parameter for the rwLock, so it required to make the lock the second argument-list to compile. I think in most cases there will be a single implicit read write lock reference available.&lt;/p&gt;

&lt;p&gt;def inReadLock&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;(fun: =&amp;gt; T)(lock: ReadWriteLock): T = {..&lt;/p&gt;

&lt;p&gt;2. Indeed, to avoid that overhead and make it atomical (i.e. brokers and topic metadata from the same snapshot of metadata). However the atomicity is not required by the functionality.&lt;br/&gt;
I understand that this locking encapsulation useful to make it safe and easy to reason on the multithreading behavior, that is the reason right?&lt;/p&gt;</comment>
                            <comment id="14069189" author="nmarasoi" created="Mon, 21 Jul 2014 20:02:18 +0000"  >&lt;p&gt;added an implementation without the implicit: this required a pair of function definitions in each client class (to my current scala knowleadge)&lt;/p&gt;</comment>
                            <comment id="14070751" author="nmarasoi" created="Tue, 22 Jul 2014 19:27:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkreps&quot; class=&quot;user-hover&quot; rel=&quot;jkreps&quot;&gt;jkreps&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; Hi, can you help me choose from the patches? Thank you, Nicu&lt;/p&gt;</comment>
                            <comment id="14070933" author="junrao" created="Tue, 22 Jul 2014 21:30:32 +0000"  >&lt;p&gt;Thanks for the patch. Could we define inReadLock and inWriteLock in the same way as inLock? Since we have code like&lt;/p&gt;

&lt;p&gt;inlock(lock) {&lt;br/&gt;
 ...&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;It would be consistent if we can just do &lt;/p&gt;

&lt;p&gt;inReadLock(readWriteLock) {&lt;br/&gt;
 ...&lt;br/&gt;
}&lt;/p&gt;</comment>
                            <comment id="14075475" author="nmarasoi" created="Sat, 26 Jul 2014 19:44:07 +0000"  >&lt;p&gt;Agreed, makes sense - attached patch.&lt;br/&gt;
I wonder why I did not receive an email on gmail with your comment, since I am subscribed (watching) this issue, do you have any idea why?&lt;/p&gt;</comment>
                            <comment id="14075646" author="junrao" created="Sun, 27 Jul 2014 17:00:53 +0000"  >&lt;p&gt;Thanks for the patch. +1 and committed to trunk.&lt;/p&gt;

&lt;p&gt;Hmm, I am not why you didn&apos;t get the email notification. Did you just miss this particular one or you never got any notification?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12658006" name="bringAllBrokers.patch" size="9184" author="nmarasoi" created="Sat, 26 Jul 2014 19:44:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406347</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 17 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xxcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406368</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>