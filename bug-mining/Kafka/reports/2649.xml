<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:24:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9859] kafka-streams-application-reset tool doesn&apos;t take into account topics generated by KTable foreign key join operation</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9859</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Steps to reproduce:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Create Kafka Streams application which uses foreign key join operation (without a Named parameter overload)&lt;/li&gt;
	&lt;li&gt;Stop Kafka streams application&lt;/li&gt;
	&lt;li&gt;Perform `kafka-topics-list` and verify that foreign key operation internal topics are generated&lt;/li&gt;
	&lt;li&gt;Use `kafka-streams-application-reset` to perform the cleanup of your kafka streams application: `kafka-streams-application-reset --application-id &amp;lt;your_app_id&amp;gt; --input-topics &amp;lt;your_input_topic&amp;gt; --bootstrap-servers &amp;lt;your_bootstrap_server&amp;gt; --to-datetime 2019-04-13T00:00:00.000`&lt;/li&gt;
	&lt;li&gt;Perform `kafka-topics-list` again, you&apos;ll see that topics generated by the foreign key operation are still there.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;#L679-L680&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;kafka-streams-application-reset&lt;/a&gt;] uses `-subscription-registration-topic` and `-subscription-response-topic` suffixes to match topics generated by the foreign key operation. While in reality, internal topics are generated in this format:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;application id&amp;gt;-KTABLE-FK-JOIN-SUBSCRIPTION-REGISTRATION-&amp;lt;running number&amp;gt;-topic 
&amp;lt;application id&amp;gt;-KTABLE-FK-JOIN-SUBSCRIPTION-RESPONSE-&amp;lt;running number&amp;gt;-topic&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please note that this problem only happens when `Named` parameter is not used. When named parameter is used, topics are generated with a same pattern as specified in StreamsResetter.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13298035">KAFKA-9859</key>
            <summary>kafka-streams-application-reset tool doesn&apos;t take into account topics generated by KTable foreign key join operation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lkokhreidze">Levani Kokhreidze</assignee>
                                    <reporter username="lkokhreidze">Levani Kokhreidze</reporter>
                        <labels>
                            <label>newbie</label>
                            <label>newbie++</label>
                    </labels>
                <created>Mon, 13 Apr 2020 13:50:47 +0000</created>
                <updated>Mon, 5 Oct 2020 18:05:08 +0000</updated>
                            <resolved>Wed, 20 May 2020 17:33:27 +0000</resolved>
                                                    <fixVersion>2.6.0</fixVersion>
                                    <component>streams</component>
                    <component>tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17082409" author="bchen225242" created="Mon, 13 Apr 2020 15:32:27 +0000"  >&lt;p&gt;Thanks for reporting. From your observation, is there a regular pattern for auto created foreign key join topics?&lt;/p&gt;</comment>
                            <comment id="17082616" author="vvcephei" created="Mon, 13 Apr 2020 19:42:46 +0000"  >&lt;p&gt;Yes, the FK join KIP added two new suffixes:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;*-subscription-registration&lt;/li&gt;
	&lt;li&gt;*-subscription-response&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;As an implementation note, these topics are registered in org.apache.kafka.streams.kstream.internals.KTableImpl#doJoinOnForeignKey&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As a workaround, these topics can be deleted &quot;manually&quot;, but they should absolutely be cleaned up by the application reset tool.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lkokhreidze&quot; class=&quot;user-hover&quot; rel=&quot;lkokhreidze&quot;&gt;lkokhreidze&lt;/a&gt;, did you want to pick this up? It should be pretty straightforward.&lt;/p&gt;</comment>
                            <comment id="17082619" author="lkokhreidze" created="Mon, 13 Apr 2020 19:53:50 +0000"  >&lt;p&gt;Ah sorry, I think this ticket is a bit misleading. Kafka broker I have tested this was 2.3.1 and FK join was implemented in 2.4. Seems like 2.4.0 has proper implementation around topics generated by the FK Join, see `kafka.tools.StreamsResetter#isInternalTopic`. I guess this ticket can be closed as &quot;not a problem&quot;? Pretty sure streams-resetter on older versions of brokers can&apos;t be backward compatible with the FK join feature.&lt;/p&gt;</comment>
                            <comment id="17082662" author="mjsax" created="Mon, 13 Apr 2020 21:05:36 +0000"  >&lt;p&gt;Thanks for the follow up &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lkokhreidze&quot; class=&quot;user-hover&quot; rel=&quot;lkokhreidze&quot;&gt;lkokhreidze&lt;/a&gt; &#8211; what you say makes sense &#8211; the `2.3.x` reset tool would not consider those topics as internal, for obvious reasons.&lt;/p&gt;</comment>
                            <comment id="17091216" author="nikuis" created="Fri, 24 Apr 2020 05:37:11 +0000"  >&lt;p&gt;I have been using 2.4.1 to perform application reset, but there are topics of foreignKey join operation left in broker after reset.&lt;/p&gt;

&lt;p&gt;Looks to me the suffix added for foreignKey, and the actual one generated is different.&lt;/p&gt;

&lt;p&gt;e.g. topics left behind after reset has suffix of &quot;-topic&quot; :&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;application id&amp;gt;-KTABLE-FK-JOIN-SUBSCRIPTION-REGISTRATION-&amp;lt;running number&amp;gt;-topic 
&amp;lt;application id&amp;gt;-KTABLE-FK-JOIN-SUBSCRIPTION-RESPONSE-&amp;lt;running number&amp;gt;-topic
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should I raise a new JIRA?&#160;&lt;/p&gt;</comment>
                            <comment id="17091227" author="tmau" created="Fri, 24 Apr 2020 06:09:21 +0000"  >&lt;p&gt;Looks like the topic pattern it looking for in `kafka.tools.StreamsResetter#isInternalTopic` does not match the generated internal topic name&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/tools/StreamsResetter.java#L679-L680&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/tools/StreamsResetter.java#L679-L680&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
topicName.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;-subscription-registration-topic&quot;&lt;/span&gt;)
topicName.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;-subscription-response-topic&quot;&lt;/span&gt;)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17091236" author="lkokhreidze" created="Fri, 24 Apr 2020 06:18:30 +0000"  >&lt;p&gt;Thanks for spotting this, haven&apos;t paid attention to it. Re-opening the ticket with the new findings.&lt;/p&gt;</comment>
                            <comment id="17091243" author="lkokhreidze" created="Fri, 24 Apr 2020 06:31:56 +0000"  >&lt;p&gt;Please also note that this problem only happens when `Named` parameter is not used. When named parameter is used, topics are generated with a same pattern as specified in StreamsResetter.&lt;/p&gt;</comment>
                            <comment id="17091313" author="nikuis" created="Fri, 24 Apr 2020 08:03:44 +0000"  >&lt;p&gt;Yes, in my program, I didn&apos;t pass in &apos;Named&apos; parameter, and rely on the default.&lt;/p&gt;</comment>
                            <comment id="17099190" author="guozhang" created="Mon, 4 May 2020 18:00:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lkokhreidze&quot; class=&quot;user-hover&quot; rel=&quot;lkokhreidze&quot;&gt;lkokhreidze&lt;/a&gt; Do you want to send a PR to resolve this ticket?&lt;/p&gt;</comment>
                            <comment id="17099196" author="lkokhreidze" created="Mon, 4 May 2020 18:02:52 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Was meaning to do it this week, will assign ticket to myself and send the PR.&lt;/p&gt;</comment>
                            <comment id="17112469" author="lkokhreidze" created="Wed, 20 May 2020 17:33:27 +0000"  >&lt;p&gt;fixed with PR&#160;&lt;a href=&quot;https://github.com/apache/kafka/pull/8671&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8671&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13329725">KAFKA-10530</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0dko0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>