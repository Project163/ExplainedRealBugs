<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:26:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-10417] suppress() with cogroup() throws ClassCastException</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-10417</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Streams operation - `cogroup()`, `aggregate()` followed by `suppress()` throws `ClassCastException`&lt;/p&gt;

&lt;p&gt;Works fine without the `suppress()`&lt;/p&gt;

&lt;p&gt;Code block tested -&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val stream1 = requestStreams.merge(successStreams).merge(errorStreams)
                .groupByKey(Grouped.with(Serdes.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(), serdesConfig.notificationSerde()))

        val streams2 = confirmationStreams
                .groupByKey(Grouped.with(Serdes.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(), serdesConfig.confirmationsSerde()))

        val cogrouped = stream1.cogroup(notificationAggregator).cogroup(streams2, confirmationsAggregator)
                .windowedBy(TimeWindows.of(Duration.ofMinutes(notificationStreamsConfig.joinWindowMinutes.toLong())).grace(Duration.ofMinutes(notificationStreamsConfig.graceDurationMinutes.toLong())))
                .aggregate({ &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; }, Materialized.`as`&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, NotificationMetric, WindowStore&amp;lt;Bytes, ByteArray&amp;gt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;time-windowed-aggregated-stream-store&quot;&lt;/span&gt;)
                        .withValueSerde(serdesConfig.notificationMetricSerde()))
                 .suppress(Suppressed.untilWindowCloses(unbounded()))
                .toStream()

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Exception thrown is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.ClassCastException: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.kafka.streams.kstream.internals.PassThrough cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.kafka.streams.kstream.internals.KTableProcessorSupplier (org.apache.kafka.streams.kstream.internals.PassThrough and org.apache.kafka.streams.kstream.internals.KTableProcessorSupplier are in unnamed module of loader &lt;span class=&quot;code-quote&quot;&gt;&apos;app&apos;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/63459685/kgroupedstream-with-cogroup-aggregate-suppress&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/63459685/kgroupedstream-with-cogroup-aggregate-suppress&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13323376">KAFKA-10417</key>
            <summary>suppress() with cogroup() throws ClassCastException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lct45">Leah Thomas</assignee>
                                    <reporter username="wardhapk">Wardha Perinkada Kattu</reporter>
                        <labels>
                            <label>kafka-streams</label>
                    </labels>
                <created>Tue, 18 Aug 2020 15:05:20 +0000</created>
                <updated>Wed, 16 Dec 2020 14:00:03 +0000</updated>
                            <resolved>Wed, 16 Dec 2020 14:00:03 +0000</resolved>
                                    <version>2.6.0</version>
                                    <fixVersion>2.7.1</fixVersion>
                    <fixVersion>2.8.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17187322" author="rensgroothuijsen" created="Sun, 30 Aug 2020 20:35:17 +0000"  >&lt;p&gt;A cogrouped stream creates a KTable with processor supplier type PassThrough, which implements ProcessorSupplier rather than&#160; KTableProcessorSupplier. This then causes a problem &lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KTableImpl.java#L842&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17211210" author="bbejeck" created="Fri, 9 Oct 2020 17:15:25 +0000"  >&lt;p&gt;I&apos;m marking this as critical vs. blocker as I don&apos;t believe this to be a regression, but an issue we missed in the 2.6 release.&lt;/p&gt;</comment>
                            <comment id="17211293" author="ableegoldman" created="Fri, 9 Oct 2020 18:49:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=RensGroothuijsen&quot; class=&quot;user-hover&quot; rel=&quot;RensGroothuijsen&quot;&gt;RensGroothuijsen&lt;/a&gt;&#160;would you be interested in submitting a PR for this?&lt;/p&gt;</comment>
                            <comment id="17211318" author="rensgroothuijsen" created="Fri, 9 Oct 2020 19:55:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt; I would, but I&apos;m not familiar enough with the code to determine what the best solution would be.&lt;/p&gt;</comment>
                            <comment id="17211875" author="duvholt" created="Sun, 11 Oct 2020 10:57:17 +0000"  >&lt;p&gt;I ended up adding&#160; an instanceof check before casting to KTableProcessorSupplier. I&apos;ve been using this in production for some weeks now and haven&apos;t noticed any issues.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/amedia/kafka/commit/7d2a027f41c246ecb521b85076525f5ed9f3834e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/amedia/kafka/commit/7d2a027f41c246ecb521b85076525f5ed9f3834e&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If someone more experienced with the internals of Kafka Streams thinks this is a proper fix I can submit a PR.&lt;/p&gt;</comment>
                            <comment id="17213535" author="vvcephei" created="Wed, 14 Oct 2020 02:40:31 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=duvholt&quot; class=&quot;user-hover&quot; rel=&quot;duvholt&quot;&gt;duvholt&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;Thanks for sharing that. It looks like it&apos;s just ignoring the request if the parent processor isn&apos;t the right type?&lt;/p&gt;

&lt;p&gt;It might be working for you, but if you have any operations downstream that actually need the old values, then you should beware that you&apos;re now silently getting incorrect results. On the other hand, if you&apos;re &lt;em&gt;just&lt;/em&gt; doing it to work around the bug that manifests when you use suppress, then you&apos;re probably ok. It&apos;s risky, though, so you might want to take a closer look and/or prioritize putting in a proper fix.&lt;/p&gt;

&lt;p&gt;The KTableValueGetter/enableOldValues thing is &lt;em&gt;super&lt;/em&gt; confusing, and as a matter of fact, it&apos;s something I&apos;m planning to clean up now that KIP-478 is finally over the line. So don&apos;t feel bad if it&apos;s as clear as mud when you try to figure out the right way to fix it, it&apos;s that way for everyone.&lt;/p&gt;

&lt;p&gt;What&apos;s happening in the cogroup case is that there are a set of aggregator processors whose results all get &quot;merged&quot; together, and the KTable is the result of that merge. The aggregation processors themselves are capable of `enableSendOldValues`, but the implementation uses the PassThrough for that merge node, which is not aware of &quot;send old values&quot;. What seems to be needed is for the cogroup merge processor to get a new kind of PassThrough that is capable of transmitting &quot;enable send old values&quot; to its parents. I&apos;m not sure whether or not the method could be added to PassThrough harmlessly, or whether we need some kind of KTableSourcePassThrough supplier.&lt;/p&gt;

&lt;p&gt;Does this sound like the kind of thing you want to take a crack at? Although it may not technically be a blocker, it would be ideal to get a fix for this in 2.7 .&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;-John&lt;/p&gt;</comment>
                            <comment id="17213606" author="mjsax" created="Wed, 14 Oct 2020 04:55:41 +0000"  >&lt;p&gt;Just want to point out, that we recently fixed&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-10077&quot; title=&quot;Filter downstream of state-store results in spurious tombstones&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-10077&quot;&gt;&lt;del&gt;KAFKA-10077&lt;/del&gt;&lt;/a&gt;&#160;and&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-10494&quot; title=&quot;Streams: enableSendingOldValues should not call parent if node is itself materialized&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-10494&quot;&gt;&lt;del&gt;KAFKA-10494&lt;/del&gt;&lt;/a&gt;&#160;that might be related?&lt;/p&gt;</comment>
                            <comment id="17213725" author="duvholt" created="Wed, 14 Oct 2020 08:25:14 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vvcephei&quot; class=&quot;user-hover&quot; rel=&quot;vvcephei&quot;&gt;vvcephei&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I suspect that I&apos;m not experienced enough with Kafka Streams to solve this issue, but I can give it a try.&lt;/p&gt;

&lt;p&gt;Is there any documentation about `enableSendOldValues` which I could read to get a better understanding of the issue?&lt;/p&gt;</comment>
                            <comment id="17217945" author="bbejeck" created="Tue, 20 Oct 2020 21:22:03 +0000"  >&lt;p&gt;Since there&apos;s no PR for this ticket yet and the code freeze is tomorrow 10/21 as part of the 2.7.0 release I&apos;m going to change the fix version to 2.8.0 and 2.7.1.&lt;/p&gt;

&lt;p&gt;\cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vvcephei&quot; class=&quot;user-hover&quot; rel=&quot;vvcephei&quot;&gt;vvcephei&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17230559" author="mimaison" created="Thu, 12 Nov 2020 11:47:32 +0000"  >&lt;p&gt;Since there&apos;s still no PR, removing 2.6.1 from &quot;Fix Version/s&quot;&lt;/p&gt;</comment>
                            <comment id="17242789" author="lct45" created="Wed, 2 Dec 2020 22:43:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=duvholt&quot; class=&quot;user-hover&quot; rel=&quot;duvholt&quot;&gt;duvholt&lt;/a&gt;&#160;are you still planning on working on this? If not I&apos;m happy to pick it up&lt;/p&gt;</comment>
                            <comment id="17242806" author="vvcephei" created="Wed, 2 Dec 2020 23:29:06 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=duvholt&quot; class=&quot;user-hover&quot; rel=&quot;duvholt&quot;&gt;duvholt&lt;/a&gt; , I&apos;m really sorry I missed your comment. Sadly, there&apos;s no documentation, but the basic point is that some aggregations need to be able to &quot;subtract&quot; the prior value before &quot;adding&quot; the new value. For this case, it requests upstream operators to send the old value along with any updates.&lt;/p&gt;</comment>
                            <comment id="17243023" author="duvholt" created="Thu, 3 Dec 2020 08:53:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lct45&quot; class=&quot;user-hover&quot; rel=&quot;lct45&quot;&gt;lct45&lt;/a&gt; unfortunately I&apos;m not able to work on this now so feel free to pick it up.&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 49 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hvw8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>