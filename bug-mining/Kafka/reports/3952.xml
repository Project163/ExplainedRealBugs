<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:40:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-17661] Fix flaky BufferPoolTest.testBlockTimeout</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-17661</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;4 flaky out of 221 trunk build in the past 28 days. (github) (&lt;a href=&quot;https://ge.apache.org/scans/tests?search.rootProjectNames=kafka&amp;amp;search.startTimeMax=1727681219558&amp;amp;search.startTimeMin=1725206400000&amp;amp;search.tags=github&amp;amp;search.timeZoneId=Asia%2FTaipei&amp;amp;tests.container=org.apache.kafka.clients.producer.internals.BufferPoolTest&amp;amp;tests.test=testBlockTimeout()&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Report Link&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;(&lt;a href=&quot;https://ge.apache.org/s/nh44u7tsm2lri/tests/task/:clients:test/details/org.apache.kafka.clients.producer.internals.BufferPoolTest/testBlockTimeout()?expanded-stacktrace=WyIwIl0&amp;amp;top-execution=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Sep 27 2024 at 04:54:00&lt;/a&gt;)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.opentest4j.AssertionFailedError: The buffer allocated more memory than its maximum value 10	

at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:38)	
at org.junit.jupiter.api.Assertions.fail(Assertions.java:138)	
at org.apache.kafka.clients.producer.internals.BufferPoolTest.testBlockTimeout(BufferPoolTest.java:184)	
at java.lang.reflect.Method.invoke(Method.java:566)	
at java.util.ArrayList.forEach(ArrayList.java:1541)	
at java.util.ArrayList.forEach(ArrayList.java:1541)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Root cause:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The test relies on 3 asynchronous threads being triggered in parallel with the test thread &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. However, there is no guarantee of parallelism in test environment. The issue will happend if test thread didn&apos;t get CPU within 25 ms. We could reproduce this issue by adding 30 ms delay to test thread. Please check the attached patch.&lt;/li&gt;
	&lt;li&gt;Since a 25 ms delay is obviously unreliable in the test environment, we could consider rewriting the test or increasing the delay. (The maxBlockTimeMs was reduced from 2000ms to 10 ms in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9852&quot; title=&quot;Lower block duration in BufferPoolTest to cut down on overall test runtime&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9852&quot;&gt;&lt;del&gt;KAFKA-9852&lt;/del&gt;&lt;/a&gt;)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/kafka/blob/40360819bb97d6b05dfef6451888b4d908fc3bf4/clients/src/test/java/org/apache/kafka/clients/producer/internals/BufferPoolTest.java#L175-L179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/40360819bb97d6b05dfef6451888b4d908fc3bf4/clients/src/test/java/org/apache/kafka/clients/producer/internals/BufferPoolTest.java#L175-L179&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13593697">KAFKA-17661</key>
            <summary>Fix flaky BufferPoolTest.testBlockTimeout</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Yu-Lin Chen">Yu-Lin Chen</assignee>
                                    <reporter username="Yu-Lin Chen">Yu-Lin Chen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Sep 2024 07:51:17 +0000</created>
                <updated>Fri, 11 Oct 2024 14:06:26 +0000</updated>
                            <resolved>Fri, 11 Oct 2024 14:06:26 +0000</resolved>
                                                    <fixVersion>4.0.0</fixVersion>
                                    <component>clients</component>
                    <component>unit tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                        <attachments>
                            <attachment id="13071868" name="0001-reproduce-racing-issue-by-adding-delay-to-test-thread.patch" size="1532" author="Yu-Lin Chen" created="Mon, 30 Sep 2024 07:39:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 6 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1row0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>