<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:02:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5600] Group loading regression causing stale metadata/offsets cache</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5600</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;After long investigation we found a Problem in Kafka.&lt;br/&gt;
When a __consumer_offsets partition gets segmented and Kafka is restarted and needs to reload offsets, consumers will start at a wrong position when metadata and offset events are in both segments.&lt;/p&gt;

&lt;p&gt;Reproduction:&lt;br/&gt;
1.) Start zookeeper and kafka as is from the archive&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;KAFKA_HEAP_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;-Xmx256M -Xms256M&quot;&lt;/span&gt; bin/zookeeper-server-start.sh config/zookeeper.properties
KAFKA_HEAP_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;-Xmx256M -Xms256M&quot;&lt;/span&gt; bin/kafka-server-start.sh config/server.properties
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2.) Start &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12877563/12877563_KafkaErrorProducer.java&quot; title=&quot;KafkaErrorProducer.java attached to KAFKA-5600&quot;&gt;KafkaErrorProducer.java&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; which adds 1M log entries to the topic test&lt;br/&gt;
3.) Start &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12877564/12877564_KafkaErrorConsumer.java&quot; title=&quot;KafkaErrorConsumer.java attached to KAFKA-5600&quot;&gt;KafkaErrorConsumer.java&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; which starts a consumer, reads 100 entries one by one and then closes the consumer. This leads to a 2nd segment in /tmp/kafka-logs/__consumer_offsets-27. This step takes some time (around 5mins). The close of the consumer is needed to have metadata events in the segments too.&lt;br/&gt;
4.) Stop and restart the Kafka broker&lt;br/&gt;
5.) Start any consumer on topic test and group testgroup&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;bin/kafka-console-consumer.sh --from-beginning --bootstrap-server localhost:9092 --topic test --consumer-property group.id=testgroup
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is:&lt;br/&gt;
the consumer starts at the segmentation boundary&lt;br/&gt;
Expected:&lt;br/&gt;
the consumer starts at the end&lt;/p&gt;

&lt;p&gt;The Reason for this behavior is the closing brace of the while loop in GroupMetadataManager#loadGroupsAndOffsets at a wrong position introduced with commit &lt;a href=&quot;https://github.com/apache/kafka/commit/5bd06f1d542e6b588a1d402d059bc24690017d32&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/commit/5bd06f1d542e6b588a1d402d059bc24690017d32&lt;/a&gt;&lt;br/&gt;
I will prepare a pull request.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Edit&lt;/b&gt;: The issue can happen if there are multiple reads from the same segment, see &lt;a href=&quot;https://github.com/apache/kafka/pull/3538#discussion_r127759694&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3538#discussion_r127759694&lt;/a&gt;&lt;/p&gt;</description>
                <environment>any</environment>
        <key id="13087550">KAFKA-5600</key>
            <summary>Group loading regression causing stale metadata/offsets cache</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bjrke">Jan Burkhardt</assignee>
                                    <reporter username="bjrke">Jan Burkhardt</reporter>
                        <labels>
                            <label>regression</label>
                            <label>reliability</label>
                    </labels>
                <created>Mon, 17 Jul 2017 11:42:20 +0000</created>
                <updated>Tue, 18 Sep 2018 06:57:52 +0000</updated>
                            <resolved>Mon, 17 Jul 2017 18:53:57 +0000</resolved>
                                    <version>0.10.2.1</version>
                    <version>0.11.0.0</version>
                                    <fixVersion>0.11.0.1</fixVersion>
                    <fixVersion>1.0.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="16089744" author="githubbot" created="Mon, 17 Jul 2017 12:22:13 +0000"  >&lt;p&gt;GitHub user bjrke opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3538&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3538&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5600&quot; title=&quot;Group loading regression causing stale metadata/offsets cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5600&quot;&gt;&lt;del&gt;KAFKA-5600&lt;/del&gt;&lt;/a&gt;: fix GroupMetadataManager doesn&apos;t read offsets of segmente&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;d log correctly&lt;/p&gt;

&lt;p&gt;    the while loop was too big and need to be closed earlier&lt;br/&gt;
    to see the fix, ignore whitespace since most of it is indentation&lt;/p&gt;

&lt;p&gt;    this bug was introduced by commit&lt;br/&gt;
    5bd06f1d542e6b588a1d402d059bc24690017d32&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/justsocialapps/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/justsocialapps/kafka&lt;/a&gt; trunk&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3538.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3538.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3538&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6b625780dd67c1dc04a90c58f99f77efd18b9d29&lt;br/&gt;
Author: Jan Burkhardt &amp;lt;jan.burkhardt@just.social&amp;gt;&lt;br/&gt;
Date:   2017-07-14T14:30:36Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5600&quot; title=&quot;Group loading regression causing stale metadata/offsets cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5600&quot;&gt;&lt;del&gt;KAFKA-5600&lt;/del&gt;&lt;/a&gt;: fix GroupMetadataManager doesn&apos;t read offsets of segmented log correctly&lt;/p&gt;

&lt;p&gt;    the while loop was too big and need to be closed earlier&lt;br/&gt;
    to see the fix, ignore whitespace since most of it is indentation&lt;/p&gt;

&lt;p&gt;    this bug was introduced by commit&lt;br/&gt;
    5bd06f1d542e6b588a1d402d059bc24690017d32&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16090328" author="hachikuji" created="Mon, 17 Jul 2017 18:53:57 +0000"  >&lt;p&gt;Issue resolved by pull request 3538&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/3538&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3538&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16090330" author="githubbot" created="Mon, 17 Jul 2017 18:54:52 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3538&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3538&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16160324" author="vamsi360" created="Sun, 10 Sep 2017 12:35:34 +0000"  >&lt;p&gt;Hi, will there be a 0.10.2.2 release and can this be included in the release?&lt;/p&gt;</comment>
                            <comment id="16160858" author="bjrke" created="Mon, 11 Sep 2017 07:49:56 +0000"  >&lt;p&gt;we have build a patched 0.11.0 version&lt;br/&gt;
&lt;a href=&quot;https://github.com/justsocialapps/kafka/tree/0.11.0-KAFKA-5600&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/justsocialapps/kafka/tree/0.11.0-KAFKA-5600&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;you can use this if you want, we are using it in production&lt;br/&gt;
&lt;a href=&quot;https://github.com/justsocialapps/kafka/releases/tag/0.11.0.0-KAFKA-5600&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/justsocialapps/kafka/releases/tag/0.11.0.0-KAFKA-5600&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;so long as i know there is only a scheduled v1.0.0 release in october&lt;/p&gt;</comment>
                            <comment id="16160875" author="ijuma" created="Mon, 11 Sep 2017 08:01:07 +0000"  >&lt;p&gt;The voting process for 0.11.0.1 is in progress. It will be officially released in the next few days.&lt;/p&gt;</comment>
                            <comment id="16618569" author="gaher" created="Tue, 18 Sep 2018 06:57:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bjrke&quot; class=&quot;user-hover&quot; rel=&quot;bjrke&quot;&gt;bjrke&lt;/a&gt;&#160;I see that you included 0.10.2.1 as the affected version for this bug however the bug for which this is the fix (to reposition the closing brace of while loop) was only introduced in 0.11. So how&#160;could this bug&#160;be present in 0.10.2.1?&lt;/p&gt;

&lt;p&gt;I ask because I am facing this issue of resetting offsets with 0.10.1.1 and I stumbled upon this bug. I can&apos;t quite find out the root cause yet.&lt;/p&gt;

&lt;p&gt;PS: I&#160;understand&#160;it has been about a year since&#160;you fixed this; but would be really&#160;helpful if I can know if this bug existed (in a different&#160;form perhaps) in 0.10.2.1 or may be 0.10.1.1 too. Appreciate&#160;your response here.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13117011">KAFKA-6189</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12877564" name="KafkaErrorConsumer.java" size="1325" author="bjrke" created="Mon, 17 Jul 2017 11:33:09 +0000"/>
                            <attachment id="12877563" name="KafkaErrorProducer.java" size="809" author="bjrke" created="Mon, 17 Jul 2017 11:33:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hlcf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>