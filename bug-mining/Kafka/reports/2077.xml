<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:15:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-7496] KafkaAdminClient#describeAcls should handle invalid filters gracefully</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-7496</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;KafkaAdminClient#describeAcls should handle invalid filters gracefully.  Specifically, it should return a future which yields an exception.&lt;/p&gt;

&lt;p&gt;The following code results in an uncaught IllegalArgumentException in the admin client thread, resulting in a zombie admin client.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
AclBindingFilter aclFilter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AclBindingFilter(
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ResourcePatternFilter(ResourceType.UNKNOWN, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, PatternType.ANY),
    AccessControlEntryFilter.ANY
);
kafkaAdminClient.describeAcls(aclFilter).values().get();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See the resulting stacktrace below&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ERROR [kafka-admin-client-thread | adminclient-3] Uncaught exception in thread &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka-admin-client-thread | adminclient-3&apos;&lt;/span&gt;: (org.apache.kafka.common.utils.KafkaThread)
java.lang.IllegalArgumentException: Filter contain UNKNOWN elements
    at org.apache.kafka.common.requests.DescribeAclsRequest.validate(DescribeAclsRequest.java:140)
    at org.apache.kafka.common.requests.DescribeAclsRequest.&amp;lt;init&amp;gt;(DescribeAclsRequest.java:92)
    at org.apache.kafka.common.requests.DescribeAclsRequest$Builder.build(DescribeAclsRequest.java:77)
    at org.apache.kafka.common.requests.DescribeAclsRequest$Builder.build(DescribeAclsRequest.java:67)
    at org.apache.kafka.clients.NetworkClient.doSend(NetworkClient.java:450)
    at org.apache.kafka.clients.NetworkClient.send(NetworkClient.java:411)
    at org.apache.kafka.clients.admin.KafkaAdminClient$AdminClientRunnable.sendEligibleCalls(KafkaAdminClient.java:910)
    at org.apache.kafka.clients.admin.KafkaAdminClient$AdminClientRunnable.run(KafkaAdminClient.java:1107)
    at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:844)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13190692">KAFKA-7496</key>
            <summary>KafkaAdminClient#describeAcls should handle invalid filters gracefully</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cmccabe">Colin McCabe</assignee>
                                    <reporter username="cmccabe">Colin McCabe</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Oct 2018 16:39:40 +0000</created>
                <updated>Tue, 16 Oct 2018 14:07:41 +0000</updated>
                            <resolved>Tue, 16 Oct 2018 14:07:41 +0000</resolved>
                                                    <fixVersion>2.1.0</fixVersion>
                                    <component>admin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16645236" author="githubbot" created="Wed, 10 Oct 2018 16:41:29 +0000"  >&lt;p&gt;cmccabe opened a new pull request #5774: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7496&quot; title=&quot;KafkaAdminClient#describeAcls should handle invalid filters gracefully&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7496&quot;&gt;&lt;del&gt;KAFKA-7496&lt;/del&gt;&lt;/a&gt;: KafkaAdminClient#describeAcls should handle invalid filters gracefully&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/5774&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/5774&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16645241" author="cmccabe" created="Wed, 10 Oct 2018 16:44:46 +0000"  >&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xvrl&quot; class=&quot;user-hover&quot; rel=&quot;xvrl&quot;&gt;xvrl&lt;/a&gt; for finding this bug and creating a test case.&lt;/p&gt;</comment>
                            <comment id="16651498" author="githubbot" created="Tue, 16 Oct 2018 11:07:52 +0000"  >&lt;p&gt;rajinisivaram closed pull request #5774: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7496&quot; title=&quot;KafkaAdminClient#describeAcls should handle invalid filters gracefully&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7496&quot;&gt;&lt;del&gt;KAFKA-7496&lt;/del&gt;&lt;/a&gt;: KafkaAdminClient#describeAcls should handle invalid filters gracefully&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/5774&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/5774&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java b/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java&lt;br/&gt;
index ceebc58301c..3c0ec6c53d4 100644&lt;br/&gt;
&amp;#8212; a/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java&lt;br/&gt;
+++ b/clients/src/main/java/org/apache/kafka/clients/admin/KafkaAdminClient.java&lt;br/&gt;
@@ -1543,6 +1543,12 @@ void handleFailure(Throwable throwable) {&lt;/p&gt;

&lt;p&gt;     @Override&lt;br/&gt;
     public DescribeAclsResult describeAcls(final AclBindingFilter filter, DescribeAclsOptions options) {&lt;br/&gt;
+        if (filter.isUnknown()) &lt;/p&gt;
{
+            KafkaFutureImpl&amp;lt;Collection&amp;lt;AclBinding&amp;gt;&amp;gt; future = new KafkaFutureImpl&amp;lt;&amp;gt;();
+            future.completeExceptionally(new InvalidRequestException(&quot;The AclBindingFilter &quot; +
+                    &quot;must not contain UNKNOWN elements.&quot;));
+            return new DescribeAclsResult(future);
+        }
&lt;p&gt;         final long now = time.milliseconds();&lt;br/&gt;
         final KafkaFutureImpl&amp;lt;Collection&amp;lt;AclBinding&amp;gt;&amp;gt; future = new KafkaFutureImpl&amp;lt;&amp;gt;();&lt;br/&gt;
         runnable.call(new Call(&quot;describeAcls&quot;, calcDeadlineMs(now, options.timeoutMs()),&lt;br/&gt;
diff --git a/clients/src/test/java/org/apache/kafka/clients/admin/KafkaAdminClientTest.java b/clients/src/test/java/org/apache/kafka/clients/admin/KafkaAdminClientTest.java&lt;br/&gt;
index 34432c31034..dc55ea236e6 100644&lt;br/&gt;
&amp;#8212; a/clients/src/test/java/org/apache/kafka/clients/admin/KafkaAdminClientTest.java&lt;br/&gt;
+++ b/clients/src/test/java/org/apache/kafka/clients/admin/KafkaAdminClientTest.java&lt;br/&gt;
@@ -37,6 +37,7 @@&lt;br/&gt;
 import org.apache.kafka.common.config.ConfigResource;&lt;br/&gt;
 import org.apache.kafka.common.errors.AuthenticationException;&lt;br/&gt;
 import org.apache.kafka.common.errors.GroupAuthorizationException;&lt;br/&gt;
+import org.apache.kafka.common.errors.InvalidRequestException;&lt;br/&gt;
 import org.apache.kafka.common.errors.InvalidTopicException;&lt;br/&gt;
 import org.apache.kafka.common.errors.LeaderNotAvailableException;&lt;br/&gt;
 import org.apache.kafka.common.errors.NotLeaderForPartitionException;&lt;br/&gt;
@@ -561,6 +562,9 @@ private void callAdminClientApisAndExpectAnAuthenticationError(AdminClientUnitTe&lt;br/&gt;
         new AccessControlEntryFilter(&quot;User:ANONYMOUS&quot;, null, AclOperation.ANY, AclPermissionType.ANY));&lt;br/&gt;
     private static final AclBindingFilter FILTER2 = new AclBindingFilter(new ResourcePatternFilter(ResourceType.ANY, null, PatternType.LITERAL),&lt;br/&gt;
         new AccessControlEntryFilter(&quot;User:bob&quot;, null, AclOperation.ANY, AclPermissionType.ANY));&lt;br/&gt;
+    private static final AclBindingFilter UNKNOWN_FILTER = new AclBindingFilter(&lt;br/&gt;
+        new ResourcePatternFilter(ResourceType.UNKNOWN, null, PatternType.LITERAL),&lt;br/&gt;
+        new AccessControlEntryFilter(&quot;User:bob&quot;, null, AclOperation.ANY, AclPermissionType.ANY));&lt;/p&gt;

&lt;p&gt;     @Test&lt;br/&gt;
     public void testDescribeAcls() throws Exception {&lt;br/&gt;
@@ -582,6 +586,10 @@ public void testDescribeAcls() throws Exception &lt;/p&gt;
{
             env.kafkaClient().prepareResponse(new DescribeAclsResponse(0,
                 new ApiError(Errors.SECURITY_DISABLED, &quot;Security is disabled&quot;), Collections.&amp;lt;AclBinding&amp;gt;emptySet()));
             TestUtils.assertFutureError(env.adminClient().describeAcls(FILTER2).values(), SecurityDisabledException.class);
+
+            // Test a call where we supply an invalid filter.
+            TestUtils.assertFutureError(env.adminClient().describeAcls(UNKNOWN_FILTER).values(),
+                InvalidRequestException.class);
         }
&lt;p&gt;     }&lt;/p&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13190690">KAFKA-7495</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3z1mv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rsivaram</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>