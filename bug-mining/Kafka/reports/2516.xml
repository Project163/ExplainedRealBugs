<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:22:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9533] JavaDocs of KStream#ValueTransform incorrect</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9533</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;According to the documentation for `KStream#transformValues`, nulls returned from `ValueTransformer#transform` are not forwarded. (see &lt;a href=&quot;https://kafka.apache.org/24/javadoc/org/apache/kafka/streams/kstream/KStream.html#transformValues-org.apache.kafka.streams.kstream.ValueTransformerSupplier-java.lang.String...-&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;KStream#transformValues&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;However, this does not appear to be the case. In `KStreamTransformValuesProcessor#process` the result of the transform is forwarded directly.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 @Override
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; K key, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; V value) {
     context.forward(key, valueTransformer.transform(key, value));
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13284392">KAFKA-9533</key>
            <summary>JavaDocs of KStream#ValueTransform incorrect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mjsax">Matthias J. Sax</assignee>
                                    <reporter username="mviamari">Michael Viamari</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Feb 2020 19:31:57 +0000</created>
                <updated>Sat, 14 Mar 2020 18:56:50 +0000</updated>
                            <resolved>Sat, 14 Mar 2020 18:56:50 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.3.2</fixVersion>
                    <fixVersion>2.4.2</fixVersion>
                    <fixVersion>2.5.1</fixVersion>
                    <fixVersion>2.6.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17034298" author="cadonna" created="Tue, 11 Feb 2020 09:38:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mviamari&quot; class=&quot;user-hover&quot; rel=&quot;mviamari&quot;&gt;mviamari&lt;/a&gt; Thank you for opening this ticket. This seems to be a bug indeed.&lt;/p&gt;</comment>
                            <comment id="17035407" author="cadonna" created="Wed, 12 Feb 2020 14:49:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mviamari&quot; class=&quot;user-hover&quot; rel=&quot;mviamari&quot;&gt;mviamari&lt;/a&gt; Would you be interested in fixing this bug?&lt;/p&gt;</comment>
                            <comment id="17035927" author="mviamari" created="Thu, 13 Feb 2020 05:23:42 +0000"  >&lt;p&gt;Sure. I can take a look at it. Before I get started:&lt;/p&gt;

&lt;p&gt;1) How should I think about the case where someone might unintentionally (or intentionally) be relying on the buggy behavior? Is that something I should handle in code, or is it handled elsewhere?&lt;/p&gt;

&lt;p&gt;2) I noticed that KStream#transform uses an adaptor to conform to KStream#flatTransform. Should I do something similar for KStream#transformValues and KStream#flatTransformValues, since I will be modifying that area of code already?&lt;/p&gt;</comment>
                            <comment id="17036099" author="cadonna" created="Thu, 13 Feb 2020 10:07:46 +0000"  >&lt;p&gt;Thank you for picking this up!&lt;/p&gt;

&lt;p&gt;Ad 1) We do not support backwards compatibility of bugs. The documentation is clear, we just failed to implement it correctly.&lt;/p&gt;

&lt;p&gt;Ad 2) If you want to try to simplify the code with the adapter as in &lt;tt&gt;transform()&lt;/tt&gt; and &lt;tt&gt;flatTransform()&lt;/tt&gt; you are very welcome to do so. For a smoother review process, I would like to ask you to create two PRs, one for the refactoring and one for the bug fix.&lt;/p&gt;

&lt;p&gt;Are you able to assign the ticket to yourself?&lt;/p&gt;</comment>
                            <comment id="17036291" author="mviamari" created="Thu, 13 Feb 2020 15:11:20 +0000"  >&lt;p&gt;Ok. Great. I&apos;ll address the adaptor code separately if necessary.&lt;/p&gt;

&lt;p&gt;I cannot yet assign this to myself.&lt;/p&gt;</comment>
                            <comment id="17036369" author="mjsax" created="Thu, 13 Feb 2020 17:35:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mviamari&quot; class=&quot;user-hover&quot; rel=&quot;mviamari&quot;&gt;mviamari&lt;/a&gt;&#160;Thanks for picking up this ticket &#8211; I added you to the list of contributors and you can now self-assign tickets.&lt;/p&gt;</comment>
                            <comment id="17036381" author="githubbot" created="Thu, 13 Feb 2020 17:51:19 +0000"  >&lt;p&gt;mviamari commented on pull request #8108: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9533&quot; title=&quot;JavaDocs of KStream#ValueTransform incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9533&quot;&gt;&lt;del&gt;KAFKA-9533&lt;/del&gt;&lt;/a&gt;: ValueTransform forwards `null` values&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8108&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Fixes a bug where `KStream#transformValues` would forward null values from the provided `ValueTransform#transform` operation.&lt;/p&gt;

&lt;p&gt;   A test was added for verification `shouldNotForwardNullTransformValuesWithValueTransformerWithKey`. A parallel test for non-key ValueTransformer was not added, as they share the same code path.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17040443" author="githubbot" created="Wed, 19 Feb 2020 21:20:41 +0000"  >&lt;p&gt;bbejeck commented on pull request #8108: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9533&quot; title=&quot;JavaDocs of KStream#ValueTransform incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9533&quot;&gt;&lt;del&gt;KAFKA-9533&lt;/del&gt;&lt;/a&gt;: ValueTransform forwards `null` values&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8108&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17041131" author="bbejeck" created="Thu, 20 Feb 2020 16:50:36 +0000"  >&lt;p&gt;cherry-picked to 2.5, 2.4, 2.3 and 2.2&lt;/p&gt;</comment>
                            <comment id="17044602" author="vvcephei" created="Tue, 25 Feb 2020 15:51:01 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mviamari&quot; class=&quot;user-hover&quot; rel=&quot;mviamari&quot;&gt;mviamari&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;Since merging this fix into trunk, we&apos;ve discovered some use cases that actually depend on the prior behavior. In retrospect, I think that we should fix this issue by correcting the docs, not changing the behavior.&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
I bet this started with a simple copy/paste error from the &lt;tt&gt;transform&lt;/tt&gt; API, in which returning &lt;tt&gt;null&lt;/tt&gt; (as opposed to a &lt;tt&gt;KeyValue&lt;/tt&gt; does mean to drop the record). But in that case, it makes sense, since we cannot process a record with no key. The choice is between throwing an NPE and dropping the record, so we drop the record. But this doesn&apos;t apply to &lt;tt&gt;transformValues&lt;/tt&gt;, because the result would have the same key as the input.&lt;br/&gt;
&#160;&lt;br/&gt;
Really, it&apos;s murky territory either way... Since we have &lt;tt&gt;transorm&lt;/tt&gt; and &lt;tt&gt;flatTransform&lt;/tt&gt;, as well as the &lt;tt&gt;xValues&lt;/tt&gt; overloads, it implies that &lt;tt&gt;transform&lt;/tt&gt; is one-in-to-one-out and &lt;tt&gt;flatTransform&lt;/tt&gt; is one-in-to-zero-or-more-out. In that case, if you did want to drop an input record, you should use a &lt;tt&gt;flatTransform&lt;/tt&gt; and return an empty collection. There &lt;em&gt;should&lt;/em&gt; be an invariant for &lt;tt&gt;transform&lt;/tt&gt; and &lt;tt&gt;transformValues&lt;/tt&gt; that you get exactly the same number of output records as input records, whether they are &lt;tt&gt;null&lt;/tt&gt; or otherwise.&lt;br/&gt;
&#160;&lt;br/&gt;
Since it seems like the docs, not the behavior, are wrong, and since this is pre-existing behavior going back a long way in Streams (which breaks some users&apos; code to change), we should go ahead and back out the PR. Sorry for the confusion.&lt;br/&gt;
&#160;&lt;br/&gt;
As far as the actual fix goes, I&apos;d be in favor of amending the docs to state that:&lt;br/&gt;
1. When &lt;tt&gt;KStream#transformValues&lt;/tt&gt; returns &lt;tt&gt;null&lt;/tt&gt;, there will simply be an output record with a &lt;tt&gt;null&lt;/tt&gt; value.&lt;br/&gt;
2. When &lt;tt&gt;KStream#transform&lt;/tt&gt; returns &lt;tt&gt;null&lt;/tt&gt;, we consider that to be an invalid return, and we will log a warning while dropping the record (similar to other APIs in Streams)&lt;br/&gt;
3. When &lt;tt&gt;KStream#transform&lt;/tt&gt; returns a &lt;tt&gt;KeyValue(key, null)&lt;/tt&gt;, there will simply be an output record with a null value.&lt;br/&gt;
4. When &lt;tt&gt;KStream#flatTransform&lt;/tt&gt; and &lt;tt&gt;KStream#flatTransformValues&lt;/tt&gt; return &lt;tt&gt;null&lt;/tt&gt;, we consider that to be equivalent to returning an empty collection, in which case, we don&apos;t forward any results, and also do not log a warning. (I&apos;d also be in favor of logging a warning here for consistency, but it seems like overkill).&lt;br/&gt;
&#160;&lt;br/&gt;
Accordingly, I&apos;m going to re-open this ticket, and Bill will revert the changes to fix the downstream builds. Sorry again for the trouble.&lt;br/&gt;
-John&lt;/p&gt;</comment>
                            <comment id="17044719" author="mviamari" created="Tue, 25 Feb 2020 18:16:55 +0000"  >&lt;p&gt;Ok. Thanks for the detailed explanation. I&apos;ll take a look at the changes you&apos;re proposing here as well.&lt;/p&gt;</comment>
                            <comment id="17044724" author="githubbot" created="Tue, 25 Feb 2020 18:25:04 +0000"  >&lt;p&gt;bbejeck commented on pull request #8167: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9533&quot; title=&quot;JavaDocs of KStream#ValueTransform incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9533&quot;&gt;&lt;del&gt;KAFKA-9533&lt;/del&gt;&lt;/a&gt;: Revert  ValueTransform forwards `null` &lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8167&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8167&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17044725" author="bbejeck" created="Tue, 25 Feb 2020 18:27:15 +0000"  >&lt;p&gt;reverted cherry-picks to 2.5, 2.4, 2.3, and 2.2&lt;/p&gt;</comment>
                            <comment id="17059086" author="mjsax" created="Fri, 13 Mar 2020 21:29:33 +0000"  >&lt;p&gt;The incorrect JavaDocs were introduced via&#160;&lt;a href=&quot;https://github.com/apache/kafka/commit/05668e98f531cf4d6ddb0696f0f72675ca128581&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/commit/05668e98f531cf4d6ddb0696f0f72675ca128581&lt;/a&gt; &#8211; ie, only 2.3.0 and newer is affected.&lt;/p&gt;</comment>
                            <comment id="17059088" author="githubbot" created="Fri, 13 Mar 2020 21:30:52 +0000"  >&lt;p&gt;mjsax commented on pull request #8298: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9533&quot; title=&quot;JavaDocs of KStream#ValueTransform incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9533&quot;&gt;&lt;del&gt;KAFKA-9533&lt;/del&gt;&lt;/a&gt;: Fix JavaDocs of KStream.transformValues&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8298&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8298&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   We might want to cherry-pick this back to 2.3.&lt;/p&gt;

&lt;p&gt;   Call for review @bbejeck &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17059429" author="githubbot" created="Sat, 14 Mar 2020 18:34:49 +0000"  >&lt;p&gt;mjsax commented on pull request #8298: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9533&quot; title=&quot;JavaDocs of KStream#ValueTransform incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9533&quot;&gt;&lt;del&gt;KAFKA-9533&lt;/del&gt;&lt;/a&gt;: Fix JavaDocs of KStream.transformValues&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8298&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8298&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17059431" author="mjsax" created="Sat, 14 Mar 2020 18:56:50 +0000"  >&lt;p&gt;Marking this as fixed version `2.6.0` and `2.5.1` &#8211; if we roll a new RC for 2.5, this should be updated to `2.5.0`. \cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mumrah&quot; class=&quot;user-hover&quot; rel=&quot;mumrah&quot;&gt;mumrah&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0bc94:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>