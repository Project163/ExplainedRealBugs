<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:45:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2738] Can&apos;t set SSL as inter-broker-protocol by rolling restart of brokers</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2738</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Scenario (as carefully documented by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=benstopford&quot; class=&quot;user-hover&quot; rel=&quot;benstopford&quot;&gt;benstopford&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;1. Start 2 or more brokers with listeners on both PLAINTEXT and SSL protocols, and PLAINTEXT as security.inter.broker.protocol:&lt;/p&gt;

&lt;p&gt;inter.broker.protocol.version = 0.9.0.X&lt;br/&gt;
security.inter.broker.protocol = PLAINTEXT&lt;br/&gt;
listeners = PLAINTEXT://:9092,SSL://:9093&lt;/p&gt;

&lt;p&gt;2. Stop one of the brokers and change security.inter.broker.protocol to SSL&lt;/p&gt;

&lt;p&gt;inter.broker.protocol.version = 0.9.0.X&lt;br/&gt;
security.inter.broker.protocol = SSL&lt;br/&gt;
listeners = PLAINTEXT://:9092,SSL://:9093&lt;/p&gt;

&lt;p&gt;3. Start that broker again.&lt;/p&gt;

&lt;p&gt;You will get replication errors as it will attempt to use SSL on a PLAINTEXT port:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;WARN ReplicaFetcherThread-0-3, Error in fetch kafka.server.ReplicaFetcherThread$FetchRequest@78ca3ba1. Possible cause: java.io.IOException: Connection to Node(3, worker4, 9092) failed (kafka.server.ReplicaFetcherThread)
WARN Failed to send SSL Close message (org.apache.kafka.common.network.SslTransportLayer)
java.io.IOException: Broken pipe
at sun.nio.ch.FileDispatcherImpl.write0(Native Method)
at sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:47)
at sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:93)
at sun.nio.ch.IOUtil.write(IOUtil.java:65)
at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:492)
at org.apache.kafka.common.network.SslTransportLayer.flush(SslTransportLayer.java:188)
at org.apache.kafka.common.network.SslTransportLayer.close(SslTransportLayer.java:161)
at org.apache.kafka.common.network.KafkaChannel.close(KafkaChannel.java:50)
at org.apache.kafka.common.network.Selector.close(Selector.java:448)
at org.apache.kafka.common.network.Selector.poll(Selector.java:316)
at org.apache.kafka.clients.NetworkClient.poll(NetworkClient.java:270)
at kafka.utils.NetworkClientBlockingOps$.recurse$1(NetworkClientBlockingOps.scala:128)
at kafka.utils.NetworkClientBlockingOps$.kafka$utils$NetworkClientBlockingOps$$pollUntilFound$extension(NetworkClientBlockingOps.scala:139)
at kafka.utils.NetworkClientBlockingOps$.kafka$utils$NetworkClientBlockingOps$$pollUntil$extension(NetworkClientBlockingOps.scala:105)
at kafka.utils.NetworkClientBlockingOps$.blockingReady$extension(NetworkClientBlockingOps.scala:58)
at kafka.server.ReplicaFetcherThread.sendRequest(ReplicaFetcherThread.scala:202)
at kafka.server.ReplicaFetcherThread.fetch(ReplicaFetcherThread.scala:192)
at kafka.server.ReplicaFetcherThread.fetch(ReplicaFetcherThread.scala:42)
at kafka.server.AbstractFetcherThread.processFetchRequest(AbstractFetcherThread.scala:102)
at kafka.server.AbstractFetcherThread.doWork(AbstractFetcherThread.scala:93)
at kafka.utils.ShutdownableThread.run(ShutdownableThread.scala:63)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12910207">KAFKA-2738</key>
            <summary>Can&apos;t set SSL as inter-broker-protocol by rolling restart of brokers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="benstopford">Ben Stopford</assignee>
                                    <reporter username="gwenshap">Gwen Shapira</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Nov 2015 00:48:32 +0000</created>
                <updated>Thu, 14 Mar 2024 12:05:54 +0000</updated>
                            <resolved>Thu, 5 Nov 2015 17:05:56 +0000</resolved>
                                                    <fixVersion>0.9.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14988785" author="junrao" created="Wed, 4 Nov 2015 02:49:10 +0000"  >&lt;p&gt;Good find. In ReplicaManager.makeFollowers(), we have the following code.&lt;br/&gt;
val partitionsToMakeFollowerWithLeaderAndOffset = partitionsToMakeFollower.map(partition =&amp;gt;&lt;br/&gt;
new TopicAndPartition(partition) -&amp;gt; BrokerAndInitialOffset(&lt;br/&gt;
leaders.find(_.id == partition.leaderReplicaIdOpt.get).get,&lt;br/&gt;
partition.getReplica().get.logEndOffset.messageOffset)).toMap&lt;br/&gt;
replicaFetcherManager.addFetcherForPartitions(partitionsToMakeFollowerWithLeaderAndOffset)&lt;br/&gt;
It seems that instead of passing in the BrokerEndpoint in the LeaderAndIsrRequest to replicaFetcherManager.addFetcherForPartitions, we should pick the endpoint from MetadataCache.brokers based on the security.inter.broker.protocol.&lt;/p&gt;</comment>
                            <comment id="14991228" author="githubbot" created="Thu, 5 Nov 2015 06:31:21 +0000"  >&lt;p&gt;GitHub user gwenshap opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/428&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2738&quot; title=&quot;Can&amp;#39;t set SSL as inter-broker-protocol by rolling restart of brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2738&quot;&gt;&lt;del&gt;KAFKA-2738&lt;/del&gt;&lt;/a&gt;: Replica FetcherThread should connect to leader endpoint m&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;atching its inter-broker security protocol&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/gwenshap/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/gwenshap/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2738&quot; title=&quot;Can&amp;#39;t set SSL as inter-broker-protocol by rolling restart of brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2738&quot;&gt;&lt;del&gt;KAFKA-2738&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/428.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/428.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #428&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 994fa156a0f6e818184182e7e5c852ece58191ce&lt;br/&gt;
Author: Gwen Shapira &amp;lt;cshapi@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-11-05T06:30:13Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2738&quot; title=&quot;Can&amp;#39;t set SSL as inter-broker-protocol by rolling restart of brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2738&quot;&gt;&lt;del&gt;KAFKA-2738&lt;/del&gt;&lt;/a&gt;: Replica FetcherThread should connect to leader endpoint matching its inter-broker security protocol&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14991230" author="gwenshap" created="Thu, 5 Nov 2015 06:34:07 +0000"  >&lt;p&gt;The PR above fixes the issue we saw.&lt;/p&gt;

&lt;p&gt;Two notes:&lt;br/&gt;
1. We keep passing metadata cache references around ReplicaManager. It will be nice to refactor a bit and initialize ReplicaManager with MetadataCache as a member, so we can avoid passing references around. I avoided this in this PR to keep it focused.&lt;/p&gt;

&lt;p&gt;2. I kept running into timeouts with controlled shutdown while testing this. It doesn&apos;t seem like the same issue (i.e. they reproduced very inconsistently on both SSL and PLAINTEXT brokers), but worth keeping in mind.&lt;/p&gt;</comment>
                            <comment id="14991999" author="guozhang" created="Thu, 5 Nov 2015 17:05:56 +0000"  >&lt;p&gt;Issue resolved by pull request 428&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/428&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14992000" author="githubbot" created="Thu, 5 Nov 2015 17:05:58 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/428&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nwzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>junrao</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>