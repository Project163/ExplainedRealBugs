<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:37:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-738] correlationId is not set in FetchRequest in AbstractFetcherThread</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-738</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;correlationId is always 0 in FetchRequest in AbstractFetcherThread.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12629462">KAFKA-738</key>
            <summary>correlationId is not set in FetchRequest in AbstractFetcherThread</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="junrao">Jun Rao</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                            <label>p2</label>
                    </labels>
                <created>Sun, 27 Jan 2013 23:17:26 +0000</created>
                <updated>Wed, 30 Jan 2013 01:14:37 +0000</updated>
                            <resolved>Wed, 30 Jan 2013 01:01:45 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13563965" author="swapnilghike" created="Mon, 28 Jan 2013 00:30:56 +0000"  >&lt;p&gt;Probably because we create a new FetchRequestBuilder object in AbstractFetcherThread.doWork() and create the fetchRequest as &lt;/p&gt;

&lt;p&gt;val fetchRequest = fetchRequestBuilder.build() // this sets correlationId in fetchRequest to 0.&lt;/p&gt;
</comment>
                            <comment id="13564791" author="junrao" created="Mon, 28 Jan 2013 22:45:12 +0000"  >&lt;p&gt;Attach a patch. &lt;/p&gt;

&lt;p&gt;Yes, we have to create a new FetchRequestBuilder every time, since some of the old values need to be cleared.&lt;/p&gt;</comment>
                            <comment id="13564824" author="swapnilghike" created="Mon, 28 Jan 2013 23:15:53 +0000"  >&lt;p&gt;With this patch, all fetchRequests in SimpleConsumerShell will have correlationId = 0. This will happen in a bunch of unit tests too.&lt;br/&gt;
A solution could be to use the same fetchRequestBuilder in AbstractFetcherThread, but clear its old values every time in doWork(). This way we can make sure that a fetchRequestBuilder can increment its own correlationId with every call to build().&lt;/p&gt;</comment>
                            <comment id="13564869" author="junrao" created="Tue, 29 Jan 2013 00:08:54 +0000"  >&lt;p&gt;Attach patch v2 that fixes the simpleConsumerShell issue. Overall, it seems it&apos;s safer if we don&apos;t reuse the request builder.&lt;/p&gt;</comment>
                            <comment id="13564887" author="swapnilghike" created="Tue, 29 Jan 2013 00:21:57 +0000"  >&lt;p&gt;I see. Actually the same issue is present in hadoop-consumer&apos;s use of builder.build(). Unit tests look fine with patch v2.&lt;/p&gt;</comment>
                            <comment id="13564896" author="nehanarkhede" created="Tue, 29 Jan 2013 00:27:34 +0000"  >&lt;p&gt;We don&apos;t use the builder pattern the way it is supposed to be used. The builder is created once, setting the required values and calling build() happens multiple times. In our case, this is complicated because we maintain some state in the request map, but this can easily be resolved by providing a resetBuilder() API. That way, it will work for SimpleConsumer and high level consumer&lt;/p&gt;</comment>
                            <comment id="13565618" author="junrao" created="Tue, 29 Jan 2013 18:20:08 +0000"  >&lt;p&gt;Attach patch v3. Having a separate reset() method adds more work to the client. Changed it to reset the map after build().&lt;/p&gt;</comment>
                            <comment id="13565631" author="nehanarkhede" created="Tue, 29 Jan 2013 18:32:04 +0000"  >&lt;p&gt;Thanks for the new patch. Some more comments -&lt;/p&gt;

&lt;p&gt;1. FetchRequest&lt;br/&gt;
1.1 Remove unused import import java.util.concurrent.atomic.AtomicInteger&lt;br/&gt;
1.2 I thought you wanted to clear the map in the build method. Don&apos;t see that change included in this patch ?&lt;/p&gt;

&lt;p&gt;2. FetchRequestBuilder&lt;br/&gt;
2.1 It is not ideal to have the SimpleConsumer set the correlation id correctly on each fetch request. It is better to leave it as it was done before (increment the correlation id in build()) and just change it to use Utils.getNextNonNegativeInt.&lt;/p&gt;</comment>
                            <comment id="13565790" author="junrao" created="Tue, 29 Jan 2013 20:47:37 +0000"  >&lt;p&gt;Sorry, attached the wrong patch. Attach the correct one v3 this time.&lt;/p&gt;</comment>
                            <comment id="13565888" author="nehanarkhede" created="Tue, 29 Jan 2013 22:30:23 +0000"  >&lt;p&gt;+1 on the latest patch&lt;/p&gt;</comment>
                            <comment id="13565965" author="swapnilghike" created="Tue, 29 Jan 2013 23:31:51 +0000"  >&lt;p&gt;Though with this patch, the requestMap will be cleared in SimpleConsumerShell and other places that use build(), which is not the case currently.&lt;/p&gt;</comment>
                            <comment id="13565992" author="swapnilghike" created="Wed, 30 Jan 2013 00:12:08 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13566026" author="junrao" created="Wed, 30 Jan 2013 01:01:45 +0000"  >&lt;p&gt;Thanks for the review. Committed to 0.8.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12567018" name="kafka-738.patch" size="6644" author="junrao" created="Tue, 29 Jan 2013 18:20:08 +0000"/>
                            <attachment id="12566842" name="kafka-738.patch" size="2887" author="junrao" created="Mon, 28 Jan 2013 22:45:12 +0000"/>
                            <attachment id="12566857" name="kafka-738_v2.patch" size="5604" author="junrao" created="Tue, 29 Jan 2013 00:08:54 +0000"/>
                            <attachment id="12567044" name="kafka-738_v3.patch" size="1872" author="junrao" created="Tue, 29 Jan 2013 20:47:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>309958</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hhrb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310302</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>