<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:39:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1154] replicas may not have consistent data after becoming follower</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1154</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;This is an issued introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1001&quot; title=&quot;Handle follower transition in batch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1001&quot;&gt;&lt;del&gt;KAFKA-1001&lt;/del&gt;&lt;/a&gt;. The issue is that in ReplicaManager.makeFollowers(), we truncate the log before marking the replica as the follower. New messages from the producer can still be added to the log after the log is truncated, but before the replica is marked as the follower. Those newly produced messages can actually be committed, which implies those truncated messages are also committed. However, the new leader is not guaranteed to have those truncated messages.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12682043">KAFKA-1154</key>
            <summary>replicas may not have consistent data after becoming follower</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="junrao">Jun Rao</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                    </labels>
                <created>Sun, 1 Dec 2013 23:29:21 +0000</created>
                <updated>Mon, 2 Dec 2013 21:58:10 +0000</updated>
                            <resolved>Mon, 2 Dec 2013 21:58:10 +0000</resolved>
                                    <version>0.8.1</version>
                                    <fixVersion>0.8.1</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13836141" author="junrao" created="Sun, 1 Dec 2013 23:32:27 +0000"  >&lt;p&gt;The fix is to switch the ordering in ReplicaManager.makeFollowers(). We should first mark the replica as the follower before truncating the log. This will ensure that after the log is truncated, no new messages from the produce requests will be added to the log.&lt;/p&gt;</comment>
                            <comment id="13836142" author="junrao" created="Sun, 1 Dec 2013 23:33:42 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/15938/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/15938/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13836144" author="junrao" created="Sun, 1 Dec 2013 23:38:30 +0000"  >&lt;p&gt;Attach a patch. Also made a minor change in KafkaApis to only expose data up to the high watermark to the debugger consumer. Data after the high watermark can be truncated and therefore could change after the consumer has read it. This fix will prevent the ReplicaVerificationTool to read stale data.&lt;/p&gt;</comment>
                            <comment id="13836683" author="nehanarkhede" created="Mon, 2 Dec 2013 16:48:42 +0000"  >&lt;p&gt;We used to do this, looks like this was a regression introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1001&quot; title=&quot;Handle follower transition in batch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1001&quot;&gt;&lt;del&gt;KAFKA-1001&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;1. ReplicaManager&lt;br/&gt;
Do we still need this &quot;TODO: the above may need to be fixed later&quot; ?&lt;/p&gt;

&lt;p&gt;2. We had added the ability for a special consumer to read the replica log for troubleshooting. This patch takes that convenience away. We should probably look for another way to prevent the replica verification tool from giving false negatives. Can it use a different consumer id?&lt;/p&gt;</comment>
                            <comment id="13836969" author="junrao" created="Mon, 2 Dec 2013 21:58:10 +0000"  >&lt;p&gt;Thanks for the review. Committed to trunk after addressing the minor review comments.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12616491" name="KAFKA-1154.patch" size="9489" author="junrao" created="Sun, 1 Dec 2013 23:33:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361300</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 51 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qa53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361599</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>