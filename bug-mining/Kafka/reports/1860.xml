<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:08:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6680] Fix config initialization in DynamicBrokerConfig</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6680</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Below issues observed while testing dynamic config update feature&lt;/p&gt;

&lt;p&gt;1.&#160;&lt;tt&gt;kafkaConfig&lt;/tt&gt;&#160;doesn&apos;t get updated during&#160;&lt;tt&gt;initialize&lt;/tt&gt;&#160;if there are no dynamic configs defined in ZK.&lt;/p&gt;

&lt;p&gt;2.&#160; update&#160;DynamicListenerConfig.validateReconfiguration() to check new Listeners must be subset of listener map&lt;/p&gt;</description>
                <environment></environment>
        <key id="13146207">KAFKA-6680</key>
            <summary>Fix config initialization in DynamicBrokerConfig</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="omkreddy">Manikumar</assignee>
                                    <reporter username="omkreddy">Manikumar</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Mar 2018 11:58:29 +0000</created>
                <updated>Fri, 23 Mar 2018 16:53:44 +0000</updated>
                            <resolved>Fri, 23 Mar 2018 16:53:44 +0000</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16405008" author="omkreddy" created="Mon, 19 Mar 2018 15:53:29 +0000"  >&lt;p&gt;PR: &lt;a href=&quot;https://github.com/apache/kafka/pull/4731&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4731&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16405544" author="githubbot" created="Mon, 19 Mar 2018 22:22:56 +0000"  >&lt;p&gt;rajinisivaram closed pull request #4731:  &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6680&quot; title=&quot;Fix config initialization in DynamicBrokerConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6680&quot;&gt;&lt;del&gt;KAFKA-6680&lt;/del&gt;&lt;/a&gt;: Fix issues related to Dynamic Broker configs&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4731&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4731&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/core/src/main/scala/kafka/server/DynamicBrokerConfig.scala b/core/src/main/scala/kafka/server/DynamicBrokerConfig.scala&lt;br/&gt;
index 3236af01bbb..92fd5d73136 100755&lt;br/&gt;
&amp;#8212; a/core/src/main/scala/kafka/server/DynamicBrokerConfig.scala&lt;br/&gt;
+++ b/core/src/main/scala/kafka/server/DynamicBrokerConfig.scala&lt;br/&gt;
@@ -137,6 +137,7 @@ class DynamicBrokerConfig(private val kafkaConfig: KafkaConfig) extends Logging&lt;br/&gt;
   private val dynamicConfigPasswordEncoder = maybeCreatePasswordEncoder(kafkaConfig.passwordEncoderSecret)&lt;/p&gt;

&lt;p&gt;   private&lt;span class=&quot;error&quot;&gt;&amp;#91;server&amp;#93;&lt;/span&gt; def initialize(zkClient: KafkaZkClient): Unit = {&lt;br/&gt;
+    currentConfig = new KafkaConfig(kafkaConfig.props, false, None)&lt;br/&gt;
     val adminZkClient = new AdminZkClient(zkClient)&lt;br/&gt;
     updateDefaultConfig(adminZkClient.fetchEntityConfig(ConfigType.Broker, ConfigEntityName.Default))&lt;br/&gt;
     val props = adminZkClient.fetchEntityConfig(ConfigType.Broker, kafkaConfig.brokerId.toString)&lt;br/&gt;
@@ -719,8 +720,8 @@ class DynamicListenerConfig(server: KafkaServer) extends BrokerReconfigurable wi&lt;br/&gt;
     val oldListeners = listenersToMap(oldConfig.listeners)&lt;br/&gt;
     if (!newAdvertisedListeners.keySet.subsetOf(newListeners.keySet))&lt;br/&gt;
       throw new ConfigException(s&quot;Advertised listeners &apos;$newAdvertisedListeners&apos; must be a subset of listeners &apos;$newListeners&apos;&quot;)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (newListeners.keySet != newConfig.listenerSecurityProtocolMap.keySet)&lt;/li&gt;
	&lt;li&gt;throw new ConfigException(s&quot;Listeners &apos;$newListeners&apos; and listener map &apos;${newConfig.listenerSecurityProtocolMap}&apos; don&apos;t match&quot;)&lt;br/&gt;
+    if (!newListeners.keySet.subsetOf(newConfig.listenerSecurityProtocolMap.keySet))&lt;br/&gt;
+      throw new ConfigException(s&quot;Listeners &apos;$newListeners&apos; must be subset of listener map &apos;${newConfig.listenerSecurityProtocolMap}&apos;&quot;)&lt;br/&gt;
     newListeners.keySet.intersect(oldListeners.keySet).foreach { listenerName =&amp;gt;&lt;br/&gt;
       val prefix = listenerName.configPrefix&lt;br/&gt;
       val newListenerProps = immutableListenerConfigs(newConfig, prefix)&lt;br/&gt;
diff --git a/core/src/test/scala/unit/kafka/server/DynamicBrokerConfigTest.scala b/core/src/test/scala/unit/kafka/server/DynamicBrokerConfigTest.scala&lt;br/&gt;
index 2e3e2742dbc..bca98d2cee0 100755
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/core/src/test/scala/unit/kafka/server/DynamicBrokerConfigTest.scala&lt;br/&gt;
+++ b/core/src/test/scala/unit/kafka/server/DynamicBrokerConfigTest.scala&lt;br/&gt;
@@ -24,10 +24,12 @@ import kafka.utils.TestUtils&lt;br/&gt;
 import org.apache.kafka.common.Reconfigurable&lt;br/&gt;
 import org.apache.kafka.common.config.types.Password&lt;br/&gt;
 import org.apache.kafka.common.config.
{ConfigException, SslConfigs}
&lt;p&gt;+import org.easymock.EasyMock&lt;br/&gt;
 import org.junit.Assert._&lt;br/&gt;
 import org.junit.Test&lt;/p&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; import scala.collection.JavaConverters._&lt;br/&gt;
+import scala.collection.Set&lt;/p&gt;

&lt;p&gt; class DynamicBrokerConfigTest {&lt;/p&gt;

&lt;p&gt;@@ -248,4 +250,56 @@ class DynamicBrokerConfigTest &lt;/p&gt;
{
     newConfigWithNewSecret.dynamicConfig.updateBrokerConfig(0, persistedProps)
     assertEquals(&quot;staticLoginModule required;&quot;, newConfigWithNewSecret.values.get(KafkaConfig.SaslJaasConfigProp).asInstanceOf[Password].value)
   }
&lt;p&gt;+&lt;br/&gt;
+  @Test&lt;br/&gt;
+  def testDynamicListenerConfig(): Unit = &lt;/p&gt;
{
+    val props = TestUtils.createBrokerConfig(0, TestUtils.MockZkConnect, port = 9092)
+    val oldConfig =  KafkaConfig.fromProps(props)
+    val kafkaServer = EasyMock.createMock(classOf[kafka.server.KafkaServer])
+    EasyMock.expect(kafkaServer.config).andReturn(oldConfig).anyTimes()
+    EasyMock.replay(kafkaServer)
+
+    props.put(KafkaConfig.ListenersProp, &quot;PLAINTEXT://hostname:9092,SASL_PLAINTEXT://hostname:9093&quot;)
+    val newConfig = KafkaConfig(props)
+
+    val dynamicListenerConfig = new DynamicListenerConfig(kafkaServer)
+    dynamicListenerConfig.validateReconfiguration(newConfig)
+  }
&lt;p&gt;+&lt;br/&gt;
+  @Test&lt;br/&gt;
+  def testDynamicConfigInitializationWithoutConfigsInZK(): Unit = &lt;/p&gt;
{
+    val zkClient = EasyMock.createMock(classOf[kafka.zk.KafkaZkClient])
+    EasyMock.expect(zkClient.getEntityConfigs(EasyMock.anyString(), EasyMock.anyString())).andReturn(new java.util.Properties()).anyTimes()
+    EasyMock.replay(zkClient)
+
+    val oldConfig =  KafkaConfig.fromProps(TestUtils.createBrokerConfig(0, TestUtils.MockZkConnect, port = 9092))
+    val dynamicBrokerConfig = new DynamicBrokerConfig(oldConfig)
+    dynamicBrokerConfig.initialize(zkClient)
+    dynamicBrokerConfig.addBrokerReconfigurable(new TestDynamicThreadPool)
+
+    val newprops = new Properties()
+    newprops.put(KafkaConfig.NumIoThreadsProp, &quot;10&quot;)
+    newprops.put(KafkaConfig.BackgroundThreadsProp, &quot;100&quot;)
+    dynamicBrokerConfig.updateBrokerConfig(0, newprops)
+  }
&lt;p&gt; }&lt;br/&gt;
+&lt;br/&gt;
+class TestDynamicThreadPool() extends BrokerReconfigurable {&lt;br/&gt;
+&lt;br/&gt;
+  override def reconfigurableConfigs: Set&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt; = &lt;/p&gt;
{
+    DynamicThreadPool.ReconfigurableConfigs
+  }
&lt;p&gt;+&lt;br/&gt;
+  override def reconfigure(oldConfig: KafkaConfig, newConfig: KafkaConfig): Unit = &lt;/p&gt;
{
+    assertEquals(Defaults.NumIoThreads, oldConfig.numIoThreads)
+    assertEquals(Defaults.BackgroundThreads, oldConfig.backgroundThreads)
+
+    assertEquals(10, newConfig.numIoThreads)
+    assertEquals(100, newConfig.backgroundThreads)
+  }
&lt;p&gt;+&lt;br/&gt;
+  override def validateReconfiguration(newConfig: KafkaConfig): Unit = &lt;/p&gt;
{
+    assertEquals(10, newConfig.numIoThreads)
+    assertEquals(100, newConfig.backgroundThreads)
+  }
&lt;p&gt;+}&lt;br/&gt;
\ No newline at end of file&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16406439" author="githubbot" created="Tue, 20 Mar 2018 14:52:50 +0000"  >&lt;p&gt;rajinisivaram opened a new pull request #4740: MINOR: Document workaround for &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6680&quot; title=&quot;Fix config initialization in DynamicBrokerConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6680&quot;&gt;&lt;del&gt;KAFKA-6680&lt;/del&gt;&lt;/a&gt; for 1.1&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4740&lt;/a&gt;&lt;/p&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16407769" author="githubbot" created="Wed, 21 Mar 2018 11:21:08 +0000"  >&lt;p&gt;rajinisivaram closed pull request #4740: MINOR: Document workaround for &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6680&quot; title=&quot;Fix config initialization in DynamicBrokerConfig&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6680&quot;&gt;&lt;del&gt;KAFKA-6680&lt;/del&gt;&lt;/a&gt; for 1.1&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4740&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/docs/configuration.html b/docs/configuration.html&lt;br/&gt;
index df58ba76b77..7b975ba1d57 100644&lt;br/&gt;
&amp;#8212; a/docs/configuration.html&lt;br/&gt;
+++ b/docs/configuration.html&lt;br/&gt;
@@ -189,6 +189,12 @@ &amp;lt;h5&amp;gt;Adding and Removing Listeners&amp;lt;/h5&amp;gt;&lt;br/&gt;
   Inter-broker listener must be configured using the static broker configuration &amp;lt;code&amp;gt;inter.broker.listener.name&amp;lt;/code&amp;gt;&lt;br/&gt;
   or &amp;lt;code&amp;gt;inter.broker.security.protocol&amp;lt;/code&amp;gt;.&lt;/p&gt;

&lt;p&gt;+  &amp;lt;p&amp;gt;&amp;lt;b&amp;gt;Note:&amp;lt;/b&amp;gt; In Kafka version 1.1.0, thread config updates and listener updates are processed by a broker only if at least one other&lt;br/&gt;
+  broker config was configured dynamically prior to this update. To workaround this issue, a dummy property may be dynamically configured&lt;br/&gt;
+  prior to an update of thread/listener configs or the update may be retried after reverting the change. Dynamic update of listeners in&lt;br/&gt;
+  1.1.0 requires &amp;lt;code&amp;gt;listener.security.protocol.map&amp;lt;/code&amp;gt; to be updated to a map containing security protocols for all the listeners,&lt;br/&gt;
+  even if listener name is a security protocol. These issues will be fixed in the next release.&lt;br/&gt;
+&lt;br/&gt;
   &amp;lt;h3&amp;gt;&amp;lt;a id=&quot;topicconfigs&quot; href=&quot;#topicconfigs&quot;&amp;gt;3.2 Topic-Level Configs&amp;lt;/a&amp;gt;&amp;lt;/h3&amp;gt;&lt;/p&gt;

&lt;p&gt;   Configurations pertinent to topics have both a server default as well an optional per-topic override. If no per-topic configuration is given the server default is used. The override can be set at topic creation time by giving one or more &amp;lt;code&amp;gt;--config&amp;lt;/code&amp;gt; options. This example creates a topic named &amp;lt;i&amp;gt;my-topic&amp;lt;/i&amp;gt; with a custom max message size and flush rate:&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3rhkf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>