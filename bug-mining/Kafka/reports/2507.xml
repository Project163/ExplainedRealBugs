<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:22:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-8025] Flaky Test RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest#shouldForwardAllDbOptionsCalls</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-8025</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;At least one occurence where the following unit test case failed on a jenkins job that didn&apos;t involve any related changes.&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/kafka-pr-jdk11-scala2.12/2783/consoleFull&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/kafka-pr-jdk11-scala2.12/2783/consoleFull&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have not been able to reproduce it locally on Linux. (For instance 20 consecutive runs of this class pass all test cases)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
14:06:13 org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest &amp;gt; shouldForwardAllDbOptionsCalls STARTED 14:06:14 org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.shouldForwardAllDbOptionsCalls failed, log available in /home/jenkins/jenkins-slave/workspace/kafka-pr-jdk11-scala2.12/streams/build/reports/testOutput/org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.shouldForwardAllDbOptionsCalls.test.stdout 14:06:14 14:06:14 org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest &amp;gt; shouldForwardAllDbOptionsCalls FAILED 14:06:14 &#160; &#160; java.lang.AssertionError: 14:06:14 &#160; &#160; Expected: a string matching the pattern &lt;span class=&quot;code-quote&quot;&gt;&apos;Unexpected method call DBOptions\.baseBackgroundCompactions((.* 14:06:14 &#160; &#160; *)*):&apos;&lt;/span&gt; 14:06:14&#160; &#160; &#160; &#160; &#160; but: was &lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected method call DBOptions.baseBackgroundCompactions():\n&#160; &#160; DBOptions.close(): expected: 3, actual: 0&quot;&lt;/span&gt; 14:06:14 &#160; &#160; &#160; &#160; at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18) 14:06:14 &#160; &#160; &#160; &#160; at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:6) 14:06:14 &#160; &#160; &#160; &#160; at org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.verifyDBOptionsMethodCall(RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.java:121) 14:06:14 &#160; &#160; &#160; &#160; at org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.shouldForwardAllDbOptionsCalls(RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.java:101) 14:06:14 14:06:14 org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest &amp;gt; shouldForwardAllColumnFamilyCalls STARTED 14:06:14 14:06:14 org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest &amp;gt; shouldForwardAllColumnFamilyCalls PASSED

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13218920">KAFKA-8025</key>
            <summary>Flaky Test RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest#shouldForwardAllDbOptionsCalls</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mjsax">Matthias J. Sax</assignee>
                                    <reporter username="kkonstantine">Konstantine Karantasis</reporter>
                        <labels>
                            <label>flaky-test</label>
                    </labels>
                <created>Fri, 1 Mar 2019 16:18:08 +0000</created>
                <updated>Tue, 18 Feb 2020 20:29:41 +0000</updated>
                            <resolved>Tue, 18 Feb 2020 20:29:41 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.2.3</fixVersion>
                    <fixVersion>2.3.2</fixVersion>
                    <fixVersion>2.4.1</fixVersion>
                    <fixVersion>2.5.0</fixVersion>
                                    <component>streams</component>
                    <component>unit tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16782598" author="mjsax" created="Sun, 3 Mar 2019 05:37:44 +0000"  >&lt;p&gt;Failed again: &lt;a href=&quot;https://builds.apache.org/job/kafka-pr-jdk11-scala2.12/2827/testReport/junit/org.apache.kafka.streams.state.internals/RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest/shouldForwardAllDbOptionsCalls/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/kafka-pr-jdk11-scala2.12/2827/testReport/junit/org.apache.kafka.streams.state.internals/RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest/shouldForwardAllDbOptionsCalls/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Different stack trace:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;java.lang.AssertionError: Expected: a string matching the pattern &apos;Unexpected method call DBOptions\.setBaseBackgroundCompactions((.* &lt;b&gt;)&lt;/b&gt;):&apos; but: was &quot;Unexpected method call DBOptions.setBaseBackgroundCompactions(0 (int)):\n DBOptions.close(): expected: 2, actual: 0&quot; at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18) at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:6) at org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.verifyDBOptionsMethodCall(RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.java:121) at org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.shouldForwardAllDbOptionsCalls(RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.java:101)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16783877" author="bbejeck" created="Mon, 4 Mar 2019 23:10:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/6370&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6370&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16788180" author="mjsax" created="Fri, 8 Mar 2019 18:47:34 +0000"  >&lt;p&gt;Failed again: &lt;a href=&quot;https://builds.apache.org/blue/organizations/jenkins/kafka-trunk-jdk8/detail/kafka-trunk-jdk8/3446/tests&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/blue/organizations/jenkins/kafka-trunk-jdk8/detail/kafka-trunk-jdk8/3446/tests&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16820402" author="githubbot" created="Wed, 17 Apr 2019 18:40:14 +0000"  >&lt;p&gt;bbejeck commented on pull request #6370: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8025&quot; title=&quot;Flaky Test RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest#shouldForwardAllDbOptionsCalls&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8025&quot;&gt;&lt;del&gt;KAFKA-8025&lt;/del&gt;&lt;/a&gt;: Update regex to allow any chars after &quot;:&quot;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6370&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6370&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16912888" author="mjsax" created="Thu, 22 Aug 2019 02:55:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/kafka-pr-jdk11-scala2.12/7098/testReport/junit/org.apache.kafka.streams.state.internals/RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest/shouldForwardAllDbOptionsCalls/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/kafka-pr-jdk11-scala2.12/7098/testReport/junit/org.apache.kafka.streams.state.internals/RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest/shouldForwardAllDbOptionsCalls/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16943286" author="ableegoldman" created="Thu, 3 Oct 2019 02:07:16 +0000"  >&lt;p&gt;Failed locally for me with&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.AssertionError: 
Expected: a string matching the pattern &lt;span class=&quot;code-quote&quot;&gt;&apos;Unexpected method call DBOptions\.walBytesPerSync((.**)*):&apos;&lt;/span&gt;
     but: was &lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected method call DBOptions.walBytesPerSync():\n    DBOptions.close(): expected: 2, actual: 0&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16952258" author="mjsax" created="Tue, 15 Oct 2019 20:09:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/kafka-pr-jdk11-scala2.12/8633/testReport/junit/org.apache.kafka.streams.state.internals/RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest/shouldForwardAllDbOptionsCalls/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/kafka-pr-jdk11-scala2.12/8633/testReport/junit/org.apache.kafka.streams.state.internals/RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest/shouldForwardAllDbOptionsCalls/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16952336" author="guozhang" created="Tue, 15 Oct 2019 22:20:48 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Stacktrace
java.lang.AssertionError: 
Expected: a string matching the pattern &apos;Unexpected method call DBOptions\.setEnableThreadTracking((.*
*)*):&apos;
     but: was &lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected method call DBOptions.setEnableThreadTracking(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;):\n    DBOptions.close(): expected: 1, actual: 0&quot;&lt;/span&gt;
	at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
	at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:6)
	at org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.verifyDBOptionsMethodCall(RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.java:126)
	at org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.shouldForwardAllDbOptionsCalls(RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.java:106)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:305)
	at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:365)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)
	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:330)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:78)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:328)
	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:65)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:292)
	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:305)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:412)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.runTestClass(JUnitTestClassExecutor.java:110)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.execute(JUnitTestClassExecutor.java:58)
	at org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.execute(JUnitTestClassExecutor.java:38)
	at org.gradle.api.internal.tasks.testing.junit.AbstractJUnitTestClassProcessor.processTestClass(AbstractJUnitTestClassProcessor.java:62)
	at org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:51)
	at jdk.internal.reflect.GeneratedMethodAccessor12.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)
	at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.internal.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:33)
	at org.gradle.internal.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:94)
	at com.sun.proxy.$Proxy5.processTestClass(Unknown Source)
	at org.gradle.api.internal.tasks.testing.worker.TestWorker.processTestClass(TestWorker.java:118)
	at jdk.internal.reflect.GeneratedMethodAccessor11.invoke(Unknown Source)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
	at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)
	at org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)
	at org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:182)
	at org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:164)
	at org.gradle.internal.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:412)
	at org.gradle.internal.concurrent.ExecutorPolicy$CatchAndRecordFailures.onExecute(ExecutorPolicy.java:64)
	at org.gradle.internal.concurrent.ManagedExecutorImpl$1.run(ManagedExecutorImpl.java:48)
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)
	at org.gradle.internal.concurrent.ThreadFactoryImpl$ManagedThreadRunnable.run(ThreadFactoryImpl.java:56)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:834)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16952523" author="mjsax" created="Wed, 16 Oct 2019 05:38:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/kafka-pr-jdk8-scala2.11/25869/testReport/junit/org.apache.kafka.streams.state.internals/RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest/shouldForwardAllDbOptionsCalls/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/kafka-pr-jdk8-scala2.11/25869/testReport/junit/org.apache.kafka.streams.state.internals/RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest/shouldForwardAllDbOptionsCalls/&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;java.lang.AssertionError: Expected: an instance of java.lang.AssertionError but: &amp;lt;java.lang.NullPointerException&amp;gt; is a java.lang.NullPointerException at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18) at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:6) at org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.verifyDBOptionsMethodCall(RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.java:160) at org.apache.kafka.streams.state.internals.RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.shouldForwardAllDbOptionsCalls(RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest.java:109)&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="16997656" author="bbejeck" created="Mon, 16 Dec 2019 21:36:16 +0000"  >&lt;p&gt;I ran this test locally 10K times and I was not able to get a repeat failure.&lt;/p&gt;</comment>
                            <comment id="17037962" author="mjsax" created="Sun, 16 Feb 2020 20:28:31 +0000"  >&lt;p&gt;Failed again on Jenkins (I am really puzzled what the problem could be...)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/kafka-pr-jdk11-scala2.13/4743/testReport/junit/org.apache.kafka.streams.state.internals/RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest/shouldForwardAllDbOptionsCalls/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/kafka-pr-jdk11-scala2.13/4743/testReport/junit/org.apache.kafka.streams.state.internals/RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest/shouldForwardAllDbOptionsCalls/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17037974" author="githubbot" created="Sun, 16 Feb 2020 21:14:53 +0000"  >&lt;p&gt;mjsax commented on pull request #8126: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8025&quot; title=&quot;Flaky Test RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest#shouldForwardAllDbOptionsCalls&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8025&quot;&gt;&lt;del&gt;KAFKA-8025&lt;/del&gt;&lt;/a&gt;: Fix flaky RocksDB test&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8126&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Reading the stack trace on the Jira, I think the issue might be related to the shared mock object we use.&lt;/p&gt;

&lt;p&gt;   The test testup is a little bit upside down to allow the usage of reflection. The test verifies that a method is called, by &lt;em&gt;not&lt;/em&gt; registering an expected call, and catching the corresponding exception from `verify()` (because we use reflections, we cannot easily register an expected call and let `verify()` throw if the call was not made).&lt;/p&gt;

&lt;p&gt;   Thus, the expected message from `verify()` is something like:&lt;br/&gt;
   ```&lt;br/&gt;
   Unexpected method call DBOptions.setEnableThreadTracking(true):&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;   When the test fails the stack trace says:&lt;br/&gt;
   ```&lt;br/&gt;
   Unexpected method call DBOptions.setEnableThreadTracking(true):\n    DBOptions.close(): expected: 1, actual: 0&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;   It indicates that an expected call was registered, however, the test actually never does this. Thus, I suspect that the mocked object is not isolated and as the tests are executed in parallel some race-condition applies (eg, one thread calls a method in the actual test to eventually trigger the exception in verify, while the other thread is just calling `replay()` accidentally register the call of the other thread as expected method call). &lt;/p&gt;

&lt;p&gt;   This fix tries to address the issue, by moving the mocked objects as local variables into the test methods.&lt;/p&gt;

&lt;p&gt;   Call for review @vvcephei @bbejeck @cadonna &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17039392" author="githubbot" created="Tue, 18 Feb 2020 19:29:20 +0000"  >&lt;p&gt;mjsax commented on pull request #8126: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8025&quot; title=&quot;Flaky Test RocksDBGenericOptionsToDbOptionsColumnFamilyOptionsAdapterTest#shouldForwardAllDbOptionsCalls&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8025&quot;&gt;&lt;del&gt;KAFKA-8025&lt;/del&gt;&lt;/a&gt;: Fix flaky RocksDB test&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8126&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 38 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z008js:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>