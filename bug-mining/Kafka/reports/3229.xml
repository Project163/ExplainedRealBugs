<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:30:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-12841] NPE from the provided metadata in client callback in case of ApiException</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-12841</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;1.&lt;br/&gt;
org.apache.kafka.clients.producer.Callback interface has method&#160;onCompletion(...)&lt;br/&gt;
Which says as part of the documentation :&lt;/p&gt;

&lt;p&gt;&lt;b&gt;The metadata for the record that was sent (i.e. the partition and offset). *An empty metadata with -1 value for all fields&lt;/b&gt; except for topicPartition will be returned if an error occurred.&lt;/p&gt;


&lt;p&gt;We got an NPE from&#160;doSend(...) method in&#160;org.apache.kafka.clients.producer.KafkaProducer&#160;&lt;br/&gt;
Which can occur in case ApiException was thrown ...&lt;br/&gt;
In case of ApiException it uses the regular callback instead of&#160;InterceptorCallback which also may cover the NPE.&lt;/p&gt;

&lt;p&gt;2. More over&#160;RecordMetadata has method&#160;partition() which return int but can also throw NPE because TopicPartition might be null.&lt;/p&gt;

&lt;p&gt;Stack trace attached.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>Prod</environment>
        <key id="13380072">KAFKA-12841</key>
            <summary>NPE from the provided metadata in client callback in case of ApiException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pnee">Philip Nee</assignee>
                                    <reporter username="ayouk">Avi Youkhananov</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 May 2021 11:08:47 +0000</created>
                <updated>Thu, 2 Jan 2025 03:36:20 +0000</updated>
                            <resolved>Tue, 26 Apr 2022 18:07:07 +0000</resolved>
                                    <version>2.6.0</version>
                                    <fixVersion>3.2.0</fixVersion>
                                    <component>clients</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17372217" author="kirktrue" created="Wed, 30 Jun 2021 22:08:51 +0000"  >&lt;p&gt;I&apos;d like to take a stab at this bug. Can someone kindly assign it to me? TIA.&lt;/p&gt;</comment>
                            <comment id="17372984" author="kirktrue" created="Thu, 1 Jul 2021 18:20:35 +0000"  >&lt;p&gt;There are some conditions inside the &lt;tt&gt;KafkaProducer&lt;/tt&gt;&apos;s &lt;tt&gt;doSend&lt;/tt&gt; method that will result in an &lt;tt&gt;ApiException&lt;/tt&gt; being thrown before the &lt;tt&gt;TopicPartition&lt;/tt&gt; (&lt;tt&gt;tp&lt;/tt&gt;) is created. As a result, &lt;tt&gt;tp&lt;/tt&gt; is null and case #2 listed in the initial bug report occurs.&lt;/p&gt;

&lt;p&gt;Would it be OK to create a new, &quot;dummy&quot; &lt;tt&gt;TopicPartition&lt;/tt&gt; in this case? We could use the topic from the &lt;tt&gt;ProducerRecord&lt;/tt&gt;. But perhaps the partition from the &lt;tt&gt;ProducerRecord&lt;/tt&gt;, if non-null, can be used? Or should we just set the partition to `-1`?&lt;/p&gt;</comment>
                            <comment id="17372989" author="ayouk" created="Thu, 1 Jul 2021 18:31:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kirktrue&quot; class=&quot;user-hover&quot; rel=&quot;kirktrue&quot;&gt;kirktrue&lt;/a&gt;&#160;This is what i did in this &lt;a href=&quot;https://github.com/apache/kafka/pull/10728]&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;[PR&lt;/a&gt;.&lt;br/&gt;
 Might be the right approach is to create the tp with default values&lt;/p&gt;</comment>
                            <comment id="17373002" author="kirktrue" created="Thu, 1 Jul 2021 19:01:36 +0000"  >&lt;p&gt;I have submitted a &lt;a href=&quot;https://github.com/apache/kafka/pull/10951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pull request&lt;/a&gt; for review.&lt;/p&gt;</comment>
                            <comment id="17528340" author="junrao" created="Tue, 26 Apr 2022 18:07:07 +0000"  >&lt;p&gt;merged&#160;&lt;a href=&quot;https://github.com/apache/kafka/pull/11689&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/11689&lt;/a&gt;&#160;and a followup fix&#160;&lt;a href=&quot;https://github.com/apache/kafka/pull/12064&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/12064&lt;/a&gt;&#160;to trunk and 3.2 branch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13411145">KAFKA-13448</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13025849" name="NPE.production" size="2291" author="ayouk" created="Mon, 24 May 2021 11:07:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0rb74:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>showuon</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>