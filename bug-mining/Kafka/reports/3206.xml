<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:30:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-13739] Sliding window without grace not working</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-13739</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Hi everyone! I would like to understand why KafkaStreams DSL offer the ability to express a SlidingWindow with no grace period but seems that it doesn&apos;t work.&#160;&lt;a href=&quot;https://docs.confluent.io/platform/current/streams/developer-guide/dsl-api.html#sliding-time-windows&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;confluent&apos;s site&lt;/a&gt;&#160;state that grace period is required and with the deprecated method, it&apos;s default to 24 hours.&lt;/p&gt;

&lt;p&gt;Doing a basic sliding window with a count, if I set grace period to 1 ms, expected output is done. Based on the sliding window documentation, lower and upper bounds are inclusive.&lt;/p&gt;

&lt;p&gt;If I set grace period to 0 ms, I can see that record is not skipped at KStreamSlidingWindowAggregate(l.126) but when we try to create the window and push the event in KStreamSlidingWindowAggregate#createWindows we call the method updateWindowAndForward(l.417). This method (l.468) check that&#160;&lt;tt&gt;windowEnd &amp;gt; closeTime&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;closeTime is defined as&#160;&lt;tt&gt;observedStreamTime - window.gracePeriodMs&lt;/tt&gt;&#160;(Sliding window configuration)&lt;/p&gt;

&lt;p&gt;windowEnd is defined as&#160;&lt;tt&gt;inputRecordTimestamp&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For a first event with a record timestamp, we can assume that observedStreamTime is equal to inputRecordTimestamp.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Therefore, closeTime is&#160;&lt;tt&gt;inputRecordTimestamp - 0&lt;/tt&gt;&#160;(gracePeriodMS) which results to&#160;&lt;tt&gt;inputRecordTimestamp&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;If we go back to the check done in&#160;&lt;tt&gt;updateWindowAndForward&lt;/tt&gt;&#160;method, then we have inputRecordTimestamp &amp;gt; inputRecordTimestamp which is always false. The record is then skipped for record&apos;s own window.&lt;/p&gt;

&lt;p&gt;Stating that lower and upper bounds are inclusive, I would have expected the event to be pushed in the store and forwarded. Hence, the check would be&#160;&lt;tt&gt;windowEnd &amp;gt;= closeTime&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Is it a bug or is it intended ?&lt;/p&gt;

&lt;p&gt;Thanks in advance for your explanations!&lt;/p&gt;

&lt;p&gt;Best regards!&lt;/p&gt;</description>
                <environment></environment>
        <key id="13433829">KAFKA-13739</key>
            <summary>Sliding window without grace not working</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tiboun">bounkong khamphousone</assignee>
                                    <reporter username="tiboun">bounkong khamphousone</reporter>
                        <labels>
                            <label>beginner</label>
                            <label>newbie</label>
                    </labels>
                <created>Tue, 15 Mar 2022 09:29:15 +0000</created>
                <updated>Thu, 31 Mar 2022 20:27:53 +0000</updated>
                            <resolved>Thu, 31 Mar 2022 15:27:34 +0000</resolved>
                                    <version>3.1.0</version>
                                    <fixVersion>3.2.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17507261" author="mjsax" created="Tue, 15 Mar 2022 23:22:10 +0000"  >&lt;p&gt;Thanks for reporting this. Good catch. I think you analysis makes sense. Do you want to do a PR to fix it? Seems we have some testing gap for &quot;no grace period&quot;... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17507674" author="lct45" created="Wed, 16 Mar 2022 15:10:59 +0000"  >&lt;p&gt;I think your analysis makes sense and the change to make `windowEnd &amp;gt;= closeTime` makes sense to me&#160;&lt;em&gt;if&lt;/em&gt; we want to support a grace period of 0. The alternative here would be to strictly prohibit a grace period of 0 and require something larger.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I can&apos;t think of any reason to prevent a grace period of 0 so I think the above change seems good to me. It would be worth making that change and running the full suite of tests to make sure there aren&apos;t any assumptions that I can&apos;t think of right now&lt;/p&gt;</comment>
                            <comment id="17507825" author="mjsax" created="Wed, 16 Mar 2022 19:14:31 +0000"  >&lt;p&gt;Thanks for chiming in &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lct45&quot; class=&quot;user-hover&quot; rel=&quot;lct45&quot;&gt;lct45&lt;/a&gt; \&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;em&gt;if&lt;/em&gt;&#160;we want to support a grace period of&#160;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Given that we support `SlidingWindow.ofTimeDifferenceNoGrace()` we should support 0ms grace period &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17509455" author="tiboun" created="Sun, 20 Mar 2022 13:15:52 +0000"  >&lt;p&gt;Hi, I&apos;ll try my best to open a PR in order to fix this.&lt;/p&gt;

&lt;p&gt;Best regards&lt;/p&gt;</comment>
                            <comment id="17510043" author="mjsax" created="Mon, 21 Mar 2022 17:36:30 +0000"  >&lt;p&gt;Thank you! &#8211; Let us know if you need any help.&lt;/p&gt;</comment>
                            <comment id="17510370" author="tiboun" created="Tue, 22 Mar 2022 09:42:40 +0000"  >&lt;p&gt;Patch available here &lt;a href=&quot;https://github.com/apache/kafka/pull/11928&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/11928&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17514700" author="bbejeck" created="Wed, 30 Mar 2022 13:28:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tiboun&quot; class=&quot;user-hover&quot; rel=&quot;tiboun&quot;&gt;tiboun&lt;/a&gt; I&apos;ve assigned the ticket to you and added you as a contributor so you can self-assign tickets in the future.&lt;/p&gt;</comment>
                            <comment id="17515396" author="bbejeck" created="Thu, 31 Mar 2022 15:27:34 +0000"  >&lt;p&gt;Resolved via &lt;a href=&quot;https://github.com/apache/kafka/pull/11928&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/11928&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10hm0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>