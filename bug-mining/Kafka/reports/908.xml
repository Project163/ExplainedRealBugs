<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:52:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3085] BrokerChangeListener computes inconsistent live/dead broker list</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3085</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;On a broker change ZK event, BrokerChangeListener gets the current broker list from ZK. It then computes a new broker list, a dead broker list, and a live broker list with more detailed broker info. The new and live broker list are computed by reading the value associated with each of the current broker twice. If a broker is de-registered in between, these two list will not be consistent.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12928744">KAFKA-3085</key>
            <summary>BrokerChangeListener computes inconsistent live/dead broker list</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dajac">David Jacot</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Jan 2016 21:29:51 +0000</created>
                <updated>Mon, 18 Jan 2016 05:22:51 +0000</updated>
                            <resolved>Mon, 18 Jan 2016 05:22:48 +0000</resolved>
                                    <version>0.9.0.0</version>
                                    <fixVersion>0.10.0.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15091625" author="githubbot" created="Mon, 11 Jan 2016 08:56:33 +0000"  >&lt;p&gt;GitHub user dajac opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/752&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/752&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3085&quot; title=&quot;BrokerChangeListener computes inconsistent live/dead broker list&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3085&quot;&gt;&lt;del&gt;KAFKA-3085&lt;/del&gt;&lt;/a&gt;: BrokerChangeListener computes inconsistent live/dead broker list&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dajac/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dajac/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3085&quot; title=&quot;BrokerChangeListener computes inconsistent live/dead broker list&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3085&quot;&gt;&lt;del&gt;KAFKA-3085&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/752.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/752.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #752&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 706cf9248769bb408ec228c11f7b717770b573d0&lt;br/&gt;
Author: David Jacot &amp;lt;david.jacot@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-01-11T08:51:25Z&lt;/p&gt;

&lt;p&gt;    BrokerChangeListener computes inconsistent live/dead broker list&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15092892" author="githubbot" created="Mon, 11 Jan 2016 23:01:08 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/752&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/752&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15092923" author="junrao" created="Mon, 11 Jan 2016 23:15:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dajac&quot; class=&quot;user-hover&quot; rel=&quot;dajac&quot;&gt;dajac&lt;/a&gt;, sorry, I overlooked this when reviewing the patch. The fix in the above PR is still not complete. So I am leaving this jira open. The issue is that we compute things like newBrokerIds based on currentBrokerList, which is the list of broker id returned from ZK. However, if a broker disappears from ZK when we try to read the broker info using the broker id, the broker essentially doesn&apos;t exist and shouldn&apos;t be included in newBrokerIds. So, perhaps the fix should be (1) compute curBrokers from currentBrokerList and only include live brokers at that time; (2) derive newBrokerIds and deadBrokerIds from curBrokers by comparing with controllerContext.liveOrShuttingDownBrokerIds. Do you want to give this another try? Thanks,&lt;/p&gt;</comment>
                            <comment id="15093334" author="dajac" created="Tue, 12 Jan 2016 05:44:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; No worries. I&apos;ll update it accordingly.&lt;/p&gt;</comment>
                            <comment id="15093411" author="githubbot" created="Tue, 12 Jan 2016 06:48:25 +0000"  >&lt;p&gt;GitHub user dajac opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/756&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/756&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3085&quot; title=&quot;BrokerChangeListener computes inconsistent live/dead broker list&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3085&quot;&gt;&lt;del&gt;KAFKA-3085&lt;/del&gt;&lt;/a&gt;: BrokerChangeListener computes inconsistent live/dead broker list.&lt;/p&gt;

&lt;p&gt;    Follow up PR as per comments in the ticket.&lt;/p&gt;

&lt;p&gt;    @junrao It should be correct now as `curBrokers` included only live brokers and live/dead brokers are computed based on it. Could you take a look when you have time?&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dajac/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dajac/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3085&quot; title=&quot;BrokerChangeListener computes inconsistent live/dead broker list&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3085&quot;&gt;&lt;del&gt;KAFKA-3085&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/756.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/756.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #756&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 94edafcf9d77a25ef5506cff9a3e9a1e76ff14ca&lt;br/&gt;
Author: David Jacot &amp;lt;david.jacot@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-01-12T06:42:40Z&lt;/p&gt;

&lt;p&gt;    BrokerChangeListener computes inconsistent live/dead broker list.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15104190" author="junrao" created="Mon, 18 Jan 2016 05:22:48 +0000"  >&lt;p&gt;Issue resolved by pull request 756&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/756&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/756&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15104191" author="githubbot" created="Mon, 18 Jan 2016 05:22:51 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/756&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/756&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2r22f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>