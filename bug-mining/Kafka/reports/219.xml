<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:37:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-774] Periodic refresh of topic metadata on the producer does not check for error code in the response</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-774</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The producer does a periodic refresh of the metadata but marks the attempt as successful based only on whether the response was received or not. It does not check for error codes in the response. This is probably ok since those produce requests will fail and the required topics will enter the list for topic metadata refresh in the next attempt. However, it will be good to log this since it looks like the metadata was refreshed but actually there could be failures.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12634295">KAFKA-774</key>
            <summary>Periodic refresh of topic metadata on the producer does not check for error code in the response</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nehanarkhede">Neha Narkhede</assignee>
                                    <reporter username="nehanarkhede">Neha Narkhede</reporter>
                        <labels>
                            <label>p1</label>
                    </labels>
                <created>Tue, 26 Feb 2013 21:44:13 +0000</created>
                <updated>Wed, 27 Feb 2013 00:41:01 +0000</updated>
                            <resolved>Wed, 27 Feb 2013 00:40:58 +0000</resolved>
                                    <version>0.8.0</version>
                                                    <component>producer </component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13587602" author="nehanarkhede" created="Tue, 26 Feb 2013 21:51:35 +0000"  >&lt;p&gt;Minor patch, probably could even skip review. The error code for partition metadata is changed from debug to warn. This is useful in investigating incorrect metadata issues which is what I observe on one of our clusters, but not sure at what point it started since the error code is in debug&lt;/p&gt;</comment>
                            <comment id="13587614" author="swapnilghike" created="Tue, 26 Feb 2013 22:02:15 +0000"  >&lt;p&gt;Useful stuff, +1.&lt;/p&gt;</comment>
                            <comment id="13587710" author="nehanarkhede" created="Tue, 26 Feb 2013 23:03:05 +0000"  >&lt;p&gt;Thanks for the quick review, Swapnil. While reviewing the server side metadata code, I found another problem. We were sending error codes only for LeaderNotAvailableException and ReplicaNotAvailableException, but if there are other errors while fetching metadata, those were just logged on the server and the client will not know. Fixed that in this patch. &lt;/p&gt;</comment>
                            <comment id="13587737" author="swapnilghike" created="Tue, 26 Feb 2013 23:34:02 +0000"  >&lt;p&gt;I doubt if the v2 patch will do what it intends to. In the big try catch block that you idented, we catch all exceptions and throw LeaderNotAvailableException and ReplicaNotAvailableException, which is what is caught by the last catch block.&lt;/p&gt;

&lt;p&gt;Apart from that, it was unnecessary to have two separate cases in the last catch block, we can consolidate them into one.&lt;/p&gt;</comment>
                            <comment id="13587742" author="nehanarkhede" created="Tue, 26 Feb 2013 23:41:59 +0000"  >&lt;p&gt;Not sure if I understood your point about consolidating catch blocks, doesn&apos;t this consolidate everything -&lt;/p&gt;

&lt;p&gt;          case e =&amp;gt;&lt;br/&gt;
            new PartitionMetadata(partition, leaderInfo, replicaInfo, isrInfo,&lt;br/&gt;
                                  ErrorMapping.codeFor(e.getClass.asInstanceOf[Class&lt;span class=&quot;error&quot;&gt;&amp;#91;Throwable&amp;#93;&lt;/span&gt;]))&lt;/p&gt;

&lt;p&gt;It is true that we explicitly throw only those 2 exceptions, but we could hit few others as well. This will catch all of those.&lt;/p&gt;</comment>
                            <comment id="13587747" author="swapnilghike" created="Tue, 26 Feb 2013 23:54:13 +0000"  >&lt;p&gt;Yes, your change consolidates everything, which is what I meant. The indentation change to the big try block is good as well.&lt;/p&gt;

&lt;p&gt;If we threw any other exceptions (which I think can be thrown only from getBrokerInfoFromCache), wouldn&apos;t the inner catch blocks convert them to LeaderNotAvailableException or ReplicaNotAvailableException? So the question would be which other exceptions are we trying to catch here and can we really send error codes to client except those for LeaderNotAvailableException or ReplicaNotAvailableException.&lt;/p&gt;

&lt;p&gt;Another question would be in getBrokerInfoFromCache, if we hit a Zk related exception do we want to convert it to one of LeaderNotAvailableException or ReplicaNotAvailableException?&lt;/p&gt;</comment>
                            <comment id="13587775" author="nehanarkhede" created="Wed, 27 Feb 2013 00:16:06 +0000"  >&lt;p&gt;I see your concern here. The reason we convert those exceptions to one of LeaderNotAvailable or ReplicaNotAvailable is so that the client can appropriately understand the nature of the error. In other words, if there was &quot;some&quot; error while fetching the leader for a partiton, the client will only care about LeaderNotAvailable as far as topic metadata request is concerned. What we need to think is whether the client will understand any other type of internal Kafka exception. If yes, we should cover that, if not we can send whatever level of detail is easy for clients to understand. Hence, the conversion.&lt;/p&gt;

&lt;p&gt;But you raised a good point, just from troubleshooting perspective, it might be worth at least logging the root cause on the server. This patch adds that.&lt;/p&gt;</comment>
                            <comment id="13587788" author="swapnilghike" created="Wed, 27 Feb 2013 00:30:53 +0000"  >&lt;p&gt;Yup, looks good. +1&lt;/p&gt;</comment>
                            <comment id="13587798" author="nehanarkhede" created="Wed, 27 Feb 2013 00:40:58 +0000"  >&lt;p&gt;Thanks for the reviews, checked in v3 after fixing indentation.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12571083" name="kafka-774-v2.patch" size="5860" author="nehanarkhede" created="Tue, 26 Feb 2013 23:03:05 +0000"/>
                            <attachment id="12571094" name="kafka-774-v3.patch" size="6694" author="nehanarkhede" created="Wed, 27 Feb 2013 00:16:06 +0000"/>
                            <attachment id="12571068" name="kafka-774.patch" size="1214" author="nehanarkhede" created="Tue, 26 Feb 2013 21:51:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314788</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 38 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ibk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>315132</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>