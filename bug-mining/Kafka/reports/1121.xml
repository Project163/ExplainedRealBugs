<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:55:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3812] State store locking is incorrect</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3812</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In &lt;tt&gt;ProcessorStateManager&lt;/tt&gt; in the &lt;tt&gt;lockStateDirectory&lt;/tt&gt; method, we close a channel if the lock is null. However, as described in &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/nio/channels/FileLock.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/api/java/nio/channels/FileLock.html&lt;/a&gt;, &quot;...closing a channel releases all locks held by the Java virtual machine on the underlying file regardless of whether the locks were acquired via that channel or via another channel open on the same file. It is strongly recommended that, within a program, a unique channel be used to acquire all locks on any given file.&quot;. Thus closing this channel sometimes leads to the other lock in &lt;tt&gt;ProcessorStateManager&lt;/tt&gt;, called &lt;tt&gt;directoryLock&lt;/tt&gt; to be released. &lt;/p&gt;

&lt;p&gt;Problem is reproduced as part of the steps in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3805&quot; title=&quot;Running multiple instances of a Streams app on the same machine results in Java_org_rocksdb_RocksDB_write error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3805&quot;&gt;&lt;del&gt;KAFKA-3805&lt;/del&gt;&lt;/a&gt;, when two processes are using the same state directory.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12977330">KAFKA-3812</key>
            <summary>State store locking is incorrect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="damianguy">Damian Guy</assignee>
                                    <reporter username="enothereska">Eno Thereska</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jun 2016 18:28:56 +0000</created>
                <updated>Tue, 19 Jul 2016 23:55:26 +0000</updated>
                            <resolved>Tue, 19 Jul 2016 23:01:14 +0000</resolved>
                                    <version>0.10.1.0</version>
                                    <fixVersion>0.10.1.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15381412" author="githubbot" created="Sun, 17 Jul 2016 16:31:56 +0000"  >&lt;p&gt;GitHub user dguy opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1628&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1628&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3812&quot; title=&quot;State store locking is incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3812&quot;&gt;&lt;del&gt;KAFKA-3812&lt;/del&gt;&lt;/a&gt; State store locking is incorrect&lt;/p&gt;

&lt;p&gt;    Move all state directory creation/locking/unlocking/cleaning to a single class. Don&apos;t release the channel until the lock is released. Refactor code to make use of new class&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dguy/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dguy/kafka&lt;/a&gt; kafka-3812&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1628.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1628.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1628&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b4547162d5d07cd471c1ccf9e84ed57c947bf2e4&lt;br/&gt;
Author: Damian Guy &amp;lt;damian.guy@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-07-17T16:29:20Z&lt;/p&gt;

&lt;p&gt;    move locking/cleaning/creating/unlocking of task directories into a single class. refactor code to make use of it&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15385027" author="guozhang" created="Tue, 19 Jul 2016 23:01:14 +0000"  >&lt;p&gt;Issue resolved by pull request 1628&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1628&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1628&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15385028" author="githubbot" created="Tue, 19 Jul 2016 23:01:24 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1628&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1628&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15385079" author="githubbot" created="Tue, 19 Jul 2016 23:50:17 +0000"  >&lt;p&gt;GitHub user dguy opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1641&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1641&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    HOTFIX: fix compilation error due to merge of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3812&quot; title=&quot;State store locking is incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3812&quot;&gt;&lt;del&gt;KAFKA-3812&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;    Merge of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3812&quot; title=&quot;State store locking is incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3812&quot;&gt;&lt;del&gt;KAFKA-3812&lt;/del&gt;&lt;/a&gt; caused a compilation error in StreamThreadStateStoreProviderTest&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dguy/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dguy/kafka&lt;/a&gt; fix-compile-error&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1641.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1641.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1641&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 60fa103e3a6fe1e4dd9788033e854886493016e0&lt;br/&gt;
Author: Damian Guy &amp;lt;damian.guy@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-07-19T23:49:02Z&lt;/p&gt;

&lt;p&gt;    fix compilation error&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15385081" author="githubbot" created="Tue, 19 Jul 2016 23:55:26 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1641&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1641&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12976823">KAFKA-3805</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2z8nz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>