<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:41:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-16372] max.block.ms behavior inconsistency with javadoc and the config description</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-16372</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;As of Kafka 3.7.0, the javadoc of &lt;a href=&quot;https://github.com/apache/kafka/blob/3.7.0/clients/src/main/java/org/apache/kafka/clients/producer/KafkaProducer.java#L956&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;KafkaProducer.send&lt;/a&gt; states that it throws TimeoutException when max.block.ms is exceeded on buffer allocation or initial metadata fetch.&lt;/p&gt;

&lt;p&gt;Also it&apos;s stated in &lt;a href=&quot;https://kafka.apache.org/37/documentation.html#producerconfigs_buffer.memory&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;buffer.memory config description&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;However, I found that this is not true because TimeoutException extends ApiException, and KafkaProducer.doSend catches ApiException and &lt;a href=&quot;https://github.com/apache/kafka/blob/3.7.0/clients/src/main/java/org/apache/kafka/clients/producer/KafkaProducer.java#L1075-L1086&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;wraps it as FutureFailure&lt;/a&gt; instead of throwing it.&lt;/p&gt;

&lt;p&gt;I wonder if this is a bug or the documentation error.&lt;/p&gt;

&lt;p&gt;Seems this discrepancy exists since 0.9.0.0, which max.block.ms is introduced.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13571868">KAFKA-16372</key>
            <summary>max.block.ms behavior inconsistency with javadoc and the config description</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ocadaruma">Haruki Okada</assignee>
                                    <reporter username="ocadaruma">Haruki Okada</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Mar 2024 10:25:10 +0000</created>
                <updated>Fri, 24 Jan 2025 12:24:22 +0000</updated>
                            <resolved>Fri, 24 Jan 2025 12:24:22 +0000</resolved>
                                                    <fixVersion>4.0.0</fixVersion>
                                    <component>producer </component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17827431" author="showuon" created="Fri, 15 Mar 2024 08:09:18 +0000"  >&lt;p&gt;If that&apos;s the case since 0.9.0.0, I would treat it as a document error, not a bug. WDYT?&lt;/p&gt;</comment>
                            <comment id="17828960" author="ocadaruma" created="Wed, 20 Mar 2024 14:15:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=showuon&quot; class=&quot;user-hover&quot; rel=&quot;showuon&quot;&gt;showuon&lt;/a&gt; Agreed.&lt;br/&gt;
One concern is, IMO many developers expect this &quot;exception thrown on buffer full after max.block.ms&quot;-behavior (because it&apos;s stated in Javadoc while we rarely hit buffer-full situation so no one realized this discrepancy).&lt;/p&gt;

&lt;p&gt;Even some famous open-sources have exception-handling code which doesn&apos;t work actually due to this. (e.g. &lt;a href=&quot;https://github.com/danielwegener/logback-kafka-appender/blob/master/src/main/java/com/github/danielwegener/logback/kafka/delivery/AsynchronousDeliveryStrategy.java#L29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;logback-kafka-appender&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;I wonder if just fixing Javadoc and Kafka documentation is fine, or we should make a heads up about this somewhere (e.g. at Kafka user mailing list).&lt;/p&gt;

&lt;p&gt;I would like to hear committer&apos;s opinion.&lt;/p&gt;

&lt;p&gt;Anyways, meanwhile let me start fixing the docs.&lt;/p&gt;</comment>
                            <comment id="17842585" author="JIRAUSER305273" created="Wed, 1 May 2024 08:34:21 +0000"  >&lt;p&gt;I just filed created (and closed) a dupe of this. I had some thoughts on how to resolve the issue that I&apos;d like to reiterate here though:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;This is basically a discrepancy between documentation and behavior, so it&apos;s a question of which one should be adjusted.&lt;/p&gt;

&lt;p&gt;And on that, being able to differentiate between synchronous timeouts (as caused by waiting on metadata or allocating memory) and asynchronous timeouts (eg. timing out waiting for acks) is useful. In the former case we&#160;&lt;em&gt;know&lt;/em&gt;&#160;that the broker has not received the event but in the latter it&#160;&lt;em&gt;may&lt;/em&gt;&#160;be that the broker has received it but the ack could not be delivered, and our actions might vary because of this. The current behavior makes this hard to differentiate since both result in a&#160;&lt;tt&gt;TimeoutException&lt;/tt&gt;&#160;being delivered via the callback. Currently, I am relying on the exception message string to differentiate these two, but this is basically just relying on implementation detail that may change at any time. Therefore I would suggest to either:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Revert to the documented behavior of throwing in case of synchronous timeouts&lt;/li&gt;
	&lt;li&gt;Correct the javadoc and introduce an exception base class/interface for synchronous timeouts&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;</comment>
                            <comment id="17843116" author="ocadaruma" created="Fri, 3 May 2024 02:47:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mpedersencrwd&quot; class=&quot;user-hover&quot; rel=&quot;mpedersencrwd&quot;&gt;mpedersencrwd&lt;/a&gt; In either case, it takes time to fix because:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;revert to the documented behavior =&amp;gt; this is a breaking change so we may not able to fix until 4.0 release&lt;/li&gt;
	&lt;li&gt;introduce an exception base class =&amp;gt; In my understanding this needs KIP&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So fixing javadoc might be appropriate as the short term fix for now.&lt;/p&gt;

&lt;p&gt;Besides, I would like to clarify the use case of differentiating synchronous/asynchronous timeout.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;our actions might vary because of this&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Could you tell how the action will be different depending on broker may receive the message or not?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13577826">KAFKA-16651</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1nytc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>