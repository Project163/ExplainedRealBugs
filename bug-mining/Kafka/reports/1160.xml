<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:55:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2894] WorkerSinkTask doesn&apos;t handle rewinding offsets on rebalance</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2894</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;rewind() is only invoked at the beginning of each poll(). This means that if a rebalance occurs in the poll, it&apos;s feasible to get data that doesn&apos;t match a request to change offsets during the rebalance. I think the consumer will hold on to consumer data across the rebalance if it is reassigned the same offset, so there may already be data ready to be delivered. Additionally we may already have data in an incomplete messageBatch that should be discarded when the rewind is requested.&lt;/p&gt;

&lt;p&gt;While connectors that care about this (i.e. ones that manage their own offsets) can handle this correctly by tracking the offsets they&apos;re expecting to see, it&apos;s a hassle, error prone, an pretty unintuitive.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12916295">KAFKA-2894</key>
            <summary>WorkerSinkTask doesn&apos;t handle rewinding offsets on rebalance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liquanpei">Liquan Pei</assignee>
                                    <reporter username="ewencp">Ewen Cheslack-Postava</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Nov 2015 23:04:19 +0000</created>
                <updated>Tue, 23 Aug 2016 22:48:06 +0000</updated>
                            <resolved>Tue, 23 Aug 2016 17:19:44 +0000</resolved>
                                    <version>0.9.0.0</version>
                                    <fixVersion>0.10.1.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15332133" author="ewencp" created="Wed, 15 Jun 2016 17:23:20 +0000"  >&lt;p&gt;More generally, I think we need to handle cases like rewind() after &lt;b&gt;any&lt;/b&gt; connector methods are invoked. The rewind() in poll() handles Connector.start() and Connector.put(), but we also need to handle the rebalance callbacks (where we can ignore Connector.close() and only do this after Connector.open()) and Connector.flush().&lt;/p&gt;</comment>
                            <comment id="15383859" author="lucasmartinez" created="Tue, 19 Jul 2016 09:36:14 +0000"  >&lt;p&gt;I apologize if I am asking in the wrong place, but I believe this issue could solve the problem I am having, and which I&#8217;ll explain in a bit.&lt;br/&gt;
First, how do connectors actually manage their own offsets? I tried creating a sink connector extending SinkTask, and:&lt;/p&gt;

&lt;p&gt;1) I tried assigning a Map of &amp;lt;TopicPartition, Offset&amp;gt; to the context obtained in initialize() by doing context.offset(offsetMap). But this results in an exception &#8220;No current assignment for partition&#8230;&#8221; because the partitions were not assigned yet.&lt;/p&gt;

&lt;p&gt;2) I tried doing the same in the open() method by saving the context from initialize() in a variable and assigning to it a map built with the Collection&amp;lt;TopicPartition&amp;gt; parameter. The result was to fetch all the messages from the last kafka committed offset, plus again, all the messages from the offsets I assigned manually to the partitions!&lt;br/&gt;
I also tried setting a worker property &#8220;auto.offset.reset=latest&#8221; as a workaround, but apparently it is not supported and the default value of earliest was used anyway.&lt;/p&gt;

&lt;p&gt;Am I wrong to think that rewinding offsets on rebalance would solve this issue and I would be able to manually assign offsets on the open() method?&lt;/p&gt;</comment>
                            <comment id="15431812" author="githubbot" created="Mon, 22 Aug 2016 23:53:51 +0000"  >&lt;p&gt;GitHub user kkonstantine opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1771&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1771&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2894&quot; title=&quot;WorkerSinkTask doesn&amp;#39;t handle rewinding offsets on rebalance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2894&quot;&gt;&lt;del&gt;KAFKA-2894&lt;/del&gt;&lt;/a&gt;: WorkerSinkTask should rewind offsets on rebalance&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kkonstantine/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kkonstantine/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2894&quot; title=&quot;WorkerSinkTask doesn&amp;#39;t handle rewinding offsets on rebalance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2894&quot;&gt;&lt;del&gt;KAFKA-2894&lt;/del&gt;&lt;/a&gt;-rewind-offsets-on-rebalance&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1771.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1771.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1771&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d14eff6084bafcf5014c8309703faafd96fe7071&lt;br/&gt;
Author: Konstantine Karantasis &amp;lt;k.karantasis@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-08-22T23:30:27Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2894&quot; title=&quot;WorkerSinkTask doesn&amp;#39;t handle rewinding offsets on rebalance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2894&quot;&gt;&lt;del&gt;KAFKA-2894&lt;/del&gt;&lt;/a&gt;: WorkerSinkTask should rewind offsets on rebalance&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15433229" author="ewencp" created="Tue, 23 Aug 2016 17:19:45 +0000"  >&lt;p&gt;Issue resolved by pull request 1771&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1771&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1771&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15433790" author="githubbot" created="Tue, 23 Aug 2016 22:48:06 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1771&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1771&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2oyav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>