<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:38:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-994] High level consumer doesn&apos;t throw an exception when the message it is trying to fetch exceeds the configured fetch size</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-994</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The high level consumer code is supposed to throw an exception when it encounters a message that exceeds its configured max message size. The relevant code form ConsumerIterator.scala is:&lt;/p&gt;

&lt;p&gt;      // if we just updated the current chunk and it is empty that means the fetch size is too small!&lt;br/&gt;
      if(currentDataChunk.messages.validBytes == 0)&lt;br/&gt;
        throw new MessageSizeTooLargeException(&quot;Found a message larger than the maximum fetch size of this consumer on topic &quot; +&lt;br/&gt;
                                               &quot;%s partition %d at fetch offset %d. Increase the fetch size, or decrease the maximum message size the broker will allow.&quot;&lt;br/&gt;
                                               .format(currentDataChunk.topicInfo.topic, currentDataChunk.topicInfo.partitionId, currentDataChunk.fetchOffset))&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;The problem is that &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-846&quot; title=&quot;AbstractFetcherThread should do shallow instead of deep iteration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-846&quot;&gt;&lt;del&gt;KAFKA-846&lt;/del&gt;&lt;/a&gt; changed PartitionTopicInfo.enqueue:&lt;/p&gt;

&lt;p&gt;   def enqueue(messages: ByteBufferMessageSet) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val size = messages.sizeInBytes&lt;br/&gt;
+    val size = messages.validBytes&lt;br/&gt;
     if(size &amp;gt; 0) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;i.e. chunks that contain messages that are too big (validBytes = 0) will never even be enqueued, so won&apos;t ever hit the too-large message check in ConsumerIterator... &lt;/p&gt;

&lt;p&gt;I&apos;ve attached a patch that passes our tests...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12661130">KAFKA-994</key>
            <summary>High level consumer doesn&apos;t throw an exception when the message it is trying to fetch exceeds the configured fetch size</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="smeder">Sam Meder</assignee>
                                    <reporter username="smeder">Sam Meder</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Aug 2013 13:59:46 +0000</created>
                <updated>Sat, 3 Aug 2013 16:49:27 +0000</updated>
                            <resolved>Fri, 2 Aug 2013 04:35:55 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>consumer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13726525" author="junrao" created="Thu, 1 Aug 2013 15:33:55 +0000"  >&lt;p&gt;Thanks for filing this jira. Looks like a real issue. Just changing validBytes to sizeInBytes may not be enough. In enqueue(), currently we expect the chunk to have at least one message in order to get the next fetch offset. Of course, if we hit a large message, that expectation won&apos;t be true. So, we have to change the logic a bit such that if there is not a single message in the chunk, we don&apos;t move the fetch offset, but still insert the chunk to the queue (so that the consumer thread can see it).&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jun&lt;/p&gt;</comment>
                            <comment id="13726535" author="smeder" created="Thu, 1 Aug 2013 15:37:40 +0000"  >&lt;p&gt;Yea, I realized that after the initial write-up, the attached patch actually does what you describe.&lt;/p&gt;</comment>
                            <comment id="13726536" author="jkreps" created="Thu, 1 Aug 2013 15:38:03 +0000"  >&lt;p&gt;Ack, nice catch.&lt;/p&gt;</comment>
                            <comment id="13727316" author="junrao" created="Fri, 2 Aug 2013 04:35:55 +0000"  >&lt;p&gt;Thanks for the patch. Committed to 0.8.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12595428" name="messageSize.patch" size="715" author="smeder" created="Thu, 1 Aug 2013 15:17:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>341319</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mv87:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>341637</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>