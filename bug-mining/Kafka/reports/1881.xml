<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:09:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6234] Transient failure in kafka.api.AdminClientIntegrationTest.testLogStartOffsetCheckpoint</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6234</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Saw this once: &lt;a href=&quot;https://builds.apache.org/job/kafka-pr-jdk9-scala2.12/2669/testReport/junit/kafka.api/AdminClientIntegrationTest/testLogStartOffsetCheckpoint/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/kafka-pr-jdk9-scala2.12/2669/testReport/junit/kafka.api/AdminClientIntegrationTest/testLogStartOffsetCheckpoint/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Stacktrace

java.util.concurrent.TimeoutException
	at org.apache.kafka.common.internals.KafkaFutureImpl$SingleWaiter.await(KafkaFutureImpl.java:108)
	at org.apache.kafka.common.internals.KafkaFutureImpl.get(KafkaFutureImpl.java:225)
	at kafka.api.AdminClientIntegrationTest.$anonfun$testLogStartOffsetCheckpoint$3(AdminClientIntegrationTest.scala:762)
	at kafka.utils.TestUtils$.waitUntilTrue(TestUtils.scala:858)
	at kafka.api.AdminClientIntegrationTest.testLogStartOffsetCheckpoint(AdminClientIntegrationTest.scala:756)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:564)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:298)
	at org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:292)
	at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:844)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13119514">KAFKA-6234</key>
            <summary>Transient failure in kafka.api.AdminClientIntegrationTest.testLogStartOffsetCheckpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sliebau">S&#246;nke Liebau</assignee>
                                    <reporter username="guozhang">Guozhang Wang</reporter>
                        <labels>
                    </labels>
                <created>Sun, 19 Nov 2017 18:59:51 +0000</created>
                <updated>Thu, 12 Apr 2018 22:46:03 +0000</updated>
                            <resolved>Thu, 12 Apr 2018 22:46:03 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16258826" author="sliebau" created="Mon, 20 Nov 2017 05:51:11 +0000"  >&lt;p&gt;Is the 1 second timeout in that relevant to what is being tested, or could we just try to increase this a little to fix the shaky test? Especially with stopping and restarting all brokers before that call, there may be some internal stuff going on that just needs longer than a second to complete. &lt;br/&gt;
On the other hand, the waitUntilTrue call is obviously intended to solve this for a leader not available exception, but this is being interrupted by the Timeoutexception being thrown in KafkaFutureImpl.get, so this could get extended to catch this exception as well.&lt;br/&gt;
Since the delete request is inside the waitUntilTrue and we probably don&apos;t want to retry the entire delete just because we didn&apos;t get a low watermark returned I think increasing the timeout a bit as a first step is the way to go.&lt;/p&gt;</comment>
                            <comment id="16258850" author="githubbot" created="Mon, 20 Nov 2017 06:30:08 +0000"  >&lt;p&gt;GitHub user soenkeliebau opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4238&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6234&quot; title=&quot;Transient failure in kafka.api.AdminClientIntegrationTest.testLogStartOffsetCheckpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6234&quot;&gt;&lt;del&gt;KAFKA-6234&lt;/del&gt;&lt;/a&gt;: Increased timeout value for lowWatermark response to avoid test failing occasionally&lt;/p&gt;

&lt;p&gt;    Increase timeout to fix flaky integration test testLogStartOffsetCheckpoint.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/soenkeliebau/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/soenkeliebau/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6234&quot; title=&quot;Transient failure in kafka.api.AdminClientIntegrationTest.testLogStartOffsetCheckpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6234&quot;&gt;&lt;del&gt;KAFKA-6234&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4238.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4238.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4238&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 06eb877538ba01a2a285ef266592f72d124ebee9&lt;br/&gt;
Author: Soenke Liebau &amp;lt;soenke.liebau@opencore.com&amp;gt;&lt;br/&gt;
Date:   2017-11-20T06:26:03Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6234&quot; title=&quot;Transient failure in kafka.api.AdminClientIntegrationTest.testLogStartOffsetCheckpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6234&quot;&gt;&lt;del&gt;KAFKA-6234&lt;/del&gt;&lt;/a&gt;: Increased timeout value for lowWatermark response to avoid test failing occasionally.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16258851" author="sliebau" created="Mon, 20 Nov 2017 06:33:43 +0000"  >&lt;p&gt;I&apos;ve run a few tests and looked at the value that the 1s timeout was exceeded by  and on my machine this was never more than 1/10th of a second, so this looks a lot like it&apos;s really just a too short timeout value. I&apos;ve created a pull request to increase the timeout to 5s (added some extra to account for busy build servers and test no being run in isolation etc.)&lt;/p&gt;</comment>
                            <comment id="16427457" author="sliebau" created="Thu, 5 Apr 2018 19:08:31 +0000"  >&lt;p&gt;I&apos;ve created a patch that has been around for a while now. Tests seem stable for the last few runs.&lt;/p&gt;

&lt;p&gt;Unless someone has reservations about the fix I think this can be merged - but we should watch out for the tests acting up again.&lt;/p&gt;</comment>
                            <comment id="16436430" author="githubbot" created="Thu, 12 Apr 2018 22:45:41 +0000"  >&lt;p&gt;hachikuji closed pull request #4238: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6234&quot; title=&quot;Transient failure in kafka.api.AdminClientIntegrationTest.testLogStartOffsetCheckpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6234&quot;&gt;&lt;del&gt;KAFKA-6234&lt;/del&gt;&lt;/a&gt;: Increased timeout value for lowWatermark response to avoid test failing occasionally&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4238&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/core/src/test/scala/integration/kafka/api/AdminClientIntegrationTest.scala b/core/src/test/scala/integration/kafka/api/AdminClientIntegrationTest.scala&lt;br/&gt;
index 0676a1a3263..2b3ca623c57 100644&lt;br/&gt;
&amp;#8212; a/core/src/test/scala/integration/kafka/api/AdminClientIntegrationTest.scala&lt;br/&gt;
+++ b/core/src/test/scala/integration/kafka/api/AdminClientIntegrationTest.scala&lt;br/&gt;
@@ -38,7 +38,7 @@ import org.apache.kafka.common.{KafkaFuture, TopicPartition, TopicPartitionRepli&lt;br/&gt;
 import org.apache.kafka.common.acl._&lt;br/&gt;
 import org.apache.kafka.common.config.ConfigResource&lt;br/&gt;
 import org.apache.kafka.common.errors._&lt;br/&gt;
-import org.junit.&lt;/p&gt;
{After, Before, Ignore, Rule, Test}
&lt;p&gt;+import org.junit.&lt;/p&gt;
{After, Before, Rule, Test}
&lt;p&gt; import org.apache.kafka.common.requests.&lt;/p&gt;
{DeleteRecordsRequest, MetadataResponse}
&lt;p&gt; import org.apache.kafka.common.resource.&lt;/p&gt;
{Resource, ResourceType}
&lt;p&gt; import org.junit.rules.Timeout&lt;br/&gt;
@@ -733,7 +733,6 @@ class AdminClientIntegrationTest extends IntegrationTestHarness with Logging {&lt;br/&gt;
   }&lt;/p&gt;

&lt;p&gt;   @Test&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Ignore // Disabled temporarily until flakiness is resolved&lt;br/&gt;
   def testLogStartOffsetCheckpoint(): Unit = {&lt;br/&gt;
     TestUtils.createTopic(zkUtils, topic, 2, serverCount, servers)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -743,8 +742,8 @@ class AdminClientIntegrationTest extends IntegrationTestHarness with Logging {&lt;/p&gt;

&lt;p&gt;     sendRecords(producers.head, 10, topicPartition)&lt;br/&gt;
     var result = client.deleteRecords(Map(topicPartition -&amp;gt; RecordsToDelete.beforeOffset(5L)).asJava)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;var lowWatermark = result.lowWatermarks().get(topicPartition).get().lowWatermark()&lt;/li&gt;
	&lt;li&gt;assertEquals(5L, lowWatermark)&lt;br/&gt;
+    var lowWatermark: Option&lt;span class=&quot;error&quot;&gt;&amp;#91;Long&amp;#93;&lt;/span&gt; = Some(result.lowWatermarks.get(topicPartition).get.lowWatermark)&lt;br/&gt;
+    assertEquals(Some(5), lowWatermark)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     for (i &amp;lt;- 0 until serverCount) {&lt;br/&gt;
       killBroker&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
@@ -759,16 +758,16 @@ class AdminClientIntegrationTest extends IntegrationTestHarness with Logging {&lt;br/&gt;
       // Need to retry if leader is not available for the partition&lt;br/&gt;
       result = client.deleteRecords(Map(topicPartition -&amp;gt; RecordsToDelete.beforeOffset(0L)).asJava)&lt;/p&gt;

&lt;p&gt;+      lowWatermark = None&lt;br/&gt;
       val future = result.lowWatermarks().get(topicPartition)&lt;br/&gt;
       try &lt;/p&gt;
{
-        lowWatermark = future.get(1000L, TimeUnit.MILLISECONDS).lowWatermark()
-        lowWatermark == 5L
+        lowWatermark = Some(future.get.lowWatermark)
+        lowWatermark.contains(5L)
       }
&lt;p&gt; catch &lt;/p&gt;
{
-        case e: LeaderNotAvailableException =&amp;gt; false
-      }
&lt;p&gt;-&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;}, &quot;Expected low watermark of the partition to be 5L&quot;)&lt;br/&gt;
-&lt;br/&gt;
+        case e: ExecutionException if e.getCause.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;LeaderNotAvailableException&amp;#93;&lt;/span&gt; ||&lt;br/&gt;
+          e.getCause.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;NotLeaderForPartitionException&amp;#93;&lt;/span&gt; =&amp;gt; false&lt;br/&gt;
+        }&lt;br/&gt;
+    }, s&quot;Expected low watermark of the partition to be 5 but got ${lowWatermark.getOrElse(&quot;no response within the timeout&quot;)}&quot;)&lt;br/&gt;
     client.close()&lt;br/&gt;
   }&lt;/li&gt;
&lt;/ul&gt;






&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mz6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>guozhang</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>