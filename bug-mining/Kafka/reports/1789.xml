<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:06:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6398] Non-aggregation KTable generation operator does not construct value getter correctly</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6398</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;For any operator that generates a KTable, its &lt;tt&gt;valueGetterSupplier&lt;/tt&gt; has three code path:&lt;/p&gt;

&lt;p&gt;1. If the operator is a KTable source operator, using its materialized state store for value getter (note that currently we always materialize on KTable source).&lt;br/&gt;
2. If the operator is an aggregation operator, then its generated KTable should always be materialized so we just use its materialized state store.&lt;br/&gt;
3. Otherwise, we treat the value getter in a per-operator basis.&lt;/p&gt;

&lt;p&gt;For 3) above, what we SHOULD do is that, if the generated KTable is materialized, the value getter would just rely on its materialized state store to get the value; otherwise we just rely on the operator itself to define which parent&apos;s value getter to inherit and what computational logic to apply on-the-fly to get the value. For example, for &lt;tt&gt;KTable#filter()&lt;/tt&gt; where the &lt;tt&gt;Materialized&lt;/tt&gt; is not specified, in &lt;tt&gt;KTableFilterValueGetter&lt;/tt&gt; we just get from parent&apos;s value getter and then apply the filter on the fly; and in addition we should let the future operators to be able to access its parent&apos;s materialized state store via &lt;tt&gt;connectProcessorAndStateStore&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;However, current code does not do this correctly: it 1) does not check if the result KTable is materialized or not, but always try to use its parent&apos;s value getter, and 2) it does not try to connect its parent&apos;s materialized store to the future operator. As a result, these operators such as &lt;tt&gt;KTable#filter&lt;/tt&gt;, &lt;tt&gt;KTable#mapValues&lt;/tt&gt;, and &lt;tt&gt;KTable#join(KTable)&lt;/tt&gt; would result in TopologyException when building. The following is an example:&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Using a non-materialized KTable in a stream-table join fails:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;final KTable filteredKTable = builder.table(&quot;table-topic&quot;).filter(...);
builder.stream(&quot;stream-topic&quot;).join(filteredKTable,...);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;fails with&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.kafka.streams.errors.TopologyBuilderException: Invalid topology building: StateStore null is not added yet.

	at org.apache.kafka.streams.processor.TopologyBuilder.connectProcessorAndStateStore(TopologyBuilder.java:1021)
	at org.apache.kafka.streams.processor.TopologyBuilder.connectProcessorAndStateStores(TopologyBuilder.java:949)
	at org.apache.kafka.streams.kstream.internals.KStreamImpl.doStreamTableJoin(KStreamImpl.java:621)
	at org.apache.kafka.streams.kstream.internals.KStreamImpl.join(KStreamImpl.java:577)
	at org.apache.kafka.streams.kstream.internals.KStreamImpl.join(KStreamImpl.java:563)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Adding a store name is not sufficient as workaround but fails differently:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;final KTable filteredKTable = builder.table(&quot;table-topic&quot;).filter(..., &quot;STORE-NAME&quot;);
builder.stream(&quot;stream-topic&quot;).join(filteredKTable,...);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;error:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.kafka.streams.errors.StreamsException: failed to initialize processor KSTREAM-JOIN-0000000005

	at org.apache.kafka.streams.processor.internals.ProcessorNode.init(ProcessorNode.java:113)
	at org.apache.kafka.streams.processor.internals.StreamTask.initTopology(StreamTask.java:339)
	at org.apache.kafka.streams.processor.internals.StreamTask.initialize(StreamTask.java:153)
Caused by: org.apache.kafka.streams.errors.TopologyBuilderException: Invalid topology building: Processor KSTREAM-JOIN-0000000005 has no access to StateStore KTABLE-SOURCE-STATE-STORE-0000000000
	at org.apache.kafka.streams.processor.internals.ProcessorContextImpl.getStateStore(ProcessorContextImpl.java:69)
	at org.apache.kafka.streams.kstream.internals.KTableSourceValueGetterSupplier$KTableSourceValueGetter.init(KTableSourceValueGetterSupplier.java:45)
	at org.apache.kafka.streams.kstream.internals.KTableFilter$KTableFilterValueGetter.init(KTableFilter.java:121)
	at org.apache.kafka.streams.kstream.internals.KStreamKTableJoinProcessor.init(KStreamKTableJoinProcessor.java:44)
	at org.apache.kafka.streams.processor.internals.ProcessorNode$2.run(ProcessorNode.java:53)
	at org.apache.kafka.streams.processor.internals.StreamsMetricsImpl.measureLatencyNs(StreamsMetricsImpl.java:201)
	at org.apache.kafka.streams.processor.internals.ProcessorNode.init(ProcessorNode.java:111)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;One can workaround by piping the result through a topic:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;final KTable filteredKTable = builder.table(&quot;table-topic&quot;).filter(...).through(&quot;TOPIC&quot;);;
builder.stream(&quot;stream-topic&quot;).join(filteredKTable,...);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;------------------------------------------------------------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Note that there is another minor orthogonal issue of &lt;tt&gt;KTable#filter&lt;/tt&gt; itself that it does not include its parent&apos;s queryable store name when itself is not materialized (see &lt;tt&gt;KTable#mapValues&lt;/tt&gt; for reference).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13126664">KAFKA-6398</key>
            <summary>Non-aggregation KTable generation operator does not construct value getter correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guozhang">Guozhang Wang</assignee>
                                    <reporter username="mjsax">Matthias J. Sax</reporter>
                        <labels>
                            <label>bug</label>
                    </labels>
                <created>Thu, 21 Dec 2017 22:19:45 +0000</created>
                <updated>Thu, 18 Jan 2018 21:16:27 +0000</updated>
                            <resolved>Thu, 18 Jan 2018 21:16:27 +0000</resolved>
                                    <version>0.11.0.1</version>
                    <version>1.0.0</version>
                                    <fixVersion>1.0.1</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16310031" author="guozhang" created="Wed, 3 Jan 2018 18:31:26 +0000"  >&lt;p&gt;Just confirmed this situation exists in 1.0.0 (more specifically in trunk) as well &lt;/p&gt;</comment>
                            <comment id="16310226" author="githubbot" created="Wed, 3 Jan 2018 20:12:16 +0000"  >&lt;p&gt;guozhangwang opened a new pull request #4384: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6398&quot; title=&quot;Non-aggregation KTable generation operator does not construct value getter correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6398&quot;&gt;&lt;del&gt;KAFKA-6398&lt;/del&gt;&lt;/a&gt;: fix KTable.filter that does not include its parent&apos;s queryable storename&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4384&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4384&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   1. Include the parent&apos;s queryable store name in KTable.filter if this operator is not materialized.&lt;br/&gt;
   2. Augment InternalTopologyBuilder checking on null processor / store names from the enum.&lt;br/&gt;
   3. Unit test.&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16310244" author="bjamet@isi.nc" created="Wed, 3 Jan 2018 20:25:43 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;, thank you for working on this issue. &lt;/p&gt;

&lt;p&gt;I would like to point that I had the same fail message when joining a KStream and a KTable ; in my case it wasn&apos;t a filtereredTable but an precedently joined table : &lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
KTable table1 = builder.table(&lt;span class=&quot;code-quote&quot;&gt;&quot;table1&quot;&lt;/span&gt;);
KTable table2 = builder.table(&lt;span class=&quot;code-quote&quot;&gt;&quot;table2&quot;&lt;/span&gt;);

KTable joinedTable = table1.leftjoin(table2, ... , Materialized.with(..,..));
builder.stream(&lt;span class=&quot;code-quote&quot;&gt;&quot;stream&quot;&lt;/span&gt;).join(joinedTable,...);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So the resolution of the issue is not (only) on the KTable.filter side, by maybe on the KStream.join side... &lt;br/&gt;
Thank you again&lt;/p&gt;</comment>
                            <comment id="16310321" author="guozhang" created="Wed, 3 Jan 2018 21:36:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bjamet%40isi.nc&quot; class=&quot;user-hover&quot; rel=&quot;bjamet@isi.nc&quot;&gt;bjamet@isi.nc&lt;/a&gt; I tried your code snippet on trunk and it works for me:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        KTable&amp;lt;Bytes, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; table1 = builder.table(&lt;span class=&quot;code-quote&quot;&gt;&quot;table1&quot;&lt;/span&gt;);
        KTable&amp;lt;Bytes, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; table2 = builder.table(&lt;span class=&quot;code-quote&quot;&gt;&quot;table2&quot;&lt;/span&gt;);

        KTable&amp;lt;Bytes, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; joinedTable = table1.leftJoin(table2, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ValueJoiner&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; apply(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value1, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value2) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value1;
            }
        } , Materialized.&amp;lt;Bytes, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, KeyValueStore&amp;lt;Bytes, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]&amp;gt;&amp;gt;with(Serdes.Bytes(), Serdes.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;()));

        builder.&amp;lt;Bytes, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;stream(&lt;span class=&quot;code-quote&quot;&gt;&quot;stream&quot;&lt;/span&gt;).join(joinedTable, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ValueJoiner&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; apply(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value1, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value2) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value1;
            }
        });
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16311091" author="bjamet@isi.nc" created="Thu, 4 Jan 2018 09:47:03 +0000"  >&lt;p&gt;Hello, &lt;br/&gt;
The failure occurs when the ProcessorTopologyTestDriver is created : &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	KTable&amp;lt;Bytes, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; table1 = builder.table(&lt;span class=&quot;code-quote&quot;&gt;&quot;table1&quot;&lt;/span&gt;);
	KTable&amp;lt;Bytes, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; table2 = builder.table(&lt;span class=&quot;code-quote&quot;&gt;&quot;table2&quot;&lt;/span&gt;);

	KTable&amp;lt;Bytes, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; joinedTable = table1.leftJoin(table2, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ValueJoiner&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;() {
	            @Override
	            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; apply(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value1, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value2) {
	                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value1;
	            }
	        } , Materialized.&amp;lt;Bytes, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, KeyValueStore&amp;lt;Bytes, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]&amp;gt;&amp;gt;with(Serdes.Bytes(), Serdes.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;()));

	        builder.&amp;lt;Bytes, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;stream(&lt;span class=&quot;code-quote&quot;&gt;&quot;stream&quot;&lt;/span&gt;).join(joinedTable, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ValueJoiner&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;() {
	            @Override
	            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; apply(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value1, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value2) {
	                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value1;
	            }
	        });
	Topology topology = builder.build();
	StreamsConfig st = newStreamsConfig();
	ProcessorTopologyTestDriver driver = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProcessorTopologyTestDriver(st, topology);	
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I get the following stack, even on trunk&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.kafka.streams.errors.StreamsException: failed to initialize processor KSTREAM-JOIN-0000000011
	at org.apache.kafka.streams.processor.internals.ProcessorNode.init(ProcessorNode.java:106)
	at org.apache.kafka.streams.processor.internals.StreamTask.initTopology(StreamTask.java:389)
	at org.apache.kafka.streams.processor.internals.StreamTask.initialize(StreamTask.java:167)
	at org.apache.kafka.test.ProcessorTopologyTestDriver.&amp;lt;init&amp;gt;(ProcessorTopologyTestDriver.java:251)
	at org.apache.kafka.test.ProcessorTopologyTestDriver.&amp;lt;init&amp;gt;(ProcessorTopologyTestDriver.java:168)
	at nc.smti.sae.TestLeftJoinStream.TestJoin(TestLeftJoinStream.java:86)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	[...]
Caused by: org.apache.kafka.streams.errors.TopologyBuilderException: Invalid topology building: Processor KSTREAM-JOIN-0000000011 has no access to StateStore table1-STATE-STORE-0000000000
	at org.apache.kafka.streams.processor.internals.ProcessorContextImpl.getStateStore(ProcessorContextImpl.java:72)
	at org.apache.kafka.streams.kstream.internals.KTableSourceValueGetterSupplier$KTableSourceValueGetter.init(KTableSourceValueGetterSupplier.java:45)
	at org.apache.kafka.streams.kstream.internals.KTableKTableLeftJoin$KTableKTableLeftJoinValueGetter.init(KTableKTableLeftJoin.java:104)
	at org.apache.kafka.streams.kstream.internals.KStreamKTableJoinProcessor.init(KStreamKTableJoinProcessor.java:44)
	at org.apache.kafka.streams.processor.internals.ProcessorNode$2.run(ProcessorNode.java:54)
	at org.apache.kafka.streams.processor.internals.StreamsMetricsImpl.measureLatencyNs(StreamsMetricsImpl.java:208)
	at org.apache.kafka.streams.processor.internals.ProcessorNode.init(ProcessorNode.java:104)
	... 28 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


</comment>
                            <comment id="16317240" author="guozhang" created="Mon, 8 Jan 2018 22:30:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bjamet%40isi.nc&quot; class=&quot;user-hover&quot; rel=&quot;bjamet@isi.nc&quot;&gt;bjamet@isi.nc&lt;/a&gt; I can reproduce the issue you mentioned, and I have a theory on its root cause, which is reflected in the updated description of this JIRA. My plan is to merge &lt;a href=&quot;https://github.com/apache/kafka/pull/4384/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4384/files&lt;/a&gt; first, which fixes a minor issue but not this ticket as a whole, and then will continue to work on this ticket.&lt;/p&gt;</comment>
                            <comment id="16320888" author="githubbot" created="Wed, 10 Jan 2018 19:16:24 +0000"  >&lt;p&gt;guozhangwang closed pull request #4384: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6398&quot; title=&quot;Non-aggregation KTable generation operator does not construct value getter correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6398&quot;&gt;&lt;del&gt;KAFKA-6398&lt;/del&gt;&lt;/a&gt;: fix KTable.filter that does not include its parent&apos;s queryable storename&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4384&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4384&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KTableImpl.java b/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KTableImpl.java&lt;br/&gt;
index 8c79decbb6f..3bc6f4b3474 100644&lt;br/&gt;
&amp;#8212; a/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KTableImpl.java&lt;br/&gt;
+++ b/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KTableImpl.java&lt;br/&gt;
@@ -155,8 +155,10 @@ String internalStoreName() {&lt;br/&gt;
         builder.internalTopologyBuilder.addProcessor(name, processorSupplier, this.name);&lt;br/&gt;
         if (storeSupplier != null) &lt;/p&gt;
{
             builder.internalTopologyBuilder.addStateStore(storeSupplier, name);
+            return new KTableImpl&amp;lt;&amp;gt;(builder, name, processorSupplier, this.keySerde, this.valSerde, sourceNodes, internalStoreName, true);
+        }
&lt;p&gt; else &lt;/p&gt;
{
+            return new KTableImpl&amp;lt;&amp;gt;(builder, name, processorSupplier, sourceNodes, this.queryableStoreName, false);
         }
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return new KTableImpl&amp;lt;&amp;gt;(builder, name, processorSupplier, this.keySerde, this.valSerde, sourceNodes, internalStoreName, internalStoreName != null);&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     private KTable&amp;lt;K, V&amp;gt; doFilter(final Predicate&amp;lt;? super K, ? super V&amp;gt; predicate,&lt;br/&gt;
diff --git a/streams/src/main/java/org/apache/kafka/streams/processor/internals/InternalTopologyBuilder.java b/streams/src/main/java/org/apache/kafka/streams/processor/internals/InternalTopologyBuilder.java&lt;br/&gt;
index 39ea44f1bfd..39010022a0b 100644&lt;br/&gt;
&amp;#8212; a/streams/src/main/java/org/apache/kafka/streams/processor/internals/InternalTopologyBuilder.java&lt;br/&gt;
+++ b/streams/src/main/java/org/apache/kafka/streams/processor/internals/InternalTopologyBuilder.java&lt;br/&gt;
@@ -456,6 +456,7 @@ public final void addSource(final Topology.AutoOffsetReset offsetReset,&lt;br/&gt;
         }&lt;/p&gt;

&lt;p&gt;         for (final String predecessor : predecessorNames) {&lt;br/&gt;
+            Objects.requireNonNull(predecessor, &quot;predecessor name can&apos;t be null&quot;);&lt;br/&gt;
             if (predecessor.equals(name)) &lt;/p&gt;
{
                 throw new TopologyException(&quot;Processor &quot; + name + &quot; cannot be a predecessor of itself.&quot;);
             }&lt;br/&gt;
@@ -483,6 +484,7 @@ public final void addProcessor(final String name,&lt;br/&gt;
         }&lt;br/&gt;
 &lt;br/&gt;
         for (final String predecessor : predecessorNames) {&lt;br/&gt;
+            Objects.requireNonNull(predecessor, &quot;predecessor name must not be null&quot;);&lt;br/&gt;
             if (predecessor.equals(name)) {                 throw new TopologyException(&quot;Processor &quot; + name + &quot; cannot be a predecessor of itself.&quot;);             }
&lt;p&gt;@@ -508,6 +510,7 @@ public final void addStateStore(final org.apache.kafka.streams.processor.StateSt&lt;/p&gt;

&lt;p&gt;         if (processorNames != null) {&lt;br/&gt;
             for (final String processorName : processorNames) &lt;/p&gt;
{
+                Objects.requireNonNull(processorName, &quot;processor name must not be null&quot;);
                 connectProcessorAndStateStore(processorName, supplier.name());
             }
&lt;p&gt;         }&lt;br/&gt;
@@ -524,6 +527,7 @@ public final void addStateStore(final StoreBuilder storeBuilder,&lt;/p&gt;

&lt;p&gt;         if (processorNames != null) {&lt;br/&gt;
             for (final String processorName : processorNames) &lt;/p&gt;
{
+                Objects.requireNonNull(processorName, &quot;processor name must not be null&quot;);
                 connectProcessorAndStateStore(processorName, storeBuilder.name());
             }
&lt;p&gt;         }&lt;br/&gt;
@@ -602,11 +606,12 @@ private void validateTopicNotAlreadyRegistered(final String topic) {&lt;br/&gt;
     public final void connectProcessorAndStateStores(final String processorName,&lt;br/&gt;
                                                      final String... stateStoreNames) {&lt;br/&gt;
         Objects.requireNonNull(processorName, &quot;processorName can&apos;t be null&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Objects.requireNonNull(stateStoreNames, &quot;stateStoreNames can&apos;t be null&quot;);&lt;br/&gt;
+        Objects.requireNonNull(stateStoreNames, &quot;state store list must not be null&quot;);&lt;br/&gt;
         if (stateStoreNames.length == 0) 
{
             throw new TopologyException(&quot;Must provide at least one state store name.&quot;);
         }
&lt;p&gt;         for (final String stateStoreName : stateStoreNames) &lt;/p&gt;
{
+            Objects.requireNonNull(stateStoreName, &quot;state store name must not be null&quot;);
             connectProcessorAndStateStore(processorName, stateStoreName);
         }
&lt;p&gt;     }&lt;br/&gt;
@@ -627,6 +632,7 @@ public final void connectProcessors(final String... processorNames) {&lt;br/&gt;
         }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         for (final String processorName : processorNames) {&lt;br/&gt;
+            Objects.requireNonNull(processorName, &quot;processor name can&apos;t be null&quot;);&lt;br/&gt;
             if (!nodeFactories.containsKey(processorName)) &lt;/p&gt;
{
                 throw new TopologyException(&quot;Processor &quot; + processorName + &quot; is not added yet.&quot;);
             }
&lt;p&gt;diff --git a/streams/src/test/java/org/apache/kafka/streams/StreamsBuilderTest.java b/streams/src/test/java/org/apache/kafka/streams/StreamsBuilderTest.java&lt;br/&gt;
index cee01dc0662..13b5b4583f3 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/StreamsBuilderTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/StreamsBuilderTest.java&lt;br/&gt;
@@ -22,12 +22,16 @@&lt;br/&gt;
 import org.apache.kafka.streams.errors.TopologyException;&lt;br/&gt;
 import org.apache.kafka.streams.kstream.ForeachAction;&lt;br/&gt;
 import org.apache.kafka.streams.kstream.KStream;&lt;br/&gt;
+import org.apache.kafka.streams.kstream.KTable;&lt;br/&gt;
 import org.apache.kafka.streams.kstream.Materialized;&lt;br/&gt;
 import org.apache.kafka.streams.kstream.internals.KStreamImpl;&lt;br/&gt;
 import org.apache.kafka.streams.processor.internals.InternalTopologyBuilder;&lt;br/&gt;
 import org.apache.kafka.streams.state.KeyValueStore;&lt;br/&gt;
 import org.apache.kafka.test.KStreamTestDriver;&lt;br/&gt;
+import org.apache.kafka.test.MockMapper;&lt;br/&gt;
+import org.apache.kafka.test.MockPredicate;&lt;br/&gt;
 import org.apache.kafka.test.MockProcessorSupplier;&lt;br/&gt;
+import org.apache.kafka.test.MockValueJoiner;&lt;br/&gt;
 import org.apache.kafka.test.TestUtils;&lt;br/&gt;
 import org.junit.Rule;&lt;br/&gt;
 import org.junit.Test;&lt;br/&gt;
@@ -59,6 +63,30 @@ public void testFrom() &lt;/p&gt;
{
         builder.build().addSource(KStreamImpl.SOURCE_NAME + &quot;0000000000&quot;, &quot;topic-3&quot;);
     }

&lt;p&gt;+    @Test&lt;br/&gt;
+    public void shouldAllowJoinUnmaterializedFilteredKTable() &lt;/p&gt;
{
+        final KTable&amp;lt;Bytes, String&amp;gt; filteredKTable = builder.&amp;lt;Bytes, String&amp;gt;table(&quot;table-topic&quot;).filter(MockPredicate.&amp;lt;Bytes, String&amp;gt;allGoodPredicate());
+        builder.&amp;lt;Bytes, String&amp;gt;stream(&quot;stream-topic&quot;).join(filteredKTable, MockValueJoiner.TOSTRING_JOINER);
+
+        driver.setUp(builder, TestUtils.tempDirectory());
+    }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void shouldAllowJoinUnmaterializedMapValuedKTable() &lt;/p&gt;
{
+        final KTable&amp;lt;Bytes, String&amp;gt; mappedKTable = builder.&amp;lt;Bytes, String&amp;gt;table(&quot;table-topic&quot;).mapValues(MockMapper.&amp;lt;String&amp;gt;noOpValueMapper());
+        builder.&amp;lt;Bytes, String&amp;gt;stream(&quot;stream-topic&quot;).join(mappedKTable, MockValueJoiner.TOSTRING_JOINER);
+
+        driver.setUp(builder, TestUtils.tempDirectory());
+    }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void shouldAllowJoinMaterializedSourceKTable() &lt;/p&gt;
{
+        final KTable&amp;lt;Bytes, String&amp;gt; table = builder.&amp;lt;Bytes, String&amp;gt;table(&quot;table-topic&quot;);
+        builder.&amp;lt;Bytes, String&amp;gt;stream(&quot;stream-topic&quot;).join(table, MockValueJoiner.TOSTRING_JOINER);
+
+        driver.setUp(builder, TestUtils.tempDirectory());
+    }
&lt;p&gt;+&lt;br/&gt;
     @Test&lt;br/&gt;
     public void shouldProcessingFromSinkTopic() {&lt;br/&gt;
         final KStream&amp;lt;String, String&amp;gt; source = builder.stream(&quot;topic-source&quot;);&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/integration/InternalTopicIntegrationTest.java b/streams/src/test/java/org/apache/kafka/streams/integration/InternalTopicIntegrationTest.java&lt;br/&gt;
index 855bcea9b27..65a6de70157 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/integration/InternalTopicIntegrationTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/integration/InternalTopicIntegrationTest.java&lt;br/&gt;
@@ -36,7 +36,7 @@&lt;br/&gt;
 import org.apache.kafka.streams.kstream.ValueMapper;&lt;br/&gt;
 import org.apache.kafka.streams.processor.internals.ProcessorStateManager;&lt;br/&gt;
 import org.apache.kafka.test.IntegrationTest;&lt;br/&gt;
-import org.apache.kafka.test.MockKeyValueMapper;&lt;br/&gt;
+import org.apache.kafka.test.MockMapper;&lt;br/&gt;
 import org.apache.kafka.test.TestUtils;&lt;br/&gt;
 import org.junit.Before;&lt;br/&gt;
 import org.junit.BeforeClass;&lt;br/&gt;
@@ -139,7 +139,7 @@ public void shouldCompactTopicsForStateChangelogs() throws Exception {&lt;br/&gt;
                     public Iterable&amp;lt;String&amp;gt; apply(final String value) &lt;/p&gt;
{
                         return Arrays.asList(value.toLowerCase(Locale.getDefault()).split(&quot;\\W+&quot;));
                     }&lt;br/&gt;
-                }).groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueMapper())&lt;br/&gt;
+                }).groupBy(MockMapper.&amp;lt;String, String&amp;gt;selectValueMapper())&lt;br/&gt;
                 .count(&quot;Counts&quot;).toStream();&lt;br/&gt;
 &lt;br/&gt;
         wordCounts.to(stringSerde, longSerde, DEFAULT_OUTPUT_TOPIC);&lt;br/&gt;
@@ -186,7 +186,7 @@ public void shouldUseCompactAndDeleteForWindowStoreChangelogs() throws Exception&lt;br/&gt;
                     public Iterable&amp;lt;String&amp;gt; apply(String value) {                         return Arrays.asList(value.toLowerCase(Locale.getDefault()).split(&quot;\W+&quot;));                     }
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;}).groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueMapper())&lt;br/&gt;
+                }).groupBy(MockMapper.&amp;lt;String, String&amp;gt;selectValueMapper())&lt;br/&gt;
                 .count(TimeWindows.of(1000).until(durationMs), &quot;CountWindows&quot;).toStream();&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;diff --git a/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationDedupIntegrationTest.java b/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationDedupIntegrationTest.java&lt;br/&gt;
index cb588490623..4c12bb93544 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationDedupIntegrationTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationDedupIntegrationTest.java&lt;br/&gt;
@@ -39,7 +39,7 @@&lt;br/&gt;
 import org.apache.kafka.streams.kstream.TimeWindows;&lt;br/&gt;
 import org.apache.kafka.streams.kstream.Windowed;&lt;br/&gt;
 import org.apache.kafka.test.IntegrationTest;&lt;br/&gt;
-import org.apache.kafka.test.MockKeyValueMapper;&lt;br/&gt;
+import org.apache.kafka.test.MockMapper;&lt;br/&gt;
 import org.apache.kafka.test.TestUtils;&lt;br/&gt;
 import org.junit.After;&lt;br/&gt;
 import org.junit.Before;&lt;br/&gt;
@@ -99,7 +99,7 @@ public void before() throws InterruptedException {&lt;br/&gt;
         streamsConfiguration.put(StreamsConfig.CACHE_MAX_BYTES_BUFFERING_CONFIG, 10 * 1024 * 1024L);&lt;br/&gt;
         streamsConfiguration.put(IntegrationTestUtils.INTERNAL_LEAVE_GROUP_ON_CLOSE, true);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;KeyValueMapper&amp;lt;Integer, String, String&amp;gt; mapper = MockKeyValueMapper.&amp;lt;Integer, String&amp;gt;SelectValueMapper();&lt;br/&gt;
+        KeyValueMapper&amp;lt;Integer, String, String&amp;gt; mapper = MockMapper.&amp;lt;Integer, String&amp;gt;selectValueMapper();&lt;br/&gt;
         stream = builder.stream(streamOneInput, Consumed.with(Serdes.Integer(), Serdes.String()));&lt;br/&gt;
         groupedStream = stream&lt;br/&gt;
             .groupBy(&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java b/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java&lt;br/&gt;
index 3500dd57db2..4527c19b471 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/integration/KStreamAggregationIntegrationTest.java&lt;br/&gt;
@@ -52,7 +52,7 @@&lt;br/&gt;
 import org.apache.kafka.streams.state.ReadOnlySessionStore;&lt;br/&gt;
 import org.apache.kafka.streams.state.WindowStore;&lt;br/&gt;
 import org.apache.kafka.test.IntegrationTest;&lt;br/&gt;
-import org.apache.kafka.test.MockKeyValueMapper;&lt;br/&gt;
+import org.apache.kafka.test.MockMapper;&lt;br/&gt;
 import org.apache.kafka.test.TestUtils;&lt;br/&gt;
 import org.junit.After;&lt;br/&gt;
 import org.junit.Before;&lt;br/&gt;
@@ -116,7 +116,7 @@ public void before() throws InterruptedException {&lt;br/&gt;
         streamsConfiguration.put(StreamsConfig.DEFAULT_KEY_SERDE_CLASS_CONFIG, Serdes.String().getClass());&lt;br/&gt;
         streamsConfiguration.put(StreamsConfig.DEFAULT_VALUE_SERDE_CLASS_CONFIG, Serdes.Integer().getClass());&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final KeyValueMapper&amp;lt;Integer, String, String&amp;gt; mapper = MockKeyValueMapper.SelectValueMapper();&lt;br/&gt;
+        final KeyValueMapper&amp;lt;Integer, String, String&amp;gt; mapper = MockMapper.selectValueMapper();&lt;br/&gt;
         stream = builder.stream(streamOneInput, Consumed.with(Serdes.Integer(), Serdes.String()));&lt;br/&gt;
         groupedStream = stream&lt;br/&gt;
             .groupBy(&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/integration/KStreamRepartitionJoinTest.java b/streams/src/test/java/org/apache/kafka/streams/integration/KStreamRepartitionJoinTest.java&lt;br/&gt;
index 5f6ff449b87..32546de0ef0 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/streams/src/test/java/org/apache/kafka/streams/integration/KStreamRepartitionJoinTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/integration/KStreamRepartitionJoinTest.java&lt;br/&gt;
@@ -39,7 +39,7 @@&lt;br/&gt;
 import org.apache.kafka.streams.kstream.Predicate;&lt;br/&gt;
 import org.apache.kafka.streams.kstream.ValueJoiner;&lt;br/&gt;
 import org.apache.kafka.test.IntegrationTest;&lt;br/&gt;
-import org.apache.kafka.test.MockKeyValueMapper;&lt;br/&gt;
+import org.apache.kafka.test.MockMapper;&lt;br/&gt;
 import org.apache.kafka.test.MockValueJoiner;&lt;br/&gt;
 import org.apache.kafka.test.TestUtils;&lt;br/&gt;
 import org.junit.After;&lt;br/&gt;
@@ -104,7 +104,7 @@ public void before() throws InterruptedException 
{
         streamTwo = builder.stream(streamTwoInput, Consumed.with(Serdes.Integer(), Serdes.String()));
         streamFour = builder.stream(streamFourInput, Consumed.with(Serdes.Integer(), Serdes.String()));
 
-        keyMapper = MockKeyValueMapper.SelectValueKeyValueMapper();
+        keyMapper = MockMapper.selectValueKeyValueMapper();
     }&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @After&lt;br/&gt;
@@ -157,7 +157,7 @@ private ExpectedOutputOnTopic mapStreamOneAndJoin() throws InterruptedException&lt;/p&gt;

&lt;p&gt;     private ExpectedOutputOnTopic mapBothStreamsAndJoin() throws InterruptedException {&lt;br/&gt;
         final KStream&amp;lt;Integer, Integer&amp;gt; map1 = streamOne.map(keyMapper);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final KStream&amp;lt;Integer, String&amp;gt; map2 = streamTwo.map(MockKeyValueMapper.&amp;lt;Integer, String&amp;gt;NoOpKeyValueMapper());&lt;br/&gt;
+        final KStream&amp;lt;Integer, String&amp;gt; map2 = streamTwo.map(MockMapper.&amp;lt;Integer, String&amp;gt;noOpKeyValueMapper());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         doJoin(map1, map2, &quot;map-both-streams-and-join-&quot; + testNo);&lt;br/&gt;
         return new ExpectedOutputOnTopic(expectedStreamOneTwoJoin, &quot;map-both-streams-and-join-&quot; + testNo);&lt;br/&gt;
@@ -183,7 +183,7 @@ private ExpectedOutputOnTopic mapMapJoin() throws InterruptedException {&lt;br/&gt;
     private ExpectedOutputOnTopic selectKeyAndJoin() throws Exception {&lt;/p&gt;

&lt;p&gt;         final KStream&amp;lt;Integer, Integer&amp;gt; keySelected =&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;streamOne.selectKey(MockKeyValueMapper.&amp;lt;Long, Integer&amp;gt;SelectValueMapper());&lt;br/&gt;
+            streamOne.selectKey(MockMapper.&amp;lt;Long, Integer&amp;gt;selectValueMapper());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         final String outputTopic = &quot;select-key-join-&quot; + testNo;&lt;br/&gt;
         doJoin(keySelected, streamTwo, outputTopic);&lt;br/&gt;
@@ -222,7 +222,7 @@ private ExpectedOutputOnTopic joinMappedRhsStream() throws InterruptedException&lt;br/&gt;
     private ExpectedOutputOnTopic mapBothStreamsAndLeftJoin() throws InterruptedException {&lt;br/&gt;
         final KStream&amp;lt;Integer, Integer&amp;gt; map1 = streamOne.map(keyMapper);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final KStream&amp;lt;Integer, String&amp;gt; map2 = streamTwo.map(MockKeyValueMapper.&amp;lt;Integer, String&amp;gt;NoOpKeyValueMapper());&lt;br/&gt;
+        final KStream&amp;lt;Integer, String&amp;gt; map2 = streamTwo.map(MockMapper.&amp;lt;Integer, String&amp;gt;noOpKeyValueMapper());&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;         final String outputTopic = &quot;left-join-&quot; + testNo;&lt;br/&gt;
@@ -247,7 +247,7 @@ private ExpectedOutputOnTopic joinTwoMappedStreamsOneThatHasBeenPreviouslyJoined&lt;br/&gt;
         final KStream&amp;lt;Integer, Integer&amp;gt; map1 = streamOne.map(keyMapper);&lt;/p&gt;

&lt;p&gt;         final KeyValueMapper&amp;lt;Integer, String, KeyValue&amp;lt;Integer, String&amp;gt;&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;kvMapper = MockKeyValueMapper.NoOpKeyValueMapper();&lt;br/&gt;
+            kvMapper = MockMapper.noOpKeyValueMapper();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         final KStream&amp;lt;Integer, String&amp;gt; map2 = streamTwo.map(kvMapper);&lt;/p&gt;

&lt;p&gt;diff --git a/streams/src/test/java/org/apache/kafka/streams/integration/PurgeRepartitionTopicIntegrationTest.java b/streams/src/test/java/org/apache/kafka/streams/integration/PurgeRepartitionTopicIntegrationTest.java&lt;br/&gt;
index 18ffb876f50..4b983cf2da0 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/integration/PurgeRepartitionTopicIntegrationTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/integration/PurgeRepartitionTopicIntegrationTest.java&lt;br/&gt;
@@ -33,7 +33,7 @@&lt;br/&gt;
 import org.apache.kafka.streams.integration.utils.EmbeddedKafkaCluster;&lt;br/&gt;
 import org.apache.kafka.streams.integration.utils.IntegrationTestUtils;&lt;br/&gt;
 import org.apache.kafka.test.IntegrationTest;&lt;br/&gt;
-import org.apache.kafka.test.MockKeyValueMapper;&lt;br/&gt;
+import org.apache.kafka.test.MockMapper;&lt;br/&gt;
 import org.apache.kafka.test.TestCondition;&lt;br/&gt;
 import org.apache.kafka.test.TestUtils;&lt;br/&gt;
 import org.junit.After;&lt;br/&gt;
@@ -163,7 +163,7 @@ public void setup() &lt;/p&gt;
{
         StreamsBuilder builder = new StreamsBuilder();
 
         builder.stream(INPUT_TOPIC)
-               .groupBy(MockKeyValueMapper.SelectKeyKeyValueMapper())
+               .groupBy(MockMapper.selectKeyKeyValueMapper())
                .count();
 
         kafkaStreams = new KafkaStreams(builder.build(), new StreamsConfig(streamsConfiguration), time);
diff --git a/streams/src/test/java/org/apache/kafka/streams/integration/QueryableStateIntegrationTest.java b/streams/src/test/java/org/apache/kafka/streams/integration/QueryableStateIntegrationTest.java
index 51c5ce237ec..fc2eaccebc9 100644
--- a/streams/src/test/java/org/apache/kafka/streams/integration/QueryableStateIntegrationTest.java
+++ b/streams/src/test/java/org/apache/kafka/streams/integration/QueryableStateIntegrationTest.java
@@ -57,7 +57,7 @@
 import org.apache.kafka.streams.state.WindowStore;
 import org.apache.kafka.streams.state.WindowStoreIterator;
 import org.apache.kafka.test.IntegrationTest;
-import org.apache.kafka.test.MockKeyValueMapper;
+import org.apache.kafka.test.MockMapper;
 import org.apache.kafka.test.TestCondition;
 import org.apache.kafka.test.TestUtils;
 import org.junit.After;
@@ -218,7 +218,7 @@ private KafkaStreams createCountStream(final String inputTopic,
                     return Arrays.asList(value.toLowerCase(Locale.getDefault()).split(&quot;\\W+&quot;));
                 }
&lt;p&gt;             })&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueMapper());&lt;br/&gt;
+            .groupBy(MockMapper.&amp;lt;String, String&amp;gt;selectValueMapper());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         // Create a State Store for the all time word count&lt;br/&gt;
         groupedByWord&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/kstream/KStreamBuilderTest.java b/streams/src/test/java/org/apache/kafka/streams/kstream/KStreamBuilderTest.java&lt;br/&gt;
index 5ffedb872fd..f9949d3c5b8 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/kstream/KStreamBuilderTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/kstream/KStreamBuilderTest.java&lt;br/&gt;
@@ -27,7 +27,7 @@&lt;br/&gt;
 import org.apache.kafka.streams.processor.internals.ProcessorTopology;&lt;br/&gt;
 import org.apache.kafka.streams.processor.internals.SourceNode;&lt;br/&gt;
 import org.apache.kafka.test.KStreamTestDriver;&lt;br/&gt;
-import org.apache.kafka.test.MockKeyValueMapper;&lt;br/&gt;
+import org.apache.kafka.test.MockMapper;&lt;br/&gt;
 import org.apache.kafka.test.MockProcessorSupplier;&lt;br/&gt;
 import org.apache.kafka.test.MockTimestampExtractor;&lt;br/&gt;
 import org.apache.kafka.test.MockValueJoiner;&lt;br/&gt;
@@ -300,7 +300,7 @@ public void shouldMapStateStoresToCorrectSourceTopics() {&lt;br/&gt;
         final KTable&amp;lt;String, String&amp;gt; table = builder.table(&quot;table-topic&quot;, &quot;table-store&quot;);&lt;br/&gt;
         assertEquals(Collections.singletonList(&quot;table-topic&quot;), builder.stateStoreNameToSourceTopics().get(&quot;table-store&quot;));&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final KStream&amp;lt;String, String&amp;gt; mapped = playEvents.map(MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueKeyValueMapper());&lt;br/&gt;
+        final KStream&amp;lt;String, String&amp;gt; mapped = playEvents.map(MockMapper.&amp;lt;String, String&amp;gt;selectValueKeyValueMapper());&lt;br/&gt;
         mapped.leftJoin(table, MockValueJoiner.TOSTRING_JOINER).groupByKey().count(&quot;count&quot;);&lt;br/&gt;
         assertEquals(Collections.singletonList(&quot;table-topic&quot;), builder.stateStoreNameToSourceTopics().get(&quot;table-store&quot;));&lt;br/&gt;
         assertEquals(Collections.singletonList(APP_ID + &quot;-KSTREAM-MAP-0000000003-repartition&quot;), builder.stateStoreNameToSourceTopics().get(&quot;count&quot;));&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/InternalStreamsBuilderTest.java b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/InternalStreamsBuilderTest.java&lt;br/&gt;
index 05a02140c35..156acadbedd 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/InternalStreamsBuilderTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/InternalStreamsBuilderTest.java&lt;br/&gt;
@@ -31,7 +31,7 @@&lt;br/&gt;
 import org.apache.kafka.streams.processor.internals.ProcessorTopology;&lt;br/&gt;
 import org.apache.kafka.streams.state.KeyValueStore;&lt;br/&gt;
 import org.apache.kafka.test.KStreamTestDriver;&lt;br/&gt;
-import org.apache.kafka.test.MockKeyValueMapper;&lt;br/&gt;
+import org.apache.kafka.test.MockMapper;&lt;br/&gt;
 import org.apache.kafka.test.MockTimestampExtractor;&lt;br/&gt;
 import org.apache.kafka.test.MockValueJoiner;&lt;br/&gt;
 import org.junit.After;&lt;br/&gt;
@@ -251,7 +251,7 @@ public void shouldMapStateStoresToCorrectSourceTopics() throws Exception {&lt;br/&gt;
         final KTable&amp;lt;String, String&amp;gt; table = builder.table(&quot;table-topic&quot;, consumed, materialized);&lt;br/&gt;
         assertEquals(Collections.singletonList(&quot;table-topic&quot;), builder.internalTopologyBuilder.stateStoreNameToSourceTopics().get(&quot;table-store&quot;));&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final KStream&amp;lt;String, String&amp;gt; mapped = playEvents.map(MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueKeyValueMapper());&lt;br/&gt;
+        final KStream&amp;lt;String, String&amp;gt; mapped = playEvents.map(MockMapper.&amp;lt;String, String&amp;gt;selectValueKeyValueMapper());&lt;br/&gt;
         mapped.leftJoin(table, MockValueJoiner.TOSTRING_JOINER).groupByKey().count(&quot;count&quot;);&lt;br/&gt;
         assertEquals(Collections.singletonList(&quot;table-topic&quot;), builder.internalTopologyBuilder.stateStoreNameToSourceTopics().get(&quot;table-store&quot;));&lt;br/&gt;
         assertEquals(Collections.singletonList(APP_ID + &quot;-KSTREAM-MAP-0000000003-repartition&quot;), builder.internalTopologyBuilder.stateStoreNameToSourceTopics().get(&quot;count&quot;));&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KGroupedTableImplTest.java b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KGroupedTableImplTest.java&lt;br/&gt;
index 705cf62f9a6..3bbd7e2fa50 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KGroupedTableImplTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KGroupedTableImplTest.java&lt;br/&gt;
@@ -33,7 +33,7 @@&lt;br/&gt;
 import org.apache.kafka.test.KStreamTestDriver;&lt;br/&gt;
 import org.apache.kafka.test.MockAggregator;&lt;br/&gt;
 import org.apache.kafka.test.MockInitializer;&lt;br/&gt;
-import org.apache.kafka.test.MockKeyValueMapper;&lt;br/&gt;
+import org.apache.kafka.test.MockMapper;&lt;br/&gt;
 import org.apache.kafka.test.MockReducer;&lt;br/&gt;
 import org.apache.kafka.test.TestUtils;&lt;br/&gt;
 import org.junit.Before;&lt;br/&gt;
@@ -62,7 +62,7 @@&lt;br/&gt;
     @Before&lt;br/&gt;
     public void before() 
{
         groupedTable = builder.table(&quot;blah&quot;, Consumed.with(Serdes.String(), Serdes.String()))
-                .groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueKeyValueMapper());
+                .groupBy(MockMapper.&amp;lt;String, String&amp;gt;selectValueKeyValueMapper());
     }&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Test&lt;br/&gt;
@@ -221,7 +221,7 @@ public void shouldReduceAndMaterializeResults() {&lt;br/&gt;
     @Test&lt;br/&gt;
     public void shouldCountAndMaterializeResults() {&lt;br/&gt;
         final KTable&amp;lt;String, String&amp;gt; table = builder.table(topic, Consumed.with(Serdes.String(), Serdes.String()));&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;table.groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueKeyValueMapper(),&lt;br/&gt;
+        table.groupBy(MockMapper.&amp;lt;String, String&amp;gt;selectValueKeyValueMapper(),&lt;br/&gt;
                       Serialized.with(Serdes.String(),&lt;br/&gt;
                                       Serdes.String()))&lt;br/&gt;
                 .count(Materialized.&amp;lt;String, Long, KeyValueStore&amp;lt;Bytes, byte[]&amp;gt;&amp;gt;as(&quot;count&quot;)&lt;br/&gt;
@@ -238,7 +238,7 @@ public void shouldCountAndMaterializeResults() {&lt;br/&gt;
     @Test&lt;br/&gt;
     public void shouldAggregateAndMaterializeResults() {&lt;br/&gt;
         final KTable&amp;lt;String, String&amp;gt; table = builder.table(topic, Consumed.with(Serdes.String(), Serdes.String()));&lt;/li&gt;
	&lt;li&gt;table.groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueKeyValueMapper(),&lt;br/&gt;
+        table.groupBy(MockMapper.&amp;lt;String, String&amp;gt;selectValueKeyValueMapper(),&lt;br/&gt;
                       Serialized.with(Serdes.String(),&lt;br/&gt;
                                       Serdes.String()))&lt;br/&gt;
                 .aggregate(MockInitializer.STRING_INIT,&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KStreamImplTest.java b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KStreamImplTest.java&lt;br/&gt;
index 0a0232c16e3..562711d2d08 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KStreamImplTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KStreamImplTest.java&lt;br/&gt;
@@ -40,7 +40,7 @@&lt;br/&gt;
 import org.apache.kafka.streams.processor.internals.ProcessorTopology;&lt;br/&gt;
 import org.apache.kafka.streams.processor.internals.SourceNode;&lt;br/&gt;
 import org.apache.kafka.test.KStreamTestDriver;&lt;br/&gt;
-import org.apache.kafka.test.MockKeyValueMapper;&lt;br/&gt;
+import org.apache.kafka.test.MockMapper;&lt;br/&gt;
 import org.apache.kafka.test.MockProcessorSupplier;&lt;br/&gt;
 import org.apache.kafka.test.MockValueJoiner;&lt;br/&gt;
 import org.junit.Before;&lt;br/&gt;
@@ -379,7 +379,7 @@ public void shouldNotAllowNullActionOnForEach() {&lt;br/&gt;
     @Test(expected = NullPointerException.class)&lt;br/&gt;
     public void shouldNotAllowNullTableOnJoinWithGlobalTable() 
{
         testStream.join((GlobalKTable) null,
-                        MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueMapper(),
+                        MockMapper.&amp;lt;String, String&amp;gt;selectValueMapper(),
                         MockValueJoiner.TOSTRING_JOINER);
     }&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -393,14 +393,14 @@ public void shouldNotAllowNullMapperOnJoinWithGlobalTable() {&lt;br/&gt;
     @Test(expected = NullPointerException.class)&lt;br/&gt;
     public void shouldNotAllowNullJoinerOnJoinWithGlobalTable() &lt;/p&gt;
{
         testStream.join(builder.globalTable(&quot;global&quot;, stringConsumed),
-                        MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueMapper(),
+                        MockMapper.&amp;lt;String, String&amp;gt;selectValueMapper(),
                         null);
     }

&lt;p&gt;     @Test(expected = NullPointerException.class)&lt;br/&gt;
     public void shouldNotAllowNullTableOnJLeftJoinWithGlobalTable() &lt;/p&gt;
{
         testStream.leftJoin((GlobalKTable) null,
-                        MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueMapper(),
+                        MockMapper.&amp;lt;String, String&amp;gt;selectValueMapper(),
                         MockValueJoiner.TOSTRING_JOINER);
     }

&lt;p&gt;@@ -414,7 +414,7 @@ public void shouldNotAllowNullMapperOnLeftJoinWithGlobalTable() {&lt;br/&gt;
     @Test(expected = NullPointerException.class)&lt;br/&gt;
     public void shouldNotAllowNullJoinerOnLeftJoinWithGlobalTable() &lt;/p&gt;
{
         testStream.leftJoin(builder.globalTable(&quot;global&quot;, stringConsumed),
-                        MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueMapper(),
+                        MockMapper.&amp;lt;String, String&amp;gt;selectValueMapper(),
                         null);
     }

&lt;p&gt;diff --git a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KTableAggregateTest.java b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KTableAggregateTest.java&lt;br/&gt;
index 0ae95dd9c5a..df8d2923a04 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KTableAggregateTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KTableAggregateTest.java&lt;br/&gt;
@@ -35,7 +35,7 @@&lt;br/&gt;
 import org.apache.kafka.test.KStreamTestDriver;&lt;br/&gt;
 import org.apache.kafka.test.MockAggregator;&lt;br/&gt;
 import org.apache.kafka.test.MockInitializer;&lt;br/&gt;
-import org.apache.kafka.test.MockKeyValueMapper;&lt;br/&gt;
+import org.apache.kafka.test.MockMapper;&lt;br/&gt;
 import org.apache.kafka.test.MockProcessorSupplier;&lt;br/&gt;
 import org.apache.kafka.test.TestUtils;&lt;br/&gt;
 import org.junit.Before;&lt;br/&gt;
@@ -73,7 +73,7 @@ public void testAggBasic() {&lt;br/&gt;
         final MockProcessorSupplier&amp;lt;String, String&amp;gt; proc = new MockProcessorSupplier&amp;lt;&amp;gt;();&lt;/p&gt;

&lt;p&gt;         KTable&amp;lt;String, String&amp;gt; table1 = builder.table(topic1, consumed);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;KTable&amp;lt;String, String&amp;gt; table2 = table1.groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;NoOpKeyValueMapper(),&lt;br/&gt;
+        KTable&amp;lt;String, String&amp;gt; table2 = table1.groupBy(MockMapper.&amp;lt;String, String&amp;gt;noOpKeyValueMapper(),&lt;br/&gt;
                                                        stringSerialzied&lt;br/&gt;
         ).aggregate(MockInitializer.STRING_INIT,&lt;br/&gt;
                 MockAggregator.TOSTRING_ADDER,&lt;br/&gt;
@@ -121,7 +121,7 @@ public void testAggCoalesced() {&lt;br/&gt;
         final MockProcessorSupplier&amp;lt;String, String&amp;gt; proc = new MockProcessorSupplier&amp;lt;&amp;gt;();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         KTable&amp;lt;String, String&amp;gt; table1 = builder.table(topic1, consumed);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;KTable&amp;lt;String, String&amp;gt; table2 = table1.groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;NoOpKeyValueMapper(),&lt;br/&gt;
+        KTable&amp;lt;String, String&amp;gt; table2 = table1.groupBy(MockMapper.&amp;lt;String, String&amp;gt;noOpKeyValueMapper(),&lt;br/&gt;
                                                        stringSerialzied&lt;br/&gt;
         ).aggregate(MockInitializer.STRING_INIT,&lt;br/&gt;
             MockAggregator.TOSTRING_ADDER,&lt;br/&gt;
@@ -235,7 +235,7 @@ public void testCount() {&lt;br/&gt;
         final MockProcessorSupplier&amp;lt;String, Long&amp;gt; proc = new MockProcessorSupplier&amp;lt;&amp;gt;();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         builder.table(input, consumed)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueKeyValueMapper(), stringSerialzied)&lt;br/&gt;
+                .groupBy(MockMapper.&amp;lt;String, String&amp;gt;selectValueKeyValueMapper(), stringSerialzied)&lt;br/&gt;
                 .count(&quot;count&quot;)&lt;br/&gt;
                 .toStream()&lt;br/&gt;
                 .process(proc);&lt;br/&gt;
@@ -250,7 +250,7 @@ public void testCountWithInternalStore() {&lt;br/&gt;
         final MockProcessorSupplier&amp;lt;String, Long&amp;gt; proc = new MockProcessorSupplier&amp;lt;&amp;gt;();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         builder.table(input, consumed)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueKeyValueMapper(), stringSerialzied)&lt;br/&gt;
+            .groupBy(MockMapper.&amp;lt;String, String&amp;gt;selectValueKeyValueMapper(), stringSerialzied)&lt;br/&gt;
             .count()&lt;br/&gt;
             .toStream()&lt;br/&gt;
             .process(proc);&lt;br/&gt;
@@ -265,7 +265,7 @@ public void testCountCoalesced() {&lt;br/&gt;
         final MockProcessorSupplier&amp;lt;String, Long&amp;gt; proc = new MockProcessorSupplier&amp;lt;&amp;gt;();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         builder.table(input, consumed)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;SelectValueKeyValueMapper(), stringSerialzied)&lt;br/&gt;
+            .groupBy(MockMapper.&amp;lt;String, String&amp;gt;selectValueKeyValueMapper(), stringSerialzied)&lt;br/&gt;
             .count(&quot;count&quot;)&lt;br/&gt;
             .toStream()&lt;br/&gt;
             .process(proc);&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KTableFilterTest.java b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KTableFilterTest.java&lt;br/&gt;
index 7986277a7f7..d70d8b7d59b 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KTableFilterTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KTableFilterTest.java&lt;br/&gt;
@@ -28,7 +28,7 @@&lt;br/&gt;
 import org.apache.kafka.test.KStreamTestDriver;&lt;br/&gt;
 import org.apache.kafka.test.MockProcessorSupplier;&lt;br/&gt;
 import org.apache.kafka.test.MockReducer;&lt;br/&gt;
-import org.apache.kafka.test.MockKeyValueMapper;&lt;br/&gt;
+import org.apache.kafka.test.MockMapper;&lt;br/&gt;
 import org.apache.kafka.test.TestUtils;&lt;br/&gt;
 import org.junit.Before;&lt;br/&gt;
 import org.junit.Rule;&lt;br/&gt;
@@ -451,7 +451,7 @@ public void testSkipNullOnMaterialization() {&lt;br/&gt;
                 public boolean test(String key, String value) 
{
                     return value.equalsIgnoreCase(&quot;accept&quot;);
                 }&lt;br/&gt;
-            }).groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;NoOpKeyValueMapper())&lt;br/&gt;
+            }).groupBy(MockMapper.&amp;lt;String, String&amp;gt;noOpKeyValueMapper())&lt;br/&gt;
             .reduce(MockReducer.STRING_ADDER, MockReducer.STRING_REMOVER, &quot;mock-result&quot;);&lt;br/&gt;
 &lt;br/&gt;
         doTestSkipNullOnMaterialization(builder, table1, table2, topic1);&lt;br/&gt;
@@ -473,7 +473,7 @@ public void testQueryableSkipNullOnMaterialization() {&lt;br/&gt;
                 public boolean test(String key, String value) {                     return value.equalsIgnoreCase(&quot;accept&quot;);                 }&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;}, &quot;anyStoreNameFilter&quot;).groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;NoOpKeyValueMapper())&lt;br/&gt;
+            }, &quot;anyStoreNameFilter&quot;).groupBy(MockMapper.&amp;lt;String, String&amp;gt;noOpKeyValueMapper())&lt;br/&gt;
             .reduce(MockReducer.STRING_ADDER, MockReducer.STRING_REMOVER, &quot;mock-result&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         doTestSkipNullOnMaterialization(builder, table1, table2, topic1);&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KTableImplTest.java b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KTableImplTest.java&lt;br/&gt;
index 9d918e27b7c..9539b45fe74 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KTableImplTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KTableImplTest.java&lt;br/&gt;
@@ -35,7 +35,7 @@&lt;br/&gt;
 import org.apache.kafka.test.KStreamTestDriver;&lt;br/&gt;
 import org.apache.kafka.test.MockAggregator;&lt;br/&gt;
 import org.apache.kafka.test.MockInitializer;&lt;br/&gt;
-import org.apache.kafka.test.MockKeyValueMapper;&lt;br/&gt;
+import org.apache.kafka.test.MockMapper;&lt;br/&gt;
 import org.apache.kafka.test.MockProcessorSupplier;&lt;br/&gt;
 import org.apache.kafka.test.MockReducer;&lt;br/&gt;
 import org.apache.kafka.test.MockValueJoiner;&lt;br/&gt;
@@ -341,11 +341,11 @@ public void testRepartition() throws NoSuchFieldException, IllegalAccessExceptio&lt;br/&gt;
                                                                            .withValueSerde(stringSerde)&lt;br/&gt;
                 );&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;table1.groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;NoOpKeyValueMapper())&lt;br/&gt;
+        table1.groupBy(MockMapper.&amp;lt;String, String&amp;gt;noOpKeyValueMapper())&lt;br/&gt;
             .aggregate(MockInitializer.STRING_INIT, MockAggregator.TOSTRING_ADDER, MockAggregator.TOSTRING_REMOVER, &quot;mock-result1&quot;);&lt;/li&gt;
&lt;/ul&gt;



&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;table1.groupBy(MockKeyValueMapper.&amp;lt;String, String&amp;gt;NoOpKeyValueMapper())&lt;br/&gt;
+        table1.groupBy(MockMapper.&amp;lt;String, String&amp;gt;noOpKeyValueMapper())&lt;br/&gt;
             .reduce(MockReducer.STRING_ADDER, MockReducer.STRING_REMOVER, &quot;mock-result2&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         driver.setUp(builder, stateDir, stringSerde, stringSerde);&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/processor/internals/InternalTopologyBuilderTest.java b/streams/src/test/java/org/apache/kafka/streams/processor/internals/InternalTopologyBuilderTest.java&lt;br/&gt;
index e68f86bc15c..a39e545f513 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/processor/internals/InternalTopologyBuilderTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/processor/internals/InternalTopologyBuilderTest.java&lt;br/&gt;
@@ -448,6 +448,11 @@ public void shouldNotAllowNullProcessorNameWhenConnectingProcessorAndStateStores&lt;br/&gt;
         builder.connectProcessorAndStateStores(null, &quot;store&quot;);&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;+    @Test(expected = NullPointerException.class)&lt;br/&gt;
+    public void shouldNotAllowNullStateStoreNameWhenConnectingProcessorAndStateStores() throws Exception {&lt;br/&gt;
+        builder.connectProcessorAndStateStores(&quot;processor&quot;, new String[]&lt;/p&gt;
{null}
&lt;p&gt;);&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
     @Test(expected = NullPointerException.class)&lt;br/&gt;
     public void shouldNotAddNullInternalTopic() throws Exception {&lt;br/&gt;
         builder.addInternalTopic(null);&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/test/MockKeyValueMapper.java b/streams/src/test/java/org/apache/kafka/test/MockMapper.java&lt;br/&gt;
similarity index 76%&lt;br/&gt;
rename from streams/src/test/java/org/apache/kafka/test/MockKeyValueMapper.java&lt;br/&gt;
rename to streams/src/test/java/org/apache/kafka/test/MockMapper.java&lt;br/&gt;
index 2ad24d7592e..fec9522de82 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/test/MockKeyValueMapper.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/test/MockMapper.java&lt;br/&gt;
@@ -18,10 +18,9 @@&lt;/p&gt;

&lt;p&gt; import org.apache.kafka.streams.KeyValue;&lt;br/&gt;
 import org.apache.kafka.streams.kstream.KeyValueMapper;&lt;br/&gt;
+import org.apache.kafka.streams.kstream.ValueMapper;&lt;/p&gt;

&lt;p&gt;-public class MockKeyValueMapper {&lt;br/&gt;
-&lt;br/&gt;
-&lt;br/&gt;
+public class MockMapper {&lt;/p&gt;

&lt;p&gt;     private static class NoOpKeyValueMapper&amp;lt;K, V&amp;gt; implements KeyValueMapper&amp;lt;K, V, KeyValue&amp;lt;K, V&amp;gt;&amp;gt; {&lt;br/&gt;
         @Override&lt;br/&gt;
@@ -51,20 +50,31 @@ public K apply(K key, V value) {&lt;br/&gt;
         }&lt;br/&gt;
     }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static &amp;lt;K, V&amp;gt; KeyValueMapper&amp;lt;K, V, K&amp;gt; SelectKeyKeyValueMapper() {&lt;br/&gt;
+    private static class NoOpValueMapper&amp;lt;V&amp;gt; implements ValueMapper&amp;lt;V, V&amp;gt; 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+        @Override+        public V apply(final V value) {
+            return value;
+        }+    }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+&lt;br/&gt;
+    public static &amp;lt;K, V&amp;gt; KeyValueMapper&amp;lt;K, V, K&amp;gt; selectKeyKeyValueMapper() &lt;/p&gt;
{
         return new SelectKeyMapper&amp;lt;&amp;gt;();
     }&lt;/li&gt;
&lt;/ul&gt;



&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static &amp;lt;K, V&amp;gt; KeyValueMapper&amp;lt;K, V, KeyValue&amp;lt;K, V&amp;gt;&amp;gt; NoOpKeyValueMapper() {&lt;br/&gt;
+    public static &amp;lt;K, V&amp;gt; KeyValueMapper&amp;lt;K, V, KeyValue&amp;lt;K, V&amp;gt;&amp;gt; noOpKeyValueMapper() 
{
         return new NoOpKeyValueMapper&amp;lt;&amp;gt;();
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static &amp;lt;K, V&amp;gt; KeyValueMapper&amp;lt;K, V, KeyValue&amp;lt;V, V&amp;gt;&amp;gt; SelectValueKeyValueMapper() {&lt;br/&gt;
+    public static &amp;lt;K, V&amp;gt; KeyValueMapper&amp;lt;K, V, KeyValue&amp;lt;V, V&amp;gt;&amp;gt; selectValueKeyValueMapper() 
{
         return new SelectValueKeyValueMapper&amp;lt;&amp;gt;();
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static &amp;lt;K, V&amp;gt; KeyValueMapper&amp;lt;K, V, V&amp;gt; SelectValueMapper() 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+    public static &amp;lt;K, V&amp;gt; KeyValueMapper&amp;lt;K, V, V&amp;gt; selectValueMapper() {
         return new SelectValueMapper&amp;lt;&amp;gt;();
     }++    public static &amp;lt;V&amp;gt; ValueMapper&amp;lt;V, V&amp;gt; noOpValueMapper() {
+        return new NoOpValueMapper&amp;lt;&amp;gt;();
+    } }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;\ No newline at end of file&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/test/MockPredicate.java b/streams/src/test/java/org/apache/kafka/test/MockPredicate.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..9d59bab3d9b&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;/dev/null&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/test/MockPredicate.java&lt;br/&gt;
@@ -0,0 +1,33 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements. See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License. You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+package org.apache.kafka.test;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.kafka.streams.kstream.Predicate;&lt;br/&gt;
+&lt;br/&gt;
+public class MockPredicate {&lt;br/&gt;
+&lt;br/&gt;
+    private static class AllGoodPredicate&amp;lt;K, V&amp;gt; implements Predicate&amp;lt;K, V&amp;gt; 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+        @Override+        public boolean test(final K key, final V value) {
+            return true;
+        }+    }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+&lt;br/&gt;
+    public static &amp;lt;K, V&amp;gt; Predicate&amp;lt;K, V&amp;gt; allGoodPredicate() &lt;/p&gt;
{
+        return new AllGoodPredicate&amp;lt;&amp;gt;();
+    }
&lt;p&gt;+}&lt;/p&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 44 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3o72v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>