<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:38:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-938] High CPU usage when more or less idle</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-938</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We&apos;ve noticed Kafka using a lot of CPU in a pretty much idle environment and tracked it down to it&apos;s DelayedItem implementation. In particular, the time conversion for how much longer to wait:&lt;/p&gt;

&lt;p&gt;  def getDelay(unit: TimeUnit): Long = &lt;/p&gt;
{
    val elapsedMs = (SystemTime.milliseconds - createdMs)
    unit.convert(max(delayMs - elapsedMs, 0), unit)
  }

&lt;p&gt;does not actually convert, so Kafka ends up treating a ms value like nanoseconds, e.g. waking up every 100 ns or so. The above code should really be:&lt;/p&gt;

&lt;p&gt;  def getDelay(unit: TimeUnit): Long = &lt;/p&gt;
{
    val elapsedMs = (SystemTime.milliseconds - createdMs)
    unit.convert(max(delayMs - elapsedMs, 0), TimeUnit.MILLISECONDS)
  }

&lt;p&gt;I&apos;ll attach a patch.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12652282">KAFKA-938</key>
            <summary>High CPU usage when more or less idle</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="smeder">Sam Meder</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Jun 2013 21:39:40 +0000</created>
                <updated>Wed, 12 Jun 2013 18:43:57 +0000</updated>
                            <resolved>Wed, 12 Jun 2013 05:44:10 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13680958" author="junrao" created="Wed, 12 Jun 2013 05:44:10 +0000"  >&lt;p&gt;Wow, thanks for finding this and providing a patch. +1 and committed to 0.8.&lt;/p&gt;</comment>
                            <comment id="13681479" author="jjkoshy" created="Wed, 12 Jun 2013 18:28:12 +0000"  >&lt;p&gt;Excellent catch Sam!&lt;/p&gt;

&lt;p&gt;One comment: I think the DelayedItem class was intended to support arbitrary (non-millisecond) timunits but that was buggy in two ways:&lt;br/&gt;
&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  The getDelay&apos;s &apos;unit&apos; parameter shadowed the DelayedItem&apos;s &apos;unit&apos; member&lt;br/&gt;
(ii) The delayMs val assumes that the delay is always in ms (which prevents DelayedItem from supporting arbitrary time units).&lt;br/&gt;
Also, I think we must have missed the bit of the DelayQueue documentation that says getDelay is called with TimeUnit.NANOSECONDS&lt;/p&gt;

&lt;p&gt;I think we can tweak this a bit to make it support arbitrary timeunits - otherwise, the &quot;unit&quot; parameter of DelayedItem is of no use. I can attach a patch to make this clearer.&lt;/p&gt;</comment>
                            <comment id="13681497" author="jjkoshy" created="Wed, 12 Jun 2013 18:43:57 +0000"  >&lt;p&gt;Actually, small correction: I overlooked that the delayMs val converts the given delay from its source unit to milliseconds. So the only caveat is that precision will be lost if the desired timeunit is nanos - which we don&apos;t really need so I don&apos;t think we need any further changes here. Thanks again!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12587325" name="timeunit.patch" size="636" author="smeder" created="Tue, 11 Jun 2013 21:41:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332606</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ldlz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332935</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>