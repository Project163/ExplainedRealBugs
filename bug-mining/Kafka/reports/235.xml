<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:37:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-802] Flush message interval is based on compressed message count</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-802</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In Log.append(), we use compressed message count to determine whether to flush the log or not. We should use uncompressed message count instead.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12636725">KAFKA-802</key>
            <summary>Flush message interval is based on compressed message count</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nehanarkhede">Neha Narkhede</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Mar 2013 04:35:50 +0000</created>
                <updated>Tue, 19 Mar 2013 17:01:05 +0000</updated>
                            <resolved>Tue, 19 Mar 2013 17:01:02 +0000</resolved>
                                    <version>0.8.0</version>
                                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13600809" author="junrao" created="Wed, 13 Mar 2013 04:38:46 +0000"  >&lt;p&gt;This is easy to fix on the leader since it iterates uncompressed messages to assign offsets. It&apos;s a bit hard to fix in the follower. We could iterate uncompressed messages. This will add CPU overhead though.&lt;/p&gt;</comment>
                            <comment id="13601311" author="nehanarkhede" created="Wed, 13 Mar 2013 16:24:20 +0000"  >&lt;p&gt;Two changes -&lt;/p&gt;

&lt;p&gt;1. Changed the maybeFlush() call from Log.append() to take in number of appended messages. On the leader, this will be the uncompressed message count, but on the follower, this will still be the compressed message count since we don&apos;t recompress data on the follower. I think this is fine.&lt;/p&gt;

&lt;p&gt;2. Changed the default of log.flush.interval.messages to 10000 instead of 500. With replication, a very low default for this config doesn&apos;t make sense&lt;/p&gt;</comment>
                            <comment id="13601318" author="sriramsub" created="Wed, 13 Mar 2013 16:29:50 +0000"  >&lt;p&gt;Personally, having different meaning to flushed messages (compressed for follower Vs uncompressed for leader) will make it tough to reason out things. &lt;/p&gt;</comment>
                            <comment id="13601393" author="junrao" created="Wed, 13 Mar 2013 17:28:08 +0000"  >&lt;p&gt;Sriram, agreed that it&apos;s better if the meaning for flush interval is consistent btw the leader and the follower. After thinking a bit more, I think this is doable. Basically, during shallow iteration, the offset returned for the compressed message is the offset of the last uncompressed message in it. So, the last offset is actually correct even if messages are compressed. The problem is with the first offset. I think we can set first offset to nextOffset at the beginning of append(). This way, whether we need to assign offsets or not, we can alway obtain the right first offset. We can then use different between last and first offset to drive log flush.&lt;/p&gt;</comment>
                            <comment id="13601407" author="nehanarkhede" created="Wed, 13 Mar 2013 17:38:59 +0000"  >&lt;p&gt;That is a good insight, Jun. Included that fix in v2&lt;/p&gt;</comment>
                            <comment id="13601421" author="junrao" created="Wed, 13 Mar 2013 17:48:30 +0000"  >&lt;p&gt;Thanks for patch v2. We need a few tweaks.&lt;/p&gt;

&lt;p&gt;20. The assignment to firstOffset and the computation of numAppendedMessages have to be done inside the synchronization of the lock.&lt;/p&gt;

&lt;p&gt;21. The following statements in append are no longer valid and can be removed.&lt;br/&gt;
          // return the offset at which the messages were appended&lt;br/&gt;
          offsets&lt;/p&gt;
</comment>
                            <comment id="13601475" author="junrao" created="Wed, 13 Mar 2013 18:40:56 +0000"  >&lt;p&gt;Thanks for patch v3. +1.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12573538" name="kafka-802-v2.patch" size="2005" author="nehanarkhede" created="Wed, 13 Mar 2013 17:38:59 +0000"/>
                            <attachment id="12573544" name="kafka-802-v3.patch" size="2864" author="nehanarkhede" created="Wed, 13 Mar 2013 18:01:21 +0000"/>
                            <attachment id="12573530" name="kafka-802.patch" size="1614" author="nehanarkhede" created="Wed, 13 Mar 2013 16:24:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>317217</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1iqiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>317558</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>