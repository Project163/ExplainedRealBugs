<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:16:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6833] KafkaProducer throws &quot;Invalid partition given with record&quot; exception</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6833</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Currently, when creating topics via ZooKeeper, there is a small but definite delay between creating the nodes in ZK, and having the topics created in the brokers. the KafkaProducer maintains a metadata cache about topics which get updated after the broker metadata is&#160;updated. If an application&#160;adds partitions to a topic, and immediately tries to produce records to a new partition, a KafkaException is throw with a message similar to the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.apache.kafka.common.KafkaException: Invalid partition given with record: 12 is not in the range [0...1).
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In this case, since the application has&#160;context that it created the topics, it might be worthwhile to consider if a more specific exception can be thrown instead of KafkaException. For example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PartitionNotFoundException &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; KafkaException {...}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This&#160;could allow the application to be able to interpret&#160;such an error, and act accordingly.&lt;/p&gt;

&lt;p&gt;EDIT:&#160;Correct &quot;create topics&quot; to &quot;adds partitions to a topic&quot;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13155747">KAFKA-6833</key>
            <summary>KafkaProducer throws &quot;Invalid partition given with record&quot; exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bob-barrett">Bob Barrett</assignee>
                                    <reporter username="wicknicks">Arjun Satish</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Apr 2018 17:34:17 +0000</created>
                <updated>Thu, 24 Jan 2019 02:27:46 +0000</updated>
                            <resolved>Wed, 9 Jan 2019 08:05:29 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16580380" author="githubbot" created="Tue, 14 Aug 2018 20:19:05 +0000"  >&lt;p&gt;bob-barrett opened a new pull request #5507: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6833&quot; title=&quot;KafkaProducer throws &amp;quot;Invalid partition given with record&amp;quot; exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6833&quot;&gt;&lt;del&gt;KAFKA-6833&lt;/del&gt;&lt;/a&gt;: KafkaProducer throws &apos;Invalid partition given with record&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/5507&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/5507&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &#8230;&apos; exception&lt;/p&gt;

&lt;p&gt;   Create a new exception class, PartitionOutOfRangeException, which is thrown when a producer attempts to fetch metadata for a partition that is outside the range of partitions for the topic. Tested by catching the specific exception class when fetching metadata for an out of range partition.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16705465" author="chrisegerton" created="Fri, 30 Nov 2018 23:42:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bob-barrett&quot; class=&quot;user-hover&quot; rel=&quot;bob-barrett&quot;&gt;bob-barrett&lt;/a&gt; another possible approach could be to alter the behavior of the producer while it waits for metadata on a topic-partition.&lt;/p&gt;

&lt;p&gt;Currently, when a record is given to the producer to send, it checks its metadata cache and, if the topic-partition exists in the cache, &lt;a href=&quot;https://github.com/apache/kafka/blob/9b476bc5f4a2fdbd62ad84e50e65331c21b321d0/clients/src/main/java/org/apache/kafka/clients/producer/KafkaProducer.java#L967-L968&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the cached data is used&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If the topic doesn&apos;t exist or that partition doesn&apos;t exist in the topic, the producer requests a metadata update and then waits until&#160;either&#160;&lt;tt&gt;max.block.ms&lt;/tt&gt;&#160;has been exceeded or until an update has occurred that&#160;guarantees that the&#160;&lt;a href=&quot;https://github.com/apache/kafka/blob/9b476bc5f4a2fdbd62ad84e50e65331c21b321d0/clients/src/main/java/org/apache/kafka/clients/producer/KafkaProducer.java#L998&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;topic exists&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We could tweak the logic so that the producer waits until either &lt;tt&gt;max.block.ms&lt;/tt&gt; has been exceeded or until the topic-partition exists.&lt;/p&gt;

&lt;p&gt;This would relieve users of the KafkaProducer from having to handle retry logic for the suggested &lt;tt&gt;PartitionOutOfRangeException&lt;/tt&gt;, although it could also potentially lead to slower failures when trying to send a record to an invalid partition.&lt;/p&gt;</comment>
                            <comment id="16719576" author="mageshn" created="Thu, 13 Dec 2018 00:12:28 +0000"  >&lt;p&gt;In my opinion, the behavior for a new topic and new partition should be no different. With that context and based on&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ChrisEgerton&quot; class=&quot;user-hover&quot; rel=&quot;ChrisEgerton&quot;&gt;ChrisEgerton&lt;/a&gt; &apos;s suggestion, I really wonder&#160;if there is any specific reason for it to be handled differently for a new topic vs a new partition.&lt;/p&gt;</comment>
                            <comment id="16730421" author="bob-barrett" created="Fri, 28 Dec 2018 18:29:40 +0000"  >&lt;p&gt;Thanks for the suggestion, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ChrisEgerton&quot; class=&quot;user-hover&quot; rel=&quot;ChrisEgerton&quot;&gt;ChrisEgerton&lt;/a&gt;! I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mageshn&quot; class=&quot;user-hover&quot; rel=&quot;mageshn&quot;&gt;mageshn&lt;/a&gt;, I think that&apos;s a better approach.&lt;/p&gt;</comment>
                            <comment id="16730422" author="githubbot" created="Fri, 28 Dec 2018 18:30:09 +0000"  >&lt;p&gt;bob-barrett commented on pull request #6073: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6833&quot; title=&quot;KafkaProducer throws &amp;quot;Invalid partition given with record&amp;quot; exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6833&quot;&gt;&lt;del&gt;KAFKA-6833&lt;/del&gt;&lt;/a&gt;: KafkaProducer throws &quot;Invalid partition given with record&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6073&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6073&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &#8230;&quot; exception&lt;/p&gt;

&lt;p&gt;   This patch changes the behavior of KafkaProducer.waitOnMetadata to wait up to max.block.ms when the partition specified in the produce request is out of the range of partitions present in the metadata. This improves the user experience in the case when partitions are added to a topic and a client attempts to produce to one of the new partitions before the metadata has propagated to the brokers. Tested with unit tests.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16730424" author="githubbot" created="Fri, 28 Dec 2018 18:31:07 +0000"  >&lt;p&gt;bob-barrett commented on pull request #5507: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6833&quot; title=&quot;KafkaProducer throws &amp;quot;Invalid partition given with record&amp;quot; exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6833&quot;&gt;&lt;del&gt;KAFKA-6833&lt;/del&gt;&lt;/a&gt;: KafkaProducer throws &apos;Invalid partition given with record&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/5507&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/5507&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16737755" author="githubbot" created="Wed, 9 Jan 2019 02:05:16 +0000"  >&lt;p&gt;hachikuji commented on pull request #6073: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6833&quot; title=&quot;KafkaProducer throws &amp;quot;Invalid partition given with record&amp;quot; exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6833&quot;&gt;&lt;del&gt;KAFKA-6833&lt;/del&gt;&lt;/a&gt;: KafkaProducer throws &quot;Invalid partition given with record&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6073&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6073&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16743566" author="githubbot" created="Wed, 16 Jan 2019 02:34:19 +0000"  >&lt;p&gt;rayokota commented on pull request #6154: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6833&quot; title=&quot;KafkaProducer throws &amp;quot;Invalid partition given with record&amp;quot; exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6833&quot;&gt;&lt;del&gt;KAFKA-6833&lt;/del&gt;&lt;/a&gt;; Producer should await metadata for unknown partitions (#6&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6154&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6154&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &#8230;073)&lt;/p&gt;

&lt;p&gt;   This patch changes the behavior of KafkaProducer.waitOnMetadata to wait up to max.block.ms when the partition specified in the produce request is out of the range of partitions present in the metadata. This improves the user experience in the case when partitions are added to a topic and a client attempts to produce to one of the new partitions before the metadata has propagated to the brokers. Tested with unit tests.&lt;/p&gt;

&lt;p&gt;   Reviewers: Arjun Satish &amp;lt;arjun@confluent.io&amp;gt;, Jason Gustafson &amp;lt;jason@confluent.io&amp;gt;&lt;/p&gt;

&lt;p&gt;   *More detailed description of your change,&lt;br/&gt;
   if necessary. The PR title and PR message become&lt;br/&gt;
   the squashed commit message, so use a separate&lt;br/&gt;
   comment to ping reviewers.*&lt;/p&gt;

&lt;p&gt;   *Summary of testing strategy (including rationale)&lt;br/&gt;
   for the feature or bug fix. Unit and/or integration&lt;br/&gt;
   tests are expected for any behaviour change and&lt;br/&gt;
   system tests should be considered for larger changes.*&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16750634" author="githubbot" created="Thu, 24 Jan 2019 02:27:12 +0000"  >&lt;p&gt;hachikuji commented on pull request #6154: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6833&quot; title=&quot;KafkaProducer throws &amp;quot;Invalid partition given with record&amp;quot; exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6833&quot;&gt;&lt;del&gt;KAFKA-6833&lt;/del&gt;&lt;/a&gt;; Producer should await metadata for unknown partitions (#6&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6154&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6154&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3t42v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>