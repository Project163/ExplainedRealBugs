<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:58:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4540] Suspended tasks that are not assigned to the StreamThread need to be closed before new active and standby tasks are created</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4540</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When partition assignment happens we first try and add the active tasks and then add the standby tasks. The problem with this is that a new active task might already be an existing suspended standby task. if this is the case then when the active task initialises it will throw an exception from RocksDB:&lt;br/&gt;
&lt;tt&gt;Caused by: org.rocksdb.RocksDBException: IO error: lock /tmp/kafka-streams-7071/kafka-music-charts/1_1/rocksdb/all-songs/LOCK: No locks available&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;We need to make sure we have removed an closed any no-longer assigned Suspended tasks before creating new tasks.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13028147">KAFKA-4540</key>
            <summary>Suspended tasks that are not assigned to the StreamThread need to be closed before new active and standby tasks are created</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="damianguy">Damian Guy</assignee>
                                    <reporter username="damianguy">Damian Guy</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Dec 2016 16:51:17 +0000</created>
                <updated>Tue, 20 Dec 2016 18:31:20 +0000</updated>
                            <resolved>Tue, 20 Dec 2016 18:30:48 +0000</resolved>
                                    <version>0.10.2.0</version>
                                    <fixVersion>0.10.2.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15749465" author="guozhang" created="Wed, 14 Dec 2016 20:59:04 +0000"  >&lt;p&gt;Is this already resolved as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4509?&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-4509?&lt;/a&gt; In the patch we reorder the operations to first close all the suspended tasks and then try to create new tasks.&lt;/p&gt;</comment>
                            <comment id="15749549" author="damianguy" created="Wed, 14 Dec 2016 21:32:23 +0000"  >&lt;p&gt;This issue isn&apos;t resolved. The problem here is that say i previously had standby task 1_0, then onPartitionsRevoked it gets suspended. Then onPartitionsAssigned it becomes an active task. When we try to create the Active Task for 1_0 we still have a Standby Task &quot;open&quot; for the same task and we get the exception above.&lt;/p&gt;</comment>
                            <comment id="15749636" author="mjsax" created="Wed, 14 Dec 2016 22:05:32 +0000"  >&lt;p&gt;This makes sense. The problem is that &lt;tt&gt;ConsumerRebalanceListener#onPartitionsAssigned()&lt;/tt&gt; first calls &lt;tt&gt;addStreamTasks()&lt;/tt&gt; and afterwards calls &lt;tt&gt;addStandbyTasks()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15752887" author="guozhang" created="Thu, 15 Dec 2016 23:52:24 +0000"  >&lt;p&gt;Thanks for the explanation. Makes sense.&lt;/p&gt;</comment>
                            <comment id="15753862" author="githubbot" created="Fri, 16 Dec 2016 08:56:26 +0000"  >&lt;p&gt;GitHub user dguy opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2266&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2266&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4540&quot; title=&quot;Suspended tasks that are not assigned to the StreamThread need to be closed before new active and standby tasks are created&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4540&quot;&gt;&lt;del&gt;KAFKA-4540&lt;/del&gt;&lt;/a&gt;: Suspended tasks that are not assigned to the StreamThread need to be closed before new active and standby tasks are created&lt;/p&gt;

&lt;p&gt;    During `onPartitionsAssigned` first close, and remove, any suspended `StandbyTasks` that are no longer assigned to this consumer.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dguy/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dguy/kafka&lt;/a&gt; kafka-4540&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2266.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2266.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2266&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 347ef4cb32c9e4ad6162160c7ba898f30941ea3c&lt;br/&gt;
Author: Damian Guy &amp;lt;damian.guy@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-12-15T16:15:24Z&lt;/p&gt;

&lt;p&gt;    fix standby task suspension&lt;/p&gt;

&lt;p&gt;commit 4f5ab9d38c3049def0ce29cd7cb191db83069a12&lt;br/&gt;
Author: Damian Guy &amp;lt;damian.guy@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-12-16T08:39:06Z&lt;/p&gt;

&lt;p&gt;    merge trunk&lt;/p&gt;

&lt;p&gt;commit 3def0307ae5185ba78b4c3ae90eafbbd50640a63&lt;br/&gt;
Author: Damian Guy &amp;lt;damian.guy@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-12-16T08:51:56Z&lt;/p&gt;

&lt;p&gt;    remove metrics etc from TestStreamTask&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15764885" author="guozhang" created="Tue, 20 Dec 2016 18:30:48 +0000"  >&lt;p&gt;Issue resolved by pull request 2266&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/2266&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2266&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15764886" author="githubbot" created="Tue, 20 Dec 2016 18:31:20 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2266&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2266&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 47 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37ln3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>