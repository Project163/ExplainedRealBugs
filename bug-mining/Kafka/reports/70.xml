<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:35:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-464] KafkaController NPE in SessionExpireListener</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-464</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Sometime see the following in LogRecoverTest.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-08-15 09:06:01,845&amp;#93;&lt;/span&gt; ERROR Error handling event ZkEvent&lt;span class=&quot;error&quot;&gt;&amp;#91;New session event sent to kafka.server.KafkaController$SessionExpireListener@e8ae59a&amp;#93;&lt;/span&gt; (org.I0Itec.zkclient.ZkEventThread)&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at kafka.server.KafkaController$SessionExpireListener.handleNewSession(KafkaController.scala:284)&lt;br/&gt;
	at org.I0Itec.zkclient.ZkClient$4.run(ZkClient.java:472)&lt;br/&gt;
	at org.I0Itec.zkclient.ZkEventThread.run(ZkEventThread.java:71)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12603613">KAFKA-464</key>
            <summary>KafkaController NPE in SessionExpireListener</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yeyangever">Yang Ye</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                            <label>bugs</label>
                    </labels>
                <created>Wed, 15 Aug 2012 16:53:56 +0000</created>
                <updated>Fri, 17 Aug 2012 23:10:15 +0000</updated>
                            <resolved>Fri, 17 Aug 2012 23:10:09 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="172800">48h</timeoriginalestimate>
                            <timeestimate seconds="172800">48h</timeestimate>
                                        <comments>
                            <comment id="13435614" author="yeyangever" created="Wed, 15 Aug 2012 23:28:04 +0000"  >&lt;p&gt;Fixed it&lt;/p&gt;</comment>
                            <comment id="13436098" author="junrao" created="Thu, 16 Aug 2012 16:57:50 +0000"  >&lt;p&gt;Thanks for the patch. &lt;/p&gt;

&lt;p&gt;I think you always need to call controllerRegisterOrFailover when handling a new session, whether controllerChannelManager is null or not.&lt;/p&gt;</comment>
                            <comment id="13436099" author="junrao" created="Thu, 16 Aug 2012 16:59:16 +0000"  >&lt;p&gt;Also, instead of testing controllerChannelManager is null, can we use isActive()?&lt;/p&gt;</comment>
                            <comment id="13436500" author="yeyangever" created="Fri, 17 Aug 2012 01:14:59 +0000"  >&lt;p&gt;&lt;br/&gt;
Added a new flag of isRunning in controller and always call controllerRegisterOrFailOver() on session expiration&lt;/p&gt;</comment>
                            <comment id="13436553" author="junrao" created="Fri, 17 Aug 2012 04:20:59 +0000"  >&lt;p&gt;Well, unfortunately, v2 doesn&apos;t address the original problem that controllerChannelManager can be null when calling controllerChannelManager.shutdown in handleNewSession().&lt;/p&gt;</comment>
                            <comment id="13436563" author="yeyangever" created="Fri, 17 Aug 2012 05:22:21 +0000"  >&lt;p&gt;&lt;br/&gt;
&lt;br/&gt;
Sorry for missing it...&lt;/p&gt;</comment>
                            <comment id="13436793" author="junrao" created="Fri, 17 Aug 2012 15:28:06 +0000"  >&lt;p&gt;A couple of more comments:&lt;/p&gt;

&lt;p&gt;1. The following check in handleNewSession() should probably be done inside controllerRegisterOrFailover() since other callers of controllerRegisterOrFailover() should check isRunning too.&lt;br/&gt;
        if(isRunning)&lt;br/&gt;
          controllerRegisterOrFailover()&lt;/p&gt;

&lt;p&gt;2. This is not really related to this jira, but it&apos;s in KafkaController. So, maybe we can fix it in this jira too. It seems that we can simplify the following code in controllerRegisterOrFailover() using filter() on a map.&lt;/p&gt;

&lt;p&gt;      // If there are some partition with leader not initialized, init the leader for them&lt;br/&gt;
      val partitionReplicaAssignment = allPartitionReplicaAssignment.clone()&lt;br/&gt;
      for((topicPartition, replicas) &amp;lt;- partitionReplicaAssignment){&lt;br/&gt;
        if (allLeaders.contains(topicPartition))&lt;/p&gt;
{
          partitionReplicaAssignment.remove(topicPartition)
        }
&lt;p&gt;      }&lt;/p&gt;</comment>
                            <comment id="13437088" author="yeyangever" created="Fri, 17 Aug 2012 21:36:34 +0000"  >&lt;p&gt;&lt;br/&gt;
&lt;br/&gt;
V4 fixes as suggested&lt;/p&gt;</comment>
                            <comment id="13437090" author="nehanarkhede" created="Fri, 17 Aug 2012 21:40:23 +0000"  >&lt;p&gt;Minor comments -&lt;/p&gt;

&lt;p&gt;1.1 Rename shutDown to shutdown()&lt;br/&gt;
1.2 Rename isLeaderController to isController or isCurrentController&lt;/p&gt;</comment>
                            <comment id="13437102" author="yeyangever" created="Fri, 17 Aug 2012 22:00:53 +0000"  >&lt;p&gt;&lt;br/&gt;
So I find a few other places in the code using &quot;startUp&quot; or &quot;shutDown&quot;, let me fix them all together.&lt;/p&gt;</comment>
                            <comment id="13437129" author="junrao" created="Fri, 17 Aug 2012 23:10:09 +0000"  >&lt;p&gt;Thanks for patch v5. Committed to 0.8&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12541152" name="kafka_464.diff" size="849" author="yeyangever" created="Wed, 15 Aug 2012 23:28:04 +0000"/>
                            <attachment id="12541315" name="kafka_464_v2.diff" size="1232" author="yeyangever" created="Fri, 17 Aug 2012 01:14:59 +0000"/>
                            <attachment id="12541328" name="kafka_464_v3.diff" size="2248" author="yeyangever" created="Fri, 17 Aug 2012 05:22:21 +0000"/>
                            <attachment id="12541424" name="kafka_464_v4.diff" size="3480" author="yeyangever" created="Fri, 17 Aug 2012 21:36:17 +0000"/>
                            <attachment id="12541425" name="kafka_464_v5.diff" size="9654" author="yeyangever" created="Fri, 17 Aug 2012 22:00:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>299136</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i15ztj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243103</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>