<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:06:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6451] Simplify KStreamReduce</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6451</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;If we do aggregations, we drop records with &lt;tt&gt;key=null&lt;/tt&gt; or &lt;tt&gt;value=null&lt;/tt&gt;. However, in &lt;tt&gt;KStreamReduce&lt;/tt&gt; we only early exit if &lt;tt&gt;key=null&lt;/tt&gt; and process &lt;tt&gt;value=null&lt;/tt&gt; &#8211; even if we only update the state with it&apos;s old value and also only send the old value downstream (ie, we still compute the correct result), it&apos;s undesired and wasteful and we should early exit on &lt;tt&gt;value=null&lt;/tt&gt;, too.&lt;/p&gt;

&lt;p&gt;This problem might occur for &lt;tt&gt;KStreamAggregate&lt;/tt&gt;&#160;or other processors, too, and we need to double check those to make sure we implement consistent behavior.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13131291">KAFKA-6451</key>
            <summary>Simplify KStreamReduce</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tanvijaywant31">Tanvi Jaywant</assignee>
                                    <reporter username="mjsax">Matthias J. Sax</reporter>
                        <labels>
                            <label>beginner</label>
                            <label>newbie</label>
                    </labels>
                <created>Tue, 16 Jan 2018 17:31:28 +0000</created>
                <updated>Tue, 30 Jan 2018 01:39:45 +0000</updated>
                            <resolved>Tue, 30 Jan 2018 01:38:43 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16327727" author="sssanthalingam" created="Tue, 16 Jan 2018 20:21:35 +0000"  >&lt;p&gt;Picking this up for now. Please feel free to reassign.&lt;/p&gt;</comment>
                            <comment id="16340333" author="githubbot" created="Fri, 26 Jan 2018 00:12:49 +0000"  >&lt;p&gt;tanvijaywant31 opened a new pull request #4477: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6451&quot; title=&quot;Simplify KStreamReduce&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6451&quot;&gt;&lt;del&gt;KAFKA-6451&lt;/del&gt;&lt;/a&gt;: Simplifying KStreamReduce and KStreamAggregate&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4477&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4477&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6451&quot; title=&quot;Simplify KStreamReduce&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6451&quot;&gt;&lt;del&gt;KAFKA-6451&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6451&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-6451&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;   Simplified KStreamReduce and KStreamAggregate.&lt;br/&gt;
   Updated comments in KStreamAggregate.&lt;/p&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16340336" author="tanvijaywant31" created="Fri, 26 Jan 2018 00:16:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/4477&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4477&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hello, this is my first pull request in Kafka. Please advise/review. Thank you.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16341677" author="mjsax" created="Fri, 26 Jan 2018 22:16:04 +0000"  >&lt;p&gt;Thanks for the PR &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tanvijaywant31&quot; class=&quot;user-hover&quot; rel=&quot;tanvijaywant31&quot;&gt;tanvijaywant31&lt;/a&gt;. Just wanted to point out, that this JIRA&#160;is assigned to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sssanthalingam&quot; class=&quot;user-hover&quot; rel=&quot;sssanthalingam&quot;&gt;sssanthalingam&lt;/a&gt; &#8211; it would have been better to first leave a comment and ask if you can take it over from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sssanthalingam&quot; class=&quot;user-hover&quot; rel=&quot;sssanthalingam&quot;&gt;sssanthalingam&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sssanthalingam&quot; class=&quot;user-hover&quot; rel=&quot;sssanthalingam&quot;&gt;sssanthalingam&lt;/a&gt;: is it ok for you, to reassign the&#160;JIRA&#160;to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tanvijaywant31&quot; class=&quot;user-hover&quot; rel=&quot;tanvijaywant31&quot;&gt;tanvijaywant31&lt;/a&gt;&#160;or do you insist in working on it? Would be great if you two could fnd an agreement. Thanks a lot.&lt;/p&gt;</comment>
                            <comment id="16341726" author="sssanthalingam" created="Fri, 26 Jan 2018 22:44:16 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt; I&apos;m fine with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tanvijaywant31&quot; class=&quot;user-hover&quot; rel=&quot;tanvijaywant31&quot;&gt;tanvijaywant31&lt;/a&gt; working on it. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tanvijaywant31&quot; class=&quot;user-hover&quot; rel=&quot;tanvijaywant31&quot;&gt;tanvijaywant31&lt;/a&gt; congrats on your first PR.&#160;&lt;/p&gt;</comment>
                            <comment id="16341745" author="mjsax" created="Fri, 26 Jan 2018 22:57:48 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sssanthalingam&quot; class=&quot;user-hover&quot; rel=&quot;sssanthalingam&quot;&gt;sssanthalingam&lt;/a&gt;. Hope you find another ticket to work on.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tanvijaywant31&quot; class=&quot;user-hover&quot; rel=&quot;tanvijaywant31&quot;&gt;tanvijaywant31&lt;/a&gt;: I added you to the list on contributors. You can assign JIRAs to yourself now. For unassigned JIRAs you can always pick the up directly. If there is an unassigned Jira you want to work, feel free to leave a comment and ask to take it over. It&apos;s also recommended to update Jira to &quot;work on progress&quot; and &quot;patch available&quot; when you work on something. Thanks.&lt;/p&gt;</comment>
                            <comment id="16341918" author="tanvijaywant31" created="Sat, 27 Jan 2018 02:40:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sssanthalingam&quot; class=&quot;user-hover&quot; rel=&quot;sssanthalingam&quot;&gt;sssanthalingam&lt;/a&gt;&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt;.&#160;Thanks for updating me with protocols. Since this was first time, I noted the procedure. Thank you both.&lt;/p&gt;</comment>
                            <comment id="16344369" author="githubbot" created="Tue, 30 Jan 2018 01:39:45 +0000"  >&lt;p&gt;guozhangwang closed pull request #4477: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6451&quot; title=&quot;Simplify KStreamReduce&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6451&quot;&gt;&lt;del&gt;KAFKA-6451&lt;/del&gt;&lt;/a&gt;: Simplifying KStreamReduce and KStreamAggregate&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4477&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4477&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KStreamAggregate.java b/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KStreamAggregate.java&lt;br/&gt;
index b1abdc29de0..95ad78e0428 100644&lt;br/&gt;
&amp;#8212; a/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KStreamAggregate.java&lt;br/&gt;
+++ b/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KStreamAggregate.java&lt;br/&gt;
@@ -64,20 +64,21 @@ public void init(ProcessorContext context) {&lt;/p&gt;

&lt;p&gt;         @Override&lt;br/&gt;
         public void process(K key, V value) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (key == null)&lt;br/&gt;
+            // If the key or value is null we don&apos;t need to proceed&lt;br/&gt;
+            if (key == null || value == null) 
{
                 return;
+            }&lt;br/&gt;
 &lt;br/&gt;
             T oldAgg = store.get(key);&lt;br/&gt;
 &lt;br/&gt;
-            if (oldAgg == null)&lt;br/&gt;
+            if (oldAgg == null) {
                 oldAgg = initializer.apply();
+            }&lt;br/&gt;
 &lt;br/&gt;
             T newAgg = oldAgg;&lt;br/&gt;
 &lt;br/&gt;
             // try to add the new value&lt;br/&gt;
-            if (value != null) {
-                newAgg = aggregator.apply(key, value, newAgg);
-            }&lt;br/&gt;
+            newAgg = aggregator.apply(key, value, newAgg);&lt;br/&gt;
 &lt;br/&gt;
             // update the store with the new value&lt;br/&gt;
             store.put(key, newAgg);&lt;br/&gt;
diff --git a/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KStreamReduce.java b/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KStreamReduce.java&lt;br/&gt;
index d339624c8a0..0fd8f757cfd 100644&lt;br/&gt;
&amp;#8212; a/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KStreamReduce.java&lt;br/&gt;
+++ b/streams/src/main/java/org/apache/kafka/streams/kstream/internals/KStreamReduce.java&lt;br/&gt;
@@ -61,21 +61,21 @@ public void init(ProcessorContext context) {&lt;br/&gt;
 &lt;br/&gt;
         @Override&lt;br/&gt;
         public void process(K key, V value) {&lt;br/&gt;
-            // If the key is null we don&apos;t need to proceed&lt;br/&gt;
-            if (key == null)&lt;br/&gt;
+            // If the key or value is null we don&apos;t need to proceed&lt;br/&gt;
+            if (key == null || value == null) {                 return;+            }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;             V oldAgg = store.get(key);&lt;br/&gt;
             V newAgg = oldAgg;&lt;/p&gt;

&lt;p&gt;             // try to add the new value&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (value != null) {&lt;/li&gt;
	&lt;li&gt;if (newAgg == null) 
{
-                    newAgg = value;
-                }
&lt;p&gt; else &lt;/p&gt;
{
-                    newAgg = reducer.apply(newAgg, value);
-                }
&lt;p&gt;+            if (newAgg == null) &lt;/p&gt;
{
+                newAgg = value;
+            }
&lt;p&gt; else &lt;/p&gt;
{
+                newAgg = reducer.apply(newAgg, value);
             }
&lt;p&gt;+            &lt;br/&gt;
             // update the store with the new value&lt;br/&gt;
             store.put(key, newAgg);&lt;br/&gt;
             tupleForwarder.maybeForward(key, newAgg, oldAgg);&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KGroupedStreamImplTest.java b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KGroupedStreamImplTest.java&lt;br/&gt;
index c8b7c1856b7..9d8b4797efb 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KGroupedStreamImplTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/kstream/internals/KGroupedStreamImplTest.java&lt;br/&gt;
@@ -621,6 +621,7 @@ private void processData() 
{
         driver.process(TOPIC, &quot;1&quot;, &quot;D&quot;);
         driver.process(TOPIC, &quot;3&quot;, &quot;E&quot;);
         driver.process(TOPIC, &quot;3&quot;, &quot;F&quot;);
+        driver.process(TOPIC, &quot;3&quot;, null);
         driver.flushState();
     }&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;






&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3oyp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>