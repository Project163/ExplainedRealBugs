<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:28:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-12677] The raftCluster always send to the wrong active controller and never update</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-12677</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We introduce KIP-500 to introduce a Self-Managed Metadata Quorum. We should always have 1 active controller, and all the RPC will send to the active controller. But there&apos;s chances that the active controller already changed, but the RPC still send to the old one.&lt;/p&gt;

&lt;p&gt;In the attachment log, we can see:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[Controller 3002] Becoming active at controller epoch 1. 
...
[Controller 3000] Becoming active at controller epoch 2. 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So, the latest active controller should be 3000. But the create topic RPC are all sending to controller 3002:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;errorMessage&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;The active controller appears to be node 3000&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This bug causes the RaftClusterTests flaky.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Debug log while running testCreateClusterAndCreateListDeleteTopic test: &lt;a href=&quot;https://drive.google.com/file/d/1WVUgy1Erjx8mHyofiP9MVvQGb0LcDYt3/view?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/file/d/1WVUgy1Erjx8mHyofiP9MVvQGb0LcDYt3/view?usp=sharing&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13372959">KAFKA-12677</key>
            <summary>The raftCluster always send to the wrong active controller and never update</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="showuon">Luke Chen</assignee>
                                    <reporter username="showuon">Luke Chen</reporter>
                        <labels>
                            <label>kip-500</label>
                    </labels>
                <created>Fri, 16 Apr 2021 09:41:37 +0000</created>
                <updated>Mon, 12 Jul 2021 19:50:33 +0000</updated>
                            <resolved>Mon, 12 Jul 2021 16:51:20 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17322747" author="showuon" created="Fri, 16 Apr 2021 09:45:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmccabe&quot; class=&quot;user-hover&quot; rel=&quot;cmccabe&quot;&gt;cmccabe&lt;/a&gt;, could you take a look at this bug? If you are busy, you can also guide me where to look into. Thank you.&lt;/p&gt;</comment>
                            <comment id="17323955" author="cmccabe" created="Fri, 16 Apr 2021 17:15:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=showuon&quot; class=&quot;user-hover&quot; rel=&quot;showuon&quot;&gt;showuon&lt;/a&gt;: thanks for looking at this.  This test failure has been frustrating everyone for a while.  It&apos;s great that you reproduced it with DEBUG logging.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The raftCluster always send to the wrong active controller and never update&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm... If you do a grep for &quot;Recorded new controller&quot; you can see that it does change eventually.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[cmccabe@zeratul Downloads]$ grep &lt;span class=&quot;code-quote&quot;&gt;&apos;Recorded &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; controller&apos;&lt;/span&gt; raftClusterTest_bug.txt 
2021-04-13T13:40:21.708+0800 [DEBUG] [TestEventLogger]     [2021-04-13 13:40:21,325] INFO [broker2_:BrokerToControllerChannelManager broker=2 name=forwarding]: Recorded &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; controller, from now on will use broker localhost:54228 (id: 3002 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (kafka.server.BrokerToControllerRequestThread:66)
2021-04-13T13:40:21.711+0800 [DEBUG] [TestEventLogger]     [2021-04-13 13:40:21,376] INFO [broker1_:BrokerToControllerChannelManager broker=1 name=alterIsr]: Recorded &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; controller, from now on will use broker localhost:54228 (id: 3002 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (kafka.server.BrokerToControllerRequestThread:66)
2021-04-13T13:40:21.711+0800 [DEBUG] [TestEventLogger]     [2021-04-13 13:40:21,376] INFO [broker2_:BrokerToControllerChannelManager broker=2 name=alterIsr]: Recorded &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; controller, from now on will use broker localhost:54228 (id: 3002 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (kafka.server.BrokerToControllerRequestThread:66)
2021-04-13T13:40:21.711+0800 [DEBUG] [TestEventLogger]     [2021-04-13 13:40:21,376] INFO [broker0_:BrokerToControllerChannelManager broker=0 name=alterIsr]: Recorded &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; controller, from now on will use broker localhost:54228 (id: 3002 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (kafka.server.BrokerToControllerRequestThread:66)
2021-04-13T13:40:21.712+0800 [DEBUG] [TestEventLogger]     [2021-04-13 13:40:21,421] INFO [broker1_:BrokerToControllerChannelManager broker=1 name=heartbeat]: Recorded &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; controller, from now on will use broker localhost:54228 (id: 3002 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (kafka.server.BrokerToControllerRequestThread:66)
....
2021-04-13T13:40:21.837+0800 [DEBUG] [TestEventLogger]     [2021-04-13 13:40:21,660] INFO [broker0_:BrokerToControllerChannelManager broker=0 name=heartbeat]: Recorded &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; controller, from now on will use broker localhost:54228 (id: 3002 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (kafka.server.BrokerToControllerRequestThread:66)
2021-04-13T13:40:21.866+0800 [DEBUG] [TestEventLogger]     [2021-04-13 13:40:21,866] INFO [broker2_:BrokerToControllerChannelManager broker=2 name=heartbeat]: Recorded &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; controller, from now on will use broker localhost:54229 (id: 3000 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (kafka.server.BrokerToControllerRequestThread:66)
2021-04-13T13:40:22.324+0800 [DEBUG] [TestEventLogger]     [2021-04-13 13:40:22,013] INFO [broker1_:BrokerToControllerChannelManager broker=1 name=heartbeat]: Recorded &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; controller, from now on will use broker localhost:54229 (id: 3000 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (kafka.server.BrokerToControllerRequestThread:66)
2021-04-13T13:40:22.428+0800 [DEBUG] [TestEventLogger]     [2021-04-13 13:40:22,073] INFO [broker0_:BrokerToControllerChannelManager broker=0 name=heartbeat]: Recorded &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; controller, from now on will use broker localhost:54229 (id: 3000 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) (kafka.server.BrokerToControllerRequestThread:66)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maybe the question is why it takes so long to change our view of the controller on the broker side? That comes directly out of the raft client on the broker. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Another question is whether we should use the information passed back by the standby controller to fail over quicker.  You can see this in the error that was returned:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;errorCode&quot;&lt;/span&gt;:41,&lt;span class=&quot;code-quote&quot;&gt;&quot;errorMessage&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;The active controller appears to be node 3000&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We could potentially try node 3000 after receiving that error (although this might complicate things in other ways...)&lt;/p&gt;</comment>
                            <comment id="17353882" author="showuon" created="Sat, 29 May 2021 23:10:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmccabe&quot; class=&quot;user-hover&quot; rel=&quot;cmccabe&quot;&gt;cmccabe&lt;/a&gt;, I&apos;ve found the root cause of this issue, and have a fix to it. Do you mind if I take over this ticket? Thank you.&lt;/p&gt;</comment>
                            <comment id="17353909" author="ijuma" created="Sun, 30 May 2021 00:44:52 +0000"  >&lt;p&gt;Go for it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=showuon&quot; class=&quot;user-hover&quot; rel=&quot;showuon&quot;&gt;showuon&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13370180">KAFKA-12629</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 24 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0q3cw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>