<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:24:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9716] Values of compression-rate and compression-rate-avg are misleading</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9716</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The values of the following metrics:&lt;/p&gt;

&lt;p&gt;compression-rate and compression-rate-avg and basically every other compression-rate (i.e.) topic compression rate&lt;/p&gt;

&lt;p&gt;are confusing.&lt;/p&gt;

&lt;p&gt;They are calculated as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (numRecords == 0L) {
    buffer().position(initialPosition);
    builtRecords = MemoryRecords.EMPTY;
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (magic &amp;gt; RecordBatch.MAGIC_VALUE_V1)
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.actualCompressionRatio = (&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;) writeDefaultBatchHeader() / &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.uncompressedRecordsSizeInBytes;
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (compressionType != CompressionType.NONE)
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.actualCompressionRatio = (&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;) writeLegacyCompressedWrapperHeader() / &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.uncompressedRecordsSizeInBytes;

    ByteBuffer buffer = buffer().duplicate();
    buffer.flip();
    buffer.position(initialPosition);
    builtRecords = MemoryRecords.readableRecords(buffer.slice());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;basically the compressed size is divided by the uncompressed size which leads to a value &amp;lt; 1 for high compression (good if you want compression) or &amp;gt; 1 for poor compression (bad if you want compression).&lt;/p&gt;

&lt;p&gt;From the name &quot;compression rate&quot; i would expect the exact opposite. Apart from the fact that the word &quot;rate&quot; usually refers to comparisons based on values of different units (miles per hour) the correct word &quot;ratio&quot; would refer to the uncompressed size divided by the compressed size. (In the code this is correct, but not with the metric names)&lt;/p&gt;

&lt;p&gt;So if the compressed data takes half the space of the uncompressed data the correct value for compression ratio (or rate) would be 2 and not 0.5 as kafka reports it. That is really confusing and i would AT LEAST expect that this behaviour would be documented somewhere, but it&apos;s not all documentation sources just say &quot;the compression rate&quot;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13291526">KAFKA-9716</key>
            <summary>Values of compression-rate and compression-rate-avg are misleading</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="RensGroothuijsen">Rens Groothuijsen</assignee>
                                    <reporter username="Kosmowski">Christian Kosmowski</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Mar 2020 10:43:29 +0000</created>
                <updated>Tue, 9 Jun 2020 19:09:50 +0000</updated>
                            <resolved>Tue, 9 Jun 2020 19:09:50 +0000</resolved>
                                    <version>2.4.1</version>
                                    <fixVersion>2.6.0</fixVersion>
                                    <component>clients</component>
                    <component>compression</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0chy8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>