<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:42:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1971] starting a broker with a conflicting id will delete the previous broker registration</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1971</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;This issue can be easily reproduced by the following steps.&lt;/p&gt;

&lt;p&gt;1. Start broker 1.&lt;br/&gt;
2. Start broker 2 with the same id as broker 1 (configure different port, log dir).&lt;/p&gt;

&lt;p&gt;Broker 2&apos;s registration will fail. However, broker 1&apos;s registration in ZK is now deleted.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12776483">KAFKA-1971</key>
            <summary>starting a broker with a conflicting id will delete the previous broker registration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="junrao">Jun Rao</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Feb 2015 16:46:40 +0000</created>
                <updated>Mon, 23 Feb 2015 20:14:13 +0000</updated>
                            <resolved>Mon, 23 Feb 2015 20:14:13 +0000</resolved>
                                    <version>0.8.2.0</version>
                                    <fixVersion>0.8.2.1</fixVersion>
                                        <due></due>
                            <votes>3</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14329154" author="junrao" created="Fri, 20 Feb 2015 16:50:28 +0000"  >&lt;p&gt;This issue is that when broker 2&apos;s ZK registration fails, we try to shutdown the broker. One of the steps is to explicitly delete the broker registration path in ZK. Since broker 2 has the same broker id as broker 1, this actually deletes broker 1&apos;s registration path by accident.&lt;/p&gt;</comment>
                            <comment id="14329157" author="junrao" created="Fri, 20 Feb 2015 16:52:33 +0000"  >&lt;p&gt;A simple fix is not to explicitly delete the broker registration path. We are closing the connection to ZK on shutdown, which will automatically remove all ephemeral paths.&lt;/p&gt;</comment>
                            <comment id="14329327" author="junrao" created="Fri, 20 Feb 2015 18:39:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;, the explicit de-registration was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1235&quot; title=&quot;Enable server to indefinitely retry on controlled shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1235&quot;&gt;&lt;del&gt;KAFKA-1235&lt;/del&gt;&lt;/a&gt;. The review comment says that this is to prevent a deadlock after shutting down the socket server. Do you remember why?&lt;/p&gt;</comment>
                            <comment id="14329587" author="gwenshap" created="Fri, 20 Feb 2015 21:29:56 +0000"  >&lt;p&gt;If you use an automated restart (say &quot;service kafka restart&quot;), the broker is very likely to start again before the ZK timeout, I believe this used to put the broker in an infinite loop of trying to register, but I don&apos;t remember the exact details.&lt;/p&gt;</comment>
                            <comment id="14329675" author="junrao" created="Fri, 20 Feb 2015 22:26:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gwenshap&quot; class=&quot;user-hover&quot; rel=&quot;gwenshap&quot;&gt;gwenshap&lt;/a&gt;, what you said only applies to the case when you hard kill the broker. However, if you hard kill the broker, you may not hit the de-registration code anyway.&lt;/p&gt;</comment>
                            <comment id="14330334" author="junrao" created="Sat, 21 Feb 2015 16:19:00 +0000"  >&lt;p&gt;Attach a fix in the following RB against trunk.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/31260/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/31260/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14332414" author="guozhang" created="Sun, 22 Feb 2015 23:03:08 +0000"  >&lt;p&gt;I think that is because when the controller node is shutting down while there are still in-flight requests to itself in the request channel, the shutdown process will be blocked upon waiting for controller model to drain all the requests. Deleting the ZK path will allow the controller listener to fire and clear the corresponding request channel and resolve the dead-lock.&lt;/p&gt;</comment>
                            <comment id="14333012" author="junrao" created="Mon, 23 Feb 2015 05:11:59 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/31260/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/31260/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14333015" author="junrao" created="Mon, 23 Feb 2015 05:17:11 +0000"  >&lt;p&gt;It seems that the reason why we explicitly delete the broker registration path in ZK is to avoid the deadlock in shutting down the controller, because the controller message queue is finite. We have since made the controller message queue unbounded. So, we don&apos;t need to explicitly deregister the broker any more. &lt;/p&gt;

&lt;p&gt;Attached is a new patch.&lt;/p&gt;</comment>
                            <comment id="14333482" author="nehanarkhede" created="Mon, 23 Feb 2015 16:39:34 +0000"  >&lt;p&gt;Excellent, thanks for looking into this!&lt;/p&gt;</comment>
                            <comment id="14333747" author="junrao" created="Mon, 23 Feb 2015 20:14:13 +0000"  >&lt;p&gt;Thanks for the review. Double committed to 0.8.2 and trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12700134" name="kafka-1971_2015-02-22_21:11:52.patch" size="7151" author="junrao" created="Mon, 23 Feb 2015 05:11:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25v3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>