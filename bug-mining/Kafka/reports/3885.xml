<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:39:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-17227] Apache Kafka 3.8.0 /tmp exec permission</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-17227</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I have just downloaded and installed new Apache Kafka version 3.8.0.&lt;/p&gt;

&lt;p&gt;It does not work for me (version 3.7.1 works fine).&lt;/p&gt;

&lt;p&gt;In SLES 15 SP5, i have configured /etc/fstab to do not have exec permission for the /tmp partition (noexec) (as suggested by the CIS benchmark).&lt;/p&gt;

&lt;p&gt;Then the Kafka service does not start. Even the kafka-storage.sh script cannot be executed to create the Kafka storage in /tmp/kraft-combined-logs.&lt;/p&gt;

&lt;p&gt;The error reported (in all cases) is exception java.lang.UnsatisfiedLinkError: /tmp/lib/libzstd-jni-1.5.6-3.....so: failed to map segment from shared object. The error does not appear if i enable again the exec permission in /tmp (i.e. mount -o remount,exec /tmp).&lt;/p&gt;

&lt;p&gt;It seems that the zstd-jni-1.5.6-3.jar library is tried to be loaded (even in the case the compression is disabled by default in producer.properties: compression.type=none). Inside the jar file there is for example lizstd-jni-1.5.6-3.so for amd64 architecture that is used by the jar, and for that purpose it is copied to /tmp. But if the /tmp does not have execution permissions, the Apache Kafka processes don&apos;t start.&lt;/p&gt;

&lt;p&gt;Maybe the issue is in zstd-jni and has to be solved in zstd-jni, or maybe the library could be imported only when necessary (only in case the compression is used) to minimize the issue with zstd-jni.&lt;/p&gt;

&lt;p&gt;Thanks and regards.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13587438">KAFKA-17227</key>
            <summary>Apache Kafka 3.8.0 /tmp exec permission</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jlprat">Josep Prat</assignee>
                                    <reporter username="franxis">Francisco Martinez</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Jul 2024 12:51:39 +0000</created>
                <updated>Wed, 30 Oct 2024 14:24:40 +0000</updated>
                            <resolved>Tue, 6 Aug 2024 18:58:06 +0000</resolved>
                                    <version>3.7.1</version>
                    <version>3.8.0</version>
                    <version>3.9.0</version>
                                    <fixVersion>3.7.2</fixVersion>
                    <fixVersion>3.8.1</fixVersion>
                    <fixVersion>3.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                                                                <comments>
                            <comment id="17870128" author="JIRAUSER298079" created="Thu, 1 Aug 2024 08:03:54 +0000"  >&lt;p&gt;Here&apos;s a reproducer using podman:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
podman run -it --tmpfs /tmp:rw,size=787448k,mode=1777,noexec apache/kafka:3.8.0 /bin/bash
7ef5b101f96b:/$ cd /opt/kafka/
7ef5b101f96b:/opt/kafka$ KAFKA_CLUSTER_ID=&lt;span class=&quot;code-quote&quot;&gt;&quot;$(bin/kafka-storage.sh random-uuid)&quot;&lt;/span&gt;
7ef5b101f96b:/opt/kafka$ bin/kafka-storage.sh format -t $KAFKA_CLUSTER_ID -c config/kraft/server.properties
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.UnsatisfiedLinkError: /tmp/libzstd-jni-1.5.6-35934137328938107222.so: Error loading shared library /tmp/libzstd-jni-1.5.6-35934137328938107222.so: Operation not permitted
no zstd-jni-1.5.6-3 in java.library.path: /opt/java/openjdk/lib/server:/opt/java/openjdk/lib:/opt/java/openjdk/../lib:/usr/java/packages/lib:/usr/lib64:/lib64:/lib:/usr/lib
Unsupported OS/arch, cannot find /linux/amd64/libzstd-jni-1.5.6-3.so or load zstd-jni-1.5.6-3 from system libraries. Please &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; building from source the jar or providing libzstd-jni-1.5.6-3 in your system.
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadLibrary(Unknown Source)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.loadLibrary0(Unknown Source)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.loadLibrary(Unknown Source)
	at com.github.luben.zstd.util.Native$1.run(Native.java:70)
	at com.github.luben.zstd.util.Native$1.run(Native.java:68)
	at java.base/java.security.AccessController.doPrivileged(Unknown Source)
	at com.github.luben.zstd.util.Native.loadLibrary(Native.java:68)
	at com.github.luben.zstd.util.Native.load(Native.java:155)
	at com.github.luben.zstd.util.Native.load(Native.java:86)
	at com.github.luben.zstd.Zstd.&amp;lt;clinit&amp;gt;(Zstd.java:12)
	at org.apache.kafka.common.compress.ZstdCompression.&amp;lt;clinit&amp;gt;(ZstdCompression.java:41)
	at org.apache.kafka.storage.internals.log.LogConfig.&amp;lt;clinit&amp;gt;(LogConfig.java:251)
	at kafka.server.KafkaConfig$.&amp;lt;clinit&amp;gt;(KafkaConfig.scala:308)
	at kafka.server.KafkaConfig.&amp;lt;init&amp;gt;(KafkaConfig.scala:546)
	at kafka.tools.StorageTool$.$anonfun$execute$1(StorageTool.scala:72)
	at scala.Option.flatMap(Option.scala:283)
	at kafka.tools.StorageTool$.execute(StorageTool.scala:72)
	at kafka.tools.StorageTool$.main(StorageTool.scala:53)
	at kafka.tools.StorageTool.main(StorageTool.scala)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I can see in the next version of zstd-jni 1.5.6-4 there is a commit that looks like it makes the dir used &lt;a href=&quot;https://github.com/luben/zstd-jni/commit/c057b94e0372be2e16e957e5e09b4fe3c84e8c22&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;configurable by system prop&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17870135" author="jlprat" created="Thu, 1 Aug 2024 08:37:25 +0000"  >&lt;p&gt;I pushed a PR to update the zstd-jni library. If not the real solution for this, at least it&apos;s a work-around.&lt;/p&gt;</comment>
                            <comment id="17870148" author="jlprat" created="Thu, 1 Aug 2024 10:00:37 +0000"  >&lt;p&gt;I did the following to confirm that this is solved with zstd-jni 1.5.6-4&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
podman run -it --tmpfs /tmp:rw,size=787448k,mode=1777,noexec apache/kafka:3.8.0 /bin/bash
deb497de256d:/$ cd opt/kafka/
deb497de256d:/opt/kafka$ cd libs
deb497de256d:/opt/kafka/libs$ rm zstd-jni-1.5.6-3.jar
deb497de256d:/opt/kafka/libs$ wget https:&lt;span class=&quot;code-comment&quot;&gt;//repo1.maven.org/maven2/com/github/luben/zstd-jni/1.5.6-4/zstd-jni-1.5.6-4.jar
&lt;/span&gt;deb497de256d:/opt/kafka/libs$ cd ..
deb497de256d:/opt/kafka$ mkdir tmp
deb497de256d:/opt/kafka$ export KAFKA_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;-DZstdTempFolder=/opt/kafka/tmp&quot;&lt;/span&gt;
deb497de256d:/opt/kafka$ KAFKA_CLUSTER_ID=&lt;span class=&quot;code-quote&quot;&gt;&quot;$(bin/kafka-storage.sh random-uuid)&quot;&lt;/span&gt;
deb497de256d:/opt/kafka$ bin/kafka-storage.sh format -t $KAFKA_CLUSTER_ID -c config/kraft/server.properties
Formatting /tmp/kraft-combined-logs with metadata.version 3.8-IV0. 

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;From there on, I could start the Kafka broker.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17870289" author="JIRAUSER298079" created="Thu, 1 Aug 2024 21:26:58 +0000"  >&lt;p&gt;I was interested if the same was true for  snappy which also packs native libs, and can see the same type of exception when I try to produce with snappy compression with a noexec temp dir.&lt;/p&gt;

&lt;p&gt;After starting up the broker using Josep&apos;s commands above and then podman execing into the container in another terminal:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
227f03903dac:/opt/kafka$ export KAFKA_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;-DZstdTempFolder=/opt/kafka/tmp&quot;&lt;/span&gt;
227f03903dac:/opt/kafka$ ./bin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic 1 --compression-codec snappy
&amp;gt;a
[2024-08-01 21:10:15,638] WARN [Producer clientId=console-producer] Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; fetching metadata with correlation id 6 : {1=UNKNOWN_TOPIC_OR_PARTITION} (org.apache.kafka.clients.NetworkClient)
org.apache.kafka.common.KafkaException: java.lang.UnsatisfiedLinkError: /tmp/snappy-1.1.10-1d07d4d6-2cb1-4b26-bc59-7c965a70bfde-libsnappyjava.so: Error loading shared library /tmp/snappy-1.1.10-1d07d4d6-2cb1-4b26-bc59-7c965a70bfde-libsnappyjava.so: Operation not permitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;xerial snappy also supports &lt;a href=&quot;https://github.com/xerial/snappy-java/blob/bad35791e13ccff89dc47896ea809138c42d5d7d/src/main/java/org/xerial/snappy/SnappyLoader.java#L67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;a system prop&lt;/a&gt; for overriding the temp dir `-Dorg.xerial.snappy.tempdir=/opt/kafka/tmp` &lt;/p&gt;

&lt;p&gt;After restarting the broker with that system prop set, and then running the console producer with that system prop set, the produce succeeded.&lt;/p&gt;</comment>
                            <comment id="17870293" author="JIRAUSER298079" created="Thu, 1 Aug 2024 21:44:48 +0000"  >&lt;p&gt;And a quick check of the prior version 3.7.1 shows that it has the same issue with zstd/snappy compressed data if /tmp is noexec.&lt;/p&gt;

&lt;p&gt;The kafka-storage script runs without error, the broker starts without error. But it will fail to decompress messages received that use snappy or zstd compression.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
podman run -it --tmpfs /tmp:rw,size=787448k,mode=1777,noexec apache/kafka:3.7.1 /bin/bash
9be0542d2aaf:/$ cd /opt/kafka &amp;amp;&amp;amp; KAFKA_CLUSTER_ID=&lt;span class=&quot;code-quote&quot;&gt;&quot;$(bin/kafka-storage.sh random-uuid)&quot;&lt;/span&gt; &amp;amp;&amp;amp; bin/kafka-storage.sh format -t $KAFKA_CLUSTER_ID -c config/kraft/server.properties
metaPropertiesEnsemble=MetaPropertiesEnsemble(metadataLogDir=Optional.empty, dirs={/tmp/kraft-combined-logs: EMPTY})
Formatting /tmp/kraft-combined-logs with metadata.version 3.7-IV4.
9be0542d2aaf:/opt/kafka$ bin/kafka-server-start.sh config/kraft/server.properties
... server starts
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and in another terminal exec into the same container:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
podman exec -it ${your container id} /bin/bash
cd /opt/kafka/
9be0542d2aaf:/opt/kafka$ bin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic 1 --compression-codec snappy
&amp;gt;a
[2024-08-01 21:35:37,967] WARN [Producer clientId=console-producer] Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; fetching metadata with correlation id 6 : {1=UNKNOWN_TOPIC_OR_PARTITION} (org.apache.kafka.clients.NetworkClient)
org.apache.kafka.common.KafkaException: java.lang.UnsatisfiedLinkError: /tmp/snappy-1.1.10-2c2e89fc-1c41-44f0-9cac-b98a64794476-libsnappyjava.so: Error loading shared library /tmp/snappy-1.1.10-2c2e89fc-1c41-44f0-9cac-b98a64794476-libsnappyjava.so: Operation not permitted
	at org.apache.kafka.common.compress.SnappyFactory.wrapForOutput(SnappyFactory.java:38)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so a client side exception, if you fix it with the system prop:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
export KAFKA_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;-Dorg.xerial.snappy.tempdir=/opt/kafka/tmp&quot;&lt;/span&gt;
9be0542d2aaf:/opt/kafka$ bin/kafka-console-producer.sh --bootstrap-server localhost:9092 --topic 1 --compression-codec snappy
&amp;gt;a
&amp;gt;b[2024-08-01 21:37:01,833] ERROR Error when sending message to topic 1 with key: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, value: 1 bytes with error: (org.apache.kafka.clients.producer.internals.ErrorLoggingCallback)
org.apache.kafka.common.errors.UnknownServerException: The server experienced an unexpected error when processing the request.

&amp;gt;
&amp;gt;c
&amp;gt;[2024-08-01 21:37:02,880] ERROR Error when sending message to topic 1 with key: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, value: 1 bytes with error: (org.apache.kafka.clients.producer.internals.ErrorLoggingCallback)
org.apache.kafka.common.errors.UnknownServerException: The server experienced an unexpected error when processing the request.
[2024-08-01 21:37:02,881] ERROR Error when sending message to topic 1 with key: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, value: 0 bytes with error: (org.apache.kafka.clients.producer.internals.ErrorLoggingCallback)
org.apache.kafka.common.errors.UnknownServerException: The server experienced an unexpected error when processing the request.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;you get broker side exceptions at decompress time&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2024-08-01 21:35:38,012] INFO [Partition 1-0 broker=1] Log loaded &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; partition 1-0 with initial high watermark 0 (kafka.cluster.Partition)
[2024-08-01 21:37:01,822] ERROR [ReplicaManager broker=1] Error processing append operation on partition 1-0 (kafka.server.ReplicaManager)
java.lang.UnsatisfiedLinkError: /tmp/snappy-1.1.10-d22e3d69-18fd-4a0f-b9fa-40aab1d9cbd4-libsnappyjava.so: Error loading shared library /tmp/snappy-1.1.10-d22e3d69-18fd-4a0f-b9fa-40aab1d9cbd4-libsnappyjava.so: Operation not permitted
	at java.base/jdk.internal.loader.NativeLibraries.load(Native Method)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17870296" author="jlprat" created="Thu, 1 Aug 2024 22:04:20 +0000"  >&lt;p&gt;It actually makes sense that 3.7.1 also fails in some way as it also depends on zstd-jni 1.5.6-3.&lt;/p&gt;

&lt;p&gt;I&apos;ll document the extra property for Snappy&lt;/p&gt;</comment>
                            <comment id="17870314" author="JIRAUSER298079" created="Fri, 2 Aug 2024 02:07:10 +0000"  >&lt;p&gt;Another option could be to override the java temp dir with `-Djava.io.tmpdir=/opt/kafka/tmp` which is working for me on 3.8.0, though that would affect anything that uses java temp dirs.&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
podman run -it --tmpfs /tmp:rw,size=787448k,mode=1777,noexec apache/kafka:3.8.0 /bin/bash
42a211f01286:/$ cd /opt/kafka/
42a211f01286:/opt/kafka$ KAFKA_CLUSTER_ID=&lt;span class=&quot;code-quote&quot;&gt;&quot;$(bin/kafka-storage.sh random-uuid)&quot;&lt;/span&gt;
42a211f01286:/opt/kafka$ mkdir tmp
42a211f01286:/opt/kafka$ export KAFKA_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;-Djava.io.tmpdir=/opt/kafka/tmp&quot;&lt;/span&gt;
42a211f01286:/opt/kafka$ bin/kafka-storage.sh format -t $KAFKA_CLUSTER_ID -c config/kraft/server.properties
Formatting /tmp/kraft-combined-logs with metadata.version 3.8-IV0.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17870405" author="jlprat" created="Fri, 2 Aug 2024 08:11:00 +0000"  >&lt;p&gt;I also reproduced it with Kafka 3.7.0. Kafka starts, but can&apos;t really use zstd compression codec.&lt;/p&gt;</comment>
                            <comment id="17870406" author="jlprat" created="Fri, 2 Aug 2024 08:12:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=franxis&quot; class=&quot;user-hover&quot; rel=&quot;franxis&quot;&gt;franxis&lt;/a&gt; could you confirm that the Kafka cluster that runs with non-exec /tmp folders doesn&apos;t use neither zstd nor Snappy?&lt;/p&gt;</comment>
                            <comment id="17870408" author="jlprat" created="Fri, 2 Aug 2024 08:17:01 +0000"  >&lt;p&gt;It seems to me that the issue is the following:&lt;/p&gt;

&lt;p&gt;If Kafka is run on environments where the &lt;tt&gt;tmp&lt;/tt&gt; folder doesn&apos;t have &lt;tt&gt;exec&lt;/tt&gt; permissions, messages can&apos;t be produced/consumed if using either &lt;tt&gt;Snappy&lt;/tt&gt; or &lt;tt&gt;Zstd&lt;/tt&gt;. Tested with Kafka 3.7.0 and 3.7.1.&lt;/p&gt;

&lt;p&gt;Kafka will start on version prior to 3.8.0 but still fail to produce/consume. While for 3.8.0, it doesn&apos;t manage to start.&lt;/p&gt;</comment>
                            <comment id="17870410" author="JIRAUSER306404" created="Fri, 2 Aug 2024 08:35:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jlprat&quot; class=&quot;user-hover&quot; rel=&quot;jlprat&quot;&gt;jlprat&lt;/a&gt;, you are right. I don&apos;t use any kind of compression (nor Snappy not Zstd). Kafka 3.7.0 and 3.7.1 run fine. And Kafka 3.8.0 does not start.&lt;/p&gt;</comment>
                            <comment id="17870411" author="jlprat" created="Fri, 2 Aug 2024 08:47:05 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=franxis&quot; class=&quot;user-hover&quot; rel=&quot;franxis&quot;&gt;franxis&lt;/a&gt;, in the meantime you can use the work-around I shared in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-17227?focusedCommentId=17870148&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17870148&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-17227?focusedCommentId=17870148&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17870148&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Basically, it&apos;s manually upgrading the zstd-jni library and specify your desired `tmp` folder for it.&lt;/p&gt;</comment>
                            <comment id="17870439" author="chia7712" created="Fri, 2 Aug 2024 10:01:21 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Maybe the issue is in zstd-jni and has to be solved in zstd-jni, or maybe the library could be imported only when necessary (only in case the compression is used) to minimize the issue with zstd-jni.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We did that before (see &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-12327&quot; title=&quot;Remove MethodHandle usage in CompressionType&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-12327&quot;&gt;&lt;del&gt;KAFKA-12327&lt;/del&gt;&lt;/a&gt;). however, we now support the compression level (see &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7632&quot; title=&quot;Support Compression Level&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7632&quot;&gt;&lt;del&gt;KAFKA-7632&lt;/del&gt;&lt;/a&gt;) and some zstd fields are exported by kafka configs.&lt;/p&gt;

&lt;p&gt;IMHO, that is a good suggestion and we should enable that again. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mimaison&quot; class=&quot;user-hover&quot; rel=&quot;mimaison&quot;&gt;mimaison&lt;/a&gt; WDYT?&lt;/p&gt;</comment>
                            <comment id="17870473" author="mimaison" created="Fri, 2 Aug 2024 11:20:03 +0000"  >&lt;p&gt;Right, if I remove the usage of ZstdCompression in ServerConfigs, LogConfig and ProducerConfig, I seem to get back to the behavior of 3.7.0.&lt;/p&gt;

&lt;p&gt;This is the steps I did:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;removed import org.apache.kafka.common.compress.ZstdCompression; from these 3 classes, and replaced the constants with hard coded values&lt;/li&gt;
	&lt;li&gt;built a release with ./gradew releaseTarGz&lt;/li&gt;
	&lt;li&gt;built a new docker image with docker/docker_build_test.py This was a bit of a pain, as it requires a URL and also a signature file so I had to tweak the Dockerfile slightly (Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-17246&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-17246&lt;/a&gt; to improve it)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We could hard code the levels (we already do it for Lz4 as they don&apos;t expose public constants) and move their definitions into CompressionType so the &amp;lt;CODEC&amp;gt;Compression classes are only loaded when used.&lt;/p&gt;

&lt;p&gt;I&apos;ll open a draft PR this afternoon.&lt;/p&gt;</comment>
                            <comment id="17870477" author="chia7712" created="Fri, 2 Aug 2024 11:52:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mimaison&quot; class=&quot;user-hover&quot; rel=&quot;mimaison&quot;&gt;mimaison&lt;/a&gt; thanks for quick response and fix. the approach LGTM&lt;/p&gt;</comment>
                            <comment id="17870585" author="mimaison" created="Fri, 2 Aug 2024 16:15:22 +0000"  >&lt;p&gt;Opened &lt;a href=&quot;https://github.com/apache/kafka/pull/16782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/16782&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17871005" author="jlprat" created="Mon, 5 Aug 2024 09:35:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/16782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/16782&lt;/a&gt; merged and backported to 3.9. I&apos;m working on the backports to 3.8 and 3.7 (letting CI run)&lt;/p&gt;</comment>
                            <comment id="17871092" author="jlprat" created="Mon, 5 Aug 2024 15:03:07 +0000"  >&lt;p&gt;Backported to 3.7 and 3.8&lt;/p&gt;</comment>
                            <comment id="17871302" author="jlprat" created="Tue, 6 Aug 2024 11:40:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/16782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/16782&lt;/a&gt; has been merged and backported to 3.9. Waiting to be backported to 3.8 to close this issue&lt;/p&gt;</comment>
                            <comment id="17871326" author="mimaison" created="Tue, 6 Aug 2024 13:03:35 +0000"  >&lt;p&gt;I had to resolve a bunch of conflicts to backport the fix to 3.8, so I opened a PR to get a review and run the CI: &lt;a href=&quot;https://github.com/apache/kafka/pull/16811&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/16811&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17871334" author="jlprat" created="Tue, 6 Aug 2024 13:27:09 +0000"  >&lt;p&gt;I&apos;ll review later today or tomorrow. I&apos;m travelling&lt;/p&gt;</comment>
                            <comment id="17892682" author="gjourdan" created="Fri, 25 Oct 2024 07:03:21 +0000"  >&lt;p&gt;Sorry if this isn&apos;t the best place to ask but when is the 3.8.1 planned for release?&lt;/p&gt;</comment>
                            <comment id="17892842" author="jlprat" created="Fri, 25 Oct 2024 15:14:14 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gjourdan&quot; class=&quot;user-hover&quot; rel=&quot;gjourdan&quot;&gt;gjourdan&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;The 3.8.1 version is in the making and just got its first vote (out of three). The release might happen in the coming days.&lt;/p&gt;</comment>
                            <comment id="17894186" author="jlprat" created="Wed, 30 Oct 2024 12:07:43 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gjourdan&quot; class=&quot;user-hover&quot; rel=&quot;gjourdan&quot;&gt;gjourdan&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;3.8.1 is now released. Remember to set the right environment variable if you are hut by this bug:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://kafka.apache.org/documentation/#upgrade_381_notable&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://kafka.apache.org/documentation/#upgrade_381_notable&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17894189" author="JIRAUSER306404" created="Wed, 30 Oct 2024 12:37:20 +0000"  >&lt;p&gt;Josep,&lt;/p&gt;

&lt;p&gt;I have tried with the new 3.8.1 version and it works fine..&lt;/p&gt;

&lt;p&gt;In any case, wouldn&apos;t be better to add an empty &apos;tmp&apos; folder inside the kafka folder (and point to that folder in the scripts or in the java code)?&lt;/p&gt;

&lt;p&gt;I would suggest this for future releases.&lt;/p&gt;

&lt;p&gt;Thanks to everyone involved!&lt;/p&gt;</comment>
                            <comment id="17894198" author="jlprat" created="Wed, 30 Oct 2024 12:56:50 +0000"  >&lt;p&gt;If I remember right, 3.9.0 won&apos;t have this problem unless compression is enabled.&lt;/p&gt;</comment>
                            <comment id="17894222" author="JIRAUSER306404" created="Wed, 30 Oct 2024 14:14:05 +0000"  >&lt;p&gt;Josep, the same with 3.8.1. Without compression i don&apos;t need to set any environment variable. It runs fine.&lt;/p&gt;</comment>
                            <comment id="17894224" author="jlprat" created="Wed, 30 Oct 2024 14:24:40 +0000"  >&lt;p&gt;Ah great, then we backported that one as well.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13597069">KAFKA-17891</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13597069">KAFKA-17891</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13070580" name="kafka_issue.png" size="126481" author="franxis" created="Wed, 31 Jul 2024 12:47:21 +0000"/>
                            <attachment id="13072493" name="kafka_issue_3.8.1.png" size="22593" author="franxis" created="Wed, 30 Oct 2024 11:28:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1qmbs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>