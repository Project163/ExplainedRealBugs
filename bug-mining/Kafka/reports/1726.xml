<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:04:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5212] Consumer ListOffsets request can starve group heartbeats</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5212</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The consumer is not able to send heartbeats while it is awaiting a ListOffsets response. Typically this is not a problem because ListOffsets requests are handled quickly, but in the worst case if the request takes longer than the session timeout, the consumer will fall out of the group.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13070958">KAFKA-5212</key>
            <summary>Consumer ListOffsets request can starve group heartbeats</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Yohan123">Richard Yu</assignee>
                                    <reporter username="hachikuji">Jason Gustafson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 May 2017 21:10:02 +0000</created>
                <updated>Tue, 9 Jan 2018 23:57:12 +0000</updated>
                            <resolved>Mon, 30 Oct 2017 18:34:55 +0000</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                    <component>consumer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16068191" author="evis" created="Thu, 29 Jun 2017 11:14:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt;, I&apos;d like to work on this ticket, but not sure, how exactly does &lt;tt&gt;Fetcher.sendListOffsetRequest()&lt;/tt&gt; block &lt;tt&gt;HeartbeatThread&lt;/tt&gt;... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Could you explain it a bit more, please?&lt;/p&gt;</comment>
                            <comment id="16116953" author="hachikuji" created="Mon, 7 Aug 2017 18:02:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=evis&quot; class=&quot;user-hover&quot; rel=&quot;evis&quot;&gt;evis&lt;/a&gt; The fetcher and the heartbeat share the same network client, so when we&apos;re blocked in &lt;tt&gt;poll&lt;/tt&gt; inside &lt;tt&gt;Fetcher&lt;/tt&gt;, the heartbeat thread can&apos;t send any heartbeats. In retrospect, we probably should have given the heartbeat thread its own network client, but sharing made its initial implementation a bit simpler. For now, maybe we just need to ensure that &lt;tt&gt;sendListOffsetRequest&lt;/tt&gt; takes the heartbeat thread into account when setting its poll timeout.&lt;/p&gt;</comment>
                            <comment id="16196199" author="yohan123" created="Sun, 8 Oct 2017 16:24:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=evis&quot; class=&quot;user-hover&quot; rel=&quot;evis&quot;&gt;evis&lt;/a&gt; Can I take this issue?&lt;/p&gt;</comment>
                            <comment id="16198120" author="githubbot" created="Tue, 10 Oct 2017 03:47:39 +0000"  >&lt;p&gt;GitHub user ConcurrencyPractitioner opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4049&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5212&quot; title=&quot;Consumer ListOffsets request can starve group heartbeats&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5212&quot;&gt;&lt;del&gt;KAFKA-5212&lt;/del&gt;&lt;/a&gt; Consumer ListOffsets request can starve group heartbeats&lt;/p&gt;

&lt;p&gt;    Through the identification of the poll method in ConsumerCoordinator as the place where the heartbeat is sent, I modified the metadata so that it polled periodically every interval for a heartbeat.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ConcurrencyPractitioner/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ConcurrencyPractitioner/kafka&lt;/a&gt; trunk&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4049.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4049.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4049&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 431bc8011ce3f8aaa677e2f6743c9b069a1eec8c&lt;br/&gt;
Author: Richard Yu &amp;lt;richardyu@richards-air.attlocal.net&amp;gt;&lt;br/&gt;
Date:   2017-10-10T03:45:23Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5212&quot; title=&quot;Consumer ListOffsets request can starve group heartbeats&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5212&quot;&gt;&lt;del&gt;KAFKA-5212&lt;/del&gt;&lt;/a&gt; Consumer ListOffsets request can starve group heartbeats&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16199778" author="yohan123" created="Wed, 11 Oct 2017 04:04:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; During some study after the failure of my most recent commit, there is this approach which one would note:&lt;/p&gt;

&lt;p&gt;1. Due to hierarchy design, heartbeat is only accessible by ConsumerCoordinator.&lt;br/&gt;
2. In order to pass a variable to Fetcher, ConsumerCoordinator must pass the necessary information through ConsumerNetworkClient.&lt;/p&gt;

&lt;p&gt;One of the easiest ways is to define a variable with the time of the next heartbeat (e.g. long nextHeartbeat = now + remainingMs). The variable is defined as a private field of ConsumerNetworkClient but could be changed by ConsumerCoordinator&apos;s methods. This way, Fetcher could have access to the next heartbeat time.&lt;/p&gt;

&lt;p&gt;However, this is when we encounter a problem: If fetcher&apos;s poll() is concluded (it could not yield, thus we must wait), and if the time.milliseconds() exceeds nextHeartbeat, we must resend a heartbeat. However, the pollHeartbeat() method is currently only accessible in ConsumerCoordinator. Is there a way to get around this?&lt;/p&gt;</comment>
                            <comment id="16214059" author="githubbot" created="Sat, 21 Oct 2017 18:40:10 +0000"  >&lt;p&gt;GitHub user ConcurrencyPractitioner opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4110&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4110&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5212&quot; title=&quot;Consumer ListOffsets request can starve group heartbeats&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5212&quot;&gt;&lt;del&gt;KAFKA-5212&lt;/del&gt;&lt;/a&gt; Consumer ListOffsets request can starve group heartbeats&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ConcurrencyPractitioner/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ConcurrencyPractitioner/kafka&lt;/a&gt; trunk&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4110.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4110.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4110&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 9bdb5d36c3b2c15559f663aeab863b994878cc1d&lt;br/&gt;
Author: Richard Yu &amp;lt;richardyu@richards-air.attlocal.net&amp;gt;&lt;br/&gt;
Date:   2017-10-21T18:38:44Z&lt;/p&gt;

&lt;p&gt;    Rebased version of tests&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16214387" author="yohan123" created="Sun, 22 Oct 2017 17:24:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; Is this test on the right track?&lt;/p&gt;</comment>
                            <comment id="16214524" author="yohan123" created="Mon, 23 Oct 2017 02:05:51 +0000"  >&lt;p&gt;There appears to be an infinite loop in the test (skippingHeartbeats). As time progresses towards endTime, the prepareHeartbeatResponse() method will always return a false.&lt;/p&gt;</comment>
                            <comment id="16216134" author="yohan123" created="Tue, 24 Oct 2017 00:34:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; I am wondering how pause can be introduced into the test so that a missed heartbeat can be seen without the fix.&lt;/p&gt;</comment>
                            <comment id="16224379" author="yohan123" created="Mon, 30 Oct 2017 04:45:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; Will there be any more requests for changes?&lt;/p&gt;</comment>
                            <comment id="16225506" author="hachikuji" created="Mon, 30 Oct 2017 18:34:55 +0000"  >&lt;p&gt;Issue resolved by pull request 4110&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/4110&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4110&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16225514" author="githubbot" created="Mon, 30 Oct 2017 18:36:19 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4110&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4110&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16319423" author="githubbot" created="Tue, 9 Jan 2018 23:57:12 +0000"  >&lt;p&gt;ConcurrencyPractitioner closed pull request #4049: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5212&quot; title=&quot;Consumer ListOffsets request can starve group heartbeats&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5212&quot;&gt;&lt;del&gt;KAFKA-5212&lt;/del&gt;&lt;/a&gt; Consumer ListOffsets request can starve group heartbeats&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4049&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12893475" name="5212.patch" size="6770" author="Yohan123" created="Mon, 23 Oct 2017 02:04:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3essv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>