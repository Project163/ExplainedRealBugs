<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:25:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-10284] Group membership update due to static member rejoin should be persisted</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-10284</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;For known static members rejoin, we would update its corresponding member.id without triggering a new rebalance. This serves the purpose for avoiding unnecessary rebalance for static membership, as well as fencing purpose if some still uses the old member.id.&#160;&lt;/p&gt;

&lt;p&gt;The bug is that we don&apos;t actually persist the membership update, so if no upcoming rebalance gets triggered, this new member.id information will get lost during group coordinator immigration, thus bringing up the zombie member identity.&lt;/p&gt;

&lt;p&gt;The&#160;bug find credit goes to&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13317302">KAFKA-10284</key>
            <summary>Group membership update due to static member rejoin should be persisted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="feyman">Haoran Xuan</assignee>
                                    <reporter username="bchen225242">Boyang Chen</reporter>
                        <labels>
                            <label>help-wanted</label>
                    </labels>
                <created>Fri, 17 Jul 2020 02:17:27 +0000</created>
                <updated>Fri, 23 Oct 2020 18:23:41 +0000</updated>
                            <resolved>Thu, 22 Oct 2020 15:16:45 +0000</resolved>
                                    <version>2.3.0</version>
                    <version>2.4.0</version>
                    <version>2.5.0</version>
                    <version>2.6.0</version>
                                    <fixVersion>2.5.2</fixVersion>
                    <fixVersion>2.6.1</fixVersion>
                    <fixVersion>2.7.0</fixVersion>
                                    <component>consumer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17159616" author="bchen225242" created="Fri, 17 Jul 2020 02:20:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/coordinator/group/GroupCoordinator.scala#L1042&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/coordinator/group/GroupCoordinator.scala#L1042&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17160152" author="guozhang" created="Fri, 17 Jul 2020 19:11:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bchen225242&quot; class=&quot;user-hover&quot; rel=&quot;bchen225242&quot;&gt;bchen225242&lt;/a&gt; Thanks for the find. Just trying to clarify that &quot;bring up the zombie member ID&quot; would break correctness, since if the zombie member still exists, it may be able to commit offsets which would rewind the position. Is that right?&lt;/p&gt;</comment>
                            <comment id="17160216" author="bchen225242" created="Fri, 17 Jul 2020 21:10:49 +0000"  >&lt;p&gt;If we have a combined scenario like below:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;A static member X joins the group and updates member.id to M1, then gets stuck&lt;/li&gt;
	&lt;li&gt;Another static member Y with the same instance.id joins and updates member.id to M2, while starts working and commit offsets&lt;/li&gt;
	&lt;li&gt;The group coordinator migrates, and the member.id for the same static member rewinds to M1&lt;/li&gt;
	&lt;li&gt;The static member X goes back online, and validated. It would try to fetch from Y&apos;s committed offset&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;In this flow, I don&apos;t think we are violating the offset committing policy here.&#160;&lt;/p&gt;

&lt;p&gt;The only downside I could think of is that there is only one member Y who will get fenced by itself after the immigration as stated in the description. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17160225" author="guozhang" created="Fri, 17 Jul 2020 21:38:44 +0000"  >&lt;p&gt;Fair enough. So it seems not a correctness breaking issue at the moment.&lt;/p&gt;</comment>
                            <comment id="17163248" author="akshaysh" created="Thu, 23 Jul 2020 06:24:09 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bchen225242&quot; class=&quot;user-hover&quot; rel=&quot;bchen225242&quot;&gt;bchen225242&lt;/a&gt;/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I&apos;ve raised the bug related to the same issue 6 days ago. Please look at it once.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-10285&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-10285&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Analysis,&lt;/p&gt;

&lt;p&gt;`when i&apos;ve not restarted the broker and restarted consumer, I could see below logs` &lt;br/&gt;
 ```&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-16 13:56:17,189&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GroupCoordinator 1001&amp;#93;&lt;/span&gt;: Preparing to rebalance group 0 in state PreparingRebalance with old generation 0 (__consumer_offsets-48) (reason: Adding new member 1-1594907777144 with group instanceid Some(1)) (kafka.coordinator.group.GroupCoordinator)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-16 13:56:17,236&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GroupCoordinator 1001&amp;#93;&lt;/span&gt;: Stabilized group 0 generation 1 (__consumer_offsets-48) (kafka.coordinator.group.GroupCoordinator)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-16 13:56:17,282&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GroupCoordinator 1001&amp;#93;&lt;/span&gt;: Assignment received from leader for group 0 for generation 1 (kafka.coordinator.group.GroupCoordinator)&lt;/p&gt;

&lt;p&gt;********&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-16 13:59:33,613&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GroupCoordinator 1001&amp;#93;&lt;/span&gt;: Static member Some(1) with unknown member id rejoins, assigning new member id 1-1594907777335, while old member 1-1594907777144 will be removed. (kafka.coordinator.group.GroupCoordinator)&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-07-16 13:59:33,635&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;GroupCoordinator 1001&amp;#93;&lt;/span&gt;: Static member joins during Stable stage will not trigger rebalance. (kafka.coordinator.group.GroupCoordinator)&lt;br/&gt;
 ```&lt;br/&gt;
 when restarted the broker, I could see broker is expecting some other member.id(old member.id of consumer)&lt;br/&gt;
 ```&lt;br/&gt;
 2020-07-16 14:04:04,953] ERROR given member.id 1-1594907777335 is identified as a known static member 1,but not matching the expected member.id 1-1594907777144 (kafka.coordinator.group.GroupMetadata)&lt;br/&gt;
 ```&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17163796" author="ableegoldman" created="Thu, 23 Jul 2020 17:19:29 +0000"  >&lt;p&gt;You know, I think we actually hit this too, but weren&apos;t able to recognize the problem at the time. A few weeks ago one of our StreamThreads/Consumers seemed to &quot;take off&quot; from the group at some point, as evidenced by the steadily increasing last-rebalance-seconds-ago metric (whereas the other members had rebalanced multiple times since then). Right before this occurred we saw that same error message in the logs:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ERROR given member.id X is identified as a known &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; member 1,but not matching the expected member.id Y (kafka.coordinator.group.GroupMetadata)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Unfortunately we killed the client trying to remotely debug it so we couldn&apos;t get any more useful information. Would you say that this was mysterious encounter was likely due to the bug reported here? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bchen225242&quot; class=&quot;user-hover&quot; rel=&quot;bchen225242&quot;&gt;bchen225242&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17163871" author="bchen225242" created="Thu, 23 Jul 2020 19:01:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akshaysh&quot; class=&quot;user-hover&quot; rel=&quot;akshaysh&quot;&gt;akshaysh&lt;/a&gt;&#160;I didn&apos;t see any trace that the group coordinator gets migrated in the pasted ticket, so it might be a separate issue.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt;&#160;Well, the symptom matches, but I don&apos;t know for sure if this is the same cause &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17164063" author="guozhang" created="Fri, 24 Jul 2020 01:01:24 +0000"  >&lt;p&gt;What &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt; described seems aligned to this, BUT I thought that fenced instance Y should still try to rejoin the group, but in &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt; that thread did not try to rejoin at all?&lt;/p&gt;</comment>
                            <comment id="17164146" author="akshaysh" created="Fri, 24 Jul 2020 05:07:07 +0000"  >&lt;p&gt;At initial, Group Coordinator will assign member id to the new joined consumer i.e X with generation id 1, when the consumer take off at the same point and try to rejoin there be no re-balance(i.e generation id will be 1), but group coordinator will assign new member id to the consumer i.e Y. Now, when broker restart due to some reason, groupmetadatamanager will reload the metadata and expects that member.id to be present, he is now expecting X member.id. and that&apos;s why consumer is fenced.&lt;/p&gt;

&lt;p&gt;1) Is this a expected behaviour?&lt;/p&gt;

&lt;p&gt;2) when consumer member id changes, groupmetadatamanager not updates new member.id information?&lt;/p&gt;

&lt;p&gt;3) consumer is fenced with new instance, even single consumer is running. Why?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bchen225242&quot; class=&quot;user-hover&quot; rel=&quot;bchen225242&quot;&gt;bchen225242&lt;/a&gt;&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17164531" author="ableegoldman" created="Fri, 24 Jul 2020 16:57:13 +0000"  >&lt;p&gt;Nope, it just spun in a loop where it would poll and then call Consumer#position to try and initialize some metadata. Poll just returned empty I guess and Consumer#position continued to throw TimeoutException.&#160;&lt;/p&gt;

&lt;p&gt;The TimeoutException part seems pretty weird, so maybe it was an unrelated bug (or some other issue like a hung socket being the primary/only guess we had). I just thought of it because it definitely happened immediately after a &quot;id does not match expected member.id&quot; error.&lt;/p&gt;

&lt;p&gt;I actually still have some of the broker and client side logs from around this incident, if that might help. But again, I&apos;m not really sure if it could be related to this or not&lt;/p&gt;</comment>
                            <comment id="17165892" author="hachikuji" created="Mon, 27 Jul 2020 18:12:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bchen225242&quot; class=&quot;user-hover&quot; rel=&quot;bchen225242&quot;&gt;bchen225242&lt;/a&gt; Hmm.. Not totally sure I buy this:&lt;/p&gt;

&lt;p&gt;&amp;gt; A static member X joins the group and updates member.id to M1, then gets stuck&lt;br/&gt;
&amp;gt; Another static member Y with the same instance.id joins and updates member.id to M2, while starts working and commit offsets&lt;br/&gt;
&amp;gt; The group coordinator migrates, and the member.id for the same static member rewinds to M1&lt;br/&gt;
&amp;gt; The static member X goes back online, and validated. It would try to fetch from Y&apos;s committed offset&lt;/p&gt;

&lt;p&gt;Why would member X fetch Y&apos;s committed offset? If it doesn&apos;t know it had been fenced temporarily, it might just commit its latest offsets. This does seem like a correctness problem to me.&lt;/p&gt;</comment>
                            <comment id="17166681" author="bchen225242" created="Tue, 28 Jul 2020 20:45:48 +0000"  >&lt;p&gt;That&apos;s a good observation, I forgot that for static members they don&apos;t actually do another Fetch offset immediately after they rejoin the group. You should be right about this, and I haven&apos;t thought about the scenario where EOS and static membership are both turned on.&lt;/p&gt;</comment>
                            <comment id="17175669" author="bchen225242" created="Tue, 11 Aug 2020 16:13:54 +0000"  >&lt;p&gt;Resign from this ticket for now, others feel free to pick up.&lt;/p&gt;</comment>
                            <comment id="17175905" author="ableegoldman" created="Wed, 12 Aug 2020 00:39:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bchen225242&quot; class=&quot;user-hover&quot; rel=&quot;bchen225242&quot;&gt;bchen225242&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt;&#160;Is this a correctness problem for all applications or only EOS?&lt;/p&gt;</comment>
                            <comment id="17176639" author="bchen225242" created="Wed, 12 Aug 2020 22:44:51 +0000"  >&lt;p&gt;I would say for all. Let me check if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=feyman&quot; class=&quot;user-hover&quot; rel=&quot;feyman&quot;&gt;feyman&lt;/a&gt;&#160;is interested in picking this up.&lt;/p&gt;</comment>
                            <comment id="17182608" author="feyman" created="Sun, 23 Aug 2020 07:29:24 +0000"  >&lt;p&gt;Checked with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bchen225242&quot; class=&quot;user-hover&quot; rel=&quot;bchen225242&quot;&gt;bchen225242&lt;/a&gt;&#160;offline, and I just reproduced the issue with the procedure as in the attachment, happy to know if there are more failure scenarios related.&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13010329/13010329_How+to+reproduce+the+issue+in+KAFKA-10284.md&quot; title=&quot;How to reproduce the issue in KAFKA-10284.md attached to KAFKA-10284&quot;&gt;How to reproduce the issue in KAFKA-10284.md&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17192885" author="feyman" created="Wed, 9 Sep 2020 14:02:35 +0000"  >&lt;p&gt;Just FYI, created a PR:&#160;&lt;a href=&quot;https://github.com/apache/kafka/pull/9270&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/9270&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13010329" name="How to reproduce the issue in KAFKA-10284.md" size="8742" author="feyman" created="Sun, 23 Aug 2020 07:29:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 9 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0gujk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>