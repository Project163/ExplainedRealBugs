<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:28:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-7421] Deadlock in Kafka Connect during class loading</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-7421</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I&apos;m getting this deadlock on half of Kafka Connect runs when having two different types connectors (in this configuration it&apos;s debezium and hdfs).&lt;br/&gt;
Thread 1:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;pool-22-thread-2@4748&quot;&lt;/span&gt; prio=5 tid=0x4d nid=NA waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; monitor entry
  java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: BLOCKED
	 waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; pool-22-thread-1@4747 to release lock on &amp;lt;0x1423&amp;gt; (a org.apache.kafka.connect.runtime.isolation.PluginClassLoader)
	  at org.apache.kafka.connect.runtime.isolation.PluginClassLoader.loadClass(PluginClassLoader.java:91)
	  at org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader.loadClass(DelegatingClassLoader.java:367)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:357)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:-1)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:348)
	  at org.apache.kafka.common.config.ConfigDef.parseType(ConfigDef.java:715)
	  at org.apache.kafka.connect.runtime.ConnectorConfig.enrich(ConnectorConfig.java:295)
	  at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:200)
	  at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:194)
	  at org.apache.kafka.connect.runtime.Worker.startConnector(Worker.java:233)
	  at org.apache.kafka.connect.runtime.distributed.DistributedHerder.startConnector(DistributedHerder.java:916)
	  at org.apache.kafka.connect.runtime.distributed.DistributedHerder.access$1300(DistributedHerder.java:111)
	  at org.apache.kafka.connect.runtime.distributed.DistributedHerder$15.call(DistributedHerder.java:932)
	  at org.apache.kafka.connect.runtime.distributed.DistributedHerder$15.call(DistributedHerder.java:928)
	  at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thread 2:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;pool-22-thread-1@4747&quot;&lt;/span&gt; prio=5 tid=0x4c nid=NA waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; monitor entry
  java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: BLOCKED
	 blocks pool-22-thread-2@4748
	 waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; pool-22-thread-2@4748 to release lock on &amp;lt;0x1421&amp;gt; (a org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:406)
	  at org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader.loadClass(DelegatingClassLoader.java:358)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:411)
	  - locked &amp;lt;0x1424&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
	  at org.apache.kafka.connect.runtime.isolation.PluginClassLoader.loadClass(PluginClassLoader.java:104)
	  - locked &amp;lt;0x1423&amp;gt; (a org.apache.kafka.connect.runtime.isolation.PluginClassLoader)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:357)
	  at io.debezium.transforms.ByLogicalTableRouter.&amp;lt;clinit&amp;gt;(ByLogicalTableRouter.java:57)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:-1)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:348)
	  at org.apache.kafka.common.config.ConfigDef.parseType(ConfigDef.java:715)
	  at org.apache.kafka.connect.runtime.ConnectorConfig.enrich(ConnectorConfig.java:295)
	  at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:200)
	  at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:194)
	  at org.apache.kafka.connect.runtime.Worker.startConnector(Worker.java:233)
	  at org.apache.kafka.connect.runtime.distributed.DistributedHerder.startConnector(DistributedHerder.java:916)
	  at org.apache.kafka.connect.runtime.distributed.DistributedHerder.access$1300(DistributedHerder.java:111)
	  at org.apache.kafka.connect.runtime.distributed.DistributedHerder$15.call(DistributedHerder.java:932)
	  at org.apache.kafka.connect.runtime.distributed.DistributedHerder$15.call(DistributedHerder.java:928)
	  at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m using official Confluent Docker images.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13185990">KAFKA-7421</key>
            <summary>Deadlock in Kafka Connect during class loading</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkonstantine">Konstantine Karantasis</assignee>
                                    <reporter username="maver1ck">Maciej Bry&#324;ski</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Sep 2018 07:40:57 +0000</created>
                <updated>Wed, 14 Jul 2021 17:54:54 +0000</updated>
                            <resolved>Wed, 14 Jul 2021 17:54:54 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="16623005" author="kkonstantine" created="Fri, 21 Sep 2018 03:13:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maver1ck&quot; class=&quot;user-hover&quot; rel=&quot;maver1ck&quot;&gt;maver1ck&lt;/a&gt;&#160;does setting &lt;tt&gt;-XX:+AlwaysLockClassLoader&lt;/tt&gt;&#160;in the JVM properties make the issue go away? It&apos;d be good to know.&#160;&lt;/p&gt;</comment>
                            <comment id="16624137" author="maver1ck" created="Fri, 21 Sep 2018 20:34:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkonstantine&quot; class=&quot;user-hover&quot; rel=&quot;kkonstantine&quot;&gt;kkonstantine&lt;/a&gt; Nope. I was able to reproduce it when running connect process with: -XX:+AlwaysLockClassLoader&lt;/p&gt;</comment>
                            <comment id="16624153" author="maver1ck" created="Fri, 21 Sep 2018 20:46:14 +0000"  >&lt;p&gt;PS. I never have such a problem with older version of Kafka (confluent platform 4.0.0)&lt;/p&gt;</comment>
                            <comment id="16624165" author="kkonstantine" created="Fri, 21 Sep 2018 20:51:31 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maver1ck&quot; class=&quot;user-hover&quot; rel=&quot;maver1ck&quot;&gt;maver1ck&lt;/a&gt; for the feedback. It makes sense. I have an idea for a fix and I&apos;ll put out a PR soon.&#160;&lt;/p&gt;

&lt;p&gt;Can you share some info about how you are able to reproduce the issue? Do you just start the two aforementioned connectors at the same time?&#160;I see it&apos;s in distributed mode and that they both get stuck during their startup.&#160;Anything special about their configs?&#160;&lt;/p&gt;</comment>
                            <comment id="16624554" author="maver1ck" created="Sat, 22 Sep 2018 08:17:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkonstantine&quot; class=&quot;user-hover&quot; rel=&quot;kkonstantine&quot;&gt;kkonstantine&lt;/a&gt;&lt;br/&gt;
I think I found the reason and workaround.&lt;/p&gt;

&lt;p&gt;Some introduction:&lt;br/&gt;
1) I&apos;m building my docker image from official confluent docker image by adding there:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;debezium connector&lt;/li&gt;
	&lt;li&gt;my own SMTs (let&apos;s call it abc and xyz)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All jars went to one directory (this part is important)&lt;/p&gt;

&lt;p&gt;2) My configuration is following - I have two tasks:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;HDFS sink (official)&lt;br/&gt;
it&apos;s using abc SMT&lt;/li&gt;
	&lt;li&gt;Debezium source&lt;br/&gt;
it&apos;s using xyz SMT&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I saw that we create one instance of classloader per directory.&lt;br/&gt;
So debezium and both SMTs are provided by same classloader.&lt;br/&gt;
So both tasks are using same classloader and debezium task is using it for both SMTs and task class.&lt;/p&gt;

&lt;p&gt;Then I moved my SMTs to different directory and this solved the problem.&lt;br/&gt;
Still there is deadlock in special circumstances.&lt;/p&gt;</comment>
                            <comment id="16901013" author="ivanyu" created="Tue, 6 Aug 2019 12:59:04 +0000"  >&lt;p&gt;I hit this in prod and am interested in getting it fixed. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkonstantine&quot; class=&quot;user-hover&quot; rel=&quot;kkonstantine&quot;&gt;kkonstantine&lt;/a&gt; please let me know if you&apos;re still considering fixing this yourself. If no, I&apos;ll pick this up.&lt;/p&gt;</comment>
                            <comment id="16912290" author="ivanyu" created="Wed, 21 Aug 2019 13:33:22 +0000"  >&lt;p&gt;I wonder if &lt;tt&gt;PluginClassLoader&lt;/tt&gt;&apos;s &lt;tt&gt;loadClass&lt;/tt&gt; method needs to be &lt;tt&gt;synchronized&lt;/tt&gt; in &lt;a href=&quot;https://github.com/apache/kafka/blob/3cdc78e6bb1f83973a14ce1550fe3874f7348b05/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/PluginClassLoader.java#L89&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;: it has fine-grain synchronization immediately inside (due to being registered as parallel capable). This method&apos;s outher synchronization on &lt;tt&gt;this&lt;/tt&gt; is what seems to cause occasional deadlocks on concurrent class loading.&lt;/p&gt;</comment>
                            <comment id="17055373" author="githubbot" created="Mon, 9 Mar 2020 20:58:25 +0000"  >&lt;p&gt;gharris1727 commented on pull request #8259: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7421&quot; title=&quot;Deadlock in Kafka Connect during class loading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7421&quot;&gt;&lt;del&gt;KAFKA-7421&lt;/del&gt;&lt;/a&gt;: Reproduce Plugin/Delegating ClassLoader deadlock&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8259&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8259&lt;/a&gt;&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;Adds SynchronizationTest with a single case&lt;/li&gt;
	&lt;li&gt;Simulates Worker::startConnector and Worker::startTask classloading difference&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   Signed-off-by: Greg Harris &amp;lt;gregh@confluent.io&amp;gt;&lt;/p&gt;

&lt;p&gt;   *More detailed description of your change,&lt;br/&gt;
   if necessary. The PR title and PR message become&lt;br/&gt;
   the squashed commit message, so use a separate&lt;br/&gt;
   comment to ping reviewers.*&lt;/p&gt;

&lt;p&gt;   *Summary of testing strategy (including rationale)&lt;br/&gt;
   for the feature or bug fix. Unit and/or integration&lt;br/&gt;
   tests are expected for any behaviour change and&lt;br/&gt;
   system tests should be considered for larger changes.*&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17185890" author="xakassi" created="Thu, 27 Aug 2020 14:35:36 +0000"  >&lt;p&gt;Hi, guys!&lt;/p&gt;

&lt;p&gt;We faced the similar deadlock (not equal but similar):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Found one Java-level deadlock:
=============================
&lt;span class=&quot;code-quote&quot;&gt;&quot;pool-9-thread-6&quot;&lt;/span&gt;:
  waiting to lock monitor 0x00007f112e5565a8 (object 0x0000000084400d80, a org.apache.kafka.connect.runtime.isolation.PluginClassLoader),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;pool-9-thread-5&quot;&lt;/span&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;pool-9-thread-5&quot;&lt;/span&gt;:
  waiting to lock monitor 0x00007f112e528c48 (object 0x000000008441a4c8, a org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;pool-9-thread-2&quot;&lt;/span&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;pool-9-thread-2&quot;&lt;/span&gt;:
  waiting to lock monitor 0x00007f112e5565a8 (object 0x0000000084400d80, a org.apache.kafka.connect.runtime.isolation.PluginClassLoader),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;pool-9-thread-5&quot;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Thread-1:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;pool-9-thread-6&quot;&lt;/span&gt;: at org.apache.kafka.connect.runtime.isolation.PluginClassLoader.loadClass(PluginClassLoader.java:91) - waiting to lock &amp;lt;0x0000000084400d80&amp;gt; (a org.apache.kafka.connect.runtime.isolation.PluginClassLoader) at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:352) at org.apache.kafka.common.config.ConfigDef.parseType(ConfigDef.java:716) at org.apache.kafka.common.config.ConfigDef.parseValue(ConfigDef.java:474) at org.apache.kafka.common.config.ConfigDef.parse(ConfigDef.java:467) at org.apache.kafka.common.config.AbstractConfig.&amp;lt;init&amp;gt;(AbstractConfig.java:108) at org.apache.kafka.common.config.AbstractConfig.&amp;lt;init&amp;gt;(AbstractConfig.java:129) at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:210) at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:206) at org.apache.kafka.connect.runtime.Worker.startTask(Worker.java:430) at com.company.streaming.platform.kafka.DistributedHerder.startTask(DistributedHerder.java:1216) at com.company.streaming.platform.kafka.DistributedHerder.access$1700(DistributedHerder.java:97) at com.company.streaming.platform.kafka.DistributedHerder$13.call(DistributedHerder.java:1231) at com.company.streaming.platform.kafka.DistributedHerder$13.call(DistributedHerder.java:1227) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Thread-2:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;pool-9-thread-5&quot;&lt;/span&gt;: at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:399) - waiting to lock &amp;lt;0x000000008441a4c8&amp;gt; (a org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader) at org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader.loadClass(DelegatingClassLoader.java:392) at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:406) - locked &amp;lt;0x0000000080a80780&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;) at org.apache.kafka.connect.runtime.isolation.PluginClassLoader.loadClass(PluginClassLoader.java:104) - locked &amp;lt;0x0000000080a80780&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;) - locked &amp;lt;0x0000000084400d80&amp;gt; (a org.apache.kafka.connect.runtime.isolation.PluginClassLoader) at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:352) at org.apache.kafka.common.config.ConfigDef.parseType(ConfigDef.java:716) at org.apache.kafka.common.config.ConfigDef.parseValue(ConfigDef.java:474) at org.apache.kafka.common.config.ConfigDef.parse(ConfigDef.java:467) at org.apache.kafka.common.config.AbstractConfig.&amp;lt;init&amp;gt;(AbstractConfig.java:108) at org.apache.kafka.common.config.AbstractConfig.&amp;lt;init&amp;gt;(AbstractConfig.java:129) at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:210) at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:206) at org.apache.kafka.connect.runtime.Worker.startTask(Worker.java:430) at com.company.streaming.platform.kafka.DistributedHerder.startTask(DistributedHerder.java:1216) at com.company.streaming.platform.kafka.DistributedHerder.access$1700(DistributedHerder.java:97) at com.company.streaming.platform.kafka.DistributedHerder$13.call(DistributedHerder.java:1231) at com.company.streaming.platform.kafka.DistributedHerder$13.call(DistributedHerder.java:1227) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Thread-3:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;pool-9-thread-2&quot;&lt;/span&gt;: at org.apache.kafka.connect.runtime.isolation.PluginClassLoader.loadClass(PluginClassLoader.java:91) - waiting to lock &amp;lt;0x0000000084400d80&amp;gt; (a org.apache.kafka.connect.runtime.isolation.PluginClassLoader) at org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader.loadClass(DelegatingClassLoader.java:389) at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:352) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:348) at org.apache.kafka.common.config.ConfigDef.parseType(ConfigDef.java:719) at org.apache.kafka.common.config.ConfigDef.parseValue(ConfigDef.java:474) at org.apache.kafka.common.config.ConfigDef.parse(ConfigDef.java:467) at org.apache.kafka.common.config.AbstractConfig.&amp;lt;init&amp;gt;(AbstractConfig.java:108) at org.apache.kafka.common.config.AbstractConfig.&amp;lt;init&amp;gt;(AbstractConfig.java:129) at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:210) at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:206) at org.apache.kafka.connect.runtime.Worker.startConnector(Worker.java:249) at com.company.streaming.platform.kafka.DistributedHerder.startConnector(DistributedHerder.java:1265) at com.company.streaming.platform.kafka.DistributedHerder.access$1400(DistributedHerder.java:97) at com.company.streaming.platform.kafka.DistributedHerder$15.call(DistributedHerder.java:1326) at com.company.streaming.platform.kafka.DistributedHerder$15.call(DistributedHerder.java:1322) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17185891" author="xakassi" created="Thu, 27 Aug 2020 14:38:13 +0000"  >&lt;p&gt;And I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ivanyu&quot; class=&quot;user-hover&quot; rel=&quot;ivanyu&quot;&gt;ivanyu&lt;/a&gt;, I do not understand why &lt;b&gt;&lt;tt&gt;PluginClassLoader&lt;/tt&gt;&apos;s loadClass&lt;/b&gt; method is marked as&#160;synchronized, because&#160;&#160;it has fine-grain synchronization immediately inside. And as I can see, this method do not use any fields of &lt;b&gt;&lt;tt&gt;PluginClassLoader&lt;/tt&gt;&lt;/b&gt;&#160;class.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkonstantine&quot; class=&quot;user-hover&quot; rel=&quot;kkonstantine&quot;&gt;kkonstantine&lt;/a&gt;&#160;what do you think about it? Can we propose a PR to remove&#160;synchronized from&#160;&lt;b&gt;&lt;tt&gt;PluginClassLoader&lt;/tt&gt;&apos;s loadClass&lt;/b&gt; method?&lt;/p&gt;</comment>
                            <comment id="17208344" author="kleiby" created="Mon, 5 Oct 2020 21:35:42 +0000"  >&lt;p&gt;Hi all, we&apos;ve been encountering a similar deadlock (I think the same as the one &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xakassi&quot; class=&quot;user-hover&quot; rel=&quot;xakassi&quot;&gt;xakassi&lt;/a&gt;&#160;is seeing). We are running a single Debezium JAR inside a &lt;tt&gt;confluentinc/cp-kafka-connect-base:5.5.1-1-deb8&lt;/tt&gt;&#160;container. We tried several 5.x Debian 8 images, and encounter the deadlocks in all of them.&lt;/p&gt;

&lt;p&gt;Here&apos;s the relevant portion from an example thread dump:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Found one Java-level deadlock:
=============================
&lt;span class=&quot;code-quote&quot;&gt;&quot;StartAndStopExecutor-connect-1-2&quot;&lt;/span&gt;:
  waiting to lock monitor 0x00007f2b68001d58 (object 0x00000000c118c3c8, a org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;StartAndStopExecutor-connect-1-1&quot;&lt;/span&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;StartAndStopExecutor-connect-1-1&quot;&lt;/span&gt;:
  waiting to lock monitor 0x00007f2b68001eb8 (object 0x00000000c5100000, a org.apache.kafka.connect.runtime.isolation.PluginClassLoader),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;StartAndStopExecutor-connect-1-2&quot;&lt;/span&gt;

Java stack information &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the threads listed above:
===================================================
&lt;span class=&quot;code-quote&quot;&gt;&quot;StartAndStopExecutor-connect-1-2&quot;&lt;/span&gt;:
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:404)
	- waiting to lock &amp;lt;0x00000000c118c3c8&amp;gt; (a org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader)
	at org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader.loadClass(DelegatingClassLoader.java:397)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:411)
	- locked &amp;lt;0x00000000c6a9e908&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
	at org.apache.kafka.connect.runtime.isolation.PluginClassLoader.loadClass(PluginClassLoader.java:104)
	- locked &amp;lt;0x00000000c6a9e908&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
	- locked &amp;lt;0x00000000c5100000&amp;gt; (a org.apache.kafka.connect.runtime.isolation.PluginClassLoader)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:357)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:348)
	at org.apache.kafka.common.config.ConfigDef.parseType(ConfigDef.java:719)
	at org.apache.kafka.connect.runtime.ConnectorConfig.enrich(ConnectorConfig.java:311)
	at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:215)
	at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:209)
	at org.apache.kafka.connect.runtime.Worker.startTask(Worker.java:432)
	at org.apache.kafka.connect.runtime.distributed.DistributedHerder.startTask(DistributedHerder.java:1186)
	at org.apache.kafka.connect.runtime.distributed.DistributedHerder.access$1600(DistributedHerder.java:127)
	at org.apache.kafka.connect.runtime.distributed.DistributedHerder$12.call(DistributedHerder.java:1201)
	at org.apache.kafka.connect.runtime.distributed.DistributedHerder$12.call(DistributedHerder.java:1197)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;span class=&quot;code-quote&quot;&gt;&quot;StartAndStopExecutor-connect-1-1&quot;&lt;/span&gt;:
	at org.apache.kafka.connect.runtime.isolation.PluginClassLoader.loadClass(PluginClassLoader.java:91)
	- waiting to lock &amp;lt;0x00000000c5100000&amp;gt; (a org.apache.kafka.connect.runtime.isolation.PluginClassLoader)
	at org.apache.kafka.connect.runtime.isolation.DelegatingClassLoader.loadClass(DelegatingClassLoader.java:394)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:357)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:348)
	at org.apache.kafka.common.config.ConfigDef.parseType(ConfigDef.java:719)
	at org.apache.kafka.connect.runtime.ConnectorConfig.enrich(ConnectorConfig.java:311)
	at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:215)
	at org.apache.kafka.connect.runtime.ConnectorConfig.&amp;lt;init&amp;gt;(ConnectorConfig.java:209)
	at org.apache.kafka.connect.runtime.Worker.startConnector(Worker.java:251)
	at org.apache.kafka.connect.runtime.distributed.DistributedHerder.startConnector(DistributedHerder.java:1229)
	at org.apache.kafka.connect.runtime.distributed.DistributedHerder.access$1300(DistributedHerder.java:127)
	at org.apache.kafka.connect.runtime.distributed.DistributedHerder$14.call(DistributedHerder.java:1245)
	at org.apache.kafka.connect.runtime.distributed.DistributedHerder$14.call(DistributedHerder.java:1241)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)

Found 1 deadlock.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17214685" author="xakassi" created="Thu, 15 Oct 2020 13:29:23 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kleiby&quot; class=&quot;user-hover&quot; rel=&quot;kleiby&quot;&gt;kleiby&lt;/a&gt;&#160;!&lt;/p&gt;

&lt;p&gt;Let me describe my issue more detailed. Maybe we will be able to figure out some similar details with you which causing the problem.&lt;/p&gt;

&lt;p&gt;We have a base docker image containing several connectors (each connector in a separate folder under /plugins folder). And one custom converter in /libs. And this docker image works perfect, never such deadlocks.&lt;/p&gt;

&lt;p&gt;Also we have a child docker image which adds additional connector in&#160;a separate folder under /plugins folder. And several additional custom converters in single JAR in the same folder! We cannot put them in /libs folder currently, but I will try to do it. And this docker image get this deadlock very often.&lt;/p&gt;

&lt;p&gt;Several custom converters in the same folder with a connector is the only difference with the approach of our base docker image. So, I suppose maybe this cause our deadlocks. But I&apos;m not sure, I will try to separate converters and see.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Can you describe your configuration also&amp;amp; Maybe there are some similarities with us? Do you have SMTs or converters in one folder, in one jar?&lt;/p&gt;</comment>
                            <comment id="17231842" author="kleiby" created="Fri, 13 Nov 2020 21:34:42 +0000"  >&lt;p&gt;We are currently running a container whose base image is&#160;&lt;tt&gt;confluentinc/cp-kafka-connect-base:6.0.0&lt;/tt&gt;, and it is designed to only ever run a single Debezium connector. We build a single JAR containing both our Debezium connector and one custom SMT. We copy this JAR into the directory specified by the &lt;tt&gt;plugin.path&lt;/tt&gt; property on Kafka Connect, and that&apos;s about it.&lt;/p&gt;

&lt;p&gt;We have been using this approach (with a single JAR) for several years, and last month we upgraded our Kafka Connect base image (previously 5.2.2) to work around some deprecated package archives in Debian 8. We upgraded to 5.5.1 and encountered these deadlocks, and more recently we have upgraded to 6.0.0 and switched to the UBI image. It seems like we&apos;re encountering fewer deadlocks than before with this newest version, but they haven&apos;t disappeared entirely.&lt;/p&gt;</comment>
                            <comment id="17290761" author="kkonstantine" created="Thu, 25 Feb 2021 08:01:38 +0000"  >&lt;p&gt;The suggested fix suggested by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ivanyu&quot; class=&quot;user-hover&quot; rel=&quot;ivanyu&quot;&gt;ivanyu&lt;/a&gt;&#160;seems plausible. The method locking seems to have been an oversight given the fine grain locking based on classloader instance and requested class name.&#160;&lt;br/&gt;
I&apos;ve extended the PR that added a test with the probable fix here:&#160;&lt;a href=&quot;https://github.com/apache/kafka/pull/8259&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8259&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17297982" author="eazhilan-nagarajan" created="Tue, 9 Mar 2021 10:04:42 +0000"  >&lt;p&gt;Good to see that there is a fix on this issue.&#160;&lt;/p&gt;

&lt;p&gt;We&apos;re facing the deadlocks occurring more frequently during connect startup. We&apos;re using almost 6 connect plugins along with some custom SMTs and convertors and seems like the frequency of deadlocks has increased after we added couple of more SMTs and connector JARs.&lt;/p&gt;

&lt;p&gt;While a fix is in progress, I&apos;d like to know if there are any workarounds which would reduce the frequency of deadlocks. Any suggestion to overcome this issue would be highly appreciated.&lt;/p&gt;</comment>
                            <comment id="17380773" author="kkonstantine" created="Wed, 14 Jul 2021 17:54:49 +0000"  >&lt;p&gt;The fix has now been merged. Let&apos;s keep track and report any new issues if they appear. Some context exists on &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-12308&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-12308&lt;/a&gt;&#160;as well which reported a similar issue.&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13357362">KAFKA-12308</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y8sv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>