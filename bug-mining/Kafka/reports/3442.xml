<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:32:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-12639] AbstractCoordinator ignores backoff timeout when joining the consumer group</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-12639</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We observed heavy logging while trying to join consumer group during partial unavailability of Kafka cluster (it&apos;s part of our testing process). Seems that&#160;&lt;tt&gt;rebalanceConfig.retryBackoffMs&lt;/tt&gt; used in&#160; &lt;tt&gt;&#160;org.apache.kafka.clients.consumer.internals.AbstractCoordinator#joinGroupIfNeeded&lt;/tt&gt; is not respected. Debugging revealed that &lt;tt&gt;Timer&lt;/tt&gt; instance technically is expired thus using sleep of 0 milliseconds which defeats the purpose of backoff timeout.&lt;/p&gt;

&lt;p&gt;Minimal backoff timeout should be respected.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2021-03-30 08:30:24,488 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] JoinGroup failed: Coordinator 127.0.0.1:9092 (id: 2147483634 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) is loading the group.
2021-03-30 08:30:24,488 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] Rebalance failed.
org.apache.kafka.common.errors.CoordinatorLoadInProgressException: The coordinator is loading and hence can&apos;t process requests.
2021-03-30 08:30:24,488 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] (Re-)joining group
2021-03-30 08:30:24,489 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] JoinGroup failed: Coordinator 127.0.0.1:9092 (id: 2147483634 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) is loading the group.
2021-03-30 08:30:24,489 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] Rebalance failed.
org.apache.kafka.common.errors.CoordinatorLoadInProgressException: The coordinator is loading and hence can&apos;t process requests.
2021-03-30 08:30:24,489 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] (Re-)joining group
2021-03-30 08:30:24,490 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] JoinGroup failed: Coordinator 127.0.0.1:9092 (id: 2147483634 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) is loading the group.
2021-03-30 08:30:24,490 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] Rebalance failed.
org.apache.kafka.common.errors.CoordinatorLoadInProgressException: The coordinator is loading and hence can&apos;t process requests.
2021-03-30 08:30:24,490 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] (Re-)joining group
2021-03-30 08:30:24,491 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] JoinGroup failed: Coordinator 127.0.0.1:9092 (id: 2147483634 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) is loading the group.
2021-03-30 08:30:24,491 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] Rebalance failed.
org.apache.kafka.common.errors.CoordinatorLoadInProgressException: The coordinator is loading and hence can&apos;t process requests.
2021-03-30 08:30:24,491 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] (Re-)joining group
2021-03-30 08:30:24,492 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] JoinGroup failed: Coordinator 127.0.0.1:9092 (id: 2147483634 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) is loading the group.
2021-03-30 08:30:24,492 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] Rebalance failed.
org.apache.kafka.common.errors.CoordinatorLoadInProgressException: The coordinator is loading and hence can&apos;t process requests.
2021-03-30 08:30:24,492 INFO [fs2-kafka-consumer-41][o.a.k.c.c.i.AbstractCoordinator] [Consumer clientId=app_clientid, groupId=consumer-group] (Re-)joining group

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13370581">KAFKA-12639</key>
            <summary>AbstractCoordinator ignores backoff timeout when joining the consumer group</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pnee">Philip Nee</assignee>
                                    <reporter username="matiss.gutmanis">Matiss Gutmanis</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Apr 2021 07:44:48 +0000</created>
                <updated>Wed, 1 Mar 2023 01:45:17 +0000</updated>
                            <resolved>Wed, 1 Mar 2023 01:37:22 +0000</resolved>
                                    <version>2.7.0</version>
                                    <fixVersion>3.5.0</fixVersion>
                                    <component>clients</component>
                    <component>consumer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17553315" author="ijuma" created="Sun, 12 Jun 2022 18:55:50 +0000"  >&lt;p&gt;Is this related to &lt;a href=&quot;https://github.com/apache/kafka/commit/f8f57960c69fe677b9192b841fb7a0361ef2cc83&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/commit/f8f57960c69fe677b9192b841fb7a0361ef2cc83&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="17553811" author="guozhang" created="Mon, 13 Jun 2022 22:27:13 +0000"  >&lt;p&gt;This is a separate issue, as `joinGroupIfNeeded` is not called by the heartbeat thread at all.&lt;/p&gt;

&lt;p&gt;I checked the code in trunk and compared with 2.7, I can confirm the situation still persists there. But this may not be a real issue, just in &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matiss.gutmanis&quot; class=&quot;user-hover&quot; rel=&quot;matiss.gutmanis&quot;&gt;matiss.gutmanis&lt;/a&gt;&apos;s testing environment.&lt;/p&gt;

&lt;p&gt;The key is that inside the while loop we only check `while (rejoinNeededOrPending()) {` and is only existing due to timed out if the response cannot be received in time. This is relied on the fact that if the timer has already elapsed, after sending the join-group request we should be effectively triggering `select(0)` in which we should rarely receive the response immediately, and hence at that time we would be exiting out of the while loop. I suspect in this testing the cluster failure is shortcut-mocked by returning immediately the response (again, which should not be a common case in practice) which caused the calling loop to never exit.&lt;/p&gt;

&lt;p&gt;All that being said, we can still augment the condition as `while (rejoinNeededOrPending() &amp;amp;&amp;amp; timer.notElapsed()) {`, but doing so has a potential caveat that we would not send out the request before exiting the while loop &amp;#8212; and this is also the intention of the current code to always make sure we have the inflight request before exiting, to optimize the pipelining latency slightly &amp;#8212; cc  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnee&quot; class=&quot;user-hover&quot; rel=&quot;pnee&quot;&gt;pnee&lt;/a&gt; to chime in here.&lt;/p&gt;</comment>
                            <comment id="17683545" author="JIRAUSER283568" created="Thu, 2 Feb 2023 19:11:53 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matiss.gutmanis&quot; class=&quot;user-hover&quot; rel=&quot;matiss.gutmanis&quot;&gt;matiss.gutmanis&lt;/a&gt; - I&apos;m arriving at the same conclusion as what Guozhang previous mentioned, would you mind sharing/briefly describe your test environment?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; - should we could exit upon expired timer? maybe something like&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;

&lt;p&gt;if (timer.isExpired())&lt;/p&gt;

{ &#160; return false; }

&lt;p&gt;timer.sleep(rebalanceConfig.retryBackoffMs);&lt;/p&gt;

&lt;p&gt;```&lt;/p&gt;</comment>
                            <comment id="17683598" author="guozhang" created="Fri, 3 Feb 2023 00:17:18 +0000"  >&lt;p&gt;Yeah that would work better I think.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13370582">KAFKA-12640</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 40 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ppdc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>