<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:59:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4741] Memory leak in RecordAccumulator.append</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4741</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;RecordAccumulator creates a `ByteBuffer` from free memory pool. This should be deallocated when invocations encounter an exception or throwing any exceptions. &lt;br/&gt;
I added todo comment lines in the below code for cases to deallocate that buffer.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;RecordProducer.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            ByteBuffer buffer = free.allocate(size, maxTimeToBlock);
            &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (dq) {
                &lt;span class=&quot;code-comment&quot;&gt;// Need to check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; producer is closed again after grabbing the dequeue lock.
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (closed)
                   &lt;span class=&quot;code-comment&quot;&gt;// todo buffer should be cleared.
&lt;/span&gt;                    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot send after the producer is closed.&quot;&lt;/span&gt;);

                &lt;span class=&quot;code-comment&quot;&gt;// todo buffer should be cleared up when tryAppend &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; an Exception
&lt;/span&gt;                RecordAppendResult appendResult = tryAppend(timestamp, key, value, callback, dq);
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (appendResult != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                    &lt;span class=&quot;code-comment&quot;&gt;// Somebody &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; found us a batch, &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the one we waited &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;! Hopefully &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; doesn&apos;t happen often...
&lt;/span&gt;                    free.deallocate(buffer);
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; appendResult;
                }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I will raise PR for the same soon.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13040856">KAFKA-4741</key>
            <summary>Memory leak in RecordAccumulator.append</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="satish.duggana">Satish Duggana</assignee>
                                    <reporter username="satish.duggana">Satish Duggana</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Feb 2017 04:52:02 +0000</created>
                <updated>Mon, 11 Sep 2017 13:43:48 +0000</updated>
                            <resolved>Wed, 8 Feb 2017 13:38:39 +0000</resolved>
                                                    <fixVersion>0.11.0.0</fixVersion>
                                    <component>clients</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15855330" author="githubbot" created="Tue, 7 Feb 2017 04:58:46 +0000"  >&lt;p&gt;GitHub user satishd opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2509&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2509&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4741&quot; title=&quot;Memory leak in RecordAccumulator.append&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4741&quot;&gt;&lt;del&gt;KAFKA-4741&lt;/del&gt;&lt;/a&gt; Fix for buffer leaks in RecordAccumulator&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/satishd/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/satishd/kafka&lt;/a&gt; buffer-cleanup&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2509.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2509.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2509&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8dd4e001fa6e0513a26db76a3b88964afd6784f8&lt;br/&gt;
Author: Satish Duggana &amp;lt;sduggana@hortonworks.com&amp;gt;&lt;br/&gt;
Date:   2017-02-06T12:21:23Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4741&quot; title=&quot;Memory leak in RecordAccumulator.append&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4741&quot;&gt;&lt;del&gt;KAFKA-4741&lt;/del&gt;&lt;/a&gt; Fix for buffer leaks in RecordAccumulator&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15857994" author="ijuma" created="Wed, 8 Feb 2017 13:38:39 +0000"  >&lt;p&gt;Issue resolved by pull request 2509&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/2509&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2509&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15857996" author="githubbot" created="Wed, 8 Feb 2017 13:39:09 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2509&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2509&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15858059" author="satish.duggana" created="Wed, 8 Feb 2017 14:36:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; Thanks for merging the PR. Can you set me as assignee for this JIRA? It did not allow me to do that.&lt;/p&gt;</comment>
                            <comment id="15858065" author="ijuma" created="Wed, 8 Feb 2017 14:38:38 +0000"  >&lt;p&gt;Done.&lt;/p&gt;</comment>
                            <comment id="16136549" author="juliuszaromskis" created="Tue, 22 Aug 2017 09:16:23 +0000"  >&lt;p&gt;I&apos;m having this problem: &lt;a href=&quot;https://stackoverflow.com/questions/45813477/kafka-off-heap-memory-leak&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/45813477/kafka-off-heap-memory-leak&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;My questions is this - would it cause leaking on producer or on server?&lt;/p&gt;</comment>
                            <comment id="16161251" author="scott.pettyjohn" created="Mon, 11 Sep 2017 13:43:48 +0000"  >&lt;p&gt;I recently ran into this issue. I am using kafka-clients v 0.11.0.0. I don&apos;t see the fix when I look at the source, but the issue is marked as resolved? &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 10 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39p9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>