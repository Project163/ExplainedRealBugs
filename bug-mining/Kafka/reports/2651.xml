<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:24:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-8869] Map taskConfigs in KafkaConfigBackingStore grows monotonically despite of task removals</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-8869</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Investigation of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8676&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-8676&lt;/a&gt; revealed another issue: &lt;br/&gt;
a map in &lt;tt&gt;KafkaConfigBackingStore&lt;/tt&gt; keeps growing despite of connectors and tasks getting removed eventually.&lt;/p&gt;

&lt;p&gt;This bug does not affect directly rebalancing protocols but it&apos;d good to resolve and use in a way similar to how &lt;tt&gt;connectorConfigs&lt;/tt&gt; is used. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13254744">KAFKA-8869</key>
            <summary>Map taskConfigs in KafkaConfigBackingStore grows monotonically despite of task removals</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ChrisEgerton">Chris Egerton</assignee>
                                    <reporter username="kkonstantine">Konstantine Karantasis</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Sep 2019 16:27:23 +0000</created>
                <updated>Thu, 21 May 2020 04:15:18 +0000</updated>
                            <resolved>Thu, 21 May 2020 04:06:47 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.3.2</fixVersion>
                    <fixVersion>2.4.2</fixVersion>
                    <fixVersion>2.5.1</fixVersion>
                    <fixVersion>2.6.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16955455" author="omkreddy" created="Sun, 20 Oct 2019 11:17:54 +0000"  >&lt;p&gt; Moving this to 2.5.0 as there is no progress.&lt;/p&gt;</comment>
                            <comment id="17077805" author="chrisegerton" created="Wed, 8 Apr 2020 03:32:27 +0000"  >&lt;p&gt;It appears that this does interfere with the incremental cooperative rebalancing protocol, since the config snapshot provided by the &lt;tt&gt;KafkaConfigBackingStore&lt;/tt&gt;&#160;is &lt;a href=&quot;https://github.com/apache/kafka/blob/4c9f5cf7c3217cf802ce233a0093586dcf5a1b7c/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/distributed/IncrementalCooperativeAssignor.java#L163-L167&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;used to calculate which connectors and tasks need to be assigned across the cluster&lt;/a&gt;&#160;during a rebalance.&lt;/p&gt;

&lt;p&gt;This causes problems when a connector is created, deleted, and then re-created with a new configuration. The old task configurations are used for a short period, after the initial rebalance has occurred and the new connector instance has been created, but before it has produced new task configurations that get written to the config topic and trigger a second rebalance.&lt;/p&gt;

&lt;p&gt;This can be reproduced and observed by creating a fairly high-throughput source connector that produces to one topic, deleting that connector, and then re-creating it with a configuration that causes it to produce to a second topic. After re-creating the connector, a few records will be written to the first topic, before the output for the connector is diverted to the second topic.&lt;/p&gt;</comment>
                            <comment id="17077830" author="githubbot" created="Wed, 8 Apr 2020 04:48:21 +0000"  >&lt;p&gt;C0urante commented on pull request #8444: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8869&quot; title=&quot;Map taskConfigs in KafkaConfigBackingStore grows monotonically despite of task removals&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8869&quot;&gt;&lt;del&gt;KAFKA-8869&lt;/del&gt;&lt;/a&gt;: Remove task configs for deleted connectors from config snapshot&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8444&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8444&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;span class=&quot;error&quot;&gt;&amp;#91;Jira&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8869&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-8869&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;   Currently, if a connector is deleted, its task configurations will remain in the config snapshot tracked by the `KafkaConfigBackingStore`. This causes issues with incremental cooperative rebalancing, which utilizes that config snapshot to determine which connectors and tasks need to be assigned across the cluster. Specifically, it first checks to see which connectors are present in the config snapshot, and then, for each of those connectors, queries the snapshot for that connector&apos;s task configs.&lt;/p&gt;

&lt;p&gt;   The lifecycle of a connector is for its configuration to be written to the config topic, that write to be picked up by the workers in the cluster and trigger a rebalance, the connector to be assigned to and started by a worker, task configs to be generated by the connector and then written to the config topic, that write to be picked up by the workers in the cluster and trigger a second rebalance, and finally, the tasks to be assigned to and started by workers across the cluster.&lt;/p&gt;

&lt;p&gt;   There is a brief period in between the first time the connector is started and when the second rebalance has completed during which those stale task configs from a previously-deleted version of the connector will be used by the framework to start tasks for that connector.&lt;/p&gt;

&lt;p&gt;   This fix aims to eliminate that window by preemptively clearing the task configs from the config snapshot for a connector whenever it has been deleted.&lt;/p&gt;

&lt;p&gt;   An existing unit test is modified to verify this behavior, and should provide sufficient guarantees that the bug has been fixed, since the cause of the behavior has been narrowed down to incorrect values in the `taskConfigs` field for the `ClusterConfigState` provided by the `KafkaConfigBackingStore`.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 31 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z06bq0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>