<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:46:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2674] ConsumerRebalanceListener.onPartitionsRevoked() is not called on consumer close</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2674</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Hi, I&apos;m investigating and testing behavior of new consumer from the planned release 0.9 and found an inconsistency in calling of rebalance callbacks.&lt;/p&gt;

&lt;p&gt;I noticed that ConsumerRebalanceListener.onPartitionsRevoked() is NOT called during consumer close and application shutdown. It&apos;s JavaDoc contract says:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&quot;This method will be called before a rebalance operation starts and after the consumer stops fetching data.&quot;&lt;/li&gt;
	&lt;li&gt;&quot;It is recommended that offsets should be committed in this callback to either Kafka or a custom offset store to prevent duplicate data.&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I believe calling consumer.close() is a start of rebalance operation and even the local consumer that is actually closing should be notified to be able to process any rebalance logic including offsets commit (e.g. if auto-commit is disabled).&lt;/p&gt;

&lt;p&gt;There are commented logs of current and expected behaviors.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;// Application start
2015-10-20 15:14:02.208 INFO  o.a.k.common.utils.AppInfoParser    [TestConsumer-worker-0]: Kafka version : 0.9.0.0-SNAPSHOT (AppInfoParser.java:82)
2015-10-20 15:14:02.208 INFO  o.a.k.common.utils.AppInfoParser    [TestConsumer-worker-0]: Kafka commitId : 241b9ab58dcbde0c (AppInfoParser.java:83)

// Consumer started (the first one in group), rebalance callbacks are called including empty onPartitionsRevoked()
2015-10-20 15:14:02.333 INFO  c.a.e.kafka.newapi.TestConsumer     [TestConsumer-worker-0]: Rebalance callback, revoked: [] (TestConsumer.java:95)
2015-10-20 15:14:02.343 INFO  c.a.e.kafka.newapi.TestConsumer     [TestConsumer-worker-0]: Rebalance callback, assigned: [testB-1, testA-0, testB-0, testB-3, testA-2, testB-2, testA-1, testA-4, testB-4, testA-3] (TestConsumer.java:100)

// Another consumer joined the group, rebalancing
2015-10-20 15:14:17.345 INFO  o.a.k.c.c.internals.Coordinator     [TestConsumer-worker-0]: Attempt to heart beat failed since the group is rebalancing, try to re-join group. (Coordinator.java:714)
2015-10-20 15:14:17.346 INFO  c.a.e.kafka.newapi.TestConsumer     [TestConsumer-worker-0]: Rebalance callback, revoked: [testB-1, testA-0, testB-0, testB-3, testA-2, testB-2, testA-1, testA-4, testB-4, testA-3] (TestConsumer.java:95)
2015-10-20 15:14:17.349 INFO  c.a.e.kafka.newapi.TestConsumer     [TestConsumer-worker-0]: Rebalance callback, assigned: [testB-3, testA-4, testB-4, testA-3] (TestConsumer.java:100)

// Consumer started closing, there SHOULD be onPartitionsRevoked() callback to commit offsets like during standard rebalance, but it is missing
2015-10-20 15:14:39.280 INFO  c.a.e.kafka.newapi.TestConsumer     [main]: Closing instance (TestConsumer.java:42)
2015-10-20 15:14:40.264 INFO  c.a.e.kafka.newapi.TestConsumer     [TestConsumer-worker-0]: Worker thread stopped (TestConsumer.java:89)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Workaround is to call onPartitionsRevoked() explicitly and manually just before calling consumer.close() but it seems dirty and error prone for me. It can be simply forgotten be someone without such experience.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12906242">KAFKA-2674</key>
            <summary>ConsumerRebalanceListener.onPartitionsRevoked() is not called on consumer close</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hachikuji">Jason Gustafson</assignee>
                                    <reporter username="turek@avast.com">Michal Turek</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Oct 2015 13:47:18 +0000</created>
                <updated>Mon, 9 Nov 2015 19:11:43 +0000</updated>
                            <resolved>Mon, 9 Nov 2015 19:11:43 +0000</resolved>
                                    <version>0.9.0.0</version>
                                    <fixVersion>0.9.0.0</fixVersion>
                                    <component>consumer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14965532" author="hachikuji" created="Tue, 20 Oct 2015 18:38:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=onurkaraman&quot; class=&quot;user-hover&quot; rel=&quot;onurkaraman&quot;&gt;onurkaraman&lt;/a&gt; Maybe this issue can be addressed when we update the client-side code for the LeaveGroup request?&lt;/p&gt;</comment>
                            <comment id="14965782" author="becket_qin" created="Tue, 20 Oct 2015 21:17:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; I am reviewing &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2464&quot; title=&quot;Client-side assignment and group generalization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2464&quot;&gt;&lt;del&gt;KAFKA-2464&lt;/del&gt;&lt;/a&gt; and also noticed this. I am actually wondering if rebalance listener should be invoked when consumer shuts down. It seems to me that when consumer shuts down, it should simply commit offsets then send a leave group request. It is not actually participating the rebalance any more. Only the rest of the members in the group are doing rebalance.&lt;/p&gt;</comment>
                            <comment id="14965803" author="hachikuji" created="Tue, 20 Oct 2015 21:25:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt; I think the only problem with that is that some users might be doing their own offset management, in which case they might not even be using Kafka to store offsets. Currently, we only commit on close if auto-commit is enabled. I guess we could also depend on the user to manually do commits prior to close, but it seems like they&apos;d probably already have their commit logic in the revoke callback. What do you think?&lt;/p&gt;</comment>
                            <comment id="14965865" author="becket_qin" created="Tue, 20 Oct 2015 22:14:22 +0000"  >&lt;p&gt;I think it would be clearer if rebalance callback is only called when rebalance occurred, but not on consumer closure. &lt;/p&gt;

&lt;p&gt;If auto commit is turned off, and users are committing offset on there own, the following code looks clean to me when user close a consumer.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!failure)
  consumer.commitOffsetSync();
consumer.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And this is what we do in mirror maker. I prefer this because it is not complex and we are not re-purposing rebalance listener for something else. I can imagine some logic that only makes sense for actual rebalance, say holding a lock and release it when onPartitionAssigned() is called.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;
</comment>
                            <comment id="14965913" author="guozhang" created="Tue, 20 Oct 2015 22:46:49 +0000"  >&lt;p&gt;Today we are already calling ```commitOffsetSync``` upon consumer closing in the coordinator if auto commit is turned on. In addition, we also call ```commitOffsetSync``` before we call ```onPartitionsRevoked``` during the rebalance if auto commit is turned on. So I think the question is really whether we should also call ```onPartitionsRevoked``` upon closing after we call ```commitOffsetSync``` as well.&lt;/p&gt;

&lt;p&gt;I prefer adding the ```onPartitionsRevoked``` call since it may be used not only for manual offset management. &lt;/p&gt;

&lt;p&gt;BTW there is a discrepancy between the old and new consumer in MirrorMaker, that with the old consumer we use a rebalance listener that returns the global assignment in ```onPartitionsAssigned``` whereas in the new consumer it only returns its own assignment. We need to think about how it can be resolved.&lt;/p&gt;</comment>
                            <comment id="14965935" author="hachikuji" created="Tue, 20 Oct 2015 23:04:10 +0000"  >&lt;p&gt;Since LeaveGroup will cause a group rebalance, it doesn&apos;t seem inconsistent to call the revocation callback prior to closing, but I don&apos;t have a strong preference either way as long as the documentation is clear. &lt;/p&gt;</comment>
                            <comment id="14966003" author="becket_qin" created="Wed, 21 Oct 2015 00:05:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; The original reason we add consumer rebalance listener was because rebalance can be triggered without user awareness. But when rebalance occurs, user might want to do something. This is different from consumer closure case. When users close the consumer, they know what they are doing, and likely they will do some cleanup and necessary state checkpoint before closing the consumer. I am not sure how valuable it is to put some pre-closure tasks to onPartitionRevoked(). To me it is a little confusing. Also user might need to add some check to see if the rebalance is caused by close() or it is an actual rebalance.(for example the grabbing a lock as I mentioned before).&lt;/p&gt;

&lt;p&gt;Good point about the Mirror Maker. The reason we have global assignment for mirror maker during rebalance listener is because we want to allow mirror maker to do some administrative logic when rebalance is triggered. (e.g. when rebalance is triggered because of a new topic is created in source cluster, we want to create the topic in target cluster with the same number of partitions). In order to let the rebalance listener to perform such action we need a global knowledge of topic so we know which topics changed. This global topic information is part of global assignment (global topic info + owners).&lt;/p&gt;

&lt;p&gt;With the new client-side assignment patch, at least the leader has global assignment knowledge, so I think for that use case we should be fine. Although letting the leader to do everything is not ideal if the administrative work is heavy, but it is still doable.&lt;/p&gt;
</comment>
                            <comment id="14967638" author="guozhang" created="Wed, 21 Oct 2015 18:46:57 +0000"  >&lt;p&gt;This is a good point, especially if the user DOES NOT want to do some logic upon shutting down that is included in the callback. One edge case though is that upon closing the consumer which tries to close the coordinator, it will likely try to finish all in-flight requests by calling &quot;maybeAutoCommitOffsetsSync&quot;, hence users&apos; behavior before calling close() may not be on the final state of the consumer. Do we have any ideas about resolving this? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14968350" author="becket_qin" created="Thu, 22 Oct 2015 01:45:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; That is a valid concern, I haven&apos;t think it through before. The question is what states could change and whether the changes matter. From consumer&apos;s point of view, there are only two states that matter: 1)Partition Assignment 2)Consumer Offsets.&lt;/p&gt;

&lt;p&gt;In most cases, user would not care about partition assignment. In cases where user care about the partition assignment, the assignment after close would be empty. So it seems users do not really lose anything from here.&lt;/p&gt;

&lt;p&gt;If user are using auto commit, that means user do not really care about the offset commit timing as long as the correct offset is committed. When consumer closes, the correct offsets to commit are the consumed offsets, and consumed offsets will not change unless user call poll(). If user don&apos;t want committed offset to change before and after consumer closes, they can either call commitOffsetSync() before closing consumer by themselves or disable auto commit, depending on the use cases.&lt;/p&gt;

&lt;p&gt;On the other hand, if users are not using auto commit, we will not commit the offsets, so the state won&apos;t change.&lt;/p&gt;

&lt;p&gt;So I think we are OK here. Do you have some specific use case that breaks?&lt;/p&gt;</comment>
                            <comment id="14968420" author="hachikuji" created="Thu, 22 Oct 2015 02:53:51 +0000"  >&lt;p&gt;I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt; that this is probably not a problem. One thing that may be unintuitive, and perhaps the reason we&apos;re having this discussion, is that the callback names suggest a different invocation order. From a user&apos;s perspective, I would expect that each invocation of onPartitionsAssigned() gets a corresponding invocation of onPartitionsRevoked(), not the other way around (doesn&apos;t assignment come before revocation after all?). In that case, it&apos;s natural to expect that onPartitionsRevoked() is invoked on close(). However, the actual contract is exactly the opposite: onPartitionsRevoked() is always called prior to rebalance, and onPartitionsAssigned() is called after. So I wonder if we should make this clearer by renaming the methods. For example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;void beforeRebalance(List&amp;lt;TopicPartition&amp;gt; oldAssignment);
void afterRebalance(List&amp;lt;TopicPartition&amp;gt; newAssignment);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In this case, the invocation order is clear even without reading the documentation. It also seems clear then that close() would not call beforeRebalance(). Any thoughts?&lt;/p&gt;</comment>
                            <comment id="14968467" author="becket_qin" created="Thu, 22 Oct 2015 03:49:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; I agree the name is a little misleading. People tends to ignore the class name which is ConsumerRebalanceListener.&lt;/p&gt;

&lt;p&gt;The reason we had onPartitionsRevoked and onPartitionsAssigned was because in old consumer during rebalance there are multiple steps (commit offsets, release partition ownership, assign partitions, claim partition ownership, etc). We wanted to make it clear when those methods are called. However some of the steps might not applicable to new consumer anymore. &lt;/p&gt;

&lt;p&gt;WRT the name change. One thing is when we say beforeRebalance(), it sounds like before committing offsets, while actually it is not. For example, if user call committed() in rebalance listener, they might get staled result. Personally I think this is fine as long as we document the behavior clearly.&lt;/p&gt;

&lt;p&gt;Another way to think about this is that in the future is it possible we add a beforeCommittingOffset() that get called before committing offset. If there is such possibility I would prefer to keep the current names but document them clearly.&lt;/p&gt;
</comment>
                            <comment id="14974770" author="hachikuji" created="Mon, 26 Oct 2015 18:28:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; What would you guys think of the following change to ConsumerRebalanceListener? Basically the objective is to make the calling order clear.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; RebalanceListener {
  &lt;span class=&quot;code-comment&quot;&gt;/* Invoked prior to rebalance, offsets committed here */&lt;/span&gt;
  void onPrepare(List&amp;lt;TopicPartition&amp;gt; oldAssignment);

  &lt;span class=&quot;code-comment&quot;&gt;/* Invoked after rebalance, set initial offset here */&lt;/span&gt;
  void onComplete(List&amp;lt;TopicPartition&amp;gt; newAssignment)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Might also be nice to get feedback from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkreps&quot; class=&quot;user-hover&quot; rel=&quot;jkreps&quot;&gt;jkreps&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14975020" author="guozhang" created="Mon, 26 Oct 2015 20:51:41 +0000"  >&lt;p&gt;Personally I prefer the old function names since the new proposed names seem not very related to the old partitions as its parameter and hence its effort in resolving confusion seems overwhelmed by the new confusions it introduced. I would suggest we only document clearly that the callback will not be triggered upon consumer closure.&lt;/p&gt;</comment>
                            <comment id="14977457" author="becket_qin" created="Wed, 28 Oct 2015 00:29:10 +0000"  >&lt;p&gt;I don&apos;t have a strong opinion on this. I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; that the argument name is a little bit weird. If we change the function name perhaps we can use currentAssignment instead of oldAssignment?&lt;/p&gt;</comment>
                            <comment id="14979433" author="jkreps" created="Wed, 28 Oct 2015 23:04:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; I don&apos;t have a ton to add. I think I added that class, but it was mostly a placeholder not something with a well-thought-out rationale--I agree that the way it calls revoke prior to assign is a bit odd.&lt;/p&gt;</comment>
                            <comment id="14979819" author="hachikuji" created="Thu, 29 Oct 2015 05:02:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; In the context of rebalancing, I think the meaning of onPrepare/onComplete should be fairly clear to the user, and the benefit is that these names suggest the semantics that we actually implement. Maybe oldAssignment is a bad argument name, but we could use currentAssignment as Becket suggests, or we could also use the revoked/assigned names, as below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; RebalanceListener {
  void onPrepare(List&amp;lt;TopicPartition&amp;gt; revokedPartitions);
  void onComplete(List&amp;lt;TopicPartition&amp;gt; assignedPartitions);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Haha, I&apos;ve been working on this code a little too much, so it&apos;s hard for me to see whether this would be more intuitive to users.&lt;/p&gt;</comment>
                            <comment id="14980737" author="becket_qin" created="Thu, 29 Oct 2015 16:39:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; I am wondering do we want to avoid use &lt;b&gt;assign&lt;/b&gt; here? Because we have used it for explicit partition management.&lt;/p&gt;</comment>
                            <comment id="14986470" author="hachikuji" created="Tue, 3 Nov 2015 01:36:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt; Since none of the alternatives seem clearly better, maybe we should just keep the current names. I can add a patch to try and clarify the behavior.&lt;/p&gt;</comment>
                            <comment id="14986541" author="becket_qin" created="Tue, 3 Nov 2015 02:33:28 +0000"  >&lt;p&gt;Yes, I agree documenting it clearly is probably sufficient.&lt;/p&gt;</comment>
                            <comment id="14997148" author="githubbot" created="Mon, 9 Nov 2015 19:03:51 +0000"  >&lt;p&gt;GitHub user hachikuji opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/467&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2674&quot; title=&quot;ConsumerRebalanceListener.onPartitionsRevoked() is not called on consumer close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2674&quot;&gt;&lt;del&gt;KAFKA-2674&lt;/del&gt;&lt;/a&gt;: clarify onPartitionsRevoked behavior&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hachikuji/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hachikuji/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2674&quot; title=&quot;ConsumerRebalanceListener.onPartitionsRevoked() is not called on consumer close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2674&quot;&gt;&lt;del&gt;KAFKA-2674&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/467.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/467.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #467&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7922adfe74278f7f003d4053c7b6e06f618ab1a6&lt;br/&gt;
Author: Jason Gustafson &amp;lt;jason@confluent.io&amp;gt;&lt;br/&gt;
Date:   2015-11-09T19:02:44Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2674&quot; title=&quot;ConsumerRebalanceListener.onPartitionsRevoked() is not called on consumer close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2674&quot;&gt;&lt;del&gt;KAFKA-2674&lt;/del&gt;&lt;/a&gt;: clarify onPartitionsRevoked behavior&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14997155" author="hachikuji" created="Mon, 9 Nov 2015 19:06:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt; I added a commit to clarify the behavior. I think the documentation was already fairly clear, so I just added a comment to emphasize that onPartitionsRevoked() is not called before close(). I also reordered the methods to try to suggest the order they are actually invoked. I don&apos;t think this is a blocker for 0.9.0.&lt;/p&gt;</comment>
                            <comment id="14997165" author="githubbot" created="Mon, 9 Nov 2015 19:11:33 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/467&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14997166" author="guozhang" created="Mon, 9 Nov 2015 19:11:43 +0000"  >&lt;p&gt;Issue resolved by pull request 467&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/467&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2n8kf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>