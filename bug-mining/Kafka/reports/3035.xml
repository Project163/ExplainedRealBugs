<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:28:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-13003] KafkaBroker advertises socket port instead of the configured advertised port</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-13003</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In Kraft mode Apache Kafka 2.8.0 does advertise the socket port instead of the configured advertised port.&lt;/p&gt;

&lt;p&gt;A broker given with the following configuration&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
listeners=PUBLIC:&lt;span class=&quot;code-comment&quot;&gt;//0.0.0.0:19092,REPLICATION://0.0.0.0:9091
&lt;/span&gt;advertised.listeners=PUBLIC:&lt;span class=&quot;code-comment&quot;&gt;//envoy-kafka-broker:9091,REPLICATION://kafka-broker1:9091&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;advertises on the &lt;em&gt;PUBLIC&lt;/em&gt; listener &lt;em&gt;envoy-kafka-broker:19092&lt;/em&gt;, however I would expect that &lt;em&gt;envoy-kafka-broker:9091&lt;/em&gt; is advertised. In ZooKeeper mode it works as expected.&lt;/p&gt;

&lt;p&gt;In a deployment with a L4 proxy in front of the Kafka cluster, it is important, that the advertised port can be different from the actual socket port.&lt;/p&gt;

&lt;p&gt;I tested it with a Docker-Compose setup which runs 3 Kafka Broker in Kraft mode and an Envoy proxy in front of them. With Apache Kafka 2.8.0 it does not work, because Kafka does not advertise the configured advertised port. For more details see: &lt;a href=&quot;https://github.com/ueisele/kafka/tree/fix/kraft-advertisedlisteners-build/proxy-examples/proxyl4-kafkakraft-bug-2.8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ueisele/kafka/tree/fix/kraft-advertisedlisteners-build/proxy-examples/proxyl4-kafkakraft-bug-2.8&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Client &amp;#8211; 909&lt;span class=&quot;error&quot;&gt;&amp;#91;1-3&amp;#93;&lt;/span&gt; --&amp;gt; Envoy Proxy &amp;#8211; 19092 --&amp;gt; Kafka Broker &lt;span class=&quot;error&quot;&gt;&amp;#91;1-3&amp;#93;&lt;/span&gt;&lt;/em&gt;&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Envoy Host &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Envoy Port &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Kafka Broker &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Kafka Port &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; Advertised Listener &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; envoy-kafka-broker &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 9091 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; kafka-broker1 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 19092 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; envoy-kafka-broker:9091 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; envoy-kafka-broker &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 9092 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; kafka-broker2 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 19092 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; envoy-kafka-broker:9092 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; envoy-kafka-broker &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 9093 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; kafka-broker3 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 19092 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; envoy-kafka-broker:9093 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-bash&quot;&gt;
&amp;gt; docker-compose exec kafkacat kafkacat -b envoy-kafka-broker:9091 -L
Metadata &lt;span class=&quot;code-object&quot;&gt;for&lt;/span&gt; all topics (from broker -1: envoy-kafka-broker:9091/bootstrap):
 3 brokers:
&#160; broker 101 at envoy-kafka-broker:19092
&#160; broker 102 at envoy-kafka-broker:19092 (controller)
&#160; broker 103 at envoy-kafka-broker:19092
 0 topics:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13386281">KAFKA-13003</key>
            <summary>KafkaBroker advertises socket port instead of the configured advertised port</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ueisele">Uwe Eisele</assignee>
                                    <reporter username="ueisele">Uwe Eisele</reporter>
                        <labels>
                            <label>kip-500</label>
                    </labels>
                <created>Mon, 28 Jun 2021 14:28:50 +0000</created>
                <updated>Mon, 12 Jul 2021 20:48:09 +0000</updated>
                            <resolved>Mon, 12 Jul 2021 20:48:09 +0000</resolved>
                                    <version>2.8.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17370624" author="ueisele" created="Mon, 28 Jun 2021 14:31:20 +0000"  >&lt;p&gt;I create a pull request: &lt;a href=&quot;https://github.com/apache/kafka/pull/10935&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/10935&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The Docker-Compose setup with the fix (proposed in the pull request) works and advertises the configured advertised port. For more details see: &lt;a href=&quot;https://github.com/ueisele/kafka/tree/fix/kraft-advertisedlisteners-build/proxy-examples/proxyl4-kafkakraft-fix-2.8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ueisele/kafka/tree/fix/kraft-advertisedlisteners-build/proxy-examples/proxyl4-kafkakraft-fix-2.8&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17379408" author="ueisele" created="Mon, 12 Jul 2021 20:48:09 +0000"  >&lt;p&gt;Pull Request #10935 has been merged.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 18 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0sdfc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>