<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:27:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-10614] Group coordinator onElection/onResignation should guard against leader epoch</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-10614</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When there are a sequence of LeaderAndISR or StopReplica requests sent from different controllers causing the group coordinator to elect / resign, we may re-order the events due to race condition. For example:&lt;/p&gt;

&lt;p&gt;1) First LeaderAndISR request received from old controller to resign as the group coordinator.&lt;br/&gt;
2) Second LeaderAndISR request received from new controller to elect as the group coordinator.&lt;br/&gt;
3) Although threads handling the 1/2) requests are synchronized on the replica manager, their callback &lt;tt&gt;onLeadershipChange&lt;/tt&gt; would trigger &lt;tt&gt;onElection/onResignation&lt;/tt&gt; which would schedule the loading / unloading on background threads, and are not synchronized.&lt;br/&gt;
4) As a result, the &lt;tt&gt;onElection&lt;/tt&gt; maybe triggered by the thread first, and then &lt;tt&gt;onResignation&lt;/tt&gt;. As a result, the coordinator would not recognize it self as the coordinator and hence would respond any coordinator request with &lt;tt&gt;NOT_COORDINATOR&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Here are two proposals on top of my head:&lt;/p&gt;

&lt;p&gt;1) Let the scheduled load / unload function to keep the passed in leader epoch, and also materialize the epoch in memory. Then when execute the unloading check against the leader epoch.&lt;/p&gt;

&lt;p&gt;2) This may be a bit simpler: using a single background thread working on a FIFO queue of loading / unloading jobs, since the caller are actually synchronized on replica manager and order preserved, the enqueued loading / unloading job would be correctly ordered as well. In that case we would avoid the reordering. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13335548">KAFKA-10614</key>
            <summary>Group coordinator onElection/onResignation should guard against leader epoch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tombentley">Tom Bentley</assignee>
                                    <reporter username="guozhang">Guozhang Wang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Oct 2020 04:41:17 +0000</created>
                <updated>Tue, 13 Jul 2021 21:04:44 +0000</updated>
                            <resolved>Mon, 7 Jun 2021 16:16:22 +0000</resolved>
                                                    <fixVersion>3.0.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17224992" author="cadonna" created="Mon, 2 Nov 2020 22:24:21 +0000"  >&lt;p&gt;FYI: This bug makes system test &lt;tt&gt;StreamsBrokerBounceTest.test_broker_type_bounce&lt;/tt&gt; fail once in a while when the group coordinator (i.e., leader of partition 2 of the&#160;&lt;tt&gt;__consumer_offset&lt;/tt&gt; topic) is bounced. Unfortunately, I haven&apos;t been able to reproduce the failure locally.&lt;/p&gt;</comment>
                            <comment id="17237451" author="tombentley" created="Mon, 23 Nov 2020 15:57:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; any thoughts about the PR I opened for this?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jpz4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>