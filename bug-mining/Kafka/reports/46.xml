<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:35:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-307] Refactor server code to remove interdependencies between LogManager and KafkaZooKeeper</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-307</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Currently, LogManager wraps KafkaZooKeeper which is meant for all zookeeper interaction of a Kafka server. With replication, KafkaZookeeper will handle leader election, various state change listeners and then start replicas. Due to interdependency between LogManager and KafkaZookeeper, starting replicas is not possible until LogManager starts up completely. Due to this, we have to separate the broker startup procedures required for replication to get around this problem.&lt;/p&gt;

&lt;p&gt;It will be good to refactor and clean up the server code, before diving deeper into replication.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12546701">KAFKA-307</key>
            <summary>Refactor server code to remove interdependencies between LogManager and KafkaZooKeeper</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nehanarkhede">Neha Narkhede</assignee>
                                    <reporter username="nehanarkhede">Neha Narkhede</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Mar 2012 01:14:31 +0000</created>
                <updated>Fri, 23 Mar 2012 20:20:08 +0000</updated>
                            <resolved>Fri, 23 Mar 2012 20:20:08 +0000</resolved>
                                    <version>0.7</version>
                    <version>0.8.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13235125" author="nehanarkhede" created="Wed, 21 Mar 2012 23:06:18 +0000"  >&lt;p&gt;Attaching a patch for this refactoring. Broadly, it includes the following changes -&lt;/p&gt;

&lt;p&gt;1. LogManager and KafkaZooKeeper are decoupled and don&apos;t depend on each other&lt;/p&gt;

&lt;p&gt;2. KafkaServer maintains replicas, instead of LogManager&lt;/p&gt;</comment>
                            <comment id="13235707" author="junrao" created="Thu, 22 Mar 2012 16:49:54 +0000"  >&lt;p&gt;Overall looks good. Some suggestions:&lt;/p&gt;

&lt;p&gt;1. KafkaServer:&lt;br/&gt;
Replicas are important data structures on each broker. Could we create a separate class Replicas that manage all replicas needed on a broker? Also, I see 2 different apis for adding a replica data structure. For replicas physically assigned to a broker, they always need a local Log. So, when adding those replicas, we need an api that creates a new log, if it&apos;s not there already (e.g. for newly created topics). The rest of replica data structures needed on a broker are not physically assigned to this broker and they are used to track the progress of the replicas in the followers. When adding those replicas, we need another api that doesn&apos;t force the creation of a local log.&lt;/p&gt;

&lt;p&gt;2. log4j.properties: Do we really want to turn off logging for all kafka during unit tests? How about keeping it at ERROR level. We can probably turn off logging for ZK.&lt;/p&gt;</comment>
                            <comment id="13235922" author="nehanarkhede" created="Thu, 22 Mar 2012 19:26:06 +0000"  >&lt;p&gt;Thanks for the review !&lt;/p&gt;

&lt;p&gt;1. I like your suggestion. I wasn&apos;t quite satisfied with the way replicas were being managed. Incorporated the suggested changes. Looks much better now.&lt;/p&gt;

&lt;p&gt;2. Didn&apos;t mean to check it in. But yes, I think zookeeper should be on ERROR and so should Kafka.&lt;/p&gt;</comment>
                            <comment id="13236175" author="junrao" created="Thu, 22 Mar 2012 23:30:16 +0000"  >&lt;p&gt;Thanks for patch v2. Looks cleaner. A couple of other comments:&lt;/p&gt;

&lt;p&gt;3. Is it better for KafkaZooKeeper to call ReplicaManager.addLocalReplica directly, instead of going through KafkaServer? For all replicas added in KafkaZookeeper, we know they are all local and should have a log. We could call LogManager.getOrCreateLog to get the log and pass it to ReplicaManager.&lt;/p&gt;

&lt;p&gt;4. There are unused imports in KafkaServer.&lt;/p&gt;</comment>
                            <comment id="13236178" author="nehanarkhede" created="Thu, 22 Mar 2012 23:34:36 +0000"  >&lt;p&gt;3. Yeah, I thought about this, but then that requires LogManager to be referenced inside KafkaZooKeeper again. So, thats why it goes through KafkaServer. The point was to have only KafkaServer have access to LogManager, ReplicaManager and KafkaZookeeper, but not have those 3 components have interdependencies. What do you think ?&lt;/p&gt;

&lt;p&gt;4. Will clean it up before committing the patch.&lt;/p&gt;</comment>
                            <comment id="13236206" author="nehanarkhede" created="Fri, 23 Mar 2012 00:09:36 +0000"  >&lt;p&gt;3. Fixed addReplica logic to use getOrCreateLog instead of getLog&lt;br/&gt;
4. Cleaned up the imports&lt;/p&gt;</comment>
                            <comment id="13236734" author="junrao" created="Fri, 23 Mar 2012 16:20:16 +0000"  >&lt;p&gt;+1 on patch v3.&lt;/p&gt;</comment>
                            <comment id="13237017" author="nehanarkhede" created="Fri, 23 Mar 2012 20:20:08 +0000"  >&lt;p&gt;Thanks for the review ! Committed this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12514682">KAFKA-45</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12519342" name="kafka-307-draft.patch" size="21083" author="nehanarkhede" created="Wed, 21 Mar 2012 23:05:18 +0000"/>
                            <attachment id="12519491" name="kafka-307-v2.patch" size="22987" author="nehanarkhede" created="Thu, 22 Mar 2012 19:26:06 +0000"/>
                            <attachment id="12519551" name="kafka-307-v3.patch" size="22841" author="nehanarkhede" created="Fri, 23 Mar 2012 00:09:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231859</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 35 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i09m9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>54040</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>