<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:37:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-779] Standardize Zk data structures for Re-assign partitions and Preferred replication election</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-779</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Follow the schema at &lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/Kafka+data+structures+in+Zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/KAFKA/Kafka+data+structures+in+Zookeeper&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12634941">KAFKA-779</key>
            <summary>Standardize Zk data structures for Re-assign partitions and Preferred replication election</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="swapnilghike">Swapnil Ghike</assignee>
                                    <reporter username="swapnilghike">Swapnil Ghike</reporter>
                        <labels>
                            <label>kafka-0.8</label>
                            <label>p2</label>
                    </labels>
                <created>Sat, 2 Mar 2013 00:57:20 +0000</created>
                <updated>Wed, 13 Mar 2013 02:04:56 +0000</updated>
                            <resolved>Wed, 6 Mar 2013 20:55:31 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13591980" author="swapnilghike" created="Mon, 4 Mar 2013 04:27:26 +0000"  >&lt;p&gt;Changes:&lt;/p&gt;

&lt;p&gt;1. Zk data format standardization for admin/reassign_partitions and admin/preffered_replica_election. (These changes still hit the bug mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-780&quot; title=&quot;Reassign partitions tool produces NPE in shutdown handler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-780&quot;&gt;&lt;del&gt;KAFKA-780&lt;/del&gt;&lt;/a&gt; which occurred without the changes in this patch.)&lt;/p&gt;

&lt;p&gt;2. I changed Json manipulation related functions in Utils, because mergeJsonObjects had a bug which could screw up a JSON string that included a nested object or an array, while attempting to sort the fields in the string. I replaced it with a new function mergeJsonFields and created a new function mapToJsonFields. As it turned out, these two functions also helped reduce some lines of code in other JSON related functions in Utils. &lt;/p&gt;

&lt;p&gt;3. Ran optimize imports on the entire source code. Three files unrelated to this patch have been touched.&lt;/p&gt;

&lt;p&gt;Testing done - &lt;br/&gt;
i. Unit tests pass&lt;br/&gt;
ii. Verified the format of all Zk data structures as mentioned in the wiki to ensure 2 above didn&apos;t break anything. Verified that the fields are sorted.&lt;br/&gt;
iii. Tested reassign-partitions tool and preferred-replica-election admin tools, but they hit the exception mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-780&quot; title=&quot;Reassign partitions tool produces NPE in shutdown handler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-780&quot;&gt;&lt;del&gt;KAFKA-780&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13592683" author="swapnilghike" created="Mon, 4 Mar 2013 21:54:15 +0000"  >&lt;p&gt;Modified the description of the --path-to-json-file option required by the tools.&lt;/p&gt;</comment>
                            <comment id="13594965" author="junrao" created="Wed, 6 Mar 2013 18:48:17 +0000"  >&lt;p&gt;Thanks for patch v2. Looks good overall. A couple of comments:&lt;/p&gt;

&lt;p&gt;1. PreferredReplicaLeaderElectionCommand: We shouldn&apos;t let the user put in the version # in path-to-json-file. The tool knows the version and should fill it in. Ditto for ReassignPartitionsCommand.&lt;/p&gt;

&lt;p&gt;2. I had the following unit test failure.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt; Test Failed: testPartitionReassignmentWithLeaderInNewReplicas(kafka.admin.AdminTest)&lt;br/&gt;
junit.framework.AssertionFailedError: Partition should have been reassigned to 0, 2, 3 expected:&amp;lt;List(0, 2, 3)&amp;gt; but was:&amp;lt;List(0, 1, 2)&amp;gt;&lt;br/&gt;
	at junit.framework.Assert.fail(Assert.java:47)&lt;br/&gt;
	at junit.framework.Assert.failNotEquals(Assert.java:277)&lt;br/&gt;
	at junit.framework.Assert.assertEquals(Assert.java:64)&lt;br/&gt;
	at kafka.admin.AdminTest.testPartitionReassignmentWithLeaderInNewReplicas(AdminTest.scala:232)&lt;/p&gt;

</comment>
                            <comment id="13595066" author="swapnilghike" created="Wed, 6 Mar 2013 20:24:41 +0000"  >&lt;p&gt;Patch v3:&lt;/p&gt;

&lt;p&gt;1. Ok, not asking the user to provide version in both the tools.&lt;/p&gt;

&lt;p&gt;2. Seems like this was a transient failure. I ran it multiple times on my machine, it passed. We can take a look at it if it fails more often than not. &lt;/p&gt;</comment>
                            <comment id="13595108" author="junrao" created="Wed, 6 Mar 2013 20:55:31 +0000"  >&lt;p&gt;Thanks for patch v3. Committed to 0.8.&lt;/p&gt;</comment>
                            <comment id="13597913" author="swapnilghike" created="Sat, 9 Mar 2013 12:48:15 +0000"  >&lt;p&gt;Jay had a great suggestion about combining Json encoding utils into one single util. He has already checked in the code to trunk at &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-554&quot; title=&quot;Move all per-topic configuration into ZK and add to the CreateTopicCommand&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-554&quot;&gt;&lt;del&gt;KAFKA-554&lt;/del&gt;&lt;/a&gt;. So, perhaps we should make the related refactoring in trunk. I would be happy to do it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12571841" name="kafka-779-v1.patch" size="18366" author="swapnilghike" created="Mon, 4 Mar 2013 04:27:26 +0000"/>
                            <attachment id="12571963" name="kafka-779-v2.patch" size="19755" author="swapnilghike" created="Mon, 4 Mar 2013 21:54:15 +0000"/>
                            <attachment id="12572385" name="kafka-779-v3.patch" size="19719" author="swapnilghike" created="Wed, 6 Mar 2013 20:24:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>315434</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 37 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ifjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>315778</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>