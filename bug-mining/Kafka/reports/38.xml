<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:34:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-204] BoundedByteBufferReceive hides OutOfMemoryError</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-204</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;  private def byteBufferAllocate(size: Int): ByteBuffer = {&lt;br/&gt;
    var buffer: ByteBuffer = null&lt;br/&gt;
    try &lt;/p&gt;
{
      buffer = ByteBuffer.allocate(size)
    }
&lt;p&gt;    catch &lt;/p&gt;
{
      case e: OutOfMemoryError =&amp;gt;
        throw new RuntimeException(&quot;OOME with size &quot; + size, e)
      case e2 =&amp;gt;
        throw e2
    }
&lt;p&gt;    buffer&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;This hides the fact that an Error occurred, and will likely result in some log handler printing a message, instead of exiting with non-zero status.  Knowing how large the allocation was that caused an OOM is really nice, so I&apos;d suggest logging in byteBufferAllocate and then re-throwing OutOfMemoryError&lt;/p&gt;</description>
                <environment></environment>
        <key id="12531486">KAFKA-204</key>
            <summary>BoundedByteBufferReceive hides OutOfMemoryError</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cburroughs">Chris Burroughs</assignee>
                                    <reporter username="cburroughs">Chris Burroughs</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Nov 2011 16:31:36 +0000</created>
                <updated>Wed, 23 Nov 2011 23:46:49 +0000</updated>
                            <resolved>Wed, 23 Nov 2011 23:46:49 +0000</resolved>
                                    <version>0.7</version>
                                    <fixVersion>0.7.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13150590" author="jkreps" created="Tue, 15 Nov 2011 16:37:17 +0000"  >&lt;p&gt;Uh...does anyone know what the motivation of this was originally? Catching OutOfMemoryError is a bit unorthodox...&lt;/p&gt;</comment>
                            <comment id="13150612" author="tgautier" created="Tue, 15 Nov 2011 17:13:13 +0000"  >&lt;p&gt;Agree with Jay - if you get an OOME all bets are off.  Best to just exit.&lt;/p&gt;</comment>
                            <comment id="13151220" author="cburroughs" created="Wed, 16 Nov 2011 14:16:29 +0000"  >&lt;p&gt;Tiny patch for this one case, created &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-205&quot; title=&quot;Audit swallowing of exceptions/throwables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-205&quot;&gt;&lt;del&gt;KAFKA-205&lt;/del&gt;&lt;/a&gt; to follow up.&lt;/p&gt;</comment>
                            <comment id="13151297" author="junrao" created="Wed, 16 Nov 2011 16:22:46 +0000"  >&lt;p&gt;The main reason this was added is to show the requested size and the caller that triggered such a request. It would be nice if both pieces are logged together. With the new patch, those two pieces are logged separately (although should be close) and someone has to link them together manually.&lt;/p&gt;</comment>
                            <comment id="13151300" author="junrao" created="Wed, 16 Nov 2011 16:24:17 +0000"  >&lt;p&gt;Another possibility is to rethrow a new RuntimeException with OOME wrapped as the cause.&lt;/p&gt;</comment>
                            <comment id="13153485" author="erikvanoosten" created="Sat, 19 Nov 2011 13:23:42 +0000"  >&lt;p&gt;If you rethrow, then rethrow a new OOME with the original OOME wrapped.&lt;/p&gt;</comment>
                            <comment id="13153919" author="junrao" created="Mon, 21 Nov 2011 00:16:00 +0000"  >&lt;p&gt;Hmm, it doesn&apos;t look like OutOfMemoryError allow one to specify a cause during initialization.&lt;/p&gt;</comment>
                            <comment id="13155739" author="jkreps" created="Wed, 23 Nov 2011 07:51:33 +0000"  >&lt;p&gt;I understand the intent, but the important thing here is not to swallow the OOM exception, right? I mean once you hit that all bets are off, you need to restart your process...basically I think we shouldn&apos;t be messing with that.&lt;/p&gt;</comment>
                            <comment id="13155740" author="jkreps" created="Wed, 23 Nov 2011 07:52:54 +0000"  >&lt;p&gt;We have request limits in the server and consumer that should provide protection against this so i think that is the appropriate way to handle it. If it does happen I think we should just break everything and then the person running things should set the configs correctly to limit the max request size the server will accept and the max fetch size for the client.&lt;/p&gt;</comment>
                            <comment id="13155857" author="cburroughs" created="Wed, 23 Nov 2011 13:18:02 +0000"  >&lt;p&gt;&amp;gt; I mean once you hit that all bets are off, you need to restart your process...basically I think we shouldn&apos;t be messing with that. &lt;/p&gt;

&lt;p&gt;Yeah, the most important thing to do is get out of the way and let the process exit with a non-zero status code.&lt;/p&gt;

&lt;p&gt;So the options as I see it are:&lt;br/&gt;
 (1) Do something ugly (like pass the original fetch request to byteBufferAllocate) for the purposes of a valiant but possible futile logging attempt (there is no guarantee we will be able to allocate the logging Strings we are already asking for, everything we ad makes that less likely).&lt;br/&gt;
 (2)  Just rethrow e after a logging attempt in byteBufferAllocate.&lt;/p&gt;

&lt;p&gt;My preference is (2), but if someone prefers (1) that&apos;s a reasonable trade off.&lt;/p&gt;</comment>
                            <comment id="13156061" author="junrao" created="Wed, 23 Nov 2011 18:47:08 +0000"  >&lt;p&gt;Ok, I am fine with the patch then. Any objection to commit it?&lt;/p&gt;</comment>
                            <comment id="13156065" author="nehanarkhede" created="Wed, 23 Nov 2011 18:50:41 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13156413" author="junrao" created="Wed, 23 Nov 2011 23:46:49 +0000"  >&lt;p&gt;Just committed this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12503888" name="k204-v1.txt" size="735" author="cburroughs" created="Wed, 16 Nov 2011 14:12:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>217222</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l4g7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>121371</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>