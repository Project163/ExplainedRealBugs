<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:04:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5829] Speedup broker startup after unclean shutdown by reducing unnecessary snapshot files deletion</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5829</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The current Kafka implementation will cause slow startup after unclean shutdown. The time to load a partition will be 10X or more than what it actually needs. Here is the explanation with example:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Say we have a partition of 20 segments, each segment has 250 message starting with offset 0. And each message has 1 MB bytes.&lt;/li&gt;
	&lt;li&gt;Broker experiences hard kill and the index file of the first segment is corrupted.&lt;/li&gt;
	&lt;li&gt;When broker startup and load the first segment, it realizes that the index of the first segment is corrupted. So it calls `log.recoverSegment(...)` to recover this segment. This method will call `stateManager.truncateAndReload(...)` which deletes the snapshot files whose offset is larger than base offset of the first segment. Thus all snapshot files are deleted.&lt;/li&gt;
	&lt;li&gt;To rebuild the snapshot files, the `log.loadSegmentFiles(...)` will have to read every message in this partition even if their log and index files are not corrupted. This will increase the time to load this partition by more than an order of magnitude.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In order to address this issue, one simple solution is not to delete snapshot files that are than the given offset if only the index files needs re-build. More specifically, we should not need to re-build producer state offset file unless the log file itself is corrupted or truncated.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13099561">KAFKA-5829</key>
            <summary>Speedup broker startup after unclean shutdown by reducing unnecessary snapshot files deletion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ijuma">Ismael Juma</assignee>
                                    <reporter username="lindong">Dong Lin</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Sep 2017 08:46:00 +0000</created>
                <updated>Wed, 18 Oct 2017 02:08:48 +0000</updated>
                            <resolved>Fri, 6 Oct 2017 23:56:40 +0000</resolved>
                                                    <fixVersion>1.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16152275" author="githubbot" created="Mon, 4 Sep 2017 08:48:07 +0000"  >&lt;p&gt;GitHub user lindong28 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3782&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5829&quot; title=&quot;Speedup broker startup after unclean shutdown by reducing unnecessary snapshot files deletion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5829&quot;&gt;&lt;del&gt;KAFKA-5829&lt;/del&gt;&lt;/a&gt;; Speedup broker startup after unclean shutdown by reducing unnecessary snapshot files deletion&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/lindong28/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/lindong28/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5829&quot; title=&quot;Speedup broker startup after unclean shutdown by reducing unnecessary snapshot files deletion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5829&quot;&gt;&lt;del&gt;KAFKA-5829&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3782.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3782.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3782&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b7f08944d9f7053489498636f64762728a9b50d6&lt;br/&gt;
Author: Dong Lin &amp;lt;lindong28@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-09-04T08:26:23Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5829&quot; title=&quot;Speedup broker startup after unclean shutdown by reducing unnecessary snapshot files deletion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5829&quot;&gt;&lt;del&gt;KAFKA-5829&lt;/del&gt;&lt;/a&gt;; Speedup broker startup after unclean shutdown by reducing unnecessary snapshot files deletion&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16192124" author="guozhang" created="Wed, 4 Oct 2017 22:04:17 +0000"  >&lt;p&gt;Updates on the reviewing progress &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16192906" author="githubbot" created="Thu, 5 Oct 2017 13:58:09 +0000"  >&lt;p&gt;GitHub user ijuma opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4023&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4023&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5829&quot; title=&quot;Speedup broker startup after unclean shutdown by reducing unnecessary snapshot files deletion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5829&quot;&gt;&lt;del&gt;KAFKA-5829&lt;/del&gt;&lt;/a&gt;: Only delete producer snapshots before the recovery point&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ijuma/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ijuma/kafka&lt;/a&gt; kafka-5829-avoid-reading-older-segments-on-hard-shutdown&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4023.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4023.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4023&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2a98d68a85f97507423cc50cd002e2db27a47c60&lt;br/&gt;
Author: Ismael Juma &amp;lt;ismael@juma.me.uk&amp;gt;&lt;br/&gt;
Date:   2017-10-05T13:26:04Z&lt;/p&gt;

&lt;p&gt;    Several clean ups in Log, LogManager, etc.&lt;/p&gt;

&lt;p&gt;commit 291c73e54b808d0c0af57c08107c3c8f357e8188&lt;br/&gt;
Author: Ismael Juma &amp;lt;ismael@juma.me.uk&amp;gt;&lt;br/&gt;
Date:   2017-10-05T13:57:07Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5829&quot; title=&quot;Speedup broker startup after unclean shutdown by reducing unnecessary snapshot files deletion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5829&quot;&gt;&lt;del&gt;KAFKA-5829&lt;/del&gt;&lt;/a&gt;: Only delete producer snapshots before the recovery point&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16195240" author="ijuma" created="Fri, 6 Oct 2017 21:01:06 +0000"  >&lt;p&gt;I have submitted an alternative PR that also includes a number of additional tests. The additional tests uncovered an issue that I&apos;m still investigating.&lt;/p&gt;</comment>
                            <comment id="16195302" author="guozhang" created="Fri, 6 Oct 2017 21:59:53 +0000"  >&lt;p&gt;Thanks for the update Ismael, please let me know if you feel it cannot be done by EOD.&lt;/p&gt;</comment>
                            <comment id="16195447" author="githubbot" created="Fri, 6 Oct 2017 23:50:02 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4023&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4023&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16195451" author="hachikuji" created="Fri, 6 Oct 2017 23:56:40 +0000"  >&lt;p&gt;Issue resolved by pull request 4023&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/4023&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4023&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16196079" author="githubbot" created="Sun, 8 Oct 2017 11:57:42 +0000"  >&lt;p&gt;GitHub user ijuma opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4040&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4040&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5829&quot; title=&quot;Speedup broker startup after unclean shutdown by reducing unnecessary snapshot files deletion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5829&quot;&gt;&lt;del&gt;KAFKA-5829&lt;/del&gt;&lt;/a&gt;; Remove stray `printStackTrace()` in test&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ijuma/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ijuma/kafka&lt;/a&gt; kafka-5829-follow-up&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4040.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4040.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4040&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c82c2050127b6d1d53a05f7ad73b77a58b0af01e&lt;br/&gt;
Author: Ismael Juma &amp;lt;ismael@juma.me.uk&amp;gt;&lt;br/&gt;
Date:   2017-10-08T11:56:42Z&lt;/p&gt;

&lt;p&gt;    Remove stray `printStackTrace()` in test&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16208715" author="githubbot" created="Wed, 18 Oct 2017 02:08:48 +0000"  >&lt;p&gt;Github user lindong28 closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3782&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 4 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3jlxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>hachikuji</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>