<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:28:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-13002] listOffsets must downgrade immediately for non MAX_TIMESTAMP specs</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-13002</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Note: this is not a report against a released version of AK. It seems to be a problem on the trunk development branch only.&lt;/p&gt;

&lt;p&gt;After deploying our soak test against `trunk/HEAD` on Friday, I noticed that Streams is no longer processing:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13027362/13027362_soaks.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I found this stacktrace in the logs during startup:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
5075 [2021-06-25T16:50:44-05:00] (streams-soak-trunk-ccloud-alos_soak_i-0691913411e8c77c3_streamslog) [2021-06-25 21:50:44,499] WARN [i-0691913411e8c77c3-StreamThread-1] The listOffsets request failed. (org.apache.kafka.streams.processor.internals.ClientUtils)
 5076 [2021-06-25T16:50:44-05:00] (streams-soak-trunk-ccloud-alos_soak_i-0691913411e8c77c3_streamslog) java.util.concurrent.ExecutionException: org.apache.kafka.common.errors.UnsupportedVersionException: The broker does not support LIST_OFFSETS with version in range [7,7].       The supported range is [0,6].
 5077         at org.apache.kafka.common.internals.KafkaFutureImpl.wrapAndThrow(KafkaFutureImpl.java:45)
 5078         at org.apache.kafka.common.internals.KafkaFutureImpl.access$000(KafkaFutureImpl.java:32)
 5079         at org.apache.kafka.common.internals.KafkaFutureImpl$SingleWaiter.await(KafkaFutureImpl.java:89)
 5080         at org.apache.kafka.common.internals.KafkaFutureImpl.get(KafkaFutureImpl.java:260)
 5081         at org.apache.kafka.streams.processor.internals.ClientUtils.getEndOffsets(ClientUtils.java:147)
 5082         at org.apache.kafka.streams.processor.internals.StreamsPartitionAssignor.populateClientStatesMap(StreamsPartitionAssignor.java:643)
 5083         at org.apache.kafka.streams.processor.internals.StreamsPartitionAssignor.assignTasksToClients(StreamsPartitionAssignor.java:579)
 5084         at org.apache.kafka.streams.processor.internals.StreamsPartitionAssignor.assign(StreamsPartitionAssignor.java:387)
 5085         at org.apache.kafka.clients.consumer.internals.ConsumerCoordinator.performAssignment(ConsumerCoordinator.java:589)
 5086         at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.onJoinLeader(AbstractCoordinator.java:689)
 5087         at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.access$1000(AbstractCoordinator.java:111)
 5088         at org.apache.kafka.clients.consumer.internals.AbstractCoordinator$JoinGroupResponseHandler.handle(AbstractCoordinator.java:593)
 5089         at org.apache.kafka.clients.consumer.internals.AbstractCoordinator$JoinGroupResponseHandler.handle(AbstractCoordinator.java:556)
 5090         at org.apache.kafka.clients.consumer.internals.AbstractCoordinator$CoordinatorResponseHandler.onSuccess(AbstractCoordinator.java:1178)
 5091         at org.apache.kafka.clients.consumer.internals.AbstractCoordinator$CoordinatorResponseHandler.onSuccess(AbstractCoordinator.java:1153)
 5092         at org.apache.kafka.clients.consumer.internals.RequestFuture$1.onSuccess(RequestFuture.java:206)
 5093         at org.apache.kafka.clients.consumer.internals.RequestFuture.fireSuccess(RequestFuture.java:169)
 5094         at org.apache.kafka.clients.consumer.internals.RequestFuture.complete(RequestFuture.java:129)
 5095         at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient$RequestFutureCompletionHandler.fireCompletion(ConsumerNetworkClient.java:602)
 5096         at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.firePendingCompletedRequests(ConsumerNetworkClient.java:412)
 5097         at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.poll(ConsumerNetworkClient.java:297)
 5098         at org.apache.kafka.clients.consumer.internals.ConsumerNetworkClient.poll(ConsumerNetworkClient.java:236)
 5099         at org.apache.kafka.clients.consumer.KafkaConsumer.pollForFetches(KafkaConsumer.java:1297)
 5100         at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:1238)
 5101         at org.apache.kafka.clients.consumer.KafkaConsumer.poll(KafkaConsumer.java:1211)
 5102         at org.apache.kafka.streams.processor.internals.StreamThread.pollRequests(StreamThread.java:932)
 5103         at org.apache.kafka.streams.processor.internals.StreamThread.pollPhase(StreamThread.java:885)
 5104         at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:720)
 5105         at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:583)
 5106         at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:555) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Just eyeballing the recent commits, I&apos;m guessing it was due to &lt;a href=&quot;https://github.com/apache/kafka/commit/bd72ef1bf1e40feb3bc17349a385b479fa5fa530&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/commit/bd72ef1bf1e40feb3bc17349a385b479fa5fa530&lt;/a&gt; . It looks like that code sets the initial &quot;minimum version&quot; to 7, but then should back off into compatibility mode. Therefore, maybe that stacktrace is expected (though it&apos;s not great UX regardless).&lt;/p&gt;

&lt;p&gt;However, it does not seem like Streams is actually able to back off. The next thing I see is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2021-06-25T16:50:44-05:00] (streams-soak-trunk-ccloud-alos_soak_i-0691913411e8c77c3_streamslog) [2021-06-25 21:50:44,507] WARN [i-0691913411e8c77c3-StreamThread-1] Task 3_2 had endOffsetSum=-3 smaller than offsetSum=0 on member 24e46b47-0a01-4b57-9d15-771482869097. This probably means the task is corrupted, which in turn indicates that it will need to restore from scratch &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it gets assigned. The assignor will de-prioritize returning &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; task to &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; member in the hopes that some other member may be able to re-use its state. (org.apache.kafka.streams.processor.internals.assignment.ClientState) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Which is itself a problem. It looks like there&apos;s a sentinel &quot;-3&quot; value returned as the end offset, but since that value is lower than any real endOffset Streams will have book-kept, Streams will assume that all its local state is corrupt. The result is that Streams will delete all its local state and rebuild from the changelog. This isn&apos;t an ideal behavior on restart.&lt;/p&gt;

&lt;p&gt;Finally, I never actually see Streams able to proceed with processing. The only thing it logs after this point (as far as I can tell) is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2021-06-25T16:50:54-05:00] (streams-soak-trunk-ccloud-alos_soak_i-0691913411e8c77c3_streamslog) [2021-06-25 21:50:52,463] INFO [i-0691913411e8c77c3-StreamThread-1] stream-thread [i-0691913411e8c77c3-StreamThread-1] End offset &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; changelog stream-soak-test-trunk-ccloud-alos--KSTREAM-AGGREGATE-STATE-STORE-0000000013-changelog-0 cannot be found; will retry in the next time. (org.apache.kafka.streams.processor.internals.StoreChangelogReader) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So, it seems the version backoff simply isn&apos;t working.&lt;/p&gt;

&lt;p&gt;Obviously, we&apos;ll need to fix these problems before we can release 3.0&lt;/p&gt;</description>
                <environment></environment>
        <key id="13386279">KAFKA-13002</key>
            <summary>listOffsets must downgrade immediately for non MAX_TIMESTAMP specs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tom@confluent.io">Tom Scott</assignee>
                                    <reporter username="vvcephei">John Roesler</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Jun 2021 14:20:56 +0000</created>
                <updated>Thu, 1 Jul 2021 12:42:36 +0000</updated>
                            <resolved>Thu, 1 Jul 2021 06:36:40 +0000</resolved>
                                                    <fixVersion>3.0.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17370618" author="ijuma" created="Mon, 28 Jun 2021 14:26:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vvcephei&quot; class=&quot;user-hover&quot; rel=&quot;vvcephei&quot;&gt;vvcephei&lt;/a&gt;&#160;If you are using the admin client, it seems that this is an admin client regression. I mentioned this ticket in the original PR.&lt;/p&gt;</comment>
                            <comment id="17370653" author="tom@confluent.io" created="Mon, 28 Jun 2021 15:10:21 +0000"  >&lt;p&gt;I think I&apos;ve determined the problem, I&apos;ll get a PR together ASAP&lt;/p&gt;</comment>
                            <comment id="17372426" author="dajac" created="Thu, 1 Jul 2021 06:37:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vvcephei&quot; class=&quot;user-hover&quot; rel=&quot;vvcephei&quot;&gt;vvcephei&lt;/a&gt; We have fixed the regression. Could you retry in your environment? Sorry for the regression.&lt;/p&gt;</comment>
                            <comment id="17372615" author="cadonna" created="Thu, 1 Jul 2021 10:25:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dajac&quot; class=&quot;user-hover&quot; rel=&quot;dajac&quot;&gt;dajac&lt;/a&gt; I deployed the soak cluster that showed the issue from trunk. Until now it looks good. We also run into the same issue with our benchmarks. I also started them to see if everything is OK. We also saw the issue in the Streams system tests &lt;tt&gt;kafkatest.tests.streams.streams_broker_compatibility_test&lt;/tt&gt;.  &lt;/p&gt;</comment>
                            <comment id="17372621" author="dajac" created="Thu, 1 Jul 2021 10:42:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cadonna&quot; class=&quot;user-hover&quot; rel=&quot;cadonna&quot;&gt;cadonna&lt;/a&gt; Sounds good, thanks.&lt;/p&gt;</comment>
                            <comment id="17372639" author="cadonna" created="Thu, 1 Jul 2021 11:03:45 +0000"  >&lt;p&gt;The soak cluster still looks good and the benchmarks completed successfully their first run. I guess the fix is fine.&lt;/p&gt;</comment>
                            <comment id="17372740" author="dajac" created="Thu, 1 Jul 2021 12:42:36 +0000"  >&lt;p&gt;Awesome, thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13367218">KAFKA-12541</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13027362" name="soaks.png" size="50407" author="vvcephei" created="Mon, 28 Jun 2021 14:12:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 19 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0sdew:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>dajac</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>