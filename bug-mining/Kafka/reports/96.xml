<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:35:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-540] log.append() should halt on IOException</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-540</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;See the following entry in the broker log in a system test run. We interrupted the ReplicaFetcherThread during shutdown. However, log.append halts the system when we hit the interrupted exception. The fix is not to halt the system in log.append and just pass on the exception. The caller can decide what to do.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-10-03 15:08:53,124&amp;#93;&lt;/span&gt; FATAL &lt;span class=&quot;error&quot;&gt;&amp;#91;Kafka Log on Broker 2&amp;#93;&lt;/span&gt;, Halting due to unrecoverable I/O error while handling producer request (kafka.log.Log)&lt;br/&gt;
java.nio.channels.ClosedByInterruptException&lt;br/&gt;
        at java.nio.channels.spi.AbstractInterruptibleChannel.end(AbstractInterruptibleChannel.java:184)&lt;br/&gt;
        at sun.nio.ch.FileChannelImpl.write(FileChannelImpl.java:203)&lt;br/&gt;
        at kafka.message.ByteBufferMessageSet.writeTo(ByteBufferMessageSet.scala:128)&lt;br/&gt;
        at kafka.log.FileMessageSet.append(FileMessageSet.scala:155)&lt;br/&gt;
        at kafka.log.LogSegment.append(LogSegment.scala:60)&lt;br/&gt;
        at kafka.log.Log.liftedTree1$1(Log.scala:282)&lt;br/&gt;
        at kafka.log.Log.append(Log.scala:270)&lt;br/&gt;
        at kafka.server.ReplicaFetcherThread.processPartitionData(ReplicaFetcherThread.scala:42)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread$$anonfun$doWork$5.apply(AbstractFetcherThread.scala:105)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread$$anonfun$doWork$5.apply(AbstractFetcherThread.scala:98)&lt;br/&gt;
        at scala.collection.immutable.Map$Map1.foreach(Map.scala:105)&lt;br/&gt;
        at kafka.server.AbstractFetcherThread.doWork(AbstractFetcherThread.scala:98)&lt;br/&gt;
        at kafka.utils.ShutdownableThread.run(ShutdownableThread.scala:50)&lt;br/&gt;
(&lt;/p&gt;</description>
                <environment></environment>
        <key id="12610152">KAFKA-540</key>
            <summary>log.append() should halt on IOException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="junrao">Jun Rao</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                            <label>bugs</label>
                    </labels>
                <created>Wed, 3 Oct 2012 22:34:07 +0000</created>
                <updated>Thu, 4 Oct 2012 03:47:44 +0000</updated>
                            <resolved>Thu, 4 Oct 2012 03:47:36 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="13468983" author="junrao" created="Wed, 3 Oct 2012 23:39:30 +0000"  >&lt;p&gt;Attach a patch to fix the issue.&lt;/p&gt;</comment>
                            <comment id="13469012" author="jkreps" created="Thu, 4 Oct 2012 00:12:04 +0000"  >&lt;p&gt;This is a good change--calling exit in the lower level code is kind of ugly so it is nice to fix that. Two comments:&lt;br/&gt;
1. Can we name the exception something more meaningful. The problem with IOException is that it covers pretty much everything under the sun, so KafkaIOException isn&apos;t much better. I think specifically the error we are calling out is some kind of disk access error so how about DiskAccessException?&lt;br/&gt;
2. Note that System.exit is not the same as Runtime.halt()--which does scala&apos;s exit do? Is there a reason it called halt() before? Using exit() means the shutdown handlers will run. In general this is good, but we need to make sure  may or may not be what we don&apos;t write out the clean shutdown file, since that would skip recovery on the restart.&lt;/p&gt;</comment>
                            <comment id="13469055" author="junrao" created="Thu, 4 Oct 2012 01:16:53 +0000"  >&lt;p&gt;Attach patch v2.&lt;/p&gt;

&lt;p&gt;1. changed to KafkaStorageException.&lt;/p&gt;

&lt;p&gt;2. I think we should call halt on real IO exception. This will make sure that kafkaserver.shutdown is not called and will force us to do log recovery on restart, which is the right thing to do. Not sure what scala exit does, but it&apos;s being deprecated anyway. &lt;/p&gt;

&lt;p&gt;Also, removed calling exit in handleOffsetRequest. It feels weird to shut down a server on a read only operation.&lt;/p&gt;</comment>
                            <comment id="13469068" author="jkreps" created="Thu, 4 Oct 2012 01:39:09 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13469125" author="junrao" created="Thu, 4 Oct 2012 03:47:36 +0000"  >&lt;p&gt;Thanks for the review. Committed 0.8.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12547630" name="kafka-540.patch" size="3342" author="junrao" created="Wed, 3 Oct 2012 23:39:30 +0000"/>
                            <attachment id="12547653" name="kafka-540_v2.patch" size="4462" author="junrao" created="Thu, 4 Oct 2012 01:16:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>240606</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i013v3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4395</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>