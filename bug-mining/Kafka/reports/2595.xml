<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:23:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3720] Remove BufferExhaustedException from doSend() in KafkaProducer</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3720</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;KafkaProducer no longer throws BufferExhaustException. We should remove it from the catch clause. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12970579">KAFKA-3720</key>
            <summary>Remove BufferExhaustedException from doSend() in KafkaProducer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sliebau">S&#246;nke Liebau</assignee>
                                    <reporter username="mgharat">Mayuresh Gharat</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 May 2016 23:49:53 +0000</created>
                <updated>Thu, 20 Aug 2020 15:45:05 +0000</updated>
                            <resolved>Fri, 10 Apr 2020 23:50:10 +0000</resolved>
                                    <version>2.4.1</version>
                                    <fixVersion>2.6.0</fixVersion>
                                    <component>producer </component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15287937" author="ijuma" created="Wed, 18 May 2016 00:07:09 +0000"  >&lt;p&gt;And probably deprecate `BufferExhaustedException` since it&apos;s not used by anything.&lt;/p&gt;</comment>
                            <comment id="15293959" author="githubbot" created="Fri, 20 May 2016 18:49:33 +0000"  >&lt;p&gt;GitHub user MayureshGharat opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1417&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1417&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3720&quot; title=&quot;Remove BufferExhaustedException from doSend() in KafkaProducer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3720&quot;&gt;&lt;del&gt;KAFKA-3720&lt;/del&gt;&lt;/a&gt; : Deprecated BufferExhaustedException and also removed its use and the related sensor metric&lt;/p&gt;

&lt;p&gt;    BufferExhaustedException is no longer used and should be deprecated and the corresponding metrics should be removed.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/MayureshGharat/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/MayureshGharat/kafka&lt;/a&gt; kafka-3720&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1417.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1417.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1417&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c5b726da480abe4a9e9d8d249c09730f9bb7ea78&lt;br/&gt;
Author: MayureshGharat &amp;lt;gharatmayuresh15@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-05-20T18:44:31Z&lt;/p&gt;

&lt;p&gt;    Deprecated BufferExhaustedException and also removed its use and the related sensor metric&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="17070051" author="sliebau" created="Sat, 28 Mar 2020 21:51:24 +0000"  >&lt;p&gt;Is anybody still working on this?&lt;/p&gt;</comment>
                            <comment id="17071749" author="sliebau" created="Tue, 31 Mar 2020 12:48:00 +0000"  >&lt;p&gt;I read through the comments on the PR and would like to briefly summarize the current state here and propose a solution.&lt;/p&gt;

&lt;p&gt;The current implementation throws a TimeoutException when no memory can be allocated for a record within max.block.ms - this exception is caught in the producer and returned from .send() in the Future object.&lt;/p&gt;

&lt;p&gt;The metric &lt;em&gt;buffer-exhausted-records&lt;/em&gt; is currently unused.&lt;/p&gt;

&lt;p&gt;A TimeoutException within .send() in the Producer can also be triggered by a failure to update Metadata, so is not a sufficient condition to update this metric. For that reason, the suggestion is to revive the BufferExhaustedException, which is currently unused.  We could make this exception extend TimeoutException so that existing code that listens for that exception continues to work and throw it instead of TimeoutException in BufferPool. This exception can then be caught in the Producer and used to trigger that metric.&lt;/p&gt;


&lt;p&gt;An open question is whether this exception should be re-thrown in the producer, or returned in the Future. As this exception would be thrown in code that runs within max.block.ms a case could be made that this is still the synchroneous part of the send process and the exception should be thrown.&lt;/p&gt;

&lt;p&gt;However, as the current implementation is to return the exception in the Future, I do not think we should change this without advance notice, as it has the potential to break user code.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgharat&quot; class=&quot;user-hover&quot; rel=&quot;mgharat&quot;&gt;mgharat&lt;/a&gt; are you still willing to look at this? If not, I am happy to rebase the PR and re-create a new one..&lt;/p&gt;</comment>
                            <comment id="17072089" author="mgharat" created="Tue, 31 Mar 2020 19:03:00 +0000"  >&lt;p&gt;You can take this up.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Mayuresh&lt;/p&gt;




&lt;p&gt;&amp;#8211; &lt;br/&gt;
-Regards,&lt;br/&gt;
Mayuresh R. Gharat&lt;br/&gt;
(862) 250-7125&lt;/p&gt;</comment>
                            <comment id="17072225" author="githubbot" created="Tue, 31 Mar 2020 22:53:37 +0000"  >&lt;p&gt;soenkeliebau commented on pull request #8399: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3720&quot; title=&quot;Remove BufferExhaustedException from doSend() in KafkaProducer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3720&quot;&gt;&lt;del&gt;KAFKA-3720&lt;/del&gt;&lt;/a&gt;: Change TimeoutException to BufferExhaustedException when no memory can be allocated for a record within max.block.ms&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8399&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8399&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Change TimeoutException to BufferExhaustedException when no memory can be allocated for a record within max.block.ms&lt;/p&gt;

&lt;p&gt;   Refactored BufferExhaustedException to be a subclass of TimeoutException so existing code that catches TimeoutExceptions keeps working.&lt;/p&gt;

&lt;p&gt;   Added handling to count these Exceptions in the metric &quot;buffer-exhausted-records&quot;.&lt;/p&gt;

&lt;p&gt;   Test Strategy&lt;br/&gt;
   There were existing test cases to check this behavior, which I refactored. &lt;br/&gt;
   I then added an extra case to check whether the expected Exception is actually thrown, which was not covered by current tests.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17072230" author="sliebau" created="Tue, 31 Mar 2020 23:06:44 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgharat&quot; class=&quot;user-hover&quot; rel=&quot;mgharat&quot;&gt;mgharat&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve created a new pull request based on what I figured is the latest consensus from earlier discussions.&lt;/p&gt;</comment>
                            <comment id="17081045" author="githubbot" created="Fri, 10 Apr 2020 23:48:34 +0000"  >&lt;p&gt;junrao commented on pull request #8399: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3720&quot; title=&quot;Remove BufferExhaustedException from doSend() in KafkaProducer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3720&quot;&gt;&lt;del&gt;KAFKA-3720&lt;/del&gt;&lt;/a&gt;: Change TimeoutException to BufferExhaustedException when no memory can be allocated for a record within max.block.ms&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8399&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8399&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17081047" author="junrao" created="Fri, 10 Apr 2020 23:50:10 +0000"  >&lt;p&gt;merged the PR to trunk.&lt;/p&gt;</comment>
                            <comment id="17155279" author="greyfairer" created="Fri, 10 Jul 2020 09:04:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sliebau&quot; class=&quot;user-hover&quot; rel=&quot;sliebau&quot;&gt;sliebau&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgharat&quot; class=&quot;user-hover&quot; rel=&quot;mgharat&quot;&gt;mgharat&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;&lt;cite&gt;An open question is whether this exception should be re-thrown in the producer, or returned in the Future. As this exception would be thrown in code that runs within max.block.ms a case could be made that this is still the synchroneous part of the send process and the exception should be thrown.&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;&lt;cite&gt;However, as the current implementation is to return the exception in the Future, I do not think we should change this without advance notice, as it has the potential to break user code.&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I checked this with Kafka 2.2.1, by setting the buffer size to 64kB and the max.block.ms to 10ms, and found that the exception is actually thrown from the producer.send() method, not in the callback. The future is not even returned. I do see that in the existing tests for 2.6, it&apos;s assumed the exception is thrown in the future.&lt;/p&gt;

&lt;p&gt;I think the current behaviour in 2.2.1 is more useful. Even if you ignore the returned future, senders will still receive back-pressure so they will not continue to try to send messages when the buffer is full anyway. And it makes sense to receive a timeout exception on the same call if that back-pressure goes over the max.block.ms limit. Checking the returned future should only be necessary if you want to wait until the message is effectively sent.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13291419">KAFKA-9713</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2y453:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>