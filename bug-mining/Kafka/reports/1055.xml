<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:54:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3112] One incorrect bootstrap server will prevent Kafka producer from opening</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3112</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;If any of the servers specified in bootstrap.servers are not resolvable through DNS the configuration is taken as an error, and the client won&apos;t start up. We pass in 30 possible servers, and one had an issue so the client wouldn&apos;t start. &lt;/p&gt;

&lt;p&gt;It would be better if the client will attempt to start if there is at least one server available from DNS.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12931710">KAFKA-3112</key>
            <summary>One incorrect bootstrap server will prevent Kafka producer from opening</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bondj">Jonathan Bond</assignee>
                                    <reporter username="bondj">Jonathan Bond</reporter>
                        <labels>
                    </labels>
                <created>Sat, 16 Jan 2016 21:39:46 +0000</created>
                <updated>Sat, 7 May 2016 08:10:21 +0000</updated>
                            <resolved>Sat, 7 May 2016 08:10:21 +0000</resolved>
                                    <version>0.8.2.1</version>
                                    <fixVersion>0.10.0.0</fixVersion>
                                    <component>clients</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15103456" author="bondj" created="Sat, 16 Jan 2016 21:47:04 +0000"  >&lt;p&gt;diff --git a/clients/src/main/java/org/apache/kafka/clients/producer/internals/BufferPoolTest.java b/clients/src/main/java/org/apache/kafka/clients/producer/internals/BufferPoolTest.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 0000000..a32ff87&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/clients/src/main/java/org/apache/kafka/clients/producer/internals/BufferPoolTest.java&lt;br/&gt;
@@ -0,0 +1,188 @@&lt;br/&gt;
+/**&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.kafka.clients.producer.internals;&lt;br/&gt;
+&lt;br/&gt;
+import java.nio.ByteBuffer;&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collections;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.concurrent.CountDownLatch;&lt;br/&gt;
+import java.util.concurrent.LinkedBlockingQueue;&lt;br/&gt;
+import java.util.concurrent.Semaphore;&lt;br/&gt;
+import java.util.concurrent.TimeUnit;&lt;br/&gt;
+import java.util.concurrent.atomic.AtomicLong;&lt;br/&gt;
+import java.util.concurrent.locks.ReentrantLock;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.kafka.clients.producer.BufferExhaustedException;&lt;br/&gt;
+import org.apache.kafka.common.metrics.Metrics;&lt;br/&gt;
+import org.apache.kafka.common.utils.SystemTime;&lt;br/&gt;
+&lt;br/&gt;
+public class BufferPoolTest {&lt;br/&gt;
+&lt;br/&gt;
+    public static void main(String[] args) throws InterruptedException {&lt;br/&gt;
+&lt;br/&gt;
+        final BufferPool bp = new BufferPool(16 * 1024 * 1024, 16384, false, new Metrics(), new SystemTime(),&lt;br/&gt;
+                &quot;metricGroupName&quot;, Collections.emptyMap());&lt;br/&gt;
+        final AtomicLong allocated = new AtomicLong(0);&lt;br/&gt;
+        final AtomicLong bufferFull = new AtomicLong(0);&lt;br/&gt;
+        final long numberOfMessages = 1000000000;&lt;br/&gt;
+        final AtomicLong messages = new AtomicLong(numberOfMessages);&lt;br/&gt;
+        final int threadCount = 16;&lt;br/&gt;
+        final CountDownLatch latch = new CountDownLatch(threadCount + 1);&lt;br/&gt;
+        final Object lock = new Object();&lt;br/&gt;
+        final ReentrantLock rl = new ReentrantLock();&lt;br/&gt;
+        final LinkedBlockingQueue&amp;lt;ByteBuffer&amp;gt; queue = new LinkedBlockingQueue&amp;lt;ByteBuffer&amp;gt;();&lt;br/&gt;
+        final AtomicLong latency = new AtomicLong();&lt;br/&gt;
+&lt;br/&gt;
+        Thread reaperThread = new Thread(new Runnable() {&lt;br/&gt;
+&lt;br/&gt;
+            @Override&lt;br/&gt;
+            public void run() {&lt;br/&gt;
+                List&amp;lt;ByteBuffer&amp;gt; currenlyAllocated = new ArrayList&amp;lt;ByteBuffer&amp;gt;(2048);&lt;br/&gt;
+                while (true) {&lt;br/&gt;
+&lt;br/&gt;
+                    try {&lt;br/&gt;
+                        Thread.sleep(100);&lt;br/&gt;
+                        queue.drainTo(currenlyAllocated, 2048);&lt;br/&gt;
+&lt;br/&gt;
+                        for (ByteBuffer byteBuffer : currenlyAllocated) &lt;/p&gt;
{
+                            bp.deallocate(byteBuffer);
+                        }
&lt;p&gt;+                        // System.out.println(&quot;drained &quot;+currenlyAllocated.size());&lt;br/&gt;
+                        currenlyAllocated.clear();&lt;br/&gt;
+                    } catch (Exception x) &lt;/p&gt;
{
+                        System.out.println(x);
+                    }
&lt;p&gt;+                }&lt;br/&gt;
+&lt;br/&gt;
+            }&lt;br/&gt;
+        });&lt;br/&gt;
+        reaperThread.setDaemon(true);&lt;br/&gt;
+        reaperThread.start();&lt;br/&gt;
+        for (int i = 0; i &amp;lt; threadCount; i++) {&lt;br/&gt;
+            Thread th = new Thread(new Runnable() {&lt;br/&gt;
+&lt;br/&gt;
+                @Override&lt;br/&gt;
+                public void run() {&lt;br/&gt;
+                    latch.countDown();&lt;br/&gt;
+                    try &lt;/p&gt;
{
+
+                        latch.await();
+                    }
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
{
+                        // TODO Auto-generated catch block
+                        e.printStackTrace();
+                    }
&lt;p&gt;+&lt;br/&gt;
+                    while (messages.getAndDecrement() &amp;gt; 0) {&lt;br/&gt;
+                        try {&lt;br/&gt;
+                            // synchronized (lock) &lt;/p&gt;
{
+                            //
+                            // }
&lt;p&gt;+&lt;br/&gt;
+                            // rl.lock();&lt;br/&gt;
+                            //&lt;br/&gt;
+                            // rl.unlock();&lt;br/&gt;
+                            long start = System.nanoTime();&lt;br/&gt;
+                            try {&lt;br/&gt;
+                                &lt;br/&gt;
+                                //ByteBuffer bb = bp.allocate(1000);&lt;br/&gt;
+                                // Thread.yield();&lt;br/&gt;
+                                ByteBuffer bb = allocate(bp, 1000);&lt;br/&gt;
+                                &lt;br/&gt;
+                                if (bb != null) &lt;/p&gt;
{
+                                    queue.offer(bb);
+                                    allocated.incrementAndGet();
+                                }
&lt;p&gt; else &lt;/p&gt;
{
+                                    bufferFull.incrementAndGet();
+                                }
&lt;p&gt;+                            } catch (BufferExhaustedException bee) &lt;/p&gt;
{
+                                bufferFull.incrementAndGet();
+                            }
&lt;p&gt;+                            &lt;br/&gt;
+                            long end = System.nanoTime();&lt;br/&gt;
+                            latency.addAndGet((end - start));&lt;br/&gt;
+&lt;br/&gt;
+                        } catch (Exception e) &lt;/p&gt;
{
+                            System.out.println(e);
+                        }
&lt;p&gt;+&lt;br/&gt;
+                    }&lt;br/&gt;
+                }&lt;br/&gt;
+            });&lt;br/&gt;
+            th.setPriority(Thread.MIN_PRIORITY);&lt;br/&gt;
+            th.setDaemon(true);&lt;br/&gt;
+            th.start();&lt;br/&gt;
+&lt;br/&gt;
+        }&lt;br/&gt;
+        latch.countDown();&lt;br/&gt;
+&lt;br/&gt;
+        long time = System.currentTimeMillis();&lt;br/&gt;
+        long start = time;&lt;br/&gt;
+        long previousF = bufferFull.get();&lt;br/&gt;
+        long previousA = allocated.get();&lt;br/&gt;
+        long nextSleep = 1000;&lt;br/&gt;
+&lt;br/&gt;
+        while (true) &lt;/p&gt;
{
+
+            Thread.sleep(nextSleep);
+            long now = System.currentTimeMillis();
+            long fullV = bufferFull.get();
+            long allocateV = allocated.get();
+            long newVal = fullV + allocateV;
+
+            long latencyMs =latency.get();
+
+            System.out.println(now - start + &quot;,&quot; + (double) (newVal - (previousF + previousA)) / (double) (now - time) * 1000
+                    + &quot;,&quot; + (double) (allocateV) / (double) (newVal) + &quot;,&quot; + fullV + &quot;,&quot; + allocateV + &quot;,&quot;
+                    + theGovernator.availablePermits() + &quot;,&quot; + (fullV+allocateV) + &quot;,&quot; + latencyMs
+                    / (numberOfMessages - messages.get()));
+
+            time = now;
+            previousF = fullV;
+            previousA = allocateV;
+
+//            if (now - start &amp;gt; 120000)
+//                break;
+
+            long diff = System.currentTimeMillis() - now;
+            nextSleep = 1000 - diff;
+        }
&lt;p&gt;+&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
+    private static final Semaphore theGovernator = new Semaphore(256 * 1000);&lt;br/&gt;
+&lt;br/&gt;
+    private static ByteBuffer allocate(BufferPool bp, int size) throws InterruptedException {&lt;br/&gt;
+        ByteBuffer result;&lt;br/&gt;
+&lt;br/&gt;
+        final Boolean youMayPass = theGovernator.tryAcquire(size);&lt;br/&gt;
+        try {&lt;br/&gt;
+            if (youMayPass) &lt;/p&gt;
{
+                result = bp.allocate(size);
+            }
&lt;p&gt; else &lt;/p&gt;
{
+                result = null;
+            }
&lt;p&gt;+        } finally &lt;/p&gt;
{
+            if (youMayPass)
+                theGovernator.release(size);
+        }
&lt;p&gt;+&lt;br/&gt;
+        return result;&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
+}&lt;br/&gt;
\ No newline at end of file&lt;br/&gt;
diff --git a/clients/src/main/java/org/apache/kafka/common/metrics/stats/AvgTest.java b/clients/src/main/java/org/apache/kafka/common/metrics/stats/AvgTest.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 0000000..ea8efd2&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/clients/src/main/java/org/apache/kafka/common/metrics/stats/AvgTest.java&lt;br/&gt;
@@ -0,0 +1,26 @@&lt;br/&gt;
+package org.apache.kafka.common.metrics.stats;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.kafka.common.metrics.MetricConfig;&lt;br/&gt;
+&lt;br/&gt;
+public class AvgTest {&lt;br/&gt;
+    &lt;br/&gt;
+    public static void main(String []args) throws Exception&lt;br/&gt;
+    {&lt;br/&gt;
+        Avg a = new Avg();&lt;br/&gt;
+        MetricConfig cfg = new MetricConfig();&lt;br/&gt;
+        for(int i=0;i&amp;lt;15;i++)&lt;br/&gt;
+        &lt;/p&gt;
{
+            a.record(cfg, i, System.currentTimeMillis());
+            System.out.println(i+&quot; &quot;+a.measure(cfg, System.currentTimeMillis()));
+            Thread.sleep(1000);
+        }
&lt;p&gt;+        &lt;br/&gt;
+        for(int i=0;i&amp;lt;150;i++)&lt;br/&gt;
+        &lt;/p&gt;
{
+           
+            System.out.println(Double.isFinite(a.measure(cfg, System.currentTimeMillis())));
+            Thread.sleep(1000);
+        }
&lt;p&gt;+    }&lt;br/&gt;
+&lt;br/&gt;
+}&lt;br/&gt;
diff --git a/clients/src/main/java/org/apache/kafka/common/utils/ClientUtils.java b/clients/src/main/java/org/apache/kafka/common/utils/ClientUtils.java&lt;br/&gt;
index d5af354..05143ac 100644&lt;br/&gt;
&amp;#8212; a/clients/src/main/java/org/apache/kafka/common/utils/ClientUtils.java&lt;br/&gt;
+++ b/clients/src/main/java/org/apache/kafka/common/utils/ClientUtils.java&lt;br/&gt;
@@ -39,16 +39,18 @@&lt;br/&gt;
                     throw new ConfigException(&quot;Invalid url in &quot; + ProducerConfig.BOOTSTRAP_SERVERS_CONFIG + &quot;: &quot; + url);&lt;br/&gt;
                 try {&lt;br/&gt;
                     InetSocketAddress address = new InetSocketAddress(host, port);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (address.isUnresolved())&lt;/li&gt;
	&lt;li&gt;throw new ConfigException(&quot;DNS resolution failed for url in &quot; + ProducerConfig.BOOTSTRAP_SERVERS_CONFIG + &quot;: &quot; + url);&lt;/li&gt;
	&lt;li&gt;addresses.add(address);&lt;br/&gt;
+                    if (address.isUnresolved()) 
{
+                        log.warn(&quot;DNS resolution failed for url in &quot; + ProducerConfig.BOOTSTRAP_SERVERS_CONFIG + &quot;: &quot; + url);
+                    }
&lt;p&gt; else &lt;/p&gt;
{
+                        addresses.add(address);
+                    }
&lt;p&gt;                 } catch (NumberFormatException e) &lt;/p&gt;
{
                     throw new ConfigException(&quot;Invalid port in &quot; + ProducerConfig.BOOTSTRAP_SERVERS_CONFIG + &quot;: &quot; + url);
                 }
&lt;p&gt;             }&lt;br/&gt;
         }&lt;br/&gt;
         if (addresses.size() &amp;lt; 1)&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;throw new ConfigException(&quot;No bootstrap urls given in &quot; + ProducerConfig.BOOTSTRAP_SERVERS_CONFIG);&lt;br/&gt;
+            throw new ConfigException(&quot;No resolvable bootstrap urls given in &quot; + ProducerConfig.BOOTSTRAP_SERVERS_CONFIG);&lt;br/&gt;
         return addresses;&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="15107108" author="ijuma" created="Tue, 19 Jan 2016 18:09:18 +0000"  >&lt;p&gt;Thanks for the contribution. It would make it easier to review if it was submitted via a GitHub pull request as described here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://kafka.apache.org/contributing.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://kafka.apache.org/contributing.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15275148" author="githubbot" created="Sat, 7 May 2016 08:06:25 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/792&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/792&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12905049">KAFKA-2657</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12905049">KAFKA-2657</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 28 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rkd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>ijuma</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>