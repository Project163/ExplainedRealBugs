<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:56:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4183] Logical converters in JsonConverter don&apos;t properly handle null values</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4183</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The &lt;tt&gt;JsonConverter.TO_CONNECT_LOGICAL_CONVERTERS&lt;/tt&gt; map contains &lt;tt&gt;LogicalTypeConverter&lt;/tt&gt; implementations to convert from the raw value into the corresponding logical type value, and they are used during deserialization of message keys and/or values. However, these implementations do not handle the case when the input raw value is null, which can happen when a key or value has a schema that is or contains a field that is &lt;em&gt;optional&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;Consider a Kafka Connect schema of type STRUCT that contains a field &quot;date&quot; with an optional schema of type &lt;tt&gt;org.apache.kafka.connect.data.Date&lt;/tt&gt;. When the key or value with this schema contains a null &quot;date&quot; field and is serialized, the logical serializer properly will serialize the null value. However, upon &lt;em&gt;deserialization&lt;/em&gt;, the &lt;tt&gt;JsonConverter.TO_CONNECT_LOGICAL_CONVERTERS&lt;/tt&gt; are used to convert the literal value (which is null) to a logical value. All of the &lt;tt&gt;JsonConverter.TO_CONNECT_LOGICAL_CONVERTERS&lt;/tt&gt; implementations will throw a NullPointerException when the input value is null. &lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.NullPointerException
	at org.apache.kafka.connect.json.JsonConverter$14.convert(JsonConverter.java:224)
	at org.apache.kafka.connect.json.JsonConverter.convertToConnect(JsonConverter.java:731)
	at org.apache.kafka.connect.json.JsonConverter.access$100(JsonConverter.java:53)
	at org.apache.kafka.connect.json.JsonConverter$12.convert(JsonConverter.java:200)
	at org.apache.kafka.connect.json.JsonConverter.convertToConnect(JsonConverter.java:727)
	at org.apache.kafka.connect.json.JsonConverter.jsonToConnect(JsonConverter.java:354)
	at org.apache.kafka.connect.json.JsonConverter.toConnectData(JsonConverter.java:343)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13005521">KAFKA-4183</key>
            <summary>Logical converters in JsonConverter don&apos;t properly handle null values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="shikhar">Shikhar Bhushan</assignee>
                                    <reporter username="rhauch">Randall Hauch</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Sep 2016 18:43:20 +0000</created>
                <updated>Sun, 25 Feb 2018 21:23:42 +0000</updated>
                            <resolved>Mon, 19 Sep 2016 19:50:18 +0000</resolved>
                                    <version>0.10.0.1</version>
                                    <fixVersion>0.10.1.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15497073" author="rhauch" created="Fri, 16 Sep 2016 18:45:47 +0000"  >&lt;p&gt;I should be able to provide a pull request to fix this. I guess I&apos;ll do it against &quot;trunk&quot; (for 0.10.1.0?), even though I&apos;d love for this fix to be backported to any upcoming 0.10.0.x release.&lt;/p&gt;</comment>
                            <comment id="15497133" author="githubbot" created="Fri, 16 Sep 2016 19:14:14 +0000"  >&lt;p&gt;GitHub user rhauch opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1867&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1867&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4183&quot; title=&quot;Logical converters in JsonConverter don&amp;#39;t properly handle null values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4183&quot;&gt;&lt;del&gt;KAFKA-4183&lt;/del&gt;&lt;/a&gt; Corrected Kafka Connect&apos;s JSON Converter to properly convert from null to logical values&lt;/p&gt;

&lt;p&gt;    The `JsonConverter` class has `LogicalTypeConverter` implementations for Date, Time, Timestamp, and Decimal, but these implementations fail when the input literal value (deserialized from the message) is null. &lt;/p&gt;

&lt;p&gt;    Test cases were added to check for these cases, and these failed before the `LogicalTypeConverter` implementations were fixed to consider whether the schema has a default value or is optional, similarly to how the `JsonToConnectTypeConverter` implementations do this. Once the fixes were made, the new tests pass.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rhauch/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rhauch/kafka&lt;/a&gt; kafka-4183&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1867.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1867.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1867&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c21db21e7b56f7c8ea31fab9852a6852dc038015&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-09-16T19:05:06Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4183&quot; title=&quot;Logical converters in JsonConverter don&amp;#39;t properly handle null values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4183&quot;&gt;&lt;del&gt;KAFKA-4183&lt;/del&gt;&lt;/a&gt; Corrected Kafka Connect&apos;s JSON Converter to properly convert from deserialized null values.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15497141" author="rhauch" created="Fri, 16 Sep 2016 19:18:02 +0000"  >&lt;p&gt;Added a &lt;a href=&quot;https://github.com/apache/kafka/pull/1867&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pull request&lt;/a&gt; with a fix.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;JsonConverter&lt;/tt&gt; class has &lt;tt&gt;LogicalTypeConverter&lt;/tt&gt; implementations for &lt;tt&gt;Date&lt;/tt&gt;, &lt;tt&gt;Time&lt;/tt&gt;, &lt;tt&gt;Timestamp&lt;/tt&gt;, and &lt;tt&gt;Decimal&lt;/tt&gt;, but these implementations fail when the input literal value (deserialized from the message) is null.&lt;/p&gt;

&lt;p&gt;Test cases were added to check for these cases, and these failed before the &lt;tt&gt;LogicalTypeConverter&lt;/tt&gt; implementations were fixed to consider whether the schema has a default value or is optional, similarly to how the &lt;tt&gt;JsonToConnectTypeConverter&lt;/tt&gt; implementations do this. Once the fixes were made to the &lt;tt&gt;LogicalTypeConverter&lt;/tt&gt; implementations, the new tests pass.&lt;/p&gt;</comment>
                            <comment id="15497508" author="hachikuji" created="Fri, 16 Sep 2016 21:59:00 +0000"  >&lt;p&gt;Issue resolved by pull request 1867&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1867&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1867&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15497511" author="githubbot" created="Fri, 16 Sep 2016 21:59:14 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1867&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1867&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15497530" author="rhauch" created="Fri, 16 Sep 2016 22:02:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt;, will there be a 0.10.0.2? If so, any chance this might be included?&lt;/p&gt;</comment>
                            <comment id="15497578" author="hachikuji" created="Fri, 16 Sep 2016 22:26:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhauch&quot; class=&quot;user-hover&quot; rel=&quot;rhauch&quot;&gt;rhauch&lt;/a&gt; Good question. I&apos;m not sure I have the answer, but if you open a PR into 0.10.0, I&apos;ll merge it there.&lt;/p&gt;</comment>
                            <comment id="15497623" author="githubbot" created="Fri, 16 Sep 2016 22:43:46 +0000"  >&lt;p&gt;GitHub user rhauch opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1871&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1871&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4183&quot; title=&quot;Logical converters in JsonConverter don&amp;#39;t properly handle null values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4183&quot;&gt;&lt;del&gt;KAFKA-4183&lt;/del&gt;&lt;/a&gt; Corrected Kafka Connect&apos;s JSON Converter to properly convert from null to logical values&lt;/p&gt;

&lt;p&gt;    The `JsonConverter` class has `LogicalTypeConverter` implementations for Date, Time, Timestamp, and Decimal, but these implementations fail when the input literal value (deserialized from the message) is null. &lt;/p&gt;

&lt;p&gt;    Test cases were added to check for these cases, and these failed before the `LogicalTypeConverter` implementations were fixed to consider whether the schema has a default value or is optional, similarly to how the `JsonToConnectTypeConverter` implementations do this. Once the fixes were made, the new tests pass.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rhauch/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rhauch/kafka&lt;/a&gt; kafka-4183-0.10.0&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1871.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1871.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1871&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4ffb9409f5a75345cf53aed0d799e6c694f636ca&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-09-16T19:05:06Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4183&quot; title=&quot;Logical converters in JsonConverter don&amp;#39;t properly handle null values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4183&quot;&gt;&lt;del&gt;KAFKA-4183&lt;/del&gt;&lt;/a&gt; Corrected Kafka Connect&apos;s JSON Converter to properly convert from deserialized null values.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15497626" author="rhauch" created="Fri, 16 Sep 2016 22:44:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt;, thanks. I&apos;ve created a &lt;a href=&quot;https://github.com/apache/kafka/pull/1871&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pull request&lt;/a&gt; for the &lt;tt&gt;0.10.0&lt;/tt&gt; branch.&lt;/p&gt;</comment>
                            <comment id="15497647" author="shikhar" created="Fri, 16 Sep 2016 22:52:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhauch&quot; class=&quot;user-hover&quot; rel=&quot;rhauch&quot;&gt;rhauch&lt;/a&gt; Reopening this, I noticed an issue with handling default values. E.g. this test&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    @Test
    public void timestampToConnectDefval() {
        Schema schema = Timestamp.builder().defaultValue(new java.util.Date(42)).schema();
        String msg = &quot;{ \&quot;schema\&quot;: { \&quot;type\&quot;: \&quot;int64\&quot;, \&quot;name\&quot;: \&quot;org.apache.kafka.connect.data.Timestamp\&quot;, \&quot;version\&quot;: 1, \&quot;default\&quot;: 42 }, \&quot;payload\&quot;: null }&quot;;
        SchemaAndValue schemaAndValue = converter.toConnectData(TOPIC, msg.getBytes());
        assertEquals(schema, schemaAndValue.schema());
        assertEquals(new java.util.Date(42), schemaAndValue.value());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Happy to create a followup PR since I&apos;m poking around with it&lt;/p&gt;</comment>
                            <comment id="15497694" author="rhauch" created="Fri, 16 Sep 2016 23:11:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shikhar&quot; class=&quot;user-hover&quot; rel=&quot;shikhar&quot;&gt;shikhar&lt;/a&gt;, that&apos;d be great. Note that I created two PRs: one for &lt;tt&gt;trunk&lt;/tt&gt; and one for &lt;tt&gt;0.10.0&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15497716" author="githubbot" created="Fri, 16 Sep 2016 23:25:54 +0000"  >&lt;p&gt;GitHub user shikhar opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1872&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4183&quot; title=&quot;Logical converters in JsonConverter don&amp;#39;t properly handle null values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4183&quot;&gt;&lt;del&gt;KAFKA-4183&lt;/del&gt;&lt;/a&gt;: centralize checking for optional and default values to avoid bugs&lt;/p&gt;

&lt;p&gt;    Cleaner to just check once for optional &amp;amp; default value from the `convertToConnect()` function.&lt;/p&gt;

&lt;p&gt;    It also helps address an issue with conversions for logical type schemas that have default values and null as the included value. That test case is &lt;em&gt;probably&lt;/em&gt; not an issue in practice, since when using the `JsonConverter` to serialize a missing field with a default value, it will serialize the default value for the field. But in the face of JSON data streaming in from a topic being &lt;span class=&quot;error&quot;&gt;&amp;#91;generous on input, strict on output&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://tedwise.com/2009/05/27/generous-on-input-strict-on-output&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://tedwise.com/2009/05/27/generous-on-input-strict-on-output&lt;/a&gt;) seems best.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/shikhar/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/shikhar/kafka&lt;/a&gt; kafka-4183&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1872.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1872.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1872&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 1e09c6431f11361e7f3a5af4c09a8174c3547669&lt;br/&gt;
Author: Shikhar Bhushan &amp;lt;shikhar@confluent.io&amp;gt;&lt;br/&gt;
Date:   2016-09-16T23:17:40Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4183&quot; title=&quot;Logical converters in JsonConverter don&amp;#39;t properly handle null values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4183&quot;&gt;&lt;del&gt;KAFKA-4183&lt;/del&gt;&lt;/a&gt;: centralize checking for optional and default values to avoid bugs&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15504477" author="hachikuji" created="Mon, 19 Sep 2016 19:50:18 +0000"  >&lt;p&gt;Issue resolved by pull request 1872&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1872&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15504479" author="githubbot" created="Mon, 19 Sep 2016 19:50:35 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1872&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1872&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16376249" author="githubbot" created="Sun, 25 Feb 2018 21:23:42 +0000"  >&lt;p&gt;hachikuji closed pull request #1871: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4183&quot; title=&quot;Logical converters in JsonConverter don&amp;#39;t properly handle null values&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4183&quot;&gt;&lt;del&gt;KAFKA-4183&lt;/del&gt;&lt;/a&gt; Corrected Kafka Connect&apos;s JSON Converter to properly convert from null to logical values&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/1871&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1871&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/connect/json/src/main/java/org/apache/kafka/connect/json/JsonConverter.java b/connect/json/src/main/java/org/apache/kafka/connect/json/JsonConverter.java&lt;br/&gt;
index d9a685953d2..b35b24aeec3 100644&lt;br/&gt;
&amp;#8212; a/connect/json/src/main/java/org/apache/kafka/connect/json/JsonConverter.java&lt;br/&gt;
+++ b/connect/json/src/main/java/org/apache/kafka/connect/json/JsonConverter.java&lt;br/&gt;
@@ -211,6 +211,7 @@ public Object convert(Schema schema, JsonNode value) {&lt;br/&gt;
         TO_CONNECT_LOGICAL_CONVERTERS.put(Decimal.LOGICAL_NAME, new LogicalTypeConverter() {&lt;br/&gt;
             @Override&lt;br/&gt;
             public Object convert(Schema schema, Object value) {&lt;br/&gt;
+                if (value == null) return checkOptionalAndDefault(schema);&lt;br/&gt;
                 if (!(value instanceof byte[]))&lt;br/&gt;
                     throw new DataException(&quot;Invalid type for Decimal, underlying representation should be bytes but was &quot; + value.getClass());&lt;br/&gt;
                 return Decimal.toLogical(schema, (byte[]) value);&lt;br/&gt;
@@ -220,6 +221,7 @@ public Object convert(Schema schema, Object value) {&lt;br/&gt;
         TO_CONNECT_LOGICAL_CONVERTERS.put(Date.LOGICAL_NAME, new LogicalTypeConverter() {&lt;br/&gt;
             @Override&lt;br/&gt;
             public Object convert(Schema schema, Object value) {&lt;br/&gt;
+                if (value == null) return checkOptionalAndDefault(schema);&lt;br/&gt;
                 if (!(value instanceof Integer))&lt;br/&gt;
                     throw new DataException(&quot;Invalid type for Date, underlying representation should be int32 but was &quot; + value.getClass());&lt;br/&gt;
                 return Date.toLogical(schema, (int) value);&lt;br/&gt;
@@ -229,6 +231,7 @@ public Object convert(Schema schema, Object value) {&lt;br/&gt;
         TO_CONNECT_LOGICAL_CONVERTERS.put(Time.LOGICAL_NAME, new LogicalTypeConverter() {&lt;br/&gt;
             @Override&lt;br/&gt;
             public Object convert(Schema schema, Object value) {&lt;br/&gt;
+                if (value == null) return checkOptionalAndDefault(schema);&lt;br/&gt;
                 if (!(value instanceof Integer))&lt;br/&gt;
                     throw new DataException(&quot;Invalid type for Time, underlying representation should be int32 but was &quot; + value.getClass());&lt;br/&gt;
                 return Time.toLogical(schema, (int) value);&lt;br/&gt;
@@ -238,6 +241,7 @@ public Object convert(Schema schema, Object value) {&lt;br/&gt;
         TO_CONNECT_LOGICAL_CONVERTERS.put(Timestamp.LOGICAL_NAME, new LogicalTypeConverter() {&lt;br/&gt;
             @Override&lt;br/&gt;
             public Object convert(Schema schema, Object value) {&lt;br/&gt;
+                if (value == null) return checkOptionalAndDefault(schema);&lt;br/&gt;
                 if (!(value instanceof Long))&lt;br/&gt;
                     throw new DataException(&quot;Invalid type for Timestamp, underlying representation should be int64 but was &quot; + value.getClass());&lt;br/&gt;
                 return Timestamp.toLogical(schema, (long) value);&lt;br/&gt;
diff --git a/connect/json/src/test/java/org/apache/kafka/connect/json/JsonConverterTest.java b/connect/json/src/test/java/org/apache/kafka/connect/json/JsonConverterTest.java&lt;br/&gt;
index c9232853067..7700f18c6dc 100644&lt;br/&gt;
&amp;#8212; a/connect/json/src/test/java/org/apache/kafka/connect/json/JsonConverterTest.java&lt;br/&gt;
+++ b/connect/json/src/test/java/org/apache/kafka/connect/json/JsonConverterTest.java&lt;br/&gt;
@@ -54,6 +54,7 @@&lt;br/&gt;
 import static org.junit.Assert.assertArrayEquals;&lt;br/&gt;
 import static org.junit.Assert.assertEquals;&lt;br/&gt;
 import static org.junit.Assert.assertNotNull;&lt;br/&gt;
+import static org.junit.Assert.assertNull;&lt;br/&gt;
 import static org.junit.Assert.assertTrue;&lt;br/&gt;
 import static org.junit.Assert.fail;&lt;/p&gt;

&lt;p&gt;@@ -216,6 +217,16 @@ public void decimalToConnect() &lt;/p&gt;
{
         assertEquals(reference, converted);
     }&lt;br/&gt;
 &lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void decimalToConnectOptional() {&lt;br/&gt;
+        Schema schema = Decimal.builder(2).optional().schema();&lt;br/&gt;
+        // Payload is base64 encoded byte[]{0, -100}, which is the two&apos;s complement encoding of 156.&lt;br/&gt;
+        String msg = &quot;{ \&quot;schema\&quot;: { \&quot;type\&quot;: \&quot;bytes\&quot;, \&quot;name\&quot;: \&quot;org.apache.kafka.connect.data.Decimal\&quot;, \&quot;version\&quot;: 1, \&quot;optional\&quot;: true, \&quot;parameters\&quot;: { \&quot;scale\&quot;: \&quot;2\&quot; } }, \&quot;payload\&quot;: null }&quot;;&lt;br/&gt;
+        SchemaAndValue schemaAndValue = converter.toConnectData(TOPIC, msg.getBytes());&lt;br/&gt;
+        assertEquals(schema, schemaAndValue.schema());&lt;br/&gt;
+        assertNull(schemaAndValue.value());&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
     @Test&lt;br/&gt;
     public void dateToConnect() {&lt;br/&gt;
         Schema schema = Date.SCHEMA;&lt;br/&gt;
@@ -230,6 +241,15 @@ public void dateToConnect() {         assertEquals(reference, converted);     }

&lt;p&gt;+    @Test&lt;br/&gt;
+    public void dateToConnectOptional() {&lt;br/&gt;
+        Schema schema = Date.builder().optional().schema();&lt;br/&gt;
+        String msg = &quot;{ \&quot;schema\&quot;: &lt;/p&gt;
{ \&quot;type\&quot;: \&quot;int32\&quot;, \&quot;name\&quot;: \&quot;org.apache.kafka.connect.data.Date\&quot;, \&quot;version\&quot;: 1, \&quot;optional\&quot;: true }
&lt;p&gt;, \&quot;payload\&quot;: null }&quot;;&lt;br/&gt;
+        SchemaAndValue schemaAndValue = converter.toConnectData(TOPIC, msg.getBytes());&lt;br/&gt;
+        assertEquals(schema, schemaAndValue.schema());&lt;br/&gt;
+        assertNull(schemaAndValue.value());&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
     @Test&lt;br/&gt;
     public void timeToConnect() {&lt;br/&gt;
         Schema schema = Time.SCHEMA;&lt;br/&gt;
@@ -244,6 +264,15 @@ public void timeToConnect() &lt;/p&gt;
{
         assertEquals(reference, converted);
     }&lt;br/&gt;
 &lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void timeToConnectOptional() {&lt;br/&gt;
+        Schema schema = Time.builder().optional().schema();&lt;br/&gt;
+        String msg = &quot;{ \&quot;schema\&quot;: { \&quot;type\&quot;: \&quot;int32\&quot;, \&quot;name\&quot;: \&quot;org.apache.kafka.connect.data.Time\&quot;, \&quot;version\&quot;: 1, \&quot;optional\&quot;: true }, \&quot;payload\&quot;: null }&quot;;&lt;br/&gt;
+        SchemaAndValue schemaAndValue = converter.toConnectData(TOPIC, msg.getBytes());&lt;br/&gt;
+        assertEquals(schema, schemaAndValue.schema());&lt;br/&gt;
+        assertNull(schemaAndValue.value());&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
     @Test&lt;br/&gt;
     public void timestampToConnect() {&lt;br/&gt;
         Schema schema = Timestamp.SCHEMA;&lt;br/&gt;
@@ -259,6 +288,15 @@ public void timestampToConnect() {         assertEquals(reference, converted);     }

&lt;p&gt;+    @Test&lt;br/&gt;
+    public void timestampToConnectOptional() {&lt;br/&gt;
+        Schema schema = Timestamp.builder().optional().schema();&lt;br/&gt;
+        String msg = &quot;{ \&quot;schema\&quot;: &lt;/p&gt;
{ \&quot;type\&quot;: \&quot;int64\&quot;, \&quot;name\&quot;: \&quot;org.apache.kafka.connect.data.Timestamp\&quot;, \&quot;version\&quot;: 1, \&quot;optional\&quot;: true }
&lt;p&gt;, \&quot;payload\&quot;: null }&quot;;&lt;br/&gt;
+        SchemaAndValue schemaAndValue = converter.toConnectData(TOPIC, msg.getBytes());&lt;br/&gt;
+        assertEquals(schema, schemaAndValue.schema());&lt;br/&gt;
+        assertNull(schemaAndValue.value());&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
     // Schema metadata&lt;/p&gt;

&lt;p&gt;     @Test&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 38 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33q8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>