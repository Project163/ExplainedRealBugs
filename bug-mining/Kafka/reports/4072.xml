<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:41:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-17792] header parsing ends up timing out and using large quantities of memory if the string looks like a number</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-17792</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;&lt;font color=&quot;#172b4d&quot;&gt;We have trace headers such as:&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#172b4d&quot;&gt;&quot;X-B3-SpanId&quot;: &quot;74320e6e26adc8f8&quot;&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#172b4d&quot;&gt;if however the value happens to be: &quot;407127e212797209&quot;&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#172b4d&quot;&gt;This is then treated as a numeric value and it tries to convert this as a numeric representation and an exact value using BigDecimal&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;we end up with the trace:&lt;/p&gt;

&lt;p&gt;&#160; &#160; BigDecimal.setScale(int, RoundingMode) line: 2876 &#160; &#160;&lt;br/&gt;
&#160; &#160; Values$ValueParser.parseAsExactDecimal(BigDecimal) line: 1044 &#160; &#160;&lt;br/&gt;
&#160; &#160; Values$ValueParser.parseAsNumber(String) line: 1025 &#160; &#160;&lt;br/&gt;
&#160; &#160; Values$ValueParser.parseNextToken(boolean, String) line: 892 &#160; &#160;&lt;br/&gt;
&#160; &#160; Values$ValueParser.parse(boolean) line: 875 &#160; &#160;&lt;br/&gt;
&#160; &#160; Values.parseString(String) line: 415 &#160; &#160;&lt;br/&gt;
&#160; &#160; SimpleHeaderConverter.toConnectHeader(String, String, byte[]) line: 68 &#160; &#160;&lt;br/&gt;
&#160; &#160; WorkerSinkTask.convertHeadersFor(ConsumerRecord&amp;lt;byte[],byte[]&amp;gt;) line: 578 &#160; &#160;&lt;/p&gt;

&lt;p&gt;this takes a long time to convert to an exact representation of a 212 billion digit integer&lt;/p&gt;</description>
                <environment></environment>
        <key id="13595380">KAFKA-17792</key>
            <summary>header parsing ends up timing out and using large quantities of memory if the string looks like a number</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="msillence">Martin Sillence</assignee>
                                    <reporter username="msillence">Martin Sillence</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Oct 2024 17:26:58 +0000</created>
                <updated>Mon, 27 Jan 2025 18:15:10 +0000</updated>
                            <resolved>Mon, 27 Jan 2025 18:06:43 +0000</resolved>
                                                    <fixVersion>3.9.1</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                    <fixVersion>4.1.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17889545" author="msillence" created="Tue, 15 Oct 2024 08:30:16 +0000"  >&lt;p&gt;I feel there are a few options&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;make the schema expicit&lt;/li&gt;
	&lt;li&gt;an exclude list&lt;/li&gt;
	&lt;li&gt;a limit on the number of digits&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The latter is the least intrusive but possibly the worst in terms of suprises but to quantifiy it:&lt;/p&gt;

&lt;p&gt;positive exponents:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;1e+1 time 0.0 totalMemory 532676608
1e+10 time 0.0 totalMemory 532676608
1e+100 time 0.0 totalMemory 532676608
1e+1000 time 0.0 totalMemory 532676608
1e+10000 time 0.005 totalMemory 532676608
1e+100000 time 0.035 totalMemory 532676608
1e+1000000 time 0.228 totalMemory 532676608
1e+10000000 time 4.308 totalMemory 926941184
1e+100000000 time 117.119 totalMemory 3221225472
1e+1000000000 time 0.0 totalMemory 3221225472 BigInteger would overflow supported range
1e+10000000000 time 0.001 totalMemory 3221225472 Too many nonzero exponent digits.
1e+100000000000 time 0.0 totalMemory 3221225472 Too many nonzero exponent digits.
1e+1000000000000 time 0.0 totalMemory 3221225472 Too many nonzero exponent digits.
1e+10000000000000 time 0.0 totalMemory 3221225472 Too many nonzero exponent digits.
&#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;negative exponents:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;1e-1 time 0.001 totalMemory 532676608
1e-10 time 0.0 totalMemory 532676608
1e-100 time 0.001 totalMemory 532676608
1e-1000 time 0.0 totalMemory 532676608
1e-10000 time 0.005 totalMemory 532676608
1e-100000 time 0.034 totalMemory 532676608
1e-1000000 time 0.242 totalMemory 532676608
1e-10000000 time 4.342 totalMemory 926941184
1e-100000000 time 121.199 totalMemory 3368026112
1e-1000000000 time 0.0 totalMemory 3368026112 BigInteger would overflow supported range
1e-10000000000 time 0.0 totalMemory 3368026112 Too many nonzero exponent digits.
1e-100000000000 time 0.0 totalMemory 3368026112 Too many nonzero exponent digits.
1e-1000000000000 time 0.0 totalMemory 3368026112 Too many nonzero exponent digits.
1e-10000000000000 time 0.0 totalMemory 3368026112 Too many nonzero exponent digits.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;so 1e+1000000 and 1e-1000000 seem to be where things start to get more expensive (negative numbers are the same, memory is&#160;&lt;font color=&quot;#d8d8d8&quot;&gt;&lt;font color=&quot;#d8d8d8&quot;&gt;&lt;/font&gt; &lt;/font&gt;&lt;font color=&quot;#d25252&quot;&gt;Runtime&lt;/font&gt;&lt;font color=&quot;#d8d8d8&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#bed6ff&quot;&gt;getRuntime&lt;/font&gt;&lt;font color=&quot;#d8d8d8&quot;&gt;().&lt;/font&gt;&lt;font color=&quot;#ffffff&quot;&gt;totalMemory&lt;/font&gt;&lt;font color=&quot;#d8d8d8&quot;&gt;()&lt;/font&gt;&lt;font color=&quot;&quot;&gt;&lt;/font&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;we have two choices then - either not process them as exact or leave them as strings&lt;/p&gt;

&lt;p&gt;leaving them as strings seems likely to break things unexpectedly but quickly&lt;/p&gt;

&lt;p&gt;not being exact sounds like it would lead to subtle errors - for us we really don&apos;t want our header to be rounded it&apos;s not a number&lt;/p&gt;</comment>
                            <comment id="17889685" author="msillence" created="Tue, 15 Oct 2024 14:02:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/17510&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/17510&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1rz9k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>