<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:20:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9137] Maintenance of FetchSession cache causing FETCH_SESSION_ID_NOT_FOUND in live sessions</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9137</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We have recently seen cases where brokers end up in a bad state where fetch&#160;session evictions occur at a high rate (&amp;gt; 16 per second) after a roll. This&#160;increase in eviction rate included the following pattern in our logs:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;broker 6: October 31st 2019, 17:52:45.496 Created a new incremental FetchContext for session id 2046264334, epoch 9790: added (), updated (), removed ()

broker 6: October 31st 2019, 17:52:45.496 Created a new incremental FetchContext for session id 2046264334, epoch 9791: added (), updated (), removed () broker 6: October 31st 2019, 17:52:45.500 Created a new incremental FetchContext for session id 2046264334, epoch 9792: added (), updated (lkc-7nv6o_tenant_soak_topic_144p-67), removed () 

broker 6: October 31st 2019, 17:52:45.501 Created a new incremental FetchContext for session id 2046264334, epoch 9793: added (), updated (lkc-7nv6o_tenant_soak_topic_144p-59, lkc-7nv6o_tenant_soak_topic_144p-123, lkc-7nv6o_tenant_soak_topic_144p-11, lkc-7nv6o_tenant_soak_topic_144p-3, lkc-7nv6o_tenant_soak_topic_144p-67, lkc-7nv6o_tenant_soak_topic_144p-115), removed () 

broker 6: October 31st 2019, 17:52:45.501 Evicting stale FetchSession 2046264334. 

broker 6: October 31st 2019, 17:52:45.502 Session error for 2046264334: no such session ID found. 

broker 4: October 31st 2019, 17:52:45.813 [ReplicaFetcher replicaId=4, leaderId=6, fetcherId=0] Node 6 was unable to process the fetch request with (sessionId=2046264334, epoch=9793): FETCH_SESSION_ID_NOT_FOUND. &#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This pattern appears to be problematic for two reasons. Firstly, the replica&#160;fetcher for broker 4 was clearly able to send multiple incremental fetch&#160;requests to broker 6, and receive replies, and did so right up to the point&#160;where broker 6 evicted its fetch session within milliseconds of multiple fetch&#160;requests. The second problem is that replica fetchers are considered privileged&#160;for the fetch session cache, and should not be evicted by consumer fetch&#160;sessions. This cluster only has 12 brokers and 1000 fetch session cache slots (the default for&#160;max.incremental.fetch.session.cache.slots),&#160;and it thus very unlikely that this session should have been evicted by another&#160;replica fetcher session.&lt;/p&gt;

&lt;p&gt;This cluster also appears to be causing cycles of fetch session evictions where the cluster never stabilizes into a state where fetch sessions are not evicted. The above logs are the best example I could find of a case where a session clearly should not have been evicted.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13266148">KAFKA-9137</key>
            <summary>Maintenance of FetchSession cache causing FETCH_SESSION_ID_NOT_FOUND in live sessions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lucasbradstreet">Lucas Bradstreet</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Nov 2019 16:40:53 +0000</created>
                <updated>Sat, 18 Apr 2020 19:35:29 +0000</updated>
                            <resolved>Sat, 15 Feb 2020 19:22:29 +0000</resolved>
                                                    <fixVersion>2.5.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16966813" author="githubbot" created="Mon, 4 Nov 2019 16:45:42 +0000"  >&lt;p&gt;lbradstreet commented on pull request #7640: &lt;span class=&quot;error&quot;&gt;&amp;#91;WIP&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9137&quot; title=&quot;Maintenance of FetchSession cache causing FETCH_SESSION_ID_NOT_FOUND in live sessions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9137&quot;&gt;&lt;del&gt;KAFKA-9137&lt;/del&gt;&lt;/a&gt;: fix incorrect eviction of fetch sessions from FetchSessionCache&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7640&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7640&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16968003" author="githubbot" created="Wed, 6 Nov 2019 01:27:55 +0000"  >&lt;p&gt;cmccabe commented on pull request #7640: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9137&quot; title=&quot;Maintenance of FetchSession cache causing FETCH_SESSION_ID_NOT_FOUND in live sessions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9137&quot;&gt;&lt;del&gt;KAFKA-9137&lt;/del&gt;&lt;/a&gt;: FETCH_SESSION_ID_NOT_FOUND caused by incorrect FetchSessionCache eviction&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7640&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7640&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17037579" author="lucasbradstreet" created="Sat, 15 Feb 2020 19:22:29 +0000"  >&lt;p&gt;Closed by&#160;&lt;a href=&quot;https://github.com/apache/kafka/pull/7640&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7640&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17084756" author="philbour" created="Thu, 16 Apr 2020 10:52:19 +0000"  >&lt;p&gt;What version is this fixed in? 2.5 was released today, I don&apos;t see this Jira in the release notes.&lt;/p&gt;</comment>
                            <comment id="17086621" author="lucasbradstreet" created="Sat, 18 Apr 2020 19:35:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philbour&quot; class=&quot;user-hover&quot; rel=&quot;philbour&quot;&gt;philbour&lt;/a&gt;&#160;I have updated the ticket with the fix version (2.5). It must have been missed in the release notes due to not being tagged correctly here.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 30 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z088ow:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>