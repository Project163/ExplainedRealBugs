<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:04:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4972] Kafka 0.10.0  Found a corrupted index file during Kafka broker startup</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4972</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;-deleted text-After force shutdown all kafka brokers one by one, restart them one by one, but a broker startup failure.&lt;/p&gt;

&lt;p&gt;The following WARN leval log was found in the log file:&lt;br/&gt;
found a corrutped index file,  xxxx.index , delet it  ...&lt;/p&gt;

&lt;p&gt;you can view details by following attachment.&lt;/p&gt;


&lt;p&gt;~I look up some codes in core module, found out :&lt;/p&gt;

&lt;p&gt;the nonthreadsafe method LogSegment.append(offset, messages)  has tow caller:&lt;/p&gt;

&lt;p&gt;1) Log.append(messages)                          // here has a synchronized lock &lt;br/&gt;
2) LogCleaner.cleanInto(topicAndPartition, source, dest, map, retainDeletes, messageFormatVersion)   // here has not &lt;/p&gt;

&lt;p&gt;So I guess this may be the reason for the repeated offset in 00000xx.log file (logsegment&apos;s .log) ~&lt;/p&gt;

&lt;p&gt;Although this is just my inference, but I hope that this problem can be quickly repaired&lt;/p&gt;</description>
                <environment>JDK: HotSpot  x64  1.7.0_80&lt;br/&gt;
Tag: 0.10.0</environment>
        <key id="13059948">KAFKA-4972</key>
            <summary>Kafka 0.10.0  Found a corrupted index file during Kafka broker startup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="f1194361820">fangjinuo</reporter>
                        <labels>
                            <label>reliability</label>
                    </labels>
                <created>Wed, 29 Mar 2017 07:31:39 +0000</created>
                <updated>Sat, 14 Mar 2020 11:26:05 +0000</updated>
                                            <version>0.10.0.0</version>
                                                    <component>log</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>19</watches>
                                                                                                                <comments>
                            <comment id="15954378" author="ewencp" created="Tue, 4 Apr 2017 00:07:06 +0000"  >&lt;p&gt;Removed a bunch of released versions from the fix version field.&lt;/p&gt;</comment>
                            <comment id="16169681" author="juliuszaromskis" created="Mon, 18 Sep 2017 07:22:00 +0000"  >&lt;p&gt;There&apos;s a bunch of warning msgs in my log file, kafka is slow to restart. Upgrading 0.10.2 to 0.11.0.1&lt;/p&gt;

&lt;p&gt;{{&lt;span class=&quot;error&quot;&gt;&amp;#91;2017-09-18 06:53:19,349&amp;#93;&lt;/span&gt; WARN Found a corrupted index file due to requirement failed: Corrupt index found, index file (/var/kafka/dispatch.task-ack-6/00000000000000021796.index) has non-zero size but the last offset is 21796 which is no larger than the base offset 21796.}. deleting /var/kafka/dispatch.task-ack-6/00000000000000021796.timeindex, /var/kafka/dispatch.task-ack-6/00000000000000021796.index, and /var/kafka/dispatch.task-ack-6/00000000000000021796.txnindex and rebuilding index... (kafka.log.Log)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2017-09-18 06:56:10,533&amp;#93;&lt;/span&gt; WARN Found a corrupted index file due to requirement failed: Corrupt index found, index file (/var/kafka/dispatch.task-ack-10/00000000000000027244.index) has non-zero size but the last offset is 27244 which is no larger than the base offset 27244.}. deleting /var/kafka/dispatch.task-ack-10/00000000000000027244.timeindex, /var/kafka/dispatch.task-ack-10/00000000000000027244.index, and /var/kafka/dispatch.task-ack-10/00000000000000027244.txnindex and rebuilding index... (kafka.log.Log)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2017-09-18 07:09:17,710&amp;#93;&lt;/span&gt; WARN Found a corrupted index file due to requirement failed: Corrupt index found, index file (/var/kafka/dispatch.status-3/00000000000049362755.index) has non-zero size but the last offset is 49362755 which is no larger than the base offset 49362755.}. deleting /var/kafka/dispatch.status-3/00000000000049362755.timeindex, /var/kafka/dispatch.status-3/00000000000049362755.index, and /var/kafka/dispatch.status-3/00000000000049362755.txnindex and rebuilding index... (kafka.log.Log)}}&lt;/p&gt;</comment>
                            <comment id="16189588" author="ijuma" created="Tue, 3 Oct 2017 11:48:10 +0000"  >&lt;p&gt;I am not sure if it&apos;s the root cause, but it&apos;s a good observation that locking seems to be missing. We should fix this for 1.0.0.&lt;/p&gt;</comment>
                            <comment id="16191321" author="githubbot" created="Wed, 4 Oct 2017 14:25:49 +0000"  >&lt;p&gt;GitHub user ijuma opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4016&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4016&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    MINOR: Simplify log cleaner and fix compiler warnings&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Simplify LogCleaner.cleanSegments and add comment regarding thread&lt;br/&gt;
    unsafe usage of `LogSegment.append`. This was a result of investigating&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4972&quot; title=&quot;Kafka 0.10.0  Found a corrupted index file during Kafka broker startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4972&quot;&gt;KAFKA-4972&lt;/a&gt;.&lt;/li&gt;
	&lt;li&gt;Fix compiler warnings.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ijuma/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ijuma/kafka&lt;/a&gt; simplify-log-cleaner-and-fix-warnings&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4016.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4016.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4016&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 3b26b21c4a41b9857d48a09a63a560228924df4f&lt;br/&gt;
Author: Ismael Juma &amp;lt;ismael@juma.me.uk&amp;gt;&lt;br/&gt;
Date:   2017-10-04T13:57:03Z&lt;/p&gt;

&lt;p&gt;    Simplify LogCleaner.cleanSegments and add comment regarding thread unsafe usage of `LogSegment.append`&lt;/p&gt;

&lt;p&gt;commit a1e50d8fbffc977646397f0446efeaa798816d87&lt;br/&gt;
Author: Ismael Juma &amp;lt;ismael@juma.me.uk&amp;gt;&lt;br/&gt;
Date:   2017-10-04T13:57:20Z&lt;/p&gt;

&lt;p&gt;    Fix compiler warnings&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16191337" author="ijuma" created="Wed, 4 Oct 2017 14:35:25 +0000"  >&lt;p&gt;There is no thread safety issue after all. I clarified it in the code. So, this needs more investigation.&lt;/p&gt;</comment>
                            <comment id="16191714" author="githubbot" created="Wed, 4 Oct 2017 17:57:38 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4016&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4016&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16245490" author="rsivaram" created="Thu, 9 Nov 2017 10:52:11 +0000"  >&lt;p&gt;Moving this out to the next release since there is no PR yet to include in 0.11.0.2. Let me know if anyone can provide a PR in time for 0.11.0.2.&lt;/p&gt;</comment>
                            <comment id="16335027" author="ewencp" created="Mon, 22 Jan 2018 22:16:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; anything to do here or are we at a loss until we have more info? I&apos;d like to bump out of this release (and maybe just remove fixVersion entirely if we don&apos;t even know what the issue is).&lt;/p&gt;</comment>
                            <comment id="16352792" author="ewencp" created="Mon, 5 Feb 2018 19:13:16 +0000"  >&lt;p&gt;No progress on this, moving to subsequent release.&lt;/p&gt;</comment>
                            <comment id="16679867" author="nenad maric" created="Thu, 8 Nov 2018 14:55:43 +0000"  >&lt;p&gt;Any news about this bug?&lt;br/&gt;
We have a similar problem on Kafka 1.1.0. Here is the log output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2018-11-08 10:45:04,471] WARN [Log partition=&amp;lt;PRODUCTION-TOPIC-21&amp;gt;, dir=/data] Found a corrupted index file corresponding to log file /data/&amp;lt;PRODUCTION-TOPIC-21&amp;gt;/00000000000006723263.log due to Corrupt index found, index file (/data/&amp;lt;PRODUCTION-TOPIC-21&amp;gt;/00000000000006723263.index) has non-zero size but the last offset is 6723263 which is no greater than the base offset 6723263.}, recovering segment and rebuilding index files... (kafka.log.Log)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2018-11-08 10:46:28,351] ERROR There was an error in one of the threads during logs loading: java.lang.IllegalArgumentException: inconsistent range (kafka.log.LogManager)
[2018-11-08 10:46:28,356] ERROR [KafkaServer id=4] Fatal error during KafkaServer startup. Prepare to shutdown (kafka.server.KafkaServer)
java.lang.IllegalArgumentException: inconsistent range
 at java.util.concurrent.ConcurrentSkipListMap$SubMap.&amp;lt;init&amp;gt;(ConcurrentSkipListMap.java:2620)
 at java.util.concurrent.ConcurrentSkipListMap.subMap(ConcurrentSkipListMap.java:2078)
 at java.util.concurrent.ConcurrentSkipListMap.subMap(ConcurrentSkipListMap.java:2114)
 at kafka.log.Log$$anonfun$12.apply(Log.scala:1561)
 at kafka.log.Log$$anonfun$12.apply(Log.scala:1560)
 at scala.Option.map(Option.scala:146)
 at kafka.log.Log.logSegments(Log.scala:1560)
 at kafka.log.Log.kafka$log$Log$$recoverSegment(Log.scala:358)
 at kafka.log.Log$$anonfun$completeSwapOperations$1.apply(Log.scala:389)
 at kafka.log.Log$$anonfun$completeSwapOperations$1.apply(Log.scala:380)
 at scala.collection.immutable.Set$Set1.foreach(Set.scala:94)
 at kafka.log.Log.completeSwapOperations(Log.scala:380)
 at kafka.log.Log.loadSegments(Log.scala:408)
 at kafka.log.Log.&amp;lt;init&amp;gt;(Log.scala:216)
 at kafka.log.Log$.apply(Log.scala:1747)
 at kafka.log.LogManager.kafka$log$LogManager$$loadLog(LogManager.scala:255)
 at kafka.log.LogManager$$anonfun$loadLogs$2$$anonfun$11$$anonfun$apply$15$$anonfun$apply$2.apply$mcV$sp(LogManager.scala:335)
 at kafka.utils.CoreUtils$$anon$1.run(CoreUtils.scala:62)
 at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
 at java.util.concurrent.FutureTask.run(FutureTask.java:266)
 at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
 at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
 at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
[2018-11-08 10:46:28,402] INFO [KafkaServer id=4] shutting down (kafka.server.KafkaServer)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16929298" author="srivishnu.totakura@experteer.com" created="Fri, 13 Sep 2019 15:37:43 +0000"  >&lt;p&gt;Hi all,&#160;&lt;/p&gt;

&lt;p&gt;we had a similar issue when we were restarting our brokers. Turns out, for us, it was an issue with the &lt;tt&gt;systemd&lt;/tt&gt;&#160;configuration.&#160;&lt;/p&gt;

&lt;p&gt;We have 350 GB of data on each broker with 150 topics and shutting down the Kafka server needs about 8 minutes. However, &lt;tt&gt;systemd&lt;/tt&gt;&#160;was configured to wait only 90 seconds for the server to shutdown and then its force kills the server. When the server is restarted, it will end up having corrupted index file because its didn&apos;t shutdown properly. The fix was to set the &lt;tt&gt;TimeoutStopSec=600&lt;/tt&gt; config in systemd configuration.&#160;&lt;/p&gt;

&lt;p&gt;We summarised the issue and the fix in a blog post: &lt;a href=&quot;https://blog.experteer.engineering/kafka-corrupted-index-file-warnings-after-broker-restart.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://blog.experteer.engineering/kafka-corrupted-index-file-warnings-after-broker-restart.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hopefully, it is helpful for some of you.&lt;/p&gt;</comment>
                            <comment id="16961220" author="stoyan.stoyanov" created="Mon, 28 Oct 2019 16:22:59 +0000"  >&lt;p&gt;Seen in version 2.2.1&lt;/p&gt;

&lt;p&gt;One mitigation is:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Stop Kafka&lt;/li&gt;
	&lt;li&gt;Delete all &quot;*.timeindex&quot; files&lt;/li&gt;
	&lt;li&gt;Start Kafka again&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17059305" author="zhangchenghui" created="Sat, 14 Mar 2020 11:26:05 +0000"  >&lt;p&gt;I made an analysis of this problem specifically:&lt;br/&gt;
&lt;a href=&quot;https://objcoding.com/2020/03/14/kafka-invalid-offset-exception/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://objcoding.com/2020/03/14/kafka-invalid-offset-exception/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12861002" name="Snap3.png" size="35123" author="f1194361820" created="Wed, 29 Mar 2017 07:31:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 35 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3cxif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>