<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:37:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-14616] Topic recreation with offline broker causes permanent URPs</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-14616</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;We are facing an odd situation when we delete and recreate a topic while broker is offline in KRAFT mode. &lt;br/&gt;
Here&#8217;s what we saw step by step&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Created topic &lt;tt&gt;foo.test&lt;/tt&gt; with 10 partitions and 4 replicas &#8212; Topic &lt;tt&gt;foo.test&lt;/tt&gt; was created with topic ID &lt;tt&gt;MfuZbwdmSMaiSa0g6__TPg&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Took broker 4 offline &#8212; which held replicas for partitions &#160;&lt;tt&gt;0, 3, 4, 5, 7, 8, 9&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Deleted topic &lt;tt&gt;foo.test&lt;/tt&gt; &#8212; The deletion process was successful, despite the fact that broker 4 still held replicas for partitions &lt;tt&gt;0, 3, 4, 5, 7, 8, 9&lt;/tt&gt; on local disk.&lt;/li&gt;
	&lt;li&gt;Recreated topic &lt;tt&gt;foo.test&lt;/tt&gt; with 10 partitions and 4 replicas. &#8212; Topic &lt;tt&gt;foo.test&lt;/tt&gt; was created with topic ID &lt;tt&gt;RzalpqQ9Q7ub2M2afHxY4Q&lt;/tt&gt; and partitions &lt;tt&gt;0, 1, 2, 7, 8, 9&lt;/tt&gt; got assigned to broker 4 (which was still offline). Notice here that partitions &lt;tt&gt;0, 7, 8, 9&lt;/tt&gt; are common between the assignment of the deleted topic (&lt;tt&gt;topic_id: MfuZbwdmSMaiSa0g6__TPg&lt;/tt&gt;) and the recreated topic (&lt;tt&gt;topic_id: RzalpqQ9Q7ub2M2afHxY4Q&lt;/tt&gt;).&lt;/li&gt;
	&lt;li&gt;Brough broker 4 back online.&lt;/li&gt;
	&lt;li&gt;Broker started to create new partition replicas for the recreated topic &lt;tt&gt;foo.test&lt;/tt&gt; (&lt;tt&gt;topic_id: RzalpqQ9Q7ub2M2afHxY4Q&lt;/tt&gt;)&lt;/li&gt;
	&lt;li&gt;The broker hit the following error &lt;tt&gt;Tried to assign topic ID RzalpqQ9Q7ub2M2afHxY4Q to log for topic partition foo.test-9,but log already contained topic ID MfuZbwdmSMaiSa0g6__TPg&lt;/tt&gt; . As a result of this error the broker decided to rename log dir for partitions &lt;tt&gt;0, 3, 4, 5, 7, 8, 9&lt;/tt&gt; to &lt;tt&gt;&amp;lt;topic&amp;gt;-&amp;lt;partition&amp;gt;.&amp;lt;uuid&amp;gt;-delete&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;Ran &lt;tt&gt;ls &amp;lt;log.dir_path&amp;gt;&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
foo.test-0.658f87fb9a2e42a590b5d7dcc28862b5-delete/
foo.test-1/
foo.test-2/
foo.test-3.a68f05d05bcc4e579087551b539af311-delete/
foo.test-4.79ce30a5310d4950ad1b28f226f74895-delete/
foo.test-5.76ed04da75bf46c3a63342be1eb44450-delete/
foo.test-6/
foo.test-7.c2d33db3bf844e9ebbcd9ef22f5270da-delete/
foo.test-8.33836969ac714b41b69b5334a5068ce0-delete/
foo.test-9.48e1494f4fac48c8aec009bf77d5e4ee-delete/&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160; &#160; &#160; 9. Waited until the deletion of the old topic was done and ran &lt;tt&gt;ls &amp;lt;log.dir_path&amp;gt;&lt;/tt&gt; again, now we were expecting to see log dir for partitions &lt;tt&gt;0, 1, 2, 7, 8, 9&lt;/tt&gt; however the result is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
foo.test-1/
foo.test-2/
foo.test-6/&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160; &#160; &#160;10. Ran &lt;tt&gt;kafka-topics.sh --command-config cmd.properties --bootstrap-server &amp;lt;bootstrap&amp;gt; --describe --topic foo.test&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Topic: foo.test TopicId: RzalpqQ9Q7ub2M2afHxY4Q PartitionCount: 10 ReplicationFactor: 4 Configs: min.insync.replicas=2,segment.bytes=1073741824,max.message.bytes=3145728,unclean.leader.election.enable=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;,retention.bytes=1000000000
Topic: foo.test Partition: 0 Leader: 2 Replicas: 2,3,4,5 Isr: 2,3,5
Topic: foo.test Partition: 1 Leader: 3 Replicas: 3,4,5,6 Isr: 3,5,6,4
Topic: foo.test Partition: 2 Leader: 5 Replicas: 5,4,6,1 Isr: 5,6,1,4
Topic: foo.test Partition: 3 Leader: 5 Replicas: 5,6,1,2 Isr: 5,6,1,2
Topic: foo.test Partition: 4 Leader: 6 Replicas: 6,1,2,3 Isr: 6,1,2,3
Topic: foo.test Partition: 5 Leader: 1 Replicas: 1,6,2,5 Isr: 1,6,2,5
Topic: foo.test Partition: 6 Leader: 6 Replicas: 6,2,5,4 Isr: 6,2,5,4
Topic: foo.test Partition: 7 Leader: 2 Replicas: 2,5,4,3 Isr: 2,5,3
Topic: foo.test Partition: 8 Leader: 5 Replicas: 5,4,3,1 Isr: 5,3,1
Topic: foo.test Partition: 9 Leader: 3 Replicas: 3,4,1,6 Isr: 3,1,6&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here&#8217;s a sample of broker logs&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2023-01-11T15:19:53,620Z&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka-scheduler-8&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Deleted log &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; partition foo.test-9 in /kafka/d1/data/foo.test-9.48e1494f4fac48c8aec009bf77d5e4ee-delete.&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka.log.LogManager&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2023-01-11T15:19:53,617Z&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka-scheduler-8&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Deleted time index /kafka/d1/data/foo.test-9.48e1494f4fac48c8aec009bf77d5e4ee-delete/00000000000000000000.timeindex.deleted.&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka.log.LogSegment&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2023-01-11T15:19:53,617Z&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka-scheduler-8&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Deleted offset index /kafka/d1/data/foo.test-9.48e1494f4fac48c8aec009bf77d5e4ee-delete/00000000000000000000.index.deleted.&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka.log.LogSegment&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2023-01-11T15:19:53,615Z&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka-scheduler-8&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Deleted log /kafka/d1/data/foo.test-9.48e1494f4fac48c8aec009bf77d5e4ee-delete/00000000000000000000.log.deleted.&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka.log.LogSegment&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2023-01-11T15:19:53,614Z&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka-scheduler-8&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;[LocalLog partition=foo.test-9, dir=/kafka/d1/data] Deleting segment files LogSegment(baseOffset=0, size=0, lastModifiedTime=1673439574661, largestRecordTimestamp=None)&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka.log.LocalLog$&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2023-01-11T15:19:53,612Z&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka-scheduler-8&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;[LocalLog partition=foo.test-9, dir=/kafka/d1/data] Deleting segments as the log has been deleted: LogSegment(baseOffset=0, size=0, lastModifiedTime=1673439574661, largestRecordTimestamp=None)&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka.log.LocalLog&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2023-01-11T15:18:53,611Z&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;EventHandler&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Log &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; partition foo.test-9 is renamed to /kafka/d1/data/foo.test-9.48e1494f4fac48c8aec009bf77d5e4ee-delete and is scheduled &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; deletion&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka.log.LogManager&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2023-01-11T15:18:53,596Z&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;EventHandler&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Found stray log dir Log(dir=/kafka/d1/data/foo.test-4, topicId=MfuZbwdmSMaiSa0g6__TPg, topic=foo.test, partition=4, highWatermark=0, lastStableOffset=0, logStartOffset=0, logEndOffset=0): the topicId MfuZbwdmSMaiSa0g6__TPg does not exist in the metadata image&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka.server.metadata.BrokerMetadataPublisher$&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2023-01-11T15:18:51,578Z&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;EventHandler&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;[Broker id=4] Unable to start fetching foo.test-9 with topic ID RzalpqQ9Q7ub2M2afHxY4Q due to InconsistentTopicIdException&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;state.change.logger&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;throwable&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;class&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.kafka.common.errors.InconsistentTopicIdException&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;msg&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Tried to assign topic ID RzalpqQ9Q7ub2M2afHxY4Q to log &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; topic partition foo.test-9,but log already contained topic ID MfuZbwdmSMaiSa0g6__TPg&quot;&lt;/span&gt;}}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2023-01-11T15:18:51,577Z&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;EventHandler&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;[Broker id=4] Creating &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; partition foo.test-9 with topic id RzalpqQ9Q7ub2M2afHxY4Q.&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;state.change.logger&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2023-01-11T15:18:51,465Z&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;log-recovery-/kafka/d1/data-0&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Completed load of Log(dir=/kafka/d1/data/foo.test-9, topicId=MfuZbwdmSMaiSa0g6__TPg, topic=foo.test, partition=9, highWatermark=0, lastStableOffset=0, logStartOffset=0, logEndOffset=0) with 1 segments in 4ms (41/46 completed in /kafka/d1/data)&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka.log.LogManager&quot;&lt;/span&gt;}
{&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2023-01-11T15:18:51,464Z&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;level&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;INFO&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;thread&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;log-recovery-/kafka/d1/data-0&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;message&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;[LogLoader partition=foo.test-9, dir=/kafka/d1/data] Loading producer state till offset 0 with message format version 2&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;logger&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka.log.UnifiedLog$&quot;&lt;/span&gt;}
&#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So what we noticed here is that KRaft didn&#8217;t recreate the log dir for partitions &lt;tt&gt;0, 7, 8, 9&lt;/tt&gt; for the recreated topic after it deleted them for the deleted topic.&lt;/p&gt;

&lt;p&gt;There&apos;re few behaviours here that are different than ZK mode (to the extent of our knowledge):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;In ZK mode deleting a topic is a blocking step for recreating the topic, so in our case in ZK mode, the deletion of &lt;tt&gt;foo.test&lt;/tt&gt; will be waiting for broker 4 to recover first, complete the deletion then a user can recreate the topic. (KIP-516 proposed changing the log.dir layout from &amp;lt;&lt;em&gt;&lt;tt&gt;topic&amp;gt;&amp;lt;partition&amp;gt;&lt;/tt&gt; format to `&lt;tt&gt;topicIdprefix&lt;/tt&gt;/&amp;lt;topicId&amp;gt;&amp;lt;&lt;/em&gt;partition&amp;gt;` but this has not been done yet&quot;.). While KRaft is fire and forget.&lt;/li&gt;
	&lt;li&gt;In ZK mode, creating a new topic doesn&apos;t assign partitions to non-active brokers. In the scenario we faced, the behavior of KRaft seems to be different. KRaft assigned partitions to broker 4 while broker 4 was down.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="13517858">KAFKA-14616</key>
            <summary>Topic recreation with offline broker causes permanent URPs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cmccabe">Colin McCabe</assignee>
                                    <reporter username="omnia_h_ibrahim">Omnia Ibrahim</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Jan 2023 13:53:29 +0000</created>
                <updated>Fri, 9 Feb 2024 12:20:32 +0000</updated>
                            <resolved>Fri, 9 Feb 2024 12:20:32 +0000</resolved>
                                    <version>3.3.1</version>
                                    <fixVersion>3.7.0</fixVersion>
                                    <component>kraft</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17807042" author="ijuma" created="Tue, 16 Jan 2024 05:28:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmccabe&quot; class=&quot;user-hover&quot; rel=&quot;cmccabe&quot;&gt;cmccabe&lt;/a&gt; Is this a blocker for 3.7.0?&lt;/p&gt;</comment>
                            <comment id="17816034" author="omnia_h_ibrahim" created="Fri, 9 Feb 2024 12:19:11 +0000"  >&lt;p&gt;I&apos;ll mark this as resolved as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cmccabe&quot; class=&quot;user-hover&quot; rel=&quot;cmccabe&quot;&gt;cmccabe&lt;/a&gt; committed the pr.&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1erhs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>