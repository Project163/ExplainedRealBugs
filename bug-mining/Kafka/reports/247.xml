<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:37:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-828] Preferred Replica Election does not delete the admin path on controller failover</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-828</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description></description>
                <environment></environment>
        <key id="12639173">KAFKA-828</key>
            <summary>Preferred Replica Election does not delete the admin path on controller failover</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="swapnilghike">Swapnil Ghike</assignee>
                                    <reporter username="swapnilghike">Swapnil Ghike</reporter>
                        <labels>
                            <label>bugs</label>
                            <label>kafka-0.8</label>
                            <label>p1</label>
                    </labels>
                <created>Tue, 26 Mar 2013 19:56:52 +0000</created>
                <updated>Thu, 28 Mar 2013 15:51:27 +0000</updated>
                            <resolved>Thu, 28 Mar 2013 15:51:23 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                                                            <comments>
                            <comment id="13614632" author="swapnilghike" created="Tue, 26 Mar 2013 22:35:11 +0000"  >&lt;p&gt;1. Moving removePartitionsFromPreferredReplicaElection() to onPreferredReplicaElection() so that when a controller fails over and tries to complete the preferred replica election, the admin path is deleted.&lt;/p&gt;

&lt;p&gt;2. Moved the parsePreferredReplicaElectionData() to ZkUtils from the admin.PreferredReplicaLeaderElectionCommand. There was also another function in ZkUtils for the same purpose and it was outdated, removed it.&lt;/p&gt;</comment>
                            <comment id="13614638" author="swapnilghike" created="Tue, 26 Mar 2013 22:46:18 +0000"  >&lt;p&gt;Converted &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-814&quot; title=&quot;Controller should not throw exception when a preferred replica is already the leader for a partition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-814&quot;&gt;&lt;del&gt;KAFKA-814&lt;/del&gt;&lt;/a&gt; to subtask of this as Sriram asked to. Added a one line change to PreferredReplicaLeaderSelector to log instead of throwing an exception if the preferred leader is already the current leader.&lt;/p&gt;</comment>
                            <comment id="13614809" author="swapnilghike" created="Wed, 27 Mar 2013 02:09:25 +0000"  >&lt;p&gt;Actually since preferred replica election is not a heavy weight operation like partition reassignment (where we need to wait until the new followers catch up etc), we can move reading of the controllerContext.partitionsUndergoingPreferredReplicaElection to inside the controllerLock. Attached patch v3.&lt;/p&gt;</comment>
                            <comment id="13615355" author="junrao" created="Wed, 27 Mar 2013 15:01:41 +0000"  >&lt;p&gt;Thanks for patch v3. A couple of comments:&lt;/p&gt;

&lt;p&gt;1. There is a compilation error&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt; /Users/jrao/intellij_workspace/kafka_git/core/src/main/scala/kafka/controller/PartitionLeaderSelector.scala:129: type mismatch;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt;  found   : Unit&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt;  required: (kafka.api.LeaderAndIsr, Seq&lt;span class=&quot;error&quot;&gt;&amp;#91;Int&amp;#93;&lt;/span&gt;)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt;       info(&quot;Preferred replica %d is already the current leader for partition %s&quot;.format(preferredReplica, topicAndPartition))&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt;           ^&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;error&amp;#93;&lt;/span&gt; one error found&lt;/p&gt;

&lt;p&gt;2. PreferredReplicaPartitionLeaderSelector: Is there any value in logging the following?&lt;br/&gt;
      info(&quot;Preferred replica %d is already the current leader for partition %s&quot;.format(preferredReplica, topicAndPartition))&lt;br/&gt;
The same info will be logged in KafkaController.removePartitionsFromPreferredReplicaElection().&lt;/p&gt;

&lt;p&gt;3. ZkUtils.parsePreferredReplicaElectionData: This is very specific to preferred replica election. So, it&apos;s better to move it to  PreferredReplicaLeaderElectionCommand.&lt;/p&gt;</comment>
                            <comment id="13615416" author="nehanarkhede" created="Wed, 27 Mar 2013 15:49:42 +0000"  >&lt;p&gt;Agree with Jun on 1, 2 and 3.&lt;/p&gt;

&lt;p&gt;The issue with your change to the leader selector is that it doesn&apos;t achieve the objective of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-814&quot; title=&quot;Controller should not throw exception when a preferred replica is already the leader for a partition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-814&quot;&gt;&lt;del&gt;KAFKA-814&lt;/del&gt;&lt;/a&gt; completely. If a preferred replica is already the leader, we &lt;b&gt;do not&lt;/b&gt; want to update zookeeper and send the become leader request to the replica again. It should just continue to work on the next partition. It doesn&apos;t achieve that. One way of handling that is throwing a special exception LeaderAlreadyElectedException (or a better name) and then catching and swallowing it inside electLeaderForPartition() &lt;/p&gt;</comment>
                            <comment id="13616098" author="swapnilghike" created="Thu, 28 Mar 2013 06:28:48 +0000"  >&lt;p&gt;Agree with all comments, uploading patch v4. &lt;/p&gt;

&lt;p&gt;Defined a new LeaderElectionNotNeededException that is thrown in selectLeader() when the current leader is the same as the preferred replica. electLeaderForPartition() swallows it.&lt;/p&gt;

&lt;p&gt;Thanks for the reviews and sorry, I was quite lousy while including the patch for 814.&lt;/p&gt;</comment>
                            <comment id="13616364" author="nehanarkhede" created="Thu, 28 Mar 2013 15:44:29 +0000"  >&lt;p&gt;Thanks for the patch ! +1&lt;/p&gt;</comment>
                            <comment id="13616371" author="nehanarkhede" created="Thu, 28 Mar 2013 15:51:23 +0000"  >&lt;p&gt;Committed patch v4&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12575600" name="kafka-828-v1.patch" size="8410" author="swapnilghike" created="Tue, 26 Mar 2013 22:35:11 +0000"/>
                            <attachment id="12575601" name="kafka-828-v2.patch" size="9564" author="swapnilghike" created="Tue, 26 Mar 2013 22:46:18 +0000"/>
                            <attachment id="12575639" name="kafka-828-v3.patch" size="9699" author="swapnilghike" created="Wed, 27 Mar 2013 02:09:25 +0000"/>
                            <attachment id="12575835" name="kafka-828-v4.patch" size="11987" author="swapnilghike" created="Thu, 28 Mar 2013 06:28:48 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12637794">KAFKA-814</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319643</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1j5hz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319984</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>