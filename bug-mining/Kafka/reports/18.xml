<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:34:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-126] Log flush should complete upon broker shutdown</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-126</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Broker shutdown currently forces the flush scheduler to shutdown(Now). This leads to an unclean shutdown. cleanupLogs may be affected by a similar scenario.&lt;/p&gt;

&lt;p&gt;2011/08/31 09:45:34.833 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;LogManager&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-logflusher-0&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Error flushing topic MyTopic&lt;br/&gt;
java.nio.channels.ClosedByInterruptException&lt;br/&gt;
        at java.nio.channels.spi.AbstractInterruptibleChannel.end(AbstractInterruptibleChannel.java:184)&lt;br/&gt;
        at sun.nio.ch.FileChannelImpl.force(FileChannelImpl.java:362)&lt;br/&gt;
        at kafka.message.FileMessageSet.flush(FileMessageSet.scala:174)&lt;br/&gt;
        at kafka.log.Log.flush(Log.scala:306)&lt;br/&gt;
        at kafka.log.LogManager$$anonfun$kafka$log$LogManager$$flushAllLogs$1.apply(LogManager.scala:274)&lt;br/&gt;
        at kafka.log.LogManager$$anonfun$kafka$log$LogManager$$flushAllLogs$1.apply(LogManager.scala:263)&lt;br/&gt;
        at scala.collection.Iterator$class.foreach(Iterator.scala:631)&lt;br/&gt;
        at kafka.utils.IteratorTemplate.foreach(IteratorTemplate.scala:30)&lt;br/&gt;
        at kafka.log.LogManager.kafka$log$LogManager$$flushAllLogs(LogManager.scala:263)&lt;br/&gt;
        at kafka.log.LogManager$$anonfun$startup$1.apply$mcV$sp(LogManager.scala:129)&lt;br/&gt;
        at kafka.utils.Utils$$anon$2.run(Utils.scala:58)&lt;br/&gt;
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)&lt;br/&gt;
        at java.util.concurrent.FutureTask$Sync.innerRunAndReset(FutureTask.java:317)&lt;br/&gt;
        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:150)&lt;br/&gt;
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$101(ScheduledThreadPoolExecutor.java:98)&lt;br/&gt;
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.runPeriodic(ScheduledThreadPoolExecutor.java:181)&lt;br/&gt;
        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:205)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;A possible fix this would be to use shutdown() instead of shutdownNow() in the scheduler.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12520992">KAFKA-126</key>
            <summary>Log flush should complete upon broker shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jjkoshy">Joel Jacob Koshy</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Aug 2011 23:58:46 +0000</created>
                <updated>Wed, 5 Oct 2011 23:05:58 +0000</updated>
                            <resolved>Mon, 26 Sep 2011 17:35:11 +0000</resolved>
                                                    <fixVersion>0.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13105612" author="jjkoshy" created="Thu, 15 Sep 2011 19:08:29 +0000"  >&lt;p&gt;This is pretty much the simple fix that I suggested in the description. i.e., change the shutdown behavior of KafkaScheduler to use shutdown() instead of shutdownNow(). I also added a shutdownNow() method to KafkaScheduler for access to the immediate shutdown behavior.&lt;/p&gt;

&lt;p&gt;For testing: I changed the flush settings to:&lt;br/&gt;
log.flush.interval=10000&lt;br/&gt;
log.default.flush.interval.ms=0&lt;br/&gt;
log.default.flush.scheduler.interval.ms=20&lt;br/&gt;
ran ProducerPerformance and shut down the broker a couple of times. These settings consistently reproduce the exception without this fix.&lt;/p&gt;

&lt;p&gt;The other usages of shutdown (now called shutdownNow) are by the zookeeper offset committer, and the LogManager&apos;s log cleanup. I think these schedulers should also switch to using shutdown() and that is accomplished by this patch.&lt;/p&gt;

&lt;p&gt;Finally, I&apos;m piggy backing an small unrelated warning message in the producer config - i.e. when both zk.connect and broker.list are specified, zk.connect takes precedence. (Let me know if you prefer this to be removed from this patch.)&lt;/p&gt;</comment>
                            <comment id="13105804" author="nehanarkhede" created="Fri, 16 Sep 2011 01:26:27 +0000"  >&lt;p&gt;Using the executor shutdown API, the process would block until the currently executing thread finishes execution. I guess that works fine unless for some odd reason, the thread blocks on one action forever, in which case the process would have to be killed manually. I can&apos;t imagine of a concrete example of when it could block forever though. &lt;/p&gt;

&lt;p&gt;On the other hand, I guess that if/when that kind of blocking happens, it is a serious problem/bug that needs attention anyways. So using the shutdown() API looks like a good approach. &lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13108788" author="junrao" created="Tue, 20 Sep 2011 15:46:50 +0000"  >&lt;p&gt;Thanks Joel for the patch. The zookeeper offset committer should use shutdownNow. If there is anything wrong with ZK server, we still want to be able to shut down a consumer immedidately.&lt;/p&gt;</comment>
                            <comment id="13109153" author="jjkoshy" created="Wed, 21 Sep 2011 01:08:12 +0000"  >&lt;p&gt;That makes sense. Here is the updated patch.&lt;/p&gt;</comment>
                            <comment id="13109154" author="jjkoshy" created="Wed, 21 Sep 2011 01:10:37 +0000"  >&lt;p&gt;Oops - forgot to rebase.&lt;/p&gt;</comment>
                            <comment id="13114834" author="junrao" created="Mon, 26 Sep 2011 17:35:11 +0000"  >&lt;p&gt;Thanks, Joel. Just committed this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12525982">KAFKA-148</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12494678" name="KAFKA-126_v1.patch" size="2969" author="jjkoshy" created="Thu, 15 Sep 2011 19:08:29 +0000"/>
                            <attachment id="12495301" name="KAFKA-126_v2.patch" size="11381" author="jjkoshy" created="Wed, 21 Sep 2011 01:08:12 +0000"/>
                            <attachment id="12495302" name="KAFKA-126_v3.patch" size="3843" author="jjkoshy" created="Wed, 21 Sep 2011 01:10:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3201</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i15z1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242979</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>