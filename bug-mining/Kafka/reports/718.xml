<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:43:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2241] AbstractFetcherThread.shutdown() should not block on ReadableByteChannel.read(buffer)</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2241</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;This is likely a bug from Java. This affects Kafka and here is the patch to fix it.&lt;/p&gt;

&lt;p&gt;Here is the description of the bug. By description of SocketChannel in Java 7 Documentation. If another thread interrupts the current thread while the read operation is in progress, the it should closes the channel and throw ClosedByInterruptException. However, we find that interrupting the thread will not unblock the channel immediately. Instead, it waits for response or socket timeout before throwing an exception.&lt;/p&gt;

&lt;p&gt;This will cause problem in the following scenario. Suppose one console_consumer_1 is reading from a topic, and due to quota delay or whatever reason, it block on channel.read(buffer). At this moment, another console_consumer_2 joins and triggers rebalance at console_consumer_1. But consumer_1 will block waiting on the channel.read before it can release partition ownership, causing consumer_2 to fail after a number of failed attempts to obtain partition ownership.&lt;/p&gt;

&lt;p&gt;In other words, AbstractFetcherThread.shutdown() is not guaranteed to shutdown due to this bug.&lt;/p&gt;

&lt;p&gt;The problem is confirmed with Java 1.7 and java 1.6. To check it by yourself, you can use the attached server.java and client.java &amp;#8211; start the server before the client and see if client unblock after interruption.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12834854">KAFKA-2241</key>
            <summary>AbstractFetcherThread.shutdown() should not block on ReadableByteChannel.read(buffer)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lindong">Dong Lin</assignee>
                                    <reporter username="lindong">Dong Lin</reporter>
                        <labels>
                            <label>quotas</label>
                    </labels>
                <created>Tue, 2 Jun 2015 22:49:04 +0000</created>
                <updated>Thu, 16 Jul 2015 23:39:05 +0000</updated>
                            <resolved>Thu, 16 Jul 2015 23:39:05 +0000</resolved>
                                                    <fixVersion>0.9.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14569928" author="lindong" created="Tue, 2 Jun 2015 22:51:27 +0000"  >&lt;p&gt;Run server before client. Then check if channel.read() will unblock after the thread is interrupted.&lt;/p&gt;</comment>
                            <comment id="14569934" author="ijuma" created="Tue, 2 Jun 2015 22:54:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lindong&quot; class=&quot;user-hover&quot; rel=&quot;lindong&quot;&gt;lindong&lt;/a&gt;, it looks like you filed two issues for the same thing &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2240&quot; title=&quot;AbstractFetcherThread.shutdown() should not block on ReadableByteChannel.read(buffer)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2240&quot;&gt;&lt;del&gt;KAFKA-2240&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2241&quot; title=&quot;AbstractFetcherThread.shutdown() should not block on ReadableByteChannel.read(buffer)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-2241&quot;&gt;&lt;del&gt;KAFKA-2241&lt;/del&gt;&lt;/a&gt;. Maybe close one of them as a duplicate?&lt;/p&gt;</comment>
                            <comment id="14569988" author="lindong" created="Tue, 2 Jun 2015 23:38:36 +0000"  >&lt;p&gt;Oh, I thought the first issue creation has failed.&lt;/p&gt;

&lt;p&gt;Thanks for your notice.&lt;/p&gt;</comment>
                            <comment id="14570010" author="lindong" created="Tue, 2 Jun 2015 23:54:02 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/34965/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/34965/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14571766" author="lindong" created="Wed, 3 Jun 2015 22:30:47 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/34965/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/34965/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14584140" author="junrao" created="Fri, 12 Jun 2015 21:46:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lindong&quot; class=&quot;user-hover&quot; rel=&quot;lindong&quot;&gt;lindong&lt;/a&gt;, thanks for reporting this. Does this happen on java 8?&lt;/p&gt;</comment>
                            <comment id="14584381" author="lindong" created="Sat, 13 Jun 2015 01:47:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; No, this bug is fixed in java 1.8.0.&lt;/p&gt;

&lt;p&gt;Can you let me know if we should drop this ticket?&lt;/p&gt;</comment>
                            <comment id="14615627" author="lindong" created="Mon, 6 Jul 2015 20:48:19 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt;, could you please review this patch when you have time?&lt;/p&gt;</comment>
                            <comment id="14621396" author="lindong" created="Thu, 9 Jul 2015 22:36:01 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/34965/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/34965/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14625284" author="lindong" created="Mon, 13 Jul 2015 20:30:17 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/34965/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/34965/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14625428" author="lindong" created="Mon, 13 Jul 2015 21:52:08 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/34965/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/34965/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14630537" author="junrao" created="Thu, 16 Jul 2015 23:39:05 +0000"  >&lt;p&gt;Thanks for the patch. +1 and committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12737046" name="KAFKA-2241.patch" size="2166" author="lindong" created="Tue, 2 Jun 2015 23:54:02 +0000"/>
                            <attachment id="12737387" name="KAFKA-2241_2015-06-03_15:30:35.patch" size="2645" author="lindong" created="Wed, 3 Jun 2015 22:30:47 +0000"/>
                            <attachment id="12744589" name="KAFKA-2241_2015-07-09_15:35:49.patch" size="2635" author="lindong" created="Thu, 9 Jul 2015 22:36:00 +0000"/>
                            <attachment id="12745113" name="KAFKA-2241_2015-07-13_13:30:07.patch" size="2608" author="lindong" created="Mon, 13 Jul 2015 20:30:17 +0000"/>
                            <attachment id="12745133" name="KAFKA-2241_2015-07-13_14:51:42.patch" size="2614" author="lindong" created="Mon, 13 Jul 2015 21:52:07 +0000"/>
                            <attachment id="12737033" name="client.java" size="2288" author="lindong" created="Tue, 2 Jun 2015 22:51:27 +0000"/>
                            <attachment id="12737032" name="server.java" size="1464" author="lindong" created="Tue, 2 Jun 2015 22:51:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fjmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>junrao</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>