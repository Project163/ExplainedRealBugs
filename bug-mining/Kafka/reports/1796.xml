<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:06:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6467] Enforce layout of dependencies within a Connect plugin to be deterministic</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6467</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In principle, Connect plugins that intend to load their dependencies in isolation should not contain any conflicts&#160;among the classes they package as dependencies. In other words, the order in which a plugin&apos;s dependencies are laid out and passed to its plugin class loader should not matter.&lt;/p&gt;

&lt;p&gt;However, in practice, there are rare and suboptimal situations where a plugin needs to bundle a few packages with conflicting dependencies because it doesn&apos;t control packaging of third-party modules. In those cases depending on a deterministic ordering within the class loader&apos;s path can help the Connect plugin enforce loading of the desired classes as needed. (For example, see &lt;a href=&quot;https://github.com/confluentinc/kafka-connect-hdfs/issues/270&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;HDFS connector with MapR libs&lt;/a&gt; or &lt;a href=&quot;https://github.com/confluentinc/kafka-connect-hdfs/issues/261&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;HDFS connector with Hive&apos;s extended jar&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;To achieve such ordering, this improvement suggests ordering a plugin&apos;s dependencies in a nested directory structure by sorting such paths alphanumerically. This way the deterministic order is implicit (no extra configuration is required) and a specific dependency can be put earlier or later in the class loader&apos;s path with appropriate naming of its package path (e.g. within the plugin&apos;s directory).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13132893">KAFKA-6467</key>
            <summary>Enforce layout of dependencies within a Connect plugin to be deterministic</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkonstantine">Konstantine Karantasis</assignee>
                                    <reporter username="kkonstantine">Konstantine Karantasis</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Jan 2018 00:03:30 +0000</created>
                <updated>Fri, 26 Jan 2018 16:52:44 +0000</updated>
                            <resolved>Fri, 26 Jan 2018 16:52:44 +0000</resolved>
                                    <version>0.11.0.2</version>
                    <version>1.0.0</version>
                                    <fixVersion>0.11.0.3</fixVersion>
                    <fixVersion>1.0.1</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16341253" author="githubbot" created="Fri, 26 Jan 2018 16:40:00 +0000"  >&lt;p&gt;hachikuji closed pull request #4459: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6467&quot; title=&quot;Enforce layout of dependencies within a Connect plugin to be deterministic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6467&quot;&gt;&lt;del&gt;KAFKA-6467&lt;/del&gt;&lt;/a&gt;: Enforce layout of dependencies within a connect plugin to be deterministic&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4459&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4459&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/PluginUtils.java b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/PluginUtils.java&lt;br/&gt;
index 9ef7c3a40e3..c1774e971aa 100644&lt;br/&gt;
&amp;#8212; a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/PluginUtils.java&lt;br/&gt;
+++ b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/isolation/PluginUtils.java&lt;br/&gt;
@@ -34,6 +34,7 @@&lt;br/&gt;
 import java.util.List;&lt;br/&gt;
 import java.util.Locale;&lt;br/&gt;
 import java.util.Set;&lt;br/&gt;
+import java.util.TreeSet;&lt;/p&gt;

&lt;p&gt; /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Connect plugin utility methods.&lt;br/&gt;
@@ -208,7 +209,7 @@ public static boolean isClassFile(Path path) {&lt;br/&gt;
      */&lt;br/&gt;
     public static List&amp;lt;Path&amp;gt; pluginUrls(Path topPath) throws IOException {&lt;br/&gt;
         boolean containsClassFiles = false;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Set&amp;lt;Path&amp;gt; archives = new HashSet&amp;lt;&amp;gt;();&lt;br/&gt;
+        Set&amp;lt;Path&amp;gt; archives = new TreeSet&amp;lt;&amp;gt;();&lt;br/&gt;
         LinkedList&amp;lt;DirectoryEntry&amp;gt; dfs = new LinkedList&amp;lt;&amp;gt;();&lt;br/&gt;
         Set&amp;lt;Path&amp;gt; visited = new HashSet&amp;lt;&amp;gt;();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;diff --git a/connect/runtime/src/test/java/org/apache/kafka/connect/runtime/isolation/PluginUtilsTest.java b/connect/runtime/src/test/java/org/apache/kafka/connect/runtime/isolation/PluginUtilsTest.java&lt;br/&gt;
index f9532a6d8cb..61ece1c779e 100644&lt;br/&gt;
&amp;#8212; a/connect/runtime/src/test/java/org/apache/kafka/connect/runtime/isolation/PluginUtilsTest.java&lt;br/&gt;
+++ b/connect/runtime/src/test/java/org/apache/kafka/connect/runtime/isolation/PluginUtilsTest.java&lt;br/&gt;
@@ -26,6 +26,7 @@&lt;br/&gt;
 import java.nio.file.Path;&lt;br/&gt;
 import java.nio.file.Paths;&lt;br/&gt;
 import java.util.ArrayList;&lt;br/&gt;
+import java.util.Arrays;&lt;br/&gt;
 import java.util.Collections;&lt;br/&gt;
 import java.util.List;&lt;/p&gt;

&lt;p&gt;@@ -158,6 +159,22 @@ public void testPluginUrlsWithJars() throws Exception &lt;/p&gt;
{
         assertUrls(expectedUrls, PluginUtils.pluginUrls(pluginPath));
     }

&lt;p&gt;+    @Test&lt;br/&gt;
+    public void testOrderOfPluginUrlsWithJars() throws Exception &lt;/p&gt;
{
+        createBasicDirectoryLayout();
+        // Here this method is just used to create the files. The result is not used.
+        createBasicExpectedUrls();
+
+        List&amp;lt;Path&amp;gt; actual = PluginUtils.pluginUrls(pluginPath);
+        // &apos;simple-transform.jar&apos; is created first. In many cases, without sorting within the
+        // PluginUtils, this jar will be placed before &apos;another-transform.jar&apos;. However this is
+        // not guaranteed because a DirectoryStream does not maintain a certain order in its
+        // results. Besides this test case, sorted order in every call to assertUrls below.
+        int i = Arrays.toString(actual.toArray()).indexOf(&quot;another-transform.jar&quot;);
+        int j = Arrays.toString(actual.toArray()).indexOf(&quot;simple-transform.jar&quot;);
+        assertTrue(i &amp;lt; j);
+    }
&lt;p&gt;+&lt;br/&gt;
     @Test&lt;br/&gt;
     public void testPluginUrlsWithZips() throws Exception {&lt;br/&gt;
         createBasicDirectoryLayout();&lt;br/&gt;
@@ -262,9 +279,8 @@ private void createBasicDirectoryLayout() throws IOException {&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     private void assertUrls(List&amp;lt;Path&amp;gt; expected, List&amp;lt;Path&amp;gt; actual) &lt;/p&gt;
{
-        List&amp;lt;Path&amp;gt; actualCopy = new ArrayList&amp;lt;&amp;gt;(actual);
         Collections.sort(expected);
-        Collections.sort(actualCopy);
-        assertEquals(expected, actualCopy);
+        // not sorting &apos;actual&apos; because it should be returned sorted from withing the PluginUtils.
+        assertEquals(expected, actual);
     }
&lt;p&gt; }&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3p7zb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>hachikuji</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>