<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:40:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-17448] New consumer seek should update positions in background thread</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-17448</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In the new AsyncKafkaConsumer, a call to seek will update the positions in subscription state for the assigned partitions in the app thread (&lt;a href=&quot;https://github.com/apache/kafka/blob/c23b6b0365af5c58b76d8ad3fb628f766f95348f/clients/src/main/java/org/apache/kafka/clients/consumer/internals/AsyncKafkaConsumer.java#L796&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/c23b6b0365af5c58b76d8ad3fb628f766f95348f/clients/src/main/java/org/apache/kafka/clients/consumer/internals/AsyncKafkaConsumer.java#L796&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;This could lead to race conditions like we&apos;ve seen when subscription state changes in the app thread (over a set of assigned partitions), that could have been modified in the background thread, leading to errors on &quot;No current assignment for partition &quot; &lt;a href=&quot;https://github.com/apache/kafka/blob/c23b6b0365af5c58b76d8ad3fb628f766f95348f/clients/src/main/java/org/apache/kafka/clients/consumer/internals/SubscriptionState.java#L378&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/c23b6b0365af5c58b76d8ad3fb628f766f95348f/clients/src/main/java/org/apache/kafka/clients/consumer/internals/SubscriptionState.java#L378&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also, positions update is moved the background with &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-17066&quot; title=&quot;New consumer updateFetchPositions should perform all operations in background thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-17066&quot;&gt;&lt;del&gt;KAFKA-17066&lt;/del&gt;&lt;/a&gt; for the same reason, so even if the assignment does not change, we could have a race between the background setting positions to the committed offsets for instance, and the app thread setting them manually via seek.&#160;&lt;/p&gt;

&lt;p&gt;To avoid all of the above, we should have seek generate an event, send it to the background, and then update the subscription state when processing that event (similar to other api calls, ex, assign with &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-17064&quot; title=&quot;New consumer assign should update assignment in background thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-17064&quot;&gt;&lt;del&gt;KAFKA-17064&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13590563">KAFKA-17448</key>
            <summary>New consumer seek should update positions in background thread</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yangpoan">PoAn Yang</assignee>
                                    <reporter username="lianetm">Lianet Magrans</reporter>
                        <labels>
                            <label>consumer-threading-refactor</label>
                            <label>kip-848-client-support</label>
                    </labels>
                <created>Fri, 30 Aug 2024 11:25:36 +0000</created>
                <updated>Wed, 11 Sep 2024 18:10:15 +0000</updated>
                            <resolved>Wed, 11 Sep 2024 18:10:15 +0000</resolved>
                                    <version>3.7.0</version>
                    <version>3.7.1</version>
                    <version>3.8.0</version>
                                    <fixVersion>4.0.0</fixVersion>
                                    <component>clients</component>
                    <component>consumer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17878065" author="JIRAUSER300183" created="Fri, 30 Aug 2024 11:27:33 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=payang&quot; class=&quot;user-hover&quot; rel=&quot;payang&quot;&gt;payang&lt;/a&gt; , this issue is very similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-17064&quot; title=&quot;New consumer assign should update assignment in background thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-17064&quot;&gt;&lt;del&gt;KAFKA-17064&lt;/del&gt;&lt;/a&gt; you just fixed. If you have bandwidth this would probably be very familiar to you already &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="17878122" author="JIRAUSER300229" created="Fri, 30 Aug 2024 13:32:13 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lianetm&quot; class=&quot;user-hover&quot; rel=&quot;lianetm&quot;&gt;lianetm&lt;/a&gt;, thank you. I can handle it. &#128077;&lt;/p&gt;</comment>
                            <comment id="17878124" author="JIRAUSER300183" created="Fri, 30 Aug 2024 13:38:55 +0000"  >&lt;p&gt;Thanks! Let me know if you have questions or when you need help with reviews.&#160;&lt;/p&gt;</comment>
                            <comment id="17879653" author="kirktrue" created="Thu, 5 Sep 2024 17:59:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangpoan&quot; class=&quot;user-hover&quot; rel=&quot;yangpoan&quot;&gt;yangpoan&lt;/a&gt;&#8212;sorry for the nag, but can you mark this as Patch Available since the PR is out for review? Thanks!&lt;/p&gt;</comment>
                            <comment id="17879851" author="JIRAUSER300229" created="Fri, 6 Sep 2024 12:27:21 +0000"  >&lt;p&gt;Updated the Jira status. Thanks for the reminder.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13584512">KAFKA-17064</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13591544">KAFKA-17505</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1r5lc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>