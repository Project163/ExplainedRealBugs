<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:26:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-10716] Streams processId is unstable across restarts resulting in task mass migration</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-10716</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The new high availability feature of KIP-441 relies on deterministic assignment to produce an eventually-stable assignment. The HighAvailabilityTaskAssignor assigns tasks based on the unique processId assigned to each client, so if the same set of Kafka Streams applications participate in a rebalance it should generate the same task assignment every time.&lt;/p&gt;

&lt;p&gt;Unfortunately the processIds aren&apos;t stable across restarts. We generate a random UUID in the KafkaStreams constructor, so each time the process starts up it would be assigned a completely different processId. Unless this new processId happens to be in exactly the same order as the previous one, a single bounce or crash/restart can result in a large scale shuffling of tasks based on a completely different eventual assignment.&lt;/p&gt;

&lt;p&gt;Ultimately we should fix this via&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-10121&quot; title=&quot;Streams Task Assignment optimization design&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-10121&quot;&gt;KAFKA-10121&lt;/a&gt;, but that&apos;s a nontrivial undertaking and this bug merits some immediate relief if we don&apos;t intend to tackle the larger problem in the upcoming releases&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13340393">KAFKA-10716</key>
            <summary>Streams processId is unstable across restarts resulting in task mass migration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ableegoldman">A. Sophie Blee-Goldman</assignee>
                                    <reporter username="ableegoldman">A. Sophie Blee-Goldman</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Nov 2020 01:41:07 +0000</created>
                <updated>Fri, 5 Feb 2021 20:20:59 +0000</updated>
                            <resolved>Fri, 5 Feb 2021 20:20:54 +0000</resolved>
                                    <version>2.6.0</version>
                                    <fixVersion>2.6.2</fixVersion>
                    <fixVersion>2.7.1</fixVersion>
                    <fixVersion>2.8.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17231116" author="ableegoldman" created="Fri, 13 Nov 2020 02:45:18 +0000"  >&lt;p&gt;There are a few possible ways forward here:&lt;/p&gt;

&lt;p&gt;1) generate the processId from the client.id config, if specified. This requires users to set this config and ensure that it&apos;s unique to the instance&lt;br/&gt;
2) generate the processId from the group.instance.id, if specified. This would only work for static membership users&lt;br/&gt;
3) write/load the processId from the checkpoint file in task directories&lt;br/&gt;
4) write/load the processId from a single file in the top-level application directory&lt;/p&gt;

&lt;p&gt;Both 1 &amp;amp; 2 would be simple for us to implement, but somewhat obnoxious to require of a user just for basic functionality of their app. That said, if a user already has specified either the client.id or group.instance.id, I don&apos;t see any reason&#160;&lt;em&gt;not&lt;/em&gt; to&#160;generate the processId from that. This might be a good stop-gap measure, but not a good permanent solution. However if we plan to implement&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-10121&quot; title=&quot;Streams Task Assignment optimization design&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-10121&quot;&gt;KAFKA-10121&lt;/a&gt;&#160;right away then maybe it&apos;s best not to mess around with options 3 or 4&lt;/p&gt;

&lt;p&gt;Options 3 and 4 would be a bit trickier. Option 3 in particular seems to open up a lot of nasty possibilities, like the processId differing from one task directory to another, or even between threads in the same app. But Option 4 seems pretty clean: we load the processId file within the KafkaStreams constructor, and if it&apos;s not found we generate a random UUID like we do now. This would all happen before any threads are created so no need to worry about them synchronizing at all&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13338683">KAFKA-10678</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0kju8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>