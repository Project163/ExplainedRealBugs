<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:57:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4415] Reduce time to create and send MetadataUpdateRequest</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4415</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;As of current implementation, when controller receives ControlledShutdownRequest, it will 1) for every broker in the cluster, for every partition on the broker which wants to shutdown, create an instance of PartitionStateInfo and add it to ControllerBrokerRequestBatch.,updateMetadataRequestMap; and 2) for every broker, for every follower partitions on the broker which wants to shutdown, send one MetadataUpdateRequst to that broker.&lt;/p&gt;

&lt;p&gt;In order to shutdown a broker, the controller will need to instantiate O(partitionNum * brokerNum) PartitionStateInfo. This is not efficient. The broker should only need to instantiate O(partitionNum) PartitionStateInfo.&lt;/p&gt;

&lt;p&gt;Micro-benchmark results show that this optimization can reduce the time of processing ControlledShutdownRequest by 30%.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13021032">KAFKA-4415</key>
            <summary>Reduce time to create and send MetadataUpdateRequest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lindong">Dong Lin</assignee>
                                    <reporter username="lindong">Dong Lin</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Nov 2016 04:47:17 +0000</created>
                <updated>Wed, 30 Nov 2016 18:27:12 +0000</updated>
                            <resolved>Tue, 29 Nov 2016 22:35:41 +0000</resolved>
                                    <version>0.10.1.0</version>
                                    <fixVersion>0.10.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15669497" author="githubbot" created="Wed, 16 Nov 2016 05:32:45 +0000"  >&lt;p&gt;GitHub user lindong28 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4415&quot; title=&quot;Reduce time to create and send MetadataUpdateRequest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4415&quot;&gt;&lt;del&gt;KAFKA-4415&lt;/del&gt;&lt;/a&gt;; Reduce time to create and send MetadataUpdateRequest&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/lindong28/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/lindong28/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4415&quot; title=&quot;Reduce time to create and send MetadataUpdateRequest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4415&quot;&gt;&lt;del&gt;KAFKA-4415&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2141.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2141.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2141&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a317b6de574842298015121b8cd836512728141e&lt;br/&gt;
Author: Dong Lin &amp;lt;lindong28@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-11-16T05:30:03Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4415&quot; title=&quot;Reduce time to create and send MetadataUpdateRequest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4415&quot;&gt;&lt;del&gt;KAFKA-4415&lt;/del&gt;&lt;/a&gt;; Reduce time to create and send MetadataUpdateRequest&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15694808" author="githubbot" created="Fri, 25 Nov 2016 04:33:40 +0000"  >&lt;p&gt;GitHub user lindong28 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2169&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4415&quot; title=&quot;Reduce time to create and send MetadataUpdateRequest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4415&quot;&gt;&lt;del&gt;KAFKA-4415&lt;/del&gt;&lt;/a&gt;; Reduce time to create and send MetadataUpdateRequest&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/lindong28/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/lindong28/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4415&quot; title=&quot;Reduce time to create and send MetadataUpdateRequest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4415&quot;&gt;&lt;del&gt;KAFKA-4415&lt;/del&gt;&lt;/a&gt;-2nd&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2169.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2169.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2169&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 439f3bbbcb8503508939977df6d6243b3eecb2f0&lt;br/&gt;
Author: Dong Lin &amp;lt;lindong28@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-11-25T04:32:27Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4415&quot; title=&quot;Reduce time to create and send MetadataUpdateRequest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4415&quot;&gt;&lt;del&gt;KAFKA-4415&lt;/del&gt;&lt;/a&gt;; Reduce time to create and send MetadataUpdateRequest&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15706416" author="githubbot" created="Tue, 29 Nov 2016 20:18:37 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2169&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2169&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15708613" author="ijuma" created="Wed, 30 Nov 2016 13:35:33 +0000"  >&lt;p&gt;This is a good improvement, but I think the description is not completely accurate. We were sending O(brokerNum) requests, not O(partitionNum * brokerNum) as far as I can see:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/blob/3b4c347949c02b1e2b1dd473deda0f8d2304d027/core/src/main/scala/kafka/controller/ControllerChannelManager.scala#L404&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/3b4c347949c02b1e2b1dd473deda0f8d2304d027/core/src/main/scala/kafka/controller/ControllerChannelManager.scala#L404&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So, the improvement affects the memory usage and processing time, but not what was sent on the wire. If you agree, it would be good to update the description of the JIRA.&lt;/p&gt;</comment>
                            <comment id="15709345" author="lindong" created="Wed, 30 Nov 2016 18:27:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; As of current Kafka implementation, Kafka does send O(partitionNum * brokerNum) MetadataUpdateRequest when responding to ControlledShutdownRequest, where each MetadataUpdateRequest will contain only one partition. The optimization in &lt;a href=&quot;https://github.com/apache/kafka/pull/2141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2141&lt;/a&gt; can reduce it to O(brokerNum) MetadataUpdateRequest, where each request includes O(partitionNum) partitions. Originally I have included that fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4415&quot; title=&quot;Reduce time to create and send MetadataUpdateRequest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4415&quot;&gt;&lt;del&gt;KAFKA-4415&lt;/del&gt;&lt;/a&gt; as well. But I moved it out of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4415&quot; title=&quot;Reduce time to create and send MetadataUpdateRequest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4415&quot;&gt;&lt;del&gt;KAFKA-4415&lt;/del&gt;&lt;/a&gt; and put into &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4444&quot; title=&quot;Aggregate requests sent from controller to broker during controlled shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4444&quot;&gt;&lt;del&gt;KAFKA-4444&lt;/del&gt;&lt;/a&gt; because there is un-resolved problem in that optimization.&lt;/p&gt;

&lt;p&gt;I just updated the description of JIRA to make it accurate.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36dq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>