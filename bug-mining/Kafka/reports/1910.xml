<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:10:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6870] Concurrency conflicts in SampledStat</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6870</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The&#160;samples stored in&#160;SampledStat is not thread-safe. However, ReplicaFetcherThreads used to handle replica to specified brokers may update (when the&#160;samples is empty, we will add a new sample to it) and iterate the&#160;samples concurrently, and then cause the&#160;ConcurrentModificationException.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2018-05-03 13:50:56,087] ERROR [ReplicaFetcher replicaId=106, leaderId=100, fetcherId=0] Error due to (kafka.server.ReplicaFetcherThread:76)
java.util.ConcurrentModificationException
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.util.ArrayList$Itr.checkForComodification(ArrayList.java:909)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at java.util.ArrayList$Itr.next(ArrayList.java:859)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.kafka.common.metrics.stats.Rate$SampledTotal.combine(Rate.java:132)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.kafka.common.metrics.stats.SampledStat.measure(SampledStat.java:78)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.kafka.common.metrics.stats.Rate.measure(Rate.java:66)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.kafka.common.metrics.KafkaMetric.measurableValue(KafkaMetric.java:85)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.kafka.common.metrics.Sensor.checkQuotas(Sensor.java:201)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at org.apache.kafka.common.metrics.Sensor.checkQuotas(Sensor.java:192)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at kafka.server.ReplicationQuotaManager.isQuotaExceeded(ReplicationQuotaManager.scala:104)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at kafka.server.ReplicaFetcherThread.kafka$server$ReplicaFetcherThread$$shouldFollowerThrottle(ReplicaFetcherThread.scala:384)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at kafka.server.ReplicaFetcherThread$$anonfun$buildFetchRequest$1.apply(ReplicaFetcherThread.scala:263)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at kafka.server.ReplicaFetcherThread$$anonfun$buildFetchRequest$1.apply(ReplicaFetcherThread.scala:261)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at scala.collection.mutable.ResizableArray$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(ResizableArray.scala:59)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:48)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at kafka.server.ReplicaFetcherThread.buildFetchRequest(ReplicaFetcherThread.scala:261)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at kafka.server.AbstractFetcherThread$$anonfun$2.apply(AbstractFetcherThread.scala:102)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at kafka.server.AbstractFetcherThread$$anonfun$2.apply(AbstractFetcherThread.scala:101)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:250)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at kafka.server.AbstractFetcherThread.doWork(AbstractFetcherThread.scala:101)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;at kafka.utils.ShutdownableThread.run(ShutdownableThread.scala:82)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Before &lt;a href=&quot;https://github.com/apache/kafka/commit/d734f4e56d276f84b8c52b602edd67d41cbb6c35&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/commit/d734f4e56d276f84b8c52b602edd67d41cbb6c35&lt;/a&gt;&#160;the&#160;ConcurrentModificationException doesn&apos;t exist since all changes to&#160;samples is &quot;add&quot; currently. Using the get(index)&#160;is able to avoid the&#160;ConcurrentModificationException.&lt;/p&gt;

&lt;p&gt;In short, we can just make&#160;samples thread-safe. Or just replace the&#160;foreach loop by&#160;get(index) if we have concerns about the performance of thread-safe list...&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13157396">KAFKA-6870</key>
            <summary>Concurrency conflicts in SampledStat</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chia7712">Chia-Ping Tsai</assignee>
                                    <reporter username="chia7712">Chia-Ping Tsai</reporter>
                        <labels>
                    </labels>
                <created>Sun, 6 May 2018 05:48:01 +0000</created>
                <updated>Fri, 1 Jun 2018 19:05:22 +0000</updated>
                            <resolved>Thu, 10 May 2018 13:29:32 +0000</resolved>
                                                    <fixVersion>1.1.1</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16465207" author="ijuma" created="Sun, 6 May 2018 16:11:33 +0000"  >&lt;p&gt;Thanks for the report. There was a recent related by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;, but not sure if it was the same underlying issue. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;, can you please check?&lt;/p&gt;</comment>
                            <comment id="16468303" author="chia7712" created="Wed, 9 May 2018 04:05:28 +0000"  >&lt;p&gt;After reading the Sensor and KafkaMetrics,&#160;I feel we should make KafkaMetric#measurableValue thread-safe to resolve this issue. We have passed a lock to&#160;KafkaMetrics and&#160;KafkaMetrics should use the&#160;lock&#160;when trying to get the measure value from&#160;metricValueProvider. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt;&#160; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt; Any suggestions?&#160;&lt;/p&gt;</comment>
                            <comment id="16468538" author="rsivaram" created="Wed, 9 May 2018 08:18:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; This is a different issue from &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6765&quot; title=&quot;Intermittent test failure in CustomQuotaCallbackTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6765&quot;&gt;&lt;del&gt;KAFKA-6765&lt;/del&gt;&lt;/a&gt;, there is missing synchronization.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chia7712&quot; class=&quot;user-hover&quot; rel=&quot;chia7712&quot;&gt;chia7712&lt;/a&gt; Yes, I think it makes sense to add&#160; `synchronized(this.lock)` in `KafkaMetric#measurableValue`.&lt;/p&gt;</comment>
                            <comment id="16468540" author="chia7712" created="Wed, 9 May 2018 08:21:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;&#160; Could I take over this issue?&lt;/p&gt;</comment>
                            <comment id="16468545" author="rsivaram" created="Wed, 9 May 2018 08:26:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chia7712&quot; class=&quot;user-hover&quot; rel=&quot;chia7712&quot;&gt;chia7712&lt;/a&gt; Yes, of course. You can just assign it to yourself and submit a PR.&lt;/p&gt;</comment>
                            <comment id="16468549" author="chia7712" created="Wed, 9 May 2018 08:28:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;You can just assign it to yourself&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That is the problem. I can&apos;t assign this issue to myself...&lt;/p&gt;</comment>
                            <comment id="16468563" author="rsivaram" created="Wed, 9 May 2018 08:45:27 +0000"  >&lt;p&gt;What is your user id?&lt;/p&gt;</comment>
                            <comment id="16468565" author="chia7712" created="Wed, 9 May 2018 08:47:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;What is your user id?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;chia7712&lt;/p&gt;</comment>
                            <comment id="16468572" author="rsivaram" created="Wed, 9 May 2018 08:56:32 +0000"  >&lt;p&gt;I have added you as Contributor and assigned the Jira to you.&lt;/p&gt;</comment>
                            <comment id="16468575" author="chia7712" created="Wed, 9 May 2018 08:58:02 +0000"  >&lt;p&gt;Thanks! &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16468587" author="githubbot" created="Wed, 9 May 2018 09:23:08 +0000"  >&lt;p&gt;chia7712 opened a new pull request #4985: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6870&quot; title=&quot;Concurrency conflicts in SampledStat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6870&quot;&gt;&lt;del&gt;KAFKA-6870&lt;/del&gt;&lt;/a&gt; Concurrency conflicts in SampledStat&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4985&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4985&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   see &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6870&quot; title=&quot;Concurrency conflicts in SampledStat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6870&quot;&gt;&lt;del&gt;KAFKA-6870&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6870&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-6870&lt;/a&gt;) for more details.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16470241" author="githubbot" created="Thu, 10 May 2018 11:27:48 +0000"  >&lt;p&gt;rajinisivaram closed pull request #4985: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6870&quot; title=&quot;Concurrency conflicts in SampledStat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6870&quot;&gt;&lt;del&gt;KAFKA-6870&lt;/del&gt;&lt;/a&gt; Concurrency conflicts in SampledStat&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4985&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4985&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetric.java b/clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetric.java&lt;br/&gt;
index f04981aee39..48999e1057d 100644&lt;br/&gt;
&amp;#8212; a/clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetric.java&lt;br/&gt;
+++ b/clients/src/main/java/org/apache/kafka/common/metrics/KafkaMetric.java&lt;br/&gt;
@@ -55,9 +55,7 @@ public MetricName metricName() {&lt;br/&gt;
     @Override&lt;br/&gt;
     @Deprecated&lt;br/&gt;
     public double value() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;synchronized (this.lock) 
{
-            return measurableValue(time.milliseconds());
-        }
&lt;p&gt;+        return measurableValue(time.milliseconds());&lt;br/&gt;
     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Override&lt;br/&gt;
@@ -81,10 +79,12 @@ public Measurable measurable() {&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     double measurableValue(long timeMs) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (this.metricValueProvider instanceof Measurable)&lt;/li&gt;
	&lt;li&gt;return ((Measurable) metricValueProvider).measure(config, timeMs);&lt;/li&gt;
	&lt;li&gt;else&lt;/li&gt;
	&lt;li&gt;return 0;&lt;br/&gt;
+        synchronized (this.lock) 
{
+            if (this.metricValueProvider instanceof Measurable)
+                return ((Measurable) metricValueProvider).measure(config, timeMs);
+            else
+                return 0;
+        }
&lt;p&gt;     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     public void config(MetricConfig config) {&lt;br/&gt;
diff --git a/clients/src/test/java/org/apache/kafka/common/metrics/SensorTest.java b/clients/src/test/java/org/apache/kafka/common/metrics/SensorTest.java&lt;br/&gt;
index a1c0814c343..8e3dfeb3b9f 100644&lt;br/&gt;
&amp;#8212; a/clients/src/test/java/org/apache/kafka/common/metrics/SensorTest.java&lt;br/&gt;
+++ b/clients/src/test/java/org/apache/kafka/common/metrics/SensorTest.java&lt;br/&gt;
@@ -19,19 +19,29 @@&lt;br/&gt;
 import org.apache.kafka.common.MetricName;&lt;br/&gt;
 import org.apache.kafka.common.metrics.stats.Avg;&lt;br/&gt;
 import org.apache.kafka.common.metrics.stats.Meter;&lt;br/&gt;
+import org.apache.kafka.common.metrics.stats.Rate;&lt;br/&gt;
 import org.apache.kafka.common.metrics.stats.Sum;&lt;br/&gt;
 import org.apache.kafka.common.utils.MockTime;&lt;br/&gt;
 import org.apache.kafka.common.utils.SystemTime;&lt;br/&gt;
 import org.apache.kafka.common.utils.Time;&lt;br/&gt;
 import org.junit.Test;&lt;/p&gt;

&lt;p&gt;+import java.util.ArrayList;&lt;br/&gt;
 import java.util.Arrays;&lt;br/&gt;
 import java.util.Collections;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
 import java.util.Map;&lt;br/&gt;
+import java.util.concurrent.Callable;&lt;br/&gt;
+import java.util.concurrent.CountDownLatch;&lt;br/&gt;
+import java.util.concurrent.ExecutionException;&lt;br/&gt;
+import java.util.concurrent.ExecutorService;&lt;br/&gt;
+import java.util.concurrent.Executors;&lt;br/&gt;
+import java.util.concurrent.Future;&lt;br/&gt;
 import java.util.concurrent.TimeUnit;&lt;/p&gt;

&lt;p&gt; import static org.junit.Assert.assertEquals;&lt;br/&gt;
 import static org.junit.Assert.assertFalse;&lt;br/&gt;
+import static org.junit.Assert.assertNull;&lt;br/&gt;
 import static org.junit.Assert.assertTrue;&lt;br/&gt;
 import static org.junit.Assert.fail;&lt;/p&gt;

&lt;p&gt;@@ -124,4 +134,56 @@ public void testIdempotentAdd() &lt;/p&gt;
{
         assertEquals(1, sensor.metrics().size());
         assertEquals(org.apache.kafka.common.metrics.stats.Avg.class, sensor.metrics().get(0).measurable().getClass());
     }
&lt;p&gt;+&lt;br/&gt;
+    /**&lt;br/&gt;
+     * The Sensor#checkQuotas should be thread-safe since the method may be used by many ReplicaFetcherThreads.&lt;br/&gt;
+     */&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testCheckQuotasInMultiThreads() throws InterruptedException, ExecutionException {&lt;br/&gt;
+        final Metrics metrics = new Metrics(new MetricConfig().quota(Quota.upperBound(Double.MAX_VALUE))&lt;br/&gt;
+            // decreasing the value of time window make SampledStat always record the given value&lt;br/&gt;
+            .timeWindow(1, TimeUnit.MILLISECONDS)&lt;br/&gt;
+            // increasing the value of samples make SampledStat store more samples&lt;br/&gt;
+            .samples(100));&lt;br/&gt;
+        final Sensor sensor = metrics.sensor(&quot;sensor&quot;);&lt;br/&gt;
+&lt;br/&gt;
+        assertTrue(sensor.add(metrics.metricName(&quot;test-metric&quot;, &quot;test-group&quot;), new Rate()));&lt;br/&gt;
+        final int threadCount = 10;&lt;br/&gt;
+        final CountDownLatch latch = new CountDownLatch(1);&lt;br/&gt;
+        ExecutorService service = Executors.newFixedThreadPool(threadCount);&lt;br/&gt;
+        List&amp;lt;Future&amp;lt;Throwable&amp;gt;&amp;gt; workers = new ArrayList&amp;lt;&amp;gt;(threadCount);&lt;br/&gt;
+        boolean needShutdown = true;&lt;br/&gt;
+        try {&lt;br/&gt;
+            for (int i = 0; i != threadCount; ++i) {&lt;br/&gt;
+                final int index = i;&lt;br/&gt;
+                workers.add(service.submit(new Callable&amp;lt;Throwable&amp;gt;() {&lt;br/&gt;
+                    @Override&lt;br/&gt;
+                    public Throwable call() {&lt;br/&gt;
+                        try {&lt;br/&gt;
+                            assertTrue(latch.await(5, TimeUnit.SECONDS));&lt;br/&gt;
+                            for (int j = 0; j != 20; ++j) &lt;/p&gt;
{
+                                sensor.record(j * index, System.currentTimeMillis() + j, false);
+                                sensor.checkQuotas();
+                            }
&lt;p&gt;+                            return null;&lt;br/&gt;
+                        } catch (Throwable e) &lt;/p&gt;
{
+                            return e;
+                        }
&lt;p&gt;+                    }&lt;br/&gt;
+                }));&lt;br/&gt;
+            }&lt;br/&gt;
+            latch.countDown();&lt;br/&gt;
+            service.shutdown();&lt;br/&gt;
+            assertTrue(service.awaitTermination(10, TimeUnit.SECONDS));&lt;br/&gt;
+            needShutdown = false;&lt;br/&gt;
+            for (Future&amp;lt;Throwable&amp;gt; callable : workers) &lt;/p&gt;
{
+                assertTrue(&quot;If this failure happen frequently, we can try to increase the wait time&quot;, callable.isDone());
+                assertNull(&quot;Sensor#checkQuotas SHOULD be thread-safe!&quot;, callable.get());
+            }
&lt;p&gt;+        } finally {&lt;br/&gt;
+            if (needShutdown) &lt;/p&gt;
{
+                service.shutdownNow();
+            }
&lt;p&gt;+        }&lt;br/&gt;
+    }&lt;br/&gt;
 }&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16470389" author="chia7712" created="Thu, 10 May 2018 13:29:32 +0000"  >&lt;p&gt;Thanks for the reviews. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16497222" author="klafferty" created="Thu, 31 May 2018 21:39:08 +0000"  >&lt;p&gt;Assuming there will be a 1.0.2, can this fix be included there?&lt;/p&gt;</comment>
                            <comment id="16497450" author="chia7712" created="Fri, 1 Jun 2018 01:28:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;Assuming there will be a 1.0.2, can this fix be included there?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;m happy to backport this fix to 1.0.2. Should I file a PR against the branch 1.0?&lt;/p&gt;</comment>
                            <comment id="16498412" author="klafferty" created="Fri, 1 Jun 2018 19:05:22 +0000"  >&lt;p&gt;This depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6765&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;KAFKA-6765&lt;/a&gt;&#160;so that would have to be backported to 1.0 as well. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rsivaram&quot; class=&quot;user-hover&quot; rel=&quot;rsivaram&quot;&gt;rsivaram&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3tdun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rsivaram</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>