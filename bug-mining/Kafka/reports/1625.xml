<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:03:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5731] Connect WorkerSinkTask out of order offset commit can lead to inconsistent state</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5731</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In Connect&apos;s WorkerSinkTask, we do sequence number validation to ensure that offset commits are handled in the right order (&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSinkTask.java#L199&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSinkTask.java#L199&lt;/a&gt;). &lt;/p&gt;

&lt;p&gt;Unfortunately, for asynchronous commits, the &lt;tt&gt;lastCommittedOffsets&lt;/tt&gt; field is overridden regardless of this sequence check as long as the response had no error (&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSinkTask.java#L284):&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSinkTask.java#L284):&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            OffsetCommitCallback cb = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OffsetCommitCallback() {
                @Override
                &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void onComplete(Map&amp;lt;TopicPartition, OffsetAndMetadata&amp;gt; offsets, Exception error) {
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (error == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                        lastCommittedOffsets = offsets;
                    }
                    onCommitCompleted(error, seqno);
                }
            };
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Hence if we get an out of order commit, then the internal state will be inconsistent. To fix this, we should only override &lt;tt&gt;lastCommittedOffsets&lt;/tt&gt; after sequence validation as part of the &lt;tt&gt;onCommitCompleted(...)&lt;/tt&gt; method.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13094234">KAFKA-5731</key>
            <summary>Connect WorkerSinkTask out of order offset commit can lead to inconsistent state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhauch">Randall Hauch</assignee>
                                    <reporter username="hachikuji">Jason Gustafson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Aug 2017 23:18:31 +0000</created>
                <updated>Wed, 23 Aug 2017 01:35:07 +0000</updated>
                            <resolved>Wed, 16 Aug 2017 00:31:41 +0000</resolved>
                                                    <fixVersion>0.10.2.2</fixVersion>
                    <fixVersion>0.11.0.1</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16125090" author="githubbot" created="Sun, 13 Aug 2017 23:41:12 +0000"  >&lt;p&gt;GitHub user rhauch opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3662&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3662&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Corrected how the sink task worker updates the last committed offsets&lt;/p&gt;

&lt;p&gt;    Prior to this change, it was possible for the synchronous consumer commit request to be handled before previously-submitted asynchronous commit requests. If that happened, the out-of-order handlers improperly set the last committed offsets, which then became inconsistent with the offsets the connector task is working with.&lt;/p&gt;

&lt;p&gt;    This change ensures that the last committed offsets are updated only for the most recent commit request, even if the consumer reorders the calls to the callbacks.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rhauch/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rhauch/kafka&lt;/a&gt; kafka-5731&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3662.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3662.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3662&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit be34cf05fe6956a24b77b35a689bda7b55e7de12&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-12T00:42:06Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Corrected how the sink task worker updates the last committed offsets&lt;/p&gt;

&lt;p&gt;    Prior to this change, it was possible for the synchronous consumer commit request to be handled before previously-submitted asynchronous commit requests. If that happened, the out-of-order handlers improperly set the last committed offsets, which then became inconsistent with the offsets the connector task is working with.&lt;/p&gt;

&lt;p&gt;    This change ensures that the last committed offsets are updated only for the most recent commit request, even if the consumer reorders the calls to the callbacks.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16127882" author="githubbot" created="Tue, 15 Aug 2017 21:19:26 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3662&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3662&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16127960" author="githubbot" created="Tue, 15 Aug 2017 22:11:27 +0000"  >&lt;p&gt;GitHub user rhauch opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3672&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3672&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Corrected how the sink task worker updates the last committed offsets (0.11.0)&lt;/p&gt;

&lt;p&gt;    Prior to this change, it was possible for the synchronous consumer commit request to be handled before previously-submitted asynchronous commit requests. If that happened, the out-of-order handlers improperly set the last committed offsets, which then became inconsistent with the offsets the connector task is working with.&lt;/p&gt;

&lt;p&gt;    This change ensures that the last committed offsets are updated only for the most recent commit request, even if the consumer reorders the calls to the callbacks.&lt;/p&gt;

&lt;p&gt;    *&lt;b&gt;This is for the `0.11.0` branch; see #3662 for the equivalent and already-approved PR for `trunk`.&lt;/b&gt;*&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rhauch/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rhauch/kafka&lt;/a&gt; kafka-5731-0.11.0&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3672.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3672.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3672&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 526dbcb776effcc1661e51293a6d03256b19d0a6&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-12T00:42:06Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Corrected how the sink task worker updates the last committed offsets&lt;/p&gt;

&lt;p&gt;    Prior to this change, it was possible for the synchronous consumer commit request to be handled before previously-submitted asynchronous commit requests. If that happened, the out-of-order handlers improperly set the last committed offsets, which then became inconsistent with the offsets the connector task is working with.&lt;/p&gt;

&lt;p&gt;    This change ensures that the last committed offsets are updated only for the most recent commit request, even if the consumer reorders the calls to the callbacks.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Conflicts:&lt;/li&gt;
	&lt;li&gt;connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSinkTask.java&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;commit 80965cb5f8771e63b0dad095287cb9a29dea47f6&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-14T19:11:08Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Corrected mock consumer behavior during rebalance&lt;/p&gt;

&lt;p&gt;    Corrects the test case added in the previous commit to properly revoke the existing partition assignments before adding new partition assigments.&lt;/p&gt;

&lt;p&gt;commit 37687c544513566c7d728273137a12751702ad41&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-14T19:11:45Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Added expected call that was missing in another test&lt;/p&gt;

&lt;p&gt;commit bfac0688ab64935bc4ac9c11e0a6251ca03e1043&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-14T22:24:35Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Improved log messages related to offset commits&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Conflicts:&lt;/li&gt;
	&lt;li&gt;connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSinkTask.java&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;commit bbc316dfa4353a7e914d11ceaca2b60c1bdaf291&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-15T14:47:05Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; More cleanup of log messages related to offset commits&lt;/p&gt;

&lt;p&gt;commit 00b17ebbb5effb7f8aa171ea69b0227c7b009e97&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-15T16:21:52Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; More improvements to the log messages in WorkerSinkTask&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Conflicts:&lt;/li&gt;
	&lt;li&gt;connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSinkTask.java&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;commit 3a5c31f1b912e06aded4b74524c73dfe1033e76c&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-15T16:31:28Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Removed unnecessary log message&lt;/p&gt;

&lt;p&gt;commit 8b91f93e8c4c7b6b8e1aa6721f86ff01f8ecf40e&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-15T17:54:16Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Additional tweaks to debug and trace log messages to ensure clarity and usefulness&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Conflicts:&lt;/li&gt;
	&lt;li&gt;connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSinkTask.java&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;commit bea03f69055524e9005302200f3a560a9cad2c3f&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-15T19:30:09Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Use the correct value in trace messages&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16127965" author="rhauch" created="Tue, 15 Aug 2017 22:14:11 +0000"  >&lt;p&gt;Added a &lt;a href=&quot;https://github.com/apache/kafka/pull/3672&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;second pull request&lt;/a&gt; that can be merged onto the &lt;tt&gt;0.11.0&lt;/tt&gt; branch.&lt;/p&gt;</comment>
                            <comment id="16128150" author="hachikuji" created="Wed, 16 Aug 2017 00:31:41 +0000"  >&lt;p&gt;Issue resolved by pull request 3672&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/3672&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3672&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16128198" author="githubbot" created="Wed, 16 Aug 2017 01:47:16 +0000"  >&lt;p&gt;Github user rhauch closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3672&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3672&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16137605" author="githubbot" created="Tue, 22 Aug 2017 23:34:07 +0000"  >&lt;p&gt;GitHub user rhauch opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3717&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3717&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Corrected how the sink task worker updates the last committed offsets (0.10.2)&lt;/p&gt;

&lt;p&gt;    Prior to this change, it was possible for the synchronous consumer commit request to be handled before previously-submitted asynchronous commit requests. If that happened, the out-of-order handlers improperly set the last committed offsets, which then became inconsistent with the offsets the connector task is working with.&lt;/p&gt;

&lt;p&gt;    This change ensures that the last committed offsets are updated only for the most recent commit request, even if the consumer reorders the calls to the callbacks.&lt;/p&gt;

&lt;p&gt;    This change also backports the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4942&quot; title=&quot;Kafka Connect: Offset committing times out before expected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4942&quot;&gt;&lt;del&gt;KAFKA-4942&lt;/del&gt;&lt;/a&gt;, which was minimal that caused the new tests to fail.&lt;/p&gt;

&lt;p&gt;    *&lt;b&gt;This is for the `0.10.2` branch; see #3662 for the equivalent and already-approved PR for `trunk` and #3672 for the equivalent and already-approved PR for the `0.11.0` branch.&lt;/b&gt;*&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rhauch/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rhauch/kafka&lt;/a&gt; kafka-5731-0.10.2&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3717.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3717.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3717&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4e39118ae302980e6d8b75cb09534172d99d5b7a&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-12T00:42:06Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Corrected how the sink task worker updates the last committed offsets&lt;/p&gt;

&lt;p&gt;    Prior to this change, it was possible for the synchronous consumer commit request to be handled before previously-submitted asynchronous commit requests. If that happened, the out-of-order handlers improperly set the last committed offsets, which then became inconsistent with the offsets the connector task is working with.&lt;/p&gt;

&lt;p&gt;    This change ensures that the last committed offsets are updated only for the most recent commit request, even if the consumer reorders the calls to the callbacks.&lt;/p&gt;

&lt;p&gt;commit 6f74ef8e89f1193a5deb66870022591d51eb6580&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-14T19:11:08Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Corrected mock consumer behavior during rebalance&lt;/p&gt;

&lt;p&gt;    Corrects the test case added in the previous commit to properly revoke the existing partition assignments before adding new partition assigments.&lt;/p&gt;

&lt;p&gt;commit 3c2531b1abdaf3cdaac3781a45597a616652ff1c&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-14T19:11:45Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Added expected call that was missing in another test&lt;/p&gt;

&lt;p&gt;commit 05567b1677e7f5a39ca0f20d86773c872193da0b&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-14T22:24:35Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Improved log messages related to offset commits&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Conflicts:&lt;/li&gt;
	&lt;li&gt;connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSinkTask.java&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;commit 60eba0ce024f3a211f33bf20bc04febbebb7d1c4&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-15T14:47:05Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; More cleanup of log messages related to offset commits&lt;/p&gt;

&lt;p&gt;commit ff123bfb910742e3a5c320fff6b23ff645ef62a2&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-15T16:21:52Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; More improvements to the log messages in WorkerSinkTask&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Conflicts:&lt;/li&gt;
	&lt;li&gt;connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSinkTask.java&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;commit d5f1b29a4cb41c139094cbed9b78cf51594f861c&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-15T16:31:28Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Removed unnecessary log message&lt;/p&gt;

&lt;p&gt;commit f2b02cda83876b7d55f331cf89d9a306ab2b467f&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-15T17:54:16Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Additional tweaks to debug and trace log messages to ensure clarity and usefulness&lt;/p&gt;

&lt;p&gt;commit fa427b7557b93a600e0007e1a4adfb4aa38f526b&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-15T19:30:09Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5731&quot; title=&quot;Connect WorkerSinkTask out of order offset commit can lead to inconsistent state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5731&quot;&gt;&lt;del&gt;KAFKA-5731&lt;/del&gt;&lt;/a&gt; Use the correct value in trace messages&lt;/p&gt;

&lt;p&gt;commit 957f0acac6ffff154fda6b522e89c00df3dcb299&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-22T23:29:52Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4942&quot; title=&quot;Kafka Connect: Offset committing times out before expected&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4942&quot;&gt;&lt;del&gt;KAFKA-4942&lt;/del&gt;&lt;/a&gt; Fix commitTimeoutMs being set before the commit actually started&lt;/p&gt;

&lt;p&gt;    Backported the fix for this issue, which was fixed in 0.11.0.0&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16137610" author="rhauch" created="Tue, 22 Aug 2017 23:36:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt;: I&apos;ve reopened the issue so this can be backported to the &lt;tt&gt;0.10.2&lt;/tt&gt; branch, and added &lt;a href=&quot;https://github.com/apache/kafka/pull/3717&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this pull request&lt;/a&gt; for that branch. Thanks!&lt;/p&gt;</comment>
                            <comment id="16137736" author="githubbot" created="Wed, 23 Aug 2017 01:35:07 +0000"  >&lt;p&gt;Github user rhauch closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3717&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3717&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3iptz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>