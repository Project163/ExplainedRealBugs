<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:43:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-19371] When a broker restarts, it should not attempt to create the __remote_log_metadata topic if it already exists.</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-19371</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;&lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Precondition&amp;#93;&lt;/span&gt;&lt;/b&gt;&lt;br/&gt;
Kafka cluster already enabled the remote storage feature based on inner topic&apos;s implementation. The core inner topic &quot;__remote_log_metadata&quot; already created.&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Steps&amp;#93;&lt;/span&gt;&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;1. Restart one broker of the Kafka cluster.&lt;/p&gt;

&lt;p&gt;2. Check the log and the code logic for the &quot;__remote_log_metadata&quot;s creating when broker restarting&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Expect result&amp;#93;&lt;/span&gt;&lt;/b&gt;&lt;br/&gt;
The broker shouldn&apos;t attempt to call API to create the topic due to that it already existed.&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Actual result&amp;#93;&lt;/span&gt;&lt;/b&gt;&lt;br/&gt;
The results are different which depend on the start process&apos; duration for broker:&lt;br/&gt;
&lt;b&gt;Case 1: Happy Path when restarting take a short time&lt;/b&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2025-06-03 22:35:11,648&amp;#93;&lt;/span&gt; INFO Topic __remote_log_metadata &lt;font color=&quot;#00875a&quot;&gt;exists&lt;/font&gt;. TopicId: 4CT2TTC-R6u7fNo_njYlDA, numPartitions: 50,&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Case 2: Unhappy path 1 when restarting take some time&lt;/b&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2025-06-03 23:59:40,505&amp;#93;&lt;/span&gt; INFO Topic __remote_log_metadata&lt;font color=&quot;#de350b&quot;&gt; does not exist&lt;/font&gt;. Error: Timed out waiting for a node assignment. Call: listNodes&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2025-06-04 00:00:36,938&amp;#93;&lt;/span&gt; INFO Topic &lt;span class=&quot;error&quot;&gt;&amp;#91;__remote_log_metadata&amp;#93;&lt;/span&gt; &lt;font color=&quot;#de350b&quot;&gt;already exists&lt;/font&gt;&lt;br/&gt;
&lt;b&gt;Case 3: Unhappy path 2 when restarting take a long time.&lt;/b&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2025-06-03 21:57:21,151&amp;#93;&lt;/span&gt; INFO Topic __remote_log_metadata &lt;font color=&quot;#de350b&quot;&gt;does not exist&lt;/font&gt;. Error: &lt;font color=&quot;#de350b&quot;&gt;Timed out waiting&lt;/font&gt; for a node assignment. Call: &lt;font color=&quot;#de350b&quot;&gt;listNodes &lt;/font&gt;at&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2025-06-03 21:58:21,153&amp;#93;&lt;/span&gt; ERROR Encountered error while creating __remote_log_metadata topic. java.util.concurrent.ExecutionException: org.apache.kafka.common.errors.&lt;font color=&quot;#de350b&quot;&gt;TimeoutException&lt;/font&gt;: Timed out waiting for a node assignment. Call: &lt;font color=&quot;#de350b&quot;&gt;createTopics &lt;/font&gt;at&lt;br/&gt;
&#160;&lt;br/&gt;
From the log and current code. we can know that &lt;font color=&quot;#de350b&quot;&gt;case 2 and case 3 both give the prompt &quot;the topic does not exist&quot; and try to call topic creating API. In actually. it is useless and contradict the fact that the topic already existed. Especially. the case 2&apos;s log prompt the topic existed and not existed at the same time.&lt;/font&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Root Cause analyst&amp;#93;&lt;/span&gt;&lt;/b&gt;&lt;br/&gt;
After reviewing the related code (TopicBasedRemoteLogMetadataManager#doesTopicExist). It is one &lt;font color=&quot;#de350b&quot;&gt;wrong implement&lt;/font&gt; to judge one topic existed or not.&lt;br/&gt;
So let me create this &lt;a href=&quot;#19899 &#183; apache/kafka&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;PR &lt;/a&gt;to fix this minor bug. Thanks&lt;br/&gt;
&#160;&lt;br/&gt;
FYI:&lt;br/&gt;
Why we got the timeout exception?&lt;br/&gt;
It is normal case based on the fact:&lt;br/&gt;
When restarting broker. The connection to query/create topic in &quot;TopicBasedRemoteLogMetadataManager#initializeResources&quot;will fail until the broker&apos;s self&#160; get ready.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2025-06-03 23:21:20,752&amp;#93;&lt;/span&gt; WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;AdminClient clientId=adminclient-1&amp;#93;&lt;/span&gt; Connection to node -1 (&lt;a href=&quot;https://10-20-1-125/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;10.20.1.125:9559)&lt;/a&gt; could not be established. Node may not be available.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2025-06-03 23:21:21,282&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;BrokerServer id=2&amp;#93;&lt;/span&gt; Transition from STARTING to STARTED (kafka.server.BrokerServer)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13620056">KAFKA-19371</key>
            <summary>When a broker restarts, it should not attempt to create the __remote_log_metadata topic if it already exists.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fujian1115">fujian</assignee>
                                    <reporter username="fujian1115">fujian</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Jun 2025 13:27:41 +0000</created>
                <updated>Mon, 28 Jul 2025 12:52:20 +0000</updated>
                            <resolved>Wed, 2 Jul 2025 05:53:14 +0000</resolved>
                                    <version>3.9.0</version>
                    <version>4.0.0</version>
                                    <fixVersion>4.2.0</fixVersion>
                                    <component>Tiered-Storage</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="259200">72h</timeoriginalestimate>
                            <timeestimate seconds="259200">72h</timeestimate>
                                        <comments>
                            <comment id="17956115" author="fujian1115" created="Wed, 4 Jun 2025 13:55:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/19899&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;When a broker restarts, it should not attempt to create the __remote_log_metadata topic if it already exists. by jiafu1115 &#183; Pull Request #19899 &#183; apache/kafka&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17985728" author="fujian1115" created="Mon, 23 Jun 2025 23:23:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangpoan&quot; class=&quot;user-hover&quot; rel=&quot;yangpoan&quot;&gt;yangpoan&lt;/a&gt; hi. can you help to take I look? thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1w6ns:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>