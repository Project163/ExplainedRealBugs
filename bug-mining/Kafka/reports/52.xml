<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:35:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-370] Exception &quot;java.util.NoSuchElementException: None.get&quot; appears inconsistently in Mirror Maker log.</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-370</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Exception in Mirror Maker log:&lt;br/&gt;
=========================&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-06-20 10:56:04,364&amp;#93;&lt;/span&gt; DEBUG Getting broker partition info for topic test01 (kafka.producer.BrokerPartitionInfo)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-06-20 10:56:04,365&amp;#93;&lt;/span&gt; INFO Fetching metadata for topic test01 (kafka.producer.BrokerPartitionInfo)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-06-20 10:56:04,366&amp;#93;&lt;/span&gt; ERROR Error in handling batch of 200 events (kafka.producer.async.ProducerSendThread)&lt;br/&gt;
java.util.NoSuchElementException: None.get&lt;br/&gt;
        at scala.None$.get(Option.scala:185)&lt;br/&gt;
        at scala.None$.get(Option.scala:183)&lt;br/&gt;
        at kafka.producer.ProducerPool.getAnyProducer(ProducerPool.scala:76)&lt;br/&gt;
        at kafka.producer.BrokerPartitionInfo.updateInfo(BrokerPartitionInfo.scala:73)&lt;br/&gt;
        at kafka.producer.BrokerPartitionInfo.getBrokerPartitionInfo(BrokerPartitionInfo.scala:45)&lt;br/&gt;
        at kafka.producer.async.DefaultEventHandler.kafka$producer$async$DefaultEventHandler$$getPartitionListForTopic(DefaultEventHandler.scala:129)&lt;br/&gt;
        at kafka.producer.async.DefaultEventHandler$$anonfun$partitionAndCollate$1.apply(DefaultEventHandler.scala:95)&lt;br/&gt;
        at kafka.producer.async.DefaultEventHandler$$anonfun$partitionAndCollate$1.apply(DefaultEventHandler.scala:94)&lt;br/&gt;
        at scala.collection.LinearSeqOptimized$class.foreach(LinearSeqOptimized.scala:61)&lt;br/&gt;
        at scala.collection.immutable.List.foreach(List.scala:45)&lt;br/&gt;
        at scala.collection.generic.TraversableForwarder$class.foreach(TraversableForwarder.scala:44)&lt;br/&gt;
        at scala.collection.mutable.ListBuffer.foreach(ListBuffer.scala:42)&lt;br/&gt;
        at kafka.producer.async.DefaultEventHandler.partitionAndCollate(DefaultEventHandler.scala:94)&lt;br/&gt;
        at kafka.producer.async.DefaultEventHandler.dispatchSerializedData(DefaultEventHandler.scala:65)&lt;br/&gt;
        at kafka.producer.async.DefaultEventHandler.handle(DefaultEventHandler.scala:49)&lt;br/&gt;
        at kafka.producer.async.ProducerSendThread.tryToHandle(ProducerSendThread.scala:96)&lt;br/&gt;
        at kafka.producer.async.ProducerSendThread$$anonfun$processEvents$3.apply(ProducerSendThread.scala:82)&lt;br/&gt;
        at kafka.producer.async.ProducerSendThread$$anonfun$processEvents$3.apply(ProducerSendThread.scala:60)&lt;br/&gt;
        at scala.collection.immutable.Stream.foreach(Stream.scala:254)&lt;br/&gt;
        at kafka.producer.async.ProducerSendThread.processEvents(ProducerSendThread.scala:59)&lt;br/&gt;
        at kafka.producer.async.ProducerSendThread.run(ProducerSendThread.scala:37)&lt;/p&gt;

&lt;p&gt;Steps to reproduce&lt;br/&gt;
=================&lt;br/&gt;
It cannot be reproduced consistently. However, running the following script 2 or 3 times (step 2) will show the error:&lt;/p&gt;

&lt;p&gt;1. Apply kafka-306-v2.patch to 0.8 branch (revision 1352192 is used to reproduce this)&lt;/p&gt;

&lt;p&gt;2. Under the directory &amp;lt;kafka home&amp;gt;/system_test/broker_failure, execute the following command:&lt;br/&gt;
=&amp;gt; $ bin/run-test.sh 5 0&lt;/p&gt;

&lt;p&gt;3. Check the log under the directory &amp;lt;kafka home&amp;gt;/system_test/broker_failure:&lt;br/&gt;
=&amp;gt; $ grep Exception `ls kafka_mirror_maker*.log`&lt;br/&gt;
=&amp;gt;    kafka_mirror_maker2.log:java.util.NoSuchElementException: None.get&lt;/p&gt;

&lt;p&gt;4. Also the kafka log sizes between source and target will not match:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;/tmp&amp;#93;&lt;/span&gt;  $ find kafka* -name *.kafka -ls&lt;br/&gt;
19400444 6104 &lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 jfung    eng       6246655 Jun 20 10:56 kafka-source4-logs/test01-0/00000000000000000000.kafka&lt;br/&gt;
19400819 5356 &lt;del&gt;rw-r&lt;/del&gt;&lt;del&gt;r&lt;/del&gt;-   1 jfung    eng       5483627 Jun 20 10:56 kafka-target3-logs/test01-0/00000000000000000000.kafka&lt;/p&gt;

&lt;p&gt;Notes about the patch kafka-306-v2.patch&lt;br/&gt;
===============================&lt;br/&gt;
This patch fix the broker_failure test suite to do the followings:&lt;/p&gt;

&lt;p&gt;a. Start 4 kafka brokers as source cluster&lt;br/&gt;
b. Start 3 kafka brokers as target cluster&lt;br/&gt;
c. Start 3 mirror maker to enable mirroring&lt;br/&gt;
d. Send n messages to source cluster&lt;br/&gt;
e. No bouncing is performed in this test for simplicity&lt;br/&gt;
f. After the producer is stopped, validate the data count is matched between source &amp;amp; target&lt;/p&gt;</description>
                <environment></environment>
        <key id="12595316">KAFKA-370</key>
            <summary>Exception &quot;java.util.NoSuchElementException: None.get&quot; appears inconsistently in Mirror Maker log.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="junrao">Jun Rao</assignee>
                                    <reporter username="jfung">John Fung</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Jun 2012 18:28:47 +0000</created>
                <updated>Fri, 22 Jun 2012 20:16:01 +0000</updated>
                            <resolved>Fri, 22 Jun 2012 17:32:07 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13399438" author="junrao" created="Fri, 22 Jun 2012 16:57:53 +0000"  >&lt;p&gt;Attach patch v1. The issue is that the code relies on the broker ids in the hashmap to be always between 0 and size - 1, which is not always true, especially when there are failures.&lt;/p&gt;</comment>
                            <comment id="13399451" author="jjkoshy" created="Fri, 22 Jun 2012 17:17:53 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13399459" author="junrao" created="Fri, 22 Jun 2012 17:32:07 +0000"  >&lt;p&gt;Thanks for the review. Committed to 0.8&lt;/p&gt;</comment>
                            <comment id="13399563" author="jfung" created="Fri, 22 Jun 2012 20:16:01 +0000"  >&lt;p&gt;Downloaded rev. 1353005 and tried the test a few times. The issue is fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12533071" name="kafka-370_v1.patch" size="533" author="junrao" created="Fri, 22 Jun 2012 16:57:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>299097</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 22 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i15zkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>243064</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>