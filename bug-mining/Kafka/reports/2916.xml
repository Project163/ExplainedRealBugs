<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:26:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-10101] recovery point is advanced without flushing the data after recovery</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-10101</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Currently, in Log.recoverLog(), we set&#160;recoveryPoint to logEndOffset after recovering the log segment. However, we don&apos;t flush the log segments after recovery. The potential issue is that if the broker has another hard failure, segments may be corrupted on disk but won&apos;t be going through recovery on another restart.&lt;/p&gt;

&lt;p&gt;This logic was introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5829&quot; title=&quot;Speedup broker startup after unclean shutdown by reducing unnecessary snapshot files deletion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5829&quot;&gt;&lt;del&gt;KAFKA-5829&lt;/del&gt;&lt;/a&gt; since 1.0.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13309482">KAFKA-10101</key>
            <summary>recovery point is advanced without flushing the data after recovery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ijuma">Ismael Juma</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Jun 2020 15:47:57 +0000</created>
                <updated>Sat, 27 Feb 2021 17:59:14 +0000</updated>
                            <resolved>Fri, 26 Feb 2021 22:43:51 +0000</resolved>
                                    <version>2.5.0</version>
                                    <fixVersion>2.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17126023" author="junrao" created="Thu, 4 Jun 2020 15:49:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt;&#160;: Could you double check if this is an issue? Thanks.&lt;/p&gt;</comment>
                            <comment id="17126036" author="junrao" created="Thu, 4 Jun 2020 15:59:47 +0000"  >&lt;p&gt;If this is an issue, one way to fix that is to simply not advance recoveryPoint after recovery.&lt;/p&gt;</comment>
                            <comment id="17126765" author="ijuma" created="Fri, 5 Jun 2020 13:28:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt;&#160;That&apos;s a good point. I agree with you that it&apos;s probably simplest to remove the code that changes the recover point. The previous code had:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(hasCleanShutdownFile) {
  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.recoveryPoint = activeSegment.nextOffset()
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It has since been consolidated into the same path. We can probably keep that. I&apos;ll submit a PR.&lt;/p&gt;</comment>
                            <comment id="17126893" author="ijuma" created="Fri, 5 Jun 2020 15:46:27 +0000"  >&lt;p&gt;Discussed with Jun a bit offline. This is a bit unlikely in practice as the hard failure has to happen after we write the recovery point (which happens in a scheduled thread) and before we roll/flush the truncated segment. Still, good to fix it. Also, it&apos;s easier to reason about if we only update the recovery point after we roll segments. While looking at the code, we noticed a few more edge cases. Will try to fix them at the same time.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fikg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>