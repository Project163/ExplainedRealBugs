<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:01:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4667] KIP-154: Connect should create internal topics</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4667</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I&apos;m reporting this as an issue but in fact it requires more investigation (which unfortunately I&apos;m not able to perform at this time).&lt;/p&gt;

&lt;p&gt;Repro steps:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;configure Kafka for consistency, for example:&lt;br/&gt;
default.replication.factor=3&lt;br/&gt;
min.insync.replicas=2&lt;br/&gt;
unclean.leader.election.enable=false&lt;/li&gt;
	&lt;li&gt;run Connect for the first time, which should create its internal topics&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I believe these topics are created with the broker&apos;s default, in particular:&lt;br/&gt;
min.insync.replicas=2&lt;br/&gt;
unclean.leader.election.enable=false&lt;br/&gt;
but connect doesn&apos;t produce with acks=all, which in turn may cause the cluster to go in a bad state (see, e.g., &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4666&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-4666&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Solution would be to force availability mode, i.e. force:&lt;br/&gt;
unclean.leader.election.enable=true&lt;br/&gt;
when creating the connect topics, or viceversa detect availability vs consistency mode and turn acks=all if needed.&lt;/p&gt;

&lt;p&gt;I assume the same happens with other kafka-based services such as streams.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13035708">KAFKA-4667</key>
            <summary>KIP-154: Connect should create internal topics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhauch">Randall Hauch</assignee>
                                    <reporter username="ecesena">Emanuele Cesena</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Jan 2017 22:39:15 +0000</created>
                <updated>Wed, 22 Feb 2023 22:56:50 +0000</updated>
                            <resolved>Thu, 18 May 2017 23:02:57 +0000</resolved>
                                                    <fixVersion>0.11.0.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="15836801" author="ewencp" created="Tue, 24 Jan 2017 23:01:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ecesena&quot; class=&quot;user-hover&quot; rel=&quot;ecesena&quot;&gt;ecesena&lt;/a&gt; Not sure I understand exactly &amp;#8211; Connect doesn&apos;t actually create its internal topics today. We&apos;d been waiting for KIP-4 and the Java AdminClient support to avoid pulling in core + all its dependencies into the framework. So today, I&apos;m not sure what state you&apos;re talking about getting into. If you have auto topic creation enabled, that&apos;s what should be taking effect. Otherwise, today we&apos;d expect you to create those topics with the desired parameters.&lt;/p&gt;

&lt;p&gt;One option would be to convert this to a JIRA for creating internal topics automatically, which doesn&apos;t seem to have a JIRA yet but is definitely something we want to do. Part of that would include config options to control what replication factor you want. # of partitions might be a setting for some (but for some internal topics, like config, we expect only a single partition).&lt;/p&gt;</comment>
                            <comment id="15836817" author="ecesena" created="Tue, 24 Jan 2017 23:13:43 +0000"  >&lt;p&gt;I see - I think I was confused because we do have automatic topic creation enabled, thank you for clarifying.&lt;/p&gt;

&lt;p&gt;I agree with you, feel free to create the new ticket and close this one, or rename this if you prefer.&lt;/p&gt;


&lt;p&gt;I guess this can go into Kafka docs as a note under configuring Kafka for consistency.&lt;br/&gt;
If you have auto topics creation enabled and Kafka configured for consistency, make sure your producers have acks=all, or you risk to end up in corner case situations (as per the other ticket that I mentioned).&lt;/p&gt;</comment>
                            <comment id="15975068" author="ewencp" created="Wed, 19 Apr 2017 16:49:22 +0000"  >&lt;p&gt;For potential implementer, see notes in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5087&quot; title=&quot;Kafka Connect&amp;#39;s configuration topics should always be compacted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5087&quot;&gt;&lt;del&gt;KAFKA-5087&lt;/del&gt;&lt;/a&gt; &amp;#8211; setting up compaction properly is important, and as soon as the AdminClient is merged someone could start work on this.&lt;/p&gt;</comment>
                            <comment id="15975072" author="ewencp" created="Wed, 19 Apr 2017 16:50:45 +0000"  >&lt;p&gt;Also increasing priority and optimistically setting the fix version to 0.11 since this issue has affected quite a few people now.&lt;/p&gt;</comment>
                            <comment id="15977460" author="gwenshap" created="Thu, 20 Apr 2017 20:32:45 +0000"  >&lt;p&gt;Also, note that validating configuration of existing internal topics is important.&lt;/p&gt;</comment>
                            <comment id="15991697" author="rhauch" created="Mon, 1 May 2017 22:46:27 +0000"  >&lt;p&gt;The AdminClient pull request is being added as part of &lt;a href=&quot;https://github.com/apache/kafka/pull/2472&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR 2472&lt;/a&gt;, though it looks like it&apos;s very close to being merged.&lt;/p&gt;

&lt;p&gt;As mentioned above, the most strongly consistent and durable topics require per-topic configuration with:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;replication factor of &lt;tt&gt;min(3, nodeCount)&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;number of partitions to 1&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;min.insync.replicas=min(round(replicationFactor/2),nodeCount)&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;unclean.leader.election.enable=false&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;cleanup.policy=compact&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Note that since we can&apos;t specify a replication factor or &lt;tt&gt;min.insync.replicas&lt;/tt&gt; greater than the number of nodes in a cluster, we need to first determine the cluster size, &lt;tt&gt;nodeCount&lt;/tt&gt;, and calculate the desired replication factor and &lt;tt&gt;min.insync.replicas&lt;/tt&gt; value.&lt;/p&gt;

&lt;p&gt;Kafka Connect currently creates 3 internal topics for each connector: one for the connector configuration(s), one for the offsets, and one for status. Should all 3 of these internal topics (per connector) use these same settings, or might the status topic not need to be so conservatively defined? Secondly, should a connector configuration be allowed to override these or any of the other &lt;a href=&quot;https://kafka.apache.org/documentation/#topic-config&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;topic configuration properties&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Finally, the AdminClient in &lt;a href=&quot;https://github.com/apache/kafka/pull/2472&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR 2472&lt;/a&gt; will allow us to get the standard metadata for each topic partition, meaning we can get the partition count, ISRs, and replica nodes. So we could output a warning if the replication factor is smaller than the preferred value as calculated above, but can we do much else? For example, can we even read the topic&apos;s cleanup policy, whether unclean leader election is enabled, or other topic properties, and if so it doesn&apos;t appear we can alter a topic configuration.&lt;/p&gt;</comment>
                            <comment id="15991939" author="cmccabe" created="Tue, 2 May 2017 01:20:40 +0000"  >&lt;p&gt;The Admin client has been merged &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;KIP-133, which is still under discussion, adds a method of getting broker and topic configs through Admin client.&lt;/p&gt;</comment>
                            <comment id="15994268" author="ewencp" created="Wed, 3 May 2017 04:45:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhauch&quot; class=&quot;user-hover&quot; rel=&quot;rhauch&quot;&gt;rhauch&lt;/a&gt; Discussed some of these issues offline, but there are some other refinements here too:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;based on KIP-115, default replication factor of 3 but override it in our demo configs to make running on a single local node easy is probably the least likely to cause unexpected problems&lt;/li&gt;
	&lt;li&gt;partitions = 1 is only really true for config topic where ordering between differing keys is required. For status and offsets topics you can go higher, and Confluent recommends doing so: &lt;a href=&quot;http://docs.confluent.io/current/connect/userguide.html#distributed-mode&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.confluent.io/current/connect/userguide.html#distributed-mode&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Not sure if we should fiddle with unclean leader election defaults. But maybe it is ok to set this to false and tell users if they want the unsafe version they need to set up the topic themselves before starting Connect? Not sure what the right tradeoff of respecting users&apos; existing settings vs encouraging better behavior is. This might even differ between the three topics &amp;#8211; status topics are way less critical than config topic.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15998675" author="githubbot" created="Fri, 5 May 2017 17:58:13 +0000"  >&lt;p&gt;GitHub user rhauch opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2984&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2984&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4667&quot; title=&quot;KIP-154: Connect should create internal topics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4667&quot;&gt;&lt;del&gt;KAFKA-4667&lt;/del&gt;&lt;/a&gt; Connect uses AdminClient to create internal topics when needed&lt;/p&gt;

&lt;p&gt;    The backing store for offsets, status, and configs now attempts to use the new AdminClient to look up the internal topics and create them if they don&#8217;t yet exist. If the necessary APIs are not available in the connected broker, the stores fall back to the old behavior of relying upon auto-created topics. Kafka Connect requires a minimum of Apache Kafka 0.10.0.1-cp1, and the AdminClient can work with all versions since 0.10.0.0.&lt;/p&gt;

&lt;p&gt;    All three of Connect&#8217;s internal topics are created as compacted topics, and new distributed worker configuration properties control the replication factor for all three topics and the number of partitions for the offsets and status topics; the config topic requires a single partition and does not allow it to be set via configuration. All of these new configuration properties have sensible defaults, meaning users can upgrade without having to change any of the existing configurations. In most situations, existing Connect deployments will have already created the storage topics prior to upgrading.&lt;/p&gt;

&lt;p&gt;    The replication factor defaults to 3, so anyone running Kafka clusters with fewer nodes than 3 will receive an error unless they explicitly set the replication factor for the three internal topics. This is actually desired behavior, since it signals the users that they should be aware they are not using sufficient replication for production use.&lt;/p&gt;

&lt;p&gt;    The integration tests use a cluster with a single broker, so they were changed to explicitly specify a replication factor of 1 and a single partition.&lt;/p&gt;

&lt;p&gt;    The `KafkaAdminClientTest` was refactored to extract a utility for setting up a `KafkaAdminClient` with a `MockClient` for unit tests.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rhauch/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rhauch/kafka&lt;/a&gt; kafka-4667&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2984.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2984.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2984&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ea181ba29a678e47a5ff88ca0ad4c995aa4e017b&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-05-05T17:14:07Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4667&quot; title=&quot;KIP-154: Connect should create internal topics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4667&quot;&gt;&lt;del&gt;KAFKA-4667&lt;/del&gt;&lt;/a&gt; Connect can create internal topics using AdminClient&lt;/p&gt;

&lt;p&gt;    The backing store for offsets, status, and configs now attempts to use the new AdminClient to look up the&lt;br/&gt;
    internal topics and create them if they don&#8217;t yet exist. If the necessary APIs are not available in the connected&lt;br/&gt;
    broker, the stores fall back to the old behavior of relying upon auto-created topics. Kafka Connect requires&lt;br/&gt;
    a minimum of Apache Kafka 0.10.0.1-cp1, and the AdminClient can work with all versions since 0.10.0.0.&lt;/p&gt;

&lt;p&gt;    All three of Connect&#8217;s internal topics are created as compacted topics, and new distributed worker configuration&lt;br/&gt;
    properties control the replication factor for all three topics and the number of partitions for the offsets&lt;br/&gt;
    and status topics; the config topic requires a single partition and does not allow it to be set via configuration.&lt;br/&gt;
    All of these new configuration properties have sensible defaults, meaning users can upgrade without having to&lt;br/&gt;
    change any of the existing configurations. In most situations, existing Connect deployments will have already&lt;br/&gt;
    created the storage topics prior to upgrading.&lt;/p&gt;

&lt;p&gt;    The replication factor defaults to 3, so anyone running Kafka clusters with fewer nodes than 3 will receive an&lt;br/&gt;
    error unless they explicitly set the replication factor for the three internal topics. This is actually desired behavior,&lt;br/&gt;
    since it signals the users that they should be aware they are not using sufficient replication for production use.&lt;/p&gt;

&lt;p&gt;    The integration tests use a cluster with a single broker, so they were changed to explictly specify a replication factor of 1&lt;br/&gt;
    and a single partition.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15999061" author="rhauch" created="Fri, 5 May 2017 22:28:49 +0000"  >&lt;p&gt;Per &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt;, I created &lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-154+Add+Kafka+Connect+configuration+properties+for+creating+internal+topics&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;KIP-154&lt;/a&gt; to address the new distributed worker configuration properties.&lt;/p&gt;</comment>
                            <comment id="16014904" author="rhauch" created="Wed, 17 May 2017 23:06:09 +0000"  >&lt;p&gt;The PR is ready for review.&lt;/p&gt;</comment>
                            <comment id="16016617" author="ewencp" created="Thu, 18 May 2017 23:02:57 +0000"  >&lt;p&gt;Issue resolved by pull request 2984&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/2984&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2984&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="12993643">KAFKA-4006</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13064984">KAFKA-5087</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 26 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38uh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>ewencp</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>