<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:39:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-17235] system test test_performance_service.py failed</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-17235</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;After run&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
TC_PATHS=&lt;span class=&quot;code-quote&quot;&gt;&quot;tests/kafkatest/sanity_checks/test_performance_services.py&quot;&lt;/span&gt; bash tests/docker/run_tests.sh
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There are three failed test cases:&lt;br/&gt;
kafkatest.sanity_checks.test_performance_services.PerformanceServiceTest.test_version.version=0.8.2.2.new_consumer=False&lt;br/&gt;
kafkatest.sanity_checks.test_performance_services.PerformanceServiceTest.test_version.version=0.9.0.1&lt;br/&gt;
kafkatest.sanity_checks.test_performance_services.PerformanceServiceTest.test_version.version=0.9.0.1.new_consumer=False&lt;/p&gt;

&lt;p&gt;And in each failed test case, in producer_performance.stderr I saw error&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.NoSuchFieldError: SYSTEM
	at org.apache.kafka.tools.PushHttpMetricsReporter.&amp;lt;init&amp;gt;(PushHttpMetricsReporter.java:99)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.newInstance(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:442)
	at org.apache.kafka.common.utils.Utils.newInstance(Utils.java:231)
	at org.apache.kafka.common.config.AbstractConfig.getConfiguredInstances(AbstractConfig.java:156)
	at org.apache.kafka.clients.producer.KafkaProducer.&amp;lt;init&amp;gt;(KafkaProducer.java:168)
	at org.apache.kafka.clients.producer.KafkaProducer.&amp;lt;init&amp;gt;(KafkaProducer.java:129)
	at org.apache.kafka.tools.ProducerPerformance.createKafkaProducer(ProducerPerformance.java:175)
	at org.apache.kafka.tools.ProducerPerformance.start(ProducerPerformance.java:86)
	at org.apache.kafka.tools.ProducerPerformance.main(ProducerPerformance.java:52)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13587522">KAFKA-17235</key>
            <summary>system test test_performance_service.py failed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brandboat">Kuan Po Tseng</assignee>
                                    <reporter username="brandboat">Kuan Po Tseng</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Aug 2024 06:30:10 +0000</created>
                <updated>Tue, 6 Aug 2024 06:56:05 +0000</updated>
                            <resolved>Tue, 6 Aug 2024 06:56:05 +0000</resolved>
                                                    <fixVersion>3.9.0</fixVersion>
                                    <component>system tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17870211" author="brandboat" created="Thu, 1 Aug 2024 14:34:14 +0000"  >&lt;p&gt;The root cause of this issue is a change we introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-16879&quot; title=&quot;SystemTime should use singleton mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-16879&quot;&gt;&lt;del&gt;KAFKA-16879&lt;/del&gt;&lt;/a&gt;, where we modified the &lt;tt&gt;PushHttpMetricsReporter&lt;/tt&gt; constructor to use &lt;tt&gt;Time.System&lt;/tt&gt; &lt;ins&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;/ins&gt;. However, &lt;tt&gt;Time.System&lt;/tt&gt; doesn&apos;t exist in Kafka versions 0.8.2 and 0.9.&lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;test_performance_services.py&lt;/tt&gt;, we have system tests for Kafka versions 0.8.2 and 0.9 &lt;ins&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;&lt;/ins&gt;. These tests always use the tools JAR from the trunk branch, regardless of the Kafka version being tested &lt;ins&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;&lt;/ins&gt;, while the client JAR aligns with the Kafka version specified in the test suite &lt;ins&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt;&lt;/ins&gt;. This discrepancy is what causes the issue to arise.&lt;/p&gt;

&lt;p&gt;To resolve this issue, we have a few options:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Add &lt;tt&gt;Time.System&lt;/tt&gt; to Kafka 0.8.2 and 0.9: This isn&apos;t practical, as we no longer maintain these versions.&lt;/li&gt;
	&lt;li&gt;Modify the &lt;tt&gt;PushHttpMetricsReporter&lt;/tt&gt; constructor to use &lt;tt&gt;new SystemTime()&lt;/tt&gt; instead of &lt;tt&gt;Time.System&lt;/tt&gt;: This would contradict the intent of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-16879&quot; title=&quot;SystemTime should use singleton mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-16879&quot;&gt;&lt;del&gt;KAFKA-16879&lt;/del&gt;&lt;/a&gt;, which aims to make &lt;tt&gt;SystemTime&lt;/tt&gt; a singleton.&lt;/li&gt;
	&lt;li&gt;Remove system tests for Kafka 0.8.2 and 0.9 from &lt;tt&gt;test_performance_services.py&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Given that we no longer maintain Kafka 0.8.2 and 0.9, and altering the constructor goes against the design goals of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-16879&quot; title=&quot;SystemTime should use singleton mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-16879&quot;&gt;&lt;del&gt;KAFKA-16879&lt;/del&gt;&lt;/a&gt;, option 3 appears to be the most feasible solution. However, I&apos;m not sure whether it&apos;s acceptable to remove these old version tests. Maybe someone else has a better solution &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/kafka/blob/133f2b0f311ba1fd5a999f477bad38370c1772ca/tools/src/main/java/org/apache/kafka/tools/PushHttpMetricsReporter.java#L99&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/133f2b0f311ba1fd5a999f477bad38370c1772ca/tools/src/main/java/org/apache/kafka/tools/PushHttpMetricsReporter.java#L99&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/kafka/blob/0711d1558250c60807dfa815d46907eac8bb4b98/tests/kafkatest/sanity_checks/test_performance_services.py#L43-L44&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/0711d1558250c60807dfa815d46907eac8bb4b98/tests/kafkatest/sanity_checks/test_performance_services.py#L43-L44&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/kafka/blob/0711d1558250c60807dfa815d46907eac8bb4b98/tests/kafkatest/services/performance/producer_performance.py#L89&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/0711d1558250c60807dfa815d46907eac8bb4b98/tests/kafkatest/services/performance/producer_performance.py#L89&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/kafka/blob/0711d1558250c60807dfa815d46907eac8bb4b98/tests/kafkatest/services/performance/producer_performance.py#L80&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/0711d1558250c60807dfa815d46907eac8bb4b98/tests/kafkatest/services/performance/producer_performance.py#L80&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17870921" author="brandboat" created="Mon, 5 Aug 2024 04:23:39 +0000"  >&lt;p&gt;see discussion in &lt;a href=&quot;https://github.com/apache/kafka/pull/16789#issuecomment-2267622823,&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/16789#issuecomment-2267622823,&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chia7712&quot; class=&quot;user-hover&quot; rel=&quot;chia7712&quot;&gt;chia7712&lt;/a&gt; mentioned, kafka support for versions 0.8 and 0.9 is still required, meaning we can&apos;t remove those Kafka versions from the system tests. So we are going to implement Time in PushHttpMetricsReporter to make test_performance_service.py passed again.&lt;/p&gt;</comment>
                            <comment id="17871230" author="chia7712" created="Tue, 6 Aug 2024 06:56:05 +0000"  >&lt;p&gt;push to trunk and 3.9&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13070615" name="2024-08-01--001.zip" size="1933986" author="brandboat" created="Thu, 1 Aug 2024 07:32:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1qmug:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>