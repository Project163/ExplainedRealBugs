<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:57:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4271] The console consumer fails on Windows with new consumer is used </title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4271</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When I try to consume message using the new consumer (Quickstart Step 5) I get an exception on the broker side. The old consumer works fine.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.io.IOException: Map failed
        at sun.nio.ch.FileChannelImpl.map(Unknown Source)
        at kafka.log.AbstractIndex.&amp;lt;init&amp;gt;(AbstractIndex.scala:61)
        at kafka.log.OffsetIndex.&amp;lt;init&amp;gt;(OffsetIndex.scala:51)
        at kafka.log.LogSegment.&amp;lt;init&amp;gt;(LogSegment.scala:67)
        at kafka.log.Log.loadSegments(Log.scala:255)
        at kafka.log.Log.&amp;lt;init&amp;gt;(Log.scala:108)
        at kafka.log.LogManager.createLog(LogManager.scala:362)
        at kafka.cluster.Partition.getOrCreateReplica(Partition.scala:94)
        at kafka.cluster.Partition$$anonfun$4$$anonfun$apply$2.apply(Partition.scala:174)
        at kafka.cluster.Partition$$anonfun$4$$anonfun$apply$2.apply(Partition.scala:174)
        at scala.collection.mutable.HashSet.foreach(HashSet.scala:79)
        at kafka.cluster.Partition$$anonfun$4.apply(Partition.scala:174)
        at kafka.cluster.Partition$$anonfun$4.apply(Partition.scala:168)
        at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:234)
        at kafka.utils.CoreUtils$.inWriteLock(CoreUtils.scala:242)
        at kafka.cluster.Partition.makeLeader(Partition.scala:168)
        at kafka.server.ReplicaManager$$anonfun$makeLeaders$4.apply(ReplicaManager.scala:740)
        at kafka.server.ReplicaManager$$anonfun$makeLeaders$4.apply(ReplicaManager.scala:739)
        at scala.collection.mutable.HashMap$$anonfun$foreach$1.apply(HashMap.scala:98)
        at scala.collection.mutable.HashMap$$anonfun$foreach$1.apply(HashMap.scala:98)
        at scala.collection.mutable.HashTable$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreachEntry(HashTable.scala:226)
        at scala.collection.mutable.HashMap.foreachEntry(HashMap.scala:39)
        at scala.collection.mutable.HashMap.foreach(HashMap.scala:98)
        at kafka.server.ReplicaManager.makeLeaders(ReplicaManager.scala:739)
        at kafka.server.ReplicaManager.becomeLeaderOrFollower(ReplicaManager.scala:685)
        at kafka.server.KafkaApis.handleLeaderAndIsrRequest(KafkaApis.scala:148)
        at kafka.server.KafkaApis.handle(KafkaApis.scala:82)
        at kafka.server.KafkaRequestHandler.run(KafkaRequestHandler.scala:60)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source)
Caused by: java.lang.OutOfMemoryError: Map failed
        at sun.nio.ch.FileChannelImpl.map0(Native Method)
        ... 29 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This issue seems to break the broker and I have to clear out the logs so I can bring the broker back up again.&lt;/p&gt;

&lt;p&gt;Update: This issue seems to occur on 32-bit Windows only. I tried this on a Windows 32-bit VM. On a 64-bit machine I did not get the error.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13010553">KAFKA-4271</key>
            <summary>The console consumer fails on Windows with new consumer is used </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vahid">Vahid Hashemian</assignee>
                                    <reporter username="vahid">Vahid Hashemian</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Oct 2016 18:26:24 +0000</created>
                <updated>Wed, 30 Nov 2016 20:20:11 +0000</updated>
                            <resolved>Wed, 30 Nov 2016 20:20:02 +0000</resolved>
                                    <version>0.10.0.1</version>
                                    <fixVersion>0.10.1.1</fixVersion>
                    <fixVersion>0.10.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15556219" author="vahid" created="Fri, 7 Oct 2016 20:51:57 +0000"  >&lt;p&gt;The command &lt;tt&gt;bin\windows\kafka-run-class.bat org.apache.kafka.streams.examples.wordcount.WordCountDemo&lt;/tt&gt; in Step 8 of the Quickstart also fails with a similar error (likely because it leverages the new consumer).&lt;/p&gt;</comment>
                            <comment id="15593876" author="huxi_2b" created="Fri, 21 Oct 2016 03:54:48 +0000"  >&lt;p&gt;Kafka maps the index file&apos; content into the memory during the log creation. Since you are using Windows 32bit box, check: &lt;br/&gt;
1. free available RAM 2. Do you set option &apos;log.index.size.max.bytes&apos; to a larger size?&lt;/p&gt;</comment>
                            <comment id="15684468" author="vahid" created="Mon, 21 Nov 2016 19:20:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=huxi_2b&quot; class=&quot;user-hover&quot; rel=&quot;huxi_2b&quot;&gt;huxi_2b&lt;/a&gt; Thanks for responding. I checked the RAM, and out of 4 GB available there&apos;s plenty left (about half) when I run the consumer.&lt;br/&gt;
I also set the config you mentioned to 4 times the default size, but no luck. I still get the same error.&lt;/p&gt;</comment>
                            <comment id="15704074" author="yuyan" created="Tue, 29 Nov 2016 03:45:30 +0000"  >&lt;p&gt;I have met this problem too. My jvm is 32 bit, and 64jvm may work well.&lt;br/&gt;
But I have sovle it by reduce the init jvm in the kafka-server-start.bat. Change the 1G to 512M, then the consumer can work.&lt;br/&gt;
IF &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;%KAFKA_HEAP_OPTS%&amp;quot;&amp;#93;&lt;/span&gt; EQU &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;&amp;quot;&amp;#93;&lt;/span&gt; (&lt;br/&gt;
    set KAFKA_HEAP_OPTS=-Xmx512M -Xms512M&lt;br/&gt;
)&lt;br/&gt;
Hope it can help someone.&lt;br/&gt;
In my later test, the topic number is related the jvm, each topic will get the assigned JVM&lt;/p&gt;
</comment>
                            <comment id="15706513" author="vahid" created="Tue, 29 Nov 2016 21:00:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuyan&quot; class=&quot;user-hover&quot; rel=&quot;yuyan&quot;&gt;yuyan&lt;/a&gt; Thanks for the pointer. I can confirm that your suggested setting worked for me.&lt;/p&gt;</comment>
                            <comment id="15706669" author="githubbot" created="Tue, 29 Nov 2016 22:01:23 +0000"  >&lt;p&gt;GitHub user vahidhashemian opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2189&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2189&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4271&quot; title=&quot;The console consumer fails on Windows with new consumer is used &quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4271&quot;&gt;&lt;del&gt;KAFKA-4271&lt;/del&gt;&lt;/a&gt;: Fix the server start script for Windows to run normally on a 32-bit OS&lt;/p&gt;

&lt;p&gt;    Without this fix the new consumer fails to run on a 32-bit Windows OS.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/vahidhashemian/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/vahidhashemian/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4271&quot; title=&quot;The console consumer fails on Windows with new consumer is used &quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4271&quot;&gt;&lt;del&gt;KAFKA-4271&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2189.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2189.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2189&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 1542c2e6d1fe27a07e1cce8c0aefaebd591bed83&lt;br/&gt;
Author: Vahid Hashemian &amp;lt;vahidhashemian@us.ibm.com&amp;gt;&lt;br/&gt;
Date:   2016-11-29T21:46:50Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4271&quot; title=&quot;The console consumer fails on Windows with new consumer is used &quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4271&quot;&gt;&lt;del&gt;KAFKA-4271&lt;/del&gt;&lt;/a&gt;: Fix the server start script for Windows to run normally on 32-bit OS too&lt;/p&gt;

&lt;p&gt;    Without this fix the new consumer fails to run on a 32-bit Windows OS.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15709662" author="guozhang" created="Wed, 30 Nov 2016 20:20:02 +0000"  >&lt;p&gt;Issue resolved by pull request 2189&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/2189&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2189&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15709663" author="githubbot" created="Wed, 30 Nov 2016 20:20:11 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2189&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2189&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34l7z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>