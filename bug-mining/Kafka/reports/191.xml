<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:37:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-708] ISR becomes empty while marking a partition offline</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-708</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Attached state change log shows that ISR becomes empty when a partition is being marked as offline.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12627970">KAFKA-708</key>
            <summary>ISR becomes empty while marking a partition offline</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nehanarkhede">Neha Narkhede</assignee>
                                    <reporter username="swapnilghike">Swapnil Ghike</reporter>
                        <labels>
                            <label>bugs</label>
                            <label>p1</label>
                    </labels>
                <created>Thu, 17 Jan 2013 01:40:06 +0000</created>
                <updated>Wed, 23 Jan 2013 22:06:15 +0000</updated>
                            <resolved>Wed, 23 Jan 2013 22:06:10 +0000</resolved>
                                    <version>0.8.0</version>
                    <version>0.8.1</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13559178" author="nehanarkhede" created="Mon, 21 Jan 2013 22:37:57 +0000"  >&lt;p&gt;Changes in this patch include -&lt;/p&gt;

&lt;p&gt;1. Allowing the isr list to be empty. This can happen if all the brokers in the isr fall out which can happen if all the replicas that host the partition are down. In other words, the partition is offline. The problem was that if the controller moves when the isr is empty or you restart the entire cluster, it relied on a non-empty isr.&lt;/p&gt;

&lt;p&gt;2. Marking the partition offline by setting the leader to -1 in zookeeper. This is because, today there is no way for an external tool to figure out the list of all offline partitions. If we were to build a Kafka cluster dashboard and list partitions and their metadata, we would want to know the leader for each partition. Until a new leader is elected, we continue to store the previous leader in zookeeper. If the partition goes offline and no new leader will ever come up, we still store the previous leader. This is not ideal and it might be worth to store some value like -1 to denote an offline partition&lt;/p&gt;

&lt;p&gt;3. Cleaned up logging for a partition. There were several places in the code that used a custom string like &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;%s, %d&amp;#93;&lt;/span&gt;&quot; or &quot;(%s, %d)&quot; to print a partition. This makes it very hard to trace the state changes on a partition while troubleshooting. I changed everything in kafka.controller to standardize on the toString() API of TopicAndPartition. I&apos;m assuming the rest of the code will get cleaned up as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-649&quot; title=&quot;Cleanup log4j logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-649&quot;&gt;&lt;del&gt;KAFKA-649&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13559334" author="junrao" created="Tue, 22 Jan 2013 03:11:00 +0000"  >&lt;p&gt;Thanks for the patch. Overall, looks good. A couple of minor comments:&lt;/p&gt;

&lt;p&gt;1. PartitionStateMachine: The patch sets the ISR in ZK to empty every time the partition goes offline. This means that, in the most common case when we can elect another broker as the leader, we will need to update ISR in ZK twice when the leader gone, the first time to set it to empty and the second time to set it to the new leader. I am wondering if we should set the ISR in ZK to empty in OfflinePartitionLeaderSelector.selectLeader() just before we throw a PartitionOfflineException. This way, in the common case, we avoid an extra ZK write.&lt;/p&gt;

&lt;p&gt;2. UtilTest,testCsvList():     assertTrue(emptyStringList!=null) should probably be  assertTrue(emptyList!=null)&lt;/p&gt;</comment>
                            <comment id="13559786" author="nehanarkhede" created="Tue, 22 Jan 2013 17:29:06 +0000"  >&lt;p&gt;1. Good point. I moved setting the leader to -1 to the removeReplicaFromIsr API. Basically, if you are removing a leader from the isr, then just set the leader field to -1 and remove it from the isr&lt;/p&gt;

&lt;p&gt;2. Included the fix&lt;/p&gt;</comment>
                            <comment id="13561024" author="junrao" created="Wed, 23 Jan 2013 19:54:40 +0000"  >&lt;p&gt;There is a typo logIndent in Logging that causes a compilation error. Other than that, +1 for patch v2. Once the typo is fixed, the patch can be checked in.&lt;/p&gt;</comment>
                            <comment id="13561142" author="nehanarkhede" created="Wed, 23 Jan 2013 22:06:10 +0000"  >&lt;p&gt;Fixed the typo, checked in patch v2. Thanks for the review!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12628597">KAFKA-715</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12565869" name="kafka-708-v1.patch" size="33503" author="nehanarkhede" created="Mon, 21 Jan 2013 22:37:57 +0000"/>
                            <attachment id="12565974" name="kafka-708-v2.patch" size="36411" author="nehanarkhede" created="Tue, 22 Jan 2013 17:29:06 +0000"/>
                            <attachment id="12565237" name="kafka-request.log.2013-01-16-15" size="44118" author="swapnilghike" created="Thu, 17 Jan 2013 01:40:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>304818</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 43 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17w5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>254179</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>