<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:31:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-14099] No REST API request logs in Kafka connect</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-14099</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Prior to 2.2.1, when an REST API request was performed, there was a request log in the log file:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2022-07-23 07:18:16,128] INFO 172.18.0.1 - - [23/Jul/2022:07:18:16 +0000] &lt;span class=&quot;code-quote&quot;&gt;&quot;GET /connectors HTTP/1.1&quot;&lt;/span&gt; 200 2 &lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;curl/7.81.0&quot;&lt;/span&gt; 66 (org.apache.kafka.connect.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.RestServer:62)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Since 2.2.1, no more request logs.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;With a bisect, I found the problem comes from &lt;a href=&quot;https://github.com/apache/kafka/pull/6651&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR 6651&lt;/a&gt; to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8304&quot; title=&quot;Connect susceptible to deadlock while registering REST extensions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8304&quot;&gt;&lt;del&gt;KAFKA-8304&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From what I understand of the problem, the ContextHandlerCollection is added in the Server (&lt;a href=&quot;https://github.com/dongjinleekr/kafka/blob/63a6130af30536d67fca5802005695a84c875b5e/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/rest/RestServer.java#L195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dongjinleekr/kafka/blob/63a6130af30536d67fca5802005695a84c875b5e/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/rest/RestServer.java#L195&lt;/a&gt;) before handlers are really added in the ContextHandlerCollection (&lt;a href=&quot;https://github.com/dongjinleekr/kafka/blob/63a6130af30536d67fca5802005695a84c875b5e/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/rest/RestServer.java#L296&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dongjinleekr/kafka/blob/63a6130af30536d67fca5802005695a84c875b5e/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/rest/RestServer.java#L296&lt;/a&gt;).&lt;br/&gt;
I don&apos;t know the impact on other handlers, but clearly it doesn&apos;t work for the RequestLogHandler.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A solution I found for the logging issue is to set the RequestLog directly in the server without using an handlers:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git i/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;/RestServer.java w/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;/RestServer.java
index ab18419efc..4d09cc0e6c 100644
--- i/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;/RestServer.java
+++ w/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;/RestServer.java
@@ -187,6 +187,11 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;RestServer {
     &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void initializeServer() {
         log.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Initializing REST server&quot;&lt;/span&gt;);
 
+        Slf4jRequestLogWriter slf4jRequestLogWriter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Slf4jRequestLogWriter();
+        slf4jRequestLogWriter.setLoggerName(RestServer.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getCanonicalName());
+        CustomRequestLog requestLog = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CustomRequestLog(slf4jRequestLogWriter, CustomRequestLog.EXTENDED_NCSA_FORMAT + &lt;span class=&quot;code-quote&quot;&gt;&quot; %{ms}T&quot;&lt;/span&gt;);
+        jettyServer.setRequestLog(requestLog);
+
         &lt;span class=&quot;code-comment&quot;&gt;/* Needed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; graceful shutdown as per `setStopTimeout` documentation */&lt;/span&gt;
         StatisticsHandler statsHandler = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StatisticsHandler();
         statsHandler.setHandler(handlers);
@@ -275,14 +280,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;RestServer {
             configureHttpResponsHeaderFilter(context);
         }
 
-        RequestLogHandler requestLogHandler = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RequestLogHandler();
-        Slf4jRequestLogWriter slf4jRequestLogWriter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Slf4jRequestLogWriter();
-        slf4jRequestLogWriter.setLoggerName(RestServer.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getCanonicalName());
-        CustomRequestLog requestLog = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CustomRequestLog(slf4jRequestLogWriter, CustomRequestLog.EXTENDED_NCSA_FORMAT + &lt;span class=&quot;code-quote&quot;&gt;&quot; %{ms}T&quot;&lt;/span&gt;);
-        requestLogHandler.setRequestLog(requestLog);
-
         contextHandlers.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultHandler());
-        contextHandlers.add(requestLogHandler);
 
         handlers.setHandlers(contextHandlers.toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Handler[0]));
         &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Same issue raised on StackOverflow: &lt;a href=&quot;https://stackoverflow.com/questions/67699702/no-rest-api-logs-in-kafka-connect&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/67699702/no-rest-api-logs-in-kafka-connect&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13473048">KAFKA-14099</key>
            <summary>No REST API request logs in Kafka connect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zigarn">Alexandre Garnier</assignee>
                                    <reporter username="zigarn">Alexandre Garnier</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 23 Jul 2022 07:42:31 +0000</created>
                <updated>Wed, 12 Oct 2022 14:29:20 +0000</updated>
                            <resolved>Wed, 12 Oct 2022 14:29:20 +0000</resolved>
                                    <version>3.2.0</version>
                                    <fixVersion>3.4.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17571115" author="chrisegerton" created="Mon, 25 Jul 2022 22:05:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zigarn&quot; class=&quot;user-hover&quot; rel=&quot;zigarn&quot;&gt;zigarn&lt;/a&gt; Since you filed a PR to address this (thanks again for the fix!), I&apos;ve assigned the ticket to you. Feel free to unassign at any point if you want to signal to others that nobody is actively working on this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z17440:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>ChrisEgerton</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>