<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:43:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-972] MetadataRequest returns stale list of brokers</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-972</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When we issue an metadatarequest towards the cluster, the list of brokers is stale. I mean, even when a broker is down, it&apos;s returned back to the client. The following are examples of two invocations one with both brokers online and the second with a broker down:&lt;/p&gt;

&lt;p&gt;{&lt;br/&gt;
    &quot;brokers&quot;: [&lt;br/&gt;
        &lt;/p&gt;
{
            &quot;nodeId&quot;: 0,
            &quot;host&quot;: &quot;10.139.245.106&quot;,
            &quot;port&quot;: 9092,
            &quot;byteLength&quot;: 24
        }
&lt;p&gt;,&lt;/p&gt;
        {
            &quot;nodeId&quot;: 1,
            &quot;host&quot;: &quot;localhost&quot;,
            &quot;port&quot;: 9093,
            &quot;byteLength&quot;: 19
        }
&lt;p&gt;    ],&lt;br/&gt;
    &quot;topicMetadata&quot;: [&lt;br/&gt;
        {&lt;br/&gt;
            &quot;topicErrorCode&quot;: 0,&lt;br/&gt;
            &quot;topicName&quot;: &quot;foozbar&quot;,&lt;br/&gt;
            &quot;partitions&quot;: [&lt;br/&gt;
                &lt;/p&gt;
{
                    &quot;replicas&quot;: [
                        0
                    ],
                    &quot;isr&quot;: [
                        0
                    ],
                    &quot;partitionErrorCode&quot;: 0,
                    &quot;partitionId&quot;: 0,
                    &quot;leader&quot;: 0,
                    &quot;byteLength&quot;: 26
                }
&lt;p&gt;,&lt;br/&gt;
                &lt;/p&gt;
{
                    &quot;replicas&quot;: [
                        1
                    ],
                    &quot;isr&quot;: [
                        1
                    ],
                    &quot;partitionErrorCode&quot;: 0,
                    &quot;partitionId&quot;: 1,
                    &quot;leader&quot;: 1,
                    &quot;byteLength&quot;: 26
                }
&lt;p&gt;,&lt;br/&gt;
                &lt;/p&gt;
{
                    &quot;replicas&quot;: [
                        0
                    ],
                    &quot;isr&quot;: [
                        0
                    ],
                    &quot;partitionErrorCode&quot;: 0,
                    &quot;partitionId&quot;: 2,
                    &quot;leader&quot;: 0,
                    &quot;byteLength&quot;: 26
                }
&lt;p&gt;,&lt;br/&gt;
                &lt;/p&gt;
{
                    &quot;replicas&quot;: [
                        1
                    ],
                    &quot;isr&quot;: [
                        1
                    ],
                    &quot;partitionErrorCode&quot;: 0,
                    &quot;partitionId&quot;: 3,
                    &quot;leader&quot;: 1,
                    &quot;byteLength&quot;: 26
                }
&lt;p&gt;,&lt;/p&gt;
                {
                    &quot;replicas&quot;: [
                        0
                    ],
                    &quot;isr&quot;: [
                        0
                    ],
                    &quot;partitionErrorCode&quot;: 0,
                    &quot;partitionId&quot;: 4,
                    &quot;leader&quot;: 0,
                    &quot;byteLength&quot;: 26
                }
&lt;p&gt;            ],&lt;br/&gt;
            &quot;byteLength&quot;: 145&lt;br/&gt;
        }&lt;br/&gt;
    ],&lt;br/&gt;
    &quot;responseSize&quot;: 200,&lt;br/&gt;
    &quot;correlationId&quot;: -1000&lt;br/&gt;
}&lt;/p&gt;


&lt;p&gt;{&lt;br/&gt;
    &quot;brokers&quot;: [&lt;br/&gt;
        &lt;/p&gt;
{
            &quot;nodeId&quot;: 0,
            &quot;host&quot;: &quot;10.139.245.106&quot;,
            &quot;port&quot;: 9092,
            &quot;byteLength&quot;: 24
        }
&lt;p&gt;,&lt;/p&gt;
        {
            &quot;nodeId&quot;: 1,
            &quot;host&quot;: &quot;localhost&quot;,
            &quot;port&quot;: 9093,
            &quot;byteLength&quot;: 19
        }
&lt;p&gt;    ],&lt;br/&gt;
    &quot;topicMetadata&quot;: [&lt;br/&gt;
        {&lt;br/&gt;
            &quot;topicErrorCode&quot;: 0,&lt;br/&gt;
            &quot;topicName&quot;: &quot;foozbar&quot;,&lt;br/&gt;
            &quot;partitions&quot;: [&lt;br/&gt;
                &lt;/p&gt;
{
                    &quot;replicas&quot;: [
                        0
                    ],
                    &quot;isr&quot;: [],
                    &quot;partitionErrorCode&quot;: 5,
                    &quot;partitionId&quot;: 0,
                    &quot;leader&quot;: -1,
                    &quot;byteLength&quot;: 22
                }
&lt;p&gt;,&lt;br/&gt;
                &lt;/p&gt;
{
                    &quot;replicas&quot;: [
                        1
                    ],
                    &quot;isr&quot;: [
                        1
                    ],
                    &quot;partitionErrorCode&quot;: 0,
                    &quot;partitionId&quot;: 1,
                    &quot;leader&quot;: 1,
                    &quot;byteLength&quot;: 26
                }
&lt;p&gt;,&lt;br/&gt;
                &lt;/p&gt;
{
                    &quot;replicas&quot;: [
                        0
                    ],
                    &quot;isr&quot;: [],
                    &quot;partitionErrorCode&quot;: 5,
                    &quot;partitionId&quot;: 2,
                    &quot;leader&quot;: -1,
                    &quot;byteLength&quot;: 22
                }
&lt;p&gt;,&lt;br/&gt;
                &lt;/p&gt;
{
                    &quot;replicas&quot;: [
                        1
                    ],
                    &quot;isr&quot;: [
                        1
                    ],
                    &quot;partitionErrorCode&quot;: 0,
                    &quot;partitionId&quot;: 3,
                    &quot;leader&quot;: 1,
                    &quot;byteLength&quot;: 26
                }
&lt;p&gt;,&lt;/p&gt;
                {
                    &quot;replicas&quot;: [
                        0
                    ],
                    &quot;isr&quot;: [],
                    &quot;partitionErrorCode&quot;: 5,
                    &quot;partitionId&quot;: 4,
                    &quot;leader&quot;: -1,
                    &quot;byteLength&quot;: 22
                }
&lt;p&gt;            ],&lt;br/&gt;
            &quot;byteLength&quot;: 133&lt;br/&gt;
        }&lt;br/&gt;
    ],&lt;br/&gt;
    &quot;responseSize&quot;: 188,&lt;br/&gt;
    &quot;correlationId&quot;: -1000&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment></environment>
        <key id="12657261">KAFKA-972</key>
            <summary>MetadataRequest returns stale list of brokers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="singhashish">Ashish Singh</assignee>
                                    <reporter username="vccarvalho">Vinicius Carvalho</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Jul 2013 13:34:07 +0000</created>
                <updated>Tue, 14 Jul 2015 18:22:34 +0000</updated>
                            <resolved>Tue, 14 Jul 2015 00:17:09 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.9.0.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13766570" author="junrao" created="Fri, 13 Sep 2013 15:58:34 +0000"  >&lt;p&gt;Could you describe how to reproduce this?&lt;/p&gt;</comment>
                            <comment id="13766639" author="nehanarkhede" created="Fri, 13 Sep 2013 17:00:52 +0000"  >&lt;p&gt;Is this repetitive or the metadata starts returning consistent data after some time ? Since the metadata is communicated to the brokers by the controller, it is possible that there is a time window after an event has happened and before all the brokers have learned of the event.&lt;/p&gt;</comment>
                            <comment id="14599577" author="granthenke" created="Wed, 24 Jun 2015 15:28:19 +0000"  >&lt;p&gt;Sample Failing Tests:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testBrokerMetadataOnClusterWithNoTopics&lt;/li&gt;
	&lt;li&gt;testBrokerMetadataOnBrokerShutdown&lt;/li&gt;
	&lt;li&gt;testBrokerMetadataOnBrokerAddition&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14600602" author="singhashish" created="Thu, 25 Jun 2015 03:10:16 +0000"  >&lt;p&gt;Hey Guys,&lt;/p&gt;

&lt;p&gt;I spent some time reproducing the issue and finding the root cause. Turns out &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1367&quot; title=&quot;Broker topic metadata not kept in sync with ZooKeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1367&quot;&gt;&lt;del&gt;KAFKA-1367&lt;/del&gt;&lt;/a&gt; is not the issue here. Below is the problem and my suggested solution.&lt;/p&gt;

&lt;p&gt;Problem:&lt;br/&gt;
Alive brokers list not being propagated to brokers by coordinator. When a broker is started, it writes to ZK brokers path. Coordinator watches that path and notices the new broker. On noticing a new broker, the coordinator sends the UpdateMetadataRequest to only the new broker that just started up. The other brokers in cluster never gets to know that there are new brokers in the cluster.&lt;/p&gt;

&lt;p&gt;Effect of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1367&quot; title=&quot;Broker topic metadata not kept in sync with ZooKeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1367&quot;&gt;&lt;del&gt;KAFKA-1367&lt;/del&gt;&lt;/a&gt;: After &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1367&quot; title=&quot;Broker topic metadata not kept in sync with ZooKeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1367&quot;&gt;&lt;del&gt;KAFKA-1367&lt;/del&gt;&lt;/a&gt; goes in it correct alive brokers information will be propagated to all live brokers after ISR changes at any broker. However, if there are no topics/ partitions &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1367&quot; title=&quot;Broker topic metadata not kept in sync with ZooKeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1367&quot;&gt;&lt;del&gt;KAFKA-1367&lt;/del&gt;&lt;/a&gt; will not help and this issue will still be there.&lt;/p&gt;

&lt;p&gt;Solution:&lt;br/&gt;
Instead of sending the UpdateMetadataRequest only to new broker, send it to all live brokers in the cluster.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nehanarkhede&quot; class=&quot;user-hover&quot; rel=&quot;nehanarkhede&quot;&gt;nehanarkhede&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=granthenke&quot; class=&quot;user-hover&quot; rel=&quot;granthenke&quot;&gt;granthenke&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gwenshap&quot; class=&quot;user-hover&quot; rel=&quot;gwenshap&quot;&gt;gwenshap&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=charmalloc&quot; class=&quot;user-hover&quot; rel=&quot;charmalloc&quot;&gt;charmalloc&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjkoshy&quot; class=&quot;user-hover&quot; rel=&quot;jjkoshy&quot;&gt;jjkoshy&lt;/a&gt; please provide your thoughts. I have a patch ready which I will post if you guys think this is indeed the correct approach. I have verified that above approach fixes the issue.&lt;/p&gt;</comment>
                            <comment id="14601817" author="granthenke" created="Thu, 25 Jun 2015 19:50:49 +0000"  >&lt;p&gt;This solutions sounds reasonable to me.&lt;/p&gt;</comment>
                            <comment id="14606755" author="singhashish" created="Tue, 30 Jun 2015 00:46:17 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/36030/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/36030/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="14609426" author="singhashish" created="Wed, 1 Jul 2015 01:42:29 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/36030/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/36030/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="14609739" author="singhashish" created="Wed, 1 Jul 2015 08:37:10 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/36030/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/36030/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="14609749" author="singhashish" created="Wed, 1 Jul 2015 08:43:05 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/36030/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/36030/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="14610423" author="singhashish" created="Wed, 1 Jul 2015 15:06:25 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/36030/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/36030/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="14616238" author="singhashish" created="Tue, 7 Jul 2015 06:07:48 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/36030/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/36030/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="14617047" author="singhashish" created="Tue, 7 Jul 2015 17:42:55 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/36030/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/36030/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="14618050" author="singhashish" created="Wed, 8 Jul 2015 06:24:26 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/36030/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/36030/&lt;/a&gt;&lt;br/&gt;
 against branch trunk&lt;/p&gt;</comment>
                            <comment id="14622967" author="singhashish" created="Fri, 10 Jul 2015 22:08:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; could you take a look, thanks.&lt;/p&gt;</comment>
                            <comment id="14625616" author="junrao" created="Tue, 14 Jul 2015 00:17:09 +0000"  >&lt;p&gt;Thanks for the latest patch. +1 and committed to trunk.&lt;/p&gt;</comment>
                            <comment id="14626807" author="singhashish" created="Tue, 14 Jul 2015 18:22:20 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12707041">KAFKA-1367</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12741634" name="BrokerMetadataTest.scala" size="3861" author="granthenke" created="Wed, 24 Jun 2015 15:28:19 +0000"/>
                            <attachment id="12742664" name="KAFKA-972.patch" size="1480" author="singhashish" created="Tue, 30 Jun 2015 00:46:17 +0000"/>
                            <attachment id="12742993" name="KAFKA-972_2015-06-30_18:42:13.patch" size="9489" author="singhashish" created="Wed, 1 Jul 2015 01:42:29 +0000"/>
                            <attachment id="12743020" name="KAFKA-972_2015-07-01_01:36:56.patch" size="9036" author="singhashish" created="Wed, 1 Jul 2015 08:37:10 +0000"/>
                            <attachment id="12743021" name="KAFKA-972_2015-07-01_01:42:42.patch" size="8760" author="singhashish" created="Wed, 1 Jul 2015 08:43:05 +0000"/>
                            <attachment id="12743100" name="KAFKA-972_2015-07-01_08:06:03.patch" size="8804" author="singhashish" created="Wed, 1 Jul 2015 15:06:24 +0000"/>
                            <attachment id="12743895" name="KAFKA-972_2015-07-06_23:07:34.patch" size="8666" author="singhashish" created="Tue, 7 Jul 2015 06:07:47 +0000"/>
                            <attachment id="12744001" name="KAFKA-972_2015-07-07_10:42:41.patch" size="7991" author="singhashish" created="Tue, 7 Jul 2015 17:42:54 +0000"/>
                            <attachment id="12744146" name="KAFKA-972_2015-07-07_23:24:13.patch" size="8273" author="singhashish" created="Wed, 8 Jul 2015 06:24:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>337483</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1m7lz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>337806</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>