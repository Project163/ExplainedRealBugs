<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:12:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4041] kafka unable to reconnect to zookeeper behind an ELB</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4041</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Kafka brokers are unable to connect to  zookeeper which is behind an ELB.&lt;/p&gt;

&lt;p&gt;Kafka is using zkClient which is caching the IP address of zookeeper  and even when there is a change in the IP for zookeeper it is using the Old zookeeper IP.&lt;/p&gt;

&lt;p&gt;The server.properties has a DNS name. Ideally kafka should resolve the IP using the DNS in case of any failures connecting to the broker.&lt;/p&gt;</description>
                <environment>RHEL EC2 instances</environment>
        <key id="12997352">KAFKA-4041</key>
            <summary>kafka unable to reconnect to zookeeper behind an ELB</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ijuma">Ismael Juma</assignee>
                                    <reporter username="pdigumarthi">prabhakar</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Aug 2016 18:02:05 +0000</created>
                <updated>Tue, 16 Oct 2018 18:20:41 +0000</updated>
                            <resolved>Tue, 17 Jul 2018 20:54:35 +0000</resolved>
                                    <version>0.9.0.1</version>
                    <version>0.10.0.1</version>
                                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15828420" author="ryan p" created="Wed, 18 Jan 2017 17:15:59 +0000"  >&lt;p&gt;This is actually the result of a ZK bug which is being actively worked on here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2184&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-2184&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16260857" author="ijuma" created="Tue, 21 Nov 2017 15:00:23 +0000"  >&lt;p&gt;Marking as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5473&quot; title=&quot;handle ZK session expiration properly when a new session can&amp;#39;t be established&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5473&quot;&gt;&lt;del&gt;KAFKA-5473&lt;/del&gt;&lt;/a&gt;. In that JIRA, we will recreate the `ZooKeeper` instance if there&apos;s an issue connecting and should hopefully fix this issue too.&lt;/p&gt;</comment>
                            <comment id="16461830" author="glasser" created="Thu, 3 May 2018 01:42:10 +0000"  >&lt;p&gt;I think this should be reopened, because I think the eventually-merged &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5473&quot; title=&quot;handle ZK session expiration properly when a new session can&amp;#39;t be established&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5473&quot;&gt;&lt;del&gt;KAFKA-5473&lt;/del&gt;&lt;/a&gt; fix did not actually implement the ZooKeeper-re-creation logic. (At the very least, I know experimentally that Kafka 1.1 does not fix this bug.)&lt;/p&gt;</comment>
                            <comment id="16465965" author="ijuma" created="Mon, 7 May 2018 14:32:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=glasser&quot; class=&quot;user-hover&quot; rel=&quot;glasser&quot;&gt;glasser&lt;/a&gt;, the fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5473&quot; title=&quot;handle ZK session expiration properly when a new session can&amp;#39;t be established&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5473&quot;&gt;&lt;del&gt;KAFKA-5473&lt;/del&gt;&lt;/a&gt; doesn&apos;t help with all scenarios, just the session expiration one. We will need &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-2184&quot; title=&quot;Zookeeper Client should re-resolve hosts when connection attempts fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-2184&quot;&gt;&lt;del&gt;ZOOKEEPER-2184&lt;/del&gt;&lt;/a&gt; to handle all scenarios. Reopening.&lt;/p&gt;</comment>
                            <comment id="16547093" author="githubbot" created="Tue, 17 Jul 2018 20:53:06 +0000"  >&lt;p&gt;ijuma closed pull request #5376: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4041&quot; title=&quot;kafka unable to reconnect to zookeeper behind an ELB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4041&quot;&gt;&lt;del&gt;KAFKA-4041&lt;/del&gt;&lt;/a&gt;: Update ZooKeeper to 3.4.13&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/5376&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/5376&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/core/src/test/scala/unit/kafka/server/ServerShutdownTest.scala b/core/src/test/scala/unit/kafka/server/ServerShutdownTest.scala&lt;br/&gt;
index b402bf9e8ca..9f966b448b7 100755&lt;br/&gt;
&amp;#8212; a/core/src/test/scala/unit/kafka/server/ServerShutdownTest.scala&lt;br/&gt;
+++ b/core/src/test/scala/unit/kafka/server/ServerShutdownTest.scala&lt;br/&gt;
@@ -22,6 +22,7 @@ import kafka.utils.TestUtils._&lt;br/&gt;
 import java.io.File&lt;/p&gt;

&lt;p&gt; import kafka.log.LogManager&lt;br/&gt;
+import kafka.zookeeper.ZooKeeperClientTimeoutException&lt;br/&gt;
 import org.apache.kafka.clients.consumer.KafkaConsumer&lt;br/&gt;
 import org.apache.kafka.clients.producer.&lt;/p&gt;
{KafkaProducer, ProducerRecord}
&lt;p&gt; import org.apache.kafka.common.errors.KafkaStorageException&lt;br/&gt;
@@ -128,9 +129,10 @@ class ServerShutdownTest extends ZooKeeperTestHarness {&lt;br/&gt;
   @Test&lt;br/&gt;
   def testCleanShutdownAfterFailedStartup() &lt;/p&gt;
{
     val newProps = TestUtils.createBrokerConfig(0, zkConnect)
-    newProps.setProperty(&quot;zookeeper.connect&quot;, &quot;some.invalid.hostname.foo.bar.local:65535&quot;)
+    newProps.setProperty(KafkaConfig.ZkConnectionTimeoutMsProp, &quot;50&quot;)
+    newProps.setProperty(KafkaConfig.ZkConnectProp, &quot;some.invalid.hostname.foo.bar.local:65535&quot;)
     val newConfig = KafkaConfig.fromProps(newProps)
-    verifyCleanShutdownAfterFailedStartup[IllegalArgumentException](newConfig)
+    verifyCleanShutdownAfterFailedStartup[ZooKeeperClientTimeoutException](newConfig)
   }

&lt;p&gt;   @Test&lt;br/&gt;
@@ -175,23 +177,17 @@ class ServerShutdownTest extends ZooKeeperTestHarness {&lt;br/&gt;
   }&lt;/p&gt;

&lt;p&gt;   def verifyNonDaemonThreadsStatus() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;assertEquals(0, Thread.getAllStackTraces.keySet().toArray&lt;/li&gt;
	&lt;li&gt;.map
{ _.asInstanceOf[Thread] }
&lt;p&gt;+    assertEquals(0, Thread.getAllStackTraces.keySet.toArray&lt;br/&gt;
+      .map(_.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread&amp;#93;&lt;/span&gt;)&lt;br/&gt;
       .count(isNonDaemonKafkaThread))&lt;br/&gt;
   }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   @Test&lt;br/&gt;
   def testConsecutiveShutdown(){&lt;br/&gt;
     val server = new KafkaServer(config)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try 
{
-      server.startup()
-      server.shutdown()
-      server.awaitShutdown()
-      server.shutdown()
-      assertTrue(true)
-    }&lt;/li&gt;
	&lt;li&gt;catch
{
-      case _: Throwable =&amp;gt; fail()
-    }
&lt;p&gt;+    server.startup()&lt;br/&gt;
+    server.shutdown()&lt;br/&gt;
+    server.awaitShutdown()&lt;br/&gt;
+    server.shutdown()&lt;br/&gt;
   }&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/core/src/test/scala/unit/kafka/zookeeper/ZooKeeperClientTest.scala b/core/src/test/scala/unit/kafka/zookeeper/ZooKeeperClientTest.scala&lt;br/&gt;
index c4143e2a8e6..fcbf699ec96 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/core/src/test/scala/unit/kafka/zookeeper/ZooKeeperClientTest.scala&lt;br/&gt;
+++ b/core/src/test/scala/unit/kafka/zookeeper/ZooKeeperClientTest.scala&lt;br/&gt;
@@ -57,16 +57,16 @@ class ZooKeeperClientTest extends ZooKeeperTestHarness 
{
     System.clearProperty(JaasUtils.JAVA_LOGIN_CONFIG_PARAM)
   }&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Test(expected = classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;IllegalArgumentException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
+  @Test(expected = classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;ZooKeeperClientTimeoutException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
   def testUnresolvableConnectString(): Unit = 
{
-    new ZooKeeperClient(&quot;some.invalid.hostname.foo.bar.local&quot;, -1, -1, Int.MaxValue, time, &quot;testMetricGroup&quot;,
-      &quot;testMetricType&quot;).close()
+    new ZooKeeperClient(&quot;some.invalid.hostname.foo.bar.local&quot;, zkSessionTimeout, connectionTimeoutMs = 10,
+      Int.MaxValue, time, &quot;testMetricGroup&quot;, &quot;testMetricType&quot;).close()
   }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   @Test(expected = classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;ZooKeeperClientTimeoutException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
   def testConnectionTimeout(): Unit = &lt;/p&gt;
{
     zookeeper.shutdown()
-    new ZooKeeperClient(zkConnect, zkSessionTimeout, connectionTimeoutMs = 100, Int.MaxValue, time, &quot;testMetricGroup&quot;,
+    new ZooKeeperClient(zkConnect, zkSessionTimeout, connectionTimeoutMs = 10, Int.MaxValue, time, &quot;testMetricGroup&quot;,
       &quot;testMetricType&quot;).close()
   }

&lt;p&gt;diff --git a/gradle/dependencies.gradle b/gradle/dependencies.gradle&lt;br/&gt;
index 00aac028afe..fe1c744a79e 100644&lt;br/&gt;
&amp;#8212; a/gradle/dependencies.gradle&lt;br/&gt;
+++ b/gradle/dependencies.gradle&lt;br/&gt;
@@ -82,7 +82,7 @@ versions += [&lt;br/&gt;
   slf4j: &quot;1.7.25&quot;,&lt;br/&gt;
   snappy: &quot;1.1.7.2&quot;,&lt;br/&gt;
   zkclient: &quot;0.10&quot;,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;zookeeper: &quot;3.4.12&quot;&lt;br/&gt;
+  zookeeper: &quot;3.4.13&quot;&lt;br/&gt;
 ]&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; libs += [&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16636479" author="abhishek.agarwal" created="Wed, 3 Oct 2018 05:26:24 +0000"  >&lt;p&gt;is there any chance that this can be backported to 1.x release line? &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13080939">KAFKA-5473</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13049502">KAFKA-4871</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="12828194">ZOOKEEPER-2184</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 6 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32buv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>