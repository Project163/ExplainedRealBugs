<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:28:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-12851] Flaky Test RaftEventSimulationTest.canMakeProgressIfMajorityIsReachable</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-12851</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Failed twice on a &lt;a href=&quot;https://ci-builds.apache.org/job/Kafka/job/kafka-pr/job/PR-10755/6/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR build&lt;/a&gt;&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Stacktrace&quot;&gt;&lt;/a&gt;Stacktrace&lt;/h3&gt;

&lt;p&gt;org.opentest4j.AssertionFailedError: expected: &amp;lt;true&amp;gt; but was: &amp;lt;false&amp;gt; at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55) at org.junit.jupiter.api.AssertTrue.assertTrue(AssertTrue.java:40) at org.junit.jupiter.api.AssertTrue.assertTrue(AssertTrue.java:35) at org.junit.jupiter.api.Assertions.assertTrue(Assertions.java:162) at org.apache.kafka.raft.RaftEventSimulationTest.canMakeProgressIfMajorityIsReachable(RaftEventSimulationTest.java:263)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13380597">KAFKA-12851</key>
            <summary>Flaky Test RaftEventSimulationTest.canMakeProgressIfMajorityIsReachable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jagsancio">Jose Armando Garcia Sancio</assignee>
                                    <reporter username="ableegoldman">A. Sophie Blee-Goldman</reporter>
                        <labels>
                            <label>kip-500</label>
                    </labels>
                <created>Wed, 26 May 2021 17:33:49 +0000</created>
                <updated>Wed, 28 Jul 2021 16:29:27 +0000</updated>
                            <resolved>Wed, 28 Jul 2021 16:29:27 +0000</resolved>
                                                    <fixVersion>3.0.0</fixVersion>
                                    <component>core</component>
                    <component>kraft</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17361312" author="mjsax" created="Fri, 11 Jun 2021 00:50:05 +0000"  >&lt;p&gt;Failed again.&lt;/p&gt;</comment>
                            <comment id="17378657" author="meher_crok" created="Sun, 11 Jul 2021 13:31:11 +0000"  >&lt;p&gt;it s working fine&#160; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13030427/13030427_Capture.PNG&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17386787" author="jagsancio" created="Sat, 24 Jul 2021 23:35:07 +0000"  >&lt;p&gt;Thanks for the report and screenshot with the seed. Next time please include at least the seed in the report. The seed can be used to deterministically reproduce the failure.&lt;/p&gt;

&lt;p&gt;The seed is &lt;tt&gt;-2333626563705276482&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17386789" author="jagsancio" created="Sat, 24 Jul 2021 23:44:27 +0000"  >&lt;p&gt;Test passes with that seed against trunk. Testing before the commit that I think fixed this.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Gradle Test Executor 3 STANDARD_ERROR
    Jul 24, 2021 4:40:13 PM org.junit.platform.launcher.core.EngineDiscoveryOrchestrator lambda$logTestDescriptorExclusionReasons$7
    INFO: 0 containers and 6 tests were Method or &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;mismatch

RaftEventSimulationTest &amp;gt; canMakeProgressIfMajorityIsReachable STANDARD_OUT
    timestamp = 2021-07-24T16:40:24.928, RaftEventSimulationTest:canMakeProgressIfMajorityIsReachable =
                                  |-------------------jqwik-------------------
    tries = 100                   | # of calls to property
    checks = 100                  | # of not rejected calls
    generation = RANDOMIZED       | parameters are randomly generated
    after-failure = SAMPLE_ONLY   | only &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; the previously failed sample
    when-fixed-seed = ALLOW       | fixing the random seed is allowed
    edge-cases#mode = MIXIN       | edge cases are mixed in
    edge-cases#total = 36         | # of all combined edge cases
    edge-cases#tried = 15         | # of edge cases tried in current run
    seed = -2333626563705276482   | random seed to reproduce generated values

Gradle Test Executor 3 finished executing tests.
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17386793" author="jagsancio" created="Sat, 24 Jul 2021 23:59:32 +0000"  >&lt;p&gt;&#160;The seed in the PR build&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
timestamp = 2021-05-26T04:37:01.424183, RaftEventSimulationTest:canMakeProgressIfMajorityIsReachable = 
  org.opentest4j.AssertionFailedError:
    expected: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;gt; but was: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;gt;

                              |-------------------jqwik-------------------
tries = 3                     | # of calls to property
checks = 3                    | # of not rejected calls
generation = RANDOMIZED       | parameters are randomly generated
after-failure = PREVIOUS_SEED | use the previous seed
when-fixed-seed = ALLOW       | fixing the random seed is allowed
edge-cases#mode = MIXIN       | edge cases are mixed in
edge-cases#total = 36         | # of all combined edge cases
edge-cases#tried = 0          | # of edge cases tried in current run
seed = 137014923570865933     | random seed to reproduce generated values

Sample
------
  arg0: 807
  arg1: 2 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17386794" author="jagsancio" created="Sun, 25 Jul 2021 00:03:17 +0000"  >&lt;p&gt;It still fails against trunk&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
RaftEventSimulationTest &amp;gt; canMakeProgressIfMajorityIsReachable STANDARD_OUT
    timestamp = 2021-07-24T17:01:57.485, RaftEventSimulationTest:canMakeProgressIfMajorityIsReachable =
      org.opentest4j.AssertionFailedError:
        expected: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;gt; but was: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;gt;

                                  |-------------------jqwik-------------------
    tries = 1                     | # of calls to property
    checks = 1                    | # of not rejected calls
    generation = RANDOMIZED       | parameters are randomly generated
    after-failure = SAMPLE_ONLY   | only &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; the previously failed sample
    when-fixed-seed = ALLOW       | fixing the random seed is allowed
    edge-cases#mode = MIXIN       | edge cases are mixed in
    edge-cases#total = 0          | # of all combined edge cases
    edge-cases#tried = 0          | # of edge cases tried in current run
    seed = 137014923570865933     | random seed to reproduce generated values

    Sample
    ------
      arg0: 807
      arg1: 2

org.apache.kafka.raft.RaftEventSimulationTest.canMakeProgressIfMajorityIsReachable failed, log available in /home/jsancio/work/kafka/raft/build/reports/testOutput/org.apache.kafka.raft.RaftEventSimulationTest.canMakeProgressIfMajorityIsReachable.test.stdout

RaftEventSimulationTest &amp;gt; canMakeProgressIfMajorityIsReachable FAILED
    org.opentest4j.AssertionFailedError: expected: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;gt; but was: &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;gt;
        at org.junit.jupiter.api.AssertionUtils.fail(AssertionUtils.java:55)
        at org.junit.jupiter.api.AssertTrue.assertTrue(AssertTrue.java:40)
        at org.junit.jupiter.api.AssertTrue.assertTrue(AssertTrue.java:35)
        at org.junit.jupiter.api.Assertions.assertTrue(Assertions.java:162)
        at org.apache.kafka.raft.RaftEventSimulationTest.canMakeProgressIfMajorityIsReachable(RaftEventSimulationTest.java:264)1 test completed, 1 failed
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17387433" author="jagsancio" created="Mon, 26 Jul 2021 15:44:18 +0000"  >&lt;p&gt;The issue is with the test and not with the Raft implementation. At a high level the test runs with 5 voters until it reaches at least a high watermark of 10. At this point it partition the network so that 3 nodes cannot send request to 2 nodes and vice versa. With the seed &lt;tt&gt;137014923570865933&lt;/tt&gt; right before the partition the nodes have the following state:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Node(id=0, hw=14, logEndOffset=25)
Node(id=1, hw=10, logEndOffset=14)
Node(id=2, hw=10, logEndOffset=14)
Node(id=3, hw=10, logEndOffset=22)
Node(id=4, hw=10, logEndOffset=14)
Node(id=5, hw=10, logEndOffset=14)
Node(id=6, hw=6, logEndOffset=18)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nodes 5 and 6 are observers and do not participate in quorum or hw values. Notices that two nodes have a log end offset greater than 20 (0 and 3).&lt;/p&gt;

&lt;p&gt;The tests now partitions the network so that nodes 0, 1 can send request to each other and nodes 2, 3, 4 can send request to each other. That means that only node 1 needs to reach offset 20 before the election timeout so that the leader 0 can advance the high watermark.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Node(id=0, hw=22, logEndOffset=34)
Node(id=1, hw=18, logEndOffset=22)
Node(id=2, hw=14, logEndOffset=18)
Node(id=3, hw=10, logEndOffset=25)
Node(id=4, hw=14, logEndOffset=18)
Node(id=5, hw=18, logEndOffset=25)
Node(id=6, hw=18, logEndOffset=29)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I think that the best way to fix the test, after the partition, is to wait for the high-watermark to reach a value must larger than the LEO before the partition. In the trace above it would be a value much greater than 25.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13030427" name="Capture.PNG" size="144934" author="meher_crok" created="Sun, 11 Jul 2021 13:31:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 16 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0refk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>