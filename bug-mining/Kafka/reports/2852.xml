<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:26:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-10606] Auto create non-existent topics when fetching metadata for all topics</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-10606</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The &quot;allow auto topic creation&quot; flag is hardcoded to be true for the fetch-all-topic metadata request:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/requests/MetadataRequest.java#L37&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/requests/MetadataRequest.java#L37&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In the below code, annotation claims that &quot;&lt;b&gt;This never causes auto-creation&lt;/b&gt;&quot;. It it NOT true and auto topic creation still gets triggered under some circumstances. So, this is a bug that needs to be fixed.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/requests/MetadataRequest.java#L68&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/requests/MetadataRequest.java#L68&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;For example, the bug could be manifested in the below situation:&lt;/p&gt;

&lt;p&gt;A topic T is being deleted and a request to fetch metadata for all topics gets sent to one broker. The broker reads names of all topics from its metadata cache (shown below).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/server/KafkaApis.scala#L1196&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/server/KafkaApis.scala#L1196&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Then the broker authorizes all topics and makes sure that they are allowed to be described. Then the broker tries to get metadata for every authorized topic by reading the metadata cache again, once for every topic (show below).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/server/KafkaApis.scala#L1240&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/server/KafkaApis.scala#L1240&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However, the metadata cache could have been updated while the broker was authorizing all topics and topic T and its metadata no longer exist in the cache since the topic got deleted and metadata update requests eventually got propagated from the controller to all brokers. So, at this point, when the broker tries to get metadata for topic T from its cache, it realizes that it does not exist and the broker tries to &quot;auto create&quot; topic T since the allow-auto-topic-creation flag was set to true in all the fetch-all-topic metadata requests.&lt;/p&gt;

&lt;p&gt;I think this bug exists since &quot;&lt;b&gt;metadataRequest.allowAutoTopicCreation&lt;/b&gt;&quot; was introduced.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13335292">KAFKA-10606</key>
            <summary>Auto create non-existent topics when fetching metadata for all topics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="andrewlincong@gmail.com">Lincong Li</assignee>
                                    <reporter username="andrewlincong@gmail.com">Lincong Li</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Oct 2020 22:28:08 +0000</created>
                <updated>Wed, 9 Dec 2020 15:32:02 +0000</updated>
                            <resolved>Wed, 9 Dec 2020 15:31:14 +0000</resolved>
                                                    <fixVersion>2.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17213813" author="huxi_2b" created="Wed, 14 Oct 2020 10:43:27 +0000"  >&lt;p&gt;I am wondering if we could change the default value for &lt;em&gt;AllowAutoTopicCreation&lt;/em&gt;&#160;to &lt;em&gt;false&lt;/em&gt; in MetadataRequest.json. In doing so could we have ALL_TOPICS_REQUEST_DATA actually disable auto-creation.&lt;/p&gt;</comment>
                            <comment id="17214051" author="andrewlincong@gmail.com" created="Wed, 14 Oct 2020 16:58:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=huxi_2b&quot; class=&quot;user-hover&quot; rel=&quot;huxi_2b&quot;&gt;huxi_2b&lt;/a&gt; Thanks for your comment. However, clients set this to true explicitly on all paths, and even if they didn&apos;t this breaks behavior when getting MD for particular topics (where auto creation may be expected because the topics were named. &lt;/p&gt;

&lt;p&gt;For example, &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/requests/MetadataRequest.java#L37&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/clients/src/main/java/org/apache/kafka/common/requests/MetadataRequest.java#L37&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also changing default values for RPC objects changes the behavior for older clients. Thus it is a breaking API change. So even if we want to change the default value of that field (for hypothetical clients that don&apos;t explicitly set it), it needs to be in a new RPC version.&lt;/p&gt;

&lt;p&gt;A simple way to fix it on the server side is:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/linkedin/kafka/pull/94/commits/95ad9add181db980914a13a6ffe1a88cd5636a6d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/linkedin/kafka/pull/94/commits/95ad9add181db980914a13a6ffe1a88cd5636a6d&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I prefer the change that does not require Kafka client version upgrade. Because in some cases (e.g. LinkedIn), client version upgrade means hundreds or even thousands of Kafka users will have to bump Kafka client version in their project dependency and it makes this approach less feasible compared to the server side fix.&lt;/p&gt;

&lt;p&gt;There are definitely other options with more complex (or fancier) way to fix this issue on the server side as well.&lt;/p&gt;</comment>
                            <comment id="17214077" author="ijuma" created="Wed, 14 Oct 2020 17:19:39 +0000"  >&lt;p&gt;Seems like the way to fix this is to pass `false` as the `allowAutoTopicCreation` parameter of `getTopicMetadata` when it&apos;s an all topics request.&lt;/p&gt;</comment>
                            <comment id="17214080" author="tombentley" created="Wed, 14 Oct 2020 17:20:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andrewlincong%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;andrewlincong@gmail.com&quot;&gt;andrewlincong@gmail.com&lt;/a&gt; agreed that a broker-side fix is necessary. Are you going to open a PR for Apache Kafka too? I&apos;d assigned this to myself, since you didn&apos;t assign it to yourself, but if you&apos;re intending to open a PR then go ahead.&lt;/p&gt;</comment>
                            <comment id="17214088" author="andrewlincong@gmail.com" created="Wed, 14 Oct 2020 17:30:08 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tombentley&quot; class=&quot;user-hover&quot; rel=&quot;tombentley&quot;&gt;tombentley&lt;/a&gt;. Thanks for your comment. I will open a PR with the same change in &lt;a href=&quot;https://github.com/linkedin/kafka/pull/94/commits/95ad9add181db980914a13a6ffe1a88cd5636a6d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/linkedin/kafka/pull/94/commits/95ad9add181db980914a13a6ffe1a88cd5636a6d&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks for your comment as well &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt;, I prefer broker-side fix instead of client-side fix since the client-side fix requires Kafka users&apos; client version upgrade and it is much more difficult to do compared to deploy a new version of Kafka server. Let me know whether you have any particular concerns regarding the broker-side fix.&lt;/p&gt;</comment>
                            <comment id="17214130" author="andrewlincong@gmail.com" created="Wed, 14 Oct 2020 18:20:10 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tombentley&quot; class=&quot;user-hover&quot; rel=&quot;tombentley&quot;&gt;tombentley&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; I just created a PR. Let me know if you have any feedback or suggestions. Thanks!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/9435&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/9435&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 4 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0joe8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>