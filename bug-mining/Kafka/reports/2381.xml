<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:20:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-8671] NullPointerException occurs if topic associated with GlobalKTable changes</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-8671</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The following NullPointerException occurs when the global/.checkpoint file contains a line with a topic previously associated with (but no longer configured for) a GlobalKTable:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.NullPointerException
at org.apache.kafka.streams.processor.internals.GlobalStateUpdateTask.update(GlobalStateUpdateTask.java:85)
at org.apache.kafka.streams.processor.internals.GlobalStreamThread$StateConsumer.pollAndUpdate(GlobalStreamThread.java:241)
at org.apache.kafka.streams.processor.internals.GlobalStreamThread.run(GlobalStreamThread.java:290)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;After line 84 (&lt;a href=&quot;https://github.com/apache/kafka/blob/2.0/streams/src/main/java/org/apache/kafka/streams/processor/internals/GlobalStateUpdateTask.java#L84)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/2.0/streams/src/main/java/org/apache/kafka/streams/processor/internals/GlobalStateUpdateTask.java#L84)&lt;/a&gt;&#160;`sourceNodeAndDeserializer` is null for the old, but still valid, topic.&#160;This can be reproduced with the following sequence:&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;create a GlobalKTable associated with topic, &apos;global-topic1&apos;&lt;/li&gt;
	&lt;li&gt;change the topic associated with&#160;the GlobalKTable to &apos;global-topic2&apos;&#160;
	&lt;ol&gt;
		&lt;li&gt;&#160;at this point, the global/.checkpoint file will contain lines for both topics&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;produce messages to previous topic (&apos;global-topic1&apos;)&lt;/li&gt;
	&lt;li&gt;the consumer will attempt to consume from global-topic1, but no deserializer associated with global-topic1 will be found and the NPE will occur&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;It looks like the following recent commit has included checkpoint validations that may prevent this issue:&#160;&lt;a href=&quot;https://github.com/apache/kafka/commit/53b4ce5c00d61be87962f603682873665155cec4#diff-cc98a6c20f2a8483e1849aea6921c34dR425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/commit/53b4ce5c00d61be87962f603682873665155cec4#diff-cc98a6c20f2a8483e1849aea6921c34dR425&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13245072">KAFKA-8671</key>
            <summary>NullPointerException occurs if topic associated with GlobalKTable changes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleung181">Alex Leung</assignee>
                                    <reporter username="aleung181">Alex Leung</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Jul 2019 23:47:48 +0000</created>
                <updated>Tue, 15 Oct 2019 05:02:24 +0000</updated>
                            <resolved>Tue, 15 Oct 2019 05:02:24 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>2.1.0</version>
                    <version>2.2.0</version>
                    <version>2.3.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16885709" author="mjsax" created="Mon, 15 Jul 2019 23:54:20 +0000"  >&lt;p&gt;This issue might be related to&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5998&quot; title=&quot;/.checkpoint.tmp Not found exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5998&quot;&gt;&lt;del&gt;KAFKA-5998&lt;/del&gt;&lt;/a&gt; &#8211; if we cannot reproduce on `trunk` any longer, the fix of&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5998&quot; title=&quot;/.checkpoint.tmp Not found exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5998&quot;&gt;&lt;del&gt;KAFKA-5998&lt;/del&gt;&lt;/a&gt; might fix this one, too.&lt;/p&gt;</comment>
                            <comment id="16886676" author="aleung181" created="Wed, 17 Jul 2019 04:47:55 +0000"  >&lt;p&gt;I was able to reproduce this on trunk.&#160;&lt;/p&gt;

&lt;p&gt;`checkpointFileCache` populated with everything from .checkpoint &lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/streams/src/main/java/org/apache/kafka/streams/processor/internals/GlobalStateManagerImpl.java#L123&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Then `globalConsumer` assigned &lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/streams/src/main/java/org/apache/kafka/streams/processor/internals/GlobalStreamThread.java#L230&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;, and `globalConsumer.subscriptions.subscription` includes the &quot;old&quot; topic.&lt;/p&gt;

&lt;p&gt;When we get to `pollAndUpdate`, leads to the same NPE:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.kafka.streams.processor.internals.GlobalStateUpdateTask.update(GlobalStateUpdateTask.java:86)
org.apache.kafka.streams.processor.internals.GlobalStreamThread$StateConsumer.pollAndUpdate(GlobalStreamThread.java:241)
org.apache.kafka.streams.processor.internals.GlobalStreamThread.run(GlobalStreamThread.java:290
apache/kafka/streams/processor/internals/GlobalStreamThread.java#L241&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16889904" author="aleung181" created="Mon, 22 Jul 2019 04:36:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt; any reason not to assign this jira to myself and submit a PR?&lt;/p&gt;</comment>
                            <comment id="16891216" author="mjsax" created="Tue, 23 Jul 2019 17:13:33 +0000"  >&lt;p&gt;No reason. Go ahead &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16891431" author="aleung181" created="Tue, 23 Jul 2019 22:40:45 +0000"  >&lt;p&gt;I cannot assign this Jira to myself. Do you have the power to add me to the contributor list? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16891465" author="guozhang" created="Tue, 23 Jul 2019 23:31:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aleung181&quot; class=&quot;user-hover&quot; rel=&quot;aleung181&quot;&gt;aleung181&lt;/a&gt; I&apos;ve assigned the ticket to you, thanks for contributing!&lt;/p&gt;

&lt;p&gt;As for the issue itself.&lt;/p&gt;</comment>
                            <comment id="16891467" author="guozhang" created="Tue, 23 Jul 2019 23:34:33 +0000"  >&lt;p&gt;&lt;b&gt;(typing too fast)&lt;/b&gt; As for the issue itself, I think the idea of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5998&quot; title=&quot;/.checkpoint.tmp Not found exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5998&quot;&gt;&lt;del&gt;KAFKA-5998&lt;/del&gt;&lt;/a&gt; could still be applied: when reading from the checkpoint file, if the corresponding topic is no longer in our interested changelog topic list, we should filter it out in our assigned partitions of the restore.consumer.&lt;/p&gt;</comment>
                            <comment id="16891483" author="aleung181" created="Wed, 24 Jul 2019 00:00:34 +0000"  >&lt;p&gt;What I did was prune the checkpointFileCache of all entries that are not associated with a global state store at the time of initializing&#160;it. See&#160;&lt;a href=&quot;https://github.com/apache/kafka/compare/trunk...amleung21:global_checkpoint_npe_fix_2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/compare/trunk...amleung21:global_checkpoint_npe_fix_2&lt;/a&gt;&#160;for the potential fix.&lt;/p&gt;</comment>
                            <comment id="16891971" author="guozhang" created="Wed, 24 Jul 2019 16:17:16 +0000"  >&lt;p&gt;I looked at the diff and it looks promising to me.&lt;/p&gt;

&lt;p&gt;Could you file a PR following the contribution guidelines as well? &lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/Contributing+Code+Changes#ContributingCodeChanges-PullRequest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/KAFKA/Contributing+Code+Changes#ContributingCodeChanges-PullRequest&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vvcephei&quot; class=&quot;user-hover&quot; rel=&quot;vvcephei&quot;&gt;vvcephei&lt;/a&gt; for reviewing this change.&lt;/p&gt;</comment>
                            <comment id="16891984" author="aleung181" created="Wed, 24 Jul 2019 16:32:57 +0000"  >&lt;p&gt;Thanks for taking a look, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;. I also wanted to add a unit test for this but haven&apos;t had time yet. Will add that and submit a PR.&lt;/p&gt;</comment>
                            <comment id="16904152" author="githubbot" created="Fri, 9 Aug 2019 19:40:06 +0000"  >&lt;p&gt;amleung21 commented on pull request #7188: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8671&quot; title=&quot;NullPointerException occurs if topic associated with GlobalKTable changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8671&quot;&gt;&lt;del&gt;KAFKA-8671&lt;/del&gt;&lt;/a&gt;: NullPointerException occurs if topic associated with GlobalKTable changes&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7188&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7188&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Fix NullPointerException that occurs when the global/.checkpoint file contains a line with an obsolete (but valid) topic by pruning non-relevant topics from the checkpoint cache.&lt;/p&gt;

&lt;p&gt;   Added a unit test to verify that non-relevant topics are pruned from the checkpoint cache by GlobalStateManagerImpl. Also, manually ran a streams application with a modified global/.checkpoint file containing an obsolete topic partition and verified that 1) the NullPointerException no longer occurs and 2) the obsolete topic is removed from the global/.checkpoint file.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16943007" author="githubbot" created="Wed, 2 Oct 2019 17:23:14 +0000"  >&lt;p&gt;amleung21 commented on pull request #7188: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8671&quot; title=&quot;NullPointerException occurs if topic associated with GlobalKTable changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8671&quot;&gt;&lt;del&gt;KAFKA-8671&lt;/del&gt;&lt;/a&gt;: NullPointerException occurs if topic associated with GlobalKTable changes&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7188&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7188&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16943181" author="githubbot" created="Wed, 2 Oct 2019 21:38:59 +0000"  >&lt;p&gt;amleung21 commented on pull request #7437: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8671&quot; title=&quot;NullPointerException occurs if topic associated with GlobalKTable changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8671&quot;&gt;&lt;del&gt;KAFKA-8671&lt;/del&gt;&lt;/a&gt;: NullPointerException occurs if topic associated with GlobalKTable changes&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7437&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7437&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   A NullPointerException occurs when the global/.checkpoint file contains a line with an obsolete (but valid) topic. Log an error and throw exception when non-relevant topic-partitions from checkpoint file are encountered.&lt;/p&gt;

&lt;p&gt;   Added a unit test to verify that non-relevant topics are detected and an exception is thrown. Also, manually ran a streams application with a modified global/.checkpoint file containing an obsolete topic partition and verified that the error is logged and initialization fails.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16951598" author="githubbot" created="Tue, 15 Oct 2019 04:47:55 +0000"  >&lt;p&gt;mjsax commented on pull request #7437: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-8671&quot; title=&quot;NullPointerException occurs if topic associated with GlobalKTable changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-8671&quot;&gt;&lt;del&gt;KAFKA-8671&lt;/del&gt;&lt;/a&gt;: NullPointerException occurs if topic associated with GlobalKTable changes&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7437&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7437&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13106225">KAFKA-5998</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z04p08:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>