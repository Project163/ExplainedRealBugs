<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:23:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9768] rest.advertised.listener configuration is not handled properly by the worker</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9768</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The &lt;tt&gt;rest.advertised.listener&lt;/tt&gt;&#160;config can currently be set to either &quot;http&quot; or &quot;https&quot;, and a listener with that protocol should be used when advertising the URL of the worker to other members of the Connect cluster.&lt;/p&gt;

&lt;p&gt;For example, someone might configure their worker with a &lt;tt&gt;listeners&lt;/tt&gt; value of &lt;tt&gt;&lt;a href=&quot;https://localhost:42069%2Chttp//localhost:4761&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://localhost:42069,http://localhost:4761&lt;/a&gt;&lt;/tt&gt; and a &lt;tt&gt;rest.advertised.listener&lt;/tt&gt;&#160;value of &lt;tt&gt;http&lt;/tt&gt;, which should cause the worker to listen on port &lt;tt&gt;42069&lt;/tt&gt; with TLS and port &lt;tt&gt;4761&lt;/tt&gt; with plaintext, and advertise the URL &lt;tt&gt;&lt;a href=&quot;http://localhost:4761/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:4761&lt;/a&gt;&lt;/tt&gt; to other workers.&lt;/p&gt;

&lt;p&gt;However, the worker instead advertises the URL &lt;tt&gt;&lt;a href=&quot;https://localhost:42069/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://localhost:42069&lt;/a&gt;&lt;/tt&gt; to other workers. This is because the &lt;tt&gt;RestServer&lt;/tt&gt; class, which is responsible for determining which URL to advertise to other workers, simply &lt;a href=&quot;https://github.com/apache/kafka/blob/0f48446690e42b78a9a6b8c6a9bbab9f01d84cb1/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/rest/RestServer.java#L422&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;chooses the first listener whose name begins with the protocol&lt;/a&gt;&#160;specified in the &lt;tt&gt;rest.advertised.listener&lt;/tt&gt; config.&lt;/p&gt;

&lt;p&gt;This breaks because &quot;http&quot; is a prefix of &quot;https&quot;, so if the advertised listener is &quot;http&quot; but the first listener that&apos;s found starts with &quot;https://&quot;, that listener will still be chosen.&lt;/p&gt;

&lt;p&gt;This bug has been present since SSL support (and the &lt;tt&gt;rest.advertised.listener&lt;/tt&gt; config) were added via &lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-208%3A+Add+SSL+support+to+Kafka+Connect+REST+interface&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;KIP-208&lt;/a&gt;, in release 1.1.0.&lt;/p&gt;

&lt;p&gt;This bug should only present in the case where a user has set &lt;tt&gt;rest.advertised.listener&lt;/tt&gt;&#160;to &lt;tt&gt;http&lt;/tt&gt; but the &lt;tt&gt;listeners&lt;/tt&gt; list begins with a listener that uses &lt;tt&gt;https&lt;/tt&gt;. A workaround can be performed by changing the order of the &lt;tt&gt;listeners&lt;/tt&gt; list to put the desired advertised listener at the beginning.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13294051">KAFKA-9768</key>
            <summary>rest.advertised.listener configuration is not handled properly by the worker</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ChrisEgerton">Chris Egerton</assignee>
                                    <reporter username="ChrisEgerton">Chris Egerton</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Mar 2020 00:39:40 +0000</created>
                <updated>Thu, 7 May 2020 01:30:35 +0000</updated>
                            <resolved>Thu, 7 May 2020 01:30:35 +0000</resolved>
                                                    <fixVersion>2.4.2</fixVersion>
                    <fixVersion>2.5.1</fixVersion>
                    <fixVersion>2.6.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17067275" author="githubbot" created="Thu, 26 Mar 2020 01:18:45 +0000"  >&lt;p&gt;C0urante commented on pull request #8360: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9768&quot; title=&quot;rest.advertised.listener configuration is not handled properly by the worker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9768&quot;&gt;&lt;del&gt;KAFKA-9768&lt;/del&gt;&lt;/a&gt;: Fix handling of rest.advertised.listener config&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8360&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8360&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &lt;span class=&quot;error&quot;&gt;&amp;#91;Jira&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9768&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-9768&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;   The `rest.advertised.listener` config is currently broken as setting it to `http` when listeners are configured for both `https` and `http` will cause the framework to choose whichever of the two listeners is listed first. The changes here attempt to fix this by checking not only that `Connector::getName` begins with the specified protocol, but also that that protocol is immediately followed by an underscore, which Jetty appears to use as a delimiter between the protocol and the remainder of the connector name.&lt;/p&gt;

&lt;p&gt;   An existing unit test for the `RestServer::advertisedUrl` method has been expanded to include a case that fails with the framework in its current state and passes with the changes in this PR.&lt;/p&gt;

&lt;p&gt;   It&apos;s unclear how the name for a Jetty `Connector` is calculated; it would be good to get assurances on that front before merging any changes relying on the name matching a given format. Opening this PR now to hopefully get some visibility into that and also to get review on the changes assuming they align with how Jetty works.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17073073" author="rhauch" created="Wed, 1 Apr 2020 18:36:10 +0000"  >&lt;p&gt;Is it true that one can order the listeners such that the listener that matches the advertised listener comes first? If so, let&apos;s document that as a workaround.&lt;/p&gt;</comment>
                            <comment id="17073083" author="chrisegerton" created="Wed, 1 Apr 2020 18:43:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhauch&quot; class=&quot;user-hover&quot; rel=&quot;rhauch&quot;&gt;rhauch&lt;/a&gt;&#160;this is already called out in the description:&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;A workaround can be performed by changing the order of the&#160;&lt;tt&gt;listeners&lt;/tt&gt;&#160;list to put the desired advertised listener at the beginning.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0cwyw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>