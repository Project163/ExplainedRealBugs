<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:25:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9666] Transactional producer Epoch could not be reset</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9666</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;As of today, the producer epoch keeps increasing until it hits Short.Max. The correct behavior at this point should be making another call to re-initialize a new PID, otherwise trying with Short.Max will throw fatal exception which eventually kills the producer.&lt;/p&gt;

&lt;p&gt;Stream log:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2020-03-04T20:25:41-08:00&amp;#93;&lt;/span&gt; (streams-soak-2-5-eos_soak_i-00d70680c58afa228_streamslog) &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-03-05 04:25:41,147&amp;#93;&lt;/span&gt; ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;stream-soak-test-689bb912-b06c-4c42-88e5-d9578f7ebfdf-StreamThread-3&amp;#93;&lt;/span&gt; Thread    StreamsThread threadId: stream-soak-test-689bb912-b06c-4c42-88e5-d9578f7ebfdf-StreamThread-3&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2020-03-04T20:25:41-08:00&amp;#93;&lt;/span&gt; (streams-soak-2-5-eos_soak_i-00d70680c58afa228_streamslog) TaskManager&lt;br/&gt;
        MetadataState:&lt;br/&gt;
                GlobalMetadata: []&lt;br/&gt;
                GlobalStores: []&lt;br/&gt;
                My HostInfo: HostInfo{host=&apos;unknown&apos;, port=-1}&lt;br/&gt;
                Cluster(id = null, nodes = [], partitions = [], controller = null)&lt;br/&gt;
        Active tasks:&lt;br/&gt;
                Running:&lt;br/&gt;
                Running Partitions:&lt;br/&gt;
                New:&lt;br/&gt;
                Restoring:&lt;br/&gt;
                Restoring Partitions:&lt;br/&gt;
                Restored Partitions:&lt;br/&gt;
                Suspended:&lt;br/&gt;
        Standby tasks:&lt;br/&gt;
                Running:&lt;br/&gt;
                Running Partitions:&lt;br/&gt;
                New:&lt;br/&gt;
 encountered an error processing soak test (org.apache.kafka.streams.StreamsSoakTest)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2020-03-04T20:25:41-08:00&amp;#93;&lt;/span&gt; (streams-soak-2-5-eos_soak_i-00d70680c58afa228_streamslog) org.apache.kafka.streams.errors.StreamsException: stream-thread &lt;span class=&quot;error&quot;&gt;&amp;#91;stream-soak-test-689bb912-b06c-4c42-88e5-d9578f7ebfdf-StreamThread-3&amp;#93;&lt;/span&gt; Failed to rebalance.&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.pollRequests(StreamThread.java:862)&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:749)&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:697)&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:670)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2020-03-04T20:25:41-08:00&amp;#93;&lt;/span&gt; (streams-soak-2-5-eos_soak_i-00d70680c58afa228_streamslog) Caused by: org.apache.kafka.common.KafkaException: Unexpected error in InitProducerIdResponse; The server experienced an unexpected error when processing the request.&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.TransactionManager$InitProducerIdHandler.handleResponse(TransactionManager.java:1352)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.TransactionManager$TxnRequestHandler.onComplete(TransactionManager.java:1260)&lt;br/&gt;
        at org.apache.kafka.clients.ClientResponse.onComplete(ClientResponse.java:109)&lt;br/&gt;
        at org.apache.kafka.clients.NetworkClient.completeResponses(NetworkClient.java:571)&lt;br/&gt;
        at org.apache.kafka.clients.NetworkClient.poll(NetworkClient.java:563)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.Sender.maybeSendAndPollTransactionalRequest(Sender.java:414)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.Sender.runOnce(Sender.java:312)&lt;br/&gt;
        at org.apache.kafka.clients.producer.internals.Sender.run(Sender.java:239)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:748)&lt;br/&gt;
&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Producer log:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2020-03-04T20:25:41-08:00&amp;#93;&lt;/span&gt; (streams-soak-2-5-eos_broker_i-0d1ef6c9a1a1708f6_server-log) &lt;span class=&quot;error&quot;&gt;&amp;#91;2020-03-05 04:25:40,885&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Transaction State Manager 1001&amp;#93;&lt;/span&gt;: TransactionalId stream-soak-test-1_0 append transaction log for TxnTransitMetadata(producerId=0, producerEpoch=576, txnTimeoutMs=60000, txnState=Ongoing, topicPartitions=Set(stream-soak-test-KSTREAM-AGGREGATE-STATE-STORE-0000000013-changelog-0, stream-soak-test-logData10MinuteFinalCount-store-changelog-0, stream-soak-test-logData10MinuteSuppressedCount-store-changelog-0, stream-soak-test-KSTREAM-AGGREGATE-STATE-STORE-0000000019-changelog-0, stream-soak-test-windowed-node-counts-STATE-STORE-0000000030-changelog-0, stream-soak-test-KSTREAM-AGGREGATE-STATE-STORE-0000000025-changelog-0, stream-soak-test-KSTREAM-AGGREGATE-STATE-STORE-0000000007-changelog-0, windowed-node-counts-0), txnStartTimestamp=1583382340885, txnLastUpdateTimestamp=1583382340885) transition failed due to COORDINATOR_NOT_AVAILABLE, resetting pending state from Some(Ongoing), aborting state transition and returning COORDINATOR_NOT_AVAILABLE in the callback (kafka.coordinator.transaction.TransactionStateManager)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2020-03-04T20:25:41-08:00&amp;#93;&lt;/span&gt; (streams-soak-2-5-eos_broker_i-0d1ef6c9a1a1708f6_stdout) java.lang.IllegalStateException: Cannot fence producer with epoch equal to Short.MaxValue since this would overflow&lt;br/&gt;
        at kafka.coordinator.transaction.TransactionMetadata.prepareFenceProducerEpoch(TransactionMetadata.scala:194)&lt;br/&gt;
        at kafka.coordinator.transaction.TransactionCoordinator.kafka$coordinator$transaction$TransactionCoordinator$$prepareInitProduceIdTransit(TransactionCoordinator.scala:216)&lt;br/&gt;
        at kafka.coordinator.transaction.TransactionCoordinator$$anonfun$2$$anonfun$apply$1.apply(TransactionCoordinator.scala:143)&lt;br/&gt;
        at kafka.coordinator.transaction.TransactionCoordinator$$anonfun$2$$anonfun$apply$1.apply(TransactionCoordinator.scala:143)&lt;br/&gt;
        at kafka.utils.CoreUtils$.inLock(CoreUtils.scala:251)&lt;br/&gt;
        at kafka.coordinator.transaction.TransactionMetadata.inLock(TransactionMetadata.scala:172)&lt;br/&gt;
        at kafka.coordinator.transaction.TransactionCoordinator$$anonfun$2.apply(TransactionCoordinator.scala:142)&lt;br/&gt;
        at kafka.coordinator.transaction.TransactionCoordinator$$anonfun$2.apply(TransactionCoordinator.scala:138)&lt;br/&gt;
        at scala.util.Either$RightProjection.flatMap(Either.scala:522)&lt;br/&gt;
        at kafka.coordinator.transaction.TransactionCoordinator.handleInitProducerId(TransactionCoordinator.scala:137)&lt;br/&gt;
        at kafka.server.KafkaApis.handleInitProducerIdRequest(KafkaApis.scala:1638)&lt;br/&gt;
        at kafka.server.KafkaApis.handle(KafkaApis.scala:135)&lt;br/&gt;
        at kafka.server.KafkaRequestHandler.run(KafkaRequestHandler.scala:69)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:748)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13289867">KAFKA-9666</key>
            <summary>Transactional producer Epoch could not be reset</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bob-barrett">Bob Barrett</assignee>
                                    <reporter username="bchen225242">Boyang Chen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Mar 2020 16:59:02 +0000</created>
                <updated>Wed, 15 Jul 2020 21:24:02 +0000</updated>
                            <resolved>Wed, 15 Jul 2020 21:24:02 +0000</resolved>
                                                    <fixVersion>2.6.1</fixVersion>
                    <fixVersion>2.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17052342" author="hachikuji" created="Thu, 5 Mar 2020 17:07:58 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mumrah&quot; class=&quot;user-hover&quot; rel=&quot;mumrah&quot;&gt;mumrah&lt;/a&gt; We may need this for 2.5. I am not sure if this is a regression, but KIP-360 makes this case much more likely.&lt;/p&gt;</comment>
                            <comment id="17053595" author="githubbot" created="Fri, 6 Mar 2020 16:55:20 +0000"  >&lt;p&gt;bob-barrett commented on pull request #8239: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9666&quot; title=&quot;Transactional producer Epoch could not be reset&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9666&quot;&gt;&lt;del&gt;KAFKA-9666&lt;/del&gt;&lt;/a&gt;: Rotate producer ID when fencing producer with exhausted e&#8230;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8239&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8239&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   &#8230;poch&lt;/p&gt;

&lt;p&gt;   When fencing producers, we currently blindly bump the epoch by 1 and write an abort marker to the transaction log. If the log is unavailable (for example, because the number of in-sync replicas is less than min.in.sync.replicas), we will roll back the attempted write of the abort marker, but still increment the epoch in the transaction metadata cache. During periods of prolonged log unavailability, producer retires of InitProducerId calls can cause the epoch to be increased to the point of exhaustion, at which point further InitProducerId calls fail because the producer can no longer be fenced. This patch changes the fencing behavior to rotate the producer ID if the epoch is exhausted, preventing this situation.&lt;/p&gt;

&lt;p&gt;   *More detailed description of your change,&lt;br/&gt;
   if necessary. The PR title and PR message become&lt;br/&gt;
   the squashed commit message, so use a separate&lt;br/&gt;
   comment to ping reviewers.*&lt;/p&gt;

&lt;p&gt;   *Summary of testing strategy (including rationale)&lt;br/&gt;
   for the feature or bug fix. Unit and/or integration&lt;br/&gt;
   tests are expected for any behaviour change and&lt;br/&gt;
   system tests should be considered for larger changes.*&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17053596" author="hachikuji" created="Fri, 6 Mar 2020 16:56:33 +0000"  >&lt;p&gt;This seems not to be a regression. This was encountered on an older version of the broker (2.0 to be specific). I&apos;ve changed priority from &quot;blocker&quot; to &quot;critical.&quot;&lt;/p&gt;</comment>
                            <comment id="17144269" author="rhauch" created="Wed, 24 Jun 2020 20:03:32 +0000"  >&lt;p&gt;Since this is not a blocker issue, as part of the 2.6.0 release process I&apos;m changing the fix version to `2.7.0`. If this is incorrect, please respond and discuss on the &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;DISCUSS&amp;#93;&lt;/span&gt; Apache Kafka 2.6.0 release&quot; discussion mailing list thread.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0c7pk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>