<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:39:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1081] kafka-run-class.sh is broken</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1081</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Please apply this patch, this is why log4j exists. Rerunning at non-deterministic command twice to catch error message is extremely dangerous.&lt;/p&gt;

&lt;p&gt;diff --git a/bin/kafka-run-class.sh b/bin/kafka-run-class.sh&lt;br/&gt;
index eb6ff1b..2f2d8b5 100755&lt;br/&gt;
&amp;#8212; a/bin/kafka-run-class.sh&lt;br/&gt;
+++ b/bin/kafka-run-class.sh&lt;br/&gt;
@@ -102,19 +102,3 @@ if [ &quot;$1&quot; = &quot;daemon&quot; ] &amp;amp;&amp;amp; [ -z &quot;$KAFKA_GC_LOG_OPTS&quot;] ; then&lt;br/&gt;
 fi&lt;/p&gt;

&lt;p&gt; $JAVA $KAFKA_HEAP_OPTS $KAFKA_JVM_PERFORMANCE_OPTS $KAFKA_GC_LOG_OPTS $KAFKA_JMX_OPTS $KAFKA_LOG4J_OPTS -cp $CLASSPATH $KAFKA_OPTS &quot;$@&quot;&lt;br/&gt;
-&lt;br/&gt;
-exitval=$?&lt;br/&gt;
-&lt;br/&gt;
-if [ $exitval -eq &quot;1&quot; ] ; then&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;$JAVA $KAFKA_HEAP_OPTS $KAFKA_JVM_PERFORMANCE_OPTS $KAFKA_GC_LOG_OPTS $KAFKA_JMX_OPTS $KAFKA_LOG4J_OPTS -cp $CLASSPATH $KAFKA_OPTS &quot;$@&quot; &amp;gt;&amp;amp; exception.txt&lt;/li&gt;
	&lt;li&gt;exception=`cat exception.txt`&lt;/li&gt;
	&lt;li&gt;noBuildMessage=&apos;Please build the project using sbt. Documentation is available at &lt;a href=&quot;http://kafka.apache.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://kafka.apache.org/&lt;/a&gt;&apos;&lt;/li&gt;
	&lt;li&gt;pattern=&quot;(Could not find or load main class)|(java\.lang\.NoClassDefFoundError)&quot;&lt;/li&gt;
	&lt;li&gt;match=`echo $exception | grep -E &quot;$pattern&quot;`&lt;/li&gt;
	&lt;li&gt;if [[ -n &quot;$match&quot; ]]; then&lt;/li&gt;
	&lt;li&gt;echo $noBuildMessage&lt;/li&gt;
	&lt;li&gt;fi&lt;/li&gt;
	&lt;li&gt;rm exception.txt&lt;br/&gt;
-fi&lt;br/&gt;
-&lt;br/&gt;
-&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12673281">KAFKA-1081</key>
            <summary>kafka-run-class.sh is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="fsaintjacques">Francois Saint-Jacques</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Oct 2013 18:11:46 +0000</created>
                <updated>Tue, 15 Oct 2013 21:08:23 +0000</updated>
                            <resolved>Tue, 15 Oct 2013 21:08:23 +0000</resolved>
                                    <version>0.8.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13791816" author="charmalloc" created="Thu, 10 Oct 2013 18:28:52 +0000"  >&lt;p&gt;please can you put together reproducible steps for the issue, thanks!&lt;/p&gt;</comment>
                            <comment id="13791819" author="fsaintjacques" created="Thu, 10 Oct 2013 18:35:56 +0000"  >&lt;p&gt;Look for the 3 last lines, not the usage error.&lt;/p&gt;

&lt;p&gt;$ cd /&lt;br/&gt;
$ /opt/kafka/bin/kafka-list-topic.sh&lt;br/&gt;
Missing required argument &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper&amp;#93;&lt;/span&gt;&quot;&lt;br/&gt;
Option                                  Description&lt;br/&gt;
------                                  -----------&lt;br/&gt;
--topic &amp;lt;topic&amp;gt;                         REQUIRED: The topic to be listed.&lt;br/&gt;
                                          Defaults to all existing topics.&lt;br/&gt;
                                          (default: )&lt;br/&gt;
--unavailable-partitions                if set, only show partitions whose&lt;br/&gt;
                                          leader is not available&lt;br/&gt;
--under-replicated-partitions           if set, only show under replicated&lt;br/&gt;
                                          partitions&lt;br/&gt;
--zookeeper &amp;lt;urls&amp;gt;                      REQUIRED: The connection string for&lt;br/&gt;
                                          the zookeeper connection in the form&lt;br/&gt;
                                          host:port. Multiple URLS can be&lt;br/&gt;
                                          given to allow fail-over.&lt;br/&gt;
/opt/kafka/bin/kafka-run-class.sh: line 72: exception.txt: Permission denied&lt;br/&gt;
cat: exception.txt: No such file or directory&lt;br/&gt;
rm: cannot remove &apos;exception.txt&apos;: No such file or directory&lt;/p&gt;</comment>
                            <comment id="13791838" author="charmalloc" created="Thu, 10 Oct 2013 18:47:05 +0000"  >&lt;p&gt;I don&apos;t see removing that function as a solution, we could re work it so that it communicates the error that you need to build the project.&lt;/p&gt;

&lt;p&gt;i don&apos;t have permission issue writing exception.txt but could see another way of fixing the function to not use a file and keep it all in vars if you wanted to rework your patch or chmod a+rw in your folder maybe not sure how you are running things but you should build first (see README)&lt;/p&gt;

&lt;p&gt;Joes-MacBook-Air:kafka joestein$ bin/kafka-list-topic.sh &lt;br/&gt;
Missing required argument &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper&amp;#93;&lt;/span&gt;&quot;&lt;br/&gt;
Option                                  Description                            &lt;br/&gt;
------                                  -----------                            &lt;br/&gt;
--topic &amp;lt;topic&amp;gt;                         REQUIRED: The topic to be listed.      &lt;br/&gt;
                                          Defaults to all existing topics.     &lt;br/&gt;
                                          (default: )                          &lt;br/&gt;
--unavailable-partitions                if set, only show partitions whose     &lt;br/&gt;
                                          leader is not available              &lt;br/&gt;
--under-replicated-partitions           if set, only show under replicated     &lt;br/&gt;
                                          partitions                           &lt;br/&gt;
--zookeeper &amp;lt;urls&amp;gt;                      REQUIRED: The connection string for    &lt;br/&gt;
                                          the zookeeper connection in the form &lt;br/&gt;
                                          host:port. Multiple URLS can be      &lt;br/&gt;
                                          given to allow fail-over.            &lt;br/&gt;
Joes-MacBook-Air:kafka joestein$ &lt;/p&gt;</comment>
                            <comment id="13791870" author="fsaintjacques" created="Thu, 10 Oct 2013 19:14:39 +0000"  >&lt;p&gt;Look, this is an ugly hack. The real problem here is not the directory permission or using a temp file but RERUNNING the first java command. &lt;/p&gt;

&lt;p&gt;I&apos;m not even trying to build it, I&apos;m trying to correctly package kafka on a production server. Whenever I run any command (bin/*) that doesn&apos;t return properly, it borks if kafka-run-class.sh is called within a directory where the user don&apos;t have write permission.&lt;/p&gt;

&lt;p&gt;I understand that these lines are there to help new users who checkout the project and forget to build before running any command, but we&apos;re talking of deploying quality code in production.&lt;/p&gt;</comment>
                            <comment id="13791890" author="charmalloc" created="Thu, 10 Oct 2013 19:28:32 +0000"  >&lt;p&gt;We have binary release &lt;a href=&quot;http://kafka.apache.org/downloads.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://kafka.apache.org/downloads.html&lt;/a&gt; since 0.8.0-beta1 and moving forward, you could use that since it is already packaged.  I would go so far as to even bootstrap the sbt launcher but that is a lot more changes than just a consistent error when not compiling source before run.&lt;/p&gt;</comment>
                            <comment id="13791901" author="fsaintjacques" created="Thu, 10 Oct 2013 19:32:18 +0000"  >&lt;p&gt;I know you guys have a binary release, this is what I&apos;m deploying. My point is, this specific snippet should never go in production release.&lt;/p&gt;</comment>
                            <comment id="13792936" author="jkreps" created="Fri, 11 Oct 2013 18:48:19 +0000"  >&lt;p&gt;Yeah I agree, rerunning the command to get the error is really weird. Given that we have a binary release do we need to retain this behavior? I.e. if you download the source release and try to run without building then it won&apos;t work but this shouldn&apos;t be as confusing as it was when we only had a source release and didn&apos;t really label the download as such.&lt;/p&gt;</comment>
                            <comment id="13793009" author="fanatoly" created="Fri, 11 Oct 2013 20:17:23 +0000"  >&lt;p&gt;There is another reason why removing this behavior would be beneficial.&lt;/p&gt;

&lt;p&gt;Currently, the run-class script spawns a subprocess. This makes running it under supervisor more difficult than it needs to be. This likely applies to other process monitoring systems. I maintain an internal patch on top of kafka that prepends the java invocation in run-class with exec and removes the error reporting. In production, the error is not very useful.&lt;/p&gt;</comment>
                            <comment id="13793097" author="jkreps" created="Fri, 11 Oct 2013 22:29:15 +0000"  >&lt;p&gt;Here is a proposed patch that uses exec for all the main commands and removes the re-execution for errors.&lt;/p&gt;</comment>
                            <comment id="13793236" author="charmalloc" created="Sat, 12 Oct 2013 03:50:43 +0000"  >&lt;p&gt;+1 on &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-1081&quot; title=&quot;kafka-run-class.sh is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-1081&quot;&gt;&lt;del&gt;KAFKA-1081&lt;/del&gt;&lt;/a&gt;-v1.patch&lt;/p&gt;</comment>
                            <comment id="13793789" author="junrao" created="Sun, 13 Oct 2013 21:27:50 +0000"  >&lt;p&gt;Thanks for the patch. +1. Could you patch for trunk as well?&lt;/p&gt;</comment>
                            <comment id="13795637" author="jkreps" created="Tue, 15 Oct 2013 21:08:23 +0000"  >&lt;p&gt;Checked in on both 0.8 and trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12608092" name="KAFKA-1081-v1.patch" size="9576" author="jkreps" created="Fri, 11 Oct 2013 22:29:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352904</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1oudr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353191</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>