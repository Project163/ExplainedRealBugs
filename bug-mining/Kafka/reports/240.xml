<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:37:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-820] Topic metadata request handling fails to return all metadata about replicas</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-820</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The admin utility that fetches topic metadata needs improvement in error handling. While fetching replica and isr broker information, if one of the replicas is offline, it fails to fetch the replica and isr info for the rest of them. This creates confusion on the client since it seems to the client the rest of the brokers are offline as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12637866">KAFKA-820</key>
            <summary>Topic metadata request handling fails to return all metadata about replicas</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nehanarkhede">Neha Narkhede</assignee>
                                    <reporter username="nehanarkhede">Neha Narkhede</reporter>
                        <labels>
                            <label>kafka-0.8</label>
                    </labels>
                <created>Wed, 20 Mar 2013 00:32:59 +0000</created>
                <updated>Fri, 22 Mar 2013 16:13:14 +0000</updated>
                            <resolved>Fri, 22 Mar 2013 16:13:11 +0000</resolved>
                                    <version>0.8.0</version>
                                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13607134" author="nehanarkhede" created="Wed, 20 Mar 2013 01:03:28 +0000"  >&lt;p&gt;Two changes -&lt;/p&gt;

&lt;p&gt;1. Modified topic metadata request handling to return the broker metadata for the rest of the brokers, even if one of them is offline. Also, modified it to throw an exception if even one of the brokers is offline so that error code will get returned to the client&lt;br/&gt;
2. ReplicaNotAvailableException is irrelevant to the producer. It should not log the stack trace for it inside BrokerPartitionInfo.updateInfo(). This should only happen for UnknownTopicOrPartitionException and LeaderNotAvailableException&lt;/p&gt;</comment>
                            <comment id="13607829" author="junrao" created="Wed, 20 Mar 2013 16:39:13 +0000"  >&lt;p&gt;Thanks for the patch. Not sure that I understand the changes in AdminUtils.getBrokerInfoFromCache(). It seems to me that with or w/o the patch, the method will throw an exception if at least one of the items in brokerIds can&apos;t be converted to a Broker object, in which case the return value is irrelevant.&lt;/p&gt;</comment>
                            <comment id="13607868" author="nehanarkhede" created="Wed, 20 Mar 2013 17:10:30 +0000"  >&lt;p&gt;The return value is not irrelevant. As I explained, even if one broker is down, it aborts sending the broker data for the rest of the brokers. The impression it gives the client is that all the brokers are dead. The reason it throws the exception at the end is because we need to send the appropriate error code to the client if at least one broker is down.&lt;/p&gt;</comment>
                            <comment id="13607877" author="junrao" created="Wed, 20 Mar 2013 17:21:34 +0000"  >&lt;p&gt;When an exception is thrown in getBrokerInfoFromCache(), no value is returned, right?&lt;/p&gt;</comment>
                            <comment id="13607937" author="nehanarkhede" created="Wed, 20 Mar 2013 18:10:42 +0000"  >&lt;p&gt;You are right, attached v2 patch to fix the issue&lt;/p&gt;</comment>
                            <comment id="13609033" author="nehanarkhede" created="Thu, 21 Mar 2013 15:30:46 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Fixed a bug in BrokerPartitionInfo while printing error code. In v2, I was printing the topic&apos;s error code instead of the partition&apos;s error code&lt;/li&gt;
	&lt;li&gt;As pointed out by Jun offline, dropWhile does not work the way I thought it did. Replaced that with filterNot.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13609124" author="junrao" created="Thu, 21 Mar 2013 17:05:27 +0000"  >&lt;p&gt;Thanks for patch v3. A few minor comments. Once addressed, the patch can be checked in.&lt;/p&gt;

&lt;p&gt;30. AdminUtil.getBrokerInfoFromCache(): The following line uses double negation&lt;br/&gt;
    brokerMetadata.filterNot(!&lt;em&gt;.isDefined).map(&lt;/em&gt;.get)&lt;br/&gt;
It will be easier to read if we do&lt;br/&gt;
    brokerMetadata.filter(&lt;em&gt;.isDefined).map(&lt;/em&gt;.get)&lt;/p&gt;

&lt;p&gt;31. AdminUtil.fetchTopicMetadataFromZk():&lt;br/&gt;
31.1 In the following statement, should the catch clause be moved to after the first two statements inside try? Otherwise, we will unnecessarily wrap a ReplicaNotAvailableException over another ReplicaNotAvailableException.&lt;br/&gt;
          try &lt;/p&gt;
{
            replicaInfo = getBrokerInfoFromCache(zkClient, cachedBrokerInfo, replicas.map(id =&amp;gt; id.toInt))
            isrInfo = getBrokerInfoFromCache(zkClient, cachedBrokerInfo, inSyncReplicas)
            if(replicaInfo.size &amp;lt; replicas.size)
              throw new ReplicaNotAvailableException(&quot;Replica information not available for following brokers: &quot; +
                replicas.filterNot(replicaInfo.map(_.id).contains(_)).mkString(&quot;,&quot;))
            if(isrInfo.size &amp;lt; inSyncReplicas.size)
              throw new ReplicaNotAvailableException(&quot;In Sync Replica information not available for following brokers: &quot; +
                inSyncReplicas.filterNot(isrInfo.map(_.id).contains(_)).mkString(&quot;,&quot;))
          }
&lt;p&gt; catch &lt;/p&gt;
{
            case e =&amp;gt; throw new ReplicaNotAvailableException(e)
          }
&lt;p&gt;31.2 Similarly, in the following try/catch clause, should we move the try/catch clause inside case Some(l)? Otherwise, we will be wrapping a LeaderNotAvailableException over another LeaderNotAvailableException.&lt;br/&gt;
          try {&lt;br/&gt;
            leaderInfo = leader match &lt;/p&gt;
{
              case Some(l) =&amp;gt; Some(getBrokerInfoFromCache(zkClient, cachedBrokerInfo, List(l)).head)
              case None =&amp;gt; throw new LeaderNotAvailableException(&quot;No leader exists for partition &quot; + partition)
            }
&lt;p&gt;          } catch &lt;/p&gt;
{
            case e =&amp;gt; throw new LeaderNotAvailableException(&quot;Leader not available for topic %s partition %d&quot;.format(topic, partition), e)
          }
</comment>
                            <comment id="13610489" author="nehanarkhede" created="Fri, 22 Mar 2013 16:13:11 +0000"  >&lt;p&gt;Checked in after suggested fixes&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12574467" name="kafka-820-v1.patch" size="4465" author="nehanarkhede" created="Wed, 20 Mar 2013 01:03:28 +0000"/>
                            <attachment id="12574588" name="kafka-820-v2.patch" size="5179" author="nehanarkhede" created="Wed, 20 Mar 2013 18:10:42 +0000"/>
                            <attachment id="12574812" name="kafka-820-v3.patch" size="5179" author="nehanarkhede" created="Thu, 21 Mar 2013 15:30:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>318346</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 35 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ixhr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>318687</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>