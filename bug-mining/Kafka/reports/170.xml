<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:36:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-681] Unclean shutdown testing - truncateAndStartWithNewOffset is not invoked when it is expected to</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-681</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description></description>
                <environment></environment>
        <key id="12625896">KAFKA-681</key>
            <summary>Unclean shutdown testing - truncateAndStartWithNewOffset is not invoked when it is expected to</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="junrao">Jun Rao</assignee>
                                    <reporter username="jfung">John Fung</reporter>
                        <labels>
                            <label>bugs</label>
                    </labels>
                <created>Thu, 3 Jan 2013 19:31:44 +0000</created>
                <updated>Fri, 4 Jan 2013 17:19:59 +0000</updated>
                            <resolved>Fri, 4 Jan 2013 17:19:39 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13543222" author="jfung" created="Thu, 3 Jan 2013 19:41:12 +0000"  >&lt;p&gt;Test description (compression off):&lt;br/&gt;
1. Start 2 brokers B1 &amp;amp; B2&lt;br/&gt;
2. Send 5 messages and sleep 5 sec&lt;br/&gt;
3. Stop B2 and sleep 5 sec&lt;br/&gt;
4. Send 20 messages and sleep 10 sec&lt;br/&gt;
5. Stop B1 and sleep 5 sec&lt;br/&gt;
6. Start B2 and sleep 5 sec&lt;br/&gt;
7. Send 5 messages and sleep 5 sec&lt;br/&gt;
8. Start B1 and sleep 5 sec&lt;br/&gt;
9. Check B1&apos;s log4j messages for &quot;Truncate and start log&quot; which is invoked from &quot;truncateAndStartWithNewOffset&quot; inside Log.scala&lt;/p&gt;</comment>
                            <comment id="13543224" author="jfung" created="Thu, 3 Jan 2013 19:43:29 +0000"  >&lt;p&gt;Uploaded kafka-681-reproduce-issue.patch&lt;/p&gt;</comment>
                            <comment id="13543228" author="jfung" created="Thu, 3 Jan 2013 19:47:22 +0000"  >&lt;p&gt;To reproduce the issue:&lt;br/&gt;
1. Download the latest 0.8 branch and apply kafka-681-reproduce-issue.patch&lt;br/&gt;
2. In &amp;lt;kafka_home&amp;gt;/system_test, execute this command: python -u -B system_test_runner.py 2&amp;gt;&amp;amp;1 | tee system_test_output_`date +%s`.log&lt;br/&gt;
3. The test suite will execute testcase_9071&lt;br/&gt;
4. When the test is completed, check the file &amp;lt;kafka_home&amp;gt;/system_test/unclean_shutdown_testsuite/testcase_9071/logs/broker-1/kafka_server_9091.log for the message &quot;Truncate and start log&quot;&lt;/p&gt;</comment>
                            <comment id="13543529" author="junrao" created="Fri, 4 Jan 2013 02:14:58 +0000"  >&lt;p&gt;This is actually caused by a real bug. When reading high watermarks from the file, we can incorrectly recover the topic name. Attach a fix.&lt;/p&gt;</comment>
                            <comment id="13543601" author="jjkoshy" created="Fri, 4 Jan 2013 05:08:43 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13543666" author="nehanarkhede" created="Fri, 4 Jan 2013 07:18:49 +0000"  >&lt;p&gt;+1 &lt;/p&gt;</comment>
                            <comment id="13543997" author="jfung" created="Fri, 4 Jan 2013 16:32:38 +0000"  >&lt;p&gt;Thanks Jun for the patch.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The patch is applied with the latest 0.8 branch and tested under the same conditions and the followings are the output:&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Searching for the message and the timestamp is after broker 1 is re-started&lt;br/&gt;
        kafka/system_test/unclean_shutdown_testsuite/testcase_9071/logs $ grep -rs -i &quot;truncate and start&quot; *&lt;br/&gt;
        broker-1/kafka_server_9091.log:&lt;span class=&quot;error&quot;&gt;&amp;#91;2013-01-04 08:25:24,416&amp;#93;&lt;/span&gt; INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;Kafka Log on Broker 1&amp;#93;&lt;/span&gt;, Truncate and start log &apos;t001-0&apos; to 0 (kafka.log.Log)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;The patch seems to be working as expected.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13544039" author="junrao" created="Fri, 4 Jan 2013 17:19:39 +0000"  >&lt;p&gt;Thanks for the review. Committed to 0.8 with minor cleanup.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12563138" name="kafka-681-reproduce-issue.patch" size="53076" author="jfung" created="Thu, 3 Jan 2013 19:43:29 +0000"/>
                            <attachment id="12563214" name="kafka-681_v1.patch" size="1815" author="junrao" created="Fri, 4 Jan 2013 02:14:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>302477</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 46 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i173fr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249524</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>