<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:19:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5998] /.checkpoint.tmp Not found exception</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5998</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I have one kafka broker and one kafka stream running... I am running its since two days under load of around 2500 msgs per second.. On third day am getting below exception for some of the partitions, I have 16 partitions only 0_0 and 0_1 gives this error&lt;/p&gt;

&lt;p&gt;{{09:43:25.955 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-6&amp;#93;&lt;/span&gt; WARN  o.a.k.s.p.i.ProcessorStateManager - Failed to write checkpoint file to /data/kstreams/rtp-kafkastreams/0_1/.checkpoint:&lt;br/&gt;
java.io.FileNotFoundException: /data/kstreams/rtp-kafkastreams/0_1/.checkpoint.tmp (No such file or directory)&lt;br/&gt;
        at java.io.FileOutputStream.open(Native Method) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:221) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:171) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:73) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:324) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask$1.run(StreamTask.java:267) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamsMetricsImpl.measureLatencyNs(StreamsMetricsImpl.java:201) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:260) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:254) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.AssignedTasks$1.apply(AssignedTasks.java:322) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.AssignedTasks.applyToRunningTasks(AssignedTasks.java:415) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.AssignedTasks.commit(AssignedTasks.java:314) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.commitAll(StreamThread.java:700) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.maybeCommit(StreamThread.java:683) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:523) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:480) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:457) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
09:43:25.974 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-15&amp;#93;&lt;/span&gt; WARN  o.a.k.s.p.i.ProcessorStateManager - Failed to write checkpoint file to /data/kstreams/rtp-kafkastreams/0_0/.checkpoint:&lt;br/&gt;
java.io.FileNotFoundException: /data/kstreams/rtp-kafkastreams/0_0/.checkpoint.tmp (No such file or directory)&lt;br/&gt;
        at java.io.FileOutputStream.open(Native Method) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:221) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:171) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:73) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:324) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask$1.run(StreamTask.java:267) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamsMetricsImpl.measureLatencyNs(StreamsMetricsImpl.java:201) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:260) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:254) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.AssignedTasks$1.apply(AssignedTasks.java:322) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.AssignedTasks.applyToRunningTasks(AssignedTasks.java:415) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.AssignedTasks.commit(AssignedTasks.java:314) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.commitAll(StreamThread.java:700) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.maybeCommit(StreamThread.java:683) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:523) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:480) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:457) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
}}&lt;/p&gt;</description>
                <environment></environment>
        <key id="13106225">KAFKA-5998</key>
            <summary>/.checkpoint.tmp Not found exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vvcephei">John Roesler</assignee>
                                    <reporter username="yogeshbelur">Yogesh BG</reporter>
                        <labels>
                    </labels>
                <created>Sat, 30 Sep 2017 09:44:29 +0000</created>
                <updated>Tue, 6 Oct 2020 17:55:31 +0000</updated>
                            <resolved>Fri, 12 Jul 2019 13:44:31 +0000</resolved>
                                    <version>0.11.0.0</version>
                    <version>0.11.0.1</version>
                    <version>2.1.1</version>
                                    <fixVersion>2.2.2</fixVersion>
                    <fixVersion>2.3.1</fixVersion>
                    <fixVersion>2.4.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>26</votes>
                                    <watches>55</watches>
                                                                                                                <comments>
                            <comment id="16187220" author="yuzhihong@gmail.com" created="Sat, 30 Sep 2017 22:18:36 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                Files.move(source, target, StandardCopyOption.REPLACE_EXISTING);
                log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Non-atomic move of {} to {} succeeded after atomic move failed due to {}&quot;&lt;/span&gt;, source, target,
                        &lt;span class=&quot;code-keyword&quot;&gt;outer&lt;/span&gt;.getMessage());
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException &lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt;) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If there was IOE from the move call, the source might be left around.&lt;/p&gt;

&lt;p&gt;Patch v1 is one way to not leave source behind. Another option is to delete the source.&lt;/p&gt;</comment>
                            <comment id="16187299" author="yogeshbelur" created="Sun, 1 Oct 2017 06:53:00 +0000"  >&lt;p&gt;17:48:31.389 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-5&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Marking the coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) dead for group rtp-kafkastreams&lt;br/&gt;
17:48:31.389 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-6&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Marking the coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) dead for group rtp-kafkastreams&lt;br/&gt;
17:48:31.391 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-8&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.391 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-1&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.392 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-15&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.392 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-8&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Marking the coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) dead for group rtp-kafkastreams&lt;br/&gt;
17:48:31.392 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-1&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Marking the coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) dead for group rtp-kafkastreams&lt;br/&gt;
17:48:31.393 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-15&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Marking the coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) dead for group rtp-kafkastreams&lt;br/&gt;
17:48:31.484 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-16&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.485 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-16&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Marking the coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) dead for group rtp-kafkastreams&lt;br/&gt;
17:48:31.485 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-11&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.485 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-2&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.485 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-10&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.486 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-2&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Marking the coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) dead for group rtp-kafkastreams&lt;br/&gt;
17:48:31.486 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-11&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Marking the coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) dead for group rtp-kafkastreams&lt;br/&gt;
17:48:31.486 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-10&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Marking the coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) dead for group rtp-kafkastreams&lt;br/&gt;
17:48:31.489 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-7&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.489 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-3&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.585 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-16&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.586 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-2&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.586 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-11&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.587 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-10&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.591 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-7&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.591 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-6&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.591 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-3&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.592 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-5&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.594 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-15&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.595 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-1&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:31.595 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-8&amp;#93;&lt;/span&gt; INFO  o.a.k.c.c.i.AbstractCoordinator - Discovered coordinator 172.30.0.9:9092 (id: 2147482646 rack: null) for group rtp-kafkastreams.&lt;br/&gt;
17:48:32.018 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-5-thread-15&amp;#93;&lt;/span&gt; INFO  n.a.elasticsearch.util.ESMetricStore - executeBatch : size = 483&lt;br/&gt;
17:48:32.030 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-5-thread-8&amp;#93;&lt;/span&gt; INFO  n.a.elasticsearch.util.ESMetricStore - executeBatch : size = 672&lt;br/&gt;
17:48:32.030 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-5-thread-6&amp;#93;&lt;/span&gt; INFO  n.a.elasticsearch.util.ESMetricStore - executeBatch : size = 276&lt;br/&gt;
17:48:32.031 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-5-thread-13&amp;#93;&lt;/span&gt; INFO  n.a.elasticsearch.util.ESMetricStore - executeBatch : size = 458&lt;br/&gt;
17:48:32.031 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-5-thread-5&amp;#93;&lt;/span&gt; INFO  n.a.elasticsearch.util.ESMetricStore - executeBatch : size = 452&lt;br/&gt;
17:48:32.033 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-5-thread-11&amp;#93;&lt;/span&gt; INFO  n.a.elasticsearch.util.ESMetricStore - executeBatch : size = 447&lt;br/&gt;
17:48:32.039 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-5-thread-7&amp;#93;&lt;/span&gt; INFO  n.a.elasticsearch.util.ESMetricStore - executeBatch : size = 413&lt;br/&gt;
17:48:32.039 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-5-thread-7&amp;#93;&lt;/span&gt; INFO  n.a.elasticsearch.util.ESMetricStore - executeBatch : size = 413&lt;br/&gt;
17:48:32.042 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-5-thread-14&amp;#93;&lt;/span&gt; INFO  n.a.elasticsearch.util.ESMetricStore - executeBatch : size = 488&lt;br/&gt;
17:48:32.045 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-5-thread-4&amp;#93;&lt;/span&gt; INFO  n.a.elasticsearch.util.ESMetricStore - executeBatch : size = 579&lt;br/&gt;
17:48:32.060 &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-5-thread-10&amp;#93;&lt;/span&gt; INFO  n.a.elasticsearch.util.ESMetricStore - executeBatch : size = 573&lt;br/&gt;
17:48:32.102 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-3&amp;#93;&lt;/span&gt; WARN  o.a.k.s.p.i.ProcessorStateManager - Failed to write checkpoint file to /data/kstreams/rtp-kafkastreams/0_11/.checkpoint:&lt;br/&gt;
java.io.FileNotFoundException: /data/kstreams/rtp-kafkastreams/0_11/.checkpoint.tmp (No such file or directory)&lt;br/&gt;
        at java.io.FileOutputStream.open(Native Method) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:221) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:171) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:73) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:324) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask$1.run(StreamTask.java:267) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamsMetricsImpl.measureLatencyNs(StreamsMetricsImpl.java:201) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:260) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:254) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.AssignedTasks$1.apply(AssignedTasks.java:322) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.AssignedTasks.applyToRunningTasks(AssignedTasks.java:415) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.AssignedTasks.commit(AssignedTasks.java:314) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.commitAll(StreamThread.java:700) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.maybeCommit(StreamThread.java:683) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:523) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:480) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:457) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
17:48:32.107 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-16&amp;#93;&lt;/span&gt; WARN  o.a.k.s.p.i.ProcessorStateManager - Failed to write checkpoint file to /data/kstreams/rtp-kafkastreams/0_15/.checkpoint:&lt;br/&gt;
java.io.FileNotFoundException: /data/kstreams/rtp-kafkastreams/0_15/.checkpoint.tmp (No such file or directory)&lt;br/&gt;
        at java.io.FileOutputStream.open(Native Method) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:221) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:171) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:73) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
   at org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:324) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask$1.run(StreamTask.java:267) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamsMetricsImpl.measureLatencyNs(StreamsMetricsImpl.java:201) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:260) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:254) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.AssignedTasks$1.apply(AssignedTasks.java:322) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.AssignedTasks.applyToRunningTasks(AssignedTasks.java:415) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.AssignedTasks.commit(AssignedTasks.java:314) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.commitAll(StreamThread.java:700) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.maybeCommit(StreamThread.java:683) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:523) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:480) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:457) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
17:48:32.111 &lt;span class=&quot;error&quot;&gt;&amp;#91;ks_0_inst-StreamThread-11&amp;#93;&lt;/span&gt; WARN  o.a.k.s.p.i.ProcessorStateManager - Failed to write checkpoint file to /data/kstreams/rtp-kafkastreams/0_9/.checkpoint:&lt;br/&gt;
java.io.FileNotFoundException: /data/kstreams/rtp-kafkastreams/0_9/.checkpoint.tmp (No such file or directory)&lt;br/&gt;
        at java.io.FileOutputStream.open(Native Method) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:221) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:171) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;na:1.7.0_111&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:73) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:324) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask$1.run(StreamTask.java:267) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamsMetricsImpl.measureLatencyNs(StreamsMetricsImpl.java:201) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:260) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:254) &lt;span class=&quot;error&quot;&gt;&amp;#91;rtp-kafkastreams-1.0-SNAPSHOT-jar-with-dependencies.jar:na&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16187301" author="yogeshbelur" created="Sun, 1 Oct 2017 06:55:18 +0000"  >&lt;p&gt;Patch v1 is one way to not leave source behind. Another option is to delete the source.&lt;/p&gt;

&lt;p&gt;Do you have the patch can you share? I will update my setup... We can not delete the source manually... What is the impact of this issue? Its gonna drop some messages or it violates any consumer semantics like exactly once?&lt;/p&gt;
</comment>
                            <comment id="16187353" author="yuzhihong@gmail.com" created="Sun, 1 Oct 2017 12:25:58 +0000"  >&lt;p&gt;Patch v1 has been attached. &lt;br/&gt;
If the .tmp file cannot be renamed to checkpoint file, the checkpoint is not taken. The patch doesn&apos;t change that behavior. &lt;/p&gt;

&lt;p&gt;But the patch tries to avoid the error shown above&lt;/p&gt;</comment>
                            <comment id="16187431" author="yuzhihong@gmail.com" created="Sun, 1 Oct 2017 15:28:44 +0000"  >&lt;p&gt;Patch v2 enables the log when renaming to secondary fails.&lt;/p&gt;</comment>
                            <comment id="16344725" author="timvanlaer" created="Tue, 30 Jan 2018 09:19:05 +0000"  >&lt;p&gt;It looks like I ran into the same issue.&#160;It doesn&apos;t seem to impact processing however.&lt;/p&gt;

&lt;p&gt;I&apos;m running a Kafka Streams application with multiple state stores. On the same machine run 3 docker containers with the same application, they share the same disk on the host.&#160;&lt;/p&gt;

&lt;p&gt;The application uses version 1.0.0 of the Kafka Streams library.&#160;&lt;/p&gt;

&lt;p&gt;All three instances started emitting the error for the first time&#160;at 4:26 and kept producing it every 30 seconds&#160;until now. commit.interval.ms=30000, so that error interval makes sense.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[WARN] 2018-01-30 08:47:23,724 LogContext$KafkaLogger - task [2_19] Failed to write checkpoint file to /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka-streams-state/microservice-primaryproduction/2_19/.checkpoint:
java.io.FileNotFoundException: /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka-streams-state/microservice-primaryproduction/2_19/.checkpoint.tmp (No such file or directory)
at java.io.FileOutputStream.open0(Native Method) ~[?:1.8.0_151]
at java.io.FileOutputStream.open(FileOutputStream.java:270) ~[?:1.8.0_151]
at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:213) ~[?:1.8.0_151]
at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:162) ~[?:1.8.0_151]
at org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:73) ~[ms.jar:?]
at org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:320) [ms.jar:?]
at org.apache.kafka.streams.processor.internals.StreamTask$1.run(StreamTask.java:306) [ms.jar:?]
at org.apache.kafka.streams.processor.internals.StreamsMetricsImpl.measureLatencyNs(StreamsMetricsImpl.java:208) [ms.jar:?]
at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:299) [ms.jar:?]
at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:289) [ms.jar:?]
at org.apache.kafka.streams.processor.internals.AssignedTasks$2.apply(AssignedTasks.java:87) [ms.jar:?]
at org.apache.kafka.streams.processor.internals.AssignedTasks.applyToRunningTasks(AssignedTasks.java:451) [ms.jar:?]
at org.apache.kafka.streams.processor.internals.AssignedTasks.commit(AssignedTasks.java:380) [ms.jar:?]
at org.apache.kafka.streams.processor.internals.TaskManager.commitAll(TaskManager.java:309) [ms.jar:?]
at org.apache.kafka.streams.processor.internals.StreamThread.maybeCommit(StreamThread.java:1018) [ms.jar:?]
at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:835) [ms.jar:?]
at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:774) [ms.jar:?]
at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:744) [ms.jar:?]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Failing tasks:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;instance 1: 2_13, 2_14, 2_15, 2_16, 2_17, 2_18, 2_19, 2_20, 2_21, 2_22, 2_23&lt;/li&gt;
	&lt;li&gt;instance 2: 2_6, 2_7, 2_8, 2_9,&#160;, 2_10, 2_11, 2_12&lt;/li&gt;
	&lt;li&gt;instance 3: 1_0, 2_0,&#160;2_1,&#160;2_2,&#160;2_3,&#160;2_4,&#160;2_5&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The interesting thing is, these directories does indeed &lt;b&gt;NOT&lt;/b&gt; exist... Application is running&#160;under root user in container, changing permissions didn&apos;t impact the behaviour.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_0
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_1
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_10
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_11
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_12
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_13
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_14
drwxr-xr-x 3 root root 53 Jan 30 09:06 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_15
drwxr-xr-x 3 root root 53 Jan 30 09:06 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_16
drwxr-xr-x 3 root root 53 Jan 30 09:06 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_17
drwxr-xr-x 3 root root 53 Jan 30 09:06 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_18
drwxr-xr-x 3 root root 53 Jan 30 09:06 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_19
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_2
drwxr-xr-x 3 root root 53 Jan 30 09:06 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_20
drwxr-xr-x 3 root root 53 Jan 30 09:06 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_21
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_22
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_3
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_4
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_5
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_6
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_7
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_8
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/0_9
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/3_0
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/3_1
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/3_2
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/3_3
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/3_4
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/3_5
drwxr-xr-x 3 root root 53 Jan 30 09:07 /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/kafka_streams_state_disk/microservice-primaryproduction/3_6
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I restarted all three instances. The problem was gone without impact (no lag, no state store restoration...).  &lt;/p&gt;</comment>
                            <comment id="16447788" author="srinivenkat" created="Mon, 23 Apr 2018 08:59:10 +0000"  >&lt;p&gt;I ran into the same issue. Is there an impact to the processing of messages because of this?&lt;/p&gt;</comment>
                            <comment id="16450300" author="mjsax" created="Tue, 24 Apr 2018 17:58:39 +0000"  >&lt;p&gt;Actual processing should not be affected. Only in case of failure, restore might take longer as the checkpoint files encode what data is in the store &amp;#8211; without the checkpoint file, it&apos;s required to re-read the whole changelog topic to guaranteed correct restore.&lt;/p&gt;</comment>
                            <comment id="16528213" author="guozhang" created="Fri, 29 Jun 2018 20:46:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yogeshbelur&quot; class=&quot;user-hover&quot; rel=&quot;yogeshbelur&quot;&gt;yogeshbelur&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srinivenkat&quot; class=&quot;user-hover&quot; rel=&quot;srinivenkat&quot;&gt;srinivenkat&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=timvanlaer&quot; class=&quot;user-hover&quot; rel=&quot;timvanlaer&quot;&gt;timvanlaer&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aman1064&quot; class=&quot;user-hover&quot; rel=&quot;aman1064&quot;&gt;aman1064&lt;/a&gt; I&apos;m investigating this issue along with Ted&apos;s patch now. Could you share your experience if possible:&lt;/p&gt;

&lt;p&gt;1. What&apos;s your file system / OS settings? Are you working with Windows, for example?&lt;br/&gt;
2. What&apos;s your Kafka Streams version?&lt;br/&gt;
3. If you have tried out Ted&apos;s patch v1 (e.g. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yogeshbelur&quot; class=&quot;user-hover&quot; rel=&quot;yogeshbelur&quot;&gt;yogeshbelur&lt;/a&gt;), did it help fixing your issue already?&lt;/p&gt;</comment>
                            <comment id="16528284" author="guozhang" created="Fri, 29 Jun 2018 21:37:13 +0000"  >&lt;p&gt;Linking &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6767&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-6767&lt;/a&gt; to this issue as well since it seems reporting the same scenario.&lt;/p&gt;</comment>
                            <comment id="16528488" author="yuzhihong@gmail.com" created="Sat, 30 Jun 2018 02:00:38 +0000"  >&lt;p&gt;For v1 patch, probably you want to uncomment the following line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                  &lt;span class=&quot;code-comment&quot;&gt;//log.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to rename {} as {}&quot;&lt;/span&gt;, temp.toPath(), secondary);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so that we know whether the rename fails or not.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="16531377" author="moody" created="Tue, 3 Jul 2018 13:22:26 +0000"  >&lt;p&gt;We handle large amounts of traffic using streams API. Is there at least a workaround until the issue gets resolved?&lt;/p&gt;</comment>
                            <comment id="16561447" author="yogeshbelur" created="Mon, 30 Jul 2018 05:39:31 +0000"  >&lt;p&gt;Is there any update on this? I know its not a issue, but would like to suppress&#160; the logs as log file is getting filled with these message&lt;/p&gt;</comment>
                            <comment id="16562215" author="guozhang" created="Mon, 30 Jul 2018 17:45:03 +0000"  >&lt;p&gt;This is what I have discovered so far:&lt;/p&gt;

&lt;p&gt;Before 1.1.0, even a stateless task will try to write a checkpoint file into its directory; but the parent directory will not be created since during the initialization of the task we determined it is stateless. On different file-systems, the behavior of new FileOutputStream(File) is really &quot;un-defined&quot;: some fs would allow the constructor to auto-create the parent directory with this call, and some will not; and some will allow auto-creation &quot;sometimes&quot;. I think this is what&apos;s observed in this ticket.&lt;/p&gt;

&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6499&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-6499&lt;/a&gt; we have a related fix trying to avoid writing a checkpoint file anymore. BUT in &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6767&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-6767&lt;/a&gt; we still see people reporting similar issues on 1.1.0, I&apos;ve looked into the source code of 1.1 but cannot find obvious bugs that could result in checkpointable offsets to be non-empty, i.e. we will still try to write the checkpoint file. For now I&apos;d suggest you upgrading to 1.1.0 or even 2.0.0 and see if this issue has been resolved because of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6499&quot; title=&quot;Avoid creating dummy checkpoint files with no state stores&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6499&quot;&gt;&lt;del&gt;KAFKA-6499&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16588406" author="ayushi0430" created="Wed, 22 Aug 2018 05:21:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&#160;This issue is there in 2.0.0 as well. Logs for the same:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;2018-08-22 03:17:03,745&amp;#93;&lt;/span&gt; org.apache.kafka.streams.processor.internals.ProcessorStateManager: task &lt;span class=&quot;error&quot;&gt;&amp;#91;0_45&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /tmp/kafka-streams/&amp;lt;application_id&amp;gt;&lt;/tt&gt;&lt;br/&gt;
{{ /0_45/.checkpoint: {}}}&lt;br/&gt;
{{ ! java.nio.file.NoSuchFileException: /tmp/kafka-streams/&amp;lt;application_id&amp;gt;/0_45/.checkpoint.tmp}}&lt;br/&gt;
{{ ! at sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)}}&lt;br/&gt;
{{ ! at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)}}&lt;br/&gt;
{{ ! at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:107)}}&lt;br/&gt;
{{ ! at sun.nio.fs.UnixCopyFile.move(UnixCopyFile.java:409)}}&lt;br/&gt;
{{ ! at sun.nio.fs.UnixFileSystemProvider.move(UnixFileSystemProvider.java:262)}}&lt;br/&gt;
{{ ! at java.nio.file.Files.move(Files.java:1395)}}&lt;br/&gt;
{{ ! at org.apache.kafka.common.utils.Utils.atomicMoveWithFallback(Utils.java:786)}}&lt;br/&gt;
{{ ! at org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:92)}}&lt;br/&gt;
{{ ! at org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:315)}}&lt;br/&gt;
{{ ! at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:383)}}&lt;br/&gt;
{{ ! at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:368)}}&lt;br/&gt;
{{ ! at org.apache.kafka.streams.processor.internals.AssignedTasks$1.apply(AssignedTasks.java:67)}}&lt;br/&gt;
{{ ! at org.apache.kafka.streams.processor.internals.AssignedTasks.applyToRunningTasks(AssignedTasks.java:362)}}&lt;br/&gt;
{{ ! at org.apache.kafka.streams.processor.internals.AssignedTasks.commit(AssignedTasks.java:352)}}&lt;br/&gt;
{{ ! at org.apache.kafka.streams.processor.internals.TaskManager.commitAll(TaskManager.java:401)}}&lt;br/&gt;
{{ ! at org.apache.kafka.streams.processor.internals.StreamThread.maybeCommit(StreamThread.java:1035)}}&lt;br/&gt;
{{ ! at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:845)}}&lt;br/&gt;
{{ ! at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:767)}}&lt;br/&gt;
{{ ! at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:736)}}&lt;br/&gt;
{{ ! Suppressed: java.nio.file.NoSuchFileException: /tmp/kafka-streams/&amp;lt;application_id&amp;gt;/0_45/.checkpoint.tmp -&amp;gt; /tmp/kafka-streams/&amp;lt;application_id&amp;gt;/0_45/.checkpoint}}&lt;br/&gt;
{{ ! at sun.nio.fs.UnixException.translateToIOException(UnixException.java:86)}}&lt;br/&gt;
{{ ! at sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:102)}}&lt;br/&gt;
{{ ! at sun.nio.fs.UnixCopyFile.move(UnixCopyFile.java:396)}}&lt;br/&gt;
{{ ! at sun.nio.fs.UnixFileSystemProvider.move(UnixFileSystemProvider.java:262)}}&lt;br/&gt;
{{ ! at java.nio.file.Files.move(Files.java:1395)}}&lt;br/&gt;
{{ ! at org.apache.kafka.common.utils.Utils.atomicMoveWithFallback(Utils.java:783)}}&lt;br/&gt;
{{ ! ... 12 common frames omitted}}&lt;/p&gt;

&lt;p&gt;This exception is thrown consistently&#160;after a given interval which I&apos;m guessing is the commit interval for the streams.&lt;/p&gt;</comment>
                            <comment id="16589110" author="guozhang" created="Wed, 22 Aug 2018 16:50:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ayushi0430&quot; class=&quot;user-hover&quot; rel=&quot;ayushi0430&quot;&gt;ayushi0430&lt;/a&gt; Thanks for reporting on 2.0.0, could you share your code snippet with the output of your `Topology.describe().toString()` so that I can better look into the issue?&lt;/p&gt;</comment>
                            <comment id="16589111" author="guozhang" created="Wed, 22 Aug 2018 16:51:15 +0000"  >&lt;p&gt;And also: is this exception being thrown right after the start of the application, plus the commit interval, or does it happen after the application has been running for a while?&lt;/p&gt;</comment>
                            <comment id="16589773" author="ayushi0430" created="Thu, 23 Aug 2018 06:40:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&#160;Requested files:&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12936777/12936777_Topology.txt&quot; title=&quot;Topology.txt attached to KAFKA-5998&quot;&gt;Topology.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12936778/12936778_streams.txt&quot; title=&quot;streams.txt attached to KAFKA-5998&quot;&gt;streams.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12936779/12936779_props.txt&quot; title=&quot;props.txt attached to KAFKA-5998&quot;&gt;props.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;
&lt;h4&gt;&lt;a name=&quot;Alsothisexceptionisbeingthrownafterlongintervaloftheapprunning.Andonceitisthrown%2Citisthrownconsistentlyafteraninterval.Afterrestartingtheapp%28asyou%27llseeinthecodeitdoesstreams.cleanup%26streams.start%29%2C...&quot;&gt;&lt;/a&gt;&lt;sup&gt;Also this exception is being thrown after long interval of the app running. And once it is thrown, it is thrown consistently after an interval. After restarting the app( as you&apos;ll see in the code it does streams.cleanup &amp;amp; streams.start), this is thrown right away.&lt;/sup&gt;&lt;/h4&gt;
&lt;h4&gt;&lt;a name=&quot;Icheckedtheunderlyingrocksdbstoresinthemachine%2Cicanactuallyfind%C2%A0%2Ftmp%2Fkafkastreams%2F%3Capplicationid%3E%2F045%2F.checkpoint.tmp&quot;&gt;&lt;/a&gt;&lt;sup&gt;I checked the underlying rocksdb stores in the machine, i can actually find&#160;/tmp/kafka-streams/&amp;lt;application_id&amp;gt;/0_45/.checkpoint.tmp&lt;/sup&gt;&lt;/h4&gt;</comment>
                            <comment id="16590492" author="guozhang" created="Thu, 23 Aug 2018 16:38:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ayushi0430&quot; class=&quot;user-hover&quot; rel=&quot;ayushi0430&quot;&gt;ayushi0430&lt;/a&gt; One thing I actually missed, but your latest email reminds me is that, your state directory is under `/tmp`, which may be auto-cleaned by OS regularly, this may leads to undefined behavior once such cleanup happens since even when the directory was auto-recreated by the streams app again, the lock channel from the file may not be valid any more.&lt;/p&gt;

&lt;p&gt;I&apos;ve also looked at the other files, which looks normal to me.&lt;/p&gt;

&lt;p&gt;I&apos;d suggest changing your state directory via &quot;state.dir&quot; config to another directory (default is in /tmp/kafka-streams), and see if it resolves the issue.&lt;/p&gt;</comment>
                            <comment id="16590505" author="ayushi0430" created="Thu, 23 Aug 2018 16:45:18 +0000"  >&lt;p&gt;&#160;Great observation and advice. Will try it out. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16590508" author="yuzhihong@gmail.com" created="Thu, 23 Aug 2018 16:48:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;via &quot;state.dir&quot; config to another directory (default is in /tmp/kafka-streams)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Shouldn&apos;t we provide better default location for the state.dir config (outside of /tmp) ?&lt;/p&gt;</comment>
                            <comment id="16590516" author="guozhang" created="Thu, 23 Aug 2018 16:52:31 +0000"  >&lt;p&gt;The motivation of setting default to `/tmp` is to rely on OS auto clean the state directory for quick-start / etc, similar reasons as to setting kafka log directory as `/tmp/kafka-logs`&lt;/p&gt;</comment>
                            <comment id="16590547" author="yuzhihong@gmail.com" created="Thu, 23 Aug 2018 17:11:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;java.nio.file.NoSuchFileException: /tmp/kafka-streams/&amp;lt;application_id&amp;gt;/0_45/.checkpoint.tmp&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;When the above happens, can we include suggestion in error log for user to migrate state.dir away from /tmp ?&lt;/p&gt;</comment>
                            <comment id="16590592" author="mjsax" created="Thu, 23 Aug 2018 17:45:46 +0000"  >&lt;p&gt;I guess we could check if the default `state.dir` is used, and extend the exception message accordingly.&lt;/p&gt;</comment>
                            <comment id="16590729" author="yuzhihong@gmail.com" created="Thu, 23 Aug 2018 19:41:05 +0000"  >&lt;p&gt;Logged &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7334&quot; title=&quot;Suggest changing config for state.dir in case of FileNotFoundException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7334&quot;&gt;&lt;del&gt;KAFKA-7334&lt;/del&gt;&lt;/a&gt; for improving exception message.&lt;/p&gt;

&lt;p&gt;The stack trace in the description didn&apos;t involve /tmp dir, so root cause is yet to be determined.&lt;/p&gt;</comment>
                            <comment id="16591870" author="ayushi0430" created="Fri, 24 Aug 2018 16:27:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; This issue is&#160;there even after changing state dir to a persistent location.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12937029/12937029_exc.txt&quot; title=&quot;exc.txt attached to KAFKA-5998&quot;&gt;exc.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16592063" author="guozhang" created="Fri, 24 Aug 2018 18:54:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ayushi0430&quot; class=&quot;user-hover&quot; rel=&quot;ayushi0430&quot;&gt;ayushi0430&lt;/a&gt; Thanks. I will take a deeper look into it.&lt;/p&gt;

&lt;p&gt;Is there an easy way to reproduce the issue? How long do you usually need to run it on Kafka 2.0.0 to hit this?&lt;/p&gt;</comment>
                            <comment id="16592383" author="ayushi0430" created="Sat, 25 Aug 2018 02:11:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt; I ran into this issue after running it for 1-2 hours for the shared application.&lt;/p&gt;

&lt;p&gt;Load of around 8000 messages/sec.&lt;/p&gt;

&lt;p&gt;Also, it is not restricted to some particular partitions.&#160;There are 50 partitions.&lt;/p&gt;</comment>
                            <comment id="16594530" author="ayushi0430" created="Tue, 28 Aug 2018 05:15:32 +0000"  >&lt;p&gt;Any updates on this please? The service throws this error for an hour or 2 and then starts streaming again. This is affecting the consumer throughput.&lt;/p&gt;</comment>
                            <comment id="16596589" author="guozhang" created="Wed, 29 Aug 2018 16:48:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ayushi0430&quot; class=&quot;user-hover&quot; rel=&quot;ayushi0430&quot;&gt;ayushi0430&lt;/a&gt; I do not have made concrete progress on this yet with latest release. The root is that I seems cannot reproduce the issue, will let you know once I got something.&lt;/p&gt;</comment>
                            <comment id="16597371" author="ayushi0430" created="Thu, 30 Aug 2018 12:19:38 +0000"  >&lt;p&gt;Alright. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16745716" author="dminkovsky" created="Fri, 18 Jan 2019 02:24:56 +0000"  >&lt;p&gt;I&apos;m getting this as well:&lt;/p&gt;

&lt;p&gt;{{&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-01-18 02:10:07,709&amp;#93;&lt;/span&gt; WARN (org.apache.kafka.streams.processor.internals.ProcessorStateManager:295) task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_1&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /opt/streams-state/user-service/2_1/.checkpoint: java.io.FileNotFoundException: /opt/streams-state/user-service/2_1/.checkpoint.tmp (No such file or directory) }}&lt;br/&gt;
 {{ &lt;span class=&quot;error&quot;&gt;&amp;#91;2019-01-18 02:10:07,790&amp;#93;&lt;/span&gt; WARN (org.apache.kafka.streams.processor.internals.ProcessorStateManager:295) task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_1&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /opt/streams-state/user-service/2_1/.checkpoint: java.io.FileNotFoundException: /opt/streams-state/user-service/2_1/.checkpoint.tmp (No such file or directory)}}&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;When I look in the state dir:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;root@user-service-659fcb455-2fkxp:/opt/streams-state/user-service# ls -alh&lt;/p&gt;

&lt;p&gt;total 48K&lt;/p&gt;

&lt;p&gt;drwxr-xr-x 12 root root 4.0K Jan 18 01:50 .&lt;/p&gt;

&lt;p&gt;drwxrwxrwx&#160; 3 root root 4.0K Jan 18 01:30 ..&lt;/p&gt;

&lt;p&gt;drwxr-xr-x&#160; 4 root root 4.0K Jan 18 02:10 0_0&lt;/p&gt;

&lt;p&gt;drwxr-xr-x&#160; 4 root root 4.0K Jan 18 01:30 0_1&lt;/p&gt;

&lt;p&gt;drwxr-xr-x&#160; 4 root root 4.0K Jan 18 02:10 0_2&lt;/p&gt;

&lt;p&gt;drwxr-xr-x&#160; 4 root root 4.0K Jan 18 01:30 0_3&lt;/p&gt;

&lt;p&gt;drwxr-xr-x&#160; 4 root root 4.0K Jan 18 01:30 0_4&lt;/p&gt;

&lt;p&gt;drwxr-xr-x&#160; 3 root root 4.0K Jan 18 01:30 1_0&lt;/p&gt;

&lt;p&gt;drwxr-xr-x&#160; 3 root root 4.0K Jan 18 02:10 1_1&lt;/p&gt;

&lt;p&gt;drwxr-xr-x&#160; 3 root root 4.0K Jan 18 01:30 1_2&lt;/p&gt;

&lt;p&gt;drwxr-xr-x&#160; 3 root root 4.0K Jan 18 01:30 1_3&lt;/p&gt;

&lt;p&gt;drwxr-xr-x&#160; 3 root root 4.0K Jan 18 01:30 1_4&lt;/p&gt;

&lt;p&gt;root@user-service-659fcb455-2fkxp:/opt/streams-state/user-service#&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Not sure what that task 2_1. Will have to add some logging to check.&#160;&lt;/p&gt;</comment>
                            <comment id="16771408" author="pkleindl" created="Mon, 18 Feb 2019 22:10:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Not sure if it helps, but I found an occurrence where the state directory was deleted by the CleanupThread, leading to the behaviour above:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2019-02-18 22:26:35,891 INFO [org.apache.kafka.streams.processor.internals.StateDirectory] (application-ba79c07c-1ac4-453f-8bf8-f814159cec59-CleanupThread) - [&lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt;-component-name:; transaction-id:; user-id:; creation-time:] stream-thread [application-ba79c07c-1ac4-453f-8bf8-f814159cec59-CleanupThread] Deleting obsolete state directory 1_4 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; task 1_4 as 771891ms has elapsed (cleanup delay is 600000ms).

2019-02-18 22:26:52,193 WARN [org.apache.kafka.streams.processor.internals.ProcessorStateManager] (application-ba79c07c-1ac4-453f-8bf8-f814159cec59-StreamThread-1) - [&lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt;-component-name:; transaction-id:; user-id:; creation-time:] task [1_4] Failed to write offset checkpoint file to /opt/app/wildfly/standalone/tmp/application-streamapp/1_4/.checkpoint: {}: java.io.FileNotFoundException: /opt/app/wildfly/standalone/tmp/application-streamapp/1_4/.checkpoint.tmp (No such file or directory)
 at java.io.FileOutputStream.open0(Native Method)
 at java.io.FileOutputStream.open(FileOutputStream.java:270)
 at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:213)
 at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:162)
 at org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:79)
 at org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:293)
 at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:446)
 at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:431)
 at org.apache.kafka.streams.processor.internals.AssignedTasks.commit(AssignedTasks.java:346)
 at org.apache.kafka.streams.processor.internals.TaskManager.commitAll(TaskManager.java:405)
 at org.apache.kafka.streams.processor.internals.StreamThread.maybeCommit(StreamThread.java:1029)
 at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:883)
 at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:777)
 at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:747)

2019-02-18 22:28:24,173 WARN [org.apache.kafka.streams.processor.internals.ProcessorStateManager] (application-ba79c07c-1ac4-453f-8bf8-f814159cec59-StreamThread-1) - [&lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt;-component-name:; transaction-id:; user-id:; creation-time:] task [1_4] Failed to write offset checkpoint file to /opt/app/wildfly/standalone/tmp/application-streamapp/1_4/.checkpoint: {}: java.io.FileNotFoundException: /opt/app/wildfly/standalone/tmp/application-streamapp/1_4/.checkpoint.tmp (No such file or directory)
 at java.io.FileOutputStream.open0(Native Method)
 at java.io.FileOutputStream.open(FileOutputStream.java:270)
 at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:213)
 at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:162)
 at org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:79)
 at org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:293)
 at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:446)
 at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:431)
 at org.apache.kafka.streams.processor.internals.AssignedTasks.commit(AssignedTasks.java:346)
 at org.apache.kafka.streams.processor.internals.TaskManager.commitAll(TaskManager.java:405)
 at org.apache.kafka.streams.processor.internals.StreamThread.maybeCommit(StreamThread.java:1029)
 at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:883)
 at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:777)
 at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:747)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16772793" author="nitay.k" created="Wed, 20 Feb 2019 09:07:04 +0000"  >&lt;p&gt;Nothing much to add just that I am&#160;getting this as well (2.1.0)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
task [0_5] Failed to write offset checkpoint file to /ephemeral/kafka-streams&lt;span class=&quot;code-comment&quot;&gt;/***/&lt;/span&gt;0_5/.checkpoint: {}: java.io.FileNotFoundException: /ephemeral/kafka-streams&lt;span class=&quot;code-comment&quot;&gt;/***/&lt;/span&gt;0_5/.checkpoint.tmp (No such file or directory)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16773703" author="mjsax" created="Thu, 21 Feb 2019 06:22:36 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pkleindl&quot; class=&quot;user-hover&quot; rel=&quot;pkleindl&quot;&gt;pkleindl&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nitay.k&quot; class=&quot;user-hover&quot; rel=&quot;nitay.k&quot;&gt;nitay.k&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="16782481" author="dminkovsky" created="Sat, 2 Mar 2019 19:03:34 +0000"  >&lt;p&gt;This seems to be happening in streams applications with session stores. And it seems to happen after retention periods expire. Maybe something is being deleted?&lt;/p&gt;</comment>
                            <comment id="16784126" author="lbdai3190" created="Tue, 5 Mar 2019 06:03:16 +0000"  >&lt;p&gt;It seems that&#160;&lt;font color=&quot;#ff0000&quot;&gt; final File temp = new File(file.getAbsolutePath() + &quot;.tmp&quot;);&lt;/font&gt; will not create new file on some system sometimes. can we do this as bellow before write offset to checkpoint.tmp file.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//&#20195;&#30721;&#21344;&#20301;&#31526;
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File temp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(file.getAbsolutePath() + &lt;span class=&quot;code-quote&quot;&gt;&quot;.tmp&quot;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!temp.exists()) {&#160; &#160; &#160; &#160;&lt;span class=&quot;code-comment&quot;&gt;// create .checkpoint.tmp file &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it&apos;s not exists
&lt;/span&gt;temp.createNewFile();
}
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FileOutputStream fileOutputStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(temp);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16794330" author="j-white" created="Sat, 16 Mar 2019 19:51:54 +0000"  >&lt;p&gt;We&apos;re running into this one too:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2019-03-16T14:46:50,866 | WARN  | oce-datasource-33a4a7f6-b157-4b31-abc7-f21939543865-StreamThread-7 | ProcessorStateManager            | 82 - org.apache.servicemix.bundles.kafka-clients - 2.0.0.1 | task [2_0] Failed to write offset checkpoint file to /opt/sentinel/data/kafka/oce-datasource/2_0/.checkpoint: {}
java.io.FileNotFoundException: /opt/sentinel/data/kafka/oce-datasource/2_0/.checkpoint.tmp (No such file or directory)
        at java.io.FileOutputStream.open0(Native Method) ~[?:?]
        at java.io.FileOutputStream.open(FileOutputStream.java:270) ~[?:?]
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:213) ~[?:?]
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:162) ~[?:?]
        at org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:78) ~[83:org.apache.servicemix.bundles.kafka-streams:2.0.0.1]
        at org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:315) [83:org.apache.servicemix.bundles.kafka-streams:2.0.0.1]
        at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:383) [83:org.apache.servicemix.bundles.kafka-streams:2.0.0.1]
        at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:368) [83:org.apache.servicemix.bundles.kafka-streams:2.0.0.1]
        at org.apache.kafka.streams.processor.internals.AssignedTasks$1.apply(AssignedTasks.java:67) [83:org.apache.servicemix.bundles.kafka-streams:2.0.0.1]
        at org.apache.kafka.streams.processor.internals.AssignedTasks.applyToRunningTasks(AssignedTasks.java:362) [83:org.apache.servicemix.bundles.kafka-streams:2.0.0.1]
        at org.apache.kafka.streams.processor.internals.AssignedTasks.commit(AssignedTasks.java:352) [83:org.apache.servicemix.bundles.kafka-streams:2.0.0.1]
        at org.apache.kafka.streams.processor.internals.TaskManager.commitAll(TaskManager.java:401) [83:org.apache.servicemix.bundles.kafka-streams:2.0.0.1]
        at org.apache.kafka.streams.processor.internals.StreamThread.maybeCommit(StreamThread.java:1035) [83:org.apache.servicemix.bundles.kafka-streams:2.0.0.1]
        at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:845) [83:org.apache.servicemix.bundles.kafka-streams:2.0.0.1]
        at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:767) [83:org.apache.servicemix.bundles.kafka-streams:2.0.0.1]
        at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:736) [83:org.apache.servicemix.bundles.kafka-streams:2.0.0.1]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16795966" author="yaojingguo" created="Tue, 19 Mar 2019 10:47:39 +0000"  >&lt;p&gt;After we restarted a streaming application, we also got the following error:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;2019-03-19 18:10:50,713 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;roombox-stream-client-StreamThread-1&amp;#93;&lt;/span&gt; o.a.k.s.p.i.ProcessorStateManager: task &lt;span class=&quot;error&quot;&gt;&amp;#91;0_0&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/roombox-stream/0_0/.checkpoint: {}&lt;br/&gt;
java.io.FileNotFoundException: /data/kafka-streams/roombox-stream/0_0/.checkpoint.tmp (No such file or directory)&lt;br/&gt;
 at java.io.FileOutputStream.open0(Native Method)&lt;br/&gt;
 at java.io.FileOutputStream.open(FileOutputStream.java:270)&lt;br/&gt;
 at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:213)&lt;br/&gt;
 at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:162)&lt;br/&gt;
 at org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:79)&lt;br/&gt;
 at org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:293)&lt;br/&gt;
 at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:446)&lt;br/&gt;
 at org.apache.kafka.streams.processor.internals.StreamTask.suspend(StreamTask.java:568)&lt;br/&gt;
 at org.apache.kafka.streams.processor.internals.StreamTask.close(StreamTask.java:691)&lt;br/&gt;
 at org.apache.kafka.streams.processor.internals.AssignedTasks.close(AssignedTasks.java:397)&lt;br/&gt;
 at org.apache.kafka.streams.processor.internals.TaskManager.shutdown(TaskManager.java:260)&lt;br/&gt;
 at org.apache.kafka.streams.processor.internals.StreamThread.completeShutdown(StreamThread.java:1181)&lt;br/&gt;
 at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:758)&lt;/p&gt;</comment>
                            <comment id="16811320" author="mparthas" created="Fri, 5 Apr 2019 22:22:27 +0000"  >&lt;p&gt;This is becoming a real problem. Can someone provide a workaround ? When it hits this condition, it also seems to process messages form old offsets and that can trigger stale events in the system. What we see is that the new state files (1_0) and it is still looking for 0_0. We moved the state directory from /tmp and can this cause this problem ? How can I clean up this internal state ?&lt;/p&gt;</comment>
                            <comment id="16811551" author="yuzhihong@gmail.com" created="Sat, 6 Apr 2019 10:52:06 +0000"  >&lt;p&gt;Cleanup delay is controlled by:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; STATE_CLEANUP_DELAY_MS_CONFIG = &lt;span class=&quot;code-quote&quot;&gt;&quot;state.cleanup.delay.ms&quot;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Maybe longer value can be specified so that CleanupThread doesn&apos;t clean up the task directory prematurely (in case task directory hasn&apos;t been modified for a while).&lt;/p&gt;</comment>
                            <comment id="16811603" author="yuzhihong@gmail.com" created="Sat, 6 Apr 2019 14:27:55 +0000"  >&lt;p&gt;It seems StreamTask can keep track of active tasks. After commit() finishes, StreamTask can inform stateDirectory.cleanRemovedTasks that the underlying task is subject to cleaning.&lt;br/&gt;
This would be more robust than depending on period of inactivity alone for cleaning.&lt;/p&gt;</comment>
                            <comment id="16811611" author="mparthas" created="Sat, 6 Apr 2019 15:01:39 +0000"  >&lt;p&gt;Ted, Thanks for your suggestion. We will give it a try. The current default seems to be 10 minutes. Also, have you seen the issue of old messages showing up because of this exception ? I can&apos;t possibly understand that as there is no reported lag in the consumer.&lt;/p&gt;

&lt;p&gt;Also, where is the state kept about these old directories that we can manually cleanup in case we see this error in production ?&lt;/p&gt;</comment>
                            <comment id="16811681" author="yuzhihong@gmail.com" created="Sat, 6 Apr 2019 19:43:00 +0000"  >&lt;p&gt;I made the following change:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/integration/AbstractJoinIntegrationTest.java b/streams/src/test/java/org/apache/kafka/streams/integration/AbstractJoinIntegrationTest.java
index badaa36cd..be29ebe56 100644
--- a/streams/src/test/java/org/apache/kafka/streams/integration/AbstractJoinIntegrationTest.java
+++ b/streams/src/test/java/org/apache/kafka/streams/integration/AbstractJoinIntegrationTest.java
@@ -138,6 +138,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;AbstractJoinIntegrationTest {
         RESULT_CONSUMER_CONFIG.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, LongDeserializer.class);
         RESULT_CONSUMER_CONFIG.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);

+        STREAMS_CONFIG.put(StreamsConfig.STATE_CLEANUP_DELAY_MS_CONFIG, &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;);
         STREAMS_CONFIG.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, &lt;span class=&quot;code-quote&quot;&gt;&quot;earliest&quot;&lt;/span&gt;);
         STREAMS_CONFIG.put(IntegrationTestUtils.INTERNAL_LEAVE_GROUP_ON_CLOSE, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
         STREAMS_CONFIG.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, CLUSTER.bootstrapServers());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For the following check in KafkaStreams#start:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state == State.RUNNING) {
                    stateDirectory.cleanRemovedTasks(cleanupDelay);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The state was REBALANCING during TableTableJoinIntegrationTest.&lt;br/&gt;
The cleaning was not triggered.&lt;/p&gt;</comment>
                            <comment id="16812743" author="mparthas" created="Mon, 8 Apr 2019 19:59:50 +0000"  >&lt;p&gt;That did not seem to help much. We still see this error:&lt;/p&gt;

&lt;p&gt;2019-04-08 19:38:50,074 WARN&#160; ProcessorStateManager: task &lt;span class=&quot;error&quot;&gt;&amp;#91;0_3&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /tmp/kafka-state/test-app/0_3/.checkpoint: java.io.FileNotFoundException: /tmp/kafka-state/test-app/0_3/.checkpoint.tmp (No such file or directory)&lt;/p&gt;

&lt;p&gt;If i look under /tmp/kafka-state/test-app, most of the time you see only 1_X directories. Sometimes I do see 0_X directories and then it disappears. Also, not sure whether it is related to this or not, when new messages come, the old messages are getting reprocessed. Not sure because of the check point problem.&lt;/p&gt;</comment>
                            <comment id="16813009" author="guozhang" created="Tue, 9 Apr 2019 05:11:09 +0000"  >&lt;p&gt;This seems affecting lots of people&apos;s file systems.&lt;/p&gt;

&lt;p&gt;Could everyone share your environment&apos;s OS / FS by editing this ticket&apos;s &lt;tt&gt;Environment&lt;/tt&gt; field (you can click &quot;edit&quot; above and search for that field), while we can look deeper into it and try to find an ultimate fix? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mparthas&quot; class=&quot;user-hover&quot; rel=&quot;mparthas&quot;&gt;mparthas&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yaojingguo&quot; class=&quot;user-hover&quot; rel=&quot;yaojingguo&quot;&gt;yaojingguo&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=j-white&quot; class=&quot;user-hover&quot; rel=&quot;j-white&quot;&gt;j-white&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dminkovsky&quot; class=&quot;user-hover&quot; rel=&quot;dminkovsky&quot;&gt;dminkovsky&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lbdai3190&quot; class=&quot;user-hover&quot; rel=&quot;lbdai3190&quot;&gt;lbdai3190&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16813012" author="mparthas" created="Tue, 9 Apr 2019 05:24:30 +0000"  >&lt;p&gt;I am not able to find the environemt field:&lt;/p&gt;

&lt;p&gt;CentOS: 2.6.32-696&lt;/p&gt;

&lt;p&gt;Kafka Version: 1.0.2&lt;/p&gt;

&lt;p&gt;What else do you need ?&lt;/p&gt;</comment>
                            <comment id="16813550" author="dminkovsky" created="Tue, 9 Apr 2019 15:39:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt;&#160;I am using&#160;kafka_2.12-2.1.0. The behavior seems&#160;identical&#160;on&#160;my local dev environment macOS 10.14/APFS and whatever Linux GKE runs,&#160;with Kafka inside a container&#160;using data on ext4.&#160;&lt;/p&gt;</comment>
                            <comment id="16814233" author="xmar" created="Wed, 10 Apr 2019 09:13:09 +0000"  >&lt;p&gt;It also happens to me on&#160;kafka_2.12-2.1.0. Run in AWS in docker (based in wurstmeister image) over Amazon Linux.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;$ cat /proc/version&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;Linux version 4.14.77-69.57.amzn1.x86_64 (mockbuild@gobi-build-60003) (gcc version 7.2.1 20170915 (Red Hat 7.2.1-2) (GCC)) #1 SMP Tue Nov 6 21:32:55 UTC 2018&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="16814291" author="pkleindl" created="Wed, 10 Apr 2019 10:12:05 +0000"  >&lt;p&gt;SUSE Linux Enterprise Server 12 SP3&lt;/p&gt;

&lt;p&gt;4.4.176-94.88-default #1 SMP Thu Mar 21 10:52:54 UTC 2019 (dea44ca) x86_64 x86_64 x86_64 GNU/Linux&lt;/p&gt;

&lt;p&gt;xfs/btrfs&lt;/p&gt;</comment>
                            <comment id="16814356" author="timvanlaer" created="Wed, 10 Apr 2019 11:24:02 +0000"  >&lt;p&gt;Running kafka-streams 2.0.1 in Docker&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;$ cat /proc/version&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Linux version 4.4.0-1075-aws (buildd@lgw01-amd64-035) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.10) ) #85-Ubuntu SMP Thu Jan 17 17:15:12 UTC 2019&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Filesystem is ext4.&#160;&lt;/p&gt;

&lt;p&gt;For completeness, our kafka-streams state directory is a Docker volume, so it&apos;s a directory on the host machine that&apos;s mounted inside the container. Several application instances (containers) on the same host, share the same state directory.&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="16816157" author="drshade" created="Fri, 12 Apr 2019 10:29:22 +0000"  >&lt;p&gt;Hi all - I&apos;ve been running into this same issue for the past few weeks while building an application which is composed of a number of streams dsl processors.&lt;/p&gt;

&lt;p&gt;I&apos;ve noticed that I only experience this issue when running more than 1 instance of the same processor on the same machine (my laptop). Looking at the code it&apos;s obvious that this could be a problem (write() function in ProcessorStateManager.java) as it uses a synchronized block to lock any other threads writing their snapshots, but obviously won&apos;t avoid other processes writing at the same time. A possibly fix is to look at a more robust (possibly filesystem based) locking mechanism - but i&apos;m no kafka expert (yet!).&lt;/p&gt;

&lt;p&gt;Does that make sense or am I barking up the wrong tree?&lt;/p&gt;</comment>
                            <comment id="16816770" author="guozhang" created="Sat, 13 Apr 2019 00:55:49 +0000"  >&lt;p&gt;Thank you guys! I will run over those info and get back to you soon.&lt;/p&gt;</comment>
                            <comment id="16819913" author="rabih.hallage" created="Wed, 17 Apr 2019 10:00:08 +0000"  >&lt;p&gt;Hello Guys,&lt;br/&gt;
 I&apos;m experiencing the same issue with the following stack trace (I tried to change the state directory, same thing):&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2019-04-16 16:42:13,459] WARN [****-app-cid-1-StreamThread-1] task [0_0] Failed to write offset checkpoint file to [/opt/ial/kafka-streams/****-app_v1/0_0/.checkpoint] (org.apache.kafka.streams.processor.internals.ProcessorStateManager)
java.io.FileNotFoundException: /opt/ial/kafka-streams/****-app_v1/0_0/.checkpoint.tmp (No such file or directory)
        at java.io.FileOutputStream.open0(Native Method)
        at java.io.FileOutputStream.open(FileOutputStream.java:270)
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:213)
        at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:162)
        at org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:79)
        at org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:325)
        at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:474)
        at org.apache.kafka.streams.processor.internals.StreamTask.suspend(StreamTask.java:596)
        at org.apache.kafka.streams.processor.internals.StreamTask.suspend(StreamTask.java:567)
        at org.apache.kafka.streams.processor.internals.AssignedTasks.suspendTasks(AssignedTasks.java:128)
        at org.apache.kafka.streams.processor.internals.AssignedTasks.suspend(AssignedTasks.java:97)
        at org.apache.kafka.streams.processor.internals.TaskManager.suspendTasksAndState(TaskManager.java:242)
        at org.apache.kafka.streams.processor.internals.StreamThread$RebalanceListener.onPartitionsRevoked(StreamThread.java:319)
        at org.apache.kafka.clients.consumer.internals.ConsumerCoordinator.onJoinPrepare(ConsumerCoordinator.java:461)
        at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.joinGroupIfNeeded(AbstractCoordinator.java:396)
        at org.apache.kafka.clients.consumer.internals.AbstractCoordinator.ensureActiveGroup(AbstractCoordinator.java)
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16820523" author="pkleindl" created="Wed, 17 Apr 2019 21:33:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; Could you please share the direction(s) you are currently investigating?&lt;/p&gt;

&lt;p&gt;Is the problem only with the file or is the whole directory affected? And if the latter, how come this does not impact stream processing?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16822395" author="drshade" created="Sat, 20 Apr 2019 09:08:12 +0000"  >&lt;p&gt;I&apos;ve confirmed the issue is related to multiple processes sharing the same &quot;state.dir&quot; directory (well certainly for me).&lt;/p&gt;

&lt;p&gt;I added the following to each of my stream processors:&lt;/p&gt;

&lt;p&gt;&amp;lt;code&amp;gt;&lt;/p&gt;

&lt;p&gt;// Investigating checkpoint not found issue (assumption is that multiple stream processor processes hitting the&lt;br/&gt;
// same /tmp/kafka-streams folder)&lt;br/&gt;
//&lt;br/&gt;
val pid = ProcessHandle.current().pid()&lt;br/&gt;
properties&lt;span class=&quot;error&quot;&gt;&amp;#91;StreamsConfig.STATE_DIR_CONFIG&amp;#93;&lt;/span&gt; = &quot;/tmp/kafka-streams-$pid&quot;&lt;/p&gt;

&lt;p&gt;&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;then launched each of my four stream processors on the same machine. No more &quot;failed to write offset checkpoint file...&quot; exception - but of course now each run of the stream processor will hit a new /tmp/kafka-streams-* folder and will have to rebuild it which is obviously suboptimal.&#160;&lt;/p&gt;

&lt;p&gt;Hope some of that helps.&lt;/p&gt;</comment>
                            <comment id="16822446" author="yuzhihong@gmail.com" created="Sat, 20 Apr 2019 14:32:49 +0000"  >&lt;p&gt;I wonder if we can use a file, which records reference count (for processor instances), alongside checkpoint file.&lt;/p&gt;

&lt;p&gt;Checkpoint file is only deleted when count reaches zero.&lt;/p&gt;</comment>
                            <comment id="16822537" author="mjsax" created="Sat, 20 Apr 2019 18:19:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=drshade&quot; class=&quot;user-hover&quot; rel=&quot;drshade&quot;&gt;drshade&lt;/a&gt; Instead of using the PID to separate the state directory, it might be better to do some manual assignment to make sure that each instance uses a different state directory that it can reuse on restart. Also, it&apos;s not recommended to use `/tmp/` as state directory anyway for production use cases.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuzhihong%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yuzhihong@gmail.com&quot;&gt;yuzhihong@gmail.com&lt;/a&gt; The checkpoint file should be used by exactly one task. Thus, I am not sure how reference counting would help? The underlying problem seems to be, that the locking mechanism is somehow broken and even if a task holds a lock to protect the checkpoint file, some other thread is able to grab the lock, too (what should never happen) and deletes the file. Reference counting would&#160;also need a lock mechanism to make sure the file is&#160;not written concurrently, but as the lock mechanism is somehow broken, the assume that we &quot;move&quot; the problem from a &quot;file not found&quot; to potentially corrupting the reference count. Or did I miss understand your proposal?&lt;/p&gt;</comment>
                            <comment id="16822563" author="mparthas" created="Sat, 20 Apr 2019 20:42:01 +0000"  >&lt;p&gt;When are these checkpoint files created ? I don&apos;t see this in all the hosts where the apps are running. It looks to me that the current scheme encodes the partition number in the directory. Why isn&apos;t that sufficient ?&lt;/p&gt;</comment>
                            <comment id="16822564" author="yuzhihong@gmail.com" created="Sat, 20 Apr 2019 20:43:32 +0000"  >&lt;p&gt;One doubt I had after reading recent comments is that, if the state directory is used by more than one process, wouldn&apos;t the problem manifest itself other than disappearing checkpoint file (such as corrupted checkpoint) ?&lt;/p&gt;

&lt;p&gt;My former comment on reference counting was not refined (pending answer to the above doubt, we may come up with good solution).&lt;/p&gt;</comment>
                            <comment id="16822610" author="mjsax" created="Sun, 21 Apr 2019 02:06:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mparthas&quot; class=&quot;user-hover&quot; rel=&quot;mparthas&quot;&gt;mparthas&lt;/a&gt; It there are state stores, on commit, the last written offsets to the changelog topic are stored in the checkpoint files. This way, Kafka Streams can check if a store need to be recovered and if yes from what point in the changelog.&lt;/p&gt;

&lt;p&gt;&amp;gt;&#160;Why isn&apos;t that sufficient ?&lt;/p&gt;

&lt;p&gt;For what?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuzhihong%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yuzhihong@gmail.com&quot;&gt;yuzhihong@gmail.com&lt;/a&gt; The other thread would be the state-cleaner thread, that only checks if there is old state that should be deleted. This thread might delete the state directory, and later the processing thread that tries to write the checkpoint does not find the checkpoint file any longer. But otherwise, you are right &#8211; if there is another thread trying to write to the same checkpoint file, it could be corrupted, too.&lt;/p&gt;</comment>
                            <comment id="16822614" author="mparthas" created="Sun, 21 Apr 2019 02:58:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt; Initially my understanding was that there should not be more than one thread check pointing to a state store. That seems incorrect. You explain above that the log-cleaner&#160; is the other thread. But then there is also a &quot;lock&quot; which made me think that we are using some sort of file-system lock for serialization ?&lt;/p&gt;

&lt;p&gt;Also, I&#160; see this:&lt;/p&gt;

&lt;p&gt;0_0&#160; 0_1&#160; 0_2&#160; 0_3&#160; 0_4&#160; 0_5&#160; 1_0&#160; 1_2&#160; 1_4&#160; 2_0&#160; 2_1&#160; 2_2&#160; 2_3&#160; 2_4&#160; 2_5&lt;/p&gt;

&lt;p&gt;Why are there so many directories ? I have one instance of the application reading from a topic with six partitions.&lt;/p&gt;</comment>
                            <comment id="16822619" author="mjsax" created="Sun, 21 Apr 2019 03:58:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mparthas&quot; class=&quot;user-hover&quot; rel=&quot;mparthas&quot;&gt;mparthas&lt;/a&gt; &quot;log-cleaner&quot; is actually not the right term (I corrected my comment above). It&apos;s called state-cleaner. And state-cleaner does not checkpoint, ie, it does not write the checkpoint file. However, it might delete a whole task directory. The idea is to free up space if a task is migrated to another instance after some configurable delay.&lt;/p&gt;

&lt;p&gt;Yes, there is a .lock file &#8211; as long as a task directory is in use, it should prevent the state-cleaner thread to delete the task directory. It seems this lock mechanism is somehow broken (on some OS or FS) resulting in the reported issue of this ticket.&lt;/p&gt;

&lt;p&gt;I guess that your program consists of 3 subtopologies and thus you get 3 * 6 tasks. The task directories are names as &quot;&amp;lt;subTopologyId&amp;gt;_&amp;lt;partitionId&amp;gt;&quot;.&lt;/p&gt;</comment>
                            <comment id="16824514" author="pkleindl" created="Tue, 23 Apr 2019 20:54:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt; If the state-cleaner ran and deleted the task directory, wouldn&apos;t that impact processing, too?&lt;/p&gt;

&lt;p&gt;Or would the state be restored automatically even without restarting?&lt;/p&gt;</comment>
                            <comment id="16825583" author="mjsax" created="Wed, 24 Apr 2019 23:52:00 +0000"  >&lt;p&gt;Sounds reasonable. Not sure why we see this problem only for the checkpoint file.&lt;/p&gt;

&lt;p&gt;Restore would only be triggered after a rebalance.&lt;/p&gt;</comment>
                            <comment id="16825821" author="pkleindl" created="Thu, 25 Apr 2019 07:41:44 +0000"  >&lt;p&gt;This issue was what led me to&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7672&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-7672&lt;/a&gt;, because there issues with the checkpoint file are also mentioned.&lt;/p&gt;

&lt;p&gt;I don&apos;t know if anyone on this thread has reported the problem with 2.2 or trunk, we are just working on the upgrade.&lt;/p&gt;

&lt;p&gt;One way I could imagine that this&#160;is&#160;not a problem if&#160;the task has&#160;no RocksDB but tries to write the checkpoint file anyway, but I don&apos;t see in which case this would be possible.&lt;/p&gt;</comment>
                            <comment id="16826188" author="mjsax" created="Thu, 25 Apr 2019 15:47:24 +0000"  >&lt;p&gt;In older release, a checkpoint file is written for all tasks. If the is not state, the file would just be empty. It&apos;s fixed since 2.0.0 release though (cf&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6499&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-6499&lt;/a&gt;)&#160;&lt;/p&gt;</comment>
                            <comment id="16826493" author="pkleindl" created="Thu, 25 Apr 2019 21:51:56 +0000"  >&lt;p&gt;Found a new log, again starting with the message after the state-cleaner ran.&lt;/p&gt;

&lt;p&gt;Filtered on task 1_1, there was no rebalance or anything in the time from 19:30 to 21:03&lt;/p&gt;

&lt;p&gt;April 25th 2019, 21:07:51.658 2019-04-25 21:07:51,658 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.kafka.streams.processor.internals.ProcessorStateManager&amp;#93;&lt;/span&gt; (application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-StreamThread-1) - &lt;span class=&quot;error&quot;&gt;&amp;#91;short-component-name:; transaction-id:; user-id:; creation-time:&amp;#93;&lt;/span&gt; task &lt;span class=&quot;error&quot;&gt;&amp;#91;1_1&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /opt/app/wildfly/standalone/tmp/application-streamapp.v1/1_1/.checkpoint: {}: java.io.FileNotFoundException: /opt/app/wildfly/standalone/tmp/application-streamapp.v1/1_1/.checkpoint.tmp (No such file or directory)&lt;br/&gt;
 at java.io.FileOutputStream.open0(Native Method)&lt;br/&gt;
 at java.io.FileOutputStream.open(FileOutputStream.java:270)&lt;/p&gt;

&lt;p&gt;April 25th 2019, 21:03:49.332 2019-04-25 21:03:49,332 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.kafka.streams.processor.internals.StateDirectory&amp;#93;&lt;/span&gt; (application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-CleanupThread) - &lt;span class=&quot;error&quot;&gt;&amp;#91;short-component-name:; transaction-id:; user-id:; creation-time:&amp;#93;&lt;/span&gt; stream-thread &lt;span class=&quot;error&quot;&gt;&amp;#91;application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-CleanupThread&amp;#93;&lt;/span&gt; Deleting obsolete state directory 1_1 for task 1_1 as 813332ms has elapsed (cleanup delay is 600000ms).&lt;/p&gt;

&lt;p&gt;April 25th 2019, 19:30:52.902 2019-04-25 19:30:52,902 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.kafka.streams.processor.internals.StreamThread&amp;#93;&lt;/span&gt; (application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-StreamThread-1) - &lt;span class=&quot;error&quot;&gt;&amp;#91;short-component-name:; transaction-id:; user-id:; creation-time:&amp;#93;&lt;/span&gt; stream-thread &lt;span class=&quot;error&quot;&gt;&amp;#91;application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-StreamThread-1&amp;#93;&lt;/span&gt; partition assignment took 80 ms.&lt;br/&gt;
 current active tasks: &lt;span class=&quot;error&quot;&gt;&amp;#91;1_0, 0_1, 1_1, 0_3, 2_1, 1_3, 1_4, 0_5, 2_3, 1_5, 1_6, 0_7, 2_5, 0_11, 2_9, 1_11, 2_10, 2_11&amp;#93;&lt;/span&gt;&lt;br/&gt;
 current standby tasks: []&lt;br/&gt;
 previous active tasks: &lt;span class=&quot;error&quot;&gt;&amp;#91;1_0, 0_1, 1_1, 0_3, 2_1, 1_3, 1_4, 2_3, 0_5, 1_5, 1_6, 0_7, 2_5, 0_11, 2_9, 1_11, 2_10, 2_11&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;April 25th 2019, 19:30:52.713 2019-04-25 19:30:52,713 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.kafka.streams.processor.internals.StreamThread&amp;#93;&lt;/span&gt; (application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-StreamThread-1) - &lt;span class=&quot;error&quot;&gt;&amp;#91;short-component-name:; transaction-id:; user-id:; creation-time:&amp;#93;&lt;/span&gt; stream-thread &lt;span class=&quot;error&quot;&gt;&amp;#91;application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-StreamThread-1&amp;#93;&lt;/span&gt; partition revocation took 764 ms.&lt;br/&gt;
 suspended active tasks: &lt;span class=&quot;error&quot;&gt;&amp;#91;1_0, 0_1, 1_1, 0_3, 2_1, 1_3, 1_4, 2_3, 0_5, 1_5, 1_6, 0_7, 2_5, 0_11, 2_9, 1_11, 2_10, 2_11&amp;#93;&lt;/span&gt;&lt;br/&gt;
 suspended standby tasks: []&lt;/p&gt;

&lt;p&gt;April 25th 2019, 19:30:39.144 2019-04-25 19:30:39,144 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.kafka.streams.processor.internals.StreamThread&amp;#93;&lt;/span&gt; (application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-StreamThread-1) - &lt;span class=&quot;error&quot;&gt;&amp;#91;short-component-name:; transaction-id:; user-id:; creation-time:&amp;#93;&lt;/span&gt; stream-thread &lt;span class=&quot;error&quot;&gt;&amp;#91;application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-StreamThread-1&amp;#93;&lt;/span&gt; partition assignment took 29 ms.&lt;br/&gt;
 current active tasks: &lt;span class=&quot;error&quot;&gt;&amp;#91;1_0, 0_1, 1_1, 0_3, 2_1, 1_3, 1_4, 2_3, 0_5, 1_5, 1_6, 0_7, 2_5, 0_11, 2_9, 1_11, 2_10, 2_11&amp;#93;&lt;/span&gt;&lt;br/&gt;
 current standby tasks: []&lt;br/&gt;
 previous active tasks: &lt;span class=&quot;error&quot;&gt;&amp;#91;1_0, 1_1, 1_3, 1_4, 2_3, 1_5, 1_6, 0_7, 2_5&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;April 25th 2019, 19:30:29.619 2019-04-25 19:30:29,619 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.kafka.streams.processor.internals.StreamThread&amp;#93;&lt;/span&gt; (application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-StreamThread-1) - &lt;span class=&quot;error&quot;&gt;&amp;#91;short-component-name:; transaction-id:; user-id:; creation-time:&amp;#93;&lt;/span&gt; stream-thread &lt;span class=&quot;error&quot;&gt;&amp;#91;application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-StreamThread-1&amp;#93;&lt;/span&gt; partition revocation took 2254 ms.&lt;br/&gt;
 suspended active tasks: &lt;span class=&quot;error&quot;&gt;&amp;#91;1_0, 1_1, 1_3, 1_4, 2_3, 1_5, 1_6, 0_7, 2_5&amp;#93;&lt;/span&gt;&lt;br/&gt;
 suspended standby tasks: []&lt;/p&gt;

&lt;p&gt;April 25th 2019, 19:30:17.158 2019-04-25 19:30:17,158 INFO &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.kafka.streams.processor.internals.StreamThread&amp;#93;&lt;/span&gt; (application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-StreamThread-1) - &lt;span class=&quot;error&quot;&gt;&amp;#91;short-component-name:; transaction-id:; user-id:; creation-time:&amp;#93;&lt;/span&gt; stream-thread &lt;span class=&quot;error&quot;&gt;&amp;#91;application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-StreamThread-1&amp;#93;&lt;/span&gt; partition assignment took 935 ms.&lt;br/&gt;
 current active tasks: &lt;span class=&quot;error&quot;&gt;&amp;#91;0_0, 1_0, 0_1, 1_1, 2_0, 1_2, 0_3, 2_1, 1_3, 2_2, 1_4, 0_5, 2_3, 1_5, 0_6, 1_6, 0_7, 2_5&amp;#93;&lt;/span&gt;&lt;br/&gt;
 current standby tasks: []&lt;br/&gt;
 previous active tasks: &lt;span class=&quot;error&quot;&gt;&amp;#91;0_0, 1_0, 0_1, 1_1, 2_0, 1_2, 0_3, 2_1, 1_3, 2_2, 1_4, 0_5, 2_3, 1_5, 0_6, 1_6, 0_7, 2_5, 1_7, 0_8, 2_6, 1_8, 0_9, 2_7, 1_9, 2_8, 1_10, 0_11, 2_9, 1_11, 2_10, 2_11&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16827025" author="yaojingguo" created="Fri, 26 Apr 2019 14:53:17 +0000"  >&lt;p&gt;We are using&#160;Confluent 5.1.0 which is based on&#160;kafka_2.11-2.1.1.&lt;/p&gt;</comment>
                            <comment id="16827089" author="yuzhihong@gmail.com" created="Fri, 26 Apr 2019 16:08:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mparthas&quot; class=&quot;user-hover&quot; rel=&quot;mparthas&quot;&gt;mparthas&lt;/a&gt;:&lt;br/&gt;
From your comment on Apr 8th, it seems that making the value for &quot;state.cleanup.delay.ms&quot; longer didn&apos;t avoid .checkpoint.tmp disappearing.&lt;/p&gt;

&lt;p&gt;Did you see log similar to the following prior to the error ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
April 25th 2019, 21:03:49.332 2019-04-25 21:03:49,332 INFO [org.apache.kafka.streams.processor.internals.StateDirectory] (application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-CleanupThread) - [&lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt;-component-name:; transaction-id:; user-id:; creation-time:] stream-thread [application-fde85da6-9d2f-4457-8bdb-ea1c78c8c1e2-CleanupThread] Deleting obsolete state directory 1_1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; task 1_1 as 813332ms has elapsed (cleanup delay is 600000ms).
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If so, that might indicate the new value for &quot;state.cleanup.delay.ms&quot; was still short.&lt;br/&gt;
If not, there could be other reason for the problem.&lt;/p&gt;

&lt;p&gt;In case the log has been swapped out, please keep an eye for future occurrences.&lt;/p&gt;</comment>
                            <comment id="16827123" author="yuzhihong@gmail.com" created="Fri, 26 Apr 2019 17:03:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://pastebin.com/vyvQ8pkF&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://pastebin.com/vyvQ8pkF&lt;/a&gt; shows what I mentioned earlier.&lt;/p&gt;

&lt;p&gt;In StateDirectory#cleanRemovedTasks, we use both last modification time of the directory and whether the task has been committed as criteria. When both are satisfied, we clean the directory for the task.&lt;/p&gt;</comment>
                            <comment id="16842015" author="nijo" created="Fri, 17 May 2019 08:58:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; Any updates on this? I have the same issues with Kafka 2.1.1.&lt;/p&gt;</comment>
                            <comment id="16846566" author="the4thamigo_uk" created="Thu, 23 May 2019 09:24:57 +0000"  >&lt;p&gt;I have just seen this error with kafka 2.2.0 and confluent 5.2.1. We are running in docker on kubernetes, and the same container works when run against some topics but not others it seems.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.io.FileNotFoundException: /tmp/kafka-streams/kafka-streams-join-to-nearest-spm-draft-position-weather/0_11/.checkpoint.tmp (No such file or directory)
&#160;&#160; &#160;at java.io.FileOutputStream.open0(Native Method)
&#160;&#160; &#160;at java.io.FileOutputStream.open(FileOutputStream.java:270)
&#160;&#160; &#160;at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:213)
&#160;&#160; &#160;at java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:162)
&#160;&#160; &#160;at org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:79)
&#160;&#160; &#160;at org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:325)
&#160;&#160; &#160;at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:474)
&#160;&#160; &#160;at org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:459)
&#160;&#160; &#160;at org.apache.kafka.streams.processor.internals.AssignedTasks.commit(AssignedTasks.java:286)
&#160;&#160; &#160;at org.apache.kafka.streams.processor.internals.TaskManager.commitAll(TaskManager.java:412)
&#160;&#160; &#160;at org.apache.kafka.streams.processor.internals.StreamThread.maybeCommit(StreamThread.java:1057)
&#160;&#160; &#160;at org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:911)
&#160;&#160; &#160;at org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:805)
&#160;&#160; &#160;at org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:774)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When I `exec` into the running container I see this :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/tmp/kafka-streams/kafka-streams-join-to-nearest-spm-draft-position-weather # ls
2_0&#160;&#160; 2_10&#160; 2_12&#160; 2_14&#160; 2_16&#160; 2_18&#160; 2_2&#160;&#160; 2_4&#160;&#160; 2_6&#160;&#160; 2_8&#160;&#160; 3_0&#160;&#160; 3_10&#160; 3_12&#160; 3_14&#160; 3_16&#160; 3_18&#160; 3_2&#160;&#160; 3_4&#160;&#160; 3_6&#160;&#160; 3_8
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also I see &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

09:55:49,898 INFO org.apache.kafka.streams.processor.internals.StateDirectory - stream-thread [kafka-streams-join-to-nearest-spm-draft-position-weather-404a240b-1e95-4587-80bf-686047658254-CleanupThread] Deleting obsolete state directory 0_1 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; task 0_1 as 600898ms has elapsed (cleanup delay is 600000ms).
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;And I see the following in the StreamsConfig log output :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 state.cleanup.delay.ms = 600000

state.dir = /tmp/kafka-streams

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16846843" author="yuzhihong@gmail.com" created="Thu, 23 May 2019 16:37:22 +0000"  >&lt;p&gt;Can you move state directory outside of /tmp which is subject to cleaning by the OS ?&lt;/p&gt;</comment>
                            <comment id="16852379" author="githubbot" created="Thu, 30 May 2019 21:35:31 +0000"  >&lt;p&gt;bbejeck commented on pull request #6846: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5998&quot; title=&quot;/.checkpoint.tmp Not found exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5998&quot;&gt;&lt;del&gt;KAFKA-5998&lt;/del&gt;&lt;/a&gt;: Create state dir and checkpoint file if it doesn&apos;t exist when checkpointing&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6846&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   There can exist a condition where the state directory for a task gets deleted by the cleanup thread, but the directory is still needed for the given task for checkpointing.  &lt;/p&gt;

&lt;p&gt;   This PR will catch the `FileNotFoundException` and create the required task directory so the checkpoint file can be created.&lt;/p&gt;

&lt;p&gt;   Tests have been updated to validate the task directory and checkpoint file are created when a `FileNotFoundException` is thrown.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16852746" author="pmazzoncini" created="Fri, 31 May 2019 07:27:45 +0000"  >&lt;p&gt;Will this&#160;be included in 2.2.1?&lt;/p&gt;</comment>
                            <comment id="16855662" author="githubbot" created="Tue, 4 Jun 2019 12:48:30 +0000"  >&lt;p&gt;bbejeck commented on pull request #6846: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5998&quot; title=&quot;/.checkpoint.tmp Not found exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5998&quot;&gt;&lt;del&gt;KAFKA-5998&lt;/del&gt;&lt;/a&gt;: Create state dir and checkpoint file if it doesn&apos;t exist when checkpointing&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6846&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16874503" author="pkleindl" created="Thu, 27 Jun 2019 20:48:34 +0000"  >&lt;p&gt;I have started a Thread on Slack to report and discuss some findings:&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://confluentcommunity.slack.com/archives/C48AHTCUQ/p1561668264371300&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://confluentcommunity.slack.com/archives/C48AHTCUQ/p1561668264371300&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16877103" author="vvcephei" created="Tue, 2 Jul 2019 16:07:49 +0000"  >&lt;p&gt;I&apos;ve been talking with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pkleindl&quot; class=&quot;user-hover&quot; rel=&quot;pkleindl&quot;&gt;pkleindl&lt;/a&gt; in the above thread, and I think he figured it out. I&apos;m preparing a bugfix PR.&lt;/p&gt;

&lt;p&gt;It seems that the problem is actually with the way ProcessorStateManager writes the checkpoint file. It dumps out all the restored offsets from the ChangelogReader, but the ChangelogReader is scoped to the thread, not the current task. This would cause each task to erroneously write checkpoint offsets for &lt;em&gt;all&lt;/em&gt; the stores in &lt;em&gt;all&lt;/em&gt; the tasks that happened to be assigned to the same thread.&lt;/p&gt;

&lt;p&gt;This would explain the warning we see, as well as another strange aspect Patrik reported, that the checkpoints in the checkpoint file for a particular task actually contains offsets for stores in other partitions not owned by that task.&lt;/p&gt;

&lt;p&gt;This bug would not actually cause any correctness-impacting bugs, since upon loading the checkpoint file, stores only pay attention to the offsets for stores they own, which would have been written correctly.&lt;/p&gt;

&lt;p&gt;I&apos;m proposing a fix and a new assertion:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the fix is that each task should write only the checkpoint offsets for changelog/partitions that it owns&lt;/li&gt;
	&lt;li&gt;the assertion would check upon loading checkpointableOffsets and also immediately upon writing checkpointableOffsets that the task actually owns the partitions in question. This will prevent checkpoint file corruption in the future, and also help people clear out their corrupted checkpoint files so that they can be rebuild correctly.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16877105" author="githubbot" created="Tue, 2 Jul 2019 16:12:02 +0000"  >&lt;p&gt;vvcephei commented on pull request #7027: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5998&quot; title=&quot;/.checkpoint.tmp Not found exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5998&quot;&gt;&lt;del&gt;KAFKA-5998&lt;/del&gt;&lt;/a&gt;: fix checkpointableOffsets handling&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7027&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7027&lt;/a&gt;&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;each task should write only the checkpoint offsets for changelog/partitions that it owns&lt;/li&gt;
	&lt;li&gt;check upon loading checkpointableOffsets and also immediately upon writing checkpointableOffsets that the task actually owns the partitions in question. This will prevent checkpoint file corruption in the future, and also help people clear out their corrupted checkpoint files so that they can be rebuild correctly.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16877136" author="xmar" created="Tue, 2 Jul 2019 16:47:25 +0000"  >&lt;p&gt;Just in case it helps. I just found it today on 2.1.1 (again, I commented here some months ago). &lt;br/&gt;
 5 brokers cluster, 3 Kafka Streams instances (2 `num.streams.threads` each). AMZN Linux. Docker on ECS.&lt;/p&gt;

&lt;p&gt;I&apos;ve seen that, before the task dies, it prints the following&#160;WARNs from one task.&lt;/p&gt;

&lt;p&gt;Please note that from the 64 partitions, only a few of them fail starting at 13:17. And the same batch of the same partitions start failing again at&#160;13:42. &lt;br/&gt;
 Why are the same partitions failing? Does it match with your findings?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:17:01,101&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_31&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_31/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:17:01,118&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_47&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_47/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:17:01,156&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_27&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_27/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:20:12,360&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_63&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_63/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:20:12,579&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_35&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_35/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:20:13,001&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_23&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_23/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:23:18,421&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_39&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_39/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:23:18,613&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_55&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_55/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:42:46,366&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_31&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_31/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:42:46,473&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_47&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_47/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:42:46,639&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_27&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_27/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:46:19,888&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_63&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_63/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:46:20,042&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_35&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_35/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:46:20,380&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_55&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_55/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:46:20,384&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_23&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_23/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;br/&gt;
 &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2019-07-02 13:48:07,011&amp;#93;&lt;/span&gt; WARN task &lt;span class=&quot;error&quot;&gt;&amp;#91;2_39&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to /data/kafka-streams/stream-processor-0.0.1/2_39/.checkpoint: {} (org.apache.kafka.streams.processor.internals.ProcessorStateManager)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Later, the application died some minutes later, at&#160;13:59:13. In case there is a relation, it was killed due to OOM.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16877988" author="githubbot" created="Wed, 3 Jul 2019 17:01:11 +0000"  >&lt;p&gt;vvcephei commented on pull request #7030: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5998&quot; title=&quot;/.checkpoint.tmp Not found exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5998&quot;&gt;&lt;del&gt;KAFKA-5998&lt;/del&gt;&lt;/a&gt;: fix checkpointableOffsets handling&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7030&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7030&lt;/a&gt;&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;fix checkpoint file warning by filtering checkpointable offsets per task&lt;/li&gt;
	&lt;li&gt;clean up state manager hierarchy to prevent similar bugs&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16878159" author="githubbot" created="Wed, 3 Jul 2019 20:57:51 +0000"  >&lt;p&gt;vvcephei commented on pull request #7027: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5998&quot; title=&quot;/.checkpoint.tmp Not found exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5998&quot;&gt;&lt;del&gt;KAFKA-5998&lt;/del&gt;&lt;/a&gt;: fix checkpointableOffsets handling&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7027&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7027&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16878549" author="pkleindl" created="Thu, 4 Jul 2019 10:55:40 +0000"  >&lt;p&gt;As this is hopefully coming to an end thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vvcephei&quot; class=&quot;user-hover&quot; rel=&quot;vvcephei&quot;&gt;vvcephei&lt;/a&gt;&#160;I&apos;ll try a little writeup so others can compare their setup and hopefully verify that the fix covers all situations.&lt;/p&gt;

&lt;p&gt;I&apos;ll also attach the code I used to reproduce the issue, should be runnable for anyone with docker.&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12973664/12973664_Kafka5998.zip&quot; title=&quot;Kafka5998.zip attached to KAFKA-5998&quot;&gt;Kafka5998.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Setup:&lt;/p&gt;

&lt;p&gt;We have a streams application with two subtopologies where the first one does not have state and the second one does.&lt;/p&gt;

&lt;p&gt;State directories are created for all tasks, but as the first subtopology does not have state it does not get locked internally and is therefor subject to the cleanup process.&lt;/p&gt;

&lt;p&gt;The &quot;trigger&quot; for the cleanup is the absence of any traffic on a topic partition which will allow the directory to be deleted, so this has higher probability on any low-volume topics (in our case, CDC from a reference table with little to no changes).&lt;/p&gt;

&lt;p&gt;After the directory is deleted, the next record received&#160;(and any thereafter) will trigger the warning because Kafka Streams erroneously tries to write a checkpoint because all tasks tried to do this for all restored partitions, not only those assigned to them. This is what Johns PR covers.&lt;/p&gt;

&lt;p&gt;We have EOS disabled, so it would be good if people could tell if this has happened with EOS too.&lt;/p&gt;

&lt;p&gt;Or if this warning has occurred for anyone with a different topology situation or on a high volume topic.&lt;/p&gt;

&lt;p&gt;For reference our topology:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Topologies:
 Sub-topology: 0
 Source: KSTREAM-SOURCE-0000000000 (topics: [inputTopic])
 --&amp;gt; KSTREAM-FILTER-0000000001
 Processor: KSTREAM-FILTER-0000000001 (stores: [])
 --&amp;gt; KSTREAM-KEY-SELECT-0000000002
 &amp;lt;-- KSTREAM-SOURCE-0000000000
 Processor: KSTREAM-KEY-SELECT-0000000002 (stores: [])
 --&amp;gt; KSTREAM-FILTER-0000000005
 &amp;lt;-- KSTREAM-FILTER-0000000001
 Processor: KSTREAM-FILTER-0000000005 (stores: [])
 --&amp;gt; KSTREAM-SINK-0000000004
 &amp;lt;-- KSTREAM-KEY-SELECT-0000000002
 Sink: KSTREAM-SINK-0000000004 (topic: store-repartition)
 &amp;lt;-- KSTREAM-FILTER-0000000005

 Sub-topology: 1
 Source: KSTREAM-SOURCE-0000000006 (topics: [store-repartition])
 --&amp;gt; KSTREAM-REDUCE-0000000003
 Processor: KSTREAM-REDUCE-0000000003 (stores: [store])
 --&amp;gt; KTABLE-TOSTREAM-0000000007
 &amp;lt;-- KSTREAM-SOURCE-0000000006
 Processor: KTABLE-TOSTREAM-0000000007 (stores: [])
 --&amp;gt; KSTREAM-SINK-0000000008
 &amp;lt;-- KSTREAM-REDUCE-0000000003
 Sink: KSTREAM-SINK-0000000008 (topic: outputTopic)
 &amp;lt;-- KTABLE-TOSTREAM-0000000007&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16878674" author="xmar" created="Thu, 4 Jul 2019 13:55:23 +0000"  >&lt;p&gt;My topology contains stateless subtopologies as well as stateful, so it may be that case.&#160;&lt;/p&gt;

&lt;p&gt;One question:&#160;&lt;/p&gt;

&lt;p&gt;&amp;gt; The &quot;trigger&quot; for the cleanup is the absence of any traffic on a topic partition which will allow the directory to be deleted&lt;/p&gt;

&lt;p&gt;&#160;Can you elaborate on this trigger? What will be cleaned in this cleanup process? How long does it wait by default for traffic to determine absence?&lt;/p&gt;</comment>
                            <comment id="16879027" author="pkleindl" created="Fri, 5 Jul 2019 07:09:18 +0000"  >&lt;p&gt;The cleanup is handled by a separate thread and periodically (default 10 minutes) checks the state directory.&lt;/p&gt;

&lt;p&gt;If any directory is not locked by a task and does not show any activity for longer than x minutes (default 10) then the directory is deleted.&lt;/p&gt;

&lt;p&gt;This makes sense when directories are no longer needed because then partitions are now assigned to another instance e.g.&lt;/p&gt;

&lt;p&gt;This should be visible in the logs with messages containing &quot;Deleting obsolete state directory&quot;&lt;/p&gt;</comment>
                            <comment id="16880482" author="xmar" created="Mon, 8 Jul 2019 15:42:32 +0000"  >&lt;p&gt;Thanks Patrik.&lt;br/&gt;
So, if for some reason an application is&#160;stopped&#160;for longer than 10 minutes, does it mean that on restart, this cleaner may clean that previous state, or is this prevented?&lt;/p&gt;

&lt;p&gt;Also - if a task is moved to a partition - is the state copied from the instances where that task was(if there was any), or is it rebuilt reading from the Kafka topics?&lt;/p&gt;</comment>
                            <comment id="16880565" author="pkleindl" created="Mon, 8 Jul 2019 17:30:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xmar&quot; class=&quot;user-hover&quot; rel=&quot;xmar&quot;&gt;xmar&lt;/a&gt; The timer starts running when the streams application is started. I haven&apos;t checked if the startup does modify the problematic directories in some way, although this should only make 10 minutes difference in the cleanup.&lt;/p&gt;

&lt;p&gt;For the second question, it should be rebuilt when the task is switched (or be there when standby tasks are used).&lt;/p&gt;

&lt;p&gt;A workaround might be to increase the cleanup interval to a value higher than your longest inactivity regarding messages, but that might lead to over-usage of disk space.&lt;/p&gt;

&lt;p&gt;Disclaimer: I&apos;m not an expert, please test in your environment.&lt;/p&gt;</comment>
                            <comment id="16883821" author="githubbot" created="Fri, 12 Jul 2019 13:42:19 +0000"  >&lt;p&gt;bbejeck commented on pull request #7030: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5998&quot; title=&quot;/.checkpoint.tmp Not found exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5998&quot;&gt;&lt;del&gt;KAFKA-5998&lt;/del&gt;&lt;/a&gt;: fix checkpointableOffsets handling&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7030&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7030&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16883856" author="bbejeck" created="Fri, 12 Jul 2019 14:26:18 +0000"  >&lt;p&gt;cherry-picked to 2.3 and 2.2&lt;/p&gt;</comment>
                            <comment id="16890932" author="sainath932" created="Tue, 23 Jul 2019 12:07:13 +0000"  >&lt;p&gt;Team/&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bbejeck&quot; class=&quot;user-hover&quot; rel=&quot;bbejeck&quot;&gt;bbejeck&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I took kafka streams 2.3 version but still the issue persists.&lt;/p&gt;

&lt;p&gt;Please suggest if there is any way to suppress this warn log as log files are growing??&#160;&lt;/p&gt;

&lt;p&gt;2019-07-23 11:59:51.260 10.227.254.31&lt;/p&gt;

&lt;p&gt;task &lt;span class=&quot;error&quot;&gt;&amp;#91;0_45&amp;#93;&lt;/span&gt; Failed to write offset checkpoint file to &lt;span class=&quot;error&quot;&gt;&amp;#91;/kafkarest/counting-stream/0_45/.checkpoint&amp;#93;&lt;/span&gt;,exc.stack=java.io.FileNotFoundException: /kafkarest/counting-stream/0_45/.checkpoint.tmp (No such file or directory)\n\tat java.io.FileOutputStream.open0(Native Method)\n\tat java.io.FileOutputStream.open(FileOutputStream.java:270)\n\tat java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:213)\n\tat java.io.FileOutputStream.&amp;lt;init&amp;gt;(FileOutputStream.java:162)\n\tat org.apache.kafka.streams.state.internals.OffsetCheckpoint.write(OffsetCheckpoint.java:79)\n\tat org.apache.kafka.streams.processor.internals.ProcessorStateManager.checkpoint(ProcessorStateManager.java:347)\n\tat org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:476)\n\tat org.apache.kafka.streams.processor.internals.StreamTask.commit(StreamTask.java:461)\n\tat org.apache.kafka.streams.processor.internals.AssignedTasks.commit(AssignedTasks.java:286)\n\tat org.apache.kafka.streams.processor.internals.TaskManager.commitAll(TaskManager.java:412)\n\tat org.apache.kafka.streams.processor.internals.StreamThread.maybeCommit(StreamThread.java:1057)\n\tat org.apache.kafka.streams.processor.internals.StreamThread.runOnce(StreamThread.java:911)\n\tat org.apache.kafka.streams.processor.internals.StreamThread.runLoop(StreamThread.java:805)\n\tat org.apache.kafka.streams.processor.internals.StreamThread.run(StreamThread.java:774)\n&lt;/p&gt;</comment>
                            <comment id="16891187" author="guozhang" created="Tue, 23 Jul 2019 16:26:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sainath932&quot; class=&quot;user-hover&quot; rel=&quot;sainath932&quot;&gt;sainath932&lt;/a&gt; Unfortunately this bug went into post-2.3, as it indicates in fixed versions it will only be available in &lt;tt&gt;2.2.2, 2.4.0, 2.3.1&lt;/tt&gt;. On the other hand, as we have investigated so far this should not cause any correctness issues other than WARN log flooding.&lt;/p&gt;</comment>
                            <comment id="16917669" author="itsharshonly" created="Wed, 28 Aug 2019 10:54:11 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pkleindl&quot; class=&quot;user-hover&quot; rel=&quot;pkleindl&quot;&gt;pkleindl&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vvcephei&quot; class=&quot;user-hover&quot; rel=&quot;vvcephei&quot;&gt;vvcephei&lt;/a&gt;&#160;, I couldn&apos;t locate version 2.3.1 in repo yet. Latest I see is 2.3.0, where the fix for &lt;a href=&quot;https://github.com/apache/kafka/pull/6846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6846&lt;/a&gt;&#160;seems missing. Could you please confirm if 2.3.1 is released yet? Same is the case with 2.2.2 and 2.4.0.&lt;/p&gt;

&lt;p&gt;Also just curious to know, did we figure out the&#160;root cause for base issue of&#160;&lt;tt&gt;FileNotFoundException&lt;/tt&gt;&#160;on checkpoint.write, inspite of having locking mechanism in place to avoid cleanup?&#160; This will help in reproducing the issue on a small scale dev-ish kind of environment, than waiting for few hours of test run.&lt;/p&gt;</comment>
                            <comment id="16918558" author="rskliar" created="Thu, 29 Aug 2019 12:27:06 +0000"  >&lt;p&gt;Hi, guys! Any news about release 2.3.1, 2.4.0, 2.2.2? I can&apos;t find those versions in maven central.&lt;/p&gt;</comment>
                            <comment id="16921204" author="itsharshonly" created="Tue, 3 Sep 2019 06:59:37 +0000"  >&lt;p&gt;Hi, appreciate if timeline for releasing the fixed version for this issue is provided. Thanks.&lt;/p&gt;</comment>
                            <comment id="16921289" author="pkleindl" created="Tue, 3 Sep 2019 09:33:06 +0000"  >&lt;p&gt;Timeline for 2.4 is here&#160;&lt;a href=&quot;https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=125307901&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=125307901&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We are using a version built from the latest 2.2 branch which includes the fix.&lt;/p&gt;

&lt;p&gt;You can check if the (next) Confluent Platform Release based on 2.3 includes the fix.&lt;/p&gt;</comment>
                            <comment id="17207489" author="sandeep.lakdawala@gmail.com" created="Sun, 4 Oct 2020 15:00:16 +0000"  >&lt;p&gt;I still see the issue in my application&lt;/p&gt;

&lt;p&gt;Apache Kafka Streams version-2.5.2&lt;/p&gt;

&lt;p&gt;I am using Spring Cloud Steam with Apache Kafka Binder.&lt;/p&gt;

&lt;p&gt; Running with 3 instances for a topic with 3 partitions.&lt;br/&gt;
I kill the first node and then the other 2 start throwing this exception.&lt;br/&gt;
In my case it is actually affecting my functionality as i do some operation in Stream processor API.&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.reduce((readingTime1, readingTime2) -&amp;gt; Constants.DECIMAL_ROUND_TO_2_DECIMAL_PLACES.apply(readingTime1 + readingTime2))
.toStream()
.process(() -&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LeaderBoardRedisProcessor(redisService));&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;LeaderBoardRedisProcessor never gets called and hence it affects my end state.&lt;/p&gt;</comment>
                            <comment id="17208316" author="ableegoldman" created="Mon, 5 Oct 2020 21:10:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sandeep.lakdawala%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;sandeep.lakdawala@gmail.com&quot;&gt;sandeep.lakdawala@gmail.com&lt;/a&gt; are you running all three instances on the same machine with a shared state directory? And/or using /tmp as the state directory?&lt;/p&gt;</comment>
                            <comment id="17208688" author="sandeep.lakdawala@gmail.com" created="Tue, 6 Oct 2020 12:16:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ableegoldman&quot; class=&quot;user-hover&quot; rel=&quot;ableegoldman&quot;&gt;ableegoldman&lt;/a&gt; , Yes I was trying out in my local machine. The tmp/ directory is the default configuration.&lt;br/&gt;
For Production this will be deployed in separate docker containers.&lt;/p&gt;



&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17209006" author="ableegoldman" created="Tue, 6 Oct 2020 17:55:31 +0000"  >&lt;p&gt;Yeah I think both of those (running with shared state directory and using /tmp) can each lead to this exception. For testing on your local machine you should just configure each of the instances to use a different state dir (preferably something other than /tmp, but that is up to you). See &lt;a href=&quot;https://kafka.apache.org/26/documentation/streams/developer-guide/config-streams.html#state-dir&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the docs&lt;/a&gt; for this config:&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13245072">KAFKA-8671</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13151161">KAFKA-6767</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12889867" name="5998.v1.txt" size="1544" author="yuzhihong@gmail.com" created="Sat, 30 Sep 2017 22:18:33 +0000"/>
                            <attachment id="12889887" name="5998.v2.txt" size="5226" author="yuzhihong@gmail.com" created="Sun, 1 Oct 2017 15:28:25 +0000"/>
                            <attachment id="12973664" name="Kafka5998.zip" size="21797" author="pkleindl" created="Thu, 4 Jul 2019 10:56:28 +0000"/>
                            <attachment id="12936777" name="Topology.txt" size="1014" author="ayushi0430" created="Thu, 23 Aug 2018 06:40:07 +0000"/>
                            <attachment id="12937029" name="exc.txt" size="2534" author="ayushi0430" created="Fri, 24 Aug 2018 16:27:34 +0000"/>
                            <attachment id="12936779" name="props.txt" size="1666" author="ayushi0430" created="Thu, 23 Aug 2018 06:40:08 +0000"/>
                            <attachment id="12936778" name="streams.txt" size="2942" author="ayushi0430" created="Thu, 23 Aug 2018 06:40:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3kqu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>