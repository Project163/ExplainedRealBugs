<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:37:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-16051] Deadlock on connector initialization</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-16051</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Tested with Kafka 3.6.1 and 2.6.3.&lt;/p&gt;

&lt;p&gt;The only plugin installed is confluentinc-kafka-connect-jdbc-10.7.4.&lt;/p&gt;

&lt;p&gt;Stack trace for Kafka 3.6.1:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Found one Java-level deadlock:
=============================
&quot;pool-3-thread-1&quot;:
&#160; waiting to lock monitor 0x00007fbc88006300 (object 0x0000000091002aa0, a org.apache.kafka.connect.runtime.standalone.StandaloneHerder),
&#160; which is held by &quot;Thread-9&quot;
&quot;Thread-9&quot;:
&#160; waiting to lock monitor 0x00007fbc88008800 (object 0x000000009101ccd8, a org.apache.kafka.connect.storage.MemoryConfigBackingStore),
&#160; which is held by &quot;pool-3-thread-1&quot;Java stack information for the threads listed above:
===================================================
&quot;pool-3-thread-1&quot;:
&#160; &#160; at org.apache.kafka.connect.runtime.standalone.StandaloneHerder$ConfigUpdateListener.onTaskConfigUpdate(StandaloneHerder.java:516)
&#160; &#160; - waiting to lock &amp;lt;0x0000000091002aa0&amp;gt; (a org.apache.kafka.connect.runtime.standalone.StandaloneHerder)
&#160; &#160; at org.apache.kafka.connect.storage.MemoryConfigBackingStore.putTaskConfigs(MemoryConfigBackingStore.java:137)
&#160; &#160; - locked &amp;lt;0x000000009101ccd8&amp;gt; (a org.apache.kafka.connect.storage.MemoryConfigBackingStore)
&#160; &#160; at org.apache.kafka.connect.runtime.standalone.StandaloneHerder.updateConnectorTasks(StandaloneHerder.java:483)
&#160; &#160; at org.apache.kafka.connect.runtime.standalone.StandaloneHerder.lambda$null$2(StandaloneHerder.java:229)
&#160; &#160; at org.apache.kafka.connect.runtime.standalone.StandaloneHerder$$Lambda$692/0x0000000840557440.run(Unknown Source)
&#160; &#160; at java.util.concurrent.Executors$RunnableAdapter.call(java.base@11.0.21/Executors.java:515)
&#160; &#160; at java.util.concurrent.FutureTask.run(java.base@11.0.21/FutureTask.java:264)
&#160; &#160; at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(java.base@11.0.21/ScheduledThreadPoolExecutor.java:304)
&#160; &#160; at java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@11.0.21/ThreadPoolExecutor.java:1128)
&#160; &#160; at java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@11.0.21/ThreadPoolExecutor.java:628)
&#160; &#160; at java.lang.Thread.run(java.base@11.0.21/Thread.java:829)
&quot;Thread-9&quot;:
&#160; &#160; at org.apache.kafka.connect.storage.MemoryConfigBackingStore.putTaskConfigs(MemoryConfigBackingStore.java:129)
&#160; &#160; - waiting to lock &amp;lt;0x000000009101ccd8&amp;gt; (a org.apache.kafka.connect.storage.MemoryConfigBackingStore)
&#160; &#160; at org.apache.kafka.connect.runtime.standalone.StandaloneHerder.updateConnectorTasks(StandaloneHerder.java:483)
&#160; &#160; at org.apache.kafka.connect.runtime.standalone.StandaloneHerder.requestTaskReconfiguration(StandaloneHerder.java:255)
&#160; &#160; - locked &amp;lt;0x0000000091002aa0&amp;gt; (a org.apache.kafka.connect.runtime.standalone.StandaloneHerder)
&#160; &#160; at org.apache.kafka.connect.runtime.HerderConnectorContext.requestTaskReconfiguration(HerderConnectorContext.java:50)
&#160; &#160; at org.apache.kafka.connect.runtime.WorkerConnector$WorkerConnectorContext.requestTaskReconfiguration(WorkerConnector.java:548)
&#160; &#160; at io.confluent.connect.jdbc.source.TableMonitorThread.run(TableMonitorThread.java:86)

Found 1 deadlock.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The jdbc source connector is loading tables from the database and updates the configuration once the list is available. The deadlock is very consistent in my environment, probably because the database is on the same machine.&lt;/p&gt;

&lt;p&gt;Maybe it is possible to avoid this situation by always locking the herder first and the config backing store second. From what I see, updateConnectorTasks sometimes is called before locking on herder and other times it is not.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13562944">KAFKA-16051</key>
            <summary>Deadlock on connector initialization</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="developster">Octavian Ciubotaru</assignee>
                                    <reporter username="developster">Octavian Ciubotaru</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Dec 2023 16:34:59 +0000</created>
                <updated>Fri, 12 Jan 2024 23:46:46 +0000</updated>
                            <resolved>Fri, 12 Jan 2024 23:46:46 +0000</resolved>
                                    <version>2.6.3</version>
                    <version>3.6.1</version>
                                    <fixVersion>3.8.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17800522" author="gharris1727" created="Tue, 26 Dec 2023 16:48:46 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=developster&quot; class=&quot;user-hover&quot; rel=&quot;developster&quot;&gt;developster&lt;/a&gt; Thanks for the report! that certainly looks like a deadlock that the standalone implementation should avoid. If you are interested, please assign this ticket to yourself and tag me to review your PR!&lt;/p&gt;

&lt;p&gt;If you&apos;re just looking for a workaround, I would suggest using the distributed mode. It shouldn&apos;t have the same deadlock you&apos;re seeing, and is more similar to typical production environments.&lt;/p&gt;</comment>
                            <comment id="17800814" author="developster" created="Wed, 27 Dec 2023 15:31:17 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gharris1727&quot; class=&quot;user-hover&quot; rel=&quot;gharris1727&quot;&gt;gharris1727&lt;/a&gt; , Thank you for you insights, I for sure still have a lot to learn about the project.&lt;/p&gt;

&lt;p&gt;In meantime I created the PR. The fix is to always lock on herder first and on the config backing store second. Tested in my environment and Kafka Connect starts successfully with the fix applied.&lt;/p&gt;</comment>
                            <comment id="17800815" author="developster" created="Wed, 27 Dec 2023 15:34:20 +0000"  >&lt;p&gt;I do not have the privileges to assign Jira ticket to myself nor assign you as reviewer in the PR on GitHub.&lt;/p&gt;</comment>
                            <comment id="17801909" author="gharris1727" created="Tue, 2 Jan 2024 19:37:17 +0000"  >&lt;p&gt;I added permissions for you on Jira, and assigned the ticket to you.&lt;/p&gt;

&lt;p&gt;It is expected that you don&apos;t have permission to add reviewers directly on github. In the future, you can at-mention reviewers, both other contributors and committers and ask for review, without using the &quot;ask for review&quot; feature on github which requires special permissions.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1mg8w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>