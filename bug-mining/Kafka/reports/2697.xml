<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:24:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9066] Kafka Connect JMX : source &amp; sink task metrics missing for tasks in failed state</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9066</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;h2&gt;&lt;a name=&quot;Overview&quot;&gt;&lt;/a&gt;Overview&lt;/h2&gt;

&lt;p&gt;Kafka Connect exposes various metrics via JMX. Those metrics can be exported i.e. by &lt;em&gt;Prometheus JMX Exporter&lt;/em&gt; for further processing.&lt;br/&gt;
One of crucial attributes is connector&apos;s &lt;b&gt;task status.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;According to official Kafka docs, status is available as &lt;ins&gt;status&lt;/ins&gt; attribute of following MBean:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;kafka.connect:type=connector-task-metrics,connector=&quot;{connector}&quot;,task=&quot;{task}&quot;status - The status of the connector task. One of &apos;unassigned&apos;, &apos;running&apos;, &apos;paused&apos;, &apos;failed&apos;, or &apos;destroyed&apos;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;h2&gt;&lt;a name=&quot;Issue&quot;&gt;&lt;/a&gt;Issue&lt;/h2&gt;

&lt;p&gt;Generally &lt;ins&gt;connector-task-metrics&lt;/ins&gt; are exposed propery for tasks in &lt;ins&gt;running&lt;/ins&gt; status but not exposed at all if task is &lt;ins&gt;failed&lt;/ins&gt;.&lt;/p&gt;

&lt;p&gt;Failed Task &lt;b&gt;appears&lt;/b&gt; properly with failed status when queried via &lt;b&gt;REST API&lt;/b&gt;:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ curl -X GET -u &lt;span class=&quot;code-quote&quot;&gt;&apos;user:pass&apos;&lt;/span&gt; http:&lt;span class=&quot;code-comment&quot;&gt;//kafka-connect.mydomain.com/connectors/customerconnector/status
&lt;/span&gt;
{&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;customerconnector&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;connector&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;RUNNING&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;worker_id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka-connect.mydomain.com:8080&quot;&lt;/span&gt;},&lt;span class=&quot;code-quote&quot;&gt;&quot;tasks&quot;&lt;/span&gt;:[{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;state&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;FAILED&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;worker_id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;kafka-connect.mydomain.com:8080&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;trace&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.kafka.connect.errors.ConnectException: Received DML &apos;DELETE FROM mysql.rds_sysinfo ......&quot;&lt;/span&gt;}],&lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;source&quot;&lt;/span&gt;}
$ &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Failed Task &lt;b&gt;doesn&apos;t appear&lt;/b&gt; as bean with &lt;ins&gt;connector-task-metrics&lt;/ins&gt; type when queried via &lt;b&gt;JMX&lt;/b&gt;:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ echo &lt;span class=&quot;code-quote&quot;&gt;&quot;beans -d kafka.connect&quot;&lt;/span&gt; | java -jar target/jmxterm-1.1.0-SNAPSHOT-uber.jar -l localhost:8081 -n -v silent | grep connector=customerconnector
kafka.connect:connector=customerconnector,task=0,type=task-error-metricskafka.connect:connector=customerconnector,type=connector-metrics
$
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;h2&gt;&lt;a name=&quot;Expectedresult&quot;&gt;&lt;/a&gt;Expected result&lt;/h2&gt;

&lt;p&gt;It is expected, that bean with &lt;ins&gt;connector-task-metrics&lt;/ins&gt; type will appear also for tasks that failed.&lt;br/&gt;
Below is example of how beans are properly registered for tasks in Running state:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ echo &lt;span class=&quot;code-quote&quot;&gt;&quot;get -b kafka.connect:connector=sinkConsentSubscription-1000,task=0,type=connector-task-metrics status&quot;&lt;/span&gt; | java -jar target/jmxterm-1.1.0-SNAPSHOT-ube r.jar -l localhost:8081 -n -v silent
status = running;
$
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13263130">KAFKA-9066</key>
            <summary>Kafka Connect JMX : source &amp; sink task metrics missing for tasks in failed state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ChrisEgerton">Chris Egerton</assignee>
                                    <reporter username="mikouaj">Miko&#322;aj Stefaniak</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Oct 2019 14:43:11 +0000</created>
                <updated>Wed, 12 Aug 2020 22:43:14 +0000</updated>
                            <resolved>Thu, 11 Jun 2020 04:36:34 +0000</resolved>
                                    <version>2.1.1</version>
                                    <fixVersion>2.4.2</fixVersion>
                    <fixVersion>2.5.2</fixVersion>
                    <fixVersion>2.6.0</fixVersion>
                    <fixVersion>2.7.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>6</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="17044186" author="seruman" created="Tue, 25 Feb 2020 07:28:54 +0000"  >&lt;p&gt;We&apos;re also experiencing this with version 2.3.0.&lt;/p&gt;</comment>
                            <comment id="17044624" author="strigona" created="Tue, 25 Feb 2020 16:23:50 +0000"  >&lt;p&gt;We&apos;re also experiencing this.&lt;/p&gt;</comment>
                            <comment id="17061693" author="javierholguera" created="Wed, 18 Mar 2020 12:52:27 +0000"  >&lt;p&gt;Dealing with this problem as well. Seems to be related to the fact that the task is &quot;gone&quot; when it goes into Failed state. Not only &quot;status&quot;, but all the other metrics associated with the task are gone.&lt;/p&gt;</comment>
                            <comment id="17085237" author="githubbot" created="Thu, 16 Apr 2020 20:25:34 +0000"  >&lt;p&gt;C0urante commented on pull request #8502: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9066&quot; title=&quot;Kafka Connect JMX : source &amp;amp; sink task metrics missing for tasks in failed state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9066&quot;&gt;&lt;del&gt;KAFKA-9066&lt;/del&gt;&lt;/a&gt;: Retain metrics for failed tasks&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/8502&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8502&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Right now, sink and source task JMX metrics are dropped as soon as the task fails. The changes here cause these metrics to be retained even if the task fails, and instead only be removed when the task has been shut down or abandoned during shut down by the worker.&lt;/p&gt;

&lt;p&gt;   Existing unit tests are modified to account for this tweak in the worker logic.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17132909" author="rhauch" created="Thu, 11 Jun 2020 04:36:34 +0000"  >&lt;p&gt;Merged to `trunk`, and backported to `2.6` (for upcoming 2.6.0). I&apos;ll file a separate issue to backport this to `2.5` (since we&apos;re in-progress on releasing 2.5.1) and `2.4`.&lt;/p&gt;</comment>
                            <comment id="17168272" author="rhauch" created="Thu, 30 Jul 2020 22:46:49 +0000"  >&lt;p&gt;Also merged &lt;a href=&quot;https://github.com/apache/kafka/pull/9106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/9106&lt;/a&gt; to the 2.4 branch and updated the FIX VERSIONS above.&lt;/p&gt;

&lt;p&gt;The 2.5 branch is still blocked for the in-progress 2.5.1 release, and once that branch is unfrozen we can merge &lt;a href=&quot;https://github.com/apache/kafka/pull/8854&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8854&lt;/a&gt; and add `2.5.2` to the fix version.&lt;/p&gt;</comment>
                            <comment id="17176636" author="rhauch" created="Wed, 12 Aug 2020 22:43:14 +0000"  >&lt;p&gt;Merged &lt;a href=&quot;https://github.com/apache/kafka/pull/8854&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/8854&lt;/a&gt; to the 2.5 branch (see &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-10146&quot; title=&quot;Backport KAFKA-9066 to 2.5 and 2.4 branches&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-10146&quot;&gt;&lt;del&gt;KAFKA-10146&lt;/del&gt;&lt;/a&gt;) and updated the FIX VERSIONS above.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13310810">KAFKA-10146</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07qjc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rhauch</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>