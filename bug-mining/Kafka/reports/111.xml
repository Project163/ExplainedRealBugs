<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:35:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-510] broker needs to know the replication factor per partition</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-510</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;A broker needs to know the replication factor to report under replicated partitions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607396">KAFKA-510</key>
            <summary>broker needs to know the replication factor per partition</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yeyangever">Yang Ye</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                            <label>bugs</label>
                    </labels>
                <created>Thu, 13 Sep 2012 04:30:26 +0000</created>
                <updated>Thu, 11 Oct 2012 23:12:18 +0000</updated>
                            <resolved>Wed, 10 Oct 2012 16:27:09 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="13461910" author="junrao" created="Mon, 24 Sep 2012 16:56:08 +0000"  >&lt;p&gt;Also, if replication factor is 1, we can immediately answer a produce request, without putting it into purgatory first.&lt;/p&gt;</comment>
                            <comment id="13468203" author="yeyangever" created="Tue, 2 Oct 2012 23:59:30 +0000"  >

&lt;p&gt;1. Added the filed &quot;replication factor&quot; in LeaderAndISR, and all related places&lt;/p&gt;

&lt;p&gt;2. directly send leaderAndIsrResponse without the purgatory when all partition in the request has replication factor one. &lt;/p&gt;</comment>
                            <comment id="13468863" author="jjkoshy" created="Wed, 3 Oct 2012 21:32:23 +0000"  >&lt;p&gt;Thanks for patch v1. I have a few comments:&lt;/p&gt;

&lt;p&gt;1 - Condition in KafkaApis.handleProducerRequest should be made clear. I think&lt;br/&gt;
  this would be clearer to understand:&lt;br/&gt;
  (! produceRequest.data.keySet.exists(m =&amp;gt; replicaManager.replicationFactorForPartitions.get(m.topic, m.partition) &amp;gt; 1))&lt;br/&gt;
2 - Also, can you remove the info log that you added in handleProducerRequest.&lt;br/&gt;
3 - Revert the test/resources/log4j change.&lt;br/&gt;
4 - Partition.scala.isUnderReplicated should use this change to report&lt;br/&gt;
  under-replicated partitions correctly.&lt;/p&gt;</comment>
                            <comment id="13469052" author="yeyangever" created="Thu, 4 Oct 2012 01:12:53 +0000"  >
&lt;p&gt;Joel, &lt;/p&gt;

&lt;p&gt;Thanks for comment, new patch uploaded&lt;/p&gt;</comment>
                            <comment id="13469950" author="jjkoshy" created="Fri, 5 Oct 2012 01:28:40 +0000"  >&lt;p&gt;Looks good - one minor change I forgot to mention is to use the TopicAndPartition case class instead of a (String, Int) tuple for the pool you added. We still have many such tuples scattered all over the code, but I think going forward we should avoid doing so.&lt;/p&gt;</comment>
                            <comment id="13469957" author="yeyangever" created="Fri, 5 Oct 2012 01:40:01 +0000"  >
&lt;p&gt;Joel,&lt;/p&gt;

&lt;p&gt;Thanks for comment, this part is changes in patch v3, potentially some other places also need be changed...&lt;/p&gt;</comment>
                            <comment id="13470437" author="junrao" created="Fri, 5 Oct 2012 16:35:04 +0000"  >&lt;p&gt;Thanks for the patch. A few more comments:&lt;/p&gt;

&lt;p&gt;30. KafkaApis: The following code can be made clearer if we use  leaderAndISRRequest.leaderAndISRInfos.foreach{ case&lt;br/&gt;
    leaderAndISRRequest.leaderAndISRInfos.foreach(&lt;br/&gt;
    &lt;/p&gt;
{
      m =&amp;gt; replicaManager.replicationFactorForPartitions.put(TopicAndPartition(m._1._1, m._1._2), m._2.replicationFactor)
    }
&lt;p&gt;)&lt;/p&gt;

&lt;p&gt;31. ReplicaManager: Instead of putting the replication factor in ReplicaManager, it&apos;s more natural to put it in Partition directly. We need to make sure that we can provide the replication factor when a Partition is created. A partition should really only be created when processing a makeLeader or makeFollower request (in both cases we the the replication factor). There are 2 other places that we call getOrCreatePartition. However, both can be changed to a getPartition method instead. The first place is in ReplicaManager.recordFollowerPosition. We can change it so that if a partition is none, we skip the call to updateLeaderHWAndMaybeExpandISR and log a warning. The second place is in DelayedProduce.isSatisfied(). We can also change it so that if a partition is none, we simply set the errorCode to UnknownTopicOrPartition. Finally, we can add a utility method in ReplicaManager to be used in KafkaApi to check the replication factor of one or more partitions.&lt;/p&gt;

&lt;p&gt;32. LeaderAndIsr: The value of the leaderAndIsr path in ZK doesn&apos;t need to include replication factor. We could add a method toZKString in LeaderAndIsr to get the value that we want to write to ZK.&lt;/p&gt;
</comment>
                            <comment id="13470889" author="yeyangever" created="Sat, 6 Oct 2012 03:06:33 +0000"  >
&lt;p&gt;I still use toString() instead of toZkString() in leaderAndISR, because I find we do have code recovering leaderAndISR from zookeeper, including the replication factor:  ZkUtils.getLeaderForPartition() &lt;/p&gt;

&lt;p&gt;Although we can still get rid of it, which means a lot of code, not good encapsulation. I prefer not.&lt;/p&gt;


&lt;p&gt;The rest of comments for v3 are addressed.&lt;/p&gt;</comment>
                            <comment id="13471862" author="yeyangever" created="Mon, 8 Oct 2012 21:05:37 +0000"  >&lt;p&gt;&lt;br/&gt;
Rebase from Jay&apos;s patch&lt;/p&gt;</comment>
                            <comment id="13472145" author="junrao" created="Tue, 9 Oct 2012 05:24:54 +0000"  >&lt;p&gt;Patch doesn&apos;t seem to apply to 0.8.&lt;/p&gt;

&lt;p&gt;The text leading up to this was:&lt;br/&gt;
--------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Index: core/src/test/scala/unit/kafka/network/RpcDataSerializationTest.scala&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;===================================================================&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;#8212; core/src/test/scala/unit/kafka/network/RpcDataSerializationTest.scala	(revision 1394906)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;+++ core/src/test/scala/unit/kafka/network/RpcDataSerializationTest.scala	(working copy)&lt;br/&gt;
--------------------------&lt;br/&gt;
File to patch:&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
</comment>
                            <comment id="13472621" author="yeyangever" created="Tue, 9 Oct 2012 18:41:58 +0000"  >&lt;p&gt;&lt;br/&gt;
Seems some issue with rebase. try this patch please&lt;/p&gt;</comment>
                            <comment id="13472911" author="yeyangever" created="Wed, 10 Oct 2012 01:00:51 +0000"  >&lt;p&gt;&lt;br/&gt;
Adding the PartitionInfo to wrap the leaderAndIsr and  replication factor&lt;/p&gt;</comment>
                            <comment id="13473342" author="junrao" created="Wed, 10 Oct 2012 16:27:09 +0000"  >&lt;p&gt;Thanks for patch v7. Committed to 0.8 with the following minor refactoring.&lt;/p&gt;

&lt;p&gt;ControllerBrokerRequestBatch.sendRequestsToBrokers() : leaderAndIsr is renamed to partitionInfo.&lt;/p&gt;</comment>
                            <comment id="13473350" author="nehanarkhede" created="Wed, 10 Oct 2012 16:40:03 +0000"  >&lt;p&gt;Thanks for patch v7, here are few review comments -&lt;/p&gt;

&lt;p&gt;1. ControllerChannelManager&lt;br/&gt;
Probably better to change partitionInfo to partitionState.&lt;/p&gt;

&lt;p&gt;2. KafkaApis&lt;br/&gt;
2.1. Wrap the line that computes the partitions with replication factor 1&lt;br/&gt;
2.2. Rename allPartitionHasReplicationFactorOne to allPartitionsHaveReplicationFactorOne&lt;br/&gt;
2.3. Change the if(partitionOpt.isDefined) to case match.&lt;/p&gt;

&lt;p&gt;3. LeaderAndIsrRequest&lt;br/&gt;
3.1 Add a space between closing parenthesis and opening bracket for case class definition of LeaderAndIsr&lt;br/&gt;
3.2 Rename partitionInfos to partitionState&lt;br/&gt;
3.3 Rename PartitionInfo to PartitionState&lt;/p&gt;

&lt;p&gt;4. ReplicaManager&lt;br/&gt;
4.1 Remove unused import&lt;br/&gt;
4.2 Change if(partitionOpt.isDefined) to case match&lt;br/&gt;
4.3 Why is the following check required in the absence of a feature that allows us to change the replication factor of a partition -&lt;br/&gt;
    if(partition.replicationFactor != replicationFactor)&lt;br/&gt;
      partition.replicationFactor = replicationFactor&lt;br/&gt;
4.4 Rename partitionInfos to partitionState&lt;/p&gt;

&lt;p&gt;5. ReplicaStateMachine&lt;br/&gt;
5.1 Wrap the long lines&lt;/p&gt;</comment>
                            <comment id="13473369" author="nehanarkhede" created="Wed, 10 Oct 2012 17:04:25 +0000"  >&lt;p&gt;I can&apos;t seem to be able to reopen this JIRA.&lt;br/&gt;
Jun, &lt;br/&gt;
can you help re-opening the JIRA until the above comments are addressed or justified ?&lt;/p&gt;</comment>
                            <comment id="13473373" author="junrao" created="Wed, 10 Oct 2012 17:09:31 +0000"  >&lt;p&gt;Unfortunately, the jira module that we use is no-reopen on close. We can either just submit new patches on this jira or open a followup jira to track it.&lt;/p&gt;</comment>
                            <comment id="13473376" author="nehanarkhede" created="Wed, 10 Oct 2012 17:14:42 +0000"  >&lt;p&gt;This JIRA would have been much easier to work on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-42&quot; title=&quot;Support rebalancing the partitions with replication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-42&quot;&gt;&lt;del&gt;KAFKA-42&lt;/del&gt;&lt;/a&gt; since the latter makes some important changes throughout the controller&apos;s state machine. Rebasing &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-42&quot; title=&quot;Support rebalancing the partitions with replication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-42&quot;&gt;&lt;del&gt;KAFKA-42&lt;/del&gt;&lt;/a&gt; over this is turning out to be a pain&lt;/p&gt;</comment>
                            <comment id="13473724" author="yeyangever" created="Thu, 11 Oct 2012 00:09:23 +0000"  >&lt;p&gt;&lt;br/&gt;
rebase from kafka 42 and apply Neha&apos;s advices&lt;/p&gt;</comment>
                            <comment id="13473746" author="nehanarkhede" created="Thu, 11 Oct 2012 00:49:02 +0000"  >&lt;p&gt;1. ControllerChannelManager&lt;br/&gt;
Wrap the long line&lt;/p&gt;

&lt;p&gt;2. KafkaApis&lt;br/&gt;
Wrap the long lines&lt;/p&gt;

&lt;p&gt;3. LeaderAndIsrRequest&lt;br/&gt;
PartitionInfo is too general, mind changing it to PartitionStateInfo ?&lt;/p&gt;

&lt;p&gt;4. PartitionStateMachine&lt;br/&gt;
4.1 Let&apos;s not change the NOTE back to TODO&lt;br/&gt;
4.2 Wrap the long lines&lt;/p&gt;

&lt;p&gt;5. ReplicaManager&lt;br/&gt;
5.1 Wrap the long lines and please remember to do this carefully in each patch&lt;br/&gt;
5.2 Move the comment in getReplicationFactorForPartition to the API description section of that method&lt;br/&gt;
5.3 Still have the same question 4.3 from previous review&lt;br/&gt;
5.4 Change &quot;In recording follower position&quot; to &quot;While recording the follower position&quot;&lt;/p&gt;

&lt;p&gt;6. ReplicaStateMachine&lt;br/&gt;
Wrap the long lines&lt;/p&gt;</comment>
                            <comment id="13473843" author="yeyangever" created="Thu, 11 Oct 2012 04:59:06 +0000"  >&lt;p&gt;thanks for the comments. The new one is ready and will be submitted tmr.&lt;/p&gt;</comment>
                            <comment id="13474447" author="yeyangever" created="Thu, 11 Oct 2012 19:16:05 +0000"  >&lt;p&gt;&lt;br/&gt;
Thanks for comments and they&apos;re addressed in patch v9&lt;/p&gt;</comment>
                            <comment id="13474608" author="nehanarkhede" created="Thu, 11 Oct 2012 23:12:18 +0000"  >&lt;p&gt;+1. Only 4.1 was not addressed, but I&apos;ll take care of it during checkin.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12547468" name="kafka_510_v1.diff" size="13221" author="yeyangever" created="Tue, 2 Oct 2012 23:59:30 +0000"/>
                            <attachment id="12547651" name="kafka_510_v2.diff" size="12880" author="yeyangever" created="Thu, 4 Oct 2012 01:12:53 +0000"/>
                            <attachment id="12547866" name="kafka_510_v3.diff" size="13881" author="yeyangever" created="Fri, 5 Oct 2012 01:40:01 +0000"/>
                            <attachment id="12548094" name="kafka_510_v4.diff" size="22829" author="yeyangever" created="Sat, 6 Oct 2012 03:06:33 +0000"/>
                            <attachment id="12548298" name="kafka_510_v5.diff" size="23984" author="yeyangever" created="Mon, 8 Oct 2012 21:05:37 +0000"/>
                            <attachment id="12548438" name="kafka_510_v6.diff" size="23102" author="yeyangever" created="Tue, 9 Oct 2012 18:41:58 +0000"/>
                            <attachment id="12548503" name="kafka_510_v7.diff" size="30440" author="yeyangever" created="Wed, 10 Oct 2012 01:00:51 +0000"/>
                            <attachment id="12548675" name="kafka_510_v8.diff" size="32422" author="yeyangever" created="Thu, 11 Oct 2012 00:09:23 +0000"/>
                            <attachment id="12548792" name="kafka_510_v9.diff" size="32913" author="yeyangever" created="Thu, 11 Oct 2012 19:16:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>240629</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0140v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4421</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>