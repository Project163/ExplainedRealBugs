<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:02:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5608] System test failure due to timeout starting Jmx tool</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5608</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Began seeing this in some failing system tests:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[INFO  - 2017-07-18 14:25:55,375 - background_thread - _protected_worker - lineno:39]: Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/services/background_thread.py&quot;&lt;/span&gt;, line 35, in _protected_worker
    self._worker(idx, node)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/tests/kafkatest/services/console_consumer.py&quot;&lt;/span&gt;, line 261, in _worker
    self.start_jmx_tool(idx, node)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/tests/kafkatest/services/monitor/jmx.py&quot;&lt;/span&gt;, line 73, in start_jmx_tool
    wait_until(lambda: self._jmx_has_output(node), timeout_sec=10, backoff_sec=.5, err_msg=&lt;span class=&quot;code-quote&quot;&gt;&quot;%s: Jmx tool took too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; to start&quot;&lt;/span&gt; % node.account)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/utils/util.py&quot;&lt;/span&gt;, line 36, in wait_until
    raise TimeoutError(err_msg)
TimeoutError: ubuntu@worker7: Jmx tool took too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; to start
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is immediately followed by a consumer timeout in the failing cases:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[INFO  - 2017-07-18 14:26:46,907 - runner_client - log - lineno:221]: RunnerClient: kafkatest.tests.core.security_rolling_upgrade_test.TestSecurityRollingUpgrade.test_rolling_upgrade_phase_two.broker_protocol=SASL_SSL.client_protocol=SASL_SSL: FAIL: Consumer failed to consume messages &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 60s.
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/tests/runner_client.py&quot;&lt;/span&gt;, line 123, in run
    data = self.run_test()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/tests/runner_client.py&quot;&lt;/span&gt;, line 176, in run_test
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.test_context.function(self.test)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/mark/_mark.py&quot;&lt;/span&gt;, line 321, in wrapper
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; functools.partial(f, *args, **kwargs)(*w_args, **w_kwargs)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/tests/kafkatest/tests/core/security_rolling_upgrade_test.py&quot;&lt;/span&gt;, line 148, in test_rolling_upgrade_phase_two
    self.run_produce_consume_validate(self.roll_in_secured_settings, client_protocol, broker_protocol)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/tests/kafkatest/tests/produce_consume_validate.py&quot;&lt;/span&gt;, line 106, in run_produce_consume_validate
    self.start_producer_and_consumer()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/tests/kafkatest/tests/produce_consume_validate.py&quot;&lt;/span&gt;, line 79, in start_producer_and_consumer
    self.consumer_start_timeout_sec)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/utils/util.py&quot;&lt;/span&gt;, line 36, in wait_until
    raise TimeoutError(err_msg)
TimeoutError: Consumer failed to consume messages &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 60s.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There does not appear to be anything wrong with the consumer in the logs, so the timeout seems to be caused by the Jmx tool timeout.&lt;/p&gt;

&lt;p&gt;Possibly due to &lt;a href=&quot;https://github.com/apache/kafka/pull/3447/files?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3447/files?&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13088071">KAFKA-5608</key>
            <summary>System test failure due to timeout starting Jmx tool</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ewencp">Ewen Cheslack-Postava</assignee>
                                    <reporter username="hachikuji">Jason Gustafson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Jul 2017 21:15:57 +0000</created>
                <updated>Fri, 21 Jul 2017 12:44:10 +0000</updated>
                            <resolved>Thu, 20 Jul 2017 04:40:15 +0000</resolved>
                                                    <fixVersion>0.11.0.1</fixVersion>
                    <fixVersion>1.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16092286" author="ewencp" created="Tue, 18 Jul 2017 22:46:25 +0000"  >&lt;p&gt;It looks like the JmxTool really did take too long to generate output:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO  - 2017-07-18 14:25:44,820 - kafka - bootstrap_servers - lineno:549&amp;#93;&lt;/span&gt;: Bootstrap client port is: 9095&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:44,820 - console_consumer - _worker - lineno:255&amp;#93;&lt;/span&gt;: Console consumer 1 command: export JMX_PORT=9192; export LOG_DIR=/mnt/console_consumer/logs; export KAFKA_LOG4J_OPTS=&quot;-Dlog4j.configuration=&lt;a href=&quot;file:/mnt/console_consumer/tools-log4j.properties&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/mnt/console_consumer/tools-log4j.properties&lt;/a&gt;&quot;; export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/mnt/security/jaas.conf -Djava.security.krb5.conf=/mnt/security/krb5.conf&quot;; /opt/kafka-dev/bin/kafka&lt;br/&gt;
-console-consumer.sh --topic test_topic --consumer.config /mnt/console_consumer/console_consumer.properties --bootstrap-server worker11:9095,worker8:9095,worker4:9095 --isolation-level read_uncommitted --from-beginning --timeout-ms 60000 --formatter kafka.tools.LoggingMessageFormatter 2&amp;gt;&amp;gt; /mnt/console_consumer/console_consumer.stderr | tee -a /mnt/console_consumer/console_consumer.stdout &amp;amp;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:44,820 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: export JMX_PORT=9192; export LOG_DIR=/mnt/console_consumer/logs; export KAFKA_LOG4J_OPTS=&quot;-Dlog4j.configuration=&lt;a href=&quot;file:/mnt/console_consumer/tools-log4j.properties&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/mnt/console_consumer/tools-log4j.properties&lt;/a&gt;&quot;; export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/mnt/security/jaas.conf -Djava.security.krb5.conf=/mnt/security/krb5.conf&quot;; /opt/kafka-dev/bin/ka&lt;br/&gt;
fka-console-consumer.sh --topic test_topic --consumer.config /mnt/console_consumer/console_consumer.properties --bootstrap-server worker11:9095,worker8:9095,worker4:9095 --isolation-level read_uncommitted --from-beginning --timeout-ms 60000 --formatter kafka.tools.LoggingMessageFormatter 2&amp;gt;&amp;gt; /mnt/console_consumer/console_consumer.stderr | tee -a /mnt/console_consumer/console_consumer.stdout &amp;amp;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:44,823 - console_consumer - _worker - lineno:260&amp;#93;&lt;/span&gt;: collecting following jmx objects: &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;kafka.consumer:type=consumer-coordinator-metrics,client-id=console-consumer&amp;#39;&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:44,823 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: nc -z 127.0.0.1 9192&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:44,929 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: nc -z 127.0.0.1 9192&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:45,035 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: nc -z 127.0.0.1 9192&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:45,141 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: nc -z 127.0.0.1 9192&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:45,148 - jmx - start_jmx_tool - lineno:71&amp;#93;&lt;/span&gt;: ubuntu@worker7: Start JmxTool 1 command: /opt/kafka-dev/bin/kafka-run-class.sh kafka.tools.JmxTool --reporting-interval 1000 --jmx-url service:jmx:rmi:///jndi/rmi://127.0.0.1:9192/jmxrmi --object-name kafka.consumer:type=consumer-coordinator-metrics,client-id=console-consumer --attributes assigned-partitions 1&amp;gt;&amp;gt; /mnt/jmx_tool.log 2&amp;gt;&amp;gt; /mnt/jmx_tool.err.log &amp;amp;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:45,148 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: /opt/kafka-dev/bin/kafka-run-class.sh kafka.tools.JmxTool --reporting-interval 1000 --jmx-url service:jmx:rmi:///jndi/rmi://127.0.0.1:9192/jmxrmi --object-name kafka.consumer:type=consumer-coordinator-metrics,client-id=console-consumer --attributes assigned-partitions 1&amp;gt;&amp;gt; /mnt/jmx_tool.log 2&amp;gt;&amp;gt; /mnt/jmx_tool.err.log &amp;amp;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:45,210 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker10: Running ssh command: mkdir -p /mnt/security&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:45,215 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker10: Running ssh command: java -version&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:45,216 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO  - 2017-07-18 14:25:45,356 - verifiable_producer - _worker - lineno:131&amp;#93;&lt;/span&gt;: verifiable_producer.properties:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO  - 2017-07-18 14:25:45,356 - verifiable_producer - _worker - lineno:132&amp;#93;&lt;/span&gt;:&lt;br/&gt;
ssl.endpoint.identification.algorithm=HTTPS&lt;br/&gt;
sasl.kerberos.service.name=kafka&lt;br/&gt;
security.protocol=SASL_SSL&lt;br/&gt;
ssl.keystore.location=/mnt/security/test.keystore.jks&lt;br/&gt;
ssl.truststore.location=/mnt/security/test.truststore.jks&lt;br/&gt;
ssl.keystore.password=test-ks-passwd&lt;br/&gt;
sasl.mechanism=GSSAPI&lt;br/&gt;
ssl.truststore.password=test-ts-passwd&lt;br/&gt;
ssl.key.password=test-key-passwd&lt;br/&gt;
sasl.mechanism.inter.broker.protocol=GSSAPI&lt;/p&gt;

&lt;p&gt;request.timeout.ms=30000&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:45,359 - kafka_path - path - lineno:92&amp;#93;&lt;/span&gt;: Using path resolver KafkaSystemTestPathResolver&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO  - 2017-07-18 14:25:45,359 - kafka - bootstrap_servers - lineno:549&amp;#93;&lt;/span&gt;: Bootstrap client port is: 9095&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:45,359 - verifiable_producer - _worker - lineno:136&amp;#93;&lt;/span&gt;: VerifiableProducer 1 command: export LOG_DIR=/mnt/verifiable_producer/logs; export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/mnt/security/jaas.conf -Djava.security.krb5.conf=/mnt/security/krb5.conf&quot;; export KAFKA_LOG4J_OPTS=&quot;-Dlog4j.configuration=&lt;a href=&quot;file:/mnt/verifiable_producer/tools-log4j.properties&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/mnt/verifiable_producer/tools-log4j.properties&lt;/a&gt;&quot;; /opt/kafka-dev/bin/kafka-run-class.sh org.apache.kafka.tools.VerifiableProducer --topic test_topic --broker-list worker11:9095,worker8:9095,worker4:9095 --throughput 100 --producer.config /mnt/verifiable_producer/verifiable_producer.properties 2&amp;gt;&amp;gt; /mnt/verifiable_producer/verifiable_producer.stdout | tee -a /mnt/verifiable_producer/verifiable_producer.stdout &amp;amp;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:45,359 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker10: Running ssh command: export LOG_DIR=/mnt/verifiable_producer/logs; export KAFKA_OPTS=&quot;-Djava.security.auth.login.config=/mnt/security/jaas.conf -Djava.security.krb5.conf=/mnt/security/krb5.conf&quot;; export KAFKA_LOG4J_OPTS=&quot;-Dlog4j.configuration=&lt;a href=&quot;file:/mnt/verifiable_producer/tools-log4j.properties&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/mnt/verifiable_producer/tools-log4j.properties&lt;/a&gt;&quot;; /opt/kafka-dev/bin/kafka-run-class.sh org.apache.kafka.tools.VerifiableProducer --topic test_topic --broker-list worker11:9095,worker8:9095,worker4:9095 --throughput 100 --producer.config /mnt/verifiable_producer/verifiable_producer.properties 2&amp;gt;&amp;gt; /mnt/verifiable_producer/verifiable_producer.stdout | tee -a /mnt/verifiable_producer/verifiable_producer.stdout &amp;amp;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:45,761 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:46,267 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:46,773 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:47,279 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:47,785 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:48,291 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:48,797 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:49,303 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:49,808 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:50,314 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:50,821 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:51,327 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:51,833 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:52,339 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:52,844 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:53,350 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:53,856 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:54,362 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG - 2017-07-18 14:25:54,868 - remoteaccount - _log - lineno:158&amp;#93;&lt;/span&gt;: ubuntu@worker7: Running ssh command: test -z &quot;$(cat /mnt/jmx_tool.log)&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO  - 2017-07-18 14:25:55,374 - background_thread - _protected_worker - lineno:38&amp;#93;&lt;/span&gt;: BackgroundThreadService threw exception:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO  - 2017-07-18 14:25:55,375 - background_thread - _protected_worker - lineno:39&amp;#93;&lt;/span&gt;: Traceback (most recent call last):&lt;br/&gt;
  File &quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/services/background_thread.py&quot;, line 35, in _protected_worker&lt;br/&gt;
    self._worker(idx, node)&lt;br/&gt;
  File &quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/tests/kafkatest/services/console_consumer.py&quot;, line 261, in _worker&lt;br/&gt;
    self.start_jmx_tool(idx, node)&lt;br/&gt;
  File &quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/tests/kafkatest/services/monitor/jmx.py&quot;, line 73, in start_jmx_tool&lt;br/&gt;
    wait_until(lambda: self._jmx_has_output(node), timeout_sec=10, backoff_sec=.5, err_msg=&quot;%s: Jmx tool took too long to start&quot; % node.account)&lt;br/&gt;
  File &quot;/home/jenkins/workspace/system-test-kafka-0.11.0/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/utils/util.py&quot;, line 36, in wait_until&lt;br/&gt;
    raise TimeoutError(err_msg)&lt;br/&gt;
TimeoutError: ubuntu@worker7: Jmx tool took too long to start&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You can see the calls to nc initially, then checking for the availability of the JMX port. There&apos;s some other output unrelated because the jmx stuff is happening in a background thread. Then you can see it start checking for the log file, but it never seems to show up.&lt;/p&gt;

&lt;p&gt;In this case there are logs for jmx (whereas I&apos;ve seen some other tests where there aren&apos;t):&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;$ cat jmx_tool.err.log&lt;br/&gt;
Trying to connect to JMX url: service:jmx:rmi:///jndi/rmi://127.0.0.1:9192/jmxrmi.&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;
&lt;p&gt;$ cat jmx_tool.log&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So no output was generated, but it did at least log itself trying to connect.&lt;/p&gt;

&lt;p&gt;And unlike some cases I&apos;ve seen before where the timeouts were a problem, the range of timestamps in the consumer log seems to overlap plenty with the tests for the log file:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2017-07-18 14:25:45,514&amp;#93;&lt;/span&gt; INFO ConsumerConfig values:&lt;br/&gt;
        auto.commit.interval.ms = 5000&lt;br/&gt;
...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2017-07-18 14:26:46,963&amp;#93;&lt;/span&gt; TRACE Completed receive from node 2147483645 for LEAVE_GROUP with correlation id 5854, received &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {throttle_time_ms=0,error_code=0}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; (org.apache.kafka.clients.NetworkClient)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2017-07-18 14:26:46,963&amp;#93;&lt;/span&gt; DEBUG LeaveGroup request for group group returned successfully (org.apache.kafka.clients.consumer.internals.AbstractCoordinator)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Unfortunately, we can&apos;t tell about JmxTool itself because it doesn&apos;t log any timestamp information.&lt;/p&gt;</comment>
                            <comment id="16092414" author="ewencp" created="Wed, 19 Jul 2017 00:42:18 +0000"  >&lt;p&gt;Further adding to the confusion, I&apos;ve found a test ConnectMysqlTest.test_query_modes.query_mode=table.incremental_mode=timestamp which has this in the jmx_tool.err.log:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Trying to connect to JMX url: service:jmx:rmi:///jndi/rmi://127.0.0.1:9192/jmxrmi.&lt;br/&gt;
Trying to connect to JMX url: service:jmx:rmi:///jndi/rmi://127.0.0.1:9192/jmxrmi.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But based on the code &lt;a href=&quot;https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/tools/JmxTool.scala#L98-L110&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/trunk/core/src/main/scala/kafka/tools/JmxTool.scala#L98-L110&lt;/a&gt; it doesn&apos;t seem that it should be possible to see that message twice without also seeing an error message...&lt;/p&gt;</comment>
                            <comment id="16092467" author="ewencp" created="Wed, 19 Jul 2017 01:52:36 +0000"  >&lt;p&gt;Another interesting point by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; is that all the tests that fail with this error seem to use SASL.&lt;/p&gt;</comment>
                            <comment id="16092497" author="hachikuji" created="Wed, 19 Jul 2017 02:51:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt; I think there is a race condition when starting up the jmx tool at the same time as the console consumer. If the metrics haven&apos;t been registered at initialization time, we may end up querying for nothing. We should probably modify the tool to wait until at least one expected name has been found before beginning polling. I did a quick dirty fix locally and it seemed to work. Does that sound plausible?&lt;/p&gt;</comment>
                            <comment id="16092578" author="githubbot" created="Wed, 19 Jul 2017 05:03:13 +0000"  >&lt;p&gt;GitHub user ewencp opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3547&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3547&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5608&quot; title=&quot;System test failure due to timeout starting Jmx tool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5608&quot;&gt;&lt;del&gt;KAFKA-5608&lt;/del&gt;&lt;/a&gt;: Add --wait option for JmxTool and use in system tests to avoid race between JmxTool and monitored services&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ewencp/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ewencp/kafka&lt;/a&gt; wait-jmx-metrics&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3547.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3547.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3547&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b33306053eda3ece107965b0db6111f36cc3232e&lt;br/&gt;
Author: Ewen Cheslack-Postava &amp;lt;me@ewencp.org&amp;gt;&lt;br/&gt;
Date:   2017-07-19T04:31:23Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5608&quot; title=&quot;System test failure due to timeout starting Jmx tool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5608&quot;&gt;&lt;del&gt;KAFKA-5608&lt;/del&gt;&lt;/a&gt;: Add --wait option for JmxTool and use in system tests to avoid race between JmxTool and monitored services&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16094163" author="ewencp" created="Thu, 20 Jul 2017 04:40:15 +0000"  >&lt;p&gt;Issue resolved by pull request 3547&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/3547&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3547&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16094164" author="githubbot" created="Thu, 20 Jul 2017 04:41:13 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3547&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3547&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16094188" author="ewencp" created="Thu, 20 Jul 2017 05:17:57 +0000"  >&lt;p&gt;For anyone following up, there was quite a bit more conversation on the PR itself: &lt;a href=&quot;https://github.com/apache/kafka/pull/3547&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3547&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16094541" author="githubbot" created="Thu, 20 Jul 2017 11:15:20 +0000"  >&lt;p&gt;GitHub user ijuma opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3553&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3553&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5608&quot; title=&quot;System test failure due to timeout starting Jmx tool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5608&quot;&gt;&lt;del&gt;KAFKA-5608&lt;/del&gt;&lt;/a&gt;: Follow-up to fix potential NPE and clarify method name&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ijuma/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ijuma/kafka&lt;/a&gt; kafka-5608-follow-up&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3553.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3553.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3553&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7f43b0f23402c7018532f92aac438929bc83ca68&lt;br/&gt;
Author: Ismael Juma &amp;lt;ismael@juma.me.uk&amp;gt;&lt;br/&gt;
Date:   2017-07-20T11:09:02Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5608&quot; title=&quot;System test failure due to timeout starting Jmx tool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5608&quot;&gt;&lt;del&gt;KAFKA-5608&lt;/del&gt;&lt;/a&gt;: Follow-up to fix potential NPE and clarify method name&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16096194" author="githubbot" created="Fri, 21 Jul 2017 12:44:10 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3553&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3553&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 17 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3hok7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>