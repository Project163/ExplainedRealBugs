<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:00:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4689] OffsetValidationTest fails validation with &quot;Current position greater than the total number of consumed records&quot;</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4689</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;blockquote&gt;
&lt;p&gt;====================================================================================================&lt;br/&gt;
test_id:    kafkatest.tests.client.consumer_test.OffsetValidationTest.test_consumer_bounce.clean_shutdown=False.bounce_mode=all&lt;br/&gt;
status:     FAIL&lt;br/&gt;
run time:   1 minute 49.834 seconds&lt;/p&gt;


&lt;p&gt;    Current position greater than the total number of consumed records&lt;br/&gt;
Traceback (most recent call last):&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/tests/runner_client.py&quot;, line 123, in run&lt;br/&gt;
    data = self.run_test()&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/tests/runner_client.py&quot;, line 176, in run_test&lt;br/&gt;
    return self.test_context.function(self.test)&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/mark/_mark.py&quot;, line 321, in wrapper&lt;br/&gt;
    return functools.partial(f, *args, **kwargs)(*w_args, **w_kwargs)&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka/kafka/tests/kafkatest/tests/client/consumer_test.py&quot;, line 157, in test_consumer_bounce&lt;br/&gt;
    &quot;Current position greater than the total number of consumed records&quot;&lt;br/&gt;
AssertionError: Current position greater than the total number of consumed records&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;See also &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3513?focusedCommentId=15791790&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15791790&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-3513?focusedCommentId=15791790&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15791790&lt;/a&gt; which is another instance of this bug, which indicates the issue goes back at least as far as 1/17/2017. Note that I don&apos;t think we&apos;ve seen this in 0.10.1 yet.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13037195">KAFKA-4689</key>
            <summary>OffsetValidationTest fails validation with &quot;Current position greater than the total number of consumed records&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hachikuji">Jason Gustafson</assignee>
                                    <reporter username="ewencp">Ewen Cheslack-Postava</reporter>
                        <labels>
                            <label>system-test-failure</label>
                    </labels>
                <created>Mon, 23 Jan 2017 22:22:08 +0000</created>
                <updated>Wed, 10 May 2017 14:00:13 +0000</updated>
                            <resolved>Thu, 30 Mar 2017 22:52:52 +0000</resolved>
                                                    <fixVersion>0.10.2.1</fixVersion>
                    <fixVersion>0.11.0.0</fixVersion>
                                    <component>clients</component>
                    <component>consumer</component>
                    <component>system tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15835572" author="hachikuji" created="Tue, 24 Jan 2017 03:05:00 +0000"  >&lt;p&gt;Not sure yet, but we think this could be caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4673&quot; title=&quot;Python VerifiableConsumer service has thread-safety bug for event_handlers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4673&quot;&gt;&lt;del&gt;KAFKA-4673&lt;/del&gt;&lt;/a&gt;. I looked at the test data and could not find any gaps in the data delivered to the consumer.&lt;/p&gt;</comment>
                            <comment id="15844219" author="ewencp" created="Sat, 28 Jan 2017 22:58:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; Any further thoughts on this since 4673 was resolved but we still saw a failure in the nightlies?&lt;/p&gt;</comment>
                            <comment id="15844221" author="ewencp" created="Sat, 28 Jan 2017 23:01:24 +0000"  >&lt;p&gt;Actually, the error message in the latest version looks different:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;====================================================================================================&lt;br/&gt;
test_id:    kafkatest.tests.client.consumer_test.OffsetValidationTest.test_broker_failure.clean_shutdown=True.enable_autocommit=False&lt;br/&gt;
status:     FAIL&lt;br/&gt;
run time:   1 minute 17.051 seconds&lt;/p&gt;


&lt;p&gt;    Timed out waiting for consumption&lt;br/&gt;
Traceback (most recent call last):&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/tests/runner_client.py&quot;, line 123, in run&lt;br/&gt;
    data = self.run_test()&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/tests/runner_client.py&quot;, line 176, in run_test&lt;br/&gt;
    return self.test_context.function(self.test)&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/mark/_mark.py&quot;, line 321, in wrapper&lt;br/&gt;
    return functools.partial(f, *args, **kwargs)(*w_args, **w_kwargs)&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/tests/kafkatest/tests/client/consumer_test.py&quot;, line 221, in test_broker_failure&lt;br/&gt;
    self.await_consumed_messages(consumer, min_messages=1000)&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/tests/kafkatest/tests/verifiable_consumer_test.py&quot;, line 74, in await_consumed_messages&lt;br/&gt;
    err_msg=&quot;Timed out waiting for consumption&quot;)&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/utils/util.py&quot;, line 36, in wait_until&lt;br/&gt;
    raise TimeoutError(err_msg)&lt;br/&gt;
TimeoutError: Timed out waiting for consumption&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So maybe the only failure remaining is actually a case of &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3513&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-3513&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15845079" author="ijuma" created="Mon, 30 Jan 2017 11:28:22 +0000"  >&lt;p&gt;0.10.1, which includes &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4673&quot; title=&quot;Python VerifiableConsumer service has thread-safety bug for event_handlers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4673&quot;&gt;&lt;del&gt;KAFKA-4673&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4547&quot; title=&quot;Consumer.position returns incorrect results for Kafka 0.10.1.0 client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4547&quot;&gt;&lt;del&gt;KAFKA-4547&lt;/del&gt;&lt;/a&gt; failed with a slightly different message:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;test_id:    2017-01-28--001.kafkatest.tests.client.consumer_test.OffsetValidationTest.test_broker_rolling_bounce
status:     FAIL
run time:   3 minutes 48.362 seconds


    Total consumed records did not match consumed position
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/jenkins/workspace/system-test-kafka-0.10.1/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.5.3-py2.7.egg/ducktape/tests/runner.py&quot;&lt;/span&gt;, line 106, in run_all_tests
    data = self.run_single_test()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/jenkins/workspace/system-test-kafka-0.10.1/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.5.3-py2.7.egg/ducktape/tests/runner.py&quot;&lt;/span&gt;, line 162, in run_single_test
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.current_test_context.function(self.current_test)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/lib/jenkins/workspace/system-test-kafka-0.10.1/kafka/tests/kafkatest/tests/client/consumer_test.py&quot;&lt;/span&gt;, line 113, in test_broker_rolling_bounce
    &lt;span class=&quot;code-quote&quot;&gt;&quot;Total consumed records did not match consumed position&quot;&lt;/span&gt;
AssertionError: Total consumed records did not match consumed position
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15846015" author="hachikuji" created="Mon, 30 Jan 2017 21:58:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt; I&apos;ve looked into the two instances of the &quot;Timed out waiting for consumption&quot; test failures from the past week: one on 0.10.2, and one on (trunk) &lt;a href=&quot;http://testing.confluent.io/confluent-kafka-system-test-results/?prefix=2017-01-25--001.1485335861--apache--trunk--abe19fe/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://testing.confluent.io/confluent-kafka-system-test-results/?prefix=2017-01-25--001.1485335861--apache--trunk--abe19fe/&lt;/a&gt;. In both of these cases, the problem appears to be on the producer side. Before the timeout occurs, I see a long delay during which the consumer continues fetching, but during which the high watermark never advances. Unfortunately there are few logs from the producer to tell what is going on, but one possibility is that we&apos;re hitting the request timeout, which is 30s by default. This corresponds closely with the duration of the delay. The consumer times out after 20s of inactivity, so we probably just need to make these two timeouts consistent. I&apos;ll submit a patch, but it doesn&apos;t seem worth blocking the release for it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt; Can you link me to the test results for that failure?&lt;/p&gt;</comment>
                            <comment id="15846023" author="ijuma" created="Mon, 30 Jan 2017 22:08:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt;, &lt;a href=&quot;https://jenkins.confluent.io/job/system-test-kafka-0.10.1/138/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.confluent.io/job/system-test-kafka-0.10.1/138/console&lt;/a&gt; and &lt;a href=&quot;http://confluent-kafka-0-10-1-system-test-results.s3-us-west-2.amazonaws.com/2017-01-28--001.1485603818--apache--0.10.1--6ba7470/report.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://confluent-kafka-0-10-1-system-test-results.s3-us-west-2.amazonaws.com/2017-01-28--001.1485603818--apache--0.10.1--6ba7470/report.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15846284" author="ewencp" created="Tue, 31 Jan 2017 01:59:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; I kicked off &lt;a href=&quot;https://jenkins.confluent.io/job/system-test-kafka-branch-builder/693/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jenkins.confluent.io/job/system-test-kafka-branch-builder/693/console&lt;/a&gt; to try to test this repeatedly for failure with --repeat 10 to see if the original failure would repeat. Didn&apos;t reproduce, so hard to say why we may be seeing this more frequently in the nightlies.&lt;/p&gt;

&lt;p&gt;Shall we remove this as a blocker for 0.10.2.0? Not ideal to have a transiently failing test, but it sounds like it&apos;s partly the test just being flaky, not necessarily incorrectness.&lt;/p&gt;</comment>
                            <comment id="15846454" author="hachikuji" created="Tue, 31 Jan 2017 06:44:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ewencp&quot; class=&quot;user-hover&quot; rel=&quot;ewencp&quot;&gt;ewencp&lt;/a&gt; Yes, let&apos;s remove it from the blockers. The test case Ismael linked to from 0.10.1 is a little more troubling (there is an unexplained pause during shutdown of one of the consumers), but until we know more, I don&apos;t think it should block the release. I&apos;ll continue investigating.&lt;/p&gt;</comment>
                            <comment id="15848602" author="hachikuji" created="Wed, 1 Feb 2017 16:43:30 +0000"  >&lt;p&gt;Note I created &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4719&quot; title=&quot;Timed out waiting for consumption in OffsetValidationTest.test_broker_failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4719&quot;&gt;&lt;del&gt;KAFKA-4719&lt;/del&gt;&lt;/a&gt; for the Timeout error we have seen a couple times. I think this is just a case of timeout adjustment.&lt;/p&gt;</comment>
                            <comment id="15850342" author="apurva" created="Thu, 2 Feb 2017 19:07:39 +0000"  >&lt;p&gt;This happened again in the system test run of 02/02/2017:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
[INFO  - 2017-02-02 04:58:49,171 - runner_client - log - lineno:221]: RunnerClient: kafkatest.tests.client.consumer_test.OffsetValidationTest.test_consumer_bounce.clean_shutdown=False.bounce_mode=rolling: Summary: Current position greater than the total number of consumed records
Traceback (most recent call last):
  File &quot;/var/lib/jenkins/workspace/system-test-kafka/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/tests/runner_client.py&quot;, line 123, in run
    data = self.run_test()
  File &quot;/var/lib/jenkins/workspace/system-test-kafka/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/tests/runner_client.py&quot;, line 176, in run_test
    return self.test_context.function(self.test)
  File &quot;/var/lib/jenkins/workspace/system-test-kafka/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/mark/_mark.py&quot;, line 321, in wrapper
    return functools.partial(f, *args, **kwargs)(*w_args, **w_kwargs)
  File &quot;/var/lib/jenkins/workspace/system-test-kafka/kafka/tests/kafkatest/tests/client/consumer_test.py&quot;, line 158, in test_consumer_bounce
    &quot;Current position greater than the total number of consumed records&quot;
AssertionError: Current position greater than the total number of consumed records

[INFO  - 2017-02-02 04:58:49,172 - runner_client - log - lineno:221]: RunnerClient: kafkatest.tests.client.consumer_test.OffsetValidationTest.test_consumer_bounce.clean_shutdown=False.bounce_mode=rolling: Data: None
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Logs for this run are at &lt;a href=&quot;http://confluent-kafka-system-test-results.s3-us-west-2.amazonaws.com/2017-02-02--001.1486027182--apache--trunk--3d9f34d/OffsetValidationTest/test_consumer_bounce/clean_shutdown=False.bounce_mode=rolling/46.tgz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://confluent-kafka-system-test-results.s3-us-west-2.amazonaws.com/2017-02-02--001.1486027182--apache--trunk--3d9f34d/OffsetValidationTest/test_consumer_bounce/clean_shutdown=False.bounce_mode=rolling/46.tgz&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15903934" author="apurva" created="Thu, 9 Mar 2017 22:04:20 +0000"  >&lt;p&gt;This happened again last night. Logs are at: &lt;a href=&quot;http://confluent-kafka-0-10-2-system-test-results.s3-us-west-2.amazonaws.com/2017-03-09--001.1489054973--apache--0.10.2--a05c541/OffsetValidationTest/test_consumer_bounce/clean_shutdown=False.bounce_mode=rolling/49.tgz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://confluent-kafka-0-10-2-system-test-results.s3-us-west-2.amazonaws.com/2017-03-09--001.1489054973--apache--0.10.2--a05c541/OffsetValidationTest/test_consumer_bounce/clean_shutdown=False.bounce_mode=rolling/49.tgz&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Current position 80172 greater than the total number of consumed records 80169
Traceback (most recent call last):
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/tests/runner_client.py&quot;, line 123, in run
    data = self.run_test()
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/tests/runner_client.py&quot;, line 176, in run_test
    return self.test_context.function(self.test)
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/mark/_mark.py&quot;, line 321, in wrapper
    return functools.partial(f, *args, **kwargs)(*w_args, **w_kwargs)
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/tests/kafkatest/tests/client/consumer_test.py&quot;, line 159, in test_consumer_bounce
    (consumer.current_position(partition), consumer.total_consumed())
AssertionError: Current position 80172 greater than the total number of consumed records 80169
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15945543" author="theduderog" created="Tue, 28 Mar 2017 16:54:33 +0000"  >&lt;p&gt;Happened again. Logs here &lt;a href=&quot;http://confluent-kafka-0-10-2-system-test-results.s3-us-west-2.amazonaws.com/2017-03-28--001.1490697484--apache--0.10.2--1e4cab7/OffsetValidationTest/test_consumer_bounce/clean_shutdown%3DFalse.bounce_mode%3Drolling/49.tgz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://confluent-kafka-0-10-2-system-test-results.s3-us-west-2.amazonaws.com/2017-03-28--001.1490697484--apache--0.10.2--1e4cab7/OffsetValidationTest/test_consumer_bounce/clean_shutdown%3DFalse.bounce_mode%3Drolling/49.tgz&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;pre&amp;gt;&lt;br/&gt;
test_id:    kafkatest.tests.client.consumer_test.OffsetValidationTest.test_consumer_bounce.clean_shutdown=False.bounce_mode=rolling&lt;br/&gt;
status:     FAIL&lt;br/&gt;
run time:   3 minutes 32.756 seconds&lt;/p&gt;


&lt;p&gt;    Current position 79302 greater than the total number of consumed records 79299&lt;br/&gt;
Traceback (most recent call last):&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/tests/runner_client.py&quot;, line 123, in run&lt;br/&gt;
    data = self.run_test()&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/tests/runner_client.py&quot;, line 176, in run_test&lt;br/&gt;
    return self.test_context.function(self.test)&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/venv/local/lib/python2.7/site-packages/ducktape-0.6.0-py2.7.egg/ducktape/mark/_mark.py&quot;, line 321, in wrapper&lt;br/&gt;
    return functools.partial(f, *args, **kwargs)(*w_args, **w_kwargs)&lt;br/&gt;
  File &quot;/var/lib/jenkins/workspace/system-test-kafka-0.10.2/kafka/tests/kafkatest/tests/client/consumer_test.py&quot;, line 159, in test_consumer_bounce&lt;br/&gt;
    (consumer.current_position(partition), consumer.total_consumed())&lt;br/&gt;
AssertionError: Current position 79302 greater than the total number of consumed records 79299&lt;br/&gt;
&amp;lt;/pre&amp;gt;&lt;/p&gt;</comment>
                            <comment id="15949526" author="hachikuji" created="Thu, 30 Mar 2017 18:13:10 +0000"  >&lt;p&gt;I think I finally see what is happening here. I looked at this test case: &lt;a href=&quot;http://confluent-systest.s3-website-us-west-2.amazonaws.com/confluent-kafka-0-10-2-system-test-results/?prefix=2017-03-30--001.1490888066--apache--0.10.2--2397269/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://confluent-systest.s3-website-us-west-2.amazonaws.com/confluent-kafka-0-10-2-system-test-results/?prefix=2017-03-30--001.1490888066--apache--0.10.2--2397269/&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Here is the assertion error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;AssertionError: Current position 30897 greater than the total number of consumed records 30892
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We are missing 5 records apparently. Looking in the test logs, I found this warning:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[WARNING - 2017-03-30 11:01:19,615 - verifiable_consumer - _update_global_position - lineno:222]: Expected next consumed offset of 20037 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; partition TopicPartition(topic=u&lt;span class=&quot;code-quote&quot;&gt;&apos;test_topic&apos;&lt;/span&gt;, partition=0), but instead saw 20042
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This suggests a gap in the consumed data. However, in the event output, we see clearly that these offsets were consumed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;{&lt;span class=&quot;code-quote&quot;&gt;&quot;timestamp&quot;&lt;/span&gt;:1490871669110,&lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;:5,&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;records_consumed&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;partitions&quot;&lt;/span&gt;:[{&lt;span class=&quot;code-quote&quot;&gt;&quot;topic&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test_topic&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;partition&quot;&lt;/span&gt;:0,&lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;:5,&lt;span class=&quot;code-quote&quot;&gt;&quot;minOffset&quot;&lt;/span&gt;:20037,&lt;span class=&quot;code-quote&quot;&gt;&quot;maxOffset&quot;&lt;/span&gt;:20041}]}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And from the consumer log, we can see the offset is committed, though we do not see the offset commit in the event output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[2017-03-30 11:01:09,110] TRACE Sending OffsetCommit request with {test_topic-0=OffsetAndMetadata{offset=20042, metadata=&apos;&apos;}} to coordinator worker9:9092 (id: 2147483646 rack: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; group test_group_id (org.apache.kafka.clients.consumer.internals.ConsumerCoordinator)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can conclude that both the &quot;records_consumed&quot; event and the &quot;offsets_committed&quot; event were not delivered to the test framework prior to the hard failure. In general, it seems difficult to write reliable hard failure test cases which depends on event output from the process experiencing the hard failure. There is always a delay between the occurrence of the event and its emission and delivery. We probably need to weaken the test assertions to deal with the possibility of having missed events, but it&apos;s possible that the test is longer be useful if we do so. For the time being, I think we should disable the hard failure scenarios.&lt;/p&gt;</comment>
                            <comment id="15949532" author="githubbot" created="Thu, 30 Mar 2017 18:19:12 +0000"  >&lt;p&gt;GitHub user hachikuji opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2771&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2771&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4689&quot; title=&quot;OffsetValidationTest fails validation with &amp;quot;Current position greater than the total number of consumed records&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4689&quot;&gt;&lt;del&gt;KAFKA-4689&lt;/del&gt;&lt;/a&gt;: Disable system tests for consumer hard failures&lt;/p&gt;

&lt;p&gt;    See the JIRA for the full details. Essentially the test assertions depend on receiving reliable events from the consumer processes, but this is not generally possible in the presence of a hard failure (i.e. `kill -9`). Until we solve this problem, the hard failure scenarios will be turned off.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hachikuji/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hachikuji/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4689&quot; title=&quot;OffsetValidationTest fails validation with &amp;quot;Current position greater than the total number of consumed records&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4689&quot;&gt;&lt;del&gt;KAFKA-4689&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2771.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2771.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2771&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 55380bf623f2a5be489818fc5979d77fd7570047&lt;br/&gt;
Author: Jason Gustafson &amp;lt;jason@confluent.io&amp;gt;&lt;br/&gt;
Date:   2017-03-30T18:15:01Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4689&quot; title=&quot;OffsetValidationTest fails validation with &amp;quot;Current position greater than the total number of consumed records&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4689&quot;&gt;&lt;del&gt;KAFKA-4689&lt;/del&gt;&lt;/a&gt;: Disable system tests for consumer hard failures&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15950017" author="ijuma" created="Thu, 30 Mar 2017 22:52:52 +0000"  >&lt;p&gt;Issue resolved by pull request 2771&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/2771&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2771&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15950018" author="githubbot" created="Thu, 30 Mar 2017 22:52:58 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/2771&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/2771&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16004711" author="enothereska" created="Wed, 10 May 2017 13:53:37 +0000"  >&lt;p&gt;This is such a critical test, I understand why it&apos;s hard to guarantee the offsets though. Any chance we could turn it back on when exactly once lands?&lt;/p&gt;</comment>
                            <comment id="16004720" author="ijuma" created="Wed, 10 May 2017 14:00:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enothereska&quot; class=&quot;user-hover&quot; rel=&quot;enothereska&quot;&gt;enothereska&lt;/a&gt;, we filed a new issue for re-enabling. As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hachikuji&quot; class=&quot;user-hover&quot; rel=&quot;hachikuji&quot;&gt;hachikuji&lt;/a&gt; said, the issue is in the test framework, so not sure that exactly once would help.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i393nj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>ewencp</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>