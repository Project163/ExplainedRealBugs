<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:03:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-5704] Auto topic creation causes failure with older clusters</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-5704</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The new automatic internal topic creation always tries to check the topic and create it if missing. However, older brokers that we should still be compatible with don&apos;t support some requests that are used. This results in an UnsupportedVersionException which some of the TopicAdmin code notes that it can throw but then isn&apos;t caught in the initializers, causing the entire process to fail.&lt;/p&gt;

&lt;p&gt;We should probably just catch it, log a message, and allow things to proceed hoping that the user has already created the topics correctly (as we used to do).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13092619">KAFKA-5704</key>
            <summary>Auto topic creation causes failure with older clusters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhauch">Randall Hauch</assignee>
                                    <reporter username="ewencp">Ewen Cheslack-Postava</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Aug 2017 21:54:38 +0000</created>
                <updated>Wed, 9 Aug 2017 03:22:07 +0000</updated>
                            <resolved>Wed, 9 Aug 2017 03:21:11 +0000</resolved>
                                    <version>0.11.0.0</version>
                                    <fixVersion>0.11.0.1</fixVersion>
                    <fixVersion>1.0.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16115063" author="rhauch" created="Fri, 4 Aug 2017 22:51:18 +0000"  >&lt;p&gt;As of Kafka 0.11.0.0, the Kafka Connect distributed worker will automatically create the internal topics (see &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4667&quot; title=&quot;KIP-154: Connect should create internal topics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4667&quot;&gt;&lt;del&gt;KAFKA-4667&lt;/del&gt;&lt;/a&gt;) using the new KafkaAdminClient. However, the KafkaAdminClient will throw an UnsupportedVersionException if the broker version doesn&apos;t support the necessary API (which in this case is the &lt;a href=&quot;https://github.com/apache/kafka/blob/0.10.1/clients/src/main/java/org/apache/kafka/common/protocol/ApiKeys.java#L42&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;CREATE_TOPICS&lt;/tt&gt; API&lt;/a&gt; added in 0.10.1.0). That means contrary to the &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4667?focusedCommentId=15998675&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15998675&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;notes in KAFKA-4667&lt;/a&gt;, Kafka Connect can indeed work with brokers older than 0.10.1.0, will receive the exception in such a case, and will not properly handle the exception.&lt;/p&gt;</comment>
                            <comment id="16115067" author="rhauch" created="Fri, 4 Aug 2017 22:54:06 +0000"  >&lt;p&gt;The fix is straightforward: &lt;a href=&quot;https://github.com/apache/kafka/blob/0.11.0.0/connect/runtime/src/main/java/org/apache/kafka/connect/util/TopicAdmin.java#L235&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this block&lt;/a&gt; should log the appropriate message and return an empty set. Then, the initializer in &lt;a href=&quot;https://github.com/apache/kafka/blob/0.11.0.0/connect/runtime/src/main/java/org/apache/kafka/connect/util/KafkaBasedLog.java#L126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;KafkaBaseLog&lt;/a&gt; will complete by doing nothing, and the producer will get the topic metadata that will result in the broker auto-creating the topic if missing and if so configured.&lt;/p&gt;</comment>
                            <comment id="16117125" author="githubbot" created="Mon, 7 Aug 2017 19:35:16 +0000"  >&lt;p&gt;GitHub user rhauch opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3641&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3641&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5704&quot; title=&quot;Auto topic creation causes failure with older clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5704&quot;&gt;&lt;del&gt;KAFKA-5704&lt;/del&gt;&lt;/a&gt; Corrected Connect distributed startup behavior to allow older brokers to auto-create topics&lt;/p&gt;

&lt;p&gt;    When a Connect distributed worker starts up talking with broker versions 0.10.1.0 and later, it will use the AdminClient to look for the internal topics and attempt to create them if they are missing. Although the AdminClient was added in 0.11.0.0, the AdminClient uses APIs to create topics that existed in 0.10.1.0 and later. This feature works as expected when Connect uses a broker version 0.10.1.0 or later.&lt;/p&gt;

&lt;p&gt;    However, when a Connect distributed worker starts up using a broker older than 0.10.1.0, the AdminClient is not able to find the required APIs and thus will throw an UnsupportedVersionException. Unfortunately, this exception is not caught and instead causes the Connect worker to fail even when the topics already exist.&lt;/p&gt;

&lt;p&gt;    This change handles the UnsupportedVersionException by logging a debug message and doing nothing. The existing producer logic will get information about the topics, which will cause the broker to create them if they don&#8217;t exist and broker auto-creation of topics is enabled. This is the same behavior that existed prior to 0.11.0.0, and so this change restores that behavior for brokers older than 0.10.1.0.&lt;/p&gt;

&lt;p&gt;    This change also adds a system test that verifies Connect works with a variety of brokers and is able to run source and sink connectors. The test verifies that Connect can read from the internal topics when the connectors are restarted.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/rhauch/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rhauch/kafka&lt;/a&gt; kafka-5704&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3641.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3641.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3641&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0d45fd113eeaff3844742181191db2cc508353fd&lt;br/&gt;
Author: Randall Hauch &amp;lt;rhauch@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-08-07T19:32:29Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-5704&quot; title=&quot;Auto topic creation causes failure with older clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-5704&quot;&gt;&lt;del&gt;KAFKA-5704&lt;/del&gt;&lt;/a&gt; Corrected Connect distributed startup behavior to allow older brokers to auto-create topics&lt;/p&gt;

&lt;p&gt;    When a Connect distributed worker starts up talking with broker versions 0.10.1.0 and later, it will use the AdminClient to look for the internal topics and attempt to create them if they are missing. Although the AdminClient was added in 0.11.0.0, the AdminClient uses APIs to create topics that existed in 0.10.1.0 and later. This feature works as expected when Connect uses a broker version 0.10.1.0 or later.&lt;/p&gt;

&lt;p&gt;    However, when a Connect distributed worker starts up using a broker older than 0.10.1.0, the AdminClient is not able to find the required APIs and thus will throw an UnsupportedVersionException. Unfortunately, this exception is not caught and instead causes the Connect worker to fail even when the topics already exist.&lt;/p&gt;

&lt;p&gt;    This change handles the UnsupportedVersionException by logging a debug message and doing nothing. The existing producer logic will get information about the topics, which will cause the broker to create them if they don&#8217;t exist and broker auto-creation of topics is enabled. This is the same behavior that existed prior to 0.11.0.0, and so this change restores that behavior for brokers older than 0.10.1.0.&lt;/p&gt;

&lt;p&gt;    This change also adds a system test that verifies Connect works with a variety of brokers and is able to run source and sink connectors. The test verifies that Connect can read from the internal topics when the connectors are restarted.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16119353" author="ewencp" created="Wed, 9 Aug 2017 03:21:11 +0000"  >&lt;p&gt;Issue resolved by pull request 3641&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/3641&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3641&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16119354" author="githubbot" created="Wed, 9 Aug 2017 03:22:07 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/3641&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/3641&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ig3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>