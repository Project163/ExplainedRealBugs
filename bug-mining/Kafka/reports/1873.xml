<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:08:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6748] Scheduler cannot be cancelled from Punctuator</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6748</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;A Scheduler cannot be cancelled from within the scheduled punctuator, I will post a test case to illustrate the problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13150252">KAFKA-6748</key>
            <summary>Scheduler cannot be cancelled from Punctuator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="frederica">Frederic Arno</assignee>
                                    <reporter username="frederica">Frederic Arno</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Apr 2018 09:45:20 +0000</created>
                <updated>Wed, 25 Apr 2018 09:43:03 +0000</updated>
                            <resolved>Thu, 5 Apr 2018 18:18:08 +0000</resolved>
                                    <version>1.0.1</version>
                    <version>1.1.0</version>
                                    <fixVersion>1.0.2</fixVersion>
                    <fixVersion>1.1.1</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16426704" author="githubbot" created="Thu, 5 Apr 2018 10:13:39 +0000"  >&lt;p&gt;fredfp opened a new pull request #4827: fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6748&quot; title=&quot;Scheduler cannot be cancelled from Punctuator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6748&quot;&gt;&lt;del&gt;KAFKA-6748&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4827&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4827&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   The first commit is a new test, illustrating the problem. The second commit fixes the problem.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16427387" author="githubbot" created="Thu, 5 Apr 2018 18:17:43 +0000"  >&lt;p&gt;guozhangwang closed pull request #4827: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6748&quot; title=&quot;Scheduler cannot be cancelled from Punctuator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6748&quot;&gt;&lt;del&gt;KAFKA-6748&lt;/del&gt;&lt;/a&gt;: double check before scheduling a new task after the punctuate call&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4827&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4827&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/streams/src/main/java/org/apache/kafka/streams/processor/internals/PunctuationQueue.java b/streams/src/main/java/org/apache/kafka/streams/processor/internals/PunctuationQueue.java&lt;br/&gt;
index 80eda6c9dd8..354c602cb3f 100644&lt;br/&gt;
&amp;#8212; a/streams/src/main/java/org/apache/kafka/streams/processor/internals/PunctuationQueue.java&lt;br/&gt;
+++ b/streams/src/main/java/org/apache/kafka/streams/processor/internals/PunctuationQueue.java&lt;br/&gt;
@@ -52,7 +52,10 @@ boolean mayPunctuate(final long timestamp, final PunctuationType type, final Pro&lt;/p&gt;

&lt;p&gt;                 if (!sched.isCancelled()) {&lt;br/&gt;
                     processorNodePunctuator.punctuate(sched.node(), timestamp, type, sched.punctuator());&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;pq.add(sched.next(timestamp));&lt;br/&gt;
+                    // sched can be cancelled from within the punctuator&lt;br/&gt;
+                    if (!sched.isCancelled()) 
{
+                        pq.add(sched.next(timestamp));
+                    }
&lt;p&gt;                     punctuated = true;&lt;br/&gt;
                 }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;diff --git a/streams/src/test/java/org/apache/kafka/streams/processor/internals/PunctuationQueueTest.java b/streams/src/test/java/org/apache/kafka/streams/processor/internals/PunctuationQueueTest.java&lt;br/&gt;
index 09c7a0a3183..e799688c428 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/processor/internals/PunctuationQueueTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/processor/internals/PunctuationQueueTest.java&lt;br/&gt;
@@ -17,6 +17,7 @@&lt;br/&gt;
 package org.apache.kafka.streams.processor.internals;&lt;/p&gt;

&lt;p&gt; import org.apache.kafka.streams.processor.AbstractProcessor;&lt;br/&gt;
+import org.apache.kafka.streams.processor.Cancellable;&lt;br/&gt;
 import org.apache.kafka.streams.processor.ProcessorContext;&lt;br/&gt;
 import org.apache.kafka.streams.processor.PunctuationType;&lt;br/&gt;
 import org.apache.kafka.streams.processor.Punctuator;&lt;br/&gt;
@@ -126,6 +127,42 @@ public void punctuate(ProcessorNode node, long time, PunctuationType type, Punct&lt;br/&gt;
         assertEquals(4, processor.punctuatedAt.size());&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;+    @Test&lt;br/&gt;
+    public void testPunctuationIntervalCancelFromPunctuator() {&lt;br/&gt;
+        final TestProcessor processor = new TestProcessor();&lt;br/&gt;
+        final ProcessorNode&amp;lt;String, String&amp;gt; node = new ProcessorNode&amp;lt;&amp;gt;(&quot;test&quot;, processor, null);&lt;br/&gt;
+        final PunctuationQueue queue = new PunctuationQueue();&lt;br/&gt;
+        final Punctuator punctuator = new Punctuator() {&lt;br/&gt;
+            @Override&lt;br/&gt;
+            public void punctuate(long timestamp) &lt;/p&gt;
{
+                node.processor().punctuate(timestamp);
+            }
&lt;p&gt;+        };&lt;br/&gt;
+&lt;br/&gt;
+        final PunctuationSchedule sched = new PunctuationSchedule(node, 0L, 100L, punctuator);&lt;br/&gt;
+        final long now = sched.timestamp - 100L;&lt;br/&gt;
+&lt;br/&gt;
+        final Cancellable cancellable = queue.schedule(sched);&lt;br/&gt;
+&lt;br/&gt;
+        ProcessorNodePunctuator processorNodePunctuator = new ProcessorNodePunctuator() {&lt;br/&gt;
+            @Override&lt;br/&gt;
+            public void punctuate(ProcessorNode node, long time, PunctuationType type, Punctuator punctuator) &lt;/p&gt;
{
+                punctuator.punctuate(time);
+                // simulate scheduler cancelled from within punctuator
+                cancellable.cancel();
+            }
&lt;p&gt;+        };&lt;br/&gt;
+&lt;br/&gt;
+        queue.mayPunctuate(now, PunctuationType.STREAM_TIME, processorNodePunctuator);&lt;br/&gt;
+        assertEquals(0, processor.punctuatedAt.size());&lt;br/&gt;
+&lt;br/&gt;
+        queue.mayPunctuate(now + 100L, PunctuationType.STREAM_TIME, processorNodePunctuator);&lt;br/&gt;
+        assertEquals(1, processor.punctuatedAt.size());&lt;br/&gt;
+&lt;br/&gt;
+        queue.mayPunctuate(now + 200L, PunctuationType.STREAM_TIME, processorNodePunctuator);&lt;br/&gt;
+        assertEquals(1, processor.punctuatedAt.size());&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
     private static class TestProcessor extends AbstractProcessor&amp;lt;String, String&amp;gt; {&lt;/p&gt;

&lt;p&gt;         public final ArrayList&amp;lt;Long&amp;gt; punctuatedAt = new ArrayList&amp;lt;&amp;gt;();&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3s6f3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>guozhang</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>