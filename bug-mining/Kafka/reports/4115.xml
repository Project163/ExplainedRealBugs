<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:42:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-18281] Kafka (3.9.0) is improperly validating non-advertised listeners for routable controller addresses</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-18281</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Kafka 3.9.0 is currently validating whether all listeners (including non-advertised controller listeners) are routable. Non-advertised controller listeners don&apos;t need to be routable.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Background:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/KIP-853%3A+KRaft+Controller+Membership+Changes&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;KIP-853 (KRaft Controller Membership Changes)&lt;/a&gt; introduced dynamic controller quorums.&lt;/p&gt;

&lt;p&gt;When a cluster is configured with a dynamic controller quorum, KRaft clients request (via a metadata request) the currently-valid set of controller endpoints, which are configured on a per-controller basis via `advertised.listeners` (previously, controller listeners were prohibited in `advertised.listeners`).&lt;/p&gt;

&lt;p&gt;As part of &lt;a href=&quot;https://github.com/confluentinc/ce-kafka/blob/78066ca74e7964bc7f9dfb0f7660814ee91ef149/core/src/main/scala/kafka/server/KafkaConfig.scala#L3445&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this work&lt;/a&gt;, Kafka added two things:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;When a controller listener is not in `advertised.listeners`, the (non-advertised) controller listener from `listeners` is added to `effectiveAdvertisedBrokerListeners`&lt;/li&gt;
	&lt;li&gt;We validate that all effective advertised broker listeners are routable (i.e. not `0.0.0.0`)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is incorrect logic, because the listeners property indicates what IPs a listener binds on, not how clients should connect to the listener (which may be a static configuration that is transparent to the controller)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In 3.8, both of these config combinations are valid:&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Implicit &quot;bind on all IP addresses&quot;&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
controller.quorum.voters=9991@localhost:9094
listeners=BROKER:&lt;span class=&quot;code-comment&quot;&gt;//:9093,CONTROLLER://:9094
&lt;/span&gt;advertised.listeners=BROKER:&lt;span class=&quot;code-comment&quot;&gt;//hostname:9093&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;em&gt;Explicit &quot;bind on all addresses&quot; (specifically, IPv4)&lt;/em&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
controller.quorum.voters=9991@localhost:9094
listeners=BROKER:&lt;span class=&quot;code-comment&quot;&gt;//0.0.0.0:9093,CONTROLLER://0.0.0.0:9094
&lt;/span&gt;advertised.listeners=BROKER:&lt;span class=&quot;code-comment&quot;&gt;//&amp;lt;hostname&amp;gt;:9093&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Formatting a controller with this configuration fails with an error like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
broker | Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.IllegalArgumentException: requirement failed: advertised.listeners cannot use the nonroutable meta-address 0.0.0.0. Use a routable IP address. at scala.Predef$.require(Predef.scala:337) at kafka.server.KafkaConfig.validateValues(KafkaConfig.scala:1022) at kafka.server.KafkaConfig.&amp;lt;init&amp;gt;(KafkaConfig.scala:852) at kafka.server.KafkaConfig.&amp;lt;init&amp;gt;(KafkaConfig.scala:184) at kafka.tools.StorageTool$.$anonfun$execute$1(StorageTool.scala:79) at scala.Option.flatMap(Option.scala:283) at kafka.tools.StorageTool$.execute(StorageTool.scala:79) at kafka.tools.StorageTool$.main(StorageTool.scala:46) at kafka.docker.KafkaDockerWrapper$.main(KafkaDockerWrapper.scala:48) at kafka.docker.KafkaDockerWrapper.main(KafkaDockerWrapper.scala) at java.base@21.0.2/java.lang.invoke.LambdaForm$DMH/sa346b79c.invokeStaticInit(LambdaForm$DMH) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In 3.9.0, the implicit configuration works, but the explicit configuration does not. This is a breaking change because a configuration that previously worked no longer works.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13602368">KAFKA-18281</key>
            <summary>Kafka (3.9.0) is improperly validating non-advertised listeners for routable controller addresses</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yangpoan">PoAn Yang</assignee>
                                    <reporter username="justinrlee">Justin Lee</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Dec 2024 06:19:26 +0000</created>
                <updated>Tue, 25 Mar 2025 08:03:46 +0000</updated>
                            <resolved>Tue, 25 Feb 2025 03:24:10 +0000</resolved>
                                    <version>3.9.0</version>
                                    <fixVersion>3.9.1</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17909610" author="JIRAUSER300229" created="Fri, 3 Jan 2025 15:24:26 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=justinrlee&quot; class=&quot;user-hover&quot; rel=&quot;justinrlee&quot;&gt;justinrlee&lt;/a&gt;, if you&apos;re not working on this, may I take it? Thank you.&lt;/p&gt;</comment>
                            <comment id="17909818" author="justinrlee" created="Sun, 5 Jan 2025 05:25:43 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangpoan&quot; class=&quot;user-hover&quot; rel=&quot;yangpoan&quot;&gt;yangpoan&lt;/a&gt;, I&apos;m not actively working on it. Go ahead and take this. Thanks!&lt;/p&gt;</comment>
                            <comment id="17909819" author="JIRAUSER300229" created="Sun, 5 Jan 2025 05:27:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=justinrlee&quot; class=&quot;user-hover&quot; rel=&quot;justinrlee&quot;&gt;justinrlee&lt;/a&gt; Thanks. I already created a PR for it. If you have time, could you help to review it? Thank you.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            44 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1t61c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>