<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:40:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1396] fix transient unit test ProducerFailureHandlingTest.testBrokerFailure</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1396</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Currently disabled after kafka-1390.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12708619">KAFKA-1396</key>
            <summary>fix transient unit test ProducerFailureHandlingTest.testBrokerFailure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="guozhang">Guozhang Wang</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Apr 2014 20:55:22 +0000</created>
                <updated>Wed, 14 May 2014 00:34:08 +0000</updated>
                            <resolved>Wed, 14 May 2014 00:34:08 +0000</resolved>
                                    <version>0.8.2.0</version>
                                    <fixVersion>0.8.2.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13970090" author="guozhang" created="Tue, 15 Apr 2014 21:42:17 +0000"  >&lt;p&gt;1. I tried the test several times but cannot re-produce the hanging locally. So I can only debug based on the stack trace in the comments.&lt;/p&gt;

&lt;p&gt;2. Following the stack trace, there is no &quot;synchronized&quot; function call along the trace; also it is not clear if a real dead-lock happens during the hanging.&lt;/p&gt;

&lt;p&gt;3. It is suggested that the JVM GC could block any threads:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/7067058/java-thread-dump-blocked-thread-without-waiting-to-lock&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/7067058/java-thread-dump-blocked-thread-without-waiting-to-lock&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/4016356/java-blocking-issue-why-would-jvm-block-threads-in-many-different-classes-metho&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/4016356/java-blocking-issue-why-would-jvm-block-threads-in-many-different-classes-metho&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I agree this test takes long, but it is not a unit test but rather an integration test. I am wondering if we are sure there is occasional forever-hangs there or just occasional taking-too-long-due-to-GC? &lt;/p&gt;</comment>
                            <comment id="13970388" author="junrao" created="Wed, 16 Apr 2014 03:31:44 +0000"  >&lt;p&gt;Basically what I did was to disable the rest of the tests in this file and ran it 3 times on a mac laptop, in 2 times, the test didn&apos;t finish after more than 1 minute.&lt;/p&gt;</comment>
                            <comment id="13971720" author="guozhang" created="Wed, 16 Apr 2014 17:48:43 +0000"  >&lt;p&gt;I did the same on a mac laptop and on a desktop, each for 10 times. All of them finished within 1 minute, some is close to 1 minute. So I think the problem is this integration test being long not having transient failures. One thing we can do is to reduce the number of server failure iterations (currently it is 5).&lt;/p&gt;

&lt;p&gt;&amp;#8212; Desktop &amp;#8212;&lt;/p&gt;

&lt;p&gt;Total time: 40.028 secs&lt;/p&gt;

&lt;p&gt;real    0m40.122s&lt;br/&gt;
user    0m48.018s&lt;br/&gt;
sys    0m3.791s&lt;/p&gt;

&lt;p&gt;Total time: 40.411 secs&lt;/p&gt;

&lt;p&gt;real    0m40.501s&lt;br/&gt;
user    0m44.771s&lt;br/&gt;
sys    0m3.517s&lt;/p&gt;

&lt;p&gt;Total time: 41.76 secs&lt;/p&gt;

&lt;p&gt;real    0m41.863s&lt;br/&gt;
user    0m47.275s&lt;br/&gt;
sys    0m3.953s&lt;/p&gt;

&lt;p&gt;Total time: 41.096 secs&lt;/p&gt;

&lt;p&gt;real    0m41.192s&lt;br/&gt;
user    0m47.258s&lt;br/&gt;
sys    0m3.942s&lt;/p&gt;

&lt;p&gt;Total time: 42.378 secs&lt;/p&gt;

&lt;p&gt;real    0m42.478s&lt;br/&gt;
user    0m52.630s&lt;br/&gt;
sys    0m5.211s&lt;/p&gt;

&lt;p&gt;Total time: 41.79 secs&lt;/p&gt;

&lt;p&gt;real    0m41.893s&lt;br/&gt;
user    0m50.208s&lt;br/&gt;
sys    0m4.515s&lt;/p&gt;


&lt;p&gt;&amp;#8212; Laptop &amp;#8212;&lt;/p&gt;

&lt;p&gt;Total time: 49.44 secs&lt;/p&gt;

&lt;p&gt;real    0m49.589s&lt;br/&gt;
user    1m6.507s&lt;br/&gt;
sys    0m5.650s&lt;/p&gt;

&lt;p&gt;Total time: 48.087 secs&lt;/p&gt;

&lt;p&gt;real    0m48.264s&lt;br/&gt;
user    1m2.772s&lt;br/&gt;
sys    0m5.352s&lt;/p&gt;

&lt;p&gt;Total time: 48.157 secs&lt;/p&gt;

&lt;p&gt;real    0m48.312s&lt;br/&gt;
user    1m1.393s&lt;br/&gt;
sys    0m5.156s&lt;/p&gt;

&lt;p&gt;Total time: 47.686 secs&lt;/p&gt;

&lt;p&gt;real    0m47.854s&lt;br/&gt;
user    0m57.030s&lt;br/&gt;
sys    0m4.664s&lt;/p&gt;

&lt;p&gt;Total time: 48.67 secs&lt;/p&gt;

&lt;p&gt;real    0m48.862s&lt;br/&gt;
user    1m4.015s&lt;br/&gt;
sys    0m5.774s&lt;/p&gt;

&lt;p&gt;Total time: 48.875 secs&lt;/p&gt;

&lt;p&gt;real    0m49.054s&lt;br/&gt;
user    1m0.465s&lt;br/&gt;
sys    0m5.154s&lt;/p&gt;

&lt;p&gt;Total time: 47.233 secs&lt;/p&gt;

&lt;p&gt;real    0m47.414s&lt;br/&gt;
user    0m59.274s&lt;br/&gt;
sys    0m4.835s&lt;/p&gt;

&lt;p&gt;Total time: 48.635 secs&lt;/p&gt;

&lt;p&gt;real    0m48.826s&lt;br/&gt;
user    1m1.937s&lt;br/&gt;
sys    0m5.646s&lt;/p&gt;

&lt;p&gt;Total time: 49.261 secs&lt;/p&gt;

&lt;p&gt;real    0m49.420s&lt;br/&gt;
user    1m3.514s&lt;br/&gt;
sys    0m5.081s&lt;/p&gt;

&lt;p&gt;Total time: 49.883 secs&lt;/p&gt;

&lt;p&gt;real    0m50.040s&lt;br/&gt;
user    1m4.248s&lt;br/&gt;
sys    0m5.244s&lt;/p&gt;
</comment>
                            <comment id="13983306" author="junrao" created="Mon, 28 Apr 2014 17:54:00 +0000"  >&lt;p&gt;I suggest that we do the following.&lt;/p&gt;

&lt;p&gt;1. Reduce the # iterations from 5 to 2 to reduce the execution time.&lt;/p&gt;

&lt;p&gt;2. Wait for metadata propagation before start fetching.&lt;/p&gt;

&lt;p&gt;3. There could be messages that get committed by the broker, but whose ack to the producer are lost, depending on when the brokers are bounced. So, the test needs to be more resilient. Perhaps we can make sure that uniqueProducedMessageSet is equal to or a subset of uniqueFetchedMessageSet.&lt;/p&gt;</comment>
                            <comment id="13983329" author="guozhang" created="Mon, 28 Apr 2014 18:02:59 +0000"  >&lt;p&gt;+1 on 1,2.&lt;/p&gt;

&lt;p&gt;I am a little unclear about 3, is this case not covered by only counting uniqueFetchedMessageSet and compare with the sent count on scheduler, which does not include duplicates either?&lt;/p&gt;</comment>
                            <comment id="13983762" author="junrao" created="Tue, 29 Apr 2014 00:09:54 +0000"  >&lt;p&gt;On second thought, the existing test does handle #3.&lt;/p&gt;</comment>
                            <comment id="13992233" author="guozhang" created="Wed, 7 May 2014 21:16:21 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/21174/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/21174/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13992273" author="guozhang" created="Wed, 7 May 2014 21:55:20 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/21174/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/21174/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13993236" author="guozhang" created="Thu, 8 May 2014 22:57:22 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/21174/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/21174/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13993740" author="guozhang" created="Fri, 9 May 2014 17:35:21 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/21174/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/21174/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13996882" author="guozhang" created="Tue, 13 May 2014 20:48:59 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/21406/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/21406/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="13997106" author="junrao" created="Wed, 14 May 2014 00:34:08 +0000"  >&lt;p&gt;Thanks for the patch. +1 and committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12644694" name="KAFKA-1396.patch" size="8191" author="guozhang" created="Tue, 13 May 2014 20:48:59 +0000"/>
                            <attachment id="12643847" name="KAFKA-1396.patch" size="4761" author="guozhang" created="Wed, 7 May 2014 21:16:20 +0000"/>
                            <attachment id="12643856" name="KAFKA-1396_2014-05-07_14:55:09.patch" size="4761" author="guozhang" created="Wed, 7 May 2014 21:55:20 +0000"/>
                            <attachment id="12644040" name="KAFKA-1396_2014-05-08_15:57:11.patch" size="7469" author="guozhang" created="Thu, 8 May 2014 22:57:22 +0000"/>
                            <attachment id="12644135" name="KAFKA-1396_2014-05-09_10:35:07.patch" size="7311" author="guozhang" created="Fri, 9 May 2014 17:35:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386942</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 27 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1unon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>387206</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>