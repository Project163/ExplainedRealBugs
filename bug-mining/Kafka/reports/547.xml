<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:41:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-1108] when controlled shutdown attempt fails, the reason is not always logged</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-1108</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In KafkaServer.controlledShutdown(), it initiates a controlled shutdown, and then if there&apos;s a failure, it will retry the controlledShutdown.&lt;/p&gt;

&lt;p&gt;Looking at the code, there are 2 ways a retry could fail, one with an error response from the controller, and this messaging code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Remaining partitions to move: %s&quot;&lt;/span&gt;.format(shutdownResponse.partitionsRemaining.mkString(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;)))
info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error code from controller: %d&quot;&lt;/span&gt;.format(shutdownResponse.errorCode))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Alternatively, there could be an IOException, with this code executed:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; {
              &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; ioe: java.io.IOException =&amp;gt;
                channel.disconnect()
                channel = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                &lt;span class=&quot;code-comment&quot;&gt;// ignore and &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; again
&lt;/span&gt;            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And then finally, in either case:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!shutdownSuceeded) {
            &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(config.controlledShutdownRetryBackoffMs)
            warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Retrying controlled shutdown after the previous attempt failed...&quot;&lt;/span&gt;)
          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It would be nice if the nature of the IOException were logged in either case (I&apos;d be happy with an ioe.getMessage() instead of a full stack trace, as kafka in general tends to be too willing to dump IOException stack traces!).&lt;/p&gt;

&lt;p&gt;I suspect, in my case, the actual IOException is a socket timeout (as the time between initial &quot;Starting controlled shutdown....&quot; and the first &quot;Retrying...&quot; message is usually about 35 seconds (the socket timeout + the controlled shutdown retry backoff).  So, it would seem that really, the issue in this case is that controlled shutdown is taking too long.  It would seem sensible instead to have the controller report back to the server (before the socket timeout) that more time is needed, etc.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12676488">KAFKA-1108</key>
            <summary>when controlled shutdown attempt fails, the reason is not always logged</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ewencp">Ewen Cheslack-Postava</assignee>
                                    <reporter username="jbrosenberg@gmail.com">Jason Rosenberg</reporter>
                        <labels>
                            <label>newbie</label>
                    </labels>
                <created>Tue, 29 Oct 2013 20:37:55 +0000</created>
                <updated>Fri, 17 Oct 2014 22:07:41 +0000</updated>
                            <resolved>Fri, 17 Oct 2014 22:07:28 +0000</resolved>
                                                    <fixVersion>0.8.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14122062" author="guozhang" created="Thu, 4 Sep 2014 22:04:50 +0000"  >&lt;p&gt;Moving to 0.9 for now.&lt;/p&gt;</comment>
                            <comment id="14172775" author="ewencp" created="Wed, 15 Oct 2014 18:55:45 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/26770/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/26770/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14174222" author="ewencp" created="Thu, 16 Oct 2014 20:53:30 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/26770/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/26770/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14175619" author="nehanarkhede" created="Fri, 17 Oct 2014 22:07:28 +0000"  >&lt;p&gt;Thanks for the patch. Pushed to trunk and 0.8.2&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12675079" name="KAFKA-1108.patch" size="976" author="ewencp" created="Wed, 15 Oct 2014 18:55:45 +0000"/>
                            <attachment id="12675345" name="KAFKA-1108_2014-10-16_13:53:11.patch" size="2607" author="ewencp" created="Thu, 16 Oct 2014 20:53:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>355920</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 5 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pcxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356208</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>