<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:31:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-13985] MirrorSourceTask commitRecord throws NPE if SMT is filtering out source record</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-13985</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Applying a SMT that filters out messages it can brings to enter in this path:&lt;/p&gt;

&lt;p&gt;From WorkerSourceTask.java&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; SourceRecord record = transformationChain.apply(preTransformRecord);
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ProducerRecord&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]&amp;gt; producerRecord = convertTransformedRecord(record);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (producerRecord == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || retryWithToleranceOperator.failed()) {
&#160; &#160; counter.skipRecord();
&#160; &#160; commitTaskRecord(preTransformRecord, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Then to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void commitTaskRecord(SourceRecord record, RecordMetadata metadata) {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &#160; task.commitRecord(record, metadata);
&#160; &#160; &#160; &#160; } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable t) {
&#160; &#160; &#160; &#160; &#160; &#160; log.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;{} Exception thrown &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; calling task.commitRecord()&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, t);
&#160; &#160; &#160; &#160; }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Finally&lt;br/&gt;
From MirrorSourceTask.java&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; @Override
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void commitRecord(SourceRecord record, RecordMetadata metadata) {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stopping) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!metadata.hasOffset()) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; log.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;RecordMetadata has no offset -- can&apos;t sync offsets &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; {}.&quot;&lt;/span&gt;, record.topic());
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&#160; &#160; &#160; &#160; &#160; &#160; }

...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
Causing a NPE because metadata is null. &lt;br/&gt;
This the exception.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2022-06-13 12:31:33,094] WARN Failure committing record. (org.apache.kafka.connect.mirror.MirrorSourceTask:190)
java.lang.NullPointerException
&#160; &#160; at org.apache.kafka.connect.mirror.MirrorSourceTask.commitRecord(MirrorSourceTask.java:177)
&#160; &#160; at org.apache.kafka.connect.runtime.WorkerSourceTask.commitTaskRecord(WorkerSourceTask.java:463)
&#160; &#160; at org.apache.kafka.connect.runtime.WorkerSourceTask.sendRecords(WorkerSourceTask.java:358)
&#160; &#160; at org.apache.kafka.connect.runtime.WorkerSourceTask.execute(WorkerSourceTask.java:257)
&#160; &#160; at org.apache.kafka.connect.runtime.WorkerTask.doRun(WorkerTask.java:188)
&#160; &#160; at org.apache.kafka.connect.runtime.WorkerTask.run(WorkerTask.java:243)
&#160; &#160; at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)
&#160; &#160; at java.base/java.util.concurrent.FutureTask.run(Unknown Source)
&#160; &#160; at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
&#160; &#160; at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
&#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In my understanding this is well handled and it does not have negative impacts because it&apos;s handled by MirrorSourceTask.commitRecord, without leaving the exception be forwarded outside of it.&#160;&lt;/p&gt;

&lt;p&gt;But probably is preferred to handle it checking if metadata != null.&lt;br/&gt;
So skipping commit but safely and silently&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;EDIT&amp;#93;&lt;/span&gt;&lt;br/&gt;
Actually, going a bit in deep, there is a small side-effect.&lt;/p&gt;

&lt;p&gt;If the latest message elaborated was filtered out (so not committed by MirrorSourceTask), if MM2 instance is rebooted, this message will be re-read by consumer, because offset was not committed (and probably filtered out if configurations wasn&apos;t change).&lt;/p&gt;

&lt;p&gt;But probably this behavior is fine considering MM2&apos;s nature&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13449802">KAFKA-13985</key>
            <summary>MirrorSourceTask commitRecord throws NPE if SMT is filtering out source record</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="RensGroothuijsen">Rens Groothuijsen</assignee>
                                    <reporter username="jacopor">Jacopo Riciputi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jun 2022 13:10:02 +0000</created>
                <updated>Thu, 15 Sep 2022 13:56:03 +0000</updated>
                            <resolved>Thu, 15 Sep 2022 13:56:03 +0000</resolved>
                                    <version>3.1.0</version>
                    <version>3.2.0</version>
                    <version>3.3.0</version>
                                    <fixVersion>3.4.0</fixVersion>
                                    <component>mirrormaker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                    <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13425723">KAFKA-13632</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z136ug:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>