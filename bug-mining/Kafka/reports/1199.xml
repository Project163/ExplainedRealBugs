<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:56:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-4214] kafka-reassign-partitions fails all the time when brokers are bounced during reassignment</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-4214</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Due to &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4204&quot; title=&quot;KafkaService.verify_reassign_partitions is a no-op &quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4204&quot;&gt;KAFKA-4204&lt;/a&gt;, we never realized that the existing system test for testing reassignment would always fail when brokers were bounced in mid process. This happens reliably, even for topics of varying number of partition and varying replication factors.&lt;/p&gt;

&lt;p&gt;In particular, we see errors like this in the logs when the brokers are bounced: &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Status of partition reassignment:
ERROR: Assigned replicas (1,2) don&apos;t match the list of replicas for reassignment (1) for partition [test_topic,2]
Reassignment of partition [test_topic,1] completed successfully
Reassignment of partition [test_topic,2] failed
Reassignment of partition [test_topic,3] completed successfully
Reassignment of partition [test_topic,0] is still in progress
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Currently, the tests which bounce brokers during reassignment are disabled until this bug is fixed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13007304">KAFKA-4214</key>
            <summary>kafka-reassign-partitions fails all the time when brokers are bounced during reassignment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="apurva">Apurva Mehta</assignee>
                                    <reporter username="apurva">Apurva Mehta</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Sep 2016 23:54:44 +0000</created>
                <updated>Mon, 5 Dec 2016 14:03:44 +0000</updated>
                            <resolved>Tue, 27 Sep 2016 00:18:53 +0000</resolved>
                                                    <fixVersion>0.10.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15524218" author="githubbot" created="Mon, 26 Sep 2016 21:26:02 +0000"  >&lt;p&gt;GitHub user apurvam opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1910&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1910&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4214&quot; title=&quot;kafka-reassign-partitions fails all the time when brokers are bounced during reassignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4214&quot;&gt;&lt;del&gt;KAFKA-4214&lt;/del&gt;&lt;/a&gt;:kafka-reassign-partitions fails all the time when brokers are bounced during reassignment&lt;/p&gt;

&lt;p&gt;    There is a corner case bug, where during partition reassignment, if the&lt;br/&gt;
    controller and a broker receiving a new replica are bounced at the same&lt;br/&gt;
    time, the partition reassignment is failed.&lt;/p&gt;

&lt;p&gt;    The cause of this bug is a block of code in the KafkaController which&lt;br/&gt;
    fails the reassignment if the aliveNewReplicas != newReplicas, ie. if&lt;br/&gt;
    some of the new replicas are offline at the time a controller fails&lt;br/&gt;
    over.&lt;/p&gt;

&lt;p&gt;    The fix is to have the controller listen for ISR change events even for&lt;br/&gt;
    new replicas which are not alive when the controller boots up. Once the&lt;br/&gt;
    said replicas come online, they will be in the ISR set, and the new&lt;br/&gt;
    controller will detect this, and then mark the reassignment as&lt;br/&gt;
    successful.&lt;/p&gt;

&lt;p&gt;    Interestingly, the block of code in question was introduced in&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-990&quot; title=&quot;Fix ReassignPartitionCommand and improve usability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-990&quot;&gt;&lt;del&gt;KAFKA-990&lt;/del&gt;&lt;/a&gt;, where a concern about this exact scenario was raised &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    This bug was revealed in the system tests in &lt;a href=&quot;https://github.com/apache/kafka/pull/1904&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1904&lt;/a&gt;. &lt;br/&gt;
    The relevant tests will be enabled in either this or a followup PR when PR-1904 is merged.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/apurvam/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apurvam/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-4214&quot; title=&quot;kafka-reassign-partitions fails all the time when brokers are bounced during reassignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-4214&quot;&gt;&lt;del&gt;KAFKA-4214&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1910.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1910.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1910&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7f9814466592f549e8fcde914815c35dcb5a046d&lt;br/&gt;
Author: Apurva Mehta &amp;lt;apurva.1618@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-09-26T21:11:44Z&lt;/p&gt;

&lt;p&gt;    There is a corner case bug, where during partition reassignment, if the&lt;br/&gt;
    controller and a broker receiving a new replica are bounced at the same&lt;br/&gt;
    time, the partition reassignment is failed.&lt;/p&gt;

&lt;p&gt;    The cause of this bug is a block of code in the KafkaController which&lt;br/&gt;
    fails the reassignment if the aliveNewReplicas != newReplicas, ie. if&lt;br/&gt;
    some of the new replicas are offline at the time a controller fails&lt;br/&gt;
    over.&lt;/p&gt;

&lt;p&gt;    The fix is to have the controller listen for ISR change events even for&lt;br/&gt;
    new replicas which are not alive when the controller boots up. Once the&lt;br/&gt;
    said replicas come online, they will be in the ISR set, and the new&lt;br/&gt;
    controller will detect this, and then mark the reassignment as&lt;br/&gt;
    successful.&lt;/p&gt;

&lt;p&gt;    Interestingly, the block of code in question was introduced in&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-990&quot; title=&quot;Fix ReassignPartitionCommand and improve usability&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-990&quot;&gt;&lt;del&gt;KAFKA-990&lt;/del&gt;&lt;/a&gt;, where a concern about this exact scenario was raised &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15524589" author="junrao" created="Tue, 27 Sep 2016 00:18:53 +0000"  >&lt;p&gt;Issue resolved by pull request 1910&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/kafka/pull/1910&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1910&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15524590" author="githubbot" created="Tue, 27 Sep 2016 00:18:55 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1910&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1910&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12938533">KAFKA-3228</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3416v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>