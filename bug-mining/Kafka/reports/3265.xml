<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:30:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-13963] Topology Description ignores context.forward</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-13963</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I have a simple topology:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160; &#160; &#160; val topology = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Topology
&#160; &#160; &#160; topology
&#160; &#160; &#160; &#160; .addSource(&lt;span class=&quot;code-quote&quot;&gt;&quot;source&quot;&lt;/span&gt;, Serdes.stringSerde.deserializer, Serdes.stringSerde.deserializer, inputTopic)
&#160; &#160; &#160; &#160; .addProcessor(
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;process&quot;&lt;/span&gt;,
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProcessorSupplier[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;] {
&#160; &#160; &#160; &#160; &#160; &#160; override def get(): Processor[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;] =
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RecordCollectorProcessor()
&#160; &#160; &#160; &#160; &#160; },
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;source&quot;&lt;/span&gt;
&#160; &#160; &#160; &#160; ) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And a simple processor that uses context.forward to forward messages:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ContextForwardProcessor &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; AbstractProcessor[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]() {&#160; &#160; override def process(key: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, value: &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;): Unit =
&#160; &#160; &#160; context().forward(&lt;span class=&quot;code-quote&quot;&gt;&quot;key&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;value&quot;&lt;/span&gt;, To.child(&lt;span class=&quot;code-quote&quot;&gt;&quot;output&quot;&lt;/span&gt;))&#160; &#160; override def close(): Unit = ()
&#160; }&#160; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;when I call topology.describe() I receive this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Topologies:
&#160; &#160;Sub-topology: 0
&#160; &#160; Source: source (topics: [input])
&#160; &#160; &#160; --&amp;gt; process
&#160; &#160; Processor: process (stores: [])
&#160; &#160; &#160; --&amp;gt; none
&#160; &#160; &#160; &amp;lt;-- source&#160;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Ignoring the fact that this will not run since it will throw a runtime exception why is the To.child ignored?&lt;/p&gt;

&lt;p&gt;Taking it one point further if I add multiple sinks to the topology like so:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val topology = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Topology
&#160; &#160; &#160; topology
&#160; &#160; &#160; &#160; .addSource(&lt;span class=&quot;code-quote&quot;&gt;&quot;source&quot;&lt;/span&gt;, Serdes.stringSerde.deserializer, Serdes.stringSerde.deserializer, inputTopic)
&#160; &#160; &#160; &#160; .addProcessor(
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;process&quot;&lt;/span&gt;,
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProcessorSupplier[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;] {
&#160; &#160; &#160; &#160; &#160; &#160; override def get(): Processor[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;] =
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ContextForwardProcessor()
&#160; &#160; &#160; &#160; &#160; },
&#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;source&quot;&lt;/span&gt;
&#160; &#160; &#160; &#160; )
&#160; &#160; &#160; &#160; .addSink(&lt;span class=&quot;code-quote&quot;&gt;&quot;sink&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;output1&quot;&lt;/span&gt;, Serdes.stringSerde.serializer(), Serdes.stringSerde.serializer(), &lt;span class=&quot;code-quote&quot;&gt;&quot;process&quot;&lt;/span&gt;)
&#160; &#160; &#160; &#160; .addSink(&lt;span class=&quot;code-quote&quot;&gt;&quot;sink2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;output2&quot;&lt;/span&gt;, Serdes.stringSerde.serializer(), Serdes.stringSerde.serializer(), &lt;span class=&quot;code-quote&quot;&gt;&quot;process&quot;&lt;/span&gt;)&#160; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but have the processor only output to &quot;output1&quot; it is in no way reflected in the described topology graph.&lt;/p&gt;

&lt;p&gt;I assume this is by design since it&apos;s a lot more work to interpret what the context.forward is doing but when I tried to look for this information in the java doc I couldn&apos;t find it.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13448789">KAFKA-13963</key>
            <summary>Topology Description ignores context.forward</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tkaszuba">Tomasz Kaszuba</assignee>
                                    <reporter username="tkaszuba">Tomasz Kaszuba</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jun 2022 12:50:55 +0000</created>
                <updated>Tue, 28 Jun 2022 01:52:27 +0000</updated>
                            <resolved>Tue, 28 Jun 2022 01:52:27 +0000</resolved>
                                    <version>2.7.2</version>
                                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17551271" author="mjsax" created="Tue, 7 Jun 2022 20:08:34 +0000"  >&lt;p&gt;TopologyDescription only describes the structure of you graph of operators. In your first example, you only added two nodes to the graph (&quot;source&quot; and &quot;process&quot;) and there is no node &quot;output&quot;, and thus it&apos;s not contained in the `TopologyDescription`.&lt;/p&gt;

&lt;p&gt;It&apos;s not really possible to take the business logic (ie, what `forward()` is doing) into account &#8211; at least I have not idea how this could be done with reasonable effort.&lt;/p&gt;

&lt;p&gt;It&apos;s for sure not a bug. We should either close this ticket and change it into a feature request.&lt;/p&gt;</comment>
                            <comment id="17551289" author="tkaszuba" created="Tue, 7 Jun 2022 21:04:01 +0000"  >&lt;p&gt;Ok, this is what I thought. Is it worth updating the java doc to mention this? The developers I work with were surprised that context.forward is not covered. We rely heavily on the generated topology graphs for impact analysis.&lt;/p&gt;

&lt;p&gt;Btw, I think you can get around the context forward exception and the need for registering sinks if you use the internal RecordCollector, which I feel should be better hidden from the streams api users since it&apos;s a class cast exception waiting to happen. I can open up a separate bug for that if it makes sense.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
collector = context.asInstanceOf[RecordCollector.Supplier].recordCollector &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17551333" author="mjsax" created="Wed, 8 Jun 2022 00:31:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is it worth updating the java doc to mention this?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Updating docs can never hurt &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &#8211; are you interested in doing a PR?&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;if you use the internal RecordCollector, which I feel should be better hidden from the streams api users&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, you should NEVER use internal stuff... Not sure how we could &quot;better hide&quot; it though? Seems not to be possible as long as we are using Java 8...&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I can open up a separate bug for that if it makes sense.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Don&apos;t think it&apos;s a bug? It (unfortunately) how Java works.&lt;/p&gt;</comment>
                            <comment id="17553976" author="tkaszuba" created="Tue, 14 Jun 2022 08:24:37 +0000"  >&lt;p&gt;Created PR for the docs: &lt;a href=&quot;https://github.com/apache/kafka/pull/12293/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/12293/files&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 22 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z130n4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>