<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:19:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-7941] Connect KafkaBasedLog work thread terminates when getting offsets fails because broker is unavailable</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-7941</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;My team has run into this Connect bug regularly in the last six months while doing infrastructure maintenance that causes intermittent broker availability issues.  I&apos;m a little surprised it exists given how routinely it affects us, so perhaps someone in the know can point out if our setup is somehow just incorrect.  My team is running 2.0.0 on both the broker and client, though from what I can tell from reading the code, the issue continues to exist through 2.2; at least, I was able to write a failing unit test that I believe reproduces it.&lt;/p&gt;

&lt;p&gt;When a &lt;tt&gt;KafkaBasedLog&lt;/tt&gt; worker thread in the Connect runtime calls &lt;tt&gt;readLogToEnd&lt;/tt&gt; and brokers are unavailable, the &lt;tt&gt;TimeoutException&lt;/tt&gt; from the consumer &lt;tt&gt;endOffsets&lt;/tt&gt; call is uncaught all the way up to the top level &lt;tt&gt;catch (Throwable t)&lt;/tt&gt;, effectively killing the thread until restarting Connect.  The result is Connect stops functioning entirely, with no indication except for that log line - tasks still show as running.&lt;/p&gt;

&lt;p&gt;The proposed fix is to simply catch and log the &lt;tt&gt;TimeoutException&lt;/tt&gt;, allowing the worker thread to retry forever.&lt;/p&gt;

&lt;p&gt;Alternatively, perhaps there is not an expectation that Connect should be able to recover following broker unavailability, though that would be disappointing.  I would at least hope hope for a louder failure then the single &lt;tt&gt;ERROR&lt;/tt&gt; log.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13216283">KAFKA-7941</key>
            <summary>Connect KafkaBasedLog work thread terminates when getting offsets fails because broker is unavailable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pgwhalen">Paul Whalen</assignee>
                                    <reporter username="pgwhalen">Paul Whalen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Feb 2019 01:00:26 +0000</created>
                <updated>Wed, 11 Sep 2019 14:46:30 +0000</updated>
                            <resolved>Tue, 13 Aug 2019 22:25:34 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>2.1.2</fixVersion>
                    <fixVersion>2.2.2</fixVersion>
                    <fixVersion>2.3.1</fixVersion>
                    <fixVersion>2.4.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16770714" author="githubbot" created="Mon, 18 Feb 2019 01:17:28 +0000"  >&lt;p&gt;pgwhalen commented on pull request #6283: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7941&quot; title=&quot;Connect KafkaBasedLog work thread terminates when getting offsets fails because broker is unavailable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7941&quot;&gt;&lt;del&gt;KAFKA-7941&lt;/del&gt;&lt;/a&gt;: Catch TimeoutException in KafkaBasedLog worker thread&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6283&lt;/a&gt;&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;When calling readLogToEnd(), the KafkaBasedLog worker thread should&lt;br/&gt;
    catch TimeoutException and log a warning, which can occur if brokers&lt;br/&gt;
    are unavailable, otherwise the worker thread terminates.&lt;/li&gt;
	&lt;li&gt;Includes an enhancement to MockConsumer that allows simulating&lt;br/&gt;
    exceptions not just when polling but also when querying for offsets,&lt;br/&gt;
    which is necessary for testing the fix.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16841226" author="rhauch" created="Thu, 16 May 2019 11:15:47 +0000"  >&lt;p&gt;It looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6608&quot; title=&quot;Add TimeoutException to KafkaConsumer#position()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6608&quot;&gt;&lt;del&gt;KAFKA-6608&lt;/del&gt;&lt;/a&gt; changed the `consumer.endOffsets(...)` methods in AK 2.0 to add an optional timeout parameter, and for the existing method to default to the value set by the `request.timeout.ms` consumer property, which itself defaults to 30 seconds. This added the possibility of a TimeoutException on these methods, which didn&apos;t have it before AK 2.0.&lt;/p&gt;

&lt;p&gt;So, one workaround is to set the `request.timeout.ms` property for Connect worker&apos;s configuration, which is used for the worker&apos;s consumer used for offsets and other internal topics. Note that doing this will affect the producer of internal components, too, and unless it&apos;s overridden for the worker&apos;s `producer.request.timeout.ms` or `consumer.request.timeout.ms` will also apply to producers and consumers used for connectors.&lt;/p&gt;</comment>
                            <comment id="16899851" author="ivanyu" created="Mon, 5 Aug 2019 07:49:16 +0000"  >&lt;p&gt;We got hit by this issue as well. In our case it makes a Connect cluster totally non-operating, when a &lt;tt&gt;WorkerCoordinator&lt;/tt&gt; can&apos;t create assignments because it can&apos;t read the latest connector config from Kafka and coordinators get into an infinite loop of&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;INFO [Worker clientId=connect-1, groupId=connect] Was selected to perform assignments, but do not have latest config found in sync request. Returning an empty configuration to trigger re-sync. (org.apache.kafka.connect.runtime.distributed.WorkerCoordinator:208)
INFO [GroupCoordinator 3]: Assignment received from leader for group connect for generation 436 (kafka.coordinator.group.GroupCoordinator)
INFO [Worker clientId=connect-1, groupId=connect] Successfully joined group with generation 436 (org.apache.kafka.clients.consumer.internals.AbstractCoordinator:455)
INFO Joined group and got assignment: Assignment{error=1, leader=&apos;connect-1-caf0b504-cb29-4456-a28d-3172cdf67d73&apos;, leaderUrl=&apos;http://&amp;lt;url&amp;gt;&apos;, offset=1, connectorIds=[], taskIds=[]} (org.apache.kafka.connect.runtime.distributed.DistributedHerder:1216)
INFO [Worker clientId=connect-1, groupId=connect] (Re-)joining group (org.apache.kafka.clients.consumer.internals.AbstractCoordinator:491)
INFO [GroupCoordinator 3]: Preparing to rebalance group connect in state PreparingRebalance with old generation 436 (__consumer_offsets-30) (reason: Updating metadata for member connect-1-caf0b504-cb29-4456-a28d-3172cdf67d73) (kafka.coordinator.group.GroupCoordinator)
INFO [GroupCoordinator 3]: Stabilized group connect generation 437 (__consumer_offsets-30) (kafka.coordinator.group.GroupCoordinator)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Thank your for reporting and fixing, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pgwhalen&quot; class=&quot;user-hover&quot; rel=&quot;pgwhalen&quot;&gt;pgwhalen&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16906306" author="githubbot" created="Tue, 13 Aug 2019 15:16:58 +0000"  >&lt;p&gt;rhauch commented on pull request #6283: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7941&quot; title=&quot;Connect KafkaBasedLog work thread terminates when getting offsets fails because broker is unavailable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7941&quot;&gt;&lt;del&gt;KAFKA-7941&lt;/del&gt;&lt;/a&gt;: Catch TimeoutException in KafkaBasedLog worker thread&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/6283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/6283&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16906673" author="rhauch" created="Tue, 13 Aug 2019 22:25:34 +0000"  >&lt;p&gt;Merged to the `trunk`, `2.3`, `2.2`, `2.1`, and `2.0` branches.&lt;/p&gt;

&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pgwhalen&quot; class=&quot;user-hover&quot; rel=&quot;pgwhalen&quot;&gt;pgwhalen&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13237649">KAFKA-8485</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13142291">KAFKA-6608</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13250318">KAFKA-8790</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 13 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi12ps:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>rhauch</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>