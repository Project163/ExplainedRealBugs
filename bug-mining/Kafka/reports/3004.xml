<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:27:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-12892] InvalidACLException thrown in tests caused jenkins build unstable</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-12892</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-12866&quot; title=&quot;Kafka requires ZK root access even when using a chroot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-12866&quot;&gt;&lt;del&gt;KAFKA-12866&lt;/del&gt;&lt;/a&gt;, we fixed the issue that Kafka required ZK root access even when using a chroot. But after the PR merged (build #183), trunk build keeps failing at least one test group (mostly, JDK 15 and Scala 2.13). The build result will said nothing useful:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt; Task :core:integrationTest FAILED
[2021-06-04T03:19:18.974Z] 
[2021-06-04T03:19:18.974Z] FAILURE: Build failed with an exception.
[2021-06-04T03:19:18.974Z] 
[2021-06-04T03:19:18.974Z] * What went wrong:
[2021-06-04T03:19:18.974Z] Execution failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; task &lt;span class=&quot;code-quote&quot;&gt;&apos;:core:integrationTest&apos;&lt;/span&gt;.
[2021-06-04T03:19:18.974Z] &amp;gt; &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;Gradle Test Executor 128&apos;&lt;/span&gt; finished with non-zero exit value 1
[2021-06-04T03:19:18.974Z]   This problem might be caused by incorrect test process configuration.
[2021-06-04T03:19:18.974Z]   Please refer to the test execution section in the User Manual at https:&lt;span class=&quot;code-comment&quot;&gt;//docs.gradle.org/7.0.2/userguide/java_testing.html#sec:test_execution&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;After investigation, I found the failed tests is because there are many `InvalidACLException` thrown during the tests, ex:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
GssapiAuthenticationTest &amp;gt; testServerNotFoundInKerberosDatabase() FAILED
[2021-06-04T02:25:45.419Z]     org.apache.zookeeper.KeeperException$InvalidACLException: KeeperErrorCode = InvalidACL &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /config/topics/__consumer_offsets
[2021-06-04T02:25:45.419Z]         at org.apache.zookeeper.KeeperException.create(KeeperException.java:128)
[2021-06-04T02:25:45.419Z]         at org.apache.zookeeper.KeeperException.create(KeeperException.java:54)
[2021-06-04T02:25:45.419Z]         at kafka.zookeeper.AsyncResponse.maybeThrow(ZooKeeperClient.scala:583)
[2021-06-04T02:25:45.419Z]         at kafka.zk.KafkaZkClient.createRecursive(KafkaZkClient.scala:1729)
[2021-06-04T02:25:45.419Z]         at kafka.zk.KafkaZkClient.createOrSet$1(KafkaZkClient.scala:366)
[2021-06-04T02:25:45.419Z]         at kafka.zk.KafkaZkClient.setOrCreateEntityConfigs(KafkaZkClient.scala:376)
[2021-06-04T02:25:45.419Z]         at kafka.zk.AdminZkClient.createTopicWithAssignment(AdminZkClient.scala:109)
[2021-06-04T02:25:45.419Z]         at kafka.zk.AdminZkClient.createTopic(AdminZkClient.scala:60)
[2021-06-04T02:25:45.419Z]         at kafka.utils.TestUtils$.$anonfun$createTopic$1(TestUtils.scala:357)
[2021-06-04T02:25:45.419Z]         at kafka.utils.TestUtils$.createTopic(TestUtils.scala:848)
[2021-06-04T02:25:45.419Z]         at kafka.utils.TestUtils$.createOffsetsTopic(TestUtils.scala:428)
[2021-06-04T02:25:45.419Z]         at kafka.api.IntegrationTestHarness.doSetup(IntegrationTestHarness.scala:109)
[2021-06-04T02:25:45.419Z]         at kafka.api.IntegrationTestHarness.setUp(IntegrationTestHarness.scala:84)
[2021-06-04T02:25:45.419Z]         at kafka.server.GssapiAuthenticationTest.setUp(GssapiAuthenticationTest.scala:68)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Log can be found [here|&lt;a href=&quot;https://ci-builds.apache.org/blue/rest/organizations/jenkins/pipelines/Kafka/pipelines/kafka/branches/trunk/runs/195/nodes/14/steps/145/log/?start=0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/blue/rest/organizations/jenkins/pipelines/Kafka/pipelines/kafka/branches/trunk/runs/195/nodes/14/steps/145/log/?start=0&lt;/a&gt;]&lt;/p&gt;

&lt;p&gt;After tracing back, I found it could because we add a test in the &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-12866&quot; title=&quot;Kafka requires ZK root access even when using a chroot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-12866&quot;&gt;&lt;del&gt;KAFKA-12866&lt;/del&gt;&lt;/a&gt; to lock root access in zookeeper, but somehow it didn&apos;t unlock after the test in testChrootExistsAndRootIsLocked. Also, while all the InvalidACLException failed tests happened right after testChrootExistsAndRootIsLocked not long. Ex: below testChrootExistsAndRootIsLocked completed at 02:24:30, and the above failed test is at 02:25:45 (and following more than 10 tests with the same InvalidACLException.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2021-06-04T02:24:29.370Z] ZkClientAclTest &amp;gt; testChrootExistsAndRootIsLocked() STARTED
[2021-06-04T02:24:30.321Z] 
[2021-06-04T02:24:30.321Z] ZkClientAclTest &amp;gt; testChrootExistsAndRootIsLocked() PASSED&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13026404/13026404_image-2021-06-04-21-05-57-222.png&quot; height=&quot;1111&quot; width=&quot;489&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;We should have further investigation to see how to improve the test to avoid breaking the build. Before that, we can disable the test first. Thanks.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13382148">KAFKA-12892</key>
            <summary>InvalidACLException thrown in tests caused jenkins build unstable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="soarez">Igor Soarez</assignee>
                                    <reporter username="showuon">Luke Chen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Jun 2021 13:20:44 +0000</created>
                <updated>Mon, 14 Jun 2021 08:01:42 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17357362" author="showuon" created="Fri, 4 Jun 2021 13:33:12 +0000"  >&lt;p&gt;I tried to set the original root acl back, but it failed. That is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val originalRootAcl = zkClient.getAcl(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)
...
zkClient.setAcl(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;, Seq(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ACL(ZooDefs.Perms.ALL, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Id(scheme, s&lt;span class=&quot;code-quote&quot;&gt;&quot;$id:$digest&quot;&lt;/span&gt;))))

...
zkClient.setAcl(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;, originalRootAcl)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I think we need &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=soarez&quot; class=&quot;user-hover&quot; rel=&quot;soarez&quot;&gt;soarez&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=omkreddy&quot; class=&quot;user-hover&quot; rel=&quot;omkreddy&quot;&gt;omkreddy&lt;/a&gt;&#160; &apos;s help. Thanks.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17360983" author="cadonna" created="Thu, 10 Jun 2021 14:46:39 +0000"  >&lt;p&gt;Is PR #10821 supposed to solve the issue?&lt;/p&gt;

&lt;p&gt;I still see a lot of &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
MultipleListenersWithAdditionalJaasContextTest &amp;gt; testProduceConsume() FAILED
[2021-06-10T11:11:52.209Z]     org.apache.zookeeper.KeeperException$InvalidACLException: KeeperErrorCode = InvalidACL &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /brokers/ids
[2021-06-10T11:11:52.209Z]         at org.apache.zookeeper.KeeperException.create(KeeperException.java:128)
[2021-06-10T11:11:52.209Z]         at org.apache.zookeeper.KeeperException.create(KeeperException.java:54)
[2021-06-10T11:11:52.209Z]         at kafka.zookeeper.AsyncResponse.maybeThrow(ZooKeeperClient.scala:583)
[2021-06-10T11:11:52.209Z]         at kafka.zk.KafkaZkClient.createRecursive(KafkaZkClient.scala:1729)
[2021-06-10T11:11:52.209Z]         at kafka.zk.KafkaZkClient.makeSurePersistentPathExists(KafkaZkClient.scala:1627)
[2021-06-10T11:11:52.209Z]         at kafka.zk.KafkaZkClient.$anonfun$createTopLevelPaths$1(KafkaZkClient.scala:1619)
[2021-06-10T11:11:52.209Z]         at kafka.zk.KafkaZkClient.$anonfun$createTopLevelPaths$1$adapted(KafkaZkClient.scala:1619)
[2021-06-10T11:11:52.209Z]         at scala.collection.immutable.List.foreach(List.scala:333)
[2021-06-10T11:11:52.209Z]         at kafka.zk.KafkaZkClient.createTopLevelPaths(KafkaZkClient.scala:1619)
[2021-06-10T11:11:52.209Z]         at kafka.server.KafkaServer.initZkClient(KafkaServer.scala:454)
[2021-06-10T11:11:52.209Z]         at kafka.server.KafkaServer.startup(KafkaServer.scala:192)
[2021-06-10T11:11:52.209Z]         at kafka.utils.TestUtils$.createServer(TestUtils.scala:166)
[2021-06-10T11:11:52.209Z]         at kafka.server.MultipleListenersWithSameSecurityProtocolBaseTest.$anonfun$setUp$1(MultipleListenersWithSameSecurityProtocolBaseTest.scala:103)
[2021-06-10T11:11:52.210Z]         at kafka.server.MultipleListenersWithSameSecurityProtocolBaseTest.$anonfun$setUp$1$adapted(MultipleListenersWithSameSecurityProtocolBaseTest.scala:76)
[2021-06-10T11:11:52.210Z]         at scala.collection.immutable.Range.foreach(Range.scala:190)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also on PRs that contain PR #10821. For example &lt;a href=&quot;https://ci-builds.apache.org/blue/rest/organizations/jenkins/pipelines/Kafka/pipelines/kafka-pr/branches/PR-10856/runs/3/nodes/14/steps/121/log/?start=0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci-builds.apache.org/blue/rest/organizations/jenkins/pipelines/Kafka/pipelines/kafka-pr/branches/PR-10856/runs/3/nodes/14/steps/121/log/?start=0&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17361026" author="soarez" created="Thu, 10 Jun 2021 15:23:23 +0000"  >&lt;p&gt;Yes it was - by applying the ACL changes to a unique child znode instead of to the root, there shouldn&apos;t be any interference with other tests. I&apos;m not sure if this is the new test that&apos;s still a problem or if there&apos;s any lingering state in zookeeper across builds. It is strange that only some test runs are affected. Disabling the test will let us know.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13026404" name="image-2021-06-04-21-05-57-222.png" size="318528" author="showuon" created="Fri, 4 Jun 2021 13:05:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0rny0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>