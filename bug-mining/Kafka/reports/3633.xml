<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:37:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-16005] ZooKeeper to KRaft migration rollback missing disabling controller and migration configuration on brokers</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-16005</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;I was following the latest documentation additions to try the rollback process of a ZK cluster migrating to KRaft, while it&apos;s still in dual-write mode: &lt;a href=&quot;https://github.com/apache/kafka/pull/14160/files#diff-e4e8d893dc2a4e999c96713dd5b5857203e0756860df0e70fb0cb041aa4d347bR3786&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/14160/files#diff-e4e8d893dc2a4e999c96713dd5b5857203e0756860df0e70fb0cb041aa4d347bR3786&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The first point is just about stopping broker, deleting __cluster_metadata folder and restarting broker.&lt;/p&gt;

&lt;p&gt;I think it&apos;s missing at least the following steps:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;removing/disabling the ZooKeeper migration flag&lt;/li&gt;
	&lt;li&gt;removing all properties related to controllers configuration (i.e. controller.quorum.voters, controller.listener.names, ...)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Without those steps, when the broker restarts, we have got broker re-creating the __cluster_metadata folder (because it syncs with controllers while they are still running).&lt;/p&gt;

&lt;p&gt;Also, when controllers stops, the broker starts to raise exceptions like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[2023-12-13 15:22:28,437] DEBUG [BrokerToControllerChannelManager id=0 name=quorum] Connection with localhost/127.0.0.1 (channelId=1) disconnected (org.apache.kafka.common.network.Selector)java.net.ConnectException: Connection refused    at java.base/sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)    at java.base/sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:777)    at org.apache.kafka.common.network.PlaintextTransportLayer.finishConnect(PlaintextTransportLayer.java:50)    at org.apache.kafka.common.network.KafkaChannel.finishConnect(KafkaChannel.java:224)    at org.apache.kafka.common.network.Selector.pollSelectionKeys(Selector.java:526)    at org.apache.kafka.common.network.Selector.poll(Selector.java:481)    at org.apache.kafka.clients.NetworkClient.poll(NetworkClient.java:571)    at org.apache.kafka.server.util.InterBrokerSendThread.pollOnce(InterBrokerSendThread.java:109)    at kafka.server.BrokerToControllerRequestThread.doWork(BrokerToControllerChannelManager.scala:421)    at org.apache.kafka.server.util.ShutdownableThread.run(ShutdownableThread.java:130)[2023-12-13 15:22:28,438] INFO [BrokerToControllerChannelManager id=0 name=quorum] Node 1 disconnected. (org.apache.kafka.clients.NetworkClient)[2023-12-13 15:22:28,438] WARN [BrokerToControllerChannelManager id=0 name=quorum] Connection to node 1 (localhost/127.0.0.1:9093) could not be established. Broker may not be available. (org.apache.kafka.clients.NetworkClient) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(where I have controller locally on port 9093)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13561684">KAFKA-16005</key>
            <summary>ZooKeeper to KRaft migration rollback missing disabling controller and migration configuration on brokers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ppatierno">Paolo Patierno</assignee>
                                    <reporter username="ppatierno">Paolo Patierno</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Dec 2023 14:36:12 +0000</created>
                <updated>Thu, 14 Dec 2023 14:02:08 +0000</updated>
                            <resolved>Thu, 14 Dec 2023 14:02:08 +0000</resolved>
                                    <version>3.6.1</version>
                                    <fixVersion>3.7.0</fixVersion>
                                    <component>documentation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 47 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1m8hc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>