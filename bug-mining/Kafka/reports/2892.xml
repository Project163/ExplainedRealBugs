<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:26:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-12270] Kafka Connect may fail a task when racing to create topic</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-12270</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When a source connector configured with many tasks and to use the new topic creation feature is run, it is possible that multiple tasks will attempt to write to the same topic, will see that the topic does not exist, and then race to create the topic. The topic is only created once, but some tasks might fail with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.kafka.connect.errors.ConnectException: Task failed to create &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; topic (name=TOPICX, numPartitions=8, replicationFactor=3, replicasAssignments=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, configs={cleanup.policy=delete}). Ensure that the task is authorized to create topics or that the topic exists and restart the task
  at org.apache.kafka.connect.runtime.WorkerSourceTask.maybeCreateTopic(WorkerSourceTask.java:436)
  at org.apache.kafka.connect.runtime.WorkerSourceTask.sendRecords(WorkerSourceTask.java:364)
  at org.apache.kafka.connect.runtime.WorkerSourceTask.execute(WorkerSourceTask.java:264)
  at org.apache.kafka.connect.runtime.WorkerTask.doRun(WorkerTask.java:185)
  at org.apache.kafka.connect.runtime.WorkerTask.run(WorkerTask.java:235)
... &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The reason appears to be that the WorkerSourceTask throws an exception if the topic creation failed, and does not account for the fact that the topic may have been created between the time the WorkerSourceTask lists existing topics and tries to create the topic.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;See in particular:&#160;&lt;a href=&quot;https://github.com/apache/kafka/blob/5c562efb2d76407011ea88c1ca1b2355079935bc/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java#L415-L423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/blob/5c562efb2d76407011ea88c1ca1b2355079935bc/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java#L415-L423&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This is only an issue when using topic creation settings in the source connector configuration, and when running multiple tasks that write to the same topic.&lt;/p&gt;

&lt;p&gt;The workaround is to create the topics manually before starting the connector, or to simply restart the failed tasks using the REST API.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13356247">KAFKA-12270</key>
            <summary>Kafka Connect may fail a task when racing to create topic</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhauch">Randall Hauch</assignee>
                                    <reporter username="rhauch">Randall Hauch</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Feb 2021 16:40:50 +0000</created>
                <updated>Thu, 4 Feb 2021 00:41:12 +0000</updated>
                            <resolved>Thu, 4 Feb 2021 00:41:12 +0000</resolved>
                                    <version>2.6.0</version>
                    <version>2.7.0</version>
                    <version>2.8.0</version>
                                    <fixVersion>2.6.2</fixVersion>
                    <fixVersion>2.7.1</fixVersion>
                    <fixVersion>2.8.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17277435" author="kkonstantine" created="Tue, 2 Feb 2021 20:12:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhauch&quot; class=&quot;user-hover&quot; rel=&quot;rhauch&quot;&gt;rhauch&lt;/a&gt; I remember considering this use case.&#160;&lt;/p&gt;

&lt;p&gt;But maybe the issue here has to do with the fact that the exception is not considered retriable. Not sure yet if something changed or this has been an issue since the KIP was merged.&#160;&lt;br/&gt;
Thanks for reporting this&lt;/p&gt;</comment>
                            <comment id="17277520" author="rhauch" created="Tue, 2 Feb 2021 23:09:23 +0000"  >&lt;p&gt;I don&apos;t think it&apos;s because the exception is retriable, because the `TopicAdmin.createTopics(...)` method explicitly catches a `TopicExistsException` and simply returns a response without the topic name, signaling that the topic was not created. I think the response is adequate to know whether my request created the topic (or topics), but it&apos;s less than ideal if the caller simply wants to know whether the topic &quot;was created or already existed&quot;.&lt;/p&gt;

&lt;p&gt;We can&apos;t easily change the response, but we could potentially add an overloaded method that takes a flag as to whether existing topics should be included in the response. I&apos;m just not sure that&apos;s worth it. WDYT?&lt;/p&gt;

&lt;p&gt;BTW, I&apos;ve added a PR that keeps the TopicAdmin methods the same and instead just re-describes the topic. This should be an infrequent occurrence, but I&apos;m happy to eliminate the re-describe if you think that&apos;s a better approach.&lt;/p&gt;</comment>
                            <comment id="17277633" author="rhauch" created="Wed, 3 Feb 2021 02:02:28 +0000"  >&lt;p&gt;Ok, I didn&apos;t really like that the first PR added another admin client call to (re)describe the topic in question when the `createTopic(...)` method returned false, meaning the topic was not created (because it already existed by the time the create topic request was made/received by Kafka).&lt;/p&gt;

&lt;p&gt;So, I created an alternative PR that changes how the `TopicAdmin` creates a topic and returns precisely which topic names were created AND which were found to already exist. This allows the `WorkerSourceTask` to know exactly what happend and to log it accordingly.&lt;/p&gt;

&lt;p&gt;This new method in `TopicAdmin` is called `createOrFindTopics(...)`, and it is the old implementation of `createTopics(...)` with only slight modification; the previously-existing `createTopics(...)` and `createTopic(...)` methods were changed to delegate to the new method. Thus the behavior of the existing methods remains unchanged (for the multiple places where they are called), but we get the more precise results in `WorkerSourceTask`.&lt;/p&gt;</comment>
                            <comment id="17278442" author="rhauch" created="Thu, 4 Feb 2021 00:41:12 +0000"  >&lt;p&gt;Merged to `trunk` for the upcoming 2.8.0, and cherrypicked to the 2.7 branch for the next 2.7.1 and to the 2.6 branch for the next 2.6.2.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0n9rc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>kkonstantine</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>