<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:33:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-12525] Inaccurate task status due to status record interleaving in fast rebalances in Connect</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-12525</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When a task is stopped in Connect it produces an &lt;tt&gt;UNASSIGNED&lt;/tt&gt;&#160;status record. &lt;br/&gt;
Equivalently, when a task is started or restarted in Connect it produces an &lt;tt&gt;RUNNING&lt;/tt&gt;&#160;status record in the Connect status topic.&lt;/p&gt;

&lt;p&gt;At the same time rebalances are decoupled from task start and stop. These operations happen in separate executor outside of the main worker thread that performs the rebalance.&lt;/p&gt;

&lt;p&gt;Normally, any delayed and stale &lt;tt&gt;UNASSIGNED&lt;/tt&gt;&#160;status records are fenced by the worker that is sending them. This worker is using the &lt;tt&gt;StatusBackingStore#putSafe&lt;/tt&gt;&#160;method that will reject any stale status messages (called only for &lt;tt&gt;UNASSIGNED&lt;/tt&gt;&#160;or &lt;tt&gt;FAILED&lt;/tt&gt;) as long as the worker is aware of the newer status record that declares a task as &lt;tt&gt;RUNNING&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;In cases of fast consecutive rebalances where a task is revoked from one worker and assigned to another one, it has been observed that there is a small time window and thus a race condition during which a &lt;tt&gt;RUNNING&lt;/tt&gt;&#160;status record in the new generation is produced and is immediately followed by a delayed &lt;tt&gt;UNASSIGNED&lt;/tt&gt;&#160;status record belonging to the same or a previous generation before the worker that sends this message reads the &lt;tt&gt;RUNNING&lt;/tt&gt;&#160;status record that corresponds to the latest generation.&lt;/p&gt;

&lt;p&gt;A couple of options are available to remediate this race condition. &lt;br/&gt;
For example a worker that is has started a task can re-write the &lt;tt&gt;RUNNING&lt;/tt&gt;&#160;status message in the topic if it reads a stale &lt;tt&gt;UNASSIGNED&lt;/tt&gt;&#160;message from a previous generation (that should have been fenced). &lt;br/&gt;
Another option is to ignore stale &lt;tt&gt;UNASSIGNED&lt;/tt&gt;&#160;message (messages from an earlier generation than the one in which the task had &lt;tt&gt;RUNNING&lt;/tt&gt;&#160;status).&lt;/p&gt;

&lt;p&gt;Worth noting that when this race condition takes place, besides the inaccurate status representation, the actual execution of the tasks remains unaffected (e.g. the tasks are running correctly even though they appear as &lt;tt&gt;UNASSIGNED&lt;/tt&gt;).&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13366889">KAFKA-12525</key>
            <summary>Inaccurate task status due to status record interleaving in fast rebalances in Connect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sagarrao">Sagar Rao</assignee>
                                    <reporter username="kkonstantine">Konstantine Karantasis</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Mar 2021 06:01:40 +0000</created>
                <updated>Wed, 20 Sep 2023 04:03:38 +0000</updated>
                            <resolved>Thu, 20 Jul 2023 10:09:10 +0000</resolved>
                                    <version>2.3.1</version>
                    <version>2.4.1</version>
                    <version>2.5.1</version>
                    <version>2.6.1</version>
                    <version>2.7.0</version>
                                    <fixVersion>3.6.0</fixVersion>
                                    <component>connect</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0p2mw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>