<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:37:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-755] standardizing json values stored in ZK</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-755</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Currently, we have the following paths in ZK that stores non-singleton values.&lt;/p&gt;

&lt;p&gt;1. Topic assignment value:&lt;br/&gt;
/brokers/topics/topic&lt;/p&gt;
{ &quot;0&quot;: [&quot;0&quot;] }

&lt;p&gt;2. LeaderAndISR info:&lt;br/&gt;
/brokers/topics/test/partitions/0/leaderAndISR&lt;/p&gt;
{ &quot;ISR&quot;:&quot;0,1&quot;,&quot;leader&quot;:&quot;0&quot;,&quot;controllerEpoch&quot;:&quot;1&quot;,&quot;leaderEpoch&quot;:&quot;0&quot; }

&lt;p&gt;3. broker registration:&lt;br/&gt;
/brokers/ids/0&lt;br/&gt;
192.168.1.148:9092:9999&lt;/p&gt;

&lt;p&gt;4. partition reassignment path&lt;/p&gt;

&lt;p&gt;It would be good if we do the following:&lt;br/&gt;
a. make them true json (e.g., using number as the value for broker/partition, instead of string).&lt;br/&gt;
b. add version support for future growth.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12631761">KAFKA-755</key>
            <summary>standardizing json values stored in ZK</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="swapnilghike">Swapnil Ghike</assignee>
                                    <reporter username="junrao">Jun Rao</reporter>
                        <labels>
                            <label>p1</label>
                    </labels>
                <created>Mon, 11 Feb 2013 17:48:16 +0000</created>
                <updated>Sun, 24 Feb 2013 20:18:12 +0000</updated>
                            <resolved>Sat, 23 Feb 2013 00:44:39 +0000</resolved>
                                    <version>0.8.0</version>
                                    <fixVersion>0.8.0</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13576062" author="jkreps" created="Mon, 11 Feb 2013 20:02:15 +0000"  >&lt;p&gt;Also&lt;br/&gt;
c. Think through how any generalization would work (e.g. (1) can&apos;t really be extended beyond partitions because the partitions are at the top level of the object.&lt;br/&gt;
d. Standardize capitalization: we have dashes, underscores, camel case and pretty much everything else&lt;br/&gt;
e: Document them and going forward add to the documentation. This will ensure future additions are thought through holistically with all the other structures.&lt;/p&gt;</comment>
                            <comment id="13577218" author="junrao" created="Wed, 13 Feb 2013 00:31:39 +0000"  >&lt;p&gt;Proposed the new format in &lt;a href=&quot;https://cwiki.apache.org/confluence/display/KAFKA/Kafka+data+structures+in+Zookeeper&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/KAFKA/Kafka+data+structures+in+Zookeeper&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13579377" author="junrao" created="Fri, 15 Feb 2013 18:14:39 +0000"  >&lt;p&gt;Updated the wiki. We need to patch value for the following path too.&lt;/p&gt;

&lt;p&gt;Consumer registration:&lt;/p&gt;

&lt;p&gt;/consumers/&lt;span class=&quot;error&quot;&gt;&amp;#91;groupId&amp;#93;&lt;/span&gt;/ids/&lt;span class=&quot;error&quot;&gt;&amp;#91;consumerId&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13582795" author="nehanarkhede" created="Thu, 21 Feb 2013 01:52:39 +0000"  >&lt;p&gt;I updated the wiki with the proposed zookeeper path and format changes for preferred replica election and partition reassignment&lt;/p&gt;</comment>
                            <comment id="13582990" author="swapnilghike" created="Thu, 21 Feb 2013 07:52:53 +0000"  >&lt;p&gt;This patch standardizes the reading and writing to zookeeper values according to the JSON schemas 1 thru 8 defined in the aforementioned wiki. &lt;/p&gt;

&lt;p&gt;The changes in this patch involve a bunch of refactoring to make this standardization possible. &lt;/p&gt;

&lt;p&gt;This patch does not touch any other use of JSON-like structures in the code that does not involve interacting with zookeeper.&lt;/p&gt;

&lt;p&gt;Testing done:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Unit tests pass.&lt;/li&gt;
	&lt;li&gt;Nuke all the zookeeper data. Start kafka server, produce data using a producer and start a consumer. Observe the zookeeper data.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It would be good if we could check in this 1st patch and let the system test run over it. I will create another patch to make the changes for item 9 and 10 in the wiki as and when my hands are free of other blockers. 9 and 10 will be used only by our tools and are standalone changes in the sense that we can simply delete and recreate the related zookeeper namespaces without disturbing our clients.&lt;/p&gt;</comment>
                            <comment id="13583829" author="junrao" created="Fri, 22 Feb 2013 02:24:32 +0000"  >&lt;p&gt;Thanks for the patch. Some comments.&lt;/p&gt;

&lt;p&gt;1. Broker.createBroker(): We should catch all json parsing related exceptions and throw a KafkaException with the problematic json string in it.&lt;/p&gt;

&lt;p&gt;2. ZkUtils.partitionReplicasZkData: should we rename it to replicaAssignmentZkData?&lt;/p&gt;

&lt;p&gt;3. TopicCount: Instead of throwing RuntimeException when hitting json errors, it&apos;s probably better to throw KafkaException.&lt;/p&gt;

&lt;p&gt;4. Utils:&lt;br/&gt;
4.1 I recommend rename putStringValuesInJsonObject() to mapToJson().&lt;br/&gt;
4.2 I recommend rename putStringSeqInJsonArray() to arrayToJson() and add a valueAsString flag too.&lt;br/&gt;
4.3 recommend rename putIntSeqValuesInJson() to mapWithSeqValuesToJson()&lt;/p&gt;

&lt;p&gt;5. ZkUtils:&lt;br/&gt;
5.1 registerBrokerInZK(): broker is no longer referenced&lt;br/&gt;
5.2 There are 2 getReplicaAssignmentForTopics methods and the following one is not used. Let&apos;s remove it.&lt;br/&gt;
  def getReplicaAssignmentForTopics(zkClient: ZkClient, topics: Iterator&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;):&lt;/p&gt;

&lt;p&gt;6. ZookeeperConsumerConnector: the line calling mergeJsonObjects is too long&lt;/p&gt;

&lt;p&gt;7.ZookeeperConsumerConnectorTest: no real change&lt;/p&gt;

&lt;p&gt;8. The following map is not sorted by field names.&lt;br/&gt;
/consumers/console-consumer-8915/ids/console-consumer-8915_jrao-ld-1361498895428-3268a767&lt;br/&gt;
{ &quot;subscription&quot;:&lt;/p&gt;
{ &quot;*test&quot; : 1 }
&lt;p&gt;, &quot;version&quot;:1, &quot;pattern&quot;:&quot;white_list&quot; }&lt;/p&gt;</comment>
                            <comment id="13584040" author="swapnilghike" created="Fri, 22 Feb 2013 07:12:35 +0000"  >&lt;p&gt;Addressed all points.&lt;/p&gt;

&lt;p&gt;i. Renamed valueAsString flag to valueInQuotes for clarity.&lt;br/&gt;
ii. Json fields should appear in sorted order now.&lt;br/&gt;
iii. Changed the whitelist/blacklist detection to use the &quot;pattern&quot; field in the zk json. Accordingly modified the createTopicCount and dbString methods.&lt;/p&gt;

&lt;p&gt;Testing done -&lt;br/&gt;
1. Testing done for v1 patch.&lt;br/&gt;
2. Tried all of non-wildcard, whitelist and blacklist topics with console consumer. Zk data looks ok (it does not include * for non-wildcard topics). Also changed the wiki to reflect this, previously it had entries like &quot;*abc&quot; and &quot;!abc&quot; for wildcard consumer subscription fields.&lt;/p&gt;
</comment>
                            <comment id="13584369" author="junrao" created="Fri, 22 Feb 2013 15:59:33 +0000"  >&lt;p&gt;Thanks for patch v2. A few more comments.&lt;/p&gt;

&lt;p&gt;20. Broker: Can we add brokerInfoString in the following exception?&lt;br/&gt;
throw new KafkaException(&quot;Failed to parse the broker info from zookeeper&quot;, t)&lt;/p&gt;

&lt;p&gt;21. TopicCount:&lt;br/&gt;
21.1 Can we define &quot;white_list&quot; and &quot;black_list&quot; as constants and reference only the constants instead of the strings?&lt;br/&gt;
21.2 Can we rename specialList to subscriptionPattern?&lt;/p&gt;

&lt;p&gt;22. Utils: The comment for mapWithSeqValuesToJson() needs to be changed.&lt;/p&gt;

&lt;p&gt;Could you rebase too?&lt;/p&gt;
</comment>
                            <comment id="13584857" author="swapnilghike" created="Sat, 23 Feb 2013 00:09:25 +0000"  >&lt;p&gt;Made the changes and rebased. &lt;/p&gt;

&lt;p&gt;writePreferredReplicaElectionData is a bit clunky to read currently, I will take care of it while completing the remaining changes for items 9 adn 10.&lt;/p&gt;</comment>
                            <comment id="13584893" author="junrao" created="Sat, 23 Feb 2013 00:44:39 +0000"  >&lt;p&gt;Thanks for patch v3. +1 and committed to 0.8 branch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12570277" name="kafka-755-v1.patch" size="48034" author="swapnilghike" created="Thu, 21 Feb 2013 07:52:53 +0000"/>
                            <attachment id="12570433" name="kafka-755-v2.patch" size="48425" author="swapnilghike" created="Fri, 22 Feb 2013 07:12:35 +0000"/>
                            <attachment id="12570562" name="kafka-755-v3.patch" size="48773" author="swapnilghike" created="Sat, 23 Feb 2013 00:09:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312257</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hvxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312603</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>