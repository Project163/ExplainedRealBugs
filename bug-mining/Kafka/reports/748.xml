<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 16:44:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-2351] Brokers are having a problem shutting down correctly</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-2351</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;The run() in Acceptor during shutdown might throw an exception that is not caught and it never reaches shutdownComplete due to which the latch is not counted down and the broker will not be able to shutdown.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12846432">KAFKA-2351</key>
            <summary>Brokers are having a problem shutting down correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgharat">Mayuresh Gharat</assignee>
                                    <reporter username="mgharat">Mayuresh Gharat</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Jul 2015 03:41:05 +0000</created>
                <updated>Wed, 26 Aug 2015 00:51:45 +0000</updated>
                            <resolved>Wed, 26 Aug 2015 00:51:45 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14635734" author="mgharat" created="Tue, 21 Jul 2015 20:11:13 +0000"  >&lt;p&gt;Created reviewboard &lt;a href=&quot;https://reviews.apache.org/r/36652/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/36652/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14635885" author="mgharat" created="Tue, 21 Jul 2015 21:58:20 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/36652/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/36652/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14638076" author="mgharat" created="Thu, 23 Jul 2015 02:26:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guozhang&quot; class=&quot;user-hover&quot; rel=&quot;guozhang&quot;&gt;guozhang&lt;/a&gt; can you take a look at this? &lt;/p&gt;</comment>
                            <comment id="14638991" author="ijuma" created="Thu, 23 Jul 2015 15:30:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgharat&quot; class=&quot;user-hover&quot; rel=&quot;mgharat&quot;&gt;mgharat&lt;/a&gt;, did you see the discussion around exceptions in the review for &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-2353&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/KAFKA-2353&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="14639097" author="mgharat" created="Thu, 23 Jul 2015 16:32:12 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ijuma&quot; class=&quot;user-hover&quot; rel=&quot;ijuma&quot;&gt;ijuma&lt;/a&gt;, thanks a lot for pointing me towards this. I will think more on this and upload a new patch.&lt;/p&gt;</comment>
                            <comment id="14639910" author="mgharat" created="Fri, 24 Jul 2015 04:36:59 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/36652/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/36652/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14641009" author="mgharat" created="Fri, 24 Jul 2015 20:09:41 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt;,&lt;br/&gt;
Thanks for the comments on the patch. &lt;br/&gt;
I have replied to your concerns on the RB. Would you mind taking another look? I will upload a new patch accordingly.&lt;/p&gt;
</comment>
                            <comment id="14644934" author="guozhang" created="Tue, 28 Jul 2015 19:50:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgharat&quot; class=&quot;user-hover&quot; rel=&quot;mgharat&quot;&gt;mgharat&lt;/a&gt; Could you change the status to &quot;Patch Available&quot; if you think it is ready for review again? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; will help reviewing it.&lt;/p&gt;</comment>
                            <comment id="14654691" author="mgharat" created="Wed, 5 Aug 2015 02:14:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt; would you mind taking another look at this. I have replied to your comments on the RB. &lt;/p&gt;</comment>
                            <comment id="14654927" author="sslavic" created="Wed, 5 Aug 2015 07:15:47 +0000"  >&lt;p&gt;Running single instance of Kafka broker from latest trunk I experienced this not so successful controlled shutdown:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[2015-08-05 00:19:09,998] INFO [Offset Manager on Broker 0]: Removed 0 expired offsets in 0 milliseconds. (kafka.server.OffsetManager)
^C[2015-08-05 00:23:09,144] INFO [Kafka Server 0], shutting down (kafka.server.KafkaServer)
[2015-08-05 00:23:09,146] INFO [Kafka Server 0], Starting controlled shutdown (kafka.server.KafkaServer)
[2015-08-05 00:23:09,155] ERROR [KafkaApi-0] error when handling request Name: ControlledShutdownRequest; Version: 0; CorrelationId: 0; BrokerId: 0 (kafka.server.KafkaApis)
kafka.common.ControllerMovedException: Controller moved to another broker. Aborting controlled shutdown
	at kafka.controller.KafkaController.shutdownBroker(KafkaController.scala:231)
	at kafka.server.KafkaApis.handleControlledShutdownRequest(KafkaApis.scala:146)
	at kafka.server.KafkaApis.handle(KafkaApis.scala:63)
	at kafka.server.KafkaRequestHandler.run(KafkaRequestHandler.scala:60)
	at java.lang.Thread.run(Thread.java:745)
[2015-08-05 00:23:09,156] INFO [Kafka Server 0], Remaining partitions to move:  (kafka.server.KafkaServer)
[2015-08-05 00:23:09,156] INFO [Kafka Server 0], Error code from controller: -1 (kafka.server.KafkaServer)
[2015-08-05 00:23:14,160] WARN [Kafka Server 0], Retrying controlled shutdown after the previous attempt failed... (kafka.server.KafkaServer)
[2015-08-05 00:23:14,166] ERROR [KafkaApi-0] error when handling request Name: ControlledShutdownRequest; Version: 0; CorrelationId: 1; BrokerId: 0 (kafka.server.KafkaApis)
kafka.common.ControllerMovedException: Controller moved to another broker. Aborting controlled shutdown
	at kafka.controller.KafkaController.shutdownBroker(KafkaController.scala:231)
	at kafka.server.KafkaApis.handleControlledShutdownRequest(KafkaApis.scala:146)
	at kafka.server.KafkaApis.handle(KafkaApis.scala:63)
	at kafka.server.KafkaRequestHandler.run(KafkaRequestHandler.scala:60)
	at java.lang.Thread.run(Thread.java:745)
[2015-08-05 00:23:14,167] INFO [Kafka Server 0], Remaining partitions to move:  (kafka.server.KafkaServer)
[2015-08-05 00:23:14,167] INFO [Kafka Server 0], Error code from controller: -1 (kafka.server.KafkaServer)
[2015-08-05 00:23:19,169] WARN [Kafka Server 0], Retrying controlled shutdown after the previous attempt failed... (kafka.server.KafkaServer)
[2015-08-05 00:23:19,172] ERROR [KafkaApi-0] error when handling request Name: ControlledShutdownRequest; Version: 0; CorrelationId: 2; BrokerId: 0 (kafka.server.KafkaApis)
kafka.common.ControllerMovedException: Controller moved to another broker. Aborting controlled shutdown
	at kafka.controller.KafkaController.shutdownBroker(KafkaController.scala:231)
	at kafka.server.KafkaApis.handleControlledShutdownRequest(KafkaApis.scala:146)
	at kafka.server.KafkaApis.handle(KafkaApis.scala:63)
	at kafka.server.KafkaRequestHandler.run(KafkaRequestHandler.scala:60)
	at java.lang.Thread.run(Thread.java:745)
[2015-08-05 00:23:19,173] INFO [Kafka Server 0], Remaining partitions to move:  (kafka.server.KafkaServer)
[2015-08-05 00:23:19,173] INFO [Kafka Server 0], Error code from controller: -1 (kafka.server.KafkaServer)
[2015-08-05 00:23:24,176] WARN [Kafka Server 0], Retrying controlled shutdown after the previous attempt failed... (kafka.server.KafkaServer)
[2015-08-05 00:23:24,177] WARN [Kafka Server 0], Proceeding to do an unclean shutdown as all the controlled shutdown attempts failed (kafka.server.KafkaServer)
[2015-08-05 00:23:24,180] INFO [Socket Server on Broker 0], Shutting down (kafka.network.SocketServer)
[2015-08-05 00:23:24,189] INFO [Socket Server on Broker 0], Shutdown completed (kafka.network.SocketServer)
[2015-08-05 00:23:24,190] INFO [Kafka Request Handler on Broker 0], shutting down (kafka.server.KafkaRequestHandlerPool)
[2015-08-05 00:23:24,193] INFO [Kafka Request Handler on Broker 0], shut down completely (kafka.server.KafkaRequestHandlerPool)
[2015-08-05 00:23:24,196] INFO [Replica Manager on Broker 0]: Shutting down (kafka.server.ReplicaManager)
[2015-08-05 00:23:24,196] INFO [ReplicaFetcherManager on broker 0] shutting down (kafka.server.ReplicaFetcherManager)
[2015-08-05 00:23:24,197] INFO [ReplicaFetcherManager on broker 0] shutdown completed (kafka.server.ReplicaFetcherManager)
[2015-08-05 00:23:24,197] INFO [ExpirationReaper-0], Shutting down (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)
[2015-08-05 00:23:24,310] INFO [ExpirationReaper-0], Stopped  (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)
[2015-08-05 00:23:24,310] INFO [ExpirationReaper-0], Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)
[2015-08-05 00:23:24,310] INFO [ExpirationReaper-0], Shutting down (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)
[2015-08-05 00:23:24,413] INFO [ExpirationReaper-0], Stopped  (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)
[2015-08-05 00:23:24,413] INFO [ExpirationReaper-0], Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)
[2015-08-05 00:23:24,420] INFO [Replica Manager on Broker 0]: Shut down completely (kafka.server.ReplicaManager)
[2015-08-05 00:23:24,421] INFO Shutting down. (kafka.log.LogManager)
[2015-08-05 00:23:24,451] INFO Shutdown complete. (kafka.log.LogManager)
[2015-08-05 00:23:24,452] INFO [ConsumerCoordinator 0]: Shutting down. (kafka.coordinator.ConsumerCoordinator)
[2015-08-05 00:23:24,453] INFO [ExpirationReaper-0], Shutting down (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)
[2015-08-05 00:23:24,494] INFO [ExpirationReaper-0], Stopped  (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)
[2015-08-05 00:23:24,494] INFO [ExpirationReaper-0], Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)
[2015-08-05 00:23:24,494] INFO [ExpirationReaper-0], Shutting down (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)
[2015-08-05 00:23:24,513] INFO [ExpirationReaper-0], Stopped  (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)
[2015-08-05 00:23:24,513] INFO [ExpirationReaper-0], Shutdown completed (kafka.server.DelayedOperationPurgatory$ExpiredOperationReaper)
[2015-08-05 00:23:24,514] INFO [ConsumerCoordinator 0]: Shutdown complete. (kafka.coordinator.ConsumerCoordinator)
[2015-08-05 00:23:24,517] INFO Terminate ZkClient event thread. (org.I0Itec.zkclient.ZkEventThread)
[2015-08-05 00:23:24,602] INFO Session: 0x14ef8883c9e0008 closed (org.apache.zookeeper.ZooKeeper)
[2015-08-05 00:23:24,602] INFO EventThread shut down (org.apache.zookeeper.ClientCnxn)
[2015-08-05 00:23:24,602] INFO [Kafka Server 0], shut down completed (kafka.server.KafkaServer)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is that unwanted behavior (going to be) handled by this ticket?&lt;/p&gt;</comment>
                            <comment id="14658749" author="mgharat" created="Wed, 5 Aug 2015 19:47:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sslavic&quot; class=&quot;user-hover&quot; rel=&quot;sslavic&quot;&gt;sslavic&lt;/a&gt; I think this is different. Thanks for reporting this. Let me see if I can address this in the current patch. &lt;/p&gt;</comment>
                            <comment id="14659235" author="junrao" created="Thu, 6 Aug 2015 00:06:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgharat&quot; class=&quot;user-hover&quot; rel=&quot;mgharat&quot;&gt;mgharat&lt;/a&gt;, sorry the delay. Just replied on RB.&lt;/p&gt;</comment>
                            <comment id="14660361" author="mgharat" created="Thu, 6 Aug 2015 17:11:05 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=junrao&quot; class=&quot;user-hover&quot; rel=&quot;junrao&quot;&gt;junrao&lt;/a&gt;. I will see if I can address the issue reported by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sslavic&quot; class=&quot;user-hover&quot; rel=&quot;sslavic&quot;&gt;sslavic&lt;/a&gt; quickly. If I can, I will upload a new patch else will do it in another ticket.&lt;/p&gt;</comment>
                            <comment id="14695859" author="mgharat" created="Thu, 13 Aug 2015 20:10:11 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/36652/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/36652/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14710205" author="mgharat" created="Mon, 24 Aug 2015 22:50:48 +0000"  >&lt;p&gt;Updated reviewboard &lt;a href=&quot;https://reviews.apache.org/r/36652/diff/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://reviews.apache.org/r/36652/diff/&lt;/a&gt;&lt;br/&gt;
 against branch origin/trunk&lt;/p&gt;</comment>
                            <comment id="14712270" author="jjkoshy" created="Wed, 26 Aug 2015 00:51:45 +0000"  >&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12746410" name="KAFKA-2351.patch" size="2741" author="mgharat" created="Tue, 21 Jul 2015 20:11:13 +0000"/>
                            <attachment id="12746427" name="KAFKA-2351_2015-07-21_14:58:13.patch" size="5139" author="mgharat" created="Tue, 21 Jul 2015 21:58:19 +0000"/>
                            <attachment id="12746947" name="KAFKA-2351_2015-07-23_21:36:52.patch" size="6852" author="mgharat" created="Fri, 24 Jul 2015 04:36:59 +0000"/>
                            <attachment id="12750368" name="KAFKA-2351_2015-08-13_13:10:05.patch" size="10701" author="mgharat" created="Thu, 13 Aug 2015 20:10:11 +0000"/>
                            <attachment id="12752099" name="KAFKA-2351_2015-08-24_15:50:41.patch" size="3510" author="mgharat" created="Mon, 24 Aug 2015 22:50:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hh7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_10022" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Reviewer</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>junrao</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>