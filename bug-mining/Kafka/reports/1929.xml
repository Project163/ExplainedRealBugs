<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:11:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6743] ConsumerPerformance fails to consume all messages on topics with large number of partitions</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6743</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;ConsumerPerformance fails to consume all messages on topics with large number of partitions due to a relatively short default polling loop timeout (1000 ms) that is not reachable and modifiable by the end user.&lt;/p&gt;

&lt;p&gt;Demo: Create a topic of 10 000 partitions, send a 50 000 000 of 100 byte records using kafka-producer-perf-test and consume them using kafka-consumer-perf-test (ConsumerPerformance). You will likely notice that the number of records returned by the kafka-consumer-perf-test is many times less than expected 50 000 000. This happens due to specific ConsumerPerformance implementation. As the result, in some rough cases it may take a long enough time to process/iterate through the records polled in batches, thus, the time may exceed the default hardcoded polling loop timeout and this is probably not what we want from this utility.&lt;/p&gt;

&lt;p&gt;We have two options: &lt;br/&gt;
1) Increasing polling loop timeout in ConsumerPerformance implementation. It defaults to 1000 ms and is hardcoded, thus cannot be changed but we could export it as an OPTIONAL kafka-consumer-perf-test parameter to enable it on a script level configuration and available to the end user.&lt;br/&gt;
2) Decreasing max.poll.records on a Consumer config level. This is not a fine option though since we do not want to touch the default settings.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13149752">KAFKA-6743</key>
            <summary>ConsumerPerformance fails to consume all messages on topics with large number of partitions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="alex.dunayevsky">Alex Dunayevsky</assignee>
                                    <reporter username="alex.dunayevsky">Alex Dunayevsky</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Apr 2018 14:32:14 +0000</created>
                <updated>Wed, 3 Oct 2018 09:17:23 +0000</updated>
                            <resolved>Sat, 2 Jun 2018 23:49:23 +0000</resolved>
                                    <version>0.11.0.2</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>core</component>
                    <component>tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16424145" author="alex.dunayevsky" created="Tue, 3 Apr 2018 15:02:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/kafka/pull/4818&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4818&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16493288" author="astubbs" created="Tue, 29 May 2018 09:18:11 +0000"  >&lt;p&gt;Duplicate / relates to &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6225&quot; title=&quot;Add an option to performance consumer consume continuously&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6225&quot;&gt;KAFKA-6225&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16499227" author="githubbot" created="Sat, 2 Jun 2018 23:43:57 +0000"  >&lt;p&gt;hachikuji closed pull request #4818: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6743&quot; title=&quot;ConsumerPerformance fails to consume all messages on topics with large number of partitions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6743&quot;&gt;&lt;del&gt;KAFKA-6743&lt;/del&gt;&lt;/a&gt; ConsumerPerformance fails to consume all messages &lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4818&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4818&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/core/src/main/scala/kafka/tools/ConsumerPerformance.scala b/core/src/main/scala/kafka/tools/ConsumerPerformance.scala&lt;br/&gt;
index 7e0dbcbe064..64a3305d8e5 100644&lt;br/&gt;
&amp;#8212; a/core/src/main/scala/kafka/tools/ConsumerPerformance.scala&lt;br/&gt;
+++ b/core/src/main/scala/kafka/tools/ConsumerPerformance.scala&lt;br/&gt;
@@ -65,7 +65,7 @@ object ConsumerPerformance extends LazyLogging {&lt;br/&gt;
       val consumer = new KafkaConsumer[Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Byte&amp;#93;&lt;/span&gt;, Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Byte&amp;#93;&lt;/span&gt;](config.props)&lt;br/&gt;
       consumer.subscribe(Collections.singletonList(config.topic))&lt;br/&gt;
       startMs = System.currentTimeMillis&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;consume(consumer, List(config.topic), config.numMessages, 1000, config, totalMessagesRead, totalBytesRead, joinGroupTimeInMs, startMs)&lt;br/&gt;
+      consume(consumer, List(config.topic), config.numMessages, config.recordFetchTimeoutMs, config, totalMessagesRead, totalBytesRead, joinGroupTimeInMs, startMs)&lt;br/&gt;
       endMs = System.currentTimeMillis&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;       if (config.printMetrics) {&lt;br/&gt;
@@ -188,6 +188,9 @@ object ConsumerPerformance extends LazyLogging {&lt;br/&gt;
       }&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;+    if (messagesRead &amp;lt; count)&lt;br/&gt;
+      println(s&quot;WARNING: Exiting before consuming the expected number of messages: timeout ($timeout ms) exceeded. &quot; +&lt;br/&gt;
+        &quot;You can use the --timeout option to increase the timeout.&quot;))&lt;br/&gt;
     totalMessagesRead.set(messagesRead)&lt;br/&gt;
     totalBytesRead.set(bytesRead)&lt;br/&gt;
   }&lt;br/&gt;
@@ -302,6 +305,11 @@ object ConsumerPerformance extends LazyLogging {&lt;br/&gt;
     val printMetricsOpt = parser.accepts(&quot;print-metrics&quot;, &quot;Print out the metrics. This only applies to new consumer.&quot;)&lt;br/&gt;
     val showDetailedStatsOpt = parser.accepts(&quot;show-detailed-stats&quot;, &quot;If set, stats are reported for each reporting &quot; +&lt;br/&gt;
       &quot;interval as configured by reporting-interval&quot;)&lt;br/&gt;
+    val recordFetchTimeoutOpt = parser.accepts(&quot;timeout&quot;, &quot;The maximum allowed time in milliseconds between returned records.&quot;)&lt;br/&gt;
+      .withOptionalArg()&lt;br/&gt;
+      .describedAs(&quot;milliseconds&quot;)&lt;br/&gt;
+      .ofType(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Long&amp;#93;&lt;/span&gt;)&lt;br/&gt;
+      .defaultsTo(10000)&lt;/p&gt;

&lt;p&gt;     val options = parser.parse(args: _*)&lt;/p&gt;

&lt;p&gt;@@ -354,6 +362,7 @@ object ConsumerPerformance extends LazyLogging &lt;/p&gt;
{
     val showDetailedStats = options.has(showDetailedStatsOpt)
     val dateFormat = new SimpleDateFormat(options.valueOf(dateFormatOpt))
     val hideHeader = options.has(hideHeaderOpt)
+    val recordFetchTimeoutMs = options.valueOf(recordFetchTimeoutOpt).longValue()
   }

&lt;p&gt;   class ConsumerPerfThread(threadId: Int,&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 24 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3s3cn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>