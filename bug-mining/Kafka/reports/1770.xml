<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:05:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-6318] StreamsResetter should return non-zero return code on error</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-6318</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;If users specify a non-existing topic as input parameter,  &lt;tt&gt;StreamsResetter&lt;/tt&gt; only prints out an error message that the topic was not found, but return code is still zero. We should return a non-zero return code for this case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13123281">KAFKA-6318</key>
            <summary>StreamsResetter should return non-zero return code on error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sssanthalingam">siva santhalingam</assignee>
                                    <reporter username="mjsax">Matthias J. Sax</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Dec 2017 19:34:03 +0000</created>
                <updated>Tue, 2 Jan 2018 18:47:10 +0000</updated>
                            <resolved>Tue, 2 Jan 2018 18:47:10 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>streams</component>
                    <component>tools</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16282932" author="sssanthalingam" created="Fri, 8 Dec 2017 02:08:54 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mjsax&quot; class=&quot;user-hover&quot; rel=&quot;mjsax&quot;&gt;mjsax&lt;/a&gt; Can i assign this to myself. Also maybeResetInputAndSeekToEndIntermediateTopicOffsets is the only method that needs to be changed right ? Please let me know if I&apos;m missing something ?&lt;/p&gt;</comment>
                            <comment id="16283954" author="githubbot" created="Fri, 8 Dec 2017 18:08:37 +0000"  >&lt;p&gt;GitHub user shivsantham opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4305&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4305&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6318&quot; title=&quot;StreamsResetter should return non-zero return code on error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6318&quot;&gt;&lt;del&gt;KAFKA-6318&lt;/del&gt;&lt;/a&gt;: StreamsResetter should return non-zero return code on error&lt;/p&gt;

&lt;p&gt;    If users specify a non-existing topic as input parameter, StreamsResetter only prints out an error message that the topic was not found, but return code is still zero. We should return a non-zero return code for this case.&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/shivsantham/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/shivsantham/kafka&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6318&quot; title=&quot;StreamsResetter should return non-zero return code on error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6318&quot;&gt;&lt;del&gt;KAFKA-6318&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/4305.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4305.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4305&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a9696d03bd6f9e03071b3d76b3ad51a411766557&lt;br/&gt;
Author: siva santhalingam &amp;lt;siva.santhalingam@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-12-08T18:05:55Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6318&quot; title=&quot;StreamsResetter should return non-zero return code on error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6318&quot;&gt;&lt;del&gt;KAFKA-6318&lt;/del&gt;&lt;/a&gt;: StreamsResetter should return non-zero return code on error&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16284083" author="mjsax" created="Fri, 8 Dec 2017 19:25:44 +0000"  >&lt;p&gt;Of course you can assign tickets to yourself if it&apos;s unassigned.&lt;/p&gt;</comment>
                            <comment id="16308490" author="githubbot" created="Tue, 2 Jan 2018 18:46:00 +0000"  >&lt;p&gt;guozhangwang closed pull request #4305: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-6318&quot; title=&quot;StreamsResetter should return non-zero return code on error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-6318&quot;&gt;&lt;del&gt;KAFKA-6318&lt;/del&gt;&lt;/a&gt;: StreamsResetter should return non-zero return code on error&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/4305&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/4305&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/core/src/main/scala/kafka/tools/StreamsResetter.java b/core/src/main/scala/kafka/tools/StreamsResetter.java&lt;br/&gt;
index 4851a948399..4496876e09a 100644&lt;br/&gt;
&amp;#8212; a/core/src/main/scala/kafka/tools/StreamsResetter.java&lt;br/&gt;
+++ b/core/src/main/scala/kafka/tools/StreamsResetter.java&lt;br/&gt;
@@ -130,7 +130,7 @@ public int run(final String[] args,&lt;/p&gt;

&lt;p&gt;             final HashMap&amp;lt;Object, Object&amp;gt; consumerConfig = new HashMap&amp;lt;&amp;gt;(config);&lt;br/&gt;
             consumerConfig.putAll(properties);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;maybeResetInputAndSeekToEndIntermediateTopicOffsets(consumerConfig, dryRun);&lt;br/&gt;
+            exitCode = maybeResetInputAndSeekToEndIntermediateTopicOffsets(consumerConfig, dryRun);&lt;br/&gt;
             maybeDeleteInternalTopics(kafkaAdminClient, dryRun);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         } catch (final Throwable e) {&lt;br/&gt;
@@ -237,9 +237,10 @@ private void parseArguments(final String[] args) throws IOException &lt;/p&gt;
{
         CommandLineUtils.checkInvalidArgs(optionParser, options, shiftByOption, allScenarioOptions.$minus(shiftByOption));
     }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private void maybeResetInputAndSeekToEndIntermediateTopicOffsets(final Map consumerConfig, final boolean dryRun) throws Exception {&lt;br/&gt;
+    private int maybeResetInputAndSeekToEndIntermediateTopicOffsets(final Map consumerConfig, final boolean dryRun) throws Exception {&lt;br/&gt;
         final List&amp;lt;String&amp;gt; inputTopics = options.valuesOf(inputTopicsOption);&lt;br/&gt;
         final List&amp;lt;String&amp;gt; intermediateTopics = options.valuesOf(intermediateTopicsOption);&lt;br/&gt;
+        int topicNotFound = EXIT_CODE_SUCCESS;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         final List&amp;lt;String&amp;gt; notFoundInputTopics = new ArrayList&amp;lt;&amp;gt;();&lt;br/&gt;
         final List&amp;lt;String&amp;gt; notFoundIntermediateTopics = new ArrayList&amp;lt;&amp;gt;();&lt;br/&gt;
@@ -248,7 +249,7 @@ private void maybeResetInputAndSeekToEndIntermediateTopicOffsets(final Map consu&lt;/p&gt;

&lt;p&gt;         if (inputTopics.size() == 0 &amp;amp;&amp;amp; intermediateTopics.size() == 0) &lt;/p&gt;
{
             System.out.println(&quot;No input or intermediate topics specified. Skipping seek.&quot;);
-            return;
+            return EXIT_CODE_SUCCESS;
         }

&lt;p&gt;         if (inputTopics.size() != 0) {&lt;br/&gt;
@@ -316,6 +317,7 @@ private void maybeResetInputAndSeekToEndIntermediateTopicOffsets(final Map consu&lt;br/&gt;
                 for (final String topic : notFoundInputTopics) &lt;/p&gt;
{
                     System.out.println(&quot;Topic: &quot; + topic);
                 }
&lt;p&gt;+                topicNotFound = EXIT_CODE_ERROR;&lt;br/&gt;
             }&lt;/p&gt;

&lt;p&gt;             if (notFoundIntermediateTopics.size() &amp;gt; 0) &lt;/p&gt;
{
@@ -330,6 +332,7 @@ private void maybeResetInputAndSeekToEndIntermediateTopicOffsets(final Map consu
             throw e;
         }
&lt;p&gt;         System.out.println(&quot;Done.&quot;);&lt;br/&gt;
+        return topicNotFound;&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;     // visible for testing&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/integration/AbstractResetIntegrationTest.java b/streams/src/test/java/org/apache/kafka/streams/integration/AbstractResetIntegrationTest.java&lt;br/&gt;
index 9131007b6bc..26673ca1926 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/integration/AbstractResetIntegrationTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/integration/AbstractResetIntegrationTest.java&lt;br/&gt;
@@ -73,6 +73,7 @@&lt;br/&gt;
     private static final String OUTPUT_TOPIC_2 = &quot;outputTopic2&quot;;&lt;br/&gt;
     private static final String OUTPUT_TOPIC_2_RERUN = &quot;outputTopic2_rerun&quot;;&lt;br/&gt;
     private static final String INTERMEDIATE_USER_TOPIC = &quot;userTopic&quot;;&lt;br/&gt;
+    private static final String NON_EXISTING_TOPIC = &quot;nonExistingTopic2&quot;;&lt;/p&gt;

&lt;p&gt;     private static final long STREAMS_CONSUMER_TIMEOUT = 2000L;&lt;br/&gt;
     private static final long CLEANUP_CONSUMER_TIMEOUT = 2000L;&lt;br/&gt;
@@ -612,6 +613,30 @@ private void cleanGlobal(final Properties sslConfig,&lt;br/&gt;
         Assert.assertEquals(0, exitCode);&lt;br/&gt;
     }&lt;/p&gt;

&lt;p&gt;+    void shouldNotAllowToResetWhileStreamsIsRunning() throws Exception &lt;/p&gt;
{
+
+        final Properties streamsConfiguration = prepareTest();
+        final List&amp;lt;String&amp;gt; parameterList = new ArrayList&amp;lt;&amp;gt;(
+                Arrays.asList(&quot;--application-id&quot;, APP_ID + testNo,
+                        &quot;--bootstrap-servers&quot;, bootstrapServers,
+                        &quot;--input-topics&quot;, NON_EXISTING_TOPIC));
+
+        final String[] parameters = parameterList.toArray(new String[parameterList.size()]);
+        final Properties cleanUpConfig = new Properties();
+        cleanUpConfig.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, 100);
+        cleanUpConfig.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, &quot;&quot; + CLEANUP_CONSUMER_TIMEOUT);
+
+        // RUN
+        KafkaStreams streams = new KafkaStreams(setupTopologyWithoutIntermediateUserTopic(), streamsConfiguration);
+        streams.start();
+
+        final int exitCode = new StreamsResetter().run(parameters, cleanUpConfig);
+        Assert.assertEquals(1, exitCode);
+
+        streams.close();
+
+    }
&lt;p&gt;+&lt;br/&gt;
     private void assertInternalTopicsGotDeleted(final String intermediateUserTopic) throws Exception {&lt;br/&gt;
         // do not use list topics request, but read from the embedded cluster&apos;s zookeeper path directly to confirm&lt;br/&gt;
         if (intermediateUserTopic != null) {&lt;br/&gt;
diff --git a/streams/src/test/java/org/apache/kafka/streams/integration/ResetIntegrationTest.java b/streams/src/test/java/org/apache/kafka/streams/integration/ResetIntegrationTest.java&lt;br/&gt;
index d781d95c9c6..ef9a67dce75 100644&lt;br/&gt;
&amp;#8212; a/streams/src/test/java/org/apache/kafka/streams/integration/ResetIntegrationTest.java&lt;br/&gt;
+++ b/streams/src/test/java/org/apache/kafka/streams/integration/ResetIntegrationTest.java&lt;br/&gt;
@@ -18,14 +18,21 @@&lt;/p&gt;

&lt;p&gt; import kafka.server.KafkaConfig$;&lt;br/&gt;
 import org.apache.kafka.streams.integration.utils.EmbeddedKafkaCluster;&lt;br/&gt;
+import org.apache.kafka.clients.consumer.ConsumerConfig;&lt;br/&gt;
 import org.apache.kafka.test.IntegrationTest;&lt;br/&gt;
 import org.junit.AfterClass;&lt;br/&gt;
+import org.junit.Assert;&lt;br/&gt;
 import org.junit.Before;&lt;br/&gt;
 import org.junit.ClassRule;&lt;br/&gt;
 import org.junit.Test;&lt;br/&gt;
 import org.junit.experimental.categories.Category;&lt;br/&gt;
+import kafka.tools.StreamsResetter;&lt;/p&gt;

&lt;p&gt; import java.util.Properties;&lt;br/&gt;
+import java.util.Arrays;&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+&lt;/p&gt;

&lt;p&gt; /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Tests local state store and global application cleanup.&lt;br/&gt;
@@ -35,6 +42,10 @@&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @ClassRule&lt;br/&gt;
     public static final EmbeddedKafkaCluster CLUSTER;&lt;br/&gt;
+    private static final long CLEANUP_CONSUMER_TIMEOUT = 2000L;&lt;br/&gt;
+    private static final String APP_ID = &quot;Integration-test&quot;;&lt;br/&gt;
+    private static final String NON_EXISTING_TOPIC = &quot;nonExistingTopic&quot;;&lt;br/&gt;
+    private static int testNo = 1;&lt;/p&gt;

&lt;p&gt;     static {&lt;br/&gt;
         final Properties props = new Properties();&lt;br/&gt;
@@ -81,4 +92,44 @@ public void testReprocessingFromDateTimeAfterResetWithoutIntermediateUserTopic()&lt;br/&gt;
     public void testReprocessingByDurationAfterResetWithoutIntermediateUserTopic() throws Exception &lt;/p&gt;
{
         super.testReprocessingByDurationAfterResetWithoutIntermediateUserTopic();
     }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void shouldNotAllowToResetWhileStreamsRunning() throws Exception &lt;/p&gt;
{
+        super.shouldNotAllowToResetWhileStreamsIsRunning();
+    }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void shouldNotAllowToResetWhenInputTopicAbsent() throws Exception &lt;/p&gt;
{
+
+        final List&amp;lt;String&amp;gt; parameterList = new ArrayList&amp;lt;&amp;gt;(
+                Arrays.asList(&quot;--application-id&quot;, APP_ID + testNo,
+                        &quot;--bootstrap-servers&quot;, bootstrapServers,
+                        &quot;--input-topics&quot;, NON_EXISTING_TOPIC));
+
+        final String[] parameters = parameterList.toArray(new String[parameterList.size()]);
+        final Properties cleanUpConfig = new Properties();
+        cleanUpConfig.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, 100);
+        cleanUpConfig.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, &quot;&quot; + CLEANUP_CONSUMER_TIMEOUT);
+
+        final int exitCode = new StreamsResetter().run(parameters, cleanUpConfig);
+        Assert.assertEquals(1, exitCode);
+    }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void shouldNotAllowToResetWhenIntermediateTopicAbsent() throws Exception &lt;/p&gt;
{
+
+        final List&amp;lt;String&amp;gt; parameterList = new ArrayList&amp;lt;&amp;gt;(
+                Arrays.asList(&quot;--application-id&quot;, APP_ID + testNo,
+                        &quot;--bootstrap-servers&quot;, bootstrapServers,
+                        &quot;--intermediate-topics&quot;, NON_EXISTING_TOPIC));
+
+        final String[] parameters = parameterList.toArray(new String[parameterList.size()]);
+        final Properties cleanUpConfig = new Properties();
+        cleanUpConfig.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, 100);
+        cleanUpConfig.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, &quot;&quot; + CLEANUP_CONSUMER_TIMEOUT);
+
+        final int exitCode = new StreamsResetter().run(parameters, cleanUpConfig);
+        Assert.assertEquals(1, exitCode);
+    }
&lt;p&gt;+&lt;br/&gt;
 }&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nman:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>