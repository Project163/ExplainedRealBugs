<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:14:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-7324] NPE due to lack of SASLExtensions in SASL/OAUTHBEARER</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-7324</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;When there are no SASL extensions in an OAUTHBEARER request (or the callback handler does not support SaslExtensionsCallback) the OAuthBearerSaslClient.retrieveCustomExtensions() method returns null.  This null value is then passed to the OAuthBearerClientInitialResponse constructor, and that results in an NPE:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at org.apache.kafka.common.security.oauthbearer.internals.OAuthBearerClientInitialResponse.validateExtensions(OAuthBearerClientInitialResponse.java:115)&lt;br/&gt;
	at org.apache.kafka.common.security.oauthbearer.internals.OAuthBearerClientInitialResponse.&amp;lt;init&amp;gt;(OAuthBearerClientInitialResponse.java:81)&lt;br/&gt;
	at org.apache.kafka.common.security.oauthbearer.internals.OAuthBearerClientInitialResponse.&amp;lt;init&amp;gt;(OAuthBearerClientInitialResponse.java:75)&lt;br/&gt;
	at org.apache.kafka.common.security.oauthbearer.internals.OAuthBearerSaslClient.evaluateChallenge(OAuthBearerSaslClient.java:99)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13180355">KAFKA-7324</key>
            <summary>NPE due to lack of SASLExtensions in SASL/OAUTHBEARER</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rndgstn">Ron Dagostino</assignee>
                                    <reporter username="rndgstn">Ron Dagostino</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Aug 2018 01:45:29 +0000</created>
                <updated>Wed, 29 Aug 2018 10:17:42 +0000</updated>
                            <resolved>Wed, 29 Aug 2018 10:17:42 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.1.0</fixVersion>
                                    <component>clients</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16588271" author="githubbot" created="Wed, 22 Aug 2018 02:08:12 +0000"  >&lt;p&gt;rondagostino opened a new pull request #5552: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7324&quot; title=&quot;NPE due to lack of SASLExtensions in SASL/OAUTHBEARER&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7324&quot;&gt;&lt;del&gt;KAFKA-7324&lt;/del&gt;&lt;/a&gt;: NPE due to lack of SASLExtensions in SASL/OAUTHBEARER&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/5552&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/5552&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Set empty extensions if null is passed in.&lt;/p&gt;

&lt;p&gt;   Signed-off-by: Ron Dagostino &amp;lt;rndgstn@gmail.com&amp;gt;&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16588541" author="enether" created="Wed, 22 Aug 2018 08:24:56 +0000"  >&lt;p&gt;Hi Ron, I&apos;ve updated the issue to reflect version 2.1, since OAuthBearer SASLExtensions are due to the added then and this is a direct fix to&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7169&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;KAFKA-7169&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16596172" author="githubbot" created="Wed, 29 Aug 2018 10:16:32 +0000"  >&lt;p&gt;rajinisivaram closed pull request #5552: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-7324&quot; title=&quot;NPE due to lack of SASLExtensions in SASL/OAUTHBEARER&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-7324&quot;&gt;&lt;del&gt;KAFKA-7324&lt;/del&gt;&lt;/a&gt;: NPE due to lack of SASLExtensions in SASL/OAUTHBEARER&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/5552&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/5552&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/clients/src/main/java/org/apache/kafka/common/security/auth/SaslExtensions.java b/clients/src/main/java/org/apache/kafka/common/security/auth/SaslExtensions.java&lt;br/&gt;
index 75cac0533ea..c129f1ec400 100644&lt;br/&gt;
&amp;#8212; a/clients/src/main/java/org/apache/kafka/common/security/auth/SaslExtensions.java&lt;br/&gt;
+++ b/clients/src/main/java/org/apache/kafka/common/security/auth/SaslExtensions.java&lt;br/&gt;
@@ -24,6 +24,10 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;A simple immutable value object class holding customizable SASL extensions&lt;br/&gt;
  */&lt;br/&gt;
 public class SaslExtensions {&lt;br/&gt;
+    /**&lt;br/&gt;
+     * An &quot;empty&quot; instance indicating no SASL extensions&lt;br/&gt;
+     */&lt;br/&gt;
+    public static final SaslExtensions NO_SASL_EXTENSIONS = new SaslExtensions(Collections.emptyMap());&lt;br/&gt;
     private final Map&amp;lt;String, String&amp;gt; extensionsMap;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     public SaslExtensions(Map&amp;lt;String, String&amp;gt; extensionsMap) {&lt;br/&gt;
diff --git a/clients/src/main/java/org/apache/kafka/common/security/auth/SaslExtensionsCallback.java b/clients/src/main/java/org/apache/kafka/common/security/auth/SaslExtensionsCallback.java&lt;br/&gt;
index d07be320625..c5bd449e0cc 100644&lt;br/&gt;
&amp;#8212; a/clients/src/main/java/org/apache/kafka/common/security/auth/SaslExtensionsCallback.java&lt;br/&gt;
+++ b/clients/src/main/java/org/apache/kafka/common/security/auth/SaslExtensionsCallback.java&lt;br/&gt;
@@ -17,6 +17,8 @@&lt;/p&gt;

&lt;p&gt; package org.apache.kafka.common.security.auth;&lt;/p&gt;

&lt;p&gt;+import java.util.Objects;&lt;br/&gt;
+&lt;br/&gt;
 import javax.security.auth.callback.Callback;&lt;/p&gt;

&lt;p&gt; /**&lt;br/&gt;
@@ -24,11 +26,14 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;in the SASL exchange.&lt;br/&gt;
  */&lt;br/&gt;
 public class SaslExtensionsCallback implements Callback {&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private SaslExtensions extensions;&lt;br/&gt;
+    private SaslExtensions extensions = SaslExtensions.NO_SASL_EXTENSIONS;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     /**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Returns a 
{@link SaslExtensions} consisting of the extension names and values that are sent by the client to&lt;br/&gt;
-     * the server in the initial client SASL authentication message.&lt;br/&gt;
+     * Returns always non-null {@link SaslExtensions}
&lt;p&gt; consisting of the extension&lt;br/&gt;
+     * names and values that are sent by the client to the server in the initial&lt;br/&gt;
+     * client SASL authentication message. The default value is&lt;br/&gt;
+     * &lt;/p&gt;
{@link SaslExtensions#NO_SASL_EXTENSIONS}
&lt;p&gt; so that if this callback is&lt;br/&gt;
+     * unhandled the client will see a non-null value.&lt;br/&gt;
      */&lt;br/&gt;
     public SaslExtensions extensions() {&lt;br/&gt;
         return extensions;&lt;br/&gt;
@@ -36,8 +41,11 @@ public SaslExtensions extensions() {&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Sets the SASL extensions on this callback.&lt;br/&gt;
+     * &lt;br/&gt;
+     * @param extensions&lt;br/&gt;
+     *            the mandatory extensions to set&lt;br/&gt;
      */&lt;br/&gt;
     public void extensions(SaslExtensions extensions) 
{
-        this.extensions = extensions;
+        this.extensions = Objects.requireNonNull(extensions, &quot;extensions must not be null&quot;);
     }
&lt;p&gt; }&lt;br/&gt;
diff --git a/clients/src/main/java/org/apache/kafka/common/security/oauthbearer/internals/OAuthBearerClientInitialResponse.java b/clients/src/main/java/org/apache/kafka/common/security/oauthbearer/internals/OAuthBearerClientInitialResponse.java&lt;br/&gt;
index ef16ea237d4..a356f0da3dd 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/clients/src/main/java/org/apache/kafka/common/security/oauthbearer/internals/OAuthBearerClientInitialResponse.java&lt;br/&gt;
+++ b/clients/src/main/java/org/apache/kafka/common/security/oauthbearer/internals/OAuthBearerClientInitialResponse.java&lt;br/&gt;
@@ -22,6 +22,7 @@&lt;br/&gt;
 import javax.security.sasl.SaslException;&lt;br/&gt;
 import java.nio.charset.StandardCharsets;&lt;br/&gt;
 import java.util.Map;&lt;br/&gt;
+import java.util.Objects;&lt;br/&gt;
 import java.util.regex.Matcher;&lt;br/&gt;
 import java.util.regex.Pattern;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -58,7 +59,9 @@ public OAuthBearerClientInitialResponse(byte[] response) throws SaslException {&lt;br/&gt;
         if (auth == null)&lt;br/&gt;
             throw new SaslException(&quot;Invalid OAUTHBEARER client first message: &apos;auth&apos; not specified&quot;);&lt;br/&gt;
         properties.remove(AUTH_KEY);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this.saslExtensions = validateExtensions(new SaslExtensions(properties));&lt;br/&gt;
+        SaslExtensions extensions = new SaslExtensions(properties);&lt;br/&gt;
+        validateExtensions(extensions);&lt;br/&gt;
+        this.saslExtensions = extensions;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         Matcher authMatcher = AUTH_PATTERN.matcher(auth);&lt;br/&gt;
         if (!authMatcher.matches())&lt;br/&gt;
@@ -71,16 +74,48 @@ public OAuthBearerClientInitialResponse(byte[] response) throws SaslException &lt;/p&gt;
{
         this.tokenValue = authMatcher.group(&quot;token&quot;);
     }

&lt;p&gt;+    /**&lt;br/&gt;
+     * Constructor&lt;br/&gt;
+     * &lt;br/&gt;
+     * @param tokenValue&lt;br/&gt;
+     *            the mandatory token value&lt;br/&gt;
+     * @param extensions&lt;br/&gt;
+     *            the optional extensions&lt;br/&gt;
+     * @throws SaslException&lt;br/&gt;
+     *             if any extension name or value fails to conform to the required&lt;br/&gt;
+     *             regular expression as defined by the specification, or if the&lt;br/&gt;
+     *             reserved &lt;/p&gt;
{@code auth} appears as a key&lt;br/&gt;
+     */&lt;br/&gt;
     public OAuthBearerClientInitialResponse(String tokenValue, SaslExtensions extensions) throws SaslException {
         this(tokenValue, &quot;&quot;, extensions);
     }&lt;br/&gt;
 &lt;br/&gt;
+    /**&lt;br/&gt;
+     * Constructor&lt;br/&gt;
+     * &lt;br/&gt;
+     * @param tokenValue&lt;br/&gt;
+     *            the mandatory token value&lt;br/&gt;
+     * @param authorizationId&lt;br/&gt;
+     *            the optional authorization ID&lt;br/&gt;
+     * @param extensions&lt;br/&gt;
+     *            the optional extensions&lt;br/&gt;
+     * @throws SaslException&lt;br/&gt;
+     *             if any extension name or value fails to conform to the required&lt;br/&gt;
+     *             regular expression as defined by the specification, or if the&lt;br/&gt;
+     *             reserved {@code auth}
&lt;p&gt; appears as a key&lt;br/&gt;
+     */&lt;br/&gt;
     public OAuthBearerClientInitialResponse(String tokenValue, String authorizationId, SaslExtensions extensions) throws SaslException &lt;/p&gt;
{
-        this.tokenValue = tokenValue;
+        this.tokenValue = Objects.requireNonNull(tokenValue, &quot;token value must not be null&quot;);
         this.authorizationId = authorizationId == null ? &quot;&quot; : authorizationId;
-        this.saslExtensions = validateExtensions(extensions);
+        validateExtensions(extensions);
+        this.saslExtensions = extensions != null ? extensions : SaslExtensions.NO_SASL_EXTENSIONS;
     }

&lt;p&gt;+    /**&lt;br/&gt;
+     * Return the always non-null extensions&lt;br/&gt;
+     * &lt;br/&gt;
+     * @return the always non-null extensions&lt;br/&gt;
+     */&lt;br/&gt;
     public SaslExtensions extensions() &lt;/p&gt;
{
         return saslExtensions;
     }
&lt;p&gt;@@ -97,10 +132,20 @@ public SaslExtensions extensions() &lt;/p&gt;
{
         return message.getBytes(StandardCharsets.UTF_8);
     }

&lt;p&gt;+    /**&lt;br/&gt;
+     * Return the always non-null token value&lt;br/&gt;
+     * &lt;br/&gt;
+     * @return the always non-null toklen value&lt;br/&gt;
+     */&lt;br/&gt;
     public String tokenValue() &lt;/p&gt;
{
         return tokenValue;
     }

&lt;p&gt;+    /**&lt;br/&gt;
+     * Return the always non-null authorization ID&lt;br/&gt;
+     * &lt;br/&gt;
+     * @return the always non-null authorization ID&lt;br/&gt;
+     */&lt;br/&gt;
     public String authorizationId() &lt;/p&gt;
{
         return authorizationId;
     }
&lt;p&gt;@@ -108,10 +153,19 @@ public String authorizationId() {&lt;br/&gt;
     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Validates that the given extensions conform to the standard. They should also not contain the reserve key name 
{@link OAuthBearerClientInitialResponse#AUTH_KEY}
&lt;p&gt;      *&lt;br/&gt;
+     * @param extensions&lt;br/&gt;
+     *            optional extensions to validate&lt;br/&gt;
+     * @throws SaslException&lt;br/&gt;
+     *             if any extension name or value fails to conform to the required&lt;br/&gt;
+     *             regular expression as defined by the specification, or if the&lt;br/&gt;
+     *             reserved &lt;/p&gt;
{@code auth}
&lt;p&gt; appears as a key&lt;br/&gt;
+     *&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;@see &amp;lt;a href=&quot;https://tools.ietf.org/html/rfc7628#section-3.1&quot;&amp;gt;RFC 7628,&lt;/li&gt;
	&lt;li&gt;Section 3.1&amp;lt;/a&amp;gt;&lt;br/&gt;
      */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static SaslExtensions validateExtensions(SaslExtensions extensions) throws SaslException {&lt;br/&gt;
+    public static void validateExtensions(SaslExtensions extensions) throws SaslException 
{
+        if (extensions == null)
+            return;
         if (extensions.map().containsKey(OAuthBearerClientInitialResponse.AUTH_KEY))
             throw new SaslException(&quot;Extension name &quot; + OAuthBearerClientInitialResponse.AUTH_KEY + &quot; is invalid&quot;);
 
@@ -124,7 +178,6 @@ public static SaslExtensions validateExtensions(SaslExtensions extensions) throw
             if (!EXTENSION_VALUE_PATTERN.matcher(extensionValue).matches())
                 throw new SaslException(&quot;Extension value (&quot; + extensionValue + &quot;) for extension &quot; + extensionName + &quot; is invalid&quot;);
         }&lt;/li&gt;
	&lt;li&gt;return extensions;&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     /**&lt;br/&gt;
diff --git a/clients/src/test/java/org/apache/kafka/common/security/oauthbearer/internals/OAuthBearerClientInitialResponseTest.java b/clients/src/test/java/org/apache/kafka/common/security/oauthbearer/internals/OAuthBearerClientInitialResponseTest.java&lt;br/&gt;
index 3de6408accd..0ba956561df 100644&lt;br/&gt;
&amp;#8212; a/clients/src/test/java/org/apache/kafka/common/security/oauthbearer/internals/OAuthBearerClientInitialResponseTest.java&lt;br/&gt;
+++ b/clients/src/test/java/org/apache/kafka/common/security/oauthbearer/internals/OAuthBearerClientInitialResponseTest.java&lt;br/&gt;
@@ -17,6 +17,7 @@&lt;br/&gt;
 package org.apache.kafka.common.security.oauthbearer.internals;&lt;/p&gt;

&lt;p&gt; import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.junit.Assert.assertTrue;&lt;/p&gt;

&lt;p&gt; import org.apache.kafka.common.security.auth.SaslExtensions;&lt;br/&gt;
 import org.junit.Test;&lt;br/&gt;
@@ -99,4 +100,25 @@ public void testRfc7688Example() throws Exception &lt;/p&gt;
{
         assertEquals(&quot;server.example.com&quot;, response.extensions().map().get(&quot;host&quot;));
         assertEquals(&quot;143&quot;, response.extensions().map().get(&quot;port&quot;));
     }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testNoExtensionsFromByteArray() throws Exception &lt;/p&gt;
{
+        String message = &quot;n,a=user@example.com,\u0001&quot; +
+                &quot;auth=Bearer vF9dft4qmTc2Nvb3RlckBhbHRhdmlzdGEuY29tCg\u0001\u0001&quot;;
+        OAuthBearerClientInitialResponse response = new OAuthBearerClientInitialResponse(message.getBytes(StandardCharsets.UTF_8));
+        assertEquals(&quot;vF9dft4qmTc2Nvb3RlckBhbHRhdmlzdGEuY29tCg&quot;, response.tokenValue());
+        assertEquals(&quot;user@example.com&quot;, response.authorizationId());
+        assertTrue(response.extensions().map().isEmpty());
+    }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testNoExtensionsFromTokenAndNullExtensions() throws Exception &lt;/p&gt;
{
+        OAuthBearerClientInitialResponse response = new OAuthBearerClientInitialResponse(&quot;token&quot;, null);
+        assertTrue(response.extensions().map().isEmpty());
+    }
&lt;p&gt;+&lt;br/&gt;
+    @Test&lt;br/&gt;
+    public void testValidateNullExtensions() throws Exception &lt;/p&gt;
{
+        OAuthBearerClientInitialResponse.validateExtensions(null);
+    }
&lt;p&gt; }&lt;br/&gt;
diff --git a/clients/src/test/java/org/apache/kafka/common/security/oauthbearer/internals/OAuthBearerSaslClientTest.java b/clients/src/test/java/org/apache/kafka/common/security/oauthbearer/internals/OAuthBearerSaslClientTest.java&lt;br/&gt;
index 55a86245da4..fad743136f3 100644&lt;br/&gt;
&amp;#8212; a/clients/src/test/java/org/apache/kafka/common/security/oauthbearer/internals/OAuthBearerSaslClientTest.java&lt;br/&gt;
+++ b/clients/src/test/java/org/apache/kafka/common/security/oauthbearer/internals/OAuthBearerSaslClientTest.java&lt;br/&gt;
@@ -20,8 +20,8 @@&lt;br/&gt;
 import org.apache.kafka.common.security.auth.SaslExtensionsCallback;&lt;br/&gt;
 import org.apache.kafka.common.security.auth.AuthenticateCallbackHandler;&lt;br/&gt;
 import org.apache.kafka.common.security.auth.SaslExtensions;&lt;br/&gt;
+import org.apache.kafka.common.security.oauthbearer.OAuthBearerToken;&lt;br/&gt;
 import org.apache.kafka.common.security.oauthbearer.OAuthBearerTokenCallback;&lt;br/&gt;
-import org.apache.kafka.common.security.oauthbearer.internals.unsecured.OAuthBearerUnsecuredJws;&lt;br/&gt;
 import org.easymock.EasyMockSupport;&lt;br/&gt;
 import org.junit.Test;&lt;/p&gt;

&lt;p&gt;@@ -30,9 +30,11 @@&lt;br/&gt;
 import javax.security.auth.login.AppConfigurationEntry;&lt;br/&gt;
 import javax.security.sasl.SaslException;&lt;br/&gt;
 import java.nio.charset.StandardCharsets;&lt;br/&gt;
+import java.util.Collections;&lt;br/&gt;
 import java.util.LinkedHashMap;&lt;br/&gt;
 import java.util.List;&lt;br/&gt;
 import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;/p&gt;

&lt;p&gt; import static org.junit.Assert.assertEquals;&lt;br/&gt;
 import static org.junit.Assert.fail;&lt;br/&gt;
@@ -70,7 +72,32 @@ public void configure(Map&amp;lt;String, ?&amp;gt; configs, String saslMechanism, List&amp;lt;AppConf&lt;br/&gt;
         public void handle(Callback[] callbacks) throws UnsupportedCallbackException {&lt;br/&gt;
             for (Callback callback : callbacks) {&lt;br/&gt;
                 if (callback instanceof OAuthBearerTokenCallback)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;((OAuthBearerTokenCallback) callback).token(createMock(OAuthBearerUnsecuredJws.class));&lt;br/&gt;
+                    ((OAuthBearerTokenCallback) callback).token(new OAuthBearerToken() 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+                        @Override+                        public String value() {
+                            return &quot;&quot;;
+                        }++                        @Override+                        public Set&amp;lt;String&amp;gt; scope() {
+                            return Collections.emptySet();
+                        }++                        @Override+                        public long lifetimeMs() {
+                            return 100;
+                        }++                        @Override+                        public String principalName() {
+                            return &quot;principalName&quot;;
+                        }++                        @Override+                        public Long startTimeMs() {
+                            return null;
+                        }+                    }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;);&lt;br/&gt;
                 else if (callback instanceof SaslExtensionsCallback) {&lt;br/&gt;
                     if (toThrow)&lt;br/&gt;
                         throw new ConfigException(errorMessage);&lt;br/&gt;
@@ -88,7 +115,7 @@ public void close() {&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     @Test&lt;br/&gt;
     public void testAttachesExtensionsToFirstClientMessage() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String expectedToken = new String(new OAuthBearerClientInitialResponse(null, testExtensions).toBytes(), StandardCharsets.UTF_8);&lt;br/&gt;
+        String expectedToken = new String(new OAuthBearerClientInitialResponse(&quot;&quot;, testExtensions).toBytes(), StandardCharsets.UTF_8);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         OAuthBearerSaslClient client = new OAuthBearerSaslClient(new ExtensionsCallbackHandler(false));&lt;/p&gt;

&lt;p&gt;@@ -101,7 +128,7 @@ public void testAttachesExtensionsToFirstClientMessage() throws Exception {&lt;br/&gt;
     public void testNoExtensionsDoesNotAttachAnythingToFirstClientMessage() throws Exception {&lt;br/&gt;
         TEST_PROPERTIES.clear();&lt;br/&gt;
         testExtensions = new SaslExtensions(TEST_PROPERTIES);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String expectedToken = new String(new OAuthBearerClientInitialResponse(null, new SaslExtensions(TEST_PROPERTIES)).toBytes(), StandardCharsets.UTF_8);&lt;br/&gt;
+        String expectedToken = new String(new OAuthBearerClientInitialResponse(&quot;&quot;, new SaslExtensions(TEST_PROPERTIES)).toBytes(), StandardCharsets.UTF_8);&lt;br/&gt;
         OAuthBearerSaslClient client = new OAuthBearerSaslClient(new ExtensionsCallbackHandler(false));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         String message = new String(client.evaluateChallenge(&quot;&quot;.getBytes()), StandardCharsets.UTF_8);&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 11 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3xacf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>