<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:27:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-3968] fsync() is not called on parent directory when new FileMessageSet is flushed to disk</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-3968</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Kafka does not call fsync() on directory when new log segment is created and flushed to disk.&lt;/p&gt;

&lt;p&gt;The problem is that following sequence of calls doesn&apos;t guarantee file durability: &lt;/p&gt;

&lt;p&gt;fd = open(&quot;log&quot;, O_RDWR | O_CREATE); // suppose open creates &quot;log&quot;&lt;br/&gt;
write(fd);&lt;br/&gt;
fsync(fd);&lt;/p&gt;

&lt;p&gt;If system crashes after fsync() but before parent directory have been flushed to disk, the log file can disappear.&lt;br/&gt;
This is true at least for ext4 on Linux.&lt;/p&gt;

&lt;p&gt;Proposed solution is to flush directory when flush() is called for the first time.&lt;/p&gt;</description>
                <environment>Linux, ext4 filesystem</environment>
        <key id="12989828">KAFKA-3968</key>
            <summary>fsync() is not called on parent directory when new FileMessageSet is flushed to disk</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tson">Cong Ding</assignee>
                                    <reporter username="nepal">Andrey Neporada</reporter>
                        <labels>
                            <label>reliability</label>
                    </labels>
                <created>Fri, 15 Jul 2016 15:33:54 +0000</created>
                <updated>Sat, 12 Oct 2024 03:36:08 +0000</updated>
                            <resolved>Sat, 3 Apr 2021 00:35:56 +0000</resolved>
                                    <version>0.9.0.1</version>
                    <version>0.10.0.0</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>log</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15379577" author="githubbot" created="Fri, 15 Jul 2016 15:39:36 +0000"  >&lt;p&gt;GitHub user nepal opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1626&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1626&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3968&quot; title=&quot;fsync() is not called on parent directory when new FileMessageSet is flushed to disk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3968&quot;&gt;&lt;del&gt;KAFKA-3968&lt;/del&gt;&lt;/a&gt; Call fsync for parent directory first time when we flush&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230; message set&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/nepal/kafka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/nepal/kafka&lt;/a&gt; fsync-directory-on-flush&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/kafka/pull/1626.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/1626.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1626&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 205df3e0b2e951b3ec8555f108217f8b2793e237&lt;br/&gt;
Author: Andrey L. Neporada &amp;lt;aneporada@yandex-team.ru&amp;gt;&lt;br/&gt;
Date:   2016-07-15T15:38:25Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-3968&quot; title=&quot;fsync() is not called on parent directory when new FileMessageSet is flushed to disk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-3968&quot;&gt;&lt;del&gt;KAFKA-3968&lt;/del&gt;&lt;/a&gt; Call fsync for parent directory first time when we flush message set&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="17314124" author="junrao" created="Sat, 3 Apr 2021 00:35:56 +0000"  >&lt;p&gt;Merged to trunk. Thanks Cong for fixing this long lasting issue.&lt;/p&gt;</comment>
                            <comment id="17344701" author="junrao" created="Fri, 14 May 2021 16:27:13 +0000"  >&lt;p&gt;Merged the reworked PR &lt;a href=&quot;https://github.com/apache/kafka/pull/10680&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/10680&lt;/a&gt;&#160;to trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13002774">KAFKA-4127</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 26 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i311fz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>