<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:21:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9335] java.lang.IllegalArgumentException: Number of partitions must be at least 1.</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9335</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Hey,&lt;/p&gt;

&lt;p&gt;When trying to upgrade our Kafka streams client to 2.4.0 (from 2.3.1) we encountered the following exception:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalArgumentException: &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of partitions must be at least 1.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It&apos;s important to notice that the exact same code works just fine at 2.3.1.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I have created a &quot;toy&quot; example which reproduces this exception:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/nitayk/50da33b7bcce19ad0a7f8244d309cb8f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/nitayk/50da33b7bcce19ad0a7f8244d309cb8f&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and I would love to get some insight regarding why its happening / ways to get around it&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</description>
                <environment></environment>
        <key id="13276450">KAFKA-9335</key>
            <summary>java.lang.IllegalArgumentException: Number of partitions must be at least 1.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bchen225242">Boyang Chen</assignee>
                                    <reporter username="nitay.k">Nitay Kufert</reporter>
                        <labels>
                            <label>bug</label>
                    </labels>
                <created>Thu, 26 Dec 2019 10:53:16 +0000</created>
                <updated>Tue, 21 Apr 2020 21:50:53 +0000</updated>
                            <resolved>Tue, 7 Jan 2020 23:24:53 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>2.4.1</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="17006659" author="dongjin.lee.kr" created="Thu, 2 Jan 2020 08:28:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;java.lang.IllegalArgumentException: The number of partitions must be at least 1.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This Exception is thrown when an internal topic (i.e., &apos;xxxxxx-changelog&apos; or &apos;xxxxxx-repartition&apos;) with 0 partition exists. Could you check the name of the internal topics &amp;amp; their partition counts? It will be a great help for tracking the reason.&lt;/p&gt;</comment>
                            <comment id="17006680" author="nitay.k" created="Thu, 2 Jan 2020 09:11:12 +0000"  >&lt;p&gt;In the example I provided, the exception is thrown over the following key:&#160;&lt;br/&gt;
 missing-partitions-example-odd_store_2-repartition&lt;/p&gt;

&lt;p&gt;And regarding the number of partitions - the topic can&apos;t be found so I guess that why it has 0 partitions.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17007101" author="bchen225242" created="Thu, 2 Jan 2020 21:50:40 +0000"  >&lt;p&gt;Thanks for the report &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nitay.k&quot; class=&quot;user-hover&quot; rel=&quot;nitay.k&quot;&gt;nitay.k&lt;/a&gt;. Could you be more specific about the reproducing process, for example:&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;Does this reproduce on local env?&lt;/li&gt;
	&lt;li&gt;How many topic partitions we need to configure for each input and output topic?&lt;/li&gt;
	&lt;li&gt;Do we need data flowing into the input topic when running this example?&lt;/li&gt;
	&lt;li&gt;Does this only fail for 2.3.1 -&amp;gt; 2.4 upgrade? At least, does 2.2 and 2.3 could also reproduce issue with this example?&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17007394" author="nitay.k" created="Fri, 3 Jan 2020 10:42:29 +0000"  >&lt;p&gt;1. Yes&lt;br/&gt;
2. I tried with 12 but I believe it wouldn&apos;t matter&lt;br/&gt;
3. Pretty sure you don&apos;t needs any data&lt;br/&gt;
4. Tested it with 2.3.1 and it works, didn&apos;t try running it with 2.2 or 2.3 &lt;/p&gt;</comment>
                            <comment id="17007641" author="bchen225242" created="Fri, 3 Jan 2020 17:31:38 +0000"  >&lt;p&gt;Sounds good, I will try to reproduce it today.&lt;/p&gt;</comment>
                            <comment id="17007853" author="bchen225242" created="Sat, 4 Jan 2020 00:20:36 +0000"  >&lt;p&gt;By applying your example, I could successfully reproduce the symptom. In fact, this is not upgrade related but a 2.4 specific correctness bug.&#160;&lt;/p&gt;

&lt;p&gt;The topology of the example used a chaining of 3 sub-topologies, which has a dependency A -&amp;gt; B -&amp;gt; C all connected by repartition topics.&lt;/p&gt;

&lt;p&gt;We gather the repartition topic metadata first, so that we created a mapping as &lt;span class=&quot;error&quot;&gt;&amp;#91;A-output-rep, B-output-rep&amp;#93;&lt;/span&gt;, and they all have no partitions defined yet.&lt;/p&gt;

&lt;p&gt;Next, a lookup of C&apos;s input partition (= B-output-rep) will be informed that the lookup fails, so it will try to look for the B&apos;s input partition (=A-output-rep), here&lt;/p&gt;

&lt;p&gt;as A-output is also a repartition topic which has no partition initialized either, the passed-down assignment is invalid as we still use a numPartitions = 0 after the if block.&lt;/p&gt;


&lt;p&gt;&lt;b&gt;To summarize, we need a chaining of 3 sub-topologies where both inputs for non-source topologies are repartition topics, and the sink topology gets initialized first.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;The explanation is bit tricky, but thanks so much for the reporting, and we will propose a fix shortly.&lt;/p&gt;</comment>
                            <comment id="17009915" author="githubbot" created="Tue, 7 Jan 2020 17:16:45 +0000"  >&lt;p&gt;abbccdda commented on pull request #7904: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9335&quot; title=&quot;java.lang.IllegalArgumentException: Number of partitions must be at least 1.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9335&quot;&gt;&lt;del&gt;KAFKA-9335&lt;/del&gt;&lt;/a&gt;: Fix StreamPartitionAssignor regression in repartition topics counts&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7904&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7904&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This PR fixes the regression introduced in 2.4 from 2 refactoring PRs:&lt;br/&gt;
   &lt;a href=&quot;https://github.com/apache/kafka/pull/7249/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7249/&lt;/a&gt;&lt;br/&gt;
   &lt;a href=&quot;https://github.com/apache/kafka/pull/7419/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7419/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   The bug was introduced by having a logical path leading `numPartitionsCandidate` to be 0, which is assigned to `numPartitions` and later being checked by `setNumPartitions`. In the subsequent check we will throw illegal argument if the `numPartitions` is 0.&lt;/p&gt;

&lt;p&gt;   This bug is both impacting new 2.4 application and upgrades to 2.4 in certain types of topology. The example in original JIRA was imported as a new integration test to guard against such regression. We also verify that without the bug fix application will still fail by running this integration test.&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;Committer Checklist (excluded from commit message)&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Verify design and implementation&lt;/li&gt;
	&lt;li&gt;[ ] Verify test coverage and CI build status&lt;/li&gt;
	&lt;li&gt;[ ] Verify documentation (including upgrade notes)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17010149" author="githubbot" created="Tue, 7 Jan 2020 22:59:32 +0000"  >&lt;p&gt;guozhangwang commented on pull request #7904: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9335&quot; title=&quot;java.lang.IllegalArgumentException: Number of partitions must be at least 1.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9335&quot;&gt;&lt;del&gt;KAFKA-9335&lt;/del&gt;&lt;/a&gt;: Fix StreamPartitionAssignor regression in repartition topics counts&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7904&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7904&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="17039049" author="vveeramani" created="Tue, 18 Feb 2020 12:41:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bchen225242&quot; class=&quot;user-hover&quot; rel=&quot;bchen225242&quot;&gt;bchen225242&lt;/a&gt;&#160;thanks for looking into this... Is there any work around for this defect, till 2.4.1 release becomes available?&#160;&lt;/p&gt;</comment>
                            <comment id="17089096" author="rebekkaxi" created="Tue, 21 Apr 2020 21:50:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vveeramani&quot; class=&quot;user-hover&quot; rel=&quot;vveeramani&quot;&gt;vveeramani&lt;/a&gt;&#160;I test it, the 2.4.1 fixed it&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 29 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0a09k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>