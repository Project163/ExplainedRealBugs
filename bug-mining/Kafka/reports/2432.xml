<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 17:21:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[KAFKA-9244] Update of old FK reference on RHS should not trigger join result</title>
                <link>https://issues.apache.org/jira/browse/KAFKA-9244</link>
                <project id="12311720" key="KAFKA">Kafka</project>
                    <description>&lt;p&gt;Perform a KTable-KTable foreign key join, after changing LHS FK reference from FK1 -&amp;gt; FK2, populating update on RHS with FK1 should not produce join result.&lt;/p&gt;

&lt;p&gt;Below test case failed at the point of last &quot;is(emptyMap())&quot;, after we published data on RHS with previous associated foreign key.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void doJoinFromLeftThenChangeForeignKeyMappingOfLeft() {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Topology topology = getTopology(streamsConfig, &lt;span class=&quot;code-quote&quot;&gt;&quot;store&quot;&lt;/span&gt;, leftJoin);
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TopologyTestDriver driver = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TopologyTestDriver(topology, streamsConfig)) {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TestInputTopic&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; right = driver.createInputTopic(RIGHT_TABLE, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringSerializer(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringSerializer());
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TestInputTopic&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; left = driver.createInputTopic(LEFT_TABLE, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringSerializer(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringSerializer());
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TestOutputTopic&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; outputTopic = driver.createOutputTopic(OUTPUT, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringDeserializer(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringDeserializer());
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; KeyValueStore&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; store = driver.getKeyValueStore(&lt;span class=&quot;code-quote&quot;&gt;&quot;store&quot;&lt;/span&gt;);

            &lt;span class=&quot;code-comment&quot;&gt;// Pre-populate the RHS records. This test is all about what happens when we change LHS records foreign key reference
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// then populate update on RHS
&lt;/span&gt;            right.pipeInput(&lt;span class=&quot;code-quote&quot;&gt;&quot;rhs1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;rhsValue1&quot;&lt;/span&gt;);
            right.pipeInput(&lt;span class=&quot;code-quote&quot;&gt;&quot;rhs2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;rhsValue2&quot;&lt;/span&gt;);

            assertThat(
                    outputTopic.readKeyValuesToMap(),
                    is(emptyMap())
            );
            assertThat(
                    asMap(store),
                    is(emptyMap())
            );

            left.pipeInput(&lt;span class=&quot;code-quote&quot;&gt;&quot;lhs1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;lhsValue1|rhs1&quot;&lt;/span&gt;);

            {
                &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; expected = mkMap(
                        mkEntry(&lt;span class=&quot;code-quote&quot;&gt;&quot;lhs1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;(lhsValue1|rhs1,rhsValue1)&quot;&lt;/span&gt;)
                );
                assertThat(
                        outputTopic.readKeyValuesToMap(),
                        is(expected)
                );
                assertThat(
                        asMap(store),
                        is(expected)
                );
            }

            &lt;span class=&quot;code-comment&quot;&gt;// Change LHS foreign key reference
&lt;/span&gt;            left.pipeInput(&lt;span class=&quot;code-quote&quot;&gt;&quot;lhs1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;lhsValue1|rhs2&quot;&lt;/span&gt;);
            {
                &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; expected = mkMap(
                        mkEntry(&lt;span class=&quot;code-quote&quot;&gt;&quot;lhs1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;(lhsValue1|rhs2,rhsValue2)&quot;&lt;/span&gt;)
                );
                assertThat(
                        outputTopic.readKeyValuesToMap(),
                        is(expected)
                );
                assertThat(
                        asMap(store),
                        is(expected)
                );
            }

            &lt;span class=&quot;code-comment&quot;&gt;// Populate RHS update on old LHS foreign key ref
&lt;/span&gt;            right.pipeInput(&lt;span class=&quot;code-quote&quot;&gt;&quot;rhs1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;rhsValue1Delta&quot;&lt;/span&gt;);
            {
                assertThat(
                        outputTopic.readKeyValuesToMap(),
                        is(emptyMap())
                );
                assertThat(
                        asMap(store),
                        is(mkMap(
                                mkEntry(&lt;span class=&quot;code-quote&quot;&gt;&quot;lhs1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;(lhsValue1|rhs2,rhsValue2)&quot;&lt;/span&gt;)
                        ))
                );
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13271118">KAFKA-9244</key>
            <summary>Update of old FK reference on RHS should not trigger join result</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mjsax">Matthias J. Sax</assignee>
                                    <reporter username="nikuis">Kin Siu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Nov 2019 00:14:16 +0000</created>
                <updated>Sat, 30 Nov 2019 05:33:46 +0000</updated>
                            <resolved>Sat, 30 Nov 2019 05:33:46 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>streams</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16984045" author="mjsax" created="Thu, 28 Nov 2019 00:32:34 +0000"  >&lt;p&gt;In you last test case,&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;right.pipeInput(&quot;rhs1&quot;, &quot;rhsValue1Delta&quot;);&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Why do you expect:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;mkEntry(&quot;lhs1&quot;, &quot;(lhsValue1|rhs2,rhsValue2)&quot;)&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;As you say not update should be produced, and thus&#160;the result should be empty.&lt;/p&gt;

&lt;p&gt;Note that each time you call&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;outputTopic.readKeyValuesToMap()&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;output records are received and than &quot;purged&quot;, hence, you won&apos;t receive them twice. `readKeyValuesToMap()` does &lt;em&gt;not&lt;/em&gt; access the KTable state store, but it only consumer the table output/changelog topic and does not re-read the whole topic each time, but reads it incrementally.&lt;/p&gt;</comment>
                            <comment id="16984048" author="nikuis" created="Thu, 28 Nov 2019 00:44:02 +0000"  >&lt;p&gt;mkEntry(&quot;lhs1&quot;, &quot;(lhsValue1|rhs2,rhsValue2)&quot;)&#160; &amp;lt;-- this is a line to check the State store of join result, since my change of &quot;rhs1&quot; shouldn&apos;t generate value, we should have same state store value as before.&lt;/p&gt;

&lt;p&gt;And above test case failed on the point of last &quot;is(emptyMap())&quot; check, failure message of JUnit test as below :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.AssertionError: 
Expected: is &amp;lt;{}&amp;gt;
     but: was &amp;lt;{lhs1=(lhsValue1|rhs2,rhsValue1Delta)}&amp;gt;
Expected :is &amp;lt;{}&amp;gt;
Actual   :&amp;lt;{lhs1=(lhsValue1|rhs2,rhsValue1Delta)}&amp;gt;
&amp;lt;Click to see difference&amp;gt;
	at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:18)
	at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:6)
	at org.apache.kafka.streams.integration.KTableKTableForeignKeyJoinIntegrationTest.doJoinFromLeftThenChangeForeignKeyMappingOfLeft(KTableKTableForeignKeyJoinIntegrationTest.java:142)
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16984174" author="mjsax" created="Thu, 28 Nov 2019 06:34:27 +0000"  >&lt;p&gt;Ah sorry. I mixed up something when reading your test case. I was able to reproduce the issue. Thank for reporting it.&lt;/p&gt;</comment>
                            <comment id="16984184" author="githubbot" created="Thu, 28 Nov 2019 06:59:08 +0000"  >&lt;p&gt;mjsax commented on pull request #7758: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9244&quot; title=&quot;Update of old FK reference on RHS should not trigger join result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9244&quot;&gt;&lt;del&gt;KAFKA-9244&lt;/del&gt;&lt;/a&gt;: Update FK reference should unsubscribe old FK&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7758&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7758&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Call for review @vvcephei @bellemare &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16984667" author="nikuis" created="Thu, 28 Nov 2019 22:39:44 +0000"  >&lt;p&gt;Thx for the speedy fix on this, this new feature will replace our home brew foreign key join solution, and simplify our code base&#160;substantially.&lt;/p&gt;</comment>
                            <comment id="16985265" author="githubbot" created="Sat, 30 Nov 2019 05:21:11 +0000"  >&lt;p&gt;mjsax commented on pull request #7758: &lt;a href=&quot;https://issues.apache.org/jira/browse/KAFKA-9244&quot; title=&quot;Update of old FK reference on RHS should not trigger join result&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KAFKA-9244&quot;&gt;&lt;del&gt;KAFKA-9244&lt;/del&gt;&lt;/a&gt;: Update FK reference should unsubscribe old FK&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/kafka/pull/7758&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/kafka/pull/7758&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on to GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 50 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z093cw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>